{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDM0NTI1ODQy", "number": 8754, "title": "Fix missing notification events issue", "bodyText": "Fixes wso2/product-apim#8340", "createdAt": "2020-06-15T13:02:29Z", "url": "https://github.com/wso2/carbon-apimgt/pull/8754", "merged": true, "mergeCommit": {"oid": "c405fae0b22ff69ea7b3112f6551b670d10f55f6"}, "closed": true, "closedAt": "2020-06-17T10:41:28Z", "author": {"login": "CrowleyRajapakse"}, "timelineItems": {"totalCount": 9, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcrgacIABqjM0NDQzMjE4NTc=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcsHeaLAFqTQzMjI3NjY1Mw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "d9338f3444eb774f23cfbf26dc0cb3ef7434baaa", "author": {"user": {"login": "CrowleyRajapakse", "name": "Crowley Rajapakse"}}, "url": "https://github.com/wso2/carbon-apimgt/commit/d9338f3444eb774f23cfbf26dc0cb3ef7434baaa", "committedDate": "2020-06-15T13:00:21Z", "message": "fix missing notification events"}, "afterCommit": {"oid": "9889290a078c42797f72abc243ed1077a77d43c0", "author": {"user": {"login": "CrowleyRajapakse", "name": "Crowley Rajapakse"}}, "url": "https://github.com/wso2/carbon-apimgt/commit/9889290a078c42797f72abc243ed1077a77d43c0", "committedDate": "2020-06-15T13:10:19Z", "message": "fix missing notification events"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDMyMDEzNTE3", "url": "https://github.com/wso2/carbon-apimgt/pull/8754#pullrequestreview-432013517", "createdAt": "2020-06-17T02:21:21Z", "commit": {"oid": "9889290a078c42797f72abc243ed1077a77d43c0"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xN1QwMjoyMToyMVrOGkzVvw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xN1QwMjoyMToyMVrOGkzVvw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTI0MzA3MQ==", "bodyText": "don't we hv to send subscription related events?", "url": "https://github.com/wso2/carbon-apimgt/pull/8754#discussion_r441243071", "createdAt": "2020-06-17T02:21:21Z", "author": {"login": "chamilaadhi"}, "path": "components/apimgt/org.wso2.carbon.apimgt.impl/src/main/java/org/wso2/carbon/apimgt/impl/APIProviderImpl.java", "diffHunk": "@@ -2291,6 +2292,12 @@ public void makeAPIKeysForwardCompatible(API api) throws APIManagementException\n             apiMgtDAO.makeKeysForwardCompatible(new ApiTypeWrapper(api), oldVersion\n             );\n         }\n+        int apiId = apiMgtDAO.getAPIID(api.getId(), null);\n+        APIEvent apiEvent = new APIEvent(UUID.randomUUID().toString(), System.currentTimeMillis(),", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "9889290a078c42797f72abc243ed1077a77d43c0"}, "originalPosition": 13}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "9889290a078c42797f72abc243ed1077a77d43c0", "author": {"user": {"login": "CrowleyRajapakse", "name": "Crowley Rajapakse"}}, "url": "https://github.com/wso2/carbon-apimgt/commit/9889290a078c42797f72abc243ed1077a77d43c0", "committedDate": "2020-06-15T13:10:19Z", "message": "fix missing notification events"}, "afterCommit": {"oid": "ed68d7667612da32d17f63eff571869f1bd9cb7d", "author": {"user": {"login": "CrowleyRajapakse", "name": "Crowley Rajapakse"}}, "url": "https://github.com/wso2/carbon-apimgt/commit/ed68d7667612da32d17f63eff571869f1bd9cb7d", "committedDate": "2020-06-17T05:34:38Z", "message": "fix missing notification events"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "af98df696fced642eda0ae0bcfc045c008cfeebe", "author": {"user": {"login": "CrowleyRajapakse", "name": "Crowley Rajapakse"}}, "url": "https://github.com/wso2/carbon-apimgt/commit/af98df696fced642eda0ae0bcfc045c008cfeebe", "committedDate": "2020-06-17T05:38:31Z", "message": "fix missing notification events"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "ed68d7667612da32d17f63eff571869f1bd9cb7d", "author": {"user": {"login": "CrowleyRajapakse", "name": "Crowley Rajapakse"}}, "url": "https://github.com/wso2/carbon-apimgt/commit/ed68d7667612da32d17f63eff571869f1bd9cb7d", "committedDate": "2020-06-17T05:34:38Z", "message": "fix missing notification events"}, "afterCommit": {"oid": "af98df696fced642eda0ae0bcfc045c008cfeebe", "author": {"user": {"login": "CrowleyRajapakse", "name": "Crowley Rajapakse"}}, "url": "https://github.com/wso2/carbon-apimgt/commit/af98df696fced642eda0ae0bcfc045c008cfeebe", "committedDate": "2020-06-17T05:38:31Z", "message": "fix missing notification events"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c2642272efaca3507463a56717724c061565ef25", "author": {"user": {"login": "CrowleyRajapakse", "name": "Crowley Rajapakse"}}, "url": "https://github.com/wso2/carbon-apimgt/commit/c2642272efaca3507463a56717724c061565ef25", "committedDate": "2020-06-17T06:33:32Z", "message": "adding missing multi-dc changes"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDMyMTY3MzM2", "url": "https://github.com/wso2/carbon-apimgt/pull/8754#pullrequestreview-432167336", "createdAt": "2020-06-17T08:19:48Z", "commit": {"oid": "c2642272efaca3507463a56717724c061565ef25"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xN1QwODoxOTo0OFrOGk68ow==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xN1QwODoxOTo0OFrOGk68ow==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTM2NzcxNQ==", "bodyText": "I don't think you have to pass the tenant Id , you could get the tenant id from the API provider using APIUtil.getTenantId(APIUtil.replaceEmailDomainBack(api.getId().getProviderName())", "url": "https://github.com/wso2/carbon-apimgt/pull/8754#discussion_r441367715", "createdAt": "2020-06-17T08:19:48Z", "author": {"login": "chamilaadhi"}, "path": "components/apimgt/org.wso2.carbon.apimgt.impl/src/main/java/org/wso2/carbon/apimgt/impl/APIProviderImpl.java", "diffHunk": "@@ -2288,8 +2289,7 @@ public void makeAPIKeysForwardCompatible(API api) throws APIManagementException\n         Collections.sort(sortedAPIs, comparator);\n         for (int i = sortedAPIs.size() - 1; i >= 0; i--) {\n             String oldVersion = sortedAPIs.get(i).getId().getVersion();\n-            apiMgtDAO.makeKeysForwardCompatible(new ApiTypeWrapper(api), oldVersion\n-            );\n+            apiMgtDAO.makeKeysForwardCompatible(new ApiTypeWrapper(api), oldVersion, tenantId);\n         }", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c2642272efaca3507463a56717724c061565ef25"}, "originalPosition": 15}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "394d1f883e536c2a20ea790593ffd2dedb00f0f3", "author": {"user": {"login": "CrowleyRajapakse", "name": "Crowley Rajapakse"}}, "url": "https://github.com/wso2/carbon-apimgt/commit/394d1f883e536c2a20ea790593ffd2dedb00f0f3", "committedDate": "2020-06-17T08:57:43Z", "message": "requested changes"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDMyMjc2NjUz", "url": "https://github.com/wso2/carbon-apimgt/pull/8754#pullrequestreview-432276653", "createdAt": "2020-06-17T10:41:18Z", "commit": {"oid": "394d1f883e536c2a20ea790593ffd2dedb00f0f3"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2648, "cost": 1, "resetAt": "2021-11-02T10:47:05Z"}}}