{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDI2OTg1MzQz", "number": 8640, "title": "[Admin-REST API] API to get role-scope mapping.", "bodyText": "Fix wso2/product-apim#8201 (wso2/product-apim#7954)\nThis PR contains the GET operation only", "createdAt": "2020-06-03T06:13:58Z", "url": "https://github.com/wso2/carbon-apimgt/pull/8640", "merged": true, "mergeCommit": {"oid": "3e776fac22b8c05478438beb564a09998c909565"}, "closed": true, "closedAt": "2020-06-03T06:23:25Z", "author": {"login": "Meruja"}, "timelineItems": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcnjM8wgH2gAyNDI2OTg1MzQzOmRjZjdlZjZmZDhkOTM3OGI0MGMwZDc3YWVjNDgwN2VmN2I5OTNkMzg=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcxSd5VgFqTQ0MjM3NDYxMQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "dcf7ef6fd8d9378b40c0d77aec4807ef7b993d38", "author": {"user": {"login": "Meruja", "name": "Meruja Selvamanikkam"}}, "url": "https://github.com/wso2/carbon-apimgt/commit/dcf7ef6fd8d9378b40c0d77aec4807ef7b993d38", "committedDate": "2020-06-03T06:09:57Z", "message": "Added api to get role-scope mapping."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ddfef475ff8177fa377f2d5edcc6e65f8294785f", "author": {"user": {"login": "Meruja", "name": "Meruja Selvamanikkam"}}, "url": "https://github.com/wso2/carbon-apimgt/commit/ddfef475ff8177fa377f2d5edcc6e65f8294785f", "committedDate": "2020-06-03T06:17:30Z", "message": "Merge branch 'master' into admin-rest-api"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDIzMjQ5MTAx", "url": "https://github.com/wso2/carbon-apimgt/pull/8640#pullrequestreview-423249101", "createdAt": "2020-06-03T06:23:14Z", "commit": {"oid": "ddfef475ff8177fa377f2d5edcc6e65f8294785f"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDQyMzczODY3", "url": "https://github.com/wso2/carbon-apimgt/pull/8640#pullrequestreview-442373867", "createdAt": "2020-07-03T12:17:50Z", "commit": {"oid": "ddfef475ff8177fa377f2d5edcc6e65f8294785f"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wM1QxMjoxNzo1MVrOGsuknA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wM1QxMjoxNzo1MVrOGsuknA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0OTU1MzU2NA==", "bodyText": "Shall we catch the specific Exception here?", "url": "https://github.com/wso2/carbon-apimgt/pull/8640#discussion_r449553564", "createdAt": "2020-07-03T12:17:51Z", "author": {"login": "vithu30"}, "path": "components/apimgt/org.wso2.carbon.apimgt.rest.api.admin.v1/src/main/java/org/wso2/carbon/apimgt/rest/api/admin/v1/impl/SettingsApiServiceImpl.java", "diffHunk": "@@ -92,4 +93,23 @@ public Response settingsScopesScopeGet(String username, String scopeName, Messag\n         }\n         return Response.ok().entity(scopeSettingsDTO).build();\n     }\n+\n+    /**\n+     * Get all scopes and respective roles\n+     *\n+     * @return Role-Scope list\n+     */\n+    @Override\n+    public Response settingsScopesGet(MessageContext messageContext) {\n+        try {\n+            Map<String, String> roleScopeMapping = APIUtil.getRESTAPIScopesForTenant(MultitenantUtils\n+                    .getTenantDomain(RestApiUtil.getLoggedInUsername()));\n+            ScopeListDTO scopeListDTO = SettingsMappingUtil.fromScopeListToScopeListDTO(roleScopeMapping);\n+            return Response.ok().entity(scopeListDTO).build();\n+        } catch (Exception e) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ddfef475ff8177fa377f2d5edcc6e65f8294785f"}, "originalPosition": 25}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDQyMzc0NjEx", "url": "https://github.com/wso2/carbon-apimgt/pull/8640#pullrequestreview-442374611", "createdAt": "2020-07-03T12:19:19Z", "commit": {"oid": "ddfef475ff8177fa377f2d5edcc6e65f8294785f"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wM1QxMjoxOToxOVrOGsum2Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wM1QxMjoxOToxOVrOGsum2Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0OTU1NDEzNw==", "bodyText": "Shall we format this line?", "url": "https://github.com/wso2/carbon-apimgt/pull/8640#discussion_r449554137", "createdAt": "2020-07-03T12:19:19Z", "author": {"login": "vithu30"}, "path": "components/apimgt/org.wso2.carbon.apimgt.rest.api.admin.v1/src/main/java/org/wso2/carbon/apimgt/rest/api/admin/v1/utils/mappings/SettingsMappingUtil.java", "diffHunk": "@@ -136,4 +137,33 @@ private static SettingsKeyManagerConfigurationDTO fromKeyManagerConfigurationToS\n         }\n         return authorizedScopes;\n     }\n+\n+    /**\n+     * Convert list of API Scope to ScopeListDTO\n+     *\n+     * @param roleScopeMapping Map of a Role Scope  Mapping\n+     * @return ScopeListDTO list containing role scope mapping data\n+     */\n+    public static ScopeListDTO fromScopeListToScopeListDTO(Map<String, String>  roleScopeMapping) {\n+        ScopeListDTO scopeListDTO = new ScopeListDTO();\n+        scopeListDTO.setList(fromRoleScopeMapToRoleScopeDTOList(roleScopeMapping));\n+        return scopeListDTO;\n+    }\n+\n+    /**\n+     * Converts api role-scope mapping to RoleScopeDTO List.\n+     *\n+     * @param roleScopeMapping Map of a Role Scope  Mapping\n+     * @return RoleScopeDTO list\n+     */\n+    private static List<ScopeDTO>  fromRoleScopeMapToRoleScopeDTOList(Map<String, String>  roleScopeMapping) {\n+        List<ScopeDTO> scopeDTOs = new ArrayList<>(roleScopeMapping.size());\n+        for (Map.Entry<String, String>  mapping : roleScopeMapping.entrySet()) {\n+            ScopeDTO roleScopeDTO = new ScopeDTO();\n+                roleScopeDTO.setScope(mapping.getKey());", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ddfef475ff8177fa377f2d5edcc6e65f8294785f"}, "originalPosition": 40}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2696, "cost": 1, "resetAt": "2021-11-02T10:47:05Z"}}}