{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDQ1MzkyNTgy", "number": 8945, "reviewThreads": {"totalCount": 8, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wN1QxNzozNjo1NlrOEMLVYA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wOVQxNTowODo1MFrOEM8CLg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjgxMjA0MDY0OnYy", "diffSide": "RIGHT", "path": "components/apimgt/org.wso2.carbon.apimgt.gateway/src/main/java/org/wso2/carbon/apimgt/gateway/listeners/GatewayStartupListener.java", "isResolved": true, "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wN1QxNzozNjo1NlrOGuI4Tw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wOFQwMzo1MzozMFrOGuXLew==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MTAzMzE2Nw==", "bodyText": "equals otherway", "url": "https://github.com/wso2/carbon-apimgt/pull/8945#discussion_r451033167", "createdAt": "2020-07-07T17:36:56Z", "author": {"login": "tharindu1st"}, "path": "components/apimgt/org.wso2.carbon.apimgt.gateway/src/main/java/org/wso2/carbon/apimgt/gateway/listeners/GatewayStartupListener.java", "diffHunk": "@@ -69,13 +70,22 @@ private boolean deployArtifactsAtStartup() {\n         boolean flag = false;\n         if (gatewayArtifactSynchronizerProperties.isRetrieveFromStorageEnabled()) {\n             InMemoryAPIDeployer inMemoryAPIDeployer = new InMemoryAPIDeployer();\n-            flag = inMemoryAPIDeployer.deployAllAPIsAtGatewayStartup(gatewayArtifactSynchronizerProperties.getGatewayLabels());\n+            flag = inMemoryAPIDeployer.deployAllAPIsAtGatewayStartup(gatewayArtifactSynchronizerProperties\n+                    .getGatewayLabels());\n         }\n         return flag;\n     }\n \n     @Override\n     public void completedServerStartup() {\n+        if (gatewayArtifactSynchronizerProperties.isRetrieveFromStorageEnabled()) {\n+            if (gatewayArtifactSynchronizerProperties.getGatewayStartup()", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "7ced4e3722b46202905cbeebdefc7b1437cca06d"}, "originalPosition": 38}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MTAzMzMxNA==", "bodyText": "constant.equals", "url": "https://github.com/wso2/carbon-apimgt/pull/8945#discussion_r451033314", "createdAt": "2020-07-07T17:37:10Z", "author": {"login": "tharindu1st"}, "path": "components/apimgt/org.wso2.carbon.apimgt.gateway/src/main/java/org/wso2/carbon/apimgt/gateway/listeners/GatewayStartupListener.java", "diffHunk": "@@ -69,13 +70,22 @@ private boolean deployArtifactsAtStartup() {\n         boolean flag = false;\n         if (gatewayArtifactSynchronizerProperties.isRetrieveFromStorageEnabled()) {\n             InMemoryAPIDeployer inMemoryAPIDeployer = new InMemoryAPIDeployer();\n-            flag = inMemoryAPIDeployer.deployAllAPIsAtGatewayStartup(gatewayArtifactSynchronizerProperties.getGatewayLabels());\n+            flag = inMemoryAPIDeployer.deployAllAPIsAtGatewayStartup(gatewayArtifactSynchronizerProperties\n+                    .getGatewayLabels());\n         }\n         return flag;\n     }\n \n     @Override\n     public void completedServerStartup() {\n+        if (gatewayArtifactSynchronizerProperties.isRetrieveFromStorageEnabled()) {\n+            if (gatewayArtifactSynchronizerProperties.getGatewayStartup()", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MTAzMzE2Nw=="}, "originalCommit": {"oid": "7ced4e3722b46202905cbeebdefc7b1437cca06d"}, "originalPosition": 38}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MTI2NzQ1MQ==", "bodyText": "8bbfb81", "url": "https://github.com/wso2/carbon-apimgt/pull/8945#discussion_r451267451", "createdAt": "2020-07-08T03:53:30Z", "author": {"login": "Sarangan0219"}, "path": "components/apimgt/org.wso2.carbon.apimgt.gateway/src/main/java/org/wso2/carbon/apimgt/gateway/listeners/GatewayStartupListener.java", "diffHunk": "@@ -69,13 +70,22 @@ private boolean deployArtifactsAtStartup() {\n         boolean flag = false;\n         if (gatewayArtifactSynchronizerProperties.isRetrieveFromStorageEnabled()) {\n             InMemoryAPIDeployer inMemoryAPIDeployer = new InMemoryAPIDeployer();\n-            flag = inMemoryAPIDeployer.deployAllAPIsAtGatewayStartup(gatewayArtifactSynchronizerProperties.getGatewayLabels());\n+            flag = inMemoryAPIDeployer.deployAllAPIsAtGatewayStartup(gatewayArtifactSynchronizerProperties\n+                    .getGatewayLabels());\n         }\n         return flag;\n     }\n \n     @Override\n     public void completedServerStartup() {\n+        if (gatewayArtifactSynchronizerProperties.isRetrieveFromStorageEnabled()) {\n+            if (gatewayArtifactSynchronizerProperties.getGatewayStartup()", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MTAzMzE2Nw=="}, "originalCommit": {"oid": "7ced4e3722b46202905cbeebdefc7b1437cca06d"}, "originalPosition": 38}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjgxMjA0NTU4OnYy", "diffSide": "RIGHT", "path": "components/apimgt/org.wso2.carbon.apimgt.gateway/src/main/java/org/wso2/carbon/apimgt/gateway/listeners/GatewayStartupListener.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wN1QxNzozODoxM1rOGuI7QA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wOFQwMzo1MjoxOFrOGuXKaQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MTAzMzkyMA==", "bodyText": "does this needed", "url": "https://github.com/wso2/carbon-apimgt/pull/8945#discussion_r451033920", "createdAt": "2020-07-07T17:38:13Z", "author": {"login": "tharindu1st"}, "path": "components/apimgt/org.wso2.carbon.apimgt.gateway/src/main/java/org/wso2/carbon/apimgt/gateway/listeners/GatewayStartupListener.java", "diffHunk": "@@ -38,6 +39,7 @@\n     private JMSTransportHandler jmsTransportHandlerForTrafficManager;\n     private JMSTransportHandler jmsTransportHandlerForEventHub;\n     private GatewayArtifactSynchronizerProperties gatewayArtifactSynchronizerProperties;\n+    private boolean isAPIsDeployedInSyncMode = false;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "7ced4e3722b46202905cbeebdefc7b1437cca06d"}, "originalPosition": 12}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MTI2NzE3Nw==", "bodyText": "This is to verify whether all the APIs in DB are deployed in the gateway. This will become true only after every API is deployed correctly. If not deployAPIsInSyncMode() will be again triggered until each and every API is deployed. If all the APIs get deployed correctly then isAPIsDeployedInSyncMode   becomes true and server will startup.", "url": "https://github.com/wso2/carbon-apimgt/pull/8945#discussion_r451267177", "createdAt": "2020-07-08T03:52:18Z", "author": {"login": "Sarangan0219"}, "path": "components/apimgt/org.wso2.carbon.apimgt.gateway/src/main/java/org/wso2/carbon/apimgt/gateway/listeners/GatewayStartupListener.java", "diffHunk": "@@ -38,6 +39,7 @@\n     private JMSTransportHandler jmsTransportHandlerForTrafficManager;\n     private JMSTransportHandler jmsTransportHandlerForEventHub;\n     private GatewayArtifactSynchronizerProperties gatewayArtifactSynchronizerProperties;\n+    private boolean isAPIsDeployedInSyncMode = false;", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MTAzMzkyMA=="}, "originalCommit": {"oid": "7ced4e3722b46202905cbeebdefc7b1437cca06d"}, "originalPosition": 12}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjgxMjA0ODQwOnYy", "diffSide": "RIGHT", "path": "components/apimgt/org.wso2.carbon.apimgt.gateway/src/main/java/org/wso2/carbon/apimgt/gateway/listeners/GatewayStartupListener.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wN1QxNzozOTowNFrOGuI9EA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wOFQwMzo1MzoxN1rOGuXLTQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MTAzNDM4NA==", "bodyText": "no need to have if condition since it decided to go in sync.", "url": "https://github.com/wso2/carbon-apimgt/pull/8945#discussion_r451034384", "createdAt": "2020-07-07T17:39:04Z", "author": {"login": "tharindu1st"}, "path": "components/apimgt/org.wso2.carbon.apimgt.gateway/src/main/java/org/wso2/carbon/apimgt/gateway/listeners/GatewayStartupListener.java", "diffHunk": "@@ -84,7 +94,14 @@ public void completedServerStartup() {\n                 new APIMgtGatewayCacheMessageListener());\n         jmsTransportHandlerForEventHub\n                 .subscribeForJmsEvents(APIConstants.TopicNames.TOPIC_NOTIFICATION, new GatewayJMSMessageListener());\n+    }\n \n+    private void deployAPIsInSyncMode() {\n+        isAPIsDeployedInSyncMode = deployArtifactsAtStartup();\n+        if (!isAPIsDeployedInSyncMode) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "7ced4e3722b46202905cbeebdefc7b1437cca06d"}, "originalPosition": 56}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MTI2NzQwNQ==", "bodyText": "This to check Every API is deployed or not . #8945 (comment)", "url": "https://github.com/wso2/carbon-apimgt/pull/8945#discussion_r451267405", "createdAt": "2020-07-08T03:53:17Z", "author": {"login": "Sarangan0219"}, "path": "components/apimgt/org.wso2.carbon.apimgt.gateway/src/main/java/org/wso2/carbon/apimgt/gateway/listeners/GatewayStartupListener.java", "diffHunk": "@@ -84,7 +94,14 @@ public void completedServerStartup() {\n                 new APIMgtGatewayCacheMessageListener());\n         jmsTransportHandlerForEventHub\n                 .subscribeForJmsEvents(APIConstants.TopicNames.TOPIC_NOTIFICATION, new GatewayJMSMessageListener());\n+    }\n \n+    private void deployAPIsInSyncMode() {\n+        isAPIsDeployedInSyncMode = deployArtifactsAtStartup();\n+        if (!isAPIsDeployedInSyncMode) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MTAzNDM4NA=="}, "originalCommit": {"oid": "7ced4e3722b46202905cbeebdefc7b1437cca06d"}, "originalPosition": 56}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjgxMjA1NTAwOnYy", "diffSide": "RIGHT", "path": "components/apimgt/org.wso2.carbon.apimgt.impl/src/main/java/org/wso2/carbon/apimgt/impl/APIManagerConfiguration.java", "isResolved": false, "comments": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wN1QxNzo0MDo1NFrOGuJBKg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wOFQxMTowMjoyM1rOGui3Pg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MTAzNTQzNA==", "bodyText": "startupConfigElement -> Retrieval Mode ?\n@pubudu538 ?", "url": "https://github.com/wso2/carbon-apimgt/pull/8945#discussion_r451035434", "createdAt": "2020-07-07T17:40:54Z", "author": {"login": "tharindu1st"}, "path": "components/apimgt/org.wso2.carbon.apimgt.impl/src/main/java/org/wso2/carbon/apimgt/impl/APIManagerConfiguration.java", "diffHunk": "@@ -1677,6 +1677,15 @@ private void setRuntimeArtifactsSyncGatewayConfig (OMElement omElement){\n             log.debug(\"Retry Duration Element is not set. Set to default duaration\");\n         }\n \n+        OMElement startupConfigElement = omElement.getFirstChildWithName(", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "7ced4e3722b46202905cbeebdefc7b1437cca06d"}, "originalPosition": 4}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MTQ0MTAxMA==", "bodyText": "+1", "url": "https://github.com/wso2/carbon-apimgt/pull/8945#discussion_r451441010", "createdAt": "2020-07-08T10:26:19Z", "author": {"login": "pubudu538"}, "path": "components/apimgt/org.wso2.carbon.apimgt.impl/src/main/java/org/wso2/carbon/apimgt/impl/APIManagerConfiguration.java", "diffHunk": "@@ -1677,6 +1677,15 @@ private void setRuntimeArtifactsSyncGatewayConfig (OMElement omElement){\n             log.debug(\"Retry Duration Element is not set. Set to default duaration\");\n         }\n \n+        OMElement startupConfigElement = omElement.getFirstChildWithName(", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MTAzNTQzNA=="}, "originalCommit": {"oid": "7ced4e3722b46202905cbeebdefc7b1437cca06d"}, "originalPosition": 4}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MTQ0MjI5Mg==", "bodyText": "Data Retrieval Mode is meaningful.", "url": "https://github.com/wso2/carbon-apimgt/pull/8945#discussion_r451442292", "createdAt": "2020-07-08T10:28:49Z", "author": {"login": "pubudu538"}, "path": "components/apimgt/org.wso2.carbon.apimgt.impl/src/main/java/org/wso2/carbon/apimgt/impl/APIManagerConfiguration.java", "diffHunk": "@@ -1677,6 +1677,15 @@ private void setRuntimeArtifactsSyncGatewayConfig (OMElement omElement){\n             log.debug(\"Retry Duration Element is not set. Set to default duaration\");\n         }\n \n+        OMElement startupConfigElement = omElement.getFirstChildWithName(", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MTAzNTQzNA=="}, "originalCommit": {"oid": "7ced4e3722b46202905cbeebdefc7b1437cca06d"}, "originalPosition": 4}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MTQ1ODg3OA==", "bodyText": "dfeccf9", "url": "https://github.com/wso2/carbon-apimgt/pull/8945#discussion_r451458878", "createdAt": "2020-07-08T11:02:23Z", "author": {"login": "Sarangan0219"}, "path": "components/apimgt/org.wso2.carbon.apimgt.impl/src/main/java/org/wso2/carbon/apimgt/impl/APIManagerConfiguration.java", "diffHunk": "@@ -1677,6 +1677,15 @@ private void setRuntimeArtifactsSyncGatewayConfig (OMElement omElement){\n             log.debug(\"Retry Duration Element is not set. Set to default duaration\");\n         }\n \n+        OMElement startupConfigElement = omElement.getFirstChildWithName(", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MTAzNTQzNA=="}, "originalCommit": {"oid": "7ced4e3722b46202905cbeebdefc7b1437cca06d"}, "originalPosition": 4}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjgxMjA1OTIxOnYy", "diffSide": "RIGHT", "path": "features/apimgt/org.wso2.carbon.apimgt.core.feature/src/main/resources/conf_templates/templates/repository/conf/api-manager.xml.j2", "isResolved": true, "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wN1QxNzo0MjowN1rOGuJDyQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wOFQxMTowMjoxNFrOGui26g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MTAzNjEwNQ==", "bodyText": "gateway_startup -> mode ?", "url": "https://github.com/wso2/carbon-apimgt/pull/8945#discussion_r451036105", "createdAt": "2020-07-07T17:42:07Z", "author": {"login": "tharindu1st"}, "path": "features/apimgt/org.wso2.carbon.apimgt.core.feature/src/main/resources/conf_templates/templates/repository/conf/api-manager.xml.j2", "diffHunk": "@@ -1247,6 +1247,9 @@\n         {% if apim.sync_runtime_artifacts.gateway.deployment_retry_duartion is defined %}\n         <RetryDuration>{{apim.sync_runtime_artifacts.gateway.deployment_retry_duartion}}</RetryDuration>\n         {% endif %}\n+        {% if apim.sync_runtime_artifacts.gateway.gateway_startup is defined %}", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "7ced4e3722b46202905cbeebdefc7b1437cca06d"}, "originalPosition": 4}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MTQ0MjExNA==", "bodyText": "Data Retrieval Mode", "url": "https://github.com/wso2/carbon-apimgt/pull/8945#discussion_r451442114", "createdAt": "2020-07-08T10:28:28Z", "author": {"login": "pubudu538"}, "path": "features/apimgt/org.wso2.carbon.apimgt.core.feature/src/main/resources/conf_templates/templates/repository/conf/api-manager.xml.j2", "diffHunk": "@@ -1247,6 +1247,9 @@\n         {% if apim.sync_runtime_artifacts.gateway.deployment_retry_duartion is defined %}\n         <RetryDuration>{{apim.sync_runtime_artifacts.gateway.deployment_retry_duartion}}</RetryDuration>\n         {% endif %}\n+        {% if apim.sync_runtime_artifacts.gateway.gateway_startup is defined %}", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MTAzNjEwNQ=="}, "originalCommit": {"oid": "7ced4e3722b46202905cbeebdefc7b1437cca06d"}, "originalPosition": 4}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MTQ1ODc5NA==", "bodyText": "dfeccf9", "url": "https://github.com/wso2/carbon-apimgt/pull/8945#discussion_r451458794", "createdAt": "2020-07-08T11:02:14Z", "author": {"login": "Sarangan0219"}, "path": "features/apimgt/org.wso2.carbon.apimgt.core.feature/src/main/resources/conf_templates/templates/repository/conf/api-manager.xml.j2", "diffHunk": "@@ -1247,6 +1247,9 @@\n         {% if apim.sync_runtime_artifacts.gateway.deployment_retry_duartion is defined %}\n         <RetryDuration>{{apim.sync_runtime_artifacts.gateway.deployment_retry_duartion}}</RetryDuration>\n         {% endif %}\n+        {% if apim.sync_runtime_artifacts.gateway.gateway_startup is defined %}", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MTAzNjEwNQ=="}, "originalCommit": {"oid": "7ced4e3722b46202905cbeebdefc7b1437cca06d"}, "originalPosition": 4}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjgxOTY3MTUyOnYy", "diffSide": "RIGHT", "path": "components/apimgt/org.wso2.carbon.apimgt.gateway/src/main/java/org/wso2/carbon/apimgt/gateway/listeners/GatewayStartupListener.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wOVQxMzo1MjoyMVrOGvSKSg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xMFQwNDozMzowMlrOGvpiKw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MjIzMzgwMg==", "bodyText": "Since this method gets called multiple times, need to put some logs to identify how many times it was called.", "url": "https://github.com/wso2/carbon-apimgt/pull/8945#discussion_r452233802", "createdAt": "2020-07-09T13:52:21Z", "author": {"login": "jaadds"}, "path": "components/apimgt/org.wso2.carbon.apimgt.gateway/src/main/java/org/wso2/carbon/apimgt/gateway/listeners/GatewayStartupListener.java", "diffHunk": "@@ -84,7 +93,14 @@ public void completedServerStartup() {\n                 new APIMgtGatewayCacheMessageListener());\n         jmsTransportHandlerForEventHub\n                 .subscribeForJmsEvents(APIConstants.TopicNames.TOPIC_NOTIFICATION, new GatewayJMSMessageListener());\n+    }\n \n+    private void deployAPIsInSyncMode() {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "dfeccf937e8c48b78ccfe0de83e8e04686c1b1f1"}, "originalPosition": 46}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MjYxNjc0Nw==", "bodyText": "1e62c1f", "url": "https://github.com/wso2/carbon-apimgt/pull/8945#discussion_r452616747", "createdAt": "2020-07-10T04:33:02Z", "author": {"login": "Sarangan0219"}, "path": "components/apimgt/org.wso2.carbon.apimgt.gateway/src/main/java/org/wso2/carbon/apimgt/gateway/listeners/GatewayStartupListener.java", "diffHunk": "@@ -84,7 +93,14 @@ public void completedServerStartup() {\n                 new APIMgtGatewayCacheMessageListener());\n         jmsTransportHandlerForEventHub\n                 .subscribeForJmsEvents(APIConstants.TopicNames.TOPIC_NOTIFICATION, new GatewayJMSMessageListener());\n+    }\n \n+    private void deployAPIsInSyncMode() {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MjIzMzgwMg=="}, "originalCommit": {"oid": "dfeccf937e8c48b78ccfe0de83e8e04686c1b1f1"}, "originalPosition": 46}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjgxOTY4Mjc2OnYy", "diffSide": "RIGHT", "path": "components/apimgt/org.wso2.carbon.apimgt.gateway/src/main/java/org/wso2/carbon/apimgt/gateway/listeners/GatewayStartupListener.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wOVQxMzo1NTowMlrOGvSReA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xMFQwNDozMzoxN1rOGvpiWw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MjIzNTY0MA==", "bodyText": "I feel we need to configure a retry limit rather than retrying indefinitely. With infinite retrying there'd be a constant load on the underlying storage and a few failed APIs can exhaust the storage fairly quickly.", "url": "https://github.com/wso2/carbon-apimgt/pull/8945#discussion_r452235640", "createdAt": "2020-07-09T13:55:02Z", "author": {"login": "jaadds"}, "path": "components/apimgt/org.wso2.carbon.apimgt.gateway/src/main/java/org/wso2/carbon/apimgt/gateway/listeners/GatewayStartupListener.java", "diffHunk": "@@ -84,7 +93,14 @@ public void completedServerStartup() {\n                 new APIMgtGatewayCacheMessageListener());\n         jmsTransportHandlerForEventHub\n                 .subscribeForJmsEvents(APIConstants.TopicNames.TOPIC_NOTIFICATION, new GatewayJMSMessageListener());\n+    }\n \n+    private void deployAPIsInSyncMode() {\n+        isAPIsDeployedInSyncMode = deployArtifactsAtStartup();\n+        if (!isAPIsDeployedInSyncMode) {\n+            log.error(\"Unable to deploy synapse artifacts at gateway\");\n+            deployAPIsInSyncMode();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "dfeccf937e8c48b78ccfe0de83e8e04686c1b1f1"}, "originalPosition": 50}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MjYxNjc5NQ==", "bodyText": "ae40fd8", "url": "https://github.com/wso2/carbon-apimgt/pull/8945#discussion_r452616795", "createdAt": "2020-07-10T04:33:17Z", "author": {"login": "Sarangan0219"}, "path": "components/apimgt/org.wso2.carbon.apimgt.gateway/src/main/java/org/wso2/carbon/apimgt/gateway/listeners/GatewayStartupListener.java", "diffHunk": "@@ -84,7 +93,14 @@ public void completedServerStartup() {\n                 new APIMgtGatewayCacheMessageListener());\n         jmsTransportHandlerForEventHub\n                 .subscribeForJmsEvents(APIConstants.TopicNames.TOPIC_NOTIFICATION, new GatewayJMSMessageListener());\n+    }\n \n+    private void deployAPIsInSyncMode() {\n+        isAPIsDeployedInSyncMode = deployArtifactsAtStartup();\n+        if (!isAPIsDeployedInSyncMode) {\n+            log.error(\"Unable to deploy synapse artifacts at gateway\");\n+            deployAPIsInSyncMode();", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MjIzNTY0MA=="}, "originalCommit": {"oid": "dfeccf937e8c48b78ccfe0de83e8e04686c1b1f1"}, "originalPosition": 50}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjgyMDAxOTY2OnYy", "diffSide": "RIGHT", "path": "components/apimgt/org.wso2.carbon.apimgt.gateway/src/main/java/org/wso2/carbon/apimgt/gateway/listeners/GatewayStartupListener.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wOVQxNTowODo1MFrOGvVlNA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xMFQwNTozNTo0MFrOGvqauw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MjI4OTg0NA==", "bodyText": "As discussed offline let's limit the retries and proceed with startup in case of a failure.", "url": "https://github.com/wso2/carbon-apimgt/pull/8945#discussion_r452289844", "createdAt": "2020-07-09T15:08:50Z", "author": {"login": "jaadds"}, "path": "components/apimgt/org.wso2.carbon.apimgt.gateway/src/main/java/org/wso2/carbon/apimgt/gateway/listeners/GatewayStartupListener.java", "diffHunk": "@@ -84,7 +93,14 @@ public void completedServerStartup() {\n                 new APIMgtGatewayCacheMessageListener());\n         jmsTransportHandlerForEventHub\n                 .subscribeForJmsEvents(APIConstants.TopicNames.TOPIC_NOTIFICATION, new GatewayJMSMessageListener());\n+    }\n ", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "dfeccf937e8c48b78ccfe0de83e8e04686c1b1f1"}, "originalPosition": 45}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MjYzMTIyNw==", "bodyText": "ae40fd8", "url": "https://github.com/wso2/carbon-apimgt/pull/8945#discussion_r452631227", "createdAt": "2020-07-10T05:35:40Z", "author": {"login": "Sarangan0219"}, "path": "components/apimgt/org.wso2.carbon.apimgt.gateway/src/main/java/org/wso2/carbon/apimgt/gateway/listeners/GatewayStartupListener.java", "diffHunk": "@@ -84,7 +93,14 @@ public void completedServerStartup() {\n                 new APIMgtGatewayCacheMessageListener());\n         jmsTransportHandlerForEventHub\n                 .subscribeForJmsEvents(APIConstants.TopicNames.TOPIC_NOTIFICATION, new GatewayJMSMessageListener());\n+    }\n ", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MjI4OTg0NA=="}, "originalCommit": {"oid": "dfeccf937e8c48b78ccfe0de83e8e04686c1b1f1"}, "originalPosition": 45}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3156, "cost": 1, "resetAt": "2021-11-13T14:23:39Z"}}}