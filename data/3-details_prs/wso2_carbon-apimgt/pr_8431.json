{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDA4OTM1NTkz", "number": 8431, "title": "Fixed external idp iframe issue.", "bodyText": "Fixed wso2/product-apim/issues/7850\nDepends on : wso2/product-apim/pull/7951", "createdAt": "2020-04-25T16:38:18Z", "url": "https://github.com/wso2/carbon-apimgt/pull/8431", "merged": true, "mergeCommit": {"oid": "3b18b739a4951d20a4891f44ae1a1d024fecada8"}, "closed": true, "closedAt": "2020-05-05T07:10:18Z", "author": {"login": "Meruja"}, "timelineItems": {"totalCount": 8, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcbIrvJgH2gAyNDA4OTM1NTkzOjMyNzkzNWRhMTU3YWZkMjMyZDE0YWFjNDI3OGE3OTNmM2Y0Y2QwNDU=", "endCursor": "Y3Vyc29yOnYyOpPPAAABc1Ex98AFqTQ0ODY2NzI4MQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "327935da157afd232d14aac4278a793f3f4cd045", "author": {"user": {"login": "Meruja", "name": "Meruja Selvamanikkam"}}, "url": "https://github.com/wso2/carbon-apimgt/commit/327935da157afd232d14aac4278a793f3f4cd045", "committedDate": "2020-04-25T16:29:03Z", "message": "Fixed external idp iframe issue."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDA1NTM5NDE1", "url": "https://github.com/wso2/carbon-apimgt/pull/8431#pullrequestreview-405539415", "createdAt": "2020-05-05T07:10:01Z", "commit": {"oid": "327935da157afd232d14aac4278a793f3f4cd045"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDQyODk4MTE0", "url": "https://github.com/wso2/carbon-apimgt/pull/8431#pullrequestreview-442898114", "createdAt": "2020-07-06T09:02:24Z", "commit": {"oid": "327935da157afd232d14aac4278a793f3f4cd045"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wNlQwOTowMjoyNFrOGtO6gA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wNlQwOTowMjoyNFrOGtO6gA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MDA4MzQ1Ng==", "bodyText": "Remove empty line", "url": "https://github.com/wso2/carbon-apimgt/pull/8431#discussion_r450083456", "createdAt": "2020-07-06T09:02:24Z", "author": {"login": "rmsamitha"}, "path": "components/apimgt/org.wso2.carbon.apimgt.impl/src/main/java/org/wso2/carbon/apimgt/impl/utils/APIUtil.java", "diffHunk": "@@ -2196,6 +2196,44 @@ private static boolean isWSDL2Resource(byte[] wsdl) throws APIManagementExceptio\n         return wsdlContent.indexOf(wsdl2NameSpace) > 0;\n     }\n \n+    /**\n+     * Get the External IDP host name when UIs use an external IDP for SSO or other purpose\n+     * By default this is equal to $ref{server.base_path} (i:e https://localhost:9443)\n+     *\n+     * @return Origin string of the external IDP\n+     */\n+\n+    public static String getExternalIDPOrigin() throws APIManagementException {\n+\n+        APIManagerConfiguration config = ServiceReferenceHolder.getInstance().\n+                getAPIManagerConfigurationService().getAPIManagerConfiguration();\n+        String idpEndpoint = config.getFirstProperty(APIConstants.IDENTITY_PROVIDER_SERVER_URL);\n+        if (idpEndpoint == null) {\n+            return getServerURL();\n+        } else {\n+            return idpEndpoint;\n+        }\n+    }\n+\n+    /**\n+     * Get the check session URL to load in the session management iframe\n+     *\n+     * @return URL to be used in iframe source for the check session with IDP\n+     */\n+", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "327935da157afd232d14aac4278a793f3f4cd045"}, "originalPosition": 28}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDQyOTEyNzA4", "url": "https://github.com/wso2/carbon-apimgt/pull/8431#pullrequestreview-442912708", "createdAt": "2020-07-06T09:22:45Z", "commit": {"oid": "327935da157afd232d14aac4278a793f3f4cd045"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wNlQwOToyMjo0NVrOGtPnRg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wNlQwOToyMjo0NVrOGtPnRg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MDA5NDkxOA==", "bodyText": "Can we use a constant for \"/oidc/checksession\"", "url": "https://github.com/wso2/carbon-apimgt/pull/8431#discussion_r450094918", "createdAt": "2020-07-06T09:22:45Z", "author": {"login": "Sarangan0219"}, "path": "components/apimgt/org.wso2.carbon.apimgt.impl/src/main/java/org/wso2/carbon/apimgt/impl/utils/APIUtil.java", "diffHunk": "@@ -2196,6 +2196,44 @@ private static boolean isWSDL2Resource(byte[] wsdl) throws APIManagementExceptio\n         return wsdlContent.indexOf(wsdl2NameSpace) > 0;\n     }\n \n+    /**\n+     * Get the External IDP host name when UIs use an external IDP for SSO or other purpose\n+     * By default this is equal to $ref{server.base_path} (i:e https://localhost:9443)\n+     *\n+     * @return Origin string of the external IDP\n+     */\n+\n+    public static String getExternalIDPOrigin() throws APIManagementException {\n+\n+        APIManagerConfiguration config = ServiceReferenceHolder.getInstance().\n+                getAPIManagerConfigurationService().getAPIManagerConfiguration();\n+        String idpEndpoint = config.getFirstProperty(APIConstants.IDENTITY_PROVIDER_SERVER_URL);\n+        if (idpEndpoint == null) {\n+            return getServerURL();\n+        } else {\n+            return idpEndpoint;\n+        }\n+    }\n+\n+    /**\n+     * Get the check session URL to load in the session management iframe\n+     *\n+     * @return URL to be used in iframe source for the check session with IDP\n+     */\n+\n+    public static String getExternalIDPCheckSessionEndpoint() throws APIManagementException {\n+\n+        APIManagerConfiguration config = ServiceReferenceHolder.getInstance().\n+                getAPIManagerConfigurationService().getAPIManagerConfiguration();\n+        String oidcCheckSessionEndpoint = config.getFirstProperty(\n+                APIConstants.IDENTITY_PROVIDER_OIDC_CHECK_SESSION_ENDPOINT);\n+        if (oidcCheckSessionEndpoint == null) {\n+            return getServerURL() + \"/oidc/checksession\";", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "327935da157afd232d14aac4278a793f3f4cd045"}, "originalPosition": 36}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDQ4NjY2ODEx", "url": "https://github.com/wso2/carbon-apimgt/pull/8431#pullrequestreview-448666811", "createdAt": "2020-07-15T06:37:29Z", "commit": {"oid": "327935da157afd232d14aac4278a793f3f4cd045"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xNVQwNjozNzozMFrOGxwQ5A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xNVQwNjozNzozMFrOGxwQ5A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NDgyNDE2NA==", "bodyText": "Formatting issue", "url": "https://github.com/wso2/carbon-apimgt/pull/8431#discussion_r454824164", "createdAt": "2020-07-15T06:37:30Z", "author": {"login": "mushthaq33"}, "path": "features/apimgt/org.wso2.carbon.apimgt.publisher.feature/src/main/resources/publisher/services/utils.js", "diffHunk": "@@ -30,3 +30,11 @@ var getLoopbackOrigin = function() {\n     var origin = 'https://' + app.origin.host + \":\" + mgtTransportPort;\n     return origin; // Unless there is a port offset this is https://localhost:9443\n };\n+\n+function getIDPOrigin(){", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "327935da157afd232d14aac4278a793f3f4cd045"}, "originalPosition": 5}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDQ4NjY2OTU5", "url": "https://github.com/wso2/carbon-apimgt/pull/8431#pullrequestreview-448666959", "createdAt": "2020-07-15T06:37:45Z", "commit": {"oid": "327935da157afd232d14aac4278a793f3f4cd045"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xNVQwNjozNzo0NVrOGxwRZw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xNVQwNjozNzo0NVrOGxwRZw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NDgyNDI5NQ==", "bodyText": "Formatting issue", "url": "https://github.com/wso2/carbon-apimgt/pull/8431#discussion_r454824295", "createdAt": "2020-07-15T06:37:45Z", "author": {"login": "mushthaq33"}, "path": "features/apimgt/org.wso2.carbon.apimgt.publisher.feature/src/main/resources/publisher/services/utils.js", "diffHunk": "@@ -30,3 +30,11 @@ var getLoopbackOrigin = function() {\n     var origin = 'https://' + app.origin.host + \":\" + mgtTransportPort;\n     return origin; // Unless there is a port offset this is https://localhost:9443\n };\n+\n+function getIDPOrigin(){\n+    return utils.getExternalIDPOrigin();\n+}\n+\n+function getIDPCheckSessionEndpoint(){", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "327935da157afd232d14aac4278a793f3f4cd045"}, "originalPosition": 9}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDQ4NjY3MTQy", "url": "https://github.com/wso2/carbon-apimgt/pull/8431#pullrequestreview-448667142", "createdAt": "2020-07-15T06:38:02Z", "commit": {"oid": "327935da157afd232d14aac4278a793f3f4cd045"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xNVQwNjozODowM1rOGxwR1Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xNVQwNjozODowM1rOGxwR1Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NDgyNDQwNQ==", "bodyText": "Formatting issue", "url": "https://github.com/wso2/carbon-apimgt/pull/8431#discussion_r454824405", "createdAt": "2020-07-15T06:38:03Z", "author": {"login": "mushthaq33"}, "path": "features/apimgt/org.wso2.carbon.apimgt.store.feature/src/main/resources/devportal/services/utils.js", "diffHunk": "@@ -28,6 +28,14 @@ var getLoopbackOrigin = function() {\n     return origin;\n };\n \n+function getIDPOrigin(){", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "327935da157afd232d14aac4278a793f3f4cd045"}, "originalPosition": 4}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDQ4NjY3Mjgx", "url": "https://github.com/wso2/carbon-apimgt/pull/8431#pullrequestreview-448667281", "createdAt": "2020-07-15T06:38:16Z", "commit": {"oid": "327935da157afd232d14aac4278a793f3f4cd045"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xNVQwNjozODoxNlrOGxwSLw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xNVQwNjozODoxNlrOGxwSLw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NDgyNDQ5NQ==", "bodyText": "Formatting issue", "url": "https://github.com/wso2/carbon-apimgt/pull/8431#discussion_r454824495", "createdAt": "2020-07-15T06:38:16Z", "author": {"login": "mushthaq33"}, "path": "features/apimgt/org.wso2.carbon.apimgt.store.feature/src/main/resources/devportal/services/utils.js", "diffHunk": "@@ -28,6 +28,14 @@ var getLoopbackOrigin = function() {\n     return origin;\n };\n \n+function getIDPOrigin(){\n+    return utils.getExternalIDPOrigin();\n+}\n+\n+function getIDPCheckSessionEndpoint(){", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "327935da157afd232d14aac4278a793f3f4cd045"}, "originalPosition": 8}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2914, "cost": 1, "resetAt": "2021-11-02T10:47:05Z"}}}