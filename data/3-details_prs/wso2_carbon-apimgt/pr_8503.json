{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDE3NzQzMjM1", "number": 8503, "title": "Get tenant aware username when the EnableEmailUserName", "bodyText": "", "createdAt": "2020-05-14T04:29:13Z", "url": "https://github.com/wso2/carbon-apimgt/pull/8503", "merged": true, "mergeCommit": {"oid": "54eda30add01b3741e41ec73f7a5bd7659604cf2"}, "closed": true, "closedAt": "2020-05-19T12:49:28Z", "author": {"login": "amalkasubasinghe"}, "timelineItems": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABchFxCMAH2gAyNDE3NzQzMjM1OmYwYTdmYjBhZmZjNWEyYmYwNmUzOWFhMTAwMWQwYmFhODc0Nzg4NWQ=", "endCursor": "Y3Vyc29yOnYyOpPPAAABciz5oigFqTQxNDQwODM4MQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "f0a7fb0affc5a2bf06e39aa1001d0baa8747885d", "author": {"user": {"login": "amalkasubasinghe", "name": "Amalka Subasinghe"}}, "url": "https://github.com/wso2/carbon-apimgt/commit/f0a7fb0affc5a2bf06e39aa1001d0baa8747885d", "committedDate": "2020-05-14T04:28:40Z", "message": "Get tenant aware username when the EnableEmailUserName"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "6a2a1b95e65e75c7c2d0dd99405d2a3394b16f7a", "author": {"user": {"login": "amalkasubasinghe", "name": "Amalka Subasinghe"}}, "url": "https://github.com/wso2/carbon-apimgt/commit/6a2a1b95e65e75c7c2d0dd99405d2a3394b16f7a", "committedDate": "2020-05-19T09:29:58Z", "message": "Get tenant aware username when the EnableEmailUserName"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDE0MzAwNTkz", "url": "https://github.com/wso2/carbon-apimgt/pull/8503#pullrequestreview-414300593", "createdAt": "2020-05-19T10:13:05Z", "commit": {"oid": "6a2a1b95e65e75c7c2d0dd99405d2a3394b16f7a"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xOVQxMDoxMzowNVrOGXZg0w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xOVQxMDoxMzowNVrOGXZg0w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNzE4ODQzNQ==", "bodyText": "We shouldn't remove \"carbon.super\" if EnableEmailUserName settings is disabled but username is an email.\nEx1:\nsay username is amalka@gmail.com@carbon.super, then\n\nif isEnableEmailUserName is true => returned username is amalka@gmail.com\nif isEnableEmailUserName is false => return amalka@gmail.com@carbon.super\n\nEx2:\nsay username is malintha@carbon.super, then\n\nif isEnableEmailUserName is true => returned username is malintha\nif isEnableEmailUserName is false => return malintha (same)\n\nBasically you need to move the same logic in AuthManager.jsx with additional check for EnableEmailUserName.\nconst count = (data.username.match(/@/g) || []).length;\nif (isEnableEmailUserName || (data.username.endsWith('@carbon.super') && count <= 1)) {\n    introspectResult.data.username = introspectResult.data.username.replace('@carbon.super', '');\n}", "url": "https://github.com/wso2/carbon-apimgt/pull/8503#discussion_r427188435", "createdAt": "2020-05-19T10:13:05Z", "author": {"login": "malinthaprasan"}, "path": "features/apimgt/org.wso2.carbon.apimgt.store.feature/src/main/resources/devportal/services/login/introspect.jag", "diffHunk": "@@ -46,6 +46,10 @@\n     // For more info about response.xhr object refer http://jaggeryjs.org/documentation.jag?api=xhr\n     \n     if (introspectResult.xhr.status === 200) {\n+        var isEnableEmailUserName = appUtils.isEnableEmailUserName();\n+        if (isEnableEmailUserName || introspectResult.data.username.endsWith('@carbon.super')) {\n+            introspectResult.data.username = introspectResult.data.username.replace('@carbon.super', '');\n+        }", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "6a2a1b95e65e75c7c2d0dd99405d2a3394b16f7a"}, "originalPosition": 7}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "93f4ac2ed6b03a749e024d972e3b8eab892f0ce4", "author": {"user": {"login": "amalkasubasinghe", "name": "Amalka Subasinghe"}}, "url": "https://github.com/wso2/carbon-apimgt/commit/93f4ac2ed6b03a749e024d972e3b8eab892f0ce4", "committedDate": "2020-05-19T12:44:04Z", "message": "Get tenant aware username when the EnableEmailUserName"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDE0NDA4Mzgx", "url": "https://github.com/wso2/carbon-apimgt/pull/8503#pullrequestreview-414408381", "createdAt": "2020-05-19T12:47:37Z", "commit": {"oid": "93f4ac2ed6b03a749e024d972e3b8eab892f0ce4"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2736, "cost": 1, "resetAt": "2021-11-02T10:47:05Z"}}}