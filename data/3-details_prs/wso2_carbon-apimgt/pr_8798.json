{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDM3NzYyMjg3", "number": 8798, "title": "fix JWT related issues", "bodyText": "", "createdAt": "2020-06-22T08:09:06Z", "url": "https://github.com/wso2/carbon-apimgt/pull/8798", "merged": true, "mergeCommit": {"oid": "1fe865123809be0ac583a387b0e47cd47a352620"}, "closed": true, "closedAt": "2020-06-22T12:16:16Z", "author": {"login": "tharindu1st"}, "timelineItems": {"totalCount": 10, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABctsUbygBqjM0NjcxMTc2MTA=", "endCursor": "Y3Vyc29yOnYyOpPPAAABctv05BgBqjM0NjgwNjE3MzQ=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "0ae35ae93b5c3bc515a9eda54099db5bfa719e7a", "author": {"user": {"login": "tharindu1st", "name": "Tharindu Dasun Dharmarathna"}}, "url": "https://github.com/wso2/carbon-apimgt/commit/0ae35ae93b5c3bc515a9eda54099db5bfa719e7a", "committedDate": "2020-06-22T07:54:30Z", "message": "fix JWT related issues"}, "afterCommit": {"oid": "e617bf95dde51f2fc3a7bd13e3b99f3e26bd1e95", "author": {"user": {"login": "tharindu1st", "name": "Tharindu Dasun Dharmarathna"}}, "url": "https://github.com/wso2/carbon-apimgt/commit/e617bf95dde51f2fc3a7bd13e3b99f3e26bd1e95", "committedDate": "2020-06-22T08:10:19Z", "message": "fix JWT related issues"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDM0NzAyNDcz", "url": "https://github.com/wso2/carbon-apimgt/pull/8798#pullrequestreview-434702473", "createdAt": "2020-06-22T08:21:12Z", "commit": {"oid": "e617bf95dde51f2fc3a7bd13e3b99f3e26bd1e95"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yMlQwODoyMToxMlrOGm2gyQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yMlQwODoyNjo0MVrOGm2tPA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MzM5MjIwMQ==", "bodyText": "if an application attribute is updated, we may need to remove and add updatex attribute. To handle that shall we add a remove method as well?", "url": "https://github.com/wso2/carbon-apimgt/pull/8798#discussion_r443392201", "createdAt": "2020-06-22T08:21:12Z", "author": {"login": "isharac"}, "path": "components/apimgt/org.wso2.carbon.apimgt.api/src/main/java/org/wso2/carbon/apimgt/api/model/subscription/Application.java", "diffHunk": "@@ -101,15 +101,25 @@ public Integer getCacheKey() {\n         return getId();\n     }\n \n-    public Map<String, String> getAttributesMap() {\n+    public Map<String, String> getAttributes() {\n \n-        return attributesMap;\n+        return attributes;\n     }\n \n     public void addAttribute(String name, String value) {\n \n-        if (!this.attributesMap.containsKey(name)) {\n-            this.attributesMap.put(name, value);\n+        if (!this.attributes.containsKey(name)) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e617bf95dde51f2fc3a7bd13e3b99f3e26bd1e95"}, "originalPosition": 32}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MzM5MjQ4OQ==", "bodyText": "minor fomatting issues", "url": "https://github.com/wso2/carbon-apimgt/pull/8798#discussion_r443392489", "createdAt": "2020-06-22T08:21:44Z", "author": {"login": "isharac"}, "path": "components/apimgt/org.wso2.carbon.apimgt.impl/src/main/java/org/wso2/carbon/apimgt/impl/dao/SubscriptionValidationDAO.java", "diffHunk": "@@ -132,18 +132,20 @@ private void addToApplicationList(List<Application> list, ResultSet resultSet) t\n                 if (application == null) {\n                     application = new Application();\n                     application.setId(appId);\n+                    application.setUuid(resultSet.getString(\"APP_UUID\"));\n                     application.setPolicy(resultSet.getString(\"TIER\"));\n                     application.setSubName(resultSet.getString(\"SUB_NAME\"));\n                     application.setName(resultSet.getString(\"NAME\"));\n                     application.setTokenType(resultSet.getString(\"TOKEN_TYPE\"));\n                     temp.put(appId, application);\n                 }\n+                String attributeName = resultSet.getString(\"ATTRIBUTE_NAME\");\n+                String attributeValue = resultSet.getString(\"ATTRIBUTE_VALUE\");\n+                if (StringUtils.isNotEmpty(attributeName) &&StringUtils.isNotEmpty(attributeValue)){", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e617bf95dde51f2fc3a7bd13e3b99f3e26bd1e95"}, "originalPosition": 13}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MzM5NTM4OA==", "bodyText": "minor formatting(line breaks)\n`", "url": "https://github.com/wso2/carbon-apimgt/pull/8798#discussion_r443395388", "createdAt": "2020-06-22T08:26:41Z", "author": {"login": "isharac"}, "path": "components/apimgt/org.wso2.carbon.apimgt.impl/src/main/java/org/wso2/carbon/apimgt/impl/dao/constants/SubscriptionValidationSQLConstants.java", "diffHunk": "@@ -22,27 +22,37 @@\n \n     public static final String GET_ALL_APPLICATIONS_SQL =\n             \" SELECT \" +\n+                    \"   APP.UUID AS APP_UUID,\" +\n                     \"   APP.APPLICATION_ID AS APP_ID,\" +\n                     \"   APP.APPLICATION_TIER AS TIER,\" +\n                     \"   APP.NAME AS NAME,\" +\n                     \"   APP.TOKEN_TYPE AS TOKEN_TYPE,\" +\n-                    \"   SUB.USER_ID AS SUB_NAME\" +\n+                    \"   SUB.USER_ID AS SUB_NAME,\" +\n+                    \"   ATTRIBUTES.NAME AS ATTRIBUTE_NAME,\" +\n+                    \"   ATTRIBUTES.VALUE AS ATTRIBUTE_VALUE\"+\n                     \" FROM \" +\n-                    \"   AM_APPLICATION AS APP,\" +\n-                    \"   AM_SUBSCRIBER AS SUB\" +\n+                    \"   AM_SUBSCRIBER AS SUB,\" +\n+                    \"   AM_APPLICATION AS APP\" +\n+                    \"   LEFT OUTER JOIN AM_APPLICATION_ATTRIBUTES AS ATTRIBUTES  ON APP.APPLICATION_ID = ATTRIBUTES\" +", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e617bf95dde51f2fc3a7bd13e3b99f3e26bd1e95"}, "originalPosition": 18}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "e617bf95dde51f2fc3a7bd13e3b99f3e26bd1e95", "author": {"user": {"login": "tharindu1st", "name": "Tharindu Dasun Dharmarathna"}}, "url": "https://github.com/wso2/carbon-apimgt/commit/e617bf95dde51f2fc3a7bd13e3b99f3e26bd1e95", "committedDate": "2020-06-22T08:10:19Z", "message": "fix JWT related issues"}, "afterCommit": {"oid": "aae3890e2acadbfd2b9976f34f74365e171476ba", "author": {"user": {"login": "tharindu1st", "name": "Tharindu Dasun Dharmarathna"}}, "url": "https://github.com/wso2/carbon-apimgt/commit/aae3890e2acadbfd2b9976f34f74365e171476ba", "committedDate": "2020-06-22T10:13:44Z", "message": "fix JWT related issues"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "aae3890e2acadbfd2b9976f34f74365e171476ba", "author": {"user": {"login": "tharindu1st", "name": "Tharindu Dasun Dharmarathna"}}, "url": "https://github.com/wso2/carbon-apimgt/commit/aae3890e2acadbfd2b9976f34f74365e171476ba", "committedDate": "2020-06-22T10:13:44Z", "message": "fix JWT related issues"}, "afterCommit": {"oid": "a628d8bbf38c33c1db8b543617af548323227c80", "author": {"user": {"login": "tharindu1st", "name": "Tharindu Dasun Dharmarathna"}}, "url": "https://github.com/wso2/carbon-apimgt/commit/a628d8bbf38c33c1db8b543617af548323227c80", "committedDate": "2020-06-22T11:01:20Z", "message": "fix JWT related issues"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDM0ODIwODI0", "url": "https://github.com/wso2/carbon-apimgt/pull/8798#pullrequestreview-434820824", "createdAt": "2020-06-22T11:05:45Z", "commit": {"oid": "a628d8bbf38c33c1db8b543617af548323227c80"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDM0ODIxODQ2", "url": "https://github.com/wso2/carbon-apimgt/pull/8798#pullrequestreview-434821846", "createdAt": "2020-06-22T11:07:26Z", "commit": {"oid": "a628d8bbf38c33c1db8b543617af548323227c80"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yMlQxMTowNzoyNlrOGm8Dug==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yMlQxMTowNzoyNlrOGm8Dug==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MzQ4MzA2Ng==", "bodyText": "a space required.", "url": "https://github.com/wso2/carbon-apimgt/pull/8798#discussion_r443483066", "createdAt": "2020-06-22T11:07:26Z", "author": {"login": "isharac"}, "path": "components/apimgt/org.wso2.carbon.apimgt.impl/src/main/java/org/wso2/carbon/apimgt/impl/APIConsumerImpl.java", "diffHunk": "@@ -4023,14 +4023,14 @@ public void removeApplication(Application application, String username) throws A\n                 ApplicationEvent applicationEvent = new ApplicationEvent(UUID.randomUUID().toString(),\n                         System.currentTimeMillis(), APIConstants.EventType.APPLICATION_DELETE.name(), tenantId,\n                         tenantDomain, applicationId, application.getName(), application.getTokenType(),\n-                        application.getTier(), application.getGroupId());\n+                        application.getTier(), application.getGroupId(), Collections.EMPTY_MAP);\n                 APIUtil.sendNotification(applicationEvent, APIConstants.NotifierType.APPLICATION.name());\n             }\n         } else {\n             ApplicationEvent applicationEvent = new ApplicationEvent(UUID.randomUUID().toString(),\n                     System.currentTimeMillis(), APIConstants.EventType.APPLICATION_DELETE.name(), tenantId,\n                     tenantDomain, applicationId, application.getName(), application.getTokenType(),\n-                    application.getTier(), application.getGroupId());\n+                    application.getTier(), application.getGroupId(),Collections.EMPTY_MAP);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a628d8bbf38c33c1db8b543617af548323227c80"}, "originalPosition": 39}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "a628d8bbf38c33c1db8b543617af548323227c80", "author": {"user": {"login": "tharindu1st", "name": "Tharindu Dasun Dharmarathna"}}, "url": "https://github.com/wso2/carbon-apimgt/commit/a628d8bbf38c33c1db8b543617af548323227c80", "committedDate": "2020-06-22T11:01:20Z", "message": "fix JWT related issues"}, "afterCommit": {"oid": "86bd5fa5e925652c94ec94c879a0136d6263fd0c", "author": {"user": {"login": "tharindu1st", "name": "Tharindu Dasun Dharmarathna"}}, "url": "https://github.com/wso2/carbon-apimgt/commit/86bd5fa5e925652c94ec94c879a0136d6263fd0c", "committedDate": "2020-06-22T11:08:10Z", "message": "fix JWT related issues"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDM0ODUxNzE3", "url": "https://github.com/wso2/carbon-apimgt/pull/8798#pullrequestreview-434851717", "createdAt": "2020-06-22T11:55:32Z", "commit": {"oid": "a628d8bbf38c33c1db8b543617af548323227c80"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "07b6edeabd8e22bf48ddf28b7f7b68d70f4d5139", "author": {"user": {"login": "tharindu1st", "name": "Tharindu Dasun Dharmarathna"}}, "url": "https://github.com/wso2/carbon-apimgt/commit/07b6edeabd8e22bf48ddf28b7f7b68d70f4d5139", "committedDate": "2020-06-22T12:15:39Z", "message": "fix JWT related issues"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "86bd5fa5e925652c94ec94c879a0136d6263fd0c", "author": {"user": {"login": "tharindu1st", "name": "Tharindu Dasun Dharmarathna"}}, "url": "https://github.com/wso2/carbon-apimgt/commit/86bd5fa5e925652c94ec94c879a0136d6263fd0c", "committedDate": "2020-06-22T11:08:10Z", "message": "fix JWT related issues"}, "afterCommit": {"oid": "07b6edeabd8e22bf48ddf28b7f7b68d70f4d5139", "author": {"user": {"login": "tharindu1st", "name": "Tharindu Dasun Dharmarathna"}}, "url": "https://github.com/wso2/carbon-apimgt/commit/07b6edeabd8e22bf48ddf28b7f7b68d70f4d5139", "committedDate": "2020-06-22T12:15:39Z", "message": "fix JWT related issues"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2670, "cost": 1, "resetAt": "2021-11-02T10:47:05Z"}}}