{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDM0NDkzMjQ1", "number": 8753, "title": "improve certificate as a file in key manager creation", "bodyText": "", "createdAt": "2020-06-15T12:02:31Z", "url": "https://github.com/wso2/carbon-apimgt/pull/8753", "merged": true, "mergeCommit": {"oid": "97ffa781f229ade5915424c9cbbac3222c2cd29f"}, "closed": true, "closedAt": "2020-06-15T17:03:39Z", "author": {"login": "tharindu1st"}, "timelineItems": {"totalCount": 10, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcrfe_cAFqTQzMDU3ODg3OQ==", "endCursor": "Y3Vyc29yOnYyOpPPAAABcrfjsOAFqTQzMDU4MjQxOQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDMwNTc4ODc5", "url": "https://github.com/wso2/carbon-apimgt/pull/8753#pullrequestreview-430578879", "createdAt": "2020-06-15T12:05:43Z", "commit": {"oid": "3c38102c3f7ccf96deb6921daade400dc2a3240f"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xNVQxMjowNTo0NFrOGjvRiA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xNVQxMjowNTo0NFrOGjvRiA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MDEyNzg4MA==", "bodyText": "Formatting issue", "url": "https://github.com/wso2/carbon-apimgt/pull/8753#discussion_r440127880", "createdAt": "2020-06-15T12:05:44Z", "author": {"login": "mushthaq33"}, "path": "components/apimgt/org.wso2.carbon.apimgt.impl/src/main/java/org/wso2/carbon/apimgt/impl/utils/APIUtil.java", "diffHunk": "@@ -10796,6 +10806,27 @@ public static KeyManagerConfigurationDTO getAndSetDefaultKeyManagerConfiguration\n                 APIConstants.KeyManager.CLAIM_MAPPING)){\n             keyManagerConfigurationDTO.addProperty(APIConstants.KeyManager.CLAIM_MAPPING, getDefaultClaimMappings());\n         }\n+        if (!keyManagerConfigurationDTO.getAdditionalProperties().containsKey(APIConstants.KeyManager.CERTIFICATE_TYPE)){", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "3c38102c3f7ccf96deb6921daade400dc2a3240f"}, "originalPosition": 46}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDMwNTc5MTIw", "url": "https://github.com/wso2/carbon-apimgt/pull/8753#pullrequestreview-430579120", "createdAt": "2020-06-15T12:06:04Z", "commit": {"oid": "3c38102c3f7ccf96deb6921daade400dc2a3240f"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xNVQxMjowNjowNFrOGjvSTA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xNVQxMjowNjowNFrOGjvSTA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MDEyODA3Ng==", "bodyText": "Formatting issue", "url": "https://github.com/wso2/carbon-apimgt/pull/8753#discussion_r440128076", "createdAt": "2020-06-15T12:06:04Z", "author": {"login": "mushthaq33"}, "path": "components/apimgt/org.wso2.carbon.apimgt.impl/src/main/java/org/wso2/carbon/apimgt/impl/utils/APIUtil.java", "diffHunk": "@@ -10796,6 +10806,27 @@ public static KeyManagerConfigurationDTO getAndSetDefaultKeyManagerConfiguration\n                 APIConstants.KeyManager.CLAIM_MAPPING)){\n             keyManagerConfigurationDTO.addProperty(APIConstants.KeyManager.CLAIM_MAPPING, getDefaultClaimMappings());\n         }\n+        if (!keyManagerConfigurationDTO.getAdditionalProperties().containsKey(APIConstants.KeyManager.CERTIFICATE_TYPE)){\n+            keyManagerConfigurationDTO.addProperty(APIConstants.KeyManager.CERTIFICATE_TYPE,\n+                    APIConstants.KeyManager.CERTIFICATE_TYPE_PEM_FILE);\n+        }\n+        if (!keyManagerConfigurationDTO.getAdditionalProperties().containsKey(APIConstants.KeyManager.CERTIFICATE_VALUE)){", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "3c38102c3f7ccf96deb6921daade400dc2a3240f"}, "originalPosition": 50}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDMwNTc5MjA5", "url": "https://github.com/wso2/carbon-apimgt/pull/8753#pullrequestreview-430579209", "createdAt": "2020-06-15T12:06:12Z", "commit": {"oid": "3c38102c3f7ccf96deb6921daade400dc2a3240f"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xNVQxMjowNjoxMlrOGjvSjw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xNVQxMjowNjoxMlrOGjvSjw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MDEyODE0Mw==", "bodyText": "Formatting issue", "url": "https://github.com/wso2/carbon-apimgt/pull/8753#discussion_r440128143", "createdAt": "2020-06-15T12:06:12Z", "author": {"login": "mushthaq33"}, "path": "components/apimgt/org.wso2.carbon.apimgt.impl/src/main/java/org/wso2/carbon/apimgt/impl/utils/APIUtil.java", "diffHunk": "@@ -10796,6 +10806,27 @@ public static KeyManagerConfigurationDTO getAndSetDefaultKeyManagerConfiguration\n                 APIConstants.KeyManager.CLAIM_MAPPING)){\n             keyManagerConfigurationDTO.addProperty(APIConstants.KeyManager.CLAIM_MAPPING, getDefaultClaimMappings());\n         }\n+        if (!keyManagerConfigurationDTO.getAdditionalProperties().containsKey(APIConstants.KeyManager.CERTIFICATE_TYPE)){\n+            keyManagerConfigurationDTO.addProperty(APIConstants.KeyManager.CERTIFICATE_TYPE,\n+                    APIConstants.KeyManager.CERTIFICATE_TYPE_PEM_FILE);\n+        }\n+        if (!keyManagerConfigurationDTO.getAdditionalProperties().containsKey(APIConstants.KeyManager.CERTIFICATE_VALUE)){\n+            try {\n+                Certificate certificate = CertificateMgtUtils.getInstance()\n+                        .getPublicCertificate(keyManagerConfigurationDTO.getTenantDomain());\n+                String x509certificateContent = null;\n+                if (certificate != null){", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "3c38102c3f7ccf96deb6921daade400dc2a3240f"}, "originalPosition": 55}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDMwNTc5MzQ3", "url": "https://github.com/wso2/carbon-apimgt/pull/8753#pullrequestreview-430579347", "createdAt": "2020-06-15T12:06:24Z", "commit": {"oid": "3c38102c3f7ccf96deb6921daade400dc2a3240f"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xNVQxMjowNjoyNFrOGjvS-w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xNVQxMjowNjoyNFrOGjvS-w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MDEyODI1MQ==", "bodyText": "Formatting issue", "url": "https://github.com/wso2/carbon-apimgt/pull/8753#discussion_r440128251", "createdAt": "2020-06-15T12:06:24Z", "author": {"login": "mushthaq33"}, "path": "components/apimgt/org.wso2.carbon.apimgt.rest.api.admin.v1/src/main/java/org/wso2/carbon/apimgt/rest/api/admin/v1/utils/mappings/KeyManagerMappingUtil.java", "diffHunk": "@@ -92,10 +93,19 @@ public static KeyManagerDTO toKeyManagerDTO(KeyManagerConfigurationDTO keyManage\n             keyManagerDTO.setIssuer(issuerElement.getAsString());\n             jsonObject.remove(APIConstants.KeyManager.ISSUER);\n         }\n-        JsonElement jwksEndpointElement = jsonObject.get(APIConstants.KeyManager.JWKS_ENDPOINT);\n-        if (jwksEndpointElement != null) {\n-            keyManagerDTO.setJwksEndpoint(jwksEndpointElement.getAsString());\n-            jsonObject.remove(APIConstants.KeyManager.JWKS_ENDPOINT);\n+        JsonElement certificateValueElement = jsonObject.get(APIConstants.KeyManager.CERTIFICATE_VALUE);\n+        JsonElement certificateTypeElement = jsonObject.get(APIConstants.KeyManager.CERTIFICATE_TYPE);\n+        if (certificateTypeElement != null && certificateValueElement != null) {\n+            KeyManagerCertificatesDTO keyManagerCertificatesDTO = new KeyManagerCertificatesDTO();\n+            keyManagerCertificatesDTO.setValue(certificateValueElement.getAsString());\n+            if (APIConstants.KeyManager.CERTIFICATE_TYPE_JWKS_ENDPOINT.equals(certificateTypeElement.getAsString())){", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "3c38102c3f7ccf96deb6921daade400dc2a3240f"}, "originalPosition": 21}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDMwNTc5NDQy", "url": "https://github.com/wso2/carbon-apimgt/pull/8753#pullrequestreview-430579442", "createdAt": "2020-06-15T12:06:33Z", "commit": {"oid": "3c38102c3f7ccf96deb6921daade400dc2a3240f"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xNVQxMjowNjozM1rOGjvTQA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xNVQxMjowNjozM1rOGjvTQA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MDEyODMyMA==", "bodyText": "Formatting issue", "url": "https://github.com/wso2/carbon-apimgt/pull/8753#discussion_r440128320", "createdAt": "2020-06-15T12:06:33Z", "author": {"login": "mushthaq33"}, "path": "components/apimgt/org.wso2.carbon.apimgt.rest.api.admin.v1/src/main/java/org/wso2/carbon/apimgt/rest/api/admin/v1/utils/mappings/KeyManagerMappingUtil.java", "diffHunk": "@@ -92,10 +93,19 @@ public static KeyManagerDTO toKeyManagerDTO(KeyManagerConfigurationDTO keyManage\n             keyManagerDTO.setIssuer(issuerElement.getAsString());\n             jsonObject.remove(APIConstants.KeyManager.ISSUER);\n         }\n-        JsonElement jwksEndpointElement = jsonObject.get(APIConstants.KeyManager.JWKS_ENDPOINT);\n-        if (jwksEndpointElement != null) {\n-            keyManagerDTO.setJwksEndpoint(jwksEndpointElement.getAsString());\n-            jsonObject.remove(APIConstants.KeyManager.JWKS_ENDPOINT);\n+        JsonElement certificateValueElement = jsonObject.get(APIConstants.KeyManager.CERTIFICATE_VALUE);\n+        JsonElement certificateTypeElement = jsonObject.get(APIConstants.KeyManager.CERTIFICATE_TYPE);\n+        if (certificateTypeElement != null && certificateValueElement != null) {\n+            KeyManagerCertificatesDTO keyManagerCertificatesDTO = new KeyManagerCertificatesDTO();\n+            keyManagerCertificatesDTO.setValue(certificateValueElement.getAsString());\n+            if (APIConstants.KeyManager.CERTIFICATE_TYPE_JWKS_ENDPOINT.equals(certificateTypeElement.getAsString())){\n+                keyManagerCertificatesDTO.setType(KeyManagerCertificatesDTO.TypeEnum.JWKS);\n+            }else if (APIConstants.KeyManager.CERTIFICATE_TYPE_PEM_FILE.equals(certificateTypeElement.getAsString())){", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "3c38102c3f7ccf96deb6921daade400dc2a3240f"}, "originalPosition": 23}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDMwNTc5NTQ1", "url": "https://github.com/wso2/carbon-apimgt/pull/8753#pullrequestreview-430579545", "createdAt": "2020-06-15T12:06:42Z", "commit": {"oid": "3c38102c3f7ccf96deb6921daade400dc2a3240f"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xNVQxMjowNjo0M1rOGjvTmg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xNVQxMjowNjo0M1rOGjvTmg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MDEyODQxMA==", "bodyText": "Formatting issue", "url": "https://github.com/wso2/carbon-apimgt/pull/8753#discussion_r440128410", "createdAt": "2020-06-15T12:06:43Z", "author": {"login": "mushthaq33"}, "path": "components/apimgt/org.wso2.carbon.apimgt.rest.api.admin.v1/src/main/java/org/wso2/carbon/apimgt/rest/api/admin/v1/utils/mappings/KeyManagerMappingUtil.java", "diffHunk": "@@ -201,8 +211,16 @@ public static KeyManagerConfigurationDTO toKeyManagerConfigurationDTO(String ten\n         if (StringUtils.isNotEmpty(keyManagerDTO.getIssuer())) {\n             additionalProperties.put(APIConstants.KeyManager.ISSUER, keyManagerDTO.getIssuer());\n         }\n-        if (StringUtils.isNotEmpty(keyManagerDTO.getJwksEndpoint())) {\n-            additionalProperties.put(APIConstants.KeyManager.JWKS_ENDPOINT, keyManagerDTO.getJwksEndpoint());\n+        if (keyManagerDTO.getCertificates() != null) {\n+            additionalProperties.put(APIConstants.KeyManager.CERTIFICATE_VALUE,\n+                    keyManagerDTO.getCertificates().getValue());\n+            if (KeyManagerCertificatesDTO.TypeEnum.JWKS.equals(keyManagerDTO.getCertificates().getType())){", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "3c38102c3f7ccf96deb6921daade400dc2a3240f"}, "originalPosition": 41}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "3c38102c3f7ccf96deb6921daade400dc2a3240f", "author": {"user": {"login": "tharindu1st", "name": "Tharindu Dasun Dharmarathna"}}, "url": "https://github.com/wso2/carbon-apimgt/commit/3c38102c3f7ccf96deb6921daade400dc2a3240f", "committedDate": "2020-06-15T12:01:57Z", "message": "improve certificate as a file in key manager creation"}, "afterCommit": {"oid": "100dcaf5961d65fd8b4428f7c053a613beea0829", "author": {"user": {"login": "tharindu1st", "name": "Tharindu Dasun Dharmarathna"}}, "url": "https://github.com/wso2/carbon-apimgt/commit/100dcaf5961d65fd8b4428f7c053a613beea0829", "committedDate": "2020-06-15T12:07:03Z", "message": "improve certificate as a file in key manager creation"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ddc077267a893197b9250d0679322a8096a90be8", "author": {"user": {"login": "tharindu1st", "name": "Tharindu Dasun Dharmarathna"}}, "url": "https://github.com/wso2/carbon-apimgt/commit/ddc077267a893197b9250d0679322a8096a90be8", "committedDate": "2020-06-15T12:08:56Z", "message": "improve certificate as a file in key manager creation"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "100dcaf5961d65fd8b4428f7c053a613beea0829", "author": {"user": {"login": "tharindu1st", "name": "Tharindu Dasun Dharmarathna"}}, "url": "https://github.com/wso2/carbon-apimgt/commit/100dcaf5961d65fd8b4428f7c053a613beea0829", "committedDate": "2020-06-15T12:07:03Z", "message": "improve certificate as a file in key manager creation"}, "afterCommit": {"oid": "ddc077267a893197b9250d0679322a8096a90be8", "author": {"user": {"login": "tharindu1st", "name": "Tharindu Dasun Dharmarathna"}}, "url": "https://github.com/wso2/carbon-apimgt/commit/ddc077267a893197b9250d0679322a8096a90be8", "committedDate": "2020-06-15T12:08:56Z", "message": "improve certificate as a file in key manager creation"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDMwNTgyNDE5", "url": "https://github.com/wso2/carbon-apimgt/pull/8753#pullrequestreview-430582419", "createdAt": "2020-06-15T12:10:52Z", "commit": {"oid": "ddc077267a893197b9250d0679322a8096a90be8"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2646, "cost": 1, "resetAt": "2021-11-02T10:47:05Z"}}}