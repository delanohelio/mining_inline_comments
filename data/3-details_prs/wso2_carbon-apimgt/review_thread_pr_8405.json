{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDAzMDcyNTAz", "number": 8405, "reviewThreads": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xNVQwMzo1NDo1NFrODx53ug==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yMFQxNToyMDozNFrODzyERw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjUzNjU0OTcwOnYy", "diffSide": "RIGHT", "path": "components/apimgt/org.wso2.carbon.apimgt.impl/src/main/java/org/wso2/carbon/apimgt/impl/APIProviderImpl.java", "isResolved": false, "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xNVQwMzo1NDo1NFrOGFo3vQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yMFQxMTo0Njo0MlrOGIQhZQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwODU2NTY5Mw==", "bodyText": "We should pass the full username to get the tenant domain correctly.\nPlease test with an email username for a tenant.", "url": "https://github.com/wso2/carbon-apimgt/pull/8405#discussion_r408565693", "createdAt": "2020-04-15T03:54:54Z", "author": {"login": "isharac"}, "path": "components/apimgt/org.wso2.carbon.apimgt.impl/src/main/java/org/wso2/carbon/apimgt/impl/APIProviderImpl.java", "diffHunk": "@@ -2006,6 +2008,51 @@ public void makeAPIKeysForwardCompatible(API api) throws APIManagementException\n         }\n     }\n \n+    /**\n+     * Returns the subscriber name for the given subscription id.\n+     *\n+     * @param subscriptionId The subscription id of the subscriber to be returned\n+     * @return The subscriber or null if the requested subscriber does not exist\n+     * @throws APIManagementException if failed to get Subscriber\n+     */\n+    @Override\n+    public String getSubscriber(String subscriptionId) throws APIManagementException {\n+        return apiMgtDAO.getSubscriberName(subscriptionId);\n+    }\n+\n+    /**\n+     * Returns the claims of subscriber for the given subscriber.\n+     *\n+     * @param subscriber The name of the subscriber to be returned\n+     * @return The looked up claims of the subscriber or null if the requested subscriber does not exist\n+     * @throws APIManagementException if failed to get Subscriber\n+     */\n+    @Override\n+    public List getSubscriberClaims(String subscriber) throws APIManagementException {\n+        String tenantDomain = MultitenantUtils.getTenantDomain(subscriber);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "11af67c9b4d1b6b12b00e9c8297b3b49add005f8"}, "originalPosition": 41}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwOTk5OTk5OA==", "bodyText": "Will test and update", "url": "https://github.com/wso2/carbon-apimgt/pull/8405#discussion_r409999998", "createdAt": "2020-04-17T05:28:54Z", "author": {"login": "vithu30"}, "path": "components/apimgt/org.wso2.carbon.apimgt.impl/src/main/java/org/wso2/carbon/apimgt/impl/APIProviderImpl.java", "diffHunk": "@@ -2006,6 +2008,51 @@ public void makeAPIKeysForwardCompatible(API api) throws APIManagementException\n         }\n     }\n \n+    /**\n+     * Returns the subscriber name for the given subscription id.\n+     *\n+     * @param subscriptionId The subscription id of the subscriber to be returned\n+     * @return The subscriber or null if the requested subscriber does not exist\n+     * @throws APIManagementException if failed to get Subscriber\n+     */\n+    @Override\n+    public String getSubscriber(String subscriptionId) throws APIManagementException {\n+        return apiMgtDAO.getSubscriberName(subscriptionId);\n+    }\n+\n+    /**\n+     * Returns the claims of subscriber for the given subscriber.\n+     *\n+     * @param subscriber The name of the subscriber to be returned\n+     * @return The looked up claims of the subscriber or null if the requested subscriber does not exist\n+     * @throws APIManagementException if failed to get Subscriber\n+     */\n+    @Override\n+    public List getSubscriberClaims(String subscriber) throws APIManagementException {\n+        String tenantDomain = MultitenantUtils.getTenantDomain(subscriber);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwODU2NTY5Mw=="}, "originalCommit": {"oid": "11af67c9b4d1b6b12b00e9c8297b3b49add005f8"}, "originalPosition": 41}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMTMxMjQ4NQ==", "bodyText": "Tested and it works", "url": "https://github.com/wso2/carbon-apimgt/pull/8405#discussion_r411312485", "createdAt": "2020-04-20T11:46:42Z", "author": {"login": "vithu30"}, "path": "components/apimgt/org.wso2.carbon.apimgt.impl/src/main/java/org/wso2/carbon/apimgt/impl/APIProviderImpl.java", "diffHunk": "@@ -2006,6 +2008,51 @@ public void makeAPIKeysForwardCompatible(API api) throws APIManagementException\n         }\n     }\n \n+    /**\n+     * Returns the subscriber name for the given subscription id.\n+     *\n+     * @param subscriptionId The subscription id of the subscriber to be returned\n+     * @return The subscriber or null if the requested subscriber does not exist\n+     * @throws APIManagementException if failed to get Subscriber\n+     */\n+    @Override\n+    public String getSubscriber(String subscriptionId) throws APIManagementException {\n+        return apiMgtDAO.getSubscriberName(subscriptionId);\n+    }\n+\n+    /**\n+     * Returns the claims of subscriber for the given subscriber.\n+     *\n+     * @param subscriber The name of the subscriber to be returned\n+     * @return The looked up claims of the subscriber or null if the requested subscriber does not exist\n+     * @throws APIManagementException if failed to get Subscriber\n+     */\n+    @Override\n+    public List getSubscriberClaims(String subscriber) throws APIManagementException {\n+        String tenantDomain = MultitenantUtils.getTenantDomain(subscriber);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwODU2NTY5Mw=="}, "originalCommit": {"oid": "11af67c9b4d1b6b12b00e9c8297b3b49add005f8"}, "originalPosition": 41}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjU1NjI0MjYzOnYy", "diffSide": "RIGHT", "path": "components/apimgt/org.wso2.carbon.apimgt.impl/src/main/java/org/wso2/carbon/apimgt/impl/dao/ApiMgtDAO.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yMFQxNToyMDozNFrOGIZ36w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yMVQwNDozODoxMVrOGIyHIA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMTQ2NTcwNw==", "bodyText": "Can we use try with resources?", "url": "https://github.com/wso2/carbon-apimgt/pull/8405#discussion_r411465707", "createdAt": "2020-04-20T15:20:34Z", "author": {"login": "malinthaprasan"}, "path": "components/apimgt/org.wso2.carbon.apimgt.impl/src/main/java/org/wso2/carbon/apimgt/impl/dao/ApiMgtDAO.java", "diffHunk": "@@ -590,6 +590,51 @@ public void addSubscriber(Subscriber subscriber, String groupingId) throws APIMa\n         }\n     }\n \n+    /**\n+     * Get subscriber name using subscription ID\n+     *\n+     * @param subscriptionId\n+     * @return subscriber name\n+     * @throws APIManagementException\n+     */\n+    public String getSubscriberName(String subscriptionId) throws APIManagementException {\n+        int subscriberId = getSubscriberIdBySubscriptionUUID(subscriptionId);\n+        Subscriber subscriber = getSubscriber(subscriberId);\n+        if (subscriber != null) {\n+            return subscriber.getName();\n+        }\n+        return StringUtils.EMPTY;\n+    }\n+\n+    /**\n+     * Get subscriber ID using subscription ID\n+     *\n+     * @param subscriptionId\n+     * @return subscriber ID\n+     * @throws APIManagementException\n+     */\n+    private int getSubscriberIdBySubscriptionUUID(String subscriptionId) throws APIManagementException {\n+        Connection connection = null;\n+        ResultSet rs = null;\n+        PreparedStatement ps = null;\n+        int subscirberId = 0;\n+        try {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "206caa818442818b4ed0483269925bdd728c2721"}, "originalPosition": 32}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMTg2MjgxNg==", "bodyText": "Fixed in 4b0356d", "url": "https://github.com/wso2/carbon-apimgt/pull/8405#discussion_r411862816", "createdAt": "2020-04-21T04:38:11Z", "author": {"login": "vithu30"}, "path": "components/apimgt/org.wso2.carbon.apimgt.impl/src/main/java/org/wso2/carbon/apimgt/impl/dao/ApiMgtDAO.java", "diffHunk": "@@ -590,6 +590,51 @@ public void addSubscriber(Subscriber subscriber, String groupingId) throws APIMa\n         }\n     }\n \n+    /**\n+     * Get subscriber name using subscription ID\n+     *\n+     * @param subscriptionId\n+     * @return subscriber name\n+     * @throws APIManagementException\n+     */\n+    public String getSubscriberName(String subscriptionId) throws APIManagementException {\n+        int subscriberId = getSubscriberIdBySubscriptionUUID(subscriptionId);\n+        Subscriber subscriber = getSubscriber(subscriberId);\n+        if (subscriber != null) {\n+            return subscriber.getName();\n+        }\n+        return StringUtils.EMPTY;\n+    }\n+\n+    /**\n+     * Get subscriber ID using subscription ID\n+     *\n+     * @param subscriptionId\n+     * @return subscriber ID\n+     * @throws APIManagementException\n+     */\n+    private int getSubscriberIdBySubscriptionUUID(String subscriptionId) throws APIManagementException {\n+        Connection connection = null;\n+        ResultSet rs = null;\n+        PreparedStatement ps = null;\n+        int subscirberId = 0;\n+        try {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMTQ2NTcwNw=="}, "originalCommit": {"oid": "206caa818442818b4ed0483269925bdd728c2721"}, "originalPosition": 32}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2728, "cost": 1, "resetAt": "2021-11-13T14:23:39Z"}}}