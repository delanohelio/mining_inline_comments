{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0Mzc2NTc0MDEz", "number": 8215, "reviewThreads": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xOFQxMjowNTo1N1rODgq0uA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yMFQwODozMDoxMlrODhbo8w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjM1NTgyNjQ4OnYy", "diffSide": "RIGHT", "path": "components/apimgt/org.wso2.carbon.apimgt.keymgt/src/main/java/org/wso2/carbon/apimgt/keymgt/handlers/SessionDataPublisherImpl.java", "isResolved": false, "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xOFQxMjowNTo1N1rOFq_4Hg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xOFQxMjoxNjowNFrOFrAJmQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MDYzMTA3MA==", "bodyText": "Can't we remove this new line and keep as a single line?", "url": "https://github.com/wso2/carbon-apimgt/pull/8215#discussion_r380631070", "createdAt": "2020-02-18T12:05:57Z", "author": {"login": "menakaj"}, "path": "components/apimgt/org.wso2.carbon.apimgt.keymgt/src/main/java/org/wso2/carbon/apimgt/keymgt/handlers/SessionDataPublisherImpl.java", "diffHunk": "@@ -123,6 +123,19 @@\n                         .getUserName(), e);\n             }\n         }\n+        SystemApplicationDAO systemApplicationDAO = new SystemApplicationDAO();\n+        try {\n+            systemApplicationDTOS = systemApplicationDAO.getApplications(tenantDomain);\n+            if (systemApplicationDTOS.length < 0) {\n+                if (log.isDebugEnabled()) {\n+                    log.debug(", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "8087fdb1e4e23297fdf21c6079e0af669b1414c7"}, "originalPosition": 57}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MDYzMTM3MA==", "bodyText": "Also add a space before \"doesn't\"\n\"The tenant: \" + tenantDomain + \" doesn't have any system apps\"", "url": "https://github.com/wso2/carbon-apimgt/pull/8215#discussion_r380631370", "createdAt": "2020-02-18T12:06:42Z", "author": {"login": "menakaj"}, "path": "components/apimgt/org.wso2.carbon.apimgt.keymgt/src/main/java/org/wso2/carbon/apimgt/keymgt/handlers/SessionDataPublisherImpl.java", "diffHunk": "@@ -123,6 +123,19 @@\n                         .getUserName(), e);\n             }\n         }\n+        SystemApplicationDAO systemApplicationDAO = new SystemApplicationDAO();\n+        try {\n+            systemApplicationDTOS = systemApplicationDAO.getApplications(tenantDomain);\n+            if (systemApplicationDTOS.length < 0) {\n+                if (log.isDebugEnabled()) {\n+                    log.debug(", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MDYzMTA3MA=="}, "originalCommit": {"oid": "8087fdb1e4e23297fdf21c6079e0af669b1414c7"}, "originalPosition": 57}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MDYzNTU0NQ==", "bodyText": "resolved", "url": "https://github.com/wso2/carbon-apimgt/pull/8215#discussion_r380635545", "createdAt": "2020-02-18T12:16:04Z", "author": {"login": "CrowleyRajapakse"}, "path": "components/apimgt/org.wso2.carbon.apimgt.keymgt/src/main/java/org/wso2/carbon/apimgt/keymgt/handlers/SessionDataPublisherImpl.java", "diffHunk": "@@ -123,6 +123,19 @@\n                         .getUserName(), e);\n             }\n         }\n+        SystemApplicationDAO systemApplicationDAO = new SystemApplicationDAO();\n+        try {\n+            systemApplicationDTOS = systemApplicationDAO.getApplications(tenantDomain);\n+            if (systemApplicationDTOS.length < 0) {\n+                if (log.isDebugEnabled()) {\n+                    log.debug(", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MDYzMTA3MA=="}, "originalCommit": {"oid": "8087fdb1e4e23297fdf21c6079e0af669b1414c7"}, "originalPosition": 57}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjM1NTgzMzMwOnYy", "diffSide": "RIGHT", "path": "components/apimgt/org.wso2.carbon.apimgt.impl/src/main/java/org/wso2/carbon/apimgt/impl/dao/constants/SQLConstants.java", "isResolved": false, "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xOFQxMjowODoxOVrOFq_8Dg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xOFQxMjoxNTo1NlrOFrAJUQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MDYzMjA3OA==", "bodyText": "Remove the concatenation and keep in a single line.\n    `public static final String GET__APPLICATIONS = \"SELECT * FROM AM_SYSTEM_APPS WHERE TENANT_DOMAIN = ?\";`", "url": "https://github.com/wso2/carbon-apimgt/pull/8215#discussion_r380632078", "createdAt": "2020-02-18T12:08:19Z", "author": {"login": "menakaj"}, "path": "components/apimgt/org.wso2.carbon.apimgt.impl/src/main/java/org/wso2/carbon/apimgt/impl/dao/constants/SQLConstants.java", "diffHunk": "@@ -3403,6 +3403,9 @@\n                 \"INSERT INTO AM_SYSTEM_APPS \" + \"(NAME,CONSUMER_KEY,CONSUMER_SECRET,TENANT_DOMAIN,CREATED_TIME) \" +\n                         \"VALUES (?,?,?,?,?)\";\n \n+        public static final String GET__APPLICATIONS =", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "8087fdb1e4e23297fdf21c6079e0af669b1414c7"}, "originalPosition": 4}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MDYzMjc1Mw==", "bodyText": "Ther are two _ characters in the variable.", "url": "https://github.com/wso2/carbon-apimgt/pull/8215#discussion_r380632753", "createdAt": "2020-02-18T12:09:50Z", "author": {"login": "menakaj"}, "path": "components/apimgt/org.wso2.carbon.apimgt.impl/src/main/java/org/wso2/carbon/apimgt/impl/dao/constants/SQLConstants.java", "diffHunk": "@@ -3403,6 +3403,9 @@\n                 \"INSERT INTO AM_SYSTEM_APPS \" + \"(NAME,CONSUMER_KEY,CONSUMER_SECRET,TENANT_DOMAIN,CREATED_TIME) \" +\n                         \"VALUES (?,?,?,?,?)\";\n \n+        public static final String GET__APPLICATIONS =", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MDYzMjA3OA=="}, "originalCommit": {"oid": "8087fdb1e4e23297fdf21c6079e0af669b1414c7"}, "originalPosition": 4}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MDYzNTQ3Mw==", "bodyText": "resolved", "url": "https://github.com/wso2/carbon-apimgt/pull/8215#discussion_r380635473", "createdAt": "2020-02-18T12:15:56Z", "author": {"login": "CrowleyRajapakse"}, "path": "components/apimgt/org.wso2.carbon.apimgt.impl/src/main/java/org/wso2/carbon/apimgt/impl/dao/constants/SQLConstants.java", "diffHunk": "@@ -3403,6 +3403,9 @@\n                 \"INSERT INTO AM_SYSTEM_APPS \" + \"(NAME,CONSUMER_KEY,CONSUMER_SECRET,TENANT_DOMAIN,CREATED_TIME) \" +\n                         \"VALUES (?,?,?,?,?)\";\n \n+        public static final String GET__APPLICATIONS =", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MDYzMjA3OA=="}, "originalCommit": {"oid": "8087fdb1e4e23297fdf21c6079e0af669b1414c7"}, "originalPosition": 4}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjM1NTg0NTMxOnYy", "diffSide": "RIGHT", "path": "components/apimgt/org.wso2.carbon.apimgt.keymgt/src/main/java/org/wso2/carbon/apimgt/keymgt/handlers/SessionDataPublisherImpl.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xOFQxMjoxMjoyOVrOFrADfA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yMFQwODoxNjozOVrOFsJwSw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MDYzMzk4MA==", "bodyText": "Format the code", "url": "https://github.com/wso2/carbon-apimgt/pull/8215#discussion_r380633980", "createdAt": "2020-02-18T12:12:29Z", "author": {"login": "malinthaprasan"}, "path": "components/apimgt/org.wso2.carbon.apimgt.keymgt/src/main/java/org/wso2/carbon/apimgt/keymgt/handlers/SessionDataPublisherImpl.java", "diffHunk": "@@ -136,11 +149,15 @@\n                     e);\n         }\n \n-        for (OAuthConsumerAppDTO appDTO : appDTOs) {\n-            if (StringUtils.equalsIgnoreCase(DEVPORTAL_CLIENT_APP_NAME_OLD, appDTO.getApplicationName()) ||\n-                    StringUtils.equalsIgnoreCase(DEVPORTAL_CLIENT_APP_NAME, appDTO.getApplicationName()) ||\n-                    StringUtils.equalsIgnoreCase(PUBLISHER_CLIENT_APP_NAME_OLD, appDTO.getApplicationName()) ||\n-                    StringUtils.equalsIgnoreCase(PUBLISHER_CLIENT_APP_NAME, appDTO.getApplicationName())) {\n+        for(OAuthConsumerAppDTO appDTO : appDTOs){\n+            for(SystemApplicationDTO systemApplicationDTO : systemApplicationDTOS) {\n+                if(StringUtils.equalsIgnoreCase(appDTO.getOauthConsumerKey(),systemApplicationDTO.getConsumerKey())){\n+                    revokeAppList.add(appDTO);\n+                }\n+            }\n+        }", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "8087fdb1e4e23297fdf21c6079e0af669b1414c7"}, "originalPosition": 83}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MTg0MTQ4Mw==", "bodyText": "resolved", "url": "https://github.com/wso2/carbon-apimgt/pull/8215#discussion_r381841483", "createdAt": "2020-02-20T08:16:39Z", "author": {"login": "CrowleyRajapakse"}, "path": "components/apimgt/org.wso2.carbon.apimgt.keymgt/src/main/java/org/wso2/carbon/apimgt/keymgt/handlers/SessionDataPublisherImpl.java", "diffHunk": "@@ -136,11 +149,15 @@\n                     e);\n         }\n \n-        for (OAuthConsumerAppDTO appDTO : appDTOs) {\n-            if (StringUtils.equalsIgnoreCase(DEVPORTAL_CLIENT_APP_NAME_OLD, appDTO.getApplicationName()) ||\n-                    StringUtils.equalsIgnoreCase(DEVPORTAL_CLIENT_APP_NAME, appDTO.getApplicationName()) ||\n-                    StringUtils.equalsIgnoreCase(PUBLISHER_CLIENT_APP_NAME_OLD, appDTO.getApplicationName()) ||\n-                    StringUtils.equalsIgnoreCase(PUBLISHER_CLIENT_APP_NAME, appDTO.getApplicationName())) {\n+        for(OAuthConsumerAppDTO appDTO : appDTOs){\n+            for(SystemApplicationDTO systemApplicationDTO : systemApplicationDTOS) {\n+                if(StringUtils.equalsIgnoreCase(appDTO.getOauthConsumerKey(),systemApplicationDTO.getConsumerKey())){\n+                    revokeAppList.add(appDTO);\n+                }\n+            }\n+        }", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MDYzMzk4MA=="}, "originalCommit": {"oid": "8087fdb1e4e23297fdf21c6079e0af669b1414c7"}, "originalPosition": 83}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjM1NTg0NzM3OnYy", "diffSide": "RIGHT", "path": "components/apimgt/org.wso2.carbon.apimgt.keymgt/src/main/java/org/wso2/carbon/apimgt/keymgt/handlers/SessionDataPublisherImpl.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xOFQxMjoxMzoxNVrOFrAEvg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yMFQwODoyMzozMFrOFsJ7sA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MDYzNDMwMg==", "bodyText": "Can we continue when error happens?", "url": "https://github.com/wso2/carbon-apimgt/pull/8215#discussion_r380634302", "createdAt": "2020-02-18T12:13:15Z", "author": {"login": "malinthaprasan"}, "path": "components/apimgt/org.wso2.carbon.apimgt.keymgt/src/main/java/org/wso2/carbon/apimgt/keymgt/handlers/SessionDataPublisherImpl.java", "diffHunk": "@@ -123,6 +123,19 @@\n                         .getUserName(), e);\n             }\n         }\n+        SystemApplicationDAO systemApplicationDAO = new SystemApplicationDAO();\n+        try {\n+            systemApplicationDTOS = systemApplicationDAO.getApplications(tenantDomain);\n+            if (systemApplicationDTOS.length < 0) {\n+                if (log.isDebugEnabled()) {\n+                    log.debug(\n+                            \"The tenant: \" + tenantDomain + \"doesn't have any system apps\");\n+                }\n+            }\n+        } catch (APIMgtDAOException e) {\n+            log.error(\"Error thrown while retrieving system applications for the tenant domain\" + tenantDomain, e);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "8087fdb1e4e23297fdf21c6079e0af669b1414c7"}, "originalPosition": 62}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MTg0NDQwMA==", "bodyText": "Yes, then there won't be any tokens related to system apps will be revoked and will log that above error message, but will terminate the user session from IDP side and user will be logged out of the client.\nTherefore, if there is an issue in database connections, it will not affect the logout flow. The downside is, then the tokens related to that user also won't get revoked.", "url": "https://github.com/wso2/carbon-apimgt/pull/8215#discussion_r381844400", "createdAt": "2020-02-20T08:23:30Z", "author": {"login": "CrowleyRajapakse"}, "path": "components/apimgt/org.wso2.carbon.apimgt.keymgt/src/main/java/org/wso2/carbon/apimgt/keymgt/handlers/SessionDataPublisherImpl.java", "diffHunk": "@@ -123,6 +123,19 @@\n                         .getUserName(), e);\n             }\n         }\n+        SystemApplicationDAO systemApplicationDAO = new SystemApplicationDAO();\n+        try {\n+            systemApplicationDTOS = systemApplicationDAO.getApplications(tenantDomain);\n+            if (systemApplicationDTOS.length < 0) {\n+                if (log.isDebugEnabled()) {\n+                    log.debug(\n+                            \"The tenant: \" + tenantDomain + \"doesn't have any system apps\");\n+                }\n+            }\n+        } catch (APIMgtDAOException e) {\n+            log.error(\"Error thrown while retrieving system applications for the tenant domain\" + tenantDomain, e);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MDYzNDMwMg=="}, "originalCommit": {"oid": "8087fdb1e4e23297fdf21c6079e0af669b1414c7"}, "originalPosition": 62}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjM2MzgyNDUxOnYy", "diffSide": "RIGHT", "path": "components/apimgt/org.wso2.carbon.apimgt.keymgt/src/main/java/org/wso2/carbon/apimgt/keymgt/handlers/SessionDataPublisherImpl.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yMFQwODozMDoxMlrOFsKHzQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yMFQwOToxNTozNlrOFsLisQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MTg0NzUwMQ==", "bodyText": "This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters. Learn more about bidirectional Unicode characters\n\n\n  \n\n\n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                        log.error(\"Error thrown while retrieving system applications for the tenant domain\" + tenantDomain, e);\n          \n          \n            \n                        log.error(\"Error thrown while retrieving system applications for the tenant domain \" + tenantDomain, e);", "url": "https://github.com/wso2/carbon-apimgt/pull/8215#discussion_r381847501", "createdAt": "2020-02-20T08:30:12Z", "author": {"login": "fazlan-nazeem"}, "path": "components/apimgt/org.wso2.carbon.apimgt.keymgt/src/main/java/org/wso2/carbon/apimgt/keymgt/handlers/SessionDataPublisherImpl.java", "diffHunk": "@@ -123,6 +123,18 @@\n                         .getUserName(), e);\n             }\n         }\n+        SystemApplicationDAO systemApplicationDAO = new SystemApplicationDAO();\n+        try {\n+            systemApplicationDTOS = systemApplicationDAO.getApplications(tenantDomain);\n+            if (systemApplicationDTOS.length < 0) {\n+                if (log.isDebugEnabled()) {\n+                    log.debug(\"The tenant: \" + tenantDomain + \" doesn't have any system apps\");\n+                }\n+            }\n+        } catch (APIMgtDAOException e) {\n+            log.error(\"Error thrown while retrieving system applications for the tenant domain\" + tenantDomain, e);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "3099e5e2754fef6a69bd0d33eab45967c2268413"}, "originalPosition": 61}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MTg3MDc2OQ==", "bodyText": "changed and resolved", "url": "https://github.com/wso2/carbon-apimgt/pull/8215#discussion_r381870769", "createdAt": "2020-02-20T09:15:36Z", "author": {"login": "CrowleyRajapakse"}, "path": "components/apimgt/org.wso2.carbon.apimgt.keymgt/src/main/java/org/wso2/carbon/apimgt/keymgt/handlers/SessionDataPublisherImpl.java", "diffHunk": "@@ -123,6 +123,18 @@\n                         .getUserName(), e);\n             }\n         }\n+        SystemApplicationDAO systemApplicationDAO = new SystemApplicationDAO();\n+        try {\n+            systemApplicationDTOS = systemApplicationDAO.getApplications(tenantDomain);\n+            if (systemApplicationDTOS.length < 0) {\n+                if (log.isDebugEnabled()) {\n+                    log.debug(\"The tenant: \" + tenantDomain + \" doesn't have any system apps\");\n+                }\n+            }\n+        } catch (APIMgtDAOException e) {\n+            log.error(\"Error thrown while retrieving system applications for the tenant domain\" + tenantDomain, e);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MTg0NzUwMQ=="}, "originalCommit": {"oid": "3099e5e2754fef6a69bd0d33eab45967c2268413"}, "originalPosition": 61}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2889, "cost": 1, "resetAt": "2021-11-13T14:23:39Z"}}}