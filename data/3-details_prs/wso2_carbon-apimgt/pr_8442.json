{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDEwNTg2MDU3", "number": 8442, "title": "Added workflow Executors for Approval workflow executor", "bodyText": "Added two rest APIs\nAdded workflow executors for application creation, application subscription, API state change, application registration key generation, and user self sign up", "createdAt": "2020-04-29T09:10:38Z", "url": "https://github.com/wso2/carbon-apimgt/pull/8442", "merged": true, "mergeCommit": {"oid": "6c9f5b0f7a85b5329b50f092c8be4fe7b1744335"}, "closed": true, "closedAt": "2020-06-03T14:49:00Z", "author": {"login": "SahanHerath"}, "timelineItems": {"totalCount": 46, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcBPeWcAH2gAyNDEwNTg2MDU3OjczODNhZjY4MWIzMDBkYmVhYzE5OTVkYWQzNjA1ZjEyOTk3OWFhM2U=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcnqn1VgFqTQyMzYzMTM4MA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "7383af681b300dbeac1995dad3605f129979aa3e", "author": {"user": {"login": "chamilaadhi", "name": "Chamila Adhikarinayake"}}, "url": "https://github.com/wso2/carbon-apimgt/commit/7383af681b300dbeac1995dad3605f129979aa3e", "committedDate": "2020-02-05T05:41:44Z", "message": "Merge pull request #8148 from chamilaadhi/master-workflow\n\nMerge master to master-workflow branch"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "1eb597113efdf58bea03635da816422782c93ab8", "author": {"user": {"login": "chamilaadhi", "name": "Chamila Adhikarinayake"}}, "url": "https://github.com/wso2/carbon-apimgt/commit/1eb597113efdf58bea03635da816422782c93ab8", "committedDate": "2020-02-25T06:09:36Z", "message": "Merge remote-tracking branch 'origin/master' into master-workflow"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "8f6f87a82ac3ad2a69c7f0e47a0517d114355694", "author": {"user": {"login": "chamilaadhi", "name": "Chamila Adhikarinayake"}}, "url": "https://github.com/wso2/carbon-apimgt/commit/8f6f87a82ac3ad2a69c7f0e47a0517d114355694", "committedDate": "2020-03-30T04:25:58Z", "message": "Merge remote-tracking branch 'origin/master' into master-workflow"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "63aac0ce60d89723bf51b15c7f9f35b420b3e7cc", "author": {"user": {"login": "SahanHerath", "name": "Sahan Herath"}}, "url": "https://github.com/wso2/carbon-apimgt/commit/63aac0ce60d89723bf51b15c7f9f35b420b3e7cc", "committedDate": "2020-04-01T07:02:11Z", "message": "Added workflowExecutors for ApprovalWorkflowExecutor and two rest APIs."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e5f1ca8c0c731ff296553a3776fe7937da125395", "author": {"user": {"login": "SahanHerath", "name": "Sahan Herath"}}, "url": "https://github.com/wso2/carbon-apimgt/commit/e5f1ca8c0c731ff296553a3776fe7937da125395", "committedDate": "2020-04-01T07:02:12Z", "message": "Reformatted workflowExecutors for ApprovalWorkflowExecutor and two rest APIs"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "8b030289aca2777f2d9be37fd3330df4e6ce1002", "author": {"user": {"login": "SahanHerath", "name": "Sahan Herath"}}, "url": "https://github.com/wso2/carbon-apimgt/commit/8b030289aca2777f2d9be37fd3330df4e6ce1002", "committedDate": "2020-04-01T07:02:12Z", "message": "Added database changes to the sql files"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "31f6f67b8a13bf657c46f4e2f9730d7b472c9b72", "author": {"user": {"login": "SahanHerath", "name": "Sahan Herath"}}, "url": "https://github.com/wso2/carbon-apimgt/commit/31f6f67b8a13bf657c46f4e2f9730d7b472c9b72", "committedDate": "2020-04-01T07:28:36Z", "message": "Added workflowExecutors for ApprovalWorkflowExecutor and two rest APIs."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "63814cb85271ac3852fd12470cc7a81669d844ca", "author": {"user": {"login": "SahanHerath", "name": "Sahan Herath"}}, "url": "https://github.com/wso2/carbon-apimgt/commit/63814cb85271ac3852fd12470cc7a81669d844ca", "committedDate": "2020-04-01T07:28:37Z", "message": "Changes in the workflow executors"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "6bf3e5572d4f5d21b3b4f4cb596a1eeea3348002", "author": {"user": {"login": "SahanHerath", "name": "Sahan Herath"}}, "url": "https://github.com/wso2/carbon-apimgt/commit/6bf3e5572d4f5d21b3b4f4cb596a1eeea3348002", "committedDate": "2020-04-03T05:48:18Z", "message": "Changes in add workflow entry ApiMgtDAO.java"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e00fe40f5ef809f1ac81dc7c22faacda062adfab", "author": {"user": {"login": "SahanHerath", "name": "Sahan Herath"}}, "url": "https://github.com/wso2/carbon-apimgt/commit/e00fe40f5ef809f1ac81dc7c22faacda062adfab", "committedDate": "2020-04-15T10:56:04Z", "message": "Reformatted the approval workflow executor and rest APIs"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "68b7419e6cbaa0784e59e60fbdbe77dbb27eb484", "author": {"user": {"login": "SahanHerath", "name": "Sahan Herath"}}, "url": "https://github.com/wso2/carbon-apimgt/commit/68b7419e6cbaa0784e59e60fbdbe77dbb27eb484", "committedDate": "2020-04-19T01:46:12Z", "message": "Changed the licence header in Approval Workflow Executor tests"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "3719d98f3d2faba218147e15535025aa6169e371", "author": {"user": {"login": "SahanHerath", "name": "Sahan Herath"}}, "url": "https://github.com/wso2/carbon-apimgt/commit/3719d98f3d2faba218147e15535025aa6169e371", "committedDate": "2020-04-19T02:28:36Z", "message": "Change the licence header of Workflow.java"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "9b48a01776745e4804aee0554f67dde112e0ccdd", "author": {"user": {"login": "SahanHerath", "name": "Sahan Herath"}}, "url": "https://github.com/wso2/carbon-apimgt/commit/9b48a01776745e4804aee0554f67dde112e0ccdd", "committedDate": "2020-04-24T09:47:33Z", "message": "Reformtted the previous commits and removed unwanted files"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "56d859aa06815de769c0130c450c2764150312fc", "author": {"user": {"login": "SahanHerath", "name": "Sahan Herath"}}, "url": "https://github.com/wso2/carbon-apimgt/commit/56d859aa06815de769c0130c450c2764150312fc", "committedDate": "2020-04-28T10:11:28Z", "message": "Changed the admin-api.yaml and beans.xml in org.wso2.carbon.apimgt.rest.api.admin"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "8f4619855f84b58847bd9b1bae181401f0a81961", "author": {"user": {"login": "chamilaadhi", "name": "Chamila Adhikarinayake"}}, "url": "https://github.com/wso2/carbon-apimgt/commit/8f4619855f84b58847bd9b1bae181401f0a81961", "committedDate": "2020-04-29T07:09:51Z", "message": "Merge pull request #8293 from SahanHerath/master-workflow\n\nAdded workflowExecutors for ApprovalWorkflowExecutor and two rest APIs."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a84db7f57f34a60ed66b6d59b075f42124e16256", "author": {"user": {"login": "SahanHerath", "name": "Sahan Herath"}}, "url": "https://github.com/wso2/carbon-apimgt/commit/a84db7f57f34a60ed66b6d59b075f42124e16256", "committedDate": "2020-04-29T09:06:55Z", "message": "Merge pull request #1 from SahanHerath/master-workflow\n\nMaster workflow merged with master"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e39d9dd0e08d1e2758d83712db0496ca4b2312d4", "author": {"user": {"login": "SahanHerath", "name": "Sahan Herath"}}, "url": "https://github.com/wso2/carbon-apimgt/commit/e39d9dd0e08d1e2758d83712db0496ca4b2312d4", "committedDate": "2020-04-29T09:38:19Z", "message": "Reformtted imports in ApiMgtDAO.java"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDA0MTEwMTQ3", "url": "https://github.com/wso2/carbon-apimgt/pull/8442#pullrequestreview-404110147", "createdAt": "2020-05-01T10:50:31Z", "commit": {"oid": "e39d9dd0e08d1e2758d83712db0496ca4b2312d4"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 6, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wMVQxMDo1MDozMVrOGPHFYg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wMVQxMDo1NDo1MVrOGPHJmA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxODQ5Nzg5MA==", "bodyText": "this method is not formatted.", "url": "https://github.com/wso2/carbon-apimgt/pull/8442#discussion_r418497890", "createdAt": "2020-05-01T10:50:31Z", "author": {"login": "chamilaadhi"}, "path": "components/apimgt/org.wso2.carbon.apimgt.impl/src/main/java/org/wso2/carbon/apimgt/impl/dao/ApiMgtDAO.java", "diffHunk": "@@ -14650,4 +14667,243 @@ public String getUserID(String userName) throws APIManagementException {\n         }\n         return list;\n     }\n+\n+    /**\n+     * Remove the Pending workflow Requests using ExternalWorkflowReference\n+     * @param workflowExtRef External Workflow Reference of Workflow Pending Request\n+     * @throws APIManagementException\n+     */\n+    public void deleteWorkflowRequest(String workflowExtRef) throws APIManagementException {\n+        Connection connection = null;\n+        PreparedStatement prepStmt = null;\n+        String query = SQLConstants.DELETE_WORKFLOW_REQUEST_SQL;\n+        try {\n+            connection = APIMgtDBUtil.getConnection();\n+            connection.setAutoCommit(false);\n+            prepStmt = connection.prepareStatement(query);\n+            prepStmt.setString(1, workflowExtRef);\n+            prepStmt.executeUpdate();\n+            connection.commit();\n+        }\n+        catch (SQLException e) {\n+            handleException(\"Failed to delete the workflow request. \", e);\n+        } finally {\n+            APIMgtDBUtil.closeAllConnections(prepStmt, connection, null);\n+        }\n+    }\n+\n+    /**\n+     * Get the Pending workflow Request using ExternalWorkflowReference\n+     * @param externalWorkflowRef\n+     * @return workflow pending request\n+     * @throws APIManagementException\n+     */\n+    public Workflow getworkflowReferenceByExternalWorkflowReference(String externalWorkflowRef)throws APIManagementException {\n+", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e39d9dd0e08d1e2758d83712db0496ca4b2312d4"}, "originalPosition": 89}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxODQ5ODE2MQ==", "bodyText": "formatting issue. this would be fixed once you format the whole method", "url": "https://github.com/wso2/carbon-apimgt/pull/8442#discussion_r418498161", "createdAt": "2020-05-01T10:51:30Z", "author": {"login": "chamilaadhi"}, "path": "components/apimgt/org.wso2.carbon.apimgt.impl/src/main/java/org/wso2/carbon/apimgt/impl/dao/ApiMgtDAO.java", "diffHunk": "@@ -14650,4 +14667,243 @@ public String getUserID(String userName) throws APIManagementException {\n         }\n         return list;\n     }\n+\n+    /**\n+     * Remove the Pending workflow Requests using ExternalWorkflowReference\n+     * @param workflowExtRef External Workflow Reference of Workflow Pending Request\n+     * @throws APIManagementException\n+     */\n+    public void deleteWorkflowRequest(String workflowExtRef) throws APIManagementException {\n+        Connection connection = null;\n+        PreparedStatement prepStmt = null;\n+        String query = SQLConstants.DELETE_WORKFLOW_REQUEST_SQL;\n+        try {\n+            connection = APIMgtDBUtil.getConnection();\n+            connection.setAutoCommit(false);\n+            prepStmt = connection.prepareStatement(query);\n+            prepStmt.setString(1, workflowExtRef);\n+            prepStmt.executeUpdate();\n+            connection.commit();\n+        }\n+        catch (SQLException e) {\n+            handleException(\"Failed to delete the workflow request. \", e);\n+        } finally {\n+            APIMgtDBUtil.closeAllConnections(prepStmt, connection, null);\n+        }\n+    }\n+\n+    /**\n+     * Get the Pending workflow Request using ExternalWorkflowReference\n+     * @param externalWorkflowRef\n+     * @return workflow pending request\n+     * @throws APIManagementException\n+     */\n+    public Workflow getworkflowReferenceByExternalWorkflowReference(String externalWorkflowRef)throws APIManagementException {\n+\n+        Connection connection = null;\n+        PreparedStatement prepStmt = null;\n+        ResultSet rs = null;\n+        Workflow workflow = new Workflow();\n+        String sqlQuery = SQLConstants.GET_ALL_WORKFLOW_DETAILS_BY_EXTERNALWORKFLOWREF;\n+        try {\n+            connection = APIMgtDBUtil.getConnection();\n+            prepStmt = connection.prepareStatement(sqlQuery);\n+            prepStmt.setString(1, externalWorkflowRef);\n+            rs = prepStmt.executeQuery();\n+\n+            while (rs.next()) {\n+                workflow.setWorkflowId(rs.getInt(\"WF_ID\"));\n+                workflow.setWorkflowReference(rs.getString(\"WF_REFERENCE\"));\n+                workflow.setWorkflowType(rs.getString(\"WF_TYPE\"));\n+                String workflowstatus =rs.getString(\"WF_STATUS\");\n+                workflow.setStatus(org.wso2.carbon.apimgt.api.WorkflowStatus.valueOf(workflowstatus));\n+                workflow.setCreatedTime(rs.getTimestamp(\"WF_CREATED_TIME\").toString());\n+                workflow.setUpdatedTime(rs.getTimestamp(\"WF_UPDATED_TIME\").toString());\n+                workflow.setWorkflowStatusDesc(rs.getString(\"WF_STATUS_DESC\"));\n+                workflow.setTenantId(rs.getInt(\"TENANT_ID\"));\n+                workflow.setTenantDomain(rs.getString(\"TENANT_DOMAIN\"));\n+                workflow.setExternalWorkflowReference(rs.getString(\"WF_EXTERNAL_REFERENCE\"));\n+                Blob metadatablob = rs.getBlob(\"WF_METADATA\");\n+\n+                byte[] metadataByte;\n+                if(metadatablob != null) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e39d9dd0e08d1e2758d83712db0496ca4b2312d4"}, "originalPosition": 116}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxODQ5ODMzNQ==", "bodyText": "formatting issue. please format the whole method", "url": "https://github.com/wso2/carbon-apimgt/pull/8442#discussion_r418498335", "createdAt": "2020-05-01T10:52:11Z", "author": {"login": "chamilaadhi"}, "path": "components/apimgt/org.wso2.carbon.apimgt.impl/src/main/java/org/wso2/carbon/apimgt/impl/dao/ApiMgtDAO.java", "diffHunk": "@@ -14650,4 +14667,243 @@ public String getUserID(String userName) throws APIManagementException {\n         }\n         return list;\n     }\n+\n+    /**\n+     * Remove the Pending workflow Requests using ExternalWorkflowReference\n+     * @param workflowExtRef External Workflow Reference of Workflow Pending Request\n+     * @throws APIManagementException\n+     */\n+    public void deleteWorkflowRequest(String workflowExtRef) throws APIManagementException {\n+        Connection connection = null;\n+        PreparedStatement prepStmt = null;\n+        String query = SQLConstants.DELETE_WORKFLOW_REQUEST_SQL;\n+        try {\n+            connection = APIMgtDBUtil.getConnection();\n+            connection.setAutoCommit(false);\n+            prepStmt = connection.prepareStatement(query);\n+            prepStmt.setString(1, workflowExtRef);\n+            prepStmt.executeUpdate();\n+            connection.commit();\n+        }\n+        catch (SQLException e) {\n+            handleException(\"Failed to delete the workflow request. \", e);\n+        } finally {\n+            APIMgtDBUtil.closeAllConnections(prepStmt, connection, null);\n+        }\n+    }\n+\n+    /**\n+     * Get the Pending workflow Request using ExternalWorkflowReference\n+     * @param externalWorkflowRef\n+     * @return workflow pending request\n+     * @throws APIManagementException\n+     */\n+    public Workflow getworkflowReferenceByExternalWorkflowReference(String externalWorkflowRef)throws APIManagementException {\n+\n+        Connection connection = null;\n+        PreparedStatement prepStmt = null;\n+        ResultSet rs = null;\n+        Workflow workflow = new Workflow();\n+        String sqlQuery = SQLConstants.GET_ALL_WORKFLOW_DETAILS_BY_EXTERNALWORKFLOWREF;\n+        try {\n+            connection = APIMgtDBUtil.getConnection();\n+            prepStmt = connection.prepareStatement(sqlQuery);\n+            prepStmt.setString(1, externalWorkflowRef);\n+            rs = prepStmt.executeQuery();\n+\n+            while (rs.next()) {\n+                workflow.setWorkflowId(rs.getInt(\"WF_ID\"));\n+                workflow.setWorkflowReference(rs.getString(\"WF_REFERENCE\"));\n+                workflow.setWorkflowType(rs.getString(\"WF_TYPE\"));\n+                String workflowstatus =rs.getString(\"WF_STATUS\");\n+                workflow.setStatus(org.wso2.carbon.apimgt.api.WorkflowStatus.valueOf(workflowstatus));\n+                workflow.setCreatedTime(rs.getTimestamp(\"WF_CREATED_TIME\").toString());\n+                workflow.setUpdatedTime(rs.getTimestamp(\"WF_UPDATED_TIME\").toString());\n+                workflow.setWorkflowStatusDesc(rs.getString(\"WF_STATUS_DESC\"));\n+                workflow.setTenantId(rs.getInt(\"TENANT_ID\"));\n+                workflow.setTenantDomain(rs.getString(\"TENANT_DOMAIN\"));\n+                workflow.setExternalWorkflowReference(rs.getString(\"WF_EXTERNAL_REFERENCE\"));\n+                Blob metadatablob = rs.getBlob(\"WF_METADATA\");\n+\n+                byte[] metadataByte;\n+                if(metadatablob != null) {\n+                    metadataByte = metadatablob.getBytes(1L, (int) metadatablob.length());\n+                    InputStream targetStream = new ByteArrayInputStream(metadataByte);\n+                    String metadata = APIMgtDBUtil.getStringFromInputStream(targetStream);\n+                    Gson metadataGson = new Gson();\n+                    JSONObject metadataJson = metadataGson.fromJson(metadata, JSONObject.class);\n+                    workflow.setMetadata(metadataJson);\n+                } else {\n+                    JSONObject metadataJson = new JSONObject();\n+                    workflow.setMetadata(metadataJson);\n+                }\n+            }\n+        } catch (SQLException e) {\n+            handleException(\"Error when retriving the workflow details. \" , e);\n+        } finally {\n+            APIMgtDBUtil.closeAllConnections(prepStmt, connection, rs);\n+        }\n+        return workflow;\n+    }\n+\n+    /**\n+     * Get the Pending workflow Requests using WorkflowType for a particular tenant\n+     * @param workflowType Type of the workflow pending request\n+     * @param status workflow status of workflow pending request\n+     * @param tenantDomain tenantDomain of the user\n+     * @return List of workflow pending request\n+     * @throws APIManagementException\n+     */\n+    public Workflow[] getworkflows(String workflowType, String status, String tenantDomain) throws APIManagementException {\n+\n+        Connection connection = null;\n+        PreparedStatement prepStmt = null;\n+        ResultSet rs = null;\n+        Workflow[] workflows = null;\n+        String sqlQuery;\n+        if (workflowType != null) {\n+            sqlQuery = SQLConstants.GET_ALL_WORKFLOW_DETAILS_BY_WORKFLOW_TYPE;\n+        } else {\n+            sqlQuery = SQLConstants.GET_ALL_WORKFLOW_DETAILS;\n+        }\n+        try {\n+            connection = APIMgtDBUtil.getConnection();\n+            prepStmt = connection.prepareStatement(sqlQuery);\n+\n+            if (workflowType != null){\n+                prepStmt.setString(1, workflowType);\n+                prepStmt.setString( 2, status);\n+                prepStmt.setString( 3, tenantDomain);\n+            } else {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e39d9dd0e08d1e2758d83712db0496ca4b2312d4"}, "originalPosition": 164}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxODQ5ODQyNw==", "bodyText": "format the whole method", "url": "https://github.com/wso2/carbon-apimgt/pull/8442#discussion_r418498427", "createdAt": "2020-05-01T10:52:38Z", "author": {"login": "chamilaadhi"}, "path": "components/apimgt/org.wso2.carbon.apimgt.impl/src/main/java/org/wso2/carbon/apimgt/impl/dao/ApiMgtDAO.java", "diffHunk": "@@ -14650,4 +14667,243 @@ public String getUserID(String userName) throws APIManagementException {\n         }\n         return list;\n     }\n+\n+    /**\n+     * Remove the Pending workflow Requests using ExternalWorkflowReference\n+     * @param workflowExtRef External Workflow Reference of Workflow Pending Request\n+     * @throws APIManagementException\n+     */\n+    public void deleteWorkflowRequest(String workflowExtRef) throws APIManagementException {\n+        Connection connection = null;\n+        PreparedStatement prepStmt = null;\n+        String query = SQLConstants.DELETE_WORKFLOW_REQUEST_SQL;\n+        try {\n+            connection = APIMgtDBUtil.getConnection();\n+            connection.setAutoCommit(false);\n+            prepStmt = connection.prepareStatement(query);\n+            prepStmt.setString(1, workflowExtRef);\n+            prepStmt.executeUpdate();\n+            connection.commit();\n+        }\n+        catch (SQLException e) {\n+            handleException(\"Failed to delete the workflow request. \", e);\n+        } finally {\n+            APIMgtDBUtil.closeAllConnections(prepStmt, connection, null);\n+        }\n+    }\n+\n+    /**\n+     * Get the Pending workflow Request using ExternalWorkflowReference\n+     * @param externalWorkflowRef\n+     * @return workflow pending request\n+     * @throws APIManagementException\n+     */\n+    public Workflow getworkflowReferenceByExternalWorkflowReference(String externalWorkflowRef)throws APIManagementException {\n+\n+        Connection connection = null;\n+        PreparedStatement prepStmt = null;\n+        ResultSet rs = null;\n+        Workflow workflow = new Workflow();\n+        String sqlQuery = SQLConstants.GET_ALL_WORKFLOW_DETAILS_BY_EXTERNALWORKFLOWREF;\n+        try {\n+            connection = APIMgtDBUtil.getConnection();\n+            prepStmt = connection.prepareStatement(sqlQuery);\n+            prepStmt.setString(1, externalWorkflowRef);\n+            rs = prepStmt.executeQuery();\n+\n+            while (rs.next()) {\n+                workflow.setWorkflowId(rs.getInt(\"WF_ID\"));\n+                workflow.setWorkflowReference(rs.getString(\"WF_REFERENCE\"));\n+                workflow.setWorkflowType(rs.getString(\"WF_TYPE\"));\n+                String workflowstatus =rs.getString(\"WF_STATUS\");\n+                workflow.setStatus(org.wso2.carbon.apimgt.api.WorkflowStatus.valueOf(workflowstatus));\n+                workflow.setCreatedTime(rs.getTimestamp(\"WF_CREATED_TIME\").toString());\n+                workflow.setUpdatedTime(rs.getTimestamp(\"WF_UPDATED_TIME\").toString());\n+                workflow.setWorkflowStatusDesc(rs.getString(\"WF_STATUS_DESC\"));\n+                workflow.setTenantId(rs.getInt(\"TENANT_ID\"));\n+                workflow.setTenantDomain(rs.getString(\"TENANT_DOMAIN\"));\n+                workflow.setExternalWorkflowReference(rs.getString(\"WF_EXTERNAL_REFERENCE\"));\n+                Blob metadatablob = rs.getBlob(\"WF_METADATA\");\n+\n+                byte[] metadataByte;\n+                if(metadatablob != null) {\n+                    metadataByte = metadatablob.getBytes(1L, (int) metadatablob.length());\n+                    InputStream targetStream = new ByteArrayInputStream(metadataByte);\n+                    String metadata = APIMgtDBUtil.getStringFromInputStream(targetStream);\n+                    Gson metadataGson = new Gson();\n+                    JSONObject metadataJson = metadataGson.fromJson(metadata, JSONObject.class);\n+                    workflow.setMetadata(metadataJson);\n+                } else {\n+                    JSONObject metadataJson = new JSONObject();\n+                    workflow.setMetadata(metadataJson);\n+                }\n+            }\n+        } catch (SQLException e) {\n+            handleException(\"Error when retriving the workflow details. \" , e);\n+        } finally {\n+            APIMgtDBUtil.closeAllConnections(prepStmt, connection, rs);\n+        }\n+        return workflow;\n+    }\n+\n+    /**\n+     * Get the Pending workflow Requests using WorkflowType for a particular tenant\n+     * @param workflowType Type of the workflow pending request\n+     * @param status workflow status of workflow pending request\n+     * @param tenantDomain tenantDomain of the user\n+     * @return List of workflow pending request\n+     * @throws APIManagementException\n+     */\n+    public Workflow[] getworkflows(String workflowType, String status, String tenantDomain) throws APIManagementException {\n+\n+        Connection connection = null;\n+        PreparedStatement prepStmt = null;\n+        ResultSet rs = null;\n+        Workflow[] workflows = null;\n+        String sqlQuery;\n+        if (workflowType != null) {\n+            sqlQuery = SQLConstants.GET_ALL_WORKFLOW_DETAILS_BY_WORKFLOW_TYPE;\n+        } else {\n+            sqlQuery = SQLConstants.GET_ALL_WORKFLOW_DETAILS;\n+        }\n+        try {\n+            connection = APIMgtDBUtil.getConnection();\n+            prepStmt = connection.prepareStatement(sqlQuery);\n+\n+            if (workflowType != null){\n+                prepStmt.setString(1, workflowType);\n+                prepStmt.setString( 2, status);\n+                prepStmt.setString( 3, tenantDomain);\n+            } else {\n+                prepStmt.setString( 1, status);\n+                prepStmt.setString( 2, tenantDomain);\n+            }\n+            rs = prepStmt.executeQuery();\n+\n+            ArrayList<Workflow> workflowsList = new ArrayList<Workflow>();\n+            Workflow workflow;\n+            while (rs.next()) {\n+                workflow = new Workflow();\n+                workflow.setWorkflowId(rs.getInt(\"WF_ID\"));\n+                workflow.setWorkflowReference(rs.getString(\"WF_REFERENCE\"));\n+                workflow.setWorkflowType(rs.getString(\"WF_TYPE\"));\n+                String workflowstatus = rs.getString(\"WF_STATUS\");\n+                workflow.setStatus(org.wso2.carbon.apimgt.api.WorkflowStatus.valueOf(workflowstatus));\n+                workflow.setCreatedTime(rs.getTimestamp(\"WF_CREATED_TIME\").toString());\n+                workflow.setUpdatedTime(rs.getTimestamp(\"WF_UPDATED_TIME\").toString());\n+                workflow.setWorkflowStatusDesc(rs.getString(\"WF_STATUS_DESC\"));\n+                workflow.setTenantId(rs.getInt(\"TENANT_ID\"));\n+                workflow.setTenantDomain(rs.getString(\"TENANT_DOMAIN\"));\n+                workflow.setExternalWorkflowReference(rs.getString(\"WF_EXTERNAL_REFERENCE\"));\n+                workflow.setWorkflowDescription(rs.getString(\"WF_STATUS_DESC\"));\n+                Blob metadataBlob = rs.getBlob(\"WF_METADATA\");\n+                Blob propertiesBlob = rs.getBlob(\"WF_PROPERTIES\");\n+\n+                byte[] metadataByte;\n+                if(metadataBlob != null) {\n+                    metadataByte = metadataBlob.getBytes(1L, (int) metadataBlob.length());\n+                    InputStream targetStream = new ByteArrayInputStream(metadataByte);\n+                    String metadata = APIMgtDBUtil.getStringFromInputStream(targetStream);\n+                    Gson metadataGson = new Gson();\n+                    JSONObject metadataJson = metadataGson.fromJson(metadata, JSONObject.class);\n+                    workflow.setMetadata(metadataJson);\n+                } else {\n+                    JSONObject metadataJson = new JSONObject();\n+                    workflow.setMetadata(metadataJson);\n+                }\n+\n+                byte[] propertiesByte;\n+                if(propertiesBlob != null) {\n+                    propertiesByte = propertiesBlob.getBytes(1L, (int) propertiesBlob.length());\n+                    InputStream propertiesTargetStream = new ByteArrayInputStream(propertiesByte);\n+                    String properties = APIMgtDBUtil.getStringFromInputStream(propertiesTargetStream);\n+                    Gson propertiesGson = new Gson();\n+                    JSONObject propertiesJson = propertiesGson.fromJson(properties, JSONObject.class);\n+                    workflow.setProperties(propertiesJson);\n+                } else {\n+                    JSONObject propertiesJson = new JSONObject();\n+                    workflow.setProperties(propertiesJson);\n+                }\n+                workflowsList.add(workflow);\n+            }\n+            workflows = workflowsList.toArray(new Workflow[workflowsList.size()]);\n+        } catch (SQLException e) {\n+            handleException(\"Error when retrieve all the workflow details. \" , e);\n+        } finally {\n+            APIMgtDBUtil.closeAllConnections(prepStmt, connection, rs);\n+        }\n+        return workflows;\n+    }\n+\n+    /**\n+     * Get the Pending workflow Request using ExternalWorkflowReference for a particular tenant\n+     * @param externelWorkflowRef of pending workflow request\n+     * @param status workflow status of workflow pending process\n+     * @param tenantDomain tenant domain of user\n+     * @return workflow pending request\n+     */\n+    public Workflow getworkflowReferenceByExternalWorkflowReferenceID(String externelWorkflowRef, String status ,\n+                                                                      String tenantDomain) throws APIManagementException {\n+\n+        Connection connection = null;\n+        PreparedStatement prepStmt = null;\n+        ResultSet rs = null;\n+        Workflow workflow = new Workflow();\n+        String sqlQuery = SQLConstants.GET_ALL_WORKFLOW_DETAILS_BY_EXTERNAL_WORKFLOW_REFERENCE;\n+        try {\n+            connection = APIMgtDBUtil.getConnection();\n+            prepStmt = connection.prepareStatement(sqlQuery);\n+            prepStmt.setString(1, externelWorkflowRef);\n+            prepStmt.setString(2, status);\n+            prepStmt.setString(3, tenantDomain);\n+            rs = prepStmt.executeQuery();\n+\n+            while (rs.next()) {\n+                workflow.setWorkflowId(rs.getInt(\"WF_ID\"));\n+                workflow.setWorkflowReference(rs.getString(\"WF_REFERENCE\"));\n+                workflow.setWorkflowType(rs.getString(\"WF_TYPE\"));\n+                String workflowstatus = rs.getString(\"WF_STATUS\");\n+                workflow.setStatus(org.wso2.carbon.apimgt.api.WorkflowStatus.valueOf(workflowstatus));\n+                workflow.setCreatedTime(rs.getTimestamp(\"WF_CREATED_TIME\").toString());\n+                workflow.setUpdatedTime(rs.getTimestamp(\"WF_UPDATED_TIME\").toString());\n+                workflow.setWorkflowDescription(rs.getString(\"WF_STATUS_DESC\"));\n+                workflow.setTenantId(rs.getInt(\"TENANT_ID\"));\n+                workflow.setTenantDomain(rs.getString(\"TENANT_DOMAIN\"));\n+                workflow.setExternalWorkflowReference(rs.getString(\"WF_EXTERNAL_REFERENCE\"));\n+                Blob metadataBlob = rs.getBlob(\"WF_METADATA\");\n+                Blob propertiesBlob = rs.getBlob(\"WF_PROPERTIES\");\n+\n+                byte[] metadataByte;\n+                if(metadataBlob != null) {\n+                    metadataByte = metadataBlob.getBytes(1L, (int) metadataBlob.length());\n+                    InputStream targetStream = new ByteArrayInputStream(metadataByte);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e39d9dd0e08d1e2758d83712db0496ca4b2312d4"}, "originalPosition": 266}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxODQ5ODkxOA==", "bodyText": "why cast null to blob?", "url": "https://github.com/wso2/carbon-apimgt/pull/8442#discussion_r418498918", "createdAt": "2020-05-01T10:54:40Z", "author": {"login": "chamilaadhi"}, "path": "components/apimgt/org.wso2.carbon.apimgt.impl/src/main/java/org/wso2/carbon/apimgt/impl/dao/ApiMgtDAO.java", "diffHunk": "@@ -5977,10 +5981,23 @@ public void addWorkflowEntry(WorkflowDTO workflow) throws APIManagementException\n             prepStmt.setString(7, workflow.getTenantDomain());\n             prepStmt.setString(8, workflow.getExternalWorkflowReference());\n \n-            prepStmt.execute();\n+            if(workflow.getMetadata() != null) {\n+                byte[] metadataByte = workflow.getMetadata().toJSONString().getBytes(\"UTF-8\");\n+                prepStmt.setBlob(9, new ByteArrayInputStream(metadataByte) );\n+            } else {\n+                prepStmt.setBlob(9, (Blob)null);\n+            }", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e39d9dd0e08d1e2758d83712db0496ca4b2312d4"}, "originalPosition": 37}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxODQ5ODk2OA==", "bodyText": "same here", "url": "https://github.com/wso2/carbon-apimgt/pull/8442#discussion_r418498968", "createdAt": "2020-05-01T10:54:51Z", "author": {"login": "chamilaadhi"}, "path": "components/apimgt/org.wso2.carbon.apimgt.impl/src/main/java/org/wso2/carbon/apimgt/impl/dao/ApiMgtDAO.java", "diffHunk": "@@ -5977,10 +5981,23 @@ public void addWorkflowEntry(WorkflowDTO workflow) throws APIManagementException\n             prepStmt.setString(7, workflow.getTenantDomain());\n             prepStmt.setString(8, workflow.getExternalWorkflowReference());\n \n-            prepStmt.execute();\n+            if(workflow.getMetadata() != null) {\n+                byte[] metadataByte = workflow.getMetadata().toJSONString().getBytes(\"UTF-8\");\n+                prepStmt.setBlob(9, new ByteArrayInputStream(metadataByte) );\n+            } else {\n+                prepStmt.setBlob(9, (Blob)null);\n+            }\n \n+            if(workflow.getProperties() != null) {\n+                byte[] propertiesByte = workflow.getProperties().toJSONString().getBytes(\"UTF-8\");\n+                prepStmt.setBlob(10, new ByteArrayInputStream(propertiesByte));\n+            } else {\n+                //prepStmt.setNull(10, java.sql.Types.BLOB);\n+                prepStmt.setBlob(10, (Blob)null);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e39d9dd0e08d1e2758d83712db0496ca4b2312d4"}, "originalPosition": 44}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDA0MTk3MDAz", "url": "https://github.com/wso2/carbon-apimgt/pull/8442#pullrequestreview-404197003", "createdAt": "2020-05-01T14:43:00Z", "commit": {"oid": "e39d9dd0e08d1e2758d83712db0496ca4b2312d4"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wMVQxNDo0MzowMVrOGPLm0A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wMVQxNDo0MzowMVrOGPLm0A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxODU3MTk4NA==", "bodyText": "Please format all your code.", "url": "https://github.com/wso2/carbon-apimgt/pull/8442#discussion_r418571984", "createdAt": "2020-05-01T14:43:01Z", "author": {"login": "bhathiya"}, "path": "components/apimgt/org.wso2.carbon.apimgt.impl/src/main/java/org/wso2/carbon/apimgt/impl/dao/ApiMgtDAO.java", "diffHunk": "@@ -5977,10 +5981,23 @@ public void addWorkflowEntry(WorkflowDTO workflow) throws APIManagementException\n             prepStmt.setString(7, workflow.getTenantDomain());\n             prepStmt.setString(8, workflow.getExternalWorkflowReference());\n \n-            prepStmt.execute();\n+            if(workflow.getMetadata() != null) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e39d9dd0e08d1e2758d83712db0496ca4b2312d4"}, "originalPosition": 32}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDA0MTk3NjIx", "url": "https://github.com/wso2/carbon-apimgt/pull/8442#pullrequestreview-404197621", "createdAt": "2020-05-01T14:44:05Z", "commit": {"oid": "e39d9dd0e08d1e2758d83712db0496ca4b2312d4"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wMVQxNDo0NDowNVrOGPLowQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wMVQxNDo0NDowNVrOGPLowQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxODU3MjQ4MQ==", "bodyText": "removed unwanted code", "url": "https://github.com/wso2/carbon-apimgt/pull/8442#discussion_r418572481", "createdAt": "2020-05-01T14:44:05Z", "author": {"login": "bhathiya"}, "path": "components/apimgt/org.wso2.carbon.apimgt.impl/src/main/java/org/wso2/carbon/apimgt/impl/workflow/APIStateChangeApprovalWorkflowExecutor.java", "diffHunk": "@@ -0,0 +1,224 @@\n+/*\n+ *  Copyright (c) 2020, WSO2 Inc. (http://www.wso2.org) All Rights Reserved.\n+ *\n+ *  WSO2 Inc. licenses this file to you under the Apache License,\n+ *  Version 2.0 (the \"License\"); you may not use this file except\n+ *  in compliance with the License.\n+ *  You may obtain a copy of the License at\n+ *\n+ *    http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing,\n+ * software distributed under the License is distributed on an\n+ * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n+ * KIND, either express or implied.  See the License for the\n+ * specific language governing permissions and limitations\n+ * under the License.\n+ */\n+package org.wso2.carbon.apimgt.impl.workflow;\n+\n+import org.apache.commons.logging.Log;\n+import org.apache.commons.logging.LogFactory;\n+import org.wso2.carbon.apimgt.api.APIManagementException;\n+import org.wso2.carbon.apimgt.api.WorkflowResponse;\n+import org.wso2.carbon.apimgt.api.model.APIIdentifier;\n+import org.wso2.carbon.apimgt.api.model.Workflow;\n+import org.wso2.carbon.apimgt.impl.APIConstants;\n+import org.wso2.carbon.apimgt.impl.dao.ApiMgtDAO;\n+import org.wso2.carbon.apimgt.impl.dto.WorkflowDTO;\n+import org.wso2.carbon.apimgt.impl.internal.ServiceReferenceHolder;\n+import org.wso2.carbon.apimgt.impl.utils.APIUtil;\n+import org.wso2.carbon.context.PrivilegedCarbonContext;\n+import org.wso2.carbon.governance.api.generic.dataobjects.GenericArtifact;\n+import org.wso2.carbon.registry.core.Registry;\n+import org.wso2.carbon.registry.core.exceptions.RegistryException;\n+import java.util.Collections;\n+import java.util.HashMap;\n+import java.util.List;\n+import java.util.Map;\n+import java.util.ArrayList;\n+\n+/**\n+ * Approval workflow for API state change.\n+ *\n+ */\n+public class APIStateChangeApprovalWorkflowExecutor extends WorkflowExecutor {\n+\n+    private static final Log log = LogFactory.getLog(APIStateChangeWSWorkflowExecutor.class);\n+    private String stateList;\n+\n+    public String getStateList() {\n+        return stateList;\n+    }\n+\n+    public void setStateList(String stateList) {\n+        this.stateList = stateList;\n+    }\n+\n+    @Override\n+    public String getWorkflowType() {\n+        return WorkflowConstants.WF_TYPE_AM_API_STATE;\n+    }\n+\n+    @Override\n+    public List<WorkflowDTO> getWorkflowDetails(String workflowStatus) throws WorkflowException {\n+        return Collections.emptyList();\n+    }\n+\n+    /**\n+     * Execute the API state change workflow approval process.\n+     *\n+     * @param workflowDTO\n+     */\n+    @Override\n+    public WorkflowResponse execute(WorkflowDTO workflowDTO) throws WorkflowException {\n+\n+        if (log.isDebugEnabled()) {\n+            log.debug(\"Executing API State change Workflow.\");\n+        }\n+        if (stateList != null) {\n+            Map<String, List<String>> stateActionMap = getSelectedStatesToApprove();\n+            APIStateWorkflowDTO apiStateWorkFlowDTO = (APIStateWorkflowDTO) workflowDTO;\n+\n+            if (stateActionMap.containsKey(apiStateWorkFlowDTO.getApiCurrentState().toUpperCase())\n+                    && stateActionMap.get(apiStateWorkFlowDTO.getApiCurrentState().toUpperCase())\n+                    .contains(apiStateWorkFlowDTO.getApiLCAction())) {\n+\n+                String callBackURL = apiStateWorkFlowDTO.getCallbackUrl();\n+                String message = \"Approval request for API state change action '\" + apiStateWorkFlowDTO.getApiLCAction()\n+                        + \"' from '\" + apiStateWorkFlowDTO.getApiCurrentState() + \"' state for the API '\"\n+                        + apiStateWorkFlowDTO.getApiName() + \" : \" + apiStateWorkFlowDTO.getApiVersion() + \"' by \"\n+                        + apiStateWorkFlowDTO.getApiProvider() + \"\";\n+                apiStateWorkFlowDTO.setWorkflowDescription(message);\n+                apiStateWorkFlowDTO.setMetadata(\"CurrentState\", apiStateWorkFlowDTO.getApiCurrentState());\n+                apiStateWorkFlowDTO.setMetadata(\"Action\", apiStateWorkFlowDTO.getApiLCAction());\n+                apiStateWorkFlowDTO.setMetadata(\"ApiName\", apiStateWorkFlowDTO.getApiName());\n+                apiStateWorkFlowDTO.setMetadata(\"ApiVersion\", apiStateWorkFlowDTO.getApiVersion());\n+                apiStateWorkFlowDTO.setMetadata(\"ApiProvider\", apiStateWorkFlowDTO.getApiProvider());\n+                apiStateWorkFlowDTO.setMetadata(\"Invoker\", apiStateWorkFlowDTO.getInvoker());\n+                apiStateWorkFlowDTO.setMetadata(\"TenantId\", String.valueOf(apiStateWorkFlowDTO.getTenantId()));\n+                super.execute(workflowDTO);\n+            } else {\n+                // For any other states, act as simple workflow executor.\n+                workflowDTO.setStatus(WorkflowStatus.APPROVED);\n+                // calling super.complete() instead of complete() to act as the simpleworkflow executor\n+                super.complete(workflowDTO);\n+            }\n+        } else {\n+            String msg = \"State change list is not provided. Please check <stateList> element in workflow-extensions.xml\";\n+            log.error(msg);\n+            throw new WorkflowException(msg);\n+        }\n+        return new GeneralWorkflowResponse();\n+    }\n+\n+    /**\n+     * Complete the API state change workflow approval process.\n+     *\n+     * @param workflowDTO\n+     */\n+    @Override\n+    public WorkflowResponse complete(WorkflowDTO workflowDTO) throws WorkflowException {\n+        if (log.isDebugEnabled()) {\n+            log.debug(\"Completing API State change Workflow..\");\n+        }\n+        workflowDTO.setUpdatedTime(System.currentTimeMillis());\n+        super.complete(workflowDTO);\n+        String externalWorkflowRef = workflowDTO.getExternalWorkflowReference();\n+        try {\n+            ApiMgtDAO apiMgtDAO = ApiMgtDAO.getInstance();\n+            Workflow workflow = apiMgtDAO.getworkflowReferenceByExternalWorkflowReference(externalWorkflowRef);\n+            String apiName = workflow.getMetadata(\"ApiName\");\n+            String action = workflow.getMetadata(\"Action\");\n+            String providerName = workflow.getMetadata(\"ApiProvider\");\n+            String version = workflow.getMetadata(\"ApiVersion\");\n+            String invoker = workflow.getMetadata(\"Invoker\");\n+            String currentStatus = workflow.getMetadata(\"CurrentState\");\n+            int tenantId = workflowDTO.getTenantId();\n+            //ApiMgtDAO apiMgtDAO = ApiMgtDAO.getInstance();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e39d9dd0e08d1e2758d83712db0496ca4b2312d4"}, "originalPosition": 138}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDA0MTk4MjUz", "url": "https://github.com/wso2/carbon-apimgt/pull/8442#pullrequestreview-404198253", "createdAt": "2020-05-01T14:45:07Z", "commit": {"oid": "e39d9dd0e08d1e2758d83712db0496ca4b2312d4"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wMVQxNDo0NTowN1rOGPLquQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wMVQxNDo0NTowN1rOGPLquQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxODU3Mjk4NQ==", "bodyText": "remove unused variables.", "url": "https://github.com/wso2/carbon-apimgt/pull/8442#discussion_r418572985", "createdAt": "2020-05-01T14:45:07Z", "author": {"login": "bhathiya"}, "path": "components/apimgt/org.wso2.carbon.apimgt.impl/src/main/java/org/wso2/carbon/apimgt/impl/workflow/ApplicationCreationApprovalWorkflowExecutor.java", "diffHunk": "@@ -0,0 +1,139 @@\n+/*\n+ *  Copyright (c) 2020, WSO2 Inc. (http://www.wso2.org) All Rights Reserved.\n+ *\n+ *  WSO2 Inc. licenses this file to you under the Apache License,\n+ *  Version 2.0 (the \"License\"); you may not use this file except\n+ *  in compliance with the License.\n+ *  You may obtain a copy of the License at\n+ *\n+ *    http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing,\n+ * software distributed under the License is distributed on an\n+ * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n+ * KIND, either express or implied.  See the License for the\n+ * specific language governing permissions and limitations\n+ * under the License.\n+ */\n+package org.wso2.carbon.apimgt.impl.workflow;\n+\n+import org.apache.commons.logging.Log;\n+import org.apache.commons.logging.LogFactory;\n+import org.wso2.carbon.apimgt.api.APIManagementException;\n+import org.wso2.carbon.apimgt.api.WorkflowResponse;\n+import org.wso2.carbon.apimgt.api.model.Application;\n+import org.wso2.carbon.apimgt.impl.APIConstants;\n+import org.wso2.carbon.apimgt.impl.dao.ApiMgtDAO;\n+import org.wso2.carbon.apimgt.impl.dto.ApplicationWorkflowDTO;\n+import org.wso2.carbon.apimgt.impl.dto.WorkflowDTO;\n+import java.util.List;\n+\n+/**\n+ * Approval workflow for Application Creation.\n+ *\n+ */\n+public class ApplicationCreationApprovalWorkflowExecutor extends WorkflowExecutor {\n+\n+    private static final Log log = LogFactory.getLog(ApplicationCreationApprovalWorkflowExecutor.class);\n+\n+    @Override\n+    public String getWorkflowType() {\n+        return WorkflowConstants.WF_TYPE_AM_APPLICATION_CREATION;\n+    }\n+\n+    /**\n+     * Execute the Application Creation workflow approval process.\n+     *\n+     * @param workflowDTO\n+     */\n+    @Override\n+    public WorkflowResponse execute(WorkflowDTO workflowDTO) throws WorkflowException {\n+        if (log.isDebugEnabled()) {\n+            log.debug(\"Executing Application creation Workflow.\");\n+        }\n+        ApplicationWorkflowDTO appWorkFlowDTO = (ApplicationWorkflowDTO) workflowDTO;\n+        Application application = appWorkFlowDTO.getApplication();\n+        String callBackURL = appWorkFlowDTO.getCallbackUrl();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e39d9dd0e08d1e2758d83712db0496ca4b2312d4"}, "originalPosition": 56}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f5092a934f4185d5efdcd67f1d1fcd92d3cc469e", "author": {"user": {"login": "SahanHerath", "name": "Sahan Herath"}}, "url": "https://github.com/wso2/carbon-apimgt/commit/f5092a934f4185d5efdcd67f1d1fcd92d3cc469e", "committedDate": "2020-05-04T05:35:33Z", "message": "Reformtted the ApimgtDAO.java and removed unwanted lines"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "8c8ee7e7dbcc0b398be64b519c170a4db969928a", "author": {"user": {"login": "SahanHerath", "name": "Sahan Herath"}}, "url": "https://github.com/wso2/carbon-apimgt/commit/8c8ee7e7dbcc0b398be64b519c170a4db969928a", "committedDate": "2020-05-04T05:48:11Z", "message": "Merge branch 'master' of https://github.com/wso2/carbon-apimgt"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "11f4fdac31bd45517ad16358bd9c42cd994ad95b", "author": {"user": {"login": "SahanHerath", "name": "Sahan Herath"}}, "url": "https://github.com/wso2/carbon-apimgt/commit/11f4fdac31bd45517ad16358bd9c42cd994ad95b", "committedDate": "2020-05-04T05:57:30Z", "message": "Merge pull request #2 from SahanHerath/master-workflow\n\nReformtted the ApimgtDAO.java and removed unwanted lines"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDA0NzU3NzE4", "url": "https://github.com/wso2/carbon-apimgt/pull/8442#pullrequestreview-404757718", "createdAt": "2020-05-04T07:28:09Z", "commit": {"oid": "11f4fdac31bd45517ad16358bd9c42cd994ad95b"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wNFQwNzoyODoxMFrOGP1Nmg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wNFQwNzoyODoxMFrOGP1Nmg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxOTI1MzY1OA==", "bodyText": "Use \"try with resources\" whenever possible. We can do the same functionality with less amount of code.", "url": "https://github.com/wso2/carbon-apimgt/pull/8442#discussion_r419253658", "createdAt": "2020-05-04T07:28:10Z", "author": {"login": "malinthaprasan"}, "path": "components/apimgt/org.wso2.carbon.apimgt.impl/src/main/java/org/wso2/carbon/apimgt/impl/dao/ApiMgtDAO.java", "diffHunk": "@@ -14723,4 +14739,246 @@ public String getUserID(String userName) throws APIManagementException {\n         }\n         return list;\n     }\n+\n+    /**\n+     * Remove the Pending workflow Requests using ExternalWorkflowReference\n+     *\n+     * @param workflowExtRef External Workflow Reference of Workflow Pending Request\n+     * @throws APIManagementException\n+     */\n+    public void deleteWorkflowRequest(String workflowExtRef) throws APIManagementException {\n+        Connection connection = null;\n+        PreparedStatement prepStmt = null;\n+        String query = SQLConstants.DELETE_WORKFLOW_REQUEST_SQL;\n+        try {\n+            connection = APIMgtDBUtil.getConnection();\n+            connection.setAutoCommit(false);\n+            prepStmt = connection.prepareStatement(query);\n+            prepStmt.setString(1, workflowExtRef);\n+            prepStmt.executeUpdate();\n+            connection.commit();\n+        } catch (SQLException e) {\n+            handleException(\"Failed to delete the workflow request. \", e);\n+        } finally {\n+            APIMgtDBUtil.closeAllConnections(prepStmt, connection, null);\n+        }", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "11f4fdac31bd45517ad16358bd9c42cd994ad95b"}, "originalPosition": 78}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDA0OTA2MDc3", "url": "https://github.com/wso2/carbon-apimgt/pull/8442#pullrequestreview-404906077", "createdAt": "2020-05-04T11:34:30Z", "commit": {"oid": "11f4fdac31bd45517ad16358bd9c42cd994ad95b"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wNFQxMTozNDozMFrOGP8dow==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wNFQxMTozNDozMFrOGP8dow==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxOTM3MjQ1MQ==", "bodyText": "It's good to use try with resources", "url": "https://github.com/wso2/carbon-apimgt/pull/8442#discussion_r419372451", "createdAt": "2020-05-04T11:34:30Z", "author": {"login": "malinthaprasan"}, "path": "components/apimgt/org.wso2.carbon.apimgt.impl/src/main/java/org/wso2/carbon/apimgt/impl/dao/ApiMgtDAO.java", "diffHunk": "@@ -14723,4 +14739,246 @@ public String getUserID(String userName) throws APIManagementException {\n         }\n         return list;\n     }\n+\n+    /**\n+     * Remove the Pending workflow Requests using ExternalWorkflowReference\n+     *\n+     * @param workflowExtRef External Workflow Reference of Workflow Pending Request\n+     * @throws APIManagementException\n+     */\n+    public void deleteWorkflowRequest(String workflowExtRef) throws APIManagementException {\n+        Connection connection = null;\n+        PreparedStatement prepStmt = null;\n+        String query = SQLConstants.DELETE_WORKFLOW_REQUEST_SQL;\n+        try {\n+            connection = APIMgtDBUtil.getConnection();\n+            connection.setAutoCommit(false);\n+            prepStmt = connection.prepareStatement(query);\n+            prepStmt.setString(1, workflowExtRef);\n+            prepStmt.executeUpdate();\n+            connection.commit();\n+        } catch (SQLException e) {\n+            handleException(\"Failed to delete the workflow request. \", e);\n+        } finally {\n+            APIMgtDBUtil.closeAllConnections(prepStmt, connection, null);\n+        }\n+    }\n+\n+    /**\n+     * Get the Pending workflow Request using ExternalWorkflowReference\n+     *\n+     * @param externalWorkflowRef\n+     * @return workflow pending request\n+     * @throws APIManagementException\n+     */\n+    public Workflow getworkflowReferenceByExternalWorkflowReference(String externalWorkflowRef) throws APIManagementException {\n+\n+        Connection connection = null;\n+        PreparedStatement prepStmt = null;\n+        ResultSet rs = null;\n+        Workflow workflow = new Workflow();\n+        String sqlQuery = SQLConstants.GET_ALL_WORKFLOW_DETAILS_BY_EXTERNALWORKFLOWREF;\n+        try {\n+            connection = APIMgtDBUtil.getConnection();\n+            prepStmt = connection.prepareStatement(sqlQuery);\n+            prepStmt.setString(1, externalWorkflowRef);\n+            rs = prepStmt.executeQuery();\n+\n+            while (rs.next()) {\n+                workflow.setWorkflowId(rs.getInt(\"WF_ID\"));\n+                workflow.setWorkflowReference(rs.getString(\"WF_REFERENCE\"));\n+                workflow.setWorkflowType(rs.getString(\"WF_TYPE\"));\n+                String workflowstatus = rs.getString(\"WF_STATUS\");\n+                workflow.setStatus(org.wso2.carbon.apimgt.api.WorkflowStatus.valueOf(workflowstatus));\n+                workflow.setCreatedTime(rs.getTimestamp(\"WF_CREATED_TIME\").toString());\n+                workflow.setUpdatedTime(rs.getTimestamp(\"WF_UPDATED_TIME\").toString());\n+                workflow.setWorkflowStatusDesc(rs.getString(\"WF_STATUS_DESC\"));\n+                workflow.setTenantId(rs.getInt(\"TENANT_ID\"));\n+                workflow.setTenantDomain(rs.getString(\"TENANT_DOMAIN\"));\n+                workflow.setExternalWorkflowReference(rs.getString(\"WF_EXTERNAL_REFERENCE\"));\n+                Blob metadatablob = rs.getBlob(\"WF_METADATA\");\n+\n+                byte[] metadataByte;\n+                if (metadatablob != null) {\n+                    metadataByte = metadatablob.getBytes(1L, (int) metadatablob.length());\n+                    InputStream targetStream = new ByteArrayInputStream(metadataByte);\n+                    String metadata = APIMgtDBUtil.getStringFromInputStream(targetStream);\n+                    Gson metadataGson = new Gson();\n+                    JSONObject metadataJson = metadataGson.fromJson(metadata, JSONObject.class);\n+                    workflow.setMetadata(metadataJson);\n+                } else {\n+                    JSONObject metadataJson = new JSONObject();\n+                    workflow.setMetadata(metadataJson);\n+                }\n+            }\n+        } catch (SQLException e) {\n+            handleException(\"Error when retriving the workflow details. \", e);\n+        } finally {\n+            APIMgtDBUtil.closeAllConnections(prepStmt, connection, rs);\n+        }\n+        return workflow;\n+    }\n+\n+    /**\n+     * Get the Pending workflow Requests using WorkflowType for a particular tenant\n+     *\n+     * @param workflowType Type of the workflow pending request\n+     * @param status       workflow status of workflow pending request\n+     * @param tenantDomain tenantDomain of the user\n+     * @return List of workflow pending request\n+     * @throws APIManagementException\n+     */\n+    public Workflow[] getworkflows(String workflowType, String status, String tenantDomain) throws APIManagementException {\n+\n+        Connection connection = null;\n+        PreparedStatement prepStmt = null;\n+        ResultSet rs = null;\n+        Workflow[] workflows = null;\n+        String sqlQuery;\n+        if (workflowType != null) {\n+            sqlQuery = SQLConstants.GET_ALL_WORKFLOW_DETAILS_BY_WORKFLOW_TYPE;\n+        } else {\n+            sqlQuery = SQLConstants.GET_ALL_WORKFLOW_DETAILS;\n+        }\n+        try {\n+            connection = APIMgtDBUtil.getConnection();\n+            prepStmt = connection.prepareStatement(sqlQuery);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "11f4fdac31bd45517ad16358bd9c42cd994ad95b"}, "originalPosition": 159}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDA1NDk1ODYx", "url": "https://github.com/wso2/carbon-apimgt/pull/8442#pullrequestreview-405495861", "createdAt": "2020-05-05T05:11:49Z", "commit": {"oid": "11f4fdac31bd45517ad16358bd9c42cd994ad95b"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wNVQwNToxMTo0OVrOGQapFQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wNVQwNToxMTo0OVrOGQapFQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxOTg2NjkwMQ==", "bodyText": "Use <verb>_<action> format.\nEG:\napim:api_workflow_view", "url": "https://github.com/wso2/carbon-apimgt/pull/8442#discussion_r419866901", "createdAt": "2020-05-05T05:11:49Z", "author": {"login": "malinthaprasan"}, "path": "components/apimgt/org.wso2.carbon.apimgt.rest.api.admin/src/main/resources/admin-api.yaml", "diffHunk": "@@ -2521,17 +2521,151 @@ paths:\n             $ref: '#/definitions/MonetizationUsagePublishInfo'\n \n ######################################################\n-  # The \"Workflow approval\" resource API\n-  ######################################################\n+# The \"Workflow Collection\" resource APIs\n+######################################################\n+  '/workflows':\n+\n+#---------------------------------------------------\n+# Retrieve a list of all workflow pending processes\n+#---------------------------------------------------\n+    get:\n+      x-scope: apim:api_workflow", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "11f4fdac31bd45517ad16358bd9c42cd994ad95b"}, "originalPosition": 14}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDA1NDk2MDgy", "url": "https://github.com/wso2/carbon-apimgt/pull/8442#pullrequestreview-405496082", "createdAt": "2020-05-05T05:12:44Z", "commit": {"oid": "11f4fdac31bd45517ad16358bd9c42cd994ad95b"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wNVQwNToxMjo0NFrOGQap2w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wNVQwNToxMjo0NFrOGQap2w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxOTg2NzA5OQ==", "bodyText": "apim:api_workflow_view", "url": "https://github.com/wso2/carbon-apimgt/pull/8442#discussion_r419867099", "createdAt": "2020-05-05T05:12:44Z", "author": {"login": "malinthaprasan"}, "path": "components/apimgt/org.wso2.carbon.apimgt.rest.api.admin/src/main/resources/admin-api.yaml", "diffHunk": "@@ -2521,17 +2521,151 @@ paths:\n             $ref: '#/definitions/MonetizationUsagePublishInfo'\n \n ######################################################\n-  # The \"Workflow approval\" resource API\n-  ######################################################\n+# The \"Workflow Collection\" resource APIs\n+######################################################\n+  '/workflows':\n+\n+#---------------------------------------------------\n+# Retrieve a list of all workflow pending processes\n+#---------------------------------------------------\n+    get:\n+      x-scope: apim:api_workflow\n+      x-wso2-request: |\n+        GET https://localhost:9443/api/am/admin/v0.16/workflows\n+        Authorization: Bearer ae4eae22-3f65-387b-a171-d37eaa366fa8\n+      x-wso2-curl: \"curl -k -H \\\"Authorization: Bearer ae4eae22-3f65-387b-a171-d37eaa366fa8\\\" \\\"https://localhost:9443/api/am/admin/v0.16/workflows\\\"\"\n+      x-wso2-response: \"HTTP/1.1 200 OK\\nContent-Type: application/json\\n\\n{\\n   \\\"previous\\\": \\\"\\\",\\n   \\\"list\\\":    [\\n            {\\n    \\\"WF_TYPE\\\": \\\"AM_APPLICATION_CREATION\\\",\\n         \\\"WF_STATUS\\\": \\\"APPROVED\\\",\\n         \\\"WF_CREATED_TIME\\\": \\\"  2020-02-10 09:33:34.476\\\"\\n    \\\"WF_UPDATED_TIME\\\": \\\"  2020-02-10 09:33:34.476\\\"\\n    \\\"WF_STATUS_DESC\\\": \\\"  Approve workflow request\\\"\\n   \\\"TENANT_ID\\\": \\\"-1234\\\",\\n  \\\"TENANT_DOMAIN\\\": \\\"carbon.super\\\",\\n  \\\"WF_EXTERNAL_REFERENCE\\\": \\\"5871244b-d6f3-466e-8995-8accd1e64303\\\",\\n  \\\"PAYLOAD\\\": \\\"7b2263616c6c4261636b55524c22\\\",\\n },\\n  {\\n         \\\"WF_ID\\\": \\\"\\\",\\n         \\\"WF_REFERENCE\\\": \\\"ABBA\\\",\\n           \\\"WF_TYPE\\\": \\\"AM_APPLICATION_CREATION\\\",\\n         \\\"WF_STATUS\\\": \\\"APPROVED\\\",\\n         \\\"WF_CREATED_TIME\\\": \\\"  2020-01-10 09:32:34.476\\\"\\n    \\\"WF_UPDATED_TIME\\\": \\\"  2020-03-12 09:34:34.476\\\"\\n    \\\"WF_STATUS_DESC\\\": \\\"  Approve workflow request\\\"\\n   \\\"TENANT_ID\\\": \\\"-1234\\\",\\n  \\\"TENANT_DOMAIN\\\": \\\"carbon.super\\\",\\n  \\\"WF_EXTERNAL_REFERENCE\\\": \\\"5871244b-d6f3-466e-8922-8accd1e64303\\\",\\n  \\\"PAYLOAD\\\": \\\"7b226170694e616d65223a2253616\\\",\\n }          \"\n+      summary: |\n+        Retrieve All pending workflow processes\n+      description: |\n+        This operation can be used to retrieve list of workflow pending processes.\n+      parameters:\n+\n+        - $ref: '#/parameters/limit'\n+        - $ref: '#/parameters/offset'\n+        - $ref: '#/parameters/Accept'\n+        - $ref: '#/parameters/If-None-Match'\n+        - name: workflowType\n+          in: query\n+          description: |\n+            We need to show the values of each workflow process separately .for that we use workflow type.\n+            Workflow type can be AM_APPLICATION_CREATION, AM_SUBSCRIPTION_CREATION,   AM_USER_SIGNUP, AM_APPLICATION_REGISTRATION_PRODUCTION, AM_APPLICATION_REGISTRATION_SANDBOX.\n+          required: false\n+          type: string\n+          enum:\n+            - AM_APPLICATION_CREATION\n+            - AM_SUBSCRIPTION_CREATION\n+            - AM_USER_SIGNUP\n+            - AM_APPLICATION_REGISTRATION_PRODUCTION\n+            - AM_APPLICATION_REGISTRATION_SANDBOX\n+            - AM_SUBSCRIPTION_DELETION\n+            - AM_APPLICATION_DELETION\n+            - AM_API_STATE\n+      tags:\n+        - Workflow (Collection)\n+      responses:\n+        200:\n+          description: |\n+            OK.\n+            Workflow pendding process list returned.\n+          schema:\n+            $ref: '#/definitions/WorkflowList'\n+          headers:\n+            Content-Type:\n+              description: |\n+                The content type of the body.\n+              type: string\n+        404:\n+          description: |\n+            Not Found.\n+            Requested user does not exist.\n+          schema:\n+            $ref: '#/definitions/Error'\n+\n+\n+        304:\n+          description: |\n+            Not Modified.\n+            Empty body because the client has already the latest version of the requested resource (Will be supported in future).\n+        400:\n+          description: |\n+            Bad Request.\n+            Invalid request or validation error.\n+          schema:\n+            $ref: '#/definitions/Error'\n+        406:\n+          description: |\n+            Not Acceptable.\n+            The requested media type is not supported.\n+          schema:\n+            $ref: '#/definitions/Error'\n+  #----------------------------------------------------------------\n+  # Retrieve workflow requests according to the external reference\n+  #----------------------------------------------------------------\n+  '/workflows/{externalWorkflowRef}':\n+\n+    #-----------------------------------------------------\n+    # Retrieve the Details of a workflow pendding process\n+    #-----------------------------------------------------\n+    get:\n+      x-scope: apim:api_workflow", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "11f4fdac31bd45517ad16358bd9c42cd994ad95b"}, "originalPosition": 93}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDA1NDk2MjQw", "url": "https://github.com/wso2/carbon-apimgt/pull/8442#pullrequestreview-405496240", "createdAt": "2020-05-05T05:13:19Z", "commit": {"oid": "11f4fdac31bd45517ad16358bd9c42cd994ad95b"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wNVQwNToxMzoyMFrOGQaqWQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wNVQwNToxMzoyMFrOGQaqWQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxOTg2NzIyNQ==", "bodyText": "x-scope: apim:api_workflow_approve", "url": "https://github.com/wso2/carbon-apimgt/pull/8442#discussion_r419867225", "createdAt": "2020-05-05T05:13:20Z", "author": {"login": "malinthaprasan"}, "path": "components/apimgt/org.wso2.carbon.apimgt.rest.api.admin/src/main/resources/admin-api.yaml", "diffHunk": "@@ -2521,17 +2521,151 @@ paths:\n             $ref: '#/definitions/MonetizationUsagePublishInfo'\n \n ######################################################\n-  # The \"Workflow approval\" resource API\n-  ######################################################\n+# The \"Workflow Collection\" resource APIs\n+######################################################\n+  '/workflows':\n+\n+#---------------------------------------------------\n+# Retrieve a list of all workflow pending processes\n+#---------------------------------------------------\n+    get:\n+      x-scope: apim:api_workflow\n+      x-wso2-request: |\n+        GET https://localhost:9443/api/am/admin/v0.16/workflows\n+        Authorization: Bearer ae4eae22-3f65-387b-a171-d37eaa366fa8\n+      x-wso2-curl: \"curl -k -H \\\"Authorization: Bearer ae4eae22-3f65-387b-a171-d37eaa366fa8\\\" \\\"https://localhost:9443/api/am/admin/v0.16/workflows\\\"\"\n+      x-wso2-response: \"HTTP/1.1 200 OK\\nContent-Type: application/json\\n\\n{\\n   \\\"previous\\\": \\\"\\\",\\n   \\\"list\\\":    [\\n            {\\n    \\\"WF_TYPE\\\": \\\"AM_APPLICATION_CREATION\\\",\\n         \\\"WF_STATUS\\\": \\\"APPROVED\\\",\\n         \\\"WF_CREATED_TIME\\\": \\\"  2020-02-10 09:33:34.476\\\"\\n    \\\"WF_UPDATED_TIME\\\": \\\"  2020-02-10 09:33:34.476\\\"\\n    \\\"WF_STATUS_DESC\\\": \\\"  Approve workflow request\\\"\\n   \\\"TENANT_ID\\\": \\\"-1234\\\",\\n  \\\"TENANT_DOMAIN\\\": \\\"carbon.super\\\",\\n  \\\"WF_EXTERNAL_REFERENCE\\\": \\\"5871244b-d6f3-466e-8995-8accd1e64303\\\",\\n  \\\"PAYLOAD\\\": \\\"7b2263616c6c4261636b55524c22\\\",\\n },\\n  {\\n         \\\"WF_ID\\\": \\\"\\\",\\n         \\\"WF_REFERENCE\\\": \\\"ABBA\\\",\\n           \\\"WF_TYPE\\\": \\\"AM_APPLICATION_CREATION\\\",\\n         \\\"WF_STATUS\\\": \\\"APPROVED\\\",\\n         \\\"WF_CREATED_TIME\\\": \\\"  2020-01-10 09:32:34.476\\\"\\n    \\\"WF_UPDATED_TIME\\\": \\\"  2020-03-12 09:34:34.476\\\"\\n    \\\"WF_STATUS_DESC\\\": \\\"  Approve workflow request\\\"\\n   \\\"TENANT_ID\\\": \\\"-1234\\\",\\n  \\\"TENANT_DOMAIN\\\": \\\"carbon.super\\\",\\n  \\\"WF_EXTERNAL_REFERENCE\\\": \\\"5871244b-d6f3-466e-8922-8accd1e64303\\\",\\n  \\\"PAYLOAD\\\": \\\"7b226170694e616d65223a2253616\\\",\\n }          \"\n+      summary: |\n+        Retrieve All pending workflow processes\n+      description: |\n+        This operation can be used to retrieve list of workflow pending processes.\n+      parameters:\n+\n+        - $ref: '#/parameters/limit'\n+        - $ref: '#/parameters/offset'\n+        - $ref: '#/parameters/Accept'\n+        - $ref: '#/parameters/If-None-Match'\n+        - name: workflowType\n+          in: query\n+          description: |\n+            We need to show the values of each workflow process separately .for that we use workflow type.\n+            Workflow type can be AM_APPLICATION_CREATION, AM_SUBSCRIPTION_CREATION,   AM_USER_SIGNUP, AM_APPLICATION_REGISTRATION_PRODUCTION, AM_APPLICATION_REGISTRATION_SANDBOX.\n+          required: false\n+          type: string\n+          enum:\n+            - AM_APPLICATION_CREATION\n+            - AM_SUBSCRIPTION_CREATION\n+            - AM_USER_SIGNUP\n+            - AM_APPLICATION_REGISTRATION_PRODUCTION\n+            - AM_APPLICATION_REGISTRATION_SANDBOX\n+            - AM_SUBSCRIPTION_DELETION\n+            - AM_APPLICATION_DELETION\n+            - AM_API_STATE\n+      tags:\n+        - Workflow (Collection)\n+      responses:\n+        200:\n+          description: |\n+            OK.\n+            Workflow pendding process list returned.\n+          schema:\n+            $ref: '#/definitions/WorkflowList'\n+          headers:\n+            Content-Type:\n+              description: |\n+                The content type of the body.\n+              type: string\n+        404:\n+          description: |\n+            Not Found.\n+            Requested user does not exist.\n+          schema:\n+            $ref: '#/definitions/Error'\n+\n+\n+        304:\n+          description: |\n+            Not Modified.\n+            Empty body because the client has already the latest version of the requested resource (Will be supported in future).\n+        400:\n+          description: |\n+            Bad Request.\n+            Invalid request or validation error.\n+          schema:\n+            $ref: '#/definitions/Error'\n+        406:\n+          description: |\n+            Not Acceptable.\n+            The requested media type is not supported.\n+          schema:\n+            $ref: '#/definitions/Error'\n+  #----------------------------------------------------------------\n+  # Retrieve workflow requests according to the external reference\n+  #----------------------------------------------------------------\n+  '/workflows/{externalWorkflowRef}':\n+\n+    #-----------------------------------------------------\n+    # Retrieve the Details of a workflow pendding process\n+    #-----------------------------------------------------\n+    get:\n+      x-scope: apim:api_workflow\n+      x-wso2-curl: \"curl https://localhost:9443/api/am/admin/v0.16/workflows/c43a325c-260b-4302-81cb-768eafaa3aed\"\n+      x-wso2-curl-tenant: \"curl -k -H \\\"X-WSO2-Tenant:test.com\\\" https://localhost:9443/api/am/admin/v0.16/workflows/c43a325c-260b-4302-81cb-768eafaa3aed\"\n+      x-wso2-request: |\n+        GET https://localhost:9443/api/am/admin/v0.16/workflows/c43a325c-260b-4302-81cb-768eafaa3aed\n+      x-wso2-response: \"HTTP/1.1 200 OK\\nContent-Type: application/json\\n\\n{\\n   \\\"previous\\\": \\\"\\\",\\n   \\\"list\\\":    [\\n            {\\n                 \\\"WF_TYPE\\\": \\\"AM_APPLICATION_CREATION\\\",\\n         \\\"WF_STATUS\\\": \\\"APPROVED\\\",\\n         \\\"WF_CREATED_TIME\\\": \\\"  2020-02-10 09:33:34.476\\\"\\n    \\\"WF_UPDATED_TIME\\\": \\\"  2020-02-10 09:33:34.476\\\"\\n    \\\"WF_STATUS_DESC\\\": \\\"  Approve workflow request\\\"\\n   \\\"TENANT_ID\\\": \\\"-1234\\\",\\n  \\\"TENANT_DOMAIN\\\": \\\"carbon.super\\\",\\n  \\\"WF_EXTERNAL_REFERENCE\\\": \\\"5871244b-d6f3-466e-8995-8accd1e64303\\\",\\n  \\\"PAYLOAD\\\": \\\"7b2263616c6c4261636b55524c22\\\",\\n } \"\n+      summary: |\n+        Get details of a the pending workflow request according to the External Workflow Reference.\n+      description: |\n+        Using this operation, you can retrieve complete details of a pending workflow request that either belongs to application creation, application subscription, application registration, api state change, user self sign up.. You need to provide the External_Workflow_Reference of the workflow Request to retrive it.\n+\n+      parameters:\n+        - name: externalWorkflowRef\n+          in: path\n+          description: |\n+            from the externel workflow reference we decide what is the the pending request that the are requesting.\n+          required: true\n+          type: string\n+        - $ref: '#/parameters/If-None-Match'\n+      tags:\n+        - Workflows (Individual)\n+      responses:\n+        200:\n+          description: |\n+            OK.\n+            Requested Workflow Pending is returned\n+          schema:\n+            $ref: '#/definitions/WorkflowInfo'\n+\n+        304:\n+          description: |\n+            Not Modified.\n+            Empty body because the client has already the latest version of the requested resource.\n+        404:\n+          description: |\n+            Not Found.\n+            Requested workflow pendding process does not exist.\n+          schema:\n+            $ref: '#/definitions/Error'\n+        406:\n+          description: |\n+            Not Acceptable.\n+            The requested media type is not supported\n+          schema:\n+            $ref: '#/definitions/Error'\n+\n+######################################################\n+# The \"Workflow approval\" resource API\n+######################################################\n   /workflows/update-workflow-status:\n \n-    #-------------------------------------------------------------------\n-    # Resume the workflow by approving or rejecting the workflow request\n-    #-------------------------------------------------------------------\n+#-------------------------------------------------------------------\n+# Resume the workflow by approving or rejecting the workflow request\n+#-------------------------------------------------------------------\n     post:\n       x-scope: apim:api_workflow", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "11f4fdac31bd45517ad16358bd9c42cd994ad95b"}, "originalPosition": 151}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f1a1001b2e734b2b39fc5e80c29ce693a0b71289", "author": {"user": {"login": "SahanHerath", "name": "Sahan Herath"}}, "url": "https://github.com/wso2/carbon-apimgt/commit/f1a1001b2e734b2b39fc5e80c29ce693a0b71289", "committedDate": "2020-05-05T12:04:15Z", "message": "changed for try with resources"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "9009ab098fd0d879226113ff503a8e2405714c71", "author": {"user": {"login": "SahanHerath", "name": "Sahan Herath"}}, "url": "https://github.com/wso2/carbon-apimgt/commit/9009ab098fd0d879226113ff503a8e2405714c71", "committedDate": "2020-05-05T12:50:31Z", "message": "Merge branch 'master' of https://github.com/wso2/carbon-apimgt\n\n\u0001 Conflicts:\n\u0001\tcomponents/apimgt/org.wso2.carbon.apimgt.impl/src/main/java/org/wso2/carbon/apimgt/impl/dao/ApiMgtDAO.java"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "0ea49a0ddedff20f6bcc1ba1fb4a1bc1dbe0395a", "author": {"user": {"login": "SahanHerath", "name": "Sahan Herath"}}, "url": "https://github.com/wso2/carbon-apimgt/commit/0ea49a0ddedff20f6bcc1ba1fb4a1bc1dbe0395a", "committedDate": "2020-05-05T13:03:48Z", "message": "Merge branch 'master' of https://github.com/wso2/carbon-apimgt"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b24a5e295b624256bb18071f3f6dedc8e5aac2df", "author": {"user": {"login": "SahanHerath", "name": "Sahan Herath"}}, "url": "https://github.com/wso2/carbon-apimgt/commit/b24a5e295b624256bb18071f3f6dedc8e5aac2df", "committedDate": "2020-05-05T13:47:13Z", "message": "Merge branch 'master' of https://github.com/SahanHerath/carbon-apimgt"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b93d62437b06910fc51cca4a40df87130b0472c0", "author": {"user": {"login": "SahanHerath", "name": "Sahan Herath"}}, "url": "https://github.com/wso2/carbon-apimgt/commit/b93d62437b06910fc51cca4a40df87130b0472c0", "committedDate": "2020-05-05T14:15:27Z", "message": "Merge pull request #3 from SahanHerath/master-workflow\n\nchanged for try with resources"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "edf999e0fbffb180bc4974d2340d782039f75deb", "author": {"user": {"login": "SahanHerath", "name": "Sahan Herath"}}, "url": "https://github.com/wso2/carbon-apimgt/commit/edf999e0fbffb180bc4974d2340d782039f75deb", "committedDate": "2020-05-05T22:12:10Z", "message": "Merge branch 'master-workflow' of https://github.com/wso2/carbon-apimgt into master-workflow"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "97294a043a675ef993c7dfd596a6f51ca2391d7d", "author": {"user": {"login": "SahanHerath", "name": "Sahan Herath"}}, "url": "https://github.com/wso2/carbon-apimgt/commit/97294a043a675ef993c7dfd596a6f51ca2391d7d", "committedDate": "2020-05-05T22:18:53Z", "message": "Changed the name of the scopes of apim:api_workflow to apim:api_workflow_view and apim:api_workflow_approve"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b398af958f84861480eecf1660cdea67b76f11bd", "author": {"user": {"login": "SahanHerath", "name": "Sahan Herath"}}, "url": "https://github.com/wso2/carbon-apimgt/commit/b398af958f84861480eecf1660cdea67b76f11bd", "committedDate": "2020-05-05T22:37:04Z", "message": "Merge pull request #4 from SahanHerath/master-workflow\n\nMaster workflow"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "dbe9c2473fffb9e5a5709af3c4230a8b8970cdd3", "author": {"user": {"login": "SahanHerath", "name": "Sahan Herath"}}, "url": "https://github.com/wso2/carbon-apimgt/commit/dbe9c2473fffb9e5a5709af3c4230a8b8970cdd3", "committedDate": "2020-06-01T10:43:24Z", "message": "Merge branch 'master' of https://github.com/wso2/carbon-apimgt\n\n\u0001 Conflicts:\n\u0001\tcomponents/apimgt/org.wso2.carbon.apimgt.impl/src/main/java/org/wso2/carbon/apimgt/impl/APIAdminImpl.java\n\u0001\tcomponents/apimgt/org.wso2.carbon.apimgt.impl/src/main/java/org/wso2/carbon/apimgt/impl/dao/ApiMgtDAO.java\n\u0001\tcomponents/apimgt/org.wso2.carbon.apimgt.impl/src/main/resources/workflowextensions/default-workflow-extensions.xml"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "0cc202fec18c9060526fd767ee6e07c54a44bea9", "author": {"user": {"login": "SahanHerath", "name": "Sahan Herath"}}, "url": "https://github.com/wso2/carbon-apimgt/commit/0cc202fec18c9060526fd767ee6e07c54a44bea9", "committedDate": "2020-06-02T07:52:40Z", "message": "Updated the rest apis to v1"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "6182365aaf3738b9567cae7641e45319401774d3", "author": {"user": {"login": "SahanHerath", "name": "Sahan Herath"}}, "url": "https://github.com/wso2/carbon-apimgt/commit/6182365aaf3738b9567cae7641e45319401774d3", "committedDate": "2020-06-03T12:16:42Z", "message": "Removed admin rest api from v0.16 and added"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "5d1abdefa19221e04be9175dc92a619efc4a5492", "author": {"user": {"login": "SahanHerath", "name": "Sahan Herath"}}, "url": "https://github.com/wso2/carbon-apimgt/commit/5d1abdefa19221e04be9175dc92a619efc4a5492", "committedDate": "2020-06-03T12:29:43Z", "message": "Merge branch 'master' of https://github.com/wso2/carbon-apimgt\n\n\u0001 Conflicts:\n\u0001\tcomponents/apimgt/org.wso2.carbon.apimgt.api/src/main/java/org/wso2/carbon/apimgt/api/APIAdmin.java\n\u0001\tcomponents/apimgt/org.wso2.carbon.apimgt.impl/src/main/java/org/wso2/carbon/apimgt/impl/APIAdminImpl.java\n\u0001\tcomponents/apimgt/org.wso2.carbon.apimgt.impl/src/main/java/org/wso2/carbon/apimgt/impl/dao/ApiMgtDAO.java\n\u0001\tcomponents/apimgt/org.wso2.carbon.apimgt.rest.api.admin.v1/src/main/resources/admin-api.yaml\n\u0001\tcomponents/apimgt/org.wso2.carbon.apimgt.rest.api.admin/src/main/resources/admin-api.yaml\n\u0001\tcomponents/apimgt/org.wso2.carbon.apimgt.rest.api.util/src/main/resources/admin-api.json"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c9ec7878b7f93f97c41771b752352fb4eb2672f9", "author": {"user": {"login": "SahanHerath", "name": "Sahan Herath"}}, "url": "https://github.com/wso2/carbon-apimgt/commit/c9ec7878b7f93f97c41771b752352fb4eb2672f9", "committedDate": "2020-06-03T13:25:10Z", "message": "Merge branch 'master' of https://github.com/wso2/carbon-apimgt"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDIzNTgyMDIy", "url": "https://github.com/wso2/carbon-apimgt/pull/8442#pullrequestreview-423582022", "createdAt": "2020-06-03T13:59:33Z", "commit": {"oid": "5d1abdefa19221e04be9175dc92a619efc4a5492"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wM1QxMzo1OTozM1rOGedMkg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wM1QxMzo1OTozM1rOGedMkg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNDU4ODgxOA==", "bodyText": "lets use camelcase", "url": "https://github.com/wso2/carbon-apimgt/pull/8442#discussion_r434588818", "createdAt": "2020-06-03T13:59:33Z", "author": {"login": "chamilaadhi"}, "path": "components/apimgt/org.wso2.carbon.apimgt.impl/src/main/java/org/wso2/carbon/apimgt/impl/workflow/ApplicationCreationApprovalWorkflowExecutor.java", "diffHunk": "@@ -0,0 +1,141 @@\n+/*\n+ *  Copyright (c) 2020, WSO2 Inc. (http://www.wso2.org) All Rights Reserved.\n+ *\n+ *  WSO2 Inc. licenses this file to you under the Apache License,\n+ *  Version 2.0 (the \"License\"); you may not use this file except\n+ *  in compliance with the License.\n+ *  You may obtain a copy of the License at\n+ *\n+ *    http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing,\n+ * software distributed under the License is distributed on an\n+ * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n+ * KIND, either express or implied.  See the License for the\n+ * specific language governing permissions and limitations\n+ * under the License.\n+ */\n+package org.wso2.carbon.apimgt.impl.workflow;\n+\n+import org.apache.commons.logging.Log;\n+import org.apache.commons.logging.LogFactory;\n+import org.wso2.carbon.apimgt.api.APIManagementException;\n+import org.wso2.carbon.apimgt.api.WorkflowResponse;\n+import org.wso2.carbon.apimgt.api.model.Application;\n+import org.wso2.carbon.apimgt.impl.APIConstants;\n+import org.wso2.carbon.apimgt.impl.dao.ApiMgtDAO;\n+import org.wso2.carbon.apimgt.impl.dto.ApplicationWorkflowDTO;\n+import org.wso2.carbon.apimgt.impl.dto.WorkflowDTO;\n+\n+import java.util.List;\n+\n+/**\n+ * Approval workflow for Application Creation.\n+ */\n+public class ApplicationCreationApprovalWorkflowExecutor extends WorkflowExecutor {\n+\n+    private static final Log log = LogFactory.getLog(ApplicationCreationApprovalWorkflowExecutor.class);\n+\n+    @Override\n+    public String getWorkflowType() {\n+        return WorkflowConstants.WF_TYPE_AM_APPLICATION_CREATION;\n+    }\n+\n+    /**\n+     * Execute the Application Creation workflow approval process.\n+     *\n+     * @param workflowDTO\n+     */\n+    @Override\n+    public WorkflowResponse execute(WorkflowDTO workflowDTO) throws WorkflowException {\n+        if (log.isDebugEnabled()) {\n+            log.debug(\"Executing Application creation Workflow.\");\n+        }\n+        ApplicationWorkflowDTO appWorkFlowDTO = (ApplicationWorkflowDTO) workflowDTO;\n+        Application application = appWorkFlowDTO.getApplication();\n+        String message = \"Approve application \" + application.getName() + \" creation request from application creator -\"\n+                + appWorkFlowDTO.getUserName() + \" with throttling tier - \" + application.getTier();\n+        workflowDTO.setWorkflowDescription(message);\n+        workflowDTO.setProperties(\"ApplicationName\", application.getName());\n+        workflowDTO.setProperties(\"UserName\", appWorkFlowDTO.getUserName());\n+        workflowDTO.setProperties(\"ApplicationTier\", application.getTier());", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "5d1abdefa19221e04be9175dc92a619efc4a5492"}, "originalPosition": 61}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "db4c6247a4bd640b55ff7ea7268e6c2ee7675941", "author": {"user": {"login": "SahanHerath", "name": "Sahan Herath"}}, "url": "https://github.com/wso2/carbon-apimgt/commit/db4c6247a4bd640b55ff7ea7268e6c2ee7675941", "committedDate": "2020-06-03T14:40:09Z", "message": "Merge branch 'master' of https://github.com/wso2/carbon-apimgt"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a4896c4b36ab90b45e6b6f51818183351ad77cf0", "author": {"user": {"login": "SahanHerath", "name": "Sahan Herath"}}, "url": "https://github.com/wso2/carbon-apimgt/commit/a4896c4b36ab90b45e6b6f51818183351ad77cf0", "committedDate": "2020-06-03T14:47:09Z", "message": "property key value changed to camelcase"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDIzNjMxMzgw", "url": "https://github.com/wso2/carbon-apimgt/pull/8442#pullrequestreview-423631380", "createdAt": "2020-06-03T14:48:39Z", "commit": {"oid": "a4896c4b36ab90b45e6b6f51818183351ad77cf0"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2916, "cost": 1, "resetAt": "2021-11-02T10:47:05Z"}}}