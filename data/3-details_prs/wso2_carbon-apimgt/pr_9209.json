{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDcwMTUxOTIz", "number": 9209, "title": "[Improvement] Add support for \"x-wso2-application-security\" mgw extension in API level", "bodyText": "Purpose\nx-wso2-application-security is not supported when defined in API definition when creating an API with existing API definition.\nThis application security values should be applied under the runtime configurations in API.\nWhen the Following extension is defined in the API definition this should reflect it's changed configs in publisher UI which is not supported currently.\n x-wso2-application-security: \n        security-types: \n          - \"api_key\"\n        optional: false\n\nThis PR will support this task.\nGoals\nImprove the extension support which is used by the micro gateway.\nFixes wso2/product-apim#9133\nand wso2/product-apim-tooling#469\nApproach\nIn OASParsers of APIM, there are methods to preprocess swagger definitions before actually processing and creating API objects. On that level, the OAS parsers can map x-wso2-application-security extension values into API object in OAS parsers when creating API objects using these OpenAPI definitions.\nUser stories\nImport API via API Controller.\nImport API via Publisher Portal\nDocumentation\nNo doc changes required.\nTest environment\nUbuntu 20.04 LTS\nJava JDK 1.8_241\nAPIM 3.2.0\nAPICTL 3.2.0", "createdAt": "2020-08-19T13:06:17Z", "url": "https://github.com/wso2/carbon-apimgt/pull/9209", "merged": true, "mergeCommit": {"oid": "3806ec1e7ef2ff96fc04028eff67303263bc358e"}, "closed": true, "closedAt": "2020-09-09T05:24:45Z", "author": {"login": "Chamindu36"}, "timelineItems": {"totalCount": 6, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdAVmy6gH2gAyNDcwMTUxOTIzOmMzZmE2MTEwZDNkYWI1YzRhYWExOTJkZmRmODZkZmRkYmJjYmNkNmU=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdzdvyagFqTU3NTAzNTI0Nw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "c3fa6110d3dab5c4aaa192dfdf86dfddbbcbcd6e", "author": {"user": {"login": "Chamindu36", "name": "Chamindu Udakara"}}, "url": "https://github.com/wso2/carbon-apimgt/commit/c3fa6110d3dab5c4aaa192dfdf86dfddbbcbcd6e", "committedDate": "2020-08-19T06:27:37Z", "message": "Add application support extension for MGW"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c5ca5af4de50981a576a3c37812daf07ffc4f91b", "author": {"user": {"login": "Chamindu36", "name": "Chamindu Udakara"}}, "url": "https://github.com/wso2/carbon-apimgt/commit/c5ca5af4de50981a576a3c37812daf07ffc4f91b", "committedDate": "2020-08-19T09:12:28Z", "message": "Display application security support config in UI"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "27b90d7c04bd9ba2b3e85d1090ba6ad54c4cbc29", "author": {"user": {"login": "Chamindu36", "name": "Chamindu Udakara"}}, "url": "https://github.com/wso2/carbon-apimgt/commit/27b90d7c04bd9ba2b3e85d1090ba6ad54c4cbc29", "committedDate": "2020-08-19T13:00:40Z", "message": "Fizalizing fix"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDg0NjY5NTgw", "url": "https://github.com/wso2/carbon-apimgt/pull/9209#pullrequestreview-484669580", "createdAt": "2020-09-09T05:24:39Z", "commit": {"oid": "27b90d7c04bd9ba2b3e85d1090ba6ad54c4cbc29"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTc1MDM1MTU4", "url": "https://github.com/wso2/carbon-apimgt/pull/9209#pullrequestreview-575035158", "createdAt": "2021-01-25T02:46:21Z", "commit": {"oid": "27b90d7c04bd9ba2b3e85d1090ba6ad54c4cbc29"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMS0yNVQwMjo0NjoyMVrOIZVW6A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMS0yNVQwMjo0NjoyMVrOIZVW6A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU2MzQzNTI0MA==", "bodyText": "@return type wrong. And there is no use of this doc comment if you don't add a description on what it returns.", "url": "https://github.com/wso2/carbon-apimgt/pull/9209#discussion_r563435240", "createdAt": "2021-01-25T02:46:21Z", "author": {"login": "rmsamitha"}, "path": "components/apimgt/org.wso2.carbon.apimgt.impl/src/main/java/org/wso2/carbon/apimgt/impl/definitions/OASParserUtil.java", "diffHunk": "@@ -1467,4 +1467,40 @@ public static String getAuthorizationHeaderFromSwagger(Map<String, Object> exten\n         return authorizationHeader == null ? null : authorizationHeader.toString();\n     }\n \n+    /**\n+     * This method returns extension of application security types related to micro-gw\n+     *\n+     * @param extensions Map<String, Object>\n+     * @return String", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "27b90d7c04bd9ba2b3e85d1090ba6ad54c4cbc29"}, "originalPosition": 8}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTc1MDM1MjQ3", "url": "https://github.com/wso2/carbon-apimgt/pull/9209#pullrequestreview-575035247", "createdAt": "2021-01-25T02:46:49Z", "commit": {"oid": "27b90d7c04bd9ba2b3e85d1090ba6ad54c4cbc29"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMS0yNVQwMjo0Njo0OVrOIZVXOQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMS0yNVQwMjo0Njo0OVrOIZVXOQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU2MzQzNTMyMQ==", "bodyText": "here is no use of this doc comment if you don't add a description on what it returns.", "url": "https://github.com/wso2/carbon-apimgt/pull/9209#discussion_r563435321", "createdAt": "2021-01-25T02:46:49Z", "author": {"login": "rmsamitha"}, "path": "components/apimgt/org.wso2.carbon.apimgt.impl/src/main/java/org/wso2/carbon/apimgt/impl/definitions/OASParserUtil.java", "diffHunk": "@@ -1467,4 +1467,40 @@ public static String getAuthorizationHeaderFromSwagger(Map<String, Object> exten\n         return authorizationHeader == null ? null : authorizationHeader.toString();\n     }\n \n+    /**\n+     * This method returns extension of application security types related to micro-gw\n+     *\n+     * @param extensions Map<String, Object>\n+     * @return String\n+     * @throws APIManagementException throws if an error occurred\n+     */\n+    public static List<String> getApplicationSecurityTypes(Map<String, Object> extensions) throws APIManagementException {\n+        ObjectMapper mapper = new ObjectMapper();\n+        List<String> appSecurityTypes = new ArrayList<>();\n+        if (extensions.containsKey(APIConstants.X_WSO2_APP_SECURITY)) {\n+            Object applicationSecurityTypes = extensions.get(APIConstants.X_WSO2_APP_SECURITY);\n+            ObjectNode appSecurityTypesNode = mapper.convertValue(applicationSecurityTypes, ObjectNode.class);\n+            appSecurityTypes = mapper.convertValue(appSecurityTypesNode.get(\"security-types\"), ArrayList.class);\n+        }\n+        return appSecurityTypes;\n+    }\n+\n+    /**\n+     * This method returns extension of application security types state related to micro-gw\n+     *\n+     * @param extensions Map<String, Object>\n+     * @return boolean", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "27b90d7c04bd9ba2b3e85d1090ba6ad54c4cbc29"}, "originalPosition": 26}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2500, "cost": 1, "resetAt": "2021-11-02T10:47:05Z"}}}