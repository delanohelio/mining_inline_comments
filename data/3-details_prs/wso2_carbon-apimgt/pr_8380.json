{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0MzkxODI0Mzk0", "number": 8380, "title": "Modifying listing all the applications for a tenant", "bodyText": "Purpose\nFixes: wso2/product-apim-tooling#205\nGoals\n\nPerform the changes to list applications in an environment without specifying the owner or by specifying the owner\nChange the database queries to retrieve APPLICATION_STATUS as well.\n\nApproach\nIf the owner is not specified based on the tenant ID all the application for that particular tenant was retrieved using getApplicationsByTenantIdWithPagination. The database queries associated with this function were changed since earlier it does not retrieve \"APPLICATION_STATUS\".\nUser stories\nAssume there is an environment named \"test\".\n\nWhen someone has invoked the below command to list applications for an environment without specifying the owner, it should list all the applications belongs to the tenant (which the currently logged in user belongs) in that environment.\napictl list apps -e test -k\nWhen someone has invoked the below command to list applications for an environment by specifying the owner, it should list all the applications belongs to that particular owner in that environment.\napictl list apps -e test -o sampleUser -k\n\nRelated PRs\nwso2/product-apim-tooling#209\nTest environment\n\nJDK 1.8.0_241\nUbuntu 18.04.4 LTS", "createdAt": "2020-03-21T06:53:03Z", "url": "https://github.com/wso2/carbon-apimgt/pull/8380", "merged": true, "mergeCommit": {"oid": "2e357586651fdec25e7e52345d4cc2769f8cbffe"}, "closed": true, "closedAt": "2020-03-25T08:23:44Z", "author": {"login": "wasuradananjith"}, "timelineItems": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcPjRipgH2gAyMzkxODI0Mzk0OjZlZmVmZGI4ODJiYjM0NmRmNjFmNzM0YzE2YWU4ZGU4YjRhMWEwMDY=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcRDI5vAFqTM4MDkzMzY2MA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "6efefdb882bb346df61f734c16ae8de8b4a1a006", "author": {"user": {"login": "wasuradananjith", "name": "Wasura Wattearachchi"}}, "url": "https://github.com/wso2/carbon-apimgt/commit/6efefdb882bb346df61f734c16ae8de8b4a1a006", "committedDate": "2020-03-20T16:40:47Z", "message": "modify listing all applications for a tenant"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzc5MTI2MTAy", "url": "https://github.com/wso2/carbon-apimgt/pull/8380#pullrequestreview-379126102", "createdAt": "2020-03-23T04:26:51Z", "commit": {"oid": "6efefdb882bb346df61f734c16ae8de8b4a1a006"}, "state": "COMMENTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yM1QwNDoyNjo1MlrOF52lsA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yM1QwNDoyNzowM1rOF52l0g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NjIwNzUzNg==", "bodyText": "formatting issue", "url": "https://github.com/wso2/carbon-apimgt/pull/8380#discussion_r396207536", "createdAt": "2020-03-23T04:26:52Z", "author": {"login": "malinthaprasan"}, "path": "components/apimgt/org.wso2.carbon.apimgt.rest.api.admin/src/main/java/org/wso2/carbon/apimgt/rest/api/admin/impl/ApplicationsApiServiceImpl.java", "diffHunk": "@@ -65,8 +69,18 @@ public Response applicationsGet(String user, Integer limit, Integer offset, Stri\n                     return Response.status(Response.Status.FORBIDDEN).entity(errorMsg).build();\n                 }\n                 APIConsumer apiConsumer = APIManagerFactory.getInstance().getAPIConsumer(user);\n-                allMatchedApps = apiConsumer.getApplicationsByOwner(user);\n \n+                // If no user is passed, get the applications for the tenant (not only for the user)\n+                if (givenUser == null || StringUtils.isEmpty(givenUser)) {\n+                    APIAdmin apiAdmin = new APIAdminImpl();\n+                    int tenantId = APIUtil.getTenantId(user);\n+                    allMatchedApps = apiAdmin.getApplicationsByTenantIdWithPagination(tenantId, 0, limit,\n+                            \"\", \"\", ApplicationMappingUtil.getApplicationSortByField(\"name\"),\n+                            RestApiConstants.DEFAULT_SORT_ORDER).toArray(new Application[0]);\n+                }\n+                else {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "6efefdb882bb346df61f734c16ae8de8b4a1a006"}, "originalPosition": 44}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NjIwNzU3MA==", "bodyText": "Please use a const for \"name\"", "url": "https://github.com/wso2/carbon-apimgt/pull/8380#discussion_r396207570", "createdAt": "2020-03-23T04:27:03Z", "author": {"login": "malinthaprasan"}, "path": "components/apimgt/org.wso2.carbon.apimgt.rest.api.admin/src/main/java/org/wso2/carbon/apimgt/rest/api/admin/impl/ApplicationsApiServiceImpl.java", "diffHunk": "@@ -65,8 +69,18 @@ public Response applicationsGet(String user, Integer limit, Integer offset, Stri\n                     return Response.status(Response.Status.FORBIDDEN).entity(errorMsg).build();\n                 }\n                 APIConsumer apiConsumer = APIManagerFactory.getInstance().getAPIConsumer(user);\n-                allMatchedApps = apiConsumer.getApplicationsByOwner(user);\n \n+                // If no user is passed, get the applications for the tenant (not only for the user)\n+                if (givenUser == null || StringUtils.isEmpty(givenUser)) {\n+                    APIAdmin apiAdmin = new APIAdminImpl();\n+                    int tenantId = APIUtil.getTenantId(user);\n+                    allMatchedApps = apiAdmin.getApplicationsByTenantIdWithPagination(tenantId, 0, limit,\n+                            \"\", \"\", ApplicationMappingUtil.getApplicationSortByField(\"name\"),", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "6efefdb882bb346df61f734c16ae8de8b4a1a006"}, "originalPosition": 41}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "8cb57edc58e7946d0fd971d48e50a865f18ec411", "author": {"user": {"login": "wasuradananjith", "name": "Wasura Wattearachchi"}}, "url": "https://github.com/wso2/carbon-apimgt/commit/8cb57edc58e7946d0fd971d48e50a865f18ec411", "committedDate": "2020-03-23T08:34:32Z", "message": "change formatting issues"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzgwOTMzNjYw", "url": "https://github.com/wso2/carbon-apimgt/pull/8380#pullrequestreview-380933660", "createdAt": "2020-03-25T08:22:14Z", "commit": {"oid": "8cb57edc58e7946d0fd971d48e50a865f18ec411"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2874, "cost": 1, "resetAt": "2021-11-02T10:47:05Z"}}}