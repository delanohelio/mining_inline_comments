{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0Mzc2NTc0MDEz", "number": 8215, "title": "Removing the hardcoded system apps names in the logout handler and retrieve from system apps db table", "bodyText": "Issue\nFixes wso2/product-apim#7410\nMethodology\nGetting the system apps from the database against the tenant and check against the apps authorized for the logout initiated user and revoke all the access token related to those apps.", "createdAt": "2020-02-18T11:51:18Z", "url": "https://github.com/wso2/carbon-apimgt/pull/8215", "merged": true, "mergeCommit": {"oid": "36411052a19d28573592f31ec60bdd8021e4618e"}, "closed": true, "closedAt": "2020-02-21T05:16:30Z", "author": {"login": "CrowleyRajapakse"}, "timelineItems": {"totalCount": 9, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcFg007AFqTM2MDI4NDkxMg==", "endCursor": "Y3Vyc29yOnYyOpPPAAABcGHj0MgFqTM2MTczOTc0MQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzYwMjg0OTEy", "url": "https://github.com/wso2/carbon-apimgt/pull/8215#pullrequestreview-360284912", "createdAt": "2020-02-18T12:05:57Z", "commit": {"oid": "8087fdb1e4e23297fdf21c6079e0af669b1414c7"}, "state": "COMMENTED", "comments": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xOFQxMjowNTo1N1rOFq_4Hg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xOFQxMjowOTo1MFrOFq_-sQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MDYzMTA3MA==", "bodyText": "Can't we remove this new line and keep as a single line?", "url": "https://github.com/wso2/carbon-apimgt/pull/8215#discussion_r380631070", "createdAt": "2020-02-18T12:05:57Z", "author": {"login": "menakaj"}, "path": "components/apimgt/org.wso2.carbon.apimgt.keymgt/src/main/java/org/wso2/carbon/apimgt/keymgt/handlers/SessionDataPublisherImpl.java", "diffHunk": "@@ -123,6 +123,19 @@\n                         .getUserName(), e);\n             }\n         }\n+        SystemApplicationDAO systemApplicationDAO = new SystemApplicationDAO();\n+        try {\n+            systemApplicationDTOS = systemApplicationDAO.getApplications(tenantDomain);\n+            if (systemApplicationDTOS.length < 0) {\n+                if (log.isDebugEnabled()) {\n+                    log.debug(", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "8087fdb1e4e23297fdf21c6079e0af669b1414c7"}, "originalPosition": 57}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MDYzMTM3MA==", "bodyText": "Also add a space before \"doesn't\"\n\"The tenant: \" + tenantDomain + \" doesn't have any system apps\"", "url": "https://github.com/wso2/carbon-apimgt/pull/8215#discussion_r380631370", "createdAt": "2020-02-18T12:06:42Z", "author": {"login": "menakaj"}, "path": "components/apimgt/org.wso2.carbon.apimgt.keymgt/src/main/java/org/wso2/carbon/apimgt/keymgt/handlers/SessionDataPublisherImpl.java", "diffHunk": "@@ -123,6 +123,19 @@\n                         .getUserName(), e);\n             }\n         }\n+        SystemApplicationDAO systemApplicationDAO = new SystemApplicationDAO();\n+        try {\n+            systemApplicationDTOS = systemApplicationDAO.getApplications(tenantDomain);\n+            if (systemApplicationDTOS.length < 0) {\n+                if (log.isDebugEnabled()) {\n+                    log.debug(", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MDYzMTA3MA=="}, "originalCommit": {"oid": "8087fdb1e4e23297fdf21c6079e0af669b1414c7"}, "originalPosition": 57}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MDYzMjA3OA==", "bodyText": "Remove the concatenation and keep in a single line.\n    `public static final String GET__APPLICATIONS = \"SELECT * FROM AM_SYSTEM_APPS WHERE TENANT_DOMAIN = ?\";`", "url": "https://github.com/wso2/carbon-apimgt/pull/8215#discussion_r380632078", "createdAt": "2020-02-18T12:08:19Z", "author": {"login": "menakaj"}, "path": "components/apimgt/org.wso2.carbon.apimgt.impl/src/main/java/org/wso2/carbon/apimgt/impl/dao/constants/SQLConstants.java", "diffHunk": "@@ -3403,6 +3403,9 @@\n                 \"INSERT INTO AM_SYSTEM_APPS \" + \"(NAME,CONSUMER_KEY,CONSUMER_SECRET,TENANT_DOMAIN,CREATED_TIME) \" +\n                         \"VALUES (?,?,?,?,?)\";\n \n+        public static final String GET__APPLICATIONS =", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "8087fdb1e4e23297fdf21c6079e0af669b1414c7"}, "originalPosition": 4}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MDYzMjc1Mw==", "bodyText": "Ther are two _ characters in the variable.", "url": "https://github.com/wso2/carbon-apimgt/pull/8215#discussion_r380632753", "createdAt": "2020-02-18T12:09:50Z", "author": {"login": "menakaj"}, "path": "components/apimgt/org.wso2.carbon.apimgt.impl/src/main/java/org/wso2/carbon/apimgt/impl/dao/constants/SQLConstants.java", "diffHunk": "@@ -3403,6 +3403,9 @@\n                 \"INSERT INTO AM_SYSTEM_APPS \" + \"(NAME,CONSUMER_KEY,CONSUMER_SECRET,TENANT_DOMAIN,CREATED_TIME) \" +\n                         \"VALUES (?,?,?,?,?)\";\n \n+        public static final String GET__APPLICATIONS =", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MDYzMjA3OA=="}, "originalCommit": {"oid": "8087fdb1e4e23297fdf21c6079e0af669b1414c7"}, "originalPosition": 4}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzYwMjg4NjYz", "url": "https://github.com/wso2/carbon-apimgt/pull/8215#pullrequestreview-360288663", "createdAt": "2020-02-18T12:12:29Z", "commit": {"oid": "8087fdb1e4e23297fdf21c6079e0af669b1414c7"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xOFQxMjoxMjoyOVrOFrADfA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xOFQxMjoxMjoyOVrOFrADfA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MDYzMzk4MA==", "bodyText": "Format the code", "url": "https://github.com/wso2/carbon-apimgt/pull/8215#discussion_r380633980", "createdAt": "2020-02-18T12:12:29Z", "author": {"login": "malinthaprasan"}, "path": "components/apimgt/org.wso2.carbon.apimgt.keymgt/src/main/java/org/wso2/carbon/apimgt/keymgt/handlers/SessionDataPublisherImpl.java", "diffHunk": "@@ -136,11 +149,15 @@\n                     e);\n         }\n \n-        for (OAuthConsumerAppDTO appDTO : appDTOs) {\n-            if (StringUtils.equalsIgnoreCase(DEVPORTAL_CLIENT_APP_NAME_OLD, appDTO.getApplicationName()) ||\n-                    StringUtils.equalsIgnoreCase(DEVPORTAL_CLIENT_APP_NAME, appDTO.getApplicationName()) ||\n-                    StringUtils.equalsIgnoreCase(PUBLISHER_CLIENT_APP_NAME_OLD, appDTO.getApplicationName()) ||\n-                    StringUtils.equalsIgnoreCase(PUBLISHER_CLIENT_APP_NAME, appDTO.getApplicationName())) {\n+        for(OAuthConsumerAppDTO appDTO : appDTOs){\n+            for(SystemApplicationDTO systemApplicationDTO : systemApplicationDTOS) {\n+                if(StringUtils.equalsIgnoreCase(appDTO.getOauthConsumerKey(),systemApplicationDTO.getConsumerKey())){\n+                    revokeAppList.add(appDTO);\n+                }\n+            }\n+        }", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "8087fdb1e4e23297fdf21c6079e0af669b1414c7"}, "originalPosition": 83}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzYwMjg5MTA3", "url": "https://github.com/wso2/carbon-apimgt/pull/8215#pullrequestreview-360289107", "createdAt": "2020-02-18T12:13:15Z", "commit": {"oid": "8087fdb1e4e23297fdf21c6079e0af669b1414c7"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xOFQxMjoxMzoxNVrOFrAEvg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xOFQxMjoxMzoxNVrOFrAEvg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MDYzNDMwMg==", "bodyText": "Can we continue when error happens?", "url": "https://github.com/wso2/carbon-apimgt/pull/8215#discussion_r380634302", "createdAt": "2020-02-18T12:13:15Z", "author": {"login": "malinthaprasan"}, "path": "components/apimgt/org.wso2.carbon.apimgt.keymgt/src/main/java/org/wso2/carbon/apimgt/keymgt/handlers/SessionDataPublisherImpl.java", "diffHunk": "@@ -123,6 +123,19 @@\n                         .getUserName(), e);\n             }\n         }\n+        SystemApplicationDAO systemApplicationDAO = new SystemApplicationDAO();\n+        try {\n+            systemApplicationDTOS = systemApplicationDAO.getApplications(tenantDomain);\n+            if (systemApplicationDTOS.length < 0) {\n+                if (log.isDebugEnabled()) {\n+                    log.debug(\n+                            \"The tenant: \" + tenantDomain + \"doesn't have any system apps\");\n+                }\n+            }\n+        } catch (APIMgtDAOException e) {\n+            log.error(\"Error thrown while retrieving system applications for the tenant domain\" + tenantDomain, e);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "8087fdb1e4e23297fdf21c6079e0af669b1414c7"}, "originalPosition": 62}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "8087fdb1e4e23297fdf21c6079e0af669b1414c7", "author": {"user": {"login": "CrowleyRajapakse", "name": "Crowley Rajapakse"}}, "url": "https://github.com/wso2/carbon-apimgt/commit/8087fdb1e4e23297fdf21c6079e0af669b1414c7", "committedDate": "2020-02-18T11:44:08Z", "message": "removing the hardcorded system apps names in the logout handler and retrieving from system apps db table"}, "afterCommit": {"oid": "16190b973ce0e8465eb0ce75f30bb1a546681bd5", "author": {"user": {"login": "CrowleyRajapakse", "name": "Crowley Rajapakse"}}, "url": "https://github.com/wso2/carbon-apimgt/commit/16190b973ce0e8465eb0ce75f30bb1a546681bd5", "committedDate": "2020-02-18T12:14:55Z", "message": "removing the hardcorded system apps names in the logout handler and retrieving from system apps db table"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "16190b973ce0e8465eb0ce75f30bb1a546681bd5", "author": {"user": {"login": "CrowleyRajapakse", "name": "Crowley Rajapakse"}}, "url": "https://github.com/wso2/carbon-apimgt/commit/16190b973ce0e8465eb0ce75f30bb1a546681bd5", "committedDate": "2020-02-18T12:14:55Z", "message": "removing the hardcorded system apps names in the logout handler and retrieving from system apps db table"}, "afterCommit": {"oid": "3099e5e2754fef6a69bd0d33eab45967c2268413", "author": {"user": {"login": "CrowleyRajapakse", "name": "Crowley Rajapakse"}}, "url": "https://github.com/wso2/carbon-apimgt/commit/3099e5e2754fef6a69bd0d33eab45967c2268413", "committedDate": "2020-02-20T04:58:08Z", "message": "removing the hardcorded system apps names in the logout handler and retrieving from system apps db table"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzYxNzA5NDM2", "url": "https://github.com/wso2/carbon-apimgt/pull/8215#pullrequestreview-361709436", "createdAt": "2020-02-20T08:30:12Z", "commit": {"oid": "3099e5e2754fef6a69bd0d33eab45967c2268413"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yMFQwODozMDoxMlrOFsKHzQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yMFQwODozMDoxMlrOFsKHzQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MTg0NzUwMQ==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                        log.error(\"Error thrown while retrieving system applications for the tenant domain\" + tenantDomain, e);\n          \n          \n            \n                        log.error(\"Error thrown while retrieving system applications for the tenant domain \" + tenantDomain, e);", "url": "https://github.com/wso2/carbon-apimgt/pull/8215#discussion_r381847501", "createdAt": "2020-02-20T08:30:12Z", "author": {"login": "fazlan-nazeem"}, "path": "components/apimgt/org.wso2.carbon.apimgt.keymgt/src/main/java/org/wso2/carbon/apimgt/keymgt/handlers/SessionDataPublisherImpl.java", "diffHunk": "@@ -123,6 +123,18 @@\n                         .getUserName(), e);\n             }\n         }\n+        SystemApplicationDAO systemApplicationDAO = new SystemApplicationDAO();\n+        try {\n+            systemApplicationDTOS = systemApplicationDAO.getApplications(tenantDomain);\n+            if (systemApplicationDTOS.length < 0) {\n+                if (log.isDebugEnabled()) {\n+                    log.debug(\"The tenant: \" + tenantDomain + \" doesn't have any system apps\");\n+                }\n+            }\n+        } catch (APIMgtDAOException e) {\n+            log.error(\"Error thrown while retrieving system applications for the tenant domain\" + tenantDomain, e);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "3099e5e2754fef6a69bd0d33eab45967c2268413"}, "originalPosition": 61}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "cc039d4795c3c62bbc8991c0f80773275ccc4f0c", "author": {"user": {"login": "CrowleyRajapakse", "name": "Crowley Rajapakse"}}, "url": "https://github.com/wso2/carbon-apimgt/commit/cc039d4795c3c62bbc8991c0f80773275ccc4f0c", "committedDate": "2020-02-20T09:14:12Z", "message": "removing the hardcorded system apps names in the logout handler and retrieving from system apps db table"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "3099e5e2754fef6a69bd0d33eab45967c2268413", "author": {"user": {"login": "CrowleyRajapakse", "name": "Crowley Rajapakse"}}, "url": "https://github.com/wso2/carbon-apimgt/commit/3099e5e2754fef6a69bd0d33eab45967c2268413", "committedDate": "2020-02-20T04:58:08Z", "message": "removing the hardcorded system apps names in the logout handler and retrieving from system apps db table"}, "afterCommit": {"oid": "cc039d4795c3c62bbc8991c0f80773275ccc4f0c", "author": {"user": {"login": "CrowleyRajapakse", "name": "Crowley Rajapakse"}}, "url": "https://github.com/wso2/carbon-apimgt/commit/cc039d4795c3c62bbc8991c0f80773275ccc4f0c", "committedDate": "2020-02-20T09:14:12Z", "message": "removing the hardcorded system apps names in the logout handler and retrieving from system apps db table"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzYxNzM5NzQx", "url": "https://github.com/wso2/carbon-apimgt/pull/8215#pullrequestreview-361739741", "createdAt": "2020-02-20T09:18:05Z", "commit": {"oid": "cc039d4795c3c62bbc8991c0f80773275ccc4f0c"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3008, "cost": 1, "resetAt": "2021-11-02T10:47:05Z"}}}