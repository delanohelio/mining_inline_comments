{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTMwMjQxMTEw", "number": 9454, "title": "[APIM-4.0.0] Displaying comments with User Information.", "bodyText": "Purpose\nFixes wso2/product-apim#9595\nThis PR Provides the capability to view each commenter's information from the REST API. As the users are provisioned to APIM, we can use the default profile to extract the user's info.\nApproach\nWe are introducing a new query parameter of includeCommenterInfo here. If this query parameter is provided in the request then commenter information with first name, last name, and Full name will be displayed. If not the commenter's Information will be null. The default value of this parameter is false.\nFor better performance, we have userClaimsMap which keeps track of the user information for a particular user. So we don't need to retrieve the claims from the user store for each comment. For a single user, even if there are multiple comments we need to query the user store only once.\nUpdate Resources:\n\nGET --> /apis/{apiId}/comments\nGET -->  /apis/{apiId}/comments/{commentId}\n\n\nhttps://localhost:9443/api/am/store/v1/apis/95ed34cd-9afa-4f8c-a272-9fa8b41b16dd/comments?includeCommenterInfo=true\n\n{\n    \"count\": 2,\n    \"list\": [\n        {\n            \"id\": \"6315a127-4eb5-4642-953a-1c7ae20ccac8\",\n            \"content\": \"This is a comment from admin\",\n            \"createdTime\": 1606821504945,\n            \"createdBy\": \"admin\",\n            \"commenterInfo\": {\n                \"firstName\": \"Admin\",\n                \"LastName\": \"Admin\",\n                \"fullName\": \"Admin Admin\"\n            }\n        },\n        {\n            \"id\": \"79f91673-69e8-480d-9aa2-2094390cf02d\",\n            \"content\": \"This is a comment from user saran\",\n            \"createdTime\": 1606821534430,\n            \"createdBy\": \"saran\",\n            \"commenterInfo\": {\n                \"firstName\": \"Saran\",\n                \"LastName\": \"Jana\",\n                \"fullName\": \"Saran Jana\"\n            }\n        }\n    ],\n    \"pagination\": null\n}\n\n\nhttps://localhost:9443/api/am/store/v1/apis/95ed34cd-9afa-4f8c-a272-9fa8b41b16dd/comments?includeCommenterInfo=false\nor  https://localhost:9443/api/am/store/v1/apis/95ed34cd-9afa-4f8c-a272-9fa8b41b16dd/comments\n\n{\n    \"count\": 2,\n    \"list\": [\n        {\n            \"id\": \"6315a127-4eb5-4642-953a-1c7ae20ccac8\",\n            \"content\": \"This is a comment from admin\",\n            \"createdTime\": 1606821504945,\n            \"createdBy\": \"admin\",\n            \"commenterInfo\": null\n        },\n        {\n            \"id\": \"79f91673-69e8-480d-9aa2-2094390cf02d\",\n            \"content\": \"This is a comment from user saran\",\n            \"createdTime\": 1606821534430,\n            \"createdBy\": \"saran\",\n            \"commenterInfo\": null\n        }\n    ],\n    \"pagination\": null\n}\n\n\nhttps://localhost:9443/api/am/store/v1/apis/95ed34cd-9afa-4f8c-a272-9fa8b41b16dd/comments/6315a127-4eb5-4642-953a-1c7ae20ccac8?includeCommenterInfo=true\n\n{\n    \"id\": \"79f91673-69e8-480d-9aa2-2094390cf02d\",\n    \"content\": \"This is a comment from user saran\",\n    \"createdTime\": 1606821534430,\n    \"createdBy\": \"saran\",\n    \"commenterInfo\": {\n        \"firstName\": \"Saran\",\n        \"LastName\": \"Jana\",\n        \"fullName\": \"Saran Jana\"\n    }\n}\n\n\nhttps://localhost:9443/api/am/store/v1/apis/95ed34cd-9afa-4f8c-a272-9fa8b41b16dd/comments/6315a127-4eb5-4642-953a-1c7ae20ccac8 or https://localhost:9443/api/am/store/v1/apis/95ed34cd-9afa-4f8c-a272-9fa8b41b16dd/comments/6315a127-4eb5-4642-953a-1c7ae20ccac8?includeCommenterInfo=false\n\n{\n    \"id\": \"6315a127-4eb5-4642-953a-1c7ae20ccac8\",\n    \"content\": \"This is a comment from admin\",\n    \"createdTime\": 1606821504945,\n    \"createdBy\": \"admin\",\n    \"commenterInfo\": null\n}\n\nTest Case Coverage", "createdAt": "2020-12-01T11:38:26Z", "url": "https://github.com/wso2/carbon-apimgt/pull/9454", "merged": true, "mergeCommit": {"oid": "0aceb84e1baffe2c2cabdabda02e5610fc25e798"}, "closed": true, "closedAt": "2020-12-09T04:46:14Z", "author": {"login": "Sarangan0219"}, "timelineItems": {"totalCount": 24, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdhzsZJgH2gAyNTMwMjQxMTEwOjI2NWE5M2Q4MmYwNTY3NmZhY2M0ODgzMDdjN2E5ZmRhNzA2YjMzZjM=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdkXSFsgFqTU0NzgzMTYxNA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "265a93d82f05676facc488307c7a9fda706b33f3", "author": {"user": {"login": "Sarangan0219", "name": "Sarangan"}}, "url": "https://github.com/wso2/carbon-apimgt/commit/265a93d82f05676facc488307c7a9fda706b33f3", "committedDate": "2020-12-01T06:10:23Z", "message": "Adding userInfo to Comment API"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "0b5ed2f1d2ef52cf9e702f7c13e80e195db6228e", "author": {"user": {"login": "Sarangan0219", "name": "Sarangan"}}, "url": "https://github.com/wso2/carbon-apimgt/commit/0b5ed2f1d2ef52cf9e702f7c13e80e195db6228e", "committedDate": "2020-12-01T11:06:18Z", "message": "Retrieve user claims from user store"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "4f2925ae5ecca5932ad30ba5e4171d2f51686c81", "author": {"user": {"login": "Sarangan0219", "name": "Sarangan"}}, "url": "https://github.com/wso2/carbon-apimgt/commit/4f2925ae5ecca5932ad30ba5e4171d2f51686c81", "committedDate": "2020-12-01T11:12:41Z", "message": "Refractor the code"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a4c5eeb073ec6ec48f293a53a7e0dcb4e2755504", "author": {"user": {"login": "Sarangan0219", "name": "Sarangan"}}, "url": "https://github.com/wso2/carbon-apimgt/commit/a4c5eeb073ec6ec48f293a53a7e0dcb4e2755504", "committedDate": "2020-12-01T11:39:51Z", "message": "Remove newlines"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTQyNTA5NjAy", "url": "https://github.com/wso2/carbon-apimgt/pull/9454#pullrequestreview-542509602", "createdAt": "2020-12-02T05:29:57Z", "commit": {"oid": "a4c5eeb073ec6ec48f293a53a7e0dcb4e2755504"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0wMlQwNToyOTo1N1rOH9LCvg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0wMlQwNToyOTo1N1rOH9LCvg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMzkwNjExMA==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                FullName:\n          \n          \n            \n                CommenterInfo:", "url": "https://github.com/wso2/carbon-apimgt/pull/9454#discussion_r533906110", "createdAt": "2020-12-02T05:29:57Z", "author": {"login": "malinthaprasan"}, "path": "components/apimgt/org.wso2.carbon.apimgt.rest.api.store.v1/src/main/resources/store-api.yaml", "diffHunk": "@@ -4590,6 +4593,18 @@ components:\n             example: admin\n           apiUUID:\n             type: string\n+    FullName:", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a4c5eeb073ec6ec48f293a53a7e0dcb4e2755504"}, "originalPosition": 21}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTQyNTA5NjQ4", "url": "https://github.com/wso2/carbon-apimgt/pull/9454#pullrequestreview-542509648", "createdAt": "2020-12-02T05:30:07Z", "commit": {"oid": "a4c5eeb073ec6ec48f293a53a7e0dcb4e2755504"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0wMlQwNTozMDowOFrOH9LC8A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0wMlQwNTozMDowOFrOH9LC8A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMzkwNjE2MA==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                    commenterInformation:\n          \n          \n            \n                    commenterInfo:", "url": "https://github.com/wso2/carbon-apimgt/pull/9454#discussion_r533906160", "createdAt": "2020-12-02T05:30:08Z", "author": {"login": "malinthaprasan"}, "path": "components/apimgt/org.wso2.carbon.apimgt.rest.api.store.v1/src/main/resources/store-api.yaml", "diffHunk": "@@ -4025,6 +4026,8 @@ components:\n           type: string\n           readOnly: true\n           example: admin\n+        commenterInformation:", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a4c5eeb073ec6ec48f293a53a7e0dcb4e2755504"}, "originalPosition": 12}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTQyNTEwMTA3", "url": "https://github.com/wso2/carbon-apimgt/pull/9454#pullrequestreview-542510107", "createdAt": "2020-12-02T05:31:32Z", "commit": {"oid": "a4c5eeb073ec6ec48f293a53a7e0dcb4e2755504"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0wMlQwNTozMTozM1rOH9LEkw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0wMlQwNTozMTozM1rOH9LEkw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMzkwNjU3OQ==", "bodyText": "shall we rename it as includeCommenterInfo", "url": "https://github.com/wso2/carbon-apimgt/pull/9454#discussion_r533906579", "createdAt": "2020-12-02T05:31:33Z", "author": {"login": "malinthaprasan"}, "path": "components/apimgt/org.wso2.carbon.apimgt.rest.api.store.v1/src/main/resources/store-api.yaml", "diffHunk": "@@ -845,6 +845,7 @@ paths:\n       - $ref: '#/components/parameters/requestedTenant'\n       - $ref: '#/components/parameters/limit'\n       - $ref: '#/components/parameters/offset'\n+      - $ref: '#/components/parameters/commenterInfo'", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a4c5eeb073ec6ec48f293a53a7e0dcb4e2755504"}, "originalPosition": 4}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTQyNTEwNDk1", "url": "https://github.com/wso2/carbon-apimgt/pull/9454#pullrequestreview-542510495", "createdAt": "2020-12-02T05:32:54Z", "commit": {"oid": "a4c5eeb073ec6ec48f293a53a7e0dcb4e2755504"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0wMlQwNTozMjo1NFrOH9LF9w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0wMlQwNTozMjo1NFrOH9LF9w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMzkwNjkzNQ==", "bodyText": "This is only a formatting fix right?", "url": "https://github.com/wso2/carbon-apimgt/pull/9454#discussion_r533906935", "createdAt": "2020-12-02T05:32:54Z", "author": {"login": "malinthaprasan"}, "path": "components/apimgt/org.wso2.carbon.apimgt.impl/src/main/java/org/wso2/carbon/apimgt/impl/APIProviderImpl.java", "diffHunk": "@@ -2390,16 +2390,38 @@ public String getSubscriber(String subscriptionId) throws APIManagementException\n         Map<String, String> claimMap = new HashMap<>();\n         try {\n             tenantId = getTenantId(tenantDomain);\n-        SortedMap<String, String> subscriberClaims =\n-                APIUtil.getClaims(subscriber, tenantId, ClaimsRetriever.DEFAULT_DIALECT_URI);\n-        APIManagerConfiguration configuration = getAPIManagerConfiguration();\n-        String configuredClaims = configuration\n-                .getFirstProperty(APIConstants.API_PUBLISHER_SUBSCRIBER_CLAIMS);\n-        if (subscriberClaims != null) {\n-            for (String claimURI : configuredClaims.split(\",\")) {\n-                claimMap.put(claimURI, subscriberClaims.get(claimURI));\n+            SortedMap<String, String> subscriberClaims =\n+                    APIUtil.getClaims(subscriber, tenantId, ClaimsRetriever.DEFAULT_DIALECT_URI);\n+            APIManagerConfiguration configuration = getAPIManagerConfiguration();\n+            String configuredClaims = configuration\n+                    .getFirstProperty(APIConstants.API_PUBLISHER_SUBSCRIBER_CLAIMS);\n+            if (subscriberClaims != null) {\n+                for (String claimURI : configuredClaims.split(\",\")) {\n+                    claimMap.put(claimURI, subscriberClaims.get(claimURI));\n+                }\n             }\n+        } catch (UserStoreException e) {\n+            throw new APIManagementException(\"Error while retrieving tenant id for tenant domain \"\n+                    + tenantDomain, e);\n         }\n+        return claimMap;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a4c5eeb073ec6ec48f293a53a7e0dcb4e2755504"}, "originalPosition": 26}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTQyNTExMDEy", "url": "https://github.com/wso2/carbon-apimgt/pull/9454#pullrequestreview-542511012", "createdAt": "2020-12-02T05:34:29Z", "commit": {"oid": "a4c5eeb073ec6ec48f293a53a7e0dcb4e2755504"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0wMlQwNTozNDoyOVrOH9LIAQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0wMlQwNTozNDoyOVrOH9LIAQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMzkwNzQ1Nw==", "bodyText": "I feel this method doesn't look right to have in APIProviderImpl.\nShall we move this method to APIUtil itself?", "url": "https://github.com/wso2/carbon-apimgt/pull/9454#discussion_r533907457", "createdAt": "2020-12-02T05:34:29Z", "author": {"login": "malinthaprasan"}, "path": "components/apimgt/org.wso2.carbon.apimgt.impl/src/main/java/org/wso2/carbon/apimgt/impl/APIProviderImpl.java", "diffHunk": "@@ -2390,16 +2390,38 @@ public String getSubscriber(String subscriptionId) throws APIManagementException\n         Map<String, String> claimMap = new HashMap<>();\n         try {\n             tenantId = getTenantId(tenantDomain);\n-        SortedMap<String, String> subscriberClaims =\n-                APIUtil.getClaims(subscriber, tenantId, ClaimsRetriever.DEFAULT_DIALECT_URI);\n-        APIManagerConfiguration configuration = getAPIManagerConfiguration();\n-        String configuredClaims = configuration\n-                .getFirstProperty(APIConstants.API_PUBLISHER_SUBSCRIBER_CLAIMS);\n-        if (subscriberClaims != null) {\n-            for (String claimURI : configuredClaims.split(\",\")) {\n-                claimMap.put(claimURI, subscriberClaims.get(claimURI));\n+            SortedMap<String, String> subscriberClaims =\n+                    APIUtil.getClaims(subscriber, tenantId, ClaimsRetriever.DEFAULT_DIALECT_URI);\n+            APIManagerConfiguration configuration = getAPIManagerConfiguration();\n+            String configuredClaims = configuration\n+                    .getFirstProperty(APIConstants.API_PUBLISHER_SUBSCRIBER_CLAIMS);\n+            if (subscriberClaims != null) {\n+                for (String claimURI : configuredClaims.split(\",\")) {\n+                    claimMap.put(claimURI, subscriberClaims.get(claimURI));\n+                }\n             }\n+        } catch (UserStoreException e) {\n+            throw new APIManagementException(\"Error while retrieving tenant id for tenant domain \"\n+                    + tenantDomain, e);\n         }\n+        return claimMap;\n+    }\n+\n+    /**\n+     * Returns the claims of a User\n+     *\n+     * @param userName The name of the user\n+     * @return The looked up claims of the user\n+     * @throws APIManagementException if failed to get user\n+     */\n+    @Override\n+    public Map<String, String> getLoggedInUserClaims(String userName) throws APIManagementException {\n+        String tenantDomain = MultitenantUtils.getTenantDomain(userName);\n+        int tenantId = 0;\n+        Map<String, String> claimMap;\n+        try {\n+            tenantId = getTenantId(tenantDomain);\n+            claimMap = APIUtil.getClaims(userName, tenantId, ClaimsRetriever.DEFAULT_DIALECT_URI);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a4c5eeb073ec6ec48f293a53a7e0dcb4e2755504"}, "originalPosition": 43}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "219471b4eaadd05fd00560c3a5c735dedb45de6b", "author": {"user": {"login": "Sarangan0219", "name": "Sarangan"}}, "url": "https://github.com/wso2/carbon-apimgt/commit/219471b4eaadd05fd00560c3a5c735dedb45de6b", "committedDate": "2020-12-02T07:33:36Z", "message": "Rename parameters"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "9dce063165691739762701864b94109afae195e2", "author": {"user": {"login": "Sarangan0219", "name": "Sarangan"}}, "url": "https://github.com/wso2/carbon-apimgt/commit/9dce063165691739762701864b94109afae195e2", "committedDate": "2020-12-04T04:30:38Z", "message": "Adding a new class for user Claims"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "7f347218da3bc3c66d7372aa59eaf3712615db52", "author": {"user": {"login": "Sarangan0219", "name": "Sarangan"}}, "url": "https://github.com/wso2/carbon-apimgt/commit/7f347218da3bc3c66d7372aa59eaf3712615db52", "committedDate": "2020-12-04T05:27:30Z", "message": "Remove unused Imports"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ade4270ea4836ea9b21931706e3a1b8e0a059ead", "author": {"user": {"login": "Sarangan0219", "name": "Sarangan"}}, "url": "https://github.com/wso2/carbon-apimgt/commit/ade4270ea4836ea9b21931706e3a1b8e0a059ead", "committedDate": "2020-12-04T07:00:14Z", "message": "Update Resources to suppoer Query parameters"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "37a27c833ab39d90fbe9713afc21544f8331c3cf", "author": {"user": {"login": "Sarangan0219", "name": "Sarangan"}}, "url": "https://github.com/wso2/carbon-apimgt/commit/37a27c833ab39d90fbe9713afc21544f8331c3cf", "committedDate": "2020-12-08T11:24:47Z", "message": "Optimize the code"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTQ3MjE4NTgy", "url": "https://github.com/wso2/carbon-apimgt/pull/9454#pullrequestreview-547218582", "createdAt": "2020-12-08T13:10:53Z", "commit": {"oid": "37a27c833ab39d90fbe9713afc21544f8331c3cf"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0wOFQxMzoxMDo1M1rOIBaTyw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0wOFQxMzoxMDo1M1rOIBaTyw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzODM1MDUzOQ==", "bodyText": "Please add license header", "url": "https://github.com/wso2/carbon-apimgt/pull/9454#discussion_r538350539", "createdAt": "2020-12-08T13:10:53Z", "author": {"login": "malinthaprasan"}, "path": "components/apimgt/org.wso2.carbon.apimgt.impl/src/main/java/org/wso2/carbon/apimgt/impl/utils/APIRealmUtils.java", "diffHunk": "@@ -0,0 +1,26 @@\n+package org.wso2.carbon.apimgt.impl.utils;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "37a27c833ab39d90fbe9713afc21544f8331c3cf"}, "originalPosition": 1}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTQ3MjE4NzEy", "url": "https://github.com/wso2/carbon-apimgt/pull/9454#pullrequestreview-547218712", "createdAt": "2020-12-08T13:11:02Z", "commit": {"oid": "37a27c833ab39d90fbe9713afc21544f8331c3cf"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0wOFQxMzoxMTowMlrOIBaUUg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0wOFQxMzoxMTowMlrOIBaUUg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzODM1MDY3NA==", "bodyText": "License header", "url": "https://github.com/wso2/carbon-apimgt/pull/9454#discussion_r538350674", "createdAt": "2020-12-08T13:11:02Z", "author": {"login": "malinthaprasan"}, "path": "components/apimgt/org.wso2.carbon.apimgt.impl/src/test/java/org/wso2/carbon/apimgt/impl/utils/APIRealmUtilTest.java", "diffHunk": "@@ -0,0 +1,60 @@\n+package org.wso2.carbon.apimgt.impl.utils;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "37a27c833ab39d90fbe9713afc21544f8331c3cf"}, "originalPosition": 1}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTQ3MjE5MTgy", "url": "https://github.com/wso2/carbon-apimgt/pull/9454#pullrequestreview-547219182", "createdAt": "2020-12-08T13:11:38Z", "commit": {"oid": "37a27c833ab39d90fbe9713afc21544f8331c3cf"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0wOFQxMzoxMTozOFrOIBaWiA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0wOFQxMzoxMTozOFrOIBaWiA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzODM1MTI0MA==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                    LastName:\n          \n          \n            \n                    lastName:", "url": "https://github.com/wso2/carbon-apimgt/pull/9454#discussion_r538351240", "createdAt": "2020-12-08T13:11:38Z", "author": {"login": "malinthaprasan"}, "path": "components/apimgt/org.wso2.carbon.apimgt.rest.api.store.v1/src/main/resources/store-api.yaml", "diffHunk": "@@ -4590,6 +4594,18 @@ components:\n             example: admin\n           apiUUID:\n             type: string\n+    CommenterInfo:\n+      type: object\n+      properties:\n+        firstName:\n+          type: string\n+          example: John\n+        LastName:", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "37a27c833ab39d90fbe9713afc21544f8331c3cf"}, "originalPosition": 35}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTQ3MjE5NTIw", "url": "https://github.com/wso2/carbon-apimgt/pull/9454#pullrequestreview-547219520", "createdAt": "2020-12-08T13:12:07Z", "commit": {"oid": "37a27c833ab39d90fbe9713afc21544f8331c3cf"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0wOFQxMzoxMjowN1rOIBaYcQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0wOFQxMzoxMjowN1rOIBaYcQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzODM1MTcyOQ==", "bodyText": "Format the code", "url": "https://github.com/wso2/carbon-apimgt/pull/9454#discussion_r538351729", "createdAt": "2020-12-08T13:12:07Z", "author": {"login": "malinthaprasan"}, "path": "components/apimgt/org.wso2.carbon.apimgt.rest.api.store.v1/src/main/java/org/wso2/carbon/apimgt/rest/api/store/v1/mappings/CommentMappingUtil.java", "diffHunk": "@@ -48,6 +53,43 @@ public static CommentDTO fromCommentToDTO(Comment comment) throws APIManagementE\n         return commentDTO;\n     }\n \n+    /**\n+     * Converts a Comment object into corresponding REST API CommentDTO object with User Info\n+     *\n+     * @param comment comment object\n+     * @return CommentDTO\n+     */\n+    public static CommentDTO fromCommentToDTOWithUserInfo(Comment comment, Map<String,\n+            Map<String, String>> userClaimsMap)  throws APIManagementException {\n+        CommentDTO commentDTO = fromCommentToDTO(comment);\n+        if (userClaimsMap.get(comment.getUser()) != null) {\n+            Map userClaims = userClaimsMap.get(comment.getUser());\n+            CommenterInfoDTO commenterInfoDTO = new CommenterInfoDTO();\n+            commenterInfoDTO.setFullName((String) userClaims.get(APIConstants.FULL_NAME));\n+            commenterInfoDTO.setFirstName((String) userClaims.get(APIConstants.FIRST_NAME));\n+            commenterInfoDTO.setLastName((String) userClaims.get(APIConstants.LAST_NAME));\n+            commentDTO.setCommenterInfo(commenterInfoDTO);\n+        }\n+        return  commentDTO;\n+    }\n+\n+    /**\n+     * Retrieve userClaims from UserStore and save it in a cache map.\n+     *\n+     * @param username        commenter username\n+     * @param userClaimsMap   cache map with user deatils\n+     * @return Map<String, Map<String, String>>\n+     */\n+    public static  Map<String, Map<String, String>> retrieveUserClaims(String username,\n+                                                                       Map<String, Map<String, String>> userClaimsMap)\n+            throws APIManagementException {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "37a27c833ab39d90fbe9713afc21544f8331c3cf"}, "originalPosition": 50}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTQ3MjE5ODk2", "url": "https://github.com/wso2/carbon-apimgt/pull/9454#pullrequestreview-547219896", "createdAt": "2020-12-08T13:12:38Z", "commit": {"oid": "37a27c833ab39d90fbe9713afc21544f8331c3cf"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0wOFQxMzoxMjozOFrOIBaaog==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0wOFQxMzoxMjozOFrOIBaaog==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzODM1MjI5MA==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                                CommentMappingUtil.retrieveUserClaims(comment.getUser(),userClaimsMap);\n          \n          \n            \n                                CommentMappingUtil.retrieveUserClaims(comment.getUser(), userClaimsMap);", "url": "https://github.com/wso2/carbon-apimgt/pull/9454#discussion_r538352290", "createdAt": "2020-12-08T13:12:38Z", "author": {"login": "malinthaprasan"}, "path": "components/apimgt/org.wso2.carbon.apimgt.rest.api.store.v1/src/main/java/org/wso2/carbon/apimgt/rest/api/store/v1/impl/ApisApiServiceImpl.java", "diffHunk": "@@ -333,7 +333,14 @@ public Response getCommentOfAPI(String commentId, String apiId, String xWSO2Tena\n             Comment comment = apiConsumer.getComment(identifier, commentId);\n \n             if (comment != null) {\n-                CommentDTO commentDTO = CommentMappingUtil.fromCommentToDTO(comment);\n+                CommentDTO commentDTO;\n+                if (includeCommenterInfo) {\n+                    Map<String, Map<String, String>> userClaimsMap = new HashMap<>();\n+                    CommentMappingUtil.retrieveUserClaims(comment.getUser(),userClaimsMap);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "37a27c833ab39d90fbe9713afc21544f8331c3cf"}, "originalPosition": 65}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTQ3MjIwMTEw", "url": "https://github.com/wso2/carbon-apimgt/pull/9454#pullrequestreview-547220110", "createdAt": "2020-12-08T13:12:56Z", "commit": {"oid": "37a27c833ab39d90fbe9713afc21544f8331c3cf"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0wOFQxMzoxMjo1NlrOIBabtg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0wOFQxMzoxMjo1NlrOIBabtg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzODM1MjU2Ng==", "bodyText": "Do not use * import", "url": "https://github.com/wso2/carbon-apimgt/pull/9454#discussion_r538352566", "createdAt": "2020-12-08T13:12:56Z", "author": {"login": "malinthaprasan"}, "path": "components/apimgt/org.wso2.carbon.apimgt.rest.api.store.v1/src/main/java/org/wso2/carbon/apimgt/rest/api/store/v1/impl/ApisApiServiceImpl.java", "diffHunk": "@@ -44,17 +44,16 @@\n import org.wso2.carbon.apimgt.impl.APIConstants;\n import org.wso2.carbon.apimgt.impl.definitions.GraphQLSchemaDefinition;\n import org.wso2.carbon.apimgt.impl.dto.Environment;\n+import org.wso2.carbon.apimgt.impl.token.ClaimsRetriever;\n+import org.wso2.carbon.apimgt.impl.utils.APIRealmUtils;\n import org.wso2.carbon.apimgt.impl.utils.APIUtil;\n import org.wso2.carbon.apimgt.rest.api.store.v1.ApisApiService;\n \n \n import java.io.File;\n import java.net.URI;\n import java.net.URISyntaxException;\n-import java.util.ArrayList;\n-import java.util.List;\n-import java.util.Map;\n-import java.util.Set;\n+import java.util.*;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "37a27c833ab39d90fbe9713afc21544f8331c3cf"}, "originalPosition": 17}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "866313d7b897152f88b7c3225827d8df4587365a", "author": {"user": {"login": "Sarangan0219", "name": "Sarangan"}}, "url": "https://github.com/wso2/carbon-apimgt/commit/866313d7b897152f88b7c3225827d8df4587365a", "committedDate": "2020-12-08T15:37:34Z", "message": "Add license headers"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTQ3NDk1MzE0", "url": "https://github.com/wso2/carbon-apimgt/pull/9454#pullrequestreview-547495314", "createdAt": "2020-12-08T18:07:31Z", "commit": {"oid": "866313d7b897152f88b7c3225827d8df4587365a"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0wOFQxODowNzozMlrOIBuLrg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0wOFQxODowNzozMlrOIBuLrg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzODY3NjE0Mg==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                                Map<String, Map<String, String>> userClaimsMap = new HashMap<>();\n          \n          \n            \n                                CommentMappingUtil.retrieveUserClaims(comment.getUser(), userClaimsMap);\n          \n          \n            \n                                Map<String, Map<String, String>> userClaimsMap = CommentMappingUtil.retrieveUserClaims(comment.getUser(), new HashMap<>());\n          \n      \n    \n    \n  \n\nWill this be more readable?", "url": "https://github.com/wso2/carbon-apimgt/pull/9454#discussion_r538676142", "createdAt": "2020-12-08T18:07:32Z", "author": {"login": "malinthaprasan"}, "path": "components/apimgt/org.wso2.carbon.apimgt.rest.api.store.v1/src/main/java/org/wso2/carbon/apimgt/rest/api/store/v1/impl/ApisApiServiceImpl.java", "diffHunk": "@@ -333,7 +334,14 @@ public Response getCommentOfAPI(String commentId, String apiId, String xWSO2Tena\n             Comment comment = apiConsumer.getComment(identifier, commentId);\n \n             if (comment != null) {\n-                CommentDTO commentDTO = CommentMappingUtil.fromCommentToDTO(comment);\n+                CommentDTO commentDTO;\n+                if (includeCommenterInfo) {\n+                    Map<String, Map<String, String>> userClaimsMap = new HashMap<>();\n+                    CommentMappingUtil.retrieveUserClaims(comment.getUser(), userClaimsMap);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "866313d7b897152f88b7c3225827d8df4587365a"}, "originalPosition": 60}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "dbe6f847730212f0db8456b3628c917d31a75961", "author": {"user": {"login": "Sarangan0219", "name": "Sarangan"}}, "url": "https://github.com/wso2/carbon-apimgt/commit/dbe6f847730212f0db8456b3628c917d31a75961", "committedDate": "2020-12-09T03:44:01Z", "message": "Fix formatting issues"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTQ3ODMxNjE0", "url": "https://github.com/wso2/carbon-apimgt/pull/9454#pullrequestreview-547831614", "createdAt": "2020-12-09T04:46:05Z", "commit": {"oid": "dbe6f847730212f0db8456b3628c917d31a75961"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3068, "cost": 1, "resetAt": "2021-11-02T10:47:05Z"}}}