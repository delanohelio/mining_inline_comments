{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDE2ODA3NjQx", "number": 8494, "title": "Update endpoint registry", "bodyText": "", "createdAt": "2020-05-12T15:38:35Z", "url": "https://github.com/wso2/carbon-apimgt/pull/8494", "merged": true, "mergeCommit": {"oid": "c67266c58f73fff9066ec129d8e3c8f8c4217bbe"}, "closed": true, "closedAt": "2020-05-13T05:46:38Z", "author": {"login": "fazlan-nazeem"}, "timelineItems": {"totalCount": 7, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcgmGvkgH2gAyNDE2ODA3NjQxOmUxZDY0ZmM3YmQ0MzIzZGJjYzc1MmRhNDEyOWUxN2RlYjMzZWEwNWI=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcgyR14AFqTQxMDYwMzQyNQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "e1d64fc7bd4323dbcc752da4129e17deb33ea05b", "author": {"user": {"login": "fazlan-nazeem", "name": "Fazlan Nazeem"}}, "url": "https://github.com/wso2/carbon-apimgt/commit/e1d64fc7bd4323dbcc752da4129e17deb33ea05b", "committedDate": "2020-05-12T15:35:25Z", "message": "Update wendpoint registry"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ffc5529b3748a9b92f7f719e1496b69e59e98002", "author": {"user": {"login": "fazlan-nazeem", "name": "Fazlan Nazeem"}}, "url": "https://github.com/wso2/carbon-apimgt/commit/ffc5529b3748a9b92f7f719e1496b69e59e98002", "committedDate": "2020-05-12T15:38:24Z", "message": "fix javadoc"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDEwNTg2Mjcw", "url": "https://github.com/wso2/carbon-apimgt/pull/8494#pullrequestreview-410586270", "createdAt": "2020-05-13T04:54:46Z", "commit": {"oid": "ffc5529b3748a9b92f7f719e1496b69e59e98002"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xM1QwNDo1NDo0NlrOGUhYwg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xM1QwNDo1NDo0NlrOGUhYwg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNDE3MTcxNA==", "bodyText": "Shall we return the updated Registry object in response.", "url": "https://github.com/wso2/carbon-apimgt/pull/8494#discussion_r424171714", "createdAt": "2020-05-13T04:54:46Z", "author": {"login": "vithu30"}, "path": "components/apimgt/org.wso2.carbon.apimgt.rest.api.endpoint.registry/src/main/java/org/wso2/carbon/apimgt/rest/api/endpoint/registry/impl/RegistriesApiServiceImpl.java", "diffHunk": "@@ -164,7 +164,23 @@ public Response createRegistryEntry(String registryId, RegistryEntryDTO registry\n     @Override\n     public Response updateRegistry(String registryId, RegistryDTO body, MessageContext messageContext) {\n \n-        return Response.ok().entity(body).build();\n+        String tenantDomain = RestApiUtil.getLoggedInUserTenantDomain();\n+        String user = RestApiUtil.getLoggedInUsername();\n+        EndpointRegistry registryProvider = new EndpointRegistryImpl();\n+        EndpointRegistryInfo registryToUpdate = EndpointRegistryMappingUtils.fromDTOtoEndpointRegistry(body, user);\n+        try {\n+            EndpointRegistryInfo endpointRegistry =\n+                    registryProvider.getEndpointRegistryByUUID(registryId, tenantDomain);\n+            if (endpointRegistry == null) {\n+                RestApiUtil.handleResourceNotFoundError(\"Endpoint registry with the id: \" + registryId +\n+                        \" is not found\", log);\n+            }\n+            registryProvider.updateEndpointRegistry(registryId, registryToUpdate);\n+        } catch (APIManagementException e) {\n+            RestApiUtil.handleInternalServerError(\"Error while updating the endpoint registry \" +\n+                    \"with id: \" + registryId, e, log);\n+        }\n+        return Response.ok().entity(\"Successfully updated the endpoint registry\").build();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ffc5529b3748a9b92f7f719e1496b69e59e98002"}, "originalPosition": 21}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDEwNTg2OTE1", "url": "https://github.com/wso2/carbon-apimgt/pull/8494#pullrequestreview-410586915", "createdAt": "2020-05-13T04:57:03Z", "commit": {"oid": "ffc5529b3748a9b92f7f719e1496b69e59e98002"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xM1QwNDo1NzowM1rOGUha7Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xM1QwNDo1NzowM1rOGUha7Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNDE3MjI2OQ==", "bodyText": "We don't need to generate uuid when updating the Registry. Shall we remove it?", "url": "https://github.com/wso2/carbon-apimgt/pull/8494#discussion_r424172269", "createdAt": "2020-05-13T04:57:03Z", "author": {"login": "vithu30"}, "path": "components/apimgt/org.wso2.carbon.apimgt.impl/src/main/java/org/wso2/carbon/apimgt/impl/dao/ApiMgtDAO.java", "diffHunk": "@@ -14757,6 +14757,37 @@ public String addEndpointRegistry(EndpointRegistryInfo endpointRegistry, int ten\n         return uuid;\n     }\n \n+    /**\n+     * Update an existing endpoint registry.\n+     *\n+     * @param registryId uuid of the endpoint registry\n+     * @param endpointRegistry EndpointRegistryInfo object with updated details\n+     * @return uuid of the updated endpoint registry\n+     * @throws APIManagementException if unable to update the endpoint registry\n+     */\n+    public String updateEndpointRegistry(String registryId, EndpointRegistryInfo endpointRegistry) throws\n+            APIManagementException {\n+\n+        String query = SQLConstants.UPDATE_ENDPOINT_REGISTRY_SQL;\n+        String uuid = UUID.randomUUID().toString();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ffc5529b3748a9b92f7f719e1496b69e59e98002"}, "originalPosition": 16}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "673eb96a79ebfb16d2e70071939589967e47c699", "author": {"user": {"login": "fazlan-nazeem", "name": "Fazlan Nazeem"}}, "url": "https://github.com/wso2/carbon-apimgt/commit/673eb96a79ebfb16d2e70071939589967e47c699", "committedDate": "2020-05-13T05:13:05Z", "message": "Fix signature of update method"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "32b5faf1684c62a4478cbdfeed5ecbbc36ab152d", "author": {"user": {"login": "fazlan-nazeem", "name": "Fazlan Nazeem"}}, "url": "https://github.com/wso2/carbon-apimgt/commit/32b5faf1684c62a4478cbdfeed5ecbbc36ab152d", "committedDate": "2020-05-13T05:44:58Z", "message": "reomve unused field"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDEwNjAzNDI1", "url": "https://github.com/wso2/carbon-apimgt/pull/8494#pullrequestreview-410603425", "createdAt": "2020-05-13T05:46:24Z", "commit": {"oid": "32b5faf1684c62a4478cbdfeed5ecbbc36ab152d"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2856, "cost": 1, "resetAt": "2021-11-02T10:47:05Z"}}}