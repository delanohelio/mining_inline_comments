{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDE4NTYwMzMy", "number": 8514, "title": "Add implementation of the resource to download Endpoint Definition and adds serviceCategory to RegistryEntry", "bodyText": "", "createdAt": "2020-05-15T12:21:27Z", "url": "https://github.com/wso2/carbon-apimgt/pull/8514", "merged": true, "mergeCommit": {"oid": "6a67551ed51d78ab8200e211c926eeefa9545aac"}, "closed": true, "closedAt": "2020-05-18T04:17:17Z", "author": {"login": "vithu30"}, "timelineItems": {"totalCount": 6, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABchdRYggH2gAyNDE4NTYwMzMyOmNmMmUwMjFiN2U4ZDhkYzUxZGY2OTdiYWU1MDY4Njk5YjdkMmU3YmE=", "endCursor": "Y3Vyc29yOnYyOpPPAAABciX_8XAFqTQxMzI2MTc1OA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "cf2e021b7e8d8dc51df697bae5068699b7d2e7ba", "author": {"user": {"login": "vithu30", "name": "Vithursa"}}, "url": "https://github.com/wso2/carbon-apimgt/commit/cf2e021b7e8d8dc51df697bae5068699b7d2e7ba", "committedDate": "2020-05-15T07:51:49Z", "message": "Add initial impl of the resource to retrieve definition file"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "446c750e4f5c046972b884a16ea49aa804344594", "author": {"user": {"login": "vithu30", "name": "Vithursa"}}, "url": "https://github.com/wso2/carbon-apimgt/commit/446c750e4f5c046972b884a16ea49aa804344594", "committedDate": "2020-05-15T07:59:57Z", "message": "Resolved conflicts"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "695d9ffcc33a1837feb2d4616ccd7327cbbcd5fc", "author": {"user": {"login": "vithu30", "name": "Vithursa"}}, "url": "https://github.com/wso2/carbon-apimgt/commit/695d9ffcc33a1837feb2d4616ccd7327cbbcd5fc", "committedDate": "2020-05-15T12:19:09Z", "message": "Add resource to download endpoint definition"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDEyNjIyMjg4", "url": "https://github.com/wso2/carbon-apimgt/pull/8514#pullrequestreview-412622288", "createdAt": "2020-05-15T12:55:31Z", "commit": {"oid": "695d9ffcc33a1837feb2d4616ccd7327cbbcd5fc"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xNVQxMjo1NTozMlrOGWDqJg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xNVQxMzowMDozN1rOGWD1nA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNTc4MTc5OA==", "bodyText": "Shall we add this to a method so that can be reused in the updateRegistryEntry method", "url": "https://github.com/wso2/carbon-apimgt/pull/8514#discussion_r425781798", "createdAt": "2020-05-15T12:55:32Z", "author": {"login": "ChamodDamitha"}, "path": "components/apimgt/org.wso2.carbon.apimgt.rest.api.endpoint.registry/src/main/java/org/wso2/carbon/apimgt/rest/api/endpoint/registry/impl/RegistriesApiServiceImpl.java", "diffHunk": "@@ -197,15 +200,24 @@ public Response createRegistryEntry(String registryId, RegistryEntryDTO registry\n                             \"definition url: \" + registryEntry.getDefinitionUrl() + \" given for the new \" +\n                             \"Endpoint Registry with Registry Id: \" + registryId, e, log);\n                 }\n-                definitionFile = new ResourceFile(null, null);\n             } else {\n                 if (!isValidEndpointDefinition(null, definitionFileInputStream,\n                         registryEntry.getDefinitionType().toString())) {\n                     RestApiUtil.handleBadRequest(\"Error while validating the endpoint definition of \" +\n                             \"the new registry entry with registry id: \" + registryId, log);\n                 }\n-                definitionFile = new ResourceFile(definitionFileInputStream, definitionFileDetail\n-                        .getContentType().getType());\n+                if (RegistryEntryDTO.DefinitionTypeEnum.OAS.equals(registryEntry.getDefinitionType())) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "695d9ffcc33a1837feb2d4616ccd7327cbbcd5fc"}, "originalPosition": 51}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNTc4NDczMg==", "bodyText": "when endpointDefinition == null, need to throw an error response right?", "url": "https://github.com/wso2/carbon-apimgt/pull/8514#discussion_r425784732", "createdAt": "2020-05-15T13:00:37Z", "author": {"login": "ChamodDamitha"}, "path": "components/apimgt/org.wso2.carbon.apimgt.rest.api.endpoint.registry/src/main/java/org/wso2/carbon/apimgt/rest/api/endpoint/registry/impl/RegistriesApiServiceImpl.java", "diffHunk": "@@ -456,4 +481,39 @@ private boolean isValidEndpointDefinition(URL definitionURL, InputStream definit\n         return isValid;\n     }\n \n+    @Override\n+    public Response getEndpointDefinition(String registryId, String entryId, MessageContext messageContext) {\n+        String tenantDomain = RestApiUtil.getLoggedInUserTenantDomain();\n+        String contentType = StringUtils.EMPTY;\n+        EndpointRegistry registryProvider = new EndpointRegistryImpl();\n+        InputStream endpointDefinition = null;\n+        try {\n+            EndpointRegistryInfo endpointRegistry = registryProvider.getEndpointRegistryByUUID(registryId, tenantDomain);\n+            if (endpointRegistry == null) {\n+                RestApiUtil.handleResourceNotFoundError(\"Endpoint registry with the id: \" + registryId +\n+                        \" is not found\", log);\n+            }\n+            EndpointRegistryEntry registryEntry = registryProvider.getEndpointRegistryEntryByUUID(registryId, entryId);\n+            if (registryEntry == null) {\n+                RestApiUtil.handleResourceNotFoundError(\"Endpoint registry entry with the id: \" + entryId +\n+                        \" is not found\", log);\n+            }\n+            String type = registryEntry.getDefinitionType();\n+            if (RegistryEntryDTO.DefinitionTypeEnum.OAS.equals(RegistryEntryDTO.DefinitionTypeEnum.fromValue(type))\n+                    || RegistryEntryDTO.DefinitionTypeEnum.GQL_SDL.equals(RegistryEntryDTO.DefinitionTypeEnum\n+                    .fromValue(type))) {\n+                contentType = MediaType.APPLICATION_JSON;\n+            } else if (RegistryEntryDTO.DefinitionTypeEnum.WSDL1.equals(RegistryEntryDTO.DefinitionTypeEnum\n+                    .fromValue(type)) || RegistryEntryDTO.DefinitionTypeEnum.WSDL2.equals(RegistryEntryDTO\n+                    .DefinitionTypeEnum.fromValue(type))) {\n+                contentType = MediaType.TEXT_XML;\n+            }\n+            endpointDefinition = registryEntry.getEndpointDefinition();\n+        } catch (APIManagementException e) {\n+            RestApiUtil.handleInternalServerError(\"Error while retrieving the endpoint definition of registry \" +\n+                    \"entry with id: \" + entryId, e, log);\n+        }\n+        return Response.ok(endpointDefinition).type(contentType).build();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "695d9ffcc33a1837feb2d4616ccd7327cbbcd5fc"}, "originalPosition": 164}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "247029ce354e3351348a849aef6a5a7a3bcec2be", "author": {"user": {"login": "vithu30", "name": "Vithursa"}}, "url": "https://github.com/wso2/carbon-apimgt/commit/247029ce354e3351348a849aef6a5a7a3bcec2be", "committedDate": "2020-05-16T03:55:39Z", "message": "Resolve review comments"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDEzMjYxNzU4", "url": "https://github.com/wso2/carbon-apimgt/pull/8514#pullrequestreview-413261758", "createdAt": "2020-05-18T04:17:10Z", "commit": {"oid": "247029ce354e3351348a849aef6a5a7a3bcec2be"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2747, "cost": 1, "resetAt": "2021-11-02T10:47:05Z"}}}