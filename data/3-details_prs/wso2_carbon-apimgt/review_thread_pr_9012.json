{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDU0MzgxMDAz", "number": 9012, "reviewThreads": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yMlQwMzoxNzoxMlrOEQ333w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yMlQwMzoyMDozNlrOEQ35_A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjg2MTI4MDk1OnYy", "diffSide": "RIGHT", "path": "components/apimgt/org.wso2.carbon.apimgt.impl/src/main/java/org/wso2/carbon/apimgt/impl/definitions/OASParserUtil.java", "isResolved": false, "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yMlQwMzoxNzoxMlrOG1RMHg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yMlQwNDoyOToxM1rOG1SSNg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1ODUwOTM0Mg==", "bodyText": "shouldn't processLegacyScopes execute before the processOtherSchemeScopes?", "url": "https://github.com/wso2/carbon-apimgt/pull/9012#discussion_r458509342", "createdAt": "2020-07-22T03:17:12Z", "author": {"login": "ruks"}, "path": "components/apimgt/org.wso2.carbon.apimgt.impl/src/main/java/org/wso2/carbon/apimgt/impl/definitions/OASParserUtil.java", "diffHunk": "@@ -1325,7 +1325,8 @@ static JsonNode getResponseCacheConfig(String responseCache, int cacheTimeout) {\n     public static String preProcess(String swaggerContent) throws APIManagementException {\n         //Load required properties from swagger to the API\n         APIDefinition apiDefinition = getOASParser(swaggerContent);\n-        return apiDefinition.processOtherSchemeScopes(swaggerContent);\n+        swaggerContent = apiDefinition.processOtherSchemeScopes(swaggerContent);\n+        return apiDefinition.processLegacyScopes(swaggerContent);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "acdee390f1f64cc3c1e893cbb19e961220e32604"}, "originalPosition": 6}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1ODUyNjg5Nw==", "bodyText": "fixed with b188ce5", "url": "https://github.com/wso2/carbon-apimgt/pull/9012#discussion_r458526897", "createdAt": "2020-07-22T04:27:43Z", "author": {"login": "msm1992"}, "path": "components/apimgt/org.wso2.carbon.apimgt.impl/src/main/java/org/wso2/carbon/apimgt/impl/definitions/OASParserUtil.java", "diffHunk": "@@ -1325,7 +1325,8 @@ static JsonNode getResponseCacheConfig(String responseCache, int cacheTimeout) {\n     public static String preProcess(String swaggerContent) throws APIManagementException {\n         //Load required properties from swagger to the API\n         APIDefinition apiDefinition = getOASParser(swaggerContent);\n-        return apiDefinition.processOtherSchemeScopes(swaggerContent);\n+        swaggerContent = apiDefinition.processOtherSchemeScopes(swaggerContent);\n+        return apiDefinition.processLegacyScopes(swaggerContent);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1ODUwOTM0Mg=="}, "originalCommit": {"oid": "acdee390f1f64cc3c1e893cbb19e961220e32604"}, "originalPosition": 6}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1ODUyNzI4Ng==", "bodyText": "Yes. Got it.", "url": "https://github.com/wso2/carbon-apimgt/pull/9012#discussion_r458527286", "createdAt": "2020-07-22T04:29:13Z", "author": {"login": "ruks"}, "path": "components/apimgt/org.wso2.carbon.apimgt.impl/src/main/java/org/wso2/carbon/apimgt/impl/definitions/OASParserUtil.java", "diffHunk": "@@ -1325,7 +1325,8 @@ static JsonNode getResponseCacheConfig(String responseCache, int cacheTimeout) {\n     public static String preProcess(String swaggerContent) throws APIManagementException {\n         //Load required properties from swagger to the API\n         APIDefinition apiDefinition = getOASParser(swaggerContent);\n-        return apiDefinition.processOtherSchemeScopes(swaggerContent);\n+        swaggerContent = apiDefinition.processOtherSchemeScopes(swaggerContent);\n+        return apiDefinition.processLegacyScopes(swaggerContent);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1ODUwOTM0Mg=="}, "originalCommit": {"oid": "acdee390f1f64cc3c1e893cbb19e961220e32604"}, "originalPosition": 6}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjg2MTI4NjM2OnYy", "diffSide": "RIGHT", "path": "components/apimgt/org.wso2.carbon.apimgt.api/src/main/java/org/wso2/carbon/apimgt/api/APIDefinition.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yMlQwMzoyMDozNlrOG1RPSg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yMlQwNDoyNzozMVrOG1SQfw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1ODUxMDE1NA==", "bodyText": "I think we should not expose processLegacyScopes via the interface because I think it is not required to execute directly.\nI think we can define same method in respective parsers as private and call inside the processOtherSchemeScopes method. Because processLegacyScopes is used by only processOtherSchemeScopes.", "url": "https://github.com/wso2/carbon-apimgt/pull/9012#discussion_r458510154", "createdAt": "2020-07-22T03:20:36Z", "author": {"login": "ruks"}, "path": "components/apimgt/org.wso2.carbon.apimgt.api/src/main/java/org/wso2/carbon/apimgt/api/APIDefinition.java", "diffHunk": "@@ -205,4 +205,13 @@ public abstract String processOtherSchemeScopes(String resourceConfigsJSON)\n     public abstract API setExtensionsToAPI(String swaggerContent, API api)\n             throws APIManagementException;\n \n+    /**\n+     * This method will extract scopes from legacy x-wso2-security and add them to default scheme\n+     * @param swaggerContent swagger definition\n+     * @return\n+     * @throws APIManagementException\n+     */\n+    public abstract String processLegacyScopes(String swaggerContent)", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "acdee390f1f64cc3c1e893cbb19e961220e32604"}, "originalPosition": 10}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1ODUyNjg0Nw==", "bodyText": "fixed with b188ce5", "url": "https://github.com/wso2/carbon-apimgt/pull/9012#discussion_r458526847", "createdAt": "2020-07-22T04:27:31Z", "author": {"login": "msm1992"}, "path": "components/apimgt/org.wso2.carbon.apimgt.api/src/main/java/org/wso2/carbon/apimgt/api/APIDefinition.java", "diffHunk": "@@ -205,4 +205,13 @@ public abstract String processOtherSchemeScopes(String resourceConfigsJSON)\n     public abstract API setExtensionsToAPI(String swaggerContent, API api)\n             throws APIManagementException;\n \n+    /**\n+     * This method will extract scopes from legacy x-wso2-security and add them to default scheme\n+     * @param swaggerContent swagger definition\n+     * @return\n+     * @throws APIManagementException\n+     */\n+    public abstract String processLegacyScopes(String swaggerContent)", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1ODUxMDE1NA=="}, "originalCommit": {"oid": "acdee390f1f64cc3c1e893cbb19e961220e32604"}, "originalPosition": 10}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3191, "cost": 1, "resetAt": "2021-11-13T14:23:39Z"}}}