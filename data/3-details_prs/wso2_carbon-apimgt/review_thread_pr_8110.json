{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0MzY3NjA0MjE0", "number": 8110, "reviewThreads": {"totalCount": 39, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yN1QxNzowOTo1MlrODa9ILg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yOFQxNDo1MToxMlrODbP5oQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjI5NTkxMDg2OnYy", "diffSide": "RIGHT", "path": "features/apimgt/org.wso2.carbon.apimgt.store.feature/src/main/resources/devportal/services/settings/settings.jag", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yN1QxNzowOTo1MlrOFiKhsg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yN1QxNzowOTo1MlrOFiKhsg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MTM2ODM3MA==", "bodyText": "This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters. Learn more about bidirectional Unicode characters\n\n\n  \n\n\n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n             * Copyright (c) 2019, WSO2 Inc. (http://www.wso2.org) All Rights Reserved.\n          \n          \n            \n             * Copyright (c) 2020, WSO2 Inc. (http://www.wso2.org) All Rights Reserved.", "url": "https://github.com/wso2/carbon-apimgt/pull/8110#discussion_r371368370", "createdAt": "2020-01-27T17:09:52Z", "author": {"login": "Rajith90"}, "path": "features/apimgt/org.wso2.carbon.apimgt.store.feature/src/main/resources/devportal/services/settings/settings.jag", "diffHunk": "@@ -0,0 +1,27 @@\n+<%\n+/*\n+ * Copyright (c) 2019, WSO2 Inc. (http://www.wso2.org) All Rights Reserved.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "dfa53803c1cec7bf4b46b2196c233e0a612f60a3"}, "originalPosition": 3}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjI5NTkxMjAxOnYy", "diffSide": "RIGHT", "path": "features/apimgt/org.wso2.carbon.apimgt.store.feature/src/main/resources/devportal/services/utils.js", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yN1QxNzoxMDoxNVrOFiKibQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yN1QxNzoxMDoxNVrOFiKibQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MTM2ODU1Nw==", "bodyText": "This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters. Learn more about bidirectional Unicode characters\n\n\n  \n\n\n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                if(tenantContext != null){\n          \n          \n            \n                if (tenantContext != null) {", "url": "https://github.com/wso2/carbon-apimgt/pull/8110#discussion_r371368557", "createdAt": "2020-01-27T17:10:15Z", "author": {"login": "Rajith90"}, "path": "features/apimgt/org.wso2.carbon.apimgt.store.feature/src/main/resources/devportal/services/utils.js", "diffHunk": "@@ -20,9 +20,73 @@\n var app = require('/site/public/theme/settings.js').Settings.app;\n \n var utils = Packages.org.wso2.carbon.apimgt.impl.utils.APIUtil;\n+include(\"/services/constants.jag\");\n \n var getLoopbackOrigin = function() {\n     var mgtTransportPort = utils.getCarbonTransportPort(\"https\");\n     var origin = 'https://' + app.origin.host + \":\" + mgtTransportPort;\n     return origin;\n };\n+\n+var getTenantBaseStoreContext = function() {\n+    var tenantDomain = getTenantDomain();\n+    var tenantContext = utils.getTenantBasedDevPortalContext(tenantDomain);\n+    if(tenantContext != null){", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "dfa53803c1cec7bf4b46b2196c233e0a612f60a3"}, "originalPosition": 15}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjI5NTkxMjc4OnYy", "diffSide": "RIGHT", "path": "features/apimgt/org.wso2.carbon.apimgt.store.feature/src/main/resources/devportal/services/utils.js", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yN1QxNzoxMDoyOFrOFiKi4g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yN1QxNzoxMDoyOFrOFiKi4g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MTM2ODY3NA==", "bodyText": "This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters. Learn more about bidirectional Unicode characters\n\n\n  \n\n\n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                }else{\n          \n          \n            \n                } else {", "url": "https://github.com/wso2/carbon-apimgt/pull/8110#discussion_r371368674", "createdAt": "2020-01-27T17:10:28Z", "author": {"login": "Rajith90"}, "path": "features/apimgt/org.wso2.carbon.apimgt.store.feature/src/main/resources/devportal/services/utils.js", "diffHunk": "@@ -20,9 +20,73 @@\n var app = require('/site/public/theme/settings.js').Settings.app;\n \n var utils = Packages.org.wso2.carbon.apimgt.impl.utils.APIUtil;\n+include(\"/services/constants.jag\");\n \n var getLoopbackOrigin = function() {\n     var mgtTransportPort = utils.getCarbonTransportPort(\"https\");\n     var origin = 'https://' + app.origin.host + \":\" + mgtTransportPort;\n     return origin;\n };\n+\n+var getTenantBaseStoreContext = function() {\n+    var tenantDomain = getTenantDomain();\n+    var tenantContext = utils.getTenantBasedDevPortalContext(tenantDomain);\n+    if(tenantContext != null){\n+        return tenantContext\n+    }else{", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "dfa53803c1cec7bf4b46b2196c233e0a612f60a3"}, "originalPosition": 17}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjI5NTkxNDM5OnYy", "diffSide": "RIGHT", "path": "features/apimgt/org.wso2.carbon.apimgt.store.feature/src/main/resources/devportal/services/utils.js", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yN1QxNzoxMDo1NlrOFiKj4Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yN1QxNzoxMDo1NlrOFiKj4Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MTM2ODkyOQ==", "bodyText": "This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters. Learn more about bidirectional Unicode characters\n\n\n  \n\n\n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                   if(storeDomainMapping.get('login') != null){\n          \n          \n            \n                   if (storeDomainMapping.get('login') != null) {", "url": "https://github.com/wso2/carbon-apimgt/pull/8110#discussion_r371368929", "createdAt": "2020-01-27T17:10:56Z", "author": {"login": "Rajith90"}, "path": "features/apimgt/org.wso2.carbon.apimgt.store.feature/src/main/resources/devportal/services/utils.js", "diffHunk": "@@ -20,9 +20,73 @@\n var app = require('/site/public/theme/settings.js').Settings.app;\n \n var utils = Packages.org.wso2.carbon.apimgt.impl.utils.APIUtil;\n+include(\"/services/constants.jag\");\n \n var getLoopbackOrigin = function() {\n     var mgtTransportPort = utils.getCarbonTransportPort(\"https\");\n     var origin = 'https://' + app.origin.host + \":\" + mgtTransportPort;\n     return origin;\n };\n+\n+var getTenantBaseStoreContext = function() {\n+    var tenantDomain = getTenantDomain();\n+    var tenantContext = utils.getTenantBasedDevPortalContext(tenantDomain);\n+    if(tenantContext != null){\n+        return tenantContext\n+    }else{\n+        return app.context;\n+    }\n+};\n+\n+var getTenantBasedLoginCallBack = function() {\n+    var tenantDomain = getTenantDomain();\n+    var storeDomainMapping = utils.getTenantBasedStoreDomainMapping(tenantDomain);\n+    if(storeDomainMapping != null){\n+       if(storeDomainMapping.get('login') != null){", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "dfa53803c1cec7bf4b46b2196c233e0a612f60a3"}, "originalPosition": 26}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjI5NTkxNTE4OnYy", "diffSide": "RIGHT", "path": "features/apimgt/org.wso2.carbon.apimgt.store.feature/src/main/resources/devportal/services/utils.js", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yN1QxNzoxMToxM1rOFiKkag==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yN1QxNzoxMToxM1rOFiKkag==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MTM2OTA2Ng==", "bodyText": "This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters. Learn more about bidirectional Unicode characters\n\n\n  \n\n\n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                if(storeDomainMapping != null){\n          \n          \n            \n                if (storeDomainMapping != null) {", "url": "https://github.com/wso2/carbon-apimgt/pull/8110#discussion_r371369066", "createdAt": "2020-01-27T17:11:13Z", "author": {"login": "Rajith90"}, "path": "features/apimgt/org.wso2.carbon.apimgt.store.feature/src/main/resources/devportal/services/utils.js", "diffHunk": "@@ -20,9 +20,73 @@\n var app = require('/site/public/theme/settings.js').Settings.app;\n \n var utils = Packages.org.wso2.carbon.apimgt.impl.utils.APIUtil;\n+include(\"/services/constants.jag\");\n \n var getLoopbackOrigin = function() {\n     var mgtTransportPort = utils.getCarbonTransportPort(\"https\");\n     var origin = 'https://' + app.origin.host + \":\" + mgtTransportPort;\n     return origin;\n };\n+\n+var getTenantBaseStoreContext = function() {\n+    var tenantDomain = getTenantDomain();\n+    var tenantContext = utils.getTenantBasedDevPortalContext(tenantDomain);\n+    if(tenantContext != null){\n+        return tenantContext\n+    }else{\n+        return app.context;\n+    }\n+};\n+\n+var getTenantBasedLoginCallBack = function() {\n+    var tenantDomain = getTenantDomain();\n+    var storeDomainMapping = utils.getTenantBasedStoreDomainMapping(tenantDomain);\n+    if(storeDomainMapping != null){", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "dfa53803c1cec7bf4b46b2196c233e0a612f60a3"}, "originalPosition": 25}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjI5NTkxNjIyOnYy", "diffSide": "RIGHT", "path": "features/apimgt/org.wso2.carbon.apimgt.store.feature/src/main/resources/devportal/services/utils.js", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yN1QxNzoxMTozNVrOFiKlIw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yN1QxNzoxMTozNVrOFiKlIw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MTM2OTI1MQ==", "bodyText": "This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters. Learn more about bidirectional Unicode characters\n\n\n  \n\n\n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                if(storeDomainMapping != null){\n          \n          \n            \n                if (storeDomainMapping != null) {", "url": "https://github.com/wso2/carbon-apimgt/pull/8110#discussion_r371369251", "createdAt": "2020-01-27T17:11:35Z", "author": {"login": "Rajith90"}, "path": "features/apimgt/org.wso2.carbon.apimgt.store.feature/src/main/resources/devportal/services/utils.js", "diffHunk": "@@ -20,9 +20,73 @@\n var app = require('/site/public/theme/settings.js').Settings.app;\n \n var utils = Packages.org.wso2.carbon.apimgt.impl.utils.APIUtil;\n+include(\"/services/constants.jag\");\n \n var getLoopbackOrigin = function() {\n     var mgtTransportPort = utils.getCarbonTransportPort(\"https\");\n     var origin = 'https://' + app.origin.host + \":\" + mgtTransportPort;\n     return origin;\n };\n+\n+var getTenantBaseStoreContext = function() {\n+    var tenantDomain = getTenantDomain();\n+    var tenantContext = utils.getTenantBasedDevPortalContext(tenantDomain);\n+    if(tenantContext != null){\n+        return tenantContext\n+    }else{\n+        return app.context;\n+    }\n+};\n+\n+var getTenantBasedLoginCallBack = function() {\n+    var tenantDomain = getTenantDomain();\n+    var storeDomainMapping = utils.getTenantBasedStoreDomainMapping(tenantDomain);\n+    if(storeDomainMapping != null){\n+       if(storeDomainMapping.get('login') != null){\n+        return storeDomainMapping.get('login');\n+       }\n+        return \"https://\"+storeDomainMapping.get('customUrl')+LOGIN_CALLBACK_URL_SUFFIX;\n+    }else{\n+    return null;\n+    }\n+};\n+var getTenantBasedLogoutCallBack = function() {\n+    var tenantDomain = getTenantDomain();\n+    var storeDomainMapping = utils.getTenantBasedStoreDomainMapping(tenantDomain);\n+    if(storeDomainMapping != null){", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "dfa53803c1cec7bf4b46b2196c233e0a612f60a3"}, "originalPosition": 37}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjI5NTkxNjk4OnYy", "diffSide": "RIGHT", "path": "features/apimgt/org.wso2.carbon.apimgt.store.feature/src/main/resources/devportal/services/utils.js", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yN1QxNzoxMTo1MFrOFiKloQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yN1QxNzoxMTo1MFrOFiKloQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MTM2OTM3Nw==", "bodyText": "This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters. Learn more about bidirectional Unicode characters\n\n\n  \n\n\n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                   if(storeDomainMapping.get('logout') != null){\n          \n          \n            \n                   if (storeDomainMapping.get('logout') != null) {", "url": "https://github.com/wso2/carbon-apimgt/pull/8110#discussion_r371369377", "createdAt": "2020-01-27T17:11:50Z", "author": {"login": "Rajith90"}, "path": "features/apimgt/org.wso2.carbon.apimgt.store.feature/src/main/resources/devportal/services/utils.js", "diffHunk": "@@ -20,9 +20,73 @@\n var app = require('/site/public/theme/settings.js').Settings.app;\n \n var utils = Packages.org.wso2.carbon.apimgt.impl.utils.APIUtil;\n+include(\"/services/constants.jag\");\n \n var getLoopbackOrigin = function() {\n     var mgtTransportPort = utils.getCarbonTransportPort(\"https\");\n     var origin = 'https://' + app.origin.host + \":\" + mgtTransportPort;\n     return origin;\n };\n+\n+var getTenantBaseStoreContext = function() {\n+    var tenantDomain = getTenantDomain();\n+    var tenantContext = utils.getTenantBasedDevPortalContext(tenantDomain);\n+    if(tenantContext != null){\n+        return tenantContext\n+    }else{\n+        return app.context;\n+    }\n+};\n+\n+var getTenantBasedLoginCallBack = function() {\n+    var tenantDomain = getTenantDomain();\n+    var storeDomainMapping = utils.getTenantBasedStoreDomainMapping(tenantDomain);\n+    if(storeDomainMapping != null){\n+       if(storeDomainMapping.get('login') != null){\n+        return storeDomainMapping.get('login');\n+       }\n+        return \"https://\"+storeDomainMapping.get('customUrl')+LOGIN_CALLBACK_URL_SUFFIX;\n+    }else{\n+    return null;\n+    }\n+};\n+var getTenantBasedLogoutCallBack = function() {\n+    var tenantDomain = getTenantDomain();\n+    var storeDomainMapping = utils.getTenantBasedStoreDomainMapping(tenantDomain);\n+    if(storeDomainMapping != null){\n+       if(storeDomainMapping.get('logout') != null){", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "dfa53803c1cec7bf4b46b2196c233e0a612f60a3"}, "originalPosition": 38}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjI5NTkxNzcxOnYy", "diffSide": "RIGHT", "path": "features/apimgt/org.wso2.carbon.apimgt.store.feature/src/main/resources/devportal/services/utils.js", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yN1QxNzoxMjowNFrOFiKmFw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yN1QxNzoxMjowNFrOFiKmFw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MTM2OTQ5NQ==", "bodyText": "This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters. Learn more about bidirectional Unicode characters\n\n\n  \n\n\n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                }else{\n          \n          \n            \n                } else {", "url": "https://github.com/wso2/carbon-apimgt/pull/8110#discussion_r371369495", "createdAt": "2020-01-27T17:12:04Z", "author": {"login": "Rajith90"}, "path": "features/apimgt/org.wso2.carbon.apimgt.store.feature/src/main/resources/devportal/services/utils.js", "diffHunk": "@@ -20,9 +20,73 @@\n var app = require('/site/public/theme/settings.js').Settings.app;\n \n var utils = Packages.org.wso2.carbon.apimgt.impl.utils.APIUtil;\n+include(\"/services/constants.jag\");\n \n var getLoopbackOrigin = function() {\n     var mgtTransportPort = utils.getCarbonTransportPort(\"https\");\n     var origin = 'https://' + app.origin.host + \":\" + mgtTransportPort;\n     return origin;\n };\n+\n+var getTenantBaseStoreContext = function() {\n+    var tenantDomain = getTenantDomain();\n+    var tenantContext = utils.getTenantBasedDevPortalContext(tenantDomain);\n+    if(tenantContext != null){\n+        return tenantContext\n+    }else{\n+        return app.context;\n+    }\n+};\n+\n+var getTenantBasedLoginCallBack = function() {\n+    var tenantDomain = getTenantDomain();\n+    var storeDomainMapping = utils.getTenantBasedStoreDomainMapping(tenantDomain);\n+    if(storeDomainMapping != null){\n+       if(storeDomainMapping.get('login') != null){\n+        return storeDomainMapping.get('login');\n+       }\n+        return \"https://\"+storeDomainMapping.get('customUrl')+LOGIN_CALLBACK_URL_SUFFIX;\n+    }else{\n+    return null;\n+    }\n+};\n+var getTenantBasedLogoutCallBack = function() {\n+    var tenantDomain = getTenantDomain();\n+    var storeDomainMapping = utils.getTenantBasedStoreDomainMapping(tenantDomain);\n+    if(storeDomainMapping != null){\n+       if(storeDomainMapping.get('logout') != null){\n+        return storeDomainMapping.get('logout');\n+       }\n+        return \"https://\"+storeDomainMapping.get('customUrl')+LOGOUT_CALLBACK_URL_SUFFIX;\n+    }else{", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "dfa53803c1cec7bf4b46b2196c233e0a612f60a3"}, "originalPosition": 42}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjI5NTkxODU3OnYy", "diffSide": "RIGHT", "path": "features/apimgt/org.wso2.carbon.apimgt.store.feature/src/main/resources/devportal/services/utils.js", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yN1QxNzoxMjoyMlrOFiKmow==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yN1QxNzoxMjoyMlrOFiKmow==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MTM2OTYzNQ==", "bodyText": "This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters. Learn more about bidirectional Unicode characters\n\n\n  \n\n\n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                if(isPerTenantServiceProviderEnabled()){\n          \n          \n            \n                if (isPerTenantServiceProviderEnabled()) {", "url": "https://github.com/wso2/carbon-apimgt/pull/8110#discussion_r371369635", "createdAt": "2020-01-27T17:12:22Z", "author": {"login": "Rajith90"}, "path": "features/apimgt/org.wso2.carbon.apimgt.store.feature/src/main/resources/devportal/services/utils.js", "diffHunk": "@@ -20,9 +20,73 @@\n var app = require('/site/public/theme/settings.js').Settings.app;\n \n var utils = Packages.org.wso2.carbon.apimgt.impl.utils.APIUtil;\n+include(\"/services/constants.jag\");\n \n var getLoopbackOrigin = function() {\n     var mgtTransportPort = utils.getCarbonTransportPort(\"https\");\n     var origin = 'https://' + app.origin.host + \":\" + mgtTransportPort;\n     return origin;\n };\n+\n+var getTenantBaseStoreContext = function() {\n+    var tenantDomain = getTenantDomain();\n+    var tenantContext = utils.getTenantBasedDevPortalContext(tenantDomain);\n+    if(tenantContext != null){\n+        return tenantContext\n+    }else{\n+        return app.context;\n+    }\n+};\n+\n+var getTenantBasedLoginCallBack = function() {\n+    var tenantDomain = getTenantDomain();\n+    var storeDomainMapping = utils.getTenantBasedStoreDomainMapping(tenantDomain);\n+    if(storeDomainMapping != null){\n+       if(storeDomainMapping.get('login') != null){\n+        return storeDomainMapping.get('login');\n+       }\n+        return \"https://\"+storeDomainMapping.get('customUrl')+LOGIN_CALLBACK_URL_SUFFIX;\n+    }else{\n+    return null;\n+    }\n+};\n+var getTenantBasedLogoutCallBack = function() {\n+    var tenantDomain = getTenantDomain();\n+    var storeDomainMapping = utils.getTenantBasedStoreDomainMapping(tenantDomain);\n+    if(storeDomainMapping != null){\n+       if(storeDomainMapping.get('logout') != null){\n+        return storeDomainMapping.get('logout');\n+       }\n+        return \"https://\"+storeDomainMapping.get('customUrl')+LOGOUT_CALLBACK_URL_SUFFIX;\n+    }else{\n+    return null;\n+    }\n+};\n+\n+var isPerTenantServiceProviderEnabled = function(){\n+    var tenantDomain = getTenantDomain();\n+\n+    var perTenantServiceProviderEnabled = utils.isPerTenantServiceProviderEnabled(tenantDomain);\n+    return perTenantServiceProviderEnabled;\n+};\n+\n+var getTenantDomain = function(){\n+    \n+    var tenantDomain = request.getParameter(\"tenant\");\n+    if(tenantDomain == null){\n+        tenantDomain = request.getHeader(\"X-WSO2-Tenant\");\n+        if(tenantDomain == null){\n+            tenantDomain = \"carbon.super\";\n+        }\n+    }\n+    return tenantDomain;\n+};\n+\n+var getServiceProviderTenantDomain = function(){\n+    var tenantDomain = getTenantDomain();\n+    if(isPerTenantServiceProviderEnabled()){", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "dfa53803c1cec7bf4b46b2196c233e0a612f60a3"}, "originalPosition": 68}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjI5NTkxOTQ1OnYy", "diffSide": "RIGHT", "path": "features/apimgt/org.wso2.carbon.apimgt.store.feature/src/main/resources/devportal/services/utils.js", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yN1QxNzoxMjozNFrOFiKnHQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yN1QxNzoxMjozNFrOFiKnHQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MTM2OTc1Nw==", "bodyText": "This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters. Learn more about bidirectional Unicode characters\n\n\n  \n\n\n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                }else{\n          \n          \n            \n                } else {", "url": "https://github.com/wso2/carbon-apimgt/pull/8110#discussion_r371369757", "createdAt": "2020-01-27T17:12:34Z", "author": {"login": "Rajith90"}, "path": "features/apimgt/org.wso2.carbon.apimgt.store.feature/src/main/resources/devportal/services/utils.js", "diffHunk": "@@ -20,9 +20,73 @@\n var app = require('/site/public/theme/settings.js').Settings.app;\n \n var utils = Packages.org.wso2.carbon.apimgt.impl.utils.APIUtil;\n+include(\"/services/constants.jag\");\n \n var getLoopbackOrigin = function() {\n     var mgtTransportPort = utils.getCarbonTransportPort(\"https\");\n     var origin = 'https://' + app.origin.host + \":\" + mgtTransportPort;\n     return origin;\n };\n+\n+var getTenantBaseStoreContext = function() {\n+    var tenantDomain = getTenantDomain();\n+    var tenantContext = utils.getTenantBasedDevPortalContext(tenantDomain);\n+    if(tenantContext != null){\n+        return tenantContext\n+    }else{\n+        return app.context;\n+    }\n+};\n+\n+var getTenantBasedLoginCallBack = function() {\n+    var tenantDomain = getTenantDomain();\n+    var storeDomainMapping = utils.getTenantBasedStoreDomainMapping(tenantDomain);\n+    if(storeDomainMapping != null){\n+       if(storeDomainMapping.get('login') != null){\n+        return storeDomainMapping.get('login');\n+       }\n+        return \"https://\"+storeDomainMapping.get('customUrl')+LOGIN_CALLBACK_URL_SUFFIX;\n+    }else{\n+    return null;\n+    }\n+};\n+var getTenantBasedLogoutCallBack = function() {\n+    var tenantDomain = getTenantDomain();\n+    var storeDomainMapping = utils.getTenantBasedStoreDomainMapping(tenantDomain);\n+    if(storeDomainMapping != null){\n+       if(storeDomainMapping.get('logout') != null){\n+        return storeDomainMapping.get('logout');\n+       }\n+        return \"https://\"+storeDomainMapping.get('customUrl')+LOGOUT_CALLBACK_URL_SUFFIX;\n+    }else{\n+    return null;\n+    }\n+};\n+\n+var isPerTenantServiceProviderEnabled = function(){\n+    var tenantDomain = getTenantDomain();\n+\n+    var perTenantServiceProviderEnabled = utils.isPerTenantServiceProviderEnabled(tenantDomain);\n+    return perTenantServiceProviderEnabled;\n+};\n+\n+var getTenantDomain = function(){\n+    \n+    var tenantDomain = request.getParameter(\"tenant\");\n+    if(tenantDomain == null){\n+        tenantDomain = request.getHeader(\"X-WSO2-Tenant\");\n+        if(tenantDomain == null){\n+            tenantDomain = \"carbon.super\";\n+        }\n+    }\n+    return tenantDomain;\n+};\n+\n+var getServiceProviderTenantDomain = function(){\n+    var tenantDomain = getTenantDomain();\n+    if(isPerTenantServiceProviderEnabled()){\n+        return tenantDomain;\n+    }else{", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "dfa53803c1cec7bf4b46b2196c233e0a612f60a3"}, "originalPosition": 70}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjI5NTkyMDg0OnYy", "diffSide": "RIGHT", "path": "features/apimgt/org.wso2.carbon.apimgt.store.feature/src/main/resources/devportal/services/utils.js", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yN1QxNzoxMjo1NlrOFiKn6g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yN1QxNzoxMjo1NlrOFiKn6g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MTM2OTk2Mg==", "bodyText": "This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters. Learn more about bidirectional Unicode characters\n\n\n  \n\n\n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                if(tenantDomain == null){\n          \n          \n            \n                if (tenantDomain == null) {", "url": "https://github.com/wso2/carbon-apimgt/pull/8110#discussion_r371369962", "createdAt": "2020-01-27T17:12:56Z", "author": {"login": "Rajith90"}, "path": "features/apimgt/org.wso2.carbon.apimgt.store.feature/src/main/resources/devportal/services/utils.js", "diffHunk": "@@ -20,9 +20,73 @@\n var app = require('/site/public/theme/settings.js').Settings.app;\n \n var utils = Packages.org.wso2.carbon.apimgt.impl.utils.APIUtil;\n+include(\"/services/constants.jag\");\n \n var getLoopbackOrigin = function() {\n     var mgtTransportPort = utils.getCarbonTransportPort(\"https\");\n     var origin = 'https://' + app.origin.host + \":\" + mgtTransportPort;\n     return origin;\n };\n+\n+var getTenantBaseStoreContext = function() {\n+    var tenantDomain = getTenantDomain();\n+    var tenantContext = utils.getTenantBasedDevPortalContext(tenantDomain);\n+    if(tenantContext != null){\n+        return tenantContext\n+    }else{\n+        return app.context;\n+    }\n+};\n+\n+var getTenantBasedLoginCallBack = function() {\n+    var tenantDomain = getTenantDomain();\n+    var storeDomainMapping = utils.getTenantBasedStoreDomainMapping(tenantDomain);\n+    if(storeDomainMapping != null){\n+       if(storeDomainMapping.get('login') != null){\n+        return storeDomainMapping.get('login');\n+       }\n+        return \"https://\"+storeDomainMapping.get('customUrl')+LOGIN_CALLBACK_URL_SUFFIX;\n+    }else{\n+    return null;\n+    }\n+};\n+var getTenantBasedLogoutCallBack = function() {\n+    var tenantDomain = getTenantDomain();\n+    var storeDomainMapping = utils.getTenantBasedStoreDomainMapping(tenantDomain);\n+    if(storeDomainMapping != null){\n+       if(storeDomainMapping.get('logout') != null){\n+        return storeDomainMapping.get('logout');\n+       }\n+        return \"https://\"+storeDomainMapping.get('customUrl')+LOGOUT_CALLBACK_URL_SUFFIX;\n+    }else{\n+    return null;\n+    }\n+};\n+\n+var isPerTenantServiceProviderEnabled = function(){\n+    var tenantDomain = getTenantDomain();\n+\n+    var perTenantServiceProviderEnabled = utils.isPerTenantServiceProviderEnabled(tenantDomain);\n+    return perTenantServiceProviderEnabled;\n+};\n+\n+var getTenantDomain = function(){\n+    \n+    var tenantDomain = request.getParameter(\"tenant\");\n+    if(tenantDomain == null){", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "dfa53803c1cec7bf4b46b2196c233e0a612f60a3"}, "originalPosition": 57}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjI5NTkyMTg1OnYy", "diffSide": "RIGHT", "path": "features/apimgt/org.wso2.carbon.apimgt.store.feature/src/main/resources/devportal/services/utils.js", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yN1QxNzoxMzoxMVrOFiKogg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yN1QxNzoxMzoxMVrOFiKogg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MTM3MDExNA==", "bodyText": "This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters. Learn more about bidirectional Unicode characters\n\n\n  \n\n\n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                    if(tenantDomain == null){\n          \n          \n            \n                    if (tenantDomain == null) {", "url": "https://github.com/wso2/carbon-apimgt/pull/8110#discussion_r371370114", "createdAt": "2020-01-27T17:13:11Z", "author": {"login": "Rajith90"}, "path": "features/apimgt/org.wso2.carbon.apimgt.store.feature/src/main/resources/devportal/services/utils.js", "diffHunk": "@@ -20,9 +20,73 @@\n var app = require('/site/public/theme/settings.js').Settings.app;\n \n var utils = Packages.org.wso2.carbon.apimgt.impl.utils.APIUtil;\n+include(\"/services/constants.jag\");\n \n var getLoopbackOrigin = function() {\n     var mgtTransportPort = utils.getCarbonTransportPort(\"https\");\n     var origin = 'https://' + app.origin.host + \":\" + mgtTransportPort;\n     return origin;\n };\n+\n+var getTenantBaseStoreContext = function() {\n+    var tenantDomain = getTenantDomain();\n+    var tenantContext = utils.getTenantBasedDevPortalContext(tenantDomain);\n+    if(tenantContext != null){\n+        return tenantContext\n+    }else{\n+        return app.context;\n+    }\n+};\n+\n+var getTenantBasedLoginCallBack = function() {\n+    var tenantDomain = getTenantDomain();\n+    var storeDomainMapping = utils.getTenantBasedStoreDomainMapping(tenantDomain);\n+    if(storeDomainMapping != null){\n+       if(storeDomainMapping.get('login') != null){\n+        return storeDomainMapping.get('login');\n+       }\n+        return \"https://\"+storeDomainMapping.get('customUrl')+LOGIN_CALLBACK_URL_SUFFIX;\n+    }else{\n+    return null;\n+    }\n+};\n+var getTenantBasedLogoutCallBack = function() {\n+    var tenantDomain = getTenantDomain();\n+    var storeDomainMapping = utils.getTenantBasedStoreDomainMapping(tenantDomain);\n+    if(storeDomainMapping != null){\n+       if(storeDomainMapping.get('logout') != null){\n+        return storeDomainMapping.get('logout');\n+       }\n+        return \"https://\"+storeDomainMapping.get('customUrl')+LOGOUT_CALLBACK_URL_SUFFIX;\n+    }else{\n+    return null;\n+    }\n+};\n+\n+var isPerTenantServiceProviderEnabled = function(){\n+    var tenantDomain = getTenantDomain();\n+\n+    var perTenantServiceProviderEnabled = utils.isPerTenantServiceProviderEnabled(tenantDomain);\n+    return perTenantServiceProviderEnabled;\n+};\n+\n+var getTenantDomain = function(){\n+    \n+    var tenantDomain = request.getParameter(\"tenant\");\n+    if(tenantDomain == null){\n+        tenantDomain = request.getHeader(\"X-WSO2-Tenant\");\n+        if(tenantDomain == null){", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "dfa53803c1cec7bf4b46b2196c233e0a612f60a3"}, "originalPosition": 59}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjI5NTkyMzk0OnYy", "diffSide": "RIGHT", "path": "features/apimgt/org.wso2.carbon.apimgt.store.feature/src/main/resources/devportal/services/refresh/refresh.jag", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yN1QxNzoxMzo1M1rOFiKp9A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yN1QxNzoxMzo1M1rOFiKp9A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MTM3MDQ4NA==", "bodyText": "This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters. Learn more about bidirectional Unicode characters\n\n\n  \n\n\n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                 if(appUtils.isPerTenantServiceProviderEnabled()){\n          \n          \n            \n                 if (appUtils.isPerTenantServiceProviderEnabled()) {", "url": "https://github.com/wso2/carbon-apimgt/pull/8110#discussion_r371370484", "createdAt": "2020-01-27T17:13:53Z", "author": {"login": "Rajith90"}, "path": "features/apimgt/org.wso2.carbon.apimgt.store.feature/src/main/resources/devportal/services/refresh/refresh.jag", "diffHunk": "@@ -20,7 +20,11 @@\n     include(\"/services/constants.jag\");\n     var appUtils = require(\"/services/utils.js\");\n     var app = require(\"/site/public/theme/settings.js\").Settings.app;\n-\n+    app.context = appUtils.getTenantBaseStoreContext();\n+    var tenantDomain;\n+     if(appUtils.isPerTenantServiceProviderEnabled()){", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "dfa53803c1cec7bf4b46b2196c233e0a612f60a3"}, "originalPosition": 7}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjI5NzA0ODY3OnYy", "diffSide": "RIGHT", "path": "components/apimgt/org.wso2.carbon.apimgt.impl/src/main/java/org/wso2/carbon/apimgt/impl/APIConsumerImpl.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yN1QyMzo1NTo0NlrOFiVfog==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yOFQwODozNzoxOFrOFicnbw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MTU0ODA2Ng==", "bodyText": "what is the tenant domain it returns when username is an email and tenant domain is carbon.super(enableEmailUsername set to false)", "url": "https://github.com/wso2/carbon-apimgt/pull/8110#discussion_r371548066", "createdAt": "2020-01-27T23:55:46Z", "author": {"login": "isharac"}, "path": "components/apimgt/org.wso2.carbon.apimgt.impl/src/main/java/org/wso2/carbon/apimgt/impl/APIConsumerImpl.java", "diffHunk": "@@ -5463,7 +5463,8 @@ public String getOpenAPIDefinitionForEnvironment(Identifier apiId, String enviro\n             //todo: use get api by id, so no need to set scopes or uri templates\n             api.setScopes(oasParser.getScopes(definition));\n             api.setUriTemplates(oasParser.getURITemplates(definition));\n-            apiTenantDomain = MultitenantUtils.getTenantDomain(api.getId().getProviderName());\n+            apiTenantDomain = MultitenantUtils.getTenantDomain(", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "afe94c8cdc127c3521d97a0d0009cf6edfeb60ff"}, "originalPosition": 5}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MTY2NDc1MQ==", "bodyText": "As offline checked this is fine as provider name contains the @carbon.super", "url": "https://github.com/wso2/carbon-apimgt/pull/8110#discussion_r371664751", "createdAt": "2020-01-28T08:37:18Z", "author": {"login": "isharac"}, "path": "components/apimgt/org.wso2.carbon.apimgt.impl/src/main/java/org/wso2/carbon/apimgt/impl/APIConsumerImpl.java", "diffHunk": "@@ -5463,7 +5463,8 @@ public String getOpenAPIDefinitionForEnvironment(Identifier apiId, String enviro\n             //todo: use get api by id, so no need to set scopes or uri templates\n             api.setScopes(oasParser.getScopes(definition));\n             api.setUriTemplates(oasParser.getURITemplates(definition));\n-            apiTenantDomain = MultitenantUtils.getTenantDomain(api.getId().getProviderName());\n+            apiTenantDomain = MultitenantUtils.getTenantDomain(", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MTU0ODA2Ng=="}, "originalCommit": {"oid": "afe94c8cdc127c3521d97a0d0009cf6edfeb60ff"}, "originalPosition": 5}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjI5NzA0OTY5OnYy", "diffSide": "RIGHT", "path": "components/apimgt/org.wso2.carbon.apimgt.impl/src/main/java/org/wso2/carbon/apimgt/impl/dao/SystemApplicationDAO.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yN1QyMzo1NjoyNFrOFiVgSw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yN1QyMzo1NjoyNFrOFiVgSw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MTU0ODIzNQ==", "bodyText": "space required.", "url": "https://github.com/wso2/carbon-apimgt/pull/8110#discussion_r371548235", "createdAt": "2020-01-27T23:56:24Z", "author": {"login": "isharac"}, "path": "components/apimgt/org.wso2.carbon.apimgt.impl/src/main/java/org/wso2/carbon/apimgt/impl/dao/SystemApplicationDAO.java", "diffHunk": "@@ -176,25 +174,24 @@ public SystemApplicationDTO getClientCredentialsForApplication(String appName) t\n      * @return boolean\n      * @throws APIMgtDAOException\n      */\n-    public boolean removeConsumerKeyForApplication(String appName) throws APIMgtDAOException {\n+    public boolean removeConsumerKeyForApplication(String appName,String tenantDomain) throws APIMgtDAOException {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "afe94c8cdc127c3521d97a0d0009cf6edfeb60ff"}, "originalPosition": 78}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjI5NzA1MDM1OnYy", "diffSide": "RIGHT", "path": "components/apimgt/org.wso2.carbon.apimgt.impl/src/main/java/org/wso2/carbon/apimgt/impl/dao/SystemApplicationDAO.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yN1QyMzo1NjozNlrOFiVgpw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yN1QyMzo1NjozNlrOFiVgpw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MTU0ODMyNw==", "bodyText": "space", "url": "https://github.com/wso2/carbon-apimgt/pull/8110#discussion_r371548327", "createdAt": "2020-01-27T23:56:36Z", "author": {"login": "isharac"}, "path": "components/apimgt/org.wso2.carbon.apimgt.impl/src/main/java/org/wso2/carbon/apimgt/impl/dao/SystemApplicationDAO.java", "diffHunk": "@@ -176,25 +174,24 @@ public SystemApplicationDTO getClientCredentialsForApplication(String appName) t\n      * @return boolean\n      * @throws APIMgtDAOException\n      */\n-    public boolean removeConsumerKeyForApplication(String appName) throws APIMgtDAOException {\n+    public boolean removeConsumerKeyForApplication(String appName,String tenantDomain) throws APIMgtDAOException {\n         Connection connection = null;\n         PreparedStatement preparedStatement = null;\n         boolean result = false;\n         String deleteApplicationKeyQuery = SQLConstants.SystemApplicationConstants.DELETE_SYSTEM_APPLICATION;\n \n         try {\n             connection = APIMgtDBUtil.getConnection();\n-            initialAutoCommit = connection.getAutoCommit();\n             connection.setAutoCommit(false);\n             preparedStatement = connection.prepareStatement(deleteApplicationKeyQuery);\n             preparedStatement.setString(1, appName);\n+            preparedStatement.setString(2,tenantDomain);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "afe94c8cdc127c3521d97a0d0009cf6edfeb60ff"}, "originalPosition": 90}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjI5NzA1MDgzOnYy", "diffSide": "RIGHT", "path": "components/apimgt/org.wso2.carbon.apimgt.impl/src/main/java/org/wso2/carbon/apimgt/impl/dao/SystemApplicationDAO.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yN1QyMzo1Njo1MlrOFiVg9A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yN1QyMzo1Njo1MlrOFiVg9A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MTU0ODQwNA==", "bodyText": "space", "url": "https://github.com/wso2/carbon-apimgt/pull/8110#discussion_r371548404", "createdAt": "2020-01-27T23:56:52Z", "author": {"login": "isharac"}, "path": "components/apimgt/org.wso2.carbon.apimgt.impl/src/main/java/org/wso2/carbon/apimgt/impl/dao/SystemApplicationDAO.java", "diffHunk": "@@ -208,25 +205,24 @@ public boolean removeConsumerKeyForApplication(String appName) throws APIMgtDAOE\n      * @return boolean\n      * @throws APIMgtDAOException\n      */\n-    public boolean isClientCredentialsExistForApplication(String appName) throws APIMgtDAOException {\n+    public boolean isClientCredentialsExistForApplication(String appName,String tenantDomain) throws APIMgtDAOException {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "afe94c8cdc127c3521d97a0d0009cf6edfeb60ff"}, "originalPosition": 106}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjI5NzgxMDAyOnYy", "diffSide": "RIGHT", "path": "features/apimgt/org.wso2.carbon.apimgt.publisher.feature/src/main/resources/publisher/services/login/idp.jag", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yOFQwODozODozMFrOFicpew==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yOFQwODozODozMFrOFicpew==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MTY2NTI3NQ==", "bodyText": "space required.", "url": "https://github.com/wso2/carbon-apimgt/pull/8110#discussion_r371665275", "createdAt": "2020-01-28T08:38:30Z", "author": {"login": "isharac"}, "path": "features/apimgt/org.wso2.carbon.apimgt.publisher.feature/src/main/resources/publisher/services/login/idp.jag", "diffHunk": "@@ -90,7 +90,7 @@\n                 var clientSecret = result.data.clientSecret;\n \n                 var addApplicationKey = systemApplicationDAO\n-                                                .addApplicationKey(PUBLISHER_CLIENT_APP_NAME, clientId, clientSecret);\n+                                                .addApplicationKey(PUBLISHER_CLIENT_APP_NAME, clientId, clientSecret,SUPER_TENANT_DOMAIN);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f84734ddbb98703be25969e53b111027cdf4651c"}, "originalPosition": 29}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjI5NzgxMzg0OnYy", "diffSide": "RIGHT", "path": "features/apimgt/org.wso2.carbon.apimgt.publisher.feature/src/main/resources/publisher/services/login/login_callback.jag", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yOFQwODozOTo1OFrOFicr0Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yOFQwODozOTo1OFrOFicr0Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MTY2NTg3Mw==", "bodyText": "space is required. please check the other places as well.", "url": "https://github.com/wso2/carbon-apimgt/pull/8110#discussion_r371665873", "createdAt": "2020-01-28T08:39:58Z", "author": {"login": "isharac"}, "path": "features/apimgt/org.wso2.carbon.apimgt.publisher.feature/src/main/resources/publisher/services/login/login_callback.jag", "diffHunk": "@@ -40,9 +40,9 @@\n     var SystemApplicationDTO = Packages.org.wso2.carbon.apimgt.impl.dao.SystemApplicationDAO;\n     var systemApplicationDAO = new SystemApplicationDTO();\n     // this is to support migration from admin_publisher to apim_publisher\n-    var systemApplicationDTO = systemApplicationDAO.getClientCredentialsForApplication(PUBLISHER_CLIENT_APP_NAME);\n+    var systemApplicationDTO = systemApplicationDAO.getClientCredentialsForApplication(PUBLISHER_CLIENT_APP_NAME,SUPER_TENANT_DOMAIN);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f84734ddbb98703be25969e53b111027cdf4651c"}, "originalPosition": 14}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjI5ODk1NTE3OnYy", "diffSide": "RIGHT", "path": "components/apimgt/org.wso2.carbon.apimgt.rest.api.dcr/src/main/java/org/wso2/carbon/apimgt/rest/api/dcr/web/impl/RegistrationServiceImpl.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yOFQxNDo0MzozMVrOFiniuA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yOFQxNDo0MzozMVrOFiniuA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MTg0Mzc2OA==", "bodyText": "This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters. Learn more about bidirectional Unicode characters\n\n\n  \n\n\n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                            }else{\n          \n          \n            \n                            } else {", "url": "https://github.com/wso2/carbon-apimgt/pull/8110#discussion_r371843768", "createdAt": "2020-01-28T14:43:31Z", "author": {"login": "malinthaprasan"}, "path": "components/apimgt/org.wso2.carbon.apimgt.rest.api.dcr/src/main/java/org/wso2/carbon/apimgt/rest/api/dcr/web/impl/RegistrationServiceImpl.java", "diffHunk": "@@ -137,8 +140,11 @@ public Response register(RegistrationProfile profile) {\n                 oauthApplicationInfo.setIsSaasApplication(profile.isSaasApp());\n                 oauthApplicationInfo.setTokenType(tokenType);\n                 appRequest.setOAuthApplicationInfo(oauthApplicationInfo);\n-\n-                loggedInUserTenantDomain = RestApiUtil.getLoggedInUserTenantDomain();\n+                if (!authUserName.equals(owner)){\n+                    loggedInUserTenantDomain = MultitenantUtils.getTenantDomain(owner);\n+                }else{", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "4fd999bd83e965211860c84912a1318aa7548b45"}, "originalPosition": 28}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjI5ODk1OTY1OnYy", "diffSide": "RIGHT", "path": "components/apimgt/org.wso2.carbon.apimgt.impl/src/main/java/org/wso2/carbon/apimgt/impl/utils/APIUtil.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yOFQxNDo0NDozMVrOFinlag==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yOFQxNDo0NDozMVrOFinlag==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MTg0NDQ1OA==", "bodyText": "This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters. Learn more about bidirectional Unicode characters\n\n\n  \n\n\n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                                if(StringUtils.equals(subscriptionPolicy.getBillingPlan(), APIConstants.COMMERCIAL_TIER_PLAN)){\n          \n          \n            \n                                if (StringUtils.equals(subscriptionPolicy.getBillingPlan(), APIConstants.COMMERCIAL_TIER_PLAN)) {", "url": "https://github.com/wso2/carbon-apimgt/pull/8110#discussion_r371844458", "createdAt": "2020-01-28T14:44:31Z", "author": {"login": "malinthaprasan"}, "path": "components/apimgt/org.wso2.carbon.apimgt.impl/src/main/java/org/wso2/carbon/apimgt/impl/utils/APIUtil.java", "diffHunk": "@@ -7919,7 +7960,7 @@ public static boolean isEnabledSubscriptionSpikeArrest() {\n                 if (policy instanceof SubscriptionPolicy) {\n                     SubscriptionPolicy subscriptionPolicy = (SubscriptionPolicy) policy;\n                     setBillingPlanAndCustomAttributesToTier(subscriptionPolicy, tier);\n-                    if(StringUtils.equals(subscriptionPolicy.getBillingPlan(),APIConstants.COMMERCIAL_TIER_PLAN)){\n+                    if(StringUtils.equals(subscriptionPolicy.getBillingPlan(), APIConstants.COMMERCIAL_TIER_PLAN)){", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "4fd999bd83e965211860c84912a1318aa7548b45"}, "originalPosition": 324}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjI5ODk2ODk2OnYy", "diffSide": "RIGHT", "path": "components/apimgt/org.wso2.carbon.apimgt.impl/src/main/java/org/wso2/carbon/apimgt/impl/utils/APIUtil.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yOFQxNDo0Njo1MVrOFinrKQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yOFQxNDo0Njo1MVrOFinrKQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MTg0NTkyOQ==", "bodyText": "Shall we remove logging the errors? Throwing the error only sufficient.", "url": "https://github.com/wso2/carbon-apimgt/pull/8110#discussion_r371845929", "createdAt": "2020-01-28T14:46:51Z", "author": {"login": "malinthaprasan"}, "path": "components/apimgt/org.wso2.carbon.apimgt.impl/src/main/java/org/wso2/carbon/apimgt/impl/utils/APIUtil.java", "diffHunk": "@@ -9936,5 +9981,103 @@ public static boolean validateAPICategories(List<APICategory> categories, String\n         }\n         return true;\n     }\n+\n+    public static String getTenantBasedDevPortalContext(String tenantDomain) throws APIManagementException {\n+\n+        String context = null;\n+        try {\n+            Registry registry = ServiceReferenceHolder.getInstance().getRegistryService().\n+                    getGovernanceSystemRegistry();\n+            String resourcePath = APIConstants.API_DOMAIN_MAPPINGS.replace(\"<tenant-id>\", tenantDomain);\n+            if (registry.resourceExists(resourcePath)) {\n+                Resource resource = registry.get(resourcePath);\n+                String content = new String((byte[]) resource.getContent(), Charset.defaultCharset());\n+                JSONParser parser = new JSONParser();\n+                JSONObject mappings = (JSONObject) parser.parse(content);\n+                if (mappings.containsKey(APIConstants.API_DOMAIN_MAPPINGS_STORE)) {\n+                    JSONObject storeMapping = (JSONObject) mappings.get(APIConstants.API_DOMAIN_MAPPINGS_STORE);\n+                    if (storeMapping.containsKey(APIConstants.API_DOMAIN_MAPPINGS_CONTEXT)) {\n+                        context = (String) storeMapping.get(APIConstants.API_DOMAIN_MAPPINGS_CONTEXT);\n+                    } else {\n+                        context = \"\";\n+                    }\n+                }\n+            }\n+        } catch (RegistryException e) {\n+            String msg = \"Error while retrieving gateway domain mappings from registry\";\n+            log.error(msg, e);\n+            throw new APIManagementException(msg, e);\n+        } catch (ClassCastException e) {\n+            String msg = \"Invalid JSON found in the gateway tenant domain mappings\";\n+            log.error(msg, e);\n+            throw new APIManagementException(msg, e);\n+        } catch (ParseException e) {\n+            String msg = \"Malformed JSON found in the gateway tenant domain mappings\";\n+            log.error(msg, e);\n+            throw new APIManagementException(msg, e);\n+        }", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "4fd999bd83e965211860c84912a1318aa7548b45"}, "originalPosition": 436}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjI5ODk3MDAzOnYy", "diffSide": "RIGHT", "path": "components/apimgt/org.wso2.carbon.apimgt.impl/src/main/java/org/wso2/carbon/apimgt/impl/utils/APIUtil.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yOFQxNDo0NzowN1rOFinr0w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yOFQxNDo0NzowN1rOFinr0w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MTg0NjA5OQ==", "bodyText": "Same as above.", "url": "https://github.com/wso2/carbon-apimgt/pull/8110#discussion_r371846099", "createdAt": "2020-01-28T14:47:07Z", "author": {"login": "malinthaprasan"}, "path": "components/apimgt/org.wso2.carbon.apimgt.impl/src/main/java/org/wso2/carbon/apimgt/impl/utils/APIUtil.java", "diffHunk": "@@ -9936,5 +9981,103 @@ public static boolean validateAPICategories(List<APICategory> categories, String\n         }\n         return true;\n     }\n+\n+    public static String getTenantBasedDevPortalContext(String tenantDomain) throws APIManagementException {\n+\n+        String context = null;\n+        try {\n+            Registry registry = ServiceReferenceHolder.getInstance().getRegistryService().\n+                    getGovernanceSystemRegistry();\n+            String resourcePath = APIConstants.API_DOMAIN_MAPPINGS.replace(\"<tenant-id>\", tenantDomain);\n+            if (registry.resourceExists(resourcePath)) {\n+                Resource resource = registry.get(resourcePath);\n+                String content = new String((byte[]) resource.getContent(), Charset.defaultCharset());\n+                JSONParser parser = new JSONParser();\n+                JSONObject mappings = (JSONObject) parser.parse(content);\n+                if (mappings.containsKey(APIConstants.API_DOMAIN_MAPPINGS_STORE)) {\n+                    JSONObject storeMapping = (JSONObject) mappings.get(APIConstants.API_DOMAIN_MAPPINGS_STORE);\n+                    if (storeMapping.containsKey(APIConstants.API_DOMAIN_MAPPINGS_CONTEXT)) {\n+                        context = (String) storeMapping.get(APIConstants.API_DOMAIN_MAPPINGS_CONTEXT);\n+                    } else {\n+                        context = \"\";\n+                    }\n+                }\n+            }\n+        } catch (RegistryException e) {\n+            String msg = \"Error while retrieving gateway domain mappings from registry\";\n+            log.error(msg, e);\n+            throw new APIManagementException(msg, e);\n+        } catch (ClassCastException e) {\n+            String msg = \"Invalid JSON found in the gateway tenant domain mappings\";\n+            log.error(msg, e);\n+            throw new APIManagementException(msg, e);\n+        } catch (ParseException e) {\n+            String msg = \"Malformed JSON found in the gateway tenant domain mappings\";\n+            log.error(msg, e);\n+            throw new APIManagementException(msg, e);\n+        }\n+        return context;\n+    }\n+\n+\n+    public static Map getTenantBasedStoreDomainMapping(String tenantDomain) throws APIManagementException {\n+\n+        try {\n+            Registry registry = ServiceReferenceHolder.getInstance().getRegistryService().\n+                    getGovernanceSystemRegistry();\n+            String resourcePath = APIConstants.API_DOMAIN_MAPPINGS.replace(\"<tenant-id>\", tenantDomain);\n+            if (registry.resourceExists(resourcePath)) {\n+                Resource resource = registry.get(resourcePath);\n+                String content = new String((byte[]) resource.getContent(), Charset.defaultCharset());\n+                JSONParser parser = new JSONParser();\n+                JSONObject mappings = (JSONObject) parser.parse(content);\n+                if (mappings.containsKey(APIConstants.API_DOMAIN_MAPPINGS_STORE)) {\n+                    return (Map) mappings.get(APIConstants.API_DOMAIN_MAPPINGS_STORE);\n+                }\n+            }\n+        } catch (RegistryException e) {\n+            String msg = \"Error while retrieving gateway domain mappings from registry\";\n+            log.error(msg, e);\n+            throw new APIManagementException(msg, e);\n+        } catch (ClassCastException e) {\n+            String msg = \"Invalid JSON found in the gateway tenant domain mappings\";\n+            log.error(msg, e);\n+            throw new APIManagementException(msg, e);\n+        } catch (ParseException e) {\n+            String msg = \"Malformed JSON found in the gateway tenant domain mappings\";\n+            log.error(msg, e);\n+            throw new APIManagementException(msg, e);\n+        }", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "4fd999bd83e965211860c84912a1318aa7548b45"}, "originalPosition": 468}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjI5ODk3MTE0OnYy", "diffSide": "RIGHT", "path": "components/apimgt/org.wso2.carbon.apimgt.impl/src/main/java/org/wso2/carbon/apimgt/impl/utils/APIUtil.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yOFQxNDo0NzoyNFrOFinseg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yOFQxNDo0NzoyNFrOFinseg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MTg0NjI2Ng==", "bodyText": "This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters. Learn more about bidirectional Unicode characters\n\n\n  \n\n\n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                public static String getTenantAdminUserName(String tenantDomain) throws APIManagementException {\n          \n          \n            \n            \n          \n          \n            \n                public static String getTenantAdminUserName(String tenantDomain) throws APIManagementException {", "url": "https://github.com/wso2/carbon-apimgt/pull/8110#discussion_r371846266", "createdAt": "2020-01-28T14:47:24Z", "author": {"login": "malinthaprasan"}, "path": "components/apimgt/org.wso2.carbon.apimgt.impl/src/main/java/org/wso2/carbon/apimgt/impl/utils/APIUtil.java", "diffHunk": "@@ -9936,5 +9981,103 @@ public static boolean validateAPICategories(List<APICategory> categories, String\n         }\n         return true;\n     }\n+\n+    public static String getTenantBasedDevPortalContext(String tenantDomain) throws APIManagementException {\n+\n+        String context = null;\n+        try {\n+            Registry registry = ServiceReferenceHolder.getInstance().getRegistryService().\n+                    getGovernanceSystemRegistry();\n+            String resourcePath = APIConstants.API_DOMAIN_MAPPINGS.replace(\"<tenant-id>\", tenantDomain);\n+            if (registry.resourceExists(resourcePath)) {\n+                Resource resource = registry.get(resourcePath);\n+                String content = new String((byte[]) resource.getContent(), Charset.defaultCharset());\n+                JSONParser parser = new JSONParser();\n+                JSONObject mappings = (JSONObject) parser.parse(content);\n+                if (mappings.containsKey(APIConstants.API_DOMAIN_MAPPINGS_STORE)) {\n+                    JSONObject storeMapping = (JSONObject) mappings.get(APIConstants.API_DOMAIN_MAPPINGS_STORE);\n+                    if (storeMapping.containsKey(APIConstants.API_DOMAIN_MAPPINGS_CONTEXT)) {\n+                        context = (String) storeMapping.get(APIConstants.API_DOMAIN_MAPPINGS_CONTEXT);\n+                    } else {\n+                        context = \"\";\n+                    }\n+                }\n+            }\n+        } catch (RegistryException e) {\n+            String msg = \"Error while retrieving gateway domain mappings from registry\";\n+            log.error(msg, e);\n+            throw new APIManagementException(msg, e);\n+        } catch (ClassCastException e) {\n+            String msg = \"Invalid JSON found in the gateway tenant domain mappings\";\n+            log.error(msg, e);\n+            throw new APIManagementException(msg, e);\n+        } catch (ParseException e) {\n+            String msg = \"Malformed JSON found in the gateway tenant domain mappings\";\n+            log.error(msg, e);\n+            throw new APIManagementException(msg, e);\n+        }\n+        return context;\n+    }\n+\n+\n+    public static Map getTenantBasedStoreDomainMapping(String tenantDomain) throws APIManagementException {\n+\n+        try {\n+            Registry registry = ServiceReferenceHolder.getInstance().getRegistryService().\n+                    getGovernanceSystemRegistry();\n+            String resourcePath = APIConstants.API_DOMAIN_MAPPINGS.replace(\"<tenant-id>\", tenantDomain);\n+            if (registry.resourceExists(resourcePath)) {\n+                Resource resource = registry.get(resourcePath);\n+                String content = new String((byte[]) resource.getContent(), Charset.defaultCharset());\n+                JSONParser parser = new JSONParser();\n+                JSONObject mappings = (JSONObject) parser.parse(content);\n+                if (mappings.containsKey(APIConstants.API_DOMAIN_MAPPINGS_STORE)) {\n+                    return (Map) mappings.get(APIConstants.API_DOMAIN_MAPPINGS_STORE);\n+                }\n+            }\n+        } catch (RegistryException e) {\n+            String msg = \"Error while retrieving gateway domain mappings from registry\";\n+            log.error(msg, e);\n+            throw new APIManagementException(msg, e);\n+        } catch (ClassCastException e) {\n+            String msg = \"Invalid JSON found in the gateway tenant domain mappings\";\n+            log.error(msg, e);\n+            throw new APIManagementException(msg, e);\n+        } catch (ParseException e) {\n+            String msg = \"Malformed JSON found in the gateway tenant domain mappings\";\n+            log.error(msg, e);\n+            throw new APIManagementException(msg, e);\n+        }\n+        return null;\n+    }\n+\n+    public static boolean isPerTenantServiceProviderEnabled(String tenantDomain) throws APIManagementException {\n+\n+        int tenantId = getTenantIdFromTenantDomain(tenantDomain);\n+        JSONObject tenantConfig = getTenantConfig(tenantId);\n+        if (tenantConfig.containsKey(APIConstants.PER_TENANT_SERVICE_PROVIDER)) {\n+            return (boolean) tenantConfig.get(APIConstants.PER_TENANT_SERVICE_PROVIDER);\n+        }\n+        return false;\n+    }\n+    public static String getTenantAdminUserName(String tenantDomain) throws APIManagementException {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "4fd999bd83e965211860c84912a1318aa7548b45"}, "originalPosition": 481}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjI5ODk3NDI1OnYy", "diffSide": "RIGHT", "path": "features/apimgt/org.wso2.carbon.apimgt.store.feature/src/main/resources/devportal/jaggery.conf", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yOFQxNDo0ODoxNVrOFinujg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yOFQxNDo0ODoxNVrOFinujg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MTg0Njc5OA==", "bodyText": "This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters. Learn more about bidirectional Unicode characters\n\n\n  \n\n\n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                    \"url\":\"/services/settings/settings.js\",\n          \n          \n            \n                        \"url\":\"/services/settings/settings.js\",", "url": "https://github.com/wso2/carbon-apimgt/pull/8110#discussion_r371846798", "createdAt": "2020-01-28T14:48:15Z", "author": {"login": "malinthaprasan"}, "path": "features/apimgt/org.wso2.carbon.apimgt.store.feature/src/main/resources/devportal/jaggery.conf", "diffHunk": "@@ -60,6 +60,10 @@\n             \"url\": \"/settings/*\",\n             \"path\": \"/site/public/pages/index.jag\"\n         },\n+        {\n+        \"url\":\"/services/settings/settings.js\",", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "4fd999bd83e965211860c84912a1318aa7548b45"}, "originalPosition": 5}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjI5ODk3NTExOnYy", "diffSide": "RIGHT", "path": "features/apimgt/org.wso2.carbon.apimgt.store.feature/src/main/resources/devportal/jaggery.conf", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yOFQxNDo0ODoyOVrOFinvGQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yOFQxNDo0ODoyOVrOFinvGQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MTg0NjkzNw==", "bodyText": "This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters. Learn more about bidirectional Unicode characters\n\n\n  \n\n\n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                    \"path\":\"/services/settings/settings.jag\"\n          \n          \n            \n                        \"path\":\"/services/settings/settings.jag\"", "url": "https://github.com/wso2/carbon-apimgt/pull/8110#discussion_r371846937", "createdAt": "2020-01-28T14:48:29Z", "author": {"login": "malinthaprasan"}, "path": "features/apimgt/org.wso2.carbon.apimgt.store.feature/src/main/resources/devportal/jaggery.conf", "diffHunk": "@@ -60,6 +60,10 @@\n             \"url\": \"/settings/*\",\n             \"path\": \"/site/public/pages/index.jag\"\n         },\n+        {\n+        \"url\":\"/services/settings/settings.js\",\n+        \"path\":\"/services/settings/settings.jag\"", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "4fd999bd83e965211860c84912a1318aa7548b45"}, "originalPosition": 6}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjI5ODk3NjA0OnYy", "diffSide": "RIGHT", "path": "features/apimgt/org.wso2.carbon.apimgt.store.feature/src/main/resources/devportal/services/login/idp.jag", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yOFQxNDo0ODo0MlrOFinvsA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yOFQxNDo0ODo0MlrOFinvsA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MTg0NzA4OA==", "bodyText": "This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters. Learn more about bidirectional Unicode characters\n\n\n  \n\n\n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                if(loginCallbackUrl == null){\n          \n          \n            \n                if (loginCallbackUrl == null) {", "url": "https://github.com/wso2/carbon-apimgt/pull/8110#discussion_r371847088", "createdAt": "2020-01-28T14:48:42Z", "author": {"login": "malinthaprasan"}, "path": "features/apimgt/org.wso2.carbon.apimgt.store.feature/src/main/resources/devportal/services/login/idp.jag", "diffHunk": "@@ -40,8 +40,14 @@\n     var settingsResponse = get(settingsAPIUrl, {}, \"json\");\n \n     var dcrUrl = appUtils.getLoopbackOrigin() + DCR_URL_SUFFIX;\n-    var loginCallbackUrl = serverUrl + app.context + LOGIN_CALLBACK_URL_SUFFIX;\n-    var logoutCallbackUrl = serverUrl + app.context + LOGOUT_CALLBACK_URL_SUFFIX;\n+    var loginCallbackUrl = appUtils.getTenantBasedLoginCallBack();\n+    if(loginCallbackUrl == null){", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "4fd999bd83e965211860c84912a1318aa7548b45"}, "originalPosition": 7}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjI5ODk3Njg4OnYy", "diffSide": "RIGHT", "path": "features/apimgt/org.wso2.carbon.apimgt.store.feature/src/main/resources/devportal/services/login/idp.jag", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yOFQxNDo0ODo1NFrOFinwNA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yOFQxNDo0ODo1NFrOFinwNA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MTg0NzIyMA==", "bodyText": "This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters. Learn more about bidirectional Unicode characters\n\n\n  \n\n\n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                if(logoutCallbackUrl == null){\n          \n          \n            \n                if (logoutCallbackUrl == null) {", "url": "https://github.com/wso2/carbon-apimgt/pull/8110#discussion_r371847220", "createdAt": "2020-01-28T14:48:54Z", "author": {"login": "malinthaprasan"}, "path": "features/apimgt/org.wso2.carbon.apimgt.store.feature/src/main/resources/devportal/services/login/idp.jag", "diffHunk": "@@ -40,8 +40,14 @@\n     var settingsResponse = get(settingsAPIUrl, {}, \"json\");\n \n     var dcrUrl = appUtils.getLoopbackOrigin() + DCR_URL_SUFFIX;\n-    var loginCallbackUrl = serverUrl + app.context + LOGIN_CALLBACK_URL_SUFFIX;\n-    var logoutCallbackUrl = serverUrl + app.context + LOGOUT_CALLBACK_URL_SUFFIX;\n+    var loginCallbackUrl = appUtils.getTenantBasedLoginCallBack();\n+    if(loginCallbackUrl == null){\n+        loginCallbackUrl = serverUrl + app.context + LOGIN_CALLBACK_URL_SUFFIX;\n+    }\n+    var logoutCallbackUrl = appUtils.getTenantBasedLogoutCallBack();\n+    if(logoutCallbackUrl == null){", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "4fd999bd83e965211860c84912a1318aa7548b45"}, "originalPosition": 11}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjI5ODk3Nzk2OnYy", "diffSide": "RIGHT", "path": "features/apimgt/org.wso2.carbon.apimgt.store.feature/src/main/resources/devportal/services/login/idp.jag", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yOFQxNDo0OTowN1rOFinw2w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yOFQxNDo0OTowN1rOFinw2w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MTg0NzM4Nw==", "bodyText": "This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters. Learn more about bidirectional Unicode characters\n\n\n  \n\n\n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                 }\n          \n          \n            \n                }", "url": "https://github.com/wso2/carbon-apimgt/pull/8110#discussion_r371847387", "createdAt": "2020-01-28T14:49:07Z", "author": {"login": "malinthaprasan"}, "path": "features/apimgt/org.wso2.carbon.apimgt.store.feature/src/main/resources/devportal/services/login/idp.jag", "diffHunk": "@@ -40,8 +40,14 @@\n     var settingsResponse = get(settingsAPIUrl, {}, \"json\");\n \n     var dcrUrl = appUtils.getLoopbackOrigin() + DCR_URL_SUFFIX;\n-    var loginCallbackUrl = serverUrl + app.context + LOGIN_CALLBACK_URL_SUFFIX;\n-    var logoutCallbackUrl = serverUrl + app.context + LOGOUT_CALLBACK_URL_SUFFIX;\n+    var loginCallbackUrl = appUtils.getTenantBasedLoginCallBack();\n+    if(loginCallbackUrl == null){\n+        loginCallbackUrl = serverUrl + app.context + LOGIN_CALLBACK_URL_SUFFIX;\n+    }\n+    var logoutCallbackUrl = appUtils.getTenantBasedLogoutCallBack();\n+    if(logoutCallbackUrl == null){\n+         logoutCallbackUrl = serverUrl + app.context + LOGOUT_CALLBACK_URL_SUFFIX;\n+     }", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "4fd999bd83e965211860c84912a1318aa7548b45"}, "originalPosition": 13}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjI5ODk3OTI5OnYy", "diffSide": "RIGHT", "path": "features/apimgt/org.wso2.carbon.apimgt.store.feature/src/main/resources/devportal/services/login/idp.jag", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yOFQxNDo0OToyNVrOFinxvQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yOFQxNDo0OToyNVrOFinxvQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MTg0NzYxMw==", "bodyText": "Shall we remove this?", "url": "https://github.com/wso2/carbon-apimgt/pull/8110#discussion_r371847613", "createdAt": "2020-01-28T14:49:25Z", "author": {"login": "malinthaprasan"}, "path": "features/apimgt/org.wso2.carbon.apimgt.store.feature/src/main/resources/devportal/services/login/idp.jag", "diffHunk": "@@ -59,32 +65,35 @@\n     var SystemApplicationDAO = Packages.org.wso2.carbon.apimgt.impl.dao.SystemApplicationDAO;\n     var systemApplicationDAO = new SystemApplicationDAO();\n     var clientId ;\n+    var serviceProviderTenantDomain = appUtils.getServiceProviderTenantDomain();\n+    log.info(serviceProviderTenantDomain);\n     // this is to support migration from admin_store to admin_devportal\n-    systemApplicationDTO = systemApplicationDAO.getClientCredentialsForApplication(STORE_CLIENT_APP_NAME);\n+    systemApplicationDTO = systemApplicationDAO.getClientCredentialsForApplication(STORE_CLIENT_APP_NAME,serviceProviderTenantDomain);\n     if (systemApplicationDTO === null) {\n-        systemApplicationDTO = systemApplicationDAO.getClientCredentialsForApplication(STORE_CLIENT_APP_NAME_OLD);\n+        systemApplicationDTO = systemApplicationDAO.getClientCredentialsForApplication(STORE_CLIENT_APP_NAME_OLD,serviceProviderTenantDomain);\n     }\n \n     var lock = SystemApplicationDAO.getLock();\n     if (systemApplicationDTO  !== null) {\n         clientId = systemApplicationDTO.getConsumerKey();\n+        log.info(\"clientid::\"+clientId);\n     } else {\n         try {\n             lock.acquire();\n             // this is to support migration from admin_store to admin_devportal\n-            systemApplicationDTO = systemApplicationDAO.getClientCredentialsForApplication(STORE_CLIENT_APP_NAME);\n+            systemApplicationDTO = systemApplicationDAO.getClientCredentialsForApplication(STORE_CLIENT_APP_NAME,serviceProviderTenantDomain);\n             if (systemApplicationDTO === null) {\n-                systemApplicationDTO = systemApplicationDAO.getClientCredentialsForApplication(STORE_CLIENT_APP_NAME_OLD);\n+                systemApplicationDTO = systemApplicationDAO.getClientCredentialsForApplication(STORE_CLIENT_APP_NAME_OLD,serviceProviderTenantDomain);\n             }\n             if (systemApplicationDTO === null) {\n                 var dcrRequestData = {\n                     \"callbackUrl\": callbackUrl,\n                     \"clientName\": STORE_CLIENT_APP_NAME,\n-                    \"owner\": String(utils.getAdminUsername()),\n+                    \"owner\": String(utils.getTenantAdminUserName(serviceProviderTenantDomain)),\n                     \"grantType\": \"authorization_code refresh_token\",\n                     \"saasApp\": true\n                 };\n-\n+                log.info(dcrRequestData);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "4fd999bd83e965211860c84912a1318aa7548b45"}, "originalPosition": 55}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjI5ODk4MDIzOnYy", "diffSide": "RIGHT", "path": "features/apimgt/org.wso2.carbon.apimgt.store.feature/src/main/resources/devportal/services/login/login_callback.jag", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yOFQxNDo0OTozOVrOFinyTQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yOFQxNDo0OTozOVrOFinyTQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MTg0Nzc1Nw==", "bodyText": "This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters. Learn more about bidirectional Unicode characters\n\n\n  \n\n\n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                if(loginCallbackUrl == null){\n          \n          \n            \n                if (loginCallbackUrl == null) {", "url": "https://github.com/wso2/carbon-apimgt/pull/8110#discussion_r371847757", "createdAt": "2020-01-28T14:49:39Z", "author": {"login": "malinthaprasan"}, "path": "features/apimgt/org.wso2.carbon.apimgt.store.feature/src/main/resources/devportal/services/login/login_callback.jag", "diffHunk": "@@ -28,17 +29,25 @@\n     } else {\n         serverUrl = utils.getServerURL();\n     }\n+    var loginCallbackUrl = appUtils.getTenantBasedLoginCallBack();\n+    if(loginCallbackUrl == null){", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "4fd999bd83e965211860c84912a1318aa7548b45"}, "originalPosition": 13}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjI5ODk4MDk0OnYy", "diffSide": "RIGHT", "path": "features/apimgt/org.wso2.carbon.apimgt.store.feature/src/main/resources/devportal/services/login/login_callback.jag", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yOFQxNDo0OTo1MVrOFinyvQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yOFQxNDo0OTo1MVrOFinyvQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MTg0Nzg2OQ==", "bodyText": "This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters. Learn more about bidirectional Unicode characters\n\n\n  \n\n\n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                 }\n          \n          \n            \n                }", "url": "https://github.com/wso2/carbon-apimgt/pull/8110#discussion_r371847869", "createdAt": "2020-01-28T14:49:51Z", "author": {"login": "malinthaprasan"}, "path": "features/apimgt/org.wso2.carbon.apimgt.store.feature/src/main/resources/devportal/services/login/login_callback.jag", "diffHunk": "@@ -28,17 +29,25 @@\n     } else {\n         serverUrl = utils.getServerURL();\n     }\n+    var loginCallbackUrl = appUtils.getTenantBasedLoginCallBack();\n+    if(loginCallbackUrl == null){\n+        loginCallbackUrl = serverUrl + app.context + LOGIN_CALLBACK_URL_SUFFIX;\n+     }", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "4fd999bd83e965211860c84912a1318aa7548b45"}, "originalPosition": 15}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjI5ODk4MTc4OnYy", "diffSide": "RIGHT", "path": "features/apimgt/org.wso2.carbon.apimgt.store.feature/src/main/resources/devportal/services/login/login_callback.jag", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yOFQxNDo1MDowMlrOFinzUQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yOFQxNDo1MDowMlrOFinzUQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MTg0ODAxNw==", "bodyText": "This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters. Learn more about bidirectional Unicode characters\n\n\n  \n\n\n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                 if(appUtils.isPerTenantServiceProviderEnabled()){\n          \n          \n            \n                 if (appUtils.isPerTenantServiceProviderEnabled()) {", "url": "https://github.com/wso2/carbon-apimgt/pull/8110#discussion_r371848017", "createdAt": "2020-01-28T14:50:02Z", "author": {"login": "malinthaprasan"}, "path": "features/apimgt/org.wso2.carbon.apimgt.store.feature/src/main/resources/devportal/services/login/login_callback.jag", "diffHunk": "@@ -28,17 +29,25 @@\n     } else {\n         serverUrl = utils.getServerURL();\n     }\n+    var loginCallbackUrl = appUtils.getTenantBasedLoginCallBack();\n+    if(loginCallbackUrl == null){\n+        loginCallbackUrl = serverUrl + app.context + LOGIN_CALLBACK_URL_SUFFIX;\n+     }\n     var tokenRequestData = {\n         \"grant_type\": \"authorization_code\",\n         \"code\": request.getParameter(\"code\",\"UTF-8\"),\n-        \"redirect_uri\": serverUrl + app.context + LOGIN_CALLBACK_URL_SUFFIX\n+        \"redirect_uri\": loginCallbackUrl\n     };\n+     var tenantDomain = \"carbon.super\" ;\n+     if(appUtils.isPerTenantServiceProviderEnabled()){", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "4fd999bd83e965211860c84912a1318aa7548b45"}, "originalPosition": 23}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjI5ODk4MjQ0OnYy", "diffSide": "RIGHT", "path": "features/apimgt/org.wso2.carbon.apimgt.store.feature/src/main/resources/devportal/services/login/login_callback.jag", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yOFQxNDo1MDoxMlrOFinztg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yOFQxNDo1MDoxMlrOFinztg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MTg0ODExOA==", "bodyText": "This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters. Learn more about bidirectional Unicode characters\n\n\n  \n\n\n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                  }\n          \n          \n            \n                 }", "url": "https://github.com/wso2/carbon-apimgt/pull/8110#discussion_r371848118", "createdAt": "2020-01-28T14:50:12Z", "author": {"login": "malinthaprasan"}, "path": "features/apimgt/org.wso2.carbon.apimgt.store.feature/src/main/resources/devportal/services/login/login_callback.jag", "diffHunk": "@@ -28,17 +29,25 @@\n     } else {\n         serverUrl = utils.getServerURL();\n     }\n+    var loginCallbackUrl = appUtils.getTenantBasedLoginCallBack();\n+    if(loginCallbackUrl == null){\n+        loginCallbackUrl = serverUrl + app.context + LOGIN_CALLBACK_URL_SUFFIX;\n+     }\n     var tokenRequestData = {\n         \"grant_type\": \"authorization_code\",\n         \"code\": request.getParameter(\"code\",\"UTF-8\"),\n-        \"redirect_uri\": serverUrl + app.context + LOGIN_CALLBACK_URL_SUFFIX\n+        \"redirect_uri\": loginCallbackUrl\n     };\n+     var tenantDomain = \"carbon.super\" ;\n+     if(appUtils.isPerTenantServiceProviderEnabled()){\n+        tenantDomain = appUtils.getTenantDomain();\n+      }", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "4fd999bd83e965211860c84912a1318aa7548b45"}, "originalPosition": 25}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjI5ODk4MzAzOnYy", "diffSide": "RIGHT", "path": "features/apimgt/org.wso2.carbon.apimgt.store.feature/src/main/resources/devportal/services/logout/logout.jag", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yOFQxNDo1MDoyMVrOFin0GQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yOFQxNDo1MDoyMVrOFin0GQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MTg0ODIxNw==", "bodyText": "This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters. Learn more about bidirectional Unicode characters\n\n\n  \n\n\n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                if(postLogoutRedirectURI == null){\n          \n          \n            \n                if (postLogoutRedirectURI == null) {", "url": "https://github.com/wso2/carbon-apimgt/pull/8110#discussion_r371848217", "createdAt": "2020-01-28T14:50:21Z", "author": {"login": "malinthaprasan"}, "path": "features/apimgt/org.wso2.carbon.apimgt.store.feature/src/main/resources/devportal/services/logout/logout.jag", "diffHunk": "@@ -38,7 +39,10 @@\n     if (idpConfig != null) {\n         logoutEndpoint = idpConfig.getOidcLogoutEndpoint();\n     }\n-    var postLogoutRedirectURI = serverUrl + app.context + LOGOUT_CALLBACK_URL_SUFFIX;\n+    var postLogoutRedirectURI = appUtils.getTenantBasedLogoutCallBack();\n+    if(postLogoutRedirectURI == null){", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "4fd999bd83e965211860c84912a1318aa7548b45"}, "originalPosition": 14}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjI5ODk4MzYxOnYy", "diffSide": "RIGHT", "path": "features/apimgt/org.wso2.carbon.apimgt.store.feature/src/main/resources/devportal/services/logout/logout.jag", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yOFQxNDo1MDozMFrOFin0eg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yOFQxNDo1MDozMFrOFin0eg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MTg0ODMxNA==", "bodyText": "This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters. Learn more about bidirectional Unicode characters\n\n\n  \n\n\n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                 }\n          \n          \n            \n                }", "url": "https://github.com/wso2/carbon-apimgt/pull/8110#discussion_r371848314", "createdAt": "2020-01-28T14:50:30Z", "author": {"login": "malinthaprasan"}, "path": "features/apimgt/org.wso2.carbon.apimgt.store.feature/src/main/resources/devportal/services/logout/logout.jag", "diffHunk": "@@ -38,7 +39,10 @@\n     if (idpConfig != null) {\n         logoutEndpoint = idpConfig.getOidcLogoutEndpoint();\n     }\n-    var postLogoutRedirectURI = serverUrl + app.context + LOGOUT_CALLBACK_URL_SUFFIX;\n+    var postLogoutRedirectURI = appUtils.getTenantBasedLogoutCallBack();\n+    if(postLogoutRedirectURI == null){\n+         postLogoutRedirectURI = serverUrl + app.context + LOGOUT_CALLBACK_URL_SUFFIX;\n+     }", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "4fd999bd83e965211860c84912a1318aa7548b45"}, "originalPosition": 16}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjI5ODk4NDI5OnYy", "diffSide": "RIGHT", "path": "features/apimgt/org.wso2.carbon.apimgt.store.feature/src/main/resources/devportal/services/refresh/refresh.jag", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yOFQxNDo1MDo0M1rOFin08g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yOFQxNDo1MDo0M1rOFin08g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MTg0ODQzNA==", "bodyText": "This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters. Learn more about bidirectional Unicode characters\n\n\n  \n\n\n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                 if(appUtils.isPerTenantServiceProviderEnabled()){\n          \n          \n            \n                if (appUtils.isPerTenantServiceProviderEnabled()) {", "url": "https://github.com/wso2/carbon-apimgt/pull/8110#discussion_r371848434", "createdAt": "2020-01-28T14:50:43Z", "author": {"login": "malinthaprasan"}, "path": "features/apimgt/org.wso2.carbon.apimgt.store.feature/src/main/resources/devportal/services/refresh/refresh.jag", "diffHunk": "@@ -20,7 +20,11 @@\n     include(\"/services/constants.jag\");\n     var appUtils = require(\"/services/utils.js\");\n     var app = require(\"/site/public/theme/settings.js\").Settings.app;\n-\n+    app.context = appUtils.getTenantBaseStoreContext();\n+    var tenantDomain;\n+     if(appUtils.isPerTenantServiceProviderEnabled()){", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "4fd999bd83e965211860c84912a1318aa7548b45"}, "originalPosition": 7}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjI5ODk4NTgzOnYy", "diffSide": "RIGHT", "path": "features/apimgt/org.wso2.carbon.apimgt.store.feature/src/main/resources/devportal/services/refresh/refresh.jag", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yOFQxNDo1MTowMlrOFin1zw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yOFQxNDo1MTowMlrOFin1zw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MTg0ODY1NQ==", "bodyText": "This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters. Learn more about bidirectional Unicode characters\n\n\n  \n\n\n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                  }\n          \n          \n            \n                 }", "url": "https://github.com/wso2/carbon-apimgt/pull/8110#discussion_r371848655", "createdAt": "2020-01-28T14:51:02Z", "author": {"login": "malinthaprasan"}, "path": "features/apimgt/org.wso2.carbon.apimgt.store.feature/src/main/resources/devportal/services/refresh/refresh.jag", "diffHunk": "@@ -20,7 +20,11 @@\n     include(\"/services/constants.jag\");\n     var appUtils = require(\"/services/utils.js\");\n     var app = require(\"/site/public/theme/settings.js\").Settings.app;\n-\n+    app.context = appUtils.getTenantBaseStoreContext();\n+    var tenantDomain;\n+     if(appUtils.isPerTenantServiceProviderEnabled()){\n+        tenantDomain = appUtils.getTenantDomain();\n+      }", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "4fd999bd83e965211860c84912a1318aa7548b45"}, "originalPosition": 9}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjI5ODk4NjU3OnYy", "diffSide": "RIGHT", "path": "features/apimgt/org.wso2.carbon.apimgt.store.feature/src/main/resources/devportal/services/utils.js", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yOFQxNDo1MToxMlrOFin2Qg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yOFQxNDo1MToxMlrOFin2Qg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MTg0ODc3MA==", "bodyText": "This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters. Learn more about bidirectional Unicode characters\n\n\n  \n\n\n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            var getTenantBasedLogoutCallBack = function() {\n          \n          \n            \n            \n          \n          \n            \n            var getTenantBasedLogoutCallBack = function() {", "url": "https://github.com/wso2/carbon-apimgt/pull/8110#discussion_r371848770", "createdAt": "2020-01-28T14:51:12Z", "author": {"login": "malinthaprasan"}, "path": "features/apimgt/org.wso2.carbon.apimgt.store.feature/src/main/resources/devportal/services/utils.js", "diffHunk": "@@ -20,9 +20,73 @@\n var app = require('/site/public/theme/settings.js').Settings.app;\n \n var utils = Packages.org.wso2.carbon.apimgt.impl.utils.APIUtil;\n+include(\"/services/constants.jag\");\n \n var getLoopbackOrigin = function() {\n     var mgtTransportPort = utils.getCarbonTransportPort(\"https\");\n     var origin = 'https://' + app.origin.host + \":\" + mgtTransportPort;\n     return origin;\n };\n+\n+var getTenantBaseStoreContext = function() {\n+    var tenantDomain = getTenantDomain();\n+    var tenantContext = utils.getTenantBasedDevPortalContext(tenantDomain);\n+    if (tenantContext != null) {\n+        return tenantContext\n+    } else {\n+        return app.context;\n+    }\n+};\n+\n+var getTenantBasedLoginCallBack = function() {\n+    var tenantDomain = getTenantDomain();\n+    var storeDomainMapping = utils.getTenantBasedStoreDomainMapping(tenantDomain);\n+    if (storeDomainMapping != null) {\n+       if (storeDomainMapping.get('login') != null) {\n+        return storeDomainMapping.get('login');\n+       }\n+        return \"https://\"+storeDomainMapping.get('customUrl')+LOGIN_CALLBACK_URL_SUFFIX;\n+    }else{\n+    return null;\n+    }\n+};\n+var getTenantBasedLogoutCallBack = function() {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "4fd999bd83e965211860c84912a1318aa7548b45"}, "originalPosition": 34}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2914, "cost": 1, "resetAt": "2021-11-13T14:23:39Z"}}}