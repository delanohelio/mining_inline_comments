{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDMyMzA4Njc2", "number": 8697, "title": "improve keymanagement to store information related to oauth app info", "bodyText": "", "createdAt": "2020-06-10T08:56:32Z", "url": "https://github.com/wso2/carbon-apimgt/pull/8697", "merged": true, "mergeCommit": {"oid": "3d36fb9cfd3fae63519ba54c9d7e02ab7e2c5fe8"}, "closed": true, "closedAt": "2020-06-10T17:43:52Z", "author": {"login": "tharindu1st"}, "timelineItems": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcp1w9EgH2gAyNDMyMzA4Njc2Ojg3OTI4YzIwZjk3ODI3NDNmNmQ3MDZkY2YyMjRkZTE1OTU0OTgzNTI=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcp3FYZAH2gAyNDMyMzA4Njc2OjY2OWE3YTI4ZjJmZmE1YmEzZDNkZGM2N2JiNWRhZDg2YjhhMGQ4OTU=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "87928c20f9782743f6d706dcf224de1595498352", "author": {"user": {"login": "tharindu1st", "name": "Tharindu Dasun Dharmarathna"}}, "url": "https://github.com/wso2/carbon-apimgt/commit/87928c20f9782743f6d706dcf224de1595498352", "committedDate": "2020-06-10T08:55:25Z", "message": "improve keymanagement to store information related to oauth app info"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDI3ODUzNjE4", "url": "https://github.com/wso2/carbon-apimgt/pull/8697#pullrequestreview-427853618", "createdAt": "2020-06-10T08:58:30Z", "commit": {"oid": "87928c20f9782743f6d706dcf224de1595498352"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDI3ODY0MTIx", "url": "https://github.com/wso2/carbon-apimgt/pull/8697#pullrequestreview-427864121", "createdAt": "2020-06-10T09:11:36Z", "commit": {"oid": "87928c20f9782743f6d706dcf224de1595498352"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDI3ODY0Njk1", "url": "https://github.com/wso2/carbon-apimgt/pull/8697#pullrequestreview-427864695", "createdAt": "2020-06-10T09:12:24Z", "commit": {"oid": "87928c20f9782743f6d706dcf224de1595498352"}, "state": "DISMISSED", "comments": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xMFQwOToxMjoyNFrOGhsGGA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xMFQwOToxNzoxMFrOGhsRIA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNzk3ODY0OA==", "bodyText": "appMetaData", "url": "https://github.com/wso2/carbon-apimgt/pull/8697#discussion_r437978648", "createdAt": "2020-06-10T09:12:24Z", "author": {"login": "isharac"}, "path": "components/apimgt/org.wso2.carbon.apimgt.api/src/main/java/org/wso2/carbon/apimgt/api/model/APIKey.java", "diffHunk": "@@ -32,6 +32,7 @@\n     private String grantTypes;\n     private Object additionalProperties;\n     private String keyManager;\n+    private String appMetadata;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "87928c20f9782743f6d706dcf224de1595498352"}, "originalPosition": 4}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNzk3OTAzNQ==", "bodyText": "formatting issue", "url": "https://github.com/wso2/carbon-apimgt/pull/8697#discussion_r437979035", "createdAt": "2020-06-10T09:13:04Z", "author": {"login": "isharac"}, "path": "components/apimgt/org.wso2.carbon.apimgt.impl/src/main/java/org/wso2/carbon/apimgt/impl/APIConsumerImpl.java", "diffHunk": "@@ -4699,7 +4699,7 @@ public OAuthApplicationInfo updateAuthClient(String userId, String applicationNa\n             oauthAppRequest.getOAuthApplicationInfo().putAllAppAttributes(application.getApplicationAttributes());\n             //call update method.\n             OAuthApplicationInfo updatedAppInfo = keyManager.updateApplication(oauthAppRequest);\n-\n+            apiMgtDAO.updateApplicationKeyTypeMetaData(application.getId(),tokenType,keyManagerName,updatedAppInfo);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "87928c20f9782743f6d706dcf224de1595498352"}, "originalPosition": 5}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNzk3OTI2Mw==", "bodyText": "need to format the code", "url": "https://github.com/wso2/carbon-apimgt/pull/8697#discussion_r437979263", "createdAt": "2020-06-10T09:13:27Z", "author": {"login": "isharac"}, "path": "components/apimgt/org.wso2.carbon.apimgt.impl/src/main/java/org/wso2/carbon/apimgt/impl/AbstractAPIManager.java", "diffHunk": "@@ -3094,6 +3095,23 @@ protected String getSearchQuery(String searchQuery) throws APIManagementExceptio\n                 KeyManager keyManager = KeyManagerHolder.getKeyManagerInstance(tenantDomain, keyManagerName);\n                 if (keyManager != null) {\n                     OAuthApplicationInfo oAuthApplicationInfo = keyManager.retrieveApplication(consumerKey);\n+                    if (StringUtils.isNotEmpty(apiKey.getAppMetadata())){", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "87928c20f9782743f6d706dcf224de1595498352"}, "originalPosition": 12}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNzk4MDI5NQ==", "bodyText": "why final here?\nAlso better to move the query to SQLConstants", "url": "https://github.com/wso2/carbon-apimgt/pull/8697#discussion_r437980295", "createdAt": "2020-06-10T09:15:07Z", "author": {"login": "isharac"}, "path": "components/apimgt/org.wso2.carbon.apimgt.impl/src/main/java/org/wso2/carbon/apimgt/impl/dao/ApiMgtDAO.java", "diffHunk": "@@ -8713,7 +8711,7 @@ public boolean isKeyManagerConfigurationExistByName(String name, String tenantDo\n     }\n \n     public Set<APIKey> getKeyMappingsFromApplicationId(int applicationId) throws APIManagementException{\n-        final String query = \"SELECT UUID,CONSUMER_KEY,KEY_MANAGER,KEY_TYPE,STATE FROM AM_APPLICATION_KEY_MAPPING \" +\n+        final String query = \"SELECT UUID,CONSUMER_KEY,KEY_MANAGER,KEY_TYPE,STATE,APP_INFO FROM AM_APPLICATION_KEY_MAPPING \" +", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "87928c20f9782743f6d706dcf224de1595498352"}, "originalPosition": 61}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNzk4MTQ3Mg==", "bodyText": "applicationId > 0 isn't it?", "url": "https://github.com/wso2/carbon-apimgt/pull/8697#discussion_r437981472", "createdAt": "2020-06-10T09:17:10Z", "author": {"login": "isharac"}, "path": "components/apimgt/org.wso2.carbon.apimgt.impl/src/main/java/org/wso2/carbon/apimgt/impl/dao/ApiMgtDAO.java", "diffHunk": "@@ -8804,6 +8809,43 @@ public String getKeyMappingIdFromApplicationIdKeyTypeAndKeyManager(int applicati\n         return null;\n     }\n \n+    /**\n+     * This method used to update Application metadata according to oauth app info\n+     * @param applicationId\n+     * @param keyType\n+     * @param keyManagerName\n+     * @param updatedAppInfo\n+     * @throws APIManagementException\n+     */\n+    public void updateApplicationKeyTypeMetaData(int applicationId, String keyType, String keyManagerName,\n+                                                 OAuthApplicationInfo updatedAppInfo) throws APIManagementException {\n+\n+        if (applicationId != -1 && updatedAppInfo != null) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "87928c20f9782743f6d706dcf224de1595498352"}, "originalPosition": 100}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "669a7a28f2ffa5ba3d3ddc67bb5dad86b8a0d895", "author": {"user": {"login": "tharindu1st", "name": "Tharindu Dasun Dharmarathna"}}, "url": "https://github.com/wso2/carbon-apimgt/commit/669a7a28f2ffa5ba3d3ddc67bb5dad86b8a0d895", "committedDate": "2020-06-10T10:27:38Z", "message": "add reviewed fixes"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2717, "cost": 1, "resetAt": "2021-11-02T10:47:05Z"}}}