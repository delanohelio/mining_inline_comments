{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDM5MTc5NTk4", "number": 8824, "title": "GraphQL Query Complexity Analysis & Fix Generate API Key UI issue", "bodyText": "Generate API Key UI\n\nFixes #wso2/product-apim#8443", "createdAt": "2020-06-24T12:36:59Z", "url": "https://github.com/wso2/carbon-apimgt/pull/8824", "merged": true, "mergeCommit": {"oid": "60ce296dd1200db8c732895e670d9fbecdef65f1"}, "closed": true, "closedAt": "2020-06-24T14:14:37Z", "author": {"login": "rasika1995"}, "timelineItems": {"totalCount": 17, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcrHqxogH2gAyNDM5MTc5NTk4OmFjM2M0NWNkNDY0NTVlYmE2NDA3NzAxNWMzMWZhNDhkOGY1ZjFkM2E=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcuathRgFqTQzNjY4Nzk3Mw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "ac3c45cd46455eba64077015c31fa48d8f5f1d3a", "author": {"user": {"login": "rasika1995", "name": null}}, "url": "https://github.com/wso2/carbon-apimgt/commit/ac3c45cd46455eba64077015c31fa48d8f5f1d3a", "committedDate": "2020-06-14T08:20:53Z", "message": "modify GraphQLQueryAnalysisHandler"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "1bd7f23711da267e7b9535d7bfb49b3ca893aa25", "author": {"user": {"login": "rasika1995", "name": null}}, "url": "https://github.com/wso2/carbon-apimgt/commit/1bd7f23711da267e7b9535d7bfb49b3ca893aa25", "committedDate": "2020-06-14T08:26:44Z", "message": "Merge branch 'master' of https://github.com/wso2/carbon-apimgt into test1"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "32b524cb19a5934d20921b03ca58d3fb3bfb5c86", "author": {"user": {"login": "rasika1995", "name": null}}, "url": "https://github.com/wso2/carbon-apimgt/commit/32b524cb19a5934d20921b03ca58d3fb3bfb5c86", "committedDate": "2020-06-15T06:13:56Z", "message": "modify addSubscriptionPolicy method"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "52cee1f846d8fcd6fa16f1f00e6a6dac16857084", "author": {"user": {"login": "rasika1995", "name": null}}, "url": "https://github.com/wso2/carbon-apimgt/commit/52cee1f846d8fcd6fa16f1f00e6a6dac16857084", "committedDate": "2020-06-16T06:38:56Z", "message": "modify add custom complexity method"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "edbc0d837772f4578e3661a9679c443b27bc8e55", "author": {"user": {"login": "rasika1995", "name": null}}, "url": "https://github.com/wso2/carbon-apimgt/commit/edbc0d837772f4578e3661a9679c443b27bc8e55", "committedDate": "2020-06-22T16:05:47Z", "message": "Change of CRUD functionality of subscription policy"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "37e2b7b533d73c3a7bdc68f3a15c4a45e31a7ffc", "author": {"user": {"login": "rasika1995", "name": null}}, "url": "https://github.com/wso2/carbon-apimgt/commit/37e2b7b533d73c3a7bdc68f3a15c4a45e31a7ffc", "committedDate": "2020-06-24T07:02:06Z", "message": "Change the Query Analysis UI"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "0ec065bb452ea23970c7613985d934e5e491f548", "author": {"user": {"login": "rasika1995", "name": null}}, "url": "https://github.com/wso2/carbon-apimgt/commit/0ec065bb452ea23970c7613985d934e5e491f548", "committedDate": "2020-06-24T09:50:10Z", "message": "modify query analysis handler"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e0813dc6c78936ec5c3f1ee2b80a8fc65fe94f4d", "author": {"user": {"login": "rasika1995", "name": null}}, "url": "https://github.com/wso2/carbon-apimgt/commit/e0813dc6c78936ec5c3f1ee2b80a8fc65fe94f4d", "committedDate": "2020-06-24T09:51:34Z", "message": "Merge branch 'master' of https://github.com/wso2/carbon-apimgt into test1"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "5486fe337c512a521e2e2d45208921d6e4cbcdc6", "author": {"user": {"login": "rasika1995", "name": null}}, "url": "https://github.com/wso2/carbon-apimgt/commit/5486fe337c512a521e2e2d45208921d6e4cbcdc6", "committedDate": "2020-06-24T10:41:12Z", "message": "modify AM_POLICY_SUBSCRIPTION table"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f78bf8d1f15b24a93497afbe6e5af3de7558ae2f", "author": {"user": {"login": "rasika1995", "name": null}}, "url": "https://github.com/wso2/carbon-apimgt/commit/f78bf8d1f15b24a93497afbe6e5af3de7558ae2f", "committedDate": "2020-06-24T11:41:40Z", "message": "modify UpdateComplexity"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDM2NjM3MTU5", "url": "https://github.com/wso2/carbon-apimgt/pull/8824#pullrequestreview-436637159", "createdAt": "2020-06-24T13:19:11Z", "commit": {"oid": "f78bf8d1f15b24a93497afbe6e5af3de7558ae2f"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yNFQxMzoxOToxMVrOGoRuRw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yNFQxMzoxOToxMVrOGoRuRw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NDg4NjU5OQ==", "bodyText": "same dependency added twice. Remove one.", "url": "https://github.com/wso2/carbon-apimgt/pull/8824#discussion_r444886599", "createdAt": "2020-06-24T13:19:11Z", "author": {"login": "fazlan-nazeem"}, "path": "components/apimgt/org.wso2.carbon.apimgt.gateway/pom.xml", "diffHunk": "@@ -299,6 +299,14 @@\n             <groupId>org.wso2.orbit.com.amazonaws</groupId>\n             <artifactId>awslambda</artifactId>\n         </dependency>\n+        <dependency>\n+            <groupId>org.wso2.carbon.apimgt</groupId>\n+            <artifactId>org.wso2.carbon.apimgt.rest.api.util</artifactId>\n+        </dependency>\n+        <dependency>", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f78bf8d1f15b24a93497afbe6e5af3de7558ae2f"}, "originalPosition": 8}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDM2NjM5MTI5", "url": "https://github.com/wso2/carbon-apimgt/pull/8824#pullrequestreview-436639129", "createdAt": "2020-06-24T13:21:23Z", "commit": {"oid": "f78bf8d1f15b24a93497afbe6e5af3de7558ae2f"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yNFQxMzoyMToyM1rOGoRz4Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yNFQxMzoyMToyM1rOGoRz4Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NDg4ODAzMw==", "bodyText": "don't print stacktrace.", "url": "https://github.com/wso2/carbon-apimgt/pull/8824#discussion_r444888033", "createdAt": "2020-06-24T13:21:23Z", "author": {"login": "fazlan-nazeem"}, "path": "components/apimgt/org.wso2.carbon.apimgt.gateway/src/main/java/org/wso2/carbon/apimgt/gateway/handlers/graphQL/GraphQLQueryAnalysisHandler.java", "diffHunk": "@@ -201,17 +199,13 @@ private boolean analyseQueryComplexity(MessageContext messageContext, String pay\n                         errorList.clear();\n                         errorList.add(\"maximum query complexity exceeded\");\n                     }\n-\n                     handleFailure(APISecurityConstants.GRAPHQL_QUERY_TOO_COMPLEX, messageContext,\n                             APISecurityConstants.GRAPHQL_QUERY_TOO_COMPLEX_MESSAGE, errorList.toString());\n                     return false;\n                 }\n-                if (log.isDebugEnabled()) {\n-                    log.debug(\"Maximum query complexity was not exceeded\");\n-                }\n                 return true;\n             } catch (Exception e) {\n-                log.error(e.getMessage(), e);\n+                e.printStackTrace();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f78bf8d1f15b24a93497afbe6e5af3de7558ae2f"}, "originalPosition": 177}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDM2NjQ3Mzk4", "url": "https://github.com/wso2/carbon-apimgt/pull/8824#pullrequestreview-436647398", "createdAt": "2020-06-24T13:30:24Z", "commit": {"oid": "f78bf8d1f15b24a93497afbe6e5af3de7558ae2f"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yNFQxMzozMDoyNFrOGoSMIQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yNFQxMzozMDoyNFrOGoSMIQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NDg5NDI0MQ==", "bodyText": "remove newline", "url": "https://github.com/wso2/carbon-apimgt/pull/8824#discussion_r444894241", "createdAt": "2020-06-24T13:30:24Z", "author": {"login": "fazlan-nazeem"}, "path": "components/apimgt/org.wso2.carbon.apimgt.impl/src/main/java/org/wso2/carbon/apimgt/impl/dao/ApiMgtDAO.java", "diffHunk": "@@ -14490,6 +14423,34 @@ public void updateComplexityDetails(APIIdentifier apiIdentifier, GraphqlComplexi\n     }\n \n \n+    /**\n+     * Add or Update complexity details\n+     *\n+     * @param apiIdentifier         APIIdentifier object to retrieve API ID\n+     * @param graphqlComplexityInfo GraphqlComplexityDetails object\n+     * @throws APIManagementException\n+     */\n+    public void addOrUpdateComplexityDetails(APIIdentifier apiIdentifier, GraphqlComplexityInfo graphqlComplexityInfo)\n+            throws APIManagementException {\n+        String getCustomComplexityDetailsQuery = SQLConstants.GET_CUSTOM_COMPLEXITY_DETAILS_SQL;\n+        try (Connection conn = APIMgtDBUtil.getConnection();\n+             PreparedStatement getCustomComplexityDetails = conn.prepareStatement(getCustomComplexityDetailsQuery)) {\n+            int apiId = getAPIID(apiIdentifier, conn);\n+            getCustomComplexityDetails.setInt(1, apiId);\n+            try (ResultSet rs1 = getCustomComplexityDetails.executeQuery()) {\n+                if (rs1.next()) {\n+                    updateComplexityDetails(apiIdentifier, graphqlComplexityInfo);\n+                } else {\n+                    addComplexityDetails(apiIdentifier, graphqlComplexityInfo);\n+                }\n+", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f78bf8d1f15b24a93497afbe6e5af3de7558ae2f"}, "originalPosition": 306}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDM2NjQ4MzM0", "url": "https://github.com/wso2/carbon-apimgt/pull/8824#pullrequestreview-436648334", "createdAt": "2020-06-24T13:31:25Z", "commit": {"oid": "f78bf8d1f15b24a93497afbe6e5af3de7558ae2f"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yNFQxMzozMToyNVrOGoSO1Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yNFQxMzozMToyNVrOGoSO1Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NDg5NDkzMw==", "bodyText": "formatting issue", "url": "https://github.com/wso2/carbon-apimgt/pull/8824#discussion_r444894933", "createdAt": "2020-06-24T13:31:25Z", "author": {"login": "fazlan-nazeem"}, "path": "components/apimgt/org.wso2.carbon.apimgt.keymgt/src/test/resources/dbscripts/h2.sql", "diffHunk": "@@ -1559,19 +1559,13 @@ CREATE TABLE IF NOT EXISTS AM_POLICY_SUBSCRIPTION (\n             BILLING_CYCLE VARCHAR(15),\n             PRICE_PER_REQUEST VARCHAR(15),\n             CURRENCY VARCHAR(15),\n+\t    MAX_COMPLEXITY INT(11),", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f78bf8d1f15b24a93497afbe6e5af3de7558ae2f"}, "originalPosition": 4}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDM2NjQ4ODA3", "url": "https://github.com/wso2/carbon-apimgt/pull/8824#pullrequestreview-436648807", "createdAt": "2020-06-24T13:31:55Z", "commit": {"oid": "f78bf8d1f15b24a93497afbe6e5af3de7558ae2f"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yNFQxMzozMTo1NVrOGoSQRA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yNFQxMzozMTo1NVrOGoSQRA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NDg5NTMwMA==", "bodyText": "formatting issue", "url": "https://github.com/wso2/carbon-apimgt/pull/8824#discussion_r444895300", "createdAt": "2020-06-24T13:31:55Z", "author": {"login": "fazlan-nazeem"}, "path": "components/apimgt/org.wso2.carbon.apimgt.rest.api.admin.v1/src/main/java/org/wso2/carbon/apimgt/rest/api/admin/v1/utils/mappings/throttling/SubscriptionThrottlePolicyMappingUtil.java", "diffHunk": "@@ -123,8 +123,12 @@ public static SubscriptionPolicy fromSubscriptionThrottlePolicyDTOToModel(Subscr\n         subscriptionPolicy.setRateLimitTimeUnit(dto.getRateLimitTimeUnit());\n         subscriptionPolicy.setRateLimitCount(dto.getRateLimitCount());\n         subscriptionPolicy.setStopOnQuotaReach(dto.isStopOnQuotaReach());\n-        subscriptionPolicy.setGraphQLMaxComplexity(dto.getGraphQLMaxComplexity());\n-        subscriptionPolicy.setGraphQLMaxDepth(dto.getGraphQLMaxDepth());\n+        if(dto.getGraphQLMaxComplexity() != null){", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f78bf8d1f15b24a93497afbe6e5af3de7558ae2f"}, "originalPosition": 6}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d5ee84cfc9f51af5e494932fc5b2fbc5efc00502", "author": {"user": {"login": "rasika1995", "name": null}}, "url": "https://github.com/wso2/carbon-apimgt/commit/d5ee84cfc9f51af5e494932fc5b2fbc5efc00502", "committedDate": "2020-06-24T14:06:20Z", "message": "fixed comments"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDM2Njg3OTcz", "url": "https://github.com/wso2/carbon-apimgt/pull/8824#pullrequestreview-436687973", "createdAt": "2020-06-24T14:13:51Z", "commit": {"oid": "d5ee84cfc9f51af5e494932fc5b2fbc5efc00502"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2595, "cost": 1, "resetAt": "2021-11-02T10:47:05Z"}}}