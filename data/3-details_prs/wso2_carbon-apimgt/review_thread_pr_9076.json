{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDU4MjE0MDc2", "number": 9076, "reviewThreads": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yOVQxMTo0OTo1MlrOETN8Bw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0zMFQwMzoxMzo0NlrOETgLxQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjg4NTg2NzU5OnYy", "diffSide": "RIGHT", "path": "components/apimgt/org.wso2.carbon.apimgt.impl/src/main/java/org/wso2/carbon/apimgt/impl/dao/constants/SubscriptionValidationSQLConstants.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yOVQxMTo0OTo1MlrOG4014Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yOVQxNTozMjowM1rOG4-HTQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MjIzOTIwMQ==", "bodyText": "@tharikaGitHub don't we hv to get the PUBLISHED_DEFAULT_API_VERSION? shall we check this", "url": "https://github.com/wso2/carbon-apimgt/pull/9076#discussion_r462239201", "createdAt": "2020-07-29T11:49:52Z", "author": {"login": "chamilaadhi"}, "path": "components/apimgt/org.wso2.carbon.apimgt.impl/src/main/java/org/wso2/carbon/apimgt/impl/dao/constants/SubscriptionValidationSQLConstants.java", "diffHunk": "@@ -348,161 +366,256 @@\n \n     public static final String GET_TENANT_APIS_SQL =\n             \"SELECT\" +\n-                    \"        API.API_ID,\" +\n-                    \"        API.API_PROVIDER,\" +\n-                    \"        API.API_NAME,\" +\n-                    \"        API.API_TIER,\" +\n-                    \"        API.API_VERSION,\" +\n-                    \"        API.CONTEXT,\" +\n-                    \"        API.API_TYPE,\" +\n-                    \"        URL.URL_MAPPING_ID,\" +\n-                    \"        URL.HTTP_METHOD,\" +\n-                    \"        URL.AUTH_SCHEME,\" +\n-                    \"        URL.URL_PATTERN,\" +\n-                    \"        URL.THROTTLING_TIER AS RES_TIER,\" +\n-                    \"        SCOPE.SCOPE_NAME \" +\n-                    \"    FROM\" +\n-                    \"        AM_API API,\" +\n-                    \"        AM_API_URL_MAPPING URL \" +\n-                    \"    LEFT JOIN\" +\n-                    \"        AM_API_RESOURCE_SCOPE_MAPPING SCOPE \" +\n+                    \"   APIS.API_ID,\" +\n+                    \"   APIS.API_PROVIDER,\" +\n+                    \"   APIS.API_NAME,\" +\n+                    \"   APIS.API_TIER,\" +\n+                    \"   APIS.API_VERSION,\" +\n+                    \"   APIS.CONTEXT,\" +\n+                    \"   APIS.API_TYPE,\" +\n+                    \"   APIS.URL_MAPPING_ID,\" +\n+                    \"   APIS.HTTP_METHOD,\" +\n+                    \"   APIS.AUTH_SCHEME,\" +\n+                    \"   APIS.URL_PATTERN,\" +\n+                    \"   APIS.RES_TIER,\" +\n+                    \"   APIS.SCOPE_NAME,\" +\n+                    \"   DEF.DEFAULT_API_VERSION \" +\n+                    \"FROM\" +\n+                    \"   (\" +\n+                    \"      SELECT\" +\n+                    \"         API.API_ID,\" +\n+                    \"         API.API_PROVIDER,\" +\n+                    \"         API.API_NAME,\" +\n+                    \"         API.API_TIER,\" +\n+                    \"         API.API_VERSION,\" +\n+                    \"         API.CONTEXT,\" +\n+                    \"         API.API_TYPE,\" +\n+                    \"         URL.URL_MAPPING_ID,\" +\n+                    \"         URL.HTTP_METHOD,\" +\n+                    \"         URL.AUTH_SCHEME,\" +\n+                    \"         URL.URL_PATTERN,\" +\n+                    \"         URL.THROTTLING_TIER AS RES_TIER,\" +\n+                    \"         SCOPE.SCOPE_NAME \" +\n+                    \"      FROM\" +\n+                    \"         AM_API API,\" +\n+                    \"         AM_API_URL_MAPPING URL \" +\n+                    \"         LEFT JOIN\" +\n+                    \"            AM_API_RESOURCE_SCOPE_MAPPING SCOPE \" +\n                     \"            ON URL.URL_MAPPING_ID = SCOPE.URL_MAPPING_ID \" +\n-                    \"    WHERE\" +\n-                    \"        API.API_ID = URL.API_ID\" +\n-                    \"        AND CONTEXT LIKE ?  \" +\n-                    \"    UNION ALL\" +\n-                    \"    SELECT\" +\n-                    \"        API.API_ID,\" +\n-                    \"        API.API_PROVIDER,\" +\n-                    \"        API.API_NAME,\" +\n-                    \"        API.API_TIER,\" +\n-                    \"        API.API_VERSION,\" +\n-                    \"        API.CONTEXT,\" +\n-                    \"        API.API_TYPE,\" +\n-                    \"        URL.URL_MAPPING_ID,\" +\n-                    \"        URL.HTTP_METHOD,\" +\n-                    \"        URL.AUTH_SCHEME,\" +\n-                    \"        URL.URL_PATTERN,\" +\n-                    \"        URL.THROTTLING_TIER AS RES_TIER,\" +\n-                    \"        SCOPE.SCOPE_NAME \" +\n-                    \"    FROM\" +\n-                    \"        AM_API API,\" +\n-                    \"        AM_API_PRODUCT_MAPPING PROD,\" +\n-                    \"        AM_API_URL_MAPPING URL \" +\n-                    \"    LEFT JOIN\" +\n-                    \"        AM_API_RESOURCE_SCOPE_MAPPING SCOPE \" +\n+                    \"      WHERE\" +\n+                    \"         API.API_ID = URL.API_ID \" +\n+                    \"         AND CONTEXT LIKE ? \" +\n+                    \"      UNION ALL\" +\n+                    \"      SELECT\" +\n+                    \"         API.API_ID,\" +\n+                    \"         API.API_PROVIDER,\" +\n+                    \"         API.API_NAME,\" +\n+                    \"         API.API_TIER,\" +\n+                    \"         API.API_VERSION,\" +\n+                    \"         API.CONTEXT,\" +\n+                    \"         API.API_TYPE,\" +\n+                    \"         URL.URL_MAPPING_ID,\" +\n+                    \"         URL.HTTP_METHOD,\" +\n+                    \"         URL.AUTH_SCHEME,\" +\n+                    \"         URL.URL_PATTERN,\" +\n+                    \"         URL.THROTTLING_TIER AS RES_TIER,\" +\n+                    \"         SCOPE.SCOPE_NAME \" +\n+                    \"      FROM\" +\n+                    \"         AM_API API,\" +\n+                    \"         AM_API_PRODUCT_MAPPING PROD,\" +\n+                    \"         AM_API_URL_MAPPING URL \" +\n+                    \"         LEFT JOIN\" +\n+                    \"            AM_API_RESOURCE_SCOPE_MAPPING SCOPE \" +\n                     \"            ON URL.URL_MAPPING_ID = SCOPE.URL_MAPPING_ID \" +\n-                    \"    WHERE\" +\n-                    \"        URL.URL_MAPPING_ID = PROD.URL_MAPPING_ID \" +\n-                    \"        AND API.API_ID = PROD.API_ID\" +\n-                    \"        AND CONTEXT LIKE ?\";\n+                    \"      WHERE\" +\n+                    \"         URL.URL_MAPPING_ID = PROD.URL_MAPPING_ID \" +\n+                    \"         AND API.API_ID = PROD.API_ID \" +\n+                    \"         AND CONTEXT LIKE ? \" +\n+                    \"   )\" +\n+                    \"   AS APIS \" +\n+                    \"   LEFT JOIN\" +\n+                    \"      AM_API_DEFAULT_VERSION AS DEF \" +\n+                    \"      ON APIS.API_NAME = DEF.API_NAME \" +\n+                    \"      AND APIS.API_PROVIDER = DEF.API_PROVIDER \" +\n+                    \"      AND APIS.API_VERSION = DEF.DEFAULT_API_VERSION\";\n \n     public static final String GET_ST_APIS_SQL =\n             \"SELECT\" +\n-                    \"        API.API_ID,\" +\n-                    \"        API.API_PROVIDER,\" +\n-                    \"        API.API_NAME,\" +\n-                    \"        API.API_TIER,\" +\n-                    \"        API.API_VERSION,\" +\n-                    \"        API.CONTEXT,\" +\n-                    \"        API.API_TYPE,\" +\n-                    \"        URL.URL_MAPPING_ID,\" +\n-                    \"        URL.HTTP_METHOD,\" +\n-                    \"        URL.AUTH_SCHEME,\" +\n-                    \"        URL.URL_PATTERN,\" +\n-                    \"        URL.THROTTLING_TIER AS RES_TIER,\" +\n-                    \"        SCOPE.SCOPE_NAME \" +\n-                    \"    FROM\" +\n-                    \"        AM_API API,\" +\n-                    \"        AM_API_URL_MAPPING URL \" +\n-                    \"    LEFT JOIN\" +\n-                    \"        AM_API_RESOURCE_SCOPE_MAPPING SCOPE \" +\n+                    \"   APIS.API_ID,\" +\n+                    \"   APIS.API_PROVIDER,\" +\n+                    \"   APIS.API_NAME,\" +\n+                    \"   APIS.API_TIER,\" +\n+                    \"   APIS.API_VERSION,\" +\n+                    \"   APIS.CONTEXT,\" +\n+                    \"   APIS.API_TYPE,\" +\n+                    \"   APIS.URL_MAPPING_ID,\" +\n+                    \"   APIS.HTTP_METHOD,\" +\n+                    \"   APIS.AUTH_SCHEME,\" +\n+                    \"   APIS.URL_PATTERN,\" +\n+                    \"   APIS.RES_TIER,\" +\n+                    \"   APIS.SCOPE_NAME,\" +\n+                    \"   DEF.DEFAULT_API_VERSION \" +\n+                    \"FROM\" +\n+                    \"   (\" +\n+                    \"      SELECT\" +\n+                    \"         API.API_ID,\" +\n+                    \"         API.API_PROVIDER,\" +\n+                    \"         API.API_NAME,\" +\n+                    \"         API.API_TIER,\" +\n+                    \"         API.API_VERSION,\" +\n+                    \"         API.CONTEXT,\" +\n+                    \"         API.API_TYPE,\" +\n+                    \"         URL.URL_MAPPING_ID,\" +\n+                    \"         URL.HTTP_METHOD,\" +\n+                    \"         URL.AUTH_SCHEME,\" +\n+                    \"         URL.URL_PATTERN,\" +\n+                    \"         URL.THROTTLING_TIER AS RES_TIER,\" +\n+                    \"         SCOPE.SCOPE_NAME \" +\n+                    \"      FROM\" +\n+                    \"         AM_API API,\" +\n+                    \"         AM_API_URL_MAPPING URL \" +\n+                    \"         LEFT JOIN\" +\n+                    \"            AM_API_RESOURCE_SCOPE_MAPPING SCOPE \" +\n                     \"            ON URL.URL_MAPPING_ID = SCOPE.URL_MAPPING_ID \" +\n-                    \"    WHERE\" +\n-                    \"        API.API_ID = URL.API_ID\" +\n-                    \"        AND CONTEXT NOT LIKE ?  \" +\n-                    \"    UNION\" +\n-                    \"    SELECT\" +\n-                    \"        API.API_ID,\" +\n-                    \"        API.API_PROVIDER,\" +\n-                    \"        API.API_NAME,\" +\n-                    \"        API.API_TIER,\" +\n-                    \"        API.API_VERSION,\" +\n-                    \"        API.CONTEXT,\" +\n-                    \"        API.API_TYPE,\" +\n-                    \"        URL.URL_MAPPING_ID,\" +\n-                    \"        URL.HTTP_METHOD,\" +\n-                    \"        URL.AUTH_SCHEME,\" +\n-                    \"        URL.URL_PATTERN,\" +\n-                    \"        URL.THROTTLING_TIER AS RES_TIER,\" +\n-                    \"        SCOPE.SCOPE_NAME \" +\n-                    \"    FROM\" +\n-                    \"        AM_API API,\" +\n-                    \"        AM_API_PRODUCT_MAPPING PROD,\" +\n-                    \"        AM_API_URL_MAPPING URL \" +\n-                    \"    LEFT JOIN\" +\n-                    \"        AM_API_RESOURCE_SCOPE_MAPPING SCOPE \" +\n+                    \"      WHERE\" +\n+                    \"         API.API_ID = URL.API_ID \" +\n+                    \"         AND CONTEXT NOT LIKE ? \" +\n+                    \"      UNION\" +\n+                    \"      SELECT\" +\n+                    \"         API.API_ID,\" +\n+                    \"         API.API_PROVIDER,\" +\n+                    \"         API.API_NAME,\" +\n+                    \"         API.API_TIER,\" +\n+                    \"         API.API_VERSION,\" +\n+                    \"         API.CONTEXT,\" +\n+                    \"         API.API_TYPE,\" +\n+                    \"         URL.URL_MAPPING_ID,\" +\n+                    \"         URL.HTTP_METHOD,\" +\n+                    \"         URL.AUTH_SCHEME,\" +\n+                    \"         URL.URL_PATTERN,\" +\n+                    \"         URL.THROTTLING_TIER AS RES_TIER,\" +\n+                    \"         SCOPE.SCOPE_NAME \" +\n+                    \"      FROM\" +\n+                    \"         AM_API API,\" +\n+                    \"         AM_API_PRODUCT_MAPPING PROD,\" +\n+                    \"         AM_API_URL_MAPPING URL \" +\n+                    \"         LEFT JOIN\" +\n+                    \"            AM_API_RESOURCE_SCOPE_MAPPING SCOPE \" +\n                     \"            ON URL.URL_MAPPING_ID = SCOPE.URL_MAPPING_ID \" +\n-                    \"    WHERE\" +\n-                    \"        URL.URL_MAPPING_ID = PROD.URL_MAPPING_ID \" +\n-                    \"        AND API.API_ID = PROD.API_ID\" +\n-                    \"        AND CONTEXT NOT LIKE ?\";\n+                    \"      WHERE\" +\n+                    \"         URL.URL_MAPPING_ID = PROD.URL_MAPPING_ID \" +\n+                    \"         AND API.API_ID = PROD.API_ID \" +\n+                    \"         AND CONTEXT NOT LIKE ? \" +\n+                    \"   )\" +\n+                    \"   AS APIS \" +\n+                    \"   LEFT JOIN\" +\n+                    \"      AM_API_DEFAULT_VERSION AS DEF \" +\n+                    \"      ON APIS.API_NAME = DEF.API_NAME \" +\n+                    \"      AND APIS.API_PROVIDER = DEF.API_PROVIDER \" +\n+                    \"      AND APIS.API_VERSION = DEF.DEFAULT_API_VERSION\";\n \n     public static final String GET_API_SQL =\n             \"SELECT \" +\n-                    \"  API.API_ID,\" +\n-                    \"  API.API_PROVIDER,\" +\n-                    \"  API.API_NAME,\" +\n-                    \"  API.API_TIER,\" +\n-                    \"  API.API_VERSION,\" +\n-                    \"  API.CONTEXT, \" +\n-                    \"  API.API_TYPE, \" +\n-                    \"  URL.URL_MAPPING_ID,\" +\n-                    \"  URL.HTTP_METHOD,\" +\n-                    \"  URL.AUTH_SCHEME,\" +\n-                    \"  URL.URL_PATTERN,\" +\n-                    \"  URL.THROTTLING_TIER AS RES_TIER,\" +\n-                    \"  SCOPE.SCOPE_NAME \" +\n-                    \" FROM \" +\n-                    \"   AM_API API,\" +\n-                    \"   AM_API_URL_MAPPING URL\" +\n-                    \" LEFT JOIN \" +\n-                    \"  AM_API_RESOURCE_SCOPE_MAPPING SCOPE \" +\n-                    \" ON \" +\n-                    \"  URL.URL_MAPPING_ID = SCOPE.URL_MAPPING_ID \" +\n-                    \" WHERE \" +\n-                    \"   API.API_ID = URL.API_ID AND \" +\n-                    \"   API.API_VERSION = ? AND \" +\n-                    \"   API.CONTEXT = ?\";\n+                    \"   APIS.API_ID,\" +\n+                    \"   APIS.API_PROVIDER,\" +\n+                    \"   APIS.API_NAME,\" +\n+                    \"   APIS.API_TIER,\" +\n+                    \"   APIS.API_VERSION,\" +\n+                    \"   APIS.CONTEXT,\" +\n+                    \"   APIS.API_TYPE,\" +\n+                    \"   APIS.URL_MAPPING_ID,\" +\n+                    \"   APIS.HTTP_METHOD,\" +\n+                    \"   APIS.AUTH_SCHEME,\" +\n+                    \"   APIS.URL_PATTERN,\" +\n+                    \"   APIS.RES_TIER,\" +\n+                    \"   APIS.SCOPE_NAME,\" +\n+                    \"   DEF.DEFAULT_API_VERSION \" +\n+                    \"FROM \" +\n+                    \"   (\" +\n+                    \"      SELECT \" +\n+                    \"         API.API_ID,\" +\n+                    \"         API.API_PROVIDER,\" +\n+                    \"         API.API_NAME,\" +\n+                    \"         API.API_TIER,\" +\n+                    \"         API.API_VERSION,\" +\n+                    \"         API.CONTEXT,\" +\n+                    \"         API.API_TYPE,\" +\n+                    \"         URL.URL_MAPPING_ID,\" +\n+                    \"         URL.HTTP_METHOD,\" +\n+                    \"         URL.AUTH_SCHEME,\" +\n+                    \"         URL.URL_PATTERN,\" +\n+                    \"         URL.THROTTLING_TIER AS RES_TIER,\" +\n+                    \"         SCOPE.SCOPE_NAME\" +\n+                    \"      FROM \" +\n+                    \"         AM_API API,\" +\n+                    \"         AM_API_URL_MAPPING URL\" +\n+                    \"         LEFT JOIN\" +\n+                    \"            AM_API_RESOURCE_SCOPE_MAPPING SCOPE\" +\n+                    \"            ON URL.URL_MAPPING_ID = SCOPE.URL_MAPPING_ID\" +\n+                    \"      WHERE\" +\n+                    \"         API.API_ID = URL.API_ID\" +\n+                    \"         AND API.API_VERSION = ?\" +\n+                    \"         AND API.CONTEXT = ?\" +\n+                    \"   )\" +\n+                    \"   AS APIS \" +\n+                    \"   LEFT JOIN \" +\n+                    \"      AM_API_DEFAULT_VERSION AS DEF\" +\n+                    \"      ON APIS.API_NAME = DEF.API_NAME\" +\n+                    \"      AND APIS.API_PROVIDER = DEF.API_PROVIDER\" +\n+                    \"      AND APIS.API_VERSION = DEF.DEFAULT_API_VERSION\";", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "1fd1523be812d93a03ced52015a7c9dfbb9d9620"}, "originalPosition": 437}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MjM5MTExNw==", "bodyText": "Fixed with f19e30f", "url": "https://github.com/wso2/carbon-apimgt/pull/9076#discussion_r462391117", "createdAt": "2020-07-29T15:32:03Z", "author": {"login": "tharikaGitHub"}, "path": "components/apimgt/org.wso2.carbon.apimgt.impl/src/main/java/org/wso2/carbon/apimgt/impl/dao/constants/SubscriptionValidationSQLConstants.java", "diffHunk": "@@ -348,161 +366,256 @@\n \n     public static final String GET_TENANT_APIS_SQL =\n             \"SELECT\" +\n-                    \"        API.API_ID,\" +\n-                    \"        API.API_PROVIDER,\" +\n-                    \"        API.API_NAME,\" +\n-                    \"        API.API_TIER,\" +\n-                    \"        API.API_VERSION,\" +\n-                    \"        API.CONTEXT,\" +\n-                    \"        API.API_TYPE,\" +\n-                    \"        URL.URL_MAPPING_ID,\" +\n-                    \"        URL.HTTP_METHOD,\" +\n-                    \"        URL.AUTH_SCHEME,\" +\n-                    \"        URL.URL_PATTERN,\" +\n-                    \"        URL.THROTTLING_TIER AS RES_TIER,\" +\n-                    \"        SCOPE.SCOPE_NAME \" +\n-                    \"    FROM\" +\n-                    \"        AM_API API,\" +\n-                    \"        AM_API_URL_MAPPING URL \" +\n-                    \"    LEFT JOIN\" +\n-                    \"        AM_API_RESOURCE_SCOPE_MAPPING SCOPE \" +\n+                    \"   APIS.API_ID,\" +\n+                    \"   APIS.API_PROVIDER,\" +\n+                    \"   APIS.API_NAME,\" +\n+                    \"   APIS.API_TIER,\" +\n+                    \"   APIS.API_VERSION,\" +\n+                    \"   APIS.CONTEXT,\" +\n+                    \"   APIS.API_TYPE,\" +\n+                    \"   APIS.URL_MAPPING_ID,\" +\n+                    \"   APIS.HTTP_METHOD,\" +\n+                    \"   APIS.AUTH_SCHEME,\" +\n+                    \"   APIS.URL_PATTERN,\" +\n+                    \"   APIS.RES_TIER,\" +\n+                    \"   APIS.SCOPE_NAME,\" +\n+                    \"   DEF.DEFAULT_API_VERSION \" +\n+                    \"FROM\" +\n+                    \"   (\" +\n+                    \"      SELECT\" +\n+                    \"         API.API_ID,\" +\n+                    \"         API.API_PROVIDER,\" +\n+                    \"         API.API_NAME,\" +\n+                    \"         API.API_TIER,\" +\n+                    \"         API.API_VERSION,\" +\n+                    \"         API.CONTEXT,\" +\n+                    \"         API.API_TYPE,\" +\n+                    \"         URL.URL_MAPPING_ID,\" +\n+                    \"         URL.HTTP_METHOD,\" +\n+                    \"         URL.AUTH_SCHEME,\" +\n+                    \"         URL.URL_PATTERN,\" +\n+                    \"         URL.THROTTLING_TIER AS RES_TIER,\" +\n+                    \"         SCOPE.SCOPE_NAME \" +\n+                    \"      FROM\" +\n+                    \"         AM_API API,\" +\n+                    \"         AM_API_URL_MAPPING URL \" +\n+                    \"         LEFT JOIN\" +\n+                    \"            AM_API_RESOURCE_SCOPE_MAPPING SCOPE \" +\n                     \"            ON URL.URL_MAPPING_ID = SCOPE.URL_MAPPING_ID \" +\n-                    \"    WHERE\" +\n-                    \"        API.API_ID = URL.API_ID\" +\n-                    \"        AND CONTEXT LIKE ?  \" +\n-                    \"    UNION ALL\" +\n-                    \"    SELECT\" +\n-                    \"        API.API_ID,\" +\n-                    \"        API.API_PROVIDER,\" +\n-                    \"        API.API_NAME,\" +\n-                    \"        API.API_TIER,\" +\n-                    \"        API.API_VERSION,\" +\n-                    \"        API.CONTEXT,\" +\n-                    \"        API.API_TYPE,\" +\n-                    \"        URL.URL_MAPPING_ID,\" +\n-                    \"        URL.HTTP_METHOD,\" +\n-                    \"        URL.AUTH_SCHEME,\" +\n-                    \"        URL.URL_PATTERN,\" +\n-                    \"        URL.THROTTLING_TIER AS RES_TIER,\" +\n-                    \"        SCOPE.SCOPE_NAME \" +\n-                    \"    FROM\" +\n-                    \"        AM_API API,\" +\n-                    \"        AM_API_PRODUCT_MAPPING PROD,\" +\n-                    \"        AM_API_URL_MAPPING URL \" +\n-                    \"    LEFT JOIN\" +\n-                    \"        AM_API_RESOURCE_SCOPE_MAPPING SCOPE \" +\n+                    \"      WHERE\" +\n+                    \"         API.API_ID = URL.API_ID \" +\n+                    \"         AND CONTEXT LIKE ? \" +\n+                    \"      UNION ALL\" +\n+                    \"      SELECT\" +\n+                    \"         API.API_ID,\" +\n+                    \"         API.API_PROVIDER,\" +\n+                    \"         API.API_NAME,\" +\n+                    \"         API.API_TIER,\" +\n+                    \"         API.API_VERSION,\" +\n+                    \"         API.CONTEXT,\" +\n+                    \"         API.API_TYPE,\" +\n+                    \"         URL.URL_MAPPING_ID,\" +\n+                    \"         URL.HTTP_METHOD,\" +\n+                    \"         URL.AUTH_SCHEME,\" +\n+                    \"         URL.URL_PATTERN,\" +\n+                    \"         URL.THROTTLING_TIER AS RES_TIER,\" +\n+                    \"         SCOPE.SCOPE_NAME \" +\n+                    \"      FROM\" +\n+                    \"         AM_API API,\" +\n+                    \"         AM_API_PRODUCT_MAPPING PROD,\" +\n+                    \"         AM_API_URL_MAPPING URL \" +\n+                    \"         LEFT JOIN\" +\n+                    \"            AM_API_RESOURCE_SCOPE_MAPPING SCOPE \" +\n                     \"            ON URL.URL_MAPPING_ID = SCOPE.URL_MAPPING_ID \" +\n-                    \"    WHERE\" +\n-                    \"        URL.URL_MAPPING_ID = PROD.URL_MAPPING_ID \" +\n-                    \"        AND API.API_ID = PROD.API_ID\" +\n-                    \"        AND CONTEXT LIKE ?\";\n+                    \"      WHERE\" +\n+                    \"         URL.URL_MAPPING_ID = PROD.URL_MAPPING_ID \" +\n+                    \"         AND API.API_ID = PROD.API_ID \" +\n+                    \"         AND CONTEXT LIKE ? \" +\n+                    \"   )\" +\n+                    \"   AS APIS \" +\n+                    \"   LEFT JOIN\" +\n+                    \"      AM_API_DEFAULT_VERSION AS DEF \" +\n+                    \"      ON APIS.API_NAME = DEF.API_NAME \" +\n+                    \"      AND APIS.API_PROVIDER = DEF.API_PROVIDER \" +\n+                    \"      AND APIS.API_VERSION = DEF.DEFAULT_API_VERSION\";\n \n     public static final String GET_ST_APIS_SQL =\n             \"SELECT\" +\n-                    \"        API.API_ID,\" +\n-                    \"        API.API_PROVIDER,\" +\n-                    \"        API.API_NAME,\" +\n-                    \"        API.API_TIER,\" +\n-                    \"        API.API_VERSION,\" +\n-                    \"        API.CONTEXT,\" +\n-                    \"        API.API_TYPE,\" +\n-                    \"        URL.URL_MAPPING_ID,\" +\n-                    \"        URL.HTTP_METHOD,\" +\n-                    \"        URL.AUTH_SCHEME,\" +\n-                    \"        URL.URL_PATTERN,\" +\n-                    \"        URL.THROTTLING_TIER AS RES_TIER,\" +\n-                    \"        SCOPE.SCOPE_NAME \" +\n-                    \"    FROM\" +\n-                    \"        AM_API API,\" +\n-                    \"        AM_API_URL_MAPPING URL \" +\n-                    \"    LEFT JOIN\" +\n-                    \"        AM_API_RESOURCE_SCOPE_MAPPING SCOPE \" +\n+                    \"   APIS.API_ID,\" +\n+                    \"   APIS.API_PROVIDER,\" +\n+                    \"   APIS.API_NAME,\" +\n+                    \"   APIS.API_TIER,\" +\n+                    \"   APIS.API_VERSION,\" +\n+                    \"   APIS.CONTEXT,\" +\n+                    \"   APIS.API_TYPE,\" +\n+                    \"   APIS.URL_MAPPING_ID,\" +\n+                    \"   APIS.HTTP_METHOD,\" +\n+                    \"   APIS.AUTH_SCHEME,\" +\n+                    \"   APIS.URL_PATTERN,\" +\n+                    \"   APIS.RES_TIER,\" +\n+                    \"   APIS.SCOPE_NAME,\" +\n+                    \"   DEF.DEFAULT_API_VERSION \" +\n+                    \"FROM\" +\n+                    \"   (\" +\n+                    \"      SELECT\" +\n+                    \"         API.API_ID,\" +\n+                    \"         API.API_PROVIDER,\" +\n+                    \"         API.API_NAME,\" +\n+                    \"         API.API_TIER,\" +\n+                    \"         API.API_VERSION,\" +\n+                    \"         API.CONTEXT,\" +\n+                    \"         API.API_TYPE,\" +\n+                    \"         URL.URL_MAPPING_ID,\" +\n+                    \"         URL.HTTP_METHOD,\" +\n+                    \"         URL.AUTH_SCHEME,\" +\n+                    \"         URL.URL_PATTERN,\" +\n+                    \"         URL.THROTTLING_TIER AS RES_TIER,\" +\n+                    \"         SCOPE.SCOPE_NAME \" +\n+                    \"      FROM\" +\n+                    \"         AM_API API,\" +\n+                    \"         AM_API_URL_MAPPING URL \" +\n+                    \"         LEFT JOIN\" +\n+                    \"            AM_API_RESOURCE_SCOPE_MAPPING SCOPE \" +\n                     \"            ON URL.URL_MAPPING_ID = SCOPE.URL_MAPPING_ID \" +\n-                    \"    WHERE\" +\n-                    \"        API.API_ID = URL.API_ID\" +\n-                    \"        AND CONTEXT NOT LIKE ?  \" +\n-                    \"    UNION\" +\n-                    \"    SELECT\" +\n-                    \"        API.API_ID,\" +\n-                    \"        API.API_PROVIDER,\" +\n-                    \"        API.API_NAME,\" +\n-                    \"        API.API_TIER,\" +\n-                    \"        API.API_VERSION,\" +\n-                    \"        API.CONTEXT,\" +\n-                    \"        API.API_TYPE,\" +\n-                    \"        URL.URL_MAPPING_ID,\" +\n-                    \"        URL.HTTP_METHOD,\" +\n-                    \"        URL.AUTH_SCHEME,\" +\n-                    \"        URL.URL_PATTERN,\" +\n-                    \"        URL.THROTTLING_TIER AS RES_TIER,\" +\n-                    \"        SCOPE.SCOPE_NAME \" +\n-                    \"    FROM\" +\n-                    \"        AM_API API,\" +\n-                    \"        AM_API_PRODUCT_MAPPING PROD,\" +\n-                    \"        AM_API_URL_MAPPING URL \" +\n-                    \"    LEFT JOIN\" +\n-                    \"        AM_API_RESOURCE_SCOPE_MAPPING SCOPE \" +\n+                    \"      WHERE\" +\n+                    \"         API.API_ID = URL.API_ID \" +\n+                    \"         AND CONTEXT NOT LIKE ? \" +\n+                    \"      UNION\" +\n+                    \"      SELECT\" +\n+                    \"         API.API_ID,\" +\n+                    \"         API.API_PROVIDER,\" +\n+                    \"         API.API_NAME,\" +\n+                    \"         API.API_TIER,\" +\n+                    \"         API.API_VERSION,\" +\n+                    \"         API.CONTEXT,\" +\n+                    \"         API.API_TYPE,\" +\n+                    \"         URL.URL_MAPPING_ID,\" +\n+                    \"         URL.HTTP_METHOD,\" +\n+                    \"         URL.AUTH_SCHEME,\" +\n+                    \"         URL.URL_PATTERN,\" +\n+                    \"         URL.THROTTLING_TIER AS RES_TIER,\" +\n+                    \"         SCOPE.SCOPE_NAME \" +\n+                    \"      FROM\" +\n+                    \"         AM_API API,\" +\n+                    \"         AM_API_PRODUCT_MAPPING PROD,\" +\n+                    \"         AM_API_URL_MAPPING URL \" +\n+                    \"         LEFT JOIN\" +\n+                    \"            AM_API_RESOURCE_SCOPE_MAPPING SCOPE \" +\n                     \"            ON URL.URL_MAPPING_ID = SCOPE.URL_MAPPING_ID \" +\n-                    \"    WHERE\" +\n-                    \"        URL.URL_MAPPING_ID = PROD.URL_MAPPING_ID \" +\n-                    \"        AND API.API_ID = PROD.API_ID\" +\n-                    \"        AND CONTEXT NOT LIKE ?\";\n+                    \"      WHERE\" +\n+                    \"         URL.URL_MAPPING_ID = PROD.URL_MAPPING_ID \" +\n+                    \"         AND API.API_ID = PROD.API_ID \" +\n+                    \"         AND CONTEXT NOT LIKE ? \" +\n+                    \"   )\" +\n+                    \"   AS APIS \" +\n+                    \"   LEFT JOIN\" +\n+                    \"      AM_API_DEFAULT_VERSION AS DEF \" +\n+                    \"      ON APIS.API_NAME = DEF.API_NAME \" +\n+                    \"      AND APIS.API_PROVIDER = DEF.API_PROVIDER \" +\n+                    \"      AND APIS.API_VERSION = DEF.DEFAULT_API_VERSION\";\n \n     public static final String GET_API_SQL =\n             \"SELECT \" +\n-                    \"  API.API_ID,\" +\n-                    \"  API.API_PROVIDER,\" +\n-                    \"  API.API_NAME,\" +\n-                    \"  API.API_TIER,\" +\n-                    \"  API.API_VERSION,\" +\n-                    \"  API.CONTEXT, \" +\n-                    \"  API.API_TYPE, \" +\n-                    \"  URL.URL_MAPPING_ID,\" +\n-                    \"  URL.HTTP_METHOD,\" +\n-                    \"  URL.AUTH_SCHEME,\" +\n-                    \"  URL.URL_PATTERN,\" +\n-                    \"  URL.THROTTLING_TIER AS RES_TIER,\" +\n-                    \"  SCOPE.SCOPE_NAME \" +\n-                    \" FROM \" +\n-                    \"   AM_API API,\" +\n-                    \"   AM_API_URL_MAPPING URL\" +\n-                    \" LEFT JOIN \" +\n-                    \"  AM_API_RESOURCE_SCOPE_MAPPING SCOPE \" +\n-                    \" ON \" +\n-                    \"  URL.URL_MAPPING_ID = SCOPE.URL_MAPPING_ID \" +\n-                    \" WHERE \" +\n-                    \"   API.API_ID = URL.API_ID AND \" +\n-                    \"   API.API_VERSION = ? AND \" +\n-                    \"   API.CONTEXT = ?\";\n+                    \"   APIS.API_ID,\" +\n+                    \"   APIS.API_PROVIDER,\" +\n+                    \"   APIS.API_NAME,\" +\n+                    \"   APIS.API_TIER,\" +\n+                    \"   APIS.API_VERSION,\" +\n+                    \"   APIS.CONTEXT,\" +\n+                    \"   APIS.API_TYPE,\" +\n+                    \"   APIS.URL_MAPPING_ID,\" +\n+                    \"   APIS.HTTP_METHOD,\" +\n+                    \"   APIS.AUTH_SCHEME,\" +\n+                    \"   APIS.URL_PATTERN,\" +\n+                    \"   APIS.RES_TIER,\" +\n+                    \"   APIS.SCOPE_NAME,\" +\n+                    \"   DEF.DEFAULT_API_VERSION \" +\n+                    \"FROM \" +\n+                    \"   (\" +\n+                    \"      SELECT \" +\n+                    \"         API.API_ID,\" +\n+                    \"         API.API_PROVIDER,\" +\n+                    \"         API.API_NAME,\" +\n+                    \"         API.API_TIER,\" +\n+                    \"         API.API_VERSION,\" +\n+                    \"         API.CONTEXT,\" +\n+                    \"         API.API_TYPE,\" +\n+                    \"         URL.URL_MAPPING_ID,\" +\n+                    \"         URL.HTTP_METHOD,\" +\n+                    \"         URL.AUTH_SCHEME,\" +\n+                    \"         URL.URL_PATTERN,\" +\n+                    \"         URL.THROTTLING_TIER AS RES_TIER,\" +\n+                    \"         SCOPE.SCOPE_NAME\" +\n+                    \"      FROM \" +\n+                    \"         AM_API API,\" +\n+                    \"         AM_API_URL_MAPPING URL\" +\n+                    \"         LEFT JOIN\" +\n+                    \"            AM_API_RESOURCE_SCOPE_MAPPING SCOPE\" +\n+                    \"            ON URL.URL_MAPPING_ID = SCOPE.URL_MAPPING_ID\" +\n+                    \"      WHERE\" +\n+                    \"         API.API_ID = URL.API_ID\" +\n+                    \"         AND API.API_VERSION = ?\" +\n+                    \"         AND API.CONTEXT = ?\" +\n+                    \"   )\" +\n+                    \"   AS APIS \" +\n+                    \"   LEFT JOIN \" +\n+                    \"      AM_API_DEFAULT_VERSION AS DEF\" +\n+                    \"      ON APIS.API_NAME = DEF.API_NAME\" +\n+                    \"      AND APIS.API_PROVIDER = DEF.API_PROVIDER\" +\n+                    \"      AND APIS.API_VERSION = DEF.DEFAULT_API_VERSION\";", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MjIzOTIwMQ=="}, "originalCommit": {"oid": "1fd1523be812d93a03ced52015a7c9dfbb9d9620"}, "originalPosition": 437}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjg4ODg1NjgxOnYy", "diffSide": "RIGHT", "path": "components/apimgt/org.wso2.carbon.apimgt.impl/src/main/java/org/wso2/carbon/apimgt/impl/dao/SubscriptionValidationDAO.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0zMFQwMzoxMzozN1rOG5RhHg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0zMFQxMDowMDozM1rOG5cd8A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MjcwOTAyMg==", "bodyText": "This logic is not right. \"PUBLISHED_DEFAULT_API_VERSION\" colum gives you the default version. What you could do is check \"PUBLISHED_DEFAULT_API_VERSION\" is equal to \"API_VERSION\" and set the boolean as true if equals", "url": "https://github.com/wso2/carbon-apimgt/pull/9076#discussion_r462709022", "createdAt": "2020-07-30T03:13:37Z", "author": {"login": "chamilaadhi"}, "path": "components/apimgt/org.wso2.carbon.apimgt.impl/src/main/java/org/wso2/carbon/apimgt/impl/dao/SubscriptionValidationDAO.java", "diffHunk": "@@ -329,6 +329,7 @@ public API getApi(String version, String context) {\n                     api.setPolicy(resultSet.getString(\"API_TIER\"));\n                     api.setVersion(resultSet.getString(\"API_VERSION\"));\n                     api.setContext(resultSet.getString(\"CONTEXT\"));\n+                    api.setIsDefaultVersion(resultSet.getBoolean(\"PUBLISHED_DEFAULT_API_VERSION\"));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f19e30fc575d02246c5ba429b9de8aabf8551162"}, "originalPosition": 4}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2Mjg4ODQzMg==", "bodyText": "Fixed with 9c76d41", "url": "https://github.com/wso2/carbon-apimgt/pull/9076#discussion_r462888432", "createdAt": "2020-07-30T10:00:33Z", "author": {"login": "tharikaGitHub"}, "path": "components/apimgt/org.wso2.carbon.apimgt.impl/src/main/java/org/wso2/carbon/apimgt/impl/dao/SubscriptionValidationDAO.java", "diffHunk": "@@ -329,6 +329,7 @@ public API getApi(String version, String context) {\n                     api.setPolicy(resultSet.getString(\"API_TIER\"));\n                     api.setVersion(resultSet.getString(\"API_VERSION\"));\n                     api.setContext(resultSet.getString(\"CONTEXT\"));\n+                    api.setIsDefaultVersion(resultSet.getBoolean(\"PUBLISHED_DEFAULT_API_VERSION\"));", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MjcwOTAyMg=="}, "originalCommit": {"oid": "f19e30fc575d02246c5ba429b9de8aabf8551162"}, "originalPosition": 4}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjg4ODg1NzAxOnYy", "diffSide": "RIGHT", "path": "components/apimgt/org.wso2.carbon.apimgt.impl/src/main/java/org/wso2/carbon/apimgt/impl/dao/SubscriptionValidationDAO.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0zMFQwMzoxMzo0NlrOG5RhOA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0zMFQxMDowMDozOFrOG5ceEQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MjcwOTA0OA==", "bodyText": "same here", "url": "https://github.com/wso2/carbon-apimgt/pull/9076#discussion_r462709048", "createdAt": "2020-07-30T03:13:46Z", "author": {"login": "chamilaadhi"}, "path": "components/apimgt/org.wso2.carbon.apimgt.impl/src/main/java/org/wso2/carbon/apimgt/impl/dao/SubscriptionValidationDAO.java", "diffHunk": "@@ -371,6 +372,7 @@ private void populateAPIList(ResultSet resultSet, List<API> apiList) throws SQLE\n                 api.setPolicy(resultSet.getString(\"API_TIER\"));\n                 api.setVersion(resultSet.getString(\"API_VERSION\"));\n                 api.setContext(resultSet.getString(\"CONTEXT\"));\n+                api.setIsDefaultVersion(resultSet.getBoolean(\"PUBLISHED_DEFAULT_API_VERSION\"));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f19e30fc575d02246c5ba429b9de8aabf8551162"}, "originalPosition": 12}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2Mjg4ODQ2NQ==", "bodyText": "Fixed with 9c76d41", "url": "https://github.com/wso2/carbon-apimgt/pull/9076#discussion_r462888465", "createdAt": "2020-07-30T10:00:38Z", "author": {"login": "tharikaGitHub"}, "path": "components/apimgt/org.wso2.carbon.apimgt.impl/src/main/java/org/wso2/carbon/apimgt/impl/dao/SubscriptionValidationDAO.java", "diffHunk": "@@ -371,6 +372,7 @@ private void populateAPIList(ResultSet resultSet, List<API> apiList) throws SQLE\n                 api.setPolicy(resultSet.getString(\"API_TIER\"));\n                 api.setVersion(resultSet.getString(\"API_VERSION\"));\n                 api.setContext(resultSet.getString(\"CONTEXT\"));\n+                api.setIsDefaultVersion(resultSet.getBoolean(\"PUBLISHED_DEFAULT_API_VERSION\"));", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MjcwOTA0OA=="}, "originalCommit": {"oid": "f19e30fc575d02246c5ba429b9de8aabf8551162"}, "originalPosition": 12}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3133, "cost": 1, "resetAt": "2021-11-13T14:23:39Z"}}}