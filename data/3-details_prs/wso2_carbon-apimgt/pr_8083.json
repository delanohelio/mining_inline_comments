{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0MzYzOTYzNTAz", "number": 8083, "title": "Improve Backend JWT Generation", "bodyText": "Improve Backend JWT Generation", "createdAt": "2020-01-17T04:55:18Z", "url": "https://github.com/wso2/carbon-apimgt/pull/8083", "merged": true, "mergeCommit": {"oid": "a8523d08d8d7e628c029a534114e626d16eab810"}, "closed": true, "closedAt": "2020-01-18T04:43:16Z", "author": {"login": "tharindu1st"}, "timelineItems": {"totalCount": 16, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABb7HdrogBqjI5NTY5MTE5NTI=", "endCursor": "Y3Vyc29yOnYyOpPPAAABb7b1EoABqjI5NjAwMDg2MDE=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "e88fcf3534eba8d198e45f45952215501e76ac5f", "author": {"user": {"login": "tharindu1st", "name": "Tharindu Dasun Dharmarathna"}}, "url": "https://github.com/wso2/carbon-apimgt/commit/e88fcf3534eba8d198e45f45952215501e76ac5f", "committedDate": "2020-01-17T04:52:48Z", "message": "Fix JWT Generation"}, "afterCommit": {"oid": "2261b356e5c396756dd4d0a44b195eda7474e5c3", "author": {"user": {"login": "tharindu1st", "name": "Tharindu Dasun Dharmarathna"}}, "url": "https://github.com/wso2/carbon-apimgt/commit/2261b356e5c396756dd4d0a44b195eda7474e5c3", "committedDate": "2020-01-17T04:57:57Z", "message": "Fix JWT Generation"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "2261b356e5c396756dd4d0a44b195eda7474e5c3", "author": {"user": {"login": "tharindu1st", "name": "Tharindu Dasun Dharmarathna"}}, "url": "https://github.com/wso2/carbon-apimgt/commit/2261b356e5c396756dd4d0a44b195eda7474e5c3", "committedDate": "2020-01-17T04:57:57Z", "message": "Fix JWT Generation"}, "afterCommit": {"oid": "01b05701f25fe1553946fa7fff0e6754c68644dc", "author": {"user": {"login": "tharindu1st", "name": "Tharindu Dasun Dharmarathna"}}, "url": "https://github.com/wso2/carbon-apimgt/commit/01b05701f25fe1553946fa7fff0e6754c68644dc", "committedDate": "2020-01-17T05:00:12Z", "message": "Fix JWT Generation"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzQ0MzcwNjky", "url": "https://github.com/wso2/carbon-apimgt/pull/8083#pullrequestreview-344370692", "createdAt": "2020-01-17T05:31:14Z", "commit": {"oid": "01b05701f25fe1553946fa7fff0e6754c68644dc"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0xN1QwNTozMToxNFrOFevOQw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0xN1QwNTozMToxNFrOFevOQw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2Nzc3NTI5OQ==", "bodyText": "While this will work in most of the cases, wouldn't it cause a problem when an OSGI module unloads/re-loads? Can we trigger the action of building tracer from setTracingService method on ServiceComponent?", "url": "https://github.com/wso2/carbon-apimgt/pull/8083#discussion_r367775299", "createdAt": "2020-01-17T05:31:14Z", "author": {"login": "jaadds"}, "path": "components/apimgt/org.wso2.carbon.apimgt.gateway/src/main/java/org/wso2/carbon/apimgt/gateway/handlers/common/APIMgtLatencySynapseHandler.java", "diffHunk": "@@ -34,14 +34,18 @@\n \n     private TracingTracer tracer;\n \n-    public APIMgtLatencySynapseHandler() {\n-        tracer = ServiceReferenceHolder.getInstance().getTracingService()\n-                .buildTracer(APIMgtGatewayConstants.SERVICE_NAME);\n-    }\n-\n     @Override\n     public boolean handleRequestInFlow(MessageContext messageContext) {\n+\n         if (Util.tracingEnabled()) {\n+            if (tracer == null) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "01b05701f25fe1553946fa7fff0e6754c68644dc"}, "originalPosition": 13}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzQ0Mzc3NjUw", "url": "https://github.com/wso2/carbon-apimgt/pull/8083#pullrequestreview-344377650", "createdAt": "2020-01-17T06:02:59Z", "commit": {"oid": "01b05701f25fe1553946fa7fff0e6754c68644dc"}, "state": "COMMENTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0xN1QwNjowMzowMFrOFevkZg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0xN1QwNjowNTozN1rOFevmMg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2Nzc4MDk2Ng==", "bodyText": "If GatewayTokenCaching is enabled, do we proceed with generating the endUserToken without checking whether it is enabled or not?", "url": "https://github.com/wso2/carbon-apimgt/pull/8083#discussion_r367780966", "createdAt": "2020-01-17T06:03:00Z", "author": {"login": "jaadds"}, "path": "components/apimgt/org.wso2.carbon.apimgt.gateway/src/main/java/org/wso2/carbon/apimgt/gateway/handlers/security/jwt/JWTValidator.java", "diffHunk": "@@ -261,6 +282,33 @@ else if (RevokedJWTDataHolder.isJWTTokenSignatureExistsInRevokedMap(tokenSignatu\n                 \"Invalid JWT token. Signature verification failed.\");\n     }\n \n+    private String generateAndRetrieveJWTToken(String tokenSignature, JWTInfoDto jwtInfoDto)\n+            throws APISecurityException {\n+        String endUserToken;\n+        if (isGatewayTokenCacheEnabled) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "01b05701f25fe1553946fa7fff0e6754c68644dc"}, "originalPosition": 99}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2Nzc4MTQyNg==", "bodyText": "How about giving a specific message indicating that the error occurred while generating the JWT?", "url": "https://github.com/wso2/carbon-apimgt/pull/8083#discussion_r367781426", "createdAt": "2020-01-17T06:05:37Z", "author": {"login": "jaadds"}, "path": "components/apimgt/org.wso2.carbon.apimgt.gateway/src/main/java/org/wso2/carbon/apimgt/gateway/handlers/security/jwt/JWTValidator.java", "diffHunk": "@@ -261,6 +282,33 @@ else if (RevokedJWTDataHolder.isJWTTokenSignatureExistsInRevokedMap(tokenSignatu\n                 \"Invalid JWT token. Signature verification failed.\");\n     }\n \n+    private String generateAndRetrieveJWTToken(String tokenSignature, JWTInfoDto jwtInfoDto)\n+            throws APISecurityException {\n+        String endUserToken;\n+        if (isGatewayTokenCacheEnabled) {\n+            Object token = getGatewayJWTTokenCache().get(tokenSignature);\n+            if (token != null){\n+                endUserToken = (String) token;\n+            }else{\n+                try {\n+                    endUserToken = apiMgtGatewayJWTGenerator.generateToken(jwtInfoDto);\n+                    getGatewayJWTTokenCache().put(tokenSignature,endUserToken);\n+                } catch (APIManagementException e) {\n+                    throw new APISecurityException(APISecurityConstants.API_AUTH_GENERAL_ERROR,", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "01b05701f25fe1553946fa7fff0e6754c68644dc"}, "originalPosition": 108}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "01b05701f25fe1553946fa7fff0e6754c68644dc", "author": {"user": {"login": "tharindu1st", "name": "Tharindu Dasun Dharmarathna"}}, "url": "https://github.com/wso2/carbon-apimgt/commit/01b05701f25fe1553946fa7fff0e6754c68644dc", "committedDate": "2020-01-17T05:00:12Z", "message": "Fix JWT Generation"}, "afterCommit": {"oid": "a5c21e50ad55453f1958adceb12b7dfcf4053da1", "author": {"user": {"login": "tharindu1st", "name": "Tharindu Dasun Dharmarathna"}}, "url": "https://github.com/wso2/carbon-apimgt/commit/a5c21e50ad55453f1958adceb12b7dfcf4053da1", "committedDate": "2020-01-17T07:57:59Z", "message": "Fix JWT Generation"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "a5c21e50ad55453f1958adceb12b7dfcf4053da1", "author": {"user": {"login": "tharindu1st", "name": "Tharindu Dasun Dharmarathna"}}, "url": "https://github.com/wso2/carbon-apimgt/commit/a5c21e50ad55453f1958adceb12b7dfcf4053da1", "committedDate": "2020-01-17T07:57:59Z", "message": "Fix JWT Generation"}, "afterCommit": {"oid": "1ae2150a1272dfd6a070bd281683e992a71427fb", "author": {"user": {"login": "tharindu1st", "name": "Tharindu Dasun Dharmarathna"}}, "url": "https://github.com/wso2/carbon-apimgt/commit/1ae2150a1272dfd6a070bd281683e992a71427fb", "committedDate": "2020-01-17T09:43:02Z", "message": "Fix JWT Generation"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "1ae2150a1272dfd6a070bd281683e992a71427fb", "author": {"user": {"login": "tharindu1st", "name": "Tharindu Dasun Dharmarathna"}}, "url": "https://github.com/wso2/carbon-apimgt/commit/1ae2150a1272dfd6a070bd281683e992a71427fb", "committedDate": "2020-01-17T09:43:02Z", "message": "Fix JWT Generation"}, "afterCommit": {"oid": "b070f3f1fb657f6e9ab81f8cd7bc65c1d2748642", "author": {"user": {"login": "tharindu1st", "name": "Tharindu Dasun Dharmarathna"}}, "url": "https://github.com/wso2/carbon-apimgt/commit/b070f3f1fb657f6e9ab81f8cd7bc65c1d2748642", "committedDate": "2020-01-17T11:34:26Z", "message": "Fix JWT Generation"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzQ0NTI3NDY5", "url": "https://github.com/wso2/carbon-apimgt/pull/8083#pullrequestreview-344527469", "createdAt": "2020-01-17T11:46:24Z", "commit": {"oid": "b070f3f1fb657f6e9ab81f8cd7bc65c1d2748642"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "b070f3f1fb657f6e9ab81f8cd7bc65c1d2748642", "author": {"user": {"login": "tharindu1st", "name": "Tharindu Dasun Dharmarathna"}}, "url": "https://github.com/wso2/carbon-apimgt/commit/b070f3f1fb657f6e9ab81f8cd7bc65c1d2748642", "committedDate": "2020-01-17T11:34:26Z", "message": "Fix JWT Generation"}, "afterCommit": {"oid": "a0fff4aadb380ecebe8eb1050d2803332b3a764a", "author": {"user": {"login": "tharindu1st", "name": "Tharindu Dasun Dharmarathna"}}, "url": "https://github.com/wso2/carbon-apimgt/commit/a0fff4aadb380ecebe8eb1050d2803332b3a764a", "committedDate": "2020-01-17T11:46:24Z", "message": "Fix JWT Generation"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "a0fff4aadb380ecebe8eb1050d2803332b3a764a", "author": {"user": {"login": "tharindu1st", "name": "Tharindu Dasun Dharmarathna"}}, "url": "https://github.com/wso2/carbon-apimgt/commit/a0fff4aadb380ecebe8eb1050d2803332b3a764a", "committedDate": "2020-01-17T11:46:24Z", "message": "Fix JWT Generation"}, "afterCommit": {"oid": "1880cb3b432892eb8edeba7fd8d33924b6e74c5a", "author": {"user": {"login": "tharindu1st", "name": "Tharindu Dasun Dharmarathna"}}, "url": "https://github.com/wso2/carbon-apimgt/commit/1880cb3b432892eb8edeba7fd8d33924b6e74c5a", "committedDate": "2020-01-17T13:24:30Z", "message": "Fix JWT Generation"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "cd33e4f296f076cf4550fc18b6c6e1d08ffe7acc", "author": {"user": {"login": "tharindu1st", "name": "Tharindu Dasun Dharmarathna"}}, "url": "https://github.com/wso2/carbon-apimgt/commit/cd33e4f296f076cf4550fc18b6c6e1d08ffe7acc", "committedDate": "2020-01-18T04:25:42Z", "message": "removing backendjwt From Enduser JWT"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "cbaca9b48a05efc545d29307f5d78202d5790858", "author": {"user": {"login": "tharindu1st", "name": "Tharindu Dasun Dharmarathna"}}, "url": "https://github.com/wso2/carbon-apimgt/commit/cbaca9b48a05efc545d29307f5d78202d5790858", "committedDate": "2020-01-18T04:25:42Z", "message": "Fix SynapseHandler Initialization issue on opentracing"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "1c1dca1abeefb838aace715351ed74d06736513e", "author": {"user": {"login": "tharindu1st", "name": "Tharindu Dasun Dharmarathna"}}, "url": "https://github.com/wso2/carbon-apimgt/commit/1c1dca1abeefb838aace715351ed74d06736513e", "committedDate": "2020-01-18T04:25:42Z", "message": "Fix https://github.com/wso2/product-apim/issues/6894 supported langauages"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a9977f91b317b51c4e7f837a399a46e1b4902dcb", "author": {"user": {"login": "tharindu1st", "name": "Tharindu Dasun Dharmarathna"}}, "url": "https://github.com/wso2/carbon-apimgt/commit/a9977f91b317b51c4e7f837a399a46e1b4902dcb", "committedDate": "2020-01-18T04:25:42Z", "message": "Fix JWT Generation for JWT Tokens"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "217a759f503c33e87719c6038294fcb05b6c8325", "author": {"user": {"login": "tharindu1st", "name": "Tharindu Dasun Dharmarathna"}}, "url": "https://github.com/wso2/carbon-apimgt/commit/217a759f503c33e87719c6038294fcb05b6c8325", "committedDate": "2020-01-18T04:41:30Z", "message": "Fix JWT Generation"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "1880cb3b432892eb8edeba7fd8d33924b6e74c5a", "author": {"user": {"login": "tharindu1st", "name": "Tharindu Dasun Dharmarathna"}}, "url": "https://github.com/wso2/carbon-apimgt/commit/1880cb3b432892eb8edeba7fd8d33924b6e74c5a", "committedDate": "2020-01-17T13:24:30Z", "message": "Fix JWT Generation"}, "afterCommit": {"oid": "217a759f503c33e87719c6038294fcb05b6c8325", "author": {"user": {"login": "tharindu1st", "name": "Tharindu Dasun Dharmarathna"}}, "url": "https://github.com/wso2/carbon-apimgt/commit/217a759f503c33e87719c6038294fcb05b6c8325", "committedDate": "2020-01-18T04:41:30Z", "message": "Fix JWT Generation"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3022, "cost": 1, "resetAt": "2021-11-02T10:47:05Z"}}}