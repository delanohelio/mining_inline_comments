{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDAzMDcyNTAz", "number": 8405, "title": "Add REST API to retrieve subscriber-info", "bodyText": "This PR adds new Publisher REST API to retrieve subscriber-info. REST API path is : /subscriptions/{subscription-id}/subscriber-info\nRequest format:\ncurl -X GET \"https://localhost:9443/api/am/publisher/v1/subscriptions/{subscriptionId}/subscriber-info\" -H  \"Authorization: Bearer xxxxxxx\"\nSample request:\ncurl -X GET \"https://localhost:9443/api/am/publisher/v1/subscriptions/04b306b6-49da-49fc-88ae-feb6dc87150b/subscriber-info\" -H  \"Authorization: Bearer 33f03b51-6f97-3076-9eb0-0045b04e1706\" \nSample response:\n{\n  \"name\": \"user1@test.com\",\n  \"claims\": [\n    {\n      \"name\": \"First Name\",\n      \"value\": \"user1\",\n      \"URI\": \"http://wso2.org/claims/givenname\"\n    },\n    {\n      \"name\": \"Last Name\",\n      \"value\": \"user1\",\n      \"URI\": \"http://wso2.org/claims/lastname\"\n    },\n    {\n      \"name\": \"Email\",\n      \"value\": \"user1@wso2.com\",\n      \"URI\": \"http://wso2.org/claims/emailaddress\"\n    },\n    {\n      \"name\": \"Organization\",\n      \"value\": \"wso2\",\n      \"URI\": \"http://wso2.org/claims/organization\"\n    }\n  ]\n}\n\nRelated PR - wso2/product-apim#7906\nRelated Issue - wso2/product-apim#7873", "createdAt": "2020-04-14T09:29:57Z", "url": "https://github.com/wso2/carbon-apimgt/pull/8405", "merged": true, "mergeCommit": {"oid": "82ad7557af18e484ad6e0c68a0b8bd47cb3a06a3"}, "closed": true, "closedAt": "2020-04-22T10:51:53Z", "author": {"login": "vithu30"}, "timelineItems": {"totalCount": 9, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcXcBgwAH2gAyNDAzMDcyNTAzOmI2NWFkMmVmY2VjNmY2NzBlZjRhZDMxYTEwMTlmMmM4ZjlhMDYxY2U=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcaD_9EgH2gAyNDAzMDcyNTAzOjVkNjU2Mjk3NGRkMTczMjcxZWJiMTIzMGZiM2Q3NmNhMmVlYTYyMjM=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "b65ad2efcec6f670ef4ad31a1019f2c8f9a061ce", "author": {"user": {"login": "vithu30", "name": "Vithursa"}}, "url": "https://github.com/wso2/carbon-apimgt/commit/b65ad2efcec6f670ef4ad31a1019f2c8f9a061ce", "committedDate": "2020-04-14T04:45:20Z", "message": "Add implementation for retrieving subscriber claims"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "11af67c9b4d1b6b12b00e9c8297b3b49add005f8", "author": {"user": {"login": "vithu30", "name": "Vithursa"}}, "url": "https://github.com/wso2/carbon-apimgt/commit/11af67c9b4d1b6b12b00e9c8297b3b49add005f8", "committedDate": "2020-04-14T05:01:44Z", "message": "Modified testcases"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzkzNDM5MzQ1", "url": "https://github.com/wso2/carbon-apimgt/pull/8405#pullrequestreview-393439345", "createdAt": "2020-04-15T03:54:54Z", "commit": {"oid": "11af67c9b4d1b6b12b00e9c8297b3b49add005f8"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xNVQwMzo1NDo1NFrOGFo3vQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xNVQwMzo1NDo1NFrOGFo3vQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwODU2NTY5Mw==", "bodyText": "We should pass the full username to get the tenant domain correctly.\nPlease test with an email username for a tenant.", "url": "https://github.com/wso2/carbon-apimgt/pull/8405#discussion_r408565693", "createdAt": "2020-04-15T03:54:54Z", "author": {"login": "isharac"}, "path": "components/apimgt/org.wso2.carbon.apimgt.impl/src/main/java/org/wso2/carbon/apimgt/impl/APIProviderImpl.java", "diffHunk": "@@ -2006,6 +2008,51 @@ public void makeAPIKeysForwardCompatible(API api) throws APIManagementException\n         }\n     }\n \n+    /**\n+     * Returns the subscriber name for the given subscription id.\n+     *\n+     * @param subscriptionId The subscription id of the subscriber to be returned\n+     * @return The subscriber or null if the requested subscriber does not exist\n+     * @throws APIManagementException if failed to get Subscriber\n+     */\n+    @Override\n+    public String getSubscriber(String subscriptionId) throws APIManagementException {\n+        return apiMgtDAO.getSubscriberName(subscriptionId);\n+    }\n+\n+    /**\n+     * Returns the claims of subscriber for the given subscriber.\n+     *\n+     * @param subscriber The name of the subscriber to be returned\n+     * @return The looked up claims of the subscriber or null if the requested subscriber does not exist\n+     * @throws APIManagementException if failed to get Subscriber\n+     */\n+    @Override\n+    public List getSubscriberClaims(String subscriber) throws APIManagementException {\n+        String tenantDomain = MultitenantUtils.getTenantDomain(subscriber);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "11af67c9b4d1b6b12b00e9c8297b3b49add005f8"}, "originalPosition": 41}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "206caa818442818b4ed0483269925bdd728c2721", "author": {"user": {"login": "vithu30", "name": "Vithursa"}}, "url": "https://github.com/wso2/carbon-apimgt/commit/206caa818442818b4ed0483269925bdd728c2721", "committedDate": "2020-04-20T13:58:25Z", "message": "Commit missing auto-gen file changes"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzk2NTU2MTYx", "url": "https://github.com/wso2/carbon-apimgt/pull/8405#pullrequestreview-396556161", "createdAt": "2020-04-20T15:20:34Z", "commit": {"oid": "206caa818442818b4ed0483269925bdd728c2721"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yMFQxNToyMDozNFrOGIZ36w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yMFQxNToyMDozNFrOGIZ36w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMTQ2NTcwNw==", "bodyText": "Can we use try with resources?", "url": "https://github.com/wso2/carbon-apimgt/pull/8405#discussion_r411465707", "createdAt": "2020-04-20T15:20:34Z", "author": {"login": "malinthaprasan"}, "path": "components/apimgt/org.wso2.carbon.apimgt.impl/src/main/java/org/wso2/carbon/apimgt/impl/dao/ApiMgtDAO.java", "diffHunk": "@@ -590,6 +590,51 @@ public void addSubscriber(Subscriber subscriber, String groupingId) throws APIMa\n         }\n     }\n \n+    /**\n+     * Get subscriber name using subscription ID\n+     *\n+     * @param subscriptionId\n+     * @return subscriber name\n+     * @throws APIManagementException\n+     */\n+    public String getSubscriberName(String subscriptionId) throws APIManagementException {\n+        int subscriberId = getSubscriberIdBySubscriptionUUID(subscriptionId);\n+        Subscriber subscriber = getSubscriber(subscriberId);\n+        if (subscriber != null) {\n+            return subscriber.getName();\n+        }\n+        return StringUtils.EMPTY;\n+    }\n+\n+    /**\n+     * Get subscriber ID using subscription ID\n+     *\n+     * @param subscriptionId\n+     * @return subscriber ID\n+     * @throws APIManagementException\n+     */\n+    private int getSubscriberIdBySubscriptionUUID(String subscriptionId) throws APIManagementException {\n+        Connection connection = null;\n+        ResultSet rs = null;\n+        PreparedStatement ps = null;\n+        int subscirberId = 0;\n+        try {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "206caa818442818b4ed0483269925bdd728c2721"}, "originalPosition": 32}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzk2NTYwODYx", "url": "https://github.com/wso2/carbon-apimgt/pull/8405#pullrequestreview-396560861", "createdAt": "2020-04-20T15:25:36Z", "commit": {"oid": "206caa818442818b4ed0483269925bdd728c2721"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "4b0356dbd07b9e8aaa4f283845c343996467b748", "author": {"user": {"login": "vithu30", "name": "Vithursa"}}, "url": "https://github.com/wso2/carbon-apimgt/commit/4b0356dbd07b9e8aaa4f283845c343996467b748", "committedDate": "2020-04-21T04:09:37Z", "message": "Resolve review comments"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzk2OTc3NTU2", "url": "https://github.com/wso2/carbon-apimgt/pull/8405#pullrequestreview-396977556", "createdAt": "2020-04-21T04:26:03Z", "commit": {"oid": "4b0356dbd07b9e8aaa4f283845c343996467b748"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "5d6562974dd173271ebb1230fb3d76ca2eea6223", "author": {"user": {"login": "vithu30", "name": "Vithursa"}}, "url": "https://github.com/wso2/carbon-apimgt/commit/5d6562974dd173271ebb1230fb3d76ca2eea6223", "committedDate": "2020-04-22T08:27:41Z", "message": "Resolve review comments"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2887, "cost": 1, "resetAt": "2021-11-02T10:47:05Z"}}}