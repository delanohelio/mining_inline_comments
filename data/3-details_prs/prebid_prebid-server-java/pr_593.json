{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0MzY0MTM2MDgy", "number": 593, "title": "Fix Facebook adapter ignoring banner.format sizes", "bodyText": "Check Format if height is null added\nTest added", "createdAt": "2020-01-17T13:14:49Z", "url": "https://github.com/prebid/prebid-server-java/pull/593", "merged": true, "mergeCommit": {"oid": "1b4c543d974443e185f589a146d1861296d5efa3"}, "closed": true, "closedAt": "2020-01-24T14:25:56Z", "author": {"login": "apaliy"}, "timelineItems": {"totalCount": 6, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABb7Od6KAH2gAyMzY0MTM2MDgyOjI1MTY4NDdjNDgzNTEzYzhjMzgxZTZjYmI0M2Y3OTNmY2FlZmFjZjA=", "endCursor": "Y3Vyc29yOnYyOpPPAAABb8ka5ogFqTM0NjA1MDUwOQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "2516847c483513c8c381e6cbb43f793fcaefacf0", "author": {"user": {"login": "apaliy", "name": "Andrew Paliy"}}, "url": "https://github.com/prebid/prebid-server-java/commit/2516847c483513c8c381e6cbb43f793fcaefacf0", "committedDate": "2020-01-17T13:07:48Z", "message": "Fix audienceNetwork adapter ignoring banner.format sizes"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzQ1MjUxOTQy", "url": "https://github.com/prebid/prebid-server-java/pull/593#pullrequestreview-345251942", "createdAt": "2020-01-20T11:42:42Z", "commit": {"oid": "2516847c483513c8c381e6cbb43f793fcaefacf0"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yMFQxMTo0Mjo0M1rOFfbvZQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yMFQxMTo1NDo1OVrOFfcCEA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2ODUwNDY3Nw==", "bodyText": "This method can be transformed to list of supported sizes.", "url": "https://github.com/prebid/prebid-server-java/pull/593#discussion_r368504677", "createdAt": "2020-01-20T11:42:43Z", "author": {"login": "rpanchyk"}, "path": "src/main/java/org/prebid/server/bidder/facebook/FacebookBidder.java", "diffHunk": "@@ -207,14 +208,32 @@ private static Banner modifyBanner(Imp imp, boolean impInstlEqOne) {\n             return banner.toBuilder().w(0).h(0).format(null).build();\n         }\n \n-        if (!Objects.equals(banner.getH(), 50) && !Objects.equals(banner.getH(), 250)) {\n+        if (banner.getH() == null) {\n+            for (int i = 0; i < banner.getFormat().size(); i++) {\n+                final Format format = banner.getFormat().get(i);\n+                if (format != null && isBannerHeightValid(format.getH())) {\n+                    return banner.toBuilder()\n+                            .w(0)\n+                            .h(format.getH())\n+                            .format(null)\n+                            .build();\n+                }\n+            }\n+            throw new PreBidException(String.format(\"imp #%s: banner height required\", imp.getId()));\n+        }\n+\n+        if (!isBannerHeightValid(banner.getH())) {\n             throw new PreBidException(String.format(\"imp #%s: only banner heights 50 and 250 are supported\",\n                     imp.getId()));\n         }\n \n         return banner.toBuilder().w(-1).format(null).build();\n     }\n \n+    private static boolean isBannerHeightValid(Integer h) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "2516847c483513c8c381e6cbb43f793fcaefacf0"}, "originalPosition": 35}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2ODUwNTAzNQ==", "bodyText": "Can banner.getFormat() be null?\nCan we use foreach here for better readability?", "url": "https://github.com/prebid/prebid-server-java/pull/593#discussion_r368505035", "createdAt": "2020-01-20T11:43:37Z", "author": {"login": "rpanchyk"}, "path": "src/main/java/org/prebid/server/bidder/facebook/FacebookBidder.java", "diffHunk": "@@ -207,14 +208,32 @@ private static Banner modifyBanner(Imp imp, boolean impInstlEqOne) {\n             return banner.toBuilder().w(0).h(0).format(null).build();\n         }\n \n-        if (!Objects.equals(banner.getH(), 50) && !Objects.equals(banner.getH(), 250)) {\n+        if (banner.getH() == null) {\n+            for (int i = 0; i < banner.getFormat().size(); i++) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "2516847c483513c8c381e6cbb43f793fcaefacf0"}, "originalPosition": 14}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2ODUwODI5MA==", "bodyText": "It is better to involve else if here, to prevent unnecessary code execution.", "url": "https://github.com/prebid/prebid-server-java/pull/593#discussion_r368508290", "createdAt": "2020-01-20T11:51:57Z", "author": {"login": "rpanchyk"}, "path": "src/main/java/org/prebid/server/bidder/facebook/FacebookBidder.java", "diffHunk": "@@ -207,14 +208,32 @@ private static Banner modifyBanner(Imp imp, boolean impInstlEqOne) {\n             return banner.toBuilder().w(0).h(0).format(null).build();\n         }\n \n-        if (!Objects.equals(banner.getH(), 50) && !Objects.equals(banner.getH(), 250)) {\n+        if (banner.getH() == null) {\n+            for (int i = 0; i < banner.getFormat().size(); i++) {\n+                final Format format = banner.getFormat().get(i);\n+                if (format != null && isBannerHeightValid(format.getH())) {\n+                    return banner.toBuilder()\n+                            .w(0)\n+                            .h(format.getH())\n+                            .format(null)\n+                            .build();\n+                }\n+            }\n+            throw new PreBidException(String.format(\"imp #%s: banner height required\", imp.getId()));\n+        }\n+\n+        if (!isBannerHeightValid(banner.getH())) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "2516847c483513c8c381e6cbb43f793fcaefacf0"}, "originalPosition": 27}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2ODUwOTQ1Ng==", "bodyText": "Seems we have to set w = 0 according to formal implementation.", "url": "https://github.com/prebid/prebid-server-java/pull/593#discussion_r368509456", "createdAt": "2020-01-20T11:54:59Z", "author": {"login": "rpanchyk"}, "path": "src/main/java/org/prebid/server/bidder/facebook/FacebookBidder.java", "diffHunk": "@@ -207,14 +208,32 @@ private static Banner modifyBanner(Imp imp, boolean impInstlEqOne) {\n             return banner.toBuilder().w(0).h(0).format(null).build();\n         }\n \n-        if (!Objects.equals(banner.getH(), 50) && !Objects.equals(banner.getH(), 250)) {\n+        if (banner.getH() == null) {\n+            for (int i = 0; i < banner.getFormat().size(); i++) {\n+                final Format format = banner.getFormat().get(i);\n+                if (format != null && isBannerHeightValid(format.getH())) {\n+                    return banner.toBuilder()\n+                            .w(0)\n+                            .h(format.getH())\n+                            .format(null)\n+                            .build();\n+                }\n+            }\n+            throw new PreBidException(String.format(\"imp #%s: banner height required\", imp.getId()));\n+        }\n+\n+        if (!isBannerHeightValid(banner.getH())) {\n             throw new PreBidException(String.format(\"imp #%s: only banner heights 50 and 250 are supported\",\n                     imp.getId()));\n         }\n \n         return banner.toBuilder().w(-1).format(null).build();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "2516847c483513c8c381e6cbb43f793fcaefacf0"}, "originalPosition": 32}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "86a631ea39cc8a476b03bd626ec72e5948e6326b", "author": {"user": {"login": "apaliy", "name": "Andrew Paliy"}}, "url": "https://github.com/prebid/prebid-server-java/commit/86a631ea39cc8a476b03bd626ec72e5948e6326b", "committedDate": "2020-01-20T12:56:35Z", "message": "Fixed minor issues"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "bf1ce421e63835ac539265e7aada647b1f59facd", "author": {"user": {"login": "apaliy", "name": "Andrew Paliy"}}, "url": "https://github.com/prebid/prebid-server-java/commit/bf1ce421e63835ac539265e7aada647b1f59facd", "committedDate": "2020-01-20T13:01:55Z", "message": "Fixed minor issues"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "4c79bfe1c92a382033a29a161c821e820ac8dc3f", "author": {"user": {"login": "apaliy", "name": "Andrew Paliy"}}, "url": "https://github.com/prebid/prebid-server-java/commit/4c79bfe1c92a382033a29a161c821e820ac8dc3f", "committedDate": "2020-01-21T16:06:11Z", "message": "Rewarded Video code cleanup, test fix"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzQ2MDUwNTA5", "url": "https://github.com/prebid/prebid-server-java/pull/593#pullrequestreview-346050509", "createdAt": "2020-01-21T17:16:21Z", "commit": {"oid": "4c79bfe1c92a382033a29a161c821e820ac8dc3f"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3252, "cost": 1, "resetAt": "2021-11-01T16:37:27Z"}}}