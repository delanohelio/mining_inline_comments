{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDczNTE4MDc5", "number": 876, "title": "Set bid currency from response", "bodyText": "Check if currency in response is not empty and blank and set it in bids.\nInstead of using default value of currency it is modified:\nStringUtils.stripToNull(bidResponse.getCur())\nSharethroughBidder and VisxBidder have specific response without currency inside. So for these bidders it is set default value of currency in bids.", "createdAt": "2020-08-25T21:56:52Z", "url": "https://github.com/prebid/prebid-server-java/pull/876", "merged": true, "mergeCommit": {"oid": "55e2dd479b1830c4c04fa2a2a1a04ea4d46ef19f"}, "closed": true, "closedAt": "2020-10-30T14:02:44Z", "author": {"login": "AndriyPavlyuk"}, "timelineItems": {"totalCount": 20, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdCeWVjAH2gAyNDczNTE4MDc5OjdiZDM2NWUwZmZhMzY1M2U0NTg2Yjc5OWQ0NWNjNjYxOGVjMTg5YzA=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdXnQUegFqTUyMDY5NjkzMA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "7bd365e0ffa3653e4586b799d45cc6618ec189c0", "author": {"user": {"login": "AndriyPavlyuk", "name": null}}, "url": "https://github.com/prebid/prebid-server-java/commit/7bd365e0ffa3653e4586b799d45cc6618ec189c0", "committedDate": "2020-08-25T21:46:38Z", "message": "Get bidcurrency from response"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "77807a31b76380f3e4d8c8f62e5248dead1b6475", "author": {"user": {"login": "AndriyPavlyuk", "name": null}}, "url": "https://github.com/prebid/prebid-server-java/commit/77807a31b76380f3e4d8c8f62e5248dead1b6475", "committedDate": "2020-09-01T21:42:57Z", "message": "Add currency validation to BidResponseValidator"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "1ea6ae7eaaf08e7a4dc01cbf0397668f08bd69da", "author": {"user": {"login": "AndriyPavlyuk", "name": null}}, "url": "https://github.com/prebid/prebid-server-java/commit/1ea6ae7eaaf08e7a4dc01cbf0397668f08bd69da", "committedDate": "2020-09-01T21:50:14Z", "message": "Additional changes"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "5bac34c31caefa9e376f973ce07c211fb4070a7b", "author": {"user": {"login": "AndriyPavlyuk", "name": null}}, "url": "https://github.com/prebid/prebid-server-java/commit/5bac34c31caefa9e376f973ce07c211fb4070a7b", "committedDate": "2020-09-02T13:19:05Z", "message": "Change defining currency in OpenrtbBidder"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "27f8d09414a586e5a622364753c276e3b87b5e76", "author": {"user": {"login": "AndriyPavlyuk", "name": null}}, "url": "https://github.com/prebid/prebid-server-java/commit/27f8d09414a586e5a622364753c276e3b87b5e76", "committedDate": "2020-09-02T14:00:01Z", "message": "Removing default currency from bidders"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a881321f868e611c81acd786abc7c998af0bb266", "author": {"user": {"login": "AndriyPavlyuk", "name": null}}, "url": "https://github.com/prebid/prebid-server-java/commit/a881321f868e611c81acd786abc7c998af0bb266", "committedDate": "2020-09-02T14:09:58Z", "message": "Merge branch 'master' into bidders-get-bid-currency-from-response\n\n# Conflicts:\n#\tsrc/main/java/org/prebid/server/bidder/rubicon/RubiconBidder.java"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f3876ad0ce29deb42cce86fbe24401dd3d80b1e7", "author": {"user": {"login": "AndriyPavlyuk", "name": null}}, "url": "https://github.com/prebid/prebid-server-java/commit/f3876ad0ce29deb42cce86fbe24401dd3d80b1e7", "committedDate": "2020-09-02T14:13:32Z", "message": "Resolving conflicts"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "6a17fd1ba5d885cb333cc496e7cbbb1be49e420c", "author": {"user": {"login": "rpanchyk", "name": null}}, "url": "https://github.com/prebid/prebid-server-java/commit/6a17fd1ba5d885cb333cc496e7cbbb1be49e420c", "committedDate": "2020-09-10T13:31:02Z", "message": "Merge branch 'master' into bidders-get-bid-currency-from-response"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDg1OTQ3OTk4", "url": "https://github.com/prebid/prebid-server-java/pull/876#pullrequestreview-485947998", "createdAt": "2020-09-10T13:41:57Z", "commit": {"oid": "f3876ad0ce29deb42cce86fbe24401dd3d80b1e7"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xMFQxMzo0Mjo0OFrOHP0YOA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xMFQxMzo0Mjo0OFrOHP0YOA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NjM0ODg1Ng==", "bodyText": "Sorry, but i have a crazy thought about stripToNull action performing.\nIt is kind frail to add this in each bidder, may be for simplicity it is reasonable to leave it as is like: bidResponse.getCur() without any processing. Then, in ExchangeService (before currency conversion service call) we can add this stripToNull action.\nSo, just in one place - before actual using the currency value.\nWhat do you think?", "url": "https://github.com/prebid/prebid-server-java/pull/876#discussion_r486348856", "createdAt": "2020-09-10T13:42:48Z", "author": {"login": "rpanchyk"}, "path": "src/main/java/org/prebid/server/bidder/OpenrtbBidder.java", "diffHunk": "@@ -231,7 +229,7 @@ protected void modifyRequest(BidRequest bidRequest, BidRequest.BidRequestBuilder\n                 .filter(Objects::nonNull)\n                 .flatMap(Collection::stream)\n                 .map(bid -> BidderBid.of(bid, getBidType(bid.getImpid(), bidRequest.getImp()),\n-                        getBidCurrency(bidRequest.getCur(), bidResponse.getCur())))\n+                        StringUtils.stripToNull(bidResponse.getCur())))", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "6a17fd1ba5d885cb333cc496e7cbbb1be49e420c"}, "originalPosition": 23}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "21011a7edef29b488f5dda5b8727263767a53e20", "author": {"user": {"login": "AndriyPavlyuk", "name": null}}, "url": "https://github.com/prebid/prebid-server-java/commit/21011a7edef29b488f5dda5b8727263767a53e20", "committedDate": "2020-09-11T09:49:15Z", "message": "Merge branch 'master' into bidders-get-bid-currency-from-response"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "0b20bcd1cbfbadb7bf3909684c9bf3c5f28308a5", "author": {"user": {"login": "AndriyPavlyuk", "name": null}}, "url": "https://github.com/prebid/prebid-server-java/commit/0b20bcd1cbfbadb7bf3909684c9bf3c5f28308a5", "committedDate": "2020-09-11T12:22:31Z", "message": "Add stripToNull function just to ExchangeService"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f52cee95e885acb3ae748f5622dc5567407c1f16", "author": {"user": {"login": "AndriyPavlyuk", "name": null}}, "url": "https://github.com/prebid/prebid-server-java/commit/f52cee95e885acb3ae748f5622dc5567407c1f16", "committedDate": "2020-09-11T12:22:52Z", "message": "Merge remote-tracking branch 'internal-github/bidders-get-bid-currency-from-response' into bidders-get-bid-currency-from-response"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "161c06b4504aa679e6931675a0aa4ecded2f940f", "author": {"user": {"login": "AndriyPavlyuk", "name": null}}, "url": "https://github.com/prebid/prebid-server-java/commit/161c06b4504aa679e6931675a0aa4ecded2f940f", "committedDate": "2020-09-11T12:34:12Z", "message": "Fixing unit test in ExchangeServiceTest"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "0b6482dfac1abb0b058777b555b774fc33396eac", "author": {"user": {"login": "AndriyPavlyuk", "name": null}}, "url": "https://github.com/prebid/prebid-server-java/commit/0b6482dfac1abb0b058777b555b774fc33396eac", "committedDate": "2020-09-11T13:17:57Z", "message": "Fixing test for currency"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ed5b4529fadfcba0fc6aebc4905a1c72c04e48f3", "author": {"user": {"login": "AndriyPavlyuk", "name": null}}, "url": "https://github.com/prebid/prebid-server-java/commit/ed5b4529fadfcba0fc6aebc4905a1c72c04e48f3", "committedDate": "2020-09-11T14:12:49Z", "message": "Move method to currency service invoking"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "18901b0395c4e80522850a4230c251b6ae34dc9e", "author": {"user": {"login": "rpanchyk", "name": null}}, "url": "https://github.com/prebid/prebid-server-java/commit/18901b0395c4e80522850a4230c251b6ae34dc9e", "committedDate": "2020-09-14T13:14:34Z", "message": "Merge branch 'master' into bidders-get-bid-currency-from-response"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "daa266f8aaf11ce88796bceabd8734262df95825", "author": {"user": {"login": "rpanchyk", "name": null}}, "url": "https://github.com/prebid/prebid-server-java/commit/daa266f8aaf11ce88796bceabd8734262df95825", "committedDate": "2020-09-14T13:38:47Z", "message": "Clean code"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDg3Nzc5Njg3", "url": "https://github.com/prebid/prebid-server-java/pull/876#pullrequestreview-487779687", "createdAt": "2020-09-14T13:40:47Z", "commit": {"oid": "daa266f8aaf11ce88796bceabd8734262df95825"}, "state": "DISMISSED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a33a14c3eab2a08c4ed60b94ba5f088bb59ba4ff", "author": {"user": null}, "url": "https://github.com/prebid/prebid-server-java/commit/a33a14c3eab2a08c4ed60b94ba5f088bb59ba4ff", "committedDate": "2020-10-30T12:08:40Z", "message": "Merge branch 'master' into bidders-get-bid-currency-from-response\n\n# Conflicts:\n#\tsrc/main/java/org/prebid/server/auction/ExchangeService.java\n#\tsrc/main/java/org/prebid/server/bidder/gamma/GammaBidder.java\n#\tsrc/main/java/org/prebid/server/bidder/gumgum/GumgumBidder.java\n#\tsrc/main/java/org/prebid/server/bidder/kubient/KubientBidder.java\n#\tsrc/main/java/org/prebid/server/bidder/pubmatic/PubmaticBidder.java\n#\tsrc/main/java/org/prebid/server/bidder/rubicon/RubiconBidder.java\n#\tsrc/main/java/org/prebid/server/bidder/telaria/TelariaBidder.java\n#\tsrc/test/java/org/prebid/server/bidder/ix/IxBidderTest.java"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTIwNjk2OTMw", "url": "https://github.com/prebid/prebid-server-java/pull/876#pullrequestreview-520696930", "createdAt": "2020-10-30T14:01:37Z", "commit": {"oid": "a33a14c3eab2a08c4ed60b94ba5f088bb59ba4ff"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3141, "cost": 1, "resetAt": "2021-11-01T16:37:27Z"}}}