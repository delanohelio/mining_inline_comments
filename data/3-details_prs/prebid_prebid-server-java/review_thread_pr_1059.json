{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTM0NDIwMTMx", "number": 1059, "reviewThreads": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0wOFQxMzowMzoxNVrOFCUfSQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0wOFQxMzo0OTo0OVrOFCWQ2g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzM3OTc3MTYxOnYy", "diffSide": "RIGHT", "path": "src/main/java/org/prebid/server/bidder/gumgum/GumgumBidder.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0wOFQxMzowMzoxNVrOIBZ2Hg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0wOFQxMzowMzoxNVrOIBZ2Hg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzODM0Mjk0Mg==", "bodyText": "Minor. Not the issue but just to inform, in this case we may use ObjectUtils.defaultIfNull(..) since trackingId is a string value.", "url": "https://github.com/prebid/prebid-server-java/pull/1059#discussion_r538342942", "createdAt": "2020-12-08T13:03:15Z", "author": {"login": "rpanchyk"}, "path": "src/main/java/org/prebid/server/bidder/gumgum/GumgumBidder.java", "diffHunk": "@@ -156,7 +158,7 @@ private static boolean isNullOrZero(Integer number) {\n     }\n \n     private static Site modifySite(Site site, String trackingId) {\n-        return site != null ? site.toBuilder().id(trackingId).build() : null;\n+        return site != null ? site.toBuilder().id(Objects.toString(trackingId, \"\")).build() : null;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "0db251de96b0db36f4cd79341ed17be48603a30a"}, "originalPosition": 98}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzM3OTk1NTM5OnYy", "diffSide": "RIGHT", "path": "src/main/java/org/prebid/server/bidder/gumgum/GumgumBidder.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0wOFQxMzozMzoyM1rOIBbsmQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0wOFQxMzozMzoyM1rOIBbsmQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzODM3MzI3Mw==", "bodyText": "use ? :", "url": "https://github.com/prebid/prebid-server-java/pull/1059#discussion_r538373273", "createdAt": "2020-12-08T13:33:23Z", "author": {"login": "DGarbar"}, "path": "src/main/java/org/prebid/server/bidder/gumgum/GumgumBidder.java", "diffHunk": "@@ -177,26 +180,34 @@ private static Site modifySite(Site site, String trackingId) {\n \n     private static List<BidderBid> bidsFromResponse(BidResponse bidResponse, BidRequest bidRequest) {\n         return bidResponse.getSeatbid().stream()\n+                .filter(Objects::nonNull)\n                 .map(SeatBid::getBid)\n                 .flatMap(Collection::stream)\n+                .filter(Objects::nonNull)\n                 .map(bid -> toBidderBid(bid, bidRequest, bidResponse.getCur()))\n                 .collect(Collectors.toList());\n     }\n \n     private static BidderBid toBidderBid(Bid bid, BidRequest bidRequest, String currency) {\n         final BidType bidType = getMediaType(bid.getImpid(), bidRequest.getImp());\n         final Bid updatedBid = bidType == BidType.video\n-                ? bid.toBuilder().adm(bid.getAdm().replace(\"${AUCTION_PRICE}\", String.valueOf(bid.getPrice()))).build()\n-                : bid;\n+                ? bid.toBuilder().adm(resolveAdm(bid.getAdm(), bid.getPrice())).build() : bid;\n         return BidderBid.of(updatedBid, bidType, currency);\n     }\n \n     private static BidType getMediaType(String impId, List<Imp> requestImps) {\n         for (Imp imp : requestImps) {\n-            if (imp.getId().equals(impId) && imp.getBanner() != null) {\n-                return BidType.banner;\n+            if (imp.getId().equals(impId)) {\n+                if (imp.getBanner() != null) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a515ed172edce0b6afdf913f6a9820771402fa0c"}, "originalPosition": 136}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzM3OTk1OTQzOnYy", "diffSide": "RIGHT", "path": "src/test/java/org/prebid/server/bidder/gumgum/GumgumBidderTest.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0wOFQxMzozMzo1OFrOIBbvIw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0wOFQxMzozMzo1OFrOIBbvIw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzODM3MzkyMw==", "bodyText": "should set What?", "url": "https://github.com/prebid/prebid-server-java/pull/1059#discussion_r538373923", "createdAt": "2020-12-08T13:33:58Z", "author": {"login": "DGarbar"}, "path": "src/test/java/org/prebid/server/bidder/gumgum/GumgumBidderTest.java", "diffHunk": "@@ -121,12 +128,37 @@ public void makeHttpRequestsShouldSkipImpressionsWithoutBannerOrVideo() {\n \n         // then\n         assertThat(result.getErrors()).isEmpty();\n-        assertThat(result.getValue()).hasSize(1)\n-                .extracting(httpRequest -> mapper.readValue(httpRequest.getBody(), BidRequest.class))\n+        assertThat(result.getValue())\n+                .extracting(HttpRequest::getPayload)\n                 .flatExtracting(BidRequest::getImp)\n                 .extracting(Imp::getBanner)\n                 .extracting(Banner::getId)\n-                .containsOnly(\"banner_id\");\n+                .containsExactly(\"banner_id\");\n+    }\n+\n+    @Test\n+    public void makeHttpRequestsShouldSet() {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a515ed172edce0b6afdf913f6a9820771402fa0c"}, "originalPosition": 67}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzM4MDAyMTUxOnYy", "diffSide": "RIGHT", "path": "src/main/java/org/prebid/server/bidder/gumgum/GumgumBidder.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0wOFQxMzo0Mzo1MFrOIBcWyQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0wOFQxMzo0Mzo1MFrOIBcWyQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzODM4NDA3Mw==", "bodyText": "/n", "url": "https://github.com/prebid/prebid-server-java/pull/1059#discussion_r538384073", "createdAt": "2020-12-08T13:43:50Z", "author": {"login": "DGarbar"}, "path": "src/main/java/org/prebid/server/bidder/gumgum/GumgumBidder.java", "diffHunk": "@@ -177,26 +180,34 @@ private static Site modifySite(Site site, String trackingId) {\n \n     private static List<BidderBid> bidsFromResponse(BidResponse bidResponse, BidRequest bidRequest) {\n         return bidResponse.getSeatbid().stream()\n+                .filter(Objects::nonNull)\n                 .map(SeatBid::getBid)\n                 .flatMap(Collection::stream)\n+                .filter(Objects::nonNull)\n                 .map(bid -> toBidderBid(bid, bidRequest, bidResponse.getCur()))\n                 .collect(Collectors.toList());\n     }\n \n     private static BidderBid toBidderBid(Bid bid, BidRequest bidRequest, String currency) {\n         final BidType bidType = getMediaType(bid.getImpid(), bidRequest.getImp());\n         final Bid updatedBid = bidType == BidType.video\n-                ? bid.toBuilder().adm(bid.getAdm().replace(\"${AUCTION_PRICE}\", String.valueOf(bid.getPrice()))).build()\n-                : bid;\n+                ? bid.toBuilder().adm(resolveAdm(bid.getAdm(), bid.getPrice())).build() : bid;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a515ed172edce0b6afdf913f6a9820771402fa0c"}, "originalPosition": 127}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzM4MDA2MjM0OnYy", "diffSide": "RIGHT", "path": "src/main/java/org/prebid/server/bidder/gumgum/GumgumBidder.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0wOFQxMzo0OTo0OVrOIBcw_g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0wOFQxNDoxOToxM1rOIBew8Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzODM5MDc4Mg==", "bodyText": "replaceAll", "url": "https://github.com/prebid/prebid-server-java/pull/1059#discussion_r538390782", "createdAt": "2020-12-08T13:49:49Z", "author": {"login": "DGarbar"}, "path": "src/main/java/org/prebid/server/bidder/gumgum/GumgumBidder.java", "diffHunk": "@@ -177,26 +180,34 @@ private static Site modifySite(Site site, String trackingId) {\n \n     private static List<BidderBid> bidsFromResponse(BidResponse bidResponse, BidRequest bidRequest) {\n         return bidResponse.getSeatbid().stream()\n+                .filter(Objects::nonNull)\n                 .map(SeatBid::getBid)\n                 .flatMap(Collection::stream)\n+                .filter(Objects::nonNull)\n                 .map(bid -> toBidderBid(bid, bidRequest, bidResponse.getCur()))\n                 .collect(Collectors.toList());\n     }\n \n     private static BidderBid toBidderBid(Bid bid, BidRequest bidRequest, String currency) {\n         final BidType bidType = getMediaType(bid.getImpid(), bidRequest.getImp());\n         final Bid updatedBid = bidType == BidType.video\n-                ? bid.toBuilder().adm(bid.getAdm().replace(\"${AUCTION_PRICE}\", String.valueOf(bid.getPrice()))).build()\n-                : bid;\n+                ? bid.toBuilder().adm(resolveAdm(bid.getAdm(), bid.getPrice())).build() : bid;\n         return BidderBid.of(updatedBid, bidType, currency);\n     }\n \n     private static BidType getMediaType(String impId, List<Imp> requestImps) {\n         for (Imp imp : requestImps) {\n-            if (imp.getId().equals(impId) && imp.getBanner() != null) {\n-                return BidType.banner;\n+            if (imp.getId().equals(impId)) {\n+                if (imp.getBanner() != null) {\n+                    return BidType.banner;\n+                }\n+                return BidType.video;\n             }\n         }\n         return BidType.video;\n     }\n+\n+    private static String resolveAdm(String bidAdm, BigDecimal price) {\n+        return StringUtils.isNotBlank(bidAdm) ? bidAdm.replace(\"${AUCTION_PRICE}\", String.valueOf(price)) : bidAdm;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a515ed172edce0b6afdf913f6a9820771402fa0c"}, "originalPosition": 146}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzODQyMzUzNw==", "bodyText": "replaceAll works with regex  when replace works with string but also replaces every occurrences", "url": "https://github.com/prebid/prebid-server-java/pull/1059#discussion_r538423537", "createdAt": "2020-12-08T14:19:13Z", "author": {"login": "snahornyi"}, "path": "src/main/java/org/prebid/server/bidder/gumgum/GumgumBidder.java", "diffHunk": "@@ -177,26 +180,34 @@ private static Site modifySite(Site site, String trackingId) {\n \n     private static List<BidderBid> bidsFromResponse(BidResponse bidResponse, BidRequest bidRequest) {\n         return bidResponse.getSeatbid().stream()\n+                .filter(Objects::nonNull)\n                 .map(SeatBid::getBid)\n                 .flatMap(Collection::stream)\n+                .filter(Objects::nonNull)\n                 .map(bid -> toBidderBid(bid, bidRequest, bidResponse.getCur()))\n                 .collect(Collectors.toList());\n     }\n \n     private static BidderBid toBidderBid(Bid bid, BidRequest bidRequest, String currency) {\n         final BidType bidType = getMediaType(bid.getImpid(), bidRequest.getImp());\n         final Bid updatedBid = bidType == BidType.video\n-                ? bid.toBuilder().adm(bid.getAdm().replace(\"${AUCTION_PRICE}\", String.valueOf(bid.getPrice()))).build()\n-                : bid;\n+                ? bid.toBuilder().adm(resolveAdm(bid.getAdm(), bid.getPrice())).build() : bid;\n         return BidderBid.of(updatedBid, bidType, currency);\n     }\n \n     private static BidType getMediaType(String impId, List<Imp> requestImps) {\n         for (Imp imp : requestImps) {\n-            if (imp.getId().equals(impId) && imp.getBanner() != null) {\n-                return BidType.banner;\n+            if (imp.getId().equals(impId)) {\n+                if (imp.getBanner() != null) {\n+                    return BidType.banner;\n+                }\n+                return BidType.video;\n             }\n         }\n         return BidType.video;\n     }\n+\n+    private static String resolveAdm(String bidAdm, BigDecimal price) {\n+        return StringUtils.isNotBlank(bidAdm) ? bidAdm.replace(\"${AUCTION_PRICE}\", String.valueOf(price)) : bidAdm;", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzODM5MDc4Mg=="}, "originalCommit": {"oid": "a515ed172edce0b6afdf913f6a9820771402fa0c"}, "originalPosition": 146}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3853, "cost": 1, "resetAt": "2021-11-13T12:26:42Z"}}}