{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDg1MTEzODQw", "number": 908, "title": "Tolerate root fpd fields wrong types", "bodyText": "", "createdAt": "2020-09-11T14:08:34Z", "url": "https://github.com/prebid/prebid-server-java/pull/908", "merged": true, "mergeCommit": {"oid": "60ed65754104ece2bf744eb00e49b36403f1bf3e"}, "closed": true, "closedAt": "2020-09-14T10:38:41Z", "author": {"login": "BraslavskiyAndrey"}, "timelineItems": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdH0lBCAH2gAyNDg1MTEzODQwOmM4MzQzZGU5M2JmNGUzNmFkZWE4ZTE2Y2FkYzA2YTYyZTE2N2RlNGQ=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdIwwwwAFqTQ4NzYyNjcyNg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "c8343de93bf4e36adea8e16cadc06a62e167de4d", "author": {"user": {"login": "BraslavskiyAndrey", "name": "Braslavskyi Andrii"}}, "url": "https://github.com/prebid/prebid-server-java/commit/c8343de93bf4e36adea8e16cadc06a62e167de4d", "committedDate": "2020-09-11T12:30:12Z", "message": "Tolerate incorrect fpd types and remove these fields"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "80ff48336b43e7c3ebab91aca46ddce684e191e0", "author": {"user": {"login": "BraslavskiyAndrey", "name": "Braslavskyi Andrii"}}, "url": "https://github.com/prebid/prebid-server-java/commit/80ff48336b43e7c3ebab91aca46ddce684e191e0", "committedDate": "2020-09-11T14:04:17Z", "message": "Fix ortb resolver debug messages and logs"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDg3NjI1NTU2", "url": "https://github.com/prebid/prebid-server-java/pull/908#pullrequestreview-487625556", "createdAt": "2020-09-14T10:34:35Z", "commit": {"oid": "80ff48336b43e7c3ebab91aca46ddce684e191e0"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDg3NjI2NzI2", "url": "https://github.com/prebid/prebid-server-java/pull/908#pullrequestreview-487626726", "createdAt": "2020-09-14T10:36:25Z", "commit": {"oid": "80ff48336b43e7c3ebab91aca46ddce684e191e0"}, "state": "APPROVED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xNFQxMDozNjoyNVrOHRN0eA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xNFQxMDozNjoyNVrOHRN0eA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NzgxNDI2NA==", "bodyText": "Pls fix typo.", "url": "https://github.com/prebid/prebid-server-java/pull/908#discussion_r487814264", "createdAt": "2020-09-14T10:36:25Z", "author": {"login": "rpanchyk"}, "path": "src/main/java/org/prebid/server/auction/OrtbTypesResolver.java", "diffHunk": "@@ -95,52 +132,61 @@ void normalizeStandardFpdFields(JsonNode fpdContainerNode, List<String> warnings\n     private void normalizeRequestFpdFields(JsonNode fpdContainerNode, List<String> warnings) {\n         if (fpdContainerNode != null && fpdContainerNode.isObject()) {\n             final ObjectNode fpdContainerObjectNode = (ObjectNode) fpdContainerNode;\n+            final String bidRequestPrefix = BIDREQUEST + \".\";\n             updateWithNormalizedNode(fpdContainerObjectNode, USER, FIRST_ARRAY_ELEMENT_REQUEST_FIELDS,\n-                    COMMA_SEPARATED_ELEMENT_FIELDS, BIDREQUEST_PREFIX, warnings);\n+                    COMMA_SEPARATED_ELEMENT_FIELDS, bidRequestPrefix, warnings);\n             updateWithNormalizedNode(fpdContainerObjectNode, APP, FIRST_ARRAY_ELEMENT_REQUEST_FIELDS,\n-                    COMMA_SEPARATED_ELEMENT_FIELDS, BIDREQUEST_PREFIX, warnings);\n+                    COMMA_SEPARATED_ELEMENT_FIELDS, bidRequestPrefix, warnings);\n             updateWithNormalizedNode(fpdContainerObjectNode, SITE, FIRST_ARRAY_ELEMENT_REQUEST_FIELDS,\n-                    COMMA_SEPARATED_ELEMENT_FIELDS, BIDREQUEST_PREFIX, warnings);\n+                    COMMA_SEPARATED_ELEMENT_FIELDS, bidRequestPrefix, warnings);\n         }\n     }\n \n     private void updateWithNormalizedNode(ObjectNode containerNode, String nodeNameToNormalize,\n                                           Map<String, Set<String>> firstArrayElementsFields,\n                                           Map<String, Set<String>> commaSeparatedElementFields,\n-                                          String nodePrefix,\n-                                          List<String> warnings) {\n+                                          String nodePrefix, List<String> warnings) {\n         final JsonNode normalizedNode = normalizeNode(containerNode.get(nodeNameToNormalize), nodeNameToNormalize,\n                 firstArrayElementsFields, commaSeparatedElementFields, nodePrefix, warnings);\n         if (normalizedNode != null) {\n             containerNode.set(nodeNameToNormalize, normalizedNode);\n+        } else {\n+            containerNode.remove(nodeNameToNormalize);\n         }\n     }\n \n     private JsonNode normalizeNode(JsonNode containerNode, String nodeName,\n                                    Map<String, Set<String>> firstArrayElementsFields,\n                                    Map<String, Set<String>> commaSeparatedElementFields,\n-                                   String nodePrefix,\n-                                   List<String> warnings) {\n-        if (containerNode != null && containerNode.isObject()) {\n-            final ObjectNode containerObjectNode = (ObjectNode) containerNode;\n-\n-            CollectionUtils.emptyIfNull(firstArrayElementsFields.get(nodeName))\n-                    .forEach(fieldName -> updateWithNormalizedField(containerObjectNode, fieldName,\n-                            () -> toFirstElementTextNode(containerObjectNode, fieldName, nodeName, nodePrefix,\n-                                    warnings)));\n-\n-            CollectionUtils.emptyIfNull(commaSeparatedElementFields.get(nodeName))\n-                    .forEach(fieldName -> updateWithNormalizedField(containerObjectNode, fieldName,\n-                            () -> toCommaSeparatedTextNode(containerObjectNode, fieldName, nodeName, nodePrefix,\n-                                    warnings)));\n+                                   String nodePrefix, List<String> warnings) {\n+        if (containerNode != null) {\n+            if (containerNode.isObject()) {\n+                final ObjectNode containerObjectNode = (ObjectNode) containerNode;\n+\n+                CollectionUtils.emptyIfNull(firstArrayElementsFields.get(nodeName))\n+                        .forEach(fieldName -> updateWithNormalizedField(containerObjectNode, fieldName,\n+                                () -> toFirstElementTextNode(containerObjectNode, fieldName, nodeName, nodePrefix,\n+                                        warnings)));\n+\n+                CollectionUtils.emptyIfNull(commaSeparatedElementFields.get(nodeName))\n+                        .forEach(fieldName -> updateWithNormalizedField(containerObjectNode, fieldName,\n+                                () -> toCommaSeparatedTextNode(containerObjectNode, fieldName, nodeName, nodePrefix,\n+                                        warnings)));\n+            } else {\n+                warnings.add(String.format(\"FDP warning: %s%s field ignored. Expected type is object, but was `%s`.\",", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "80ff48336b43e7c3ebab91aca46ddce684e191e0"}, "originalPosition": 164}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2994, "cost": 1, "resetAt": "2021-11-01T16:37:27Z"}}}