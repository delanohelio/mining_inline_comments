{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDM1NzYwMTQ3", "number": 768, "title": "Add application settings documentation", "bodyText": "", "createdAt": "2020-06-17T10:34:30Z", "url": "https://github.com/prebid/prebid-server-java/pull/768", "merged": true, "mergeCommit": {"oid": "5bb0707b50c7d10a0d7670f2516262c0116e5ccc"}, "closed": true, "closedAt": "2020-06-24T14:54:39Z", "author": {"login": "BraslavskiyAndrey"}, "timelineItems": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcsHB_0AH2gAyNDM1NzYwMTQ3OmVhNTkwMzgwMjNkYzkwYTk4ZDJlNDU5ZTFkM2ZmNWVmMGJkNzIyNTk=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcubSamgFqTQzNjcyODYwOQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "ea59038023dc90a98d2e459e1d3ff5ef0bd72259", "author": {"user": {"login": "BraslavskiyAndrey", "name": "Braslavskyi Andrii"}}, "url": "https://github.com/prebid/prebid-server-java/commit/ea59038023dc90a98d2e459e1d3ff5ef0bd72259", "committedDate": "2020-06-17T10:10:16Z", "message": "Add application settings documentation"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDMyMzM0NTg1", "url": "https://github.com/prebid/prebid-server-java/pull/768#pullrequestreview-432334585", "createdAt": "2020-06-17T12:08:58Z", "commit": {"oid": "ea59038023dc90a98d2e459e1d3ff5ef0bd72259"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xN1QxMjowODo1OFrOGlCwhg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xN1QxMjowODo1OFrOGlCwhg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTQ5NTY4Ng==", "bodyText": "Seems this section is not required here.\nMay be circuit-breaker is also under the question, but up to you.", "url": "https://github.com/prebid/prebid-server-java/pull/768#discussion_r441495686", "createdAt": "2020-06-17T12:08:58Z", "author": {"login": "rpanchyk"}, "path": "docs/application-settings.md", "diffHunk": "@@ -0,0 +1,298 @@\n+# Application Settings\n+There are two ways to configure application settings: database and file. This document will describe both approaches.\n+\n+## Account properties\n+- `id` - identifies publisher account.\n+- `price-granularity` - defines price granularity types: 'low','med','high','auto','dense','unknown'.\n+- `banner-cache-ttl` - how long (in seconds) banner will be available via the external Cache Service.\n+- `video-cache-ttl`- how long (in seconds) video creative will be available via the external Cache Service.\n+- `events-enabled` - enables events for account if true\n+- `enforce-ccpa` - enforces ccpa if true. Has higher priority than configuration in application.yaml.\n+- `gdpr.enabled` - enables gdpr verifications if true. Has higher priority than configuration in application.yaml.\n+- `gdpr.purposes.[p1-p10].enforce-purpose` - define type of enforcement confirmation: `no`/`basic`/`full`. Default `full`\n+- `gdpr.purposes.[p1-p10].enforce-vendors` - if equals to `true`, user must give consent to use vendors. Purposes will be omitted. Default `true`\n+- `gdpr.purposes.[p1-p10].vendor-exceptions[]` - bidder names that will be treated opposite to `pN.enforce-vendors` value.\n+- `gdpr.special-features.[f1-f2].enforce`- if equals to `true`, special feature will be enforced for purpose. Default `true`\n+- `gdpr.special-features.[f1-f2].vendor-exceptions` - bidder names that will be treated opposite to `sfN.enforce` value.\n+- `gdpr.purpose-one-treatment-interpretation` - option that allows to skip the Purpose one enforcement workflow. Values: ignore, no-access-allowed, access-allowed.\n+- `analytics-sampling-factor` - Analytics sampling factor value. \n+- `truncate-target-attr` - Maximum targeting attributes size. Values between 1 and 255.\n+\n+```\n+Purpose| Purpose goal                            |  Purpose meaning for PBS (n\\a - not affected)  \n+p1        | Access device                          | Stops usersync for given vendor and stops settings cookie on `/seuid`\n+p2        | Select basic ads                       | Verify consent for each vendor as appropriate for the enforcement method before calling a bid adapter. If consent is not granted, log a metric and skip it.\n+p3        | Personalized ads profile            | n\\a\n+p4        | Select personalized ads            | Verify consent for each vendor that passed the Purpose 2. If consent is not granted, remove the bidrequest.userId, user.ext.eids, user.ext.digitrust, device.if attributes and call the adapter.\n+p5        | Personalized content profile      | n\\a\n+p6        | Select personalized content      | n\\a\n+p7        | Measure ad performance          | Verify consent for each analytics module. If consent is not grantet skip it.\n+p8        | Measure content performance  | n\\a\n+p9        | Generate audience insights      | n\\a\n+p10      | Develop/improve products        | n\\a\n+\n+f1         | Precise geo                               | Verifies user opt-in. If the user has opted out, rounds off the IP address and lat/long details \n+f2         | Fingerprinting                          | n\\a\n+```\n+## File based\n+\n+In file based approach all configuration stores in .yaml files, path to which are defined in application properties.\n+\n+### Configuration in application.yaml\n+\n+```\n+settings:\n+  filesystem:\n+    settings-filename: <directory to yaml file with settings>\n+```\n+### File format\n+\n+```\n+accounts:\n+  - id: 14062\n+    bannerCacheTtl: 100\n+    videoCacheTtl: 100\n+    eventsEnabled: true\n+    priceGranularity: low\n+    enforceCcpa: true\n+    analyticsSamplingFactor: 1\n+    truncateTargetAttr: 40\n+    gdpr:\n+      enabled: true\n+      purposes:\n+        p1:\n+          enforce-purpose: full\n+          enforce-vendors: true\n+          vendor-exceptions:\n+            - bidder1\n+            - bidder2\n+        p2:\n+          enforce-purpose: full\n+          enforce-vendors: true\n+          vendor-exceptions:\n+            - bidder1\n+            - bidder2\n+        p3:\n+          enforce-purpose: full\n+          enforce-vendors: true\n+          vendor-exceptions:\n+            - bidder1\n+            - bidder2\n+        p4:\n+          enforce-purpose: full\n+          enforce-vendors: true\n+          vendor-exceptions:\n+            - bidder1\n+            - bidder2\n+        p5:\n+          enforce-purpose: full\n+          enforce-vendors: true\n+          vendor-exceptions:\n+            - bidder1\n+            - bidder2\n+        p6:\n+          enforce-purpose: full\n+          enforce-vendors: true\n+          vendor-exceptions:\n+            - bidder1\n+            - bidder2\n+        p7:\n+          enforce-purpose: full\n+          enforce-vendors: true\n+          vendor-exceptions:\n+            - bidder1\n+            - bidder2\n+        p8:\n+          enforce-purpose: full\n+          enforce-vendors: true\n+          vendor-exceptions:\n+            - bidder1\n+            - bidder2\n+        p9:\n+          enforce-purpose: full\n+          enforce-vendors: true\n+          vendor-exceptions:\n+            - bidder1\n+            - bidder2\n+        p10:\n+          enforce-purpose: full\n+          enforce-vendors: true\n+          vendor-exceptions:\n+            - bidder1\n+            - bidder2\n+      special-features:\n+        sf1:\n+          enforce: true\n+          vendor-exceptions:\n+            - bidder1\n+            - bidder2\n+        sf2:\n+          enforce: true\n+          vendor-exceptions:\n+            - bidder1\n+            - bidder2\n+      purpose-one-treatment-interpretation: ignore\n+```\n+\n+  \n+## Database application setting\n+\n+In database approach account properties are stored in database table with name accounts_account.\n+\n+### Configuration in application.yaml\n+```\n+settings:\n+  enforce-valid-account: true", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ea59038023dc90a98d2e459e1d3ff5ef0bd72259"}, "originalPosition": 145}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "cf1b3e5b618d241863e82f404b23d224af23d79e", "author": {"user": {"login": "BraslavskiyAndrey", "name": "Braslavskyi Andrii"}}, "url": "https://github.com/prebid/prebid-server-java/commit/cf1b3e5b618d241863e82f404b23d224af23d79e", "committedDate": "2020-06-24T13:35:19Z", "message": "Update documentation for enabling jdbc application settings"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "8a8668b555497bdef0967a04198d33c3fcae23d9", "author": {"user": {"login": "BraslavskiyAndrey", "name": "Braslavskyi Andrii"}}, "url": "https://github.com/prebid/prebid-server-java/commit/8a8668b555497bdef0967a04198d33c3fcae23d9", "committedDate": "2020-06-24T14:52:49Z", "message": "Revert changes"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDM2NzI4NjA5", "url": "https://github.com/prebid/prebid-server-java/pull/768#pullrequestreview-436728609", "createdAt": "2020-06-24T14:54:09Z", "commit": {"oid": "8a8668b555497bdef0967a04198d33c3fcae23d9"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3218, "cost": 1, "resetAt": "2021-11-01T16:37:27Z"}}}