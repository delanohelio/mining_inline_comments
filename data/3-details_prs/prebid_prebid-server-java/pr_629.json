{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0Mzc4MjEwMjUw", "number": 629, "title": "Add TimeoutBidder interface", "bodyText": "FacebookBidder migrate from Bidder to TimeoutBidder", "createdAt": "2020-02-21T10:26:14Z", "url": "https://github.com/prebid/prebid-server-java/pull/629", "merged": true, "mergeCommit": {"oid": "c2c5356b28dc94edaf7bdb4be180833f12a7cada"}, "closed": true, "closedAt": "2020-06-04T07:45:28Z", "author": {"login": "apaliy"}, "timelineItems": {"totalCount": 13, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcGLqEYAH2gAyMzc4MjEwMjUwOjMzNTkxOTBlMTYwODgyMzBhOGIwZTc3YmQ3Yjk2OTVkNGFjMDBiODY=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcn5InuAFqTQyNDE4MjAwNg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "3359190e16088230a8b0e77bd7b9695d4ac00b86", "author": {"user": {"login": "apaliy", "name": "Andrew Paliy"}}, "url": "https://github.com/prebid/prebid-server-java/commit/3359190e16088230a8b0e77bd7b9695d4ac00b86", "committedDate": "2020-02-20T14:04:32Z", "message": "TimeoutBidder interface added.\nFacebookBidder migrate from Bidder to TimeoutBidder"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzY0MTk5MzM4", "url": "https://github.com/prebid/prebid-server-java/pull/629#pullrequestreview-364199338", "createdAt": "2020-02-25T14:49:36Z", "commit": {"oid": "3359190e16088230a8b0e77bd7b9695d4ac00b86"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yNVQxNDo0OTozNlrOFuI9Hg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yNVQxNDo1MDo1NFrOFuJAcQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MzkyNTUzNA==", "bodyText": "Please extract separate method.\nAnd extract timeoutNotification.* into values.", "url": "https://github.com/prebid/prebid-server-java/pull/629#discussion_r383925534", "createdAt": "2020-02-25T14:49:36Z", "author": {"login": "DGarbar"}, "path": "src/main/java/org/prebid/server/bidder/HttpBidderRequester.java", "diffHunk": "@@ -128,6 +130,17 @@ public HttpBidderRequester(HttpClient httpClient,\n                         ? BidderError.Type.timeout\n                         : BidderError.Type.generic;\n \n+        if (errorType == BidderError.Type.timeout) {\n+            if (bidder instanceof TimeoutBidder) {\n+                final TimeoutBidder<T> timeoutBidder = (TimeoutBidder<T>) bidder;\n+                final HttpRequest<Void> timeoutNotification = timeoutBidder.makeTimeoutNotification(httpRequest);\n+                if (timeoutNotification != null) {\n+                    httpClient.request(timeoutNotification.getMethod(), timeoutNotification.getUri(),\n+                            timeoutNotification.getHeaders(), timeoutNotification.getBody(), NOTIFICATION_TIMEOUT_MS);\n+                }\n+            }\n+        }", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "3359190e16088230a8b0e77bd7b9695d4ac00b86"}, "originalPosition": 58}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MzkyNTg2Mg==", "bodyText": "in Go they have 200*time.Millisecond", "url": "https://github.com/prebid/prebid-server-java/pull/629#discussion_r383925862", "createdAt": "2020-02-25T14:50:06Z", "author": {"login": "DGarbar"}, "path": "src/main/java/org/prebid/server/bidder/HttpBidderRequester.java", "diffHunk": "@@ -43,6 +43,7 @@\n public class HttpBidderRequester {\n \n     private static final Logger logger = LoggerFactory.getLogger(HttpBidderRequester.class);\n+    private static final int NOTIFICATION_TIMEOUT_MS = 5_000;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "3359190e16088230a8b0e77bd7b9695d4ac00b86"}, "originalPosition": 4}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MzkyNjM4NQ==", "bodyText": "Add javaDoc please.", "url": "https://github.com/prebid/prebid-server-java/pull/629#discussion_r383926385", "createdAt": "2020-02-25T14:50:54Z", "author": {"login": "DGarbar"}, "path": "src/main/java/org/prebid/server/bidder/TimeoutBidder.java", "diffHunk": "@@ -0,0 +1,9 @@\n+package org.prebid.server.bidder;\n+\n+import org.prebid.server.bidder.model.HttpRequest;\n+\n+public interface TimeoutBidder<T> extends Bidder<T> {\n+", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "3359190e16088230a8b0e77bd7b9695d4ac00b86"}, "originalPosition": 6}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzY0MjAyMTE1", "url": "https://github.com/prebid/prebid-server-java/pull/629#pullrequestreview-364202115", "createdAt": "2020-02-25T14:52:50Z", "commit": {"oid": "3359190e16088230a8b0e77bd7b9695d4ac00b86"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yNVQxNDo1Mjo1MFrOFuJFhg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yNVQxNDo1Mjo1MFrOFuJFhg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MzkyNzY4Ng==", "bodyText": "Add tests for timeoutException please.", "url": "https://github.com/prebid/prebid-server-java/pull/629#discussion_r383927686", "createdAt": "2020-02-25T14:52:50Z", "author": {"login": "DGarbar"}, "path": "src/main/java/org/prebid/server/bidder/HttpBidderRequester.java", "diffHunk": "@@ -103,22 +104,23 @@ public HttpBidderRequester(HttpClient httpClient,\n     /**\n      * Makes an HTTP request and returns {@link Future} that will be eventually completed with success or error result.\n      */\n-    private <T> Future<HttpCall<T>> doRequest(HttpRequest<T> httpRequest, Timeout timeout) {\n+    private <T> Future<HttpCall<T>> doRequest(HttpRequest<T> httpRequest, Timeout timeout, Bidder<T> bidder) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "3359190e16088230a8b0e77bd7b9695d4ac00b86"}, "originalPosition": 22}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d9aae091134958fbd8c94705bd37d7c126e611aa", "author": {"user": {"login": "apaliy", "name": "Andrew Paliy"}}, "url": "https://github.com/prebid/prebid-server-java/commit/d9aae091134958fbd8c94705bd37d7c126e611aa", "committedDate": "2020-02-27T10:20:42Z", "message": "TimeoutBidder interface added.\nFacebookBidder migrate from Bidder to TimeoutBidder"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzY1NzQ4Mjc0", "url": "https://github.com/prebid/prebid-server-java/pull/629#pullrequestreview-365748274", "createdAt": "2020-02-27T15:17:32Z", "commit": {"oid": "d9aae091134958fbd8c94705bd37d7c126e611aa"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yN1QxNToxNzozM1rOFvVaVA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yN1QxNToxNzozM1rOFvVaVA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NTE3ODE5Ng==", "bodyText": "please add   if (bidder instanceof TimeoutBidder) { to this method, or perform\n  final TimeoutBidder<T> timeoutBidder = (TimeoutBidder<T>) bidder; near instanceOf and change method parameter from Bidder to TimeoutBidder.", "url": "https://github.com/prebid/prebid-server-java/pull/629#discussion_r385178196", "createdAt": "2020-02-27T15:17:33Z", "author": {"login": "DGarbar"}, "path": "src/main/java/org/prebid/server/bidder/HttpBidderRequester.java", "diffHunk": "@@ -132,19 +134,30 @@ public HttpBidderRequester(HttpClient httpClient,\n \n         if (errorType == BidderError.Type.timeout) {\n             if (bidder instanceof TimeoutBidder) {\n-                final TimeoutBidder<T> timeoutBidder = (TimeoutBidder<T>) bidder;\n-                final HttpRequest<Void> timeoutNotification = timeoutBidder.makeTimeoutNotification(httpRequest);\n-                if (timeoutNotification != null) {\n-                    httpClient.request(timeoutNotification.getMethod(), timeoutNotification.getUri(),\n-                            timeoutNotification.getHeaders(), timeoutNotification.getBody(), NOTIFICATION_TIMEOUT_MS);\n-                }\n+                doTimeoutNotificationRequest(httpRequest, bidder);\n             }\n         }\n \n         return Future.succeededFuture(\n                 HttpCall.failure(httpRequest, BidderError.create(exception.getMessage(), errorType)));\n     }\n \n+    /**\n+     *  doTimeoutNotificationRequest shoots on {@link TimeoutException} or {@link ConnectTimeoutException},\n+     *  if Bidder supports Timeout notifications\n+     */\n+    private <T> void doTimeoutNotificationRequest(HttpRequest<T> httpRequest, Bidder<T> bidder) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d9aae091134958fbd8c94705bd37d7c126e611aa"}, "originalPosition": 40}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "59422876de13820f70dd06d6d7651c76706a0a46", "author": {"user": {"login": "apaliy", "name": "Andrew Paliy"}}, "url": "https://github.com/prebid/prebid-server-java/commit/59422876de13820f70dd06d6d7651c76706a0a46", "committedDate": "2020-02-27T15:48:52Z", "message": "Added extra validation"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "3cb6eebf2abc66089c4ee0cd0ac699e6a1ea8fd9", "author": {"user": {"login": "apaliy", "name": "Andrew Paliy"}}, "url": "https://github.com/prebid/prebid-server-java/commit/3cb6eebf2abc66089c4ee0cd0ac699e6a1ea8fd9", "committedDate": "2020-02-27T15:53:25Z", "message": "cs fix"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzY2NDQwMjIz", "url": "https://github.com/prebid/prebid-server-java/pull/629#pullrequestreview-366440223", "createdAt": "2020-02-28T14:35:16Z", "commit": {"oid": "3cb6eebf2abc66089c4ee0cd0ac699e6a1ea8fd9"}, "state": "DISMISSED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "0cb2e6f5d0def11e6c910290b2b3af625b04eb18", "author": {"user": {"login": "rpanchyk", "name": null}}, "url": "https://github.com/prebid/prebid-server-java/commit/0cb2e6f5d0def11e6c910290b2b3af625b04eb18", "committedDate": "2020-05-13T12:50:19Z", "message": "Merge branch 'master' into timeout-notification"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDEwODkxNjU0", "url": "https://github.com/prebid/prebid-server-java/pull/629#pullrequestreview-410891654", "createdAt": "2020-05-13T12:53:07Z", "commit": {"oid": "0cb2e6f5d0def11e6c910290b2b3af625b04eb18"}, "state": "DISMISSED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "6a9de396f7ea2c4e245eeba2ef9d8d4b4bf21dae", "author": {"user": {"login": "rpanchyk", "name": null}}, "url": "https://github.com/prebid/prebid-server-java/commit/6a9de396f7ea2c4e245eeba2ef9d8d4b4bf21dae", "committedDate": "2020-06-04T07:35:29Z", "message": "Fixes after review"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "43ab5d762a8772c91fc7f38d9672c18e035d0338", "author": {"user": {"login": "rpanchyk", "name": null}}, "url": "https://github.com/prebid/prebid-server-java/commit/43ab5d762a8772c91fc7f38d9672c18e035d0338", "committedDate": "2020-06-04T07:38:20Z", "message": "Fixes after review"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDI0MTgyMDA2", "url": "https://github.com/prebid/prebid-server-java/pull/629#pullrequestreview-424182006", "createdAt": "2020-06-04T07:43:08Z", "commit": {"oid": "43ab5d762a8772c91fc7f38d9672c18e035d0338"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3290, "cost": 1, "resetAt": "2021-11-01T16:37:27Z"}}}