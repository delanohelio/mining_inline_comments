{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDQzMTI2ODE4", "number": 781, "title": "Brightroll adapter - Adding bid floor config parameter", "bodyText": "Description:\nAdding bid floor as a configuration for publishers to config. This will be populated on request.imp.bidfloor  in the bid request. Business Insider currently not sending bid floor in their open RTB bid requests and want us to add their default global floor price (0.30 cents). So configuring that bid floor value for BusinessInsider.\nReviewers:\n@bretg\n@rpanchyk", "createdAt": "2020-07-02T00:55:10Z", "url": "https://github.com/prebid/prebid-server-java/pull/781", "merged": true, "mergeCommit": {"oid": "13b37568baa92ac5bb2da682e4ad25403b84456a"}, "closed": true, "closedAt": "2020-07-17T13:16:45Z", "author": {"login": "smithaammassamveettil"}, "timelineItems": {"totalCount": 7, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcwdkrCgH2gAyNDQzMTI2ODE4OmJlMjE0YTE3ZmZjYWZjMTQxNmE5MzJmMjYxNGIwMmNhOGFkYzM0OTE=", "endCursor": "Y3Vyc29yOnYyOpPPAAABc1w9iyAFqTQ1MDUzNjA2Mg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "be214a17ffcafc1416a932f2614b02ca8adc3491", "author": {"user": {"login": "smithaammassamveettil", "name": null}}, "url": "https://github.com/prebid/prebid-server-java/commit/be214a17ffcafc1416a932f2614b02ca8adc3491", "committedDate": "2020-06-30T22:41:45Z", "message": " Adding global bid floor field as config"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "2ea1d582d79cecc7d2798a17652d196854f15d33", "author": {"user": {"login": "smithaammassamveettil", "name": null}}, "url": "https://github.com/prebid/prebid-server-java/commit/2ea1d582d79cecc7d2798a17652d196854f15d33", "committedDate": "2020-07-02T00:45:47Z", "message": "added bid floor config"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDQyMTc3Mjk3", "url": "https://github.com/prebid/prebid-server-java/pull/781#pullrequestreview-442177297", "createdAt": "2020-07-03T06:36:47Z", "commit": {"oid": "2ea1d582d79cecc7d2798a17652d196854f15d33"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wM1QwNjozNjo0N1rOGslS9w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wM1QwNjozNjo0N1rOGslS9w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0OTQwMTU5MQ==", "bodyText": "Not critical, but is it possible we don't need to update the imp?\nIn this case toBuilder() -> build() operations is redundant.", "url": "https://github.com/prebid/prebid-server-java/pull/781#discussion_r449401591", "createdAt": "2020-07-03T06:36:47Z", "author": {"login": "rpanchyk"}, "path": "src/main/java/org/prebid/server/bidder/brightroll/BrightrollBidder.java", "diffHunk": "@@ -170,6 +170,12 @@ private static boolean isImpValid(Imp imp, List<BidderError> errors) {\n      * Updates {@link Imp} {@link Banner} and/or {@link Video}.\n      */\n     private Imp updateImp(Imp imp, PublisherOverride publisherOverride) {\n+        final Imp.ImpBuilder impBuilder = imp.toBuilder();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "2ea1d582d79cecc7d2798a17652d196854f15d33"}, "originalPosition": 4}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "199d006cf4416f0c004bd421f7399dd546752b08", "author": {"user": {"login": "smithaammassamveettil", "name": null}}, "url": "https://github.com/prebid/prebid-server-java/commit/199d006cf4416f0c004bd421f7399dd546752b08", "committedDate": "2020-07-14T23:55:18Z", "message": "addressed review comments"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDQ4ODI5OTM5", "url": "https://github.com/prebid/prebid-server-java/pull/781#pullrequestreview-448829939", "createdAt": "2020-07-15T10:33:25Z", "commit": {"oid": "199d006cf4416f0c004bd421f7399dd546752b08"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xNVQxMDozMzoyNVrOGx4NfA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xNVQxMDozMzoyNVrOGx4NfA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NDk1NDM2NA==", "bodyText": "Just to confirm. Do you expect here both bidFloor and impBattr should not be null for video?\nIf so, below checking for null is not required.", "url": "https://github.com/prebid/prebid-server-java/pull/781#discussion_r454954364", "createdAt": "2020-07-15T10:33:25Z", "author": {"login": "rpanchyk"}, "path": "src/main/java/org/prebid/server/bidder/brightroll/BrightrollBidder.java", "diffHunk": "@@ -170,34 +171,66 @@ private static boolean isImpValid(Imp imp, List<BidderError> errors) {\n      * Updates {@link Imp} {@link Banner} and/or {@link Video}.\n      */\n     private Imp updateImp(Imp imp, PublisherOverride publisherOverride) {\n+        final BigDecimal bidFloor = publisherOverride != null && publisherOverride.getBidFloor() != null\n+                ? publisherOverride.getBidFloor()\n+                : null;\n+        final List<Integer> impBattr = publisherOverride != null && publisherOverride.getImpBattr() != null\n+                ? publisherOverride.getImpBattr()\n+                : null;\n+\n         final Banner banner = imp.getBanner();\n         if (banner != null) {\n-            final Banner.BannerBuilder bannerBuilder = banner.toBuilder();\n-            if (banner.getW() == null && banner.getH() == null && CollectionUtils.isNotEmpty(banner.getFormat())) {\n-                // update banner with size from first format\n-                final Format firstFormat = banner.getFormat().get(0);\n-                bannerBuilder\n-                        .w(firstFormat.getW())\n-                        .h(firstFormat.getH());\n-            }\n-            if (publisherOverride != null) {\n-                bannerBuilder.battr(publisherOverride.getImpBattr());\n+            final boolean noSizes = banner.getW() == null && banner.getH() == null\n+                    && CollectionUtils.isNotEmpty(banner.getFormat());\n+\n+            if (bidFloor != null || impBattr != null || noSizes) {\n+                final Imp.ImpBuilder impBuilder = imp.toBuilder();\n+\n+                if (bidFloor != null) {\n+                    impBuilder.bidfloor(bidFloor);\n+                }\n+                if (impBattr != null || noSizes) {\n+                    impBuilder.banner(updateBanner(banner, impBattr, noSizes));\n+                }\n+\n+                return impBuilder.build();\n             }\n-            return imp.toBuilder()\n-                    .banner(bannerBuilder.build())\n-                    .build();\n         }\n+\n         final Video video = imp.getVideo();\n-        if (video != null && publisherOverride != null) {\n-            return imp.toBuilder()\n-                    .video(video.toBuilder()\n-                            .battr(publisherOverride.getImpBattr())\n-                            .build())\n-                    .build();\n+        if (video != null && (bidFloor != null && impBattr != null)) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "199d006cf4416f0c004bd421f7399dd546752b08"}, "originalPosition": 58}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "8d37aa39ec561e46514a1bfa7ebabe0628872632", "author": {"user": {"login": "smithaammassamveettil", "name": null}}, "url": "https://github.com/prebid/prebid-server-java/commit/8d37aa39ec561e46514a1bfa7ebabe0628872632", "committedDate": "2020-07-16T18:46:12Z", "message": "fixed condition check"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDUwNTM2MDYy", "url": "https://github.com/prebid/prebid-server-java/pull/781#pullrequestreview-450536062", "createdAt": "2020-07-17T10:06:44Z", "commit": {"oid": "8d37aa39ec561e46514a1bfa7ebabe0628872632"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3243, "cost": 1, "resetAt": "2021-11-01T16:37:27Z"}}}