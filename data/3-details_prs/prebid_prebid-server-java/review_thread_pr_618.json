{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0Mzc0Nzg0MzU5", "number": 618, "reviewThreads": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xN1QwOTo0MToyMFrODgUvgg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xN1QxMDowMzozNlrODgVPVA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjM1MjIwODY2OnYy", "diffSide": "RIGHT", "path": "src/main/java/org/prebid/server/spring/config/AdminEndpointsConfiguration.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xN1QwOTo0MToyMFrOFqd5bA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xN1QwOTo0MToyMFrOFqd5bA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MDA3NDM0OA==", "bodyText": "I would avoid polluting context with such generic bean as Map<String, String>. It's much more reliable and straightforward to inject AdminEndpointCredentials in ampCacheNotificationEndpoint factory method and just use getter getCredentials() right there.", "url": "https://github.com/prebid/prebid-server-java/pull/618#discussion_r380074348", "createdAt": "2020-02-17T09:41:20Z", "author": {"login": "schernysh"}, "path": "src/main/java/org/prebid/server/spring/config/AdminEndpointsConfiguration.java", "diffHunk": "@@ -0,0 +1,106 @@\n+package org.prebid.server.spring.config;\n+\n+import lombok.Data;\n+import lombok.NoArgsConstructor;\n+import org.prebid.server.currency.CurrencyConversionService;\n+import org.prebid.server.execution.LogModifier;\n+import org.prebid.server.handler.AdminHandler;\n+import org.prebid.server.handler.CurrencyRatesHandler;\n+import org.prebid.server.handler.CustomizedAdminEndpoint;\n+import org.prebid.server.handler.SettingsCacheNotificationHandler;\n+import org.prebid.server.json.JacksonMapper;\n+import org.prebid.server.settings.SettingsCache;\n+import org.springframework.beans.factory.annotation.Autowired;\n+import org.springframework.beans.factory.annotation.Value;\n+import org.springframework.boot.autoconfigure.condition.ConditionalOnProperty;\n+import org.springframework.boot.context.properties.ConfigurationProperties;\n+import org.springframework.context.annotation.Bean;\n+import org.springframework.context.annotation.Configuration;\n+import org.springframework.stereotype.Component;\n+\n+import java.util.Collections;\n+import java.util.Map;\n+\n+@Configuration\n+public class AdminEndpointsConfiguration {\n+\n+    private static final String LOGGER_LEVEL_ENDPOINT = \"/pbs-admin/admin\";\n+    private static final String CURRENCY_RATES_ENDPOINT = \"/pbs-admin/currency-rates\";\n+    private static final String STOREDREQUESTS_OPENRTB_ENDPOINT = \"/pbs-admin/storedrequests/openrtb2\";\n+    private static final String STOREDREQUESTS_AMP_ENDPOINT = \"/pbs-admin/storedrequests/amp\";\n+\n+    @Bean\n+    @ConditionalOnProperty(prefix = \"logger-level-modifier\", name = \"enabled\", havingValue = \"true\")\n+    CustomizedAdminEndpoint loggerLevelModifierEndpoint(\n+            LogModifier logModifier,\n+            @Autowired(required = false) Map<String, String> adminEndpointCredentials,\n+            @Value(\"${admin-endpoints.logger-level-modifier.on-application-port}\") boolean isOnApplicationPort,\n+            @Value(\"${admin-endpoints.logger-level-modifier.protected}\") boolean isProtected) {\n+        final AdminHandler adminHandler = new AdminHandler(logModifier);\n+        return new CustomizedAdminEndpoint(LOGGER_LEVEL_ENDPOINT, adminHandler, isOnApplicationPort,\n+                isProtected)\n+                .credentials(adminEndpointCredentials);\n+    }\n+\n+    @Bean\n+    @ConditionalOnProperty(prefix = \"currency-converter.external-rates\", name = \"enabled\", havingValue = \"true\")\n+    CustomizedAdminEndpoint currencyConversionRatesEndpoint(\n+            CurrencyConversionService currencyConversionRates,\n+            JacksonMapper mapper,\n+            @Autowired(required = false) Map<String, String> adminEndpointCredentials,\n+            @Value(\"${admin-endpoints.currency-rates.on-application-port}\") boolean isOnApplicationPort,\n+            @Value(\"${admin-endpoints.currency-rates.protected}\") boolean isProtected) {\n+        final CurrencyRatesHandler currencyRatesHandler = new CurrencyRatesHandler(currencyConversionRates, mapper);\n+        return new CustomizedAdminEndpoint(CURRENCY_RATES_ENDPOINT, currencyRatesHandler, isOnApplicationPort,\n+                isProtected)\n+                .credentials(adminEndpointCredentials);\n+    }\n+\n+    @Bean\n+    @ConditionalOnProperty(prefix = \"settings.in-memory-cache\", name = \"notification-endpoints-enabled\",\n+            havingValue = \"true\")\n+    CustomizedAdminEndpoint cacheNotificationEndpoint(\n+            SettingsCache settingsCache,\n+            JacksonMapper mapper,\n+            @Autowired(required = false) Map<String, String> adminEndpointCredentials,\n+            @Value(\"${admin-endpoints.storedrequest.on-application-port}\") boolean isOnApplicationPort,\n+            @Value(\"${admin-endpoints.storedrequest.protected}\") boolean isProtected) {\n+        final SettingsCacheNotificationHandler cacheNotificationHandler =\n+                new SettingsCacheNotificationHandler(settingsCache, mapper);\n+        return new CustomizedAdminEndpoint(STOREDREQUESTS_OPENRTB_ENDPOINT, cacheNotificationHandler,\n+                isOnApplicationPort, isProtected)\n+                .credentials(adminEndpointCredentials);\n+    }\n+\n+    @Bean\n+    @ConditionalOnProperty(prefix = \"settings.in-memory-cache\", name = \"notification-endpoints-enabled\",\n+            havingValue = \"true\")\n+    CustomizedAdminEndpoint ampCacheNotificationEndpoint(\n+            SettingsCache ampSettingsCache,\n+            JacksonMapper mapper,\n+            @Autowired(required = false) Map<String, String> adminEndpointCredentials,\n+            @Value(\"${admin-endpoints.storedrequest-amp.on-application-port}\") boolean isOnApplicationPort,\n+            @Value(\"${admin-endpoints.storedrequest-amp.protected}\") boolean isProtected) {\n+        final SettingsCacheNotificationHandler settingsCacheNotificationHandler =\n+                new SettingsCacheNotificationHandler(ampSettingsCache, mapper);\n+        return new CustomizedAdminEndpoint(STOREDREQUESTS_AMP_ENDPOINT, settingsCacheNotificationHandler,\n+                isOnApplicationPort, isProtected)\n+                .credentials(adminEndpointCredentials);\n+    }\n+\n+    @Bean\n+    Map<String, String> adminEndpointCredentials(", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "14041e797943cbd94df6fdfa7447280b80fb57bf"}, "originalPosition": 92}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjM1MjIyMjY2OnYy", "diffSide": "RIGHT", "path": "src/main/java/org/prebid/server/handler/CustomizedAdminEndpoint.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xN1QwOTo0NTowNFrOFqeBzQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xN1QwOTo0NTowNFrOFqeBzQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MDA3NjQ5Mw==", "bodyText": "Having this method makes this class a bit of a puzzle as it looks more like a part of the builder approach whilst it is not the case. As a corresponding alternative to what this method is supposed to do you can create another constructor overload that accepts credentials in addition to other properties.", "url": "https://github.com/prebid/prebid-server-java/pull/618#discussion_r380076493", "createdAt": "2020-02-17T09:45:04Z", "author": {"login": "schernysh"}, "path": "src/main/java/org/prebid/server/handler/CustomizedAdminEndpoint.java", "diffHunk": "@@ -0,0 +1,76 @@\n+package org.prebid.server.handler;\n+\n+import io.vertx.core.Future;\n+import io.vertx.core.Handler;\n+import io.vertx.ext.auth.AuthProvider;\n+import io.vertx.ext.web.Router;\n+import io.vertx.ext.web.RoutingContext;\n+import io.vertx.ext.web.handler.BasicAuthHandler;\n+import org.apache.commons.collections4.MapUtils;\n+import org.apache.commons.lang3.StringUtils;\n+\n+import java.util.Map;\n+import java.util.Objects;\n+\n+public class CustomizedAdminEndpoint {\n+\n+    private final Handler<RoutingContext> handler;\n+    private final boolean isOnApplicationPort;\n+    private final boolean isProtected;\n+    private final String path;\n+    private Map<String, String> adminEndpointCredentials;\n+\n+    public CustomizedAdminEndpoint(String path, Handler<RoutingContext> handler, boolean isOnApplicationPort,\n+                                   boolean isProtected) {\n+        this.path = path;\n+        this.handler = handler;\n+        this.isOnApplicationPort = isOnApplicationPort;\n+        this.isProtected = isProtected;\n+    }\n+\n+    public CustomizedAdminEndpoint credentials(Map<String, String> adminEndpointCredentials) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "14041e797943cbd94df6fdfa7447280b80fb57bf"}, "originalPosition": 31}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjM1MjI5MDEyOnYy", "diffSide": "RIGHT", "path": "src/main/java/org/prebid/server/spring/config/WebConfiguration.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xN1QxMDowMzozNlrOFqerFw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xN1QxMDowMzozNlrOFqerFw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MDA4NzA2Mw==", "bodyText": "Since qualifier is used here I would suggest making router bean name explicit in place of its declaration (@Bean Router router(...) method)", "url": "https://github.com/prebid/prebid-server-java/pull/618#discussion_r380087063", "createdAt": "2020-02-17T10:03:36Z", "author": {"login": "schernysh"}, "path": "src/main/java/org/prebid/server/spring/config/WebConfiguration.java", "diffHunk": "@@ -99,6 +94,7 @@\n     private ExceptionHandler exceptionHandler;\n \n     @Autowired\n+    @Qualifier(\"router\")", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "14041e797943cbd94df6fdfa7447280b80fb57bf"}, "originalPosition": 44}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4140, "cost": 1, "resetAt": "2021-11-13T12:26:42Z"}}}