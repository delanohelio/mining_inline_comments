{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDExNTY4NTI4", "number": 700, "title": "Add Nanointeractive Bidder and tests", "bodyText": "Add Nanointeractive Bidder implementation and tests to keep up with Go version.", "createdAt": "2020-04-30T14:32:28Z", "url": "https://github.com/prebid/prebid-server-java/pull/700", "merged": true, "mergeCommit": {"oid": "1a1b7140ec0f15fa89fdcaf4210a3ef9cb25964e"}, "closed": true, "closedAt": "2020-06-24T15:58:14Z", "author": {"login": "AndriyPavlyuk"}, "timelineItems": {"totalCount": 8, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcct-_3AH2gAyNDExNTY4NTI4OmU2YmVhOWVmODNkMjIzYTEyZTg3MjE2YjIyZGEwMTBiM2U1MTBmMTk=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcucLIfAFqTQzNjc4NjMzNw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "e6bea9ef83d223a12e87216b22da010b3e510f19", "author": {"user": {"login": "AndriyPavlyuk", "name": null}}, "url": "https://github.com/prebid/prebid-server-java/commit/e6bea9ef83d223a12e87216b22da010b3e510f19", "committedDate": "2020-04-30T14:30:30Z", "message": "Add Nanointeractive Bidder and tests"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDA1NzQ5MzU3", "url": "https://github.com/prebid/prebid-server-java/pull/700#pullrequestreview-405749357", "createdAt": "2020-05-05T12:43:34Z", "commit": {"oid": "e6bea9ef83d223a12e87216b22da010b3e510f19"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 8, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wNVQxMjo0MzozNFrOGQnkqg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wNVQxMjo1NjozNFrOGQoD4A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMDA3ODc2Mg==", "bodyText": "You will use last not empty extImp.getRef(). But in GO they will use first one.", "url": "https://github.com/prebid/prebid-server-java/pull/700#discussion_r420078762", "createdAt": "2020-05-05T12:43:34Z", "author": {"login": "DGarbar"}, "path": "src/main/java/org/prebid/server/bidder/nanointeractive/NanointeractiveBidder.java", "diffHunk": "@@ -0,0 +1,162 @@\n+package org.prebid.server.bidder.nanointeractive;\n+\n+import com.fasterxml.jackson.core.type.TypeReference;\n+import com.fasterxml.jackson.databind.node.ObjectNode;\n+import com.iab.openrtb.request.BidRequest;\n+import com.iab.openrtb.request.Device;\n+import com.iab.openrtb.request.Imp;\n+import com.iab.openrtb.request.Site;\n+import com.iab.openrtb.response.BidResponse;\n+import com.iab.openrtb.response.SeatBid;\n+import io.vertx.core.MultiMap;\n+import io.vertx.core.http.HttpMethod;\n+import org.apache.commons.lang3.StringUtils;\n+import org.prebid.server.bidder.Bidder;\n+import org.prebid.server.bidder.model.BidderBid;\n+import org.prebid.server.bidder.model.BidderError;\n+import org.prebid.server.bidder.model.HttpCall;\n+import org.prebid.server.bidder.model.HttpRequest;\n+import org.prebid.server.bidder.model.Result;\n+import org.prebid.server.exception.PreBidException;\n+import org.prebid.server.json.DecodeException;\n+import org.prebid.server.json.JacksonMapper;\n+import org.prebid.server.proto.openrtb.ext.ExtPrebid;\n+import org.prebid.server.proto.openrtb.ext.request.nanointeractive.ExtImpNanointeractive;\n+import org.prebid.server.proto.openrtb.ext.response.BidType;\n+import org.prebid.server.util.HttpUtil;\n+\n+import java.util.ArrayList;\n+import java.util.Collection;\n+import java.util.Collections;\n+import java.util.List;\n+import java.util.Map;\n+import java.util.Objects;\n+import java.util.stream.Collectors;\n+\n+public class NanointeractiveBidder implements Bidder<BidRequest> {\n+\n+    private static final TypeReference<ExtPrebid<?, ExtImpNanointeractive>> NANOINTERACTIVE_EXT_TYPE_REFERENCE =\n+            new TypeReference<ExtPrebid<?, ExtImpNanointeractive>>() {\n+            };\n+    private static final String DEFAULT_BID_CURRENCY = \"USD\";\n+    private final String endpointUrl;\n+    private final JacksonMapper mapper;\n+\n+    public NanointeractiveBidder(String endpointUrl, JacksonMapper mapper) {\n+        this.endpointUrl = HttpUtil.validateUrl(Objects.requireNonNull(endpointUrl));\n+        this.mapper = Objects.requireNonNull(mapper);\n+    }\n+\n+    @Override\n+    public Result<List<HttpRequest<BidRequest>>> makeHttpRequests(BidRequest request) {\n+        final List<BidderError> errors = new ArrayList<>();\n+        final List<Imp> validImps = new ArrayList<>();\n+        String reference = \"\";\n+        for (Imp imp : request.getImp()) {\n+            try {\n+                final Imp validImp = validateImp(imp);\n+                final ExtImpNanointeractive extImp = parseImpExt(imp);\n+                if (StringUtils.isBlank(extImp.getPid())) {\n+                    throw new PreBidException(\"pid is empty\");\n+                }\n+\n+                if (StringUtils.isNotBlank(extImp.getRef())) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e6bea9ef83d223a12e87216b22da010b3e510f19"}, "originalPosition": 63}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMDA3OTc0Mw==", "bodyText": "They set empty site if they have null, or update existing one", "url": "https://github.com/prebid/prebid-server-java/pull/700#discussion_r420079743", "createdAt": "2020-05-05T12:45:12Z", "author": {"login": "DGarbar"}, "path": "src/main/java/org/prebid/server/bidder/nanointeractive/NanointeractiveBidder.java", "diffHunk": "@@ -0,0 +1,162 @@\n+package org.prebid.server.bidder.nanointeractive;\n+\n+import com.fasterxml.jackson.core.type.TypeReference;\n+import com.fasterxml.jackson.databind.node.ObjectNode;\n+import com.iab.openrtb.request.BidRequest;\n+import com.iab.openrtb.request.Device;\n+import com.iab.openrtb.request.Imp;\n+import com.iab.openrtb.request.Site;\n+import com.iab.openrtb.response.BidResponse;\n+import com.iab.openrtb.response.SeatBid;\n+import io.vertx.core.MultiMap;\n+import io.vertx.core.http.HttpMethod;\n+import org.apache.commons.lang3.StringUtils;\n+import org.prebid.server.bidder.Bidder;\n+import org.prebid.server.bidder.model.BidderBid;\n+import org.prebid.server.bidder.model.BidderError;\n+import org.prebid.server.bidder.model.HttpCall;\n+import org.prebid.server.bidder.model.HttpRequest;\n+import org.prebid.server.bidder.model.Result;\n+import org.prebid.server.exception.PreBidException;\n+import org.prebid.server.json.DecodeException;\n+import org.prebid.server.json.JacksonMapper;\n+import org.prebid.server.proto.openrtb.ext.ExtPrebid;\n+import org.prebid.server.proto.openrtb.ext.request.nanointeractive.ExtImpNanointeractive;\n+import org.prebid.server.proto.openrtb.ext.response.BidType;\n+import org.prebid.server.util.HttpUtil;\n+\n+import java.util.ArrayList;\n+import java.util.Collection;\n+import java.util.Collections;\n+import java.util.List;\n+import java.util.Map;\n+import java.util.Objects;\n+import java.util.stream.Collectors;\n+\n+public class NanointeractiveBidder implements Bidder<BidRequest> {\n+\n+    private static final TypeReference<ExtPrebid<?, ExtImpNanointeractive>> NANOINTERACTIVE_EXT_TYPE_REFERENCE =\n+            new TypeReference<ExtPrebid<?, ExtImpNanointeractive>>() {\n+            };\n+    private static final String DEFAULT_BID_CURRENCY = \"USD\";\n+    private final String endpointUrl;\n+    private final JacksonMapper mapper;\n+\n+    public NanointeractiveBidder(String endpointUrl, JacksonMapper mapper) {\n+        this.endpointUrl = HttpUtil.validateUrl(Objects.requireNonNull(endpointUrl));\n+        this.mapper = Objects.requireNonNull(mapper);\n+    }\n+\n+    @Override\n+    public Result<List<HttpRequest<BidRequest>>> makeHttpRequests(BidRequest request) {\n+        final List<BidderError> errors = new ArrayList<>();\n+        final List<Imp> validImps = new ArrayList<>();\n+        String reference = \"\";\n+        for (Imp imp : request.getImp()) {\n+            try {\n+                final Imp validImp = validateImp(imp);\n+                final ExtImpNanointeractive extImp = parseImpExt(imp);\n+                if (StringUtils.isBlank(extImp.getPid())) {\n+                    throw new PreBidException(\"pid is empty\");\n+                }\n+\n+                if (StringUtils.isNotBlank(extImp.getRef())) {\n+                    reference = extImp.getRef();\n+                }\n+                validImps.add(validImp);\n+            } catch (PreBidException e) {\n+                errors.add(BidderError.badInput(e.getMessage()));\n+            }\n+        }\n+\n+        Site updateSite = null;\n+        if (StringUtils.isNotBlank(reference)) {\n+            if (request.getSite() != null) {\n+                updateSite = Site.builder().ref(reference).build();\n+            }", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e6bea9ef83d223a12e87216b22da010b3e510f19"}, "originalPosition": 76}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMDA4MTM4OA==", "bodyText": "Also i'd rather extract this in another method and called like\nfinal BidRequest outgoingRequest = request.toBuilder()\n.imp(validImps)\n.site(updateSite(request.site, reference))\n.build();", "url": "https://github.com/prebid/prebid-server-java/pull/700#discussion_r420081388", "createdAt": "2020-05-05T12:47:49Z", "author": {"login": "DGarbar"}, "path": "src/main/java/org/prebid/server/bidder/nanointeractive/NanointeractiveBidder.java", "diffHunk": "@@ -0,0 +1,162 @@\n+package org.prebid.server.bidder.nanointeractive;\n+\n+import com.fasterxml.jackson.core.type.TypeReference;\n+import com.fasterxml.jackson.databind.node.ObjectNode;\n+import com.iab.openrtb.request.BidRequest;\n+import com.iab.openrtb.request.Device;\n+import com.iab.openrtb.request.Imp;\n+import com.iab.openrtb.request.Site;\n+import com.iab.openrtb.response.BidResponse;\n+import com.iab.openrtb.response.SeatBid;\n+import io.vertx.core.MultiMap;\n+import io.vertx.core.http.HttpMethod;\n+import org.apache.commons.lang3.StringUtils;\n+import org.prebid.server.bidder.Bidder;\n+import org.prebid.server.bidder.model.BidderBid;\n+import org.prebid.server.bidder.model.BidderError;\n+import org.prebid.server.bidder.model.HttpCall;\n+import org.prebid.server.bidder.model.HttpRequest;\n+import org.prebid.server.bidder.model.Result;\n+import org.prebid.server.exception.PreBidException;\n+import org.prebid.server.json.DecodeException;\n+import org.prebid.server.json.JacksonMapper;\n+import org.prebid.server.proto.openrtb.ext.ExtPrebid;\n+import org.prebid.server.proto.openrtb.ext.request.nanointeractive.ExtImpNanointeractive;\n+import org.prebid.server.proto.openrtb.ext.response.BidType;\n+import org.prebid.server.util.HttpUtil;\n+\n+import java.util.ArrayList;\n+import java.util.Collection;\n+import java.util.Collections;\n+import java.util.List;\n+import java.util.Map;\n+import java.util.Objects;\n+import java.util.stream.Collectors;\n+\n+public class NanointeractiveBidder implements Bidder<BidRequest> {\n+\n+    private static final TypeReference<ExtPrebid<?, ExtImpNanointeractive>> NANOINTERACTIVE_EXT_TYPE_REFERENCE =\n+            new TypeReference<ExtPrebid<?, ExtImpNanointeractive>>() {\n+            };\n+    private static final String DEFAULT_BID_CURRENCY = \"USD\";\n+    private final String endpointUrl;\n+    private final JacksonMapper mapper;\n+\n+    public NanointeractiveBidder(String endpointUrl, JacksonMapper mapper) {\n+        this.endpointUrl = HttpUtil.validateUrl(Objects.requireNonNull(endpointUrl));\n+        this.mapper = Objects.requireNonNull(mapper);\n+    }\n+\n+    @Override\n+    public Result<List<HttpRequest<BidRequest>>> makeHttpRequests(BidRequest request) {\n+        final List<BidderError> errors = new ArrayList<>();\n+        final List<Imp> validImps = new ArrayList<>();\n+        String reference = \"\";\n+        for (Imp imp : request.getImp()) {\n+            try {\n+                final Imp validImp = validateImp(imp);\n+                final ExtImpNanointeractive extImp = parseImpExt(imp);\n+                if (StringUtils.isBlank(extImp.getPid())) {\n+                    throw new PreBidException(\"pid is empty\");\n+                }\n+\n+                if (StringUtils.isNotBlank(extImp.getRef())) {\n+                    reference = extImp.getRef();\n+                }\n+                validImps.add(validImp);\n+            } catch (PreBidException e) {\n+                errors.add(BidderError.badInput(e.getMessage()));\n+            }\n+        }\n+\n+        Site updateSite = null;\n+        if (StringUtils.isNotBlank(reference)) {\n+            if (request.getSite() != null) {\n+                updateSite = Site.builder().ref(reference).build();\n+            }\n+        }", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e6bea9ef83d223a12e87216b22da010b3e510f19"}, "originalPosition": 77}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMDA4MjI2MQ==", "bodyText": "Are you sure that user not empty and buyeruid is not null ?", "url": "https://github.com/prebid/prebid-server-java/pull/700#discussion_r420082261", "createdAt": "2020-05-05T12:49:15Z", "author": {"login": "DGarbar"}, "path": "src/main/java/org/prebid/server/bidder/nanointeractive/NanointeractiveBidder.java", "diffHunk": "@@ -0,0 +1,162 @@\n+package org.prebid.server.bidder.nanointeractive;\n+\n+import com.fasterxml.jackson.core.type.TypeReference;\n+import com.fasterxml.jackson.databind.node.ObjectNode;\n+import com.iab.openrtb.request.BidRequest;\n+import com.iab.openrtb.request.Device;\n+import com.iab.openrtb.request.Imp;\n+import com.iab.openrtb.request.Site;\n+import com.iab.openrtb.response.BidResponse;\n+import com.iab.openrtb.response.SeatBid;\n+import io.vertx.core.MultiMap;\n+import io.vertx.core.http.HttpMethod;\n+import org.apache.commons.lang3.StringUtils;\n+import org.prebid.server.bidder.Bidder;\n+import org.prebid.server.bidder.model.BidderBid;\n+import org.prebid.server.bidder.model.BidderError;\n+import org.prebid.server.bidder.model.HttpCall;\n+import org.prebid.server.bidder.model.HttpRequest;\n+import org.prebid.server.bidder.model.Result;\n+import org.prebid.server.exception.PreBidException;\n+import org.prebid.server.json.DecodeException;\n+import org.prebid.server.json.JacksonMapper;\n+import org.prebid.server.proto.openrtb.ext.ExtPrebid;\n+import org.prebid.server.proto.openrtb.ext.request.nanointeractive.ExtImpNanointeractive;\n+import org.prebid.server.proto.openrtb.ext.response.BidType;\n+import org.prebid.server.util.HttpUtil;\n+\n+import java.util.ArrayList;\n+import java.util.Collection;\n+import java.util.Collections;\n+import java.util.List;\n+import java.util.Map;\n+import java.util.Objects;\n+import java.util.stream.Collectors;\n+\n+public class NanointeractiveBidder implements Bidder<BidRequest> {\n+\n+    private static final TypeReference<ExtPrebid<?, ExtImpNanointeractive>> NANOINTERACTIVE_EXT_TYPE_REFERENCE =\n+            new TypeReference<ExtPrebid<?, ExtImpNanointeractive>>() {\n+            };\n+    private static final String DEFAULT_BID_CURRENCY = \"USD\";\n+    private final String endpointUrl;\n+    private final JacksonMapper mapper;\n+\n+    public NanointeractiveBidder(String endpointUrl, JacksonMapper mapper) {\n+        this.endpointUrl = HttpUtil.validateUrl(Objects.requireNonNull(endpointUrl));\n+        this.mapper = Objects.requireNonNull(mapper);\n+    }\n+\n+    @Override\n+    public Result<List<HttpRequest<BidRequest>>> makeHttpRequests(BidRequest request) {\n+        final List<BidderError> errors = new ArrayList<>();\n+        final List<Imp> validImps = new ArrayList<>();\n+        String reference = \"\";\n+        for (Imp imp : request.getImp()) {\n+            try {\n+                final Imp validImp = validateImp(imp);\n+                final ExtImpNanointeractive extImp = parseImpExt(imp);\n+                if (StringUtils.isBlank(extImp.getPid())) {\n+                    throw new PreBidException(\"pid is empty\");\n+                }\n+\n+                if (StringUtils.isNotBlank(extImp.getRef())) {\n+                    reference = extImp.getRef();\n+                }\n+                validImps.add(validImp);\n+            } catch (PreBidException e) {\n+                errors.add(BidderError.badInput(e.getMessage()));\n+            }\n+        }\n+\n+        Site updateSite = null;\n+        if (StringUtils.isNotBlank(reference)) {\n+            if (request.getSite() != null) {\n+                updateSite = Site.builder().ref(reference).build();\n+            }\n+        }\n+\n+        final BidRequest outgoingRequest = request.toBuilder()\n+                .imp(validImps)\n+                .site(updateSite)\n+                .build();\n+\n+        final String body = mapper.encode(outgoingRequest);\n+\n+        return Result.of(Collections.singletonList(\n+                HttpRequest.<BidRequest>builder()\n+                        .method(HttpMethod.POST)\n+                        .uri(endpointUrl)\n+                        .headers(headers(request))\n+                        .payload(outgoingRequest)\n+                        .body(body)\n+                        .build()),\n+                errors);\n+    }\n+\n+    private Imp validateImp(Imp imp) {\n+        if (imp.getBanner() == null) {\n+            throw new PreBidException(\"invalid MediaType. NanoInteractive only supports Banner type.\");\n+        }\n+        return imp;\n+    }\n+\n+    private ExtImpNanointeractive parseImpExt(Imp imp) {\n+        try {\n+            return mapper.mapper().convertValue(imp.getExt(), NANOINTERACTIVE_EXT_TYPE_REFERENCE).getBidder();\n+        } catch (IllegalArgumentException e) {\n+            throw new PreBidException(e.getMessage(), e);\n+        }\n+    }\n+\n+    private MultiMap headers(BidRequest bidRequest) {\n+        final MultiMap headers = HttpUtil.headers().add(\"x-openrtb-version\", \"2.5\");\n+        final Device device = bidRequest.getDevice();\n+        if (device != null) {\n+            HttpUtil.addHeaderIfValueIsNotEmpty(headers, HttpUtil.USER_AGENT_HEADER, device.getUa());\n+            HttpUtil.addHeaderIfValueIsNotEmpty(headers, HttpUtil.X_FORWARDED_FOR_HEADER, device.getIp());\n+        }\n+\n+        final Site site = bidRequest.getSite();\n+        if (site != null) {\n+            HttpUtil.addHeaderIfValueIsNotEmpty(headers, HttpUtil.REFERER_HEADER, site.getPage());\n+        }\n+\n+        if (bidRequest.getUser() != null && StringUtils.isNotBlank(bidRequest.getUser().getBuyeruid())) {\n+            HttpUtil.addHeaderIfValueIsNotEmpty(headers, HttpUtil.COOKIE_HEADER, String.format(\"Nano=%s\",\n+                    bidRequest.getUser().getBuyeruid().trim()));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e6bea9ef83d223a12e87216b22da010b3e510f19"}, "originalPosition": 127}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMDA4MzAyMQ==", "bodyText": "They also check for status codes", "url": "https://github.com/prebid/prebid-server-java/pull/700#discussion_r420083021", "createdAt": "2020-05-05T12:50:29Z", "author": {"login": "DGarbar"}, "path": "src/main/java/org/prebid/server/bidder/nanointeractive/NanointeractiveBidder.java", "diffHunk": "@@ -0,0 +1,162 @@\n+package org.prebid.server.bidder.nanointeractive;\n+\n+import com.fasterxml.jackson.core.type.TypeReference;\n+import com.fasterxml.jackson.databind.node.ObjectNode;\n+import com.iab.openrtb.request.BidRequest;\n+import com.iab.openrtb.request.Device;\n+import com.iab.openrtb.request.Imp;\n+import com.iab.openrtb.request.Site;\n+import com.iab.openrtb.response.BidResponse;\n+import com.iab.openrtb.response.SeatBid;\n+import io.vertx.core.MultiMap;\n+import io.vertx.core.http.HttpMethod;\n+import org.apache.commons.lang3.StringUtils;\n+import org.prebid.server.bidder.Bidder;\n+import org.prebid.server.bidder.model.BidderBid;\n+import org.prebid.server.bidder.model.BidderError;\n+import org.prebid.server.bidder.model.HttpCall;\n+import org.prebid.server.bidder.model.HttpRequest;\n+import org.prebid.server.bidder.model.Result;\n+import org.prebid.server.exception.PreBidException;\n+import org.prebid.server.json.DecodeException;\n+import org.prebid.server.json.JacksonMapper;\n+import org.prebid.server.proto.openrtb.ext.ExtPrebid;\n+import org.prebid.server.proto.openrtb.ext.request.nanointeractive.ExtImpNanointeractive;\n+import org.prebid.server.proto.openrtb.ext.response.BidType;\n+import org.prebid.server.util.HttpUtil;\n+\n+import java.util.ArrayList;\n+import java.util.Collection;\n+import java.util.Collections;\n+import java.util.List;\n+import java.util.Map;\n+import java.util.Objects;\n+import java.util.stream.Collectors;\n+\n+public class NanointeractiveBidder implements Bidder<BidRequest> {\n+\n+    private static final TypeReference<ExtPrebid<?, ExtImpNanointeractive>> NANOINTERACTIVE_EXT_TYPE_REFERENCE =\n+            new TypeReference<ExtPrebid<?, ExtImpNanointeractive>>() {\n+            };\n+    private static final String DEFAULT_BID_CURRENCY = \"USD\";\n+    private final String endpointUrl;\n+    private final JacksonMapper mapper;\n+\n+    public NanointeractiveBidder(String endpointUrl, JacksonMapper mapper) {\n+        this.endpointUrl = HttpUtil.validateUrl(Objects.requireNonNull(endpointUrl));\n+        this.mapper = Objects.requireNonNull(mapper);\n+    }\n+\n+    @Override\n+    public Result<List<HttpRequest<BidRequest>>> makeHttpRequests(BidRequest request) {\n+        final List<BidderError> errors = new ArrayList<>();\n+        final List<Imp> validImps = new ArrayList<>();\n+        String reference = \"\";\n+        for (Imp imp : request.getImp()) {\n+            try {\n+                final Imp validImp = validateImp(imp);\n+                final ExtImpNanointeractive extImp = parseImpExt(imp);\n+                if (StringUtils.isBlank(extImp.getPid())) {\n+                    throw new PreBidException(\"pid is empty\");\n+                }\n+\n+                if (StringUtils.isNotBlank(extImp.getRef())) {\n+                    reference = extImp.getRef();\n+                }\n+                validImps.add(validImp);\n+            } catch (PreBidException e) {\n+                errors.add(BidderError.badInput(e.getMessage()));\n+            }\n+        }\n+\n+        Site updateSite = null;\n+        if (StringUtils.isNotBlank(reference)) {\n+            if (request.getSite() != null) {\n+                updateSite = Site.builder().ref(reference).build();\n+            }\n+        }\n+\n+        final BidRequest outgoingRequest = request.toBuilder()\n+                .imp(validImps)\n+                .site(updateSite)\n+                .build();\n+\n+        final String body = mapper.encode(outgoingRequest);\n+\n+        return Result.of(Collections.singletonList(\n+                HttpRequest.<BidRequest>builder()\n+                        .method(HttpMethod.POST)\n+                        .uri(endpointUrl)\n+                        .headers(headers(request))\n+                        .payload(outgoingRequest)\n+                        .body(body)\n+                        .build()),\n+                errors);\n+    }\n+\n+    private Imp validateImp(Imp imp) {\n+        if (imp.getBanner() == null) {\n+            throw new PreBidException(\"invalid MediaType. NanoInteractive only supports Banner type.\");\n+        }\n+        return imp;\n+    }\n+\n+    private ExtImpNanointeractive parseImpExt(Imp imp) {\n+        try {\n+            return mapper.mapper().convertValue(imp.getExt(), NANOINTERACTIVE_EXT_TYPE_REFERENCE).getBidder();\n+        } catch (IllegalArgumentException e) {\n+            throw new PreBidException(e.getMessage(), e);\n+        }\n+    }\n+\n+    private MultiMap headers(BidRequest bidRequest) {\n+        final MultiMap headers = HttpUtil.headers().add(\"x-openrtb-version\", \"2.5\");\n+        final Device device = bidRequest.getDevice();\n+        if (device != null) {\n+            HttpUtil.addHeaderIfValueIsNotEmpty(headers, HttpUtil.USER_AGENT_HEADER, device.getUa());\n+            HttpUtil.addHeaderIfValueIsNotEmpty(headers, HttpUtil.X_FORWARDED_FOR_HEADER, device.getIp());\n+        }\n+\n+        final Site site = bidRequest.getSite();\n+        if (site != null) {\n+            HttpUtil.addHeaderIfValueIsNotEmpty(headers, HttpUtil.REFERER_HEADER, site.getPage());\n+        }\n+\n+        if (bidRequest.getUser() != null && StringUtils.isNotBlank(bidRequest.getUser().getBuyeruid())) {\n+            HttpUtil.addHeaderIfValueIsNotEmpty(headers, HttpUtil.COOKIE_HEADER, String.format(\"Nano=%s\",\n+                    bidRequest.getUser().getBuyeruid().trim()));\n+        }\n+        return headers;\n+    }\n+\n+    @Override\n+    public Result<List<BidderBid>> makeBids(HttpCall<BidRequest> httpCall, BidRequest bidRequest) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e6bea9ef83d223a12e87216b22da010b3e510f19"}, "originalPosition": 133}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMDA4Mzc5MQ==", "bodyText": "They also validates that price is above 0", "url": "https://github.com/prebid/prebid-server-java/pull/700#discussion_r420083791", "createdAt": "2020-05-05T12:51:50Z", "author": {"login": "DGarbar"}, "path": "src/main/java/org/prebid/server/bidder/nanointeractive/NanointeractiveBidder.java", "diffHunk": "@@ -0,0 +1,162 @@\n+package org.prebid.server.bidder.nanointeractive;\n+\n+import com.fasterxml.jackson.core.type.TypeReference;\n+import com.fasterxml.jackson.databind.node.ObjectNode;\n+import com.iab.openrtb.request.BidRequest;\n+import com.iab.openrtb.request.Device;\n+import com.iab.openrtb.request.Imp;\n+import com.iab.openrtb.request.Site;\n+import com.iab.openrtb.response.BidResponse;\n+import com.iab.openrtb.response.SeatBid;\n+import io.vertx.core.MultiMap;\n+import io.vertx.core.http.HttpMethod;\n+import org.apache.commons.lang3.StringUtils;\n+import org.prebid.server.bidder.Bidder;\n+import org.prebid.server.bidder.model.BidderBid;\n+import org.prebid.server.bidder.model.BidderError;\n+import org.prebid.server.bidder.model.HttpCall;\n+import org.prebid.server.bidder.model.HttpRequest;\n+import org.prebid.server.bidder.model.Result;\n+import org.prebid.server.exception.PreBidException;\n+import org.prebid.server.json.DecodeException;\n+import org.prebid.server.json.JacksonMapper;\n+import org.prebid.server.proto.openrtb.ext.ExtPrebid;\n+import org.prebid.server.proto.openrtb.ext.request.nanointeractive.ExtImpNanointeractive;\n+import org.prebid.server.proto.openrtb.ext.response.BidType;\n+import org.prebid.server.util.HttpUtil;\n+\n+import java.util.ArrayList;\n+import java.util.Collection;\n+import java.util.Collections;\n+import java.util.List;\n+import java.util.Map;\n+import java.util.Objects;\n+import java.util.stream.Collectors;\n+\n+public class NanointeractiveBidder implements Bidder<BidRequest> {\n+\n+    private static final TypeReference<ExtPrebid<?, ExtImpNanointeractive>> NANOINTERACTIVE_EXT_TYPE_REFERENCE =\n+            new TypeReference<ExtPrebid<?, ExtImpNanointeractive>>() {\n+            };\n+    private static final String DEFAULT_BID_CURRENCY = \"USD\";\n+    private final String endpointUrl;\n+    private final JacksonMapper mapper;\n+\n+    public NanointeractiveBidder(String endpointUrl, JacksonMapper mapper) {\n+        this.endpointUrl = HttpUtil.validateUrl(Objects.requireNonNull(endpointUrl));\n+        this.mapper = Objects.requireNonNull(mapper);\n+    }\n+\n+    @Override\n+    public Result<List<HttpRequest<BidRequest>>> makeHttpRequests(BidRequest request) {\n+        final List<BidderError> errors = new ArrayList<>();\n+        final List<Imp> validImps = new ArrayList<>();\n+        String reference = \"\";\n+        for (Imp imp : request.getImp()) {\n+            try {\n+                final Imp validImp = validateImp(imp);\n+                final ExtImpNanointeractive extImp = parseImpExt(imp);\n+                if (StringUtils.isBlank(extImp.getPid())) {\n+                    throw new PreBidException(\"pid is empty\");\n+                }\n+\n+                if (StringUtils.isNotBlank(extImp.getRef())) {\n+                    reference = extImp.getRef();\n+                }\n+                validImps.add(validImp);\n+            } catch (PreBidException e) {\n+                errors.add(BidderError.badInput(e.getMessage()));\n+            }\n+        }\n+\n+        Site updateSite = null;\n+        if (StringUtils.isNotBlank(reference)) {\n+            if (request.getSite() != null) {\n+                updateSite = Site.builder().ref(reference).build();\n+            }\n+        }\n+\n+        final BidRequest outgoingRequest = request.toBuilder()\n+                .imp(validImps)\n+                .site(updateSite)\n+                .build();\n+\n+        final String body = mapper.encode(outgoingRequest);\n+\n+        return Result.of(Collections.singletonList(\n+                HttpRequest.<BidRequest>builder()\n+                        .method(HttpMethod.POST)\n+                        .uri(endpointUrl)\n+                        .headers(headers(request))\n+                        .payload(outgoingRequest)\n+                        .body(body)\n+                        .build()),\n+                errors);\n+    }\n+\n+    private Imp validateImp(Imp imp) {\n+        if (imp.getBanner() == null) {\n+            throw new PreBidException(\"invalid MediaType. NanoInteractive only supports Banner type.\");\n+        }\n+        return imp;\n+    }\n+\n+    private ExtImpNanointeractive parseImpExt(Imp imp) {\n+        try {\n+            return mapper.mapper().convertValue(imp.getExt(), NANOINTERACTIVE_EXT_TYPE_REFERENCE).getBidder();\n+        } catch (IllegalArgumentException e) {\n+            throw new PreBidException(e.getMessage(), e);\n+        }\n+    }\n+\n+    private MultiMap headers(BidRequest bidRequest) {\n+        final MultiMap headers = HttpUtil.headers().add(\"x-openrtb-version\", \"2.5\");\n+        final Device device = bidRequest.getDevice();\n+        if (device != null) {\n+            HttpUtil.addHeaderIfValueIsNotEmpty(headers, HttpUtil.USER_AGENT_HEADER, device.getUa());\n+            HttpUtil.addHeaderIfValueIsNotEmpty(headers, HttpUtil.X_FORWARDED_FOR_HEADER, device.getIp());\n+        }\n+\n+        final Site site = bidRequest.getSite();\n+        if (site != null) {\n+            HttpUtil.addHeaderIfValueIsNotEmpty(headers, HttpUtil.REFERER_HEADER, site.getPage());\n+        }\n+\n+        if (bidRequest.getUser() != null && StringUtils.isNotBlank(bidRequest.getUser().getBuyeruid())) {\n+            HttpUtil.addHeaderIfValueIsNotEmpty(headers, HttpUtil.COOKIE_HEADER, String.format(\"Nano=%s\",\n+                    bidRequest.getUser().getBuyeruid().trim()));\n+        }\n+        return headers;\n+    }\n+\n+    @Override\n+    public Result<List<BidderBid>> makeBids(HttpCall<BidRequest> httpCall, BidRequest bidRequest) {\n+        try {\n+            final BidResponse bidResponse = mapper.decodeValue(httpCall.getResponse().getBody(), BidResponse.class);\n+            return Result.of(extractBids(httpCall.getRequest().getPayload(), bidResponse), Collections.emptyList());\n+        } catch (DecodeException | PreBidException e) {\n+            return Result.emptyWithError(BidderError.badServerResponse(e.getMessage()));\n+        }\n+    }\n+\n+    private static List<BidderBid> extractBids(BidRequest bidRequest, BidResponse bidResponse) {\n+        return bidResponse == null || bidResponse.getSeatbid() == null\n+                ? Collections.emptyList()\n+                : bidsFromResponse(bidRequest, bidResponse);\n+    }\n+\n+    private static List<BidderBid> bidsFromResponse(BidRequest bidRequest, BidResponse bidResponse) {\n+        return bidResponse.getSeatbid().stream()\n+                .filter(Objects::nonNull)\n+                .map(SeatBid::getBid)", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e6bea9ef83d223a12e87216b22da010b3e510f19"}, "originalPosition": 151}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMDA4Mzk4NA==", "bodyText": "currency is from response", "url": "https://github.com/prebid/prebid-server-java/pull/700#discussion_r420083984", "createdAt": "2020-05-05T12:52:09Z", "author": {"login": "DGarbar"}, "path": "src/main/java/org/prebid/server/bidder/nanointeractive/NanointeractiveBidder.java", "diffHunk": "@@ -0,0 +1,162 @@\n+package org.prebid.server.bidder.nanointeractive;\n+\n+import com.fasterxml.jackson.core.type.TypeReference;\n+import com.fasterxml.jackson.databind.node.ObjectNode;\n+import com.iab.openrtb.request.BidRequest;\n+import com.iab.openrtb.request.Device;\n+import com.iab.openrtb.request.Imp;\n+import com.iab.openrtb.request.Site;\n+import com.iab.openrtb.response.BidResponse;\n+import com.iab.openrtb.response.SeatBid;\n+import io.vertx.core.MultiMap;\n+import io.vertx.core.http.HttpMethod;\n+import org.apache.commons.lang3.StringUtils;\n+import org.prebid.server.bidder.Bidder;\n+import org.prebid.server.bidder.model.BidderBid;\n+import org.prebid.server.bidder.model.BidderError;\n+import org.prebid.server.bidder.model.HttpCall;\n+import org.prebid.server.bidder.model.HttpRequest;\n+import org.prebid.server.bidder.model.Result;\n+import org.prebid.server.exception.PreBidException;\n+import org.prebid.server.json.DecodeException;\n+import org.prebid.server.json.JacksonMapper;\n+import org.prebid.server.proto.openrtb.ext.ExtPrebid;\n+import org.prebid.server.proto.openrtb.ext.request.nanointeractive.ExtImpNanointeractive;\n+import org.prebid.server.proto.openrtb.ext.response.BidType;\n+import org.prebid.server.util.HttpUtil;\n+\n+import java.util.ArrayList;\n+import java.util.Collection;\n+import java.util.Collections;\n+import java.util.List;\n+import java.util.Map;\n+import java.util.Objects;\n+import java.util.stream.Collectors;\n+\n+public class NanointeractiveBidder implements Bidder<BidRequest> {\n+\n+    private static final TypeReference<ExtPrebid<?, ExtImpNanointeractive>> NANOINTERACTIVE_EXT_TYPE_REFERENCE =\n+            new TypeReference<ExtPrebid<?, ExtImpNanointeractive>>() {\n+            };\n+    private static final String DEFAULT_BID_CURRENCY = \"USD\";\n+    private final String endpointUrl;\n+    private final JacksonMapper mapper;\n+\n+    public NanointeractiveBidder(String endpointUrl, JacksonMapper mapper) {\n+        this.endpointUrl = HttpUtil.validateUrl(Objects.requireNonNull(endpointUrl));\n+        this.mapper = Objects.requireNonNull(mapper);\n+    }\n+\n+    @Override\n+    public Result<List<HttpRequest<BidRequest>>> makeHttpRequests(BidRequest request) {\n+        final List<BidderError> errors = new ArrayList<>();\n+        final List<Imp> validImps = new ArrayList<>();\n+        String reference = \"\";\n+        for (Imp imp : request.getImp()) {\n+            try {\n+                final Imp validImp = validateImp(imp);\n+                final ExtImpNanointeractive extImp = parseImpExt(imp);\n+                if (StringUtils.isBlank(extImp.getPid())) {\n+                    throw new PreBidException(\"pid is empty\");\n+                }\n+\n+                if (StringUtils.isNotBlank(extImp.getRef())) {\n+                    reference = extImp.getRef();\n+                }\n+                validImps.add(validImp);\n+            } catch (PreBidException e) {\n+                errors.add(BidderError.badInput(e.getMessage()));\n+            }\n+        }\n+\n+        Site updateSite = null;\n+        if (StringUtils.isNotBlank(reference)) {\n+            if (request.getSite() != null) {\n+                updateSite = Site.builder().ref(reference).build();\n+            }\n+        }\n+\n+        final BidRequest outgoingRequest = request.toBuilder()\n+                .imp(validImps)\n+                .site(updateSite)\n+                .build();\n+\n+        final String body = mapper.encode(outgoingRequest);\n+\n+        return Result.of(Collections.singletonList(\n+                HttpRequest.<BidRequest>builder()\n+                        .method(HttpMethod.POST)\n+                        .uri(endpointUrl)\n+                        .headers(headers(request))\n+                        .payload(outgoingRequest)\n+                        .body(body)\n+                        .build()),\n+                errors);\n+    }\n+\n+    private Imp validateImp(Imp imp) {\n+        if (imp.getBanner() == null) {\n+            throw new PreBidException(\"invalid MediaType. NanoInteractive only supports Banner type.\");\n+        }\n+        return imp;\n+    }\n+\n+    private ExtImpNanointeractive parseImpExt(Imp imp) {\n+        try {\n+            return mapper.mapper().convertValue(imp.getExt(), NANOINTERACTIVE_EXT_TYPE_REFERENCE).getBidder();\n+        } catch (IllegalArgumentException e) {\n+            throw new PreBidException(e.getMessage(), e);\n+        }\n+    }\n+\n+    private MultiMap headers(BidRequest bidRequest) {\n+        final MultiMap headers = HttpUtil.headers().add(\"x-openrtb-version\", \"2.5\");\n+        final Device device = bidRequest.getDevice();\n+        if (device != null) {\n+            HttpUtil.addHeaderIfValueIsNotEmpty(headers, HttpUtil.USER_AGENT_HEADER, device.getUa());\n+            HttpUtil.addHeaderIfValueIsNotEmpty(headers, HttpUtil.X_FORWARDED_FOR_HEADER, device.getIp());\n+        }\n+\n+        final Site site = bidRequest.getSite();\n+        if (site != null) {\n+            HttpUtil.addHeaderIfValueIsNotEmpty(headers, HttpUtil.REFERER_HEADER, site.getPage());\n+        }\n+\n+        if (bidRequest.getUser() != null && StringUtils.isNotBlank(bidRequest.getUser().getBuyeruid())) {\n+            HttpUtil.addHeaderIfValueIsNotEmpty(headers, HttpUtil.COOKIE_HEADER, String.format(\"Nano=%s\",\n+                    bidRequest.getUser().getBuyeruid().trim()));\n+        }\n+        return headers;\n+    }\n+\n+    @Override\n+    public Result<List<BidderBid>> makeBids(HttpCall<BidRequest> httpCall, BidRequest bidRequest) {\n+        try {\n+            final BidResponse bidResponse = mapper.decodeValue(httpCall.getResponse().getBody(), BidResponse.class);\n+            return Result.of(extractBids(httpCall.getRequest().getPayload(), bidResponse), Collections.emptyList());\n+        } catch (DecodeException | PreBidException e) {\n+            return Result.emptyWithError(BidderError.badServerResponse(e.getMessage()));\n+        }\n+    }\n+\n+    private static List<BidderBid> extractBids(BidRequest bidRequest, BidResponse bidResponse) {\n+        return bidResponse == null || bidResponse.getSeatbid() == null\n+                ? Collections.emptyList()\n+                : bidsFromResponse(bidRequest, bidResponse);\n+    }\n+\n+    private static List<BidderBid> bidsFromResponse(BidRequest bidRequest, BidResponse bidResponse) {\n+        return bidResponse.getSeatbid().stream()\n+                .filter(Objects::nonNull)\n+                .map(SeatBid::getBid)\n+                .filter(Objects::nonNull)\n+                .flatMap(Collection::stream)\n+                .map(bid -> BidderBid.of(bid, BidType.banner, DEFAULT_BID_CURRENCY))\n+                .collect(Collectors.toList());", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e6bea9ef83d223a12e87216b22da010b3e510f19"}, "originalPosition": 155}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMDA4Njc1Mg==", "bodyText": "remove this value if you want to check that smth was set.\nAlso as I mentioned Site shouldn't be removed.", "url": "https://github.com/prebid/prebid-server-java/pull/700#discussion_r420086752", "createdAt": "2020-05-05T12:56:34Z", "author": {"login": "DGarbar"}, "path": "src/test/resources/org/prebid/server/it/openrtb2/nanointeractive/test-auction-nanointeractive-request.json", "diffHunk": "@@ -0,0 +1,118 @@\n+{\n+  \"id\": \"tid\",\n+  \"imp\": [\n+    {\n+      \"id\": \"impId13\",\n+      \"banner\": {\n+        \"format\": [\n+          {\n+            \"w\": 300,\n+            \"h\": 250\n+          }\n+        ],\n+        \"w\": 300,\n+        \"h\": 250\n+      },\n+      \"ext\": {\n+        \"nanointeractive\": {\n+          \"pid\": \"58bfec94eb0a1916fa380163\",\n+          \"nq\": [\"search query\"],\n+          \"category\": \"Automotive\",\n+          \"subId\": \"a23\",\n+          \"ref\": \"https://nanointeractive.com\"\n+        }\n+      }\n+    },\n+    {\n+      \"id\": \"impId001\",\n+      \"banner\": {\n+        \"format\": [\n+          {\n+            \"w\": 300,\n+            \"h\": 250\n+          }\n+        ],\n+        \"w\": 300,\n+        \"h\": 250\n+      },\n+      \"ext\": {\n+        \"nanointeractive\": {\n+          \"pid\": \"58bfec94eb0a1916fa380163\",\n+          \"nq\": [\"search query\"],\n+          \"category\": \"Automotive\",\n+          \"subId\": \"a23\",\n+          \"ref\": \"https://nanointeractive.com\"\n+        }\n+      }\n+    }\n+  ],\n+  \"device\": {\n+    \"pxratio\": 4.2,\n+    \"dnt\": 2,\n+    \"language\": \"en\",\n+    \"ifa\": \"ifaId\"\n+  },\n+  \"site\": {\n+    \"page\": \"http://www.example.com\",\n+    \"ref\": \"https://nanointeractive.com\",", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e6bea9ef83d223a12e87216b22da010b3e510f19"}, "originalPosition": 57}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ef68503ac174aa6950329ff37e0a74e1cf0de904", "author": {"user": {"login": "AndriyPavlyuk", "name": null}}, "url": "https://github.com/prebid/prebid-server-java/commit/ef68503ac174aa6950329ff37e0a74e1cf0de904", "committedDate": "2020-05-06T18:14:58Z", "message": "Fix after review"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDA4MTU0Mzk3", "url": "https://github.com/prebid/prebid-server-java/pull/700#pullrequestreview-408154397", "createdAt": "2020-05-08T10:43:47Z", "commit": {"oid": "ef68503ac174aa6950329ff37e0a74e1cf0de904"}, "state": "DISMISSED", "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wOFQxMDo0Mzo0N1rOGShYBg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wOFQxMDo1Mjo0NlrOGShmGw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMjA3NDM3NA==", "bodyText": "Now you inject nothing when site is null.\nYou can rewrite it like this.\n final Site site = request.getSite();\n        if (StringUtils.isNotBlank(reference)) {\n           return site == null ? Site.builder().ref(reference).build() : site.toBuilder().ref(reference).build();\n        }\n        return site;", "url": "https://github.com/prebid/prebid-server-java/pull/700#discussion_r422074374", "createdAt": "2020-05-08T10:43:47Z", "author": {"login": "DGarbar"}, "path": "src/main/java/org/prebid/server/bidder/nanointeractive/NanointeractiveBidder.java", "diffHunk": "@@ -109,6 +103,15 @@ private ExtImpNanointeractive parseImpExt(Imp imp) {\n         }\n     }\n \n+    private static Site modifySite(String reference, BidRequest request) {\n+        final Site site = request.getSite();\n+        Site.SiteBuilder siteBuilder = null;\n+        if (StringUtils.isNotBlank(reference)) {\n+            siteBuilder = site == null ? Site.builder() : site.toBuilder().ref(reference);\n+        }\n+        return siteBuilder != null ? siteBuilder.build() : null;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ef68503ac174aa6950329ff37e0a74e1cf0de904"}, "originalPosition": 55}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMjA3NTYwOA==", "bodyText": "I'm sorry, I suggested updateSite but not I think that it will be more appropriate to call modified site.\nAnd pass only Site to the arguments, not all BidRequest", "url": "https://github.com/prebid/prebid-server-java/pull/700#discussion_r422075608", "createdAt": "2020-05-08T10:46:42Z", "author": {"login": "DGarbar"}, "path": "src/main/java/org/prebid/server/bidder/nanointeractive/NanointeractiveBidder.java", "diffHunk": "@@ -109,6 +103,15 @@ private ExtImpNanointeractive parseImpExt(Imp imp) {\n         }\n     }\n \n+    private static Site modifySite(String reference, BidRequest request) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ef68503ac174aa6950329ff37e0a74e1cf0de904"}, "originalPosition": 49}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMjA3Nzk3OQ==", "bodyText": "make test that cur is from response", "url": "https://github.com/prebid/prebid-server-java/pull/700#discussion_r422077979", "createdAt": "2020-05-08T10:52:46Z", "author": {"login": "DGarbar"}, "path": "src/main/java/org/prebid/server/bidder/nanointeractive/NanointeractiveBidder.java", "diffHunk": "@@ -151,7 +164,8 @@ private MultiMap headers(BidRequest bidRequest) {\n                 .map(SeatBid::getBid)\n                 .filter(Objects::nonNull)\n                 .flatMap(Collection::stream)\n-                .map(bid -> BidderBid.of(bid, BidType.banner, DEFAULT_BID_CURRENCY))\n+                .filter(bid -> bid.getPrice().compareTo(BigDecimal.ZERO) > 0)\n+                .map(bid -> BidderBid.of(bid, BidType.banner, bidResponse.getCur()))", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ef68503ac174aa6950329ff37e0a74e1cf0de904"}, "originalPosition": 84}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "3ac5293009785a1439afc402f84d016c870d674f", "author": {"user": {"login": "AndriyPavlyuk", "name": null}}, "url": "https://github.com/prebid/prebid-server-java/commit/3ac5293009785a1439afc402f84d016c870d674f", "committedDate": "2020-05-13T13:42:38Z", "message": "Add test to check price"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "07998de9e3dad27fa33c25b35bd9d451fba30153", "author": {"user": {"login": "rpanchyk", "name": null}}, "url": "https://github.com/prebid/prebid-server-java/commit/07998de9e3dad27fa33c25b35bd9d451fba30153", "committedDate": "2020-06-24T15:53:04Z", "message": "Merge branch 'master' into add-nanointeractive-bidder"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ebfed8f7931e0da8e796a32ee1f2a9a561e48c2d", "author": {"user": {"login": "rpanchyk", "name": null}}, "url": "https://github.com/prebid/prebid-server-java/commit/ebfed8f7931e0da8e796a32ee1f2a9a561e48c2d", "committedDate": "2020-06-24T15:55:13Z", "message": "Add pbs-enforces-ccpa property to nanointeractive.yaml file"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDM2Nzg2MzM3", "url": "https://github.com/prebid/prebid-server-java/pull/700#pullrequestreview-436786337", "createdAt": "2020-06-24T15:56:06Z", "commit": {"oid": "ebfed8f7931e0da8e796a32ee1f2a9a561e48c2d"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3165, "cost": 1, "resetAt": "2021-11-01T16:37:27Z"}}}