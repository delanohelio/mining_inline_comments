{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDQ2NzYwMDI2", "number": 797, "title": "Add choosing of the most valuable bid for single imp id", "bodyText": "Priority by deal and then by cpm", "createdAt": "2020-07-09T10:10:18Z", "url": "https://github.com/prebid/prebid-server-java/pull/797", "merged": true, "mergeCommit": {"oid": "4ca80b494358af911565d77689c79e351aac20de"}, "closed": true, "closedAt": "2020-07-17T10:19:06Z", "author": {"login": "DGarbar"}, "timelineItems": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABczMAJ7gH2gAyNDQ2NzYwMDI2OmE0MDdjYTNmMzExYTZjNTJhZTY1NGE1NzYzMzQ5YzI4NmFkNWE3NzI=", "endCursor": "Y3Vyc29yOnYyOpPPAAABc1xIpuAFqTQ1MDU0MzQ1NA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "a407ca3f311a6c52ae654a5763349c286ad5a772", "author": {"user": {"login": "DGarbar", "name": "Dmitriy"}}, "url": "https://github.com/prebid/prebid-server-java/commit/a407ca3f311a6c52ae654a5763349c286ad5a772", "committedDate": "2020-07-09T09:55:15Z", "message": "Add choosing most valuable bid that have same imp id"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDQ1NzQ2NTg5", "url": "https://github.com/prebid/prebid-server-java/pull/797#pullrequestreview-445746589", "createdAt": "2020-07-09T15:47:51Z", "commit": {"oid": "a407ca3f311a6c52ae654a5763349c286ad5a772"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wOVQxNTo0Nzo1MVrOGvXPLA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wOVQxNTo1MjoyOFrOGvXaqw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MjMxNjk3Mg==", "bodyText": "Pls consider this way:\n        final List<BidderBid> mostValuableBids = impIdToBidderBid.values().stream()\n                .map(BidResponseCreator::mostValuableBid)\n                .collect(Collectors.toList());\n\n        responseBidderBids.retainAll(mostValuableBids);", "url": "https://github.com/prebid/prebid-server-java/pull/797#discussion_r452316972", "createdAt": "2020-07-09T15:47:51Z", "author": {"login": "rpanchyk"}, "path": "src/main/java/org/prebid/server/auction/BidResponseCreator.java", "diffHunk": "@@ -188,6 +192,35 @@ private ExtBidResponse toExtBidResponse(List<BidderResponse> bidderResponses, Au\n                 ExtBidResponsePrebid.of(auctionTimestamp));\n     }\n \n+    private static void removeRedundantBids(BidderResponse bidderResponse) {\n+        final List<BidderBid> responseBidderBids = bidderResponse.getSeatBid().getBids();\n+        final Map<String, List<BidderBid>> impIdToBidderBid = responseBidderBids.stream()\n+                .collect(Collectors.groupingBy(bidderBid -> bidderBid.getBid().getImpid()));\n+\n+        final List<BidderBid> bidsForRemoval = impIdToBidderBid.values().stream()\n+                .peek(bidderBids -> bidderBids.remove(mostValuableBid(bidderBids)))", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a407ca3f311a6c52ae654a5763349c286ad5a772"}, "originalPosition": 35}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MjMxODQ2Nw==", "bodyText": "Just a thought. i1 is slightly hard to read ;-)\nUsually we use imp1, etc.", "url": "https://github.com/prebid/prebid-server-java/pull/797#discussion_r452318467", "createdAt": "2020-07-09T15:50:16Z", "author": {"login": "rpanchyk"}, "path": "src/test/java/org/prebid/server/auction/BidResponseCreatorTest.java", "diffHunk": "@@ -385,7 +386,7 @@ public void shouldSetNbrNullAndPopulateSeatbidWhenAtLeastOneBidIsPresent() {\n         // given\n         final AuctionContext auctionContext = givenAuctionContext(givenBidRequest());\n \n-        final Bid bid = Bid.builder().build();\n+        final Bid bid = Bid.builder().impid(\"i1\").build();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a407ca3f311a6c52ae654a5763349c286ad5a772"}, "originalPosition": 13}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MjMxOTkxNQ==", "bodyText": "Pls fix typo in Equeal.", "url": "https://github.com/prebid/prebid-server-java/pull/797#discussion_r452319915", "createdAt": "2020-07-09T15:52:28Z", "author": {"login": "rpanchyk"}, "path": "src/test/java/org/prebid/server/auction/BidResponseCreatorTest.java", "diffHunk": "@@ -484,6 +487,47 @@ public void shouldSetExpectedResponseSeatBidAndBidFields() {\n         verify(cacheService, never()).cacheBidsOpenrtb(anyList(), anyList(), any(), any(), any(), any());\n     }\n \n+    @Test\n+    public void shouldFilterByDealsAndPriceBidsWhenImpIdsAreEqueal() {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a407ca3f311a6c52ae654a5763349c286ad5a772"}, "originalPosition": 51}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "2456f5da74ecf1ef3b5da0a2b127c274d8a4a804", "author": {"user": {"login": "DGarbar", "name": "Dmitriy"}}, "url": "https://github.com/prebid/prebid-server-java/commit/2456f5da74ecf1ef3b5da0a2b127c274d8a4a804", "committedDate": "2020-07-16T16:25:16Z", "message": "Small fixes after review"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDUwNTQzNDU0", "url": "https://github.com/prebid/prebid-server-java/pull/797#pullrequestreview-450543454", "createdAt": "2020-07-17T10:18:52Z", "commit": {"oid": "2456f5da74ecf1ef3b5da0a2b127c274d8a4a804"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3068, "cost": 1, "resetAt": "2021-11-01T16:37:27Z"}}}