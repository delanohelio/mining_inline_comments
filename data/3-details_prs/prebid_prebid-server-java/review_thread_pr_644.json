{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0Mzk0MDg2NTY0", "number": 644, "reviewThreads": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yN1QxNDo0NDowOVrODsGIzQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yN1QxNDo0NDo0NlrODsGJwQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjQ3NTY0NDkzOnYy", "diffSide": "RIGHT", "path": "src/main/java/org/prebid/server/auction/VideoRequestFactory.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yN1QxNDo0NDowOVrOF80UGw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yN1QxNDo0NDowOVrOF80UGw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5OTMxNTk5NQ==", "bodyText": "First of all. Don't you thing that\n1 Check if Device is null\n2 Create new Device if it is Null and insert into request.\n3 call bidRequestVideo.getDevice() 4 times\n4 ...\n5 Then create new request. And create new device again. And set UA.", "url": "https://github.com/prebid/prebid-server-java/pull/644#discussion_r399315995", "createdAt": "2020-03-27T14:44:09Z", "author": {"login": "DGarbar"}, "path": "src/main/java/org/prebid/server/auction/VideoRequestFactory.java", "diffHunk": "@@ -85,7 +87,22 @@ private BidRequestVideo parseRequest(RoutingContext context) {\n         }\n \n         try {\n-            return mapper.decodeValue(body, BidRequestVideo.class);\n+            BidRequestVideo bidRequestVideo = mapper.decodeValue(body, BidRequestVideo.class);\n+            if (bidRequestVideo.getDevice() == null) {\n+                bidRequestVideo = bidRequestVideo.toBuilder().device(Device.builder().build()).build();\n+            }\n+            if (StringUtils.isEmpty(bidRequestVideo.getDevice().getUa())) {\n+                final String userAgentHeader = context.request().getHeader(HttpUtil.USER_AGENT_HEADER);\n+                if (StringUtils.isEmpty(userAgentHeader)) {\n+                    throw new InvalidRequestException(\"Device.UA and User-Agent Header is not presented\");\n+                }\n+                bidRequestVideo = bidRequestVideo.toBuilder()\n+                        .device(bidRequestVideo.getDevice().toBuilder()\n+                                .ua(userAgentHeader)\n+                                .build())\n+                        .build();\n+            }", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "9640b9068b14f6d83215b8eae6e0ea8572ab0e33"}, "originalPosition": 35}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjQ3NTY0NTQ4OnYy", "diffSide": "RIGHT", "path": "src/main/java/org/prebid/server/auction/VideoRequestFactory.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yN1QxNDo0NDoyMFrOF80UhA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yN1QxNDo0NDoyMFrOF80UhA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5OTMxNjEwMA==", "bodyText": "private BidRequestVideo insertDeviceUa(RoutingContext context, BidRequestVideo bidRequestVideo) {\n        final Device device = bidRequestVideo.getDevice();\n        final String deviceUa = device != null ? device.getUa() : null;\n        if (StringUtils.isBlank(deviceUa)) {\n            final String userAgentHeader = context.request().getHeader(HttpUtil.USER_AGENT_HEADER);\n            if (StringUtils.isEmpty(userAgentHeader)) {\n                throw new InvalidRequestException(\"Device.UA and User-Agent Header is not present\");\n            }\n            final Device.DeviceBuilder deviceBuilder = device == null ? Device.builder() : device.toBuilder();\n\n            return bidRequestVideo.toBuilder()\n                    .device(deviceBuilder\n                            .ua(userAgentHeader)\n                            .build())\n                    .build();\n        }\n        return bidRequestVideo;\n    }", "url": "https://github.com/prebid/prebid-server-java/pull/644#discussion_r399316100", "createdAt": "2020-03-27T14:44:20Z", "author": {"login": "DGarbar"}, "path": "src/main/java/org/prebid/server/auction/VideoRequestFactory.java", "diffHunk": "@@ -85,7 +87,22 @@ private BidRequestVideo parseRequest(RoutingContext context) {\n         }\n \n         try {\n-            return mapper.decodeValue(body, BidRequestVideo.class);\n+            BidRequestVideo bidRequestVideo = mapper.decodeValue(body, BidRequestVideo.class);\n+            if (bidRequestVideo.getDevice() == null) {\n+                bidRequestVideo = bidRequestVideo.toBuilder().device(Device.builder().build()).build();\n+            }\n+            if (StringUtils.isEmpty(bidRequestVideo.getDevice().getUa())) {\n+                final String userAgentHeader = context.request().getHeader(HttpUtil.USER_AGENT_HEADER);\n+                if (StringUtils.isEmpty(userAgentHeader)) {\n+                    throw new InvalidRequestException(\"Device.UA and User-Agent Header is not presented\");\n+                }\n+                bidRequestVideo = bidRequestVideo.toBuilder()\n+                        .device(bidRequestVideo.getDevice().toBuilder()\n+                                .ua(userAgentHeader)\n+                                .build())\n+                        .build();\n+            }\n+            return bidRequestVideo;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "9640b9068b14f6d83215b8eae6e0ea8572ab0e33"}, "originalPosition": 36}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjQ3NTY0NzM3OnYy", "diffSide": "RIGHT", "path": "src/test/java/org/prebid/server/auction/VideoRequestFactoryTest.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yN1QxNDo0NDo0NlrOF80Vww==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yN1QxNDo0NDo0NlrOF80Vww==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5OTMxNjQxOQ==", "bodyText": "check style", "url": "https://github.com/prebid/prebid-server-java/pull/644#discussion_r399316419", "createdAt": "2020-03-27T14:44:46Z", "author": {"login": "DGarbar"}, "path": "src/test/java/org/prebid/server/auction/VideoRequestFactoryTest.java", "diffHunk": "@@ -29,15 +30,14 @@\n import org.prebid.server.proto.openrtb.ext.request.ExtRequestPrebidCache;\n import org.prebid.server.proto.openrtb.ext.request.ExtRequestPrebidCacheVastxml;\n import org.prebid.server.proto.openrtb.ext.request.ExtRequestTargeting;\n+import org.prebid.server.util.HttpUtil;\n \n import java.util.Arrays;\n \n import static java.util.Collections.emptySet;\n import static java.util.Collections.singletonList;\n import static org.assertj.core.api.Assertions.assertThat;\n-import static org.mockito.ArgumentMatchers.any;\n-import static org.mockito.ArgumentMatchers.anyLong;\n-import static org.mockito.ArgumentMatchers.anyString;\n+import static org.mockito.ArgumentMatchers.*;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "9640b9068b14f6d83215b8eae6e0ea8572ab0e33"}, "originalPosition": 22}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4177, "cost": 1, "resetAt": "2021-11-13T12:26:42Z"}}}