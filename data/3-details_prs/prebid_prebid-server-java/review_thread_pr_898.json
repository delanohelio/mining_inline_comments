{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDc5OTAyMjA2", "number": 898, "reviewThreads": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yMlQxNDozNzowN1rOEmHd8A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yM1QxMDoxMzo1MlrOEmft-A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzA4NDAzNjk2OnYy", "diffSide": "RIGHT", "path": "src/main/java/org/prebid/server/bidder/gumgum/GumgumBidder.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yMlQxNDozNzowN1rOHV9XJQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yMlQxNDozNzowN1rOHV9XJQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5Mjc4NzQ5Mw==", "bodyText": "Seems we need builder for video.\nUsually, creating of builder is expensive operation for performance, pls avoid if possible.", "url": "https://github.com/prebid/prebid-server-java/pull/898#discussion_r492787493", "createdAt": "2020-09-22T14:37:07Z", "author": {"login": "rpanchyk"}, "path": "src/main/java/org/prebid/server/bidder/gumgum/GumgumBidder.java", "diffHunk": "@@ -138,26 +154,47 @@ private static Site modifySite(Site site, String trackingId) {\n     public Result<List<BidderBid>> makeBids(HttpCall<BidRequest> httpCall, BidRequest bidRequest) {\n         try {\n             final BidResponse bidResponse = mapper.decodeValue(httpCall.getResponse().getBody(), BidResponse.class);\n-            return Result.of(extractBids(bidResponse), Collections.emptyList());\n+            return Result.of(extractBids(bidResponse, bidRequest), Collections.emptyList());\n         } catch (DecodeException | PreBidException e) {\n             return Result.emptyWithError(BidderError.badServerResponse(e.getMessage()));\n         }\n     }\n \n-    private static List<BidderBid> extractBids(BidResponse bidResponse) {\n+    private static List<BidderBid> extractBids(BidResponse bidResponse, BidRequest bidRequest) {\n         return bidResponse == null || bidResponse.getSeatbid() == null\n                 ? Collections.emptyList()\n-                : bidsFromResponse(bidResponse);\n+                : bidsFromResponse(bidResponse, bidRequest);\n     }\n \n-    private static List<BidderBid> bidsFromResponse(BidResponse bidResponse) {\n+    private static List<BidderBid> bidsFromResponse(BidResponse bidResponse, BidRequest bidRequest) {\n         return bidResponse.getSeatbid().stream()\n                 .map(SeatBid::getBid)\n                 .flatMap(Collection::stream)\n-                .map(bid -> BidderBid.of(bid, BidType.banner, DEFAULT_BID_CURRENCY))\n+                .map(bid -> toBidderBid(bid, bidRequest, bidResponse.getCur()))\n                 .collect(Collectors.toList());\n     }\n \n+    private static BidderBid toBidderBid(Bid bid, BidRequest bidRequest, String currency) {\n+        final BidType bidType = getMediaType(bid.getImpid(), bidRequest.getImp());\n+        final Bid.BidBuilder bidBuilder = bid.toBuilder();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "6ec69a2a33b579279f9c044ace7578ca938ce7af"}, "originalPosition": 88}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzA4NDg1NTE2OnYy", "diffSide": "RIGHT", "path": "src/main/java/org/prebid/server/bidder/gumgum/GumgumBidder.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yMlQxNzozODoxNVrOHWFSVA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yMlQxNzozODoxNVrOHWFSVA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MjkxNzMzMg==", "bodyText": "What is happen if the field will be null?\nSeems we need to fix the case for all mentioned fields here.", "url": "https://github.com/prebid/prebid-server-java/pull/898#discussion_r492917332", "createdAt": "2020-09-22T17:38:15Z", "author": {"login": "rpanchyk"}, "path": "src/main/java/org/prebid/server/bidder/gumgum/GumgumBidder.java", "diffHunk": "@@ -127,6 +135,13 @@ private static Imp modifyImp(Imp imp) {\n         return imp;\n     }\n \n+    private void validateVideoParams(Video video) {\n+        if (video.getW() == 0 || video.getH() == 0 || video.getMinduration() == 0 || video.getMaxduration() == 0", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "af619d3d4b4a1f4dc2b698b06cf38329b13f3bc3"}, "originalPosition": 43}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzA4NDg1ODA5OnYy", "diffSide": "RIGHT", "path": "src/main/java/org/prebid/server/bidder/gumgum/GumgumBidder.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yMlQxNzozOTowNVrOHWFUPA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yMlQxNzozOTowNVrOHWFUPA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MjkxNzgyMA==", "bodyText": "Pls combine this condition with upper one.", "url": "https://github.com/prebid/prebid-server-java/pull/898#discussion_r492917820", "createdAt": "2020-09-22T17:39:05Z", "author": {"login": "rpanchyk"}, "path": "src/main/java/org/prebid/server/bidder/gumgum/GumgumBidder.java", "diffHunk": "@@ -138,26 +153,45 @@ private static Site modifySite(Site site, String trackingId) {\n     public Result<List<BidderBid>> makeBids(HttpCall<BidRequest> httpCall, BidRequest bidRequest) {\n         try {\n             final BidResponse bidResponse = mapper.decodeValue(httpCall.getResponse().getBody(), BidResponse.class);\n-            return Result.of(extractBids(bidResponse), Collections.emptyList());\n+            return Result.of(extractBids(bidResponse, bidRequest), Collections.emptyList());\n         } catch (DecodeException | PreBidException e) {\n             return Result.emptyWithError(BidderError.badServerResponse(e.getMessage()));\n         }\n     }\n \n-    private static List<BidderBid> extractBids(BidResponse bidResponse) {\n+    private static List<BidderBid> extractBids(BidResponse bidResponse, BidRequest bidRequest) {\n         return bidResponse == null || bidResponse.getSeatbid() == null\n                 ? Collections.emptyList()\n-                : bidsFromResponse(bidResponse);\n+                : bidsFromResponse(bidResponse, bidRequest);\n     }\n \n-    private static List<BidderBid> bidsFromResponse(BidResponse bidResponse) {\n+    private static List<BidderBid> bidsFromResponse(BidResponse bidResponse, BidRequest bidRequest) {\n         return bidResponse.getSeatbid().stream()\n                 .map(SeatBid::getBid)\n                 .flatMap(Collection::stream)\n-                .map(bid -> BidderBid.of(bid, BidType.banner, DEFAULT_BID_CURRENCY))\n+                .map(bid -> toBidderBid(bid, bidRequest, bidResponse.getCur()))\n                 .collect(Collectors.toList());\n     }\n \n+    private static BidderBid toBidderBid(Bid bid, BidRequest bidRequest, String currency) {\n+        final BidType bidType = getMediaType(bid.getImpid(), bidRequest.getImp());\n+        final Bid updatedBid = bidType == BidType.video\n+                ? bid.toBuilder().adm(bid.getAdm().replace(\"${AUCTION_PRICE}\", String.valueOf(bid.getPrice()))).build()\n+                : bid;\n+        return BidderBid.of(updatedBid, bidType, currency);\n+    }\n+\n+    private static BidType getMediaType(String impId, List<Imp> requestImps) {\n+        for (Imp imp : requestImps) {\n+            if (imp.getId().equals(impId)) {\n+                if (imp.getBanner() != null) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "af619d3d4b4a1f4dc2b698b06cf38329b13f3bc3"}, "originalPosition": 92}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzA4ODAxMDE2OnYy", "diffSide": "RIGHT", "path": "src/main/java/org/prebid/server/bidder/gumgum/GumgumBidder.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yM1QxMDoxMzo1MlrOHWjXHw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yM1QxMDoxMzo1MlrOHWjXHw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MzQxMDA3OQ==", "bodyText": "It is to cryptic to see. May be it will be better to add universal method like positiveOrNull(..) for each param.\nThen in condition below we can compare with NULL only.", "url": "https://github.com/prebid/prebid-server-java/pull/898#discussion_r493410079", "createdAt": "2020-09-23T10:13:52Z", "author": {"login": "rpanchyk"}, "path": "src/main/java/org/prebid/server/bidder/gumgum/GumgumBidder.java", "diffHunk": "@@ -127,6 +135,20 @@ private static Imp modifyImp(Imp imp) {\n         return imp;\n     }\n \n+    private void validateVideoParams(Video video) {\n+        final Integer w = video.getW();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "18fdab628e59205f1eeb98975f8fd7525c3c4f6a"}, "originalPosition": 43}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3882, "cost": 1, "resetAt": "2021-11-13T12:26:42Z"}}}