{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTI1NTcxOTY3", "number": 1281, "title": "Have StrictScopeDecorator also detect leaked to GC scopes.", "bodyText": "With all the thought I've had to put into context leakage lately, I thought it could be nice to have StrictScopeDecorator detect GC leaked scopes too, for enabling on a staging server. What do you think?", "createdAt": "2020-11-23T09:01:12Z", "url": "https://github.com/openzipkin/brave/pull/1281", "merged": true, "mergeCommit": {"oid": "073b9e4698c8e3e5397279e37d3416fd915d6cd8"}, "closed": true, "closedAt": "2020-11-24T03:50:55Z", "author": {"login": "anuraaga"}, "timelineItems": {"totalCount": 9, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdfRVasAH2gAyNTI1NTcxOTY3OjgwNDE3NjQ5NTY4NzkzMjMzZTQzOTg4YWQ4OWZlODc3OWRkNzI2NWQ=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdfhgBiAFqTUzNzA1ODAwNg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "80417649568793233e43988ad89fe8779dd7265d", "author": {"user": {"login": "anuraaga", "name": "Anuraag Agrawal"}}, "url": "https://github.com/openzipkin/brave/commit/80417649568793233e43988ad89fe8779dd7265d", "committedDate": "2020-11-23T09:00:40Z", "message": "Have StrictScopeDecorator also detect leaked to GC scopes."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTM2MzI1MTYw", "url": "https://github.com/openzipkin/brave/pull/1281#pullrequestreview-536325160", "createdAt": "2020-11-23T10:07:55Z", "commit": {"oid": "80417649568793233e43988ad89fe8779dd7265d"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0yM1QxMDowNzo1NlrOH4GmOg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0yM1QxMDowNzo1NlrOH4GmOg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyODU5MDM5NA==", "bodyText": "I might suggest having the WeakConcurrentMap type be an inner class vs leaking it in the signature\nIf you have more time, bonus points to see if upstream works now (including shading it). I think raphael changed it to allow our features to work.", "url": "https://github.com/openzipkin/brave/pull/1281#discussion_r528590394", "createdAt": "2020-11-23T10:07:56Z", "author": {"login": "codefromthecrypt"}, "path": "brave/src/main/java/brave/propagation/StrictScopeDecorator.java", "diffHunk": "@@ -40,13 +40,11 @@\n  * }</pre>\n  */\n // Closeable so things like Spring will automatically execute it on shutdown and expose leaks!\n-public final class StrictScopeDecorator implements ScopeDecorator, Closeable {\n+public final class StrictScopeDecorator extends WeakConcurrentMap<Scope, CallerStackTrace> implements ScopeDecorator, Closeable {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "80417649568793233e43988ad89fe8779dd7265d"}, "originalPosition": 22}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "9595ab1048f2a364b1d9d0dea5c396c9265ab598", "author": {"user": {"login": "anuraaga", "name": "Anuraag Agrawal"}}, "url": "https://github.com/openzipkin/brave/commit/9595ab1048f2a364b1d9d0dea5c396c9265ab598", "committedDate": "2020-11-24T02:54:25Z", "message": "Don't extend WeakConcurrentMap in public type."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "3b573a127723bb96502472c49aeb97ddc962fb0b", "author": {"user": {"login": "anuraaga", "name": "Anuraag Agrawal"}}, "url": "https://github.com/openzipkin/brave/commit/3b573a127723bb96502472c49aeb97ddc962fb0b", "committedDate": "2020-11-24T02:55:44Z", "message": "Revert drift"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTM3MDM5ODcw", "url": "https://github.com/openzipkin/brave/pull/1281#pullrequestreview-537039870", "createdAt": "2020-11-24T02:56:19Z", "commit": {"oid": "3b573a127723bb96502472c49aeb97ddc962fb0b"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0yNFQwMjo1NjoyMFrOH4p4Hg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0yNFQwMjo1NjoyMFrOH4p4Hg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyOTE2ODQxNA==", "bodyText": "Added an iterator method to match upstream (instead of my previous approach of the protected field which stopped being feasible)", "url": "https://github.com/openzipkin/brave/pull/1281#discussion_r529168414", "createdAt": "2020-11-24T02:56:20Z", "author": {"login": "anuraaga"}, "path": "brave/src/main/java/brave/internal/collect/WeakConcurrentMap.java", "diffHunk": "@@ -66,6 +69,12 @@\n     return target.remove(key);\n   }\n \n+  /** Iterates over the entries in this map. */\n+  @Override\n+  public Iterator<Map.Entry<K, V>> iterator() {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "3b573a127723bb96502472c49aeb97ddc962fb0b"}, "originalPosition": 33}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "6ee21d8d430c37d6e01407a51cfd571c104a33cc", "author": {"user": {"login": "anuraaga", "name": "Anuraag Agrawal"}}, "url": "https://github.com/openzipkin/brave/commit/6ee21d8d430c37d6e01407a51cfd571c104a33cc", "committedDate": "2020-11-24T03:01:34Z", "message": "Iterable now"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTM3MDQyMzI5", "url": "https://github.com/openzipkin/brave/pull/1281#pullrequestreview-537042329", "createdAt": "2020-11-24T03:02:53Z", "commit": {"oid": "6ee21d8d430c37d6e01407a51cfd571c104a33cc"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0yNFQwMzowMjo1M1rOH4qAcg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0yNFQwMzowMjo1M1rOH4qAcg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyOTE3MDU0Ng==", "bodyText": "Assertion changed from ObjectAssert to ListAssert. Other ways to fix\n\nDon't implement Iterable in WeakConcurrentMap\nStop extending WeakConcurrentMap in PendingSpans\n\nCould do now or in the future when integrating upstream's library in.", "url": "https://github.com/openzipkin/brave/pull/1281#discussion_r529170546", "createdAt": "2020-11-24T03:02:53Z", "author": {"login": "anuraaga"}, "path": "brave/src/test/java/brave/TracingTest.java", "diffHunk": "@@ -112,7 +112,7 @@\n \n   @Test public void spanHandler_loggingByDefault() {\n     try (Tracing tracing = Tracing.newBuilder().build()) {\n-      assertThat(tracing.tracer().pendingSpans).extracting(\"spanHandler.delegate\")\n+      assertThat((Object) tracing.tracer().pendingSpans).extracting(\"spanHandler.delegate\")", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "6ee21d8d430c37d6e01407a51cfd571c104a33cc"}, "originalPosition": 5}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d66454dc1ea7a7884e68094ace2f0eed34710b80", "author": {"user": {"login": "anuraaga", "name": "Anuraag Agrawal"}}, "url": "https://github.com/openzipkin/brave/commit/d66454dc1ea7a7884e68094ace2f0eed34710b80", "committedDate": "2020-11-24T03:05:59Z", "message": "foo"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTM3MDU4MDA2", "url": "https://github.com/openzipkin/brave/pull/1281#pullrequestreview-537058006", "createdAt": "2020-11-24T03:50:44Z", "commit": {"oid": "d66454dc1ea7a7884e68094ace2f0eed34710b80"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1814, "cost": 1, "resetAt": "2021-11-01T15:33:45Z"}}}