{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0Mzc4NjQ0MzY1", "number": 1091, "reviewThreads": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yM1QwMjo1MTozNVrODiHpoQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yM1QwMjo1MzoyMFrODiHp0A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjM3MTAzNTIxOnYy", "diffSide": "RIGHT", "path": "instrumentation/http/src/main/java/brave/http/HttpAdapter.java", "isResolved": true, "comments": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yM1QwMjo1MTozNVrOFtN9ng==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yM1QwMzo0ODozOVrOFtOGuA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4Mjk1OTAwNg==", "bodyText": "Agree that HTTP spec doesn't actually require a path (OPTIONS commonly has * which I don't know if we call a path, CONNECT has only authority). So nullable seems fine.\nBut not so sympathetic with the availability bug issue - seems like bad http library as opposed to bad instrumentation, not sure if that specifically should fall into our defensive requirements.", "url": "https://github.com/openzipkin/brave/pull/1091#discussion_r382959006", "createdAt": "2020-02-23T02:51:35Z", "author": {"login": "anuraaga"}, "path": "instrumentation/http/src/main/java/brave/http/HttpAdapter.java", "diffHunk": "@@ -19,7 +19,7 @@\n /** @deprecated Since 5.10, use {@link HttpRequest} and {@link HttpResponse} */\n @Deprecated public abstract class HttpAdapter<Req, Resp> {\n   /** @see HttpRequest#method() */\n-  @Nullable public abstract String method(Req request);\n+  public abstract String method(Req request);\n \n   /** @see HttpRequest#path() */\n   @Nullable public String path(Req request) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d49072222eb1ef7590e30f4d313dcf66c63cba92"}, "originalPosition": 8}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4Mjk2MDUwNg==", "bodyText": "This was one example of path missing, something from last week, not the only time.\nI think it is wise to be cautious as instrumentation should do no harm. Users can't always control versions of things and for example, even in armeria there are availability checks to prevent a known class of bugs. I don't expect you to agree with me but I disagree that we should just trust path will exist and anything that causes it not to be should crash requests.", "url": "https://github.com/openzipkin/brave/pull/1091#discussion_r382960506", "createdAt": "2020-02-23T03:28:45Z", "author": {"login": "codefromthecrypt"}, "path": "instrumentation/http/src/main/java/brave/http/HttpAdapter.java", "diffHunk": "@@ -19,7 +19,7 @@\n /** @deprecated Since 5.10, use {@link HttpRequest} and {@link HttpResponse} */\n @Deprecated public abstract class HttpAdapter<Req, Resp> {\n   /** @see HttpRequest#method() */\n-  @Nullable public abstract String method(Req request);\n+  public abstract String method(Req request);\n \n   /** @see HttpRequest#path() */\n   @Nullable public String path(Req request) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4Mjk1OTAwNg=="}, "originalCommit": {"oid": "d49072222eb1ef7590e30f4d313dcf66c63cba92"}, "originalPosition": 8}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4Mjk2MDk1OA==", "bodyText": "I reworded the javadoc towards the method rationale without suggesting that's the only reason why. The other reasons could be in the class of parse failures, or availability drift outside our control, but IMHO shouldn't cause requests to crash. hope the words balance!", "url": "https://github.com/openzipkin/brave/pull/1091#discussion_r382960958", "createdAt": "2020-02-23T03:39:34Z", "author": {"login": "codefromthecrypt"}, "path": "instrumentation/http/src/main/java/brave/http/HttpAdapter.java", "diffHunk": "@@ -19,7 +19,7 @@\n /** @deprecated Since 5.10, use {@link HttpRequest} and {@link HttpResponse} */\n @Deprecated public abstract class HttpAdapter<Req, Resp> {\n   /** @see HttpRequest#method() */\n-  @Nullable public abstract String method(Req request);\n+  public abstract String method(Req request);\n \n   /** @see HttpRequest#path() */\n   @Nullable public String path(Req request) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4Mjk1OTAwNg=="}, "originalCommit": {"oid": "d49072222eb1ef7590e30f4d313dcf66c63cba92"}, "originalPosition": 8}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4Mjk2MDk4Mg==", "bodyText": "concretely, if we \"fixed path\" now, we'd definitely blow up former versions of instrumentation, causing revlock.", "url": "https://github.com/openzipkin/brave/pull/1091#discussion_r382960982", "createdAt": "2020-02-23T03:40:32Z", "author": {"login": "codefromthecrypt"}, "path": "instrumentation/http/src/main/java/brave/http/HttpAdapter.java", "diffHunk": "@@ -19,7 +19,7 @@\n /** @deprecated Since 5.10, use {@link HttpRequest} and {@link HttpResponse} */\n @Deprecated public abstract class HttpAdapter<Req, Resp> {\n   /** @see HttpRequest#method() */\n-  @Nullable public abstract String method(Req request);\n+  public abstract String method(Req request);\n \n   /** @see HttpRequest#path() */\n   @Nullable public String path(Req request) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4Mjk1OTAwNg=="}, "originalCommit": {"oid": "d49072222eb1ef7590e30f4d313dcf66c63cba92"}, "originalPosition": 8}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4Mjk2MTMzNg==", "bodyText": "PS I'd be fine with forcing path to be present on the methods relevant in a major release. We'd just know this would invalidate third party stuff and they'd get revlocked to the old one, causing the old version to need patches in worst case. Not signing up for that work personally, but agree in a green field or known break scenario stricter rules could apply.", "url": "https://github.com/openzipkin/brave/pull/1091#discussion_r382961336", "createdAt": "2020-02-23T03:48:39Z", "author": {"login": "codefromthecrypt"}, "path": "instrumentation/http/src/main/java/brave/http/HttpAdapter.java", "diffHunk": "@@ -19,7 +19,7 @@\n /** @deprecated Since 5.10, use {@link HttpRequest} and {@link HttpResponse} */\n @Deprecated public abstract class HttpAdapter<Req, Resp> {\n   /** @see HttpRequest#method() */\n-  @Nullable public abstract String method(Req request);\n+  public abstract String method(Req request);\n \n   /** @see HttpRequest#path() */\n   @Nullable public String path(Req request) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4Mjk1OTAwNg=="}, "originalCommit": {"oid": "d49072222eb1ef7590e30f4d313dcf66c63cba92"}, "originalPosition": 8}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjM3MTAzNTY4OnYy", "diffSide": "RIGHT", "path": "instrumentation/http/src/main/java/brave/http/HttpRequestParser.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yM1QwMjo1MzoyMFrOFtN93Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yM1QwMzozMDoxMlrOFtODsA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4Mjk1OTA2OQ==", "bodyText": "Think we can remove this null check (it's the one I most wanted to remove since it's the span name :) ).\nBut if you think we need it I guess we are missing @Nullable on the protected spanName method.", "url": "https://github.com/openzipkin/brave/pull/1091#discussion_r382959069", "createdAt": "2020-02-23T02:53:20Z", "author": {"login": "anuraaga"}, "path": "instrumentation/http/src/main/java/brave/http/HttpRequestParser.java", "diffHunk": "@@ -62,8 +62,7 @@\n     @Override public void parse(HttpRequest req, TraceContext context, SpanCustomizer span) {\n       String name = spanName(req, context);\n       if (name != null) span.name(name);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d49072222eb1ef7590e30f4d313dcf66c63cba92"}, "originalPosition": 3}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4Mjk2MDU2MA==", "bodyText": "I can fix the lack of nullable", "url": "https://github.com/openzipkin/brave/pull/1091#discussion_r382960560", "createdAt": "2020-02-23T03:30:12Z", "author": {"login": "codefromthecrypt"}, "path": "instrumentation/http/src/main/java/brave/http/HttpRequestParser.java", "diffHunk": "@@ -62,8 +62,7 @@\n     @Override public void parse(HttpRequest req, TraceContext context, SpanCustomizer span) {\n       String name = spanName(req, context);\n       if (name != null) span.name(name);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4Mjk1OTA2OQ=="}, "originalCommit": {"oid": "d49072222eb1ef7590e30f4d313dcf66c63cba92"}, "originalPosition": 3}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1528, "cost": 1, "resetAt": "2021-11-13T12:10:21Z"}}}