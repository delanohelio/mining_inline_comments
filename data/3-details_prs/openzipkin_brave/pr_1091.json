{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0Mzc4NjQ0MzY1", "number": 1091, "title": "Makes HTTP request method mandatory", "bodyText": "While all other properties can be absent or invalid, this makes the HTTP\nmethod mandatory. This will help when we create a path to the request\nfrom the response, as it allows chaining to the method without a null\ncheck.\nNote: Eventhough we've seen method incorrectly set in the past,\nwe've never seen it missing.\nPS: While it seems path would also always be available even recently,\nit isn't valid for all HTTP methods (ex OPTIONS and CONNECT). Also,\nit can be null due to bad parsing (ex some things don't natively return\nthe path, only the URL). Also, it has been found missing before, most\nrecently due to a request availablility bug which is still not released! If we started enforcing path be present, it\nwould force a known set of scenarios to NPE causing people who can't\nchange their implementations to become revlocked until they can. This\nmakes forcing path to be not nullable, so late in the game, to be a cure\nworse than the disease.\nFixes #1089", "createdAt": "2020-02-23T00:01:05Z", "url": "https://github.com/openzipkin/brave/pull/1091", "merged": true, "mergeCommit": {"oid": "df7506bcc3ef071ab1f5e4bb7da478e911a15ec5"}, "closed": true, "closedAt": "2020-02-23T05:11:31Z", "author": {"login": "codefromthecrypt"}, "timelineItems": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcG9U2wgH2gAyMzc4NjQ0MzY1OmQ0OTA3MjIyMmViMWVmNzU5MGUzMGY0ZDMxM2RjZjY2YzYzY2JhOTI=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcHBBB_gH2gAyMzc4NjQ0MzY1OjY1NjQ3ZTZmYzNhZjlhZDVmYTJkY2ZjOTc5ZjE4Njc0OGYzOGNhMDU=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "d49072222eb1ef7590e30f4d313dcf66c63cba92", "author": {"user": null}, "url": "https://github.com/openzipkin/brave/commit/d49072222eb1ef7590e30f4d313dcf66c63cba92", "committedDate": "2020-02-22T23:56:37Z", "message": "Makes HTTP request method mandatory\n\nWhile all other properties can be absent or invalid, this makes the HTTP\nmethod mandatory. This will help when we create a path to the request\nfrom the response, as it allows chaining to the method without a null\ncheck.\n\nNote: while it seems path would also always be available even recently,\nit has been found missing due to a [request availablility bug](https://github.com/reactor/reactor-netty/pull/998). Eventhough we've seen method incorrectly set in the past,\nwe've never seen it missing.\n\nFixes #1089"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzYzMDYyNDEy", "url": "https://github.com/openzipkin/brave/pull/1091#pullrequestreview-363062412", "createdAt": "2020-02-23T02:51:35Z", "commit": {"oid": "d49072222eb1ef7590e30f4d313dcf66c63cba92"}, "state": "APPROVED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yM1QwMjo1MTozNVrOFtN9ng==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yM1QwMjo1MzoyMFrOFtN93Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4Mjk1OTAwNg==", "bodyText": "Agree that HTTP spec doesn't actually require a path (OPTIONS commonly has * which I don't know if we call a path, CONNECT has only authority). So nullable seems fine.\nBut not so sympathetic with the availability bug issue - seems like bad http library as opposed to bad instrumentation, not sure if that specifically should fall into our defensive requirements.", "url": "https://github.com/openzipkin/brave/pull/1091#discussion_r382959006", "createdAt": "2020-02-23T02:51:35Z", "author": {"login": "anuraaga"}, "path": "instrumentation/http/src/main/java/brave/http/HttpAdapter.java", "diffHunk": "@@ -19,7 +19,7 @@\n /** @deprecated Since 5.10, use {@link HttpRequest} and {@link HttpResponse} */\n @Deprecated public abstract class HttpAdapter<Req, Resp> {\n   /** @see HttpRequest#method() */\n-  @Nullable public abstract String method(Req request);\n+  public abstract String method(Req request);\n \n   /** @see HttpRequest#path() */\n   @Nullable public String path(Req request) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d49072222eb1ef7590e30f4d313dcf66c63cba92"}, "originalPosition": 8}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4Mjk1OTA2OQ==", "bodyText": "Think we can remove this null check (it's the one I most wanted to remove since it's the span name :) ).\nBut if you think we need it I guess we are missing @Nullable on the protected spanName method.", "url": "https://github.com/openzipkin/brave/pull/1091#discussion_r382959069", "createdAt": "2020-02-23T02:53:20Z", "author": {"login": "anuraaga"}, "path": "instrumentation/http/src/main/java/brave/http/HttpRequestParser.java", "diffHunk": "@@ -62,8 +62,7 @@\n     @Override public void parse(HttpRequest req, TraceContext context, SpanCustomizer span) {\n       String name = spanName(req, context);\n       if (name != null) span.name(name);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d49072222eb1ef7590e30f4d313dcf66c63cba92"}, "originalPosition": 3}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "590a7d2f9277705062049e66c5c9c135a7d48cd1", "author": {"user": null}, "url": "https://github.com/openzipkin/brave/commit/590a7d2f9277705062049e66c5c9c135a7d48cd1", "committedDate": "2020-02-23T03:32:26Z", "message": "missing nullable"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "27077303d93b008bf231556289a8e384f12a6826", "author": {"user": null}, "url": "https://github.com/openzipkin/brave/commit/27077303d93b008bf231556289a8e384f12a6826", "committedDate": "2020-02-23T03:38:04Z", "message": "reword"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "65647e6fc3af9ad5fa2dcfc979f186748f38ca05", "author": {"user": null}, "url": "https://github.com/openzipkin/brave/commit/65647e6fc3af9ad5fa2dcfc979f186748f38ca05", "committedDate": "2020-02-23T04:14:35Z", "message": "rationale"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1845, "cost": 1, "resetAt": "2021-11-01T15:33:45Z"}}}