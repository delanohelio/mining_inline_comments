{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTA1MzQxNjMy", "number": 1261, "title": "Accept any string as zipkinServiceName parameter.", "bodyText": "While remoteServiceName accepts any string, the jdbc url parameter which provides a way to override it only accepts characters from the word group [a-zA-Z0-9_] this change remove that assumption and capture the complete value of the parameter and it solves a problem that I'm experiencing where in my naming convention (kebab case) is not possible to have the correct value due the presence of dash (-), for example my-database-override results in my as the remoteServiceName.", "createdAt": "2020-10-17T20:20:24Z", "url": "https://github.com/openzipkin/brave/pull/1261", "merged": true, "mergeCommit": {"oid": "0501ffc8b37d6e65749b34f2fd4d5f5ec121f7ef"}, "closed": true, "closedAt": "2020-11-02T11:46:56Z", "author": {"login": "rgamez"}, "timelineItems": {"totalCount": 6, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdTwrxZgFqTUxMTE1MTU5Mw==", "endCursor": "Y3Vyc29yOnYyOpPPAAABdUL7rwABqjM4OTU3NzY2MzY=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTExMTUxNTkz", "url": "https://github.com/openzipkin/brave/pull/1261#pullrequestreview-511151593", "createdAt": "2020-10-18T14:45:02Z", "commit": {"oid": "ea64ebb50a17562c72c55228b3686e9c883e4c9a"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xOFQxNDo0NTowM1rOHjrTuA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xOFQxNDo0NTowM1rOHjrTuA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNzE3MTc2OA==", "bodyText": "Could you maybe add a small comment what the regex is aiming to match ? Not everyone can work it out from the top of their head.", "url": "https://github.com/openzipkin/brave/pull/1261#discussion_r507171768", "createdAt": "2020-10-18T14:45:03Z", "author": {"login": "jorgheymans"}, "path": "instrumentation/p6spy/src/main/java/brave/p6spy/TracingJdbcEventListener.java", "diffHunk": "@@ -30,7 +30,7 @@\n final class TracingJdbcEventListener extends SimpleJdbcEventListener {\n \n   private static final Pattern URL_SERVICE_NAME_FINDER =\n-    Pattern.compile(\"zipkinServiceName=(\\\\w*)\");\n+    Pattern.compile(\"zipkinServiceName=(.*?)(?:&|$)\");", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ea64ebb50a17562c72c55228b3686e9c883e4c9a"}, "originalPosition": 5}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTExMTUxOTM3", "url": "https://github.com/openzipkin/brave/pull/1261#pullrequestreview-511151937", "createdAt": "2020-10-18T14:49:10Z", "commit": {"oid": "ea64ebb50a17562c72c55228b3686e9c883e4c9a"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "ea64ebb50a17562c72c55228b3686e9c883e4c9a", "author": {"user": null}, "url": "https://github.com/openzipkin/brave/commit/ea64ebb50a17562c72c55228b3686e9c883e4c9a", "committedDate": "2020-10-17T20:10:09Z", "message": "Accept any string as zipkinServiceName parameter.\n\nAligns it with remoteServiceName that accepts any arbitrary string."}, "afterCommit": {"oid": "e2c534fc96e9a43837b72b647551c7214460804a", "author": {"user": {"login": "rgamez", "name": "Ruben Gamez"}}, "url": "https://github.com/openzipkin/brave/commit/e2c534fc96e9a43837b72b647551c7214460804a", "committedDate": "2020-10-18T18:20:37Z", "message": "Accept any string as zipkinServiceName parameter.\n\nAligns it with remoteServiceName that accepts any arbitrary string."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTExMjgxMTQ3", "url": "https://github.com/openzipkin/brave/pull/1261#pullrequestreview-511281147", "createdAt": "2020-10-18T23:35:00Z", "commit": {"oid": "e2c534fc96e9a43837b72b647551c7214460804a"}, "state": "COMMENTED", "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xOFQyMzozNTowMFrOHjwY3g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xOFQyMzozNjozMlrOHjwbhQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNzI1NTAwNg==", "bodyText": "this dep hasn't been updated since 2017, so might haunt us later. you mind switching to just using a map and calling a method not marked test for each pair here?", "url": "https://github.com/openzipkin/brave/pull/1261#discussion_r507255006", "createdAt": "2020-10-18T23:35:00Z", "author": {"login": "codefromthecrypt"}, "path": "instrumentation/p6spy/src/test/java/brave/p6spy/TracingJdbcEventListenerTest.java", "diffHunk": "@@ -121,6 +128,34 @@\n     verify(span).remoteIpAndPort(\"1.2.3.4\", 5555);\n   }\n \n+  @Test\n+  @TestCaseName(\"remoteServiceName should be '{1}'\")\n+  @Parameters({", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e2c534fc96e9a43837b72b647551c7214460804a"}, "originalPosition": 36}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNzI1NTI5Nw==", "bodyText": "empty should coerce to null, not \"default\" IMHO", "url": "https://github.com/openzipkin/brave/pull/1261#discussion_r507255297", "createdAt": "2020-10-18T23:35:41Z", "author": {"login": "codefromthecrypt"}, "path": "instrumentation/p6spy/src/test/java/brave/p6spy/TracingJdbcEventListenerTest.java", "diffHunk": "@@ -121,6 +128,34 @@\n     verify(span).remoteIpAndPort(\"1.2.3.4\", 5555);\n   }\n \n+  @Test\n+  @TestCaseName(\"remoteServiceName should be '{1}'\")\n+  @Parameters({\n+    \"?zipkinServiceName=myDatabase&foo=bar, myDatabase\",\n+    \"?zipkinServiceName=my_database&foo=bar, my_database\",\n+    \"?zipkinServiceName=my-database&foo=bar, my-database\",\n+    \"?zipkinServiceName=my-database-1&foo=bar, my-database-1\",\n+    \"?zipkinServiceName=my.database&foo=bar, my.database\",\n+    \"?zipkinServiceName=my.database&foo=bar, my.database\",\n+    \"?zipkinServiceName=my-database:5432&foo=bar, my-database:5432\",\n+    \"?zipkinServiceName=my-database@localhost&foo=bar, my-database@localhost\",\n+    \"?zipkinServiceName=my-database, my-database\",\n+    \"?zipkinServiceName=my-database-1&zipkinServiceName=my-database-2, my-database-1\",\n+    \"?zipkinServiceName=, default\",", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e2c534fc96e9a43837b72b647551c7214460804a"}, "originalPosition": 47}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNzI1NTY4NQ==", "bodyText": "am I reading this carefully? the service name would have a comma in it? that seems odd.. I think we should pick last instead.", "url": "https://github.com/openzipkin/brave/pull/1261#discussion_r507255685", "createdAt": "2020-10-18T23:36:32Z", "author": {"login": "codefromthecrypt"}, "path": "instrumentation/p6spy/src/test/java/brave/p6spy/TracingJdbcEventListenerTest.java", "diffHunk": "@@ -121,6 +128,34 @@\n     verify(span).remoteIpAndPort(\"1.2.3.4\", 5555);\n   }\n \n+  @Test\n+  @TestCaseName(\"remoteServiceName should be '{1}'\")\n+  @Parameters({\n+    \"?zipkinServiceName=myDatabase&foo=bar, myDatabase\",\n+    \"?zipkinServiceName=my_database&foo=bar, my_database\",\n+    \"?zipkinServiceName=my-database&foo=bar, my-database\",\n+    \"?zipkinServiceName=my-database-1&foo=bar, my-database-1\",\n+    \"?zipkinServiceName=my.database&foo=bar, my.database\",\n+    \"?zipkinServiceName=my.database&foo=bar, my.database\",\n+    \"?zipkinServiceName=my-database:5432&foo=bar, my-database:5432\",\n+    \"?zipkinServiceName=my-database@localhost&foo=bar, my-database@localhost\",\n+    \"?zipkinServiceName=my-database, my-database\",\n+    \"?zipkinServiceName=my-database-1&zipkinServiceName=my-database-2, my-database-1\",", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e2c534fc96e9a43837b72b647551c7214460804a"}, "originalPosition": 46}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "419cc0d77dd7ee3e9cecdf1c6e287f56577281b7", "author": {"user": {"login": "rgamez", "name": "Ruben Gamez"}}, "url": "https://github.com/openzipkin/brave/commit/419cc0d77dd7ee3e9cecdf1c6e287f56577281b7", "committedDate": "2020-10-19T22:29:37Z", "message": "Accept any string as zipkinServiceName parameter.\n\nAligns it with remoteServiceName that accepts any arbitrary string."}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "e2c534fc96e9a43837b72b647551c7214460804a", "author": {"user": {"login": "rgamez", "name": "Ruben Gamez"}}, "url": "https://github.com/openzipkin/brave/commit/e2c534fc96e9a43837b72b647551c7214460804a", "committedDate": "2020-10-18T18:20:37Z", "message": "Accept any string as zipkinServiceName parameter.\n\nAligns it with remoteServiceName that accepts any arbitrary string."}, "afterCommit": {"oid": "419cc0d77dd7ee3e9cecdf1c6e287f56577281b7", "author": {"user": {"login": "rgamez", "name": "Ruben Gamez"}}, "url": "https://github.com/openzipkin/brave/commit/419cc0d77dd7ee3e9cecdf1c6e287f56577281b7", "committedDate": "2020-10-19T22:29:37Z", "message": "Accept any string as zipkinServiceName parameter.\n\nAligns it with remoteServiceName that accepts any arbitrary string."}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1794, "cost": 1, "resetAt": "2021-11-01T15:33:45Z"}}}