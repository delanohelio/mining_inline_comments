{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0Mzk2MjA2NTEw", "number": 1132, "title": "Actually don't check SingletonList as comment says.", "bodyText": "Noticed implementation does not reflect the comment \"Faster to make a copy than check the type to see if it is already a singleton list\". I haven't actually benchmarked this but it seems to make sense. Alternatively I can revert the code changes and remove the comment, let me know.\nAdditionally optimizes for an empty mutable list parameter.", "createdAt": "2020-03-31T09:45:35Z", "url": "https://github.com/openzipkin/brave/pull/1132", "merged": true, "mergeCommit": {"oid": "8772a96b08078588d7b9dc0f0933ac6fa3fd5c11"}, "closed": true, "closedAt": "2020-04-01T04:01:08Z", "author": {"login": "anuraaga"}, "timelineItems": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcS_oLAgH2gAyMzk2MjA2NTEwOmRhOTVjYzdlOWMwNjcxMjZhYTg4YWE0MDdkOWJmNDY3MGE1MGNhMjY=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcTAfQZgH2gAyMzk2MjA2NTEwOjc0YWU5NGI1OGJlNmE4YThlMGM5ODY5NjkzNGRiNjJhNjE2ZDUyODU=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "da95cc7e9c067126aa88aa407d9bf4670a50ca26", "author": {"user": {"login": "anuraaga", "name": "Anuraag Agrawal"}}, "url": "https://github.com/openzipkin/brave/commit/da95cc7e9c067126aa88aa407d9bf4670a50ca26", "committedDate": "2020-03-31T09:24:37Z", "message": "Actually don't check SingletonList as comment says."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "31006481f3e876112dffa44265f6d5d0f49f2ac1", "author": {"user": {"login": "anuraaga", "name": "Anuraag Agrawal"}}, "url": "https://github.com/openzipkin/brave/commit/31006481f3e876112dffa44265f6d5d0f49f2ac1", "committedDate": "2020-03-31T10:18:51Z", "message": "License"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzg0NTk0NjYy", "url": "https://github.com/openzipkin/brave/pull/1132#pullrequestreview-384594662", "createdAt": "2020-03-31T10:19:37Z", "commit": {"oid": "31006481f3e876112dffa44265f6d5d0f49f2ac1"}, "state": "APPROVED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0zMVQxMDoxOTozN1rOF-O81Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0zMVQxMDoxOTozN1rOF-O81Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMDgwMDk4MQ==", "bodyText": "that SingletonList isn't here hurts my brain because it is a well known type. that said I understand why you are doing this.. it is under the assumption nothing else is using this method which is fair enough. It might hurt brain less to say intentionally not checking SingletonList due as the only call site wont' have it", "url": "https://github.com/openzipkin/brave/pull/1132#discussion_r400800981", "createdAt": "2020-03-31T10:19:37Z", "author": {"login": "codefromthecrypt"}, "path": "brave/src/main/java/brave/internal/Lists.java", "diffHunk": "@@ -29,19 +29,19 @@\n     return mutable;\n   }\n \n-  public static List<Object> ensureImmutable(List<Object> extra) {\n-    if (isImmutable(extra)) return extra;\n+  public static List<Object> ensureImmutable(List<Object> list) {\n+    if (list.isEmpty()) return Collections.emptyList();\n     // Faster to make a copy than check the type to see if it is already a singleton list\n-    if (extra.size() == 1) return Collections.singletonList(extra.get(0));\n-    return Collections.unmodifiableList(new ArrayList<>(extra));\n+    if (list.size() == 1) return Collections.singletonList(list.get(0));\n+    if (isImmutable(list)) return list;\n+    return Collections.unmodifiableList(new ArrayList<>(list));\n   }\n \n   static boolean isImmutable(List<Object> extra) {\n-    if (extra == Collections.EMPTY_LIST) return true;\n+    if (extra == Collections.emptyList()) return true;\n     // avoid copying datastructure by trusting certain names.\n     String simpleName = extra.getClass().getSimpleName();\n-    return simpleName.equals(\"SingletonList\")", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "31006481f3e876112dffa44265f6d5d0f49f2ac1"}, "originalPosition": 28}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "74ae94b58be6a8a8e0c98696934db62a616d5285", "author": {"user": {"login": "anuraaga", "name": "Anuraag Agrawal"}}, "url": "https://github.com/openzipkin/brave/commit/74ae94b58be6a8a8e0c98696934db62a616d5285", "committedDate": "2020-03-31T10:24:47Z", "message": "Clarify why we don't check type of singleton list"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1907, "cost": 1, "resetAt": "2021-11-01T15:33:45Z"}}}