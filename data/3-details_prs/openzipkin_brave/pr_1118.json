{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0MzkxNzkyMjU4", "number": 1118, "title": "Enforces parent on ITHttpClient.redirect() and other minor issues", "bodyText": "This fixes a bug where httpasyncclient broke trace on redirect. It also fixes some minor issues.\n\nRaises the global timeout to 20s\n\nSee line/armeria#2615\n\n\nDecouples assertions from reporting order\n\nAllows libraries to backdate spans and report in any order\n\n\nFixes some out-of-date links notices when doing above\nEases classpath by decoupling from jetty and okhttp internals", "createdAt": "2020-03-21T00:44:10Z", "url": "https://github.com/openzipkin/brave/pull/1118", "merged": true, "mergeCommit": {"oid": "e89109edec5b33fad1d661d473a0b4bd0d842f20"}, "closed": true, "closedAt": "2020-03-21T11:16:36Z", "author": {"login": "codefromthecrypt"}, "timelineItems": {"totalCount": 11, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcPqKMzAH2gAyMzkxNzkyMjU4OjFkZjMwZDZlMDhlZDg1ODU0ODYzMmE2NmIyZTExNWM2ZDUwZDg4YzA=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcPyXptAH2gAyMzkxNzkyMjU4OjA0YTZhZGQ1MzVhYTE3ZmM1ODgyMDdjNzZiMmY1YWY4MTBhNGYyNzY=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "1df30d6e08ed858548632a66b2e115c6d50d88c0", "author": {"user": null}, "url": "https://github.com/openzipkin/brave/commit/1df30d6e08ed858548632a66b2e115c6d50d88c0", "committedDate": "2020-03-21T00:42:06Z", "message": "Minor improvements to integration tests\n\n * Raises the global timeout to 20s\n  * See https://github.com/line/armeria/pull/2615\n * Decouples assertions from reporting order\n  * Allows libraries to backdate spans and report in any order\n * Fixes some out-of-date links notices when doing above"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "2dd6beec91b5a89453fd3bb74abf14370c259829", "author": {"user": null}, "url": "https://github.com/openzipkin/brave/commit/2dd6beec91b5a89453fd3bb74abf14370c259829", "committedDate": "2020-03-21T00:49:53Z", "message": "polish"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "5b2b860a66515fc1dd3160bc4a4c48aafe25c20e", "author": {"user": null}, "url": "https://github.com/openzipkin/brave/commit/5b2b860a66515fc1dd3160bc4a4c48aafe25c20e", "committedDate": "2020-03-21T01:47:52Z", "message": "refactored to reveal timing problems in redirect"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "aaef72ae835255cb65af812a4d84c64c403f4959", "author": {"user": null}, "url": "https://github.com/openzipkin/brave/commit/aaef72ae835255cb65af812a4d84c64c403f4959", "committedDate": "2020-03-21T01:56:53Z", "message": "whoops"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "6e4a3f87515bb5386631de6f946e5436af2459a5", "author": {"user": null}, "url": "https://github.com/openzipkin/brave/commit/6e4a3f87515bb5386631de6f946e5436af2459a5", "committedDate": "2020-03-21T02:05:29Z", "message": "caught bug in httpasyncclient where redirect breaks trace"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "7e855b607f3b37939daf8da0031e9b4aef627abd", "author": {"user": null}, "url": "https://github.com/openzipkin/brave/commit/7e855b607f3b37939daf8da0031e9b4aef627abd", "committedDate": "2020-03-21T02:08:09Z", "message": "polish"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d16ce26178487724503775d50c68805a5fbaa94e", "author": {"user": null}, "url": "https://github.com/openzipkin/brave/commit/d16ce26178487724503775d50c68805a5fbaa94e", "committedDate": "2020-03-21T02:08:14Z", "message": "fixes redirect bug"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzc4ODgzNDE4", "url": "https://github.com/openzipkin/brave/pull/1118#pullrequestreview-378883418", "createdAt": "2020-03-21T02:09:55Z", "commit": {"oid": "d16ce26178487724503775d50c68805a5fbaa94e"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yMVQwMjowOTo1NVrOF5m-IA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yMVQwMjowOTo1NVrOF5m-IA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NTk1MTY0OA==", "bodyText": "BUG!", "url": "https://github.com/openzipkin/brave/pull/1118#discussion_r395951648", "createdAt": "2020-03-21T02:09:55Z", "author": {"login": "codefromthecrypt"}, "path": "instrumentation/httpasyncclient/src/main/java/brave/httpasyncclient/TracingHttpAsyncClientBuilder.java", "diffHunk": "@@ -76,7 +76,7 @@ public static HttpAsyncClientBuilder create(HttpTracing httpTracing) {\n \n   final class HandleSend implements HttpRequestInterceptor {\n     @Override public void process(HttpRequest request, HttpContext context) {\n-      TraceContext parent = (TraceContext) context.removeAttribute(TraceContext.class.getName());\n+      TraceContext parent = (TraceContext) context.getAttribute(TraceContext.class.getName());", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d16ce26178487724503775d50c68805a5fbaa94e"}, "originalPosition": 5}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzc4ODg5OTA5", "url": "https://github.com/openzipkin/brave/pull/1118#pullrequestreview-378889909", "createdAt": "2020-03-21T03:57:22Z", "commit": {"oid": "d16ce26178487724503775d50c68805a5fbaa94e"}, "state": "APPROVED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yMVQwMzo1NzoyMlrOF5nZtQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yMVQwMzo1NzoyMlrOF5nZtQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NTk1ODcwOQ==", "bodyText": "Either is fine but you could consider e.g. as(\"timestamp\") for some less code  (default fail message will dump it with this tag). A bit different than our other cases where we want to print something other than the asserted value.", "url": "https://github.com/openzipkin/brave/pull/1118#discussion_r395958709", "createdAt": "2020-03-21T03:57:22Z", "author": {"login": "anuraaga"}, "path": "instrumentation/http-tests/src/main/java/brave/test/http/ITHttp.java", "diffHunk": "@@ -142,6 +145,15 @@ private Span doTakeSpan() throws InterruptedException {\n     assertThat(result)\n       .withFailMessage(\"Span was not reported\")\n       .isNotNull();\n+\n+    assertThat(result.timestampAsLong())\n+      .withFailMessage(\"Expected a timestamp: %s\", result)", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d16ce26178487724503775d50c68805a5fbaa94e"}, "originalPosition": 19}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d13f62c3d841a05b351de5cbb403a3cbc709cf8f", "author": {"user": null}, "url": "https://github.com/openzipkin/brave/commit/d13f62c3d841a05b351de5cbb403a3cbc709cf8f", "committedDate": "2020-03-21T09:30:29Z", "message": "don't require jetty"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "04a6add535aa17fc588207c76b2f5af810a4f276", "author": {"user": null}, "url": "https://github.com/openzipkin/brave/commit/04a6add535aa17fc588207c76b2f5af810a4f276", "committedDate": "2020-03-21T10:16:02Z", "message": "don't use internal types"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1879, "cost": 1, "resetAt": "2021-11-01T15:33:45Z"}}}