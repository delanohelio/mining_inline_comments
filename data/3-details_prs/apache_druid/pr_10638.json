{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTMyNzgxMzc0", "number": 10638, "title": "Integration tests: update base image for hadoop containers to centos:7", "bodyText": "Fixes the issue of builds were getting stuck\n\nDescription\nSince centos:6.5 has ended his lifetime: https://wiki.centos.org/About/Product, docker_build_containers.sh failed building druid/cluster image and didn't start build druid-it/hadoop:2.8.5 which caused prompt from docker-compose command and build was getting stuck:\nThe image for the service you're trying to recreate has been removed. If you continue, volume data could be lost. Consider backing up your data before continuing.\n\nChanges:\nadded set -e flag in docker_build_containers.sh so script should fail if some of commands failed\nchange base image to centos:7", "createdAt": "2020-12-04T20:52:14Z", "url": "https://github.com/apache/druid/pull/10638", "merged": true, "mergeCommit": {"oid": "5324785eacaa0891e332d5dc62ac674c9da18362"}, "closed": true, "closedAt": "2020-12-08T19:00:51Z", "author": {"login": "viatcheslavmogilevsky"}, "timelineItems": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdi8z3egH2gAyNTMyNzgxMzc0Ojk4MjBjMTJhNzhmMDAyOTE1MGNlYjJlNWVjMWQyNjIwYzVlOGIxMmE=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdkO6H8AFqTU0NzUzOTk1Ng==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "9820c12a78f0029150ceb2e5ec1d2620c5e8b12a", "author": {"user": {"login": "viatcheslavmogilevsky", "name": "Vyatcheslav Mogilevsky"}}, "url": "https://github.com/apache/druid/commit/9820c12a78f0029150ceb2e5ec1d2620c5e8b12a", "committedDate": "2020-12-04T19:21:37Z", "message": "integration tests fix: update base image for hadoop containers to centos 7"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTQ1MzAzMTg4", "url": "https://github.com/apache/druid/pull/10638#pullrequestreview-545303188", "createdAt": "2020-12-04T21:19:32Z", "commit": {"oid": "9820c12a78f0029150ceb2e5ec1d2620c5e8b12a"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0wNFQyMToxOTozMlrOH_iYdw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0wNFQyMToxOTozMlrOH_iYdw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNjM4NTY1NQ==", "bodyText": "I decided to create /usr/local/bin/start_sshd executable by RUN command to make non-standard ssh port 2122 visible in that Dockerfile", "url": "https://github.com/apache/druid/pull/10638#discussion_r536385655", "createdAt": "2020-12-04T21:19:32Z", "author": {"login": "viatcheslavmogilevsky"}, "path": "examples/quickstart/tutorial/hadoop/docker/Dockerfile", "diffHunk": "@@ -109,8 +103,14 @@ RUN sed  -i \"/^[^#]*UsePAM/ s/.*/#&/\"  /etc/ssh/sshd_config\n RUN echo \"UsePAM no\" >> /etc/ssh/sshd_config\n RUN echo \"Port 2122\" >> /etc/ssh/sshd_config\n \n-RUN service sshd start && $HADOOP_PREFIX/etc/hadoop/hadoop-env.sh && $HADOOP_PREFIX/sbin/start-dfs.sh && $HADOOP_PREFIX/bin/hdfs dfs -mkdir -p /user/root\n-RUN service sshd start && $HADOOP_PREFIX/etc/hadoop/hadoop-env.sh && $HADOOP_PREFIX/sbin/start-dfs.sh && $HADOOP_PREFIX/bin/hdfs dfs -put $HADOOP_PREFIX/etc/hadoop/ input\n+# script for plain sshd start\n+RUN echo -e \\\n+\t'#!/bin/bash\\n/usr/sbin/sshd\\ntimeout 10 bash -c \"until printf \\\"\\\" 2>>/dev/null >>/dev/tcp/127.0.0.1/2122; do sleep 0.5; done\"' > \\\n+\t/usr/local/bin/start_sshd && \\\n+\tchmod a+x /usr/local/bin/start_sshd", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "9820c12a78f0029150ceb2e5ec1d2620c5e8b12a"}, "originalPosition": 25}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTQ3NTM5OTU2", "url": "https://github.com/apache/druid/pull/10638#pullrequestreview-547539956", "createdAt": "2020-12-08T19:00:40Z", "commit": {"oid": "9820c12a78f0029150ceb2e5ec1d2620c5e8b12a"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3136, "cost": 1, "resetAt": "2021-10-28T17:48:14Z"}}}