{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDc0NDA4MzEz", "number": 10325, "title": "fix NPE in StringGroupByColumnSelectorStrategy#bufferComparator", "bodyText": "Description\nIntelliJ warned me about a potential NPE here if canCompareInts is false and the comparator being used is false.\nThis patch defaults to use the Lexicographic comparator, which I think was the original intention from reading the code.\n\nThis PR has:\n\n been self-reviewed.\n added unit tests or modified existing tests to cover new code paths, ensuring the threshold for code coverage is met.\n added integration tests.\n been tested in a test Druid cluster.", "createdAt": "2020-08-27T02:38:28Z", "url": "https://github.com/apache/druid/pull/10325", "merged": true, "mergeCommit": {"oid": "91a153820ef2b2d938cd2e6e0eb1e5a53dcd0fb2"}, "closed": true, "closedAt": "2020-09-04T20:23:41Z", "author": {"login": "suneet-s"}, "timelineItems": {"totalCount": 6, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdC3EEBAH2gAyNDc0NDA4MzEzOjUzNjBhNDE1MjlkYWUyZWUwODYwOWJiZTdjZTAwMDliNjEwMDkyMDg=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdFrJptgFqTQ4MjkyMTMxNw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "5360a41529dae2ee08609bbe7ce0009b61009208", "author": {"user": {"login": "suneet-s", "name": "Suneet Saldanha"}}, "url": "https://github.com/apache/druid/commit/5360a41529dae2ee08609bbe7ce0009b61009208", "committedDate": "2020-08-27T02:34:18Z", "message": "fix NPE in StringGroupByColumnSelectorStrategy#bufferComparator"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "bad4065e4ff4a22ededc908e6503941b9dbc3348", "author": {"user": {"login": "suneet-s", "name": "Suneet Saldanha"}}, "url": "https://github.com/apache/druid/commit/bad4065e4ff4a22ededc908e6503941b9dbc3348", "committedDate": "2020-09-03T16:03:17Z", "message": "Add tests"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDgyMDAxNTU2", "url": "https://github.com/apache/druid/pull/10325#pullrequestreview-482001556", "createdAt": "2020-09-03T16:17:28Z", "commit": {"oid": "bad4065e4ff4a22ededc908e6503941b9dbc3348"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wM1QxNjoxNzoyOFrOHMuFpw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wM1QxNjoxNzoyOFrOHMuFpw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MzEwMDA3MQ==", "bodyText": "Could you add some javadocs to this method explaining what it does in general, and also specifically what it does when stringComparator is null?\nAlso, do you think this NPE could have got triggered by a real query? If so, is defaulting to lexicographic the right behavior for that query?", "url": "https://github.com/apache/druid/pull/10325#discussion_r483100071", "createdAt": "2020-09-03T16:17:28Z", "author": {"login": "gianm"}, "path": "processing/src/main/java/org/apache/druid/query/groupby/epinephelinae/column/StringGroupByColumnSelectorStrategy.java", "diffHunk": "@@ -157,8 +157,8 @@ private void initializeGroupingKeyV2Dimension(\n         capabilities != null &&\n         capabilities.hasBitmapIndexes() &&\n         capabilities.areDictionaryValuesSorted().and(capabilities.areDictionaryValuesUnique()).isTrue();\n-\n-    if (canCompareInts && (stringComparator == null || StringComparators.LEXICOGRAPHIC.equals(stringComparator))) {\n+    final StringComparator comparator = stringComparator == null ? StringComparators.LEXICOGRAPHIC : stringComparator;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "bad4065e4ff4a22ededc908e6503941b9dbc3348"}, "originalPosition": 6}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "4feba9937f455d2c910b912dc9e6338047e81501", "author": {"user": {"login": "suneet-s", "name": "Suneet Saldanha"}}, "url": "https://github.com/apache/druid/commit/4feba9937f455d2c910b912dc9e6338047e81501", "committedDate": "2020-09-03T23:59:18Z", "message": "Merge remote-tracking branch 'upstream/master' into comparator"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "4b7b866900f736404bce5ce91285fd58cf7e0977", "author": {"user": {"login": "suneet-s", "name": "Suneet Saldanha"}}, "url": "https://github.com/apache/druid/commit/4b7b866900f736404bce5ce91285fd58cf7e0977", "committedDate": "2020-09-04T00:03:26Z", "message": "javadocs"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDgyOTIxMzE3", "url": "https://github.com/apache/druid/pull/10325#pullrequestreview-482921317", "createdAt": "2020-09-04T20:23:19Z", "commit": {"oid": "4b7b866900f736404bce5ce91285fd58cf7e0977"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3501, "cost": 1, "resetAt": "2021-10-28T17:48:14Z"}}}