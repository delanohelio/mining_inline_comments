{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0MzU5MzQzMjk0", "number": 9130, "title": "Move result-to-array logic from SQL layer into QueryToolChests.", "bodyText": "The main changes are the removal of query-result-to-array code from org.apache.druid.sql.calcite.rel.QueryMaker, and the addition of these two methods to QueryToolChest:\nList<String> resultArrayFields(QueryType query);\nSequence<Object[]> resultsAsArrays(QueryType query, Sequence<ResultType> resultSequence);\nI think this improves the design of the code a little bit, but the main benefit is really to support joins on subqueries. The change is needed by this item from the proposal #8728:\n\nAllow joining on to \"query\" datasources as well. To make this work, we\u2019ll need to add a sense of a \u2018standard translation\u2019 of results from certain query types into flat schemas that we can offer column selectors on top of. There may be more than one way to do this, since certain query types (notably, topN and scan) return nested results in some cases. We could do this by adding a new QueryToolChest method.", "createdAt": "2020-01-05T22:34:43Z", "url": "https://github.com/apache/druid/pull/9130", "merged": true, "mergeCommit": {"oid": "bd49ec03bcb16930e4c25eab2d62c17b177724e3"}, "closed": true, "closedAt": "2020-01-16T23:42:11Z", "author": {"login": "gianm"}, "timelineItems": {"totalCount": 6, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABb3fXlhgH2gAyMzU5MzQzMjk0OmEyYjQwMDQ3ODJmZGM1NWQ0ZjJkZGEzYmY1ZWYyMzdjM2Q0YTMxMTU=", "endCursor": "Y3Vyc29yOnYyOpPPAAABb7BGaNAH2gAyMzU5MzQzMjk0OjRkOGQwNzYzNTFiN2M2MzE0MjE4MjMxYzdlYTBmM2NlNTBlYjgwODk=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "a2b4004782fdc55d4f2dda3bf5ef237c3d4a3115", "author": {"user": {"login": "gianm", "name": "Gian Merlino"}}, "url": "https://github.com/apache/druid/commit/a2b4004782fdc55d4f2dda3bf5ef237c3d4a3115", "committedDate": "2020-01-05T22:33:35Z", "message": "Move result-to-array logic from SQL layer into QueryToolChests."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "14ea4d44aca04fcd6b8e6237b5fdae91401db641", "author": {"user": {"login": "gianm", "name": "Gian Merlino"}}, "url": "https://github.com/apache/druid/commit/14ea4d44aca04fcd6b8e6237b5fdae91401db641", "committedDate": "2020-01-06T04:02:22Z", "message": "Checkstyle adjustment."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "66ff94f8834655ff9f5487023fa294963388fca8", "author": {"user": {"login": "gianm", "name": "Gian Merlino"}}, "url": "https://github.com/apache/druid/commit/66ff94f8834655ff9f5487023fa294963388fca8", "committedDate": "2020-01-16T21:18:37Z", "message": "Merge branch 'master' into result-to-array"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzQzNzA2NjQw", "url": "https://github.com/apache/druid/pull/9130#pullrequestreview-343706640", "createdAt": "2020-01-16T07:05:02Z", "commit": {"oid": "14ea4d44aca04fcd6b8e6237b5fdae91401db641"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0xNlQwNzowNTowM1rOFePulg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0xNlQwNzowNTowM1rOFePulg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NzI1OTI4Ng==", "bodyText": "nit: should this be 'Returns a list of field names in the order that ...'", "url": "https://github.com/apache/druid/pull/9130#discussion_r367259286", "createdAt": "2020-01-16T07:05:03Z", "author": {"login": "clintropolis"}, "path": "processing/src/main/java/org/apache/druid/query/QueryToolChest.java", "diffHunk": "@@ -269,4 +270,50 @@ public ObjectMapper decorateObjectMapper(final ObjectMapper objectMapper, final\n   {\n     return segments;\n   }\n+\n+  /**\n+   * Returns a list of field names in the order than {@link #resultsAsArrays} would return them. The returned list will", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "14ea4d44aca04fcd6b8e6237b5fdae91401db641"}, "originalPosition": 23}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzQ0MjMwMzE4", "url": "https://github.com/apache/druid/pull/9130#pullrequestreview-344230318", "createdAt": "2020-01-16T21:32:01Z", "commit": {"oid": "66ff94f8834655ff9f5487023fa294963388fca8"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "4d8d076351b7c6314218231c7ea0f3ce50eb8089", "author": {"user": {"login": "gianm", "name": "Gian Merlino"}}, "url": "https://github.com/apache/druid/commit/4d8d076351b7c6314218231c7ea0f3ce50eb8089", "committedDate": "2020-01-16T21:33:22Z", "message": "Fix typo."}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3856, "cost": 1, "resetAt": "2021-10-28T17:48:14Z"}}}