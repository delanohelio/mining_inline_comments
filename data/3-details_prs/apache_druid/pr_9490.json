{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0Mzg1ODc1NTc4", "number": 9490, "title": "Fix NPE when using IndexedTable and all left rows are filtered out", "bodyText": "This PR fixes an NPE that can occur with joins on RHS tables backed by IndexedTable, where if IndexedTableJoinMatcher never gets reset, matchRemainder, or matchCondition called (this can occur when all left rows have been filtered out), the IndexedTableJoinMatcher will incorrectly return true for hasMatch because the currentRow variable was never initialized.\nThis PR initializes currentRow in the constructor.\nThis PR has:\n\n been self-reviewed.\n added documentation for new or modified features or behaviors.\n added Javadocs for most classes and all non-trivial methods. Linked related entities via Javadoc links.\n added or updated version, license, or notice information in licenses.yaml\n added comments explaining the \"why\" and the intent of the code wherever would not be obvious for an unfamiliar reader.\n added unit tests or modified existing tests to cover new code paths.\n added integration tests.\n been tested in a test Druid cluster.", "createdAt": "2020-03-10T00:12:27Z", "url": "https://github.com/apache/druid/pull/9490", "merged": true, "mergeCommit": {"oid": "3082b9289a19e91a32bc874be187730ff47c6428"}, "closed": true, "closedAt": "2020-03-12T02:23:06Z", "author": {"login": "jon-wei"}, "timelineItems": {"totalCount": 11, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcMYnbvAH2gAyMzg1ODc1NTc4OjFkYzg0MDUzNDI2ODllYzNjMDI2N2NjMmFkZGJiMWEyMzA5MTIwOGE=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcMxhr9gFqTM3MzIyODMyNA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "1dc8405342689ec3c0267cc2addbb1a23091208a", "author": {"user": {"login": "jon-wei", "name": "Jonathan Wei"}}, "url": "https://github.com/apache/druid/commit/1dc8405342689ec3c0267cc2addbb1a23091208a", "committedDate": "2020-03-10T20:33:58Z", "message": "Fix NPE when using IndexedTable and all left rows are filtered out"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "74f015d1f8665b3830735cf81ea690802daa6185", "author": {"user": {"login": "jon-wei", "name": "Jonathan Wei"}}, "url": "https://github.com/apache/druid/commit/74f015d1f8665b3830735cf81ea690802daa6185", "committedDate": "2020-03-10T20:36:05Z", "message": "Fix compile"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": null, "afterCommit": {"oid": "74f015d1f8665b3830735cf81ea690802daa6185", "author": {"user": {"login": "jon-wei", "name": "Jonathan Wei"}}, "url": "https://github.com/apache/druid/commit/74f015d1f8665b3830735cf81ea690802daa6185", "committedDate": "2020-03-10T20:36:05Z", "message": "Fix compile"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzcyMzEwMjgx", "url": "https://github.com/apache/druid/pull/9490#pullrequestreview-372310281", "createdAt": "2020-03-10T20:48:42Z", "commit": {"oid": "74f015d1f8665b3830735cf81ea690802daa6185"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xMFQyMDo0ODo0MlrOF0gbVQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xMFQyMDo0ODo0MlrOF0gbVQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MDYwMTU1Nw==", "bodyText": "Perhaps create a named constant for this that's also used by the reset() method in this class", "url": "https://github.com/apache/druid/pull/9490#discussion_r390601557", "createdAt": "2020-03-10T20:48:42Z", "author": {"login": "ccaominh"}, "path": "processing/src/main/java/org/apache/druid/segment/join/table/IndexedTableJoinMatcher.java", "diffHunk": "@@ -81,6 +81,7 @@\n   )\n   {\n     this.table = table;\n+    this.currentRow = -1;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "74f015d1f8665b3830735cf81ea690802daa6185"}, "originalPosition": 4}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzcyOTA5NTMy", "url": "https://github.com/apache/druid/pull/9490#pullrequestreview-372909532", "createdAt": "2020-03-11T16:11:16Z", "commit": {"oid": "74f015d1f8665b3830735cf81ea690802daa6185"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzcyOTIwNTQ5", "url": "https://github.com/apache/druid/pull/9490#pullrequestreview-372920549", "createdAt": "2020-03-11T16:23:49Z", "commit": {"oid": "74f015d1f8665b3830735cf81ea690802daa6185"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "102b5b92c01550ad39ee51e299e9d2ca162178bf", "author": {"user": {"login": "jon-wei", "name": "Jonathan Wei"}}, "url": "https://github.com/apache/druid/commit/102b5b92c01550ad39ee51e299e9d2ca162178bf", "committedDate": "2020-03-11T23:42:44Z", "message": "Add constant for uninitialized current row"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzczMTk3NTc0", "url": "https://github.com/apache/druid/pull/9490#pullrequestreview-373197574", "createdAt": "2020-03-11T23:44:14Z", "commit": {"oid": "102b5b92c01550ad39ee51e299e9d2ca162178bf"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzczMjE4MDIw", "url": "https://github.com/apache/druid/pull/9490#pullrequestreview-373218020", "createdAt": "2020-03-12T00:54:52Z", "commit": {"oid": "102b5b92c01550ad39ee51e299e9d2ca162178bf"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xMlQwMDo1NDo1MlrOF1OFaQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xMlQwMDo1NDo1MlrOF1OFaQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MTM0OTYwOQ==", "bodyText": "Checkstyle is flagging this:\nERROR] /home/travis/build/apache/druid/processing/src/main/java/org/apache/druid/segment/join/table/IndexedTableJoinMatcher.java:62:17: 'static' modifier out of order with the JLS suggestions. [ModifierOrder]", "url": "https://github.com/apache/druid/pull/9490#discussion_r391349609", "createdAt": "2020-03-12T00:54:52Z", "author": {"login": "ccaominh"}, "path": "processing/src/main/java/org/apache/druid/segment/join/table/IndexedTableJoinMatcher.java", "diffHunk": "@@ -59,6 +59,8 @@\n \n public class IndexedTableJoinMatcher implements JoinMatcher\n {\n+  private final static int UNINITIALIZED_CURRENT_ROW = -1;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "102b5b92c01550ad39ee51e299e9d2ca162178bf"}, "originalPosition": 4}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "7780ce4069485907caee7be755cc8712f7c3b558", "author": {"user": {"login": "jon-wei", "name": "Jonathan Wei"}}, "url": "https://github.com/apache/druid/commit/7780ce4069485907caee7be755cc8712f7c3b558", "committedDate": "2020-03-12T01:13:43Z", "message": "Fix checkstyle"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzczMjI4MzI0", "url": "https://github.com/apache/druid/pull/9490#pullrequestreview-373228324", "createdAt": "2020-03-12T01:35:19Z", "commit": {"oid": "7780ce4069485907caee7be755cc8712f7c3b558"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2608, "cost": 1, "resetAt": "2021-10-28T17:48:14Z"}}}