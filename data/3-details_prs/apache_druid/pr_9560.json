{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0MzkzMzU4ODU1", "number": 9560, "title": "Instructions to run integration tests against quickstart", "bodyText": "This change makes it easier to run integration tests against a quickstart cluster running on a local development machine.\nThe primary motivation for this is debuggability, as you can have a local quickstart environment set up with remote debugging so you can easily put breakpoints in the cluster under test.\nThe other advantage of using this mode is that you can run an integration test against an older version of quickstart to verify that the test fails for older versions, but pass when the fix is applied in a newer version.", "createdAt": "2020-03-25T03:09:35Z", "url": "https://github.com/apache/druid/pull/9560", "merged": true, "mergeCommit": {"oid": "e6e2836b0e25f2b27816c514c5064e6516e60d7b"}, "closed": true, "closedAt": "2020-03-26T20:22:53Z", "author": {"login": "suneet-s"}, "timelineItems": {"totalCount": 11, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcQ-pOmgH2gAyMzkzMzU4ODU1OmZkZmQ2OGU3YjdhYWRmOGMwY2ZmOTQ3NmViNTc4MmU1ZWZiZTcyMjM=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcRiCvxAFqTM4MjM4NjEyMg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "fdfd68e7b7aadf8c0cff9476eb5782e5efbe7223", "author": {"user": {"login": "suneet-s", "name": "Suneet Saldanha"}}, "url": "https://github.com/apache/druid/commit/fdfd68e7b7aadf8c0cff9476eb5782e5efbe7223", "committedDate": "2020-03-25T03:08:01Z", "message": "Instructions to run integration tests against quickstart"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzgxNDE2Nzk5", "url": "https://github.com/apache/druid/pull/9560#pullrequestreview-381416799", "createdAt": "2020-03-25T18:17:54Z", "commit": {"oid": "fdfd68e7b7aadf8c0cff9476eb5782e5efbe7223"}, "state": "COMMENTED", "comments": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yNVQxODoxNzo1NFrOF7oXWA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yNVQxODoyMToxOVrOF7ogQA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5ODA3MTY0MA==", "bodyText": "How about linking against the quickstart docs so that folks know what is meant by a \"quickstart cluster\"?", "url": "https://github.com/apache/druid/pull/9560#discussion_r398071640", "createdAt": "2020-03-25T18:17:54Z", "author": {"login": "ccaominh"}, "path": "integration-tests/README.md", "diffHunk": "@@ -66,7 +66,40 @@ Integration tests can also be run with either Java 8 or Java 11 by adding -Djvm.\n can either be 8 or 11.\n \n Druid's configuration (using Docker) can be overrided by providing -Doverride.config.path=<PATH_TO_FILE>. \n-The file must contain one property per line, the key must start with druid_ and the format should be snake case. \n+The file must contain one property per line, the key must start with `druid_` and the format should be snake case. \n+\n+Running Tests Using A Quickstart Cluster\n+-------------------\n+\n+When writing integration tests, it can be helpful to test against a quickstart\n+cluster so that you can set up remote debugging with in your developer\n+environment. This section walks you through setting up the integration tests\n+so that it can run against a quickstart cluster running on your development", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "fdfd68e7b7aadf8c0cff9476eb5782e5efbe7223"}, "originalPosition": 13}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5ODA3MjE0Ng==", "bodyText": "Suggestion: Add : at the end\n(similar comment for other occurrences below)", "url": "https://github.com/apache/druid/pull/9560#discussion_r398072146", "createdAt": "2020-03-25T18:18:41Z", "author": {"login": "ccaominh"}, "path": "integration-tests/README.md", "diffHunk": "@@ -66,7 +66,40 @@ Integration tests can also be run with either Java 8 or Java 11 by adding -Djvm.\n can either be 8 or 11.\n \n Druid's configuration (using Docker) can be overrided by providing -Doverride.config.path=<PATH_TO_FILE>. \n-The file must contain one property per line, the key must start with druid_ and the format should be snake case. \n+The file must contain one property per line, the key must start with `druid_` and the format should be snake case. \n+\n+Running Tests Using A Quickstart Cluster\n+-------------------\n+\n+When writing integration tests, it can be helpful to test against a quickstart\n+cluster so that you can set up remote debugging with in your developer\n+environment. This section walks you through setting up the integration tests\n+so that it can run against a quickstart cluster running on your development\n+machine.\n+\n+Note that not all features run by default on a quickstart cluster, so it may\n+not make sense to run the entire test suite against this configuration.\n+\n+Make sure you have at least 6GB of memory available before you run the tests.\n+\n+The tests rely on files in the test/resources folder to exist under the path /resources,\n+so create a symlink to make them available", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "fdfd68e7b7aadf8c0cff9476eb5782e5efbe7223"}, "originalPosition": 22}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5ODA3MzI2Ng==", "bodyText": "Having to create a new directory as a child of root seems strange. Is there a way to make it local to the druid repo directory?", "url": "https://github.com/apache/druid/pull/9560#discussion_r398073266", "createdAt": "2020-03-25T18:20:22Z", "author": {"login": "ccaominh"}, "path": "integration-tests/README.md", "diffHunk": "@@ -66,7 +66,40 @@ Integration tests can also be run with either Java 8 or Java 11 by adding -Djvm.\n can either be 8 or 11.\n \n Druid's configuration (using Docker) can be overrided by providing -Doverride.config.path=<PATH_TO_FILE>. \n-The file must contain one property per line, the key must start with druid_ and the format should be snake case. \n+The file must contain one property per line, the key must start with `druid_` and the format should be snake case. \n+\n+Running Tests Using A Quickstart Cluster\n+-------------------\n+\n+When writing integration tests, it can be helpful to test against a quickstart\n+cluster so that you can set up remote debugging with in your developer\n+environment. This section walks you through setting up the integration tests\n+so that it can run against a quickstart cluster running on your development\n+machine.\n+\n+Note that not all features run by default on a quickstart cluster, so it may\n+not make sense to run the entire test suite against this configuration.\n+\n+Make sure you have at least 6GB of memory available before you run the tests.\n+\n+The tests rely on files in the test/resources folder to exist under the path /resources,\n+so create a symlink to make them available", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5ODA3MjE0Ng=="}, "originalCommit": {"oid": "fdfd68e7b7aadf8c0cff9476eb5782e5efbe7223"}, "originalPosition": 22}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5ODA3MzkyMA==", "bodyText": "Suggestion: Add . at the end", "url": "https://github.com/apache/druid/pull/9560#discussion_r398073920", "createdAt": "2020-03-25T18:21:19Z", "author": {"login": "ccaominh"}, "path": "integration-tests/README.md", "diffHunk": "@@ -66,7 +66,40 @@ Integration tests can also be run with either Java 8 or Java 11 by adding -Djvm.\n can either be 8 or 11.\n \n Druid's configuration (using Docker) can be overrided by providing -Doverride.config.path=<PATH_TO_FILE>. \n-The file must contain one property per line, the key must start with druid_ and the format should be snake case. \n+The file must contain one property per line, the key must start with `druid_` and the format should be snake case. \n+\n+Running Tests Using A Quickstart Cluster\n+-------------------\n+\n+When writing integration tests, it can be helpful to test against a quickstart\n+cluster so that you can set up remote debugging with in your developer\n+environment. This section walks you through setting up the integration tests\n+so that it can run against a quickstart cluster running on your development\n+machine.\n+\n+Note that not all features run by default on a quickstart cluster, so it may\n+not make sense to run the entire test suite against this configuration.\n+\n+Make sure you have at least 6GB of memory available before you run the tests.\n+\n+The tests rely on files in the test/resources folder to exist under the path /resources,\n+so create a symlink to make them available\n+\n+```\n+  ln -s ${DRUID_HOME}/integration-tests/src/test/resources /resources\n+```\n+\n+Set the cluster config file environment variable to the quickstart config\n+```\n+  export CONFIG_FILE=${DRUID_HOME}/integration-tests/quickstart-it.json\n+```\n+Note that quickstart does not run with ssl, so to trick the integration tests\n+we specify the `*_tls_url` in the config to be the same as the http url", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "fdfd68e7b7aadf8c0cff9476eb5782e5efbe7223"}, "originalPosition": 33}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzgxNDI5NzI1", "url": "https://github.com/apache/druid/pull/9560#pullrequestreview-381429725", "createdAt": "2020-03-25T18:34:22Z", "commit": {"oid": "fdfd68e7b7aadf8c0cff9476eb5782e5efbe7223"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yNVQxODozNDoyMlrOF7pAwg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yNVQxODozNDoyMlrOF7pAwg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5ODA4MjI0Mg==", "bodyText": "@maytasm3 I was worried about what you mentioned as a top level comment on this PR too. I tried to talk about it here, but maybe the warning is not big and scary enough. Any suggestions on how to make it more prominent? Also I wonder if I should point to the docker setup scripts for the next person who might find a test that fails when run against quickstart.", "url": "https://github.com/apache/druid/pull/9560#discussion_r398082242", "createdAt": "2020-03-25T18:34:22Z", "author": {"login": "suneet-s"}, "path": "integration-tests/README.md", "diffHunk": "@@ -66,7 +66,40 @@ Integration tests can also be run with either Java 8 or Java 11 by adding -Djvm.\n can either be 8 or 11.\n \n Druid's configuration (using Docker) can be overrided by providing -Doverride.config.path=<PATH_TO_FILE>. \n-The file must contain one property per line, the key must start with druid_ and the format should be snake case. \n+The file must contain one property per line, the key must start with `druid_` and the format should be snake case. \n+\n+Running Tests Using A Quickstart Cluster\n+-------------------\n+\n+When writing integration tests, it can be helpful to test against a quickstart\n+cluster so that you can set up remote debugging with in your developer\n+environment. This section walks you through setting up the integration tests\n+so that it can run against a quickstart cluster running on your development\n+machine.\n+\n+Note that not all features run by default on a quickstart cluster, so it may", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "fdfd68e7b7aadf8c0cff9476eb5782e5efbe7223"}, "originalPosition": 16}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d9b01561d7a7aa81eeef0e0d9186eaa9a8339d2b", "author": {"user": {"login": "suneet-s", "name": "Suneet Saldanha"}}, "url": "https://github.com/apache/druid/commit/d9b01561d7a7aa81eeef0e0d9186eaa9a8339d2b", "committedDate": "2020-03-25T21:32:40Z", "message": "Merge remote-tracking branch 'upstream/master' into quickstart-it"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "912762cd48d5f7a45a7d0de1eded35e120b1bccb", "author": {"user": {"login": "suneet-s", "name": "Suneet Saldanha"}}, "url": "https://github.com/apache/druid/commit/912762cd48d5f7a45a7d0de1eded35e120b1bccb", "committedDate": "2020-03-25T22:10:48Z", "message": "Address review comments"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzgxNTc1MjM2", "url": "https://github.com/apache/druid/pull/9560#pullrequestreview-381575236", "createdAt": "2020-03-25T22:13:34Z", "commit": {"oid": "912762cd48d5f7a45a7d0de1eded35e120b1bccb"}, "state": "DISMISSED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yNVQyMjoxMzozNFrOF7wWmA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yNVQyMjoxMzozNFrOF7wWmA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5ODIwMjUyMA==", "bodyText": "If you push another commit, there's a small typo here: group os -> group is", "url": "https://github.com/apache/druid/pull/9560#discussion_r398202520", "createdAt": "2020-03-25T22:13:34Z", "author": {"login": "ccaominh"}, "path": "integration-tests/src/test/java/org/apache/druid/tests/TestNGGroup.java", "diffHunk": "@@ -33,29 +33,57 @@\n   // This group can only be run individually using -Dgroups=query since it requires specific test data setup.\n   public static final String QUERY = \"query\";\n   public static final String REALTIME_INDEX = \"realtime-index\";\n-  // This group can only be run individually using -Dgroups=security since it requires specific test data setup.\n+\n+  /**\n+   * This group can only be run individually using -Dgroups=security since it requires specific test data setup.\n+   */\n   public static final String SECURITY = \"security\";\n-  // This group is not part of CI. To run this group, s3 configs/credentials for your s3 must be provided in a file.\n-  // The path of the file must then be pass to mvn with -Doverride.config.path=<PATH_TO_FILE>\n-  // See integration-tests/docker/environment-configs/override-examples/s3 for env vars to provide.\n+\n+  /**\n+   * This group is not part of CI. To run this group, s3 configs/credentials for your s3 must be provided in a file.\n+   * The path of the file must then be pass to mvn with -Doverride.config.path=<PATH_TO_FILE>\n+   * See integration-tests/docker/environment-configs/override-examples/s3 for env vars to provide.\n+   */\n   public static final String S3_DEEP_STORAGE = \"s3-deep-storage\";\n-  // This group is not part of CI. To run this group, gcs configs/credentials for your gcs must be provided in a file.\n-  // The path of the file must then be pass to mvn with -Doverride.config.path=<PATH_TO_FILE>\n-  // See integration-tests/docker/environment-configs/override-examples/gcs for env vars to provide.\n-  // The path to the folder that contains your GOOGLE_APPLICATION_CREDENTIALS file must also be pass\n-  // to mvn with -Dresource.file.dir.path=<PATH_TO_FOLDER>\n+\n+  /**\n+   * This group is not part of CI. To run this group, gcs configs/credentials for your gcs must be provided in a file.\n+   * The path of the file must then be pass to mvn with -Doverride.config.path=<PATH_TO_FILE>\n+   * See integration-tests/docker/environment-configs/override-examples/gcs for env vars to provide.\n+   * The path to the folder that contains your GOOGLE_APPLICATION_CREDENTIALS file must also be pass\n+   * to mvn with -Dresource.file.dir.path=<PATH_TO_FOLDER>\n+   */\n   public static final String GCS_DEEP_STORAGE = \"gcs-deep-storage\";\n-  // This group is not part of CI. To run this group, azure configs/credentials for your azure must be provided in a file.\n-  // The path of the file must then be pass to mvn with -Doverride.config.path=<PATH_TO_FILE>\n-  // See integration-tests/docker/environment-configs/override-examples/azures for env vars to provide.\n+\n+  /**\n+   * This group is not part of CI. To run this group, azure configs/credentials for your azure must be provided in a file.\n+   * The path of the file must then be pass to mvn with -Doverride.config.path=<PATH_TO_FILE>\n+   * See integration-tests/docker/environment-configs/override-examples/azures for env vars to provide.\n+   */\n   public static final String AZURE_DEEP_STORAGE = \"azure-deep-storage\";\n-  // This group is not part of CI. To run this group, hadoop configs must be provided in a file. The path of the file\n-  // must then be pass to mvn with -Doverride.config.path=<PATH_TO_FILE>\n-  // See integration-tests/docker/environment-configs/override-examples/hdfs for env vars to provide.\n-  // Additionally, hadoop docker must be started by passing -Dstart.hadoop.docker=true to mvn.\n+\n+  /**\n+   * This group is not part of CI. To run this group, hadoop configs must be provided in a file. The path of the file\n+   * must then be pass to mvn with -Doverride.config.path=<PATH_TO_FILE>\n+   * See integration-tests/docker/environment-configs/override-examples/hdfs for env vars to provide.\n+   * Additionally, hadoop docker must be started by passing -Dstart.hadoop.docker=true to mvn.\n+   */\n   public static final String HDFS_DEEP_STORAGE = \"hdfs-deep-storage\";\n-  // This group is not part of CI. To run this group, s3 configs/credentials for your s3 must be provided in a file.\n-  // The path of the file must then be pass to mvn with -Doverride.config.path=<PATH_TO_FILE>\n-  // See integration-tests/docker/environment-configs/override-examples/s3 for env vars to provide.\n+\n+  /**\n+   * This group is not part of CI. To run this group, s3 configs/credentials for your s3 must be provided in a file.\n+   * The path of the file must then be pass to mvn with -Doverride.config.path=<PATH_TO_FILE>\n+   * See integration-tests/docker/environment-configs/override-examples/s3 for env vars to provide.\n+   */\n   public static final String S3_INGESTION = \"s3-ingestion\";\n+\n+  /**\n+   * This group os not part of CI explicitly. It allows you to run all the tests that have been tested with", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "912762cd48d5f7a45a7d0de1eded35e120b1bccb"}, "originalPosition": 68}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "66f366409ee2e51af1ec0285276309bb6acc15c4", "author": {"user": {"login": "suneet-s", "name": "Suneet Saldanha"}}, "url": "https://github.com/apache/druid/commit/66f366409ee2e51af1ec0285276309bb6acc15c4", "committedDate": "2020-03-25T22:17:17Z", "message": "actually exclude the test group"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "73bc428dcfc814de3d477b2112455ad839024e53", "author": {"user": {"login": "suneet-s", "name": "Suneet Saldanha"}}, "url": "https://github.com/apache/druid/commit/73bc428dcfc814de3d477b2112455ad839024e53", "committedDate": "2020-03-26T04:20:27Z", "message": "Revert \"actually exclude the test group\"\n\nThis reverts commit 66f366409ee2e51af1ec0285276309bb6acc15c4."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "298a4d2f8a5b6478d63bbb9d8fb7cd5a0bb96c18", "author": {"user": {"login": "suneet-s", "name": "Suneet Saldanha"}}, "url": "https://github.com/apache/druid/commit/298a4d2f8a5b6478d63bbb9d8fb7cd5a0bb96c18", "committedDate": "2020-03-26T04:22:12Z", "message": "update comment"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzgxNzAwMzQ2", "url": "https://github.com/apache/druid/pull/9560#pullrequestreview-381700346", "createdAt": "2020-03-26T04:48:52Z", "commit": {"oid": "298a4d2f8a5b6478d63bbb9d8fb7cd5a0bb96c18"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzgyMzg2MTIy", "url": "https://github.com/apache/druid/pull/9560#pullrequestreview-382386122", "createdAt": "2020-03-26T20:22:34Z", "commit": {"oid": "298a4d2f8a5b6478d63bbb9d8fb7cd5a0bb96c18"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2725, "cost": 1, "resetAt": "2021-10-28T17:48:14Z"}}}