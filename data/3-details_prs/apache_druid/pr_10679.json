{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTM5NjcxNzcw", "number": 10679, "title": "Adding example config files for indexer process. Also added status/selfDiscovered endpoint to indexer for self discovery", "bodyText": "In this PR I have added example config files that can be used to spin up the indexer process. And have also added the status/selfDiscovered endpoint to indexer. Per the api-reference doc, all services support status/selfDiscovered endpoint. So this PR would fix that expected behavior.\nCode changes:\nSince the SelfDiscovered endpoint is registered in the middle manager here, I followed the similar pattern in CliIndexer.java file as well\nTesting\nBuilt my own docker image, added the following in docker-compose.yml file\n+  indexer:\n+    image: apache/druid:harini\n+    container_name: indexer\n+    volumes:\n+      - ./storage:/opt/data\n+      - middle_var:/opt/druid/var\n+    depends_on:\n+      - zookeeper\n+      - postgres\n+      - coordinator\n+    ports:\n+      - \"8092:8091\"\n+    command:\n+      - indexer\n+    env_file:\n+      - environment\n+\n\nBrought all the services up\nhrajendran@Harini-Rajendran's-MBP16 docker % docker-compose up -d\nCreating network \"docker_default\" with the default driver\nCreating postgres  ... done\nCreating zookeeper ... done\nCreating coordinator ... done\nCreating indexer       ... done\nCreating router        ... done\nCreating broker        ... done\nCreating historical    ... done\nCreating middlemanager ... done\nhrajendran@Harini-Rajendran's-MBP16 docker % docker ps\nCONTAINER ID        IMAGE                 COMMAND                  CREATED             STATUS              PORTS                                    NAMES\n65dc5d38b6fa        apache/druid:harini   \"/druid.sh broker\"       2 minutes ago       Up About a minute   0.0.0.0:8082->8082/tcp                   broker\nbc4d96b16aa5        apache/druid:harini   \"/druid.sh historical\"   2 minutes ago       Up About a minute   0.0.0.0:8083->8083/tcp                   historical\n8630096058c1        apache/druid:harini   \"/druid.sh middleMan\u2026\"   2 minutes ago       Up About a minute   0.0.0.0:8091->8091/tcp                   middlemanager\n61b9c89be515        apache/druid:harini   \"/druid.sh indexer\"      2 minutes ago       Up About a minute   0.0.0.0:8092->8091/tcp                   indexer\nd3c5d2f3e3ed        apache/druid:harini   \"/druid.sh router\"       2 minutes ago       Up About a minute   0.0.0.0:8888->8888/tcp                   router\n932a8794440b        apache/druid:harini   \"/druid.sh coordinat\u2026\"   2 minutes ago       Up 2 minutes        0.0.0.0:8081->8081/tcp                   coordinator\n086fe8a44b0a        postgres:latest       \"docker-entrypoint.s\u2026\"   2 minutes ago       Up 2 minutes        5432/tcp                                 postgres\nc3ea54ce6907        zookeeper:3.5         \"/docker-entrypoint.\u2026\"   2 minutes ago       Up 2 minutes        2181/tcp, 2888/tcp, 3888/tcp, 8080/tcp   zookeeper\n\n\nMade status/selfDiscovered curl call to indexer running on port 8092 and got back 200 OK.\nhrajendran@Harini-Rajendran's-MBP16 docker % curl -v http://localhost:8092/status/selfDiscovered\n*   Trying ::1...\n* TCP_NODELAY set\n* Connected to localhost (::1) port 8092 (#0)\n> GET /status/selfDiscovered HTTP/1.1\n> Host: localhost:8092\n> User-Agent: curl/7.64.1\n> Accept: */*\n> \n< HTTP/1.1 200 OK\n< Date: Mon, 14 Dec 2020 20:11:58 GMT\n< Content-Type: application/json\n< Vary: Accept-Encoding, User-Agent\n< Content-Length: 0\n< \n* Connection #0 to host localhost left intact\n* Closing connection 0", "createdAt": "2020-12-14T17:10:51Z", "url": "https://github.com/apache/druid/pull/10679", "merged": true, "mergeCommit": {"oid": "c2e26d2e1cc2218dbb1b25dc2794787fc43e24fa"}, "closed": true, "closedAt": "2020-12-15T03:04:14Z", "author": {"login": "harinirajendran"}, "timelineItems": {"totalCount": 13, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdmJGMUAFqTU1MTY2MzI3Ng==", "endCursor": "Y3Vyc29yOnYyOpPPAAABdmOQzfgFqTU1MTk3NjgwOQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTUxNjYzMjc2", "url": "https://github.com/apache/druid/pull/10679#pullrequestreview-551663276", "createdAt": "2020-12-14T17:22:15Z", "commit": null, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xNFQxNzoyMjoxNVrOIFbeBw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xNFQxNzoyMjoxNVrOIFbeBw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MjU2Mzg0Nw==", "bodyText": "any reason this is different than the default indexer port?", "url": "https://github.com/apache/druid/pull/10679#discussion_r542563847", "createdAt": "2020-12-14T17:22:15Z", "author": {"login": "xvrl"}, "path": "examples/conf/druid/cluster/data/indexer/runtime.properties", "diffHunk": "@@ -0,0 +1,38 @@\n+#\n+# Licensed to the Apache Software Foundation (ASF) under one\n+# or more contributor license agreements.  See the NOTICE file\n+# distributed with this work for additional information\n+# regarding copyright ownership.  The ASF licenses this file\n+# to you under the Apache License, Version 2.0 (the\n+# \"License\"); you may not use this file except in compliance\n+# with the License.  You may obtain a copy of the License at\n+#\n+#   http://www.apache.org/licenses/LICENSE-2.0\n+#\n+# Unless required by applicable law or agreed to in writing,\n+# software distributed under the License is distributed on an\n+# \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n+# KIND, either express or implied.  See the License for the\n+# specific language governing permissions and limitations\n+# under the License.\n+#\n+\n+druid.service=druid/indexer\n+druid.plaintextPort=8092", "state": "SUBMITTED", "replyTo": null, "originalCommit": null, "originalPosition": 21}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": null, "afterCommit": null}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTUxODkxNTY4", "url": "https://github.com/apache/druid/pull/10679#pullrequestreview-551891568", "createdAt": "2020-12-14T21:04:55Z", "commit": null, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xNFQyMTowNDo1NlrOIFo89w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xNFQyMTowNDo1NlrOIFo89w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0Mjc4NDc1OQ==", "bodyText": "the corresponding middleManager config has 4 tasks, should we match that for consistency?", "url": "https://github.com/apache/druid/pull/10679#discussion_r542784759", "createdAt": "2020-12-14T21:04:56Z", "author": {"login": "xvrl"}, "path": "examples/conf/druid/cluster/data/indexer/runtime.properties", "diffHunk": "@@ -0,0 +1,38 @@\n+#\n+# Licensed to the Apache Software Foundation (ASF) under one\n+# or more contributor license agreements.  See the NOTICE file\n+# distributed with this work for additional information\n+# regarding copyright ownership.  The ASF licenses this file\n+# to you under the Apache License, Version 2.0 (the\n+# \"License\"); you may not use this file except in compliance\n+# with the License.  You may obtain a copy of the License at\n+#\n+#   http://www.apache.org/licenses/LICENSE-2.0\n+#\n+# Unless required by applicable law or agreed to in writing,\n+# software distributed under the License is distributed on an\n+# \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n+# KIND, either express or implied.  See the License for the\n+# specific language governing permissions and limitations\n+# under the License.\n+#\n+\n+druid.service=druid/indexer\n+druid.plaintextPort=8091\n+\n+# Number of tasks per indexer\n+druid.worker.capacity=2", "state": "SUBMITTED", "replyTo": null, "originalCommit": null, "originalPosition": 24}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTUxODkyNDM2", "url": "https://github.com/apache/druid/pull/10679#pullrequestreview-551892436", "createdAt": "2020-12-14T21:06:08Z", "commit": null, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xNFQyMTowNjowOFrOIFpB4A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xNFQyMTowNjowOFrOIFpB4A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0Mjc4NjAxNg==", "bodyText": "given we have 1 processing thread per task in the example middle-manager config, I would set this to equal the worker capacity to have a comparable config.", "url": "https://github.com/apache/druid/pull/10679#discussion_r542786016", "createdAt": "2020-12-14T21:06:08Z", "author": {"login": "xvrl"}, "path": "examples/conf/druid/cluster/data/indexer/runtime.properties", "diffHunk": "@@ -0,0 +1,38 @@\n+#\n+# Licensed to the Apache Software Foundation (ASF) under one\n+# or more contributor license agreements.  See the NOTICE file\n+# distributed with this work for additional information\n+# regarding copyright ownership.  The ASF licenses this file\n+# to you under the Apache License, Version 2.0 (the\n+# \"License\"); you may not use this file except in compliance\n+# with the License.  You may obtain a copy of the License at\n+#\n+#   http://www.apache.org/licenses/LICENSE-2.0\n+#\n+# Unless required by applicable law or agreed to in writing,\n+# software distributed under the License is distributed on an\n+# \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n+# KIND, either express or implied.  See the License for the\n+# specific language governing permissions and limitations\n+# under the License.\n+#\n+\n+druid.service=druid/indexer\n+druid.plaintextPort=8091\n+\n+# Number of tasks per indexer\n+druid.worker.capacity=2\n+\n+# Task launch parameters\n+druid.indexer.task.baseTaskDir=var/druid/task\n+\n+# HTTP server threads\n+druid.server.http.numThreads=60\n+\n+# Processing threads and buffers on Indexer\n+druid.processing.numMergeBuffers=2\n+druid.processing.buffer.sizeBytes=100MiB\n+druid.processing.numThreads=1", "state": "SUBMITTED", "replyTo": null, "originalCommit": null, "originalPosition": 35}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTUxODkyOTI0", "url": "https://github.com/apache/druid/pull/10679#pullrequestreview-551892924", "createdAt": "2020-12-14T21:06:49Z", "commit": null, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xNFQyMTowNjo0OVrOIFpFHQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xNFQyMTowNjo0OVrOIFpFHQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0Mjc4Njg0NQ==", "bodyText": "we probably need more heap to match our middle-manager config, which had 1GB per task.", "url": "https://github.com/apache/druid/pull/10679#discussion_r542786845", "createdAt": "2020-12-14T21:06:49Z", "author": {"login": "xvrl"}, "path": "examples/conf/druid/cluster/data/indexer/jvm.config", "diffHunk": "@@ -0,0 +1,9 @@\n+-server\n+-Xms128m\n+-Xmx128m\n+-XX:MaxDirectMemorySize=1g", "state": "SUBMITTED", "replyTo": null, "originalCommit": null, "originalPosition": 4}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": null, "afterCommit": null}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": null, "afterCommit": null}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTUxOTE0Mjk2", "url": "https://github.com/apache/druid/pull/10679#pullrequestreview-551914296", "createdAt": "2020-12-14T21:38:08Z", "commit": null, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xNFQyMTozODowOFrOIFrI5g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xNFQyMTozODowOFrOIFrI5g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MjgyMDU4Mg==", "bodyText": "processing buffers are per thread, so we you can leave that to 100MB to match the middle manager", "url": "https://github.com/apache/druid/pull/10679#discussion_r542820582", "createdAt": "2020-12-14T21:38:08Z", "author": {"login": "xvrl"}, "path": "examples/conf/druid/cluster/data/indexer/runtime.properties", "diffHunk": "@@ -0,0 +1,38 @@\n+#\n+# Licensed to the Apache Software Foundation (ASF) under one\n+# or more contributor license agreements.  See the NOTICE file\n+# distributed with this work for additional information\n+# regarding copyright ownership.  The ASF licenses this file\n+# to you under the Apache License, Version 2.0 (the\n+# \"License\"); you may not use this file except in compliance\n+# with the License.  You may obtain a copy of the License at\n+#\n+#   http://www.apache.org/licenses/LICENSE-2.0\n+#\n+# Unless required by applicable law or agreed to in writing,\n+# software distributed under the License is distributed on an\n+# \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n+# KIND, either express or implied.  See the License for the\n+# specific language governing permissions and limitations\n+# under the License.\n+#\n+\n+druid.service=druid/indexer\n+druid.plaintextPort=8091\n+\n+# Number of tasks per indexer\n+druid.worker.capacity=4\n+\n+# Task launch parameters\n+druid.indexer.task.baseTaskDir=var/druid/task\n+\n+# HTTP server threads\n+druid.server.http.numThreads=60\n+\n+# Processing threads and buffers on Indexer\n+druid.processing.numMergeBuffers=2\n+druid.processing.buffer.sizeBytes=500MiB", "state": "SUBMITTED", "replyTo": null, "originalCommit": null, "originalPosition": 34}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": null, "afterCommit": null}, {"__typename": "PullRequestCommit", "commit": {"oid": "062572af7c8e44d8b6a4e2ff67c9979cb9d74435", "author": {"user": {"login": "harinirajendran", "name": "Harini Rajendran"}}, "url": "https://github.com/apache/druid/commit/062572af7c8e44d8b6a4e2ff67c9979cb9d74435", "committedDate": "2020-12-14T22:10:45Z", "message": "Adding example config files for indexer process. Also added status/selfDiscovered endpoint to indexer for self discovery of indexer."}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": null, "afterCommit": {"oid": "062572af7c8e44d8b6a4e2ff67c9979cb9d74435", "author": {"user": {"login": "harinirajendran", "name": "Harini Rajendran"}}, "url": "https://github.com/apache/druid/commit/062572af7c8e44d8b6a4e2ff67c9979cb9d74435", "committedDate": "2020-12-14T22:10:45Z", "message": "Adding example config files for indexer process. Also added status/selfDiscovered endpoint to indexer for self discovery of indexer."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTUxOTQyNTk3", "url": "https://github.com/apache/druid/pull/10679#pullrequestreview-551942597", "createdAt": "2020-12-14T22:21:04Z", "commit": {"oid": "062572af7c8e44d8b6a4e2ff67c9979cb9d74435"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTUxOTc2ODA5", "url": "https://github.com/apache/druid/pull/10679#pullrequestreview-551976809", "createdAt": "2020-12-14T23:23:23Z", "commit": {"oid": "062572af7c8e44d8b6a4e2ff67c9979cb9d74435"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3176, "cost": 1, "resetAt": "2021-10-28T17:48:14Z"}}}