{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTM2NjU0Mzcz", "number": 10669, "reviewThreads": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xNVQyMjoxMToyMFrOFF1LPQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xNVQyMjoyNTo0MlrOFF1f7w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzQxNjU4NDI5OnYy", "diffSide": "RIGHT", "path": "integration-tests/script/build_run_k8s_cluster.sh", "isResolved": false, "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xNVQyMjoxMToyMFrOIGiR9A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xNlQxODozMjozOFrOIHTcBg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MzcyNDAyMA==", "bodyText": "nit: not sure why we need to copy, can't we directly use those two files ?", "url": "https://github.com/apache/druid/pull/10669#discussion_r543724020", "createdAt": "2020-12-15T22:11:20Z", "author": {"login": "himanshug"}, "path": "integration-tests/script/build_run_k8s_cluster.sh", "diffHunk": "@@ -0,0 +1,82 @@\n+#!/usr/bin/env bash\n+# Licensed to the Apache Software Foundation (ASF) under one or more\n+# contributor license agreements.  See the NOTICE file distributed with\n+# this work for additional information regarding copyright ownership.\n+# The ASF licenses this file to You under the Apache License, Version 2.0\n+# (the \"License\"); you may not use this file except in compliance with\n+# the License.  You may obtain a copy of the License at\n+#\n+#     http://www.apache.org/licenses/LICENSE-2.0\n+#\n+# Unless required by applicable law or agreed to in writing, software\n+# distributed under the License is distributed on an \"AS IS\" BASIS,\n+# WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+# See the License for the specific language governing permissions and\n+# limitations under the License.\n+\n+set -e\n+\n+# setup client keystore\n+cd integration-tests\n+./docker/tls/generate-client-certs-and-keystores.sh\n+rm -rf docker/client_tls\n+cp -r client_tls docker/client_tls\n+cd ..\n+\n+# Build Docker images for pods\n+mvn -B -ff -q dependency:go-offline \\\n+      install \\\n+      -Pdist,bundle-contrib-exts \\\n+      -Pskip-static-checks,skip-tests \\\n+      -Dmaven.javadoc.skip=true\n+\n+docker build -t druid/cluster:v1 -f distribution/docker/DockerfileBuildTarAdvanced .\n+\n+# Set Necessary ENV\n+export CHANGE_MINIKUBE_NONE_USER=true\n+export MINIKUBE_WANTUPDATENOTIFICATION=false\n+export MINIKUBE_WANTREPORTERRORPROMPT=false\n+export MINIKUBE_HOME=$HOME\n+export KUBECONFIG=$HOME/.kube/config\n+sudo apt install -y conntrack\n+\n+# This tmp dir is used for MiddleManager pod and Historical Pod to cache segments.\n+mkdir tmp\n+chmod 777 tmp\n+\n+# Lacunch K8S cluster\n+curl -Lo kubectl https://storage.googleapis.com/kubernetes-release/release/v1.18.1/bin/linux/amd64/kubectl && chmod +x kubectl && sudo mv kubectl /usr/local/bin/\n+curl -Lo minikube https://storage.googleapis.com/minikube/releases/v1.8.1/minikube-linux-amd64 && chmod +x minikube && sudo mv minikube /usr/local/bin/\n+sudo /usr/local/bin/minikube start --profile=minikube --vm-driver=none --kubernetes-version=v1.18.1\n+sudo /usr/local/bin/minikube update-context\n+\n+# Prepare For Druid-Operator\n+git clone https://github.com/druid-io/druid-operator.git\n+cd druid-operator\n+git checkout -b druid-operator-0.0.3 druid-operator-0.0.3\n+cd ..\n+sed -i 's|REPLACE_IMAGE|druidio/druid-operator:0.0.3|g' druid-operator/deploy/operator.yaml\n+cp integration-tests/tiny-cluster.yaml druid-operator/examples/\n+cp integration-tests/tiny-cluster-zk.yaml druid-operator/examples/", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b7443be1f4dfc3ae9335bc87e4b420c0d059e400"}, "originalPosition": 60}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0Mzg2MzMzMw==", "bodyText": "There are some changes in integration-tests/tiny-cluster.yaml and integration-tests/tiny-cluster-zk.yaml, such as:\n\nNew NodeType Service.\nConfigs changing.\nAdd MiddleManager configs.\n\nSo the original files in druid-operator can't be used directly here.", "url": "https://github.com/apache/druid/pull/10669#discussion_r543863333", "createdAt": "2020-12-16T02:58:24Z", "author": {"login": "zhangyue19921010"}, "path": "integration-tests/script/build_run_k8s_cluster.sh", "diffHunk": "@@ -0,0 +1,82 @@\n+#!/usr/bin/env bash\n+# Licensed to the Apache Software Foundation (ASF) under one or more\n+# contributor license agreements.  See the NOTICE file distributed with\n+# this work for additional information regarding copyright ownership.\n+# The ASF licenses this file to You under the Apache License, Version 2.0\n+# (the \"License\"); you may not use this file except in compliance with\n+# the License.  You may obtain a copy of the License at\n+#\n+#     http://www.apache.org/licenses/LICENSE-2.0\n+#\n+# Unless required by applicable law or agreed to in writing, software\n+# distributed under the License is distributed on an \"AS IS\" BASIS,\n+# WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+# See the License for the specific language governing permissions and\n+# limitations under the License.\n+\n+set -e\n+\n+# setup client keystore\n+cd integration-tests\n+./docker/tls/generate-client-certs-and-keystores.sh\n+rm -rf docker/client_tls\n+cp -r client_tls docker/client_tls\n+cd ..\n+\n+# Build Docker images for pods\n+mvn -B -ff -q dependency:go-offline \\\n+      install \\\n+      -Pdist,bundle-contrib-exts \\\n+      -Pskip-static-checks,skip-tests \\\n+      -Dmaven.javadoc.skip=true\n+\n+docker build -t druid/cluster:v1 -f distribution/docker/DockerfileBuildTarAdvanced .\n+\n+# Set Necessary ENV\n+export CHANGE_MINIKUBE_NONE_USER=true\n+export MINIKUBE_WANTUPDATENOTIFICATION=false\n+export MINIKUBE_WANTREPORTERRORPROMPT=false\n+export MINIKUBE_HOME=$HOME\n+export KUBECONFIG=$HOME/.kube/config\n+sudo apt install -y conntrack\n+\n+# This tmp dir is used for MiddleManager pod and Historical Pod to cache segments.\n+mkdir tmp\n+chmod 777 tmp\n+\n+# Lacunch K8S cluster\n+curl -Lo kubectl https://storage.googleapis.com/kubernetes-release/release/v1.18.1/bin/linux/amd64/kubectl && chmod +x kubectl && sudo mv kubectl /usr/local/bin/\n+curl -Lo minikube https://storage.googleapis.com/minikube/releases/v1.8.1/minikube-linux-amd64 && chmod +x minikube && sudo mv minikube /usr/local/bin/\n+sudo /usr/local/bin/minikube start --profile=minikube --vm-driver=none --kubernetes-version=v1.18.1\n+sudo /usr/local/bin/minikube update-context\n+\n+# Prepare For Druid-Operator\n+git clone https://github.com/druid-io/druid-operator.git\n+cd druid-operator\n+git checkout -b druid-operator-0.0.3 druid-operator-0.0.3\n+cd ..\n+sed -i 's|REPLACE_IMAGE|druidio/druid-operator:0.0.3|g' druid-operator/deploy/operator.yaml\n+cp integration-tests/tiny-cluster.yaml druid-operator/examples/\n+cp integration-tests/tiny-cluster-zk.yaml druid-operator/examples/", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MzcyNDAyMA=="}, "originalCommit": {"oid": "b7443be1f4dfc3ae9335bc87e4b420c0d059e400"}, "originalPosition": 60}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NDUyOTQxNA==", "bodyText": "sorry, I wasn't clear, in this context \"original\" meant files in \"integration-tests/\"  i.e. you have\ncp integration-tests/tiny-cluster.yaml druid-operator/examples/\ncp integration-tests/tiny-cluster-zk.yaml druid-operator/examples/\n...\nsed -i \"s|REPLACE_VOLUMES|`pwd`|g\" druid-operator/examples/tiny-cluster.yaml\n..\nsudo /usr/local/bin/kubectl apply -f druid-operator/examples/tiny-cluster-zk.yaml\nsudo /usr/local/bin/kubectl apply -f druid-operator/examples/tiny-cluster.yaml\n\nas opposed to\n...\nsed -i \"s|REPLACE_VOLUMES|`pwd`|g\" integration-tests/tiny-cluster.yaml\n..\nsudo /usr/local/bin/kubectl apply -f integration-tests/tiny-cluster-zk.yaml\nsudo /usr/local/bin/kubectl apply -f integration-tests/tiny-cluster.yaml\n\nregardless, it is a nit and doesn't really matter much.", "url": "https://github.com/apache/druid/pull/10669#discussion_r544529414", "createdAt": "2020-12-16T18:32:38Z", "author": {"login": "himanshug"}, "path": "integration-tests/script/build_run_k8s_cluster.sh", "diffHunk": "@@ -0,0 +1,82 @@\n+#!/usr/bin/env bash\n+# Licensed to the Apache Software Foundation (ASF) under one or more\n+# contributor license agreements.  See the NOTICE file distributed with\n+# this work for additional information regarding copyright ownership.\n+# The ASF licenses this file to You under the Apache License, Version 2.0\n+# (the \"License\"); you may not use this file except in compliance with\n+# the License.  You may obtain a copy of the License at\n+#\n+#     http://www.apache.org/licenses/LICENSE-2.0\n+#\n+# Unless required by applicable law or agreed to in writing, software\n+# distributed under the License is distributed on an \"AS IS\" BASIS,\n+# WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+# See the License for the specific language governing permissions and\n+# limitations under the License.\n+\n+set -e\n+\n+# setup client keystore\n+cd integration-tests\n+./docker/tls/generate-client-certs-and-keystores.sh\n+rm -rf docker/client_tls\n+cp -r client_tls docker/client_tls\n+cd ..\n+\n+# Build Docker images for pods\n+mvn -B -ff -q dependency:go-offline \\\n+      install \\\n+      -Pdist,bundle-contrib-exts \\\n+      -Pskip-static-checks,skip-tests \\\n+      -Dmaven.javadoc.skip=true\n+\n+docker build -t druid/cluster:v1 -f distribution/docker/DockerfileBuildTarAdvanced .\n+\n+# Set Necessary ENV\n+export CHANGE_MINIKUBE_NONE_USER=true\n+export MINIKUBE_WANTUPDATENOTIFICATION=false\n+export MINIKUBE_WANTREPORTERRORPROMPT=false\n+export MINIKUBE_HOME=$HOME\n+export KUBECONFIG=$HOME/.kube/config\n+sudo apt install -y conntrack\n+\n+# This tmp dir is used for MiddleManager pod and Historical Pod to cache segments.\n+mkdir tmp\n+chmod 777 tmp\n+\n+# Lacunch K8S cluster\n+curl -Lo kubectl https://storage.googleapis.com/kubernetes-release/release/v1.18.1/bin/linux/amd64/kubectl && chmod +x kubectl && sudo mv kubectl /usr/local/bin/\n+curl -Lo minikube https://storage.googleapis.com/minikube/releases/v1.8.1/minikube-linux-amd64 && chmod +x minikube && sudo mv minikube /usr/local/bin/\n+sudo /usr/local/bin/minikube start --profile=minikube --vm-driver=none --kubernetes-version=v1.18.1\n+sudo /usr/local/bin/minikube update-context\n+\n+# Prepare For Druid-Operator\n+git clone https://github.com/druid-io/druid-operator.git\n+cd druid-operator\n+git checkout -b druid-operator-0.0.3 druid-operator-0.0.3\n+cd ..\n+sed -i 's|REPLACE_IMAGE|druidio/druid-operator:0.0.3|g' druid-operator/deploy/operator.yaml\n+cp integration-tests/tiny-cluster.yaml druid-operator/examples/\n+cp integration-tests/tiny-cluster-zk.yaml druid-operator/examples/", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MzcyNDAyMA=="}, "originalCommit": {"oid": "b7443be1f4dfc3ae9335bc87e4b420c0d059e400"}, "originalPosition": 60}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzQxNjU4ODYxOnYy", "diffSide": "RIGHT", "path": "integration-tests/script/build_run_k8s_cluster.sh", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xNVQyMjoxMjoyMVrOIGiUTg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xNlQwMjo1OToyMFrOIGq1Kw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MzcyNDYyMg==", "bodyText": "nit: maybe define DRUID_OPERATOR_VERSION=0.0.3 ?", "url": "https://github.com/apache/druid/pull/10669#discussion_r543724622", "createdAt": "2020-12-15T22:12:21Z", "author": {"login": "himanshug"}, "path": "integration-tests/script/build_run_k8s_cluster.sh", "diffHunk": "@@ -0,0 +1,82 @@\n+#!/usr/bin/env bash\n+# Licensed to the Apache Software Foundation (ASF) under one or more\n+# contributor license agreements.  See the NOTICE file distributed with\n+# this work for additional information regarding copyright ownership.\n+# The ASF licenses this file to You under the Apache License, Version 2.0\n+# (the \"License\"); you may not use this file except in compliance with\n+# the License.  You may obtain a copy of the License at\n+#\n+#     http://www.apache.org/licenses/LICENSE-2.0\n+#\n+# Unless required by applicable law or agreed to in writing, software\n+# distributed under the License is distributed on an \"AS IS\" BASIS,\n+# WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+# See the License for the specific language governing permissions and\n+# limitations under the License.\n+\n+set -e\n+\n+# setup client keystore\n+cd integration-tests\n+./docker/tls/generate-client-certs-and-keystores.sh\n+rm -rf docker/client_tls\n+cp -r client_tls docker/client_tls\n+cd ..\n+\n+# Build Docker images for pods\n+mvn -B -ff -q dependency:go-offline \\\n+      install \\\n+      -Pdist,bundle-contrib-exts \\\n+      -Pskip-static-checks,skip-tests \\\n+      -Dmaven.javadoc.skip=true\n+\n+docker build -t druid/cluster:v1 -f distribution/docker/DockerfileBuildTarAdvanced .\n+\n+# Set Necessary ENV\n+export CHANGE_MINIKUBE_NONE_USER=true\n+export MINIKUBE_WANTUPDATENOTIFICATION=false\n+export MINIKUBE_WANTREPORTERRORPROMPT=false\n+export MINIKUBE_HOME=$HOME\n+export KUBECONFIG=$HOME/.kube/config\n+sudo apt install -y conntrack\n+\n+# This tmp dir is used for MiddleManager pod and Historical Pod to cache segments.\n+mkdir tmp\n+chmod 777 tmp\n+\n+# Lacunch K8S cluster\n+curl -Lo kubectl https://storage.googleapis.com/kubernetes-release/release/v1.18.1/bin/linux/amd64/kubectl && chmod +x kubectl && sudo mv kubectl /usr/local/bin/\n+curl -Lo minikube https://storage.googleapis.com/minikube/releases/v1.8.1/minikube-linux-amd64 && chmod +x minikube && sudo mv minikube /usr/local/bin/\n+sudo /usr/local/bin/minikube start --profile=minikube --vm-driver=none --kubernetes-version=v1.18.1\n+sudo /usr/local/bin/minikube update-context\n+\n+# Prepare For Druid-Operator\n+git clone https://github.com/druid-io/druid-operator.git\n+cd druid-operator\n+git checkout -b druid-operator-0.0.3 druid-operator-0.0.3", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b7443be1f4dfc3ae9335bc87e4b420c0d059e400"}, "originalPosition": 56}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0Mzg2NDEwNw==", "bodyText": "Sure thing. Done!", "url": "https://github.com/apache/druid/pull/10669#discussion_r543864107", "createdAt": "2020-12-16T02:59:20Z", "author": {"login": "zhangyue19921010"}, "path": "integration-tests/script/build_run_k8s_cluster.sh", "diffHunk": "@@ -0,0 +1,82 @@\n+#!/usr/bin/env bash\n+# Licensed to the Apache Software Foundation (ASF) under one or more\n+# contributor license agreements.  See the NOTICE file distributed with\n+# this work for additional information regarding copyright ownership.\n+# The ASF licenses this file to You under the Apache License, Version 2.0\n+# (the \"License\"); you may not use this file except in compliance with\n+# the License.  You may obtain a copy of the License at\n+#\n+#     http://www.apache.org/licenses/LICENSE-2.0\n+#\n+# Unless required by applicable law or agreed to in writing, software\n+# distributed under the License is distributed on an \"AS IS\" BASIS,\n+# WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+# See the License for the specific language governing permissions and\n+# limitations under the License.\n+\n+set -e\n+\n+# setup client keystore\n+cd integration-tests\n+./docker/tls/generate-client-certs-and-keystores.sh\n+rm -rf docker/client_tls\n+cp -r client_tls docker/client_tls\n+cd ..\n+\n+# Build Docker images for pods\n+mvn -B -ff -q dependency:go-offline \\\n+      install \\\n+      -Pdist,bundle-contrib-exts \\\n+      -Pskip-static-checks,skip-tests \\\n+      -Dmaven.javadoc.skip=true\n+\n+docker build -t druid/cluster:v1 -f distribution/docker/DockerfileBuildTarAdvanced .\n+\n+# Set Necessary ENV\n+export CHANGE_MINIKUBE_NONE_USER=true\n+export MINIKUBE_WANTUPDATENOTIFICATION=false\n+export MINIKUBE_WANTREPORTERRORPROMPT=false\n+export MINIKUBE_HOME=$HOME\n+export KUBECONFIG=$HOME/.kube/config\n+sudo apt install -y conntrack\n+\n+# This tmp dir is used for MiddleManager pod and Historical Pod to cache segments.\n+mkdir tmp\n+chmod 777 tmp\n+\n+# Lacunch K8S cluster\n+curl -Lo kubectl https://storage.googleapis.com/kubernetes-release/release/v1.18.1/bin/linux/amd64/kubectl && chmod +x kubectl && sudo mv kubectl /usr/local/bin/\n+curl -Lo minikube https://storage.googleapis.com/minikube/releases/v1.8.1/minikube-linux-amd64 && chmod +x minikube && sudo mv minikube /usr/local/bin/\n+sudo /usr/local/bin/minikube start --profile=minikube --vm-driver=none --kubernetes-version=v1.18.1\n+sudo /usr/local/bin/minikube update-context\n+\n+# Prepare For Druid-Operator\n+git clone https://github.com/druid-io/druid-operator.git\n+cd druid-operator\n+git checkout -b druid-operator-0.0.3 druid-operator-0.0.3", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MzcyNDYyMg=="}, "originalCommit": {"oid": "b7443be1f4dfc3ae9335bc87e4b420c0d059e400"}, "originalPosition": 56}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzQxNjYzNzI3OnYy", "diffSide": "RIGHT", "path": "distribution/docker/DockerfileBuildTarAdvanced", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xNVQyMjoyNTo0MlrOIGiwxQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xNlQwMzowMzowMFrOIGrADw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MzczMTkwOQ==", "bodyText": "nit: this looks mostly a copy of other Dockerfile , it would be nice to reuse same if possible.", "url": "https://github.com/apache/druid/pull/10669#discussion_r543731909", "createdAt": "2020-12-15T22:25:42Z", "author": {"login": "himanshug"}, "path": "distribution/docker/DockerfileBuildTarAdvanced", "diffHunk": "@@ -0,0 +1,62 @@\n+#", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b7443be1f4dfc3ae9335bc87e4b420c0d059e400"}, "originalPosition": 1}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0Mzg2Njg5NQ==", "bodyText": "Also. There are some changes between DockerfileBuildTarAdvanced and original Dockerfile, such as :\n\nPrepare test data.\nMove mvn package out of Dockerfile.\nMkdir necessary for IT.\n\nSo that we can't use the original Dockerfile here.", "url": "https://github.com/apache/druid/pull/10669#discussion_r543866895", "createdAt": "2020-12-16T03:03:00Z", "author": {"login": "zhangyue19921010"}, "path": "distribution/docker/DockerfileBuildTarAdvanced", "diffHunk": "@@ -0,0 +1,62 @@\n+#", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MzczMTkwOQ=="}, "originalCommit": {"oid": "b7443be1f4dfc3ae9335bc87e4b420c0d059e400"}, "originalPosition": 1}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2905, "cost": 1, "resetAt": "2021-11-12T11:18:39Z"}}}