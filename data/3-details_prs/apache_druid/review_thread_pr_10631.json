{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTMyMjg0NTAz", "number": 10631, "reviewThreads": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0wNFQwNTozMDoyMlrOFAohIA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0wNFQwNTo0NDoyNVrOFAottQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzM2MjA4MTYwOnYy", "diffSide": "RIGHT", "path": "indexing-service/src/main/java/org/apache/druid/indexing/common/task/Task.java", "isResolved": false, "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0wNFQwNTozMDoyMlrOH_BeoA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0wNFQwNjoyODowNlrOH_CrPQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNTg0NjU2MA==", "bodyText": "Hmm, how can this happen? I thought Task.isReady() is always called before Task.run() because a task can be scheduled only when Task.isReady() returns true. Task.run() will be called after the task is scheduled in some indexer or middleManager.", "url": "https://github.com/apache/druid/pull/10631#discussion_r535846560", "createdAt": "2020-12-04T05:30:22Z", "author": {"login": "jihoonson"}, "path": "indexing-service/src/main/java/org/apache/druid/indexing/common/task/Task.java", "diffHunk": "@@ -160,8 +160,11 @@ default int getPriority()\n   /**\n    * Execute preflight actions for a task. This can be used to acquire locks, check preconditions, and so on. The\n    * actions must be idempotent, since this method may be executed multiple times. This typically runs on the\n-   * coordinator. If this method throws an exception, the task should be considered a failure.\n-   * <p/>\n+   * Overlord. If this method throws an exception, the task should be considered a failure.\n+   *\n+   * This method will not necessarily be executed before {@link #run(TaskToolbox)}, since this task readiness check\n+   * may be done on a different machine from the one that actually runs the task.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "7ae9e3c5ae125499abb1683d13bfc17b137818fa"}, "originalPosition": 9}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNTg1NDYxOQ==", "bodyText": "It won't necessarily be called on that same Task object (it might be called on a different instance that represents the same actual task).", "url": "https://github.com/apache/druid/pull/10631#discussion_r535854619", "createdAt": "2020-12-04T05:55:19Z", "author": {"login": "gianm"}, "path": "indexing-service/src/main/java/org/apache/druid/indexing/common/task/Task.java", "diffHunk": "@@ -160,8 +160,11 @@ default int getPriority()\n   /**\n    * Execute preflight actions for a task. This can be used to acquire locks, check preconditions, and so on. The\n    * actions must be idempotent, since this method may be executed multiple times. This typically runs on the\n-   * coordinator. If this method throws an exception, the task should be considered a failure.\n-   * <p/>\n+   * Overlord. If this method throws an exception, the task should be considered a failure.\n+   *\n+   * This method will not necessarily be executed before {@link #run(TaskToolbox)}, since this task readiness check\n+   * may be done on a different machine from the one that actually runs the task.", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNTg0NjU2MA=="}, "originalCommit": {"oid": "7ae9e3c5ae125499abb1683d13bfc17b137818fa"}, "originalPosition": 9}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNTg2NjE3Mw==", "bodyText": "Oh, I see. I think it happens only in indexers because peon calls isReady() before it runs its task.", "url": "https://github.com/apache/druid/pull/10631#discussion_r535866173", "createdAt": "2020-12-04T06:28:06Z", "author": {"login": "jihoonson"}, "path": "indexing-service/src/main/java/org/apache/druid/indexing/common/task/Task.java", "diffHunk": "@@ -160,8 +160,11 @@ default int getPriority()\n   /**\n    * Execute preflight actions for a task. This can be used to acquire locks, check preconditions, and so on. The\n    * actions must be idempotent, since this method may be executed multiple times. This typically runs on the\n-   * coordinator. If this method throws an exception, the task should be considered a failure.\n-   * <p/>\n+   * Overlord. If this method throws an exception, the task should be considered a failure.\n+   *\n+   * This method will not necessarily be executed before {@link #run(TaskToolbox)}, since this task readiness check\n+   * may be done on a different machine from the one that actually runs the task.", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNTg0NjU2MA=="}, "originalCommit": {"oid": "7ae9e3c5ae125499abb1683d13bfc17b137818fa"}, "originalPosition": 9}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzM2MjExMzgxOnYy", "diffSide": "RIGHT", "path": "integration-tests/docker/environment-configs/coordinator", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0wNFQwNTo0NDoyNVrOH_Bv1Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0wNFQwNTo1NzozMVrOH_CBKA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNTg1MDk2NQ==", "bodyText": "Is this too aggressive? \ud83d\ude05", "url": "https://github.com/apache/druid/pull/10631#discussion_r535850965", "createdAt": "2020-12-04T05:44:25Z", "author": {"login": "jihoonson"}, "path": "integration-tests/docker/environment-configs/coordinator", "diffHunk": "@@ -32,7 +32,11 @@ druid_coordinator_startDelay=PT5S\n druid_manager_lookups_hostUpdateTimeout=PT30S\n druid_manager_lookups_period=10000\n druid_manager_lookups_threadPoolSize=2\n+druid_manager_config_pollDuration=PT10S\n+druid_manager_rules_pollDuration=PT10S\n+druid_manager_segments_pollDuration=PT2S\n druid_auth_basic_common_cacheDirectory=/tmp/authCache/coordinator\n druid_auth_unsecuredPaths=[\"/druid/coordinator/v1/loadqueue\"]\n druid_server_https_crlPath=/tls/revocations.crl\n-druid_coordinator_period_indexingPeriod=PT180000S\n\\ No newline at end of file\n+druid_coordinator_period_indexingPeriod=PT180000S\n+druid_coordinator_period=PT1S", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "7ae9e3c5ae125499abb1683d13bfc17b137818fa"}, "originalPosition": 13}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNTg1NTQwMA==", "bodyText": "Ha ha \ud83d\ude42\nI think it's OK \u2014\u00a0there are going to be very few segments in the integration tests, so a coordinator run should be able to finish very quickly. This change was meant to speed up the tests.", "url": "https://github.com/apache/druid/pull/10631#discussion_r535855400", "createdAt": "2020-12-04T05:57:31Z", "author": {"login": "gianm"}, "path": "integration-tests/docker/environment-configs/coordinator", "diffHunk": "@@ -32,7 +32,11 @@ druid_coordinator_startDelay=PT5S\n druid_manager_lookups_hostUpdateTimeout=PT30S\n druid_manager_lookups_period=10000\n druid_manager_lookups_threadPoolSize=2\n+druid_manager_config_pollDuration=PT10S\n+druid_manager_rules_pollDuration=PT10S\n+druid_manager_segments_pollDuration=PT2S\n druid_auth_basic_common_cacheDirectory=/tmp/authCache/coordinator\n druid_auth_unsecuredPaths=[\"/druid/coordinator/v1/loadqueue\"]\n druid_server_https_crlPath=/tls/revocations.crl\n-druid_coordinator_period_indexingPeriod=PT180000S\n\\ No newline at end of file\n+druid_coordinator_period_indexingPeriod=PT180000S\n+druid_coordinator_period=PT1S", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNTg1MDk2NQ=="}, "originalCommit": {"oid": "7ae9e3c5ae125499abb1683d13bfc17b137818fa"}, "originalPosition": 13}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2882, "cost": 1, "resetAt": "2021-11-12T11:18:39Z"}}}