{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTE0NTA1NDM1", "number": 10550, "title": "Add zero period support to TIMESTAMPADD", "bodyText": "Description\nThis PR solves #10530 by removing internal checking of zero period for TIMESTAMPADD SQL function and timestamp_shift native query.\nAs is described in the issue, TIMESTAMPADD uses shared code PeriodGranularity, which does not allow zero period for user configuration, to hold arguments passed to it. To fix the issue in a simple way, period and timezone are extracted from given arguments respectively instead of creating a PeriodGranularity object to hold them together.\nAnd also, there's another slight improvement in code where TIMESTAMPADD SQL is converted to native query timestamp_shift function call. By detecting SQL AST ahead, a period string such as P1M is generated instead of calling of concat function.\n\nThis PR has:\n\n been self-reviewed.\n\n using the concurrency checklist (Remove this item if the PR doesn't have any relation to concurrency.)\n\n\n added documentation for new or modified features or behaviors.\n added Javadocs for most classes and all non-trivial methods. Linked related entities via Javadoc links.\n added or updated version, license, or notice information in licenses.yaml\n added comments explaining the \"why\" and the intent of the code wherever would not be obvious for an unfamiliar reader.\n added unit tests or modified existing tests to cover new code paths, ensuring the threshold for code coverage is met.\n added integration tests.\n been tested in a test Druid cluster.", "createdAt": "2020-11-03T06:06:27Z", "url": "https://github.com/apache/druid/pull/10550", "merged": true, "mergeCommit": {"oid": "d7d2c804ad10853cb9241766ae0602fb84e146ff"}, "closed": true, "closedAt": "2020-11-19T02:26:54Z", "author": {"login": "FrankChen021"}, "timelineItems": {"totalCount": 7, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdbbZMqgBqjM5ODMxNzkxMTc=", "endCursor": "Y3Vyc29yOnYyOpPPAAABddPN12ABqjQwMDMwOTcwMTI=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "HeadRefForcePushedEvent", "beforeCommit": null, "afterCommit": null}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTIzODIyMzYz", "url": "https://github.com/apache/druid/pull/10550#pullrequestreview-523822363", "createdAt": "2020-11-04T23:59:41Z", "commit": null, "state": "APPROVED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wNFQyMzo1OTo0MlrOHtuBnQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wNFQyMzo1OTo0MlrOHtuBnQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNzcwMjA0NQ==", "bodyText": "Nice tests!", "url": "https://github.com/apache/druid/pull/10550#discussion_r517702045", "createdAt": "2020-11-04T23:59:42Z", "author": {"login": "gianm"}, "path": "sql/src/test/java/org/apache/druid/sql/calcite/CalciteQueryTest.java", "diffHunk": "@@ -16016,6 +16017,142 @@ public void testTopNOnStringWithNonSortedOrUniqueDictionary(Map<String, Object>\n     );\n   }\n \n+  @Test\n+  public void testTimeStampAddZeroDayPeriod() throws Exception", "state": "SUBMITTED", "replyTo": null, "originalCommit": null, "originalPosition": 13}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "34f06b0ef1460800267904ee6439094f24e17d98", "author": {"user": {"login": "FrankChen021", "name": "Frank Chen"}}, "url": "https://github.com/apache/druid/commit/34f06b0ef1460800267904ee6439094f24e17d98", "committedDate": "2020-11-17T01:22:22Z", "message": "Allow zero period for TIMESTAMPADD"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "42a07eb9f009915df5091d994fe8346605e513de", "author": {"user": {"login": "FrankChen021", "name": "Frank Chen"}}, "url": "https://github.com/apache/druid/commit/42a07eb9f009915df5091d994fe8346605e513de", "committedDate": "2020-11-17T01:22:22Z", "message": "update test cases"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "2a7d5abfc2c6362ea168962461ab3675e710e2b8", "author": {"user": {"login": "FrankChen021", "name": "Frank Chen"}}, "url": "https://github.com/apache/druid/commit/2a7d5abfc2c6362ea168962461ab3675e710e2b8", "committedDate": "2020-11-17T01:22:22Z", "message": "add empty zone test case"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a82b74926a8d19eb5e0fded2dcc8655b71a92fed", "author": {"user": {"login": "FrankChen021", "name": "Frank Chen"}}, "url": "https://github.com/apache/druid/commit/a82b74926a8d19eb5e0fded2dcc8655b71a92fed", "committedDate": "2020-11-17T01:22:22Z", "message": "add unit test cases for TimestampShiftMacro"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": null, "afterCommit": {"oid": "a82b74926a8d19eb5e0fded2dcc8655b71a92fed", "author": {"user": {"login": "FrankChen021", "name": "Frank Chen"}}, "url": "https://github.com/apache/druid/commit/a82b74926a8d19eb5e0fded2dcc8655b71a92fed", "committedDate": "2020-11-17T01:22:22Z", "message": "add unit test cases for TimestampShiftMacro"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3431, "cost": 1, "resetAt": "2021-10-28T17:48:14Z"}}}