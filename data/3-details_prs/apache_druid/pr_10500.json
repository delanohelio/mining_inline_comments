{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTAwODk1Njcw", "number": 10500, "title": "Web console: targetRowsPerSegment for hashed partionin", "bodyText": "Added targetRowsPerSegment to the web console for hashed partition for both\nthe auto compaction view and as part of the ingestion workflow.\nThe help text was also updated to indicate when a user should care about\nupdating these fields\nView in Auto-compaction form for hashed partitioning\n\nHelp text for targetRowsPerSegment\n\nView in the Partition tab of the ingestion flow", "createdAt": "2020-10-10T02:45:39Z", "url": "https://github.com/apache/druid/pull/10500", "merged": true, "mergeCommit": {"oid": "b45a56f989934ed62dfb58e3dd8c222c341067ed"}, "closed": true, "closedAt": "2020-10-11T23:55:29Z", "author": {"login": "suneet-s"}, "timelineItems": {"totalCount": 6, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdRBjqEAH2gAyNTAwODk1NjcwOmEwM2QyMDM1MmJhZDRiNzBhZTRjYzFlN2M3NzUxYmQ1Njg2MjA1OTM=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdRoWmRAFqTUwNjIzMDk0MQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "a03d20352bad4b70ae4cc1e7c7751bd568620593", "author": {"user": {"login": "suneet-s", "name": "Suneet Saldanha"}}, "url": "https://github.com/apache/druid/commit/a03d20352bad4b70ae4cc1e7c7751bd568620593", "committedDate": "2020-10-10T02:42:48Z", "message": "Web console: targetRowsPerSegment for hashed partionin\n\nAdded `targetRowsPerSegment` to the web console for hashed partition for both\nthe auto compaction view and as part of the ingestion workflow.\n\nThe help text was also updated to indicate when a user should care about\nupdating these fields"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTA2MTEzMzIx", "url": "https://github.com/apache/druid/pull/10500#pullrequestreview-506113321", "createdAt": "2020-10-10T17:26:07Z", "commit": {"oid": "a03d20352bad4b70ae4cc1e7c7751bd568620593"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xMFQxNzoyNjowN1rOHfhPkA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xMFQxODozMDo1MVrOHfhm5g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMjgxMjU2MA==", "bodyText": "do not use <br /> in these descriptions. What you want is paragraphs. You can return multiple paragraphs by wrapping them in a fragment <>. So you would want:\n<>\n  <p>Paragraph 1</p>\n  <p>Paragraph 2</p>\n</>\n\nSee \n  \n    \n      druid/web-console/src/utils/ingestion-spec.tsx\n    \n    \n         Line 780\n      in\n      cbe2b44\n    \n    \n    \n    \n\n        \n          \n           <> \n        \n    \n  \n\n for example", "url": "https://github.com/apache/druid/pull/10500#discussion_r502812560", "createdAt": "2020-10-10T17:26:07Z", "author": {"login": "vogievetsky"}, "path": "web-console/src/dialogs/compaction-dialog/compaction-dialog.tsx", "diffHunk": "@@ -74,17 +74,39 @@ const COMPACTION_CONFIG_FIELDS: Field<CompactionConfig>[] = [\n     info: <>Total number of rows in segments waiting for being pushed.</>,\n   },\n   // partitionsSpec type: hashed\n+  {\n+    name: 'tuningConfig.partitionsSpec.targetRowsPerSegment',\n+    label: 'Target rows per segment',\n+    type: 'number',\n+    defined: (t: CompactionConfig) =>\n+      deepGet(t, 'tuningConfig.partitionsSpec.type') === 'hashed' &&\n+      !deepGet(t, 'tuningConfig.partitionsSpec.numShards'),\n+    info: (\n+      <p>\n+        If you have skewed data, you may want to set this field to generate evenly sized segments.\n+        <br />\n+        <br /> A target row count for each partition. Each partition will have a row count close to\n+        the target assuming evenly distributed keys. Defaults to 5 million if numShards is null.\n+      </p>\n+    ),\n+  },\n   {\n     name: 'tuningConfig.partitionsSpec.numShards',\n     label: 'Num shards',\n     type: 'number',\n-    defined: (t: CompactionConfig) => deepGet(t, 'tuningConfig.partitionsSpec.type') === 'hashed',\n+    defined: (t: CompactionConfig) =>\n+      deepGet(t, 'tuningConfig.partitionsSpec.type') === 'hashed' &&\n+      !deepGet(t, 'tuningConfig.partitionsSpec.targetRowsPerSegment'),\n     info: (\n-      <>\n+      <p>\n+        If you know the optimal number of shards and want to speed up the time it takes for\n+        compaction to run, set this field.\n+        <br />", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a03d20352bad4b70ae4cc1e7c7751bd568620593"}, "originalPosition": 33}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMjgxODUzNA==", "bodyText": "Does this mean that either numShards should be set or targetRowsPerSegment? What is their relationship exactly? Does one have to be set? What if both are set? I am asking because it looks like there might need some validation logic?", "url": "https://github.com/apache/druid/pull/10500#discussion_r502818534", "createdAt": "2020-10-10T18:30:51Z", "author": {"login": "vogievetsky"}, "path": "web-console/src/utils/ingestion-spec.tsx", "diffHunk": "@@ -2181,17 +2181,41 @@ export function getPartitionRelatedTuningSpecFormFields(\n           info: <>Total number of rows in segments waiting for being pushed.</>,\n         },\n         // partitionsSpec type: hashed\n+        {\n+          name: 'partitionsSpec.targetRowsPerSegment',\n+          label: 'Target rows per segment',\n+          type: 'number',\n+          defined: (t: TuningConfig) =>\n+            deepGet(t, 'partitionsSpec.type') === 'hashed' &&\n+            !deepGet(t, 'partitionsSpec.numShards'),\n+          info: (\n+            <p>\n+              If you have skewed data, you may want to set this field to generate evenly sized\n+              segments.\n+              <br />\n+              <br /> A target row count for each partition. Each partition will have a row count\n+              close to the target assuming evenly distributed keys. Defaults to 5 million if\n+              numShards is null.\n+            </p>\n+          ),\n+        },\n         {\n           name: 'partitionsSpec.numShards',\n           label: 'Num shards',\n           type: 'number',\n-          defined: (t: TuningConfig) => deepGet(t, 'partitionsSpec.type') === 'hashed',\n+          defined: (t: TuningConfig) =>\n+            deepGet(t, 'partitionsSpec.type') === 'hashed' &&\n+            !deepGet(t, 'partitionsSpec.targetRowsPerSegment'),", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a03d20352bad4b70ae4cc1e7c7751bd568620593"}, "originalPosition": 29}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "275ad8e890bc73c451f7a8a51bafe53e4087793b", "author": {"user": {"login": "suneet-s", "name": "Suneet Saldanha"}}, "url": "https://github.com/apache/druid/commit/275ad8e890bc73c451f7a8a51bafe53e4087793b", "committedDate": "2020-10-11T01:52:16Z", "message": "code review"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "4de618c42925fa3d53ec6925fe85c4ccf4c13984", "author": {"user": {"login": "suneet-s", "name": "Suneet Saldanha"}}, "url": "https://github.com/apache/druid/commit/4de618c42925fa3d53ec6925fe85c4ccf4c13984", "committedDate": "2020-10-11T02:11:47Z", "message": "update test snapshots"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d8fd80a8fd4e7424bfbb7eab28788c5c92190517", "author": {"user": {"login": "suneet-s", "name": "Suneet Saldanha"}}, "url": "https://github.com/apache/druid/commit/d8fd80a8fd4e7424bfbb7eab28788c5c92190517", "committedDate": "2020-10-11T14:31:33Z", "message": "oops"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTA2MjMwOTQx", "url": "https://github.com/apache/druid/pull/10500#pullrequestreview-506230941", "createdAt": "2020-10-11T23:54:50Z", "commit": {"oid": "d8fd80a8fd4e7424bfbb7eab28788c5c92190517"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3360, "cost": 1, "resetAt": "2021-10-28T17:48:14Z"}}}