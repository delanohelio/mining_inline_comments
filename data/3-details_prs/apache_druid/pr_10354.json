{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDc5MTcwODQy", "number": 10354, "title": "Integration tests and docs for auto compaction with different partitioning", "bodyText": "Description\nA follow-up of #10307. The OOM killer started killing Druid processes in ITAutoCompactionTest. My recent commits are to avoid this problem. I reduced the memory of historicals from 768MB to 512MB. ITAutoCompactionTest is now running in a separate job because of the time limit in Travis.\n\nThis PR has:\n\n been self-reviewed.\n\n using the concurrency checklist (Remove this item if the PR doesn't have any relation to concurrency.)\n\n\n added documentation for new or modified features or behaviors.\n added Javadocs for most classes and all non-trivial methods. Linked related entities via Javadoc links.\n added or updated version, license, or notice information in licenses.yaml\n added comments explaining the \"why\" and the intent of the code wherever would not be obvious for an unfamiliar reader.\n added unit tests or modified existing tests to cover new code paths, ensuring the threshold for code coverage is met.\n added integration tests.\n been tested in a test Druid cluster.", "createdAt": "2020-09-04T01:39:03Z", "url": "https://github.com/apache/druid/pull/10354", "merged": true, "mergeCommit": {"oid": "8657b23ab215668c5ac5adb4b8f91096d5fb4733"}, "closed": true, "closedAt": "2020-09-15T18:28:10Z", "author": {"login": "jihoonson"}, "timelineItems": {"totalCount": 18, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdDgV7HgH2gAyNDc5MTcwODQyOjllYzcwNzkzNDMwNjU5ZDEyMWM5YmExMTkzZGNjOWJlNDU5NTE5YzA=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdI_eZZgFqTQ4ODMwMTc1Ng==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "9ec70793430659d121c9ba1193dcc9be459519c0", "author": {"user": {"login": "jihoonson", "name": "Jihoon Son"}}, "url": "https://github.com/apache/druid/commit/9ec70793430659d121c9ba1193dcc9be459519c0", "committedDate": "2020-08-29T02:39:55Z", "message": "Working"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c901404e292df4744fabb8acf17d2a2de069d67e", "author": {"user": {"login": "jihoonson", "name": "Jihoon Son"}}, "url": "https://github.com/apache/druid/commit/c901404e292df4744fabb8acf17d2a2de069d67e", "committedDate": "2020-09-01T22:51:59Z", "message": "Merge branch 'master' of github.com:apache/druid into it-test-auto-compaction"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "352a5a4b4c4033124a1eda29047e902f1f5b29de", "author": {"user": {"login": "jihoonson", "name": "Jihoon Son"}}, "url": "https://github.com/apache/druid/commit/352a5a4b4c4033124a1eda29047e902f1f5b29de", "committedDate": "2020-09-01T22:52:12Z", "message": "add test"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "917381a5952bf6ef3591d37f435a4987ea4f5295", "author": {"user": {"login": "jihoonson", "name": "Jihoon Son"}}, "url": "https://github.com/apache/druid/commit/917381a5952bf6ef3591d37f435a4987ea4f5295", "committedDate": "2020-09-02T01:30:02Z", "message": "doc"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "2dc4947ae3ea5ae053ce944487cddcff81dfbae3", "author": {"user": {"login": "jihoonson", "name": "Jihoon Son"}}, "url": "https://github.com/apache/druid/commit/2dc4947ae3ea5ae053ce944487cddcff81dfbae3", "committedDate": "2020-09-04T01:36:29Z", "message": "fix test"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c8f7836364a06517d1115f6d3a212f5daaceb6bf", "author": {"user": {"login": "jihoonson", "name": "Jihoon Son"}}, "url": "https://github.com/apache/druid/commit/c8f7836364a06517d1115f6d3a212f5daaceb6bf", "committedDate": "2020-09-04T01:39:47Z", "message": "Merge branch 'it-test-auto-compaction' of github.com:jihoonson/druid into it-test-auto-compaction"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e5f9dbc984b58f25e62393ad9f1b65cfd134560a", "author": {"user": {"login": "jihoonson", "name": "Jihoon Son"}}, "url": "https://github.com/apache/druid/commit/e5f9dbc984b58f25e62393ad9f1b65cfd134560a", "committedDate": "2020-09-04T03:22:33Z", "message": "split other integration test"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "fcc7b42dbc0dc423139a6c4da8a9aa0ae06027a3", "author": {"user": {"login": "jihoonson", "name": "Jihoon Son"}}, "url": "https://github.com/apache/druid/commit/fcc7b42dbc0dc423139a6c4da8a9aa0ae06027a3", "committedDate": "2020-09-04T03:23:23Z", "message": "exclude other-index from other tests"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "573903ac18a688bdbe4db984614c791801758476", "author": {"user": {"login": "jihoonson", "name": "Jihoon Son"}}, "url": "https://github.com/apache/druid/commit/573903ac18a688bdbe4db984614c791801758476", "committedDate": "2020-09-04T06:22:05Z", "message": "doc anchor fix"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "70bfc5bb0ae84ecc60518945ab68e988a7e2084a", "author": {"user": {"login": "jihoonson", "name": "Jihoon Son"}}, "url": "https://github.com/apache/druid/commit/70bfc5bb0ae84ecc60518945ab68e988a7e2084a", "committedDate": "2020-09-04T06:42:34Z", "message": "adjust task slots and number of merge tasks"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "bba850d8c8cb44155dc64222f116e59ede11fc6e", "author": {"user": {"login": "jihoonson", "name": "Jihoon Son"}}, "url": "https://github.com/apache/druid/commit/bba850d8c8cb44155dc64222f116e59ede11fc6e", "committedDate": "2020-09-04T07:12:42Z", "message": "spell check"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "aece722b0ed6c5b4e7b240f33d90bf6a71824704", "author": {"user": {"login": "jihoonson", "name": "Jihoon Son"}}, "url": "https://github.com/apache/druid/commit/aece722b0ed6c5b4e7b240f33d90bf6a71824704", "committedDate": "2020-09-04T17:24:42Z", "message": "reduce maxNumConcurrentSubTasks to 1"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "6613de4d31b108ebfb80c350d758747f46ea7da9", "author": {"user": {"login": "jihoonson", "name": "Jihoon Son"}}, "url": "https://github.com/apache/druid/commit/6613de4d31b108ebfb80c350d758747f46ea7da9", "committedDate": "2020-09-04T17:24:54Z", "message": "Merge branch 'it-test-auto-compaction' of github.com:jihoonson/druid into it-test-auto-compaction"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ddecc0caf4821955d15645005fdf9f90e3d214fa", "author": {"user": {"login": "jihoonson", "name": "Jihoon Son"}}, "url": "https://github.com/apache/druid/commit/ddecc0caf4821955d15645005fdf9f90e3d214fa", "committedDate": "2020-09-05T00:05:25Z", "message": "maxNumConcurrentSubtasks for range partitinoing"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ad58a298dbf436b44196db675d407954bbc6a4b1", "author": {"user": {"login": "jihoonson", "name": "Jihoon Son"}}, "url": "https://github.com/apache/druid/commit/ad58a298dbf436b44196db675d407954bbc6a4b1", "committedDate": "2020-09-08T21:28:58Z", "message": "reduce memory for historical"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDg2MjYxODkw", "url": "https://github.com/apache/druid/pull/10354#pullrequestreview-486261890", "createdAt": "2020-09-10T19:52:06Z", "commit": {"oid": "ad58a298dbf436b44196db675d407954bbc6a4b1"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xMFQxOTo1MjowNlrOHQDdWw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xMFQxOTo1Mjo1OFrOHQDfAg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NjU5NTkzMQ==", "bodyText": "Should be rename the TestNGGroup from \"other-index\" to \"compact\"? AFAIK, the \"other-index\" only has auto-compaction IT and manual compaction IT. If we do that then we can rename this job from \"integration_auto_compaction_tests\" to \"integration_compaction_tests\". My concern is with the job saying auto_compaction but the test group is other-index which in the future may contains non compaction related tests", "url": "https://github.com/apache/druid/pull/10354#discussion_r486595931", "createdAt": "2020-09-10T19:52:06Z", "author": {"login": "maytasm"}, "path": ".travis.yml", "diffHunk": "@@ -417,11 +417,19 @@ jobs:\n       script: *run_integration_test\n       after_failure: *integration_test_diags\n \n+    - &integration_auto_compaction_tests\n+      name: \"(Compile=openjdk8, Run=openjdk8) auto compaction integration test\"\n+      jdk: openjdk8\n+      services: *integration_test_services\n+      env: TESTNG_GROUPS='-Dgroups=other-index' JVM_RUNTIME='-Djvm.runtime=8'", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ad58a298dbf436b44196db675d407954bbc6a4b1"}, "originalPosition": 8}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NjU5NjM1NA==", "bodyText": "Doesn't have to be address but maybe we should get rid of this. This is only running a single test since we move out the \"other-index\"", "url": "https://github.com/apache/druid/pull/10354#discussion_r486596354", "createdAt": "2020-09-10T19:52:58Z", "author": {"login": "maytasm"}, "path": ".travis.yml", "diffHunk": "@@ -417,11 +417,19 @@ jobs:\n       script: *run_integration_test\n       after_failure: *integration_test_diags\n \n+    - &integration_auto_compaction_tests\n+      name: \"(Compile=openjdk8, Run=openjdk8) auto compaction integration test\"\n+      jdk: openjdk8\n+      services: *integration_test_services\n+      env: TESTNG_GROUPS='-Dgroups=other-index' JVM_RUNTIME='-Djvm.runtime=8'\n+      script: *run_integration_test\n+      after_failure: *integration_test_diags\n+\n     - &integration_tests\n       name: \"(Compile=openjdk8, Run=openjdk8) other integration test\"\n       jdk: openjdk8\n       services: *integration_test_services\n-      env: TESTNG_GROUPS='-DexcludedGroups=batch-index,input-format,input-source,perfect-rollup-parallel-batch-index,kafka-index,query,query-retry,realtime-index,security,s3-deep-storage,gcs-deep-storage,azure-deep-storage,hdfs-deep-storage,s3-ingestion,kinesis-index,kinesis-data-format,kafka-transactional-index,kafka-index-slow,kafka-transactional-index-slow,kafka-data-format,hadoop-s3-to-s3-deep-storage,hadoop-s3-to-hdfs-deep-storage,hadoop-azure-to-azure-deep-storage,hadoop-azure-to-hdfs-deep-storage,hadoop-gcs-to-gcs-deep-storage,hadoop-gcs-to-hdfs-deep-storage,aliyun-oss-deep-storage,append-ingestion' JVM_RUNTIME='-Djvm.runtime=11'\n+      env: TESTNG_GROUPS='-DexcludedGroups=batch-index,input-format,input-source,perfect-rollup-parallel-batch-index,kafka-index,query,query-retry,realtime-index,security,s3-deep-storage,gcs-deep-storage,azure-deep-storage,hdfs-deep-storage,s3-ingestion,kinesis-index,kinesis-data-format,kafka-transactional-index,kafka-index-slow,kafka-transactional-index-slow,kafka-data-format,hadoop-s3-to-s3-deep-storage,hadoop-s3-to-hdfs-deep-storage,hadoop-azure-to-azure-deep-storage,hadoop-azure-to-hdfs-deep-storage,hadoop-gcs-to-gcs-deep-storage,hadoop-gcs-to-hdfs-deep-storage,aliyun-oss-deep-storage,append-ingestion,other-index' JVM_RUNTIME='-Djvm.runtime=11'", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ad58a298dbf436b44196db675d407954bbc6a4b1"}, "originalPosition": 17}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "2ee19d4717222e8b87f5252d03f1ba58b16a42e9", "author": {"user": {"login": "jihoonson", "name": "Jihoon Son"}}, "url": "https://github.com/apache/druid/commit/2ee19d4717222e8b87f5252d03f1ba58b16a42e9", "committedDate": "2020-09-13T06:10:55Z", "message": "change group name"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDg4MzAxNzU2", "url": "https://github.com/apache/druid/pull/10354#pullrequestreview-488301756", "createdAt": "2020-09-15T03:45:51Z", "commit": {"oid": "2ee19d4717222e8b87f5252d03f1ba58b16a42e9"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3563, "cost": 1, "resetAt": "2021-10-28T17:48:14Z"}}}