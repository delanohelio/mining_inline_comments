{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0MzcxODAyOTc3", "number": 9320, "title": "fix protobuf extension packaging and docs", "bodyText": "Fixes #8051.\nDescription\nThis PR fixes druid-protobuf-extensions by tweaking how shading is done to not included the jars that are shaded in the packaging.\nbefore:\n$ ls -1 apache-druid-0.18.0-SNAPSHOT/extensions/druid-protobuf-extensions/\ndruid-protobuf-extensions-0.18.0-SNAPSHOT.jar\nerror_prone_annotations-2.3.2.jar\ngson-2.8.6.jar\nprotobuf-dynamic-0.9.3.jar\nprotobuf-java-3.11.0.jar\nprotobuf-java-util-3.11.0.jar\n\nafter:\n$ ls -1 apache-druid-0.18.0-SNAPSHOT/extensions/druid-protobuf-extensions/\ndruid-protobuf-extensions-0.18.0-SNAPSHOT.jar\n\nI also updated the extension quickstart website docs a bit to make it a bit easier to follow.\n\nThis PR has:\n\n been self-reviewed.\n added documentation for new or modified features or behaviors.\n been tested in a test Druid cluster.", "createdAt": "2020-02-06T09:50:20Z", "url": "https://github.com/apache/druid/pull/9320", "merged": true, "mergeCommit": {"oid": "b55657cc267cda89fd616a25c23da72a05570a44"}, "closed": true, "closedAt": "2020-02-07T17:26:53Z", "author": {"login": "clintropolis"}, "timelineItems": {"totalCount": 7, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcBndiZAH2gAyMzcxODAyOTc3Ojk3OWVhMjhlN2EwZjE3ODJiODc2NzUxMTU5MDAyMDBjYTkyOTM5MWI=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcByMIxgFqTM1NDgwNzQwNg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "979ea28e7a0f1782b87675115900200ca929391b", "author": {"user": {"login": "clintropolis", "name": "Clint Wylie"}}, "url": "https://github.com/apache/druid/commit/979ea28e7a0f1782b87675115900200ca929391b", "committedDate": "2020-02-06T09:38:34Z", "message": "fix protobuf extension packaging and docs"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "fd69ba4902f73edab6dc93ee36582b6b88292450", "author": {"user": {"login": "clintropolis", "name": "Clint Wylie"}}, "url": "https://github.com/apache/druid/commit/fd69ba4902f73edab6dc93ee36582b6b88292450", "committedDate": "2020-02-06T10:03:07Z", "message": "fix paths"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "96e6dcc618d86463c8a285902c45e286dfa1ce89", "author": {"user": {"login": "clintropolis", "name": "Clint Wylie"}}, "url": "https://github.com/apache/druid/commit/96e6dcc618d86463c8a285902c45e286dfa1ce89", "committedDate": "2020-02-06T12:33:08Z", "message": "Update protobuf.md"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzU0NzA5MjY0", "url": "https://github.com/apache/druid/pull/9320#pullrequestreview-354709264", "createdAt": "2020-02-06T19:23:38Z", "commit": {"oid": "96e6dcc618d86463c8a285902c45e286dfa1ce89"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0wNlQxOToyMzozOFrOFmnRTA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0wNlQxOToyMzozOFrOFmnRTA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NjAzMzYxMg==", "bodyText": "Keeping the shebang line that was present before is convenient if this code snippet is copy/pasted into its own script file.", "url": "https://github.com/apache/druid/pull/9320#discussion_r376033612", "createdAt": "2020-02-06T19:23:38Z", "author": {"login": "ccaominh"}, "path": "docs/development/extensions-core/protobuf.md", "diffHunk": "@@ -165,54 +164,74 @@ Please make sure these keys are properly configured for successful ingestion.\n }\n ```\n \n-## Kafka Producer\n+## Adding Protobuf messages to Kafka\n \n-Here is the sample script that publishes the metrics to Kafka in Protobuf format.\n+If necessary, from your Kafka installation directory run the following command to create the Kafka topic\n \n-1. Run `protoc` again with the Python binding option.  This command generates `metrics_pb2.py` file.\n- ```\n-  protoc -o metrics.desc metrics.proto --python_out=.\n- ```\n+```\n+./bin/kafka-topics.sh --create --zookeeper localhost:2181 --replication-factor 1 --partitions 1 --topic metrics_pb\n+```\n \n-2. Create Kafka producer script.\n+This example script requires `protobuf` and `kafka-python` modules. With the topic in place, messages can be inserted running the following command from your Druid installation directory\n \n-This script requires `protobuf` and `kafka-python` modules.\n+```\n+./bin/generate-example-metrics | ./quickstart/protobuf/pb_publisher.py\n+```\n \n-```python\n-#!/usr/bin/env python\n+You can confirm that data has been inserted to your Kafka topic using the following command from your Kafka installation directory\n+\n+```\n+./bin/kafka-console-consumer --zookeeper localhost --topic metrics_pb\n+```\n+\n+which should print messages like this\n+\n+```\n+millisecondsGETR\"2017-04-06T03:23:56Z*2002/list:request/latencyBwww1.example.com\n+```\n+\n+If your supervisor created in the previous step is running, the indexing tasks should begin producing the messages and the data will soon be available for querying in Druid.\n+\n+## Generating the example files\n+\n+The files provided in the example quickstart can be generated in the following manner starting with only `metrics.proto`.\n+\n+### `metrics.desc`\n+\n+The descriptor file is generated using `protoc` Protobuf compiler. Given a `.proto` file, a `.desc` file can be generated like so.\n+\n+```\n+protoc -o metrics.desc metrics.proto\n+```\n+\n+### `metrics_pb2.py`\n+`metrics_pb2.py` is also generated with `protoc`\n+\n+```\n+ protoc -o metrics.desc metrics.proto --python_out=.\n+```\n \n+### `pb_publisher.py`\n+After `metrics_pb2.py` is generated, another script can be constructed to parse JSON data, convert it to Protobuf, and produce to a Kafka topic\n+\n+```python", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "96e6dcc618d86463c8a285902c45e286dfa1ce89"}, "originalPosition": 135}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ffb65c48f6baf46016e874f096848d9b90696b2a", "author": {"user": {"login": "clintropolis", "name": "Clint Wylie"}}, "url": "https://github.com/apache/druid/commit/ffb65c48f6baf46016e874f096848d9b90696b2a", "committedDate": "2020-02-06T21:21:39Z", "message": "Update protobuf.md"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzU0ODA3MjI5", "url": "https://github.com/apache/druid/pull/9320#pullrequestreview-354807229", "createdAt": "2020-02-06T22:08:10Z", "commit": {"oid": "ffb65c48f6baf46016e874f096848d9b90696b2a"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzU0ODA3NDA2", "url": "https://github.com/apache/druid/pull/9320#pullrequestreview-354807406", "createdAt": "2020-02-06T22:08:31Z", "commit": {"oid": "ffb65c48f6baf46016e874f096848d9b90696b2a"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2867, "cost": 1, "resetAt": "2021-10-28T17:48:14Z"}}}