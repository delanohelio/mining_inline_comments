{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTAwMjE5ODU3", "number": 10496, "title": "Web console: show segment sizes in rows not bytes", "bodyText": "This PR addresses the feedback from the recent work on the new segment distribution in the console. Segment sizes should be in rows not megabytes to fit with the new Druid documentation https://github.com/apache/druid/blob/master/docs/operations/segment-optimization.md\nOld:\n\nNew:\n\nThis PR also cleans up some types and adds a nice little error action hint for 3 of the most common SQL query errors (see bottom of screenshot):\n\nAlso fixes #10507", "createdAt": "2020-10-08T22:16:44Z", "url": "https://github.com/apache/druid/pull/10496", "merged": true, "mergeCommit": {"oid": "e8c5893c34db2482ed80cd0a01c6d44c411515aa"}, "closed": true, "closedAt": "2020-10-13T20:19:40Z", "author": {"login": "vogievetsky"}, "timelineItems": {"totalCount": 21, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdQW-UMAH2gAyNTAwMjE5ODU3OjBlNDFlNGJiNzc3NTgzMWU2N2FmNDI1NTNhYzYwNzllMzFmMzAzNTg=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdSOc4EgFqTUwNzc5NzAyMw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "0e41e4bb7775831e67af42553ac6079e31f30358", "author": {"user": {"login": "vogievetsky", "name": "Vadim Ogievetsky"}}, "url": "https://github.com/apache/druid/commit/0e41e4bb7775831e67af42553ac6079e31f30358", "committedDate": "2020-10-08T01:06:00Z", "message": "added query error suggestions"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "3779bf2541c417b032c30bb728484aca3a529c7e", "author": {"user": {"login": "vogievetsky", "name": "Vadim Ogievetsky"}}, "url": "https://github.com/apache/druid/commit/3779bf2541c417b032c30bb728484aca3a529c7e", "committedDate": "2020-10-08T20:39:14Z", "message": "simplify the SQLs"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "7616d7f167e57c7e488df8edcdb55a9daff73e3b", "author": {"user": {"login": "vogievetsky", "name": "Vadim Ogievetsky"}}, "url": "https://github.com/apache/druid/commit/7616d7f167e57c7e488df8edcdb55a9daff73e3b", "committedDate": "2020-10-08T21:06:59Z", "message": "change segment size display to rows"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "5b695b98ddf9a362c6316a2a255017bb585ca63a", "author": {"user": {"login": "vogievetsky", "name": "Vadim Ogievetsky"}}, "url": "https://github.com/apache/druid/commit/5b695b98ddf9a362c6316a2a255017bb585ca63a", "committedDate": "2020-10-08T22:08:00Z", "message": "suggestion tests"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "761ba2a778945cb98d7658ffd00eca1f6f50a324", "author": {"user": {"login": "vogievetsky", "name": "Vadim Ogievetsky"}}, "url": "https://github.com/apache/druid/commit/761ba2a778945cb98d7658ffd00eca1f6f50a324", "committedDate": "2020-10-08T22:10:07Z", "message": "update snapshot"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTA1MzMzMjQ3", "url": "https://github.com/apache/druid/pull/10496#pullrequestreview-505333247", "createdAt": "2020-10-09T03:18:23Z", "commit": {"oid": "761ba2a778945cb98d7658ffd00eca1f6f50a324"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wOVQwMzoxODoyM1rOHe5j5Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wOVQwMzoxODoyM1rOHe5j5Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMjE2MjQwNQ==", "bodyText": "what does mq and mc stand for?", "url": "https://github.com/apache/druid/pull/10496#discussion_r502162405", "createdAt": "2020-10-09T03:18:23Z", "author": {"login": "suneet-s"}, "path": "web-console/src/utils/druid-query.ts", "diffHunk": "@@ -92,12 +97,55 @@ export class DruidError extends Error {\n     return;\n   }\n \n+  static getSuggestion(errorMessage: string): QuerySuggestion | undefined {\n+    // == is used instead of =\n+    if (errorMessage.includes('Encountered \"= =\" at')) {\n+      return {\n+        label: `Replace == with =`,\n+        fn: str => {\n+          if (!str.includes('==')) return;\n+          return str.replace(/==/g, '=');\n+        },\n+      };\n+    }\n+\n+    // Incorrect quoting on table\n+    const mq = errorMessage.match(/Column '([^']+)' not found in any table/);\n+    if (mq) {\n+      const literalString = mq[1];\n+      return {\n+        label: `Replace \"${literalString}\" with '${literalString}'`,\n+        fn: str => {\n+          if (!str.includes(`\"${literalString}\"`)) return;\n+          return str.replace(`\"${literalString}\"`, `'${literalString}'`);\n+        },\n+      };\n+    }\n+\n+    // , before FROM\n+    const mc = errorMessage.match(/Encountered \"(FROM)\" at/i);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "761ba2a778945cb98d7658ffd00eca1f6f50a324"}, "originalPosition": 42}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTA1MzM0NDUy", "url": "https://github.com/apache/druid/pull/10496#pullrequestreview-505334452", "createdAt": "2020-10-09T03:23:22Z", "commit": {"oid": "761ba2a778945cb98d7658ffd00eca1f6f50a324"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wOVQwMzoyMzoyMlrOHe5oKw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wOVQwMzoyMzoyMlrOHe5oKw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMjE2MzQ5OQ==", "bodyText": "what if == is part of a literal? Does str#replace replace all instances of the regex in the string? Similar comments for other uses of replace function in this code block", "url": "https://github.com/apache/druid/pull/10496#discussion_r502163499", "createdAt": "2020-10-09T03:23:22Z", "author": {"login": "suneet-s"}, "path": "web-console/src/utils/druid-query.ts", "diffHunk": "@@ -92,12 +97,55 @@ export class DruidError extends Error {\n     return;\n   }\n \n+  static getSuggestion(errorMessage: string): QuerySuggestion | undefined {\n+    // == is used instead of =\n+    if (errorMessage.includes('Encountered \"= =\" at')) {\n+      return {\n+        label: `Replace == with =`,\n+        fn: str => {\n+          if (!str.includes('==')) return;\n+          return str.replace(/==/g, '=');", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "761ba2a778945cb98d7658ffd00eca1f6f50a324"}, "originalPosition": 23}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTA1MzM3MTk2", "url": "https://github.com/apache/druid/pull/10496#pullrequestreview-505337196", "createdAt": "2020-10-09T03:34:33Z", "commit": {"oid": "761ba2a778945cb98d7658ffd00eca1f6f50a324"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wOVQwMzozNDozM1rOHe5x-g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wOVQwMzozNDozM1rOHe5x-g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMjE2NjAxMA==", "bodyText": "Is this wide enough to handle 7 digits for min, avg and max?\nFrom the doc linked in this PR it's generally recommended for each segment to have around 5 million rows\nDo you think it's users would want to see a rounded number instead - something like 2.1M instead of 2,105,248\n^ just a thought", "url": "https://github.com/apache/druid/pull/10496#discussion_r502166010", "createdAt": "2020-10-09T03:34:33Z", "author": {"login": "suneet-s"}, "path": "web-console/src/views/datasource-view/datasource-view.tsx", "diffHunk": "@@ -1011,11 +1006,11 @@ GROUP BY 1`;\n               ),\n             },\n             {\n-              Header: twoLines('Segment size (MB)', 'min / avg / max'),\n+              Header: twoLines('Segment size (rows)', 'minimum / average / maximum'),\n               show: hiddenColumns.exists('Segment size'),\n               accessor: 'avg_segment_size',\n               filterable: false,\n-              width: 150,\n+              width: 220,", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "761ba2a778945cb98d7658ffd00eca1f6f50a324"}, "originalPosition": 130}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "cef736db24f173bc27b84cd251a5e27ac3cd215a", "author": {"user": {"login": "vogievetsky", "name": "Vadim Ogievetsky"}}, "url": "https://github.com/apache/druid/commit/cef736db24f173bc27b84cd251a5e27ac3cd215a", "committedDate": "2020-10-10T00:32:01Z", "message": "make error detection more robust"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "052c29127094c085a5d662e8e515e012a3b442fe", "author": {"user": {"login": "vogievetsky", "name": "Vadim Ogievetsky"}}, "url": "https://github.com/apache/druid/commit/052c29127094c085a5d662e8e515e012a3b442fe", "committedDate": "2020-10-10T00:33:37Z", "message": "remove errant console log"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "491c8c0c2d7a2a1ca86f2b01be1c400945ba48cc", "author": {"user": {"login": "vogievetsky", "name": "Vadim Ogievetsky"}}, "url": "https://github.com/apache/druid/commit/491c8c0c2d7a2a1ca86f2b01be1c400945ba48cc", "committedDate": "2020-10-10T00:34:16Z", "message": "fix imports"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c73483ffc921f968df38390b349f117328883437", "author": {"user": {"login": "vogievetsky", "name": "Vadim Ogievetsky"}}, "url": "https://github.com/apache/druid/commit/c73483ffc921f968df38390b349f117328883437", "committedDate": "2020-10-10T00:45:00Z", "message": "put suggestion on top"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "874b5c6f5bb91e7607511aa14c6b3be28a98eb47", "author": {"user": {"login": "vogievetsky", "name": "Vadim Ogievetsky"}}, "url": "https://github.com/apache/druid/commit/874b5c6f5bb91e7607511aa14c6b3be28a98eb47", "committedDate": "2020-10-10T04:32:49Z", "message": "better error rendering"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "426b68fb8b8ff5f3fdf35e3bd687639fa14d58d7", "author": {"user": {"login": "vogievetsky", "name": "Vadim Ogievetsky"}}, "url": "https://github.com/apache/druid/commit/426b68fb8b8ff5f3fdf35e3bd687639fa14d58d7", "committedDate": "2020-10-12T00:26:46Z", "message": "format as millions"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTA2OTY2NTEz", "url": "https://github.com/apache/druid/pull/10496#pullrequestreview-506966513", "createdAt": "2020-10-12T23:02:05Z", "commit": {"oid": "426b68fb8b8ff5f3fdf35e3bd687639fa14d58d7"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xMlQyMzowMjowNlrOHgP3BQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xMlQyMzowMjowNlrOHgP3BQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMzU3NjMyNQ==", "bodyText": "nit: should this be min_segment_rows ... instead of size?", "url": "https://github.com/apache/druid/pull/10496#discussion_r503576325", "createdAt": "2020-10-12T23:02:06Z", "author": {"login": "suneet-s"}, "path": "web-console/src/views/datasource-view/datasource-view.tsx", "diffHunk": "@@ -144,42 +144,41 @@ function progress(done: number, awaiting: number): number {\n \n const PERCENT_BRACES = [formatPercent(1)];\n \n-interface Datasource {\n-  datasource: string;\n-  rules: Rule[];\n-  compactionConfig?: CompactionConfig;\n-  compactionStatus?: CompactionStatus;\n-  [key: string]: any;\n+interface DatasourceQueryResultRow {\n+  readonly datasource: string;\n+  readonly num_segments: number;\n+  readonly num_available_segments: number;\n+  readonly num_segments_to_load: number;\n+  readonly num_segments_to_drop: number;\n+  readonly total_data_size: number;\n+  readonly replicated_size: number;\n+  readonly min_segment_size: number;\n+  readonly avg_segment_size: number;\n+  readonly max_segment_size: number;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "426b68fb8b8ff5f3fdf35e3bd687639fa14d58d7"}, "originalPosition": 38}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTA2OTY3MDQ1", "url": "https://github.com/apache/druid/pull/10496#pullrequestreview-506967045", "createdAt": "2020-10-12T23:03:52Z", "commit": {"oid": "426b68fb8b8ff5f3fdf35e3bd687639fa14d58d7"}, "state": "COMMENTED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTA3MDA5MTk3", "url": "https://github.com/apache/druid/pull/10496#pullrequestreview-507009197", "createdAt": "2020-10-13T01:24:44Z", "commit": {"oid": "426b68fb8b8ff5f3fdf35e3bd687639fa14d58d7"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e5e29a5a6a6ca3e2ba7788ed8fede494e73082db", "author": {"user": {"login": "vogievetsky", "name": "Vadim Ogievetsky"}}, "url": "https://github.com/apache/druid/commit/e5e29a5a6a6ca3e2ba7788ed8fede494e73082db", "committedDate": "2020-10-13T16:01:43Z", "message": "add .druid.pid to gitignore"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "5726fabf695b775701d1d80cb969543971bc2100", "author": {"user": {"login": "vogievetsky", "name": "Vadim Ogievetsky"}}, "url": "https://github.com/apache/druid/commit/5726fabf695b775701d1d80cb969543971bc2100", "committedDate": "2020-10-13T16:13:32Z", "message": "rename segment_size to segment_rows, fix visability, fix divide by zero"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "080d49f8b2eaa02c3e028cff48caa1006bd6e03d", "author": {"user": {"login": "vogievetsky", "name": "Vadim Ogievetsky"}}, "url": "https://github.com/apache/druid/commit/080d49f8b2eaa02c3e028cff48caa1006bd6e03d", "committedDate": "2020-10-13T18:45:47Z", "message": "update snapshots"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTA3Nzk3MDIz", "url": "https://github.com/apache/druid/pull/10496#pullrequestreview-507797023", "createdAt": "2020-10-13T20:18:05Z", "commit": {"oid": "080d49f8b2eaa02c3e028cff48caa1006bd6e03d"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3350, "cost": 1, "resetAt": "2021-10-28T17:48:14Z"}}}