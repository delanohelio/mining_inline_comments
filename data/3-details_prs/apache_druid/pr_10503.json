{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTAwOTA3ODUy", "number": 10503, "title": "Additional documentation for query caching", "bodyText": "Add documentation for the queries that do not support caching.", "createdAt": "2020-10-10T04:28:28Z", "url": "https://github.com/apache/druid/pull/10503", "merged": true, "mergeCommit": {"oid": "04546b65ec481c511ebaf38eac346f351854d92b"}, "closed": true, "closedAt": "2020-10-20T20:49:14Z", "author": {"login": "abhishekagarwal87"}, "timelineItems": {"totalCount": 13, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdNrWw7AH2gAyNTAwOTA3ODUyOjAzMzVlNDJiODc5OTUyOWU0MDE0MTZkZDIzY2M2OTJjZTBmM2RlYmM=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdUHj9aAFqTUxMTk5MDExNQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "0335e42b8799529e401416dd23cc692ce0f3debc", "author": {"user": {"login": "abhishekagarwal87", "name": "Abhishek Agarwal"}}, "url": "https://github.com/apache/druid/commit/0335e42b8799529e401416dd23cc692ce0f3debc", "committedDate": "2020-09-29T17:09:02Z", "message": "Add documentation for when caching is unsupported"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "9528f1eb5495fccac8be0d0ba60363cbd99ffe40", "author": {"user": {"login": "abhishekagarwal87", "name": "Abhishek Agarwal"}}, "url": "https://github.com/apache/druid/commit/9528f1eb5495fccac8be0d0ba60363cbd99ffe40", "committedDate": "2020-10-10T04:27:12Z", "message": "Minor changes"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "88443622f081520061f49bdcdbce3c908deb6978", "author": {"user": {"login": "abhishekagarwal87", "name": "Abhishek Agarwal"}}, "url": "https://github.com/apache/druid/commit/88443622f081520061f49bdcdbce3c908deb6978", "committedDate": "2020-10-10T05:06:46Z", "message": "Merge branch 'master' of github.com:apache/druid into caching_doc"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "04112f3940a291cd5b160c6bddfe7e3eee5b5b49", "author": {"user": {"login": "abhishekagarwal87", "name": "Abhishek Agarwal"}}, "url": "https://github.com/apache/druid/commit/04112f3940a291cd5b160c6bddfe7e3eee5b5b49", "committedDate": "2020-10-13T13:06:13Z", "message": "Minor doc fix"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTA3ODc3MDkw", "url": "https://github.com/apache/druid/pull/10503#pullrequestreview-507877090", "createdAt": "2020-10-13T22:38:27Z", "commit": {"oid": "04112f3940a291cd5b160c6bddfe7e3eee5b5b49"}, "state": "COMMENTED", "comments": {"totalCount": 6, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xM1QyMjozODoyN1rOHg77bw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xM1QyMzoxNDoxNlrOHg8r1g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNDI5ODM1MQ==", "bodyText": "Nice catch. Please add a SQL query example as in https://github.com/apache/druid/pull/10503/files#diff-dae1ec2a726a9b89dfdf6eb74b7d7c4d9397e02eb95cf4ec5ef3ee440fdefd4dR75-R79.", "url": "https://github.com/apache/druid/pull/10503#discussion_r504298351", "createdAt": "2020-10-13T22:38:27Z", "author": {"login": "jihoonson"}, "path": "docs/querying/datasource.md", "diffHunk": "@@ -134,8 +134,6 @@ another will be treated as if they contained all null values in the tables where\n The list of \"dataSources\" must be nonempty. If you want to query an empty dataset, use an [`inline` datasource](#inline)\n instead.\n \n-Union datasources are not available in Druid SQL.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "04112f3940a291cd5b160c6bddfe7e3eee5b5b49"}, "originalPosition": 4}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNDI5OTI0Mg==", "bodyText": "Suggest union operation -> union datasource.", "url": "https://github.com/apache/druid/pull/10503#discussion_r504299242", "createdAt": "2020-10-13T22:40:53Z", "author": {"login": "jihoonson"}, "path": "docs/querying/caching.md", "diffHunk": "@@ -82,3 +82,12 @@ Note that the task executor processes only support caches that keep their data l\n This restriction exists because the cache stores results at the level of intermediate partial segments generated by the\n ingestion tasks. These intermediate partial segments will not necessarily be identical across task replicas, so\n remote cache types such as `memcached` will be ignored by task executor processes.\n+\n+## Unsupported queries\n+\n+Query caching is not available for following\n+- queries, that have a union operation, do not support result-level caching - [More details](https://github.com/apache/druid/issues/8713)", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "04112f3940a291cd5b160c6bddfe7e3eee5b5b49"}, "originalPosition": 8}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNDI5OTc0NA==", "bodyText": "Suggest inline datasource and lookup datasource. \"Datasource\" is the correct terminology to refer a datasource.", "url": "https://github.com/apache/druid/pull/10503#discussion_r504299744", "createdAt": "2020-10-13T22:42:30Z", "author": {"login": "jihoonson"}, "path": "docs/querying/caching.md", "diffHunk": "@@ -82,3 +82,12 @@ Note that the task executor processes only support caches that keep their data l\n This restriction exists because the cache stores results at the level of intermediate partial segments generated by the\n ingestion tasks. These intermediate partial segments will not necessarily be identical across task replicas, so\n remote cache types such as `memcached` will be ignored by task executor processes.\n+\n+## Unsupported queries\n+\n+Query caching is not available for following\n+- queries, that have a union operation, do not support result-level caching - [More details](https://github.com/apache/druid/issues/8713)\n+- queries, that involve an Inline data source or a Lookup data source, do not support any caching. ", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "04112f3940a291cd5b160c6bddfe7e3eee5b5b49"}, "originalPosition": 9}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNDMwMTU5MA==", "bodyText": "Did you intend this line and the below sentences to be separate? If so, please add a colon or a period at the end of this sentence. Also, the below sentences should start with a capital letter.", "url": "https://github.com/apache/druid/pull/10503#discussion_r504301590", "createdAt": "2020-10-13T22:47:23Z", "author": {"login": "jihoonson"}, "path": "docs/querying/caching.md", "diffHunk": "@@ -82,3 +82,12 @@ Note that the task executor processes only support caches that keep their data l\n This restriction exists because the cache stores results at the level of intermediate partial segments generated by the\n ingestion tasks. These intermediate partial segments will not necessarily be identical across task replicas, so\n remote cache types such as `memcached` will be ignored by task executor processes.\n+\n+## Unsupported queries\n+\n+Query caching is not available for following", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "04112f3940a291cd5b160c6bddfe7e3eee5b5b49"}, "originalPosition": 7}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNDMwODMzMA==", "bodyText": "Some missing stuffs:\n\nDataSourceMetadataQuery is never cached.\nAny queries are not cached in brokers if bySegment is set in query context. Historicals don't seem to care about bySegment which I think is a bug. We should never cache when it's set.", "url": "https://github.com/apache/druid/pull/10503#discussion_r504308330", "createdAt": "2020-10-13T23:06:49Z", "author": {"login": "jihoonson"}, "path": "docs/querying/caching.md", "diffHunk": "@@ -82,3 +82,12 @@ Note that the task executor processes only support caches that keep their data l\n This restriction exists because the cache stores results at the level of intermediate partial segments generated by the\n ingestion tasks. These intermediate partial segments will not necessarily be identical across task replicas, so\n remote cache types such as `memcached` will be ignored by task executor processes.\n+\n+## Unsupported queries", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "04112f3940a291cd5b160c6bddfe7e3eee5b5b49"}, "originalPosition": 5}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNDMxMDc0Mg==", "bodyText": "It would be worth linking https://druid.apache.org/docs/0.19.0/querying/query-execution.html#query to help understanding since this requires to know how subquery system works in Druid.", "url": "https://github.com/apache/druid/pull/10503#discussion_r504310742", "createdAt": "2020-10-13T23:14:16Z", "author": {"login": "jihoonson"}, "path": "docs/querying/caching.md", "diffHunk": "@@ -82,3 +82,12 @@ Note that the task executor processes only support caches that keep their data l\n This restriction exists because the cache stores results at the level of intermediate partial segments generated by the\n ingestion tasks. These intermediate partial segments will not necessarily be identical across task replicas, so\n remote cache types such as `memcached` will be ignored by task executor processes.\n+\n+## Unsupported queries\n+\n+Query caching is not available for following\n+- queries, that have a union operation, do not support result-level caching - [More details](https://github.com/apache/druid/issues/8713)\n+- queries, that involve an Inline data source or a Lookup data source, do not support any caching. \n+- queries, with a sub-query in them, do not support any caching though the output of sub-queries itself may be cached.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "04112f3940a291cd5b160c6bddfe7e3eee5b5b49"}, "originalPosition": 10}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "4bc7b459c47da8265cf992749d9eff22ca65e86f", "author": {"user": {"login": "abhishekagarwal87", "name": "Abhishek Agarwal"}}, "url": "https://github.com/apache/druid/commit/4bc7b459c47da8265cf992749d9eff22ca65e86f", "committedDate": "2020-10-14T06:53:32Z", "message": "Review comments"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "6b81672e72736509d6e34bcaac6ee87860881721", "author": {"user": {"login": "abhishekagarwal87", "name": "Abhishek Agarwal"}}, "url": "https://github.com/apache/druid/commit/6b81672e72736509d6e34bcaac6ee87860881721", "committedDate": "2020-10-14T07:28:51Z", "message": "Add more details"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTEwNzk1NDA3", "url": "https://github.com/apache/druid/pull/10503#pullrequestreview-510795407", "createdAt": "2020-10-16T21:00:02Z", "commit": {"oid": "6b81672e72736509d6e34bcaac6ee87860881721"}, "state": "COMMENTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xNlQyMTowMDowMlrOHjPqZA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xNlQyMTo1ODo0NFrOHjQ5eQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNjcxODgyMA==", "bodyText": "../docs/querying/caching.md\n       90 | [related github issue](https://github.com/apa \n>> 1 spelling error found in 167 files\n\nThe CI is failing because of this line. Please add a suppression in website/.spelling. BTW, I think it should be GitHub.", "url": "https://github.com/apache/druid/pull/10503#discussion_r506718820", "createdAt": "2020-10-16T21:00:02Z", "author": {"login": "jihoonson"}, "path": "docs/querying/caching.md", "diffHunk": "@@ -82,3 +82,19 @@ Note that the task executor processes only support caches that keep their data l\n This restriction exists because the cache stores results at the level of intermediate partial segments generated by the\n ingestion tasks. These intermediate partial segments will not necessarily be identical across task replicas, so\n remote cache types such as `memcached` will be ignored by task executor processes.\n+\n+## Unsupported queries\n+\n+Query caching is not available for following:\n+- Queries, that involve a `union` datasource, do not support result-level caching. Refer to the \n+[related github issue](https://github.com/apache/druid/issues/8713) for details. Top level union SQL queries can still ", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "6b81672e72736509d6e34bcaac6ee87860881721"}, "originalPosition": 9}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNjczOTA2NQ==", "bodyText": "I was deliberate in avoiding datasource term since SQL users don't define datasource as such. For them, its just union operator.\n\nEven they don't define datasource by themselves, their query will be translated into native queries, which will determine whether it will be cached or not. I think it will be better to be precise so that users don't get confused.\n\nThough I think Top Level Union queries may still be cached since they are not translated into a Union datasource.\n\nGood point, I'm not sure what you mean by \"Top Level Union queries\" though. In SQL, the union operator can be translated to either DruidUnionDataSourceRule or DruidUnionRule. The former is converted to a union datasource while the later is executed sequentially by the sql layer. AFAIT, the former can be used when it's UNION ALL of flat scan subqueries. The later can be used otherwise (still only for UNION ALL). So, the result-level cache cannot be used for the former, but can for the later. Maybe it could say, \"Queries, that have a union datasource, do not support result-level caching. For SQL, a union SQL query can be translated to a native query with a union datasource when it is a UNION ALL of flat scan subqueries. These queries cannot be cached at the result-level.\"", "url": "https://github.com/apache/druid/pull/10503#discussion_r506739065", "createdAt": "2020-10-16T21:58:44Z", "author": {"login": "jihoonson"}, "path": "docs/querying/caching.md", "diffHunk": "@@ -82,3 +82,12 @@ Note that the task executor processes only support caches that keep their data l\n This restriction exists because the cache stores results at the level of intermediate partial segments generated by the\n ingestion tasks. These intermediate partial segments will not necessarily be identical across task replicas, so\n remote cache types such as `memcached` will be ignored by task executor processes.\n+\n+## Unsupported queries\n+\n+Query caching is not available for following\n+- queries, that have a union operation, do not support result-level caching - [More details](https://github.com/apache/druid/issues/8713)", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNDI5OTI0Mg=="}, "originalCommit": {"oid": "04112f3940a291cd5b160c6bddfe7e3eee5b5b49"}, "originalPosition": 8}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTEwOTk3NzYy", "url": "https://github.com/apache/druid/pull/10503#pullrequestreview-510997762", "createdAt": "2020-10-17T16:29:47Z", "commit": {"oid": "6b81672e72736509d6e34bcaac6ee87860881721"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xN1QxNjoyOTo0N1rOHjeXDA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xN1QxNjoyOTo0N1rOHjeXDA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNjk1OTYyOA==", "bodyText": "The linked issue only refers to segment-level caching.\nI could be wrong but I believe GroupBy V2 does support results-level caching?", "url": "https://github.com/apache/druid/pull/10503#discussion_r506959628", "createdAt": "2020-10-17T16:29:47Z", "author": {"login": "dylwylie"}, "path": "docs/querying/caching.md", "diffHunk": "@@ -82,3 +82,19 @@ Note that the task executor processes only support caches that keep their data l\n This restriction exists because the cache stores results at the level of intermediate partial segments generated by the\n ingestion tasks. These intermediate partial segments will not necessarily be identical across task replicas, so\n remote cache types such as `memcached` will be ignored by task executor processes.\n+\n+## Unsupported queries\n+\n+Query caching is not available for following:\n+- Queries, that involve a `union` datasource, do not support result-level caching. Refer to the \n+[related github issue](https://github.com/apache/druid/issues/8713) for details. Top level union SQL queries can still \n+be cached at result-level since they are not translated into a `union` datasource. Refer to [Union SQL](sql.md#UNION ALL) \n+for more details on how union SQL queries work.\n+- Queries, that involve an `Inline` datasource or a `Lookup` datasource, do not support any caching. \n+- Queries, with a sub-query in them, do not support any caching though the output of sub-queries itself may be cached. \n+Refer to the [Query execution](query-execution.md#query) page for more details on how sub-queries are executed.\n+- Join queries do not support any caching on the broker [More details](https://github.com/apache/druid/issues/10444).\n+- GroupBy v2 queries do not support any caching on broker [More details](https://github.com/apache/druid/issues/3820).", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "6b81672e72736509d6e34bcaac6ee87860881721"}, "originalPosition": 16}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "8d60c3e893f0130c3a4ae3bd90a4d78b0b31017f", "author": {"user": {"login": "abhishekagarwal87", "name": "Abhishek Agarwal"}}, "url": "https://github.com/apache/druid/commit/8d60c3e893f0130c3a4ae3bd90a4d78b0b31017f", "committedDate": "2020-10-17T20:35:12Z", "message": "Fix spelling check"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f8d5900b28402a51298f226294bd27b460ac9763", "author": {"user": {"login": "abhishekagarwal87", "name": "Abhishek Agarwal"}}, "url": "https://github.com/apache/druid/commit/f8d5900b28402a51298f226294bd27b460ac9763", "committedDate": "2020-10-19T17:16:35Z", "message": "Fix doc for union query"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "7e94c7a8595d922edc6cc60737db4be8c749c928", "author": {"user": {"login": "abhishekagarwal87", "name": "Abhishek Agarwal"}}, "url": "https://github.com/apache/druid/commit/7e94c7a8595d922edc6cc60737db4be8c749c928", "committedDate": "2020-10-19T17:21:36Z", "message": "Trailing dot"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTExOTkwMTE1", "url": "https://github.com/apache/druid/pull/10503#pullrequestreview-511990115", "createdAt": "2020-10-19T17:24:20Z", "commit": {"oid": "7e94c7a8595d922edc6cc60737db4be8c749c928"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3364, "cost": 1, "resetAt": "2021-10-28T17:48:14Z"}}}