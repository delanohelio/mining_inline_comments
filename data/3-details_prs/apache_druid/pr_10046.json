{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDM2MTM2NzY1", "number": 10046, "title": "Fix missing temp dir for native single_dim", "bodyText": "Fixes #9467 .\nDescription\nNative single dim indexing throws a file not found exception from\nInputEntityIteratingReader.java:81.\nThis PR moves the temporary directory creation step into TaskTookBox.getIndexingTmpDir so that the directory will be automatically created.  It also removes directory creation code from other callers TaskTookBox.getIndexingTmpDir since they no longer need to create the directory themselves.\nThe change was tested on a Druid cluster.  After installing the change native single_dim indexing\ncompletes successfully.\n\nThis PR has:\n\n been self-reviewed.\n added integration tests.\n been tested in a test Druid cluster.\n\n\nKey changed/added classes in this PR\n\nPartialDimensionDistributionTask", "createdAt": "2020-06-17T22:55:54Z", "url": "https://github.com/apache/druid/pull/10046", "merged": true, "mergeCommit": {"oid": "f6594fff608d4b2e071c7bdd6d86d7f87398ce4f"}, "closed": true, "closedAt": "2020-06-25T21:41:23Z", "author": {"login": "morrifeldman"}, "timelineItems": {"totalCount": 11, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcsRpEwAH2gAyNDM2MTM2NzY1OjVkZWMzMmEzMjE0MmNmZjQxMDU5MWUzMThlNTg4Zjg2ZjgzMzc5MmE=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcuj--uAFqTQzNzEwMjU2OQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "5dec32a32142cff410591e318e588f86f833792a", "author": {"user": null}, "url": "https://github.com/apache/druid/commit/5dec32a32142cff410591e318e588f86f833792a", "committedDate": "2020-06-17T22:32:00Z", "message": "Fix missing temp dir for native single_dim\n\nNative single dim indexing throws a file not found exception from\nInputEntityIteratingReader.java:81.  This MR creates the required\ntemporary directory when setting up the\nPartialDimensionDistributionTask.  The change was tested on a Druid\ncluster.  After installing the change native single_dim indexing\ncompletes successfully."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "bd619ec072ee46e17f3cb6c840a4975dd333eff6", "author": {"user": null}, "url": "https://github.com/apache/druid/commit/bd619ec072ee46e17f3cb6c840a4975dd333eff6", "committedDate": "2020-06-18T18:03:22Z", "message": "Fix indentation"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "4d0ce86a1ba2a44adddb54f67ced320859938f8e", "author": {"user": null}, "url": "https://github.com/apache/druid/commit/4d0ce86a1ba2a44adddb54f67ced320859938f8e", "committedDate": "2020-06-18T18:27:17Z", "message": "Use SinglePhaseSubTask as example for creating the temp dir"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "62909739a51f91ea2a2a955d4b1df2abc77bbdd5", "author": {"user": null}, "url": "https://github.com/apache/druid/commit/62909739a51f91ea2a2a955d4b1df2abc77bbdd5", "committedDate": "2020-06-18T19:51:15Z", "message": "Merge branch 'master' of https://github.com/apache/druid into missing-indexing-tmp-dir"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "36e7fafdb1660b317d7302f5f3bf5b4f18c353f7", "author": {"user": null}, "url": "https://github.com/apache/druid/commit/36e7fafdb1660b317d7302f5f3bf5b4f18c353f7", "committedDate": "2020-06-23T23:07:52Z", "message": "Merge branch 'master' of https://github.com/apache/druid into missing-indexing-tmp-dir"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDM2MjQyNjg4", "url": "https://github.com/apache/druid/pull/10046#pullrequestreview-436242688", "createdAt": "2020-06-24T00:16:01Z", "commit": {"oid": "62909739a51f91ea2a2a955d4b1df2abc77bbdd5"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yNFQwMDoxNjowMVrOGn-wgQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yNFQwMDoxNjowMVrOGn-wgQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NDU3NTg3Mw==", "bodyText": "How about pushing this code into TaskToolbox.getIndexingTmpDir()? We can check if the directory exists first and then create one.", "url": "https://github.com/apache/druid/pull/10046#discussion_r444575873", "createdAt": "2020-06-24T00:16:01Z", "author": {"login": "jihoonson"}, "path": "indexing-service/src/main/java/org/apache/druid/indexing/common/task/batch/parallel/PartialDimensionDistributionTask.java", "diffHunk": "@@ -200,6 +202,10 @@ public TaskStatus runTask(TaskToolbox toolbox) throws Exception\n     Preconditions.checkNotNull(partitionDimension, \"partitionDimension required in partitionsSpec\");\n     boolean isAssumeGrouped = partitionsSpec.isAssumeGrouped();\n \n+    final File tmpDir = toolbox.getIndexingTmpDir();\n+    // Temporary directory is automatically removed when this IndexTask completes.\n+    FileUtils.forceMkdir(tmpDir);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "62909739a51f91ea2a2a955d4b1df2abc77bbdd5"}, "originalPosition": 22}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "055bd2674f9976d6dee1f30f3a696518a9a7309e", "author": {"user": null}, "url": "https://github.com/apache/druid/commit/055bd2674f9976d6dee1f30f3a696518a9a7309e", "committedDate": "2020-06-24T15:12:24Z", "message": "Move temporary indexing dir creation in to TaskToolbox"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "7c50fd918d9f71ee46c3ad1aa31078289775c026", "author": {"user": null}, "url": "https://github.com/apache/druid/commit/7c50fd918d9f71ee46c3ad1aa31078289775c026", "committedDate": "2020-06-24T20:33:39Z", "message": "Remove unused dependency"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "9cd65ca87df39786f13a04c7c420df2a11fc8a6a", "author": {"user": null}, "url": "https://github.com/apache/druid/commit/9cd65ca87df39786f13a04c7c420df2a11fc8a6a", "committedDate": "2020-06-24T21:51:51Z", "message": "Merge remote-tracking branch 'upstream/master' into missing-indexing-tmp-dir"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDM3MDk5MTI2", "url": "https://github.com/apache/druid/pull/10046#pullrequestreview-437099126", "createdAt": "2020-06-25T00:49:58Z", "commit": {"oid": "9cd65ca87df39786f13a04c7c420df2a11fc8a6a"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDM3MTAyNTY5", "url": "https://github.com/apache/druid/pull/10046#pullrequestreview-437102569", "createdAt": "2020-06-25T01:02:04Z", "commit": {"oid": "9cd65ca87df39786f13a04c7c420df2a11fc8a6a"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2111, "cost": 1, "resetAt": "2021-10-28T17:48:14Z"}}}