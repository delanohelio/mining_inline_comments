{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDAzODk0ODMx", "number": 9705, "reviewThreads": {"totalCount": 8, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xNlQwMzoyODoxMlrODyUrOA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xNlQwMzozMjozNVrODyUuLQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjU0MDk0MTM2OnYy", "diffSide": "RIGHT", "path": "web-console/src/views/query-view/column-tree/column-tree-menu/string-menu-items/string-menu-items.tsx", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xNlQwMzoyODoxMlrOGGTN7w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xNlQwMzoyODoxMlrOGGTN7w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwOTI1OTUwMw==", "bodyText": "capitalization", "url": "https://github.com/apache/druid/pull/9705#discussion_r409259503", "createdAt": "2020-04-16T03:28:12Z", "author": {"login": "vogievetsky"}, "path": "web-console/src/views/query-view/column-tree/column-tree-menu/string-menu-items/string-menu-items.tsx", "diffHunk": "@@ -163,13 +167,80 @@ export const StringMenuItems = React.memo(function StringMenuItems(props: String\n     );\n   }\n \n+  function renderJoinMenu(): JSX.Element | undefined {\n+    const { schema, table, columnName, parsedQuery, onQueryChange } = props;\n+    if (schema !== 'lookup' || !parsedQuery) return;\n+\n+    const { originalTableColumn, lookupColumn } = getCurrentColumns(parsedQuery, table);\n+\n+    return (\n+      <>\n+        <MenuItem\n+          icon={IconNames.JOIN_TABLE}\n+          text={parsedQuery.joinTable ? `Replace Join` : `Join`}", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "cf4e8fda7b91f3fde2e529b4679f9a78c68e4b0d"}, "originalPosition": 67}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjU0MDk0MTgzOnYy", "diffSide": "RIGHT", "path": "web-console/src/views/query-view/column-tree/column-tree-menu/string-menu-items/string-menu-items.tsx", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xNlQwMzoyODoyOFrOGGTOMA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xNlQwMzoyODoyOFrOGGTOMA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwOTI1OTU2OA==", "bodyText": "Cap", "url": "https://github.com/apache/druid/pull/9705#discussion_r409259568", "createdAt": "2020-04-16T03:28:28Z", "author": {"login": "vogievetsky"}, "path": "web-console/src/views/query-view/column-tree/column-tree-menu/string-menu-items/string-menu-items.tsx", "diffHunk": "@@ -163,13 +167,80 @@ export const StringMenuItems = React.memo(function StringMenuItems(props: String\n     );\n   }\n \n+  function renderJoinMenu(): JSX.Element | undefined {\n+    const { schema, table, columnName, parsedQuery, onQueryChange } = props;\n+    if (schema !== 'lookup' || !parsedQuery) return;\n+\n+    const { originalTableColumn, lookupColumn } = getCurrentColumns(parsedQuery, table);\n+\n+    return (\n+      <>\n+        <MenuItem\n+          icon={IconNames.JOIN_TABLE}\n+          text={parsedQuery.joinTable ? `Replace Join` : `Join`}\n+        >\n+          <MenuItem\n+            icon={IconNames.LEFT_JOIN}\n+            text={`Left Join`}", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "cf4e8fda7b91f3fde2e529b4679f9a78c68e4b0d"}, "originalPosition": 71}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjU0MDk0MjQ0OnYy", "diffSide": "RIGHT", "path": "web-console/src/views/query-view/column-tree/column-tree-menu/string-menu-items/string-menu-items.tsx", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xNlQwMzoyODo0OVrOGGTOjA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xNlQwMzoyODo0OVrOGGTOjA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwOTI1OTY2MA==", "bodyText": "ditto", "url": "https://github.com/apache/druid/pull/9705#discussion_r409259660", "createdAt": "2020-04-16T03:28:49Z", "author": {"login": "vogievetsky"}, "path": "web-console/src/views/query-view/column-tree/column-tree-menu/string-menu-items/string-menu-items.tsx", "diffHunk": "@@ -163,13 +167,80 @@ export const StringMenuItems = React.memo(function StringMenuItems(props: String\n     );\n   }\n \n+  function renderJoinMenu(): JSX.Element | undefined {\n+    const { schema, table, columnName, parsedQuery, onQueryChange } = props;\n+    if (schema !== 'lookup' || !parsedQuery) return;\n+\n+    const { originalTableColumn, lookupColumn } = getCurrentColumns(parsedQuery, table);\n+\n+    return (\n+      <>\n+        <MenuItem\n+          icon={IconNames.JOIN_TABLE}\n+          text={parsedQuery.joinTable ? `Replace Join` : `Join`}\n+        >\n+          <MenuItem\n+            icon={IconNames.LEFT_JOIN}\n+            text={`Left Join`}\n+            onClick={() => {\n+              onQueryChange(\n+                parsedQuery.addJoin(\n+                  'LEFT',\n+                  SqlRef.fromString(table, schema).upgrade(),\n+                  SqlMulti.sqlMultiFactory('=', [\n+                    SqlRef.fromString(columnName, table, 'lookup'),\n+                    SqlRef.fromString(\n+                      lookupColumn === columnName ? originalTableColumn : 'XXX',\n+                      parsedQuery.getTableName(),\n+                    ),\n+                  ]),\n+                ),\n+                false,\n+              );\n+            }}\n+          />\n+          <MenuItem\n+            icon={IconNames.INNER_JOIN}\n+            text={`Inner Join`}\n+            onClick={() => {\n+              onQueryChange(\n+                parsedQuery.addJoin(\n+                  'INNER',\n+                  SqlRef.fromString(table, schema).upgrade(),\n+                  SqlMulti.sqlMultiFactory('=', [\n+                    SqlRef.fromString(columnName, table, 'lookup'),\n+                    SqlRef.fromString(\n+                      lookupColumn === columnName ? originalTableColumn : 'XXX',\n+                      parsedQuery.getTableName(),\n+                    ),\n+                  ]),\n+                ),\n+                false,\n+              );\n+            }}\n+          />\n+        </MenuItem>\n+        {parsedQuery.onExpression &&\n+          parsedQuery.onExpression instanceof SqlMulti &&\n+          parsedQuery.onExpression.containsColumn(columnName) && (\n+            <MenuItem\n+              icon={IconNames.EXCHANGE}\n+              text={`Remove Join`}", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "cf4e8fda7b91f3fde2e529b4679f9a78c68e4b0d"}, "originalPosition": 115}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjU0MDk0NDgyOnYy", "diffSide": "RIGHT", "path": "web-console/src/views/query-view/column-tree/column-tree.tsx", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xNlQwMzozMDowNVrOGGTP7w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xNlQwMzozMDowNVrOGGTP7w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwOTI2MDAxNQ==", "bodyText": "Cap", "url": "https://github.com/apache/druid/pull/9705#discussion_r409260015", "createdAt": "2020-04-16T03:30:05Z", "author": {"login": "vogievetsky"}, "path": "web-console/src/views/query-view/column-tree/column-tree.tsx", "diffHunk": "@@ -188,6 +214,73 @@ export class ColumnTree extends React.PureComponent<ColumnTreeProps, ColumnTreeS\n                                 }}\n                               />\n                             )}\n+                            {parsedQuery && schema === 'lookup' && (\n+                              <MenuItem\n+                                popoverProps={{ openOnTargetFocus: false }}\n+                                icon={IconNames.JOIN_TABLE}\n+                                text={parsedQuery.joinTable ? `Replace Join` : `Join`}", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "cf4e8fda7b91f3fde2e529b4679f9a78c68e4b0d"}, "originalPosition": 50}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjU0MDk0NTgzOnYy", "diffSide": "RIGHT", "path": "web-console/src/views/query-view/column-tree/column-tree.tsx", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xNlQwMzozMDo0M1rOGGTQgQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xNlQwMzozMDo0M1rOGGTQgQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwOTI2MDE2MQ==", "bodyText": "Sentence case", "url": "https://github.com/apache/druid/pull/9705#discussion_r409260161", "createdAt": "2020-04-16T03:30:43Z", "author": {"login": "vogievetsky"}, "path": "web-console/src/views/query-view/column-tree/column-tree.tsx", "diffHunk": "@@ -188,6 +214,73 @@ export class ColumnTree extends React.PureComponent<ColumnTreeProps, ColumnTreeS\n                                 }}\n                               />\n                             )}\n+                            {parsedQuery && schema === 'lookup' && (\n+                              <MenuItem\n+                                popoverProps={{ openOnTargetFocus: false }}\n+                                icon={IconNames.JOIN_TABLE}\n+                                text={parsedQuery.joinTable ? `Replace Join` : `Join`}\n+                              >\n+                                <MenuItem\n+                                  icon={IconNames.LEFT_JOIN}\n+                                  text={`Left Join`}\n+                                  onClick={() => {\n+                                    const { lookupColumn, originalTableColumn } = getCurrentColumns(\n+                                      parsedQuery,\n+                                      table,\n+                                    );\n+                                    props.onQueryStringChange(\n+                                      parsedQuery.addJoin(\n+                                        'LEFT',\n+                                        SqlRef.fromString(table, schema).upgrade(),\n+                                        SqlMulti.sqlMultiFactory('=', [\n+                                          SqlRef.fromString(lookupColumn, table, 'lookup'),\n+                                          SqlRef.fromString(\n+                                            originalTableColumn,\n+                                            parsedQuery.getTableName(),\n+                                          ),\n+                                        ]),\n+                                      ),\n+                                      false,\n+                                    );\n+                                  }}\n+                                />\n+                                <MenuItem\n+                                  icon={IconNames.INNER_JOIN}\n+                                  text={`Inner Join`}", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "cf4e8fda7b91f3fde2e529b4679f9a78c68e4b0d"}, "originalPosition": 78}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjU0MDk0NjA5OnYy", "diffSide": "RIGHT", "path": "web-console/src/views/query-view/column-tree/column-tree.tsx", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xNlQwMzozMDo1M1rOGGTQrA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xNlQwMzozMDo1M1rOGGTQrA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwOTI2MDIwNA==", "bodyText": "Cap", "url": "https://github.com/apache/druid/pull/9705#discussion_r409260204", "createdAt": "2020-04-16T03:30:53Z", "author": {"login": "vogievetsky"}, "path": "web-console/src/views/query-view/column-tree/column-tree.tsx", "diffHunk": "@@ -188,6 +214,73 @@ export class ColumnTree extends React.PureComponent<ColumnTreeProps, ColumnTreeS\n                                 }}\n                               />\n                             )}\n+                            {parsedQuery && schema === 'lookup' && (\n+                              <MenuItem\n+                                popoverProps={{ openOnTargetFocus: false }}\n+                                icon={IconNames.JOIN_TABLE}\n+                                text={parsedQuery.joinTable ? `Replace Join` : `Join`}\n+                              >\n+                                <MenuItem\n+                                  icon={IconNames.LEFT_JOIN}\n+                                  text={`Left Join`}", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "cf4e8fda7b91f3fde2e529b4679f9a78c68e4b0d"}, "originalPosition": 54}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjU0MDk0NjIzOnYy", "diffSide": "RIGHT", "path": "web-console/src/views/query-view/column-tree/column-tree.tsx", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xNlQwMzozMTowMlrOGGTQxA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xNlQwMzozMTowMlrOGGTQxA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwOTI2MDIyOA==", "bodyText": "Cap", "url": "https://github.com/apache/druid/pull/9705#discussion_r409260228", "createdAt": "2020-04-16T03:31:02Z", "author": {"login": "vogievetsky"}, "path": "web-console/src/views/query-view/column-tree/column-tree.tsx", "diffHunk": "@@ -188,6 +214,73 @@ export class ColumnTree extends React.PureComponent<ColumnTreeProps, ColumnTreeS\n                                 }}\n                               />\n                             )}\n+                            {parsedQuery && schema === 'lookup' && (\n+                              <MenuItem\n+                                popoverProps={{ openOnTargetFocus: false }}\n+                                icon={IconNames.JOIN_TABLE}\n+                                text={parsedQuery.joinTable ? `Replace Join` : `Join`}\n+                              >\n+                                <MenuItem\n+                                  icon={IconNames.LEFT_JOIN}\n+                                  text={`Left Join`}\n+                                  onClick={() => {\n+                                    const { lookupColumn, originalTableColumn } = getCurrentColumns(\n+                                      parsedQuery,\n+                                      table,\n+                                    );\n+                                    props.onQueryStringChange(\n+                                      parsedQuery.addJoin(\n+                                        'LEFT',\n+                                        SqlRef.fromString(table, schema).upgrade(),\n+                                        SqlMulti.sqlMultiFactory('=', [\n+                                          SqlRef.fromString(lookupColumn, table, 'lookup'),\n+                                          SqlRef.fromString(\n+                                            originalTableColumn,\n+                                            parsedQuery.getTableName(),\n+                                          ),\n+                                        ]),\n+                                      ),\n+                                      false,\n+                                    );\n+                                  }}\n+                                />\n+                                <MenuItem\n+                                  icon={IconNames.INNER_JOIN}\n+                                  text={`Inner Join`}\n+                                  onClick={() => {\n+                                    const { lookupColumn, originalTableColumn } = getCurrentColumns(\n+                                      parsedQuery,\n+                                      table,\n+                                    );\n+                                    props.onQueryStringChange(\n+                                      parsedQuery.addJoin(\n+                                        'INNER',\n+                                        SqlRef.fromString(table, schema).upgrade(),\n+                                        SqlMulti.sqlMultiFactory('=', [\n+                                          SqlRef.fromString(lookupColumn, table, 'lookup'),\n+                                          SqlRef.fromString(\n+                                            originalTableColumn,\n+                                            parsedQuery.getTableName(),\n+                                          ),\n+                                        ]),\n+                                      ),\n+                                      false,\n+                                    );\n+                                  }}\n+                                />\n+                              </MenuItem>\n+                            )}\n+                            {parsedQuery &&\n+                              parsedQuery.joinTable &&\n+                              parsedQuery.joinTable.table === table && (\n+                                <MenuItem\n+                                  icon={IconNames.EXCHANGE}\n+                                  text={`Remove Join`}", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "cf4e8fda7b91f3fde2e529b4679f9a78c68e4b0d"}, "originalPosition": 107}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjU0MDk0ODkzOnYy", "diffSide": "RIGHT", "path": "web-console/lib/keywords.js", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xNlQwMzozMjozNVrOGGTSSg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xNlQwMzozMjozNVrOGGTSSg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwOTI2MDYxOA==", "bodyText": "What about RIGHT? Are there any other keywords that are now supported that should go here?", "url": "https://github.com/apache/druid/pull/9705#discussion_r409260618", "createdAt": "2020-04-16T03:32:35Z", "author": {"login": "vogievetsky"}, "path": "web-console/lib/keywords.js", "diffHunk": "@@ -34,6 +34,10 @@ exports.SQL_KEYWORDS = [\n   'DESC',\n   'LIMIT',\n   'UNION ALL',\n+  'JOIN',\n+  'LEFT',\n+  'INNER',\n+  'ON',", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "cf4e8fda7b91f3fde2e529b4679f9a78c68e4b0d"}, "originalPosition": 7}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2550, "cost": 1, "resetAt": "2021-11-12T11:18:39Z"}}}