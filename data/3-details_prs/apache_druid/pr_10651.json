{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTMzODAwODQx", "number": 10651, "title": "fixed input source sampler buildReader exp", "bodyText": "Description\nCreation of InputSourceReader can throw an exception, right now it's not mapped to SamplerException that leads Web Console to hide error descriptions.\nThe change is simple - moving InputSourceReader creation in try-catch-block.\n\n\n\n\n\n\n\n\nThis PR has:\n\n been self-reviewed.\n\n using the concurrency checklist (Remove this item if the PR doesn't have any relation to concurrency.)\n\n\n added documentation for new or modified features or behaviors.\n added Javadocs for most classes and all non-trivial methods. Linked related entities via Javadoc links.\n added or updated version, license, or notice information in licenses.yaml\n added comments explaining the \"why\" and the intent of the code wherever would not be obvious for an unfamiliar reader.\n added unit tests or modified existing tests to cover new code paths, ensuring the threshold for code coverage is met.\n added integration tests.\n been tested in a test Druid cluster.", "createdAt": "2020-12-07T16:37:24Z", "url": "https://github.com/apache/druid/pull/10651", "merged": true, "mergeCommit": {"oid": "5d8a69ecf9fa1bbe212bc1ee433092be0425f3b6"}, "closed": true, "closedAt": "2021-02-05T21:33:55Z", "author": {"login": "egor-ryashin"}, "timelineItems": {"totalCount": 7, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdj3ZSXgH2gAyNTMzODAwODQxOmIyMDNiZjg5NWQ2YTlmYWUyYzJjMjY5OTRjOWI0NGRkODY4OWZmMjQ=", "endCursor": "Y3Vyc29yOnYyOpPPAAABd3PikKAFqTU4NDY4MzU0Mg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "b203bf895d6a9fae2c2c26994c9b44dd8689ff24", "author": {"user": null}, "url": "https://github.com/apache/druid/commit/b203bf895d6a9fae2c2c26994c9b44dd8689ff24", "committedDate": "2020-12-07T15:36:59Z", "message": "fixed input source sampler buildReader exp"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTQ2MzM0MTA5", "url": "https://github.com/apache/druid/pull/10651#pullrequestreview-546334109", "createdAt": "2020-12-07T16:46:03Z", "commit": {"oid": "b203bf895d6a9fae2c2c26994c9b44dd8689ff24"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTQ2NDIxOTE0", "url": "https://github.com/apache/druid/pull/10651#pullrequestreview-546421914", "createdAt": "2020-12-07T18:29:53Z", "commit": {"oid": "b203bf895d6a9fae2c2c26994c9b44dd8689ff24"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0wN1QxODoyOTo1M1rOIA0kHw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0wN1QxODoyOTo1M1rOIA0kHw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNzczMjEyNw==", "bodyText": "@egor-ryashin Can you add a test that shows what happens when an error is thrown when building an InputSourceReader", "url": "https://github.com/apache/druid/pull/10651#discussion_r537732127", "createdAt": "2020-12-07T18:29:53Z", "author": {"login": "suneet-s"}, "path": "indexing-service/src/main/java/org/apache/druid/indexing/overlord/sampler/InputSourceSampler.java", "diffHunk": "@@ -103,90 +103,102 @@ public SamplerResponse sample(\n     final File tempDir = FileUtils.createTempDir();\n     closer.register(() -> FileUtils.deleteDirectory(tempDir));\n \n-    final InputSourceReader reader = buildReader(\n-        nonNullSamplerConfig,\n-        nonNullDataSchema,\n-        inputSource,\n-        inputFormat,\n-        tempDir\n-    );\n-    try (final CloseableIterator<InputRowListPlusRawValues> iterator = reader.sample();\n-         final IncrementalIndex<Aggregator> index = buildIncrementalIndex(nonNullSamplerConfig, nonNullDataSchema);\n-         final Closer closer1 = closer) {\n-      List<SamplerResponseRow> responseRows = new ArrayList<>(nonNullSamplerConfig.getNumRows());\n-      int numRowsIndexed = 0;\n-\n-      while (responseRows.size() < nonNullSamplerConfig.getNumRows() && iterator.hasNext()) {\n-        final InputRowListPlusRawValues inputRowListPlusRawValues = iterator.next();\n-\n-        final List<Map<String, Object>> rawColumnsList = inputRowListPlusRawValues.getRawValuesList();\n-\n-        final ParseException parseException = inputRowListPlusRawValues.getParseException();\n-        if (parseException != null) {\n-          if (rawColumnsList != null) {\n-            // add all rows to response\n-            responseRows.addAll(rawColumnsList.stream()\n-                                              .map(rawColumns -> new SamplerResponseRow(rawColumns, null, true, parseException.getMessage()))\n-                                              .collect(Collectors.toList()));\n-          } else {\n-            // no data parsed, add one response row\n-            responseRows.add(new SamplerResponseRow(null, null, true, parseException.getMessage()));\n+    try {\n+      final InputSourceReader reader = buildReader(\n+          nonNullSamplerConfig,\n+          nonNullDataSchema,\n+          inputSource,\n+          inputFormat,\n+          tempDir\n+      );", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b203bf895d6a9fae2c2c26994c9b44dd8689ff24"}, "originalPosition": 39}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "35d23f712dd21589f4819b7e41d63594a691c774", "author": {"user": null}, "url": "https://github.com/apache/druid/commit/35d23f712dd21589f4819b7e41d63594a691c774", "committedDate": "2021-02-05T11:18:05Z", "message": "sampler exception unit test"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "03dcde314cd3cd104afe1cba537a162279e29bc5", "author": {"user": {"login": "egor-ryashin", "name": "Egor Riashin"}}, "url": "https://github.com/apache/druid/commit/03dcde314cd3cd104afe1cba537a162279e29bc5", "committedDate": "2021-02-05T11:25:55Z", "message": "Merge branch 'master' into fix-iss-build-reader-exp"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b28cd1df91f0731dea5c7d5932c5a966ada98ff9", "author": {"user": null}, "url": "https://github.com/apache/druid/commit/b28cd1df91f0731dea5c7d5932c5a966ada98ff9", "committedDate": "2021-02-05T11:27:21Z", "message": "styling"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTg0NjgzNTQy", "url": "https://github.com/apache/druid/pull/10651#pullrequestreview-584683542", "createdAt": "2021-02-05T20:29:24Z", "commit": {"oid": "b28cd1df91f0731dea5c7d5932c5a966ada98ff9"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3147, "cost": 1, "resetAt": "2021-10-28T17:48:14Z"}}}