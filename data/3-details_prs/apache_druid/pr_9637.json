{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDAwMTAwMjMy", "number": 9637, "title": "druid-pac4j: add ability to use custom ssl trust store while talking to auth  server", "bodyText": "Description\nThis feature is to enable users who use non-standard or self signed SSL certs on the auth server. Similar feature  exists in other Druid  features communicating with external LDAP server for example.\nIt was initially highlighted in #8992 (comment)\n\nThis PR has:\n\n been self-reviewed.\n\n using the concurrency checklist (Remove this item if the PR doesn't have any relation to concurrency.)\n\n\n added documentation for new or modified features or behaviors.\n added Javadocs for most classes and all non-trivial methods. Linked related entities via Javadoc links.\n added or updated version, license, or notice information in licenses.yaml\n added comments explaining the \"why\" and the intent of the code wherever would not be obvious for an unfamiliar reader.\n added unit tests or modified existing tests to cover new code paths.\n added integration tests.\n been tested in a test Druid cluster.", "createdAt": "2020-04-07T07:51:19Z", "url": "https://github.com/apache/druid/pull/9637", "merged": true, "mergeCommit": {"oid": "ca369e57683cdb907d2bf2fcd32c39fac48a94e6"}, "closed": true, "closedAt": "2020-04-11T01:02:00Z", "author": {"login": "himanshug"}, "timelineItems": {"totalCount": 8, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcVjIBiABqjMyMTI5NDcwOTg=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcWY95qgH2gAyNDAwMTAwMjMyOjU3ZmE3OTZkZmIyZjBlODgxYmI5NjJjYjczOWMwNDk1MDc5ZDRmMTY=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "HeadRefForcePushedEvent", "beforeCommit": null, "afterCommit": null}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": null, "afterCommit": null}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": null, "afterCommit": null}, {"__typename": "PullRequestCommit", "commit": {"oid": "fec751e20ca9befd5ddd6f330207725023ccdf8d", "author": {"user": {"login": "himanshug", "name": "Himanshu"}}, "url": "https://github.com/apache/druid/commit/fec751e20ca9befd5ddd6f330207725023ccdf8d", "committedDate": "2020-04-08T18:03:38Z", "message": "druid-pac4j: add ability for custom ssl trust store for talking to auth\nserver"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": null, "afterCommit": {"oid": "fec751e20ca9befd5ddd6f330207725023ccdf8d", "author": {"user": {"login": "himanshug", "name": "Himanshu"}}, "url": "https://github.com/apache/druid/commit/fec751e20ca9befd5ddd6f330207725023ccdf8d", "committedDate": "2020-04-08T18:03:38Z", "message": "druid-pac4j: add ability for custom ssl trust store for talking to auth\nserver"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzkxNjY1MDA2", "url": "https://github.com/apache/druid/pull/9637#pullrequestreview-391665006", "createdAt": "2020-04-10T21:08:08Z", "commit": {"oid": "fec751e20ca9befd5ddd6f330207725023ccdf8d"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xMFQyMTowODowOFrOGEF9aw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xMFQyMTowODowOFrOGEF9aw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNjk0NTEzMQ==", "bodyText": "I think reusing simple-client-sslcontext is good for now since the client is the same entity (a Druid server); are there any potential cases where you'd want to use a different truststore or keystore when talking to the auth server here vs. another Druid server?", "url": "https://github.com/apache/druid/pull/9637#discussion_r406945131", "createdAt": "2020-04-10T21:08:08Z", "author": {"login": "jon-wei"}, "path": "docs/development/extensions-core/druid-pac4j.md", "diffHunk": "@@ -38,8 +38,9 @@ druid.auth.authenticator.pac4j.type=pac4j\n ### Properties\n |Property|Description|Default|required|\n |--------|---------------|-----------|-------|--------|\n+|`druid.auth.pac4j.cookiePassphrase`|passphrase for encrypting the cookies used to manage authentication session with browser. It can be provided as plaintext string or The [Password Provider](../../operations/password-provider.md).|none|Yes|\n+|`druid.auth.pac4j.readTimeout`|Socket connect and read timeout duration used when communicating with authentication server|PT5S|No|\n+|`druid.auth.pac4j.enableCustomSslContext`|Whether to use custom SSLContext setup via [simple-client-sslcontext](simple-client-sslcontext.md) extension which must be added to extensions list when this property is set to true.|false|No|", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "fec751e20ca9befd5ddd6f330207725023ccdf8d"}, "originalPosition": 6}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzkxNjg5OTgy", "url": "https://github.com/apache/druid/pull/9637#pullrequestreview-391689982", "createdAt": "2020-04-10T22:23:27Z", "commit": {"oid": "fec751e20ca9befd5ddd6f330207725023ccdf8d"}, "state": "APPROVED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xMFQyMjoyMzoyN1rOGEHUaw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xMFQyMjoyMzoyN1rOGEHUaw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNjk2NzQwMw==", "bodyText": "I think the original class in the comment should be com.nimbusds.jose.util.DefaultResourceRetriever.", "url": "https://github.com/apache/druid/pull/9637#discussion_r406967403", "createdAt": "2020-04-10T22:23:27Z", "author": {"login": "jon-wei"}, "path": "extensions-core/druid-pac4j/src/main/java/org/apache/druid/security/pac4j/CustomSSLResourceRetriever.java", "diffHunk": "@@ -0,0 +1,60 @@\n+/*\n+ * Licensed to the Apache Software Foundation (ASF) under one\n+ * or more contributor license agreements.  See the NOTICE file\n+ * distributed with this work for additional information\n+ * regarding copyright ownership.  The ASF licenses this file\n+ * to you under the Apache License, Version 2.0 (the\n+ * \"License\"); you may not use this file except in compliance\n+ * with the License.  You may obtain a copy of the License at\n+ *\n+ *   http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing,\n+ * software distributed under the License is distributed on an\n+ * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n+ * KIND, either express or implied.  See the License for the\n+ * specific language governing permissions and limitations\n+ * under the License.\n+ */\n+\n+package org.apache.druid.security.pac4j;\n+\n+\n+import com.google.common.primitives.Ints;\n+import com.nimbusds.jose.util.DefaultResourceRetriever;\n+\n+import javax.net.ssl.HttpsURLConnection;\n+import javax.net.ssl.SSLSocketFactory;\n+import java.io.IOException;\n+import java.net.HttpURLConnection;\n+import java.net.URL;\n+\n+\n+/**\n+ * This class exists only to enable use of custom SSLSocketFactory on top of builtin class. This could be removed\n+ * when same functionality has been added to original class com.nimbusds.jose.util.CustomSSLResourceRetriever.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "fec751e20ca9befd5ddd6f330207725023ccdf8d"}, "originalPosition": 35}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "57fa796dfb2f0e881bb962cb739c0495079d4f16", "author": {"user": {"login": "himanshug", "name": "Himanshu"}}, "url": "https://github.com/apache/druid/commit/57fa796dfb2f0e881bb962cb739c0495079d4f16", "committedDate": "2020-04-10T22:37:45Z", "message": "fix nimbusds DefaultResourceRetriever name in comment"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2451, "cost": 1, "resetAt": "2021-10-28T17:48:14Z"}}}