{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTEwNDMzOTA0", "number": 10533, "title": "Web console: improve make type preservation in ingestion configs in the data loader", "bodyText": "This PR fixes an issue that in the data loader if you toggle the rollup it loses any previously entered type information because it will simply rescan the sample. It makes a couple of other fixes also.\nThis work was done as a result of 2 user studies where people loaded data into Druid via the data loader and then user a couple of other parts of the console.\nThis PR also refactors all the druid concepts into the druid-modals directory and breaks them up a bit so they are not just huge files (bad code smell).\nIn addition to that this PR also:\n\nAdds a Partitioning column (derived from shardSpec) to the segment view (see screenshot)\nAdds a Segment granularity column to the datasource view (see screenshot)\nCreates a framework where auto form fields could be used to verify the modal reducing redundancy\nAdds an optional validator prop to the JsonInput to let it surface higher level errors\nAllows for using a __time transform in the parse time step of the data loader\nFixes the issue the it was not possible to edit the tuningConfig.partitionsSpec.type from the Edit spec step of the data loader\nAdds oneOf utility function to make AutoForm definitions more succinct\nFixes the height of the icons in the data loader splash screen so it does not bounce\nUses the improved escaping from druid-query-toolkit to make data view tables' filtering better\nFixes some typos\n\nPartitioning column\n\nSegment granularity column", "createdAt": "2020-10-27T03:09:12Z", "url": "https://github.com/apache/druid/pull/10533", "merged": true, "mergeCommit": {"oid": "ee61a165e3142149595362a01211227f2ce3b07a"}, "closed": true, "closedAt": "2020-10-31T02:02:45Z", "author": {"login": "vogievetsky"}, "timelineItems": {"totalCount": 29, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdWdCxxgH2gAyNTEwNDMzOTA0Ojg5NjljNmU3Y2VmNTgyYmI2NWY2NzVjMWJjZTk4ZDcyNTEwOGM0ODI=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdXu5IqAH2gAyNTEwNDMzOTA0OmViYjc1OTZhZTZlOWZhMDYxNTgwYWQ5OGE2YTU1ZTg3YjY0MTUwOGM=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "8969c6e7cef582bb65f675c1bce98d725108c482", "author": {"user": {"login": "vogievetsky", "name": "Vadim Ogievetsky"}}, "url": "https://github.com/apache/druid/commit/8969c6e7cef582bb65f675c1bce98d725108c482", "committedDate": "2020-10-26T23:33:51Z", "message": "improve validation"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b9aa89cbbd99c4d0bc253df8a8b13f17e254ce24", "author": {"user": {"login": "vogievetsky", "name": "Vadim Ogievetsky"}}, "url": "https://github.com/apache/druid/commit/b9aa89cbbd99c4d0bc253df8a8b13f17e254ce24", "committedDate": "2020-10-26T23:33:51Z", "message": "move to druid modals"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "26bb2a505474c4b81241e68c3b7aa5d67d119257", "author": {"user": {"login": "vogievetsky", "name": "Vadim Ogievetsky"}}, "url": "https://github.com/apache/druid/commit/26bb2a505474c4b81241e68c3b7aa5d67d119257", "committedDate": "2020-10-26T23:33:51Z", "message": "adjust specs"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "9081100917aa01888d849cf72eb8cb4af35b2976", "author": {"user": {"login": "vogievetsky", "name": "Vadim Ogievetsky"}}, "url": "https://github.com/apache/druid/commit/9081100917aa01888d849cf72eb8cb4af35b2976", "committedDate": "2020-10-26T23:33:51Z", "message": "oneOf"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "46b88fa61ec1cf56358b9844de325b55cce969ad", "author": {"user": {"login": "vogievetsky", "name": "Vadim Ogievetsky"}}, "url": "https://github.com/apache/druid/commit/46b88fa61ec1cf56358b9844de325b55cce969ad", "committedDate": "2020-10-26T23:33:51Z", "message": "move transform"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ce44c205cb53571386002ade22fdf37a874b721b", "author": {"user": {"login": "vogievetsky", "name": "Vadim Ogievetsky"}}, "url": "https://github.com/apache/druid/commit/ce44c205cb53571386002ade22fdf37a874b721b", "committedDate": "2020-10-26T23:33:51Z", "message": "segment grans"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "14ef365a49bc05867a0cc09e5b34e79ec5ba8357", "author": {"user": {"login": "vogievetsky", "name": "Vadim Ogievetsky"}}, "url": "https://github.com/apache/druid/commit/14ef365a49bc05867a0cc09e5b34e79ec5ba8357", "committedDate": "2020-10-26T23:33:51Z", "message": "tidy up webpack"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "8e9a68902fbdedca4697938d860ae90593b3e4c8", "author": {"user": {"login": "vogievetsky", "name": "Vadim Ogievetsky"}}, "url": "https://github.com/apache/druid/commit/8e9a68902fbdedca4697938d860ae90593b3e4c8", "committedDate": "2020-10-26T23:33:51Z", "message": "add Partitioning"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e2ef8d29478c372d72316098d28bd89472777a7d", "author": {"user": {"login": "vogievetsky", "name": "Vadim Ogievetsky"}}, "url": "https://github.com/apache/druid/commit/e2ef8d29478c372d72316098d28bd89472777a7d", "committedDate": "2020-10-26T23:33:51Z", "message": "break out druid models"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a0242333deb15d4c8f814075445d0fadec00cc96", "author": {"user": {"login": "vogievetsky", "name": "Vadim Ogievetsky"}}, "url": "https://github.com/apache/druid/commit/a0242333deb15d4c8f814075445d0fadec00cc96", "committedDate": "2020-10-26T23:33:51Z", "message": "tidy up"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "2590de67e58048e9123cc8a5ca008eadd71e00a8", "author": {"user": {"login": "vogievetsky", "name": "Vadim Ogievetsky"}}, "url": "https://github.com/apache/druid/commit/2590de67e58048e9123cc8a5ca008eadd71e00a8", "committedDate": "2020-10-26T23:33:51Z", "message": "rename to Expression"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "941f1bc0f452306351b074b0e3b6511e4d9c2c32", "author": {"user": {"login": "vogievetsky", "name": "Vadim Ogievetsky"}}, "url": "https://github.com/apache/druid/commit/941f1bc0f452306351b074b0e3b6511e4d9c2c32", "committedDate": "2020-10-26T23:33:51Z", "message": "move druid time"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b7007d5df71ac1cbf67498dd3c8dd014ad5424cc", "author": {"user": {"login": "vogievetsky", "name": "Vadim Ogievetsky"}}, "url": "https://github.com/apache/druid/commit/b7007d5df71ac1cbf67498dd3c8dd014ad5424cc", "committedDate": "2020-10-26T23:53:44Z", "message": "cleanup"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "608a8acccb09e087caec4bd2076a7a998968edd9", "author": {"user": {"login": "vogievetsky", "name": "Vadim Ogievetsky"}}, "url": "https://github.com/apache/druid/commit/608a8acccb09e087caec4bd2076a7a998968edd9", "committedDate": "2020-10-27T00:11:38Z", "message": "update format"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "63adebc4c08fe7cd35e7884b1a4fb1a13908ba93", "author": {"user": {"login": "vogievetsky", "name": "Vadim Ogievetsky"}}, "url": "https://github.com/apache/druid/commit/63adebc4c08fe7cd35e7884b1a4fb1a13908ba93", "committedDate": "2020-10-27T03:08:27Z", "message": "better detail"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d84b21b1a993a0af215b26a4f5cec1f564ee9201", "author": {"user": {"login": "vogievetsky", "name": "Vadim Ogievetsky"}}, "url": "https://github.com/apache/druid/commit/d84b21b1a993a0af215b26a4f5cec1f564ee9201", "committedDate": "2020-10-27T06:25:21Z", "message": "fix e2e test"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "13628967ed279dc7e3de14eb7a0bab5af07f6175", "author": {"user": {"login": "vogievetsky", "name": "Vadim Ogievetsky"}}, "url": "https://github.com/apache/druid/commit/13628967ed279dc7e3de14eb7a0bab5af07f6175", "committedDate": "2020-10-27T17:48:37Z", "message": "remove forceGuaranteedRollup from e2e tests"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a4ea7a6b2701246a7a3e93fa2a2fbe46e0895960", "author": {"user": {"login": "vogievetsky", "name": "Vadim Ogievetsky"}}, "url": "https://github.com/apache/druid/commit/a4ea7a6b2701246a7a3e93fa2a2fbe46e0895960", "committedDate": "2020-10-28T00:17:47Z", "message": "clean up imports"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "05c442758787b5133ad20bbd5cd9de314a3ddb52", "author": {"user": {"login": "vogievetsky", "name": "Vadim Ogievetsky"}}, "url": "https://github.com/apache/druid/commit/05c442758787b5133ad20bbd5cd9de314a3ddb52", "committedDate": "2020-10-29T01:41:51Z", "message": "shardSpec -> shard_spec"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "054a29abb18083e3e34e751df9085d00f65995a6", "author": {"user": {"login": "vogievetsky", "name": "Vadim Ogievetsky"}}, "url": "https://github.com/apache/druid/commit/054a29abb18083e3e34e751df9085d00f65995a6", "committedDate": "2020-10-29T05:25:42Z", "message": "fix css"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "52784797fc4eb773c52153550983a2951202f809", "author": {"user": {"login": "vogievetsky", "name": "Vadim Ogievetsky"}}, "url": "https://github.com/apache/druid/commit/52784797fc4eb773c52153550983a2951202f809", "committedDate": "2020-10-29T17:48:03Z", "message": "adjust snapshot"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d57c9e296d5c3b2902c0b3c024acd27d5e1e1b27", "author": {"user": {"login": "vogievetsky", "name": "Vadim Ogievetsky"}}, "url": "https://github.com/apache/druid/commit/d57c9e296d5c3b2902c0b3c024acd27d5e1e1b27", "committedDate": "2020-10-29T18:53:33Z", "message": "add granularity to segments view"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "0d02c778c6d98c907fe042c64f8df413efa1c728", "author": {"user": {"login": "vogievetsky", "name": "Vadim Ogievetsky"}}, "url": "https://github.com/apache/druid/commit/0d02c778c6d98c907fe042c64f8df413efa1c728", "committedDate": "2020-10-29T20:43:29Z", "message": "rename to Time span"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "50f7a55778174aee775337f4302884087b47e5bb", "author": {"user": {"login": "vogievetsky", "name": "Vadim Ogievetsky"}}, "url": "https://github.com/apache/druid/commit/50f7a55778174aee775337f4302884087b47e5bb", "committedDate": "2020-10-29T22:18:52Z", "message": "use OFFSET in segments view query"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTIwOTg1MDI4", "url": "https://github.com/apache/druid/pull/10533#pullrequestreview-520985028", "createdAt": "2020-10-30T19:41:59Z", "commit": {"oid": "50f7a55778174aee775337f4302884087b47e5bb"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0zMFQxOTo0MTo1OVrOHrdpjQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0zMFQxOTo0MTo1OVrOHrdpjQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNTMzNjU4OQ==", "bodyText": "does this info text always display 'parquet' column even when shown for orc and avro_ocf?", "url": "https://github.com/apache/druid/pull/10533#discussion_r515336589", "createdAt": "2020-10-30T19:41:59Z", "author": {"login": "clintropolis"}, "path": "web-console/src/druid-models/input-format.tsx", "diffHunk": "@@ -0,0 +1,138 @@\n+/*\n+ * Licensed to the Apache Software Foundation (ASF) under one\n+ * or more contributor license agreements.  See the NOTICE file\n+ * distributed with this work for additional information\n+ * regarding copyright ownership.  The ASF licenses this file\n+ * to you under the Apache License, Version 2.0 (the\n+ * \"License\"); you may not use this file except in compliance\n+ * with the License.  You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+import React from 'react';\n+\n+import { AutoForm, ExternalLink, Field } from '../components';\n+import { getLink } from '../links';\n+import { oneOf } from '../utils';\n+\n+import { FlattenSpec } from './flatten-spec';\n+\n+export interface InputFormat {\n+  type: string;\n+  findColumnsFromHeader?: boolean;\n+  skipHeaderRows?: number;\n+  columns?: string[];\n+  listDelimiter?: string;\n+  pattern?: string;\n+  function?: string;\n+  flattenSpec?: FlattenSpec;\n+  keepNullColumns?: boolean;\n+}\n+\n+export const INPUT_FORMAT_FIELDS: Field<InputFormat>[] = [\n+  {\n+    name: 'type',\n+    label: 'Input format',\n+    type: 'string',\n+    suggestions: ['json', 'csv', 'tsv', 'regex', 'parquet', 'orc', 'avro_ocf'],\n+    required: true,\n+    info: (\n+      <>\n+        <p>The parser used to parse the data.</p>\n+        <p>\n+          For more information see{' '}\n+          <ExternalLink href={`${getLink('DOCS')}/ingestion/data-formats.html`}>\n+            the documentation\n+          </ExternalLink>\n+          .\n+        </p>\n+      </>\n+    ),\n+  },\n+  {\n+    name: 'pattern',\n+    type: 'string',\n+    required: true,\n+    defined: (p: InputFormat) => p.type === 'regex',\n+  },\n+  {\n+    name: 'function',\n+    type: 'string',\n+    required: true,\n+    defined: (p: InputFormat) => p.type === 'javascript',\n+  },\n+  {\n+    name: 'findColumnsFromHeader',\n+    type: 'boolean',\n+    required: true,\n+    defined: (p: InputFormat) => oneOf(p.type, 'csv', 'tsv'),\n+  },\n+  {\n+    name: 'skipHeaderRows',\n+    type: 'number',\n+    defaultValue: 0,\n+    defined: (p: InputFormat) => oneOf(p.type, 'csv', 'tsv'),\n+    min: 0,\n+    info: (\n+      <>\n+        If both skipHeaderRows and hasHeaderRow options are set, skipHeaderRows is first applied.\n+        For example, if you set skipHeaderRows to 2 and hasHeaderRow to true, Druid will skip the\n+        first two lines and then extract column information from the third line.\n+      </>\n+    ),\n+  },\n+  {\n+    name: 'columns',\n+    type: 'string-array',\n+    required: (p: InputFormat) =>\n+      (oneOf(p.type, 'csv', 'tsv') && !p.findColumnsFromHeader) || p.type === 'regex',\n+    defined: (p: InputFormat) =>\n+      (oneOf(p.type, 'csv', 'tsv') && !p.findColumnsFromHeader) || p.type === 'regex',\n+  },\n+  {\n+    name: 'delimiter',\n+    type: 'string',\n+    defaultValue: '\\t',\n+    defined: (p: InputFormat) => p.type === 'tsv',\n+    info: <>A custom delimiter for data values.</>,\n+  },\n+  {\n+    name: 'listDelimiter',\n+    type: 'string',\n+    defined: (p: InputFormat) => oneOf(p.type, 'csv', 'tsv', 'regex'),\n+    info: <>A custom delimiter for multi-value dimensions.</>,\n+  },\n+  {\n+    name: 'binaryAsString',\n+    type: 'boolean',\n+    defaultValue: false,\n+    defined: (p: InputFormat) => oneOf(p.type, 'parquet', 'orc', 'avro_ocf'),\n+    info: (\n+      <>\n+        Specifies if the bytes parquet column which is not logically marked as a string or enum type\n+        should be treated as a UTF-8 encoded string.\n+      </>\n+    ),", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "50f7a55778174aee775337f4302884087b47e5bb"}, "originalPosition": 122}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b91dcafddc6f61885ca7398c7c14790a73aec11d", "author": {"user": {"login": "vogievetsky", "name": "Vadim Ogievetsky"}}, "url": "https://github.com/apache/druid/commit/b91dcafddc6f61885ca7398c7c14790a73aec11d", "committedDate": "2020-10-30T22:05:23Z", "message": "update doc links"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTIxMDY0Mzk1", "url": "https://github.com/apache/druid/pull/10533#pullrequestreview-521064395", "createdAt": "2020-10-30T22:14:13Z", "commit": {"oid": "b91dcafddc6f61885ca7398c7c14790a73aec11d"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c85350615ade44c8ccbdff367273461f06aa6829", "author": {"user": {"login": "vogievetsky", "name": "Vadim Ogievetsky"}}, "url": "https://github.com/apache/druid/commit/c85350615ade44c8ccbdff367273461f06aa6829", "committedDate": "2020-10-30T22:23:22Z", "message": "simplify require"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ebb7596ae6e9fa061580ad98a6a55e87b641508c", "author": {"user": {"login": "vogievetsky", "name": "Vadim Ogievetsky"}}, "url": "https://github.com/apache/druid/commit/ebb7596ae6e9fa061580ad98a6a55e87b641508c", "committedDate": "2020-10-30T22:55:32Z", "message": "more oneOf"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3409, "cost": 1, "resetAt": "2021-10-28T17:48:14Z"}}}