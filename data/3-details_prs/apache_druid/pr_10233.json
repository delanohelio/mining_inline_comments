{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDYyMjk3MjYw", "number": 10233, "title": "Add \"offset\" parameter to the Scan query.", "bodyText": "It works by doing the query as normal and then throwing away the first \"offset\" number of rows on the broker.\nAlso includes some logic to skip writing the limit field in JSON if it's Long.MAX_VALUE (internally this is used to signify \"unlimited\").\nEdit: Now also includes changes geared towards stabilizing Scan query result ordering, which is required for offset-based pagination to be useful. See #10233 (comment)", "createdAt": "2020-08-03T17:13:54Z", "url": "https://github.com/apache/druid/pull/10233", "merged": true, "mergeCommit": {"oid": "6cca7242de629ad07478c6792b01dc1f37dc6b40"}, "closed": true, "closedAt": "2020-08-13T21:56:25Z", "author": {"login": "gianm"}, "timelineItems": {"totalCount": 20, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABc7VPGlgH2gAyNDYyMjk3MjYwOjdlMzUyYjY4ZDgwMWQyMzg0ZTg5OGNmNTUwYjk2YTgyMjNkMTRkN2Q=", "endCursor": "Y3Vyc29yOnYyOpPPAAABc-nJ2zgFqTQ2NzE1MzQ4Mg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "7e352b68d801d2384e898cf550b96a8223d14d7d", "author": {"user": {"login": "gianm", "name": "Gian Merlino"}}, "url": "https://github.com/apache/druid/commit/7e352b68d801d2384e898cf550b96a8223d14d7d", "committedDate": "2020-08-03T17:12:07Z", "message": "Add \"offset\" parameter to the Scan query.\n\nIt works by doing the query as normal and then throwing away the first\n\"offset\" number of rows on the broker."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "8aa3102a10d54bed6898b2c945e3363e4a433600", "author": {"user": {"login": "gianm", "name": "Gian Merlino"}}, "url": "https://github.com/apache/druid/commit/8aa3102a10d54bed6898b2c945e3363e4a433600", "committedDate": "2020-08-03T17:55:01Z", "message": "Fix constructor call."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "3990052fb13ad1cb73b23bf12fa4dc2765432298", "author": {"user": {"login": "gianm", "name": "Gian Merlino"}}, "url": "https://github.com/apache/druid/commit/3990052fb13ad1cb73b23bf12fa4dc2765432298", "committedDate": "2020-08-03T17:56:22Z", "message": "Fix up JSONs."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "839d4a73008926bcf3ba37496dfdf7c2e89b4fea", "author": {"user": {"login": "gianm", "name": "Gian Merlino"}}, "url": "https://github.com/apache/druid/commit/839d4a73008926bcf3ba37496dfdf7c2e89b4fea", "committedDate": "2020-08-03T18:19:44Z", "message": "Fix call to ScanQuery."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b3f4f83e497c78cbab646f058b3bc13028cb75f4", "author": {"user": {"login": "gianm", "name": "Gian Merlino"}}, "url": "https://github.com/apache/druid/commit/b3f4f83e497c78cbab646f058b3bc13028cb75f4", "committedDate": "2020-08-03T19:15:06Z", "message": "Doc update."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "3f1a4a2c65b517020a5a1e252b309ed9e37f0398", "author": {"user": {"login": "gianm", "name": "Gian Merlino"}}, "url": "https://github.com/apache/druid/commit/3f1a4a2c65b517020a5a1e252b309ed9e37f0398", "committedDate": "2020-08-04T00:33:55Z", "message": "Fix javadocs."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "25a68eb37134a02a36b997c3f8f5f0d9d76565cd", "author": {"user": {"login": "gianm", "name": "Gian Merlino"}}, "url": "https://github.com/apache/druid/commit/25a68eb37134a02a36b997c3f8f5f0d9d76565cd", "committedDate": "2020-08-04T00:51:25Z", "message": "Spotbugs, LGTM suppressions."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "488788e0de14baa8b7da425a7a44e94b582d2877", "author": {"user": {"login": "gianm", "name": "Gian Merlino"}}, "url": "https://github.com/apache/druid/commit/488788e0de14baa8b7da425a7a44e94b582d2877", "committedDate": "2020-08-04T00:52:51Z", "message": "Javadocs."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "015bd2adbdc1818ad95db99c2a4dcb5e81a8b3c3", "author": {"user": {"login": "gianm", "name": "Gian Merlino"}}, "url": "https://github.com/apache/druid/commit/015bd2adbdc1818ad95db99c2a4dcb5e81a8b3c3", "committedDate": "2020-08-04T02:43:52Z", "message": "Fix suppression."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "8791a82e63aa032f7f6259147c93bb4581677c67", "author": {"user": {"login": "gianm", "name": "Gian Merlino"}}, "url": "https://github.com/apache/druid/commit/8791a82e63aa032f7f6259147c93bb4581677c67", "committedDate": "2020-08-06T00:23:56Z", "message": "Merge branch 'master' into offset-scan"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "15997042a0df27dca8cd01138e7a1a88d4d74c25", "author": {"user": {"login": "gianm", "name": "Gian Merlino"}}, "url": "https://github.com/apache/druid/commit/15997042a0df27dca8cd01138e7a1a88d4d74c25", "committedDate": "2020-08-07T19:13:25Z", "message": "Merge branch 'master' into offset-scan"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "6bd319a7635d61dcc59447b1a892c96bfc12af1b", "author": {"user": {"login": "gianm", "name": "Gian Merlino"}}, "url": "https://github.com/apache/druid/commit/6bd319a7635d61dcc59447b1a892c96bfc12af1b", "committedDate": "2020-08-12T07:11:44Z", "message": "Stabilize Scan query result order, add tests."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "bc2bf927a5ef495c6bb82e732699210fd31e588b", "author": {"user": {"login": "gianm", "name": "Gian Merlino"}}, "url": "https://github.com/apache/druid/commit/bc2bf927a5ef495c6bb82e732699210fd31e588b", "committedDate": "2020-08-12T07:11:49Z", "message": "Merge branch 'master' into offset-scan"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "0f7d7c0dfc838c13171ded1669ded2813459b891", "author": {"user": {"login": "gianm", "name": "Gian Merlino"}}, "url": "https://github.com/apache/druid/commit/0f7d7c0dfc838c13171ded1669ded2813459b891", "committedDate": "2020-08-12T07:14:12Z", "message": "Update LGTM comment."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "83273027dff51dfc5139ce1fe3eb6f67c5a32279", "author": {"user": {"login": "gianm", "name": "Gian Merlino"}}, "url": "https://github.com/apache/druid/commit/83273027dff51dfc5139ce1fe3eb6f67c5a32279", "committedDate": "2020-08-12T07:32:33Z", "message": "Fixup."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "644a2d5c9c1a96ab18acf0fe6b8f753b5561038d", "author": {"user": {"login": "gianm", "name": "Gian Merlino"}}, "url": "https://github.com/apache/druid/commit/644a2d5c9c1a96ab18acf0fe6b8f753b5561038d", "committedDate": "2020-08-12T09:50:19Z", "message": "Test different batch sizes too."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "09af824e1a78eea91978b6a52cce9f8f013193c4", "author": {"user": {"login": "gianm", "name": "Gian Merlino"}}, "url": "https://github.com/apache/druid/commit/09af824e1a78eea91978b6a52cce9f8f013193c4", "committedDate": "2020-08-12T10:08:41Z", "message": "Nicer tests."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDY2MTIzMzUy", "url": "https://github.com/apache/druid/pull/10233#pullrequestreview-466123352", "createdAt": "2020-08-12T17:25:04Z", "commit": {"oid": "09af824e1a78eea91978b6a52cce9f8f013193c4"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xMlQxNzoyNTowNFrOG_rN9Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xMlQxNzoyNTowNFrOG_rN9Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2OTQyMTU1Nw==", "bodyText": "Same comment as #10235 (comment). :-)", "url": "https://github.com/apache/druid/pull/10233#discussion_r469421557", "createdAt": "2020-08-12T17:25:04Z", "author": {"login": "abhishekrb19"}, "path": "processing/src/main/java/org/apache/druid/query/scan/ScanQuery.java", "diffHunk": "@@ -202,12 +210,38 @@ public int getBatchSize()\n     return batchSize;\n   }\n \n-  @JsonProperty\n+  /**\n+   * Offset for this query; behaves like SQL \"OFFSET\". Zero means no offset. Negative values are invalid.\n+   */\n+  @JsonProperty(\"offset\")\n+  @JsonInclude(JsonInclude.Include.NON_DEFAULT)\n+  public long getScanRowsOffset()\n+  {\n+    return scanRowsOffset;\n+  }\n+\n+  /**\n+   * Offset for this query; behaves like SQL \"LIMIT\". Will always be positive. {@link Long#MAX_VALUE} is used in", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "09af824e1a78eea91978b6a52cce9f8f013193c4"}, "originalPosition": 61}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "2edebad0fbf8fc77426075d1a25fa957fb315192", "author": {"user": {"login": "gianm", "name": "Gian Merlino"}}, "url": "https://github.com/apache/druid/commit/2edebad0fbf8fc77426075d1a25fa957fb315192", "committedDate": "2020-08-12T21:15:59Z", "message": "Fix comment."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDY3MTUzNDgy", "url": "https://github.com/apache/druid/pull/10233#pullrequestreview-467153482", "createdAt": "2020-08-13T21:46:27Z", "commit": {"oid": "2edebad0fbf8fc77426075d1a25fa957fb315192"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1907, "cost": 1, "resetAt": "2021-10-28T17:48:14Z"}}}