{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDY2MjQxMDkz", "number": 10264, "title": "Fix CombiningFirehose compatibility", "bodyText": "Fixes #9389.\nThis fixes CombiningFirehose to be compatible with FiniteFirehoseFactory . Will look into adding index_parallel support for this.\n\nThis PR has:\n\n been self-reviewed.\n added unit tests or modified existing tests to cover new code paths, ensuring the threshold for code coverage is met.\n been tested in a test Druid cluster.", "createdAt": "2020-08-11T17:14:59Z", "url": "https://github.com/apache/druid/pull/10264", "merged": true, "mergeCommit": {"oid": "618c04a99e4b6cb4ff5aff659feb655b37273fc0"}, "closed": true, "closedAt": "2020-08-20T17:37:39Z", "author": {"login": "a2l007"}, "timelineItems": {"totalCount": 8, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABc956gEgH2gAyNDY2MjQxMDkzOjM1NmNkNDMyYTRlOTIxNmM4NDgxOGVkOTc2ZDFmOWYwZmMzZjU3MWY=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdAIN-AAFqTQ2OTUzNTMwNA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "356cd432a4e9216c84818ed976d1f9f0fc3f571f", "author": {"user": null}, "url": "https://github.com/apache/druid/commit/356cd432a4e9216c84818ed976d1f9f0fc3f571f", "committedDate": "2020-08-11T17:03:57Z", "message": "Fix CombiningFirehose"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f62775b5842745e586c3e9d43f145da04e7af412", "author": {"user": null}, "url": "https://github.com/apache/druid/commit/f62775b5842745e586c3e9d43f145da04e7af412", "committedDate": "2020-08-12T15:15:01Z", "message": "Merge branch 'master' of https://github.com/druid-io/druid into fix_combining"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "03b56bc3e5e13b89e3502a5fbbbf32b9744fc080", "author": {"user": null}, "url": "https://github.com/apache/druid/commit/03b56bc3e5e13b89e3502a5fbbbf32b9744fc080", "committedDate": "2020-08-13T16:17:24Z", "message": "Add integration test"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "fcdb6afc4500321b67c46b7c0a6122a184e274d4", "author": {"user": null}, "url": "https://github.com/apache/druid/commit/fcdb6afc4500321b67c46b7c0a6122a184e274d4", "committedDate": "2020-08-13T18:15:53Z", "message": "Fix path"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "8d3f7182feb74c5636cae95a00663f060a49e2ac", "author": {"user": null}, "url": "https://github.com/apache/druid/commit/8d3f7182feb74c5636cae95a00663f060a49e2ac", "committedDate": "2020-08-13T20:51:41Z", "message": "Add full datasource name"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "10ab1298f839b584544047f970f511bb95eb8dcc", "author": {"user": null}, "url": "https://github.com/apache/druid/commit/10ab1298f839b584544047f970f511bb95eb8dcc", "committedDate": "2020-08-14T14:02:36Z", "message": "Fix input location"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDY4NTQyMjE4", "url": "https://github.com/apache/druid/pull/10264#pullrequestreview-468542218", "createdAt": "2020-08-17T15:00:07Z", "commit": {"oid": "10ab1298f839b584544047f970f511bb95eb8dcc"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xN1QxNTowMDowOFrOHBsdyg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xN1QxNTowMDowOFrOHBsdyg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MTUzOTE0Ng==", "bodyText": "I looked for implementations of FirehoseFactory that do not also implement FiniteFirehoseFactory and I found a few... eg. ClippedFirehoseFactory, FixedCountFirehoseFactory, etc.\nI think the underlying problem is in IndexIOConfig#getNonNullInputSource\nIndexIOConfig accepts a FirehoseFactory, but getNonNullInputSource expects a FiniteFirehoseFactory.\nI wonder if we could fix this by creating an adapter that translates any FirehoseFactory into a non-splittable FiniteFirehoseFactory (ie. the same functionality you've implemented in this class).\nI understand that the FirehoseFactories are deprecated, so I'm open to other ways of fixing the broken quickstart material as well - can we update the spec used so that the combining firehose factory works without a code change?", "url": "https://github.com/apache/druid/pull/10264#discussion_r471539146", "createdAt": "2020-08-17T15:00:08Z", "author": {"login": "suneet-s"}, "path": "server/src/main/java/org/apache/druid/segment/realtime/firehose/CombiningFirehoseFactory.java", "diffHunk": "@@ -33,11 +36,12 @@\n import java.io.IOException;\n import java.util.Iterator;\n import java.util.List;\n+import java.util.stream.Stream;\n \n /**\n  * Creates firehose that combines data from different Firehoses. Useful for ingesting data from multiple sources.\n  */\n-public class CombiningFirehoseFactory implements FirehoseFactory<InputRowParser>\n+public class CombiningFirehoseFactory implements FiniteFirehoseFactory<InputRowParser, List<FirehoseFactory>>", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "10ab1298f839b584544047f970f511bb95eb8dcc"}, "originalPosition": 23}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDY5NTM1MzA0", "url": "https://github.com/apache/druid/pull/10264#pullrequestreview-469535304", "createdAt": "2020-08-18T14:51:44Z", "commit": {"oid": "10ab1298f839b584544047f970f511bb95eb8dcc"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1941, "cost": 1, "resetAt": "2021-10-28T17:48:14Z"}}}