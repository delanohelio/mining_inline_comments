{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDYyMjg3MTA2", "number": 10232, "reviewThreads": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xMlQxNDoyMzo0MVrOEXppMw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xMlQxNDo1NjoxOFrOEXqjuQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjkzMjM0OTk1OnYy", "diffSide": "RIGHT", "path": "web-console/src/utils/ingestion-spec.tsx", "isResolved": true, "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xMlQxNDoyMzo0MVrOG_jruA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yM1QwOToyNzoxMFrOHFLp9Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2OTI5ODEwNA==", "bodyText": "It'd be really great if we could test the proper thing here, but I'm not sure how either.\n@vogievetsky Any ideas about how we could actually check all 4 bytes here? (See #10229; the \"1\" should actually be the unprintable character 0x01.)\nAlso, are there tests for this logic block in general? Where could we add one for this particular case?", "url": "https://github.com/apache/druid/pull/10232#discussion_r469298104", "createdAt": "2020-08-12T14:23:41Z", "author": {"login": "gianm"}, "path": "web-console/src/utils/ingestion-spec.tsx", "diffHunk": "@@ -2663,7 +2663,7 @@ function guessInputFormat(sampleData: string[]): InputFormat {\n       return inputFormatFromType('orc');\n     }\n     // Avro OCF 4 byte magic header: https://avro.apache.org/docs/current/spec.html#Object+Container+Files\n-    if (sampleDatum.startsWith('Obj1')) {\n+    if (sampleDatum.startsWith('Obj')) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": null, "originalPosition": 5}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2OTM3NTQxNg==", "bodyText": "sure thing. just do if (sampleDatum.startsWith('Obj') && sampleDatum.charCodeAt(3) === 1)", "url": "https://github.com/apache/druid/pull/10232#discussion_r469375416", "createdAt": "2020-08-12T16:08:42Z", "author": {"login": "vogievetsky"}, "path": "web-console/src/utils/ingestion-spec.tsx", "diffHunk": "@@ -2663,7 +2663,7 @@ function guessInputFormat(sampleData: string[]): InputFormat {\n       return inputFormatFromType('orc');\n     }\n     // Avro OCF 4 byte magic header: https://avro.apache.org/docs/current/spec.html#Object+Container+Files\n-    if (sampleDatum.startsWith('Obj1')) {\n+    if (sampleDatum.startsWith('Obj')) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2OTI5ODEwNA=="}, "originalCommit": null, "originalPosition": 5}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NTE5NTg5Mw==", "bodyText": "Done.", "url": "https://github.com/apache/druid/pull/10232#discussion_r475195893", "createdAt": "2020-08-23T09:27:10Z", "author": {"login": "josephglanville"}, "path": "web-console/src/utils/ingestion-spec.tsx", "diffHunk": "@@ -2663,7 +2663,7 @@ function guessInputFormat(sampleData: string[]): InputFormat {\n       return inputFormatFromType('orc');\n     }\n     // Avro OCF 4 byte magic header: https://avro.apache.org/docs/current/spec.html#Object+Container+Files\n-    if (sampleDatum.startsWith('Obj1')) {\n+    if (sampleDatum.startsWith('Obj')) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2OTI5ODEwNA=="}, "originalCommit": null, "originalPosition": 5}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjkzMjQ5OTc3OnYy", "diffSide": "RIGHT", "path": "extensions-core/avro-extensions/src/test/java/org/apache/druid/data/input/avro/AvroFlattenerMakerTest.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xMlQxNDo1NjoxOFrOG_lKIQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xM1QwNToyNjozMFrOG_8ehA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2OTMyMjI3Mw==", "bodyText": "What data type is \"someFixed\"? This code is expecting it to be translated as a byte[]. I think most downstream users of these parsed datums will be interpreting them using Rows.objectToStrings, which is going to translate a byte[] into a base64 encoded string. Is that sensible behavior?\nWould you be able to add some documentation to this page: https://druid.apache.org/docs/latest/ingestion/data-formats.html#avro-ocf about how the various Avro types that we support will be handled?", "url": "https://github.com/apache/druid/pull/10232#discussion_r469322273", "createdAt": "2020-08-12T14:56:18Z", "author": {"login": "gianm"}, "path": "extensions-core/avro-extensions/src/test/java/org/apache/druid/data/input/avro/AvroFlattenerMakerTest.java", "diffHunk": "@@ -78,7 +78,8 @@ public void getRootField()\n         flattener.getRootField(record, \"someNull\")\n     );\n     Assert.assertEquals(\n-        record.getSomeFixed(),\n+        // Casted to an array by transformValue\n+        record.getSomeFixed().bytes(),", "state": "SUBMITTED", "replyTo": null, "originalCommit": null, "originalPosition": 6}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2OTcwNDMyNA==", "bodyText": "Yes so fixed and bytes are encoded equivalently in Avro, fixed just has an enforced size. There is a binaryAsString option for decoding these as strings if need be. It would be nice to support that as a per-field transformation though rather than applying to all binary types as you may only want some to be interpreted as strings and others to be returned verbatim.\nIf docs were to be added I would probably put them on the druid-avro-extensions page and link to them from the various places Avro parsing it used.", "url": "https://github.com/apache/druid/pull/10232#discussion_r469704324", "createdAt": "2020-08-13T05:26:30Z", "author": {"login": "josephglanville"}, "path": "extensions-core/avro-extensions/src/test/java/org/apache/druid/data/input/avro/AvroFlattenerMakerTest.java", "diffHunk": "@@ -78,7 +78,8 @@ public void getRootField()\n         flattener.getRootField(record, \"someNull\")\n     );\n     Assert.assertEquals(\n-        record.getSomeFixed(),\n+        // Casted to an array by transformValue\n+        record.getSomeFixed().bytes(),", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2OTMyMjI3Mw=="}, "originalCommit": null, "originalPosition": 6}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2246, "cost": 1, "resetAt": "2021-11-12T11:18:39Z"}}}