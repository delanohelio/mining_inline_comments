{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTAwODk1Njcw", "number": 10500, "reviewThreads": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xMFQxNzoyNjowN1rOEsTQvw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xMFQxODozMDo1MVrOEsTj-w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzE0ODg4MzgzOnYy", "diffSide": "RIGHT", "path": "web-console/src/dialogs/compaction-dialog/compaction-dialog.tsx", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xMFQxNzoyNjowN1rOHfhPkA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xMVQwMToyOTowNlrOHfjpcQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMjgxMjU2MA==", "bodyText": "do not use <br /> in these descriptions. What you want is paragraphs. You can return multiple paragraphs by wrapping them in a fragment <>. So you would want:\n<>\n  <p>Paragraph 1</p>\n  <p>Paragraph 2</p>\n</>\n\nSee \n  \n    \n      druid/web-console/src/utils/ingestion-spec.tsx\n    \n    \n         Line 780\n      in\n      cbe2b44\n    \n    \n    \n    \n\n        \n          \n           <> \n        \n    \n  \n\n for example", "url": "https://github.com/apache/druid/pull/10500#discussion_r502812560", "createdAt": "2020-10-10T17:26:07Z", "author": {"login": "vogievetsky"}, "path": "web-console/src/dialogs/compaction-dialog/compaction-dialog.tsx", "diffHunk": "@@ -74,17 +74,39 @@ const COMPACTION_CONFIG_FIELDS: Field<CompactionConfig>[] = [\n     info: <>Total number of rows in segments waiting for being pushed.</>,\n   },\n   // partitionsSpec type: hashed\n+  {\n+    name: 'tuningConfig.partitionsSpec.targetRowsPerSegment',\n+    label: 'Target rows per segment',\n+    type: 'number',\n+    defined: (t: CompactionConfig) =>\n+      deepGet(t, 'tuningConfig.partitionsSpec.type') === 'hashed' &&\n+      !deepGet(t, 'tuningConfig.partitionsSpec.numShards'),\n+    info: (\n+      <p>\n+        If you have skewed data, you may want to set this field to generate evenly sized segments.\n+        <br />\n+        <br /> A target row count for each partition. Each partition will have a row count close to\n+        the target assuming evenly distributed keys. Defaults to 5 million if numShards is null.\n+      </p>\n+    ),\n+  },\n   {\n     name: 'tuningConfig.partitionsSpec.numShards',\n     label: 'Num shards',\n     type: 'number',\n-    defined: (t: CompactionConfig) => deepGet(t, 'tuningConfig.partitionsSpec.type') === 'hashed',\n+    defined: (t: CompactionConfig) =>\n+      deepGet(t, 'tuningConfig.partitionsSpec.type') === 'hashed' &&\n+      !deepGet(t, 'tuningConfig.partitionsSpec.targetRowsPerSegment'),\n     info: (\n-      <>\n+      <p>\n+        If you know the optimal number of shards and want to speed up the time it takes for\n+        compaction to run, set this field.\n+        <br />", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a03d20352bad4b70ae4cc1e7c7751bd568620593"}, "originalPosition": 33}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMjg1MTk1Mw==", "bodyText": "Done", "url": "https://github.com/apache/druid/pull/10500#discussion_r502851953", "createdAt": "2020-10-11T01:29:06Z", "author": {"login": "suneet-s"}, "path": "web-console/src/dialogs/compaction-dialog/compaction-dialog.tsx", "diffHunk": "@@ -74,17 +74,39 @@ const COMPACTION_CONFIG_FIELDS: Field<CompactionConfig>[] = [\n     info: <>Total number of rows in segments waiting for being pushed.</>,\n   },\n   // partitionsSpec type: hashed\n+  {\n+    name: 'tuningConfig.partitionsSpec.targetRowsPerSegment',\n+    label: 'Target rows per segment',\n+    type: 'number',\n+    defined: (t: CompactionConfig) =>\n+      deepGet(t, 'tuningConfig.partitionsSpec.type') === 'hashed' &&\n+      !deepGet(t, 'tuningConfig.partitionsSpec.numShards'),\n+    info: (\n+      <p>\n+        If you have skewed data, you may want to set this field to generate evenly sized segments.\n+        <br />\n+        <br /> A target row count for each partition. Each partition will have a row count close to\n+        the target assuming evenly distributed keys. Defaults to 5 million if numShards is null.\n+      </p>\n+    ),\n+  },\n   {\n     name: 'tuningConfig.partitionsSpec.numShards',\n     label: 'Num shards',\n     type: 'number',\n-    defined: (t: CompactionConfig) => deepGet(t, 'tuningConfig.partitionsSpec.type') === 'hashed',\n+    defined: (t: CompactionConfig) =>\n+      deepGet(t, 'tuningConfig.partitionsSpec.type') === 'hashed' &&\n+      !deepGet(t, 'tuningConfig.partitionsSpec.targetRowsPerSegment'),\n     info: (\n-      <>\n+      <p>\n+        If you know the optimal number of shards and want to speed up the time it takes for\n+        compaction to run, set this field.\n+        <br />", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMjgxMjU2MA=="}, "originalCommit": {"oid": "a03d20352bad4b70ae4cc1e7c7751bd568620593"}, "originalPosition": 33}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzE0ODkzMzA3OnYy", "diffSide": "RIGHT", "path": "web-console/src/utils/ingestion-spec.tsx", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xMFQxODozMDo1MVrOHfhm5g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xMFQyMjozNzoxMFrOHfi5vQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMjgxODUzNA==", "bodyText": "Does this mean that either numShards should be set or targetRowsPerSegment? What is their relationship exactly? Does one have to be set? What if both are set? I am asking because it looks like there might need some validation logic?", "url": "https://github.com/apache/druid/pull/10500#discussion_r502818534", "createdAt": "2020-10-10T18:30:51Z", "author": {"login": "vogievetsky"}, "path": "web-console/src/utils/ingestion-spec.tsx", "diffHunk": "@@ -2181,17 +2181,41 @@ export function getPartitionRelatedTuningSpecFormFields(\n           info: <>Total number of rows in segments waiting for being pushed.</>,\n         },\n         // partitionsSpec type: hashed\n+        {\n+          name: 'partitionsSpec.targetRowsPerSegment',\n+          label: 'Target rows per segment',\n+          type: 'number',\n+          defined: (t: TuningConfig) =>\n+            deepGet(t, 'partitionsSpec.type') === 'hashed' &&\n+            !deepGet(t, 'partitionsSpec.numShards'),\n+          info: (\n+            <p>\n+              If you have skewed data, you may want to set this field to generate evenly sized\n+              segments.\n+              <br />\n+              <br /> A target row count for each partition. Each partition will have a row count\n+              close to the target assuming evenly distributed keys. Defaults to 5 million if\n+              numShards is null.\n+            </p>\n+          ),\n+        },\n         {\n           name: 'partitionsSpec.numShards',\n           label: 'Num shards',\n           type: 'number',\n-          defined: (t: TuningConfig) => deepGet(t, 'partitionsSpec.type') === 'hashed',\n+          defined: (t: TuningConfig) =>\n+            deepGet(t, 'partitionsSpec.type') === 'hashed' &&\n+            !deepGet(t, 'partitionsSpec.targetRowsPerSegment'),", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a03d20352bad4b70ae4cc1e7c7751bd568620593"}, "originalPosition": 29}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMjgzOTc0MQ==", "bodyText": "That's right, at most one is needed. If both are set, the backend will reject the spec. I forgot to add the validation logic. Will add in the next patch", "url": "https://github.com/apache/druid/pull/10500#discussion_r502839741", "createdAt": "2020-10-10T22:37:10Z", "author": {"login": "suneet-s"}, "path": "web-console/src/utils/ingestion-spec.tsx", "diffHunk": "@@ -2181,17 +2181,41 @@ export function getPartitionRelatedTuningSpecFormFields(\n           info: <>Total number of rows in segments waiting for being pushed.</>,\n         },\n         // partitionsSpec type: hashed\n+        {\n+          name: 'partitionsSpec.targetRowsPerSegment',\n+          label: 'Target rows per segment',\n+          type: 'number',\n+          defined: (t: TuningConfig) =>\n+            deepGet(t, 'partitionsSpec.type') === 'hashed' &&\n+            !deepGet(t, 'partitionsSpec.numShards'),\n+          info: (\n+            <p>\n+              If you have skewed data, you may want to set this field to generate evenly sized\n+              segments.\n+              <br />\n+              <br /> A target row count for each partition. Each partition will have a row count\n+              close to the target assuming evenly distributed keys. Defaults to 5 million if\n+              numShards is null.\n+            </p>\n+          ),\n+        },\n         {\n           name: 'partitionsSpec.numShards',\n           label: 'Num shards',\n           type: 'number',\n-          defined: (t: TuningConfig) => deepGet(t, 'partitionsSpec.type') === 'hashed',\n+          defined: (t: TuningConfig) =>\n+            deepGet(t, 'partitionsSpec.type') === 'hashed' &&\n+            !deepGet(t, 'partitionsSpec.targetRowsPerSegment'),", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMjgxODUzNA=="}, "originalCommit": {"oid": "a03d20352bad4b70ae4cc1e7c7751bd568620593"}, "originalPosition": 29}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3018, "cost": 1, "resetAt": "2021-11-12T11:18:39Z"}}}