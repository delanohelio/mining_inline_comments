{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDAwNzU3NzI5", "number": 9647, "title": "document useFilterCNF query context parameter", "bodyText": "Does the thing the title says, and adds useFilterCNF to the query context docs. It might be worth adding a preamble of sorts to some of these settings to indicate that they are for advanced tuning and control over druid behavior, but i'm not sure what that should look like or what would be intuitive, so instead just focused on trying to impart that query issuers should experiment before using this setting in a production environment to confirm it is good for the filter shape.", "createdAt": "2020-04-08T10:16:09Z", "url": "https://github.com/apache/druid/pull/9647", "merged": true, "mergeCommit": {"oid": "e677c62484bf02379ff8cb7855de1e3e43a4b4b1"}, "closed": true, "closedAt": "2020-04-17T05:12:21Z", "author": {"login": "clintropolis"}, "timelineItems": {"totalCount": 8, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcVlBrqgH2gAyNDAwNzU3NzI5OjJjYmYwYTJkNTE2YjRkNDE3OGYzODE2M2JkYjRkYzZhODIyY2E0NDI=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcYCfq4AH2gAyNDAwNzU3NzI5OjE5Y2M1NDFiYzA5NzAzNDI5ODA1MjE3OWQxYjg1OWU5YjAwNjgyZjM=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "2cbf0a2d516b4d4178f38163bdb4dc6a822ca442", "author": {"user": {"login": "clintropolis", "name": "Clint Wylie"}}, "url": "https://github.com/apache/druid/commit/2cbf0a2d516b4d4178f38163bdb4dc6a822ca442", "committedDate": "2020-04-08T10:06:49Z", "message": "document useFilterCNF query context parameter"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "5c2c087b4d728ce05883adf483d256da54a561d2", "author": {"user": {"login": "clintropolis", "name": "Clint Wylie"}}, "url": "https://github.com/apache/druid/commit/5c2c087b4d728ce05883adf483d256da54a561d2", "committedDate": "2020-04-08T10:14:53Z", "message": "move context key to QueryContexts"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzkwMjg2NzMw", "url": "https://github.com/apache/druid/pull/9647#pullrequestreview-390286730", "createdAt": "2020-04-08T19:58:07Z", "commit": {"oid": "5c2c087b4d728ce05883adf483d256da54a561d2"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ee9f6e98deaa16ad927583d67b4fea4175efbd24", "author": {"user": {"login": "clintropolis", "name": "Clint Wylie"}}, "url": "https://github.com/apache/druid/commit/ee9f6e98deaa16ad927583d67b4fea4175efbd24", "committedDate": "2020-04-09T01:53:46Z", "message": "Update .spelling"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "8a920d36429e0cfb218fd0f81c8ee52943248dc9", "author": {"user": {"login": "clintropolis", "name": "Clint Wylie"}}, "url": "https://github.com/apache/druid/commit/8a920d36429e0cfb218fd0f81c8ee52943248dc9", "committedDate": "2020-04-09T04:38:39Z", "message": "Merge remote-tracking branch 'upstream/master' into doc-useFilterCNF-context-parameter"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzkwNTA1NTEy", "url": "https://github.com/apache/druid/pull/9647#pullrequestreview-390505512", "createdAt": "2020-04-09T05:47:19Z", "commit": {"oid": "8a920d36429e0cfb218fd0f81c8ee52943248dc9"}, "state": "COMMENTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wOVQwNTo0NzoyMFrOGDKZMA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wOVQwNTo1Njo1N1rOGDKkYw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNTk2OTIwMA==", "bodyText": "\ud83d\udc4d", "url": "https://github.com/apache/druid/pull/9647#discussion_r405969200", "createdAt": "2020-04-09T05:47:20Z", "author": {"login": "jon-wei"}, "path": "processing/src/main/java/org/apache/druid/query/QueryContexts.java", "diffHunk": "@@ -67,7 +68,8 @@\n   public static final boolean DEFAULT_ENABLE_JOIN_FILTER_PUSH_DOWN = true;\n   public static final boolean DEFAULT_ENABLE_JOIN_FILTER_REWRITE = true;\n   public static final boolean DEFAULT_ENABLE_JOIN_FILTER_REWRITE_VALUE_COLUMN_FILTERS = false;\n-  public static final long DEFAULT_ENABLE_JOIN_FILTER_REWRITE_MAX_SIZE_KEY = 10000;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "8a920d36429e0cfb218fd0f81c8ee52943248dc9"}, "originalPosition": 12}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNTk3MjA2Nw==", "bodyText": "But this effect only happens for the top level filter, or individual clauses of a top level 'and' filter.\n\nSuggest providing a few examples to clarify:\n\nAn OR filter A || B where A can be resolved using bitmap indexes but B cannot will prevent the whole OR filter from being considered for pre-filtering\nIf it were A && B instead, A would be considered for pre-filtering but B would not.\nIf it were A && (C || D) where C and D can be resolved using bitmap indexes, then the whole filter can be considered for pre-filtering\nIf were A && (B || C) only A will be considered for pre-filtering", "url": "https://github.com/apache/druid/pull/9647#discussion_r405972067", "createdAt": "2020-04-09T05:56:57Z", "author": {"login": "jon-wei"}, "path": "docs/querying/query-context.md", "diffHunk": "@@ -45,6 +45,7 @@ The query context is used for various query configuration parameters. The follow\n |parallelMergeParallelism|`druid.processing.merge.pool.parallelism`|Maximum number of parallel threads to use for parallel result merging on the Broker. See [Broker configuration](../configuration/index.html#broker) for more details.|\n |parallelMergeInitialYieldRows|`druid.processing.merge.task.initialYieldNumRows`|Number of rows to yield per ForkJoinPool merge task for parallel result merging on the Broker, before forking off a new task to continue merging sequences. See [Broker configuration](../configuration/index.html#broker) for more details.|\n |parallelMergeSmallBatchRows|`druid.processing.merge.task.smallBatchNumRows`|Size of result batches to operate on in ForkJoinPool merge tasks for parallel result merging on the Broker. See [Broker configuration](../configuration/index.html#broker) for more details.|\n+|useFilterCNF|`false`| If true, Druid will attempt to convert the query filter to Conjunctive Normal Form (CNF). During query processing, columns can be pre-filtered by intersecting the bitmap indexes of all values that match the eligible filters, often greatly reducing the raw number of rows which need to be scanned. But this effect only happens for the top level filter, or individual clauses of a top level 'and' filter. As such, filters in CNF potentially have a higher chance to utilize a large amount of bitmap indexes on string columns during pre-filtering. However, this setting should be used with great caution, as it can sometimes have a negative effect on performance, and in some cases, the act of computing CNF of a filter can be expensive. We recommend hand tuning your filters to produce an optimal form if possible, or at least verifying through experimentation that using this parameter actually improves your query performance with no ill-effects.|", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "8a920d36429e0cfb218fd0f81c8ee52943248dc9"}, "originalPosition": 4}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzkxMDY1OTM0", "url": "https://github.com/apache/druid/pull/9647#pullrequestreview-391065934", "createdAt": "2020-04-09T19:19:09Z", "commit": {"oid": "8a920d36429e0cfb218fd0f81c8ee52943248dc9"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "19cc541bc097034298052179d1b859e9b00682f3", "author": {"user": {"login": "clintropolis", "name": "Clint Wylie"}}, "url": "https://github.com/apache/druid/commit/19cc541bc097034298052179d1b859e9b00682f3", "committedDate": "2020-04-16T01:34:40Z", "message": "Merge remote-tracking branch 'upstream/master' into doc-useFilterCNF-context-parameter"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2467, "cost": 1, "resetAt": "2021-10-28T17:48:14Z"}}}