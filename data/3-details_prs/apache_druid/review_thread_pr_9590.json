{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0Mzk2MDAxNzkx", "number": 9590, "reviewThreads": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0zMVQwMTo0MTowOVrODs6ieA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wMVQyMToxNjoxMVrODttXwg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjQ4NDIzMDMyOnYy", "diffSide": "RIGHT", "path": "integration-tests/src/test/resources/indexer/wikipedia_index_queries_with_transform.json", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0zMVQwMTo0MTowOVrOF-CRow==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0zMVQwMTo0MTowOVrOF-CRow==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMDU5MzMxNQ==", "bodyText": "typo in expected results\n\n  \n    \n  \n    \n\n  \n  This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters. Learn more about bidirectional Unicode characters\n\n\n  \n\n\n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                            \"added_count_times_ten\" : 9050.0,\n          \n          \n            \n                            \"added_count_times_ten\" : 27150.0,", "url": "https://github.com/apache/druid/pull/9590#discussion_r400593315", "createdAt": "2020-03-31T01:41:09Z", "author": {"login": "suneet-s"}, "path": "integration-tests/src/test/resources/indexer/wikipedia_index_queries_with_transform.json", "diffHunk": "@@ -0,0 +1,54 @@\n+[\n+    {\n+        \"description\":\"having spec on post aggregation\",\n+        \"query\":{\n+            \"queryType\":\"groupBy\",\n+            \"dataSource\":\"%%DATASOURCE%%\",\n+            \"granularity\":\"day\",\n+            \"dimensions\":[\n+                \"page\"\n+            ],\n+            \"filter\":{\n+                \"type\":\"selector\",\n+                \"dimension\":\"language\",\n+                \"value\":\"language-zh\"\n+            },\n+            \"aggregations\":[\n+                {\n+                    \"type\":\"count\",\n+                    \"name\":\"rows\"\n+                },\n+                {\n+                    \"type\":\"longSum\",\n+                    \"fieldName\":\"triple-added\",\n+                    \"name\":\"added_count\"\n+                }\n+            ],\n+            \"postAggregations\": [\n+                {\n+                    \"type\":\"arithmetic\",\n+                    \"name\":\"added_count_times_ten\",\n+                    \"fn\":\"*\",\n+                    \"fields\":[\n+                        {\"type\":\"fieldAccess\", \"name\":\"added_count\", \"fieldName\":\"added_count\"},\n+                        {\"type\":\"constant\", \"name\":\"const\", \"value\":10}\n+                    ]\n+                }\n+            ],\n+            \"having\":{\"type\":\"greaterThan\", \"aggregation\":\"added_count_times_ten\", \"value\":9000},\n+            \"intervals\":[\n+                \"2013-08-31T00:00/2013-09-01T00:00\"\n+            ]\n+        },\n+        \"expectedResults\":[ {\n+            \"version\" : \"v1\",\n+            \"timestamp\" : \"2013-08-31T00:00:00.000Z\",\n+            \"event\" : {\n+                \"added_count_times_ten\" : 9050.0,", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "045584b0f6fbee9ca5c07117bf6f21d6e2815c8b"}, "originalPosition": 47}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjQ4NDUyMDA1OnYy", "diffSide": "RIGHT", "path": "integration-tests/src/test/resources/indexer/wikipedia_index_queries_with_transform.json", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0zMVQwNDozMzoyNlrOF-E-Qg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0zMVQyMTowNzowMVrOF-oQjg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMDYzNzUwNg==", "bodyText": "Using a filter on \"newPage\" (the renamed column) fails the test locally. But if I apply the transformation from another datasource it appears to work. Need to verify if this is actually a bug or not", "url": "https://github.com/apache/druid/pull/9590#discussion_r400637506", "createdAt": "2020-03-31T04:33:26Z", "author": {"login": "suneet-s"}, "path": "integration-tests/src/test/resources/indexer/wikipedia_index_queries_with_transform.json", "diffHunk": "@@ -0,0 +1,54 @@\n+[\n+    {\n+        \"description\":\"having spec on post aggregation\",\n+        \"query\":{\n+            \"queryType\":\"groupBy\",\n+            \"dataSource\":\"%%DATASOURCE%%\",\n+            \"granularity\":\"day\",\n+            \"dimensions\":[\n+                \"page\"", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "8d2c471ac91093f46ae292c42fdddc4a22a20f68"}, "originalPosition": 9}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMTIxNTYzMA==", "bodyText": "This is a bug filed #9593 for this", "url": "https://github.com/apache/druid/pull/9590#discussion_r401215630", "createdAt": "2020-03-31T21:07:01Z", "author": {"login": "suneet-s"}, "path": "integration-tests/src/test/resources/indexer/wikipedia_index_queries_with_transform.json", "diffHunk": "@@ -0,0 +1,54 @@\n+[\n+    {\n+        \"description\":\"having spec on post aggregation\",\n+        \"query\":{\n+            \"queryType\":\"groupBy\",\n+            \"dataSource\":\"%%DATASOURCE%%\",\n+            \"granularity\":\"day\",\n+            \"dimensions\":[\n+                \"page\"", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMDYzNzUwNg=="}, "originalCommit": {"oid": "8d2c471ac91093f46ae292c42fdddc4a22a20f68"}, "originalPosition": 9}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjQ5MjU1MzQxOnYy", "diffSide": "RIGHT", "path": "examples/quickstart/tutorial/transform-index.json", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wMVQyMToxNDoyNlrOF_S2ug==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wMVQyMToxNDoyNlrOF_S2ug==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMTkxMzUzMA==", "bodyText": "Good catch!", "url": "https://github.com/apache/druid/pull/9590#discussion_r401913530", "createdAt": "2020-04-01T21:14:26Z", "author": {"login": "jihoonson"}, "path": "examples/quickstart/tutorial/transform-index.json", "diffHunk": "@@ -55,7 +55,7 @@\n         \"baseDir\" : \"quickstart/tutorial\",\n         \"filter\" : \"transform-data.json\"\n       },\n-      \"inpuFormat\" : {\n+      \"inputFormat\" : {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d5ee5ef38e6f706a2e55f12420d0d0409e048bec"}, "originalPosition": 5}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjQ5MjU1ODc0OnYy", "diffSide": "RIGHT", "path": "indexing-service/src/main/java/org/apache/druid/indexing/common/ReingestionTimelineUtils.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wMVQyMToxNjoxMVrOF_S6Ig==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wMVQyMToxNjoxMVrOF_S6Ig==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMTkxNDQwMg==", "bodyText": "nit: please add description for the return value or remove this.", "url": "https://github.com/apache/druid/pull/9590#discussion_r401914402", "createdAt": "2020-04-01T21:16:11Z", "author": {"login": "jihoonson"}, "path": "indexing-service/src/main/java/org/apache/druid/indexing/common/ReingestionTimelineUtils.java", "diffHunk": "@@ -101,4 +103,34 @@\n                     .mapToObj(orderedMetrics::get)\n                     .collect(Collectors.toList());\n   }\n+\n+  /**\n+   * Utility function to get dimensions that should be ingested. The preferred order is\n+   * - Explicit dimensions if they are provided.\n+   * - Custom dimensions are provided in the inputSpec.\n+   * - Calculate dimensions from the timeline but exclude any dimension exclusions.\n+   *\n+   * @param explicitDimensions sent as part of the re-ingestion InputSource.\n+   * @param dimensionsSpec from the provided ingestion spec.\n+   * @param timeLineSegments for the datasource that is being read.\n+   * @return", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d5ee5ef38e6f706a2e55f12420d0d0409e048bec"}, "originalPosition": 28}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2694, "cost": 1, "resetAt": "2021-11-12T11:18:39Z"}}}