{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0Mzg1MDEzMDY0", "number": 9472, "title": "Add option to control join filter rewrites", "bodyText": "This PR adds a new query context option for joins enableJoinFilterRewrite that controls whether filter clauses that reference non-base table columns will be rewritten into filters on base table columns.\nThe default is false, as the rewrite can be costly and not worth it.\nThis PR has:\n\n been self-reviewed.\n added documentation for new or modified features or behaviors.\n added Javadocs for most classes and all non-trivial methods. Linked related entities via Javadoc links.\n added or updated version, license, or notice information in licenses.yaml\n added comments explaining the \"why\" and the intent of the code wherever would not be obvious for an unfamiliar reader.\n added unit tests or modified existing tests to cover new code paths.\n added integration tests.\n been tested in a test Druid cluster.", "createdAt": "2020-03-06T20:43:28Z", "url": "https://github.com/apache/druid/pull/9472", "merged": true, "mergeCommit": {"oid": "0136dba95d5271027b2ee0d0266a8a66fe88d4ca"}, "closed": true, "closedAt": "2020-03-10T00:36:08Z", "author": {"login": "jon-wei"}, "timelineItems": {"totalCount": 7, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcLGMQaAH2gAyMzg1MDEzMDY0OjE1MGY2NDNjMGM3NTYwODUyZWI4MThiZmUzNWM3NmVkNjA0ZTQyZDM=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcMDsK2AFqTM3MTQ5Mzk5OA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "150f643c0c7560852eb818bfe35c76ed604e42d3", "author": {"user": {"login": "jon-wei", "name": "Jonathan Wei"}}, "url": "https://github.com/apache/druid/commit/150f643c0c7560852eb818bfe35c76ed604e42d3", "committedDate": "2020-03-06T20:32:04Z", "message": "Add option to control join filter rewrites"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzcwNjYyNjk4", "url": "https://github.com/apache/druid/pull/9472#pullrequestreview-370662698", "createdAt": "2020-03-06T22:22:40Z", "commit": {"oid": "150f643c0c7560852eb818bfe35c76ed604e42d3"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wNlQyMjoyMjo0MFrOFzJOZA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wNlQyMjoyMjo0MFrOFzJOZA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4OTE3MjgzNg==", "bodyText": "Does this need to be added to the docs?", "url": "https://github.com/apache/druid/pull/9472#discussion_r389172836", "createdAt": "2020-03-06T22:22:40Z", "author": {"login": "ccaominh"}, "path": "processing/src/main/java/org/apache/druid/query/QueryContexts.java", "diffHunk": "@@ -46,6 +46,7 @@\n   public static final String VECTORIZE_KEY = \"vectorize\";\n   public static final String VECTOR_SIZE_KEY = \"vectorSize\";\n   public static final String JOIN_FILTER_PUSH_DOWN_KEY = \"enableJoinFilterPushDown\";\n+  public static final String JOIN_FILTER_REWRITE_KEY = \"enableJoinFilterRewrite\";", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "150f643c0c7560852eb818bfe35c76ed604e42d3"}, "originalPosition": 4}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzcwNjYyNzI1", "url": "https://github.com/apache/druid/pull/9472#pullrequestreview-370662725", "createdAt": "2020-03-06T22:22:43Z", "commit": {"oid": "150f643c0c7560852eb818bfe35c76ed604e42d3"}, "state": "DISMISSED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzcwNjY1NjA2", "url": "https://github.com/apache/druid/pull/9472#pullrequestreview-370665606", "createdAt": "2020-03-06T22:29:59Z", "commit": {"oid": "150f643c0c7560852eb818bfe35c76ed604e42d3"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wNlQyMjoyOTo1OVrOFzJXiQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wNlQyMjoyOTo1OVrOFzJXiQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4OTE3NTE3Nw==", "bodyText": "Wrong key name (unused new rewrite key name getting flagged by intellij inspection job)", "url": "https://github.com/apache/druid/pull/9472#discussion_r389175177", "createdAt": "2020-03-06T22:29:59Z", "author": {"login": "ccaominh"}, "path": "processing/src/main/java/org/apache/druid/query/QueryContexts.java", "diffHunk": "@@ -225,6 +227,11 @@ public String toString()\n     return parseBoolean(query, JOIN_FILTER_PUSH_DOWN_KEY, DEFAULT_ENABLE_JOIN_FILTER_PUSH_DOWN);\n   }\n \n+  public static <T> boolean getEnableJoinFilterRewrite(Query<T> query)\n+  {\n+    return parseBoolean(query, JOIN_FILTER_PUSH_DOWN_KEY, DEFAULT_ENABLE_JOIN_FILTER_REWRITE);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "150f643c0c7560852eb818bfe35c76ed604e42d3"}, "originalPosition": 22}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzcwNjY3MDM4", "url": "https://github.com/apache/druid/pull/9472#pullrequestreview-370667038", "createdAt": "2020-03-06T22:33:27Z", "commit": {"oid": "150f643c0c7560852eb818bfe35c76ed604e42d3"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wNlQyMjozMzoyN1rOFzJcSg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wNlQyMjozMzoyN1rOFzJcSg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4OTE3NjM5NA==", "bodyText": "Javadoc reference to this method on line 54 needs to be updated (flagged by intellij inspection job)", "url": "https://github.com/apache/druid/pull/9472#discussion_r389176394", "createdAt": "2020-03-06T22:33:27Z", "author": {"login": "ccaominh"}, "path": "processing/src/main/java/org/apache/druid/segment/join/filter/JoinFilterAnalyzer.java", "diffHunk": "@@ -88,7 +88,8 @@ public static JoinFilterSplit splitFilter(\n       HashJoinSegmentStorageAdapter hashJoinSegmentStorageAdapter,\n       Set<String> baseColumnNames,\n       @Nullable Filter originalFilter,\n-      boolean enableFilterPushDown\n+      boolean enableFilterPushDown,\n+      boolean enableFilterRewrite", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "150f643c0c7560852eb818bfe35c76ed604e42d3"}, "originalPosition": 6}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "92f290bc46a0a3147ad56bce3b48f6a4ec7fe3d4", "author": {"user": {"login": "jon-wei", "name": "Jonathan Wei"}}, "url": "https://github.com/apache/druid/commit/92f290bc46a0a3147ad56bce3b48f6a4ec7fe3d4", "committedDate": "2020-03-09T20:07:02Z", "message": "Fix inspections"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzcxNDkzOTk4", "url": "https://github.com/apache/druid/pull/9472#pullrequestreview-371493998", "createdAt": "2020-03-09T20:11:08Z", "commit": {"oid": "92f290bc46a0a3147ad56bce3b48f6a4ec7fe3d4"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3019, "cost": 1, "resetAt": "2021-10-28T17:48:14Z"}}}