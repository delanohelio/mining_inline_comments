{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDIyOTYzNDIy", "number": 9923, "title": "Add parameterized Calcite tests for join queries", "bodyText": "This change paramterizes the join CalciteQueryTest tests so that we can test the various config options for join queries.\nFor join queries, we use the query context to enable and disable different features on the query execution path. The results of a query should be the same regardless of which features it uses. These parameterized tests allow us to validate that the results are in fact the same regardless of the passed in query context features.", "createdAt": "2020-05-26T03:11:32Z", "url": "https://github.com/apache/druid/pull/9923", "merged": true, "mergeCommit": {"oid": "cbd587dbd64ea7e5b1a316d19752786f01e50dec"}, "closed": true, "closedAt": "2020-05-29T02:10:27Z", "author": {"login": "suneet-s"}, "timelineItems": {"totalCount": 7, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABck7zoagH2gAyNDIyOTYzNDIyOmY0YzRkZjQxYzQ1YzRiMDg3N2M0NzNiYWViODY4MTJhMTA0NjhmNjc=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcle4J1AFqTQxOTU2NDk2Nw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "f4c4df41c45c4b0877c473baeb86812a10468f67", "author": {"user": {"login": "suneet-s", "name": "Suneet Saldanha"}}, "url": "https://github.com/apache/druid/commit/f4c4df41c45c4b0877c473baeb86812a10468f67", "committedDate": "2020-05-26T03:08:09Z", "message": "Add parameterized Calcite tests for join queries"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "2c55685e2b822eed40f1a32cb2b6f636be7e0b5c", "author": {"user": {"login": "suneet-s", "name": "Suneet Saldanha"}}, "url": "https://github.com/apache/druid/commit/2c55685e2b822eed40f1a32cb2b6f636be7e0b5c", "committedDate": "2020-05-26T06:13:37Z", "message": "new tests"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDE4NzIzMDcz", "url": "https://github.com/apache/druid/pull/9923#pullrequestreview-418723073", "createdAt": "2020-05-26T22:30:19Z", "commit": {"oid": "2c55685e2b822eed40f1a32cb2b6f636be7e0b5c"}, "state": "COMMENTED", "comments": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yNlQyMjozMDoxOVrOGaydhQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yNlQyMjo0MTowN1rOGayr7w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMDc0MjkxNw==", "bodyText": "May be worth explicitly setting JOIN_FILTER_REWRITE_ENABLE_KEY to true here in case the default value changes in the future.", "url": "https://github.com/apache/druid/pull/9923#discussion_r430742917", "createdAt": "2020-05-26T22:30:19Z", "author": {"login": "ccaominh"}, "path": "sql/src/test/java/org/apache/druid/sql/calcite/CalciteQueryTest.java", "diffHunk": "@@ -13917,4 +14073,38 @@ public void testRepeatedIdenticalVirtualExpressionGrouping() throws Exception\n         )\n     );\n   }\n+\n+  /**\n+   * This is a provider of query contexts that should be used by join tests.\n+   * It tests various configs that can be passed to join queries. All the configs provided by this provider should\n+   * have the join query engine return the same results.\n+   */\n+  public static class QueryContextForJoinProvider\n+  {\n+    @UsedByJUnitParamsRunner\n+    public static Object[] provideQueryContexts()\n+    {\n+      return new Object[] {\n+          // default behavior\n+          QUERY_CONTEXT_DEFAULT,\n+          // filter value re-writes enabled\n+          new ImmutableMap.Builder<String, Object>()\n+              .putAll(QUERY_CONTEXT_DEFAULT)\n+              .put(QueryContexts.JOIN_FILTER_REWRITE_VALUE_COLUMN_FILTERS_ENABLE_KEY, true)\n+              .build(),", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "2c55685e2b822eed40f1a32cb2b6f636be7e0b5c"}, "originalPosition": 1253}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMDc0NDg4Nw==", "bodyText": "Should line 8863 use queryContext instead of QUERY_CONTEXT_DEFAULT?", "url": "https://github.com/apache/druid/pull/9923#discussion_r430744887", "createdAt": "2020-05-26T22:36:01Z", "author": {"login": "ccaominh"}, "path": "sql/src/test/java/org/apache/druid/sql/calcite/CalciteQueryTest.java", "diffHunk": "@@ -8803,6 +8841,7 @@ public void testInnerJoinTwoLookupsToTableUsingNumericColumn() throws Exception\n         + \"FROM foo\\n\"\n         + \"INNER JOIN lookup.lookyloo l1 ON l1.k = foo.m1\\n\"\n         + \"INNER JOIN lookup.lookyloo l2 ON l2.k = l1.k\",\n+        queryContext,", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "2c55685e2b822eed40f1a32cb2b6f636be7e0b5c"}, "originalPosition": 530}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMDc0NjA2Ng==", "bodyText": "Revert extra indent", "url": "https://github.com/apache/druid/pull/9923#discussion_r430746066", "createdAt": "2020-05-26T22:39:29Z", "author": {"login": "ccaominh"}, "path": "sql/src/test/java/org/apache/druid/sql/calcite/CalciteQueryTest.java", "diffHunk": "@@ -9279,22 +9330,24 @@ public void testInnerJoinCastLeft() throws Exception\n                 )\n                 .intervals(querySegmentSpec(Filtration.eternity()))\n                 .columns(\"j0.k\", \"j0.v\", \"m1\")\n-                .context(QUERY_CONTEXT_DEFAULT)\n+                  .context(queryContext)", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "2c55685e2b822eed40f1a32cb2b6f636be7e0b5c"}, "originalPosition": 683}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMDc0NjYwNw==", "bodyText": "Should line 9219 use queryContext instead of QUERY_CONTEXT_DEFAULT?", "url": "https://github.com/apache/druid/pull/9923#discussion_r430746607", "createdAt": "2020-05-26T22:41:07Z", "author": {"login": "ccaominh"}, "path": "sql/src/test/java/org/apache/druid/sql/calcite/CalciteQueryTest.java", "diffHunk": "@@ -9152,6 +9198,7 @@ public void testCommaJoinTableLookupTableMismatchedTypes() throws Exception\n         \"SELECT COUNT(*)\\n\"\n         + \"FROM foo, lookup.lookyloo l, numfoo\\n\"\n         + \"WHERE foo.cnt = l.k AND l.k = numfoo.cnt\\n\",\n+        queryContext,", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "2c55685e2b822eed40f1a32cb2b6f636be7e0b5c"}, "originalPosition": 620}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f4eaf2234e2d0de2c1c305712cb138e96e86b75c", "author": {"user": {"login": "suneet-s", "name": "Suneet Saldanha"}}, "url": "https://github.com/apache/druid/commit/f4eaf2234e2d0de2c1c305712cb138e96e86b75c", "committedDate": "2020-05-26T23:57:26Z", "message": "review comments"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "dc2068824fe4a27f81b81462c2a4784a3aeab922", "author": {"user": {"login": "suneet-s", "name": "Suneet Saldanha"}}, "url": "https://github.com/apache/druid/commit/dc2068824fe4a27f81b81462c2a4784a3aeab922", "committedDate": "2020-05-26T23:57:57Z", "message": "Merge remote-tracking branch 'upstream/master' into sql-tests-2"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDE4NzYzOTY4", "url": "https://github.com/apache/druid/pull/9923#pullrequestreview-418763968", "createdAt": "2020-05-27T00:22:56Z", "commit": {"oid": "dc2068824fe4a27f81b81462c2a4784a3aeab922"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDE5NTY0OTY3", "url": "https://github.com/apache/druid/pull/9923#pullrequestreview-419564967", "createdAt": "2020-05-27T19:59:46Z", "commit": {"oid": "dc2068824fe4a27f81b81462c2a4784a3aeab922"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2396, "cost": 1, "resetAt": "2021-10-28T17:48:14Z"}}}