{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDk4MTQ4MDEw", "number": 10481, "title": "Make sure all fields in sys.segments are JSON-serialized ", "bodyText": "Make sure all fields in sys.segments are JSON-serialized\nDescription\nThis PR:\n\nMake sure all fields in sys.segments are JSON-serialized. This is to be consistent with other sys tables such as spec in sys.supervisors. This is also more standardized and prevent things like changing Java class name from having end user impact (as our contract is to maintain compatibility of the JSON-serialized String).\nMake all columns use the same casing\n\nThis PR has:\n\n been self-reviewed.\n\n using the concurrency checklist (Remove this item if the PR doesn't have any relation to concurrency.)\n\n\n added documentation for new or modified features or behaviors.\n added Javadocs for most classes and all non-trivial methods. Linked related entities via Javadoc links.\n added or updated version, license, or notice information in licenses.yaml\n added comments explaining the \"why\" and the intent of the code wherever would not be obvious for an unfamiliar reader.\n added unit tests or modified existing tests to cover new code paths, ensuring the threshold for code coverage is met.\n added integration tests.\n been tested in a test Druid cluster.", "createdAt": "2020-10-05T22:15:20Z", "url": "https://github.com/apache/druid/pull/10481", "merged": true, "mergeCommit": {"oid": "3538abd5d064d11a03cea6458782e5f4b52d3c45"}, "closed": true, "closedAt": "2020-10-14T20:49:47Z", "author": {"login": "maytasm"}, "timelineItems": {"totalCount": 9, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdOYKRbgH2gAyNDk4MTQ4MDEwOjk5OTJjMGQzMzE5MjRjYWJjMDYwMWZmOGMzNzk0MDYwMTUzMGRiMTc=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdSWPOmgH2gAyNDk4MTQ4MDEwOmMxNjk4MzNiMDliNTRiMjE2ZjA4YWQ4YTllZmEwZDRmNWJhNTdlNjQ=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "9992c0d331924cabc0601ff8c37940601530db17", "author": {"user": {"login": "maytasm", "name": "Maytas Monsereenusorn"}}, "url": "https://github.com/apache/druid/commit/9992c0d331924cabc0601ff8c37940601530db17", "committedDate": "2020-10-01T21:21:07Z", "message": "fix JSON format"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "1c14aad4c67a5d538a6923695f96f4d9fd83af4d", "author": {"user": {"login": "maytasm", "name": "Maytas Monsereenusorn"}}, "url": "https://github.com/apache/druid/commit/1c14aad4c67a5d538a6923695f96f4d9fd83af4d", "committedDate": "2020-10-02T01:11:26Z", "message": "Change all columns in sys segments to be JSON"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a2f9d86cafc1b634af904599cf96c813e56e7553", "author": {"user": {"login": "maytasm", "name": "Maytas Monsereenusorn"}}, "url": "https://github.com/apache/druid/commit/a2f9d86cafc1b634af904599cf96c813e56e7553", "committedDate": "2020-10-02T01:13:02Z", "message": "Change all columns in sys segments to be JSON"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTAyNDcyOTAx", "url": "https://github.com/apache/druid/pull/10481#pullrequestreview-502472901", "createdAt": "2020-10-05T22:48:27Z", "commit": {"oid": "a2f9d86cafc1b634af904599cf96c813e56e7553"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wNVQyMjo0ODoyN1rOHcwSUw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wNVQyMjo0ODoyN1rOHcwSUw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5OTkxMzI5OQ==", "bodyText": "shardSpec was introduced in this change #9883 and changing it to shard_spec would be a breaking change. I don't think we should do this without an upgrade plan", "url": "https://github.com/apache/druid/pull/10481#discussion_r499913299", "createdAt": "2020-10-05T22:48:27Z", "author": {"login": "suneet-s"}, "path": "sql/src/main/java/org/apache/druid/sql/calcite/schema/SystemSchema.java", "diffHunk": "@@ -142,7 +143,7 @@\n       .add(\"is_available\", ValueType.LONG)\n       .add(\"is_realtime\", ValueType.LONG)\n       .add(\"is_overshadowed\", ValueType.LONG)\n-      .add(\"shardSpec\", ValueType.STRING)\n+      .add(\"shard_spec\", ValueType.STRING)", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a2f9d86cafc1b634af904599cf96c813e56e7553"}, "originalPosition": 13}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "4a0448d736cd26aa56280632631139e158e1d13a", "author": {"user": {"login": "maytasm", "name": "Maytas Monsereenusorn"}}, "url": "https://github.com/apache/druid/commit/4a0448d736cd26aa56280632631139e158e1d13a", "committedDate": "2020-10-05T23:46:37Z", "message": "add tests"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTA1MjkxMzcz", "url": "https://github.com/apache/druid/pull/10481#pullrequestreview-505291373", "createdAt": "2020-10-09T01:23:47Z", "commit": {"oid": "4a0448d736cd26aa56280632631139e158e1d13a"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTA3MDc3NzAw", "url": "https://github.com/apache/druid/pull/10481#pullrequestreview-507077700", "createdAt": "2020-10-13T05:25:30Z", "commit": {"oid": "4a0448d736cd26aa56280632631139e158e1d13a"}, "state": "APPROVED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xM1QwNToyNTozMFrOHgV2Xg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xM1QwNToyNTozMFrOHgV2Xg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMzY3NDQ2Mg==", "bodyText": "suggest \"JSON-serialized form\" instead here and elsewhere", "url": "https://github.com/apache/druid/pull/10481#discussion_r503674462", "createdAt": "2020-10-13T05:25:30Z", "author": {"login": "jon-wei"}, "path": "docs/querying/sql.md", "diffHunk": "@@ -1083,10 +1083,10 @@ Segments table provides details on all Druid segments, whether they are publishe\n |is_available|LONG|Boolean is represented as long type where 1 = true, 0 = false. 1 if this segment is currently being served by any process(Historical or realtime). See the [Architecture page](../design/architecture.md#segment-lifecycle) for more details.|\n |is_realtime|LONG|Boolean is represented as long type where 1 = true, 0 = false. 1 if this segment is _only_ served by realtime tasks, and 0 if any historical process is serving this segment.|\n |is_overshadowed|LONG|Boolean is represented as long type where 1 = true, 0 = false. 1 if this segment is published and is _fully_ overshadowed by some other published segments. Currently, is_overshadowed is always false for unpublished segments, although this may change in the future. You can filter for segments that \"should be published\" by filtering for `is_published = 1 AND is_overshadowed = 0`. Segments can briefly be both published and overshadowed if they were recently replaced, but have not been unpublished yet. See the [Architecture page](../design/architecture.md#segment-lifecycle) for more details.|\n-|shardSpec|STRING|The toString of specific `ShardSpec`|\n-|dimensions|STRING|The dimensions of the segment|\n-|metrics|STRING|The metrics of the segment|\n-|last_compaction_state|STRING|The configurations of the compaction task which created this segment. May be null if segment was not created by compaction task.|\n+|shard_spec|STRING|JSON-serialized of the segment `ShardSpec`|", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "4a0448d736cd26aa56280632631139e158e1d13a"}, "originalPosition": 8}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a0d83f0d6ae172d21209b1cd4d025300d99dffe0", "author": {"user": {"login": "maytasm", "name": "Maytas Monsereenusorn"}}, "url": "https://github.com/apache/druid/commit/a0d83f0d6ae172d21209b1cd4d025300d99dffe0", "committedDate": "2020-10-14T05:21:04Z", "message": "fix failing tests"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c169833b09b54b216f08ad8a9efa0d4f5ba57e64", "author": {"user": {"login": "maytasm", "name": "Maytas Monsereenusorn"}}, "url": "https://github.com/apache/druid/commit/c169833b09b54b216f08ad8a9efa0d4f5ba57e64", "committedDate": "2020-10-14T05:22:25Z", "message": "fix failing tests"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3340, "cost": 1, "resetAt": "2021-10-28T17:48:14Z"}}}