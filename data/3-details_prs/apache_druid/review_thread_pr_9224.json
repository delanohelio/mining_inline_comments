{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0MzY0NTg3NzAy", "number": 9224, "reviewThreads": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0wNFQxNzo0MTo1MlrODdEV8A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0wNVQwODo0MjowN1rODdP-sA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjMxODA2NDQ4OnYy", "diffSide": "RIGHT", "path": "docs/configuration/index.md", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0wNFQxNzo0MTo1MlrOFldSbg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0wNVQwODo0MDo1OVrOFlvilQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NDgyMTQ4Ng==", "bodyText": "\u201cdeep store\u201d -> \u201cdeep storage\u201d?", "url": "https://github.com/apache/druid/pull/9224#discussion_r374821486", "createdAt": "2020-02-04T17:41:52Z", "author": {"login": "jihoonson"}, "path": "docs/configuration/index.md", "diffHunk": "@@ -763,6 +764,8 @@ Issuing a GET request at the same URL will return the spec that is currently in\n |`maxSegmentsInNodeLoadingQueue`|The maximum number of segments that could be queued for loading to any given server. This parameter could be used to speed up segments loading process, especially if there are \"slow\" nodes in the cluster (with low loading speed) or if too much segments scheduled to be replicated to some particular node (faster loading could be preferred to better segments distribution). Desired value depends on segments loading speed, acceptable replication time and number of nodes. Value 1000 could be a start point for a rather big cluster. Default value is 0 (loading queue is unbounded) |0|\n |`decommissioningNodes`| List of historical servers to 'decommission'. Coordinator will not assign new segments to 'decommissioning' servers,  and segments will be moved away from them to be placed on non-decommissioning servers at the maximum rate specified by `decommissioningMaxPercentOfMaxSegmentsToMove`.|none|\n |`decommissioningMaxPercentOfMaxSegmentsToMove`|  The maximum number of segments that may be moved away from 'decommissioning' servers to non-decommissioning (that is, active) servers during one Coordinator run. This value is relative to the total maximum segment movements allowed during one run which is determined by `maxSegmentsToMove`. If `decommissioningMaxPercentOfMaxSegmentsToMove` is 0, segments will neither be moved from _or to_ 'decommissioning' servers, effectively putting them in a sort of \"maintenance\" mode that will not participate in balancing or assignment by load rules. Decommissioning can also become stalled if there are no available active servers to place the segments. By leveraging the maximum percent of decommissioning segment movements, an operator can prevent active servers from overload by prioritizing balancing, or decrease decommissioning time instead. The value should be between 0 and 100.|70|\n+|`pauseCoordinator`| Boolean flag for whether or not the coordinator should execute its various jobs of coordinating the cluster. Setting this to true essentially pauses all coordination work while allowing the API to remain up. An example of when an admin may want to pause coordination would be if they are doing deep store maintenance on HDFS Name Nodes with downtime and don't want the coordinator to be directing Historical Nodes to hit the Name Node with API requests until maintenance is done and the deep store is declared healthy for use again. |false|", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "70f4ab334cf76a9133da1b6a58cf6d62e8dbc840"}, "originalPosition": 14}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NTEyMDUzMw==", "bodyText": "I think it's worth to document the exact list of jobs that will stop when this is set to true. Can you add it here?", "url": "https://github.com/apache/druid/pull/9224#discussion_r375120533", "createdAt": "2020-02-05T08:40:59Z", "author": {"login": "jihoonson"}, "path": "docs/configuration/index.md", "diffHunk": "@@ -763,6 +764,8 @@ Issuing a GET request at the same URL will return the spec that is currently in\n |`maxSegmentsInNodeLoadingQueue`|The maximum number of segments that could be queued for loading to any given server. This parameter could be used to speed up segments loading process, especially if there are \"slow\" nodes in the cluster (with low loading speed) or if too much segments scheduled to be replicated to some particular node (faster loading could be preferred to better segments distribution). Desired value depends on segments loading speed, acceptable replication time and number of nodes. Value 1000 could be a start point for a rather big cluster. Default value is 0 (loading queue is unbounded) |0|\n |`decommissioningNodes`| List of historical servers to 'decommission'. Coordinator will not assign new segments to 'decommissioning' servers,  and segments will be moved away from them to be placed on non-decommissioning servers at the maximum rate specified by `decommissioningMaxPercentOfMaxSegmentsToMove`.|none|\n |`decommissioningMaxPercentOfMaxSegmentsToMove`|  The maximum number of segments that may be moved away from 'decommissioning' servers to non-decommissioning (that is, active) servers during one Coordinator run. This value is relative to the total maximum segment movements allowed during one run which is determined by `maxSegmentsToMove`. If `decommissioningMaxPercentOfMaxSegmentsToMove` is 0, segments will neither be moved from _or to_ 'decommissioning' servers, effectively putting them in a sort of \"maintenance\" mode that will not participate in balancing or assignment by load rules. Decommissioning can also become stalled if there are no available active servers to place the segments. By leveraging the maximum percent of decommissioning segment movements, an operator can prevent active servers from overload by prioritizing balancing, or decrease decommissioning time instead. The value should be between 0 and 100.|70|\n+|`pauseCoordinator`| Boolean flag for whether or not the coordinator should execute its various jobs of coordinating the cluster. Setting this to true essentially pauses all coordination work while allowing the API to remain up. An example of when an admin may want to pause coordination would be if they are doing deep store maintenance on HDFS Name Nodes with downtime and don't want the coordinator to be directing Historical Nodes to hit the Name Node with API requests until maintenance is done and the deep store is declared healthy for use again. |false|", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NDgyMTQ4Ng=="}, "originalCommit": {"oid": "70f4ab334cf76a9133da1b6a58cf6d62e8dbc840"}, "originalPosition": 14}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjMxOTk0ODA2OnYy", "diffSide": "RIGHT", "path": "server/src/main/java/org/apache/druid/server/coordinator/DruidCoordinator.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0wNVQwODozMzoyN1rOFlvWLQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0wNVQxNjozMTo1MFrOFl-lBw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NTExNzM1Nw==", "bodyText": "I think this if clause should check startingLeaderCounter == coordLeaderSelector.localTerm() as well as in the below if clause. Or maybe, this log can be just printed when the dynamic configuration is updated. Also we are trying to reduce the amount of logs. Do you think it's worth to be the info level? Or can it be the debug level?", "url": "https://github.com/apache/druid/pull/9224#discussion_r375117357", "createdAt": "2020-02-05T08:33:27Z", "author": {"login": "jihoonson"}, "path": "server/src/main/java/org/apache/druid/server/coordinator/DruidCoordinator.java", "diffHunk": "@@ -678,9 +678,20 @@ public void run()\n                 .withEmitter(emitter)\n                 .withBalancerStrategy(balancerStrategy)\n                 .build();\n+\n+        boolean coordinationPaused = getDynamicConfigs().getPauseCoordination();\n+        if (coordinationPaused && coordLeaderSelector.isLeader()) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "70f4ab334cf76a9133da1b6a58cf6d62e8dbc840"}, "originalPosition": 6}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NTM2NjkxOQ==", "bodyText": "I agree that this can be flipped to a debug log. It was nice to have it as info for our initial testing to make sure everything was squared away. I will swap to debug and add to the conditional check to cover the case you mentioned. Now that we know everything works, admins will just need to reference the dynamic config instead of logs for clarity on the state of this (which seems like better admin practice anyways).", "url": "https://github.com/apache/druid/pull/9224#discussion_r375366919", "createdAt": "2020-02-05T16:31:50Z", "author": {"login": "capistrant"}, "path": "server/src/main/java/org/apache/druid/server/coordinator/DruidCoordinator.java", "diffHunk": "@@ -678,9 +678,20 @@ public void run()\n                 .withEmitter(emitter)\n                 .withBalancerStrategy(balancerStrategy)\n                 .build();\n+\n+        boolean coordinationPaused = getDynamicConfigs().getPauseCoordination();\n+        if (coordinationPaused && coordLeaderSelector.isLeader()) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NTExNzM1Nw=="}, "originalCommit": {"oid": "70f4ab334cf76a9133da1b6a58cf6d62e8dbc840"}, "originalPosition": 6}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjMxOTk2NDI4OnYy", "diffSide": "RIGHT", "path": "docs/configuration/index.md", "isResolved": false, "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0wNVQwODozOTozN1rOFlvgTQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0wNVQxNzoxOToyMlrOFmAS8w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NTExOTk0OQ==", "bodyText": "What has changed in this line?", "url": "https://github.com/apache/druid/pull/9224#discussion_r375119949", "createdAt": "2020-02-05T08:39:37Z", "author": {"login": "jihoonson"}, "path": "docs/configuration/index.md", "diffHunk": "@@ -1839,4 +1842,4 @@ Supported query contexts:\n |`druid.router.http.readTimeout`|The timeout for data reads from Broker processes.|`PT15M`|\n |`druid.router.http.numMaxThreads`|Maximum number of worker threads to handle HTTP requests and responses|`max(10, ((number of cores * 17) / 16 + 2) + 30)`|\n |`druid.router.http.numRequestsQueued`|Maximum number of requests that may be queued to a destination|`1024`|\n-|`druid.router.http.requestBuffersize`|Size of the content buffer for receiving requests. These buffers are only used for active connections that have requests with bodies that will not fit within the header buffer|`8 * 1024`|\n\\ No newline at end of file\n+|`druid.router.http.requestBuffersize`|Size of the content buffer for receiving requests. These buffers are only used for active connections that have requests with bodies that will not fit within the header buffer|`8 * 1024`|", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "70f4ab334cf76a9133da1b6a58cf6d62e8dbc840"}, "originalPosition": 25}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NTM2NTUxNA==", "bodyText": "I think my editor deleted the newline at the end of the file. Will fix.", "url": "https://github.com/apache/druid/pull/9224#discussion_r375365514", "createdAt": "2020-02-05T16:29:45Z", "author": {"login": "capistrant"}, "path": "docs/configuration/index.md", "diffHunk": "@@ -1839,4 +1842,4 @@ Supported query contexts:\n |`druid.router.http.readTimeout`|The timeout for data reads from Broker processes.|`PT15M`|\n |`druid.router.http.numMaxThreads`|Maximum number of worker threads to handle HTTP requests and responses|`max(10, ((number of cores * 17) / 16 + 2) + 30)`|\n |`druid.router.http.numRequestsQueued`|Maximum number of requests that may be queued to a destination|`1024`|\n-|`druid.router.http.requestBuffersize`|Size of the content buffer for receiving requests. These buffers are only used for active connections that have requests with bodies that will not fit within the header buffer|`8 * 1024`|\n\\ No newline at end of file\n+|`druid.router.http.requestBuffersize`|Size of the content buffer for receiving requests. These buffers are only used for active connections that have requests with bodies that will not fit within the header buffer|`8 * 1024`|", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NTExOTk0OQ=="}, "originalCommit": {"oid": "70f4ab334cf76a9133da1b6a58cf6d62e8dbc840"}, "originalPosition": 25}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NTM5NTA1OQ==", "bodyText": "I actually have no idea what is up here. The lines are identical so it has to be something to do with a hidden character... The rich diff shows not change for this line so whatever it is, it isn't visible. Still trying to figure it out.\nEdit: Fixed this after realizing it was an intellij thing", "url": "https://github.com/apache/druid/pull/9224#discussion_r375395059", "createdAt": "2020-02-05T17:19:22Z", "author": {"login": "capistrant"}, "path": "docs/configuration/index.md", "diffHunk": "@@ -1839,4 +1842,4 @@ Supported query contexts:\n |`druid.router.http.readTimeout`|The timeout for data reads from Broker processes.|`PT15M`|\n |`druid.router.http.numMaxThreads`|Maximum number of worker threads to handle HTTP requests and responses|`max(10, ((number of cores * 17) / 16 + 2) + 30)`|\n |`druid.router.http.numRequestsQueued`|Maximum number of requests that may be queued to a destination|`1024`|\n-|`druid.router.http.requestBuffersize`|Size of the content buffer for receiving requests. These buffers are only used for active connections that have requests with bodies that will not fit within the header buffer|`8 * 1024`|\n\\ No newline at end of file\n+|`druid.router.http.requestBuffersize`|Size of the content buffer for receiving requests. These buffers are only used for active connections that have requests with bodies that will not fit within the header buffer|`8 * 1024`|", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NTExOTk0OQ=="}, "originalCommit": {"oid": "70f4ab334cf76a9133da1b6a58cf6d62e8dbc840"}, "originalPosition": 25}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjMxOTk3MTA0OnYy", "diffSide": "RIGHT", "path": "integration-tests/src/test/java/org/apache/druid/tests/indexer/ITTestCoordinatorPausedTest.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0wNVQwODo0MjowN1rOFlvkcw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0wNVQwODo0MjowN1rOFlvkcw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NTEyMTAxMQ==", "bodyText": "Thank you for adding this test!", "url": "https://github.com/apache/druid/pull/9224#discussion_r375121011", "createdAt": "2020-02-05T08:42:07Z", "author": {"login": "jihoonson"}, "path": "integration-tests/src/test/java/org/apache/druid/tests/indexer/ITTestCoordinatorPausedTest.java", "diffHunk": "@@ -0,0 +1,74 @@\n+/*\n+ * Licensed to the Apache Software Foundation (ASF) under one\n+ * or more contributor license agreements.  See the NOTICE file\n+ * distributed with this work for additional information\n+ * regarding copyright ownership.  The ASF licenses this file\n+ * to you under the Apache License, Version 2.0 (the\n+ * \"License\"); you may not use this file except in compliance\n+ * with the License.  You may obtain a copy of the License at\n+ *\n+ *   http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing,\n+ * software distributed under the License is distributed on an\n+ * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n+ * KIND, either express or implied.  See the License for the\n+ * specific language governing permissions and limitations\n+ * under the License.\n+ */\n+\n+package org.apache.druid.tests.indexer;\n+\n+import com.google.inject.Inject;\n+import org.apache.druid.java.util.common.logger.Logger;\n+import org.apache.druid.server.coordinator.CoordinatorDynamicConfig;\n+import org.apache.druid.testing.clients.CoordinatorResourceTestClient;\n+import org.apache.druid.testing.guice.DruidTestModuleFactory;\n+import org.apache.druid.testing.utils.ITRetryUtil;\n+import org.testng.annotations.Guice;\n+import org.testng.annotations.Test;\n+\n+import java.io.Closeable;\n+import java.util.concurrent.TimeUnit;\n+\n+@Guice(moduleFactory = DruidTestModuleFactory.class)\n+public class ITTestCoordinatorPausedTest extends AbstractITBatchIndexTest", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "70f4ab334cf76a9133da1b6a58cf6d62e8dbc840"}, "originalPosition": 35}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2145, "cost": 1, "resetAt": "2021-11-12T11:18:39Z"}}}