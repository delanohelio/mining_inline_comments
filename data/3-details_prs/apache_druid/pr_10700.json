{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTQzNzQwNzg5", "number": 10700, "title": "refactor NodeRole so extensions can participate in disco and announcement", "bodyText": "Description\nDruid is like, absurdly extensible, which is pretty cool. Extensions are able to create entire new standalone tools and even full services, and they can be quite powerful because they have access to the wealth of facilities provided by the Druid codebase. However, they are not currently able to announce or discover themselves because we use a NodeRole enumeration which limits participation to known service types.\nThis PR modifies NodeRole to instead be a class, mimicking the contract the enum provided so that there is no apparent change, and allowing custom NodeRoles to be used alongside the built-in service types. I've added an integration test that tests discovery and self discovery (/status/selfDiscovered, which wasn't previously covered by tests afaict) of both the built-in node types as well as an additional custom node-role service extension.\n\nThis PR has:\n\n been self-reviewed.\n added Javadocs for most classes and all non-trivial methods. Linked related entities via Javadoc links.\n added comments explaining the \"why\" and the intent of the code wherever would not be obvious for an unfamiliar reader.\n added unit tests or modified existing tests to cover new code paths, ensuring the threshold for code coverage is met.\n added integration tests.\n been tested in a test Druid cluster.", "createdAt": "2020-12-21T21:43:42Z", "url": "https://github.com/apache/druid/pull/10700", "merged": true, "mergeCommit": {"oid": "74fbdd322dd31bcd3f8b79463cdfdeae8ad85ab5"}, "closed": true, "closedAt": "2020-12-24T23:29:33Z", "author": {"login": "clintropolis"}, "timelineItems": {"totalCount": 10, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdobqo8gH2gAyNTQzNzQwNzg5OmVmNDI1MjRhOGQxMmNjZmRjNjU3NzY1MDg3ZWJlZmE0ZGQwNjNkNDk=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdpb6vwAFqTU1ODcyMjQxMg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "ef42524a8d12ccfdc657765087ebefa4dd063d49", "author": {"user": {"login": "clintropolis", "name": "Clint Wylie"}}, "url": "https://github.com/apache/druid/commit/ef42524a8d12ccfdc657765087ebefa4dd063d49", "committedDate": "2020-12-21T20:08:13Z", "message": "refactor NodeRole so extensions can participate in disco and announcement"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "cd7f898770dfaa7c86923802af5af0f8103b0878", "author": {"user": {"login": "clintropolis", "name": "Clint Wylie"}}, "url": "https://github.com/apache/druid/commit/cd7f898770dfaa7c86923802af5af0f8103b0878", "committedDate": "2020-12-22T01:20:41Z", "message": "fixes, maybe"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "00abb926e63778733144e2e21d4621c0aeb65d1b", "author": {"user": {"login": "clintropolis", "name": "Clint Wylie"}}, "url": "https://github.com/apache/druid/commit/00abb926e63778733144e2e21d4621c0aeb65d1b", "committedDate": "2020-12-22T08:04:59Z", "message": "Merge remote-tracking branch 'upstream/master' into disco-rework-node-role"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a18e98a2f11aff74da63bb08538d115c1a225649", "author": {"user": {"login": "clintropolis", "name": "Clint Wylie"}}, "url": "https://github.com/apache/druid/commit/a18e98a2f11aff74da63bb08538d115c1a225649", "committedDate": "2020-12-22T09:16:23Z", "message": "retries"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTU4MjkzMzky", "url": "https://github.com/apache/druid/pull/10700#pullrequestreview-558293392", "createdAt": "2020-12-24T01:20:54Z", "commit": {"oid": "a18e98a2f11aff74da63bb08538d115c1a225649"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0yNFQwMToyMDo1NFrOIK8DSw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0yNFQwMToyMDo1NFrOIK8DSw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0ODM0MDU1NQ==", "bodyText": "Please edit the javadoc:\n\nIt's no longer an enum, the the javadoc says it is.\nThe javadoc should explain the difference between \"name\" and \"jsonName\" and why they both exist.", "url": "https://github.com/apache/druid/pull/10700#discussion_r548340555", "createdAt": "2020-12-24T01:20:54Z", "author": {"login": "gianm"}, "path": "server/src/main/java/org/apache/druid/discovery/NodeRole.java", "diffHunk": "@@ -31,33 +38,88 @@\n  * These abstractions can probably be merged when Druid updates to Jackson 2.9 that supports JsonAliases, see\n  * see https://github.com/apache/druid/issues/7152.\n  */\n-public enum NodeRole\n+public class NodeRole", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a18e98a2f11aff74da63bb08538d115c1a225649"}, "originalPosition": 21}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "3449da3bf07d80256f47db9b63ac1b95ad1e1fc0", "author": {"user": {"login": "clintropolis", "name": "Clint Wylie"}}, "url": "https://github.com/apache/druid/commit/3449da3bf07d80256f47db9b63ac1b95ad1e1fc0", "committedDate": "2020-12-24T01:59:00Z", "message": "javadoc"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "0b1c5d14b4528f58d27ef1bda0c33ef78eb5d0d1", "author": {"user": {"login": "clintropolis", "name": "Clint Wylie"}}, "url": "https://github.com/apache/druid/commit/0b1c5d14b4528f58d27ef1bda0c33ef78eb5d0d1", "committedDate": "2020-12-24T02:01:38Z", "message": "fix"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "6dbbe1deda1ebe499f54711a6668b35540ab8ab0", "author": {"user": {"login": "clintropolis", "name": "Clint Wylie"}}, "url": "https://github.com/apache/druid/commit/6dbbe1deda1ebe499f54711a6668b35540ab8ab0", "committedDate": "2020-12-24T02:02:05Z", "message": "spelling"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTU4NzIyMDk1", "url": "https://github.com/apache/druid/pull/10700#pullrequestreview-558722095", "createdAt": "2020-12-24T22:53:06Z", "commit": {"oid": "6dbbe1deda1ebe499f54711a6668b35540ab8ab0"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTU4NzIyNDEy", "url": "https://github.com/apache/druid/pull/10700#pullrequestreview-558722412", "createdAt": "2020-12-24T22:59:44Z", "commit": {"oid": "6dbbe1deda1ebe499f54711a6668b35540ab8ab0"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3219, "cost": 1, "resetAt": "2021-10-28T17:48:14Z"}}}