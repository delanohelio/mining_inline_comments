{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTAxMDg0OTAz", "number": 6069, "reviewThreads": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xMlQxOToxMjoxM1rOEsv5WQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xMlQxOToxMjoxM1rOEsv5WQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzE1MzU3NTI5OnYy", "diffSide": "RIGHT", "path": "frameworks/Crystal/lucky/src/actions/db/index.cr", "isResolved": false, "comments": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xMlQxOToxMjoxNFrOHgKOWA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xMlQyMDo1NDowMlrOHgM2SQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMzQ4Mzk5Mg==", "bodyText": "I vaguely remember taking a dive into the Crystal codebase and seeing that the rand(range) wasn't inclusive on the upper bounds. I could be wrong, but want to confirm that this could return 10,000.", "url": "https://github.com/TechEmpower/FrameworkBenchmarks/pull/6069#discussion_r503483992", "createdAt": "2020-10-12T19:12:14Z", "author": {"login": "nbrady-techempower"}, "path": "frameworks/Crystal/lucky/src/actions/db/index.cr", "diffHunk": "@@ -0,0 +1,6 @@\n+class Db::Index < BaseAction\n+  get \"/db\" do\n+    world = WorldQuery.find(rand(1..ID_MAXIMUM))", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c5c3c3585905f794e1dd22c16968054ea1799939"}, "originalPosition": 3}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMzQ4NjY3Mw==", "bodyText": "Yeah, I remember now. The documentation wasn't clear so I had to dig through the code: https://crystal-lang.org/api/0.24.2/Random.html#rand%28range%3ARange%28Int%2CInt%29%29%3AInt-instance-method\nhttps://github.com/crystal-lang/crystal/blob/4f9ed8d03208dd0db33993c5a6fa6753bc1cf91e/src/random.cr#L219 Seems in this case it's basically doing:\nrange.begin + rand(range.end - range.begin) and rand(int) is not inclusive, so the max of : 1 + rand(9999) is 9999", "url": "https://github.com/TechEmpower/FrameworkBenchmarks/pull/6069#discussion_r503486673", "createdAt": "2020-10-12T19:18:58Z", "author": {"login": "nbrady-techempower"}, "path": "frameworks/Crystal/lucky/src/actions/db/index.cr", "diffHunk": "@@ -0,0 +1,6 @@\n+class Db::Index < BaseAction\n+  get \"/db\" do\n+    world = WorldQuery.find(rand(1..ID_MAXIMUM))", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMzQ4Mzk5Mg=="}, "originalCommit": {"oid": "c5c3c3585905f794e1dd22c16968054ea1799939"}, "originalPosition": 3}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMzUxODY2Mw==", "bodyText": "admittedly I copied it from the other crystal projects so it definitely could have been wrong but I ran a little test in a repl calling rand(1..3) and was able to get a 3. https://play.crystal-lang.org/#/r/9toe", "url": "https://github.com/TechEmpower/FrameworkBenchmarks/pull/6069#discussion_r503518663", "createdAt": "2020-10-12T20:33:06Z", "author": {"login": "matthewmcgarvey"}, "path": "frameworks/Crystal/lucky/src/actions/db/index.cr", "diffHunk": "@@ -0,0 +1,6 @@\n+class Db::Index < BaseAction\n+  get \"/db\" do\n+    world = WorldQuery.find(rand(1..ID_MAXIMUM))", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMzQ4Mzk5Mg=="}, "originalCommit": {"oid": "c5c3c3585905f794e1dd22c16968054ea1799939"}, "originalPosition": 3}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMzUyNjk4NQ==", "bodyText": "wow that is interesting. the source code in the crystal repo reads to me like that would be doing:\nputs (1..10_000).map { 1 + rand(3 - 1) }.uniq\nBut the REPL says otherwise lol, thanks!", "url": "https://github.com/TechEmpower/FrameworkBenchmarks/pull/6069#discussion_r503526985", "createdAt": "2020-10-12T20:54:02Z", "author": {"login": "nbrady-techempower"}, "path": "frameworks/Crystal/lucky/src/actions/db/index.cr", "diffHunk": "@@ -0,0 +1,6 @@\n+class Db::Index < BaseAction\n+  get \"/db\" do\n+    world = WorldQuery.find(rand(1..ID_MAXIMUM))", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMzQ4Mzk5Mg=="}, "originalCommit": {"oid": "c5c3c3585905f794e1dd22c16968054ea1799939"}, "originalPosition": 3}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2579, "cost": 1, "resetAt": "2021-11-13T14:23:39Z"}}}