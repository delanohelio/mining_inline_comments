{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDY4MDQ1NjE1", "number": 5933, "title": "aspnetcore: ef updates", "bodyText": "Try to improve Entity Framework Updates.", "createdAt": "2020-08-14T15:25:15Z", "url": "https://github.com/TechEmpower/FrameworkBenchmarks/pull/5933", "merged": true, "mergeCommit": {"oid": "9da04d53a03df616088f86c7cd59f838ffc005b6"}, "closed": true, "closedAt": "2020-08-18T15:32:12Z", "author": {"login": "n-stefan"}, "timelineItems": {"totalCount": 16, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABZ_CleuAH2gAyNDY4MDQ1NjE1OjQyNTZkZmQ3NmU2ODFjOWI0MWYxOTFmMzZjOGQxYjZkNDMzNGM2MTg=", "endCursor": "Y3Vyc29yOnYyOpPPAAABc_G6rZAFqTQ2Nzk2MzkyMA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "4256dfd76e681c9b41f191f36c8d1b6d4334c618", "author": {"user": {"login": "dark-tar", "name": null}}, "url": "https://github.com/TechEmpower/FrameworkBenchmarks/commit/4256dfd76e681c9b41f191f36c8d1b6d4334c618", "committedDate": "2018-12-27T17:10:36Z", "message": "aspcore: add platform multiple queries"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "4c9407bbcdd2826996342a1cc90b67e204515a79", "author": {"user": {"login": "dark-tar", "name": null}}, "url": "https://github.com/TechEmpower/FrameworkBenchmarks/commit/4c9407bbcdd2826996342a1cc90b67e204515a79", "committedDate": "2018-12-27T20:44:14Z", "message": "Add missing console output"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "bf98d457ce0835396bc1966ba939c7d36f1876b1", "author": {"user": {"login": "dark-tar", "name": null}}, "url": "https://github.com/TechEmpower/FrameworkBenchmarks/commit/bf98d457ce0835396bc1966ba939c7d36f1876b1", "committedDate": "2019-01-05T16:05:49Z", "message": "tweak postgresql connectionstring"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "cbe9eaf6009273c48f6d5e2c7356a0de59e863e2", "author": {"user": {"login": "dark-tar", "name": null}}, "url": "https://github.com/TechEmpower/FrameworkBenchmarks/commit/cbe9eaf6009273c48f6d5e2c7356a0de59e863e2", "committedDate": "2019-01-07T21:03:37Z", "message": "Merge remote-tracking branch 'upstream/master'"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a43174f175fc1cae7dec25f57cf95ecb4300353c", "author": {"user": {"login": "dark-tar", "name": null}}, "url": "https://github.com/TechEmpower/FrameworkBenchmarks/commit/a43174f175fc1cae7dec25f57cf95ecb4300353c", "committedDate": "2019-01-20T12:44:08Z", "message": "Merge remote-tracking branch 'upstream/master'"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "db872574fefa1b1efd233f4ffed2707c61ed8c7b", "author": {"user": {"login": "dark-tar", "name": null}}, "url": "https://github.com/TechEmpower/FrameworkBenchmarks/commit/db872574fefa1b1efd233f4ffed2707c61ed8c7b", "committedDate": "2019-02-06T20:05:09Z", "message": "Merge remote-tracking branch 'upstream/master'"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "78e2f4e3b2e84f77c708d337b24e3bee6e8f9cda", "author": {"user": {"login": "dark-tar", "name": null}}, "url": "https://github.com/TechEmpower/FrameworkBenchmarks/commit/78e2f4e3b2e84f77c708d337b24e3bee6e8f9cda", "committedDate": "2019-04-02T13:26:58Z", "message": "Merge remote-tracking branch 'upstream/master'"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "3e08c435393132b7b3f219946dc13619ac538d73", "author": {"user": {"login": "dark-tar", "name": null}}, "url": "https://github.com/TechEmpower/FrameworkBenchmarks/commit/3e08c435393132b7b3f219946dc13619ac538d73", "committedDate": "2019-04-16T13:21:42Z", "message": "Merge remote-tracking branch 'upstream/master'"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d222d676fcc39256d37814466252feec4451c7b4", "author": {"user": {"login": "dark-tar", "name": null}}, "url": "https://github.com/TechEmpower/FrameworkBenchmarks/commit/d222d676fcc39256d37814466252feec4451c7b4", "committedDate": "2019-04-26T16:22:29Z", "message": "Merge remote-tracking branch 'upstream/master'"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "8f62663303f17774bbd10d9159c33ca15f18c1f4", "author": {"user": {"login": "n-stefan", "name": null}}, "url": "https://github.com/TechEmpower/FrameworkBenchmarks/commit/8f62663303f17774bbd10d9159c33ca15f18c1f4", "committedDate": "2019-07-22T13:44:48Z", "message": "Merge remote-tracking branch 'upstream/master'"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a6f989c00ed8d362a8d298a9139200954678efc7", "author": {"user": {"login": "n-stefan", "name": null}}, "url": "https://github.com/TechEmpower/FrameworkBenchmarks/commit/a6f989c00ed8d362a8d298a9139200954678efc7", "committedDate": "2019-11-13T21:31:36Z", "message": "Merge remote-tracking branch 'upstream/master'"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "9115c517e0a6a7a7945e1be6c2c553cd48f4551c", "author": {"user": {"login": "n-stefan", "name": null}}, "url": "https://github.com/TechEmpower/FrameworkBenchmarks/commit/9115c517e0a6a7a7945e1be6c2c553cd48f4551c", "committedDate": "2019-12-30T14:16:44Z", "message": "Merge remote-tracking branch 'upstream/master'"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "75c5c795d7cda39a1d7d771aa6ffc3a99bd70bb7", "author": {"user": {"login": "n-stefan", "name": null}}, "url": "https://github.com/TechEmpower/FrameworkBenchmarks/commit/75c5c795d7cda39a1d7d771aa6ffc3a99bd70bb7", "committedDate": "2020-07-07T18:51:09Z", "message": "Merge remote-tracking branch 'upstream/master'"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "da989734cd44aee828d6faa3f2c5782acece9ccd", "author": {"user": {"login": "n-stefan", "name": null}}, "url": "https://github.com/TechEmpower/FrameworkBenchmarks/commit/da989734cd44aee828d6faa3f2c5782acece9ccd", "committedDate": "2020-08-14T15:03:24Z", "message": "Merge remote-tracking branch 'upstream/master'"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b02910cfbfd9760a57755a8a60091308d887cce8", "author": {"user": {"login": "n-stefan", "name": null}}, "url": "https://github.com/TechEmpower/FrameworkBenchmarks/commit/b02910cfbfd9760a57755a8a60091308d887cce8", "committedDate": "2020-08-14T15:15:29Z", "message": "aspnetcore: ef updates"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDY3OTYzOTIw", "url": "https://github.com/TechEmpower/FrameworkBenchmarks/pull/5933#pullrequestreview-467963920", "createdAt": "2020-08-15T10:46:50Z", "commit": {"oid": "b02910cfbfd9760a57755a8a60091308d887cce8"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xNVQxMDo0Njo1MFrOHBJaGg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xNVQxMDo0Njo1MFrOHBJaGg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MDk2NDc2Mg==", "bodyText": "In this version, you have a couple of issues:\n\nno guarantee that enough distinct numbers will be created to satisfy count\nit does many allocations: some for the Set<T> in Distinct(), some for the temporary Buffer<T> in ToArray() and one for the final array (with a copy).\n\nThe previous implementation does have some allocations implied by OrderBy() but it also has the guarantee of having sufficient elements.\nThat said, both propositions do too many allocations and are not efficient. Instead we can use a simple Fisher-Yates to generate a randomize range in O(n) with only one allocation. See my own implementation as an example.\nvar ids = ShuffleUtility.RandomRange(1, 10000).Take(count);\n\nforeach (int id in ids)\n{\n    // etc.\n}", "url": "https://github.com/TechEmpower/FrameworkBenchmarks/pull/5933#discussion_r470964762", "createdAt": "2020-08-15T10:46:50Z", "author": {"login": "Kryptos-FR"}, "path": "frameworks/CSharp/aspnetcore/Benchmarks/Data/EfDb.cs", "diffHunk": "@@ -54,26 +54,25 @@ public async Task<World[]> LoadMultipleQueriesRows(int count)\n         public async Task<World[]> LoadMultipleUpdatesRows(int count)\n         {\n             var results = new World[count];\n-            var random = new Random();\n-            int i = 0;\n+            int currentValue, newValue;\n \n-            var ids = Enumerable.Range(1, 10000).OrderBy(x => random.Next()).Take(count);\n+            var ids = Enumerable.Range(1, 10000).Select(x => _random.Next(1, 10001)).Distinct().Take(count).ToArray();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b02910cfbfd9760a57755a8a60091308d887cce8"}, "originalPosition": 9}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3850, "cost": 1, "resetAt": "2021-11-02T12:20:56Z"}}}