{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDA4NzY4NTEx", "number": 5646, "reviewThreads": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yN1QyMDo0NDo0NVrOD243NQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yN1QyMDo0NDo0NVrOD243NQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjU4ODgxMzMzOnYy", "diffSide": "RIGHT", "path": "frameworks/C++/libsniper/libsniper_bench/src/main.cpp", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yN1QyMDo0NDo0NVrOGM24Jw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yOFQwNjozODoyNFrOGNE5fA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNjEzNTIwNw==", "bodyText": "Thanks for your contribution @OlegRomanenko\nI don't see any type of routing here. Please see rule 6 in the General Requirements\n\nSome form of request routing is required, even if only a single test type (e.g., Plaintext) is implemented. In most cases, the framework's canonical router or a mainstream router library will be used. In some cases, it is considered normal and sufficiently production-grade to use hand-crafted minimalist routing using control structures such as if/else branching. This is acceptable where it is considered canonical for the framework.", "url": "https://github.com/TechEmpower/FrameworkBenchmarks/pull/5646#discussion_r416135207", "createdAt": "2020-04-27T20:44:45Z", "author": {"login": "nbrady-techempower"}, "path": "frameworks/C++/libsniper/libsniper_bench/src/main.cpp", "diffHunk": "@@ -0,0 +1,101 @@\n+/*\n+ * Copyright (c) 2020, RTBtech, MediaSniper, Oleg Romanenko (oleg@romanenko.ro)\n+ */\n+\n+#include <sniper/event/Loop.h>\n+#include <sniper/event/Timer.h>\n+#include <sniper/http/Server.h>\n+#include <sniper/log/log.h>\n+#include <sniper/std/check.h>\n+#include <sniper/std/vector.h>\n+#include <sniper/threads/Stop.h>\n+#include <thread>\n+\n+using namespace sniper;\n+\n+class Server\n+{\n+public:\n+    explicit Server()\n+    {\n+        for (unsigned i = 0; i < std::thread::hardware_concurrency(); i++)\n+            _workers.emplace_back(&Server::worker_noexcept, this, i);\n+    }\n+\n+    ~Server()\n+    {\n+        for (auto& w : _workers)\n+            if (w.joinable())\n+                w.join();\n+    }\n+\n+private:\n+    void worker_noexcept(unsigned int thread_num) noexcept\n+    {\n+        try {\n+            worker(thread_num);\n+        }\n+        catch (std::exception& e) {\n+            log_err(e.what());\n+        }\n+        catch (...) {\n+            log_err(\"[Server] non std::exception occured\");\n+        }\n+    }\n+\n+    static string gen_date()\n+    {\n+        return fmt::format(\"Date: {:%a, %d %b %Y %H:%M:%S} GMT\\r\\n\", fmt::gmtime(time(nullptr)));\n+    }\n+\n+    void worker(unsigned thread_num)\n+    {\n+        auto loop = event::make_loop();\n+        check(loop, \"[Server] cannot init event loop\");\n+\n+        http::server::Config config;\n+        config.max_conns = 100000;\n+        config.connection.keep_alive_timeout = 10min;\n+        config.connection.request_read_timeout = 10s;\n+\n+        http::Server http_server(loop, config);\n+        check(http_server.bind(\"\", 8090), \"[Server] cannot bind to localhost:8090\");\n+\n+        string date = gen_date();\n+        http_server.set_cb_request([&, this](const auto& conn, const auto& req, const auto& resp) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "5ef26453f09ed2ebf6a18eac1f1758b38982bf05"}, "originalPosition": 65}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNjM2NDkyNA==", "bodyText": "Oh sorry! I forgot about routing. We do not use routing in production.\nFixed.", "url": "https://github.com/TechEmpower/FrameworkBenchmarks/pull/5646#discussion_r416364924", "createdAt": "2020-04-28T06:38:24Z", "author": {"login": "OlegRomanenko"}, "path": "frameworks/C++/libsniper/libsniper_bench/src/main.cpp", "diffHunk": "@@ -0,0 +1,101 @@\n+/*\n+ * Copyright (c) 2020, RTBtech, MediaSniper, Oleg Romanenko (oleg@romanenko.ro)\n+ */\n+\n+#include <sniper/event/Loop.h>\n+#include <sniper/event/Timer.h>\n+#include <sniper/http/Server.h>\n+#include <sniper/log/log.h>\n+#include <sniper/std/check.h>\n+#include <sniper/std/vector.h>\n+#include <sniper/threads/Stop.h>\n+#include <thread>\n+\n+using namespace sniper;\n+\n+class Server\n+{\n+public:\n+    explicit Server()\n+    {\n+        for (unsigned i = 0; i < std::thread::hardware_concurrency(); i++)\n+            _workers.emplace_back(&Server::worker_noexcept, this, i);\n+    }\n+\n+    ~Server()\n+    {\n+        for (auto& w : _workers)\n+            if (w.joinable())\n+                w.join();\n+    }\n+\n+private:\n+    void worker_noexcept(unsigned int thread_num) noexcept\n+    {\n+        try {\n+            worker(thread_num);\n+        }\n+        catch (std::exception& e) {\n+            log_err(e.what());\n+        }\n+        catch (...) {\n+            log_err(\"[Server] non std::exception occured\");\n+        }\n+    }\n+\n+    static string gen_date()\n+    {\n+        return fmt::format(\"Date: {:%a, %d %b %Y %H:%M:%S} GMT\\r\\n\", fmt::gmtime(time(nullptr)));\n+    }\n+\n+    void worker(unsigned thread_num)\n+    {\n+        auto loop = event::make_loop();\n+        check(loop, \"[Server] cannot init event loop\");\n+\n+        http::server::Config config;\n+        config.max_conns = 100000;\n+        config.connection.keep_alive_timeout = 10min;\n+        config.connection.request_read_timeout = 10s;\n+\n+        http::Server http_server(loop, config);\n+        check(http_server.bind(\"\", 8090), \"[Server] cannot bind to localhost:8090\");\n+\n+        string date = gen_date();\n+        http_server.set_cb_request([&, this](const auto& conn, const auto& req, const auto& resp) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNjEzNTIwNw=="}, "originalCommit": {"oid": "5ef26453f09ed2ebf6a18eac1f1758b38982bf05"}, "originalPosition": 65}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2697, "cost": 1, "resetAt": "2021-11-13T14:23:39Z"}}}