{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDA4OTUyMjcw", "number": 1118, "title": "\u0424\u0443\u043d\u043a\u0446\u0438\u044f \u0432\u0441\u0435\u0433\u0434\u0430 \u0432\u043e\u0437\u0432\u0440\u0430\u0449\u0430\u0435\u0442 \u043e\u0434\u043d\u043e \u0438 \u0442\u043e \u0436\u0435 \u043f\u0440\u0438\u043c\u0438\u0442\u0438\u0432\u043d\u043e\u0435 \u0437\u043d\u0430\u0447\u0435\u043d\u0438\u0435", "bodyText": "\u041e\u043f\u0438\u0441\u0430\u043d\u0438\u0435\n\n\u0421\u0432\u044f\u0437\u0430\u043d\u043d\u044b\u0435 \u0437\u0430\u0434\u0430\u0447\u0438\n\n\n\n\n\n\nCloses: #110\n\u0427\u0435\u043a\u043b\u0438\u0441\u0442\n\n\n\u041e\u0431\u0449\u0438\u0435\n\n \u0412\u0435\u0442\u043a\u0430 PR \u043e\u0431\u043d\u043e\u0432\u043b\u0435\u043d\u0430 \u0438\u0437 develop\n \u041e\u0442\u043b\u0430\u0434\u043e\u0447\u043d\u044b\u0435, \u0437\u0430\u043a\u043e\u043c\u043c\u0435\u043d\u0442\u0438\u0440\u043e\u0432\u0430\u043d\u043d\u044b\u0435 \u0438 \u043f\u0440\u043e\u0447\u0438\u0435, \u043d\u0435 \u0438\u043c\u0435\u044e\u0449\u0438\u0435 \u0441\u043c\u044b\u0441\u043b\u0430 \u0443\u0447\u0430\u0441\u0442\u043a\u0438 \u043a\u043e\u0434\u0430 \u0443\u0434\u0430\u043b\u0435\u043d\u044b\n \u0418\u0437\u043c\u0435\u043d\u0435\u043d\u0438\u044f \u043f\u043e\u043a\u0440\u044b\u0442\u044b \u0442\u0435\u0441\u0442\u0430\u043c\u0438\n \u041e\u0431\u044f\u0437\u0430\u0442\u0435\u043b\u044c\u043d\u044b\u0435 \u0434\u0435\u0439\u0441\u0442\u0432\u0438\u044f \u043f\u0435\u0440\u0435\u0434 \u043a\u043e\u043c\u043c\u0438\u0442\u043e\u043c \u0432\u044b\u043f\u043e\u043b\u043d\u0435\u043d\u044b (\u0437\u0430\u043f\u0443\u0441\u043a\u0430\u043b \u043a\u043e\u043c\u0430\u043d\u0434\u0443 gradlew precommit)\n\n\u0414\u043b\u044f \u0434\u0438\u0430\u0433\u043d\u043e\u0441\u0442\u0438\u043a\n\n \u041e\u043f\u0438\u0441\u0430\u043d\u0438\u0435 \u0434\u0438\u0430\u0433\u043d\u043e\u0441\u0442\u0438\u043a\u0438 \u0437\u0430\u043f\u043e\u043b\u043d\u0435\u043d\u043e \u0434\u043b\u044f \u043e\u0431\u043e\u0438\u0445 \u044f\u0437\u044b\u043a\u043e\u0432 (\u043f\u0435\u0440\u0435\u0432\u043e\u0434 \u043d\u0430 \u0430\u043d\u0433\u043b\u0438\u0439\u0441\u043a\u0438\u0439 \u043d\u0435 \u043e\u0431\u044f\u0437\u0430\u0442\u0435\u043b\u0435\u043d)\n\n\u0414\u043e\u043f\u043e\u043b\u043d\u0438\u0442\u0435\u043b\u044c\u043d\u043e", "createdAt": "2020-04-25T18:42:43Z", "url": "https://github.com/1c-syntax/bsl-language-server/pull/1118", "merged": true, "mergeCommit": {"oid": "748d17b8cf48fd42ef9159679e91695920c5b761"}, "closed": true, "closedAt": "2020-04-28T06:38:54Z", "author": {"login": "otymko"}, "timelineItems": {"totalCount": 70, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcbIsfAAH2gAyNDA4OTUyMjcwOjAyZjMyOTMwNzRmMjQ1NmIwZjk0MTU5MWJhNjNhNjU1Y2E0ZGQ1M2E=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcb97a8gH2gAyNDA4OTUyMjcwOjQ0YjcwNGVhNGNiZTA3Yjc3ODRjZDM2ZmE1MzRmMTdjYTc1M2VkMmI=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "02f3293074f2456b0f941591ba63a655ca4dd53a", "author": {"user": {"login": "otymko", "name": "Oleg Tymko"}}, "url": "https://github.com/1c-syntax/bsl-language-server/commit/02f3293074f2456b0f941591ba63a655ca4dd53a", "committedDate": "2020-04-25T16:29:52Z", "message": "\u041f\u0435\u0440\u0432\u043e\u0435 \u043f\u0440\u0438\u0431\u043b\u0438\u0436\u0435\u043d\u0438\u0435"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f687ef3626081d41c1d5444d2d6c337c1f373679", "author": {"user": {"login": "otymko", "name": "Oleg Tymko"}}, "url": "https://github.com/1c-syntax/bsl-language-server/commit/f687ef3626081d41c1d5444d2d6c337c1f373679", "committedDate": "2020-04-25T18:23:36Z", "message": "\u0418\u0441\u043a\u043b\u044e\u0447\u0435\u043d\u0438\u0435 \u043d\u0435 \u043f\u0440\u0438\u043c\u0438\u0442\u0438\u0432\u043e\u0432, \u0434\u043e\u043f\u043e\u043b\u043d\u0435\u043d\u0430 \u0434\u043e\u043a\u0443\u043c\u0435\u043d\u0442\u0430\u0446\u0438\u044f \u043d\u0430 ru, \u043f\u0435\u0440\u0435\u0438\u043c\u0435\u043d\u043e\u0432\u0430\u043d\u0438\u0435 \u0438\u043c\u0435\u043d\u0438 \u0444\u0430\u0439\u043b\u0430 \u043a\u0435\u0439\u0441\u0430 \u0434\u043b\u044f \u0442\u0435\u0441\u0442\u0430"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "4421d3b4737e0b330b7df794b8564ca8f967e801", "author": {"user": {"login": "otymko", "name": "Oleg Tymko"}}, "url": "https://github.com/1c-syntax/bsl-language-server/commit/4421d3b4737e0b330b7df794b8564ca8f967e801", "committedDate": "2020-04-25T18:38:38Z", "message": "\u0414\u043e\u043f\u043e\u043b\u043d\u0435\u043d\u0430 \u0434\u043e\u043a\u0443\u043c\u0435\u043d\u0442\u0430\u0446\u0438\u044f, \u0437\u0430\u043f\u0443\u0449\u0435\u043d \u043f\u0440\u0435\u043a\u043e\u043c\u043c\u0438\u0442, \u0434\u043e\u0431\u0430\u0432\u043b\u0435\u043d\u0430 \u043f\u043e\u0442\u0435\u0440\u044f\u043d\u043d\u0430\u044f \u043b\u0438\u0446\u0435\u043d\u0437\u0438\u044f \u0432 \u0444\u0430\u0439\u043b\u0435 \u0442\u0435\u0441\u0442\u0430."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDAwNDIxMDI0", "url": "https://github.com/1c-syntax/bsl-language-server/pull/1118#pullrequestreview-400421024", "createdAt": "2020-04-25T18:48:22Z", "commit": {"oid": "4421d3b4737e0b330b7df794b8564ca8f967e801"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yNVQxODo0ODoyMlrOGL479g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yNVQxODo0ODoyMlrOGL479g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNTEyMDM3NA==", "bodyText": "\u0410 \u043f\u0440\u043e\u0432\u0435\u0440\u043a\u0430 \u043d\u0430 \u0440\u0430\u0437\u043c\u0435\u0440 \u0437\u0430\u0447\u0435\u043c?", "url": "https://github.com/1c-syntax/bsl-language-server/pull/1118#discussion_r415120374", "createdAt": "2020-04-25T18:48:22Z", "author": {"login": "asosnoviy"}, "path": "src/main/java/com/github/_1c_syntax/bsl/languageserver/diagnostics/FunctionReturnsSamePrimitiveDiagnostic.java", "diffHunk": "@@ -0,0 +1,110 @@\n+/*\n+ * This file is a part of BSL Language Server.\n+ *\n+ * Copyright \u00a9 2018-2020\n+ * Alexey Sosnoviy <labotamy@gmail.com>, Nikita Gryzlov <nixel2007@gmail.com> and contributors\n+ *\n+ * SPDX-License-Identifier: LGPL-3.0-or-later\n+ *\n+ * BSL Language Server is free software; you can redistribute it and/or\n+ * modify it under the terms of the GNU Lesser General Public\n+ * License as published by the Free Software Foundation; either\n+ * version 3.0 of the License, or (at your option) any later version.\n+ *\n+ * BSL Language Server is distributed in the hope that it will be useful,\n+ * but WITHOUT ANY WARRANTY; without even the implied warranty of\n+ * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU\n+ * Lesser General Public License for more details.\n+ *\n+ * You should have received a copy of the GNU Lesser General Public\n+ * License along with BSL Language Server.\n+ */\n+package com.github._1c_syntax.bsl.languageserver.diagnostics;\n+\n+import com.github._1c_syntax.bsl.languageserver.context.symbol.MethodSymbol;\n+import com.github._1c_syntax.bsl.languageserver.diagnostics.metadata.DiagnosticInfo;\n+import com.github._1c_syntax.bsl.languageserver.diagnostics.metadata.DiagnosticMetadata;\n+import com.github._1c_syntax.bsl.languageserver.diagnostics.metadata.DiagnosticSeverity;\n+import com.github._1c_syntax.bsl.languageserver.diagnostics.metadata.DiagnosticTag;\n+import com.github._1c_syntax.bsl.languageserver.diagnostics.metadata.DiagnosticType;\n+import com.github._1c_syntax.bsl.languageserver.utils.Ranges;\n+import com.github._1c_syntax.bsl.languageserver.utils.RelatedInformation;\n+import com.github._1c_syntax.bsl.languageserver.utils.Trees;\n+import com.github._1c_syntax.bsl.parser.BSLParser;\n+import org.antlr.v4.runtime.ParserRuleContext;\n+import org.antlr.v4.runtime.tree.ParseTree;\n+import org.eclipse.lsp4j.Range;\n+\n+import java.util.Collection;\n+import java.util.List;\n+import java.util.Optional;\n+import java.util.stream.Collectors;\n+import java.util.stream.Stream;\n+\n+@DiagnosticMetadata(\n+  type = DiagnosticType.ERROR,\n+  severity = DiagnosticSeverity.MAJOR,\n+  minutesToFix = 5,\n+  tags = {\n+    DiagnosticTag.DESIGN,\n+    DiagnosticTag.BADPRACTICE\n+  }\n+\n+)\n+public class FunctionReturnsSamePrimitiveDiagnostic extends AbstractVisitorDiagnostic {\n+\n+  private static final String KEY_MESSAGE = \"diagnosticMessageReturnStatement\";\n+\n+  public FunctionReturnsSamePrimitiveDiagnostic(DiagnosticInfo info) {\n+    super(info);\n+  }\n+\n+  @Override\n+  public ParseTree visitFunction(BSLParser.FunctionContext ctx) {\n+    var tree = Trees.findAllRuleNodes(ctx, BSLParser.RULE_returnStatement);\n+    if (tree.size() > 1) {\n+      var expressions = tree.stream()\n+        .map(BSLParser.ReturnStatementContext.class::cast)\n+        .map(BSLParser.ReturnStatementContext::expression)\n+        .flatMap(Stream::ofNullable)\n+        .collect(Collectors.toList());\n+\n+      expressions.stream()\n+        .map(expression -> Trees.findAllRuleNodes(expression, BSLParser.RULE_complexIdentifier))\n+        .filter(Collection::isEmpty)\n+        .findAny()\n+        .ifPresent(\n+          parseTrees -> checkPrimitiveValue(ctx, tree, expressions)\n+        );\n+    }\n+    return ctx;\n+  }\n+\n+  private void checkPrimitiveValue(\n+    BSLParser.FunctionContext ctx, Collection<ParseTree> tree, List<BSLParser.ExpressionContext> expressions) {\n+\n+    var set = expressions.stream().map(BSLParser.ExpressionContext::getText).collect(Collectors.toSet());\n+    if (set.size() == 1) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "4421d3b4737e0b330b7df794b8564ca8f967e801"}, "originalPosition": 87}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d4e585a1e9c999c950d5c6b1971d84ce1f8678e8", "author": {"user": {"login": "otymko", "name": "Oleg Tymko"}}, "url": "https://github.com/1c-syntax/bsl-language-server/commit/d4e585a1e9c999c950d5c6b1971d84ce1f8678e8", "committedDate": "2020-04-25T19:11:20Z", "message": "\u041f\u0435\u0440\u0432\u043e\u0435 \u043f\u0440\u0438\u0431\u043b\u0438\u0436\u0435\u043d\u0438\u0435"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e40a786fef5f118b230bcc336ec0892a5cc3d6af", "author": {"user": {"login": "otymko", "name": "Oleg Tymko"}}, "url": "https://github.com/1c-syntax/bsl-language-server/commit/e40a786fef5f118b230bcc336ec0892a5cc3d6af", "committedDate": "2020-04-25T19:11:21Z", "message": "\u0418\u0441\u043a\u043b\u044e\u0447\u0435\u043d\u0438\u0435 \u043d\u0435 \u043f\u0440\u0438\u043c\u0438\u0442\u0438\u0432\u043e\u0432, \u0434\u043e\u043f\u043e\u043b\u043d\u0435\u043d\u0430 \u0434\u043e\u043a\u0443\u043c\u0435\u043d\u0442\u0430\u0446\u0438\u044f \u043d\u0430 ru, \u043f\u0435\u0440\u0435\u0438\u043c\u0435\u043d\u043e\u0432\u0430\u043d\u0438\u0435 \u0438\u043c\u0435\u043d\u0438 \u0444\u0430\u0439\u043b\u0430 \u043a\u0435\u0439\u0441\u0430 \u0434\u043b\u044f \u0442\u0435\u0441\u0442\u0430"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c9a65c76b9e44a8eb71347890ffe7287598a1bb4", "author": {"user": {"login": "otymko", "name": "Oleg Tymko"}}, "url": "https://github.com/1c-syntax/bsl-language-server/commit/c9a65c76b9e44a8eb71347890ffe7287598a1bb4", "committedDate": "2020-04-25T19:12:05Z", "message": "\u0414\u043e\u043f\u043e\u043b\u043d\u0435\u043d\u0430 \u0434\u043e\u043a\u0443\u043c\u0435\u043d\u0442\u0430\u0446\u0438\u044f, \u0437\u0430\u043f\u0443\u0449\u0435\u043d \u043f\u0440\u0435\u043a\u043e\u043c\u043c\u0438\u0442, \u0434\u043e\u0431\u0430\u0432\u043b\u0435\u043d\u0430 \u043f\u043e\u0442\u0435\u0440\u044f\u043d\u043d\u0430\u044f \u043b\u0438\u0446\u0435\u043d\u0437\u0438\u044f \u0432 \u0444\u0430\u0439\u043b\u0435 \u0442\u0435\u0441\u0442\u0430."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "17fcd03e91d54dac680eff364a240876302c568b", "author": {"user": {"login": "otymko", "name": "Oleg Tymko"}}, "url": "https://github.com/1c-syntax/bsl-language-server/commit/17fcd03e91d54dac680eff364a240876302c568b", "committedDate": "2020-04-25T19:14:16Z", "message": "+ \u043f\u0440\u0435\u043a\u043e\u043c\u043c\u0438\u0442"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b217bf88e799d1ea58e100ccd3fedd4c82ac7b00", "author": {"user": {"login": "otymko", "name": "Oleg Tymko"}}, "url": "https://github.com/1c-syntax/bsl-language-server/commit/b217bf88e799d1ea58e100ccd3fedd4c82ac7b00", "committedDate": "2020-04-25T19:15:12Z", "message": "Merge branch 'feature/issue110' of https://github.com/1c-syntax/bsl-language-server into feature/issue110\n\n# Conflicts:\n#\tdocs/diagnostics/index.md\n#\tdocs/en/diagnostics/index.md\n#\tsrc/main/resources/com/github/_1c_syntax/bsl/languageserver/configuration/parameters-schema.json"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c8ca3ba1d16ac0e4a1e64c1c5b6953a9ff0c4ce4", "author": {"user": {"login": "otymko", "name": "Oleg Tymko"}}, "url": "https://github.com/1c-syntax/bsl-language-server/commit/c8ca3ba1d16ac0e4a1e64c1c5b6953a9ff0c4ce4", "committedDate": "2020-04-26T01:59:12Z", "message": "\u0418\u0441\u043a\u043b\u044e\u0447\u0435\u043d\u0438\u0435 \u0438\u0437 \u043f\u0440\u043e\u0432\u0435\u0440\u043a\u0438 \u043f\u043e\u0434\u043a\u043b\u044e\u0447\u0430\u0435\u043c\u044b\u0445 \u0444\u0443\u043d\u043a\u0446\u0438\u0439"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "4cef417ce48e4d7cb4a51bab5886da44ed343171", "author": {"user": {"login": "otymko", "name": "Oleg Tymko"}}, "url": "https://github.com/1c-syntax/bsl-language-server/commit/4cef417ce48e4d7cb4a51bab5886da44ed343171", "committedDate": "2020-04-26T01:59:21Z", "message": "\u0414\u043e\u043f\u043e\u043b\u043d\u0435\u043d\u0438\u0435 \u0434\u043e\u043a\u0443\u043c\u0435\u043d\u0442\u0430\u0446\u0438\u0438"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "52da61470e6d024357b4cd274150456fc68b63cf", "author": {"user": {"login": "otymko", "name": "Oleg Tymko"}}, "url": "https://github.com/1c-syntax/bsl-language-server/commit/52da61470e6d024357b4cd274150456fc68b63cf", "committedDate": "2020-04-26T11:40:34Z", "message": "\u041e\u0431\u0440\u0430\u0431\u043e\u0442\u043a\u0430 \u0441\u0440\u0430\u0432\u043d\u0435\u043d\u0438\u044f \u0437\u043d\u0430\u0447\u0435\u043d\u0438\u0439 \u0432 \u0440\u0430\u0437\u043d\u044b\u0445 \u0440\u0435\u0433\u0438\u0441\u0442\u0440\u0430\u0445 (\u043d\u0430\u043f\u0440\u0438\u043c\u0435\u0440 Null \u0438 NULL)"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b02973bae3543c65cf0a5805e3095d39aa77d721", "author": {"user": {"login": "otymko", "name": "Oleg Tymko"}}, "url": "https://github.com/1c-syntax/bsl-language-server/commit/b02973bae3543c65cf0a5805e3095d39aa77d721", "committedDate": "2020-04-26T14:41:13Z", "message": "\u041d\u0435 \u043f\u0440\u0435\u0432\u043e\u0434\u0438\u0442\u044c \u0421\u0442\u0440\u043e\u043a\u0438 \u043a \u0432\u0435\u0440\u0445\u043d\u0435\u043c\u0443 \u0440\u0435\u0433\u0438\u0441\u0442\u0440\u0443"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "8bf2479a9ab15de37f05a7067a91ce7f0b62a8cf", "author": {"user": {"login": "otymko", "name": "Oleg Tymko"}}, "url": "https://github.com/1c-syntax/bsl-language-server/commit/8bf2479a9ab15de37f05a7067a91ce7f0b62a8cf", "committedDate": "2020-04-26T14:54:41Z", "message": "Merge branch 'develop' into feature/issue110"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDAwNjMwNzY3", "url": "https://github.com/1c-syntax/bsl-language-server/pull/1118#pullrequestreview-400630767", "createdAt": "2020-04-27T05:13:00Z", "commit": {"oid": "8bf2479a9ab15de37f05a7067a91ce7f0b62a8cf"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yN1QwNToxMzowMFrOGMRCsQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yN1QwNToxMzowMFrOGMRCsQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNTUxNTMxMw==", "bodyText": "\u0412\u044b\u043d\u043e\u0441\u0438 \u043f\u0440\u043e\u0432\u0435\u0440\u043a\u0443 \u043d\u0430 \u043f\u043e\u0434\u043a\u043b\u044e\u0447\u0430\u0435\u043c\u044b\u0435 \u0432 \u043f\u0430\u0440\u0430\u043c\u0435\u0442\u0440, \u043f\u0443\u0441\u0442\u044c \u043f\u043e \u0443\u043c\u043e\u043b\u0447\u0430\u043d\u0438\u044e \u0431\u0443\u0434\u0435\u0442 \u0438\u0441\u0442\u0438\u043d\u0430.", "url": "https://github.com/1c-syntax/bsl-language-server/pull/1118#discussion_r415515313", "createdAt": "2020-04-27T05:13:00Z", "author": {"login": "theshadowco"}, "path": "src/main/java/com/github/_1c_syntax/bsl/languageserver/diagnostics/FunctionReturnsSamePrimitiveDiagnostic.java", "diffHunk": "@@ -0,0 +1,131 @@\n+/*\n+ * This file is a part of BSL Language Server.\n+ *\n+ * Copyright \u00a9 2018-2020\n+ * Alexey Sosnoviy <labotamy@gmail.com>, Nikita Gryzlov <nixel2007@gmail.com> and contributors\n+ *\n+ * SPDX-License-Identifier: LGPL-3.0-or-later\n+ *\n+ * BSL Language Server is free software; you can redistribute it and/or\n+ * modify it under the terms of the GNU Lesser General Public\n+ * License as published by the Free Software Foundation; either\n+ * version 3.0 of the License, or (at your option) any later version.\n+ *\n+ * BSL Language Server is distributed in the hope that it will be useful,\n+ * but WITHOUT ANY WARRANTY; without even the implied warranty of\n+ * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU\n+ * Lesser General Public License for more details.\n+ *\n+ * You should have received a copy of the GNU Lesser General Public\n+ * License along with BSL Language Server.\n+ */\n+package com.github._1c_syntax.bsl.languageserver.diagnostics;\n+\n+import com.github._1c_syntax.bsl.languageserver.context.symbol.MethodSymbol;\n+import com.github._1c_syntax.bsl.languageserver.diagnostics.metadata.DiagnosticInfo;\n+import com.github._1c_syntax.bsl.languageserver.diagnostics.metadata.DiagnosticMetadata;\n+import com.github._1c_syntax.bsl.languageserver.diagnostics.metadata.DiagnosticSeverity;\n+import com.github._1c_syntax.bsl.languageserver.diagnostics.metadata.DiagnosticTag;\n+import com.github._1c_syntax.bsl.languageserver.diagnostics.metadata.DiagnosticType;\n+import com.github._1c_syntax.bsl.languageserver.utils.Ranges;\n+import com.github._1c_syntax.bsl.languageserver.utils.RelatedInformation;\n+import com.github._1c_syntax.bsl.languageserver.utils.Trees;\n+import com.github._1c_syntax.bsl.parser.BSLParser;\n+import org.antlr.v4.runtime.ParserRuleContext;\n+import org.antlr.v4.runtime.tree.ParseTree;\n+import org.eclipse.lsp4j.Range;\n+\n+import java.util.Collection;\n+import java.util.List;\n+import java.util.Locale;\n+import java.util.Optional;\n+import java.util.regex.Pattern;\n+import java.util.stream.Collectors;\n+import java.util.stream.Stream;\n+\n+@DiagnosticMetadata(\n+  type = DiagnosticType.ERROR,\n+  severity = DiagnosticSeverity.MAJOR,\n+  minutesToFix = 5,\n+  tags = {\n+    DiagnosticTag.DESIGN,\n+    DiagnosticTag.BADPRACTICE\n+  }\n+\n+)\n+public class FunctionReturnsSamePrimitiveDiagnostic extends AbstractVisitorDiagnostic {\n+\n+  private static final String KEY_MESSAGE = \"diagnosticMessageReturnStatement\";\n+  private static final Pattern pattern = Pattern.compile(\n+    \"^(\u043f\u043e\u0434\u043a\u043b\u044e\u0447\u0430\u0435\u043c\u044b\u0439|attachable)_\", Pattern.CASE_INSENSITIVE | Pattern.UNICODE_CASE);\n+\n+  public FunctionReturnsSamePrimitiveDiagnostic(DiagnosticInfo info) {\n+    super(info);\n+  }\n+\n+  @Override\n+  public ParseTree visitFunction(BSLParser.FunctionContext ctx) {\n+\n+    var abortCheck = Optional.ofNullable(ctx.funcDeclaration())", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "8bf2479a9ab15de37f05a7067a91ce7f0b62a8cf"}, "originalPosition": 69}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "bc14bb63f3fd7ad805c4a8ba8d737ee3cfce90fd", "author": {"user": {"login": "asosnoviy", "name": "Alexey Sosnoviy"}}, "url": "https://github.com/1c-syntax/bsl-language-server/commit/bc14bb63f3fd7ad805c4a8ba8d737ee3cfce90fd", "committedDate": "2020-04-27T06:30:51Z", "message": "CommonModuleNameClientServerDiagnostic \u0437\u0430\u0433\u043e\u0442\u043e\u0432\u043a\u0430"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ba37830972f040080aa6242215d4fa1c3f6f1953", "author": {"user": {"login": "asosnoviy", "name": "Alexey Sosnoviy"}}, "url": "https://github.com/1c-syntax/bsl-language-server/commit/ba37830972f040080aa6242215d4fa1c3f6f1953", "committedDate": "2020-04-27T06:30:51Z", "message": "\u0443\u0437\u043e\u0440\u044b \u0432 \u0442\u0435\u0441\u0442\u0435"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "5fc6de251d1d1a677ac82369162280be025d5871", "author": {"user": {"login": "asosnoviy", "name": "Alexey Sosnoviy"}}, "url": "https://github.com/1c-syntax/bsl-language-server/commit/5fc6de251d1d1a677ac82369162280be025d5871", "committedDate": "2020-04-27T06:30:51Z", "message": "\u043f\u043e\u043c\u0435\u043d\u044f\u043b\u043e\u0441\u044c \u0432\u0441\u0435"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "5dbb27ed493451025f63e556e15525ebc7509a0b", "author": {"user": {"login": "asosnoviy", "name": "Alexey Sosnoviy"}}, "url": "https://github.com/1c-syntax/bsl-language-server/commit/5dbb27ed493451025f63e556e15525ebc7509a0b", "committedDate": "2020-04-27T06:30:51Z", "message": "test \u0438\u0437\u043c\u0435\u043d\u043d\u0435\u043d"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "0a250d97a58923c1b7bf2f41759e15a70d7ef2a8", "author": {"user": {"login": "asosnoviy", "name": "Alexey Sosnoviy"}}, "url": "https://github.com/1c-syntax/bsl-language-server/commit/0a250d97a58923c1b7bf2f41759e15a70d7ef2a8", "committedDate": "2020-04-27T06:30:51Z", "message": "\u0440\u0435\u0441\u0443\u0440\u0441\u044b"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "2a6cbe2ba211c5ec97ad9b8278817aa16c01766e", "author": {"user": {"login": "asosnoviy", "name": "Alexey Sosnoviy"}}, "url": "https://github.com/1c-syntax/bsl-language-server/commit/2a6cbe2ba211c5ec97ad9b8278817aa16c01766e", "committedDate": "2020-04-27T06:30:51Z", "message": "\u0434\u043e\u043a\u0430"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a13d9285cc499acd096dca8b80e0fb66916fc625", "author": {"user": {"login": "asosnoviy", "name": "Alexey Sosnoviy"}}, "url": "https://github.com/1c-syntax/bsl-language-server/commit/a13d9285cc499acd096dca8b80e0fb66916fc625", "committedDate": "2020-04-27T06:30:51Z", "message": "license add"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "3b70c1b93f8492605e3b5557683639a303bc0afe", "author": {"user": {"login": "asosnoviy", "name": "Alexey Sosnoviy"}}, "url": "https://github.com/1c-syntax/bsl-language-server/commit/3b70c1b93f8492605e3b5557683639a303bc0afe", "committedDate": "2020-04-27T06:30:51Z", "message": "\u0420\u0435\u0433\u0443\u043b\u044f\u0440\u043a\u0430 \u0438 \u0442\u0435\u0433\u0438"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "2aea4e10a00633623c0769218d1b6ba28600e0e8", "author": {"user": {"login": "asosnoviy", "name": "Alexey Sosnoviy"}}, "url": "https://github.com/1c-syntax/bsl-language-server/commit/2aea4e10a00633623c0769218d1b6ba28600e0e8", "committedDate": "2020-04-27T06:30:51Z", "message": "precommit"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "cc0b0ec7e9963417e0de286981ecbd0ebb83bf4f", "author": {"user": {"login": "asosnoviy", "name": "Alexey Sosnoviy"}}, "url": "https://github.com/1c-syntax/bsl-language-server/commit/cc0b0ec7e9963417e0de286981ecbd0ebb83bf4f", "committedDate": "2020-04-27T06:30:51Z", "message": "CommonModuleNameServerCallDiagnostic"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "5ca7c57febb10902da5d6e26da14aa286a620536", "author": {"user": {"login": "asosnoviy", "name": "Alexey Sosnoviy"}}, "url": "https://github.com/1c-syntax/bsl-language-server/commit/5ca7c57febb10902da5d6e26da14aa286a620536", "committedDate": "2020-04-27T06:30:51Z", "message": "abstract common module"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "5279aaf1db75a7b4e2d6c42c4fe3b71f32d589aa", "author": {"user": {"login": "asosnoviy", "name": "Alexey Sosnoviy"}}, "url": "https://github.com/1c-syntax/bsl-language-server/commit/5279aaf1db75a7b4e2d6c42c4fe3b71f32d589aa", "committedDate": "2020-04-27T06:31:15Z", "message": "precommit"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "1346289815e0f7760ff8bce1cee225ed58f25938", "author": {"user": {"login": "asosnoviy", "name": "Alexey Sosnoviy"}}, "url": "https://github.com/1c-syntax/bsl-language-server/commit/1346289815e0f7760ff8bce1cee225ed58f25938", "committedDate": "2020-04-27T06:31:26Z", "message": "CommonModuleNameClientDiagnstic"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "1f3c710db7215babeaa58ae59ca6ca4598637199", "author": {"user": {"login": "asosnoviy", "name": "Alexey Sosnoviy"}}, "url": "https://github.com/1c-syntax/bsl-language-server/commit/1f3c710db7215babeaa58ae59ca6ca4598637199", "committedDate": "2020-04-27T06:31:46Z", "message": "CommonModuleNameGlobalDiagnostic"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f9fd96083924b6ff986fa82842009a730be89757", "author": {"user": {"login": "asosnoviy", "name": "Alexey Sosnoviy"}}, "url": "https://github.com/1c-syntax/bsl-language-server/commit/f9fd96083924b6ff986fa82842009a730be89757", "committedDate": "2020-04-27T06:32:09Z", "message": "CommonModuleNameFullAccessDiagnostic"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "2958098074abd213efdc02f2bcc426db14a902a4", "author": {"user": {"login": "asosnoviy", "name": "Alexey Sosnoviy"}}, "url": "https://github.com/1c-syntax/bsl-language-server/commit/2958098074abd213efdc02f2bcc426db14a902a4", "committedDate": "2020-04-27T06:32:09Z", "message": "CommonModuleNameCashedDiagnostic"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "85a0f9ba3148b0592c6f73d3bb726c78a34bfc46", "author": {"user": {"login": "asosnoviy", "name": "Alexey Sosnoviy"}}, "url": "https://github.com/1c-syntax/bsl-language-server/commit/85a0f9ba3148b0592c6f73d3bb726c78a34bfc46", "committedDate": "2020-04-27T06:32:09Z", "message": "CommonModuleGlobalClientDiagnostic"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a4c9866724e012ba3d510d806c1c4a6ae8000a0b", "author": {"user": {"login": "asosnoviy", "name": "Alexey Sosnoviy"}}, "url": "https://github.com/1c-syntax/bsl-language-server/commit/a4c9866724e012ba3d510d806c1c4a6ae8000a0b", "committedDate": "2020-04-27T06:32:09Z", "message": "test empty file"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d54c5a72df2c04a175ae1c19797d9353e2eb5a7e", "author": {"user": {"login": "asosnoviy", "name": "Alexey Sosnoviy"}}, "url": "https://github.com/1c-syntax/bsl-language-server/commit/d54c5a72df2c04a175ae1c19797d9353e2eb5a7e", "committedDate": "2020-04-27T06:32:09Z", "message": "regexp fix"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "8427d107835a78f5cba724057c4685fd56262574", "author": {"user": {"login": "asosnoviy", "name": "Alexey Sosnoviy"}}, "url": "https://github.com/1c-syntax/bsl-language-server/commit/8427d107835a78f5cba724057c4685fd56262574", "committedDate": "2020-04-27T06:32:09Z", "message": "precommit"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "3c66ea93ae264e6f9aaee7f9c198008935642bbc", "author": {"user": {"login": "asosnoviy", "name": "Alexey Sosnoviy"}}, "url": "https://github.com/1c-syntax/bsl-language-server/commit/3c66ea93ae264e6f9aaee7f9c198008935642bbc", "committedDate": "2020-04-27T06:32:09Z", "message": "patter \u0432 super"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f0a71a1eaa649c15d8c26db6e49d32dd9af4c974", "author": {"user": {"login": "asosnoviy", "name": "Alexey Sosnoviy"}}, "url": "https://github.com/1c-syntax/bsl-language-server/commit/f0a71a1eaa649c15d8c26db6e49d32dd9af4c974", "committedDate": "2020-04-27T06:32:09Z", "message": "Metadata"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "1376750a4daa7f36e4e9b3ade52d84820761ceed", "author": {"user": {"login": "asosnoviy", "name": "Alexey Sosnoviy"}}, "url": "https://github.com/1c-syntax/bsl-language-server/commit/1376750a4daa7f36e4e9b3ade52d84820761ceed", "committedDate": "2020-04-27T06:32:09Z", "message": "docs"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "73635a7e3c67d28a68a8f39be2361923c1363223", "author": {"user": {"login": "asosnoviy", "name": "Alexey Sosnoviy"}}, "url": "https://github.com/1c-syntax/bsl-language-server/commit/73635a7e3c67d28a68a8f39be2361923c1363223", "committedDate": "2020-04-27T06:32:09Z", "message": "\u0421\u043b\u0438\u0448\u043a\u043e\u043c \u043c\u043d\u043e\u0433\u043e\u0442\u0435\u0433\u043e\u0432"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "8cc345d1e3507b35b14f7c4496f6fee4a5fdb0c2", "author": {"user": {"login": "asosnoviy", "name": "Alexey Sosnoviy"}}, "url": "https://github.com/1c-syntax/bsl-language-server/commit/8cc345d1e3507b35b14f7c4496f6fee4a5fdb0c2", "committedDate": "2020-04-27T06:32:32Z", "message": "precommit"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "10c966a642cd36ca1895e04de6fb10a50df4e83c", "author": {"user": {"login": "asosnoviy", "name": "Alexey Sosnoviy"}}, "url": "https://github.com/1c-syntax/bsl-language-server/commit/10c966a642cd36ca1895e04de6fb10a50df4e83c", "committedDate": "2020-04-27T06:32:32Z", "message": "matches -> find"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "12563b0f45b62458e7623bfb427215855d827013", "author": {"user": {"login": "asosnoviy", "name": "Alexey Sosnoviy"}}, "url": "https://github.com/1c-syntax/bsl-language-server/commit/12563b0f45b62458e7623bfb427215855d827013", "committedDate": "2020-04-27T06:32:32Z", "message": "\u043d\u0430 \u043f\u0435\u0440\u0432\u044b\u0439 \u0442\u043e\u043a\u0435\u043d \u0434\u0435\u0444\u0430\u0443\u043b\u0442 \u0447\u0435\u043d\u043d\u0435\u043b\u0430"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "3bd9829aacb3a0ae3a4fce32db7c1c58e2d638c3", "author": {"user": {"login": "nixel2007", "name": "Nikita Fedkin"}}, "url": "https://github.com/1c-syntax/bsl-language-server/commit/3bd9829aacb3a0ae3a4fce32db7c1c58e2d638c3", "committedDate": "2020-04-27T10:12:30Z", "message": "Create StyleGuide.md"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "63eb898b50cdd8f81491b776ec83a51548a4a723", "author": {"user": {"login": "nixel2007", "name": "Nikita Fedkin"}}, "url": "https://github.com/1c-syntax/bsl-language-server/commit/63eb898b50cdd8f81491b776ec83a51548a4a723", "committedDate": "2020-04-27T10:12:55Z", "message": "Update index.md"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "59844692c03891a3a09dde85c104e9c2d8008ed1", "author": {"user": {"login": "nixel2007", "name": "Nikita Fedkin"}}, "url": "https://github.com/1c-syntax/bsl-language-server/commit/59844692c03891a3a09dde85c104e9c2d8008ed1", "committedDate": "2020-04-27T10:14:49Z", "message": "Update index.md"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "742092b54eadac6e8185ef2dee66cd60149a9e04", "author": {"user": {"login": "asosnoviy", "name": "Alexey Sosnoviy"}}, "url": "https://github.com/1c-syntax/bsl-language-server/commit/742092b54eadac6e8185ef2dee66cd60149a9e04", "committedDate": "2020-04-27T11:04:22Z", "message": "\u0422\u0435\u0441\u0442 \u043d\u0430 \u0444\u043f \u041a\u043b\u0438\u0435\u043d\u0442\u0427\u0435\u0433\u043e\u0422\u043e\u0413\u043b\u043e\u0431\u0430\u043b\u044c\u043d\u044b\u0439"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "3d936d8606464bf8ebbe0cde125fb3ffb7641cbd", "author": {"user": {"login": "asosnoviy", "name": "Alexey Sosnoviy"}}, "url": "https://github.com/1c-syntax/bsl-language-server/commit/3d936d8606464bf8ebbe0cde125fb3ffb7641cbd", "committedDate": "2020-04-27T14:36:57Z", "message": "fp fix"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "4efa4334c03a40bbc4bf5dd8bfd51fa82284c0b9", "author": {"user": {"login": "asosnoviy", "name": "Alexey Sosnoviy"}}, "url": "https://github.com/1c-syntax/bsl-language-server/commit/4efa4334c03a40bbc4bf5dd8bfd51fa82284c0b9", "committedDate": "2020-04-27T14:37:35Z", "message": "utils.CaseInsentivitesPatern"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "58cf2407aa5467f408d077e43a8df92f1854daea", "author": {"user": {"login": "asosnoviy", "name": "Alexey Sosnoviy"}}, "url": "https://github.com/1c-syntax/bsl-language-server/commit/58cf2407aa5467f408d077e43a8df92f1854daea", "committedDate": "2020-04-27T14:37:52Z", "message": "tests"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "7aa3a3b9f354f0e75b00be014e2dcd9fd2b26b80", "author": {"user": {"login": "asosnoviy", "name": "Alexey Sosnoviy"}}, "url": "https://github.com/1c-syntax/bsl-language-server/commit/7aa3a3b9f354f0e75b00be014e2dcd9fd2b26b80", "committedDate": "2020-04-27T14:38:27Z", "message": "precommit"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "af8af0c6798d3a4902d590b55c777a1da3fccf25", "author": {"user": {"login": "otymko", "name": "Oleg Tymko"}}, "url": "https://github.com/1c-syntax/bsl-language-server/commit/af8af0c6798d3a4902d590b55c777a1da3fccf25", "committedDate": "2020-04-27T17:02:18Z", "message": "\u041f\u0430\u0440\u0430\u043c\u0435\u0442\u0440 \"\u041f\u0440\u043e\u0432\u0435\u0440\u044f\u0442\u044c \u043f\u043e\u0434\u043a\u043b\u044e\u0447\u0430\u0435\u043c\u044b\u0435 \u043c\u0435\u0442\u043e\u0434\u044b\" \u0438 \u0434\u043e\u0440\u0430\u0431\u043e\u0442\u043a\u0430 \u0442\u0435\u0441\u0442\u043e\u0432"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "406078f2faa521663e0bc245bd226ab56d355776", "author": {"user": {"login": "otymko", "name": "Oleg Tymko"}}, "url": "https://github.com/1c-syntax/bsl-language-server/commit/406078f2faa521663e0bc245bd226ab56d355776", "committedDate": "2020-04-27T17:03:01Z", "message": "\u041f\u0440\u0435\u043a\u043e\u043c\u043c\u0438\u0442"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDAxMTU2NzAx", "url": "https://github.com/1c-syntax/bsl-language-server/pull/1118#pullrequestreview-401156701", "createdAt": "2020-04-27T17:11:02Z", "commit": {"oid": "406078f2faa521663e0bc245bd226ab56d355776"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yN1QxNzoxMTowMlrOGMuSyg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yN1QxNzoxMTowMlrOGMuSyg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNTk5NDU3MA==", "bodyText": "@otymko \u0430 \u0442\u0443\u0442 \u043f\u0440\u043e\u0432\u0435\u0440\u044f\u0435\u0442\u0441\u044f \u043d\u0435 \u0441\u0442\u0440\u043e\u043a\u0438 \u043b\u0438 \u044d\u0442\u043e? \u0410 \u043d\u0435\u0442 \u0441\u043f\u043e\u0441\u043e\u0431\u0430 \u043f\u043e\u043f\u0440\u043e\u0449\u0435?", "url": "https://github.com/1c-syntax/bsl-language-server/pull/1118#discussion_r415994570", "createdAt": "2020-04-27T17:11:02Z", "author": {"login": "asosnoviy"}, "path": "src/main/java/com/github/_1c_syntax/bsl/languageserver/diagnostics/FunctionReturnsSamePrimitiveDiagnostic.java", "diffHunk": "@@ -0,0 +1,141 @@\n+/*\n+ * This file is a part of BSL Language Server.\n+ *\n+ * Copyright \u00a9 2018-2020\n+ * Alexey Sosnoviy <labotamy@gmail.com>, Nikita Gryzlov <nixel2007@gmail.com> and contributors\n+ *\n+ * SPDX-License-Identifier: LGPL-3.0-or-later\n+ *\n+ * BSL Language Server is free software; you can redistribute it and/or\n+ * modify it under the terms of the GNU Lesser General Public\n+ * License as published by the Free Software Foundation; either\n+ * version 3.0 of the License, or (at your option) any later version.\n+ *\n+ * BSL Language Server is distributed in the hope that it will be useful,\n+ * but WITHOUT ANY WARRANTY; without even the implied warranty of\n+ * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU\n+ * Lesser General Public License for more details.\n+ *\n+ * You should have received a copy of the GNU Lesser General Public\n+ * License along with BSL Language Server.\n+ */\n+package com.github._1c_syntax.bsl.languageserver.diagnostics;\n+\n+import com.github._1c_syntax.bsl.languageserver.context.symbol.MethodSymbol;\n+import com.github._1c_syntax.bsl.languageserver.diagnostics.metadata.DiagnosticInfo;\n+import com.github._1c_syntax.bsl.languageserver.diagnostics.metadata.DiagnosticMetadata;\n+import com.github._1c_syntax.bsl.languageserver.diagnostics.metadata.DiagnosticParameter;\n+import com.github._1c_syntax.bsl.languageserver.diagnostics.metadata.DiagnosticSeverity;\n+import com.github._1c_syntax.bsl.languageserver.diagnostics.metadata.DiagnosticTag;\n+import com.github._1c_syntax.bsl.languageserver.diagnostics.metadata.DiagnosticType;\n+import com.github._1c_syntax.bsl.languageserver.utils.Ranges;\n+import com.github._1c_syntax.bsl.languageserver.utils.RelatedInformation;\n+import com.github._1c_syntax.bsl.languageserver.utils.Trees;\n+import com.github._1c_syntax.bsl.parser.BSLParser;\n+import org.antlr.v4.runtime.ParserRuleContext;\n+import org.antlr.v4.runtime.tree.ParseTree;\n+import org.eclipse.lsp4j.Range;\n+\n+import java.util.Collection;\n+import java.util.List;\n+import java.util.Locale;\n+import java.util.Optional;\n+import java.util.regex.Pattern;\n+import java.util.stream.Collectors;\n+import java.util.stream.Stream;\n+\n+@DiagnosticMetadata(\n+  type = DiagnosticType.ERROR,\n+  severity = DiagnosticSeverity.MAJOR,\n+  minutesToFix = 5,\n+  tags = {\n+    DiagnosticTag.DESIGN,\n+    DiagnosticTag.BADPRACTICE\n+  }\n+\n+)\n+public class FunctionReturnsSamePrimitiveDiagnostic extends AbstractVisitorDiagnostic {\n+\n+  private static final String KEY_MESSAGE = \"diagnosticMessageReturnStatement\";\n+  private static final Pattern pattern = Pattern.compile(\n+    \"^(\u043f\u043e\u0434\u043a\u043b\u044e\u0447\u0430\u0435\u043c\u044b\u0439|attachable)_\", Pattern.CASE_INSENSITIVE | Pattern.UNICODE_CASE);\n+\n+  private static final boolean CHECK_ATTACHABLE_METHODS = true;\n+\n+  @DiagnosticParameter(\n+    type = Boolean.class,\n+    defaultValue = \"\" + CHECK_ATTACHABLE_METHODS\n+  )\n+  private boolean checkAttachableMethods = CHECK_ATTACHABLE_METHODS;\n+\n+  public FunctionReturnsSamePrimitiveDiagnostic(DiagnosticInfo info) {\n+    super(info);\n+  }\n+\n+  @Override\n+  public ParseTree visitFunction(BSLParser.FunctionContext ctx) {\n+\n+    if (checkAttachableMethods) {\n+      // \u0418\u0441\u043a\u043b\u044e\u0447\u0430\u0435\u043c \u043f\u043e\u0434\u043a\u043b\u044e\u0447\u0430\u0435\u043c\u044b\u0435 \u043c\u0435\u0442\u043e\u0434\u044b\n+      var abortCheck = Optional.ofNullable(ctx.funcDeclaration())\n+        .map(BSLParser.FuncDeclarationContext::subName)\n+        .filter(subNameContext -> pattern.matcher(subNameContext.getText()).find())\n+        .isPresent();\n+      if (abortCheck) {\n+        return ctx;\n+      }\n+    }\n+\n+    var tree = Trees.findAllRuleNodes(ctx, BSLParser.RULE_returnStatement);\n+    if (tree.size() > 1) {\n+      var expressions = tree.stream()\n+        .map(BSLParser.ReturnStatementContext.class::cast)\n+        .map(BSLParser.ReturnStatementContext::expression)\n+        .flatMap(Stream::ofNullable)\n+        .collect(Collectors.toList());\n+\n+      expressions.stream()\n+        .map(expression -> Trees.findAllRuleNodes(expression, BSLParser.RULE_complexIdentifier))\n+        .filter(Collection::isEmpty)\n+        .findAny()\n+        .ifPresent(\n+          parseTrees -> checkPrimitiveValue(ctx, tree, expressions)\n+        );\n+    }\n+    return ctx;\n+  }\n+\n+  private void checkPrimitiveValue(\n+    BSLParser.FunctionContext ctx, Collection<ParseTree> tree, List<BSLParser.ExpressionContext> expressions) {\n+\n+    var set = expressions.stream()\n+      .map((BSLParser.ExpressionContext expression) -> {\n+        var text = expression.getText();\n+        if (Trees.findAllRuleNodes(expression, BSLParser.RULE_string).isEmpty()) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "406078f2faa521663e0bc245bd226ab56d355776"}, "originalPosition": 114}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDAxMTc1OTk2", "url": "https://github.com/1c-syntax/bsl-language-server/pull/1118#pullrequestreview-401175996", "createdAt": "2020-04-27T17:35:37Z", "commit": {"oid": "406078f2faa521663e0bc245bd226ab56d355776"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yN1QxNzozNTozN1rOGMvYng==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yN1QxNzozNTozN1rOGMvYng==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNjAxMjQ0Ng==", "bodyText": "info.getMessage() \u043d\u0435 \u043d\u0443\u0436\u043d\u043e \u043f\u0435\u0440\u0435\u0434\u0430\u0432\u0430\u0442\u044c", "url": "https://github.com/1c-syntax/bsl-language-server/pull/1118#discussion_r416012446", "createdAt": "2020-04-27T17:35:37Z", "author": {"login": "asosnoviy"}, "path": "src/main/java/com/github/_1c_syntax/bsl/languageserver/diagnostics/FunctionReturnsSamePrimitiveDiagnostic.java", "diffHunk": "@@ -0,0 +1,141 @@\n+/*\n+ * This file is a part of BSL Language Server.\n+ *\n+ * Copyright \u00a9 2018-2020\n+ * Alexey Sosnoviy <labotamy@gmail.com>, Nikita Gryzlov <nixel2007@gmail.com> and contributors\n+ *\n+ * SPDX-License-Identifier: LGPL-3.0-or-later\n+ *\n+ * BSL Language Server is free software; you can redistribute it and/or\n+ * modify it under the terms of the GNU Lesser General Public\n+ * License as published by the Free Software Foundation; either\n+ * version 3.0 of the License, or (at your option) any later version.\n+ *\n+ * BSL Language Server is distributed in the hope that it will be useful,\n+ * but WITHOUT ANY WARRANTY; without even the implied warranty of\n+ * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU\n+ * Lesser General Public License for more details.\n+ *\n+ * You should have received a copy of the GNU Lesser General Public\n+ * License along with BSL Language Server.\n+ */\n+package com.github._1c_syntax.bsl.languageserver.diagnostics;\n+\n+import com.github._1c_syntax.bsl.languageserver.context.symbol.MethodSymbol;\n+import com.github._1c_syntax.bsl.languageserver.diagnostics.metadata.DiagnosticInfo;\n+import com.github._1c_syntax.bsl.languageserver.diagnostics.metadata.DiagnosticMetadata;\n+import com.github._1c_syntax.bsl.languageserver.diagnostics.metadata.DiagnosticParameter;\n+import com.github._1c_syntax.bsl.languageserver.diagnostics.metadata.DiagnosticSeverity;\n+import com.github._1c_syntax.bsl.languageserver.diagnostics.metadata.DiagnosticTag;\n+import com.github._1c_syntax.bsl.languageserver.diagnostics.metadata.DiagnosticType;\n+import com.github._1c_syntax.bsl.languageserver.utils.Ranges;\n+import com.github._1c_syntax.bsl.languageserver.utils.RelatedInformation;\n+import com.github._1c_syntax.bsl.languageserver.utils.Trees;\n+import com.github._1c_syntax.bsl.parser.BSLParser;\n+import org.antlr.v4.runtime.ParserRuleContext;\n+import org.antlr.v4.runtime.tree.ParseTree;\n+import org.eclipse.lsp4j.Range;\n+\n+import java.util.Collection;\n+import java.util.List;\n+import java.util.Locale;\n+import java.util.Optional;\n+import java.util.regex.Pattern;\n+import java.util.stream.Collectors;\n+import java.util.stream.Stream;\n+\n+@DiagnosticMetadata(\n+  type = DiagnosticType.ERROR,\n+  severity = DiagnosticSeverity.MAJOR,\n+  minutesToFix = 5,\n+  tags = {\n+    DiagnosticTag.DESIGN,\n+    DiagnosticTag.BADPRACTICE\n+  }\n+\n+)\n+public class FunctionReturnsSamePrimitiveDiagnostic extends AbstractVisitorDiagnostic {\n+\n+  private static final String KEY_MESSAGE = \"diagnosticMessageReturnStatement\";\n+  private static final Pattern pattern = Pattern.compile(\n+    \"^(\u043f\u043e\u0434\u043a\u043b\u044e\u0447\u0430\u0435\u043c\u044b\u0439|attachable)_\", Pattern.CASE_INSENSITIVE | Pattern.UNICODE_CASE);\n+\n+  private static final boolean CHECK_ATTACHABLE_METHODS = true;\n+\n+  @DiagnosticParameter(\n+    type = Boolean.class,\n+    defaultValue = \"\" + CHECK_ATTACHABLE_METHODS\n+  )\n+  private boolean checkAttachableMethods = CHECK_ATTACHABLE_METHODS;\n+\n+  public FunctionReturnsSamePrimitiveDiagnostic(DiagnosticInfo info) {\n+    super(info);\n+  }\n+\n+  @Override\n+  public ParseTree visitFunction(BSLParser.FunctionContext ctx) {\n+\n+    if (checkAttachableMethods) {\n+      // \u0418\u0441\u043a\u043b\u044e\u0447\u0430\u0435\u043c \u043f\u043e\u0434\u043a\u043b\u044e\u0447\u0430\u0435\u043c\u044b\u0435 \u043c\u0435\u0442\u043e\u0434\u044b\n+      var abortCheck = Optional.ofNullable(ctx.funcDeclaration())\n+        .map(BSLParser.FuncDeclarationContext::subName)\n+        .filter(subNameContext -> pattern.matcher(subNameContext.getText()).find())\n+        .isPresent();\n+      if (abortCheck) {\n+        return ctx;\n+      }\n+    }\n+\n+    var tree = Trees.findAllRuleNodes(ctx, BSLParser.RULE_returnStatement);\n+    if (tree.size() > 1) {\n+      var expressions = tree.stream()\n+        .map(BSLParser.ReturnStatementContext.class::cast)\n+        .map(BSLParser.ReturnStatementContext::expression)\n+        .flatMap(Stream::ofNullable)\n+        .collect(Collectors.toList());\n+\n+      expressions.stream()\n+        .map(expression -> Trees.findAllRuleNodes(expression, BSLParser.RULE_complexIdentifier))\n+        .filter(Collection::isEmpty)\n+        .findAny()\n+        .ifPresent(\n+          parseTrees -> checkPrimitiveValue(ctx, tree, expressions)\n+        );\n+    }\n+    return ctx;\n+  }\n+\n+  private void checkPrimitiveValue(\n+    BSLParser.FunctionContext ctx, Collection<ParseTree> tree, List<BSLParser.ExpressionContext> expressions) {\n+\n+    var set = expressions.stream()\n+      .map((BSLParser.ExpressionContext expression) -> {\n+        var text = expression.getText();\n+        if (Trees.findAllRuleNodes(expression, BSLParser.RULE_string).isEmpty()) {\n+          text = text.toUpperCase(Locale.ENGLISH);\n+        }\n+        return text;\n+      })\n+      .collect(Collectors.toSet());\n+    if (set.size() == 1) {\n+      var relatedInformation = tree.stream()\n+        .map(BSLParser.ReturnStatementContext.class::cast)\n+        .map(statement -> RelatedInformation.create(\n+          documentContext.getUri(),\n+          Ranges.create(statement.getStart()),\n+          info.getResourceString(KEY_MESSAGE)))\n+        .collect(Collectors.toList());\n+      diagnosticStorage.addDiagnostic(getSubNameRange(ctx), info.getMessage(), relatedInformation);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "406078f2faa521663e0bc245bd226ab56d355776"}, "originalPosition": 128}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ccbc9212c28de9a81e4c5c5319079e0cc9a87894", "author": {"user": {"login": "otymko", "name": "Oleg Tymko"}}, "url": "https://github.com/1c-syntax/bsl-language-server/commit/ccbc9212c28de9a81e4c5c5319079e0cc9a87894", "committedDate": "2020-04-28T03:38:29Z", "message": "\u043e\u043f\u0446\u0438\u044f \u043d\u0430 \u0440\u0435\u0433\u0438\u0441\u0442\u0440 \u0434\u043b\u044f \u0441\u0442\u0440\u043e\u043a, \u0440\u0435\u043d\u0435\u0439\u043c \u043e\u043f\u0446\u0438\u0438 \u043f\u043e \u043f\u043e\u0434\u043a\u043b\u044e\u0447\u0430\u0435\u043c\u044b\u043c, \u0440\u0430\u0441\u0448\u0438\u0440\u0435\u043d\u044b \u0442\u0435\u0441\u0442\u044b."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "9b596f3d90f711ed6ffdc3ed06fab530f8b9a231", "author": {"user": {"login": "nixel2007", "name": "Nikita Fedkin"}}, "url": "https://github.com/1c-syntax/bsl-language-server/commit/9b596f3d90f711ed6ffdc3ed06fab530f8b9a231", "committedDate": "2020-04-28T06:03:21Z", "message": "Merge pull request #1087 from 1c-syntax/feature/commonModuleNameClientServer\n\nCommonModuleNameDiagnostics"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e78235cee50d99f5f0ab7bac98002239ff3fd5de", "author": {"user": {"login": "otymko", "name": "Oleg Tymko"}}, "url": "https://github.com/1c-syntax/bsl-language-server/commit/e78235cee50d99f5f0ab7bac98002239ff3fd5de", "committedDate": "2020-04-28T06:16:30Z", "message": "\u041f\u0435\u0440\u0432\u043e\u0435 \u043f\u0440\u0438\u0431\u043b\u0438\u0436\u0435\u043d\u0438\u0435"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "3a8ad5cb8452122a925bd3ed985a6e3e3c025203", "author": {"user": {"login": "otymko", "name": "Oleg Tymko"}}, "url": "https://github.com/1c-syntax/bsl-language-server/commit/3a8ad5cb8452122a925bd3ed985a6e3e3c025203", "committedDate": "2020-04-28T06:16:30Z", "message": "\u0418\u0441\u043a\u043b\u044e\u0447\u0435\u043d\u0438\u0435 \u043d\u0435 \u043f\u0440\u0438\u043c\u0438\u0442\u0438\u0432\u043e\u0432, \u0434\u043e\u043f\u043e\u043b\u043d\u0435\u043d\u0430 \u0434\u043e\u043a\u0443\u043c\u0435\u043d\u0442\u0430\u0446\u0438\u044f \u043d\u0430 ru, \u043f\u0435\u0440\u0435\u0438\u043c\u0435\u043d\u043e\u0432\u0430\u043d\u0438\u0435 \u0438\u043c\u0435\u043d\u0438 \u0444\u0430\u0439\u043b\u0430 \u043a\u0435\u0439\u0441\u0430 \u0434\u043b\u044f \u0442\u0435\u0441\u0442\u0430"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e2f0d2777eb05e17622e2369ff509b16e240555e", "author": {"user": {"login": "otymko", "name": "Oleg Tymko"}}, "url": "https://github.com/1c-syntax/bsl-language-server/commit/e2f0d2777eb05e17622e2369ff509b16e240555e", "committedDate": "2020-04-28T06:21:12Z", "message": "no message"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c666ebf83d77160d59ec3c4c31e559356d1a952b", "author": {"user": {"login": "otymko", "name": "Oleg Tymko"}}, "url": "https://github.com/1c-syntax/bsl-language-server/commit/c666ebf83d77160d59ec3c4c31e559356d1a952b", "committedDate": "2020-04-28T06:21:17Z", "message": "+ \u043f\u0440\u0435\u043a\u043e\u043c\u043c\u0438\u0442"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c5f53a5ce08e5aaa27d7edf843c73b9cc478e613", "author": {"user": {"login": "otymko", "name": "Oleg Tymko"}}, "url": "https://github.com/1c-syntax/bsl-language-server/commit/c5f53a5ce08e5aaa27d7edf843c73b9cc478e613", "committedDate": "2020-04-28T06:23:39Z", "message": "\u0414\u043e\u043f\u043e\u043b\u043d\u0435\u043d\u0430 \u0434\u043e\u043a\u0443\u043c\u0435\u043d\u0442\u0430\u0446\u0438\u044f, \u0437\u0430\u043f\u0443\u0449\u0435\u043d \u043f\u0440\u0435\u043a\u043e\u043c\u043c\u0438\u0442, \u0434\u043e\u0431\u0430\u0432\u043b\u0435\u043d\u0430 \u043f\u043e\u0442\u0435\u0440\u044f\u043d\u043d\u0430\u044f \u043b\u0438\u0446\u0435\u043d\u0437\u0438\u044f \u0432 \u0444\u0430\u0439\u043b\u0435 \u0442\u0435\u0441\u0442\u0430."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "49a71fc9f98dc5ef5100f28f06c41db5722ab952", "author": {"user": {"login": "otymko", "name": "Oleg Tymko"}}, "url": "https://github.com/1c-syntax/bsl-language-server/commit/49a71fc9f98dc5ef5100f28f06c41db5722ab952", "committedDate": "2020-04-28T06:23:40Z", "message": "\u0418\u0441\u043a\u043b\u044e\u0447\u0435\u043d\u0438\u0435 \u0438\u0437 \u043f\u0440\u043e\u0432\u0435\u0440\u043a\u0438 \u043f\u043e\u0434\u043a\u043b\u044e\u0447\u0430\u0435\u043c\u044b\u0445 \u0444\u0443\u043d\u043a\u0446\u0438\u0439"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "0b712d412880a7757d23eb9e6c303819fad5b28c", "author": {"user": {"login": "otymko", "name": "Oleg Tymko"}}, "url": "https://github.com/1c-syntax/bsl-language-server/commit/0b712d412880a7757d23eb9e6c303819fad5b28c", "committedDate": "2020-04-28T06:23:40Z", "message": "\u0414\u043e\u043f\u043e\u043b\u043d\u0435\u043d\u0438\u0435 \u0434\u043e\u043a\u0443\u043c\u0435\u043d\u0442\u0430\u0446\u0438\u0438"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "5a099f8a6ae7e2aa98408a9e41f43da917ddc831", "author": {"user": {"login": "otymko", "name": "Oleg Tymko"}}, "url": "https://github.com/1c-syntax/bsl-language-server/commit/5a099f8a6ae7e2aa98408a9e41f43da917ddc831", "committedDate": "2020-04-28T06:23:41Z", "message": "\u041e\u0431\u0440\u0430\u0431\u043e\u0442\u043a\u0430 \u0441\u0440\u0430\u0432\u043d\u0435\u043d\u0438\u044f \u0437\u043d\u0430\u0447\u0435\u043d\u0438\u0439 \u0432 \u0440\u0430\u0437\u043d\u044b\u0445 \u0440\u0435\u0433\u0438\u0441\u0442\u0440\u0430\u0445 (\u043d\u0430\u043f\u0440\u0438\u043c\u0435\u0440 Null \u0438 NULL)"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "dd9ac1d343bb888e9d3400c6e7817da55512c9bc", "author": {"user": {"login": "otymko", "name": "Oleg Tymko"}}, "url": "https://github.com/1c-syntax/bsl-language-server/commit/dd9ac1d343bb888e9d3400c6e7817da55512c9bc", "committedDate": "2020-04-28T06:23:41Z", "message": "\u041d\u0435 \u043f\u0440\u0435\u0432\u043e\u0434\u0438\u0442\u044c \u0421\u0442\u0440\u043e\u043a\u0438 \u043a \u0432\u0435\u0440\u0445\u043d\u0435\u043c\u0443 \u0440\u0435\u0433\u0438\u0441\u0442\u0440\u0443"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b8a72d89bd9de948f1a034ce7445824bc61620dd", "author": {"user": {"login": "otymko", "name": "Oleg Tymko"}}, "url": "https://github.com/1c-syntax/bsl-language-server/commit/b8a72d89bd9de948f1a034ce7445824bc61620dd", "committedDate": "2020-04-28T06:23:42Z", "message": "\u041f\u0430\u0440\u0430\u043c\u0435\u0442\u0440 \"\u041f\u0440\u043e\u0432\u0435\u0440\u044f\u0442\u044c \u043f\u043e\u0434\u043a\u043b\u044e\u0447\u0430\u0435\u043c\u044b\u0435 \u043c\u0435\u0442\u043e\u0434\u044b\" \u0438 \u0434\u043e\u0440\u0430\u0431\u043e\u0442\u043a\u0430 \u0442\u0435\u0441\u0442\u043e\u0432"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b958bba32910c74c2a195f7aebcb90be03c119d4", "author": {"user": {"login": "otymko", "name": "Oleg Tymko"}}, "url": "https://github.com/1c-syntax/bsl-language-server/commit/b958bba32910c74c2a195f7aebcb90be03c119d4", "committedDate": "2020-04-28T06:23:42Z", "message": "\u041f\u0440\u0435\u043a\u043e\u043c\u043c\u0438\u0442"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "864f769df51150ef4fd28ec43c554f99ec5f8192", "author": {"user": {"login": "otymko", "name": "Oleg Tymko"}}, "url": "https://github.com/1c-syntax/bsl-language-server/commit/864f769df51150ef4fd28ec43c554f99ec5f8192", "committedDate": "2020-04-28T06:23:44Z", "message": "\u043e\u043f\u0446\u0438\u044f \u043d\u0430 \u0440\u0435\u0433\u0438\u0441\u0442\u0440 \u0434\u043b\u044f \u0441\u0442\u0440\u043e\u043a, \u0440\u0435\u043d\u0435\u0439\u043c \u043e\u043f\u0446\u0438\u0438 \u043f\u043e \u043f\u043e\u0434\u043a\u043b\u044e\u0447\u0430\u0435\u043c\u044b\u043c, \u0440\u0430\u0441\u0448\u0438\u0440\u0435\u043d\u044b \u0442\u0435\u0441\u0442\u044b."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "59b717d63d55fe8560007ceb857dd2805d8accef", "author": {"user": {"login": "otymko", "name": "Oleg Tymko"}}, "url": "https://github.com/1c-syntax/bsl-language-server/commit/59b717d63d55fe8560007ceb857dd2805d8accef", "committedDate": "2020-04-28T06:24:23Z", "message": "Merge branch 'feature/issue110' of https://github.com/1c-syntax/bsl-language-server into feature/issue110\n\n# Conflicts:\n#\tdocs/diagnostics/index.md\n#\tdocs/en/diagnostics/index.md\n#\tsrc/main/resources/com/github/_1c_syntax/bsl/languageserver/configuration/parameters-schema.json"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "44b704ea4cbe07b7784cd36fa534f17ca753ed2b", "author": {"user": {"login": "otymko", "name": "Oleg Tymko"}}, "url": "https://github.com/1c-syntax/bsl-language-server/commit/44b704ea4cbe07b7784cd36fa534f17ca753ed2b", "committedDate": "2020-04-28T06:31:09Z", "message": "\u0430\u043a\u0442\u0443\u0430\u043b\u0438\u0437\u0430\u0446\u0438\u044f precommit"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4750, "cost": 1, "resetAt": "2021-10-29T17:30:11Z"}}}