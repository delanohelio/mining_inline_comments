{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDA5OTM2NTI1", "number": 8903, "reviewThreads": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yOFQwOToxMToyM1rOD3GZOw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yOFQwOToxMToyM1rOD3GZOw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjU5MTAzMDM1OnYy", "diffSide": "RIGHT", "path": "extensions/resteasy-common/runtime/src/main/java/io/quarkus/resteasy/common/runtime/ResteasyContextProvider.java", "isResolved": false, "comments": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yOFQwOToxMToyM1rOGNKe8g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0zMFQwMzo0NToyN1rOGOYpfw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNjQ1NjQzNA==", "bodyText": "Not sure this works, because you may need to capture the fact that there's no context, to make sure that when you run the action you remove any existing context.", "url": "https://github.com/quarkusio/quarkus/pull/8903#discussion_r416456434", "createdAt": "2020-04-28T09:11:23Z", "author": {"login": "FroMage"}, "path": "extensions/resteasy-common/runtime/src/main/java/io/quarkus/resteasy/common/runtime/ResteasyContextProvider.java", "diffHunk": "@@ -13,7 +14,10 @@\n \n     @Override\n     public ThreadContextSnapshot currentContext(Map<String, String> props) {\n-        Map<Class<?>, Object> context = ResteasyContext.getContextDataMap();\n+        Map<Class<?>, Object> context = ResteasyContext.getContextDataMap(false);\n+        if (context == null) {\n+            return null;\n+        }", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "cf693b7a802df8a72528d73c347453a20312312f"}, "originalPosition": 16}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNjUwNDUzMA==", "bodyText": "Does that actually matter? There won't be a context unless you are inside a RESTEasy request, or unless you have saved it.", "url": "https://github.com/quarkusio/quarkus/pull/8903#discussion_r416504530", "createdAt": "2020-04-28T10:28:04Z", "author": {"login": "stuartwdouglas"}, "path": "extensions/resteasy-common/runtime/src/main/java/io/quarkus/resteasy/common/runtime/ResteasyContextProvider.java", "diffHunk": "@@ -13,7 +14,10 @@\n \n     @Override\n     public ThreadContextSnapshot currentContext(Map<String, String> props) {\n-        Map<Class<?>, Object> context = ResteasyContext.getContextDataMap();\n+        Map<Class<?>, Object> context = ResteasyContext.getContextDataMap(false);\n+        if (context == null) {\n+            return null;\n+        }", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNjQ1NjQzNA=="}, "originalCommit": {"oid": "cf693b7a802df8a72528d73c347453a20312312f"}, "originalPosition": 16}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNzE1NjczMQ==", "bodyText": "Well, you don't know where a Uni is coming from. If it came from a place outside of a request context, it will have no RESTEasy context. If you then complete it from within a context, it will inherit the RESTEasy context by accident, where it should not.", "url": "https://github.com/quarkusio/quarkus/pull/8903#discussion_r417156731", "createdAt": "2020-04-29T08:42:45Z", "author": {"login": "FroMage"}, "path": "extensions/resteasy-common/runtime/src/main/java/io/quarkus/resteasy/common/runtime/ResteasyContextProvider.java", "diffHunk": "@@ -13,7 +14,10 @@\n \n     @Override\n     public ThreadContextSnapshot currentContext(Map<String, String> props) {\n-        Map<Class<?>, Object> context = ResteasyContext.getContextDataMap();\n+        Map<Class<?>, Object> context = ResteasyContext.getContextDataMap(false);\n+        if (context == null) {\n+            return null;\n+        }", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNjQ1NjQzNA=="}, "originalCommit": {"oid": "cf693b7a802df8a72528d73c347453a20312312f"}, "originalPosition": 16}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNzczNzA4Nw==", "bodyText": "I still don't think this is a real issue. If there is a RESTEasy request is progress then CP will have captured the context, so it should be propagated everywhere and there is no change of behaviour. The only way this will be missing is if a request is started with no request is progress, and then ends up in a RESTEasy request, such as with lazy authentication. This could mean that RESTEasy requests effectively loose their context once they start dealing with the SecurityIdentity, which does not seem ideal IMHO.", "url": "https://github.com/quarkusio/quarkus/pull/8903#discussion_r417737087", "createdAt": "2020-04-30T03:45:27Z", "author": {"login": "stuartwdouglas"}, "path": "extensions/resteasy-common/runtime/src/main/java/io/quarkus/resteasy/common/runtime/ResteasyContextProvider.java", "diffHunk": "@@ -13,7 +14,10 @@\n \n     @Override\n     public ThreadContextSnapshot currentContext(Map<String, String> props) {\n-        Map<Class<?>, Object> context = ResteasyContext.getContextDataMap();\n+        Map<Class<?>, Object> context = ResteasyContext.getContextDataMap(false);\n+        if (context == null) {\n+            return null;\n+        }", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNjQ1NjQzNA=="}, "originalCommit": {"oid": "cf693b7a802df8a72528d73c347453a20312312f"}, "originalPosition": 16}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3307, "cost": 1, "resetAt": "2021-11-13T14:23:39Z"}}}