{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0MzkxMjk5NjU3", "number": 8005, "title": "Don't let the thread interrupt state interfere with class loading", "bodyText": "", "createdAt": "2020-03-20T00:32:53Z", "url": "https://github.com/quarkusio/quarkus/pull/8005", "merged": true, "mergeCommit": {"oid": "eb2f5b7e6c53cd443b101dbba9df519459fb05f0"}, "closed": true, "closedAt": "2020-03-25T03:15:12Z", "author": {"login": "stuartwdouglas"}, "timelineItems": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcPVh22ABqjMxNDc3Mjk4NDk=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcQWJGHgBqjMxNTM1Mjk3NTI=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "e7c22c0b518034c64d333567e43bd39793ace5c4", "author": {"user": {"login": "stuartwdouglas", "name": "Stuart Douglas"}}, "url": "https://github.com/quarkusio/quarkus/commit/e7c22c0b518034c64d333567e43bd39793ace5c4", "committedDate": "2020-03-20T00:32:17Z", "message": "Don't let the thread interrupt state interfere with class loading"}, "afterCommit": {"oid": "44c8cf98d37c041b3c9538a7761b1c4b2d6c7db3", "author": {"user": {"login": "stuartwdouglas", "name": "Stuart Douglas"}}, "url": "https://github.com/quarkusio/quarkus/commit/44c8cf98d37c041b3c9538a7761b1c4b2d6c7db3", "committedDate": "2020-03-20T00:38:55Z", "message": "Don't let the thread interrupt state interfere with class loading"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzc4NDk0ODMz", "url": "https://github.com/quarkusio/quarkus/pull/8005#pullrequestreview-378494833", "createdAt": "2020-03-20T13:45:45Z", "commit": {"oid": "44c8cf98d37c041b3c9538a7761b1c4b2d6c7db3"}, "state": "APPROVED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yMFQxMzo0NTo0NVrOF5US6g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yMFQxMzo0NTo0NVrOF5US6g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NTY0NTY3NA==", "bodyText": "In general I think this makes sense.  It's not perfect in that the thread can be interrupted during the class load, but I don't really have any better solution for that at bootstrap (JBossThread does have support for blocking interrupts but I'm assuming that it isn't available at bootstrap).", "url": "https://github.com/quarkusio/quarkus/pull/8005#discussion_r395645674", "createdAt": "2020-03-20T13:45:45Z", "author": {"login": "dmlloyd"}, "path": "independent-projects/bootstrap/core/src/main/java/io/quarkus/bootstrap/classloading/QuarkusClassLoader.java", "diffHunk": "@@ -253,44 +253,55 @@ public InputStream getResourceAsStream(String nm) {\n \n     @Override\n     protected Class<?> loadClass(String name, boolean resolve) throws ClassNotFoundException {\n-        ClassLoaderState state = getState();\n-        synchronized (getClassLoadingLock(name)) {\n-            Class<?> c = findLoadedClass(name);\n-            if (c != null) {\n-                return c;\n-            }\n-            String resourceName = sanitizeName(name).replace(\".\", \"/\") + \".class\";\n-            boolean parentFirst = parentFirst(resourceName, state);\n-            if (state.bannedResources.contains(resourceName)) {\n-                throw new ClassNotFoundException(name);\n-            }\n-            if (parentFirst) {\n-                try {\n-                    return parent.loadClass(name);\n-                } catch (ClassNotFoundException ignore) {\n-                    log.tracef(\"Class %s not found in parent first load from %s\", name, parent);\n+        //even if the thread is interrupted we still want to be able to load classes\n+        //if the interrupt bit is set then we clear it and restore it at the end\n+        boolean interrupted = Thread.interrupted();\n+        try {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "44c8cf98d37c041b3c9538a7761b1c4b2d6c7db3"}, "originalPosition": 23}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "44c8cf98d37c041b3c9538a7761b1c4b2d6c7db3", "author": {"user": {"login": "stuartwdouglas", "name": "Stuart Douglas"}}, "url": "https://github.com/quarkusio/quarkus/commit/44c8cf98d37c041b3c9538a7761b1c4b2d6c7db3", "committedDate": "2020-03-20T00:38:55Z", "message": "Don't let the thread interrupt state interfere with class loading"}, "afterCommit": {"oid": "5e79b536ed671d293df7eb83d4ecef50aca0a1f1", "author": {"user": {"login": "stuartwdouglas", "name": "Stuart Douglas"}}, "url": "https://github.com/quarkusio/quarkus/commit/5e79b536ed671d293df7eb83d4ecef50aca0a1f1", "committedDate": "2020-03-23T03:25:45Z", "message": "Don't let the thread interrupt state interfere with class loading"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f96f10ec6e60858970d360f529a0670932e8b572", "author": {"user": {"login": "stuartwdouglas", "name": "Stuart Douglas"}}, "url": "https://github.com/quarkusio/quarkus/commit/f96f10ec6e60858970d360f529a0670932e8b572", "committedDate": "2020-03-23T03:55:37Z", "message": "Don't let the thread interrupt state interfere with class loading"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "5e79b536ed671d293df7eb83d4ecef50aca0a1f1", "author": {"user": {"login": "stuartwdouglas", "name": "Stuart Douglas"}}, "url": "https://github.com/quarkusio/quarkus/commit/5e79b536ed671d293df7eb83d4ecef50aca0a1f1", "committedDate": "2020-03-23T03:25:45Z", "message": "Don't let the thread interrupt state interfere with class loading"}, "afterCommit": {"oid": "f96f10ec6e60858970d360f529a0670932e8b572", "author": {"user": {"login": "stuartwdouglas", "name": "Stuart Douglas"}}, "url": "https://github.com/quarkusio/quarkus/commit/f96f10ec6e60858970d360f529a0670932e8b572", "committedDate": "2020-03-23T03:55:37Z", "message": "Don't let the thread interrupt state interfere with class loading"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3754, "cost": 1, "resetAt": "2021-11-02T10:47:05Z"}}}