{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDA3NDIwMjA5", "number": 8762, "title": "Fix broken Kafka Quickstarts", "bodyText": "Fix broken Kafka Quickstarts\nThis problem was introduced by our bump to Kafka 2.5.\nThe substitution uses simple reflection to invoke the cleaner\non a DirectByteBuffer", "createdAt": "2020-04-22T17:04:38Z", "url": "https://github.com/quarkusio/quarkus/pull/8762", "merged": true, "mergeCommit": {"oid": "65e125299f62502567b99da1aad6ccdc11fdd094"}, "closed": true, "closedAt": "2020-04-23T09:22:02Z", "author": {"login": "geoand"}, "timelineItems": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcaXj-9AFqTM5ODgxOTQwMg==", "endCursor": "Y3Vyc29yOnYyOpPPAAABcaY569AFqTM5ODg5MDMwNw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzk4ODE5NDAy", "url": "https://github.com/quarkusio/quarkus/pull/8762#pullrequestreview-398819402", "createdAt": "2020-04-23T07:15:10Z", "commit": {"oid": "2b117fbc38967fd3f35cb820be3e4ac73aa9f602"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yM1QwNzoxNToxMFrOGKaPEQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yM1QwNzoxNToxMFrOGKaPEQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMzU2ODc4NQ==", "bodyText": "Should we add ByteBuffer in the reflection list. The cleaner method may be removed during the native compilation. The class returned by the \"cleaner\" method should also be registered.", "url": "https://github.com/quarkusio/quarkus/pull/8762#discussion_r413568785", "createdAt": "2020-04-23T07:15:10Z", "author": {"login": "cescoffier"}, "path": "extensions/kafka-client/runtime/src/main/java/io/quarkus/kafka/client/runtime/graal/ByteBufferUnmapper.java", "diffHunk": "@@ -0,0 +1,32 @@\n+package io.quarkus.kafka.client.runtime.graal;\n+\n+import java.io.IOException;\n+import java.lang.reflect.Method;\n+import java.nio.ByteBuffer;\n+\n+import org.apache.kafka.common.utils.ByteBufferUnmapper;\n+\n+import com.oracle.svm.core.annotate.Substitute;\n+import com.oracle.svm.core.annotate.TargetClass;\n+import com.oracle.svm.core.jdk.JDK8OrEarlier;\n+\n+@TargetClass(value = ByteBufferUnmapper.class, onlyWith = JDK8OrEarlier.class)\n+final class Target_org_apache_kafka_common_utils_ByteBufferUnmapper {\n+\n+    @Substitute\n+    public static void unmap(String resourceDescription, ByteBuffer buffer) throws IOException {\n+        if (!buffer.isDirect())\n+            throw new IllegalArgumentException(\"Unmapping only works with direct buffers\");\n+        try {\n+            Method cleanerMethod = buffer.getClass().getMethod(\"cleaner\");", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "2b117fbc38967fd3f35cb820be3e4ac73aa9f602"}, "originalPosition": 21}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "2f35a3a58cceaca401b12a729fac6c9447f8f684", "author": {"user": {"login": "geoand", "name": "Georgios Andrianakis"}}, "url": "https://github.com/quarkusio/quarkus/commit/2f35a3a58cceaca401b12a729fac6c9447f8f684", "committedDate": "2020-04-23T07:34:22Z", "message": "Fix broken Kafka Quickstarts\n\nThis problem was introduced by our bump to Kafka 2.5.\nThe substitution uses simple reflection to invoke the cleaner\non a DirectByteBuffer"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "2b117fbc38967fd3f35cb820be3e4ac73aa9f602", "author": {"user": {"login": "geoand", "name": "Georgios Andrianakis"}}, "url": "https://github.com/quarkusio/quarkus/commit/2b117fbc38967fd3f35cb820be3e4ac73aa9f602", "committedDate": "2020-04-23T06:58:21Z", "message": "Fix broken Kafka Quickstarts\n\nThis problem was introduced by our bump to Kafka 2.5.\nThe substitution uses simple reflection to invoke the cleaner\non a DirectByteBuffer"}, "afterCommit": {"oid": "2f35a3a58cceaca401b12a729fac6c9447f8f684", "author": {"user": {"login": "geoand", "name": "Georgios Andrianakis"}}, "url": "https://github.com/quarkusio/quarkus/commit/2f35a3a58cceaca401b12a729fac6c9447f8f684", "committedDate": "2020-04-23T07:34:22Z", "message": "Fix broken Kafka Quickstarts\n\nThis problem was introduced by our bump to Kafka 2.5.\nThe substitution uses simple reflection to invoke the cleaner\non a DirectByteBuffer"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzk4ODkwMDIy", "url": "https://github.com/quarkusio/quarkus/pull/8762#pullrequestreview-398890022", "createdAt": "2020-04-23T08:48:44Z", "commit": {"oid": "2f35a3a58cceaca401b12a729fac6c9447f8f684"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzk4ODkwMzA3", "url": "https://github.com/quarkusio/quarkus/pull/8762#pullrequestreview-398890307", "createdAt": "2020-04-23T08:49:05Z", "commit": {"oid": "2f35a3a58cceaca401b12a729fac6c9447f8f684"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yM1QwODo0OTowNlrOGKeIDA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yM1QwODo0OTowNlrOGKeIDA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMzYzMjUyNA==", "bodyText": "Wondering if that would fail on Java 11... The CI will let us now.", "url": "https://github.com/quarkusio/quarkus/pull/8762#discussion_r413632524", "createdAt": "2020-04-23T08:49:06Z", "author": {"login": "cescoffier"}, "path": "extensions/kafka-client/deployment/src/main/java/io/quarkus/kafka/client/deployment/KafkaProcessor.java", "diffHunk": "@@ -105,6 +105,10 @@ public void build(CombinedIndexBuildItem indexBuildItem, BuildProducer<Reflectiv\n         reflectiveClass.produce(new ReflectiveClassBuildItem(false, false, RangeAssignor.class.getName()));\n         reflectiveClass.produce(new ReflectiveClassBuildItem(false, false, RoundRobinAssignor.class.getName()));\n         reflectiveClass.produce(new ReflectiveClassBuildItem(false, false, StickyAssignor.class.getName()));\n+\n+        // classes needed to perform reflection on DirectByteBuffer - only really needed for Java 8\n+        reflectiveClass.produce(new ReflectiveClassBuildItem(true, false, \"java.nio.DirectByteBuffer\"));\n+        reflectiveClass.produce(new ReflectiveClassBuildItem(true, false, \"sun.misc.Cleaner\"));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "2f35a3a58cceaca401b12a729fac6c9447f8f684"}, "originalPosition": 7}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4483, "cost": 1, "resetAt": "2021-11-02T10:47:05Z"}}}