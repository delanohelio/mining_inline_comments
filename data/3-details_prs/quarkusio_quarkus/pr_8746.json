{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDA3MjY4NDU5", "number": 8746, "title": "fix MDC scope nesting", "bodyText": "Fixes #8722.", "createdAt": "2020-04-22T12:48:49Z", "url": "https://github.com/quarkusio/quarkus/pull/8746", "merged": true, "mergeCommit": {"oid": "843f1810c783b966b9345a2e4993ef7107af7936"}, "closed": true, "closedAt": "2020-04-22T17:48:43Z", "author": {"login": "Ladicek"}, "timelineItems": {"totalCount": 6, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcaKRv6gFqTM5ODMyNzc3Mg==", "endCursor": "Y3Vyc29yOnYyOpPPAAABcaMBMugFqTM5ODQzMjg5MQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzk4MzI3Nzcy", "url": "https://github.com/quarkusio/quarkus/pull/8746#pullrequestreview-398327772", "createdAt": "2020-04-22T15:46:32Z", "commit": {"oid": "8daf8865c6750d72b9509910575ec91c0fd62b76"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yMlQxNTo0NjozM1rOGJ9iLg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yMlQxNTo0NjozM1rOGJ9iLg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMzA5ODU0Mg==", "bodyText": "Could be this test moved to Jaeger artifact - close to the MDC implementation?", "url": "https://github.com/quarkusio/quarkus/pull/8746#discussion_r413098542", "createdAt": "2020-04-22T15:46:33Z", "author": {"login": "pavolloffay"}, "path": "extensions/smallrye-opentracing/deployment/src/test/java/io/quarkus/smallrye/opentracing/deployment/NestedMdcScopesTest.java", "diffHunk": "@@ -0,0 +1,118 @@\n+package io.quarkus.smallrye.opentracing.deployment;\n+\n+import static org.junit.jupiter.api.Assertions.assertEquals;\n+import static org.junit.jupiter.api.Assertions.assertNull;\n+\n+import java.util.Map;\n+\n+import org.jboss.logging.MDC;\n+import org.junit.jupiter.api.Test;\n+\n+import io.jaegertracing.internal.JaegerSpanContext;\n+import io.opentracing.Scope;\n+import io.opentracing.Span;\n+import io.opentracing.SpanContext;\n+import io.opentracing.util.ThreadLocalScopeManager;\n+import io.quarkus.jaeger.runtime.MDCScopeManager;\n+\n+public class NestedMdcScopesTest {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "8daf8865c6750d72b9509910575ec91c0fd62b76"}, "originalPosition": 18}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "5081fecaf65a8d359f412b74d55fb7010cb1c027", "author": {"user": {"login": "Ladicek", "name": "Ladislav Thon"}}, "url": "https://github.com/quarkusio/quarkus/commit/5081fecaf65a8d359f412b74d55fb7010cb1c027", "committedDate": "2020-04-22T16:05:34Z", "message": "fix MDC scope nesting"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "8daf8865c6750d72b9509910575ec91c0fd62b76", "author": {"user": {"login": "Ladicek", "name": "Ladislav Thon"}}, "url": "https://github.com/quarkusio/quarkus/commit/8daf8865c6750d72b9509910575ec91c0fd62b76", "committedDate": "2020-04-22T12:48:19Z", "message": "fix MDC scope nesting"}, "afterCommit": {"oid": "5081fecaf65a8d359f412b74d55fb7010cb1c027", "author": {"user": {"login": "Ladicek", "name": "Ladislav Thon"}}, "url": "https://github.com/quarkusio/quarkus/commit/5081fecaf65a8d359f412b74d55fb7010cb1c027", "committedDate": "2020-04-22T16:05:34Z", "message": "fix MDC scope nesting"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzk4MzU1NDY4", "url": "https://github.com/quarkusio/quarkus/pull/8746#pullrequestreview-398355468", "createdAt": "2020-04-22T16:16:57Z", "commit": {"oid": "5081fecaf65a8d359f412b74d55fb7010cb1c027"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yMlQxNjoxNjo1N1rOGJ--fw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yMlQxNjoxNjo1N1rOGJ--fw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMzEyMjE3NQ==", "bodyText": "This certainly fixes the problem, but I am wondering whether it isn't better to just restore the old values of the keys that were removed. For instance they could be explicitly set by a user or other integration.", "url": "https://github.com/quarkusio/quarkus/pull/8746#discussion_r413122175", "createdAt": "2020-04-22T16:16:57Z", "author": {"login": "pavolloffay"}, "path": "extensions/jaeger/runtime/src/main/java/io/quarkus/jaeger/runtime/MDCScope.java", "diffHunk": "@@ -33,6 +35,10 @@ public void close() {\n         MDC.remove(TRACE_ID);\n         MDC.remove(SPAN_ID);\n         MDC.remove(SAMPLED);\n+\n+        if (toRestore != null && toRestore.span().context() instanceof JaegerSpanContext) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "5081fecaf65a8d359f412b74d55fb7010cb1c027"}, "originalPosition": 17}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzk4MzU1NjYw", "url": "https://github.com/quarkusio/quarkus/pull/8746#pullrequestreview-398355660", "createdAt": "2020-04-22T16:17:11Z", "commit": {"oid": "5081fecaf65a8d359f412b74d55fb7010cb1c027"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzk4NDMyODkx", "url": "https://github.com/quarkusio/quarkus/pull/8746#pullrequestreview-398432891", "createdAt": "2020-04-22T17:48:17Z", "commit": {"oid": "5081fecaf65a8d359f412b74d55fb7010cb1c027"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4476, "cost": 1, "resetAt": "2021-11-02T10:47:05Z"}}}