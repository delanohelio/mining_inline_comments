{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDk2NTEwNTg1", "number": 12462, "title": "Add warning for MP Metric API usage with Micrometer", "bodyText": "Future versions will require use of SmallRye Metrics extension to use MP Metrics APIs", "createdAt": "2020-10-01T19:54:43Z", "url": "https://github.com/quarkusio/quarkus/pull/12462", "merged": true, "mergeCommit": {"oid": "244929f3f8b78d94213903bc24726b286cf23915"}, "closed": true, "closedAt": "2020-10-05T14:08:20Z", "author": {"login": "kenfinnigan"}, "timelineItems": {"totalCount": 11, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdOXIwEgBqjM4MzEyNTYwNjU=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdPkTPjAFqTUwMjA4OTQzMg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "cee5677025c229c7ef9852aa84f9c63d01fa459f", "author": {"user": {"login": "kenfinnigan", "name": "Ken Finnigan"}}, "url": "https://github.com/quarkusio/quarkus/commit/cee5677025c229c7ef9852aa84f9c63d01fa459f", "committedDate": "2020-10-01T19:54:08Z", "message": "Add warning for MP Metric API usage with Micrometer\n\n- Future versions will require use of SmallRye Metrics extension to use MP Metrics APIs"}, "afterCommit": {"oid": "194611471e8f2fbde78c7c7794530d1829b10a3c", "author": {"user": {"login": "kenfinnigan", "name": "Ken Finnigan"}}, "url": "https://github.com/quarkusio/quarkus/commit/194611471e8f2fbde78c7c7794530d1829b10a3c", "committedDate": "2020-10-01T20:09:17Z", "message": "Add warning for MP Metric API usage with Micrometer\n\n- Future versions will require use of SmallRye Metrics extension to use MP Metrics APIs"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTAwNjg2MjI0", "url": "https://github.com/quarkusio/quarkus/pull/12462#pullrequestreview-500686224", "createdAt": "2020-10-01T20:16:50Z", "commit": {"oid": "194611471e8f2fbde78c7c7794530d1829b10a3c"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wMVQyMDoxNjo1MFrOHbZcEQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wMVQyMDoxNzoxN1rOHbZc7A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5ODQ5MDM4NQ==", "bodyText": "We can't word the warning this way unless/until the smallrye-metrics and micrometer extensions can be enabled at the same time.  What might be better is to warn that the MP Metrics API is being supported in a compatibility mode, which may be subject to change over time. (or something).", "url": "https://github.com/quarkusio/quarkus/pull/12462#discussion_r498490385", "createdAt": "2020-10-01T20:16:50Z", "author": {"login": "ebullient"}, "path": "extensions/micrometer/deployment/src/main/java/io/quarkus/micrometer/deployment/binder/mpmetrics/MicroprofileMetricsProcessor.java", "diffHunk": "@@ -62,6 +62,25 @@ AdditionalBeanBuildItem registerBeanClasses() {\n                 .build();\n     }\n \n+    @BuildStep(onlyIf = MicroprofileMetricsEnabled.class)\n+    void logWarningForMpMetricsUsage(CombinedIndexBuildItem combinedIndexBuildItem) {\n+        IndexView index = combinedIndexBuildItem.getIndex();\n+        boolean mpMetricsPresent = false;\n+\n+        // Find usage of MP Metrics annotations\n+        for (DotName annotation : MetricDotNames.individualMetrics) {\n+            if (index.getAnnotations(annotation).size() > 0) {\n+                mpMetricsPresent = true;\n+                break;\n+            }\n+        }\n+\n+        if (mpMetricsPresent) {\n+            log.warn(\"Use of MicroProfile Metrics annotations with the `quarkus-micrometer` extension in future Quarkus \" +\n+                    \"versions will require using the `quarkus-smallrye-metrics` extension instead.\");\n+        }", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "194611471e8f2fbde78c7c7794530d1829b10a3c"}, "originalPosition": 20}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5ODQ5MDYwNA==", "bodyText": "Same as above.", "url": "https://github.com/quarkusio/quarkus/pull/12462#discussion_r498490604", "createdAt": "2020-10-01T20:17:17Z", "author": {"login": "ebullient"}, "path": "extensions/micrometer/runtime/src/main/java/io/quarkus/micrometer/runtime/config/MicroprofileMetricsConfig.java", "diffHunk": "@@ -14,15 +14,18 @@\n      * Microprofile Metrics support.\n      * <p>\n      * Support for Microprofile metrics will be enabled if micrometer\n-     * support is enabled, and this value is true. You need to also\n-     * include the microprofile api jar to your dependencies:\n+     * support is enabled and the MicroProfile Metrics dependency is present:\n      *\n      * <pre>\n      * &lt;dependency&gt;\n      *   &lt;groupId&gt;org.eclipse.microprofile.metrics&lt;/groupId&gt;\n      *   &lt;artifactId&gt;microprofile-metrics-api&lt;/artifactId&gt;\n      * &lt;/dependency&gt;\n      * </pre>\n+     * <p>\n+     * Future versions of the micrometer extension will not include compatibility\n+     * for MicroProfile Metrics. A future version will require the\n+     * `quarkus-smallrye-metrics` extension for MicroProfile Metrics APIs with micrometer.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "194611471e8f2fbde78c7c7794530d1829b10a3c"}, "originalPosition": 17}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTAwODk1MjI1", "url": "https://github.com/quarkusio/quarkus/pull/12462#pullrequestreview-500895225", "createdAt": "2020-10-02T06:55:25Z", "commit": {"oid": "194611471e8f2fbde78c7c7794530d1829b10a3c"}, "state": "COMMENTED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "194611471e8f2fbde78c7c7794530d1829b10a3c", "author": {"user": {"login": "kenfinnigan", "name": "Ken Finnigan"}}, "url": "https://github.com/quarkusio/quarkus/commit/194611471e8f2fbde78c7c7794530d1829b10a3c", "committedDate": "2020-10-01T20:09:17Z", "message": "Add warning for MP Metric API usage with Micrometer\n\n- Future versions will require use of SmallRye Metrics extension to use MP Metrics APIs"}, "afterCommit": {"oid": "23d0c172e6a407464118dfb1bd098d86650e214f", "author": {"user": {"login": "kenfinnigan", "name": "Ken Finnigan"}}, "url": "https://github.com/quarkusio/quarkus/commit/23d0c172e6a407464118dfb1bd098d86650e214f", "committedDate": "2020-10-02T13:35:49Z", "message": "Add warning for MP Metric API usage with Micrometer\n\n- Future versions will require use of SmallRye Metrics extension to use MP Metrics APIs"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "23d0c172e6a407464118dfb1bd098d86650e214f", "author": {"user": {"login": "kenfinnigan", "name": "Ken Finnigan"}}, "url": "https://github.com/quarkusio/quarkus/commit/23d0c172e6a407464118dfb1bd098d86650e214f", "committedDate": "2020-10-02T13:35:49Z", "message": "Add warning for MP Metric API usage with Micrometer\n\n- Future versions will require use of SmallRye Metrics extension to use MP Metrics APIs"}, "afterCommit": {"oid": "f069ddcd90064fd8e0d663de1644e3a6f59805c0", "author": {"user": {"login": "kenfinnigan", "name": "Ken Finnigan"}}, "url": "https://github.com/quarkusio/quarkus/commit/f069ddcd90064fd8e0d663de1644e3a6f59805c0", "committedDate": "2020-10-02T13:39:35Z", "message": "Add warning for MP Metric API usage with Micrometer\n\n- Future versions will require use of SmallRye Metrics extension to use MP Metrics APIs"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTAxMTQ3MDY2", "url": "https://github.com/quarkusio/quarkus/pull/12462#pullrequestreview-501147066", "createdAt": "2020-10-02T13:43:39Z", "commit": {"oid": "f069ddcd90064fd8e0d663de1644e3a6f59805c0"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wMlQxMzo0MzozOVrOHbuKeg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wMlQxMzo0MzozOVrOHbuKeg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5ODgyOTk0Ng==", "bodyText": "You can probably remove \"This application uses the MP Metrics API.\" from the javadoc.", "url": "https://github.com/quarkusio/quarkus/pull/12462#discussion_r498829946", "createdAt": "2020-10-02T13:43:39Z", "author": {"login": "ebullient"}, "path": "extensions/micrometer/runtime/src/main/java/io/quarkus/micrometer/runtime/config/MicroprofileMetricsConfig.java", "diffHunk": "@@ -14,15 +14,19 @@\n      * Microprofile Metrics support.\n      * <p>\n      * Support for Microprofile metrics will be enabled if micrometer\n-     * support is enabled, and this value is true. You need to also\n-     * include the microprofile api jar to your dependencies:\n+     * support is enabled and the MicroProfile Metrics dependency is present:\n      *\n      * <pre>\n      * &lt;dependency&gt;\n      *   &lt;groupId&gt;org.eclipse.microprofile.metrics&lt;/groupId&gt;\n      *   &lt;artifactId&gt;microprofile-metrics-api&lt;/artifactId&gt;\n      * &lt;/dependency&gt;\n      * </pre>\n+     * <p>\n+     * This application uses the MP Metrics API.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f069ddcd90064fd8e0d663de1644e3a6f59805c0"}, "originalPosition": 15}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTAxMTQ3MjA3", "url": "https://github.com/quarkusio/quarkus/pull/12462#pullrequestreview-501147207", "createdAt": "2020-10-02T13:43:47Z", "commit": {"oid": "f069ddcd90064fd8e0d663de1644e3a6f59805c0"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "dee997a4d49c0b07be9ec268c0e953b59363374d", "author": {"user": {"login": "kenfinnigan", "name": "Ken Finnigan"}}, "url": "https://github.com/quarkusio/quarkus/commit/dee997a4d49c0b07be9ec268c0e953b59363374d", "committedDate": "2020-10-02T13:49:26Z", "message": "Add warning for MP Metric API usage with Micrometer\n\n- Future versions will require use of SmallRye Metrics extension to use MP Metrics APIs"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "f069ddcd90064fd8e0d663de1644e3a6f59805c0", "author": {"user": {"login": "kenfinnigan", "name": "Ken Finnigan"}}, "url": "https://github.com/quarkusio/quarkus/commit/f069ddcd90064fd8e0d663de1644e3a6f59805c0", "committedDate": "2020-10-02T13:39:35Z", "message": "Add warning for MP Metric API usage with Micrometer\n\n- Future versions will require use of SmallRye Metrics extension to use MP Metrics APIs"}, "afterCommit": {"oid": "dee997a4d49c0b07be9ec268c0e953b59363374d", "author": {"user": {"login": "kenfinnigan", "name": "Ken Finnigan"}}, "url": "https://github.com/quarkusio/quarkus/commit/dee997a4d49c0b07be9ec268c0e953b59363374d", "committedDate": "2020-10-02T13:49:26Z", "message": "Add warning for MP Metric API usage with Micrometer\n\n- Future versions will require use of SmallRye Metrics extension to use MP Metrics APIs"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTAxMjQyMTM4", "url": "https://github.com/quarkusio/quarkus/pull/12462#pullrequestreview-501242138", "createdAt": "2020-10-02T15:37:05Z", "commit": {"oid": "dee997a4d49c0b07be9ec268c0e953b59363374d"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTAyMDg5NDMy", "url": "https://github.com/quarkusio/quarkus/pull/12462#pullrequestreview-502089432", "createdAt": "2020-10-05T14:03:42Z", "commit": {"oid": "dee997a4d49c0b07be9ec268c0e953b59363374d"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1833, "cost": 1, "resetAt": "2021-11-01T16:37:27Z"}}}