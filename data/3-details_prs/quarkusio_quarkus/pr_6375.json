{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0MzU4NjEwNDA0", "number": 6375, "title": "Use mongodb-driver-sync instead of mongo-java-driver", "bodyText": "Today Quarkus uses two MongoDB libraries:\n\nmongo-java-driver: this is an uberjar of mongodb-driver-sync, mongodb-driver-async, mongodb-driver-core and bson\nmongodb-driver-reactivestreams: it have dependencies to mongodb-driver-async, mongodb-driver-core and bson\n\nSo a lot of mongodb classes are duplicated, we also include some legacy classes that are replaced and should not be used anymore.\nThis PR replace the usage of mongo-java-driver by  mongodb-driver-sync.\nIt breaks some compatibilities because com.mongodb.MongoClient is no more accessible as it is replaced by com.mongodb.client.MongoClient. As the Quarkus code only provides bean instance of com.mongodb.client.MongoClient it should be safe to do it.\nOnly some code related to codec didn't works anymore as the default codec registry should be obtain from MongoClientSettings inside of from the old MongoClient.\nA dependency management has been added to mongodb-client-legacy that includes the classes from mongo-java-driver that are not present in other libraries. User can add this dependency to have access to the old classes.\nWe should have a note about this small breaking change inside the release note (or we can add some WARNING in the guide) explaining the changes needed to be done on Codec code and the possibility to add the legacy driver if needed (not recommended).", "createdAt": "2020-01-02T10:17:39Z", "url": "https://github.com/quarkusio/quarkus/pull/6375", "merged": true, "mergeCommit": {"oid": "499eb06f9404c02c4a36f127e711a6ddac1569ab"}, "closed": true, "closedAt": "2020-01-09T21:53:02Z", "author": {"login": "loicmathieu"}, "timelineItems": {"totalCount": 11, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABb3ngaiAFqTMzODUwNzk0Nw==", "endCursor": "Y3Vyc29yOnYyOpPPAAABb4xLOlAFqTM0MDgzODA5OA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzM4NTA3OTQ3", "url": "https://github.com/quarkusio/quarkus/pull/6375#pullrequestreview-338507947", "createdAt": "2020-01-06T08:01:15Z", "commit": {"oid": "81fe2a64f089d7323517ea119db65326b14bc93f"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0wNlQwODowMToxNlrOFaXXww==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0wNlQwODowMjoxMlrOFaXYpg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2MzE5MDIxMQ==", "bodyText": "It should be declared in the bom.", "url": "https://github.com/quarkusio/quarkus/pull/6375#discussion_r363190211", "createdAt": "2020-01-06T08:01:16Z", "author": {"login": "cescoffier"}, "path": "extensions/mongodb-client/runtime/pom.xml", "diffHunk": "@@ -13,6 +13,17 @@\n     <artifactId>quarkus-mongodb-client</artifactId>\n     <name>Quarkus - MongoDB Client - Runtime</name>\n     <description>An imperative and reactive client for MongoDB</description>\n+\n+    <dependencyManagement>\n+        <dependencies>\n+            <dependency>\n+                <groupId>org.mongodb</groupId>\n+                <artifactId>mongodb-driver-async</artifactId>\n+                <version>3.10.2</version>", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "81fe2a64f089d7323517ea119db65326b14bc93f"}, "originalPosition": 10}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2MzE5MDQzOA==", "bodyText": "This might be considered as a breaking change as the application code need to be updated.", "url": "https://github.com/quarkusio/quarkus/pull/6375#discussion_r363190438", "createdAt": "2020-01-06T08:02:12Z", "author": {"login": "cescoffier"}, "path": "integration-tests/mongodb-client/src/main/java/io/quarkus/it/mongodb/BookCodec.java", "diffHunk": "@@ -9,14 +9,14 @@\n import org.bson.codecs.DecoderContext;\n import org.bson.codecs.EncoderContext;\n \n-import com.mongodb.MongoClient;\n+import com.mongodb.MongoClientSettings;\n \n public class BookCodec implements CollectibleCodec<Book> {\n \n     private final Codec<Document> documentCodec;\n \n     public BookCodec() {\n-        this.documentCodec = MongoClient.getDefaultCodecRegistry().get(Document.class);\n+        this.documentCodec = MongoClientSettings.getDefaultCodecRegistry().get(Document.class);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "81fe2a64f089d7323517ea119db65326b14bc93f"}, "originalPosition": 13}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "81fe2a64f089d7323517ea119db65326b14bc93f", "author": {"user": {"login": "loicmathieu", "name": "Lo\u00efc Mathieu"}}, "url": "https://github.com/quarkusio/quarkus/commit/81fe2a64f089d7323517ea119db65326b14bc93f", "committedDate": "2020-01-02T10:06:40Z", "message": "Use mongodb-driver-sync instead of mongo-java-driver"}, "afterCommit": {"oid": "43ab9c5193d93615155fb2899be08a73a00b8630", "author": {"user": {"login": "loicmathieu", "name": "Lo\u00efc Mathieu"}}, "url": "https://github.com/quarkusio/quarkus/commit/43ab9c5193d93615155fb2899be08a73a00b8630", "committedDate": "2020-01-06T09:28:58Z", "message": "Use mongodb-driver-sync instead of mongo-java-driver"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzM4Njg4NDAy", "url": "https://github.com/quarkusio/quarkus/pull/6375#pullrequestreview-338688402", "createdAt": "2020-01-06T14:55:58Z", "commit": {"oid": "43ab9c5193d93615155fb2899be08a73a00b8630"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0wNlQxNDo1NTo1OFrOFafu_A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0wNlQxNDo1NTo1OFrOFafu_A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2MzMyNzIyOA==", "bodyText": "If you declare the mongo-driver-async in the BOM I think you can remove this exclusion", "url": "https://github.com/quarkusio/quarkus/pull/6375#discussion_r363327228", "createdAt": "2020-01-06T14:55:58Z", "author": {"login": "gastaldi"}, "path": "extensions/mongodb-client/runtime/pom.xml", "diffHunk": "@@ -29,11 +30,25 @@\n         </dependency>\n         <dependency>\n             <groupId>org.mongodb</groupId>\n-            <artifactId>mongo-java-driver</artifactId>\n+            <artifactId>mongodb-driver-sync</artifactId>\n+        </dependency>\n+        <dependency>\n+            <groupId>org.mongodb</groupId>\n+            <artifactId>mongodb-driver-async</artifactId>\n         </dependency>\n         <dependency>\n             <groupId>org.mongodb</groupId>\n             <artifactId>mongodb-driver-reactivestreams</artifactId>\n+            <exclusions>\n+                <!--\n+                    Exclude mongodb-driver-async as it shares dependencies with mongodb-driver-sync so we need\n+                    to have both versions aligned which is not the case if it is a transitive dependency of mongodb-driver-reactivestreams.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "43ab9c5193d93615155fb2899be08a73a00b8630"}, "originalPosition": 25}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "43ab9c5193d93615155fb2899be08a73a00b8630", "author": {"user": {"login": "loicmathieu", "name": "Lo\u00efc Mathieu"}}, "url": "https://github.com/quarkusio/quarkus/commit/43ab9c5193d93615155fb2899be08a73a00b8630", "committedDate": "2020-01-06T09:28:58Z", "message": "Use mongodb-driver-sync instead of mongo-java-driver"}, "afterCommit": {"oid": "5c00a2c37af6d9d6ef5d8387fc413cb26215945b", "author": {"user": {"login": "loicmathieu", "name": "Lo\u00efc Mathieu"}}, "url": "https://github.com/quarkusio/quarkus/commit/5c00a2c37af6d9d6ef5d8387fc413cb26215945b", "committedDate": "2020-01-06T15:46:48Z", "message": "Use mongodb-driver-sync instead of mongo-java-driver"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "5c00a2c37af6d9d6ef5d8387fc413cb26215945b", "author": {"user": {"login": "loicmathieu", "name": "Lo\u00efc Mathieu"}}, "url": "https://github.com/quarkusio/quarkus/commit/5c00a2c37af6d9d6ef5d8387fc413cb26215945b", "committedDate": "2020-01-06T15:46:48Z", "message": "Use mongodb-driver-sync instead of mongo-java-driver"}, "afterCommit": {"oid": "14ff54ff407df834c0506c042293dfe0c43e5a95", "author": {"user": {"login": "loicmathieu", "name": "Lo\u00efc Mathieu"}}, "url": "https://github.com/quarkusio/quarkus/commit/14ff54ff407df834c0506c042293dfe0c43e5a95", "committedDate": "2020-01-06T16:46:10Z", "message": "Use mongodb-driver-sync instead of mongo-java-driver"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzM5NzAwMjY2", "url": "https://github.com/quarkusio/quarkus/pull/6375#pullrequestreview-339700266", "createdAt": "2020-01-08T08:14:46Z", "commit": {"oid": "14ff54ff407df834c0506c042293dfe0c43e5a95"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzM5ODUxMTQ2", "url": "https://github.com/quarkusio/quarkus/pull/6375#pullrequestreview-339851146", "createdAt": "2020-01-08T13:09:12Z", "commit": {"oid": "14ff54ff407df834c0506c042293dfe0c43e5a95"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0wOFQxMzowOToxM1rOFbWUsA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0wOFQxMzowOTo0NFrOFbWVig==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NDIyMTYxNg==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            We didn't include the legacy MongoDB client per default. It contains the old MongoDB Java API (DB, DBCollection,... )\n          \n          \n            \n            We don't include the legacy MongoDB client by default. It contains the now retired MongoDB Java API (DB, DBCollection,... )", "url": "https://github.com/quarkusio/quarkus/pull/6375#discussion_r364221616", "createdAt": "2020-01-08T13:09:13Z", "author": {"login": "gsmet"}, "path": "docs/src/main/asciidoc/mongodb.adoc", "diffHunk": "@@ -479,6 +479,21 @@ So when you access the `/health/ready` endpoint of your application you will hav\n \n This behavior can be disabled by setting the `quarkus.mongodb.health.enabled` property to `false` in your `application.properties`.\n \n+== The legacy client\n+\n+We didn't include the legacy MongoDB client per default. It contains the old MongoDB Java API (DB, DBCollection,... )", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "14ff54ff407df834c0506c042293dfe0c43e5a95"}, "originalPosition": 24}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NDIyMTgzNA==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            If you want to use the legacy API, you need to include the following dependency inside your `pom.xml`.\n          \n          \n            \n            If you want to use the legacy API, you need to add the following dependency to your `pom.xml`:", "url": "https://github.com/quarkusio/quarkus/pull/6375#discussion_r364221834", "createdAt": "2020-01-08T13:09:44Z", "author": {"login": "gsmet"}, "path": "docs/src/main/asciidoc/mongodb.adoc", "diffHunk": "@@ -479,6 +479,21 @@ So when you access the `/health/ready` endpoint of your application you will hav\n \n This behavior can be disabled by setting the `quarkus.mongodb.health.enabled` property to `false` in your `application.properties`.\n \n+== The legacy client\n+\n+We didn't include the legacy MongoDB client per default. It contains the old MongoDB Java API (DB, DBCollection,... )\n+and the `com.mongodb.MongoClient` that is now superseded by `com.mongodb.client.MongoClient`.\n+\n+If you want to use the legacy API, you need to include the following dependency inside your `pom.xml`.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "14ff54ff407df834c0506c042293dfe0c43e5a95"}, "originalPosition": 27}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzM5ODUxOTQ4", "url": "https://github.com/quarkusio/quarkus/pull/6375#pullrequestreview-339851948", "createdAt": "2020-01-08T13:10:48Z", "commit": {"oid": "14ff54ff407df834c0506c042293dfe0c43e5a95"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0wOFQxMzoxMDo0OFrOFbWW-w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0wOFQxMzoxMDo0OFrOFbWW-w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NDIyMjIwMw==", "bodyText": "Do we need a PR for the quickstart too (if there is one)?", "url": "https://github.com/quarkusio/quarkus/pull/6375#discussion_r364222203", "createdAt": "2020-01-08T13:10:48Z", "author": {"login": "gsmet"}, "path": "docs/src/main/asciidoc/mongodb.adoc", "diffHunk": "@@ -346,7 +346,7 @@ public class FruitCodec implements CollectibleCodec<Fruit> {\n     private final Codec<Document> documentCodec;\n \n     public FruitCodec() {\n-        this.documentCodec = MongoClient.getDefaultCodecRegistry().get(Document.class);\n+        this.documentCodec = MongoClientSettings.getDefaultCodecRegistry().get(Document.class);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "14ff54ff407df834c0506c042293dfe0c43e5a95"}, "originalPosition": 14}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f4d7ec5e3ff3db31fdea07c1c3616b35d3c8edcc", "author": {"user": {"login": "loicmathieu", "name": "Lo\u00efc Mathieu"}}, "url": "https://github.com/quarkusio/quarkus/commit/f4d7ec5e3ff3db31fdea07c1c3616b35d3c8edcc", "committedDate": "2020-01-09T09:04:43Z", "message": "Use mongodb-driver-sync instead of mongo-java-driver"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "a57d8f1b37ea9987ca98dd83f5a64f1258a7ed3e", "author": {"user": {"login": "loicmathieu", "name": "Lo\u00efc Mathieu"}}, "url": "https://github.com/quarkusio/quarkus/commit/a57d8f1b37ea9987ca98dd83f5a64f1258a7ed3e", "committedDate": "2020-01-09T08:57:15Z", "message": "Apply suggestions from code review\n\nCo-Authored-By: Guillaume Smet <guillaume.smet@gmail.com>"}, "afterCommit": {"oid": "f4d7ec5e3ff3db31fdea07c1c3616b35d3c8edcc", "author": {"user": {"login": "loicmathieu", "name": "Lo\u00efc Mathieu"}}, "url": "https://github.com/quarkusio/quarkus/commit/f4d7ec5e3ff3db31fdea07c1c3616b35d3c8edcc", "committedDate": "2020-01-09T09:04:43Z", "message": "Use mongodb-driver-sync instead of mongo-java-driver"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzQwODM4MDk4", "url": "https://github.com/quarkusio/quarkus/pull/6375#pullrequestreview-340838098", "createdAt": "2020-01-09T21:52:18Z", "commit": {"oid": "f4d7ec5e3ff3db31fdea07c1c3616b35d3c8edcc"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 276, "cost": 1, "resetAt": "2021-11-01T16:37:27Z"}}}