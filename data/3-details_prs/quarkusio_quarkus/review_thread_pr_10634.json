{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDQ3MzM1MjY4", "number": 10634, "reviewThreads": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xMFQxMDozMToyM1rOENOeJw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xMFQxMDozMToyM1rOENOeJw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjgyMzA0MDM5OnYy", "diffSide": "RIGHT", "path": "devtools/platform-descriptor-json/src/main/resources/templates/dockerfile-fast-jar.ftl", "isResolved": false, "comments": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xMFQxMDozMToyM1rOGvyb_w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xM1QxMTozMDowN1rOGwkkRw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1Mjc2MjYyMw==", "bodyText": "Is it equivalent? I would expect this to copy the quarkus-app directory inside /deployments/ whereas we used to copy the content of this directory, meaning the main jar was at the root of /deployments/.\nAt least if Docker's COPY has the same semantic as cp.", "url": "https://github.com/quarkusio/quarkus/pull/10634#discussion_r452762623", "createdAt": "2020-07-10T10:31:23Z", "author": {"login": "gsmet"}, "path": "devtools/platform-descriptor-json/src/main/resources/templates/dockerfile-fast-jar.ftl", "diffHunk": "@@ -45,10 +45,7 @@ RUN microdnf install curl ca-certificates ${JAVA_PACKAGE} \\\n # Configure the JAVA_OPTIONS, you can add -XshowSettings:vm to also display the heap size.\n ENV JAVA_OPTIONS=\"-Dquarkus.http.host=0.0.0.0 -Djava.util.logging.manager=org.jboss.logmanager.LogManager\"\n \n-COPY --chown=1001 ${build_dir}/quarkus-app/lib/ /deployments/lib/\n-COPY --chown=1001 ${build_dir}/quarkus-app/*.jar /deployments/\n-COPY --chown=1001 ${build_dir}/quarkus-app/app/ /deployments/app/\n-COPY --chown=1001 ${build_dir}/quarkus-app/quarkus/ /deployments/quarkus/\n+COPY --chown=1001 ${build_dir}/quarkus-app /deployments/", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "cc4435c0fd2b14744a637f88e6e17a9caa3aa9de"}, "originalPosition": 8}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1Mjg1NTU5Nw==", "bodyText": "I tested it locally by adding a RUN ls /deployments line after that and the log shows that the contents of the directory have been copied:\nStep 13/17 : COPY --from=builder --chown=1001 /usr/src/app/bff/build/quarkus-app /deployments/\n ---> Using cache\n ---> 61e79dc8db06\nStep 14/17 : RUN ls /deployments\n ---> Running in 5124e52a774d\napp\nlib\nquarkus\nquarkus-run.jar\nrun-java.sh", "url": "https://github.com/quarkusio/quarkus/pull/10634#discussion_r452855597", "createdAt": "2020-07-10T13:49:38Z", "author": {"login": "andreas-eberle"}, "path": "devtools/platform-descriptor-json/src/main/resources/templates/dockerfile-fast-jar.ftl", "diffHunk": "@@ -45,10 +45,7 @@ RUN microdnf install curl ca-certificates ${JAVA_PACKAGE} \\\n # Configure the JAVA_OPTIONS, you can add -XshowSettings:vm to also display the heap size.\n ENV JAVA_OPTIONS=\"-Dquarkus.http.host=0.0.0.0 -Djava.util.logging.manager=org.jboss.logmanager.LogManager\"\n \n-COPY --chown=1001 ${build_dir}/quarkus-app/lib/ /deployments/lib/\n-COPY --chown=1001 ${build_dir}/quarkus-app/*.jar /deployments/\n-COPY --chown=1001 ${build_dir}/quarkus-app/app/ /deployments/app/\n-COPY --chown=1001 ${build_dir}/quarkus-app/quarkus/ /deployments/quarkus/\n+COPY --chown=1001 ${build_dir}/quarkus-app /deployments/", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1Mjc2MjYyMw=="}, "originalCommit": {"oid": "cc4435c0fd2b14744a637f88e6e17a9caa3aa9de"}, "originalPosition": 8}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1Mjg3MjA0OQ==", "bodyText": "OK. That's a bit weird IMO but not familiar with Docker so I trust you :).\nThat being said, I'm wondering if we could change that to:\nCOPY --chown=1001 ${build_dir}/quarkus-app/* /deployments/\n\nto be on the safe side?", "url": "https://github.com/quarkusio/quarkus/pull/10634#discussion_r452872049", "createdAt": "2020-07-10T14:16:58Z", "author": {"login": "gsmet"}, "path": "devtools/platform-descriptor-json/src/main/resources/templates/dockerfile-fast-jar.ftl", "diffHunk": "@@ -45,10 +45,7 @@ RUN microdnf install curl ca-certificates ${JAVA_PACKAGE} \\\n # Configure the JAVA_OPTIONS, you can add -XshowSettings:vm to also display the heap size.\n ENV JAVA_OPTIONS=\"-Dquarkus.http.host=0.0.0.0 -Djava.util.logging.manager=org.jboss.logmanager.LogManager\"\n \n-COPY --chown=1001 ${build_dir}/quarkus-app/lib/ /deployments/lib/\n-COPY --chown=1001 ${build_dir}/quarkus-app/*.jar /deployments/\n-COPY --chown=1001 ${build_dir}/quarkus-app/app/ /deployments/app/\n-COPY --chown=1001 ${build_dir}/quarkus-app/quarkus/ /deployments/quarkus/\n+COPY --chown=1001 ${build_dir}/quarkus-app /deployments/", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1Mjc2MjYyMw=="}, "originalCommit": {"oid": "cc4435c0fd2b14744a637f88e6e17a9caa3aa9de"}, "originalPosition": 8}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MzQ2OTQ4Nw==", "bodyText": "Unfortunately this seems to unpack the directories in the quarkus-app directory. The ls now shows\napp-1.0.0-SNAPSHOT.jar\nboot\ngenerated-bytecode.jar\nmain\nquarkus-application.dat\nquarkus-run.jar\nrun-java.sh\ntransformed-bytecode.jar", "url": "https://github.com/quarkusio/quarkus/pull/10634#discussion_r453469487", "createdAt": "2020-07-13T07:10:48Z", "author": {"login": "andreas-eberle"}, "path": "devtools/platform-descriptor-json/src/main/resources/templates/dockerfile-fast-jar.ftl", "diffHunk": "@@ -45,10 +45,7 @@ RUN microdnf install curl ca-certificates ${JAVA_PACKAGE} \\\n # Configure the JAVA_OPTIONS, you can add -XshowSettings:vm to also display the heap size.\n ENV JAVA_OPTIONS=\"-Dquarkus.http.host=0.0.0.0 -Djava.util.logging.manager=org.jboss.logmanager.LogManager\"\n \n-COPY --chown=1001 ${build_dir}/quarkus-app/lib/ /deployments/lib/\n-COPY --chown=1001 ${build_dir}/quarkus-app/*.jar /deployments/\n-COPY --chown=1001 ${build_dir}/quarkus-app/app/ /deployments/app/\n-COPY --chown=1001 ${build_dir}/quarkus-app/quarkus/ /deployments/quarkus/\n+COPY --chown=1001 ${build_dir}/quarkus-app /deployments/", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1Mjc2MjYyMw=="}, "originalCommit": {"oid": "cc4435c0fd2b14744a637f88e6e17a9caa3aa9de"}, "originalPosition": 8}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MzU4Mzk0Mw==", "bodyText": "@gsmet: In the docker copy docs, I just found a note saying the following about the src path:\nThe directory itself is not copied, just its contents.\n\nFurthermore, the pattern matching seems to the one Golang uses. Therefore I think it doesn't apply the standard linux semantics.", "url": "https://github.com/quarkusio/quarkus/pull/10634#discussion_r453583943", "createdAt": "2020-07-13T11:30:07Z", "author": {"login": "andreas-eberle"}, "path": "devtools/platform-descriptor-json/src/main/resources/templates/dockerfile-fast-jar.ftl", "diffHunk": "@@ -45,10 +45,7 @@ RUN microdnf install curl ca-certificates ${JAVA_PACKAGE} \\\n # Configure the JAVA_OPTIONS, you can add -XshowSettings:vm to also display the heap size.\n ENV JAVA_OPTIONS=\"-Dquarkus.http.host=0.0.0.0 -Djava.util.logging.manager=org.jboss.logmanager.LogManager\"\n \n-COPY --chown=1001 ${build_dir}/quarkus-app/lib/ /deployments/lib/\n-COPY --chown=1001 ${build_dir}/quarkus-app/*.jar /deployments/\n-COPY --chown=1001 ${build_dir}/quarkus-app/app/ /deployments/app/\n-COPY --chown=1001 ${build_dir}/quarkus-app/quarkus/ /deployments/quarkus/\n+COPY --chown=1001 ${build_dir}/quarkus-app /deployments/", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1Mjc2MjYyMw=="}, "originalCommit": {"oid": "cc4435c0fd2b14744a637f88e6e17a9caa3aa9de"}, "originalPosition": 8}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2437, "cost": 1, "resetAt": "2021-11-13T14:23:39Z"}}}