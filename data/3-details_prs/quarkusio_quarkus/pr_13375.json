{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTIzODc0MzEx", "number": 13375, "title": "Ability to exclude particular data sources from the health check", "bodyText": "fixes #13326\n@xstefank", "createdAt": "2020-11-19T11:21:58Z", "url": "https://github.com/quarkusio/quarkus/pull/13375", "merged": true, "mergeCommit": {"oid": "23c529a4718bd2ca752fb2d1527191bfc21e60cd"}, "closed": true, "closedAt": "2021-04-01T15:46:47Z", "author": {"login": "jmartisk"}, "timelineItems": {"totalCount": 17, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdeBSK_gFqTUzNDM0MjMyOQ==", "endCursor": "Y3Vyc29yOnYyOpPPAAABeI0nvNgFqTYyNjE1NTU1MQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTM0MzQyMzI5", "url": "https://github.com/quarkusio/quarkus/pull/13375#pullrequestreview-534342329", "createdAt": "2020-11-19T11:43:01Z", "commit": {"oid": "70809325902908d6f5e75779a502429ceedd79a0"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xOVQxMTo0MzowMVrOH2Zf5g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xOVQxMTo0MzowMVrOH2Zf5g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNjgwMjkxOA==", "bodyText": "You don't need the name, it will be the one generated.", "url": "https://github.com/quarkusio/quarkus/pull/13375#discussion_r526802918", "createdAt": "2020-11-19T11:43:01Z", "author": {"login": "gsmet"}, "path": "extensions/datasource/runtime/src/main/java/io/quarkus/datasource/runtime/DataSourceBuildTimeConfig.java", "diffHunk": "@@ -16,4 +16,12 @@\n     @ConvertWith(DatabaseKindConverter.class)\n     public Optional<String> dbKind = Optional.empty();\n \n+    /**\n+     * Whether this particular data source should be excluded from the health check if\n+     * the general health check for data sources is enabled. By default, the health check includes\n+     * all configured data sources (if it is enabled).\n+     */\n+    @ConfigItem(name = \"health-check-exclude\", defaultValue = \"false\")", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "70809325902908d6f5e75779a502429ceedd79a0"}, "originalPosition": 9}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "70809325902908d6f5e75779a502429ceedd79a0", "author": {"user": {"login": "jmartisk", "name": "Jan Martiska"}}, "url": "https://github.com/quarkusio/quarkus/commit/70809325902908d6f5e75779a502429ceedd79a0", "committedDate": "2020-11-19T11:21:11Z", "message": "Ability to exclude particular data sources from the health check"}, "afterCommit": {"oid": "e963fe4f4887cdeaf0bdee3ae9f4040be0736a8b", "author": {"user": {"login": "jmartisk", "name": "Jan Martiska"}}, "url": "https://github.com/quarkusio/quarkus/commit/e963fe4f4887cdeaf0bdee3ae9f4040be0736a8b", "committedDate": "2020-11-20T10:15:27Z", "message": "Ability to exclude particular data sources from the health check"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTM1MzgxOTIz", "url": "https://github.com/quarkusio/quarkus/pull/13375#pullrequestreview-535381923", "createdAt": "2020-11-20T12:21:28Z", "commit": {"oid": "e963fe4f4887cdeaf0bdee3ae9f4040be0736a8b"}, "state": "DISMISSED", "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0yMFQxMjoyMToyOFrOH3Nigw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0yMFQxMjoyNDowNFrOH3NnWw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNzY1NTU1NQ==", "bodyText": "Can we use a proper \n  \n    \n      quarkus/extensions/datasource/common/src/main/java/io/quarkus/datasource/common/runtime/DataSourceUtil.java\n    \n    \n         Line 7\n      in\n      e963fe4\n    \n    \n    \n    \n\n        \n          \n           public static final String DEFAULT_DATASOURCE_NAME = \"<default>\"; \n        \n    \n  \n\n instead of null?", "url": "https://github.com/quarkusio/quarkus/pull/13375#discussion_r527655555", "createdAt": "2020-11-20T12:21:28Z", "author": {"login": "machi1990"}, "path": "extensions/agroal/runtime/src/main/java/io/quarkus/agroal/runtime/AgroalRecorder.java", "diffHunk": "@@ -29,4 +35,24 @@ public AgroalDataSource get() {\n         };\n     }\n \n+    public Supplier<DataSourcesExcludedFromHealthChecks> dataSourcesExcludedFromHealthChecks(\n+            DataSourcesBuildTimeConfig dataSourcesBuildTimeConfig) {\n+        return new Supplier<DataSourcesExcludedFromHealthChecks>() {\n+            @Override\n+            public DataSourcesExcludedFromHealthChecks get() {\n+                List<String> excludedNames = new ArrayList<>();\n+                if (dataSourcesBuildTimeConfig.defaultDataSource.healthCheckExclude) {\n+                    excludedNames.add(null);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e963fe4f4887cdeaf0bdee3ae9f4040be0736a8b"}, "originalPosition": 26}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNzY1NTgwMA==", "bodyText": "Let's replace the null usage by something like \n  \n    \n      quarkus/extensions/datasource/common/src/main/java/io/quarkus/datasource/common/runtime/DataSourceUtil.java\n    \n    \n         Line 7\n      in\n      e963fe4\n    \n    \n    \n    \n\n        \n          \n           public static final String DEFAULT_DATASOURCE_NAME = \"<default>\";", "url": "https://github.com/quarkusio/quarkus/pull/13375#discussion_r527655800", "createdAt": "2020-11-20T12:21:59Z", "author": {"login": "machi1990"}, "path": "extensions/agroal/runtime/src/main/java/io/quarkus/agroal/runtime/health/DataSourceHealthCheck.java", "diffHunk": "@@ -27,14 +29,21 @@\n     @PostConstruct\n     protected void init() {\n         Set<Bean<?>> beans = Arc.container().beanManager().getBeans(DataSource.class);\n+        DataSourcesExcludedFromHealthChecks excluded = Arc.container().instance(DataSourcesExcludedFromHealthChecks.class)\n+                .get();\n+        List<String> excludedNames = excluded.getExcludedNames();\n         for (Bean<?> bean : beans) {\n             if (bean.getName() == null) {\n-                // this is the default DataSource: retrieve it by type\n-                DataSource defaultDs = Arc.container().instance(DataSource.class).get();\n-                dataSources.put(DEFAULT_DS, defaultDs);\n+                if (!excludedNames.contains(null)) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e963fe4f4887cdeaf0bdee3ae9f4040be0736a8b"}, "originalPosition": 28}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNzY1Njc5NQ==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                /**\n          \n          \n            \n                 * Whether this particular data source should be excluded from the health check if\n          \n          \n            \n                 * the general health check for data sources is enabled. By default, the health check includes\n          \n          \n            \n                 * all configured data sources (if it is enabled).\n          \n          \n            \n                 */\n          \n          \n            \n                /**\n          \n          \n            \n                 * Whether this particular data source should be excluded from the health check if\n          \n          \n            \n                 * the general health check for data sources is enabled. \n          \n          \n            \n                 * <p>\n          \n          \n            \n                 * By default, the health check includes all configured data sources (if it is enabled).\n          \n          \n            \n                 */\n          \n      \n    \n    \n  \n\nIntroduce <p> to render out nicely the generated doc.", "url": "https://github.com/quarkusio/quarkus/pull/13375#discussion_r527656795", "createdAt": "2020-11-20T12:24:04Z", "author": {"login": "machi1990"}, "path": "extensions/datasource/runtime/src/main/java/io/quarkus/datasource/runtime/DataSourceBuildTimeConfig.java", "diffHunk": "@@ -16,4 +16,12 @@\n     @ConvertWith(DatabaseKindConverter.class)\n     public Optional<String> dbKind = Optional.empty();\n \n+    /**\n+     * Whether this particular data source should be excluded from the health check if\n+     * the general health check for data sources is enabled. By default, the health check includes\n+     * all configured data sources (if it is enabled).\n+     */", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e963fe4f4887cdeaf0bdee3ae9f4040be0736a8b"}, "originalPosition": 8}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "b6760a7bd66a960c57927efb0646898044bc5bcf", "author": {"user": {"login": "jmartisk", "name": "Jan Martiska"}}, "url": "https://github.com/quarkusio/quarkus/commit/b6760a7bd66a960c57927efb0646898044bc5bcf", "committedDate": "2020-11-20T12:38:35Z", "message": "Update extensions/datasource/runtime/src/main/java/io/quarkus/datasource/runtime/DataSourceBuildTimeConfig.java\n\nCo-authored-by: Manyanda Chitimbo <manyanda.chitimbo@gmail.com>"}, "afterCommit": {"oid": "0cae756d47fb23cd849380b21bde45ac232bf61c", "author": {"user": {"login": "jmartisk", "name": "Jan Martiska"}}, "url": "https://github.com/quarkusio/quarkus/commit/0cae756d47fb23cd849380b21bde45ac232bf61c", "committedDate": "2020-11-20T12:40:27Z", "message": "Ability to exclude particular data sources from the health check"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "0cae756d47fb23cd849380b21bde45ac232bf61c", "author": {"user": {"login": "jmartisk", "name": "Jan Martiska"}}, "url": "https://github.com/quarkusio/quarkus/commit/0cae756d47fb23cd849380b21bde45ac232bf61c", "committedDate": "2020-11-20T12:40:27Z", "message": "Ability to exclude particular data sources from the health check"}, "afterCommit": {"oid": "40d50f196b074f142920c391ece21d1de34ff60d", "author": {"user": {"login": "jmartisk", "name": "Jan Martiska"}}, "url": "https://github.com/quarkusio/quarkus/commit/40d50f196b074f142920c391ece21d1de34ff60d", "committedDate": "2020-11-23T09:34:12Z", "message": "Ability to exclude particular data sources from the health check"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTM2Mzc5OTIy", "url": "https://github.com/quarkusio/quarkus/pull/13375#pullrequestreview-536379922", "createdAt": "2020-11-23T11:19:32Z", "commit": {"oid": "40d50f196b074f142920c391ece21d1de34ff60d"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "40d50f196b074f142920c391ece21d1de34ff60d", "author": {"user": {"login": "jmartisk", "name": "Jan Martiska"}}, "url": "https://github.com/quarkusio/quarkus/commit/40d50f196b074f142920c391ece21d1de34ff60d", "committedDate": "2020-11-23T09:34:12Z", "message": "Ability to exclude particular data sources from the health check"}, "afterCommit": {"oid": "80c5ed1929d4f90f200029cc90ecf14980c86349", "author": {"user": {"login": "jmartisk", "name": "Jan Martiska"}}, "url": "https://github.com/quarkusio/quarkus/commit/80c5ed1929d4f90f200029cc90ecf14980c86349", "committedDate": "2020-12-01T11:31:36Z", "message": "Ability to exclude particular data sources from the health check"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTYxMTkzNjY3", "url": "https://github.com/quarkusio/quarkus/pull/13375#pullrequestreview-561193667", "createdAt": "2021-01-04T17:09:56Z", "commit": {"oid": "80c5ed1929d4f90f200029cc90ecf14980c86349"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMS0wNFQxNzowOTo1NlrOIN5xTw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMS0wNFQxNzowOTo1NlrOIN5xTw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1MTQ0ODkxMQ==", "bodyText": "Could we maybe have something like health.exclude instead? That looks a bit more in line with health.enabled.", "url": "https://github.com/quarkusio/quarkus/pull/13375#discussion_r551448911", "createdAt": "2021-01-04T17:09:56Z", "author": {"login": "gsmet"}, "path": "extensions/datasource/runtime/src/main/java/io/quarkus/datasource/runtime/DataSourceBuildTimeConfig.java", "diffHunk": "@@ -16,4 +16,13 @@\n     @ConvertWith(DatabaseKindConverter.class)\n     public Optional<String> dbKind = Optional.empty();\n \n+    /**\n+     * Whether this particular data source should be excluded from the health check if\n+     * the general health check for data sources is enabled.\n+     * <p>\n+     * By default, the health check includes all configured data sources (if it is enabled).\n+     */\n+    @ConfigItem(defaultValue = \"false\")\n+    public boolean healthCheckExclude;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "80c5ed1929d4f90f200029cc90ecf14980c86349"}, "originalPosition": 11}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "80c5ed1929d4f90f200029cc90ecf14980c86349", "author": {"user": {"login": "jmartisk", "name": "Jan Martiska"}}, "url": "https://github.com/quarkusio/quarkus/commit/80c5ed1929d4f90f200029cc90ecf14980c86349", "committedDate": "2020-12-01T11:31:36Z", "message": "Ability to exclude particular data sources from the health check"}, "afterCommit": {"oid": "009018b58e868147104ae470024911dbf6795236", "author": {"user": {"login": "jmartisk", "name": "Jan Martiska"}}, "url": "https://github.com/quarkusio/quarkus/commit/009018b58e868147104ae470024911dbf6795236", "committedDate": "2021-01-05T08:34:03Z", "message": "Ability to exclude particular data sources from the health check"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTYxNjMwMDQx", "url": "https://github.com/quarkusio/quarkus/pull/13375#pullrequestreview-561630041", "createdAt": "2021-01-05T09:23:03Z", "commit": {"oid": "009018b58e868147104ae470024911dbf6795236"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTYxNzY5NjQ4", "url": "https://github.com/quarkusio/quarkus/pull/13375#pullrequestreview-561769648", "createdAt": "2021-01-05T13:03:07Z", "commit": {"oid": "009018b58e868147104ae470024911dbf6795236"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMS0wNVQxMzowMzowN1rOIOWbGA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMS0wNVQxMzowMzowN1rOIOWbGA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1MTkxODM2MA==", "bodyText": "That will make it health-exclude not health.exclude. Also shouldn't we have a test?", "url": "https://github.com/quarkusio/quarkus/pull/13375#discussion_r551918360", "createdAt": "2021-01-05T13:03:07Z", "author": {"login": "gsmet"}, "path": "extensions/datasource/runtime/src/main/java/io/quarkus/datasource/runtime/DataSourceBuildTimeConfig.java", "diffHunk": "@@ -16,4 +16,13 @@\n     @ConvertWith(DatabaseKindConverter.class)\n     public Optional<String> dbKind = Optional.empty();\n \n+    /**\n+     * Whether this particular data source should be excluded from the health check if\n+     * the general health check for data sources is enabled.\n+     * <p>\n+     * By default, the health check includes all configured data sources (if it is enabled).\n+     */\n+    @ConfigItem(defaultValue = \"false\")\n+    public boolean healthExclude;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "009018b58e868147104ae470024911dbf6795236"}, "originalPosition": 11}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "009018b58e868147104ae470024911dbf6795236", "author": {"user": {"login": "jmartisk", "name": "Jan Martiska"}}, "url": "https://github.com/quarkusio/quarkus/commit/009018b58e868147104ae470024911dbf6795236", "committedDate": "2021-01-05T08:34:03Z", "message": "Ability to exclude particular data sources from the health check"}, "afterCommit": {"oid": "92732ea8994edab5a810576e0513eb283bb2dc44", "author": {"user": {"login": "jmartisk", "name": "Jan Martiska"}}, "url": "https://github.com/quarkusio/quarkus/commit/92732ea8994edab5a810576e0513eb283bb2dc44", "committedDate": "2021-01-05T14:53:50Z", "message": "Ability to exclude particular data sources from the health check"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "92732ea8994edab5a810576e0513eb283bb2dc44", "author": {"user": {"login": "jmartisk", "name": "Jan Martiska"}}, "url": "https://github.com/quarkusio/quarkus/commit/92732ea8994edab5a810576e0513eb283bb2dc44", "committedDate": "2021-01-05T14:53:50Z", "message": "Ability to exclude particular data sources from the health check"}, "afterCommit": {"oid": "021423b746ad0750b1de8e9abb550bb712cdbda5", "author": {"user": {"login": "jmartisk", "name": "Jan Martiska"}}, "url": "https://github.com/quarkusio/quarkus/commit/021423b746ad0750b1de8e9abb550bb712cdbda5", "committedDate": "2021-02-11T08:27:57Z", "message": "Ability to exclude particular data sources from the health check"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "021423b746ad0750b1de8e9abb550bb712cdbda5", "author": {"user": {"login": "jmartisk", "name": "Jan Martiska"}}, "url": "https://github.com/quarkusio/quarkus/commit/021423b746ad0750b1de8e9abb550bb712cdbda5", "committedDate": "2021-02-11T08:27:57Z", "message": "Ability to exclude particular data sources from the health check"}, "afterCommit": {"oid": "b07147912fe29a156e5778d9c98e4c8211debc27", "author": {"user": {"login": "jmartisk", "name": "Jan Martiska"}}, "url": "https://github.com/quarkusio/quarkus/commit/b07147912fe29a156e5778d9c98e4c8211debc27", "committedDate": "2021-03-26T09:06:44Z", "message": "Ability to exclude particular data sources from the health check"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "1749f00e3aec88868522e15f65e3d23cc6a715b1", "author": {"user": {"login": "jmartisk", "name": "Jan Martiska"}}, "url": "https://github.com/quarkusio/quarkus/commit/1749f00e3aec88868522e15f65e3d23cc6a715b1", "committedDate": "2021-04-01T11:17:30Z", "message": "Ability to exclude particular data sources from the health check"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "b07147912fe29a156e5778d9c98e4c8211debc27", "author": {"user": {"login": "jmartisk", "name": "Jan Martiska"}}, "url": "https://github.com/quarkusio/quarkus/commit/b07147912fe29a156e5778d9c98e4c8211debc27", "committedDate": "2021-03-26T09:06:44Z", "message": "Ability to exclude particular data sources from the health check"}, "afterCommit": {"oid": "1749f00e3aec88868522e15f65e3d23cc6a715b1", "author": {"user": {"login": "jmartisk", "name": "Jan Martiska"}}, "url": "https://github.com/quarkusio/quarkus/commit/1749f00e3aec88868522e15f65e3d23cc6a715b1", "committedDate": "2021-04-01T11:17:30Z", "message": "Ability to exclude particular data sources from the health check"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NjI2MTU1NTUx", "url": "https://github.com/quarkusio/quarkus/pull/13375#pullrequestreview-626155551", "createdAt": "2021-04-01T11:18:15Z", "commit": {"oid": "b07147912fe29a156e5778d9c98e4c8211debc27"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1421, "cost": 1, "resetAt": "2021-11-01T16:37:27Z"}}}