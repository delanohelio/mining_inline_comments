{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTI4NjA0MjI0", "number": 13515, "title": "Remove the ProtectionDomain Map in RunnerClassLoader", "bodyText": "Based on: #13503 (comment)", "createdAt": "2020-11-27T13:08:17Z", "url": "https://github.com/quarkusio/quarkus/pull/13515", "merged": true, "mergeCommit": {"oid": "85a5a9112c090174793cedabedc02ab34c30112b"}, "closed": true, "closedAt": "2020-12-01T09:54:59Z", "author": {"login": "geoand"}, "timelineItems": {"totalCount": 8, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdgnXjRABqjQwNDYwOTUwNDA=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdhz2wPABqjQwNTUzNTc1NDc=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "e9ea5e5b3eae0c192d216011d37d7afabd16360b", "author": {"user": {"login": "geoand", "name": "Georgios Andrianakis"}}, "url": "https://github.com/quarkusio/quarkus/commit/e9ea5e5b3eae0c192d216011d37d7afabd16360b", "committedDate": "2020-11-27T13:07:47Z", "message": "Remove the protection domain map in RunnerClassLoader\n\nBased on: https://github.com/quarkusio/quarkus/pull/13503#discussion_r531573829"}, "afterCommit": {"oid": "4ad9172fbaf501a75c3bec2225fcc0c722eeb59b", "author": {"user": {"login": "geoand", "name": "Georgios Andrianakis"}}, "url": "https://github.com/quarkusio/quarkus/commit/4ad9172fbaf501a75c3bec2225fcc0c722eeb59b", "committedDate": "2020-11-27T13:14:42Z", "message": "Remove the protection domain map in RunnerClassLoader\n\nBased on: https://github.com/quarkusio/quarkus/pull/13503#discussion_r531573829"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "4ad9172fbaf501a75c3bec2225fcc0c722eeb59b", "author": {"user": {"login": "geoand", "name": "Georgios Andrianakis"}}, "url": "https://github.com/quarkusio/quarkus/commit/4ad9172fbaf501a75c3bec2225fcc0c722eeb59b", "committedDate": "2020-11-27T13:14:42Z", "message": "Remove the protection domain map in RunnerClassLoader\n\nBased on: https://github.com/quarkusio/quarkus/pull/13503#discussion_r531573829"}, "afterCommit": {"oid": "88e6c71089a28af87812ac5e73760499564d3ba9", "author": {"user": {"login": "geoand", "name": "Georgios Andrianakis"}}, "url": "https://github.com/quarkusio/quarkus/commit/88e6c71089a28af87812ac5e73760499564d3ba9", "committedDate": "2020-11-27T15:08:05Z", "message": "Remove the protection domain map in RunnerClassLoader\n\nBased on: https://github.com/quarkusio/quarkus/pull/13503#discussion_r531573829"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTQwMDQ3ODgx", "url": "https://github.com/quarkusio/quarkus/pull/13515#pullrequestreview-540047881", "createdAt": "2020-11-27T15:12:53Z", "commit": {"oid": "88e6c71089a28af87812ac5e73760499564d3ba9"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0yN1QxNToxMjo1M1rOH7BoVg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0yN1QxNToxMjo1M1rOH7BoVg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMTY1NDc0Mg==", "bodyText": "just wondering - do we really want to impose that a ClassLoadingResource belongs to a unique classloader ever?", "url": "https://github.com/quarkusio/quarkus/pull/13515#discussion_r531654742", "createdAt": "2020-11-27T15:12:53Z", "author": {"login": "Sanne"}, "path": "independent-projects/bootstrap/runner/src/main/java/io/quarkus/bootstrap/runner/ClassLoadingResource.java", "diffHunk": "@@ -5,13 +5,22 @@\n \n public interface ClassLoadingResource {\n \n+    /**\n+     * A lifecycle hook that should be called when the ClassLoader to which this resource belongs to\n+     * is constructed\n+     */\n+    void init(ClassLoader runnerClassLoader);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "88e6c71089a28af87812ac5e73760499564d3ba9"}, "originalPosition": 8}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTQwMDUwMzQw", "url": "https://github.com/quarkusio/quarkus/pull/13515#pullrequestreview-540050340", "createdAt": "2020-11-27T15:17:06Z", "commit": {"oid": "88e6c71089a28af87812ac5e73760499564d3ba9"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0yN1QxNToxNzowNlrOH7BwPQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0yN1QxNToxNzowNlrOH7BwPQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMTY1Njc2NQ==", "bodyText": "this might need some thoughts regading threadsafety?\nMaybe you could simplify things by maintaining the same API as it had, then lazily initialize the ProtectionDomain domain on first request. This way you can also check if the classloader is the same as the one you have cached the ProtectionDomain for, and in case rebuild the instance.\nThis would ensure there's no way to get the wrong ProtectionDomain, for example in case the same JarResource was ever used by multiple / different classloader instances - I'm thinking for example it might be reusing the same JarResource by a fresh classloader on hot reload?", "url": "https://github.com/quarkusio/quarkus/pull/13515#discussion_r531656765", "createdAt": "2020-11-27T15:17:06Z", "author": {"login": "Sanne"}, "path": "independent-projects/bootstrap/runner/src/main/java/io/quarkus/bootstrap/runner/JarResource.java", "diffHunk": "@@ -106,20 +124,8 @@ public ManifestInfo getManifestInfo() {\n     }\n \n     @Override\n-    public ProtectionDomain getProtectionDomain(ClassLoader classLoader) {\n-        final URL url;\n-        try {\n-            String path = jarPath.toAbsolutePath().toString();\n-            if (!path.startsWith(\"/\")) {\n-                path = '/' + path;\n-            }\n-            URI uri = new URI(\"file\", null, path, null);\n-            url = uri.toURL();\n-        } catch (URISyntaxException | MalformedURLException e) {\n-            throw new RuntimeException(\"Unable to create protection domain for \" + jarPath, e);\n-        }\n-        CodeSource codesource = new CodeSource(url, (Certificate[]) null);\n-        return new ProtectionDomain(codesource, null, classLoader, null);\n+    public ProtectionDomain getProtectionDomain() {\n+        return protectionDomain;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "88e6c71089a28af87812ac5e73760499564d3ba9"}, "originalPosition": 51}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "88e6c71089a28af87812ac5e73760499564d3ba9", "author": {"user": {"login": "geoand", "name": "Georgios Andrianakis"}}, "url": "https://github.com/quarkusio/quarkus/commit/88e6c71089a28af87812ac5e73760499564d3ba9", "committedDate": "2020-11-27T15:08:05Z", "message": "Remove the protection domain map in RunnerClassLoader\n\nBased on: https://github.com/quarkusio/quarkus/pull/13503#discussion_r531573829"}, "afterCommit": {"oid": "d6d4de47483c598ca951b6cb4cfa358c08c0cfb2", "author": {"user": {"login": "geoand", "name": "Georgios Andrianakis"}}, "url": "https://github.com/quarkusio/quarkus/commit/d6d4de47483c598ca951b6cb4cfa358c08c0cfb2", "committedDate": "2020-11-27T16:03:11Z", "message": "Remove the protection domain map in RunnerClassLoader\n\nBased on: https://github.com/quarkusio/quarkus/pull/13503#discussion_r531573829"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTQxNDEwNDYx", "url": "https://github.com/quarkusio/quarkus/pull/13515#pullrequestreview-541410461", "createdAt": "2020-12-01T00:55:10Z", "commit": {"oid": "d6d4de47483c598ca951b6cb4cfa358c08c0cfb2"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a94be261ce99c6410f70cae05c5565d75b41013c", "author": {"user": {"login": "geoand", "name": "Georgios Andrianakis"}}, "url": "https://github.com/quarkusio/quarkus/commit/a94be261ce99c6410f70cae05c5565d75b41013c", "committedDate": "2020-12-01T06:21:28Z", "message": "Remove the protection domain map in RunnerClassLoader\n\nBased on: https://github.com/quarkusio/quarkus/pull/13503#discussion_r531573829"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "d6d4de47483c598ca951b6cb4cfa358c08c0cfb2", "author": {"user": {"login": "geoand", "name": "Georgios Andrianakis"}}, "url": "https://github.com/quarkusio/quarkus/commit/d6d4de47483c598ca951b6cb4cfa358c08c0cfb2", "committedDate": "2020-11-27T16:03:11Z", "message": "Remove the protection domain map in RunnerClassLoader\n\nBased on: https://github.com/quarkusio/quarkus/pull/13503#discussion_r531573829"}, "afterCommit": {"oid": "a94be261ce99c6410f70cae05c5565d75b41013c", "author": {"user": {"login": "geoand", "name": "Georgios Andrianakis"}}, "url": "https://github.com/quarkusio/quarkus/commit/a94be261ce99c6410f70cae05c5565d75b41013c", "committedDate": "2020-12-01T06:21:28Z", "message": "Remove the protection domain map in RunnerClassLoader\n\nBased on: https://github.com/quarkusio/quarkus/pull/13503#discussion_r531573829"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1317, "cost": 1, "resetAt": "2021-11-01T16:37:27Z"}}}