{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDIwNjA2NDQy", "number": 9484, "title": "Escaping JSON strings in QuarkusErrorServlet", "bodyText": "Fixes #9463.\nJust added a more thorough escaping for the strings.", "createdAt": "2020-05-20T08:53:56Z", "url": "https://github.com/quarkusio/quarkus/pull/9484", "merged": true, "mergeCommit": {"oid": "efd6e3191765679dd1627a0c26e80c107f497202"}, "closed": true, "closedAt": "2020-05-21T14:43:52Z", "author": {"login": "lodrantl"}, "timelineItems": {"totalCount": 6, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcjI8nkgFqTQxNTMyMjU2Nw==", "endCursor": "Y3Vyc29yOnYyOpPPAAABcjewlXgFqTQxNjIwNTM2MQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDE1MzIyNTY3", "url": "https://github.com/quarkusio/quarkus/pull/9484#pullrequestreview-415322567", "createdAt": "2020-05-20T13:17:40Z", "commit": {"oid": "c56855997c1b4ddf33ddb4c5a30b59f34073f013"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yMFQxMzoxNzo0MFrOGYLJfg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yMFQxMzoxNzo0MFrOGYLJfg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyODAwMTY2Mg==", "bodyText": "I think it is escaped later in TemplateHtmlBuilder so we don't need to escape it here. Am I right?", "url": "https://github.com/quarkusio/quarkus/pull/9484#discussion_r428001662", "createdAt": "2020-05-20T13:17:40Z", "author": {"login": "gsmet"}, "path": "extensions/undertow/runtime/src/main/java/io/quarkus/undertow/runtime/QuarkusErrorServlet.java", "diffHunk": "@@ -40,15 +40,17 @@ protected void service(HttpServletRequest req, HttpServletResponse resp) throws\n         if (accept != null && accept.contains(\"application/json\")) {\n             resp.setContentType(\"application/json\");\n             resp.setCharacterEncoding(StandardCharsets.UTF_8.name());\n-            String escapedStack = stack.replace(System.lineSeparator(), \"\\\\n\").replace(\"\\\"\", \"\\\\\\\"\");\n-            StringBuilder jsonPayload = new StringBuilder(\"{\\\"details\\\":\\\"\").append(details).append(\"\\\",\\\"stack\\\":\\\"\")\n-                    .append(escapedStack).append(\"\\\"}\");\n+            String escapedDetails = escapeJsonString(details);\n+            String escapedStack = escapeJsonString(stack);\n+            StringBuilder jsonPayload = new StringBuilder(\"{\\\"details\\\":\\\"\").append(escapedDetails)\n+                    .append(\"\\\",\\\"stack\\\":\\\"\").append(escapedStack).append(\"\\\"}\");\n             resp.getWriter().write(jsonPayload.toString());\n         } else {\n             //We default to HTML representation\n+            String escapedDetails = escapeHtml(details);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c56855997c1b4ddf33ddb4c5a30b59f34073f013"}, "originalPosition": 14}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "bb688f883334f061685bce66582e0aeb19f7ecfa", "author": {"user": {"login": "lodrantl", "name": "Luka Lodrant"}}, "url": "https://github.com/quarkusio/quarkus/commit/bb688f883334f061685bce66582e0aeb19f7ecfa", "committedDate": "2020-05-21T08:37:11Z", "message": "Proper escaping of JSON strings in ErrorServlet"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a7a91cd450618a7a11d071688d9759da9230c1c1", "author": {"user": {"login": "lodrantl", "name": "Luka Lodrant"}}, "url": "https://github.com/quarkusio/quarkus/commit/a7a91cd450618a7a11d071688d9759da9230c1c1", "committedDate": "2020-05-21T08:37:11Z", "message": "Don't escapeHTML when using JSON"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "28e3587c910bec520c40d6d0b5359215e58fee40", "author": {"user": {"login": "lodrantl", "name": "Luka Lodrant"}}, "url": "https://github.com/quarkusio/quarkus/commit/28e3587c910bec520c40d6d0b5359215e58fee40", "committedDate": "2020-05-21T08:37:11Z", "message": "Removed the double HTML escaping."}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "0b91e9568f4f40cefe5f8e74e66380f7b665859f", "author": {"user": {"login": "lodrantl", "name": "Luka Lodrant"}}, "url": "https://github.com/quarkusio/quarkus/commit/0b91e9568f4f40cefe5f8e74e66380f7b665859f", "committedDate": "2020-05-20T20:50:34Z", "message": "Removed the double HTML escaping."}, "afterCommit": {"oid": "28e3587c910bec520c40d6d0b5359215e58fee40", "author": {"user": {"login": "lodrantl", "name": "Luka Lodrant"}}, "url": "https://github.com/quarkusio/quarkus/commit/28e3587c910bec520c40d6d0b5359215e58fee40", "committedDate": "2020-05-21T08:37:11Z", "message": "Removed the double HTML escaping."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDE2MjA1MzYx", "url": "https://github.com/quarkusio/quarkus/pull/9484#pullrequestreview-416205361", "createdAt": "2020-05-21T14:43:39Z", "commit": {"oid": "28e3587c910bec520c40d6d0b5359215e58fee40"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3341, "cost": 1, "resetAt": "2021-11-02T10:47:05Z"}}}