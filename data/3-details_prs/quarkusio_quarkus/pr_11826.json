{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDc3OTMwMjQ5", "number": 11826, "title": "Document the Multiple Persistence Units support", "bodyText": "@gastaldi I know you like to spot typos, care to have a look?\n@geoand also interested in your feedback\n@Sanne if you have time, obviously, I would love your feedback on this too", "createdAt": "2020-09-02T16:08:15Z", "url": "https://github.com/quarkusio/quarkus/pull/11826", "merged": true, "mergeCommit": {"oid": "1779453853cb4cb40e8fd59831644a1db841a41b"}, "closed": true, "closedAt": "2020-09-03T11:15:09Z", "author": {"login": "gsmet"}, "timelineItems": {"totalCount": 18, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdE8ukTAH2gAyNDc3OTMwMjQ5OmZiMDA4YzFhNzM4OThkMmE3ODk0ZmUxN2IyZDQ4MjE5MzY5MjhjN2Q=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdFN-esABqjM3MjQwMTM5NjY=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "fb008c1a73898d2a7894fe17b2d4821936928c7d", "author": {"user": {"login": "gsmet", "name": "Guillaume Smet"}}, "url": "https://github.com/quarkusio/quarkus/commit/fb008c1a73898d2a7894fe17b2d4821936928c7d", "committedDate": "2020-09-02T14:18:06Z", "message": "Fix some formatting issues in Hibernate ORM documentation"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDgwOTkyNDk2", "url": "https://github.com/quarkusio/quarkus/pull/11826#pullrequestreview-480992496", "createdAt": "2020-09-02T16:24:51Z", "commit": {"oid": "6bd1f7669b4e9fff5754f68e5c36f4adcf7e5631"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wMlQxNjoyNDo1MVrOHL3Oew==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wMlQxNjoyNDo1MVrOHL3Oew==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MjIwMTIxMQ==", "bodyText": "Do you think we can add a link to the appropriate section?", "url": "https://github.com/quarkusio/quarkus/pull/11826#discussion_r482201211", "createdAt": "2020-09-02T16:24:51Z", "author": {"login": "machi1990"}, "path": "docs/src/main/asciidoc/hibernate-orm.adoc", "diffHunk": "@@ -168,37 +168,212 @@ Make up your mind on which approach you want to use.\n Want to start a PostgreSQL server on the side with Docker?\n \n [source,shell]\n---\n+----\n docker run --ulimit memlock=-1:-1 -it --rm=true --memory-swappiness=0 \\\n            --name postgres-quarkus-hibernate -e POSTGRES_USER=hibernate \\\n            -e POSTGRES_PASSWORD=hibernate -e POSTGRES_DB=hibernate_db \\\n            -p 5432:5432 postgres:10.5\n---\n+----\n \n This will start a non-durable empty database: ideal for a quick experiment!\n ====\n \n+[[multiple-persistence-units]]\n+=== Multiple persistence units\n+\n+==== Setting up multiple persistence units\n+\n+[WARNING]\n+====\n+This feature is still experimental.\n+It is considered stable and usable in production but the configuration properties and CDI integration might evolve depending on your feedback.\n+\n+If you are using this feature, any feedback (even just to say it fulfills your requirements) is very welcome on our link:{quarkus-mailing-list-index}[quarkus-dev mailing list].\n+====\n+\n+Starting with Quarkus 1.7, you can define multiple persistence units using the Quarkus configuration properties approach.\n+\n+The properties at the root of the `quarkus.hibernate-orm.` namespace define the default persistence unit.\n+For instance, the following snippet defines a default datasource and a default persistence unit:\n+\n+[source,properties]\n+----\n+quarkus.datasource.db-kind=h2\n+quarkus.datasource.jdbc.url=jdbc:h2:mem:default;DB_CLOSE_DELAY=-1\n+\n+quarkus.hibernate-orm.dialect=org.hibernate.dialect.H2Dialect\n+quarkus.hibernate-orm.database.generation=drop-and-create\n+----\n+\n+Using a map based approach, it is possible to define named persistence units:\n+\n+[source,properties]\n+----\n+quarkus.datasource.\"users\".db-kind=h2 <1>\n+quarkus.datasource.\"users\".jdbc.url=jdbc:h2:mem:users;DB_CLOSE_DELAY=-1\n+\n+quarkus.datasource.\"inventory\".db-kind=h2 <2>\n+quarkus.datasource.\"inventory\".jdbc.url=jdbc:h2:mem:inventory;DB_CLOSE_DELAY=-1\n+\n+quarkus.hibernate-orm.\"users\".database.generation=drop-and-create <3>\n+quarkus.hibernate-orm.\"users\".datasource=users <4>\n+quarkus.hibernate-orm.\"users\".packages=org.acme.model.user <5>\n+\n+quarkus.hibernate-orm.\"inventory\".database.generation=drop-and-create <6>\n+quarkus.hibernate-orm.\"inventory\".datasource=inventory\n+quarkus.hibernate-orm.\"inventory\".packages=org.acme.model.inventory\n+----\n+<1> Define a datasource named `users`.\n+<2> Define a datasource named `inventory`.\n+<3> Define a persistence unit called `users`.\n+<4> Define the datasource used by the persistence unit.\n+<5> This configuration property is important but we will discuss it a bit later.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "6bd1f7669b4e9fff5754f68e5c36f4adcf7e5631"}, "originalPosition": 135}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDgwOTg2NjYx", "url": "https://github.com/quarkusio/quarkus/pull/11826#pullrequestreview-480986661", "createdAt": "2020-09-02T16:17:58Z", "commit": {"oid": "6bd1f7669b4e9fff5754f68e5c36f4adcf7e5631"}, "state": "COMMENTED", "comments": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wMlQxNjoxNzo1OFrOHL29Uw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wMlQxNjozMzoyMlrOHL3j8A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MjE5NjgxOQ==", "bodyText": "We should refrain from calling \"things\" since it's too subjective. Perhaps remove this part since it's explained in the linked document", "url": "https://github.com/quarkusio/quarkus/pull/11826#discussion_r482196819", "createdAt": "2020-09-02T16:17:58Z", "author": {"login": "gastaldi"}, "path": "docs/src/main/asciidoc/hibernate-orm-panache.adoc", "diffHunk": "@@ -618,6 +618,15 @@ so the compiler must be configured to store parameter names inside the compiled\n This is enabled by default if you are using the Quarkus Maven archetype. If you are not using it, add the property `<maven.compiler.parameters>true</maven.compiler.parameters>` to your pom.xml.\n ====\n \n+== Multiple Persistence Units\n+\n+The support for multiple persistence units is described in details in link:hibernate-orm#multiple-persistence-units[the Hibernate ORM guide].\n+\n+When using Panache, things are simple:\n+\n+* A given Panache entity can be attached to only one persistence unit;\n+* Given that, things are totally transparent and Panache automatically uses the appropriate `EntityManager`.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "6bd1f7669b4e9fff5754f68e5c36f4adcf7e5631"}, "originalPosition": 11}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MjE5NzcwOQ==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            Starting with Quarkus 1.7, you can define multiple persistence units using the Quarkus configuration properties approach.\n          \n          \n            \n            Starting with Quarkus 1.7.0.Final, you can define multiple persistence units using the Quarkus configuration properties approach.", "url": "https://github.com/quarkusio/quarkus/pull/11826#discussion_r482197709", "createdAt": "2020-09-02T16:19:19Z", "author": {"login": "gastaldi"}, "path": "docs/src/main/asciidoc/hibernate-orm.adoc", "diffHunk": "@@ -168,37 +168,212 @@ Make up your mind on which approach you want to use.\n Want to start a PostgreSQL server on the side with Docker?\n \n [source,shell]\n---\n+----\n docker run --ulimit memlock=-1:-1 -it --rm=true --memory-swappiness=0 \\\n            --name postgres-quarkus-hibernate -e POSTGRES_USER=hibernate \\\n            -e POSTGRES_PASSWORD=hibernate -e POSTGRES_DB=hibernate_db \\\n            -p 5432:5432 postgres:10.5\n---\n+----\n \n This will start a non-durable empty database: ideal for a quick experiment!\n ====\n \n+[[multiple-persistence-units]]\n+=== Multiple persistence units\n+\n+==== Setting up multiple persistence units\n+\n+[WARNING]\n+====\n+This feature is still experimental.\n+It is considered stable and usable in production but the configuration properties and CDI integration might evolve depending on your feedback.\n+\n+If you are using this feature, any feedback (even just to say it fulfills your requirements) is very welcome on our link:{quarkus-mailing-list-index}[quarkus-dev mailing list].\n+====\n+\n+Starting with Quarkus 1.7, you can define multiple persistence units using the Quarkus configuration properties approach.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "6bd1f7669b4e9fff5754f68e5c36f4adcf7e5631"}, "originalPosition": 99}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MjIwMDE4Ng==", "bodyText": "This is confusing. Here we propose how to attach an entity to several PUs but now we're saying to not use Panache in case that happens?", "url": "https://github.com/quarkusio/quarkus/pull/11826#discussion_r482200186", "createdAt": "2020-09-02T16:23:13Z", "author": {"login": "gastaldi"}, "path": "docs/src/main/asciidoc/hibernate-orm.adoc", "diffHunk": "@@ -168,37 +168,212 @@ Make up your mind on which approach you want to use.\n Want to start a PostgreSQL server on the side with Docker?\n \n [source,shell]\n---\n+----\n docker run --ulimit memlock=-1:-1 -it --rm=true --memory-swappiness=0 \\\n            --name postgres-quarkus-hibernate -e POSTGRES_USER=hibernate \\\n            -e POSTGRES_PASSWORD=hibernate -e POSTGRES_DB=hibernate_db \\\n            -p 5432:5432 postgres:10.5\n---\n+----\n \n This will start a non-durable empty database: ideal for a quick experiment!\n ====\n \n+[[multiple-persistence-units]]\n+=== Multiple persistence units\n+\n+==== Setting up multiple persistence units\n+\n+[WARNING]\n+====\n+This feature is still experimental.\n+It is considered stable and usable in production but the configuration properties and CDI integration might evolve depending on your feedback.\n+\n+If you are using this feature, any feedback (even just to say it fulfills your requirements) is very welcome on our link:{quarkus-mailing-list-index}[quarkus-dev mailing list].\n+====\n+\n+Starting with Quarkus 1.7, you can define multiple persistence units using the Quarkus configuration properties approach.\n+\n+The properties at the root of the `quarkus.hibernate-orm.` namespace define the default persistence unit.\n+For instance, the following snippet defines a default datasource and a default persistence unit:\n+\n+[source,properties]\n+----\n+quarkus.datasource.db-kind=h2\n+quarkus.datasource.jdbc.url=jdbc:h2:mem:default;DB_CLOSE_DELAY=-1\n+\n+quarkus.hibernate-orm.dialect=org.hibernate.dialect.H2Dialect\n+quarkus.hibernate-orm.database.generation=drop-and-create\n+----\n+\n+Using a map based approach, it is possible to define named persistence units:\n+\n+[source,properties]\n+----\n+quarkus.datasource.\"users\".db-kind=h2 <1>\n+quarkus.datasource.\"users\".jdbc.url=jdbc:h2:mem:users;DB_CLOSE_DELAY=-1\n+\n+quarkus.datasource.\"inventory\".db-kind=h2 <2>\n+quarkus.datasource.\"inventory\".jdbc.url=jdbc:h2:mem:inventory;DB_CLOSE_DELAY=-1\n+\n+quarkus.hibernate-orm.\"users\".database.generation=drop-and-create <3>\n+quarkus.hibernate-orm.\"users\".datasource=users <4>\n+quarkus.hibernate-orm.\"users\".packages=org.acme.model.user <5>\n+\n+quarkus.hibernate-orm.\"inventory\".database.generation=drop-and-create <6>\n+quarkus.hibernate-orm.\"inventory\".datasource=inventory\n+quarkus.hibernate-orm.\"inventory\".packages=org.acme.model.inventory\n+----\n+<1> Define a datasource named `users`.\n+<2> Define a datasource named `inventory`.\n+<3> Define a persistence unit called `users`.\n+<4> Define the datasource used by the persistence unit.\n+<5> This configuration property is important but we will discuss it a bit later.\n+<6> Define a persistence unit called `inventory` pointing to the `inventory` datasource.\n+\n+[NOTE]\n+====\n+You can mix the default datasource and named datasources or only have one or the other.\n+====\n+\n+[NOTE]\n+====\n+The default persistence unit points to the default datasource by default.\n+For named persistence units, the `datasource` property is mandatory.\n+You can point your persistence unit to the default datasource by setting it to `<default>`\n+(which is the internal name of the default datasource).\n+\n+It is perfectly valid to have several persistence units pointing to the same datasource.\n+====\n+\n+==== Attaching model classes to persistence units\n+\n+There are two distinct ways to attach model classes to persistence units and they should not be mixed:\n+\n+* Via the `packages` configuration property;\n+* Via the `@io.quarkus.hibernate.orm.PersistenceUnit` package-level annotation.\n+\n+If both are mixed, the annotations are ignored and only the `packages` configuration properties are taken into account.\n+\n+Using the `packages` configuration property is simple:\n+\n+[source,properties]\n+----\n+quarkus.hibernate-orm.database.generation=drop-and-create\n+quarkus.hibernate-orm.packages=org.acme.model.defaultpu\n+\n+quarkus.hibernate-orm.\"users\".database.generation=drop-and-create\n+quarkus.hibernate-orm.\"users\".datasource=users\n+quarkus.hibernate-orm.\"users\".packages=org.acme.model.user\n+----\n+\n+This configuration snippet will create two persistence units:\n+\n+* The default one which will contain all the model classes under the `org.acme.model.defaultpu` package, subpackages included.\n+* A named `users` persistence unit which will contain all the model classes under the `org.acme.model.user` package, subpackages included.\n+\n+It is possible to attach several packages to a persistence unit:\n+\n+[source,properties]\n+----\n+quarkus.hibernate-orm.\"users\".packages=org.acme.model.shared,org.acme.model.user\n+----\n+\n+All the model classes under the `org.acme.model.shared` and `org.acme.model.user` packages will be attached to the `users` persistence unit.\n+\n+It is also supported to attach a given model class to several persistence units.\n+\n+[NOTE]\n+====\n+Model classes need to be consistently added to a given persistence unit.\n+Meaning all dependent model classes of a given entity (mapped super classes, embeddables...) are required to be attached to the persistence unit.\n+As we are dealing with the persistence unit at the package level, it should be simple enough.\n+====\n+\n+[WARNING]\n+====\n+Panache entities can be attached to only one persistence unit.\n+\n+For entities attached to several persistence units, you cannot use Panache.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "6bd1f7669b4e9fff5754f68e5c36f4adcf7e5631"}, "originalPosition": 201}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MjIwMDk0NA==", "bodyText": "Package, field and parameter levels according to the sources \ud83d\ude09", "url": "https://github.com/quarkusio/quarkus/pull/11826#discussion_r482200944", "createdAt": "2020-09-02T16:24:28Z", "author": {"login": "gastaldi"}, "path": "docs/src/main/asciidoc/hibernate-orm.adoc", "diffHunk": "@@ -168,37 +168,212 @@ Make up your mind on which approach you want to use.\n Want to start a PostgreSQL server on the side with Docker?\n \n [source,shell]\n---\n+----\n docker run --ulimit memlock=-1:-1 -it --rm=true --memory-swappiness=0 \\\n            --name postgres-quarkus-hibernate -e POSTGRES_USER=hibernate \\\n            -e POSTGRES_PASSWORD=hibernate -e POSTGRES_DB=hibernate_db \\\n            -p 5432:5432 postgres:10.5\n---\n+----\n \n This will start a non-durable empty database: ideal for a quick experiment!\n ====\n \n+[[multiple-persistence-units]]\n+=== Multiple persistence units\n+\n+==== Setting up multiple persistence units\n+\n+[WARNING]\n+====\n+This feature is still experimental.\n+It is considered stable and usable in production but the configuration properties and CDI integration might evolve depending on your feedback.\n+\n+If you are using this feature, any feedback (even just to say it fulfills your requirements) is very welcome on our link:{quarkus-mailing-list-index}[quarkus-dev mailing list].\n+====\n+\n+Starting with Quarkus 1.7, you can define multiple persistence units using the Quarkus configuration properties approach.\n+\n+The properties at the root of the `quarkus.hibernate-orm.` namespace define the default persistence unit.\n+For instance, the following snippet defines a default datasource and a default persistence unit:\n+\n+[source,properties]\n+----\n+quarkus.datasource.db-kind=h2\n+quarkus.datasource.jdbc.url=jdbc:h2:mem:default;DB_CLOSE_DELAY=-1\n+\n+quarkus.hibernate-orm.dialect=org.hibernate.dialect.H2Dialect\n+quarkus.hibernate-orm.database.generation=drop-and-create\n+----\n+\n+Using a map based approach, it is possible to define named persistence units:\n+\n+[source,properties]\n+----\n+quarkus.datasource.\"users\".db-kind=h2 <1>\n+quarkus.datasource.\"users\".jdbc.url=jdbc:h2:mem:users;DB_CLOSE_DELAY=-1\n+\n+quarkus.datasource.\"inventory\".db-kind=h2 <2>\n+quarkus.datasource.\"inventory\".jdbc.url=jdbc:h2:mem:inventory;DB_CLOSE_DELAY=-1\n+\n+quarkus.hibernate-orm.\"users\".database.generation=drop-and-create <3>\n+quarkus.hibernate-orm.\"users\".datasource=users <4>\n+quarkus.hibernate-orm.\"users\".packages=org.acme.model.user <5>\n+\n+quarkus.hibernate-orm.\"inventory\".database.generation=drop-and-create <6>\n+quarkus.hibernate-orm.\"inventory\".datasource=inventory\n+quarkus.hibernate-orm.\"inventory\".packages=org.acme.model.inventory\n+----\n+<1> Define a datasource named `users`.\n+<2> Define a datasource named `inventory`.\n+<3> Define a persistence unit called `users`.\n+<4> Define the datasource used by the persistence unit.\n+<5> This configuration property is important but we will discuss it a bit later.\n+<6> Define a persistence unit called `inventory` pointing to the `inventory` datasource.\n+\n+[NOTE]\n+====\n+You can mix the default datasource and named datasources or only have one or the other.\n+====\n+\n+[NOTE]\n+====\n+The default persistence unit points to the default datasource by default.\n+For named persistence units, the `datasource` property is mandatory.\n+You can point your persistence unit to the default datasource by setting it to `<default>`\n+(which is the internal name of the default datasource).\n+\n+It is perfectly valid to have several persistence units pointing to the same datasource.\n+====\n+\n+==== Attaching model classes to persistence units\n+\n+There are two distinct ways to attach model classes to persistence units and they should not be mixed:\n+\n+* Via the `packages` configuration property;\n+* Via the `@io.quarkus.hibernate.orm.PersistenceUnit` package-level annotation.\n+\n+If both are mixed, the annotations are ignored and only the `packages` configuration properties are taken into account.\n+\n+Using the `packages` configuration property is simple:\n+\n+[source,properties]\n+----\n+quarkus.hibernate-orm.database.generation=drop-and-create\n+quarkus.hibernate-orm.packages=org.acme.model.defaultpu\n+\n+quarkus.hibernate-orm.\"users\".database.generation=drop-and-create\n+quarkus.hibernate-orm.\"users\".datasource=users\n+quarkus.hibernate-orm.\"users\".packages=org.acme.model.user\n+----\n+\n+This configuration snippet will create two persistence units:\n+\n+* The default one which will contain all the model classes under the `org.acme.model.defaultpu` package, subpackages included.\n+* A named `users` persistence unit which will contain all the model classes under the `org.acme.model.user` package, subpackages included.\n+\n+It is possible to attach several packages to a persistence unit:\n+\n+[source,properties]\n+----\n+quarkus.hibernate-orm.\"users\".packages=org.acme.model.shared,org.acme.model.user\n+----\n+\n+All the model classes under the `org.acme.model.shared` and `org.acme.model.user` packages will be attached to the `users` persistence unit.\n+\n+It is also supported to attach a given model class to several persistence units.\n+\n+[NOTE]\n+====\n+Model classes need to be consistently added to a given persistence unit.\n+Meaning all dependent model classes of a given entity (mapped super classes, embeddables...) are required to be attached to the persistence unit.\n+As we are dealing with the persistence unit at the package level, it should be simple enough.\n+====\n+\n+[WARNING]\n+====\n+Panache entities can be attached to only one persistence unit.\n+\n+For entities attached to several persistence units, you cannot use Panache.\n+You can mix the two approaches though and mix Panache entities and traditional entities where multiple persistence units are required.\n+\n+If you have a use case for that and clever ideas about how to implement it without cluttering the simplified Panache approach,\n+contact us on the link:{quarkus-mailing-list-index}[quarkus-dev mailing list].\n+====\n+\n+The second approach to attach model classes to a persistence unit is to use package-level `@io.quarkus.hibernate.orm.PersistenceUnit` annotations.\n+Again, the two approaches cannot be mixed.\n+\n+To obtain a configuration similar to the one above with the `packages` configuration property, create a `package-info.java` file with the following content:\n+\n+[source,java]\n+----\n+@PersistenceUnit(\"users\") <1>\n+package org.acme.model.user;\n+\n+import io.quarkus.hibernate.orm.PersistenceUnit;\n+----\n+<1> Be careful, use the `@io.quarkus.hibernate.orm.PersistenceUnit` annotation, not the JPA one.\n+\n+[CAUTION]\n+====\n+We only support setting `@PersistenceUnit` at the package level,", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "6bd1f7669b4e9fff5754f68e5c36f4adcf7e5631"}, "originalPosition": 224}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MjIwNjcwNA==", "bodyText": "Or put something like this before the initial sentence containing the link to the guide:\nA given Panache entity can be attached to only one persistence unit. Given that, Panache already provides the necessary plumbing to find the appropriate `EntityManager` associated to a Panache entity", "url": "https://github.com/quarkusio/quarkus/pull/11826#discussion_r482206704", "createdAt": "2020-09-02T16:33:22Z", "author": {"login": "gastaldi"}, "path": "docs/src/main/asciidoc/hibernate-orm-panache.adoc", "diffHunk": "@@ -618,6 +618,15 @@ so the compiler must be configured to store parameter names inside the compiled\n This is enabled by default if you are using the Quarkus Maven archetype. If you are not using it, add the property `<maven.compiler.parameters>true</maven.compiler.parameters>` to your pom.xml.\n ====\n \n+== Multiple Persistence Units\n+\n+The support for multiple persistence units is described in details in link:hibernate-orm#multiple-persistence-units[the Hibernate ORM guide].\n+\n+When using Panache, things are simple:\n+\n+* A given Panache entity can be attached to only one persistence unit;\n+* Given that, things are totally transparent and Panache automatically uses the appropriate `EntityManager`.", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MjE5NjgxOQ=="}, "originalCommit": {"oid": "6bd1f7669b4e9fff5754f68e5c36f4adcf7e5631"}, "originalPosition": 11}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "6bd1f7669b4e9fff5754f68e5c36f4adcf7e5631", "author": {"user": {"login": "gsmet", "name": "Guillaume Smet"}}, "url": "https://github.com/quarkusio/quarkus/commit/6bd1f7669b4e9fff5754f68e5c36f4adcf7e5631", "committedDate": "2020-09-02T16:06:25Z", "message": "Document the Multiple Persistence Units support"}, "afterCommit": {"oid": "f2dec74b0cc2f2bc708511e6e6949db963a79e62", "author": {"user": {"login": "gsmet", "name": "Guillaume Smet"}}, "url": "https://github.com/quarkusio/quarkus/commit/f2dec74b0cc2f2bc708511e6e6949db963a79e62", "committedDate": "2020-09-02T16:46:22Z", "message": "Document the Multiple Persistence Units support"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDgxMDI0NDc3", "url": "https://github.com/quarkusio/quarkus/pull/11826#pullrequestreview-481024477", "createdAt": "2020-09-02T17:04:30Z", "commit": {"oid": "f2dec74b0cc2f2bc708511e6e6949db963a79e62"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDgxMDg5MzA5", "url": "https://github.com/quarkusio/quarkus/pull/11826#pullrequestreview-481089309", "createdAt": "2020-09-02T17:50:57Z", "commit": {"oid": "f2dec74b0cc2f2bc708511e6e6949db963a79e62"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wMlQxNzo1MDo1N1rOHL6n2g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wMlQxNzo1MDo1N1rOHL6n2g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MjI1Njg1OA==", "bodyText": "'...file: these drive Quarkus...' -> this is a bit confusing. Do you actually need to say that 'they are not the same...'? Isn't enough to say 'Note that these configuration properties drive the Quarkus configuration properties, which often will map to Hibernate configuration properties, but could have different names and don't necessarily map 1:1 to each other.\nAlso, it's to clear what 'drives' mean.\nEven better if you could name 'these' properties - 'Note that the datasource configuration properties drive (supply, produce, are the source for ??) the Quarkus configuration properties, which often will map to Hibernate configuration properties but they could have different names and don't necessarily map 1:1 to each other.", "url": "https://github.com/quarkusio/quarkus/pull/11826#discussion_r482256858", "createdAt": "2020-09-02T17:50:57Z", "author": {"login": "andreamussap"}, "path": "docs/src/main/asciidoc/hibernate-orm.adoc", "diffHunk": "@@ -70,7 +70,7 @@ quarkus.datasource.jdbc.url = jdbc:postgresql://localhost:5432/hibernate_db\n \n # drop and create the database at startup (use `update` to only update the schema)\n quarkus.hibernate-orm.database.generation=drop-and-create\n---\n+----\n \n Note that these configuration properties are not the same ones as in your typical Hibernate ORM configuration file: these drive Quarkus configuration properties,", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f2dec74b0cc2f2bc708511e6e6949db963a79e62"}, "originalPosition": 33}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDgxMTAxMDA3", "url": "https://github.com/quarkusio/quarkus/pull/11826#pullrequestreview-481101007", "createdAt": "2020-09-02T17:56:01Z", "commit": {"oid": "f2dec74b0cc2f2bc708511e6e6949db963a79e62"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wMlQxNzo1NjowMVrOHL6zCg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wMlQxNzo1NjowMVrOHL6zCg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MjI1OTcyMg==", "bodyText": "Suggestion - To load SQL statements when Hibernate ORM starts, add an import.sql file to the root of your resources directory. This script can contain any SQL DML statements. Make sure to terminate each statement with a semicolon.", "url": "https://github.com/quarkusio/quarkus/pull/11826#discussion_r482259722", "createdAt": "2020-09-02T17:56:01Z", "author": {"login": "andreamussap"}, "path": "docs/src/main/asciidoc/hibernate-orm.adoc", "diffHunk": "@@ -132,7 +132,7 @@ public class Gift {\n         this.name = name;\n     }\n }\n---\n+----\n \n To load some SQL statements when Hibernate ORM starts, add an `import.sql` in the root of your resources directory.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f2dec74b0cc2f2bc708511e6e6949db963a79e62"}, "originalPosition": 68}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDgxMTA2NDQ3", "url": "https://github.com/quarkusio/quarkus/pull/11826#pullrequestreview-481106447", "createdAt": "2020-09-02T17:58:21Z", "commit": {"oid": "f2dec74b0cc2f2bc708511e6e6949db963a79e62"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wMlQxNzo1ODoyMlrOHL64jg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wMlQxNzo1ODoyMlrOHL64jg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MjI2MTEzNA==", "bodyText": "suggestion: 'There are two ways to attach model classes to persistence units, and they should not be mixed.'", "url": "https://github.com/quarkusio/quarkus/pull/11826#discussion_r482261134", "createdAt": "2020-09-02T17:58:22Z", "author": {"login": "andreamussap"}, "path": "docs/src/main/asciidoc/hibernate-orm.adoc", "diffHunk": "@@ -168,37 +168,212 @@ Make up your mind on which approach you want to use.\n Want to start a PostgreSQL server on the side with Docker?\n \n [source,shell]\n---\n+----\n docker run --ulimit memlock=-1:-1 -it --rm=true --memory-swappiness=0 \\\n            --name postgres-quarkus-hibernate -e POSTGRES_USER=hibernate \\\n            -e POSTGRES_PASSWORD=hibernate -e POSTGRES_DB=hibernate_db \\\n            -p 5432:5432 postgres:10.5\n---\n+----\n \n This will start a non-durable empty database: ideal for a quick experiment!\n ====\n \n+[[multiple-persistence-units]]\n+=== Multiple persistence units\n+\n+==== Setting up multiple persistence units\n+\n+[WARNING]\n+====\n+This feature is still experimental.\n+It is considered stable and usable in production but the configuration properties and CDI integration might evolve depending on your feedback.\n+\n+If you are using this feature, any feedback (even just to say it fulfills your requirements) is very welcome on our link:{quarkus-mailing-list-index}[quarkus-dev mailing list].\n+====\n+\n+Starting with Quarkus 1.8, you can define multiple persistence units using the Quarkus configuration properties approach.\n+\n+The properties at the root of the `quarkus.hibernate-orm.` namespace define the default persistence unit.\n+For instance, the following snippet defines a default datasource and a default persistence unit:\n+\n+[source,properties]\n+----\n+quarkus.datasource.db-kind=h2\n+quarkus.datasource.jdbc.url=jdbc:h2:mem:default;DB_CLOSE_DELAY=-1\n+\n+quarkus.hibernate-orm.dialect=org.hibernate.dialect.H2Dialect\n+quarkus.hibernate-orm.database.generation=drop-and-create\n+----\n+\n+Using a map based approach, it is possible to define named persistence units:\n+\n+[source,properties]\n+----\n+quarkus.datasource.\"users\".db-kind=h2 <1>\n+quarkus.datasource.\"users\".jdbc.url=jdbc:h2:mem:users;DB_CLOSE_DELAY=-1\n+\n+quarkus.datasource.\"inventory\".db-kind=h2 <2>\n+quarkus.datasource.\"inventory\".jdbc.url=jdbc:h2:mem:inventory;DB_CLOSE_DELAY=-1\n+\n+quarkus.hibernate-orm.\"users\".database.generation=drop-and-create <3>\n+quarkus.hibernate-orm.\"users\".datasource=users <4>\n+quarkus.hibernate-orm.\"users\".packages=org.acme.model.user <5>\n+\n+quarkus.hibernate-orm.\"inventory\".database.generation=drop-and-create <6>\n+quarkus.hibernate-orm.\"inventory\".datasource=inventory\n+quarkus.hibernate-orm.\"inventory\".packages=org.acme.model.inventory\n+----\n+<1> Define a datasource named `users`.\n+<2> Define a datasource named `inventory`.\n+<3> Define a persistence unit called `users`.\n+<4> Define the datasource used by the persistence unit.\n+<5> This configuration property is important but we will discuss it a bit later.\n+<6> Define a persistence unit called `inventory` pointing to the `inventory` datasource.\n+\n+[NOTE]\n+====\n+You can mix the default datasource and named datasources or only have one or the other.\n+====\n+\n+[NOTE]\n+====\n+The default persistence unit points to the default datasource by default.\n+For named persistence units, the `datasource` property is mandatory.\n+You can point your persistence unit to the default datasource by setting it to `<default>`\n+(which is the internal name of the default datasource).\n+\n+It is perfectly valid to have several persistence units pointing to the same datasource.\n+====\n+\n+==== Attaching model classes to persistence units\n+\n+There are two distinct ways to attach model classes to persistence units and they should not be mixed:", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f2dec74b0cc2f2bc708511e6e6949db963a79e62"}, "originalPosition": 155}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDgxMTA4ODA5", "url": "https://github.com/quarkusio/quarkus/pull/11826#pullrequestreview-481108809", "createdAt": "2020-09-02T17:59:21Z", "commit": {"oid": "f2dec74b0cc2f2bc708511e6e6949db963a79e62"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wMlQxNzo1OToyMVrOHL66zQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wMlQxNzo1OToyMVrOHL66zQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MjI2MTcwOQ==", "bodyText": "'You can attach several packages to a persistence unit:'", "url": "https://github.com/quarkusio/quarkus/pull/11826#discussion_r482261709", "createdAt": "2020-09-02T17:59:21Z", "author": {"login": "andreamussap"}, "path": "docs/src/main/asciidoc/hibernate-orm.adoc", "diffHunk": "@@ -168,37 +168,212 @@ Make up your mind on which approach you want to use.\n Want to start a PostgreSQL server on the side with Docker?\n \n [source,shell]\n---\n+----\n docker run --ulimit memlock=-1:-1 -it --rm=true --memory-swappiness=0 \\\n            --name postgres-quarkus-hibernate -e POSTGRES_USER=hibernate \\\n            -e POSTGRES_PASSWORD=hibernate -e POSTGRES_DB=hibernate_db \\\n            -p 5432:5432 postgres:10.5\n---\n+----\n \n This will start a non-durable empty database: ideal for a quick experiment!\n ====\n \n+[[multiple-persistence-units]]\n+=== Multiple persistence units\n+\n+==== Setting up multiple persistence units\n+\n+[WARNING]\n+====\n+This feature is still experimental.\n+It is considered stable and usable in production but the configuration properties and CDI integration might evolve depending on your feedback.\n+\n+If you are using this feature, any feedback (even just to say it fulfills your requirements) is very welcome on our link:{quarkus-mailing-list-index}[quarkus-dev mailing list].\n+====\n+\n+Starting with Quarkus 1.8, you can define multiple persistence units using the Quarkus configuration properties approach.\n+\n+The properties at the root of the `quarkus.hibernate-orm.` namespace define the default persistence unit.\n+For instance, the following snippet defines a default datasource and a default persistence unit:\n+\n+[source,properties]\n+----\n+quarkus.datasource.db-kind=h2\n+quarkus.datasource.jdbc.url=jdbc:h2:mem:default;DB_CLOSE_DELAY=-1\n+\n+quarkus.hibernate-orm.dialect=org.hibernate.dialect.H2Dialect\n+quarkus.hibernate-orm.database.generation=drop-and-create\n+----\n+\n+Using a map based approach, it is possible to define named persistence units:\n+\n+[source,properties]\n+----\n+quarkus.datasource.\"users\".db-kind=h2 <1>\n+quarkus.datasource.\"users\".jdbc.url=jdbc:h2:mem:users;DB_CLOSE_DELAY=-1\n+\n+quarkus.datasource.\"inventory\".db-kind=h2 <2>\n+quarkus.datasource.\"inventory\".jdbc.url=jdbc:h2:mem:inventory;DB_CLOSE_DELAY=-1\n+\n+quarkus.hibernate-orm.\"users\".database.generation=drop-and-create <3>\n+quarkus.hibernate-orm.\"users\".datasource=users <4>\n+quarkus.hibernate-orm.\"users\".packages=org.acme.model.user <5>\n+\n+quarkus.hibernate-orm.\"inventory\".database.generation=drop-and-create <6>\n+quarkus.hibernate-orm.\"inventory\".datasource=inventory\n+quarkus.hibernate-orm.\"inventory\".packages=org.acme.model.inventory\n+----\n+<1> Define a datasource named `users`.\n+<2> Define a datasource named `inventory`.\n+<3> Define a persistence unit called `users`.\n+<4> Define the datasource used by the persistence unit.\n+<5> This configuration property is important but we will discuss it a bit later.\n+<6> Define a persistence unit called `inventory` pointing to the `inventory` datasource.\n+\n+[NOTE]\n+====\n+You can mix the default datasource and named datasources or only have one or the other.\n+====\n+\n+[NOTE]\n+====\n+The default persistence unit points to the default datasource by default.\n+For named persistence units, the `datasource` property is mandatory.\n+You can point your persistence unit to the default datasource by setting it to `<default>`\n+(which is the internal name of the default datasource).\n+\n+It is perfectly valid to have several persistence units pointing to the same datasource.\n+====\n+\n+==== Attaching model classes to persistence units\n+\n+There are two distinct ways to attach model classes to persistence units and they should not be mixed:\n+\n+* Via the `packages` configuration property;\n+* Via the `@io.quarkus.hibernate.orm.PersistenceUnit` package-level annotation.\n+\n+If both are mixed, the annotations are ignored and only the `packages` configuration properties are taken into account.\n+\n+Using the `packages` configuration property is simple:\n+\n+[source,properties]\n+----\n+quarkus.hibernate-orm.database.generation=drop-and-create\n+quarkus.hibernate-orm.packages=org.acme.model.defaultpu\n+\n+quarkus.hibernate-orm.\"users\".database.generation=drop-and-create\n+quarkus.hibernate-orm.\"users\".datasource=users\n+quarkus.hibernate-orm.\"users\".packages=org.acme.model.user\n+----\n+\n+This configuration snippet will create two persistence units:\n+\n+* The default one which will contain all the model classes under the `org.acme.model.defaultpu` package, subpackages included.\n+* A named `users` persistence unit which will contain all the model classes under the `org.acme.model.user` package, subpackages included.\n+\n+It is possible to attach several packages to a persistence unit:", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f2dec74b0cc2f2bc708511e6e6949db963a79e62"}, "originalPosition": 179}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDgxMTI4OTIw", "url": "https://github.com/quarkusio/quarkus/pull/11826#pullrequestreview-481128920", "createdAt": "2020-09-02T18:08:21Z", "commit": {"oid": "f2dec74b0cc2f2bc708511e6e6949db963a79e62"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "f2dec74b0cc2f2bc708511e6e6949db963a79e62", "author": {"user": {"login": "gsmet", "name": "Guillaume Smet"}}, "url": "https://github.com/quarkusio/quarkus/commit/f2dec74b0cc2f2bc708511e6e6949db963a79e62", "committedDate": "2020-09-02T16:46:22Z", "message": "Document the Multiple Persistence Units support"}, "afterCommit": {"oid": "32d1f6ca6adb740a5fc32fbe2028b4489a81c7d2", "author": {"user": {"login": "gsmet", "name": "Guillaume Smet"}}, "url": "https://github.com/quarkusio/quarkus/commit/32d1f6ca6adb740a5fc32fbe2028b4489a81c7d2", "committedDate": "2020-09-02T19:43:50Z", "message": "Additional adjustment suggested by Andrea."}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "32d1f6ca6adb740a5fc32fbe2028b4489a81c7d2", "author": {"user": {"login": "gsmet", "name": "Guillaume Smet"}}, "url": "https://github.com/quarkusio/quarkus/commit/32d1f6ca6adb740a5fc32fbe2028b4489a81c7d2", "committedDate": "2020-09-02T19:43:50Z", "message": "Additional adjustment suggested by Andrea."}, "afterCommit": {"oid": "d6aaafaad1f0687edf2940f0b238983260c929e6", "author": {"user": {"login": "gsmet", "name": "Guillaume Smet"}}, "url": "https://github.com/quarkusio/quarkus/commit/d6aaafaad1f0687edf2940f0b238983260c929e6", "committedDate": "2020-09-02T19:45:24Z", "message": "Additional adjustments suggested by Andrea"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDgxMjg0MTg0", "url": "https://github.com/quarkusio/quarkus/pull/11826#pullrequestreview-481284184", "createdAt": "2020-09-02T20:42:41Z", "commit": {"oid": "d6aaafaad1f0687edf2940f0b238983260c929e6"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wMlQyMDo0Mjo0MlrOHMFqwQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wMlQyMDo0Mjo0MlrOHMFqwQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MjQzNzgyNQ==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            The support for multiple persistence units is described in details in link:hibernate-orm#multiple-persistence-units[the Hibernate ORM guide].\n          \n          \n            \n            The support for multiple persistence units is described in detail in link:hibernate-orm#multiple-persistence-units[the Hibernate ORM guide].", "url": "https://github.com/quarkusio/quarkus/pull/11826#discussion_r482437825", "createdAt": "2020-09-02T20:42:42Z", "author": {"login": "geoand"}, "path": "docs/src/main/asciidoc/hibernate-orm-panache.adoc", "diffHunk": "@@ -618,6 +618,15 @@ so the compiler must be configured to store parameter names inside the compiled\n This is enabled by default if you are using the Quarkus Maven archetype. If you are not using it, add the property `<maven.compiler.parameters>true</maven.compiler.parameters>` to your pom.xml.\n ====\n \n+== Multiple Persistence Units\n+\n+The support for multiple persistence units is described in details in link:hibernate-orm#multiple-persistence-units[the Hibernate ORM guide].", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d6aaafaad1f0687edf2940f0b238983260c929e6"}, "originalPosition": 6}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDgxMjg0Mzk5", "url": "https://github.com/quarkusio/quarkus/pull/11826#pullrequestreview-481284399", "createdAt": "2020-09-02T20:42:59Z", "commit": {"oid": "d6aaafaad1f0687edf2940f0b238983260c929e6"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wMlQyMDo0Mjo1OVrOHMFsRQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wMlQyMDo0Mjo1OVrOHMFsRQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MjQzODIxMw==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            * A given Panache entity can be attached to only one persistence unit.\n          \n          \n            \n            * A given Panache entity can be attached to a single persistence unit.", "url": "https://github.com/quarkusio/quarkus/pull/11826#discussion_r482438213", "createdAt": "2020-09-02T20:42:59Z", "author": {"login": "geoand"}, "path": "docs/src/main/asciidoc/hibernate-orm-panache.adoc", "diffHunk": "@@ -618,6 +618,15 @@ so the compiler must be configured to store parameter names inside the compiled\n This is enabled by default if you are using the Quarkus Maven archetype. If you are not using it, add the property `<maven.compiler.parameters>true</maven.compiler.parameters>` to your pom.xml.\n ====\n \n+== Multiple Persistence Units\n+\n+The support for multiple persistence units is described in details in link:hibernate-orm#multiple-persistence-units[the Hibernate ORM guide].\n+\n+When using Panache, things are simple:\n+\n+* A given Panache entity can be attached to only one persistence unit.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d6aaafaad1f0687edf2940f0b238983260c929e6"}, "originalPosition": 10}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDgxMjg5MDYz", "url": "https://github.com/quarkusio/quarkus/pull/11826#pullrequestreview-481289063", "createdAt": "2020-09-02T20:49:35Z", "commit": {"oid": "d6aaafaad1f0687edf2940f0b238983260c929e6"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wMlQyMDo0OTozNVrOHMGPOA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wMlQyMDo0OTozNVrOHMGPOA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MjQ0NzE2MA==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            Meaning all dependent model classes of a given entity (mapped super classes, embeddables...) are required to be attached to the persistence unit.\n          \n          \n            \n            That meant that all dependent model classes of a given entity (mapped super classes, embeddables...) are required to be attached to the persistence unit.", "url": "https://github.com/quarkusio/quarkus/pull/11826#discussion_r482447160", "createdAt": "2020-09-02T20:49:35Z", "author": {"login": "geoand"}, "path": "docs/src/main/asciidoc/hibernate-orm.adoc", "diffHunk": "@@ -168,37 +170,212 @@ Make up your mind on which approach you want to use.\n Want to start a PostgreSQL server on the side with Docker?\n \n [source,shell]\n---\n+----\n docker run --ulimit memlock=-1:-1 -it --rm=true --memory-swappiness=0 \\\n            --name postgres-quarkus-hibernate -e POSTGRES_USER=hibernate \\\n            -e POSTGRES_PASSWORD=hibernate -e POSTGRES_DB=hibernate_db \\\n            -p 5432:5432 postgres:10.5\n---\n+----\n \n This will start a non-durable empty database: ideal for a quick experiment!\n ====\n \n+[[multiple-persistence-units]]\n+=== Multiple persistence units\n+\n+==== Setting up multiple persistence units\n+\n+[WARNING]\n+====\n+This feature is still experimental.\n+It is considered stable and usable in production but the configuration properties and CDI integration might evolve depending on your feedback.\n+\n+If you are using this feature, any feedback (even just to say it fulfills your requirements) is very welcome on our link:{quarkus-mailing-list-index}[quarkus-dev mailing list].\n+====\n+\n+Starting with Quarkus 1.8, you can define multiple persistence units using the Quarkus configuration properties approach.\n+\n+The properties at the root of the `quarkus.hibernate-orm.` namespace define the default persistence unit.\n+For instance, the following snippet defines a default datasource and a default persistence unit:\n+\n+[source,properties]\n+----\n+quarkus.datasource.db-kind=h2\n+quarkus.datasource.jdbc.url=jdbc:h2:mem:default;DB_CLOSE_DELAY=-1\n+\n+quarkus.hibernate-orm.dialect=org.hibernate.dialect.H2Dialect\n+quarkus.hibernate-orm.database.generation=drop-and-create\n+----\n+\n+Using a map based approach, it is possible to define named persistence units:\n+\n+[source,properties]\n+----\n+quarkus.datasource.\"users\".db-kind=h2 <1>\n+quarkus.datasource.\"users\".jdbc.url=jdbc:h2:mem:users;DB_CLOSE_DELAY=-1\n+\n+quarkus.datasource.\"inventory\".db-kind=h2 <2>\n+quarkus.datasource.\"inventory\".jdbc.url=jdbc:h2:mem:inventory;DB_CLOSE_DELAY=-1\n+\n+quarkus.hibernate-orm.\"users\".database.generation=drop-and-create <3>\n+quarkus.hibernate-orm.\"users\".datasource=users <4>\n+quarkus.hibernate-orm.\"users\".packages=org.acme.model.user <5>\n+\n+quarkus.hibernate-orm.\"inventory\".database.generation=drop-and-create <6>\n+quarkus.hibernate-orm.\"inventory\".datasource=inventory\n+quarkus.hibernate-orm.\"inventory\".packages=org.acme.model.inventory\n+----\n+<1> Define a datasource named `users`.\n+<2> Define a datasource named `inventory`.\n+<3> Define a persistence unit called `users`.\n+<4> Define the datasource used by the persistence unit.\n+<5> This configuration property is important but we will discuss it a bit later.\n+<6> Define a persistence unit called `inventory` pointing to the `inventory` datasource.\n+\n+[NOTE]\n+====\n+You can mix the default datasource and named datasources or only have one or the other.\n+====\n+\n+[NOTE]\n+====\n+The default persistence unit points to the default datasource by default.\n+For named persistence units, the `datasource` property is mandatory.\n+You can point your persistence unit to the default datasource by setting it to `<default>`\n+(which is the internal name of the default datasource).\n+\n+It is perfectly valid to have several persistence units pointing to the same datasource.\n+====\n+\n+==== Attaching model classes to persistence units\n+\n+There are two ways to attach model classes to persistence units, and they should not be mixed:\n+\n+* Via the `packages` configuration property;\n+* Via the `@io.quarkus.hibernate.orm.PersistenceUnit` package-level annotation.\n+\n+If both are mixed, the annotations are ignored and only the `packages` configuration properties are taken into account.\n+\n+Using the `packages` configuration property is simple:\n+\n+[source,properties]\n+----\n+quarkus.hibernate-orm.database.generation=drop-and-create\n+quarkus.hibernate-orm.packages=org.acme.model.defaultpu\n+\n+quarkus.hibernate-orm.\"users\".database.generation=drop-and-create\n+quarkus.hibernate-orm.\"users\".datasource=users\n+quarkus.hibernate-orm.\"users\".packages=org.acme.model.user\n+----\n+\n+This configuration snippet will create two persistence units:\n+\n+* The default one which will contain all the model classes under the `org.acme.model.defaultpu` package, subpackages included.\n+* A named `users` persistence unit which will contain all the model classes under the `org.acme.model.user` package, subpackages included.\n+\n+You can attach several packages to a persistence unit:\n+\n+[source,properties]\n+----\n+quarkus.hibernate-orm.\"users\".packages=org.acme.model.shared,org.acme.model.user\n+----\n+\n+All the model classes under the `org.acme.model.shared` and `org.acme.model.user` packages will be attached to the `users` persistence unit.\n+\n+It is also supported to attach a given model class to several persistence units.\n+\n+[NOTE]\n+====\n+Model classes need to be consistently added to a given persistence unit.\n+Meaning all dependent model classes of a given entity (mapped super classes, embeddables...) are required to be attached to the persistence unit.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d6aaafaad1f0687edf2940f0b238983260c929e6"}, "originalPosition": 208}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDgxMjk3MDAx", "url": "https://github.com/quarkusio/quarkus/pull/11826#pullrequestreview-481297001", "createdAt": "2020-09-02T21:00:28Z", "commit": {"oid": "d6aaafaad1f0687edf2940f0b238983260c929e6"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ffbaf9e92f71bcb9e1ff430a77d8e57a368c2fb9", "author": {"user": {"login": "gsmet", "name": "Guillaume Smet"}}, "url": "https://github.com/quarkusio/quarkus/commit/ffbaf9e92f71bcb9e1ff430a77d8e57a368c2fb9", "committedDate": "2020-09-03T10:23:41Z", "message": "Document the Multiple Persistence Units support"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "c60aa6ea2d9f36860a087eaa63d600fd2fb118a4", "author": {"user": {"login": "gsmet", "name": "Guillaume Smet"}}, "url": "https://github.com/quarkusio/quarkus/commit/c60aa6ea2d9f36860a087eaa63d600fd2fb118a4", "committedDate": "2020-09-03T10:21:23Z", "message": "Apply suggestions from code review\n\nCo-authored-by: Georgios Andrianakis <geoand@gmail.com>"}, "afterCommit": {"oid": "ffbaf9e92f71bcb9e1ff430a77d8e57a368c2fb9", "author": {"user": {"login": "gsmet", "name": "Guillaume Smet"}}, "url": "https://github.com/quarkusio/quarkus/commit/ffbaf9e92f71bcb9e1ff430a77d8e57a368c2fb9", "committedDate": "2020-09-03T10:23:41Z", "message": "Document the Multiple Persistence Units support"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 677, "cost": 1, "resetAt": "2021-11-01T16:37:27Z"}}}