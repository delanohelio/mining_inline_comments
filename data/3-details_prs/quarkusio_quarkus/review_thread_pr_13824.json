{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTM2MTUzMzIz", "number": 13824, "reviewThreads": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xMFQxODo0NjowNVrOFDoPEw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xMFQxODo0Nzo0OVrOFDoSIg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzM5MzQ5MjY3OnYy", "diffSide": "RIGHT", "path": "extensions/panache/mongodb-panache-common/runtime/src/main/java/io/quarkus/mongodb/panache/runtime/CommonPanacheQueryImpl.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xMFQxODo0NjowNVrOIDYGsg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xMVQwODoxMjo0NFrOIDtmLg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MDQxMTU3MA==", "bodyText": "The collection should be updated/reassigned here rather than lazily.  Save some headaches down the line.", "url": "https://github.com/quarkusio/quarkus/pull/13824#discussion_r540411570", "createdAt": "2020-12-10T18:46:05Z", "author": {"login": "evanchooly"}, "path": "extensions/panache/mongodb-panache-common/runtime/src/main/java/io/quarkus/mongodb/panache/runtime/CommonPanacheQueryImpl.java", "diffHunk": "@@ -139,12 +142,21 @@ private void checkPagination() {\n         return (CommonPanacheQueryImpl<T>) this;\n     }\n \n+    public <T extends Entity> CommonPanacheQueryImpl<T> withReadPreference(ReadPreference readPreference) {\n+        this.readPreference = readPreference;\n+        return (CommonPanacheQueryImpl<T>) this;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a0954ec06c4c6d5bb3fa19bc118d99f3bac6fa85"}, "originalPosition": 30}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MDc2MzY5NA==", "bodyText": "Ah yes, this is so simple to do it this way ;)\nI'll update my impl then.", "url": "https://github.com/quarkusio/quarkus/pull/13824#discussion_r540763694", "createdAt": "2020-12-11T08:12:44Z", "author": {"login": "loicmathieu"}, "path": "extensions/panache/mongodb-panache-common/runtime/src/main/java/io/quarkus/mongodb/panache/runtime/CommonPanacheQueryImpl.java", "diffHunk": "@@ -139,12 +142,21 @@ private void checkPagination() {\n         return (CommonPanacheQueryImpl<T>) this;\n     }\n \n+    public <T extends Entity> CommonPanacheQueryImpl<T> withReadPreference(ReadPreference readPreference) {\n+        this.readPreference = readPreference;\n+        return (CommonPanacheQueryImpl<T>) this;", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MDQxMTU3MA=="}, "originalCommit": {"oid": "a0954ec06c4c6d5bb3fa19bc118d99f3bac6fa85"}, "originalPosition": 30}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzM5MzQ5NTc4OnYy", "diffSide": "RIGHT", "path": "extensions/panache/mongodb-panache-common/runtime/src/main/java/io/quarkus/mongodb/panache/runtime/CommonPanacheQueryImpl.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xMFQxODo0Njo0NVrOIDYIbQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xMFQxODo0Njo0NVrOIDYIbQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MDQxMjAxMw==", "bodyText": "This can all but ignore the ReadPreference but updating as above.", "url": "https://github.com/quarkusio/quarkus/pull/13824#discussion_r540412013", "createdAt": "2020-12-10T18:46:45Z", "author": {"login": "evanchooly"}, "path": "extensions/panache/mongodb-panache-common/runtime/src/main/java/io/quarkus/mongodb/panache/runtime/CommonPanacheQueryImpl.java", "diffHunk": "@@ -139,12 +142,21 @@ private void checkPagination() {\n         return (CommonPanacheQueryImpl<T>) this;\n     }\n \n+    public <T extends Entity> CommonPanacheQueryImpl<T> withReadPreference(ReadPreference readPreference) {\n+        this.readPreference = readPreference;\n+        return (CommonPanacheQueryImpl<T>) this;\n+    }\n+\n     // Results\n \n     @SuppressWarnings(\"unchecked\")\n     public long count() {\n         if (count == null) {\n-            count = collection.countDocuments(mongoQuery);\n+            MongoCollection theCollection = collection;\n+            if (this.readPreference != null) {\n+                theCollection = theCollection.withReadPreference(this.readPreference);\n+            }\n+            count = theCollection.countDocuments(mongoQuery);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a0954ec06c4c6d5bb3fa19bc118d99f3bac6fa85"}, "originalPosition": 43}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzM5MzUwMDUwOnYy", "diffSide": "RIGHT", "path": "extensions/panache/mongodb-panache-common/runtime/src/main/java/io/quarkus/mongodb/panache/runtime/CommonPanacheQueryImpl.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xMFQxODo0Nzo0OVrOIDYLGA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xMFQxODo0Nzo0OVrOIDYLGA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MDQxMjY5Ng==", "bodyText": "Same here.", "url": "https://github.com/quarkusio/quarkus/pull/13824#discussion_r540412696", "createdAt": "2020-12-10T18:47:49Z", "author": {"login": "evanchooly"}, "path": "extensions/panache/mongodb-panache-common/runtime/src/main/java/io/quarkus/mongodb/panache/runtime/CommonPanacheQueryImpl.java", "diffHunk": "@@ -156,7 +168,11 @@ public long count() {\n     @SuppressWarnings(\"unchecked\")\n     private <T extends Entity> List<T> list(Integer limit) {\n         List<T> list = new ArrayList<>();\n-        FindIterable find = mongoQuery == null ? collection.find() : collection.find(mongoQuery);\n+        MongoCollection theCollection = collection;\n+        if (this.readPreference != null) {\n+            theCollection = theCollection.withReadPreference(this.readPreference);\n+        }\n+        FindIterable find = mongoQuery == null ? theCollection.find() : theCollection.find(mongoQuery);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a0954ec06c4c6d5bb3fa19bc118d99f3bac6fa85"}, "originalPosition": 56}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4492, "cost": 1, "resetAt": "2021-11-13T14:23:39Z"}}}