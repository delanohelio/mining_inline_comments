{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDY1NDY1Mzk3", "number": 11300, "reviewThreads": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wMVQxMjowNTowMFrOEe323Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wMVQxMjowNTowMFrOEe323Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzAwODA3OTAxOnYy", "diffSide": "RIGHT", "path": "extensions/flyway/deployment/src/main/java/io/quarkus/flyway/FlywayProcessor.java", "isResolved": false, "comments": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wMVQxMjowNTowMFrOHKzMrQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wMVQxMzozODoyMVrOHK2s2w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MTA4NjYzNw==", "bodyText": "This does not work in a Jar !\nI get unable to optain inputstream for resource:\ndb/migration/oracle/../oracle/<migration_name>.sql\nwith quarkus/flyway.locations=db/migration/oracle", "url": "https://github.com/quarkusio/quarkus/pull/11300#discussion_r481086637", "createdAt": "2020-09-01T12:05:00Z", "author": {"login": "rmanibus"}, "path": "extensions/flyway/deployment/src/main/java/io/quarkus/flyway/FlywayProcessor.java", "diffHunk": "@@ -232,11 +226,33 @@ ServiceStartBuildItem createBeansAndStartActions(FlywayRecorder recorder,\n         }\n     }\n \n+    private String normalizeLocation(String location) {\n+        if (location == null) {\n+            throw new IllegalStateException(\"Flyway migration location may not be null.\");\n+        }\n+\n+        // Strip any 'classpath:' protocol prefixes because they are assumed\n+        // but not recognized by ClassLoader.getResources()\n+        if (location.startsWith(CLASSPATH_APPLICATION_MIGRATIONS_PROTOCOL + ':')) {\n+            location = location.substring(CLASSPATH_APPLICATION_MIGRATIONS_PROTOCOL.length() + 1);\n+            if (location.startsWith(\"/\")) {\n+                location = location.substring(1);\n+            }\n+        }\n+        if (!location.endsWith(\"/\")) {\n+            location += \"/\";\n+        }\n+\n+        return location;\n+    }\n+\n     private Set<String> getApplicationMigrationsFromPath(final String location, final URL path)\n             throws IOException, URISyntaxException {\n-        try (final Stream<Path> pathStream = Files.walk(Paths.get(path.toURI()))) {\n+        Path rootPath = Paths.get(path.toURI());\n+\n+        try (final Stream<Path> pathStream = Files.walk(rootPath)) {\n             return pathStream.filter(Files::isRegularFile)\n-                    .map(it -> Paths.get(location, it.getFileName().toString()).toString())\n+                    .map(it -> Paths.get(location, rootPath.relativize(it).toString()).toString())", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c715ba3410e6d45efe55128115756f37d179642e"}, "originalPosition": 49}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MTA4NzcxMw==", "bodyText": "I will try to make a reproducer yes", "url": "https://github.com/quarkusio/quarkus/pull/11300#discussion_r481087713", "createdAt": "2020-09-01T12:07:04Z", "author": {"login": "rmanibus"}, "path": "extensions/flyway/deployment/src/main/java/io/quarkus/flyway/FlywayProcessor.java", "diffHunk": "@@ -232,11 +226,33 @@ ServiceStartBuildItem createBeansAndStartActions(FlywayRecorder recorder,\n         }\n     }\n \n+    private String normalizeLocation(String location) {\n+        if (location == null) {\n+            throw new IllegalStateException(\"Flyway migration location may not be null.\");\n+        }\n+\n+        // Strip any 'classpath:' protocol prefixes because they are assumed\n+        // but not recognized by ClassLoader.getResources()\n+        if (location.startsWith(CLASSPATH_APPLICATION_MIGRATIONS_PROTOCOL + ':')) {\n+            location = location.substring(CLASSPATH_APPLICATION_MIGRATIONS_PROTOCOL.length() + 1);\n+            if (location.startsWith(\"/\")) {\n+                location = location.substring(1);\n+            }\n+        }\n+        if (!location.endsWith(\"/\")) {\n+            location += \"/\";\n+        }\n+\n+        return location;\n+    }\n+\n     private Set<String> getApplicationMigrationsFromPath(final String location, final URL path)\n             throws IOException, URISyntaxException {\n-        try (final Stream<Path> pathStream = Files.walk(Paths.get(path.toURI()))) {\n+        Path rootPath = Paths.get(path.toURI());\n+\n+        try (final Stream<Path> pathStream = Files.walk(rootPath)) {\n             return pathStream.filter(Files::isRegularFile)\n-                    .map(it -> Paths.get(location, it.getFileName().toString()).toString())\n+                    .map(it -> Paths.get(location, rootPath.relativize(it).toString()).toString())", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MTA4NjYzNw=="}, "originalCommit": {"oid": "c715ba3410e6d45efe55128115756f37d179642e"}, "originalPosition": 49}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MTA4Nzk3MA==", "bodyText": "Thanks", "url": "https://github.com/quarkusio/quarkus/pull/11300#discussion_r481087970", "createdAt": "2020-09-01T12:07:34Z", "author": {"login": "geoand"}, "path": "extensions/flyway/deployment/src/main/java/io/quarkus/flyway/FlywayProcessor.java", "diffHunk": "@@ -232,11 +226,33 @@ ServiceStartBuildItem createBeansAndStartActions(FlywayRecorder recorder,\n         }\n     }\n \n+    private String normalizeLocation(String location) {\n+        if (location == null) {\n+            throw new IllegalStateException(\"Flyway migration location may not be null.\");\n+        }\n+\n+        // Strip any 'classpath:' protocol prefixes because they are assumed\n+        // but not recognized by ClassLoader.getResources()\n+        if (location.startsWith(CLASSPATH_APPLICATION_MIGRATIONS_PROTOCOL + ':')) {\n+            location = location.substring(CLASSPATH_APPLICATION_MIGRATIONS_PROTOCOL.length() + 1);\n+            if (location.startsWith(\"/\")) {\n+                location = location.substring(1);\n+            }\n+        }\n+        if (!location.endsWith(\"/\")) {\n+            location += \"/\";\n+        }\n+\n+        return location;\n+    }\n+\n     private Set<String> getApplicationMigrationsFromPath(final String location, final URL path)\n             throws IOException, URISyntaxException {\n-        try (final Stream<Path> pathStream = Files.walk(Paths.get(path.toURI()))) {\n+        Path rootPath = Paths.get(path.toURI());\n+\n+        try (final Stream<Path> pathStream = Files.walk(rootPath)) {\n             return pathStream.filter(Files::isRegularFile)\n-                    .map(it -> Paths.get(location, it.getFileName().toString()).toString())\n+                    .map(it -> Paths.get(location, rootPath.relativize(it).toString()).toString())", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MTA4NjYzNw=="}, "originalCommit": {"oid": "c715ba3410e6d45efe55128115756f37d179642e"}, "originalPosition": 49}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MTA5OTM2OA==", "bodyText": "Please open a separate issue with a reproducer so that we can easily track it.\nThanks!", "url": "https://github.com/quarkusio/quarkus/pull/11300#discussion_r481099368", "createdAt": "2020-09-01T12:28:45Z", "author": {"login": "gsmet"}, "path": "extensions/flyway/deployment/src/main/java/io/quarkus/flyway/FlywayProcessor.java", "diffHunk": "@@ -232,11 +226,33 @@ ServiceStartBuildItem createBeansAndStartActions(FlywayRecorder recorder,\n         }\n     }\n \n+    private String normalizeLocation(String location) {\n+        if (location == null) {\n+            throw new IllegalStateException(\"Flyway migration location may not be null.\");\n+        }\n+\n+        // Strip any 'classpath:' protocol prefixes because they are assumed\n+        // but not recognized by ClassLoader.getResources()\n+        if (location.startsWith(CLASSPATH_APPLICATION_MIGRATIONS_PROTOCOL + ':')) {\n+            location = location.substring(CLASSPATH_APPLICATION_MIGRATIONS_PROTOCOL.length() + 1);\n+            if (location.startsWith(\"/\")) {\n+                location = location.substring(1);\n+            }\n+        }\n+        if (!location.endsWith(\"/\")) {\n+            location += \"/\";\n+        }\n+\n+        return location;\n+    }\n+\n     private Set<String> getApplicationMigrationsFromPath(final String location, final URL path)\n             throws IOException, URISyntaxException {\n-        try (final Stream<Path> pathStream = Files.walk(Paths.get(path.toURI()))) {\n+        Path rootPath = Paths.get(path.toURI());\n+\n+        try (final Stream<Path> pathStream = Files.walk(rootPath)) {\n             return pathStream.filter(Files::isRegularFile)\n-                    .map(it -> Paths.get(location, it.getFileName().toString()).toString())\n+                    .map(it -> Paths.get(location, rootPath.relativize(it).toString()).toString())", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MTA4NjYzNw=="}, "originalCommit": {"oid": "c715ba3410e6d45efe55128115756f37d179642e"}, "originalPosition": 49}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MTE0NDAyNw==", "bodyText": "Please see #11780", "url": "https://github.com/quarkusio/quarkus/pull/11300#discussion_r481144027", "createdAt": "2020-09-01T13:38:21Z", "author": {"login": "rmanibus"}, "path": "extensions/flyway/deployment/src/main/java/io/quarkus/flyway/FlywayProcessor.java", "diffHunk": "@@ -232,11 +226,33 @@ ServiceStartBuildItem createBeansAndStartActions(FlywayRecorder recorder,\n         }\n     }\n \n+    private String normalizeLocation(String location) {\n+        if (location == null) {\n+            throw new IllegalStateException(\"Flyway migration location may not be null.\");\n+        }\n+\n+        // Strip any 'classpath:' protocol prefixes because they are assumed\n+        // but not recognized by ClassLoader.getResources()\n+        if (location.startsWith(CLASSPATH_APPLICATION_MIGRATIONS_PROTOCOL + ':')) {\n+            location = location.substring(CLASSPATH_APPLICATION_MIGRATIONS_PROTOCOL.length() + 1);\n+            if (location.startsWith(\"/\")) {\n+                location = location.substring(1);\n+            }\n+        }\n+        if (!location.endsWith(\"/\")) {\n+            location += \"/\";\n+        }\n+\n+        return location;\n+    }\n+\n     private Set<String> getApplicationMigrationsFromPath(final String location, final URL path)\n             throws IOException, URISyntaxException {\n-        try (final Stream<Path> pathStream = Files.walk(Paths.get(path.toURI()))) {\n+        Path rootPath = Paths.get(path.toURI());\n+\n+        try (final Stream<Path> pathStream = Files.walk(rootPath)) {\n             return pathStream.filter(Files::isRegularFile)\n-                    .map(it -> Paths.get(location, it.getFileName().toString()).toString())\n+                    .map(it -> Paths.get(location, rootPath.relativize(it).toString()).toString())", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MTA4NjYzNw=="}, "originalCommit": {"oid": "c715ba3410e6d45efe55128115756f37d179642e"}, "originalPosition": 49}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 716, "cost": 1, "resetAt": "2021-11-13T12:26:42Z"}}}