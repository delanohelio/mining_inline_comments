{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTI3NTUwNDQ3", "number": 13473, "title": "Workaround graal#3003 by passing IncludeResources via AutomaticFeature", "bodyText": "instead of command line argument\nFix #13472", "createdAt": "2020-11-25T16:07:17Z", "url": "https://github.com/quarkusio/quarkus/pull/13473", "merged": true, "mergeCommit": {"oid": "9cc3d421c14c2e5b64aeda6d52ce595d10bde33c"}, "closed": true, "closedAt": "2020-12-02T10:14:21Z", "author": {"login": "ppalaga"}, "timelineItems": {"totalCount": 11, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdgAwWCgBqjQwMzg4NjIwNjk=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdh68fTAFqTU0MTk1OTM0MQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "60f443459b70a12bb9e422e807ec8f71428df85a", "author": {"user": {"login": "ppalaga", "name": "Peter Palaga"}}, "url": "https://github.com/quarkusio/quarkus/commit/60f443459b70a12bb9e422e807ec8f71428df85a", "committedDate": "2020-11-25T16:05:21Z", "message": "Workaround graal#3003 by passing IncludeResources via AutomaticFeature\ninstead of command line argument #13472"}, "afterCommit": {"oid": "cf3ad81c895fe066c76a8166304f32e4e6618591", "author": {"user": {"login": "ppalaga", "name": "Peter Palaga"}}, "url": "https://github.com/quarkusio/quarkus/commit/cf3ad81c895fe066c76a8166304f32e4e6618591", "committedDate": "2020-11-25T16:15:28Z", "message": "Workaround graal#3003 by passing IncludeResources via AutomaticFeature\ninstead of command line argument #13472"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTM5MTIwNzIx", "url": "https://github.com/quarkusio/quarkus/pull/13473#pullrequestreview-539120721", "createdAt": "2020-11-26T09:10:55Z", "commit": {"oid": "cf3ad81c895fe066c76a8166304f32e4e6618591"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0yNlQwOToxMDo1NlrOH6SFyA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0yNlQwOToxMDo1NlrOH6SFyA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMDg3NTg0OA==", "bodyText": "Why do you remove this method? NativeImageResourceDirectoryBuildItem does not seem to be related to the -H:IncludeResources problem, or?", "url": "https://github.com/quarkusio/quarkus/pull/13473#discussion_r530875848", "createdAt": "2020-11-26T09:10:56Z", "author": {"login": "mkouba"}, "path": "core/deployment/src/main/java/io/quarkus/deployment/steps/NativeImageAutoFeatureStep.java", "diffHunk": "@@ -62,44 +53,25 @@\n     private static final MethodDescriptor RERUN_INITIALIZATION = ofMethod(\n             \"org.graalvm.nativeimage.impl.RuntimeClassInitializationSupport\",\n             \"rerunInitialization\", void.class, Class.class, String.class);\n+    private static final MethodDescriptor RESOURCES_REGISTRY_ADD_RESOURCES = ofMethod(\n+            \"com.oracle.svm.core.configure.ResourcesRegistry\",\n+            \"addResources\", void.class, String.class);\n+    private static final MethodDescriptor RESOURCES_REGISTRY_IGNORE_RESOURCES = ofMethod(\n+            \"com.oracle.svm.core.configure.ResourcesRegistry\",\n+            \"ignoreResources\", void.class, String.class);\n     static final String RUNTIME_REFLECTION = RuntimeReflection.class.getName();\n     static final String JNI_RUNTIME_ACCESS = \"com.oracle.svm.core.jni.JNIRuntimeAccess\";\n     static final String BEFORE_ANALYSIS_ACCESS = Feature.BeforeAnalysisAccess.class.getName();\n     static final String DYNAMIC_PROXY_REGISTRY = \"com.oracle.svm.core.jdk.proxy.DynamicProxyRegistry\";\n     static final String LOCALIZATION_FEATURE = \"com.oracle.svm.core.jdk.LocalizationFeature\";\n \n-    @BuildStep\n-    List<NativeImageResourceBuildItem> registerPackageResources(", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "cf3ad81c895fe066c76a8166304f32e4e6618591"}, "originalPosition": 53}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTM5MTI2NDAz", "url": "https://github.com/quarkusio/quarkus/pull/13473#pullrequestreview-539126403", "createdAt": "2020-11-26T09:17:41Z", "commit": {"oid": "cf3ad81c895fe066c76a8166304f32e4e6618591"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0yNlQwOToxNzo0MVrOH6SWNw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0yNlQwOToxNzo0MVrOH6SWNw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMDg4MDA1NQ==", "bodyText": "I thought that the purpose of this PR is to avoid -H:IncludeResources completely?", "url": "https://github.com/quarkusio/quarkus/pull/13473#discussion_r530880055", "createdAt": "2020-11-26T09:17:41Z", "author": {"login": "mkouba"}, "path": "core/deployment/src/main/java/io/quarkus/deployment/builditem/nativeimage/NativeImageResourcePatternsBuildItem.java", "diffHunk": "@@ -0,0 +1,76 @@\n+package io.quarkus.deployment.builditem.nativeimage;\n+\n+import java.util.ArrayList;\n+import java.util.Collection;\n+import java.util.Collections;\n+import java.util.List;\n+import java.util.stream.Stream;\n+\n+import io.quarkus.builder.item.MultiBuildItem;\n+import io.quarkus.deployment.util.GlobUtil;\n+\n+/**\n+ * A build item that indicates that a set of resource paths defined by regular expression patterns or globs should be\n+ * included in the native image. This uses native-image's {@code -H:IncludeResources} under the hood.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "cf3ad81c895fe066c76a8166304f32e4e6618591"}, "originalPosition": 14}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTM5MTI2Nzkx", "url": "https://github.com/quarkusio/quarkus/pull/13473#pullrequestreview-539126791", "createdAt": "2020-11-26T09:18:10Z", "commit": {"oid": "cf3ad81c895fe066c76a8166304f32e4e6618591"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0yNlQwOToxODoxMFrOH6SXTA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0yNlQwOToxODoxMFrOH6SXTA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMDg4MDMzMg==", "bodyText": "Maybe it wouldn't hurt to explain what globs means...", "url": "https://github.com/quarkusio/quarkus/pull/13473#discussion_r530880332", "createdAt": "2020-11-26T09:18:10Z", "author": {"login": "mkouba"}, "path": "core/deployment/src/main/java/io/quarkus/deployment/builditem/nativeimage/NativeImageResourcePatternsBuildItem.java", "diffHunk": "@@ -0,0 +1,76 @@\n+package io.quarkus.deployment.builditem.nativeimage;\n+\n+import java.util.ArrayList;\n+import java.util.Collection;\n+import java.util.Collections;\n+import java.util.List;\n+import java.util.stream.Stream;\n+\n+import io.quarkus.builder.item.MultiBuildItem;\n+import io.quarkus.deployment.util.GlobUtil;\n+\n+/**\n+ * A build item that indicates that a set of resource paths defined by regular expression patterns or globs should be", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "cf3ad81c895fe066c76a8166304f32e4e6618591"}, "originalPosition": 13}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "cf3ad81c895fe066c76a8166304f32e4e6618591", "author": {"user": {"login": "ppalaga", "name": "Peter Palaga"}}, "url": "https://github.com/quarkusio/quarkus/commit/cf3ad81c895fe066c76a8166304f32e4e6618591", "committedDate": "2020-11-25T16:15:28Z", "message": "Workaround graal#3003 by passing IncludeResources via AutomaticFeature\ninstead of command line argument #13472"}, "afterCommit": {"oid": "f671833b31e0b3a0321a6079ccd09db843739062", "author": {"user": {"login": "ppalaga", "name": "Peter Palaga"}}, "url": "https://github.com/quarkusio/quarkus/commit/f671833b31e0b3a0321a6079ccd09db843739062", "committedDate": "2020-11-26T10:07:16Z", "message": "Workaround graal#3003 by passing IncludeResources via AutomaticFeature\ninstead of command line argument #13472"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTM5MTc2MTk0", "url": "https://github.com/quarkusio/quarkus/pull/13473#pullrequestreview-539176194", "createdAt": "2020-11-26T10:16:24Z", "commit": {"oid": "f671833b31e0b3a0321a6079ccd09db843739062"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTQwOTQ4NTEy", "url": "https://github.com/quarkusio/quarkus/pull/13473#pullrequestreview-540948512", "createdAt": "2020-11-30T14:17:38Z", "commit": {"oid": "f671833b31e0b3a0321a6079ccd09db843739062"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0zMFQxNDoxNzozOVrOH79FAQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0zMFQxNDoxNzozOVrOH79FAQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMjYyODczNw==", "bodyText": "you should use tc here to load the pattern.", "url": "https://github.com/quarkusio/quarkus/pull/13473#discussion_r532628737", "createdAt": "2020-11-30T14:17:39Z", "author": {"login": "gsmet"}, "path": "core/deployment/src/main/java/io/quarkus/deployment/steps/NativeImageAutoFeatureStep.java", "diffHunk": "@@ -201,6 +173,21 @@ public void write(String s, byte[] bytes) {\n             }\n         }\n \n+        /* Resource includes and excludes */\n+        if (!resourcePatterns.isEmpty()) {\n+            ResultHandle resourcesRegistrySingleton = overallCatch.invokeStaticMethod(IMAGE_SINGLETONS_LOOKUP,\n+                    overallCatch.loadClass(\"com.oracle.svm.core.configure.ResourcesRegistry\"));\n+            TryBlock tc = overallCatch.tryBlock();\n+            for (NativeImageResourcePatternsBuildItem resourcePatternsItem : resourcePatterns) {\n+                for (String pattern : resourcePatternsItem.getIncludePatterns()) {\n+                    tc.invokeInterfaceMethod(RESOURCES_REGISTRY_ADD_RESOURCES, resourcesRegistrySingleton,\n+                            overallCatch.load(pattern));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f671833b31e0b3a0321a6079ccd09db843739062"}, "originalPosition": 100}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "8f5c2b5d65d00e48391754debddbf845ceaae6d6", "author": {"user": {"login": "ppalaga", "name": "Peter Palaga"}}, "url": "https://github.com/quarkusio/quarkus/commit/8f5c2b5d65d00e48391754debddbf845ceaae6d6", "committedDate": "2020-11-30T14:43:34Z", "message": "Workaround graal#3003 by passing IncludeResources via AutomaticFeature\ninstead of command line argument #13472"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "f671833b31e0b3a0321a6079ccd09db843739062", "author": {"user": {"login": "ppalaga", "name": "Peter Palaga"}}, "url": "https://github.com/quarkusio/quarkus/commit/f671833b31e0b3a0321a6079ccd09db843739062", "committedDate": "2020-11-26T10:07:16Z", "message": "Workaround graal#3003 by passing IncludeResources via AutomaticFeature\ninstead of command line argument #13472"}, "afterCommit": {"oid": "8f5c2b5d65d00e48391754debddbf845ceaae6d6", "author": {"user": {"login": "ppalaga", "name": "Peter Palaga"}}, "url": "https://github.com/quarkusio/quarkus/commit/8f5c2b5d65d00e48391754debddbf845ceaae6d6", "committedDate": "2020-11-30T14:43:34Z", "message": "Workaround graal#3003 by passing IncludeResources via AutomaticFeature\ninstead of command line argument #13472"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTQxMDk0OTYy", "url": "https://github.com/quarkusio/quarkus/pull/13473#pullrequestreview-541094962", "createdAt": "2020-11-30T16:46:29Z", "commit": {"oid": "8f5c2b5d65d00e48391754debddbf845ceaae6d6"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTQxOTU5MzQx", "url": "https://github.com/quarkusio/quarkus/pull/13473#pullrequestreview-541959341", "createdAt": "2020-12-01T14:37:18Z", "commit": {"oid": "8f5c2b5d65d00e48391754debddbf845ceaae6d6"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1297, "cost": 1, "resetAt": "2021-11-01T16:37:27Z"}}}