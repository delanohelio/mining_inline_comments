{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDEzNTkxOTIw", "number": 9091, "title": "Optimize Dockerfile.native for smaller docker-image size", "bodyText": "Optimizing the native Dockerfile by combining the copy with the chown command.\nWith that in place one docker-layer can be dropped.\nThis safes 1x the size of the native executable.\nFor background read this blog-post: https://blog.mornati.net/docker-images-and-chown/\nTested the changed  Dockerfile.native with Windows10 and Ubuntu Linux, both using Docker 19.03.8.\nbefore change:\ndocker images dev/simple:1.0\nREPOSITORY          TAG                 IMAGE ID            CREATED             SIZE\ndev/simple          1.0                 db1611fb072c        28 seconds ago      164MB\n\ndocker history dev/simple:1.0\nIMAGE               CREATED             CREATED BY                                      SIZE                COMMENT\ndb1611fb072c        7 seconds ago       /bin/sh -c #(nop)  CMD [\"./application\" \"-Dq\u2026   0B                  \nf642cf578ba7        7 seconds ago       /bin/sh -c #(nop)  USER 1001                    0B                  \naa93812566e5        8 seconds ago       /bin/sh -c #(nop)  EXPOSE 8080                  0B                  \necd06c4fdc15        8 seconds ago       /bin/sh -c chmod 775 /work /work/application\u2026   29.1MB              \n00d68ba8db63        10 seconds ago      /bin/sh -c #(nop) COPY file:7f4154ec775be2da\u2026   29.1MB              \n7381d031be10        6 weeks ago         /bin/sh -c #(nop) WORKDIR /work/                0B                  \n6ce38bb5210c        2 months ago                                                        4.23kB              \n<missing>           2 months ago                                                        106MB               Imported from -\n\nafter change:\n> docker images dev/simple:1.0\nREPOSITORY          TAG                 IMAGE ID            CREATED             SIZE\ndev/simple          1.0                 97a4faa5c9bd        35 minutes ago      135MB\n\n> docker history dev/simple:1.0\nIMAGE               CREATED             CREATED BY                                      SIZE                COMMENT\n97a4faa5c9bd        32 minutes ago      /bin/sh -c #(nop)  CMD [\"./application\" \"-Dq\u2026   0B                  \n0f8a16d0616d        32 minutes ago      /bin/sh -c #(nop)  USER 1001                    0B                  \n45c1bf0e7f72        32 minutes ago      /bin/sh -c #(nop)  EXPOSE 8080                  0B                  \n6c677db83e3a        32 minutes ago      /bin/sh -c #(nop) COPY --chown=1001:rootfile\u2026   29.1MB              \n7381d031be10        6 weeks ago         /bin/sh -c #(nop) WORKDIR /work/                0B                  \n6ce38bb5210c        2 months ago                                                        4.23kB              \n<missing>           2 months ago                                                        106MB               Imported from -", "createdAt": "2020-05-05T15:33:54Z", "url": "https://github.com/quarkusio/quarkus/pull/9091", "merged": true, "mergeCommit": {"oid": "9a5c5536f8e62ee17b92396fe5556ec58b7b79a0"}, "closed": true, "closedAt": "2020-05-11T17:05:34Z", "author": {"login": "haraldatbmw"}, "timelineItems": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABceVfhlgH2gAyNDEzNTkxOTIwOmQyZjJiYzI2NTQxOTAzMmI1YjQ2NjQ2YmRiMDQxYTI4OGZkMTk0OGY=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcgSyz9gFqTQwOTM2MjEzNw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "d2f2bc265419032b5b46646bdb041a288fd1948f", "author": {"user": {"login": "haraldatbmw", "name": "Harald Reinm\u00fcller"}}, "url": "https://github.com/quarkusio/quarkus/commit/d2f2bc265419032b5b46646bdb041a288fd1948f", "committedDate": "2020-05-05T15:06:15Z", "message": "optimize dockerfile for smaller docker-image"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDA1OTEyMjk1", "url": "https://github.com/quarkusio/quarkus/pull/9091#pullrequestreview-405912295", "createdAt": "2020-05-05T15:39:43Z", "commit": {"oid": "d2f2bc265419032b5b46646bdb041a288fd1948f"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wNVQxNTozOTo0M1rOGQvbKg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wNVQxNTozOTo0M1rOGQvbKg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMDIwNzQwMg==", "bodyText": "just a quick comment: we lost the chmod in passing. It's not a problem?\n/cc @cescoffier", "url": "https://github.com/quarkusio/quarkus/pull/9091#discussion_r420207402", "createdAt": "2020-05-05T15:39:43Z", "author": {"login": "gsmet"}, "path": "devtools/platform-descriptor-json/src/main/resources/templates/dockerfile-native.ftl", "diffHunk": "@@ -16,13 +16,7 @@\n ###\n FROM registry.access.redhat.com/ubi8/ubi-minimal:8.1\n WORKDIR /work/\n-COPY ${build_dir}/*-runner /work/application\n-\n-# set up permissions for user `1001`\n-RUN chmod 775 /work /work/application \\\n-  && chown -R 1001 /work \\\n-  && chmod -R \"g+rwX\" /work \\\n-  && chown -R 1001:root /work\n+COPY --chown=1001:root ${build_dir}/*-runner /work/application", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d2f2bc265419032b5b46646bdb041a288fd1948f"}, "originalPosition": 11}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDA5MzYyMTM3", "url": "https://github.com/quarkusio/quarkus/pull/9091#pullrequestreview-409362137", "createdAt": "2020-05-11T17:05:27Z", "commit": {"oid": "d2f2bc265419032b5b46646bdb041a288fd1948f"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3507, "cost": 1, "resetAt": "2021-11-02T10:47:05Z"}}}