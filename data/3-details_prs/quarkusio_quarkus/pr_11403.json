{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDY4MzQ4MzQ3", "number": 11403, "title": "Hibernate-Envers: Support store_data_at_delete", "bodyText": "Add the config key hibernate-envers.store-data-at-delete to Quarkus' application.properties and forwards the value to hibernate-envers. Default is false (as in hibernate-envers)\nThe code is mostly \"stolen\" from hibernate-search-elasticsearch and I am new to Quarkus extensions, so I'm thankful for any feedback.\nrefs #11368", "createdAt": "2020-08-15T18:02:02Z", "url": "https://github.com/quarkusio/quarkus/pull/11403", "merged": true, "mergeCommit": {"oid": "7ab0f1e59b1240f62e58b195bfeedb9efb23556c"}, "closed": true, "closedAt": "2020-08-27T11:22:18Z", "author": {"login": "j-be"}, "timelineItems": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdBCsmUgFqTQ3MjM5NjE3NQ==", "endCursor": "Y3Vyc29yOnYyOpPPAAABdC-XqxgFqTQ3NjYxMTAwMg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDcyMzk2MTc1", "url": "https://github.com/quarkusio/quarkus/pull/11403#pullrequestreview-472396175", "createdAt": "2020-08-21T10:55:40Z", "commit": {"oid": "9297d48b958ca7dccf2d80ccd8803d2b300481f3"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yMVQxMDo1NTo0MFrOHEo12w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yMVQxMDo1ODo0MVrOHEo6fA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NDYyNTQ5OQ==", "bodyText": "It's a better pattern to inject the config in the @BuildStep method. This way, we keep track of the dependencies.\n(our code is not consistent so you might have found occurrences of this pattern)", "url": "https://github.com/quarkusio/quarkus/pull/11403#discussion_r474625499", "createdAt": "2020-08-21T10:55:40Z", "author": {"login": "gsmet"}, "path": "extensions/hibernate-envers/deployment/src/main/java/io/quarkus/hibernate/envers/deployment/QuarkusHibernateEnversProcessor.java", "diffHunk": "@@ -3,11 +3,17 @@\n import io.quarkus.deployment.Feature;\n import io.quarkus.deployment.annotations.BuildProducer;\n import io.quarkus.deployment.annotations.BuildStep;\n+import io.quarkus.deployment.annotations.ExecutionTime;\n+import io.quarkus.deployment.annotations.Record;\n import io.quarkus.deployment.builditem.FeatureBuildItem;\n import io.quarkus.deployment.builditem.nativeimage.ReflectiveClassBuildItem;\n+import io.quarkus.hibernate.envers.HibernateEnversBuildTimeConfig;\n+import io.quarkus.hibernate.envers.HibernateEnversRecorder;\n \n public final class QuarkusHibernateEnversProcessor {\n \n+    HibernateEnversBuildTimeConfig buildTimeConfig;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "9297d48b958ca7dccf2d80ccd8803d2b300481f3"}, "originalPosition": 13}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NDYyNjI4OQ==", "bodyText": "I would make it BUILD_AND_RUN_TIME_FIXED as you access it in the recorder thus at runtime.", "url": "https://github.com/quarkusio/quarkus/pull/11403#discussion_r474626289", "createdAt": "2020-08-21T10:57:40Z", "author": {"login": "gsmet"}, "path": "extensions/hibernate-envers/runtime/src/main/java/io/quarkus/hibernate/envers/HibernateEnversBuildTimeConfig.java", "diffHunk": "@@ -0,0 +1,13 @@\n+package io.quarkus.hibernate.envers;\n+\n+import io.quarkus.runtime.annotations.ConfigItem;\n+import io.quarkus.runtime.annotations.ConfigRoot;\n+\n+@ConfigRoot", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "9297d48b958ca7dccf2d80ccd8803d2b300481f3"}, "originalPosition": 6}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NDYyNjY4NA==", "bodyText": "If you make it runtime fixed, I think you should be able to just inject the config in the @Recorder class.\nWhich would avoid passing the config object through the recording mechanism.", "url": "https://github.com/quarkusio/quarkus/pull/11403#discussion_r474626684", "createdAt": "2020-08-21T10:58:41Z", "author": {"login": "gsmet"}, "path": "extensions/hibernate-envers/runtime/src/main/java/io/quarkus/hibernate/envers/HibernateEnversRecorder.java", "diffHunk": "@@ -0,0 +1,46 @@\n+package io.quarkus.hibernate.envers;\n+\n+import java.util.function.BiConsumer;\n+\n+import org.hibernate.boot.Metadata;\n+import org.hibernate.boot.spi.BootstrapContext;\n+import org.hibernate.envers.configuration.EnversSettings;\n+\n+import io.quarkus.hibernate.orm.runtime.integration.HibernateOrmIntegrationListener;\n+import io.quarkus.hibernate.orm.runtime.integration.HibernateOrmIntegrations;\n+import io.quarkus.runtime.annotations.Recorder;\n+\n+@Recorder\n+public class HibernateEnversRecorder {\n+\n+    public void registerHibernateEnversIntegration(HibernateEnversBuildTimeConfig buildTimeConfig) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "9297d48b958ca7dccf2d80ccd8803d2b300481f3"}, "originalPosition": 16}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "64980d2f66d297f52a921eb82e69c687587e04a5", "author": {"user": {"login": "j-be", "name": "Juri Berlanda"}}, "url": "https://github.com/quarkusio/quarkus/commit/64980d2f66d297f52a921eb82e69c687587e04a5", "committedDate": "2020-08-27T11:03:59Z", "message": "[Envers] Implement support for store_data_at_delete.\n\nSigned-off-by: Juri Berlanda <juriberlanda@hotmail.com>"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "df7dae6c4282f2389c7cddfe05c10a72450b35c6", "author": {"user": {"login": "j-be", "name": "Juri Berlanda"}}, "url": "https://github.com/quarkusio/quarkus/commit/df7dae6c4282f2389c7cddfe05c10a72450b35c6", "committedDate": "2020-08-23T11:09:56Z", "message": "[Envers] Inject config into BuildStep, rather then Processor class.\n\nSigned-off-by: Juri Berlanda <juriberlanda@hotmail.com>"}, "afterCommit": {"oid": "64980d2f66d297f52a921eb82e69c687587e04a5", "author": {"user": {"login": "j-be", "name": "Juri Berlanda"}}, "url": "https://github.com/quarkusio/quarkus/commit/64980d2f66d297f52a921eb82e69c687587e04a5", "committedDate": "2020-08-27T11:03:59Z", "message": "[Envers] Implement support for store_data_at_delete.\n\nSigned-off-by: Juri Berlanda <juriberlanda@hotmail.com>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDc2NjExMDAy", "url": "https://github.com/quarkusio/quarkus/pull/11403#pullrequestreview-476611002", "createdAt": "2020-08-27T11:05:03Z", "commit": {"oid": "64980d2f66d297f52a921eb82e69c687587e04a5"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 787, "cost": 1, "resetAt": "2021-11-01T16:37:27Z"}}}