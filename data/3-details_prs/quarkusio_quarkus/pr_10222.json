{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDM5MjQxMjIw", "number": 10222, "title": "Error messages when jdbc.url has not been defined", "bodyText": "As far as I understood it correctly, #10194 could be fixed by log error messages when quarkus.datasource.jdbc.url has not been defined, also when quarkus.datasource.url has been defined instead of quarkus.datasource.jdbc.url.\nThe idea behind this PR is to log an error with an explicit message for both cases.", "createdAt": "2020-06-24T14:21:38Z", "url": "https://github.com/quarkusio/quarkus/pull/10222", "merged": true, "mergeCommit": {"oid": "7c38b71e3acf9d2fc4511f2479fe555536c308b2"}, "closed": true, "closedAt": "2020-06-25T12:39:15Z", "author": {"login": "ejba"}, "timelineItems": {"totalCount": 12, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcua236ABqjM0Nzc3NjYyNzI=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcut870gFqTQzNzQ1MDA4Ng==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "92c3d720bd216f72d7a9c519a5b9690f1ff75172", "author": {"user": {"login": "ejba", "name": "Emanuel Alves"}}, "url": "https://github.com/quarkusio/quarkus/commit/92c3d720bd216f72d7a9c519a5b9690f1ff75172", "committedDate": "2020-06-24T14:14:27Z", "message": "Log error messages when quarkus.database.jdbc.url property has not been defined"}, "afterCommit": {"oid": "5613c059158474caef0d1b2016d2decb64f9ea8e", "author": {"user": {"login": "ejba", "name": "Emanuel Alves"}}, "url": "https://github.com/quarkusio/quarkus/commit/5613c059158474caef0d1b2016d2decb64f9ea8e", "committedDate": "2020-06-24T14:23:54Z", "message": "Log error messages when quarkus.database.jdbc.url property has not been defined"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "5613c059158474caef0d1b2016d2decb64f9ea8e", "author": {"user": {"login": "ejba", "name": "Emanuel Alves"}}, "url": "https://github.com/quarkusio/quarkus/commit/5613c059158474caef0d1b2016d2decb64f9ea8e", "committedDate": "2020-06-24T14:23:54Z", "message": "Log error messages when quarkus.database.jdbc.url property has not been defined"}, "afterCommit": {"oid": "163dbef1cfed022cc782116eb792c1e7e3e4a9ab", "author": {"user": {"login": "ejba", "name": "Emanuel Alves"}}, "url": "https://github.com/quarkusio/quarkus/commit/163dbef1cfed022cc782116eb792c1e7e3e4a9ab", "committedDate": "2020-06-24T16:19:43Z", "message": "Enhance error message when quarkus.database.jdbc.url property has not been defined"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDM2ODE3OTM3", "url": "https://github.com/quarkusio/quarkus/pull/10222#pullrequestreview-436817937", "createdAt": "2020-06-24T16:34:48Z", "commit": {"oid": "163dbef1cfed022cc782116eb792c1e7e3e4a9ab"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yNFQxNjozNDo0OFrOGoaJIw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yNFQxNjozODowNlrOGoaQzg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NTAyNDU0Nw==", "bodyText": "isn't it quarkus.datasource.<name>.jdbc.url?", "url": "https://github.com/quarkusio/quarkus/pull/10222#discussion_r445024547", "createdAt": "2020-06-24T16:34:48Z", "author": {"login": "gsmet"}, "path": "extensions/agroal/runtime/src/main/java/io/quarkus/agroal/runtime/DataSources.java", "diffHunk": "@@ -142,12 +150,38 @@ public AgroalDataSource doCreateDataSource(String dataSourceName) {\n         DataSourceSupport.Entry matchingSupportEntry = dataSourceSupport.entries.get(dataSourceName);\n         boolean isLegacy = matchingSupportEntry.isLegacy;\n         if (!isLegacy) {\n+            if (!dataSourceJdbcRuntimeConfig.url.isPresent() && legacyDataSourceRuntimeConfig.url.isPresent()) {\n+                String errorMessage;\n+                if (DataSourceUtil.isDefault(dataSourceName)) {\n+                    errorMessage = \"`quarkus.datasource.url` is deprecated and will be removed in a future version - it is \" +\n+                            \"recommended to switch to `quarkus.datasource.jdbc.url`. See https://quarkus.io/guides/datasource\";\n+                } else {\n+                    errorMessage = \"`quarkus.datasource.\" + dataSourceName\n+                            + \".url` is deprecated and will be removed in a future version - it is \" +\n+                            \"recommended to switch to `quarkus.datasource.\" + dataSourceName\n+                            + \".jdbc.url`. See https://quarkus.io/guides/datasource\";\n+                }\n+                throw new ConfigurationException(errorMessage);\n+            }\n+\n             if (!dataSourceJdbcRuntimeConfig.url.isPresent()) {\n-                throw new ConfigurationException(\"URL is not defined for datasource \" + dataSourceName);\n+                String errorMessage;\n+                if (DataSourceUtil.isDefault(dataSourceName)) {\n+                    errorMessage = \"`quarkus.datasource.jdbc.url` has not been defined\";\n+                } else {\n+                    errorMessage = \"`quarkus.datasource.jdbc.\" + dataSourceName + \".url` has not been defined\";", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "163dbef1cfed022cc782116eb792c1e7e3e4a9ab"}, "originalPosition": 39}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NTAyNDcwMg==", "bodyText": "Please avoid reformatting this.", "url": "https://github.com/quarkusio/quarkus/pull/10222#discussion_r445024702", "createdAt": "2020-06-24T16:35:04Z", "author": {"login": "gsmet"}, "path": "extensions/agroal/runtime/src/main/java/io/quarkus/agroal/runtime/DataSources.java", "diffHunk": "@@ -202,7 +236,8 @@ public AgroalDataSource doCreateDataSource(String dataSourceName) {\n         // Explicit reference to bypass reflection need of the ServiceLoader used by AgroalDataSource#from\n         AgroalDataSourceConfiguration agroalConfiguration = dataSourceConfiguration.get();\n         AgroalDataSource dataSource = new io.agroal.pool.DataSource(agroalConfiguration,\n-                new AgroalEventLoggingListener(dataSourceName));\n+                new AgroalEventLoggingListener(\n+                        dataSourceName));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "163dbef1cfed022cc782116eb792c1e7e3e4a9ab"}, "originalPosition": 62}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NTAyNTAzOA==", "bodyText": "I would avoid the backticks in log messages.", "url": "https://github.com/quarkusio/quarkus/pull/10222#discussion_r445025038", "createdAt": "2020-06-24T16:35:38Z", "author": {"login": "gsmet"}, "path": "extensions/agroal/runtime/src/main/java/io/quarkus/agroal/runtime/DataSources.java", "diffHunk": "@@ -142,12 +150,38 @@ public AgroalDataSource doCreateDataSource(String dataSourceName) {\n         DataSourceSupport.Entry matchingSupportEntry = dataSourceSupport.entries.get(dataSourceName);\n         boolean isLegacy = matchingSupportEntry.isLegacy;\n         if (!isLegacy) {\n+            if (!dataSourceJdbcRuntimeConfig.url.isPresent() && legacyDataSourceRuntimeConfig.url.isPresent()) {\n+                String errorMessage;\n+                if (DataSourceUtil.isDefault(dataSourceName)) {\n+                    errorMessage = \"`quarkus.datasource.url` is deprecated and will be removed in a future version - it is \" +\n+                            \"recommended to switch to `quarkus.datasource.jdbc.url`. See https://quarkus.io/guides/datasource\";\n+                } else {\n+                    errorMessage = \"`quarkus.datasource.\" + dataSourceName\n+                            + \".url` is deprecated and will be removed in a future version - it is \" +\n+                            \"recommended to switch to `quarkus.datasource.\" + dataSourceName\n+                            + \".jdbc.url`. See https://quarkus.io/guides/datasource\";\n+                }\n+                throw new ConfigurationException(errorMessage);\n+            }\n+\n             if (!dataSourceJdbcRuntimeConfig.url.isPresent()) {\n-                throw new ConfigurationException(\"URL is not defined for datasource \" + dataSourceName);\n+                String errorMessage;\n+                if (DataSourceUtil.isDefault(dataSourceName)) {\n+                    errorMessage = \"`quarkus.datasource.jdbc.url` has not been defined\";\n+                } else {\n+                    errorMessage = \"`quarkus.datasource.jdbc.\" + dataSourceName + \".url` has not been defined\";\n+                }\n+                throw new ConfigurationException(errorMessage);\n             }\n         } else {\n             if (!legacyDataSourceRuntimeConfig.url.isPresent()) {\n-                throw new ConfigurationException(\"URL is not defined for datasource \" + dataSourceName);\n+                String errorMessage;\n+                if (DataSourceUtil.isDefault(dataSourceName)) {\n+                    errorMessage = \"`quarkus.datasource.url` has not been defined\";\n+                } else {\n+                    errorMessage = \"`quarkus.datasource.\" + dataSourceName + \".url` has not been defined\";", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "163dbef1cfed022cc782116eb792c1e7e3e4a9ab"}, "originalPosition": 50}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NTAyNTMwNw==", "bodyText": "I would get rid of these constants, there's no value for them IMHO.", "url": "https://github.com/quarkusio/quarkus/pull/10222#discussion_r445025307", "createdAt": "2020-06-24T16:36:04Z", "author": {"login": "gsmet"}, "path": "extensions/agroal/runtime/src/main/java/io/quarkus/agroal/runtime/DataSources.java", "diffHunk": "@@ -64,6 +64,14 @@\n public class DataSources {\n \n     private static final Logger log = Logger.getLogger(DataSources.class.getName());\n+    public static final String DEPRECATED_URL_PROPERTY_NAME_ERROR_MESSAGE_FORMAT = \"`quarkus.datasource.%s.url` is deprecated and will be removed in a future version - it is \"\n+            +\n+            \"recommended to switch to `quarkus.datasource.%s.jdbc.url`. See https://quarkus.io/guides/datasource\";\n+    public static final String DEPRECATED_URL_PROPERTY_ERROR_MESSAGE = \"`quarkus.datasource.url` is deprecated and will be removed in a future version - it is \"\n+            +\n+            \"recommended to switch to `quarkus.datasource.jdbc.url`. See https://quarkus.io/guides/datasource\";\n+    public static final String DATASOURCE_JDBC_URL_HAS_NOT_BEEN_DEFINED = \"`quarkus.datasource.jdbc.url` has not been defined\";\n+    public static final String DATASOURCE_JDBC_S_URL_HAS_NOT_BEEN_DEFINED_MESSAGE_FORMAT = \"`quarkus.datasource.jdbc.%s.url` has not been defined\";", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "163dbef1cfed022cc782116eb792c1e7e3e4a9ab"}, "originalPosition": 11}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NTAyNjUxMA==", "bodyText": "I would have had something like:\nif (!dataSourceJdbcRuntimeConfig.url.isPresent()) {\n    if (!legacyDataSourceRuntimeConfig.url.isPresent()) {\n        // no legacy JDBC URL either so proceed with the standard message\n    } else {\n        // the user provided a legacy JDBC URL, provide an explicit error message\n    }\n}", "url": "https://github.com/quarkusio/quarkus/pull/10222#discussion_r445026510", "createdAt": "2020-06-24T16:38:06Z", "author": {"login": "gsmet"}, "path": "extensions/agroal/runtime/src/main/java/io/quarkus/agroal/runtime/DataSources.java", "diffHunk": "@@ -142,12 +150,38 @@ public AgroalDataSource doCreateDataSource(String dataSourceName) {\n         DataSourceSupport.Entry matchingSupportEntry = dataSourceSupport.entries.get(dataSourceName);\n         boolean isLegacy = matchingSupportEntry.isLegacy;\n         if (!isLegacy) {\n+            if (!dataSourceJdbcRuntimeConfig.url.isPresent() && legacyDataSourceRuntimeConfig.url.isPresent()) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "163dbef1cfed022cc782116eb792c1e7e3e4a9ab"}, "originalPosition": 19}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "163dbef1cfed022cc782116eb792c1e7e3e4a9ab", "author": {"user": {"login": "ejba", "name": "Emanuel Alves"}}, "url": "https://github.com/quarkusio/quarkus/commit/163dbef1cfed022cc782116eb792c1e7e3e4a9ab", "committedDate": "2020-06-24T16:19:43Z", "message": "Enhance error message when quarkus.database.jdbc.url property has not been defined"}, "afterCommit": {"oid": "8f0b28e5c1fded41a0adef4ce0f243db65af9386", "author": {"user": {"login": "ejba", "name": "Emanuel Alves"}}, "url": "https://github.com/quarkusio/quarkus/commit/8f0b28e5c1fded41a0adef4ce0f243db65af9386", "committedDate": "2020-06-24T16:47:51Z", "message": "Enhance error message when quarkus.database.jdbc.url property has not been defined"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "8f0b28e5c1fded41a0adef4ce0f243db65af9386", "author": {"user": {"login": "ejba", "name": "Emanuel Alves"}}, "url": "https://github.com/quarkusio/quarkus/commit/8f0b28e5c1fded41a0adef4ce0f243db65af9386", "committedDate": "2020-06-24T16:47:51Z", "message": "Enhance error message when quarkus.database.jdbc.url property has not been defined"}, "afterCommit": {"oid": "d4ba95a2f76f6315661e15812a725203130eb1c3", "author": {"user": {"login": "ejba", "name": "Emanuel Alves"}}, "url": "https://github.com/quarkusio/quarkus/commit/d4ba95a2f76f6315661e15812a725203130eb1c3", "committedDate": "2020-06-24T16:50:46Z", "message": "Enhance error message when quarkus.database.jdbc.url property has not been defined"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "d4ba95a2f76f6315661e15812a725203130eb1c3", "author": {"user": {"login": "ejba", "name": "Emanuel Alves"}}, "url": "https://github.com/quarkusio/quarkus/commit/d4ba95a2f76f6315661e15812a725203130eb1c3", "committedDate": "2020-06-24T16:50:46Z", "message": "Enhance error message when quarkus.database.jdbc.url property has not been defined"}, "afterCommit": {"oid": "0f0b8da65a0dbdb89a82f37db4913316a07927d7", "author": {"user": {"login": "ejba", "name": "Emanuel Alves"}}, "url": "https://github.com/quarkusio/quarkus/commit/0f0b8da65a0dbdb89a82f37db4913316a07927d7", "committedDate": "2020-06-24T16:52:57Z", "message": "Enhance error message when quarkus.database.jdbc.url property has not been defined"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "0f0b8da65a0dbdb89a82f37db4913316a07927d7", "author": {"user": {"login": "ejba", "name": "Emanuel Alves"}}, "url": "https://github.com/quarkusio/quarkus/commit/0f0b8da65a0dbdb89a82f37db4913316a07927d7", "committedDate": "2020-06-24T16:52:57Z", "message": "Enhance error message when quarkus.database.jdbc.url property has not been defined"}, "afterCommit": {"oid": "7289c8fba44a4231c7ab5be6b9ae6b0c6d4b4801", "author": {"user": {"login": "ejba", "name": "Emanuel Alves"}}, "url": "https://github.com/quarkusio/quarkus/commit/7289c8fba44a4231c7ab5be6b9ae6b0c6d4b4801", "committedDate": "2020-06-24T17:00:04Z", "message": "Enhance error message when quarkus.database.jdbc.url property has not been defined"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "7289c8fba44a4231c7ab5be6b9ae6b0c6d4b4801", "author": {"user": {"login": "ejba", "name": "Emanuel Alves"}}, "url": "https://github.com/quarkusio/quarkus/commit/7289c8fba44a4231c7ab5be6b9ae6b0c6d4b4801", "committedDate": "2020-06-24T17:00:04Z", "message": "Enhance error message when quarkus.database.jdbc.url property has not been defined"}, "afterCommit": {"oid": "adc30732194db99f0234934b7cb1eb2d35de4dab", "author": {"user": {"login": "ejba", "name": "Emanuel Alves"}}, "url": "https://github.com/quarkusio/quarkus/commit/adc30732194db99f0234934b7cb1eb2d35de4dab", "committedDate": "2020-06-24T17:17:01Z", "message": "Enhance error message when quarkus.database.jdbc.url property has not been defined"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "20e4f3fe392150b7c79f932a99dc9de7e04f986f", "author": {"user": {"login": "ejba", "name": "Emanuel Alves"}}, "url": "https://github.com/quarkusio/quarkus/commit/20e4f3fe392150b7c79f932a99dc9de7e04f986f", "committedDate": "2020-06-25T09:11:20Z", "message": "Enhance error message when quarkus.database.jdbc.url property has not been defined"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "2e6bd5275ec3a70be5bc26c11ea9e6411bfd3dc5", "author": {"user": {"login": "gsmet", "name": "Guillaume Smet"}}, "url": "https://github.com/quarkusio/quarkus/commit/2e6bd5275ec3a70be5bc26c11ea9e6411bfd3dc5", "committedDate": "2020-06-25T09:21:39Z", "message": "Adjust the error messages a bit"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "adc30732194db99f0234934b7cb1eb2d35de4dab", "author": {"user": {"login": "ejba", "name": "Emanuel Alves"}}, "url": "https://github.com/quarkusio/quarkus/commit/adc30732194db99f0234934b7cb1eb2d35de4dab", "committedDate": "2020-06-24T17:17:01Z", "message": "Enhance error message when quarkus.database.jdbc.url property has not been defined"}, "afterCommit": {"oid": "2e6bd5275ec3a70be5bc26c11ea9e6411bfd3dc5", "author": {"user": {"login": "gsmet", "name": "Guillaume Smet"}}, "url": "https://github.com/quarkusio/quarkus/commit/2e6bd5275ec3a70be5bc26c11ea9e6411bfd3dc5", "committedDate": "2020-06-25T09:21:39Z", "message": "Adjust the error messages a bit"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDM3NDUwMDg2", "url": "https://github.com/quarkusio/quarkus/pull/10222#pullrequestreview-437450086", "createdAt": "2020-06-25T12:38:53Z", "commit": {"oid": "2e6bd5275ec3a70be5bc26c11ea9e6411bfd3dc5"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3702, "cost": 1, "resetAt": "2021-11-01T16:37:27Z"}}}