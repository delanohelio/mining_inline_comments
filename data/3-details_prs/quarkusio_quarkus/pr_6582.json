{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0MzYzNTYyNzcy", "number": 6582, "title": "Kubernetes Extension: Include openshift, knative and more in the list of supported prefixes", "bodyText": "Currently we filter out all propertiest that don't have the kubernetes prefix.\nThis means that we ignore everything but kubernetes related properties.\nThis pull request addresses that and also adds:\n\nopenshift\nknative\ndocker\ns2i\n\nto the list of supported prefixes.", "createdAt": "2020-01-16T10:14:12Z", "url": "https://github.com/quarkusio/quarkus/pull/6582", "merged": true, "mergeCommit": {"oid": "863f4ab95750400693b179f41480710ebff36d14"}, "closed": true, "closedAt": "2020-01-20T07:46:10Z", "author": {"login": "iocanel"}, "timelineItems": {"totalCount": 11, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABb63dLRgFqTM0MzgwNTk4Nw==", "endCursor": "Y3Vyc29yOnYyOpPPAAABb8HqUwgFqTM0NTEyMjI1MQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzQzODA1OTg3", "url": "https://github.com/quarkusio/quarkus/pull/6582#pullrequestreview-343805987", "createdAt": "2020-01-16T10:19:10Z", "commit": {"oid": "f8a82f151abc7630c3f0cd673365caa200f0cb29"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0xNlQxMDoxOToxMFrOFeUeBw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0xNlQxMDoxOToxMFrOFeUeBw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NzMzNjk2Nw==", "bodyText": "How about making this a Set so contains will be O(1) complexity?", "url": "https://github.com/quarkusio/quarkus/pull/6582#discussion_r367336967", "createdAt": "2020-01-16T10:19:10Z", "author": {"login": "geoand"}, "path": "extensions/kubernetes/deployment/src/main/java/io/quarkus/kubernetes/deployment/KubernetesProcessor.java", "diffHunk": "@@ -51,7 +51,8 @@\n class KubernetesProcessor {\n \n     private static final String PROPERTY_PREFIX = \"dekorate.\";\n-    private static final String ALLOWED_GENERATOR = \"kubernetes\";\n+    private static final List<String> ALLOWED_GENERATORS = Arrays.asList(\"kubernetes\", \"openshift\", \"knative\", \"docker\", \"s2i\");", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f8a82f151abc7630c3f0cd673365caa200f0cb29"}, "originalPosition": 5}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "f8a82f151abc7630c3f0cd673365caa200f0cb29", "author": {"user": {"login": "iocanel", "name": "Ioannis Canellos"}}, "url": "https://github.com/quarkusio/quarkus/commit/f8a82f151abc7630c3f0cd673365caa200f0cb29", "committedDate": "2020-01-16T10:10:11Z", "message": "test (#6580): Add integration-test to verify the properties with the\nopenshift prefix are well respected."}, "afterCommit": {"oid": "7ea34827db1d39438e8efea18e012860c7ce17d4", "author": {"user": {"login": "iocanel", "name": "Ioannis Canellos"}}, "url": "https://github.com/quarkusio/quarkus/commit/7ea34827db1d39438e8efea18e012860c7ce17d4", "committedDate": "2020-01-16T10:42:49Z", "message": "test (#6580): Add integration-test to verify the properties with the\nopenshift prefix are well respected."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzQzODU5MDk0", "url": "https://github.com/quarkusio/quarkus/pull/6582#pullrequestreview-343859094", "createdAt": "2020-01-16T11:54:19Z", "commit": {"oid": "7ea34827db1d39438e8efea18e012860c7ce17d4"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0xNlQxMTo1NDoxOVrOFeW7tw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0xNlQxMTo1NDoxOVrOFeW7tw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NzM3NzMzNQ==", "bodyText": "Just nitpicking here, but the codebase generally shies away from this syntax and uses the more verbose new HashSet(Arrays.asList())", "url": "https://github.com/quarkusio/quarkus/pull/6582#discussion_r367377335", "createdAt": "2020-01-16T11:54:19Z", "author": {"login": "geoand"}, "path": "extensions/kubernetes/deployment/src/main/java/io/quarkus/kubernetes/deployment/KubernetesProcessor.java", "diffHunk": "@@ -51,7 +51,22 @@\n class KubernetesProcessor {\n \n     private static final String PROPERTY_PREFIX = \"dekorate.\";\n-    private static final String ALLOWED_GENERATOR = \"kubernetes\";\n+    private static final Set<String> ALLOWED_GENERATORS = new HashSet<String>() {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "7ea34827db1d39438e8efea18e012860c7ce17d4"}, "originalPosition": 5}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "7ea34827db1d39438e8efea18e012860c7ce17d4", "author": {"user": {"login": "iocanel", "name": "Ioannis Canellos"}}, "url": "https://github.com/quarkusio/quarkus/commit/7ea34827db1d39438e8efea18e012860c7ce17d4", "committedDate": "2020-01-16T10:42:49Z", "message": "test (#6580): Add integration-test to verify the properties with the\nopenshift prefix are well respected."}, "afterCommit": {"oid": "392c145e910086a55511e0a932da9363ff1869a6", "author": {"user": {"login": "iocanel", "name": "Ioannis Canellos"}}, "url": "https://github.com/quarkusio/quarkus/commit/392c145e910086a55511e0a932da9363ff1869a6", "committedDate": "2020-01-16T13:14:16Z", "message": "test (#6580): Add integration-test to verify the properties with the\nopenshift prefix are well respected."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "061a02a1a23c12ff072e8927d593d6e7747d7ad1", "author": {"user": {"login": "iocanel", "name": "Ioannis Canellos"}}, "url": "https://github.com/quarkusio/quarkus/commit/061a02a1a23c12ff072e8927d593d6e7747d7ad1", "committedDate": "2020-01-16T19:17:24Z", "message": "fix (#6580) Add openshift, knative and more to the list of supported\nprefixes in the kubernetes extension."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "6bff3e11458c9fa6e761db00c3a8c11400e0cd31", "author": {"user": {"login": "iocanel", "name": "Ioannis Canellos"}}, "url": "https://github.com/quarkusio/quarkus/commit/6bff3e11458c9fa6e761db00c3a8c11400e0cd31", "committedDate": "2020-01-16T19:17:24Z", "message": "test (#6580): Add integration-test to verify the properties with the\nopenshift prefix are well respected."}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "392c145e910086a55511e0a932da9363ff1869a6", "author": {"user": {"login": "iocanel", "name": "Ioannis Canellos"}}, "url": "https://github.com/quarkusio/quarkus/commit/392c145e910086a55511e0a932da9363ff1869a6", "committedDate": "2020-01-16T13:14:16Z", "message": "test (#6580): Add integration-test to verify the properties with the\nopenshift prefix are well respected."}, "afterCommit": {"oid": "6bff3e11458c9fa6e761db00c3a8c11400e0cd31", "author": {"user": {"login": "iocanel", "name": "Ioannis Canellos"}}, "url": "https://github.com/quarkusio/quarkus/commit/6bff3e11458c9fa6e761db00c3a8c11400e0cd31", "committedDate": "2020-01-16T19:17:24Z", "message": "test (#6580): Add integration-test to verify the properties with the\nopenshift prefix are well respected."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzQ0MjIyNjQ2", "url": "https://github.com/quarkusio/quarkus/pull/6582#pullrequestreview-344222646", "createdAt": "2020-01-16T21:18:42Z", "commit": {"oid": "6bff3e11458c9fa6e761db00c3a8c11400e0cd31"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0xNlQyMToxODo0MlrOFen4Ug==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0xNlQyMToxODo0MlrOFen4Ug==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NzY1NDk5NA==", "bodyText": "Does this comment still apply?", "url": "https://github.com/quarkusio/quarkus/pull/6582#discussion_r367654994", "createdAt": "2020-01-16T21:18:42Z", "author": {"login": "geoand"}, "path": "extensions/kubernetes/deployment/src/main/java/io/quarkus/kubernetes/deployment/KubernetesProcessor.java", "diffHunk": "@@ -97,18 +99,25 @@ public void build(ApplicationInfoBuildItem applicationInfo,\n                 .collect(Collectors.toList());\n \n         Map<String, Object> configAsMap = StreamSupport.stream(config.getPropertyNames().spliterator(), false)\n-                .filter(k -> ALLOWED_GENERATOR.equals(generatorName(k)))\n+                .filter(k -> ALLOWED_GENERATORS.contains(generatorName(k)))\n                 .collect(Collectors.toMap(k -> PROPERTY_PREFIX + k, k -> config.getValue(k, String.class)));\n+\n         // this is a hack to get kubernetes.registry working because currently it's not supported as is in Dekorate", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "6bff3e11458c9fa6e761db00c3a8c11400e0cd31"}, "originalPosition": 19}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzQ0MjIyNzQy", "url": "https://github.com/quarkusio/quarkus/pull/6582#pullrequestreview-344222742", "createdAt": "2020-01-16T21:18:53Z", "commit": {"oid": "6bff3e11458c9fa6e761db00c3a8c11400e0cd31"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0xNlQyMToxODo1M1rOFen4nw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0xNlQyMToxODo1M1rOFen4nw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NzY1NTA3MQ==", "bodyText": "Same for this", "url": "https://github.com/quarkusio/quarkus/pull/6582#discussion_r367655071", "createdAt": "2020-01-16T21:18:53Z", "author": {"login": "geoand"}, "path": "extensions/kubernetes/deployment/src/main/java/io/quarkus/kubernetes/deployment/KubernetesProcessor.java", "diffHunk": "@@ -97,18 +99,25 @@ public void build(ApplicationInfoBuildItem applicationInfo,\n                 .collect(Collectors.toList());\n \n         Map<String, Object> configAsMap = StreamSupport.stream(config.getPropertyNames().spliterator(), false)\n-                .filter(k -> ALLOWED_GENERATOR.equals(generatorName(k)))\n+                .filter(k -> ALLOWED_GENERATORS.contains(generatorName(k)))\n                 .collect(Collectors.toMap(k -> PROPERTY_PREFIX + k, k -> config.getValue(k, String.class)));\n+\n         // this is a hack to get kubernetes.registry working because currently it's not supported as is in Dekorate\n-        Optional<String> kubernetesRegistry = config.getOptionalValue(ALLOWED_GENERATOR + \".registry\", String.class);\n-        if (kubernetesRegistry.isPresent()) {\n-            System.setProperty(DOCKER_REGISTRY_PROPERTY, kubernetesRegistry.get());\n-        }\n+        Optional<String> dockerRegistry = IMAGE_GENERATORS.stream()\n+                .map(g -> config.getOptionalValue(g + \".registry\", String.class))\n+                .filter(Optional::isPresent)\n+                .map(Optional::get)\n+                .findFirst();\n+\n+        dockerRegistry.ifPresent(v -> System.setProperty(DOCKER_REGISTRY_PROPERTY, v));\n+\n         // this is a hack to work around Dekorate using the default group for some of the properties", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "6bff3e11458c9fa6e761db00c3a8c11400e0cd31"}, "originalPosition": 32}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzQ0Mzk5ODI0", "url": "https://github.com/quarkusio/quarkus/pull/6582#pullrequestreview-344399824", "createdAt": "2020-01-17T07:25:14Z", "commit": {"oid": "6bff3e11458c9fa6e761db00c3a8c11400e0cd31"}, "state": "DISMISSED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzQ1MTIyMjUx", "url": "https://github.com/quarkusio/quarkus/pull/6582#pullrequestreview-345122251", "createdAt": "2020-01-20T07:45:57Z", "commit": {"oid": "6bff3e11458c9fa6e761db00c3a8c11400e0cd31"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 218, "cost": 1, "resetAt": "2021-11-01T16:37:27Z"}}}