{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDQ2NzExNzM4", "number": 10598, "title": "ArC - fix AnnotationStore", "bodyText": "AnnotationTarget was incorrectly used as a key in a Map\nresolves #10593", "createdAt": "2020-07-09T08:43:30Z", "url": "https://github.com/quarkusio/quarkus/pull/10598", "merged": true, "mergeCommit": {"oid": "39cbdd38cc9775de60d9097ac34b3db2ac20e96e"}, "closed": true, "closedAt": "2020-07-10T10:29:53Z", "author": {"login": "mkouba"}, "timelineItems": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABczMgPpAFqTQ0NTQ5MDgzOA==", "endCursor": "Y3Vyc29yOnYyOpPPAAABcze_r4ABqjM1MzI4MDU1NDQ=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDQ1NDkwODM4", "url": "https://github.com/quarkusio/quarkus/pull/10598#pullrequestreview-445490838", "createdAt": "2020-07-09T10:30:18Z", "commit": {"oid": "2f42ce973299c4420608f1f8af2a52ca8f91614d"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDQ2MDgyNzE5", "url": "https://github.com/quarkusio/quarkus/pull/10598#pullrequestreview-446082719", "createdAt": "2020-07-10T02:24:29Z", "commit": {"oid": "2f42ce973299c4420608f1f8af2a52ca8f91614d"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xMFQwMjoyNDozMFrOGvnyRA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xMFQwMjoyNDozMFrOGvnyRA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MjU4ODEwMA==", "bodyText": "Small typo \ud83d\ude09\n\n  \n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                private static IllegalArgumentException unsupportedAnnoationTarget(AnnotationTarget target) {\n          \n          \n            \n                private static IllegalArgumentException unsupportedAnnotationTarget(AnnotationTarget target) {", "url": "https://github.com/quarkusio/quarkus/pull/10598#discussion_r452588100", "createdAt": "2020-07-10T02:24:30Z", "author": {"login": "gastaldi"}, "path": "independent-projects/arc/processor/src/main/java/io/quarkus/arc/processor/AnnotationStore.java", "diffHunk": "@@ -144,4 +148,65 @@ public Transformation transform() {\n \n     }\n \n+    /**\n+     * We cannot use annotation target directly as a key in a Map. Only {@link MethodInfo} overrides equals/hashCode.\n+     */\n+    static final class AnnotationTargetKey {\n+\n+        final AnnotationTarget target;\n+\n+        public AnnotationTargetKey(AnnotationTarget target) {\n+            this.target = target;\n+        }\n+\n+        @Override\n+        public boolean equals(Object obj) {\n+            if (this == obj) {\n+                return true;\n+            }\n+            if (obj == null) {\n+                return false;\n+            }\n+            if (getClass() != obj.getClass()) {\n+                return false;\n+            }\n+            AnnotationTargetKey other = (AnnotationTargetKey) obj;\n+            if (target.kind() != other.target.kind()) {\n+                return false;\n+            }\n+            switch (target.kind()) {\n+                case METHOD:\n+                    return target.asMethod().equals(other.target);\n+                case FIELD:\n+                    FieldInfo field = target.asField();\n+                    FieldInfo otherField = other.target.asField();\n+                    return Objects.equals(field.name(), otherField.name())\n+                            && Objects.equals(field.declaringClass().name(), otherField.declaringClass().name());\n+                case CLASS:\n+                    return target.asClass().name().equals(other.target.asClass().name());\n+                default:\n+                    throw unsupportedAnnoationTarget(target);\n+            }\n+        }\n+\n+        @Override\n+        public int hashCode() {\n+            switch (target.kind()) {\n+                case METHOD:\n+                    return target.asMethod().hashCode();\n+                case FIELD:\n+                    return Objects.hash(target.asField().name(), target.asField().declaringClass().name());\n+                case CLASS:\n+                    return target.asClass().name().hashCode();\n+                default:\n+                    throw unsupportedAnnoationTarget(target);\n+            }\n+        }\n+\n+    }\n+\n+    private static IllegalArgumentException unsupportedAnnoationTarget(AnnotationTarget target) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "2f42ce973299c4420608f1f8af2a52ca8f91614d"}, "originalPosition": 105}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "7f33d1e36f77889484b597efada770bcd23c7e01", "author": {"user": {"login": "mkouba", "name": "Martin Kouba"}}, "url": "https://github.com/quarkusio/quarkus/commit/7f33d1e36f77889484b597efada770bcd23c7e01", "committedDate": "2020-07-10T08:02:45Z", "message": "ArC - fix AnnotationStore\n\n- AnnotationTarget was incorrectly used as a key in a Map\n- resolves #10593"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "2f42ce973299c4420608f1f8af2a52ca8f91614d", "author": {"user": {"login": "mkouba", "name": "Martin Kouba"}}, "url": "https://github.com/quarkusio/quarkus/commit/2f42ce973299c4420608f1f8af2a52ca8f91614d", "committedDate": "2020-07-09T08:42:03Z", "message": "ArC - fix AnnotationStore\n\n- AnnotationTarget was incorrectly used as a key in a Map\n- resolves #10593"}, "afterCommit": {"oid": "7f33d1e36f77889484b597efada770bcd23c7e01", "author": {"user": {"login": "mkouba", "name": "Martin Kouba"}}, "url": "https://github.com/quarkusio/quarkus/commit/7f33d1e36f77889484b597efada770bcd23c7e01", "committedDate": "2020-07-10T08:02:45Z", "message": "ArC - fix AnnotationStore\n\n- AnnotationTarget was incorrectly used as a key in a Map\n- resolves #10593"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3468, "cost": 1, "resetAt": "2021-11-01T16:37:27Z"}}}