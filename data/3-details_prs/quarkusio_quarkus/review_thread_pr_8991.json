{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDExNzg5ODA2", "number": 8991, "reviewThreads": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wNVQwNjoxNzo1MFrOD5RDMQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wNlQwNDowMDozNlrOD5qSMA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjYxMzc0NzY5OnYy", "diffSide": "RIGHT", "path": "extensions/vertx-http/runtime/src/main/java/io/quarkus/vertx/http/runtime/security/MtlsAuthenticationMechanism.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wNVQwNjoxNzo1MFrOGQbvNw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wNVQwNjoxNzo1MFrOGQbvNw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxOTg4NDg1NQ==", "bodyText": "This should just return an empty identity, it is still possible for the user to authenticate via another mechanism.", "url": "https://github.com/quarkusio/quarkus/pull/8991#discussion_r419884855", "createdAt": "2020-05-05T06:17:50Z", "author": {"login": "stuartwdouglas"}, "path": "extensions/vertx-http/runtime/src/main/java/io/quarkus/vertx/http/runtime/security/MtlsAuthenticationMechanism.java", "diffHunk": "@@ -0,0 +1,81 @@\n+/*\n+ * JBoss, Home of Professional Open Source.\n+ * Copyright 2014 Red Hat, Inc., and individual contributors\n+ * as indicated by the @author tags.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ *  Unless required by applicable law or agreed to in writing, software\n+ *  distributed under the License is distributed on an \"AS IS\" BASIS,\n+ *  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ *  See the License for the specific language governing permissions and\n+ *  limitations under the License.\n+ */\n+package io.quarkus.vertx.http.runtime.security;\n+\n+import java.security.cert.Certificate;\n+import java.security.cert.X509Certificate;\n+import java.util.Collections;\n+import java.util.Optional;\n+import java.util.Set;\n+\n+import javax.net.ssl.SSLPeerUnverifiedException;\n+\n+import io.netty.handler.codec.http.HttpResponseStatus;\n+import io.quarkus.security.credential.CertificateCredential;\n+import io.quarkus.security.identity.IdentityProviderManager;\n+import io.quarkus.security.identity.SecurityIdentity;\n+import io.quarkus.security.identity.request.AuthenticationRequest;\n+import io.quarkus.security.identity.request.CertificateAuthenticationRequest;\n+import io.smallrye.mutiny.Uni;\n+import io.vertx.core.http.HttpServerRequest;\n+import io.vertx.ext.web.RoutingContext;\n+\n+/**\n+ * The authentication handler responsible for mTLS client authentication\n+ */\n+public class MtlsAuthenticationMechanism implements HttpAuthenticationMechanism {\n+\n+    @Override\n+    public Uni<SecurityIdentity> authenticate(RoutingContext context,\n+            IdentityProviderManager identityProviderManager) {\n+        HttpServerRequest request = context.request();\n+\n+        if (!request.isSSL()) {\n+            // we don't handle insecure requests\n+            return Uni.createFrom().failure(new AuthenticationCompletionException());", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "75f17cf5aa233c8b85a40533f119f4f97114c99b"}, "originalPosition": 50}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjYxMzc0OTAzOnYy", "diffSide": "RIGHT", "path": "extensions/vertx-http/runtime/src/main/java/io/quarkus/vertx/http/runtime/security/MtlsAuthenticationMechanism.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wNVQwNjoxODozM1rOGQbwGQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wNVQwNjoxODozM1rOGQbwGQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxOTg4NTA4MQ==", "bodyText": "Uni now has a better API for this (createFrom().empty() I think).", "url": "https://github.com/quarkusio/quarkus/pull/8991#discussion_r419885081", "createdAt": "2020-05-05T06:18:33Z", "author": {"login": "stuartwdouglas"}, "path": "extensions/vertx-http/runtime/src/main/java/io/quarkus/vertx/http/runtime/security/MtlsAuthenticationMechanism.java", "diffHunk": "@@ -0,0 +1,81 @@\n+/*\n+ * JBoss, Home of Professional Open Source.\n+ * Copyright 2014 Red Hat, Inc., and individual contributors\n+ * as indicated by the @author tags.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ *  Unless required by applicable law or agreed to in writing, software\n+ *  distributed under the License is distributed on an \"AS IS\" BASIS,\n+ *  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ *  See the License for the specific language governing permissions and\n+ *  limitations under the License.\n+ */\n+package io.quarkus.vertx.http.runtime.security;\n+\n+import java.security.cert.Certificate;\n+import java.security.cert.X509Certificate;\n+import java.util.Collections;\n+import java.util.Optional;\n+import java.util.Set;\n+\n+import javax.net.ssl.SSLPeerUnverifiedException;\n+\n+import io.netty.handler.codec.http.HttpResponseStatus;\n+import io.quarkus.security.credential.CertificateCredential;\n+import io.quarkus.security.identity.IdentityProviderManager;\n+import io.quarkus.security.identity.SecurityIdentity;\n+import io.quarkus.security.identity.request.AuthenticationRequest;\n+import io.quarkus.security.identity.request.CertificateAuthenticationRequest;\n+import io.smallrye.mutiny.Uni;\n+import io.vertx.core.http.HttpServerRequest;\n+import io.vertx.ext.web.RoutingContext;\n+\n+/**\n+ * The authentication handler responsible for mTLS client authentication\n+ */\n+public class MtlsAuthenticationMechanism implements HttpAuthenticationMechanism {\n+\n+    @Override\n+    public Uni<SecurityIdentity> authenticate(RoutingContext context,\n+            IdentityProviderManager identityProviderManager) {\n+        HttpServerRequest request = context.request();\n+\n+        if (!request.isSSL()) {\n+            // we don't handle insecure requests\n+            return Uni.createFrom().failure(new AuthenticationCompletionException());\n+        }\n+\n+        Certificate certificate;\n+\n+        try {\n+            certificate = request.sslSession().getPeerCertificates()[0];\n+        } catch (SSLPeerUnverifiedException e) {\n+            return Uni.createFrom().optional(Optional.empty());", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "75f17cf5aa233c8b85a40533f119f4f97114c99b"}, "originalPosition": 58}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjYxNzg4MjA4OnYy", "diffSide": "RIGHT", "path": "bom/runtime/pom.xml", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wNlQwNDowMDozNlrOGRDSyA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wNlQwNDowMDozNlrOGRDSyA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMDUzMjkzNg==", "bodyText": "I have released this.", "url": "https://github.com/quarkusio/quarkus/pull/8991#discussion_r420532936", "createdAt": "2020-05-06T04:00:36Z", "author": {"login": "stuartwdouglas"}, "path": "bom/runtime/pom.xml", "diffHunk": "@@ -183,7 +183,7 @@\n         <mockito.version>3.3.3</mockito.version>\n         <jna.version>5.3.1</jna.version>\n         <antlr.version>4.7.2</antlr.version>\n-        <quarkus-security.version>1.1.1.Final</quarkus-security.version>\n+        <quarkus-security.version>1.1.2.Final-SNAPSHOT</quarkus-security.version>", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "75f17cf5aa233c8b85a40533f119f4f97114c99b"}, "originalPosition": 5}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3338, "cost": 1, "resetAt": "2021-11-13T14:23:39Z"}}}