{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDAzNjU1MTc0", "number": 8581, "title": "fix Jaeger metrics initialization", "bodyText": "Creation of the correct MetricsFactory was moved from runtime\nto build time, which also means that it's created during native\nimage compilation. Therefore, the MicroProfile Metrics API and\nSmallRye Metrics are not required to be present at runtime.\nWhich, in the end, means that native image compilation no longer\nfails when the quarkus-smallrye-opentracing extension is present\nbut quarkus-smallrye-metrics is not.\nResolves #8578.", "createdAt": "2020-04-15T09:48:46Z", "url": "https://github.com/quarkusio/quarkus/pull/8581", "merged": true, "mergeCommit": {"oid": "fe07f6ed61c561cc4f0548d98bd430542f03818d"}, "closed": true, "closedAt": "2020-04-15T15:18:42Z", "author": {"login": "Ladicek"}, "timelineItems": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcX1EkdAFqTM5MzYyNjgwOQ==", "endCursor": "Y3Vyc29yOnYyOpPPAAABcX25QOgFqTM5MzcwODIzNw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzkzNjI2ODA5", "url": "https://github.com/quarkusio/quarkus/pull/8581#pullrequestreview-393626809", "createdAt": "2020-04-15T09:56:12Z", "commit": {"oid": "33243e8241106e0f3f42d2cc79cf91a4e290f730"}, "state": "DISMISSED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xNVQwOTo1NjoxM1rOGFycXw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xNVQwOTo1NjoxM1rOGFycXw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwODcyMjUyNw==", "bodyText": "I would keep passing the boolean and initialize the class in the recorder. I think it would work the same and be a bit less confusing.\nThe recorder method wouldn't be called so the class wouldn't be accessible either.\n(Just guessing, you would need to try)", "url": "https://github.com/quarkusio/quarkus/pull/8581#discussion_r408722527", "createdAt": "2020-04-15T09:56:13Z", "author": {"login": "gsmet"}, "path": "extensions/jaeger/deployment/src/main/java/io/quarkus/jaeger/deployment/JaegerProcessor.java", "diffHunk": "@@ -29,8 +32,11 @@ void setupTracer(JaegerDeploymentRecorder jdr, JaegerBuildTimeConfig buildTimeCo\n \n         if (buildTimeConfig.enabled) {\n             boolean metricsEnabled = capabilities.isCapabilityPresent(Capabilities.METRICS);\n+            MetricsFactory metricsFactory = metricsEnabled\n+                    ? new QuarkusJaegerMetricsFactory()\n+                    : new NoopMetricsFactory();\n \n-            jdr.registerTracer(jaeger, appConfig, metricsEnabled);\n+            jdr.registerTracer(jaeger, appConfig, metricsFactory);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "33243e8241106e0f3f42d2cc79cf91a4e290f730"}, "originalPosition": 26}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "4bab9db1a03a07e558614a6ca7e969650953404c", "author": {"user": {"login": "Ladicek", "name": "Ladislav Thon"}}, "url": "https://github.com/quarkusio/quarkus/commit/4bab9db1a03a07e558614a6ca7e969650953404c", "committedDate": "2020-04-15T11:53:45Z", "message": "fix Jaeger metrics initialization\n\nCreation of the correct `MetricsFactory` is moved from runtime\nto build time, which also means that it's created during native\nimage compilation. Therefore, the MicroProfile Metrics API and\nSmallRye Metrics are not required to be present at runtime.\nWhich, in the end, means that native image compilation no longer\nfails when the `quarkus-smallrye-opentracing` extension is present\nbut `quarkus-smallrye-metrics` is not."}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "33243e8241106e0f3f42d2cc79cf91a4e290f730", "author": {"user": {"login": "Ladicek", "name": "Ladislav Thon"}}, "url": "https://github.com/quarkusio/quarkus/commit/33243e8241106e0f3f42d2cc79cf91a4e290f730", "committedDate": "2020-04-15T09:42:04Z", "message": "fix Jaeger metrics initialization\n\nCreation of the correct `MetricsFactory` was moved from runtime\nto build time, which also means that it's created during native\nimage compilation. Therefore, the MicroProfile Metrics API and\nSmallRye Metrics are not required to be present at runtime.\nWhich, in the end, means that native image compilation no longer\nfails when the `quarkus-smallrye-opentracing` extension is present\nbut `quarkus-smallrye-metrics` is not."}, "afterCommit": {"oid": "4bab9db1a03a07e558614a6ca7e969650953404c", "author": {"user": {"login": "Ladicek", "name": "Ladislav Thon"}}, "url": "https://github.com/quarkusio/quarkus/commit/4bab9db1a03a07e558614a6ca7e969650953404c", "committedDate": "2020-04-15T11:53:45Z", "message": "fix Jaeger metrics initialization\n\nCreation of the correct `MetricsFactory` is moved from runtime\nto build time, which also means that it's created during native\nimage compilation. Therefore, the MicroProfile Metrics API and\nSmallRye Metrics are not required to be present at runtime.\nWhich, in the end, means that native image compilation no longer\nfails when the `quarkus-smallrye-opentracing` extension is present\nbut `quarkus-smallrye-metrics` is not."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzkzNzA4MjM3", "url": "https://github.com/quarkusio/quarkus/pull/8581#pullrequestreview-393708237", "createdAt": "2020-04-15T12:03:45Z", "commit": {"oid": "4bab9db1a03a07e558614a6ca7e969650953404c"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4590, "cost": 1, "resetAt": "2021-11-02T10:47:05Z"}}}