{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDEzNzkxNTc2", "number": 9099, "title": "Gradle dev mode test support and basic test", "bodyText": "Basic Gradle quarkusDev test\nInclude resources directories into the build classpath in dev mode\nInclude all the artifact's paths into the index if at least one of the artifact's dirs contains a marker file\n\nFixes #9090\nFixes #9137", "createdAt": "2020-05-05T22:51:31Z", "url": "https://github.com/quarkusio/quarkus/pull/9099", "merged": true, "mergeCommit": {"oid": "efa3212a62632299bca7edc7fdddad797dc4d355"}, "closed": true, "closedAt": "2020-05-11T02:45:20Z", "author": {"login": "aloubyansky"}, "timelineItems": {"totalCount": 11, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcecUoMgBqjMzMDYzMjM0MTQ=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcgDXJBgFqTQwODc5MDQ4OA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "eec9c4b93d4678c4c277558038e906e6f07f64af", "author": {"user": {"login": "aloubyansky", "name": "Alexey Loubyansky"}}, "url": "https://github.com/quarkusio/quarkus/commit/eec9c4b93d4678c4c277558038e906e6f07f64af", "committedDate": "2020-05-05T22:46:24Z", "message": "* Basic Gradle quarkusDev test\n* Include resources directories into the build classpath in dev mode\n* Include all the artifact's paths into the index if at least one of the artifact's dirs contains a marker file"}, "afterCommit": {"oid": "563c4c43c34fd37fd8bc12515a5e0f43285c5690", "author": {"user": {"login": "aloubyansky", "name": "Alexey Loubyansky"}}, "url": "https://github.com/quarkusio/quarkus/commit/563c4c43c34fd37fd8bc12515a5e0f43285c5690", "committedDate": "2020-05-05T23:03:20Z", "message": "* Basic Gradle quarkusDev test\n* Include resources directories into the build classpath in dev mode\n* Include all the artifact's paths into the index if at least one of the artifact's dirs contains a marker file"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "563c4c43c34fd37fd8bc12515a5e0f43285c5690", "author": {"user": {"login": "aloubyansky", "name": "Alexey Loubyansky"}}, "url": "https://github.com/quarkusio/quarkus/commit/563c4c43c34fd37fd8bc12515a5e0f43285c5690", "committedDate": "2020-05-05T23:03:20Z", "message": "* Basic Gradle quarkusDev test\n* Include resources directories into the build classpath in dev mode\n* Include all the artifact's paths into the index if at least one of the artifact's dirs contains a marker file"}, "afterCommit": {"oid": "47e4959f3ae48a5c374260b84635d8d2ddbe3faa", "author": {"user": {"login": "aloubyansky", "name": "Alexey Loubyansky"}}, "url": "https://github.com/quarkusio/quarkus/commit/47e4959f3ae48a5c374260b84635d8d2ddbe3faa", "committedDate": "2020-05-06T09:22:09Z", "message": "* Basic Gradle quarkusDev test\n* Include resources directories into the build classpath in dev mode\n* Include all the artifact's paths into the index if at least one of the artifact's dirs contains a marker file"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDA2NDU0Mjgy", "url": "https://github.com/quarkusio/quarkus/pull/9099#pullrequestreview-406454282", "createdAt": "2020-05-06T09:42:59Z", "commit": {"oid": "563c4c43c34fd37fd8bc12515a5e0f43285c5690"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wNlQwOTo0MzoxNlrOGRLbKA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wNlQwOTo0MzoxNlrOGRLbKA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMDY2NjE1Mg==", "bodyText": "This may need adjustment. Previously it used to look for the markers in the deployment classloader, which includes more resources than the list of the deployment deps the resolver returns.", "url": "https://github.com/quarkusio/quarkus/pull/9099#discussion_r420666152", "createdAt": "2020-05-06T09:43:16Z", "author": {"login": "aloubyansky"}, "path": "core/deployment/src/main/java/io/quarkus/deployment/index/ApplicationArchiveBuildStep.java", "diffHunk": "@@ -171,47 +169,41 @@ ApplicationArchivesBuildItem build(\n         return ret;\n     }\n \n-    private static Collection<? extends Path> getMarkerFilePaths(ClassLoader classLoader, Set<String> applicationArchiveFiles,\n-            ArchiveRootBuildItem root)\n+    private static void addMarkerFilePaths(Set<String> applicationArchiveFiles,\n+            ArchiveRootBuildItem root, CurateOutcomeBuildItem curateOutcomeBuildItem, Set<Path> depsToIndex)\n             throws IOException {\n-        List<Path> ret = new ArrayList<>();\n-        for (String file : applicationArchiveFiles) {\n-            Enumeration<URL> e = classLoader.getResources(file);\n-            while (e.hasMoreElements()) {\n-                final URL url = e.nextElement();\n-                final Path path = urlToPath(url, file);\n-                if (!root.isExcludedFromIndexing(path)) {\n-                    ret.add(path);\n+        for (AppDependency dep : curateOutcomeBuildItem.getEffectiveModel().getFullDeploymentDeps()) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "47e4959f3ae48a5c374260b84635d8d2ddbe3faa"}, "originalPosition": 121}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "47e4959f3ae48a5c374260b84635d8d2ddbe3faa", "author": {"user": {"login": "aloubyansky", "name": "Alexey Loubyansky"}}, "url": "https://github.com/quarkusio/quarkus/commit/47e4959f3ae48a5c374260b84635d8d2ddbe3faa", "committedDate": "2020-05-06T09:22:09Z", "message": "* Basic Gradle quarkusDev test\n* Include resources directories into the build classpath in dev mode\n* Include all the artifact's paths into the index if at least one of the artifact's dirs contains a marker file"}, "afterCommit": {"oid": "d344774ca87ff830f3ae7f610aee9410eb83019c", "author": {"user": {"login": "aloubyansky", "name": "Alexey Loubyansky"}}, "url": "https://github.com/quarkusio/quarkus/commit/d344774ca87ff830f3ae7f610aee9410eb83019c", "committedDate": "2020-05-06T10:35:35Z", "message": "* Basic Gradle quarkusDev test\n* Include resources directories into the build classpath in dev mode\n* Include all the artifact's paths into the index if at least one of the artifact's dirs contains a marker file"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "d344774ca87ff830f3ae7f610aee9410eb83019c", "author": {"user": {"login": "aloubyansky", "name": "Alexey Loubyansky"}}, "url": "https://github.com/quarkusio/quarkus/commit/d344774ca87ff830f3ae7f610aee9410eb83019c", "committedDate": "2020-05-06T10:35:35Z", "message": "* Basic Gradle quarkusDev test\n* Include resources directories into the build classpath in dev mode\n* Include all the artifact's paths into the index if at least one of the artifact's dirs contains a marker file"}, "afterCommit": {"oid": "3bb0ec868858504d5640c5e13e136c9704550c60", "author": {"user": {"login": "aloubyansky", "name": "Alexey Loubyansky"}}, "url": "https://github.com/quarkusio/quarkus/commit/3bb0ec868858504d5640c5e13e136c9704550c60", "committedDate": "2020-05-06T11:38:30Z", "message": "* Basic Gradle quarkusDev test\n* Include resources directories into the build classpath in dev mode\n* Include all the artifact's paths into the index if at least one of the artifact's dirs contains a marker file"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "3bb0ec868858504d5640c5e13e136c9704550c60", "author": {"user": {"login": "aloubyansky", "name": "Alexey Loubyansky"}}, "url": "https://github.com/quarkusio/quarkus/commit/3bb0ec868858504d5640c5e13e136c9704550c60", "committedDate": "2020-05-06T11:38:30Z", "message": "* Basic Gradle quarkusDev test\n* Include resources directories into the build classpath in dev mode\n* Include all the artifact's paths into the index if at least one of the artifact's dirs contains a marker file"}, "afterCommit": {"oid": "e914ab0cf753ecee7129636c33fdbbe13897be57", "author": {"user": {"login": "aloubyansky", "name": "Alexey Loubyansky"}}, "url": "https://github.com/quarkusio/quarkus/commit/e914ab0cf753ecee7129636c33fdbbe13897be57", "committedDate": "2020-05-07T15:09:08Z", "message": "* Basic Gradle quarkusDev test\n* Include resources directories into the build classpath in dev mode\n* Include all the artifact's paths into the index if at least one of the artifact's dirs contains a marker file"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "e914ab0cf753ecee7129636c33fdbbe13897be57", "author": {"user": {"login": "aloubyansky", "name": "Alexey Loubyansky"}}, "url": "https://github.com/quarkusio/quarkus/commit/e914ab0cf753ecee7129636c33fdbbe13897be57", "committedDate": "2020-05-07T15:09:08Z", "message": "* Basic Gradle quarkusDev test\n* Include resources directories into the build classpath in dev mode\n* Include all the artifact's paths into the index if at least one of the artifact's dirs contains a marker file"}, "afterCommit": {"oid": "37edb11ee7db9539d5ec36ff0f2ef98f32a3d528", "author": {"user": {"login": "aloubyansky", "name": "Alexey Loubyansky"}}, "url": "https://github.com/quarkusio/quarkus/commit/37edb11ee7db9539d5ec36ff0f2ef98f32a3d528", "committedDate": "2020-05-07T22:59:25Z", "message": "trying something for windows"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDA4MDgyMTgz", "url": "https://github.com/quarkusio/quarkus/pull/9099#pullrequestreview-408082183", "createdAt": "2020-05-08T08:22:25Z", "commit": {"oid": "37edb11ee7db9539d5ec36ff0f2ef98f32a3d528"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wOFQwODoyMjoyNVrOGSdrfg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wOFQwODoyMjoyNVrOGSdrfg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMjAxMzgyMg==", "bodyText": "Yea, this needs to be user deps, not deployment deps.", "url": "https://github.com/quarkusio/quarkus/pull/9099#discussion_r422013822", "createdAt": "2020-05-08T08:22:25Z", "author": {"login": "stuartwdouglas"}, "path": "core/deployment/src/main/java/io/quarkus/deployment/index/ApplicationArchiveBuildStep.java", "diffHunk": "@@ -171,47 +169,41 @@ ApplicationArchivesBuildItem build(\n         return ret;\n     }\n \n-    private static Collection<? extends Path> getMarkerFilePaths(ClassLoader classLoader, Set<String> applicationArchiveFiles,\n-            ArchiveRootBuildItem root)\n+    private static void addMarkerFilePaths(Set<String> applicationArchiveFiles,\n+            ArchiveRootBuildItem root, CurateOutcomeBuildItem curateOutcomeBuildItem, Set<Path> depsToIndex)\n             throws IOException {\n-        List<Path> ret = new ArrayList<>();\n-        for (String file : applicationArchiveFiles) {\n-            Enumeration<URL> e = classLoader.getResources(file);\n-            while (e.hasMoreElements()) {\n-                final URL url = e.nextElement();\n-                final Path path = urlToPath(url, file);\n-                if (!root.isExcludedFromIndexing(path)) {\n-                    ret.add(path);\n+        for (AppDependency dep : curateOutcomeBuildItem.getEffectiveModel().getFullDeploymentDeps()) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMDY2NjE1Mg=="}, "originalCommit": {"oid": "47e4959f3ae48a5c374260b84635d8d2ddbe3faa"}, "originalPosition": 121}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "638b22b3b8edc3755e3dd8ad67d508bda4097a90", "author": {"user": {"login": "aloubyansky", "name": "Alexey Loubyansky"}}, "url": "https://github.com/quarkusio/quarkus/commit/638b22b3b8edc3755e3dd8ad67d508bda4097a90", "committedDate": "2020-05-08T09:26:13Z", "message": "* Basic Gradle quarkusDev test\n* Include resources directories into the build classpath in dev mode\n* Include all the artifact's paths into the index if at least one of the artifact's dirs contains a marker file"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "37edb11ee7db9539d5ec36ff0f2ef98f32a3d528", "author": {"user": {"login": "aloubyansky", "name": "Alexey Loubyansky"}}, "url": "https://github.com/quarkusio/quarkus/commit/37edb11ee7db9539d5ec36ff0f2ef98f32a3d528", "committedDate": "2020-05-07T22:59:25Z", "message": "trying something for windows"}, "afterCommit": {"oid": "638b22b3b8edc3755e3dd8ad67d508bda4097a90", "author": {"user": {"login": "aloubyansky", "name": "Alexey Loubyansky"}}, "url": "https://github.com/quarkusio/quarkus/commit/638b22b3b8edc3755e3dd8ad67d508bda4097a90", "committedDate": "2020-05-08T09:26:13Z", "message": "* Basic Gradle quarkusDev test\n* Include resources directories into the build classpath in dev mode\n* Include all the artifact's paths into the index if at least one of the artifact's dirs contains a marker file"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDA4NzkwNDg4", "url": "https://github.com/quarkusio/quarkus/pull/9099#pullrequestreview-408790488", "createdAt": "2020-05-10T23:06:39Z", "commit": {"oid": "638b22b3b8edc3755e3dd8ad67d508bda4097a90"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3514, "cost": 1, "resetAt": "2021-11-02T10:47:05Z"}}}