{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDE5MTcxMDAx", "number": 9390, "title": "Enable Hibernate ORM multitenancy IT on CI", "bodyText": "Fixes #9389\nThe multi-tenancy integration tests require root access to the MariaDB instance, so that it can create multiple databases to test the dybanamic DB switching ability.\nThe integration tests of these modules were not enabled so far.", "createdAt": "2020-05-17T20:43:32Z", "url": "https://github.com/quarkusio/quarkus/pull/9390", "merged": true, "mergeCommit": {"oid": "a84849805de1e6bb1b859839c0d5ad10d1ef7bde"}, "closed": true, "closedAt": "2020-05-20T18:17:26Z", "author": {"login": "Sanne"}, "timelineItems": {"totalCount": 8, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcitTBqgFqTQxNDEwNDMyNg==", "endCursor": "Y3Vyc29yOnYyOpPPAAABcjNKurgFqTQxNTU5Mzc5NQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDE0MTA0MzI2", "url": "https://github.com/quarkusio/quarkus/pull/9390#pullrequestreview-414104326", "createdAt": "2020-05-19T05:06:00Z", "commit": {"oid": "e432971fb158ef6eea6f987c18c04f1e9a976330"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xOVQwNTowNjowMVrOGXP_lw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xOVQwNTowNjowMVrOGXP_lw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNzAzMjQ3MQ==", "bodyText": "Are you sure you want to do this? It could introduce a race condition, because multiple parallel requests will use the same object. I think this is not thread safe.", "url": "https://github.com/quarkusio/quarkus/pull/9390#discussion_r427032471", "createdAt": "2020-05-19T05:06:01Z", "author": {"login": "michael-schnell"}, "path": "extensions/hibernate-orm/runtime/src/main/java/io/quarkus/hibernate/orm/runtime/tenant/HibernateMultiTenantConnectionProvider.java", "diffHunk": "@@ -33,12 +33,14 @@ protected ConnectionProvider getAnyConnectionProvider() {\n     }\n \n     @Override\n-    protected ConnectionProvider selectConnectionProvider(String tenantIdentifier) {\n+    protected ConnectionProvider selectConnectionProvider(final String tenantIdentifier) {\n         LOG.debugv(\"selectConnectionProvider({0})\", tenantIdentifier);\n \n         ConnectionProvider provider = providerMap.get(tenantIdentifier);\n         if (provider == null) {\n-            return providerMap.computeIfAbsent(tenantIdentifier, tid -> resolveConnectionProvider(tid));\n+            final ConnectionProvider connectionProvider = resolveConnectionProvider(tenantIdentifier);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e432971fb158ef6eea6f987c18c04f1e9a976330"}, "originalPosition": 20}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "7c65431f03c6b8df203a038c4d0a7b1a4cf6958f", "author": {"user": {"login": "Sanne", "name": "Sanne Grinovero"}}, "url": "https://github.com/quarkusio/quarkus/commit/7c65431f03c6b8df203a038c4d0a7b1a4cf6958f", "committedDate": "2020-05-20T16:17:22Z", "message": "Minor polishing of the Hibernate Multitenancy support code and tests"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "cc6f4d5b62072a16750e50a26f10aaf701987c96", "author": {"user": {"login": "Sanne", "name": "Sanne Grinovero"}}, "url": "https://github.com/quarkusio/quarkus/commit/cc6f4d5b62072a16750e50a26f10aaf701987c96", "committedDate": "2020-05-20T16:17:22Z", "message": "Reconfigure MariaDB in CI actions for multi-DB tests"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "bdeab9d1d72e37bf1edcd302606d66603cc93f4e", "author": {"user": {"login": "Sanne", "name": "Sanne Grinovero"}}, "url": "https://github.com/quarkusio/quarkus/commit/bdeab9d1d72e37bf1edcd302606d66603cc93f4e", "committedDate": "2020-05-20T16:17:22Z", "message": "Introduce a 'mariadb.base_url' variable for multitenancy tests"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "78548098d539ec23e1ce36bfa878dadd41c217cd", "author": {"user": {"login": "Sanne", "name": "Sanne Grinovero"}}, "url": "https://github.com/quarkusio/quarkus/commit/78548098d539ec23e1ce36bfa878dadd41c217cd", "committedDate": "2020-05-20T16:17:22Z", "message": "Add podman instructions to the jpa-mariadb tests as well"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "32019289725aa008570f560174a94582247444c2", "author": {"user": {"login": "Sanne", "name": "Sanne Grinovero"}}, "url": "https://github.com/quarkusio/quarkus/commit/32019289725aa008570f560174a94582247444c2", "committedDate": "2020-05-20T16:17:22Z", "message": "Flyway migrations for Multitenancy IT needs to be more resilient"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "b0fa53a8d4f63b9b116992024e65ec2ab4f4d618", "author": {"user": {"login": "Sanne", "name": "Sanne Grinovero"}}, "url": "https://github.com/quarkusio/quarkus/commit/b0fa53a8d4f63b9b116992024e65ec2ab4f4d618", "committedDate": "2020-05-18T12:14:46Z", "message": "Flyway migrations for Multitenancy IT needs to be more resilient"}, "afterCommit": {"oid": "32019289725aa008570f560174a94582247444c2", "author": {"user": {"login": "Sanne", "name": "Sanne Grinovero"}}, "url": "https://github.com/quarkusio/quarkus/commit/32019289725aa008570f560174a94582247444c2", "committedDate": "2020-05-20T16:17:22Z", "message": "Flyway migrations for Multitenancy IT needs to be more resilient"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDE1NTkzNzk1", "url": "https://github.com/quarkusio/quarkus/pull/9390#pullrequestreview-415593795", "createdAt": "2020-05-20T18:13:55Z", "commit": {"oid": "32019289725aa008570f560174a94582247444c2"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3286, "cost": 1, "resetAt": "2021-11-02T10:47:05Z"}}}