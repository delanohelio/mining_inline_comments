{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDg5MDAxMTc5", "number": 12179, "title": "Ability to start test resources in parallel (concurrently)", "bodyText": "Feature #12056", "createdAt": "2020-09-18T00:39:25Z", "url": "https://github.com/quarkusio/quarkus/pull/12179", "merged": true, "mergeCommit": {"oid": "949da104b7916fb83fe3c15ba1c98977e14a16ee"}, "closed": true, "closedAt": "2021-01-19T09:26:40Z", "author": {"login": "Nunalves"}, "timelineItems": {"totalCount": 11, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdJ7A0lgFqTQ5MTA4NDEyNg==", "endCursor": "Y3Vyc29yOnYyOpPPAAABdxn3lUAFqTU3MTA1MDIxMw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDkxMDg0MTI2", "url": "https://github.com/quarkusio/quarkus/pull/12179#pullrequestreview-491084126", "createdAt": "2020-09-18T01:06:01Z", "commit": {"oid": "b4282979056c2819bcf98e428ff948f7631cb6da"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xOFQwMTowNjowMVrOHT6dww==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xOFQwMTowNzoxNlrOHT6fLA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MDY0Mjg4Mw==", "bodyText": "This needs to be shutdown in a finally block", "url": "https://github.com/quarkusio/quarkus/pull/12179#discussion_r490642883", "createdAt": "2020-09-18T01:06:01Z", "author": {"login": "stuartwdouglas"}, "path": "test-framework/common/src/main/java/io/quarkus/test/common/TestResourceManager.java", "diffHunk": "@@ -46,17 +64,41 @@ public void init() {\n \n     public Map<String, String> start() {\n         started = true;\n-        Map<String, String> ret = new HashMap<>();\n-        for (TestResourceEntry entry : testResourceEntries) {\n-            try {\n-                Map<String, String> start = entry.getTestResource().start();\n-                if (start != null) {\n-                    ret.putAll(start);\n+        Map<String, String> ret = new ConcurrentHashMap<>();\n+\n+        ExecutorService executor = newExecutor();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b4282979056c2819bcf98e428ff948f7631cb6da"}, "originalPosition": 60}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MDY0MzI0NA==", "bodyText": "I would just use a fixed pool sized to the number of tasks", "url": "https://github.com/quarkusio/quarkus/pull/12179#discussion_r490643244", "createdAt": "2020-09-18T01:07:16Z", "author": {"login": "stuartwdouglas"}, "path": "test-framework/common/src/main/java/io/quarkus/test/common/TestResourceManager.java", "diffHunk": "@@ -69,8 +111,22 @@ public void init() {\n         return ret;\n     }\n \n+    private void waitForAllFutures(List<Future> startFutures) {\n+        for (Future future : startFutures) {\n+            try {\n+                future.get();\n+            } catch (CancellationException | InterruptedException | ExecutionException e) {\n+                throw new RuntimeException(\"Error waiting for test resource future to finish.\", e);\n+            }\n+        }\n+    }\n+\n+    private ExecutorService newExecutor() {\n+        return Executors.newWorkStealingPool();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b4282979056c2819bcf98e428ff948f7631cb6da"}, "originalPosition": 114}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDk1Nzc2NjEw", "url": "https://github.com/quarkusio/quarkus/pull/12179#pullrequestreview-495776610", "createdAt": "2020-09-24T17:03:31Z", "commit": {"oid": "e91983958f32725d57bdb2adef6e39b6e94d6aea"}, "state": "COMMENTED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "57a86f3b6ef3b21cd56a3cf565a12a398376d19c", "author": {"user": {"login": "Nunalves", "name": "Nuno Alves"}}, "url": "https://github.com/quarkusio/quarkus/commit/57a86f3b6ef3b21cd56a3cf565a12a398376d19c", "committedDate": "2020-09-27T21:34:26Z", "message": "Add docs"}, "afterCommit": {"oid": "85279b1487aed7d2447f0f9189441e582195fef8", "author": {"user": {"login": "Nunalves", "name": "Nuno Alves"}}, "url": "https://github.com/quarkusio/quarkus/commit/85279b1487aed7d2447f0f9189441e582195fef8", "committedDate": "2021-01-11T22:18:22Z", "message": "Add docs"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "2a188672985a6dc0e184aa46d483c8ee77833405", "author": {"user": {"login": "Nunalves", "name": "Nuno Alves"}}, "url": "https://github.com/quarkusio/quarkus/commit/2a188672985a6dc0e184aa46d483c8ee77833405", "committedDate": "2021-01-17T20:44:09Z", "message": "Ability to start test resources in parallel (concurrently)"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "db47e7bda74f66ace7ed508bf80f94d3f8a00c06", "author": {"user": {"login": "Nunalves", "name": "Nuno Alves"}}, "url": "https://github.com/quarkusio/quarkus/commit/db47e7bda74f66ace7ed508bf80f94d3f8a00c06", "committedDate": "2021-01-17T20:44:09Z", "message": "Apply code review suggestions"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a8710c903c9d6ec149599b1cd9afc11261f7e78b", "author": {"user": {"login": "Nunalves", "name": "Nuno Alves"}}, "url": "https://github.com/quarkusio/quarkus/commit/a8710c903c9d6ec149599b1cd9afc11261f7e78b", "committedDate": "2021-01-17T20:44:09Z", "message": "fix bad commit"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ae62989ded56cadda70d2d1b73ed6edd4e7c9e8f", "author": {"user": {"login": "Nunalves", "name": "Nuno Alves"}}, "url": "https://github.com/quarkusio/quarkus/commit/ae62989ded56cadda70d2d1b73ed6edd4e7c9e8f", "committedDate": "2021-01-17T20:44:09Z", "message": "Add docs"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a11bedf6eec180ac2c31123a572904677d28ed23", "author": {"user": {"login": "famod", "name": "Falko Modler"}}, "url": "https://github.com/quarkusio/quarkus/commit/a11bedf6eec180ac2c31123a572904677d28ed23", "committedDate": "2021-01-17T20:49:55Z", "message": "Don't swallow exception in QuarkusTestExtension#getAdditionalTestResources"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "85279b1487aed7d2447f0f9189441e582195fef8", "author": {"user": {"login": "Nunalves", "name": "Nuno Alves"}}, "url": "https://github.com/quarkusio/quarkus/commit/85279b1487aed7d2447f0f9189441e582195fef8", "committedDate": "2021-01-11T22:18:22Z", "message": "Add docs"}, "afterCommit": {"oid": "a11bedf6eec180ac2c31123a572904677d28ed23", "author": {"user": {"login": "famod", "name": "Falko Modler"}}, "url": "https://github.com/quarkusio/quarkus/commit/a11bedf6eec180ac2c31123a572904677d28ed23", "committedDate": "2021-01-17T20:49:55Z", "message": "Don't swallow exception in QuarkusTestExtension#getAdditionalTestResources"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "3ec965fc3cdb7b09b4384e529446a0a75718a2dd", "author": {"user": {"login": "stuartwdouglas", "name": "Stuart Douglas"}}, "url": "https://github.com/quarkusio/quarkus/commit/3ec965fc3cdb7b09b4384e529446a0a75718a2dd", "committedDate": "2021-01-17T23:00:39Z", "message": "Fix issue with test profiles"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTcxMDUwMjEz", "url": "https://github.com/quarkusio/quarkus/pull/12179#pullrequestreview-571050213", "createdAt": "2021-01-19T09:26:32Z", "commit": {"oid": "3ec965fc3cdb7b09b4384e529446a0a75718a2dd"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 528, "cost": 1, "resetAt": "2021-11-01T16:37:27Z"}}}