{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTQyODAwNzc4", "number": 13977, "title": "Reactive Connection Pools: always use TLOCAL, HealthCheck refactoring", "bodyText": "Fixes #13943\nFixes #13978\nFixes #13868\nThis was meant to only change the deafult configuration for a Reactive Pool, but the new configuration makes an existing possible timeout error more likely, so we also need to improve the errorhandling about this.\nAlso turns out the PG and MySQL health beans were almost the same, and shared the same errorhandling limitations: so unified the code. The DB2 pool health is entirely different, so added a note about this but didn't need the same refactoring.\nTurns out that for this process to run reliably it needs to be run on the vert.x context; so incorporating #13978 as well.", "createdAt": "2020-12-18T22:19:57Z", "url": "https://github.com/quarkusio/quarkus/pull/13977", "merged": true, "mergeCommit": {"oid": "a698de8f54bb63df5866842c3bc21afea75b2efa"}, "closed": true, "closedAt": "2020-12-22T18:44:17Z", "author": {"login": "Sanne"}, "timelineItems": {"totalCount": 11, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdnpyMigBqjQxMzIzMjcxODY=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdovD-QgFqTU1NzI5MDUyMw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "55f3d1d45b34c682a67968dc81ef5d5c3815c7fa", "author": {"user": {"login": "Sanne", "name": "Sanne Grinovero"}}, "url": "https://github.com/quarkusio/quarkus/commit/55f3d1d45b34c682a67968dc81ef5d5c3815c7fa", "committedDate": "2020-12-18T22:14:35Z", "message": "Refactor the Reactive Datasource Healthcheck implementations"}, "afterCommit": {"oid": "12d31adb0586132bc3990c689b6f9d7dcd00052d", "author": {"user": {"login": "Sanne", "name": "Sanne Grinovero"}}, "url": "https://github.com/quarkusio/quarkus/commit/12d31adb0586132bc3990c689b6f9d7dcd00052d", "committedDate": "2020-12-19T09:59:23Z", "message": "Refactor the Reactive Datasource Healthcheck implementations"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "12d31adb0586132bc3990c689b6f9d7dcd00052d", "author": {"user": {"login": "Sanne", "name": "Sanne Grinovero"}}, "url": "https://github.com/quarkusio/quarkus/commit/12d31adb0586132bc3990c689b6f9d7dcd00052d", "committedDate": "2020-12-19T09:59:23Z", "message": "Refactor the Reactive Datasource Healthcheck implementations"}, "afterCommit": {"oid": "f7ada06013e1c6d85eb9c3ce2e8cd86a9c94cd0f", "author": {"user": {"login": "Sanne", "name": "Sanne Grinovero"}}, "url": "https://github.com/quarkusio/quarkus/commit/f7ada06013e1c6d85eb9c3ce2e8cd86a9c94cd0f", "committedDate": "2020-12-21T15:52:16Z", "message": "Simplify possible states of Reactive ThreadLocalPool"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "93d29191b9ce39f7405de8ac87fd2a7321eddfe6", "author": {"user": {"login": "Sanne", "name": "Sanne Grinovero"}}, "url": "https://github.com/quarkusio/quarkus/commit/93d29191b9ce39f7405de8ac87fd2a7321eddfe6", "committedDate": "2020-12-22T13:41:12Z", "message": "Always use a Thread-local scoped Reactive SQL Pool"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "fecf636d4d158c691436b947d888491b5a2e9969", "author": {"user": {"login": "Sanne", "name": "Sanne Grinovero"}}, "url": "https://github.com/quarkusio/quarkus/commit/fecf636d4d158c691436b947d888491b5a2e9969", "committedDate": "2020-12-22T13:41:12Z", "message": "Refactor the Reactive Datasource Healthcheck implementations"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "5ba7d9811aa00cd197d93437ae3aec2184186c61", "author": {"user": {"login": "Sanne", "name": "Sanne Grinovero"}}, "url": "https://github.com/quarkusio/quarkus/commit/5ba7d9811aa00cd197d93437ae3aec2184186c61", "committedDate": "2020-12-22T13:41:12Z", "message": "Simplify possible states of Reactive ThreadLocalPool"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d7f3362e99ce9c8d6d5ddf610d1cb567dd4cb26f", "author": {"user": {"login": "DavideD", "name": "Davide D'Alto"}}, "url": "https://github.com/quarkusio/quarkus/commit/d7f3362e99ce9c8d6d5ddf610d1cb567dd4cb26f", "committedDate": "2020-12-22T13:41:22Z", "message": "Run the health check in a Vert.x context if found"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "f7ada06013e1c6d85eb9c3ce2e8cd86a9c94cd0f", "author": {"user": {"login": "Sanne", "name": "Sanne Grinovero"}}, "url": "https://github.com/quarkusio/quarkus/commit/f7ada06013e1c6d85eb9c3ce2e8cd86a9c94cd0f", "committedDate": "2020-12-21T15:52:16Z", "message": "Simplify possible states of Reactive ThreadLocalPool"}, "afterCommit": {"oid": "17d1ca164858c82af000d38664ec31635128433d", "author": {"user": {"login": "Sanne", "name": "Sanne Grinovero"}}, "url": "https://github.com/quarkusio/quarkus/commit/17d1ca164858c82af000d38664ec31635128433d", "committedDate": "2020-12-22T13:41:22Z", "message": "Improve warnings on lack of Vert.x context"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTU3MDk5MDc4", "url": "https://github.com/quarkusio/quarkus/pull/13977#pullrequestreview-557099078", "createdAt": "2020-12-22T14:00:58Z", "commit": {"oid": "17d1ca164858c82af000d38664ec31635128433d"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0yMlQxNDowMDo1OFrOIJ8J0Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0yMlQxNDowMDo1OFrOIJ8J0Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NzI5MzY0OQ==", "bodyText": "This is unlikely to work correctly.\n\nAre you sure about this? I think it should be possible to run this without a context. Not sure why we had that issue only for MySQL and only on CI.", "url": "https://github.com/quarkusio/quarkus/pull/13977#discussion_r547293649", "createdAt": "2020-12-22T14:00:58Z", "author": {"login": "DavideD"}, "path": "extensions/reactive-datasource/runtime/src/main/java/io/quarkus/reactive/datasource/runtime/ReactiveDatasourceHealthCheck.java", "diffHunk": "@@ -64,7 +64,7 @@ public HealthCheckResponse call() {\n                                 });\n                     });\n                 } else {\n-                    log.debug(\"Vert.x context not found for health check\");\n+                    log.warn(\"Vert.x context unavailable to perform healthcheck of reactive datasource `\" + dataSourceName + \"`. This is unlikely to work correctly.\");", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "17d1ca164858c82af000d38664ec31635128433d"}, "originalPosition": 5}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "6b33c181ab6354c2ed185e08e3506a490b0a3d98", "author": {"user": {"login": "Sanne", "name": "Sanne Grinovero"}}, "url": "https://github.com/quarkusio/quarkus/commit/6b33c181ab6354c2ed185e08e3506a490b0a3d98", "committedDate": "2020-12-22T14:14:22Z", "message": "Improve warnings on lack of Vert.x context"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "17d1ca164858c82af000d38664ec31635128433d", "author": {"user": {"login": "Sanne", "name": "Sanne Grinovero"}}, "url": "https://github.com/quarkusio/quarkus/commit/17d1ca164858c82af000d38664ec31635128433d", "committedDate": "2020-12-22T13:41:22Z", "message": "Improve warnings on lack of Vert.x context"}, "afterCommit": {"oid": "6b33c181ab6354c2ed185e08e3506a490b0a3d98", "author": {"user": {"login": "Sanne", "name": "Sanne Grinovero"}}, "url": "https://github.com/quarkusio/quarkus/commit/6b33c181ab6354c2ed185e08e3506a490b0a3d98", "committedDate": "2020-12-22T14:14:22Z", "message": "Improve warnings on lack of Vert.x context"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTU3MjkwNTIz", "url": "https://github.com/quarkusio/quarkus/pull/13977#pullrequestreview-557290523", "createdAt": "2020-12-22T18:44:05Z", "commit": {"oid": "6b33c181ab6354c2ed185e08e3506a490b0a3d98"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4229, "cost": 1, "resetAt": "2021-11-02T10:47:05Z"}}}