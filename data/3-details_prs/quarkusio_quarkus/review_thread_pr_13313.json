{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTIxNjUwMzMz", "number": 13313, "reviewThreads": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xNlQxMzoxODowNFrOE5e8xw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xNlQxMzoxODowNFrOE5e8xw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzI4NzExMzY3OnYy", "diffSide": "RIGHT", "path": "core/deployment/src/main/java/io/quarkus/deployment/pkg/steps/JarResultBuildStep.java", "isResolved": false, "comments": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xNlQxMzoxODowNFrOHz-UAw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xNlQxNDoxNToyNFrOH0AlMg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNDI2MDM1NQ==", "bodyText": "Yeah, that was my question. I also wonder if we should index the files in META-INF/ (I'm not sure if we should index recursively or not) and if we don't do it recursively META-INF/services/?\nThat would cover this use case too.", "url": "https://github.com/quarkusio/quarkus/pull/13313#discussion_r524260355", "createdAt": "2020-11-16T13:18:04Z", "author": {"login": "gsmet"}, "path": "core/deployment/src/main/java/io/quarkus/deployment/pkg/steps/JarResultBuildStep.java", "diffHunk": "@@ -551,9 +553,26 @@ private JarBuildItem buildThinJar(CurateOutcomeBuildItem curateOutcomeBuildItem,\n                 jars.add(path);\n             }\n         }\n+\n+        /*\n+         * There are some files like META-INF/microprofile-config.properties that usually don't exist in application\n+         * and yet are always looked up (spec compliance...) and due to the location in the jar,\n+         * the RunnerClassLoader needs to look into every jar to determine whether they exist or not.\n+         * In keeping true to the original design of the RunnerClassLoader which indexes the directory structure,\n+         * we just add a fail-fast path for files we know don't exist.\n+         *\n+         * TODO: if this gets more complex, we'll probably want a build item to carry this information instead of hard\n+         * coding it here", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "6542a037e3ed1457cf7b211ca5038930d3c828fa"}, "originalPosition": 29}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNDI2NzIxNQ==", "bodyText": "I have another draft PR exploring services, so I would prefer not to do anything with services for the time being.\nThe thing is, that even if we do index all files in META-INF, \n  \n    \n      quarkus/independent-projects/bootstrap/runner/src/main/java/io/quarkus/bootstrap/runner/RunnerClassLoader.java\n    \n    \n         Line 123\n      in\n      6542a03\n    \n    \n    \n    \n\n        \n          \n           private ClassLoadingResource[] getClassLoadingResources(String name) { \n        \n    \n  \n\n still is an obstacle.\nWhich is why I think the what I did here is the simplest thing to do for now, as we don't yet know how far we want to take this.", "url": "https://github.com/quarkusio/quarkus/pull/13313#discussion_r524267215", "createdAt": "2020-11-16T13:29:19Z", "author": {"login": "geoand"}, "path": "core/deployment/src/main/java/io/quarkus/deployment/pkg/steps/JarResultBuildStep.java", "diffHunk": "@@ -551,9 +553,26 @@ private JarBuildItem buildThinJar(CurateOutcomeBuildItem curateOutcomeBuildItem,\n                 jars.add(path);\n             }\n         }\n+\n+        /*\n+         * There are some files like META-INF/microprofile-config.properties that usually don't exist in application\n+         * and yet are always looked up (spec compliance...) and due to the location in the jar,\n+         * the RunnerClassLoader needs to look into every jar to determine whether they exist or not.\n+         * In keeping true to the original design of the RunnerClassLoader which indexes the directory structure,\n+         * we just add a fail-fast path for files we know don't exist.\n+         *\n+         * TODO: if this gets more complex, we'll probably want a build item to carry this information instead of hard\n+         * coding it here", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNDI2MDM1NQ=="}, "originalCommit": {"oid": "6542a037e3ed1457cf7b211ca5038930d3c828fa"}, "originalPosition": 29}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNDI5MzM3Nw==", "bodyText": "Yeah, that was my question. I also wonder if we should index the files in META-INF/ (I'm not sure if we should index recursively or not) and if we don't do it recursively META-INF/services/?\n\nThere are HTML/JS/CSS files in META-INF/resources which probably won't need to be indexed", "url": "https://github.com/quarkusio/quarkus/pull/13313#discussion_r524293377", "createdAt": "2020-11-16T14:09:30Z", "author": {"login": "gastaldi"}, "path": "core/deployment/src/main/java/io/quarkus/deployment/pkg/steps/JarResultBuildStep.java", "diffHunk": "@@ -551,9 +553,26 @@ private JarBuildItem buildThinJar(CurateOutcomeBuildItem curateOutcomeBuildItem,\n                 jars.add(path);\n             }\n         }\n+\n+        /*\n+         * There are some files like META-INF/microprofile-config.properties that usually don't exist in application\n+         * and yet are always looked up (spec compliance...) and due to the location in the jar,\n+         * the RunnerClassLoader needs to look into every jar to determine whether they exist or not.\n+         * In keeping true to the original design of the RunnerClassLoader which indexes the directory structure,\n+         * we just add a fail-fast path for files we know don't exist.\n+         *\n+         * TODO: if this gets more complex, we'll probably want a build item to carry this information instead of hard\n+         * coding it here", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNDI2MDM1NQ=="}, "originalCommit": {"oid": "6542a037e3ed1457cf7b211ca5038930d3c828fa"}, "originalPosition": 29}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNDI5NzUyMg==", "bodyText": "Indeed. They didn't show up in the profiling I did, but in the future we certainly should look further", "url": "https://github.com/quarkusio/quarkus/pull/13313#discussion_r524297522", "createdAt": "2020-11-16T14:15:24Z", "author": {"login": "geoand"}, "path": "core/deployment/src/main/java/io/quarkus/deployment/pkg/steps/JarResultBuildStep.java", "diffHunk": "@@ -551,9 +553,26 @@ private JarBuildItem buildThinJar(CurateOutcomeBuildItem curateOutcomeBuildItem,\n                 jars.add(path);\n             }\n         }\n+\n+        /*\n+         * There are some files like META-INF/microprofile-config.properties that usually don't exist in application\n+         * and yet are always looked up (spec compliance...) and due to the location in the jar,\n+         * the RunnerClassLoader needs to look into every jar to determine whether they exist or not.\n+         * In keeping true to the original design of the RunnerClassLoader which indexes the directory structure,\n+         * we just add a fail-fast path for files we know don't exist.\n+         *\n+         * TODO: if this gets more complex, we'll probably want a build item to carry this information instead of hard\n+         * coding it here", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNDI2MDM1NQ=="}, "originalCommit": {"oid": "6542a037e3ed1457cf7b211ca5038930d3c828fa"}, "originalPosition": 29}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3930, "cost": 1, "resetAt": "2021-11-13T14:23:39Z"}}}