{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDYzMDAzMzA0", "number": 11212, "title": "Refactor the cache key building logic", "bodyText": "This PR lays some groundwork for #8631.\nWith the programmatic caching API in mind, I refactored the cache key building logic to better isolate the code related to the annotations caching API (and also make a few things clearer).\nIt only contains one minor behavior change for the cache extension: the default cache key is no longer built more than once per cache while it was built at each call before. Everything else is strictly identical in terms of extension behavior. This can be easily checked with the many tests based on the caching annotations: nothing was changed in these tests.\nIn terms of extension API, everything is also still the same. I introduced a few new classes (which were actually inner classes before) like CompositeCacheKey for example, but these classes are located in the io.quarkus.cache.runtime package which is not part of the extension API for now. They might be moved to the API package later, in #8631.\nThe main point of attention for the code review is probably CacheInterceptor#getCacheKey which now contains all the key building logic for the annotations API while it was splitted between this same method and CacheKeyBuilder before.\nIn this PR, CaffeineCache purposely contains some code that could belong to an abstraction layer, like for example the getDefaultKey method. This will be fixed later, most probably in #8631.", "createdAt": "2020-08-04T20:53:56Z", "url": "https://github.com/quarkusio/quarkus/pull/11212", "merged": true, "mergeCommit": {"oid": "fb0fd524cb69e493dce83553c4c032ea293439ff"}, "closed": true, "closedAt": "2020-08-06T16:09:10Z", "author": {"login": "gwenneg"}, "timelineItems": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABc7tES5AH2gAyNDYzMDAzMzA0OmNjZTUzMjgwODViNjMwOThlZGJiMjNiNTk4OWVhZjk2NmJjMGRmMjU=", "endCursor": "Y3Vyc29yOnYyOpPPAAABc78qvSAFqTQ2MTc1ODcxNQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "cce5328085b63098edbb23b5989eaf966bc0df25", "author": {"user": {"login": "gwenneg", "name": "Gwenneg Lepage"}}, "url": "https://github.com/quarkusio/quarkus/commit/cce5328085b63098edbb23b5989eaf966bc0df25", "committedDate": "2020-08-04T20:58:02Z", "message": "Refactor the cache key building logic"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "94caa94e2750171a2834d21e2f909402823b2783", "author": {"user": {"login": "gwenneg", "name": "Gwenneg Lepage"}}, "url": "https://github.com/quarkusio/quarkus/commit/94caa94e2750171a2834d21e2f909402823b2783", "committedDate": "2020-08-04T20:19:50Z", "message": "Refactor the cache key building logic"}, "afterCommit": {"oid": "cce5328085b63098edbb23b5989eaf966bc0df25", "author": {"user": {"login": "gwenneg", "name": "Gwenneg Lepage"}}, "url": "https://github.com/quarkusio/quarkus/commit/cce5328085b63098edbb23b5989eaf966bc0df25", "committedDate": "2020-08-04T20:58:02Z", "message": "Refactor the cache key building logic"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDYxNzU3Njk2", "url": "https://github.com/quarkusio/quarkus/pull/11212#pullrequestreview-461757696", "createdAt": "2020-08-05T15:07:33Z", "commit": {"oid": "cce5328085b63098edbb23b5989eaf966bc0df25"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0wNVQxNTowNzozM1rOG8N_9Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0wNVQxNTowNzozM1rOG8N_9Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NTc5NzEwOQ==", "bodyText": "You could have used Objects.requireNonNull to save some typing, but that's fine \ud83d\ude09", "url": "https://github.com/quarkusio/quarkus/pull/11212#discussion_r465797109", "createdAt": "2020-08-05T15:07:33Z", "author": {"login": "gastaldi"}, "path": "extensions/cache/runtime/src/main/java/io/quarkus/cache/runtime/caffeine/CaffeineCache.java", "diffHunk": "@@ -54,6 +60,9 @@ public CaffeineCache(CaffeineCacheInfo cacheInfo, Executor executor) {\n     }\n \n     public Object get(Object key, Callable<Object> valueLoader, long lockTimeout) throws Exception {\n+        if (key == null) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "cce5328085b63098edbb23b5989eaf966bc0df25"}, "originalPosition": 26}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDYxNzU4NzE1", "url": "https://github.com/quarkusio/quarkus/pull/11212#pullrequestreview-461758715", "createdAt": "2020-08-05T15:08:36Z", "commit": {"oid": "cce5328085b63098edbb23b5989eaf966bc0df25"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 907, "cost": 1, "resetAt": "2021-11-01T16:37:27Z"}}}