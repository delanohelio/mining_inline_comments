{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0Mzg2MzExNzQw", "number": 7749, "title": "fix(#7712): S2i build no longer renames artifacts", "bodyText": "Fixes: #7712 #7766 #7740\nThis pull request changes the way that the artifact is handled during the s2i build process.\n\nThe artifact is no longer renamed.\nThe user is able to specify the target directory and or the target filename (if the s2i builder image changes the name).\nThe artifact name that is used in the manifests comes from JarBuildItem / NativeBuildItem unless the user specifies something else (see above).", "createdAt": "2020-03-10T19:03:29Z", "url": "https://github.com/quarkusio/quarkus/pull/7749", "merged": true, "mergeCommit": {"oid": "f02e1c041141832f4db950b2b3b92b743d63a433"}, "closed": true, "closedAt": "2020-03-12T17:00:04Z", "author": {"login": "iocanel"}, "timelineItems": {"totalCount": 19, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcMXWKkABqjMxMTYwNjI3MDk=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcM-pCtgFqTM3MzczMTMwOA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "34aa591130eb35b8209ab4130c604c2956b1be3f", "author": {"user": {"login": "iocanel", "name": "Ioannis Canellos"}}, "url": "https://github.com/quarkusio/quarkus/commit/34aa591130eb35b8209ab4130c604c2956b1be3f", "committedDate": "2020-03-10T18:58:34Z", "message": "fix(#7712): S2i build no longer renames artifacts"}, "afterCommit": {"oid": "8ed7832bb6a836de8fac17e4eb681a4ad84875ae", "author": {"user": {"login": "iocanel", "name": "Ioannis Canellos"}}, "url": "https://github.com/quarkusio/quarkus/commit/8ed7832bb6a836de8fac17e4eb681a4ad84875ae", "committedDate": "2020-03-10T19:05:05Z", "message": "fix(#7712): S2i build no longer renames artifacts"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "8ed7832bb6a836de8fac17e4eb681a4ad84875ae", "author": {"user": {"login": "iocanel", "name": "Ioannis Canellos"}}, "url": "https://github.com/quarkusio/quarkus/commit/8ed7832bb6a836de8fac17e4eb681a4ad84875ae", "committedDate": "2020-03-10T19:05:05Z", "message": "fix(#7712): S2i build no longer renames artifacts"}, "afterCommit": {"oid": "2a5afba54012530256689e03015d0cf0219f059e", "author": {"user": {"login": "iocanel", "name": "Ioannis Canellos"}}, "url": "https://github.com/quarkusio/quarkus/commit/2a5afba54012530256689e03015d0cf0219f059e", "committedDate": "2020-03-10T20:11:29Z", "message": "fix(#7712): S2i build no longer renames artifacts"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzcyNDk4NjAw", "url": "https://github.com/quarkusio/quarkus/pull/7749#pullrequestreview-372498600", "createdAt": "2020-03-11T06:21:12Z", "commit": {"oid": "2a5afba54012530256689e03015d0cf0219f059e"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xMVQwNjoyMToxM1rOF0qaLg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xMVQwNjoyMToxM1rOF0qaLg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MDc2NTEwMg==", "bodyText": "wait - so our own native s2i builder goes an rename to something even more different ?", "url": "https://github.com/quarkusio/quarkus/pull/7749#discussion_r390765102", "createdAt": "2020-03-11T06:21:13Z", "author": {"login": "maxandersen"}, "path": "extensions/container-image/container-image-s2i/deployment/src/main/java/io/quarkus/container/image/s2i/deployment/S2iProcessor.java", "diffHunk": "@@ -102,11 +109,30 @@ public void s2iRequirementsNative(S2iConfig s2iConfig,\n             CurateOutcomeBuildItem curateOutcomeBuildItem,\n             OutputTargetBuildItem out,\n             PackageConfig packageConfig,\n+            NativeImageBuildItem nativeImage,\n             BuildProducer<BaseImageInfoBuildItem> builderImageProducer,\n             BuildProducer<KubernetesCommandBuildItem> commandProducer) {\n \n+        boolean usingDefaultBuilder = ImageUtil.getRepository(S2iConfig.DEFAULT_BASE_NATIVE_IMAGE)\n+                .equals(ImageUtil.getRepository(s2iConfig.baseNativeImage));\n+        String outputNativeBinaryFileName = nativeImage.getPath().getFileName().toString();\n+\n+        String nativeBinaryFileName = null;\n+\n+        //The default s2i builder for native builds, renames the native binary.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "2a5afba54012530256689e03015d0cf0219f059e"}, "originalPosition": 54}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzcyNjIzMDE0", "url": "https://github.com/quarkusio/quarkus/pull/7749#pullrequestreview-372623014", "createdAt": "2020-03-11T10:11:20Z", "commit": {"oid": "2a5afba54012530256689e03015d0cf0219f059e"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzcyNjI1NDA4", "url": "https://github.com/quarkusio/quarkus/pull/7749#pullrequestreview-372625408", "createdAt": "2020-03-11T10:14:38Z", "commit": {"oid": "2a5afba54012530256689e03015d0cf0219f059e"}, "state": "COMMENTED", "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xMVQxMDoxNDozOFrOF0wpcw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xMVQxMDoxNTo0OVrOF0wr5A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MDg2NzMxNQ==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                 * This option may be used of the selected s2i image uses a fixed name for the jar.\n          \n          \n            \n                 * This option may be used if the selected s2i image uses a fixed name for the jar.", "url": "https://github.com/quarkusio/quarkus/pull/7749#discussion_r390867315", "createdAt": "2020-03-11T10:14:38Z", "author": {"login": "geoand"}, "path": "extensions/container-image/container-image-s2i/deployment/src/main/java/io/quarkus/container/image/s2i/deployment/S2iConfig.java", "diffHunk": "@@ -38,18 +40,32 @@\n     public List<String> nativeArguments;\n \n     /**\n-     * The path to where the jar is added during the assemble phase.\n+     * The directory where the jar is added during the assemble phase.\n      * This is dependant on the s2i image and should be supplied if a non default image is used.\n      */\n-    @ConfigItem(defaultValue = \"/deployments/application${quarkus.package.runner-suffix}.jar\")\n-    public String jarPath;\n+    @ConfigItem(defaultValue = \"/deployments/\")\n+    public String jarDirectory;\n \n     /**\n-     * The path to where the native binary is added during the assemble phase.\n+     * The resulting filename of the jar in the s2i image.\n+     * This option may be used of the selected s2i image uses a fixed name for the jar.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "2a5afba54012530256689e03015d0cf0219f059e"}, "originalPosition": 32}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MDg2NzcyNg==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                 * This is dependant on the s2i image and should be supplied if a non default image is used.\n          \n          \n            \n                 * This is dependant on the s2i image and should be supplied if a non-default image is used.", "url": "https://github.com/quarkusio/quarkus/pull/7749#discussion_r390867726", "createdAt": "2020-03-11T10:15:24Z", "author": {"login": "geoand"}, "path": "extensions/container-image/container-image-s2i/deployment/src/main/java/io/quarkus/container/image/s2i/deployment/S2iConfig.java", "diffHunk": "@@ -38,18 +40,32 @@\n     public List<String> nativeArguments;\n \n     /**\n-     * The path to where the jar is added during the assemble phase.\n+     * The directory where the jar is added during the assemble phase.\n      * This is dependant on the s2i image and should be supplied if a non default image is used.\n      */\n-    @ConfigItem(defaultValue = \"/deployments/application${quarkus.package.runner-suffix}.jar\")\n-    public String jarPath;\n+    @ConfigItem(defaultValue = \"/deployments/\")\n+    public String jarDirectory;\n \n     /**\n-     * The path to where the native binary is added during the assemble phase.\n+     * The resulting filename of the jar in the s2i image.\n+     * This option may be used of the selected s2i image uses a fixed name for the jar.\n+     */\n+    @ConfigItem\n+    public Optional<String> jarFileName;\n+\n+    /**\n+     * The directory where the native binary is added during the assemble phase.\n      * This is dependant on the s2i image and should be supplied if a non default image is used.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "2a5afba54012530256689e03015d0cf0219f059e"}, "originalPosition": 39}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MDg2Nzk0MA==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                 * This option may be used of the selected s2i image uses a fixed name for the native binary.\n          \n          \n            \n                 * This option may be used if the selected s2i image uses a fixed name for the native binary.", "url": "https://github.com/quarkusio/quarkus/pull/7749#discussion_r390867940", "createdAt": "2020-03-11T10:15:49Z", "author": {"login": "geoand"}, "path": "extensions/container-image/container-image-s2i/deployment/src/main/java/io/quarkus/container/image/s2i/deployment/S2iConfig.java", "diffHunk": "@@ -38,18 +40,32 @@\n     public List<String> nativeArguments;\n \n     /**\n-     * The path to where the jar is added during the assemble phase.\n+     * The directory where the jar is added during the assemble phase.\n      * This is dependant on the s2i image and should be supplied if a non default image is used.\n      */\n-    @ConfigItem(defaultValue = \"/deployments/application${quarkus.package.runner-suffix}.jar\")\n-    public String jarPath;\n+    @ConfigItem(defaultValue = \"/deployments/\")\n+    public String jarDirectory;\n \n     /**\n-     * The path to where the native binary is added during the assemble phase.\n+     * The resulting filename of the jar in the s2i image.\n+     * This option may be used of the selected s2i image uses a fixed name for the jar.\n+     */\n+    @ConfigItem\n+    public Optional<String> jarFileName;\n+\n+    /**\n+     * The directory where the native binary is added during the assemble phase.\n      * This is dependant on the s2i image and should be supplied if a non default image is used.\n      */\n-    @ConfigItem(defaultValue = \"/home/quarkus/application\")\n-    public String nativeBinaryPath;\n+    @ConfigItem(defaultValue = \"/home/quarkus/\")\n+    public String nativeBinaryDirectory;\n+\n+    /**\n+     * The resulting filename of the native binary in the s2i image.\n+     * This option may be used of the selected s2i image uses a fixed name for the native binary.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "2a5afba54012530256689e03015d0cf0219f059e"}, "originalPosition": 48}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "e781b1de40f5d00485e9b78cc5455b3f025eba21", "author": {"user": {"login": "iocanel", "name": "Ioannis Canellos"}}, "url": "https://github.com/quarkusio/quarkus/commit/e781b1de40f5d00485e9b78cc5455b3f025eba21", "committedDate": "2020-03-11T10:57:53Z", "message": "Update extensions/container-image/container-image-s2i/deployment/src/main/java/io/quarkus/container/image/s2i/deployment/S2iConfig.java\n\nCo-Authored-By: Georgios Andrianakis <geoand@gmail.com>"}, "afterCommit": {"oid": "f82472d4bee88fb0754ccb7405a36c4d89511933", "author": {"user": {"login": "iocanel", "name": "Ioannis Canellos"}}, "url": "https://github.com/quarkusio/quarkus/commit/f82472d4bee88fb0754ccb7405a36c4d89511933", "committedDate": "2020-03-11T11:04:25Z", "message": "fix(#7712): S2i build no longer renames artifacts"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzcyNjYxMTQw", "url": "https://github.com/quarkusio/quarkus/pull/7749#pullrequestreview-372661140", "createdAt": "2020-03-11T11:05:45Z", "commit": {"oid": "f82472d4bee88fb0754ccb7405a36c4d89511933"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzczMzYwODQ3", "url": "https://github.com/quarkusio/quarkus/pull/7749#pullrequestreview-373360847", "createdAt": "2020-03-12T08:37:45Z", "commit": {"oid": "a3a666fc002e576443823dc64ea8b3a8848dbd3e"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xMlQwODozNzo0NVrOF1VURA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xMlQwODozNzo0NVrOF1VURA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MTQ2ODEwMA==", "bodyText": "I'm not sure if this is a good idea, purely from \"legal\" point of view. This is RHEL, after all. Too bad UBI Java isn't ready yet :-(", "url": "https://github.com/quarkusio/quarkus/pull/7749#discussion_r391468100", "createdAt": "2020-03-12T08:37:45Z", "author": {"login": "Ladicek"}, "path": "extensions/container-image/container-image-s2i/deployment/src/main/java/io/quarkus/container/image/s2i/deployment/S2iConfig.java", "diffHunk": "@@ -11,7 +11,7 @@\n @ConfigRoot(phase = ConfigPhase.BUILD_TIME)\n public class S2iConfig {\n \n-    public static final String DEFAULT_BASE_JVM_IMAGE = \"fabric8/s2i-java:2.3\";\n+    public static final String DEFAULT_BASE_JVM_IMAGE = \"registry.access.redhat.com/openjdk/openjdk-11-rhel7\";", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a3a666fc002e576443823dc64ea8b3a8848dbd3e"}, "originalPosition": 5}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzczMzY3NDQz", "url": "https://github.com/quarkusio/quarkus/pull/7749#pullrequestreview-373367443", "createdAt": "2020-03-12T08:48:43Z", "commit": {"oid": "135dc61be2b39f45039b1401ad3b822511121050"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xMlQwODo0ODo0M1rOF1VpCQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xMlQwODo0ODo0M1rOF1VpCQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MTQ3MzQxNw==", "bodyText": "There are 4 Red Hat OpenJDK images that I'm aware of (OpenJDK 8 and 11, RHEL 7 and 8), some of them being available from 2 registries (authenticated and unauthenticated).\n\nOpenJDK 8 (I'm not sure if we still support Java 8, but we probably do. Defaulting to 11 is probably good though.)\n\nRHEL 7\n\nregistry.access.redhat.com/redhat-openjdk-18/openjdk18-openshift\nregistry.redhat.io/redhat-openjdk-18/openjdk18-openshift\n\n\nRHEL 8\n\nregistry.redhat.io/openjdk/openjdk-8-rhel8 (registry.access.redhat.com variant not available)\n\n\n\n\nOpenJDK 11\n\nRHEL 7\n\nregistry.access.redhat.com/openjdk/openjdk-11-rhel7\nregistry.redhat.io/openjdk/openjdk-11-rhel7\n\n\nRHEL 8\n\nregistry.redhat.io/openjdk/openjdk-11-rhel8 (registry.access.redhat.com variant not available)\n\n\n\n\n\nThey all have different tags (as does the Fabric8 image), which should all be recognized. (That is, tag should be ignored when searching.)", "url": "https://github.com/quarkusio/quarkus/pull/7749#discussion_r391473417", "createdAt": "2020-03-12T08:48:43Z", "author": {"login": "Ladicek"}, "path": "extensions/container-image/container-image-s2i/deployment/src/main/java/io/quarkus/container/image/s2i/deployment/S2iBaseJavaImage.java", "diffHunk": "@@ -0,0 +1,64 @@\n+\n+package io.quarkus.container.image.s2i.deployment;\n+\n+import java.util.Optional;\n+\n+import io.quarkus.container.image.deployment.util.ImageUtil;\n+\n+public enum S2iBaseJavaImage {\n+\n+    FABRIC8(\"fabric8/s2i-java:2.3\", \"JAVA_MAIN_CLASS\", \"JAVA_APP_JAR\", \"JAVA_LIB_DIR\", \"JAVA_CLASSPATH\", \"JAVA_OPTIONS\"),\n+    OPENJDK(\"registry.access.redhat.com/openjdk/openjdk-11-rhel7\", \"JAVA_MAIN_CLASS\", \"JAVA_APP_JAR\", \"JAVA_LIB_DIR\",", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "135dc61be2b39f45039b1401ad3b822511121050"}, "originalPosition": 11}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "79e8ca8364ffa8c9489b152ed3474b07ae3d2030", "author": {"user": {"login": "iocanel", "name": "Ioannis Canellos"}}, "url": "https://github.com/quarkusio/quarkus/commit/79e8ca8364ffa8c9489b152ed3474b07ae3d2030", "committedDate": "2020-03-11T20:13:11Z", "message": "chore: minor s2i & kubernetes improvements"}, "afterCommit": {"oid": "223fa0bd9a57f24069cd4b60a2d549ff41eded8d", "author": {"user": {"login": "iocanel", "name": "Ioannis Canellos"}}, "url": "https://github.com/quarkusio/quarkus/commit/223fa0bd9a57f24069cd4b60a2d549ff41eded8d", "committedDate": "2020-03-12T10:02:28Z", "message": "feat: Enrich and cleanup the s2i base images"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "223fa0bd9a57f24069cd4b60a2d549ff41eded8d", "author": {"user": {"login": "iocanel", "name": "Ioannis Canellos"}}, "url": "https://github.com/quarkusio/quarkus/commit/223fa0bd9a57f24069cd4b60a2d549ff41eded8d", "committedDate": "2020-03-12T10:02:28Z", "message": "feat: Enrich and cleanup the s2i base images"}, "afterCommit": {"oid": "7e7d652e4cebf40bd51d69694b571610f5571bbe", "author": {"user": {"login": "iocanel", "name": "Ioannis Canellos"}}, "url": "https://github.com/quarkusio/quarkus/commit/7e7d652e4cebf40bd51d69694b571610f5571bbe", "committedDate": "2020-03-12T11:32:13Z", "message": "feat: Enrich and cleanup the s2i base images"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c224346e8deee3360253968cc4100ab3f0997f66", "author": {"user": {"login": "iocanel", "name": "Ioannis Canellos"}}, "url": "https://github.com/quarkusio/quarkus/commit/c224346e8deee3360253968cc4100ab3f0997f66", "committedDate": "2020-03-12T15:25:37Z", "message": "fix(#7712): S2i build no longer renames artifacts"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "0f991bd565679adb310a1e0718a18882523f2ac5", "author": {"user": {"login": "iocanel", "name": "Ioannis Canellos"}}, "url": "https://github.com/quarkusio/quarkus/commit/0f991bd565679adb310a1e0718a18882523f2ac5", "committedDate": "2020-03-12T15:25:37Z", "message": "fix: wrong value passed to working dir decorator"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "fccaaebc5bdd249213cd9464567eef12f9dad4b5", "author": {"user": {"login": "iocanel", "name": "Ioannis Canellos"}}, "url": "https://github.com/quarkusio/quarkus/commit/fccaaebc5bdd249213cd9464567eef12f9dad4b5", "committedDate": "2020-03-12T15:25:37Z", "message": "fix: Work around duplicating environment variables"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "55b9d84cffa01d4ac5b59ac4c62a02583c65edcb", "author": {"user": {"login": "iocanel", "name": "Ioannis Canellos"}}, "url": "https://github.com/quarkusio/quarkus/commit/55b9d84cffa01d4ac5b59ac4c62a02583c65edcb", "committedDate": "2020-03-12T15:25:37Z", "message": "feat: Know s2i base images now leverage env vars."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "66dd28cf8e71f859554566c7646839eacc250132", "author": {"user": {"login": "iocanel", "name": "Ioannis Canellos"}}, "url": "https://github.com/quarkusio/quarkus/commit/66dd28cf8e71f859554566c7646839eacc250132", "committedDate": "2020-03-12T15:25:37Z", "message": "chore: minor s2i & kubernetes improvements"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "7e7d652e4cebf40bd51d69694b571610f5571bbe", "author": {"user": {"login": "iocanel", "name": "Ioannis Canellos"}}, "url": "https://github.com/quarkusio/quarkus/commit/7e7d652e4cebf40bd51d69694b571610f5571bbe", "committedDate": "2020-03-12T11:32:13Z", "message": "feat: Enrich and cleanup the s2i base images"}, "afterCommit": {"oid": "66dd28cf8e71f859554566c7646839eacc250132", "author": {"user": {"login": "iocanel", "name": "Ioannis Canellos"}}, "url": "https://github.com/quarkusio/quarkus/commit/66dd28cf8e71f859554566c7646839eacc250132", "committedDate": "2020-03-12T15:25:37Z", "message": "chore: minor s2i & kubernetes improvements"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzczNzI5NDI2", "url": "https://github.com/quarkusio/quarkus/pull/7749#pullrequestreview-373729426", "createdAt": "2020-03-12T16:49:46Z", "commit": {"oid": "66dd28cf8e71f859554566c7646839eacc250132"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xMlQxNjo0OTo0NlrOF1m0iw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xMlQxNjo0OTo0NlrOF1m0iw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MTc1NDg5MQ==", "bodyText": "I wonder what happens on Windows, would this possibly generate Windows-style paths into the Kubernetes YAML? (Didn't check, just thinking aloud.)", "url": "https://github.com/quarkusio/quarkus/pull/7749#discussion_r391754891", "createdAt": "2020-03-12T16:49:46Z", "author": {"login": "Ladicek"}, "path": "extensions/container-image/container-image-s2i/deployment/src/main/java/io/quarkus/container/image/s2i/deployment/S2iProcessor.java", "diffHunk": "@@ -61,53 +65,100 @@\n import io.quarkus.kubernetes.client.deployment.KubernetesClientErrorHanlder;\n import io.quarkus.kubernetes.client.spi.KubernetesClientBuildItem;\n import io.quarkus.kubernetes.spi.KubernetesCommandBuildItem;\n+import io.quarkus.kubernetes.spi.KubernetesEnvBuildItem;\n \n public class S2iProcessor {\n \n     private static final String S2I = \"s2i\";\n-    private static final String JAR_ARTIFACT_FORMAT = \"%s%s.jar\";\n-    private static final String NATIVE_ARTIFACT_FORMAT = \"%s%s\";\n+    private static final String OPENSHIFT = \"openshift\";\n     private static final String BUILD_CONFIG_NAME = \"openshift.io/build-config.name\";\n     private static final String RUNNING = \"Running\";\n \n     private static final Logger LOG = Logger.getLogger(S2iProcessor.class);\n \n-    @BuildStep(onlyIf = { IsNormal.class, S2iBuild.class }, onlyIfNot = NativeBuild.class)\n+    @BuildStep(onlyIf = IsNormal.class, onlyIfNot = NativeBuild.class)\n     public void s2iRequirementsJvm(S2iConfig s2iConfig,\n             CurateOutcomeBuildItem curateOutcomeBuildItem,\n             OutputTargetBuildItem out,\n             PackageConfig packageConfig,\n+            JarBuildItem jarBuildItem,\n+            BuildProducer<KubernetesEnvBuildItem> envProducer,\n             BuildProducer<BaseImageInfoBuildItem> builderImageProducer,\n             BuildProducer<KubernetesCommandBuildItem> commandProducer) {\n \n         final List<AppDependency> appDeps = curateOutcomeBuildItem.getEffectiveModel().getUserDependencies();\n+        String outputJarFileName = jarBuildItem.getPath().getFileName().toString();\n         String classpath = appDeps.stream()\n-                .map(d -> Paths.get(s2iConfig.jarPath).getParent().resolve(\"lib\")\n-                        .resolve(d.getArtifact().getGroupId() + \".\" + d.getArtifact().getPath().getFileName()).toAbsolutePath()\n+                .map(d -> String.valueOf(d.getArtifact().getGroupId() + \".\" + d.getArtifact().getPath().getFileName()))\n+                .map(s -> Paths.get(s2iConfig.jarDirectory).resolve(\"lib\").resolve(s).toAbsolutePath()", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "66dd28cf8e71f859554566c7646839eacc250132"}, "originalPosition": 51}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzczNzMxMzA4", "url": "https://github.com/quarkusio/quarkus/pull/7749#pullrequestreview-373731308", "createdAt": "2020-03-12T16:52:07Z", "commit": {"oid": "66dd28cf8e71f859554566c7646839eacc250132"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3803, "cost": 1, "resetAt": "2021-11-02T10:47:05Z"}}}