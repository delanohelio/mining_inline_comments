{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDY0MDE3NDMy", "number": 11255, "reviewThreads": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0wNlQxMzozNDowMFrOEV1KGg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0wNlQxOToxMDozMFrOEV9Rvw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjkxMzI2NDkwOnYy", "diffSide": "RIGHT", "path": "independent-projects/tools/devtools-common/src/main/java/io/quarkus/devtools/project/buildfile/AbstractGradleBuildFile.java", "isResolved": true, "comments": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0wNlQxMzozNDowMFrOG8zvnQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0wNlQxMzo0NjoxOFrOG80QJA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NjQxNTUxNw==", "bodyText": "Do we really want to compare with the version?", "url": "https://github.com/quarkusio/quarkus/pull/11255#discussion_r466415517", "createdAt": "2020-08-06T13:34:00Z", "author": {"login": "gsmet"}, "path": "independent-projects/tools/devtools-common/src/main/java/io/quarkus/devtools/project/buildfile/AbstractGradleBuildFile.java", "diffHunk": "@@ -61,11 +61,30 @@ protected boolean addDependency(AppArtifactCoords coords, boolean managed) {\n     }\n \n     static boolean addDependencyInModel(Model model, AppArtifactCoords coords, boolean managed) {\n-        StringBuilder newDependency = new StringBuilder()\n-                .append(\"    implementation '\")\n-                .append(coords.getGroupId())\n-                .append(\":\")\n-                .append(coords.getArtifactId());\n+        boolean isBOM = \"pom\".equals(coords.getType());\n+        StringBuilder newDependency;\n+        if (isBOM) {\n+            // Check if BOM is not included already\n+            String resolvedPlatform = String\n+                    .format(\"%s:%s:%s\", getProperty(model, \"quarkusPlatformGroupId\"),\n+                            getProperty(model, \"quarkusPlatformArtifactId\"),\n+                            getProperty(model, \"quarkusPlatformVersion\"));\n+            String thisBOM = String.format(\"%s:%s:%s\", coords.getGroupId(), coords.getArtifactId(), coords.getVersion());", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "fdf085b03a97a5161a49b4dad47c095132b3bc85"}, "originalPosition": 17}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NjQxOTYwNA==", "bodyText": "The version will (or should) always be the same here", "url": "https://github.com/quarkusio/quarkus/pull/11255#discussion_r466419604", "createdAt": "2020-08-06T13:40:10Z", "author": {"login": "gastaldi"}, "path": "independent-projects/tools/devtools-common/src/main/java/io/quarkus/devtools/project/buildfile/AbstractGradleBuildFile.java", "diffHunk": "@@ -61,11 +61,30 @@ protected boolean addDependency(AppArtifactCoords coords, boolean managed) {\n     }\n \n     static boolean addDependencyInModel(Model model, AppArtifactCoords coords, boolean managed) {\n-        StringBuilder newDependency = new StringBuilder()\n-                .append(\"    implementation '\")\n-                .append(coords.getGroupId())\n-                .append(\":\")\n-                .append(coords.getArtifactId());\n+        boolean isBOM = \"pom\".equals(coords.getType());\n+        StringBuilder newDependency;\n+        if (isBOM) {\n+            // Check if BOM is not included already\n+            String resolvedPlatform = String\n+                    .format(\"%s:%s:%s\", getProperty(model, \"quarkusPlatformGroupId\"),\n+                            getProperty(model, \"quarkusPlatformArtifactId\"),\n+                            getProperty(model, \"quarkusPlatformVersion\"));\n+            String thisBOM = String.format(\"%s:%s:%s\", coords.getGroupId(), coords.getArtifactId(), coords.getVersion());", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NjQxNTUxNw=="}, "originalCommit": {"oid": "fdf085b03a97a5161a49b4dad47c095132b3bc85"}, "originalPosition": 17}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NjQyMDQ0Ng==", "bodyText": "@gastaldi as @gsmet pointed out, I think we should have the same bahavior as for extensions which is to skip it if it's already there whatever the version.", "url": "https://github.com/quarkusio/quarkus/pull/11255#discussion_r466420446", "createdAt": "2020-08-06T13:41:26Z", "author": {"login": "ia3andy"}, "path": "independent-projects/tools/devtools-common/src/main/java/io/quarkus/devtools/project/buildfile/AbstractGradleBuildFile.java", "diffHunk": "@@ -61,11 +61,30 @@ protected boolean addDependency(AppArtifactCoords coords, boolean managed) {\n     }\n \n     static boolean addDependencyInModel(Model model, AppArtifactCoords coords, boolean managed) {\n-        StringBuilder newDependency = new StringBuilder()\n-                .append(\"    implementation '\")\n-                .append(coords.getGroupId())\n-                .append(\":\")\n-                .append(coords.getArtifactId());\n+        boolean isBOM = \"pom\".equals(coords.getType());\n+        StringBuilder newDependency;\n+        if (isBOM) {\n+            // Check if BOM is not included already\n+            String resolvedPlatform = String\n+                    .format(\"%s:%s:%s\", getProperty(model, \"quarkusPlatformGroupId\"),\n+                            getProperty(model, \"quarkusPlatformArtifactId\"),\n+                            getProperty(model, \"quarkusPlatformVersion\"));\n+            String thisBOM = String.format(\"%s:%s:%s\", coords.getGroupId(), coords.getArtifactId(), coords.getVersion());", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NjQxNTUxNw=="}, "originalCommit": {"oid": "fdf085b03a97a5161a49b4dad47c095132b3bc85"}, "originalPosition": 17}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NjQyMzg0NA==", "bodyText": "@ia3andy although working with the model as a big String in the case of Gradle is a PITA, I think that might make sense, let's do that in a separate PR", "url": "https://github.com/quarkusio/quarkus/pull/11255#discussion_r466423844", "createdAt": "2020-08-06T13:46:18Z", "author": {"login": "gastaldi"}, "path": "independent-projects/tools/devtools-common/src/main/java/io/quarkus/devtools/project/buildfile/AbstractGradleBuildFile.java", "diffHunk": "@@ -61,11 +61,30 @@ protected boolean addDependency(AppArtifactCoords coords, boolean managed) {\n     }\n \n     static boolean addDependencyInModel(Model model, AppArtifactCoords coords, boolean managed) {\n-        StringBuilder newDependency = new StringBuilder()\n-                .append(\"    implementation '\")\n-                .append(coords.getGroupId())\n-                .append(\":\")\n-                .append(coords.getArtifactId());\n+        boolean isBOM = \"pom\".equals(coords.getType());\n+        StringBuilder newDependency;\n+        if (isBOM) {\n+            // Check if BOM is not included already\n+            String resolvedPlatform = String\n+                    .format(\"%s:%s:%s\", getProperty(model, \"quarkusPlatformGroupId\"),\n+                            getProperty(model, \"quarkusPlatformArtifactId\"),\n+                            getProperty(model, \"quarkusPlatformVersion\"));\n+            String thisBOM = String.format(\"%s:%s:%s\", coords.getGroupId(), coords.getArtifactId(), coords.getVersion());", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NjQxNTUxNw=="}, "originalCommit": {"oid": "fdf085b03a97a5161a49b4dad47c095132b3bc85"}, "originalPosition": 17}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjkxMzI3NjEzOnYy", "diffSide": "RIGHT", "path": "independent-projects/tools/devtools-common/src/main/java/io/quarkus/devtools/project/buildfile/AbstractGradleBuildFile.java", "isResolved": true, "comments": {"totalCount": 7, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0wNlQxMzozNjozOVrOG8z2kA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0wNlQxMzo1Mjo0M1rOG80h3w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NjQxNzI5Ng==", "bodyText": "It seems really weird to have the quarkus bom insertion as part of the addDependencyInModel", "url": "https://github.com/quarkusio/quarkus/pull/11255#discussion_r466417296", "createdAt": "2020-08-06T13:36:39Z", "author": {"login": "ia3andy"}, "path": "independent-projects/tools/devtools-common/src/main/java/io/quarkus/devtools/project/buildfile/AbstractGradleBuildFile.java", "diffHunk": "@@ -61,11 +61,30 @@ protected boolean addDependency(AppArtifactCoords coords, boolean managed) {\n     }\n \n     static boolean addDependencyInModel(Model model, AppArtifactCoords coords, boolean managed) {\n-        StringBuilder newDependency = new StringBuilder()\n-                .append(\"    implementation '\")\n-                .append(coords.getGroupId())\n-                .append(\":\")\n-                .append(coords.getArtifactId());\n+        boolean isBOM = \"pom\".equals(coords.getType());\n+        StringBuilder newDependency;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "fdf085b03a97a5161a49b4dad47c095132b3bc85"}, "originalPosition": 10}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NjQxODQ5NQ==", "bodyText": "Why? You can have other BOMs when using the extension registry", "url": "https://github.com/quarkusio/quarkus/pull/11255#discussion_r466418495", "createdAt": "2020-08-06T13:38:37Z", "author": {"login": "gastaldi"}, "path": "independent-projects/tools/devtools-common/src/main/java/io/quarkus/devtools/project/buildfile/AbstractGradleBuildFile.java", "diffHunk": "@@ -61,11 +61,30 @@ protected boolean addDependency(AppArtifactCoords coords, boolean managed) {\n     }\n \n     static boolean addDependencyInModel(Model model, AppArtifactCoords coords, boolean managed) {\n-        StringBuilder newDependency = new StringBuilder()\n-                .append(\"    implementation '\")\n-                .append(coords.getGroupId())\n-                .append(\":\")\n-                .append(coords.getArtifactId());\n+        boolean isBOM = \"pom\".equals(coords.getType());\n+        StringBuilder newDependency;", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NjQxNzI5Ng=="}, "originalCommit": {"oid": "fdf085b03a97a5161a49b4dad47c095132b3bc85"}, "originalPosition": 10}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NjQxOTY0Ng==", "bodyText": "aww right, I forgot about that :)", "url": "https://github.com/quarkusio/quarkus/pull/11255#discussion_r466419646", "createdAt": "2020-08-06T13:40:13Z", "author": {"login": "ia3andy"}, "path": "independent-projects/tools/devtools-common/src/main/java/io/quarkus/devtools/project/buildfile/AbstractGradleBuildFile.java", "diffHunk": "@@ -61,11 +61,30 @@ protected boolean addDependency(AppArtifactCoords coords, boolean managed) {\n     }\n \n     static boolean addDependencyInModel(Model model, AppArtifactCoords coords, boolean managed) {\n-        StringBuilder newDependency = new StringBuilder()\n-                .append(\"    implementation '\")\n-                .append(coords.getGroupId())\n-                .append(\":\")\n-                .append(coords.getArtifactId());\n+        boolean isBOM = \"pom\".equals(coords.getType());\n+        StringBuilder newDependency;", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NjQxNzI5Ng=="}, "originalCommit": {"oid": "fdf085b03a97a5161a49b4dad47c095132b3bc85"}, "originalPosition": 10}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NjQyMDM3Mg==", "bodyText": "The extension registry creates an ExtensionInstallPlan with the extensions and BOMs needed to work, which then it's up to the ExtensionManager to decide what needs to be added/changed/etc", "url": "https://github.com/quarkusio/quarkus/pull/11255#discussion_r466420372", "createdAt": "2020-08-06T13:41:20Z", "author": {"login": "gastaldi"}, "path": "independent-projects/tools/devtools-common/src/main/java/io/quarkus/devtools/project/buildfile/AbstractGradleBuildFile.java", "diffHunk": "@@ -61,11 +61,30 @@ protected boolean addDependency(AppArtifactCoords coords, boolean managed) {\n     }\n \n     static boolean addDependencyInModel(Model model, AppArtifactCoords coords, boolean managed) {\n-        StringBuilder newDependency = new StringBuilder()\n-                .append(\"    implementation '\")\n-                .append(coords.getGroupId())\n-                .append(\":\")\n-                .append(coords.getArtifactId());\n+        boolean isBOM = \"pom\".equals(coords.getType());\n+        StringBuilder newDependency;", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NjQxNzI5Ng=="}, "originalCommit": {"oid": "fdf085b03a97a5161a49b4dad47c095132b3bc85"}, "originalPosition": 10}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NjQyMzQ1MQ==", "bodyText": "@gastaldi do you use the currently installed extensions to create that plan?", "url": "https://github.com/quarkusio/quarkus/pull/11255#discussion_r466423451", "createdAt": "2020-08-06T13:45:46Z", "author": {"login": "ia3andy"}, "path": "independent-projects/tools/devtools-common/src/main/java/io/quarkus/devtools/project/buildfile/AbstractGradleBuildFile.java", "diffHunk": "@@ -61,11 +61,30 @@ protected boolean addDependency(AppArtifactCoords coords, boolean managed) {\n     }\n \n     static boolean addDependencyInModel(Model model, AppArtifactCoords coords, boolean managed) {\n-        StringBuilder newDependency = new StringBuilder()\n-                .append(\"    implementation '\")\n-                .append(coords.getGroupId())\n-                .append(\":\")\n-                .append(coords.getArtifactId());\n+        boolean isBOM = \"pom\".equals(coords.getType());\n+        StringBuilder newDependency;", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NjQxNzI5Ng=="}, "originalCommit": {"oid": "fdf085b03a97a5161a49b4dad47c095132b3bc85"}, "originalPosition": 10}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NjQyNzEwMw==", "bodyText": "No, it's up to the ExtensionManager to decide what to do with the ExtensionInstallPlan and the currently installed extensions", "url": "https://github.com/quarkusio/quarkus/pull/11255#discussion_r466427103", "createdAt": "2020-08-06T13:50:53Z", "author": {"login": "gastaldi"}, "path": "independent-projects/tools/devtools-common/src/main/java/io/quarkus/devtools/project/buildfile/AbstractGradleBuildFile.java", "diffHunk": "@@ -61,11 +61,30 @@ protected boolean addDependency(AppArtifactCoords coords, boolean managed) {\n     }\n \n     static boolean addDependencyInModel(Model model, AppArtifactCoords coords, boolean managed) {\n-        StringBuilder newDependency = new StringBuilder()\n-                .append(\"    implementation '\")\n-                .append(coords.getGroupId())\n-                .append(\":\")\n-                .append(coords.getArtifactId());\n+        boolean isBOM = \"pom\".equals(coords.getType());\n+        StringBuilder newDependency;", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NjQxNzI5Ng=="}, "originalCommit": {"oid": "fdf085b03a97a5161a49b4dad47c095132b3bc85"}, "originalPosition": 10}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NjQyODM4Mw==", "bodyText": "ok ;-) I just wanted to make sure that my other comment about the version was relevant..", "url": "https://github.com/quarkusio/quarkus/pull/11255#discussion_r466428383", "createdAt": "2020-08-06T13:52:43Z", "author": {"login": "ia3andy"}, "path": "independent-projects/tools/devtools-common/src/main/java/io/quarkus/devtools/project/buildfile/AbstractGradleBuildFile.java", "diffHunk": "@@ -61,11 +61,30 @@ protected boolean addDependency(AppArtifactCoords coords, boolean managed) {\n     }\n \n     static boolean addDependencyInModel(Model model, AppArtifactCoords coords, boolean managed) {\n-        StringBuilder newDependency = new StringBuilder()\n-                .append(\"    implementation '\")\n-                .append(coords.getGroupId())\n-                .append(\":\")\n-                .append(coords.getArtifactId());\n+        boolean isBOM = \"pom\".equals(coords.getType());\n+        StringBuilder newDependency;", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NjQxNzI5Ng=="}, "originalCommit": {"oid": "fdf085b03a97a5161a49b4dad47c095132b3bc85"}, "originalPosition": 10}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjkxNDU5NTE5OnYy", "diffSide": "RIGHT", "path": "independent-projects/tools/devtools-common/src/main/java/io/quarkus/devtools/project/buildfile/AbstractGradleBuildFile.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0wNlQxOToxMDozMFrOG9Aucw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0wNlQxOToxMDozMFrOG9Aucw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NjYyODIxMQ==", "bodyText": "It's better but works on the assumption that these properties are used. In general there could be any property or direct coordinates.", "url": "https://github.com/quarkusio/quarkus/pull/11255#discussion_r466628211", "createdAt": "2020-08-06T19:10:30Z", "author": {"login": "aloubyansky"}, "path": "independent-projects/tools/devtools-common/src/main/java/io/quarkus/devtools/project/buildfile/AbstractGradleBuildFile.java", "diffHunk": "@@ -61,11 +61,29 @@ protected boolean addDependency(AppArtifactCoords coords, boolean managed) {\n     }\n \n     static boolean addDependencyInModel(Model model, AppArtifactCoords coords, boolean managed) {\n-        StringBuilder newDependency = new StringBuilder()\n-                .append(\"    implementation '\")\n-                .append(coords.getGroupId())\n-                .append(\":\")\n-                .append(coords.getArtifactId());\n+        boolean isBOM = \"pom\".equals(coords.getType());\n+        StringBuilder newDependency;\n+        if (isBOM) {\n+            // Check if BOM is not included already\n+            String resolvedPlatform = String\n+                    .format(\"%s:%s\", getProperty(model, \"quarkusPlatformGroupId\"),\n+                            getProperty(model, \"quarkusPlatformArtifactId\"));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c869bc7111fdf1fb626ce6e9f684eb6a33d04fcc"}, "originalPosition": 24}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 703, "cost": 1, "resetAt": "2021-11-13T12:26:42Z"}}}