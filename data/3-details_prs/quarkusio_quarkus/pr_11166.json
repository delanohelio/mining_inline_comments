{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDYyMjA3MTI5", "number": 11166, "title": "Upgrade to Hibernate Search 6.0.0.Beta9 + Elasticsearch 7.8", "bodyText": "Relevant: https://in.relation.to/2020/08/03/hibernate-search-6-0-0-Beta9/", "createdAt": "2020-08-03T14:20:38Z", "url": "https://github.com/quarkusio/quarkus/pull/11166", "merged": true, "mergeCommit": {"oid": "dad0481e4b3d8a277a62460261ba5a0c55b451ea"}, "closed": true, "closedAt": "2020-08-21T10:52:38Z", "author": {"login": "yrodiere"}, "timelineItems": {"totalCount": 12, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABc7S8xWgFqTQ2MDA3NjAwMg==", "endCursor": "Y3Vyc29yOnYyOpPPAAABdBCmDYAFqTQ3MjM5NDU1MA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDYwMDc2MDAy", "url": "https://github.com/quarkusio/quarkus/pull/11166#pullrequestreview-460076002", "createdAt": "2020-08-03T14:31:00Z", "commit": {"oid": "c926b015d63fe221332a261a2ab1a4db0349ca5f"}, "state": "COMMENTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0wM1QxNDozMTowMVrOG673Lg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0wM1QxNDozMTozNlrOG674vg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NDQ1MTM3NA==", "bodyText": "Not sure I follow you here. We make the version mandatory for named backend so maybe we should just make it mandatory for everything, default backend included? And then we could keep the named backend active?", "url": "https://github.com/quarkusio/quarkus/pull/11166#discussion_r464451374", "createdAt": "2020-08-03T14:31:01Z", "author": {"login": "gsmet"}, "path": "extensions/hibernate-search-elasticsearch/deployment/src/main/java/io/quarkus/hibernate/search/elasticsearch/HibernateSearchElasticsearchProcessor.java", "diffHunk": "@@ -97,37 +97,34 @@ void setRuntimeConfig(HibernateSearchElasticsearchRecorder recorder,\n     }\n \n     private static void checkConfig(HibernateSearchElasticsearchBuildTimeConfig buildTimeConfig) {\n-        if (buildTimeConfig.additionalBackends.defaultBackend.isPresent()) {\n-            String defaultBackend = buildTimeConfig.additionalBackends.defaultBackend.get();\n-            // we have a default named backend\n-            if (buildTimeConfig.defaultBackend.version.isPresent()) {\n-                throw new ConfigurationError(\n-                        \"quarkus.hibernate-search.elasticsearch.default-backend cannot be used in conjunction with a default backend configuration.\");\n-            }\n-            if (!buildTimeConfig.additionalBackends.backends.containsKey(defaultBackend)) {\n-                throw new ConfigurationError(\n-                        \"The default backend defined does not exist: \" + defaultBackend);\n-            }\n-        } else {\n-            // we are in the default backend case\n+        if (buildTimeConfig.namedBackends.backends.isEmpty()) {\n+            // There isn't any named backend: the default backend will be used.\n+\n+            // we validate that the version is present\n             if (!buildTimeConfig.defaultBackend.version.isPresent()) {\n                 throw new ConfigurationError(\n                         \"The Elasticsearch version needs to be defined via the quarkus.hibernate-search.elasticsearch.version property.\");\n             }\n-        }\n+        } else {\n+            // There is at least one named backend: we disallow using the default backend.\n+            // Theoretically we could allow using it,\n+            // but then we would be unable to detect whether the default backend is used\n+            // (and thus absolutely needs the version to be configured)", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c926b015d63fe221332a261a2ab1a4db0349ca5f"}, "originalPosition": 30}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NDQ1MTc3NA==", "bodyText": "Given we are still experimental, I would just drop it and document it in the release notes.", "url": "https://github.com/quarkusio/quarkus/pull/11166#discussion_r464451774", "createdAt": "2020-08-03T14:31:36Z", "author": {"login": "gsmet"}, "path": "extensions/hibernate-search-elasticsearch/runtime/src/main/java/io/quarkus/hibernate/search/elasticsearch/runtime/HibernateSearchElasticsearchRuntimeConfig.java", "diffHunk": "@@ -128,9 +128,18 @@\n         /**\n          * The default configuration for the Elasticsearch indexes.\n          */\n-        @ConfigItem\n+        @ConfigItem(name = ConfigItem.PARENT)\n         ElasticsearchIndexConfig indexDefaults;\n \n+        /**\n+         * @deprecated Define index defaults directly at the backend level instead of using {@code index-defaults};\n+         *             e.g. use simply {@code quarkus.hibernate-search.elasticsearch.indexing.queue.count}\n+         *             instead of {@code quarkus.hibernate-search.elasticsearch.index-defaults.indexing.queue.count}.\n+         */\n+        @ConfigItem(name = \"index-defaults\")\n+        @Deprecated\n+        ElasticsearchIndexConfig legacyIndexDefaults;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c926b015d63fe221332a261a2ab1a4db0349ca5f"}, "originalPosition": 42}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "1bfd83f94f8a76939403201af5451fed0c4db5d5", "author": {"user": {"login": "yrodiere", "name": "Yoann Rodi\u00e8re"}}, "url": "https://github.com/quarkusio/quarkus/commit/1bfd83f94f8a76939403201af5451fed0c4db5d5", "committedDate": "2020-08-19T14:18:19Z", "message": "Upgrade to Hibernate Search 6.0.0.Beta9"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "20533c622ec52d310c6eb9ff748898be2d004d94", "author": {"user": {"login": "yrodiere", "name": "Yoann Rodi\u00e8re"}}, "url": "https://github.com/quarkusio/quarkus/commit/20533c622ec52d310c6eb9ff748898be2d004d94", "committedDate": "2020-08-19T14:18:20Z", "message": "Upgrade to Elasticsearch 7.8.0"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "1d70c61e2182c7d5bb741d65f97f5918c42d0890", "author": {"user": {"login": "yrodiere", "name": "Yoann Rodi\u00e8re"}}, "url": "https://github.com/quarkusio/quarkus/commit/1d70c61e2182c7d5bb741d65f97f5918c42d0890", "committedDate": "2020-08-19T14:18:20Z", "message": "hsearch-es: Use HSearch's native concept of default (unnamed) backend instead of defining our own"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "2c0e8ae1eb9dd85fd58806a32d98b725ee3c226c", "author": {"user": {"login": "yrodiere", "name": "Yoann Rodi\u00e8re"}}, "url": "https://github.com/quarkusio/quarkus/commit/2c0e8ae1eb9dd85fd58806a32d98b725ee3c226c", "committedDate": "2020-08-19T15:03:38Z", "message": "hsearch-es: Remove the ability to define a *named*, default backend\n\nThis feature probably wasn't used a lot by Quarkus users, since it's\nonly (potentially) useful when you have multiple backends."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "04b56b5dd80ee693f9de141b2d29480e0995e323", "author": {"user": {"login": "yrodiere", "name": "Yoann Rodi\u00e8re"}}, "url": "https://github.com/quarkusio/quarkus/commit/04b56b5dd80ee693f9de141b2d29480e0995e323", "committedDate": "2020-08-19T15:03:38Z", "message": "hsearch-es: Add missing 'final' keyword"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "4c164d866ac9edb35c24db01c0040b06b98ccb6b", "author": {"user": {"login": "yrodiere", "name": "Yoann Rodi\u00e8re"}}, "url": "https://github.com/quarkusio/quarkus/commit/4c164d866ac9edb35c24db01c0040b06b98ccb6b", "committedDate": "2020-08-19T15:03:38Z", "message": "hsearch-es: Move to HSearch's new simplified syntax for specifying default configuration for indexes"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d9071e5a4827470945664bc810d95d05d7d266f6", "author": {"user": {"login": "yrodiere", "name": "Yoann Rodi\u00e8re"}}, "url": "https://github.com/quarkusio/quarkus/commit/d9071e5a4827470945664bc810d95d05d7d266f6", "committedDate": "2020-08-19T15:03:38Z", "message": "hsearch-es: Drop the deprecated '.index-defaults.foo' syntax for specifying default configuration for indexes"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "2e6f816539f6bf5b54ea75a45cddfd585c559612", "author": {"user": {"login": "yrodiere", "name": "Yoann Rodi\u00e8re"}}, "url": "https://github.com/quarkusio/quarkus/commit/2e6f816539f6bf5b54ea75a45cddfd585c559612", "committedDate": "2020-08-19T15:05:54Z", "message": "hsearch-es: Clarify the name of some unit tests\n\nI had renamed the tests in 961d95b3b8e02c2c104f6ef2bf96d82f822580c8\nbecause I misunderstood their purpose from the comment on IndexedEntity\nand thought they were misnamed, but actually it's the comment that was\nunclear and should have been fixed."}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "d9082260c840aba6f5b27f30b5d861a309874b81", "author": {"user": {"login": "yrodiere", "name": "Yoann Rodi\u00e8re"}}, "url": "https://github.com/quarkusio/quarkus/commit/d9082260c840aba6f5b27f30b5d861a309874b81", "committedDate": "2020-08-03T14:58:56Z", "message": "hsearch-es: Drop the deprecated '.index-defaults.foo' syntax for specifying default configuration for indexes"}, "afterCommit": {"oid": "2e6f816539f6bf5b54ea75a45cddfd585c559612", "author": {"user": {"login": "yrodiere", "name": "Yoann Rodi\u00e8re"}}, "url": "https://github.com/quarkusio/quarkus/commit/2e6f816539f6bf5b54ea75a45cddfd585c559612", "committedDate": "2020-08-19T15:05:54Z", "message": "hsearch-es: Clarify the name of some unit tests\n\nI had renamed the tests in 961d95b3b8e02c2c104f6ef2bf96d82f822580c8\nbecause I misunderstood their purpose from the comment on IndexedEntity\nand thought they were misnamed, but actually it's the comment that was\nunclear and should have been fixed."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDcxOTc5NDA5", "url": "https://github.com/quarkusio/quarkus/pull/11166#pullrequestreview-471979409", "createdAt": "2020-08-20T20:55:57Z", "commit": {"oid": "2e6f816539f6bf5b54ea75a45cddfd585c559612"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yMFQyMDo1NTo1N1rOHES_fg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yMFQyMDo1NTo1N1rOHES_fg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NDI2NzUxOA==", "bodyText": "Maybe we could rename that one to defaultBackend? That would be clearer IMHO.", "url": "https://github.com/quarkusio/quarkus/pull/11166#discussion_r474267518", "createdAt": "2020-08-20T20:55:57Z", "author": {"login": "gsmet"}, "path": "extensions/hibernate-search-elasticsearch/runtime/src/main/java/io/quarkus/hibernate/search/elasticsearch/runtime/HibernateSearchElasticsearchRuntimeConfig.java", "diffHunk": "@@ -128,7 +128,7 @@\n         /**\n          * The default configuration for the Elasticsearch indexes.\n          */\n-        @ConfigItem\n+        @ConfigItem(name = ConfigItem.PARENT)\n         ElasticsearchIndexConfig indexDefaults;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "2e6f816539f6bf5b54ea75a45cddfd585c559612"}, "originalPosition": 33}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDcyMzk0NTUw", "url": "https://github.com/quarkusio/quarkus/pull/11166#pullrequestreview-472394550", "createdAt": "2020-08-21T10:52:32Z", "commit": {"oid": "2e6f816539f6bf5b54ea75a45cddfd585c559612"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 882, "cost": 1, "resetAt": "2021-11-01T16:37:27Z"}}}