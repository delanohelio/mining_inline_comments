{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTEwMDM0OTI2", "number": 12949, "reviewThreads": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yNlQxNDoyMDoyNVrOEx7Dww==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yN1QyMDoxNjozOVrOEyiWzA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzIwNzgzMjk5OnYy", "diffSide": "RIGHT", "path": "extensions/hibernate-orm/runtime/src/main/java/io/quarkus/hibernate/orm/runtime/StaticInitHibernatePersistenceProviderResolver.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yNlQxNDoyMDoyNVrOHoRwXA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yNlQxNDoyMzo0MlrOHoR6WQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMTk5NTk5Ng==", "bodyText": "I'd love to understand the need for this better. Could you elaborate, and maybe evolve the comments for future reference?", "url": "https://github.com/quarkusio/quarkus/pull/12949#discussion_r511995996", "createdAt": "2020-10-26T14:20:25Z", "author": {"login": "Sanne"}, "path": "extensions/hibernate-orm/runtime/src/main/java/io/quarkus/hibernate/orm/runtime/StaticInitHibernatePersistenceProviderResolver.java", "diffHunk": "@@ -0,0 +1,23 @@\n+package io.quarkus.hibernate.orm.runtime;\n+\n+import java.util.List;\n+\n+import javax.persistence.spi.PersistenceProvider;\n+import javax.persistence.spi.PersistenceProviderResolver;\n+\n+/**\n+ * During the static init phase, we don't access the PersistenceProviderResolver.\n+ */\n+final class StaticInitHibernatePersistenceProviderResolver implements PersistenceProviderResolver {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "8263258c972c9e118658a03427065c50b77ed76d"}, "originalPosition": 11}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMTk5ODU1Mw==", "bodyText": "This is something we shouldn't access during the static init phase as it's only used when creating the entity manager factory.\nThus, to be extra sure we don't access it, I decided to make it extra safe by throwing exceptions.\nWe now define the PersistenceProviderResolver twice: once at the beginning of the static init phase with this one, which shouldn't be used and the second time at the beginning of the runtime phase where we also push the runtime properties.\nBTW, it was more or less done this way before i.e. I haven't changed anything really, just made it clearer. Mostly because I now need to push the runtime properties in the constructor. I could have define a setter and rely on the order of operations but I prefer having things immutable and fully constructed.", "url": "https://github.com/quarkusio/quarkus/pull/12949#discussion_r511998553", "createdAt": "2020-10-26T14:23:42Z", "author": {"login": "gsmet"}, "path": "extensions/hibernate-orm/runtime/src/main/java/io/quarkus/hibernate/orm/runtime/StaticInitHibernatePersistenceProviderResolver.java", "diffHunk": "@@ -0,0 +1,23 @@\n+package io.quarkus.hibernate.orm.runtime;\n+\n+import java.util.List;\n+\n+import javax.persistence.spi.PersistenceProvider;\n+import javax.persistence.spi.PersistenceProviderResolver;\n+\n+/**\n+ * During the static init phase, we don't access the PersistenceProviderResolver.\n+ */\n+final class StaticInitHibernatePersistenceProviderResolver implements PersistenceProviderResolver {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMTk5NTk5Ng=="}, "originalCommit": {"oid": "8263258c972c9e118658a03427065c50b77ed76d"}, "originalPosition": 11}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzIxNDI0MzExOnYy", "diffSide": "RIGHT", "path": "extensions/hibernate-orm/runtime/src/main/java/io/quarkus/hibernate/orm/runtime/recording/RecordedState.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yN1QyMDowOToxMlrOHpO7MA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yN1QyMDowOToxMlrOHpO7MA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMjk5ODE5Mg==", "bodyText": "great idea to add this, I'm going to need it as well.", "url": "https://github.com/quarkusio/quarkus/pull/12949#discussion_r512998192", "createdAt": "2020-10-27T20:09:12Z", "author": {"login": "Sanne"}, "path": "extensions/hibernate-orm/runtime/src/main/java/io/quarkus/hibernate/orm/runtime/recording/RecordedState.java", "diffHunk": "@@ -79,4 +82,8 @@ public MultiTenancyStrategy getMultiTenancyStrategy() {\n     public boolean isReactive() {\n         return isReactive;\n     }\n+\n+    public boolean isFromPersistenceXml() {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "88afebc7157b13f9dd5ce65d67c60e7cb693222a"}, "originalPosition": 28}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzIxNDI3MTQ4OnYy", "diffSide": "RIGHT", "path": "extensions/hibernate-reactive/runtime/src/main/java/io/quarkus/hibernate/reactive/runtime/FastBootHibernateReactivePersistenceProviderResolver.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yN1QyMDoxNjozOVrOHpPL8w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yN1QyMDoxNjozOVrOHpPL8w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMzAwMjQ4Mw==", "bodyText": "Very clever! I expected you'd have to bypass the JPA bootstrap, but this seems more effective.", "url": "https://github.com/quarkusio/quarkus/pull/12949#discussion_r513002483", "createdAt": "2020-10-27T20:16:39Z", "author": {"login": "Sanne"}, "path": "extensions/hibernate-reactive/runtime/src/main/java/io/quarkus/hibernate/reactive/runtime/FastBootHibernateReactivePersistenceProviderResolver.java", "diffHunk": "@@ -6,19 +6,24 @@\n import javax.persistence.spi.PersistenceProvider;\n import javax.persistence.spi.PersistenceProviderResolver;\n \n+import io.quarkus.hibernate.orm.runtime.HibernateOrmRuntimeConfig;\n+\n final class FastBootHibernateReactivePersistenceProviderResolver implements PersistenceProviderResolver {\n \n-    private static final List<PersistenceProvider> HARDCODED_PROVIDER_LIST = Collections\n-            .singletonList(new FastBootHibernateReactivePersistenceProvider());\n+    private final List<PersistenceProvider> persistenceProviders;\n+\n+    public FastBootHibernateReactivePersistenceProviderResolver(HibernateOrmRuntimeConfig hibernateOrmRuntimeConfig) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "88afebc7157b13f9dd5ce65d67c60e7cb693222a"}, "originalPosition": 12}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4081, "cost": 1, "resetAt": "2021-11-13T14:23:39Z"}}}