{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTA4NDc4NzU0", "number": 12888, "title": "Run OIDC Challenge in the blocking mode if needed", "bodyText": "Fixes #12754\nThe problem is that if a web-app tenant is created in a custom TenantConfigResolver then it causes Vert.x to block.\nI've just copied some code where Stuart did a blocking SecurityIdentity context implementation, keeping the same interface + impl approach for now.\nAlso did some updates to OidcTenantConfig to ensure it is initialized correctly without the injection.\n@stuartwdouglas It is not really an OIDC specific issue so please check this PR as well :-)", "createdAt": "2020-10-22T18:26:53Z", "url": "https://github.com/quarkusio/quarkus/pull/12888", "merged": true, "mergeCommit": {"oid": "27911ad117a9a5fabef51c2510c1be82d7b26c91"}, "closed": true, "closedAt": "2020-10-29T13:19:58Z", "author": {"login": "sberyozkin"}, "timelineItems": {"totalCount": 11, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdVGVWsABqjM5MTA1Njg4Mjk=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdXCUpFgFqTUxODk5Mjc0NQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "cabffcf593d2f468ef1c9b1d82e2ac881c60f472", "author": {"user": {"login": "sberyozkin", "name": null}}, "url": "https://github.com/quarkusio/quarkus/commit/cabffcf593d2f468ef1c9b1d82e2ac881c60f472", "committedDate": "2020-10-22T18:01:54Z", "message": "Run OIDC Challenge in the blocking mode if needed"}, "afterCommit": {"oid": "d186e98b65ffe500ffce21d20cce85ca0b8b83d0", "author": {"user": {"login": "sberyozkin", "name": null}}, "url": "https://github.com/quarkusio/quarkus/commit/d186e98b65ffe500ffce21d20cce85ca0b8b83d0", "committedDate": "2020-10-22T18:30:43Z", "message": "Run OIDC Challenge in the blocking mode if needed"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "d186e98b65ffe500ffce21d20cce85ca0b8b83d0", "author": {"user": {"login": "sberyozkin", "name": null}}, "url": "https://github.com/quarkusio/quarkus/commit/d186e98b65ffe500ffce21d20cce85ca0b8b83d0", "committedDate": "2020-10-22T18:30:43Z", "message": "Run OIDC Challenge in the blocking mode if needed"}, "afterCommit": {"oid": "5d6219c97cf6d3c5b0e01d6631d58dc6cd986abf", "author": {"user": {"login": "sberyozkin", "name": null}}, "url": "https://github.com/quarkusio/quarkus/commit/5d6219c97cf6d3c5b0e01d6631d58dc6cd986abf", "committedDate": "2020-10-23T08:43:48Z", "message": "Run OIDC Challenge in the blocking mode if needed"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTE3NTkwNjY5", "url": "https://github.com/quarkusio/quarkus/pull/12888#pullrequestreview-517590669", "createdAt": "2020-10-27T11:16:22Z", "commit": {"oid": "5d6219c97cf6d3c5b0e01d6631d58dc6cd986abf"}, "state": "DISMISSED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yN1QxMToxNjoyMlrOHo3AWw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yN1QxMToxNjoyMlrOHo3AWw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMjYwNjI5OQ==", "bodyText": "Why have you done this? You don't need a special interface and implementation for this, just run the code directly inside getChallenge", "url": "https://github.com/quarkusio/quarkus/pull/12888#discussion_r512606299", "createdAt": "2020-10-27T11:16:22Z", "author": {"login": "stuartwdouglas"}, "path": "extensions/oidc/runtime/src/main/java/io/quarkus/oidc/runtime/CodeAuthenticationMechanism.java", "diffHunk": "@@ -600,4 +621,45 @@ static String getCookieSuffix(String tenantId) {\n         return !\"Default\".equals(tenantId) ? \"_\" + tenantId : \"\";\n     }\n \n+    interface AuthenticationChallegeContext {\n+\n+        Uni<ChallengeData> runBlocking(Supplier<ChallengeData> function);\n+\n+    }\n+\n+    private final AuthenticationChallegeContext blockingChallengeContext = new AuthenticationChallegeContext() {\n+        @Override\n+        public Uni<ChallengeData> runBlocking(Supplier<ChallengeData> function) {\n+            return Uni.createFrom().deferred(new Supplier<Uni<? extends ChallengeData>>() {\n+                @Override\n+                public Uni<ChallengeData> get() {\n+                    if (BlockingOperationControl.isBlockingAllowed()) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "5d6219c97cf6d3c5b0e01d6631d58dc6cd986abf"}, "originalPosition": 58}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "5d6219c97cf6d3c5b0e01d6631d58dc6cd986abf", "author": {"user": {"login": "sberyozkin", "name": null}}, "url": "https://github.com/quarkusio/quarkus/commit/5d6219c97cf6d3c5b0e01d6631d58dc6cd986abf", "committedDate": "2020-10-23T08:43:48Z", "message": "Run OIDC Challenge in the blocking mode if needed"}, "afterCommit": {"oid": "61b22f945f74fa7d415b28dedaf430f0e246ee54", "author": {"user": {"login": "sberyozkin", "name": null}}, "url": "https://github.com/quarkusio/quarkus/commit/61b22f945f74fa7d415b28dedaf430f0e246ee54", "committedDate": "2020-10-27T12:56:32Z", "message": "Run OIDC Challenge in the blocking mode if needed"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "61b22f945f74fa7d415b28dedaf430f0e246ee54", "author": {"user": {"login": "sberyozkin", "name": null}}, "url": "https://github.com/quarkusio/quarkus/commit/61b22f945f74fa7d415b28dedaf430f0e246ee54", "committedDate": "2020-10-27T12:56:32Z", "message": "Run OIDC Challenge in the blocking mode if needed"}, "afterCommit": {"oid": "1424d565bde31c3df2857d55dcba242dcfab6748", "author": {"user": {"login": "sberyozkin", "name": null}}, "url": "https://github.com/quarkusio/quarkus/commit/1424d565bde31c3df2857d55dcba242dcfab6748", "committedDate": "2020-10-27T16:53:49Z", "message": "Run OIDC Challenge in the blocking mode if needed"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "1424d565bde31c3df2857d55dcba242dcfab6748", "author": {"user": {"login": "sberyozkin", "name": null}}, "url": "https://github.com/quarkusio/quarkus/commit/1424d565bde31c3df2857d55dcba242dcfab6748", "committedDate": "2020-10-27T16:53:49Z", "message": "Run OIDC Challenge in the blocking mode if needed"}, "afterCommit": {"oid": "6f74eb8f8c27134c7986100cb2201f1915716c3a", "author": {"user": {"login": "sberyozkin", "name": null}}, "url": "https://github.com/quarkusio/quarkus/commit/6f74eb8f8c27134c7986100cb2201f1915716c3a", "committedDate": "2020-10-27T21:11:21Z", "message": "Run OIDC Challenge in the blocking mode if needed"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "6f74eb8f8c27134c7986100cb2201f1915716c3a", "author": {"user": {"login": "sberyozkin", "name": null}}, "url": "https://github.com/quarkusio/quarkus/commit/6f74eb8f8c27134c7986100cb2201f1915716c3a", "committedDate": "2020-10-27T21:11:21Z", "message": "Run OIDC Challenge in the blocking mode if needed"}, "afterCommit": {"oid": "75120b46dd1f95c7aacc9c4083dbce822df3b71c", "author": {"user": {"login": "sberyozkin", "name": null}}, "url": "https://github.com/quarkusio/quarkus/commit/75120b46dd1f95c7aacc9c4083dbce822df3b71c", "committedDate": "2020-10-28T11:12:13Z", "message": "Run OIDC Challenge in the blocking mode if needed"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "75120b46dd1f95c7aacc9c4083dbce822df3b71c", "author": {"user": {"login": "sberyozkin", "name": null}}, "url": "https://github.com/quarkusio/quarkus/commit/75120b46dd1f95c7aacc9c4083dbce822df3b71c", "committedDate": "2020-10-28T11:12:13Z", "message": "Run OIDC Challenge in the blocking mode if needed"}, "afterCommit": {"oid": "7c957d7984bb3eb1a128992dfa17f65ae5e23b18", "author": {"user": {"login": "sberyozkin", "name": null}}, "url": "https://github.com/quarkusio/quarkus/commit/7c957d7984bb3eb1a128992dfa17f65ae5e23b18", "committedDate": "2020-10-28T11:26:45Z", "message": "Run OIDC Challenge in the blocking mode if needed"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "dd321fe6bd2197075423f262fa7b69da5b2147de", "author": {"user": {"login": "sberyozkin", "name": null}}, "url": "https://github.com/quarkusio/quarkus/commit/dd321fe6bd2197075423f262fa7b69da5b2147de", "committedDate": "2020-10-28T13:39:59Z", "message": "Run OIDC Challenge in the blocking mode if needed"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "7c957d7984bb3eb1a128992dfa17f65ae5e23b18", "author": {"user": {"login": "sberyozkin", "name": null}}, "url": "https://github.com/quarkusio/quarkus/commit/7c957d7984bb3eb1a128992dfa17f65ae5e23b18", "committedDate": "2020-10-28T11:26:45Z", "message": "Run OIDC Challenge in the blocking mode if needed"}, "afterCommit": {"oid": "dd321fe6bd2197075423f262fa7b69da5b2147de", "author": {"user": {"login": "sberyozkin", "name": null}}, "url": "https://github.com/quarkusio/quarkus/commit/dd321fe6bd2197075423f262fa7b69da5b2147de", "committedDate": "2020-10-28T13:39:59Z", "message": "Run OIDC Challenge in the blocking mode if needed"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTE4OTkyNzQ1", "url": "https://github.com/quarkusio/quarkus/pull/12888#pullrequestreview-518992745", "createdAt": "2020-10-28T18:59:51Z", "commit": {"oid": "dd321fe6bd2197075423f262fa7b69da5b2147de"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1705, "cost": 1, "resetAt": "2021-11-01T16:37:27Z"}}}