{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDA1OTYyNTk3", "number": 8692, "title": "Config root beans - throw CreationException if a root is not initialized", "bodyText": "Follows up on #8641.", "createdAt": "2020-04-20T10:07:33Z", "url": "https://github.com/quarkusio/quarkus/pull/8692", "merged": true, "mergeCommit": {"oid": "23f8418df1a734580c48754630b985c81f2dbe08"}, "closed": true, "closedAt": "2020-04-20T15:10:17Z", "author": {"login": "mkouba"}, "timelineItems": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcZcXOfAFqTM5NjMyMjc0Nw==", "endCursor": "Y3Vyc29yOnYyOpPPAAABcZfPrLABqjMyNTE3OTI5OTg=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzk2MzIyNzQ3", "url": "https://github.com/quarkusio/quarkus/pull/8692#pullrequestreview-396322747", "createdAt": "2020-04-20T10:16:53Z", "commit": {"oid": "7e5ce8bba5c654640f605d9d5611f4d495d4f057"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yMFQxMDoxNjo1NFrOGINZOQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yMFQxMDoxNjo1NFrOGINZOQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMTI2MTI0MQ==", "bodyText": "Perhaps we should simplify the message to just say that config roots can only be accessed at runtime init? Mentioning bootstrap here is kind of confusing since there is also the bootstrap config phase.", "url": "https://github.com/quarkusio/quarkus/pull/8692#discussion_r411261241", "createdAt": "2020-04-20T10:16:54Z", "author": {"login": "geoand"}, "path": "extensions/arc/deployment/src/main/java/io/quarkus/arc/deployment/ConfigBuildStep.java", "diffHunk": "@@ -151,10 +153,16 @@ public void register(RegistrationContext context) {\n                 for (RootDefinition rootDefinition : configItem.getReadResult().getAllRoots()) {\n                     if (rootDefinition.getConfigPhase() == ConfigPhase.BUILD_AND_RUN_TIME_FIXED\n                             || rootDefinition.getConfigPhase() == ConfigPhase.RUN_TIME) {\n-                        context.configure(rootDefinition.getConfigurationClass()).types(rootDefinition.getConfigurationClass())\n+                        Class<?> configRootClass = rootDefinition.getConfigurationClass();\n+                        context.configure(configRootClass).types(configRootClass)\n                                 .scope(Dependent.class).creator(mc -> {\n                                     // e.g. return Config.ApplicationConfig\n-                                    mc.returnValue(mc.readStaticField(rootDefinition.getDescriptor()));\n+                                    ResultHandle configRoot = mc.readStaticField(rootDefinition.getDescriptor());\n+                                    mc.ifNull(configRoot).trueBranch().throwException(CreationException.class,\n+                                            String.format(\n+                                                    \"Config root %s [%s] was not initialized yet. Make sure the bean is accessed at the right time in the correct bootstrap phase.\",", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "7e5ce8bba5c654640f605d9d5611f4d495d4f057"}, "originalPosition": 29}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzk2NDA2MDA3", "url": "https://github.com/quarkusio/quarkus/pull/8692#pullrequestreview-396406007", "createdAt": "2020-04-20T12:28:28Z", "commit": {"oid": "7e5ce8bba5c654640f605d9d5611f4d495d4f057"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "9a0ce74485263326c9f4463ec308dba495c654f3", "author": {"user": {"login": "mkouba", "name": "Martin Kouba"}}, "url": "https://github.com/quarkusio/quarkus/commit/9a0ce74485263326c9f4463ec308dba495c654f3", "committedDate": "2020-04-20T13:38:12Z", "message": "Config root beans - throw CreationException if a root is not initialized"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "7e5ce8bba5c654640f605d9d5611f4d495d4f057", "author": {"user": {"login": "mkouba", "name": "Martin Kouba"}}, "url": "https://github.com/quarkusio/quarkus/commit/7e5ce8bba5c654640f605d9d5611f4d495d4f057", "committedDate": "2020-04-20T10:06:09Z", "message": "Config root beans - throw CreationException if a root is not initialized"}, "afterCommit": {"oid": "9a0ce74485263326c9f4463ec308dba495c654f3", "author": {"user": {"login": "mkouba", "name": "Martin Kouba"}}, "url": "https://github.com/quarkusio/quarkus/commit/9a0ce74485263326c9f4463ec308dba495c654f3", "committedDate": "2020-04-20T13:38:12Z", "message": "Config root beans - throw CreationException if a root is not initialized"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4449, "cost": 1, "resetAt": "2021-11-02T10:47:05Z"}}}