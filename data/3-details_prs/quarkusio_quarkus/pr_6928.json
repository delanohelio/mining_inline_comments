{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0MzY5Nzk0MDM3", "number": 6928, "title": "Introduce support for .env", "bodyText": "Fixes #3670", "createdAt": "2020-01-31T22:16:26Z", "url": "https://github.com/quarkusio/quarkus/pull/6928", "merged": true, "mergeCommit": {"oid": "06dd418a055117c3c83663a212b49ee9aa9999f4"}, "closed": true, "closedAt": "2020-02-05T20:35:44Z", "author": {"login": "dmlloyd"}, "timelineItems": {"totalCount": 7, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABb_2uDYAFqTM1MTgwOTk1Nw==", "endCursor": "Y3Vyc29yOnYyOpPPAAABcAxKGqABqjMwMDMyODIwNzQ=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzUxODA5OTU3", "url": "https://github.com/quarkusio/quarkus/pull/6928#pullrequestreview-351809957", "createdAt": "2020-01-31T22:17:20Z", "commit": {"oid": "a9f5b981e5967858e7959e26d86fbf3e454280df"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0zMVQyMjoxNzoyMFrOFkZdFw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0zMVQyMjoxNzoyMFrOFkZdFw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MzcxMDEwMw==", "bodyText": "@gastaldi you were totally right about this :)", "url": "https://github.com/quarkusio/quarkus/pull/6928#discussion_r373710103", "createdAt": "2020-01-31T22:17:20Z", "author": {"login": "dmlloyd"}, "path": "core/runtime/src/main/java/io/quarkus/runtime/configuration/ConfigUtils.java", "diffHunk": "@@ -86,32 +95,68 @@ public static void addSourceProvider(SmallRyeConfigBuilder builder, ConfigSource\n         }\n     }\n \n-    static final class EnvConfigSource implements ConfigSource {\n+    static class EnvConfigSource implements ConfigSource {\n         static final Pattern REP_PATTERN = Pattern.compile(\"[^a-zA-Z0-9_]\");\n \n-        private final int ordinal;\n-\n-        EnvConfigSource(final int ordinal) {\n-            this.ordinal = ordinal;\n+        EnvConfigSource() {\n         }\n \n         public int getOrdinal() {\n-            return ordinal;\n+            return 300;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a9f5b981e5967858e7959e26d86fbf3e454280df"}, "originalPosition": 47}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "a9f5b981e5967858e7959e26d86fbf3e454280df", "author": {"user": {"login": "dmlloyd", "name": "David M. Lloyd"}}, "url": "https://github.com/quarkusio/quarkus/commit/a9f5b981e5967858e7959e26d86fbf3e454280df", "committedDate": "2020-01-31T22:13:42Z", "message": "Introduce support for .env\n\nFixes #3670"}, "afterCommit": {"oid": "207976341c56e0a37e5dfd63edc415738feb6459", "author": {"user": {"login": "dmlloyd", "name": "David M. Lloyd"}}, "url": "https://github.com/quarkusio/quarkus/commit/207976341c56e0a37e5dfd63edc415738feb6459", "committedDate": "2020-02-03T13:46:01Z", "message": "Introduce support for .env\n\nFixes #3670"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzUyMjY2MTg4", "url": "https://github.com/quarkusio/quarkus/pull/6928#pullrequestreview-352266188", "createdAt": "2020-02-03T13:52:02Z", "commit": {"oid": "207976341c56e0a37e5dfd63edc415738feb6459"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzUyMjcwMjIz", "url": "https://github.com/quarkusio/quarkus/pull/6928#pullrequestreview-352270223", "createdAt": "2020-02-03T13:57:36Z", "commit": {"oid": "207976341c56e0a37e5dfd63edc415738feb6459"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0wM1QxMzo1NzozN1rOFkyMcw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0wM1QxMzo1NzozN1rOFkyMcw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NDExNTQ0Mw==", "bodyText": "Not a big deal, but maybe it would be nice to debug log any IOExceptions thrown here", "url": "https://github.com/quarkusio/quarkus/pull/6928#discussion_r374115443", "createdAt": "2020-02-03T13:57:37Z", "author": {"login": "gastaldi"}, "path": "core/runtime/src/main/java/io/quarkus/runtime/configuration/ConfigUtils.java", "diffHunk": "@@ -86,32 +95,68 @@ public static void addSourceProvider(SmallRyeConfigBuilder builder, ConfigSource\n         }\n     }\n \n-    static final class EnvConfigSource implements ConfigSource {\n+    static class EnvConfigSource implements ConfigSource {\n         static final Pattern REP_PATTERN = Pattern.compile(\"[^a-zA-Z0-9_]\");\n \n-        private final int ordinal;\n-\n-        EnvConfigSource(final int ordinal) {\n-            this.ordinal = ordinal;\n+        EnvConfigSource() {\n         }\n \n         public int getOrdinal() {\n-            return ordinal;\n+            return 300;\n         }\n \n         public Map<String, String> getProperties() {\n             return Collections.emptyMap();\n         }\n \n         public String getValue(final String propertyName) {\n-            return System.getenv(REP_PATTERN.matcher(propertyName.toUpperCase(Locale.ROOT)).replaceAll(\"_\"));\n+            return getRawValue(REP_PATTERN.matcher(propertyName.toUpperCase(Locale.ROOT)).replaceAll(\"_\"));\n+        }\n+\n+        String getRawValue(final String name) {\n+            return System.getenv(name);\n         }\n \n         public String getName() {\n             return \"System environment\";\n         }\n     }\n \n+    static class DotEnvConfigSource extends EnvConfigSource {\n+        private final Map<String, String> values;\n+\n+        DotEnvConfigSource() {\n+            this(Paths.get(System.getProperty(\"user.dir\", \".\"), \".env\"));\n+        }\n+\n+        DotEnvConfigSource(Path path) {\n+            Map<String, String> values = new HashMap<>();\n+            try (InputStream is = Files.newInputStream(path)) {\n+                try (InputStreamReader isr = new InputStreamReader(is, StandardCharsets.UTF_8)) {\n+                    final Properties properties = new Properties();\n+                    properties.load(isr);\n+                    for (String name : properties.stringPropertyNames()) {\n+                        values.put(name, properties.getProperty(name));\n+                    }\n+                }\n+            } catch (IOException ignored) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "207976341c56e0a37e5dfd63edc415738feb6459"}, "originalPosition": 85}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "207976341c56e0a37e5dfd63edc415738feb6459", "author": {"user": {"login": "dmlloyd", "name": "David M. Lloyd"}}, "url": "https://github.com/quarkusio/quarkus/commit/207976341c56e0a37e5dfd63edc415738feb6459", "committedDate": "2020-02-03T13:46:01Z", "message": "Introduce support for .env\n\nFixes #3670"}, "afterCommit": {"oid": "da3c82e4ba1552751c6a5f3bebc1757202b2ee1e", "author": {"user": {"login": "dmlloyd", "name": "David M. Lloyd"}}, "url": "https://github.com/quarkusio/quarkus/commit/da3c82e4ba1552751c6a5f3bebc1757202b2ee1e", "committedDate": "2020-02-03T14:10:52Z", "message": "Introduce support for .env\n\nFixes #3670"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "36263b5e3e174821418e926e298a8ca2dda41406", "author": {"user": {"login": "dmlloyd", "name": "David M. Lloyd"}}, "url": "https://github.com/quarkusio/quarkus/commit/36263b5e3e174821418e926e298a8ca2dda41406", "committedDate": "2020-02-03T18:22:20Z", "message": "Introduce support for .env\n\nFixes #3670"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "da3c82e4ba1552751c6a5f3bebc1757202b2ee1e", "author": {"user": {"login": "dmlloyd", "name": "David M. Lloyd"}}, "url": "https://github.com/quarkusio/quarkus/commit/da3c82e4ba1552751c6a5f3bebc1757202b2ee1e", "committedDate": "2020-02-03T14:10:52Z", "message": "Introduce support for .env\n\nFixes #3670"}, "afterCommit": {"oid": "36263b5e3e174821418e926e298a8ca2dda41406", "author": {"user": {"login": "dmlloyd", "name": "David M. Lloyd"}}, "url": "https://github.com/quarkusio/quarkus/commit/36263b5e3e174821418e926e298a8ca2dda41406", "committedDate": "2020-02-03T18:22:20Z", "message": "Introduce support for .env\n\nFixes #3670"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 32, "cost": 1, "resetAt": "2021-11-01T16:37:27Z"}}}