{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0Mzc4OTgyNTQ4", "number": 7385, "title": "Fix broken MongoClientBuildItem support", "bodyText": "Fixes: #7378", "createdAt": "2020-02-24T13:13:54Z", "url": "https://github.com/quarkusio/quarkus/pull/7385", "merged": true, "mergeCommit": {"oid": "6ecb8bcdd4ee9a0d7d7c36dd79fe317b9723a7dd"}, "closed": true, "closedAt": "2020-02-25T17:01:09Z", "author": {"login": "geoand"}, "timelineItems": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcHe0PhAFqTM2MzQ1MDE0Mg==", "endCursor": "Y3Vyc29yOnYyOpPPAAABcH1LXUAFqTM2NDI5NzY2Mw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzYzNDUwMTQy", "url": "https://github.com/quarkusio/quarkus/pull/7385#pullrequestreview-363450142", "createdAt": "2020-02-24T14:57:40Z", "commit": {"oid": "ad376e42465a03925f579b1f63ea55f28385e235"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yNFQxNDo1Nzo0MVrOFtjmGQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yNFQxNDo1Nzo0MVrOFtjmGQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MzMxMzQzMw==", "bodyText": "Why not using this new methods also in the createMongoClientProducerBeanmethods that do the same but based on Jandex ?", "url": "https://github.com/quarkusio/quarkus/pull/7385#discussion_r383313433", "createdAt": "2020-02-24T14:57:41Z", "author": {"login": "loicmathieu"}, "path": "extensions/mongodb-client/deployment/src/main/java/io/quarkus/mongodb/deployment/MongoClientProcessor.java", "diffHunk": "@@ -365,21 +358,51 @@ BeanContainerListenerBuildItem build(\n \n     @Record(RUNTIME_INIT)\n     @BuildStep\n-    void build(MongoClientRecorder recorder, BuildProducer<MongoClientBuildItem> mongoClients, MongodbConfig config) {\n-        if (config.mongoClientConfigs != null && !config.mongoClientConfigs.isEmpty()) {\n-            for (Map.Entry<String, MongoClientConfig> namedDataSourceEntry : config.mongoClientConfigs.entrySet()) {\n-                String name = namedDataSourceEntry.getKey();\n-                mongoClients\n-                        .produce(new MongoClientBuildItem(recorder.getClient(name), recorder.getReactiveClient(name), name));\n+    void configureRuntimePropertiesAndBuildClients(MongoClientRecorder recorder,\n+            CodecProviderBuildItem codecProvider,\n+            BsonDiscriminatorBuildItem bsonDiscriminator,\n+            MongodbConfig mongodbConfig, ConfigurationBuildItem config,\n+            BuildProducer<MongoClientBuildItem> mongoClients) {\n+        recorder.configureRuntimeProperties(codecProvider.getCodecProviderClassNames(),\n+                bsonDiscriminator.getBsonDiscriminatorClassNames(), mongodbConfig);\n+\n+        for (String connectionName : resolveAllConnectionNamesFromConfig(config)) {\n+            mongoClients.produce(new MongoClientBuildItem(recorder.getClient(connectionName),\n+                    recorder.getReactiveClient(connectionName), connectionName));\n+        }\n+    }\n+\n+    private Set<String> resolveAllConnectionNamesFromConfig(ConfigurationBuildItem config) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ad376e42465a03925f579b1f63ea55f28385e235"}, "originalPosition": 83}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "15e2f328234c7e7afe550e90f1936f076269020e", "author": {"user": {"login": "geoand", "name": "Georgios Andrianakis"}}, "url": "https://github.com/quarkusio/quarkus/commit/15e2f328234c7e7afe550e90f1936f076269020e", "committedDate": "2020-02-24T23:06:17Z", "message": "Fix broken MongoClientBuildItem support\n\nFixes: #7378"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "ad376e42465a03925f579b1f63ea55f28385e235", "author": {"user": {"login": "geoand", "name": "Georgios Andrianakis"}}, "url": "https://github.com/quarkusio/quarkus/commit/ad376e42465a03925f579b1f63ea55f28385e235", "committedDate": "2020-02-24T13:59:58Z", "message": "Change MongoClientBuildItem to use Optional\n\nThis is done because the clients won't be actually created\nby CDI if there are no injection points that use them"}, "afterCommit": {"oid": "15e2f328234c7e7afe550e90f1936f076269020e", "author": {"user": {"login": "geoand", "name": "Georgios Andrianakis"}}, "url": "https://github.com/quarkusio/quarkus/commit/15e2f328234c7e7afe550e90f1936f076269020e", "committedDate": "2020-02-24T23:06:17Z", "message": "Fix broken MongoClientBuildItem support\n\nFixes: #7378"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzYzOTUzMTcx", "url": "https://github.com/quarkusio/quarkus/pull/7385#pullrequestreview-363953171", "createdAt": "2020-02-25T08:40:02Z", "commit": {"oid": "15e2f328234c7e7afe550e90f1936f076269020e"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzY0Mjk3NjYz", "url": "https://github.com/quarkusio/quarkus/pull/7385#pullrequestreview-364297663", "createdAt": "2020-02-25T17:00:56Z", "commit": {"oid": "15e2f328234c7e7afe550e90f1936f076269020e"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3989, "cost": 1, "resetAt": "2021-11-02T10:47:05Z"}}}