{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTI4Nzk1MTA0", "number": 13529, "title": "Rework constrained method inheritance for Hibernate Validator extension", "bodyText": "Fixes #13470\nFixes #11536\n@famod IIRC you were the last person working on this. I decided to rework it to exploit the index to get all the information rather than having a not so good way to manage the interface in the annotation transformer.\nLet me know what you think.", "createdAt": "2020-11-27T21:43:17Z", "url": "https://github.com/quarkusio/quarkus/pull/13529", "merged": true, "mergeCommit": {"oid": "0ebf0ff79cfc9d4730bc7d34d5fcee055862b8e3"}, "closed": true, "closedAt": "2020-11-28T17:07:41Z", "author": {"login": "gsmet"}, "timelineItems": {"totalCount": 6, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdgvjnTgFqTU0MDIwNTQzNA==", "endCursor": "Y3Vyc29yOnYyOpPPAAABdg8NF8gFqTU0MDM3NTY5Ng==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTQwMjA1NDM0", "url": "https://github.com/quarkusio/quarkus/pull/13529#pullrequestreview-540205434", "createdAt": "2020-11-27T22:38:55Z", "commit": {"oid": "ef6d8b0e8c8549279a2f59f0920c6c0920b28344"}, "state": "APPROVED", "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0yN1QyMjozODo1NlrOH7Kh1Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0yN1QyMjo0NDo0NFrOH7KkvA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMTgwMDUzMw==", "bodyText": "method.declaringClass() is already available as clazz .", "url": "https://github.com/quarkusio/quarkus/pull/13529#discussion_r531800533", "createdAt": "2020-11-27T22:38:56Z", "author": {"login": "famod"}, "path": "extensions/hibernate-validator/deployment/src/main/java/io/quarkus/hibernate/validator/deployment/HibernateValidatorProcessor.java", "diffHunk": "@@ -376,13 +376,23 @@ private static void contributeClassMarkedForCascadingValidation(Set<DotName> cla\n     }\n \n     private static void contributeMethodsWithInheritedValidation(\n-            Map<DotName, Set<SimpleMethodSignatureKey>> inheritedAnnotationsToBeValidated,\n+            Map<DotName, Set<SimpleMethodSignatureKey>> methodsWithInheritedValidation,\n             IndexView indexView, MethodInfo method) {\n         ClassInfo clazz = method.declaringClass();\n-        if (Modifier.isInterface(clazz.flags())) {\n-            // Remember annotated interface methods that must be validated\n-            inheritedAnnotationsToBeValidated.computeIfAbsent(clazz.name(), k -> new HashSet<>())\n-                    .add(new SimpleMethodSignatureKey(method));\n+\n+        methodsWithInheritedValidation.computeIfAbsent(clazz.name(), k -> new HashSet<>())\n+                .add(new SimpleMethodSignatureKey(method));\n+\n+        if (Modifier.isInterface(method.declaringClass().flags())) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ef6d8b0e8c8549279a2f59f0920c6c0920b28344"}, "originalPosition": 52}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMTgwMTEwNA==", "bodyText": "Parameter name should also be methodsWithInheritedValidation.", "url": "https://github.com/quarkusio/quarkus/pull/13529#discussion_r531801104", "createdAt": "2020-11-27T22:43:39Z", "author": {"login": "famod"}, "path": "extensions/hibernate-validator/deployment/src/main/java/io/quarkus/hibernate/validator/deployment/MethodValidatedAnnotationsTransformer.java", "diffHunk": "@@ -23,15 +23,15 @@\n     private static final Logger LOGGER = Logger.getLogger(MethodValidatedAnnotationsTransformer.class.getPackage().getName());\n \n     private final Set<DotName> consideredAnnotations;\n-    private final Map<DotName, Set<SimpleMethodSignatureKey>> inheritedAnnotationsToBeValidated;\n+    private final Map<DotName, Set<SimpleMethodSignatureKey>> methodsWithInheritedValidation;\n     private final Map<DotName, Set<SimpleMethodSignatureKey>> jaxRsMethods;\n \n     MethodValidatedAnnotationsTransformer(Set<DotName> consideredAnnotations,\n             Map<DotName, Set<SimpleMethodSignatureKey>> jaxRsMethods,\n             Map<DotName, Set<SimpleMethodSignatureKey>> inheritedAnnotationsToBeValidated) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ef6d8b0e8c8549279a2f59f0920c6c0920b28344"}, "originalPosition": 10}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMTgwMTI3Ng==", "bodyText": "This could be moved further down because it is only needed when validatedMethods is not null or empty.", "url": "https://github.com/quarkusio/quarkus/pull/13529#discussion_r531801276", "createdAt": "2020-11-27T22:44:44Z", "author": {"login": "famod"}, "path": "extensions/hibernate-validator/deployment/src/main/java/io/quarkus/hibernate/validator/deployment/MethodValidatedAnnotationsTransformer.java", "diffHunk": "@@ -67,17 +67,19 @@ private boolean requiresValidation(MethodInfo method) {\n                 return true;\n             }\n         }\n+\n         // This method has no annotations of its own: look for inherited annotations\n-        ClassInfo clazz = method.declaringClass();\n         SimpleMethodSignatureKey signatureKey = new SimpleMethodSignatureKey(method);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ef6d8b0e8c8549279a2f59f0920c6c0920b28344"}, "originalPosition": 25}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "ef6d8b0e8c8549279a2f59f0920c6c0920b28344", "author": {"user": {"login": "gsmet", "name": "Guillaume Smet"}}, "url": "https://github.com/quarkusio/quarkus/commit/ef6d8b0e8c8549279a2f59f0920c6c0920b28344", "committedDate": "2020-11-27T21:40:58Z", "message": "Rework constrained method inheritance for Hibernate Validator extension\n\nFixes #13470"}, "afterCommit": {"oid": "253cf9b58a054e0d8b30dac1629bd20ac9b33146", "author": {"user": {"login": "gsmet", "name": "Guillaume Smet"}}, "url": "https://github.com/quarkusio/quarkus/commit/253cf9b58a054e0d8b30dac1629bd20ac9b33146", "committedDate": "2020-11-27T22:59:25Z", "message": "Rework constrained method inheritance for Hibernate Validator extension\n\nFixes #13470"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ddea520d5912e5a83614a6755df3585d93c83a1b", "author": {"user": {"login": "gsmet", "name": "Guillaume Smet"}}, "url": "https://github.com/quarkusio/quarkus/commit/ddea520d5912e5a83614a6755df3585d93c83a1b", "committedDate": "2020-11-28T11:49:26Z", "message": "Rework constrained method inheritance for Hibernate Validator extension\n\nFixes #13470"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "253cf9b58a054e0d8b30dac1629bd20ac9b33146", "author": {"user": {"login": "gsmet", "name": "Guillaume Smet"}}, "url": "https://github.com/quarkusio/quarkus/commit/253cf9b58a054e0d8b30dac1629bd20ac9b33146", "committedDate": "2020-11-27T22:59:25Z", "message": "Rework constrained method inheritance for Hibernate Validator extension\n\nFixes #13470"}, "afterCommit": {"oid": "ddea520d5912e5a83614a6755df3585d93c83a1b", "author": {"user": {"login": "gsmet", "name": "Guillaume Smet"}}, "url": "https://github.com/quarkusio/quarkus/commit/ddea520d5912e5a83614a6755df3585d93c83a1b", "committedDate": "2020-11-28T11:49:26Z", "message": "Rework constrained method inheritance for Hibernate Validator extension\n\nFixes #13470"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTQwMzcyMDA5", "url": "https://github.com/quarkusio/quarkus/pull/13529#pullrequestreview-540372009", "createdAt": "2020-11-28T12:22:12Z", "commit": {"oid": "ddea520d5912e5a83614a6755df3585d93c83a1b"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTQwMzc1Njk2", "url": "https://github.com/quarkusio/quarkus/pull/13529#pullrequestreview-540375696", "createdAt": "2020-11-28T13:31:25Z", "commit": {"oid": "ddea520d5912e5a83614a6755df3585d93c83a1b"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1323, "cost": 1, "resetAt": "2021-11-01T16:37:27Z"}}}