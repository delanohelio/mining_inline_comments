{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0MzU5NzE1NDEz", "number": 6432, "title": "ArC - optimize CreationalContext", "bodyText": "do not always store all dependent instances in CC\nalso introduce io.quarkus.arc.InjectableInstance\nresolves #5281", "createdAt": "2020-01-06T21:11:19Z", "url": "https://github.com/quarkusio/quarkus/pull/6432", "merged": true, "mergeCommit": {"oid": "70419294d710175e563fcc2ee6f0bf50a48cd950"}, "closed": true, "closedAt": "2020-01-07T19:39:24Z", "author": {"login": "mkouba"}, "timelineItems": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABb3yvVRgH2gAyMzU5NzE1NDEzOmFlNjYwZmU3MDFjN2Q0NjBhMjMxMWMzZWRjNjIwMDNlNWE2Mzk0ZGY=", "endCursor": "Y3Vyc29yOnYyOpPPAAABb4CssdgBqjI5MjgwODA1ODM=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "ae660fe701c7d460a2311c3edc62003e5a6394df", "author": {"user": {"login": "mkouba", "name": "Martin Kouba"}}, "url": "https://github.com/quarkusio/quarkus/commit/ae660fe701c7d460a2311c3edc62003e5a6394df", "committedDate": "2020-01-06T21:07:43Z", "message": "ArC - optimize CreationalContext\n\n- do not always store all dependent instances in CC\n- also introduce io.quarkus.arc.InjectableInstance\n- resolves #5281"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzM5MTg1Njg3", "url": "https://github.com/quarkusio/quarkus/pull/6432#pullrequestreview-339185687", "createdAt": "2020-01-07T11:40:52Z", "commit": {"oid": "ae660fe701c7d460a2311c3edc62003e5a6394df"}, "state": "COMMENTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0wN1QxMTo0MDo1MlrOFa3G9A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0wN1QxMTo0MToyNFrOFa3HuQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2MzcxMDE5Ng==", "bodyText": "getActiveContext can return null if no context is active, we should probably check that.", "url": "https://github.com/quarkusio/quarkus/pull/6432#discussion_r363710196", "createdAt": "2020-01-07T11:40:52Z", "author": {"login": "manovotn"}, "path": "independent-projects/arc/runtime/src/main/java/io/quarkus/arc/impl/InstanceHandleImpl.java", "diffHunk": "@@ -61,10 +60,14 @@ public T get() {\n     @Override\n     public void destroy() {\n         if (instance != null && destroyed.compareAndSet(false, true)) {\n-            if (bean.getScope().equals(Dependent.class)) {\n-                destroyInternal();\n+            if (destroyLogic != null) {\n+                destroyLogic.accept(instance);\n             } else {\n-                Arc.container().getActiveContext(bean.getScope()).destroy(bean);\n+                if (bean.getScope().equals(Dependent.class)) {\n+                    destroyInternal();\n+                } else {\n+                    Arc.container().getActiveContext(bean.getScope()).destroy(bean);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ae660fe701c7d460a2311c3edc62003e5a6394df"}, "originalPosition": 56}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2MzcxMDM5Mw==", "bodyText": "Why Object, the instance should still be of type T, right?", "url": "https://github.com/quarkusio/quarkus/pull/6432#discussion_r363710393", "createdAt": "2020-01-07T11:41:24Z", "author": {"login": "manovotn"}, "path": "independent-projects/arc/runtime/src/main/java/io/quarkus/arc/impl/InstanceImpl.java", "diffHunk": "@@ -120,7 +113,7 @@ public boolean isAmbiguous() {\n     }\n \n     @Override\n-    public void destroy(T instance) {\n+    public void destroy(Object instance) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ae660fe701c7d460a2311c3edc62003e5a6394df"}, "originalPosition": 71}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzM5Mjc3MDgz", "url": "https://github.com/quarkusio/quarkus/pull/6432#pullrequestreview-339277083", "createdAt": "2020-01-07T14:42:04Z", "commit": {"oid": "f8ea605d0abd2d8deb21d0191ff84759d1b85a78"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "18ac748ce2ef2f8672a0f7cde9dc9e231dbdfa64", "author": {"user": {"login": "mkouba", "name": "Martin Kouba"}}, "url": "https://github.com/quarkusio/quarkus/commit/18ac748ce2ef2f8672a0f7cde9dc9e231dbdfa64", "committedDate": "2020-01-07T15:43:11Z", "message": "InstanceHandle#destroy - throw ContextNotActiveException if appropriate"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "f8ea605d0abd2d8deb21d0191ff84759d1b85a78", "author": {"user": {"login": "mkouba", "name": "Martin Kouba"}}, "url": "https://github.com/quarkusio/quarkus/commit/f8ea605d0abd2d8deb21d0191ff84759d1b85a78", "committedDate": "2020-01-07T14:31:51Z", "message": "InstanceHandle#destroy - throw ContextNotActiveException if appropriate"}, "afterCommit": {"oid": "18ac748ce2ef2f8672a0f7cde9dc9e231dbdfa64", "author": {"user": {"login": "mkouba", "name": "Martin Kouba"}}, "url": "https://github.com/quarkusio/quarkus/commit/18ac748ce2ef2f8672a0f7cde9dc9e231dbdfa64", "committedDate": "2020-01-07T15:43:11Z", "message": "InstanceHandle#destroy - throw ContextNotActiveException if appropriate"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 321, "cost": 1, "resetAt": "2021-11-01T16:37:27Z"}}}