{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0Mzg4MzUxMzI2", "number": 7866, "title": "RequestStreamHandler functionality added to Amazon Lambda", "bodyText": "Summary:\nAmazon Lambda extension currently only supports the interface RequestHandler.\nEnhance the extension, to enable the use of the interface RequestStreamHandler, so that both AWS Lambda interfaces are supported.\n#6707 requests this functionality.\nThe RequestStreamHandler can co-exist in a project with RequestHandler, and the active function toggled via the property quarkus.lambda.handler, as normal.  The requestHandler signature for the former has 3 params, the latter 2.\nValidated as working for NativeImage, via SAM and AWS.\nSpecifics:\nDeployment:\nAmazonLambdaBuildItem adds a flag to indicate whether the scanned requestHandler is of type RequestStreamHandler, since it was the only way I could determine this (tried lots of options not to modify this BuildItem class).\npublic AmazonLambdaBuildItem(String handlerClass, String name, boolean streamHandler) {\nVarious changes to AmazonLambdaProcessesor to recognise and process the RequestStreamHandler::requestHandler implementation.\nRuntime:\nAmazonLambdaRecorder has similar changes to accept the co-existance of the RequestStreamHandler::requestHandler implementation.\nOnly one lambda handler can be active, per the existing validation in chooseHandlerClass, thus the code is checking which one is present to determine how to branch.\nAdded a compatible integration test for the AmazonClient.invoke in the test-framework for Amazon Lambda.  I used this to test both.\nArchetype:\nAdded a StreamHandler to the archetype, to demonstrate you can have both in your project, and that you must use the @nAmed annotation along with the application.properties to select the active lambda function, per existing functionality.\nIn addition, I added test functionality to include the integration test for Amazon Lambda into the archetype, as that is an easy way for people to test their functions, and wasn't previously in the archetype.  For JVM, there is no need to use SAM when you have the integration test available (see issues with SAM for JVM #6701) which I continue to experience.\nTested by:\n\nmvn archetype:generate -DarchetypeGroupId=io.quarkus -DarchetypeArtifactId=quarkus-amazon-lambda-archetype -DarchetypeVersion=999-SNAPSHOT\nmvn package\nsh manage.sh create\nsh manage.sh invoke\nmvn package -Dnative -Dquarkus.native.container-build=true'\nsam local invoke --template sam.native.yaml --event payload.json\nsh manage.sh native create invoke\n(repeated toggling the application.property to swap handler type quarkus.lambda.handler)\n\n/cc @patriot1burke\n/cc @evanchooly\n/cc @bnusunny", "createdAt": "2020-03-14T16:08:29Z", "url": "https://github.com/quarkusio/quarkus/pull/7866", "merged": true, "mergeCommit": {"oid": "8a058ebf8f8dba53db0a85ab78ee075eb167dc63"}, "closed": true, "closedAt": "2020-03-15T19:05:11Z", "author": {"login": "oztimpower"}, "timelineItems": {"totalCount": 7, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcNowbmABqjMxMjk2NDA1MDU=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcN-V3tAFqTM3NDc1NDk0Mw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "4a56b27c0faad9e9f61a45f65081d32e2f911f32", "author": {"user": {"login": "oztimpower", "name": "Timothy Power"}}, "url": "https://github.com/quarkusio/quarkus/commit/4a56b27c0faad9e9f61a45f65081d32e2f911f32", "committedDate": "2020-03-14T15:34:30Z", "message": "Deployment changes for BuildSteps with RequestStreamHandler, and Runtime with AmazonLambdaRecorder"}, "afterCommit": {"oid": "4c9135c2cd9a79286b495079b64695b6f3ad1a0c", "author": {"user": {"login": "oztimpower", "name": "Timothy Power"}}, "url": "https://github.com/quarkusio/quarkus/commit/4c9135c2cd9a79286b495079b64695b6f3ad1a0c", "committedDate": "2020-03-14T17:54:06Z", "message": "Deployment changes for BuildSteps with RequestStreamHandler, and Runtime with AmazonLambdaRecorder"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzc0NzU0NzI1", "url": "https://github.com/quarkusio/quarkus/pull/7866#pullrequestreview-374754725", "createdAt": "2020-03-14T21:17:46Z", "commit": {"oid": "4c9135c2cd9a79286b495079b64695b6f3ad1a0c"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xNFQyMToxNzo0NlrOF2bn6w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xNFQyMToxNzo0NlrOF2bn6w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MjYyMDAxMQ==", "bodyText": "Remove commented code", "url": "https://github.com/quarkusio/quarkus/pull/7866#discussion_r392620011", "createdAt": "2020-03-14T21:17:46Z", "author": {"login": "patriot1burke"}, "path": "extensions/amazon-lambda/deployment/src/main/java/io/quarkus/amazon/lambda/deployment/AmazonLambdaProcessor.java", "diffHunk": "@@ -90,14 +96,18 @@ AdditionalApplicationArchiveMarkerBuildItem marker() {\n             }\n \n             final String lambda = name.toString();\n-            ret.add(new AmazonLambdaBuildItem(lambda, cdiName));\n+            //            ret.add(new AmazonLambdaBuildItem(lambda, cdiName));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "4c9135c2cd9a79286b495079b64695b6f3ad1a0c"}, "originalPosition": 32}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "4c9135c2cd9a79286b495079b64695b6f3ad1a0c", "author": {"user": {"login": "oztimpower", "name": "Timothy Power"}}, "url": "https://github.com/quarkusio/quarkus/commit/4c9135c2cd9a79286b495079b64695b6f3ad1a0c", "committedDate": "2020-03-14T17:54:06Z", "message": "Deployment changes for BuildSteps with RequestStreamHandler, and Runtime with AmazonLambdaRecorder"}, "afterCommit": {"oid": "0ebb11bd85291947d45dbfa5df67ff0a5b58ce07", "author": {"user": {"login": "oztimpower", "name": "Timothy Power"}}, "url": "https://github.com/quarkusio/quarkus/commit/0ebb11bd85291947d45dbfa5df67ff0a5b58ce07", "committedDate": "2020-03-14T23:02:47Z", "message": "Deployment changes for BuildSteps with RequestStreamHandler, and Runtime with AmazonLambdaRecorder"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "0ebb11bd85291947d45dbfa5df67ff0a5b58ce07", "author": {"user": {"login": "oztimpower", "name": "Timothy Power"}}, "url": "https://github.com/quarkusio/quarkus/commit/0ebb11bd85291947d45dbfa5df67ff0a5b58ce07", "committedDate": "2020-03-14T23:02:47Z", "message": "Deployment changes for BuildSteps with RequestStreamHandler, and Runtime with AmazonLambdaRecorder"}, "afterCommit": {"oid": "b9902f3e54033d7b884adfe17b65d76ad60f180f", "author": {"user": {"login": "oztimpower", "name": "Timothy Power"}}, "url": "https://github.com/quarkusio/quarkus/commit/b9902f3e54033d7b884adfe17b65d76ad60f180f", "committedDate": "2020-03-15T00:59:07Z", "message": "Deployment changes for BuildSteps with RequestStreamHandler, and Runtime with AmazonLambdaRecorder"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c4e4b11cfb6cf99a61159498543cabfce66284ea", "author": {"user": {"login": "oztimpower", "name": "Timothy Power"}}, "url": "https://github.com/quarkusio/quarkus/commit/c4e4b11cfb6cf99a61159498543cabfce66284ea", "committedDate": "2020-03-15T10:58:05Z", "message": "Deployment changes for BuildSteps with RequestStreamHandler, and Runtime with AmazonLambdaRecorder"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "b9902f3e54033d7b884adfe17b65d76ad60f180f", "author": {"user": {"login": "oztimpower", "name": "Timothy Power"}}, "url": "https://github.com/quarkusio/quarkus/commit/b9902f3e54033d7b884adfe17b65d76ad60f180f", "committedDate": "2020-03-15T00:59:07Z", "message": "Deployment changes for BuildSteps with RequestStreamHandler, and Runtime with AmazonLambdaRecorder"}, "afterCommit": {"oid": "c4e4b11cfb6cf99a61159498543cabfce66284ea", "author": {"user": {"login": "oztimpower", "name": "Timothy Power"}}, "url": "https://github.com/quarkusio/quarkus/commit/c4e4b11cfb6cf99a61159498543cabfce66284ea", "committedDate": "2020-03-15T10:58:05Z", "message": "Deployment changes for BuildSteps with RequestStreamHandler, and Runtime with AmazonLambdaRecorder"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzc0NzU0OTQz", "url": "https://github.com/quarkusio/quarkus/pull/7866#pullrequestreview-374754943", "createdAt": "2020-03-14T21:21:38Z", "commit": {"oid": "4c9135c2cd9a79286b495079b64695b6f3ad1a0c"}, "state": "APPROVED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xNFQyMToyMTozOFrOF2bo7g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xNFQyMToyMTozOFrOF2bo7g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MjYyMDI3MA==", "bodyText": "Should memory-size be different between JVM and Native?", "url": "https://github.com/quarkusio/quarkus/pull/7866#discussion_r392620270", "createdAt": "2020-03-14T21:21:38Z", "author": {"login": "patriot1burke"}, "path": "extensions/amazon-lambda/maven-archetype/src/main/resources/archetype-resources/manage.sh", "diffHunk": "@@ -9,7 +9,11 @@ function cmd_create() {\n     --handler ${HANDLER} \\\n     --runtime ${RUNTIME} \\\n     --role ${LAMBDA_ROLE_ARN} \\\n+    --timeout 15 \\\n+    --memory-size 256 \\", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "4c9135c2cd9a79286b495079b64695b6f3ad1a0c"}, "originalPosition": 5}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3894, "cost": 1, "resetAt": "2021-11-02T10:47:05Z"}}}