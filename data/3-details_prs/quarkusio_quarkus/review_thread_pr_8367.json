{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0Mzk3ODAxMTA3", "number": 8367, "reviewThreads": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wMlQyMTo1NzozMVrODuIjgw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wN1QxOToxNzo0OVrODvtJiA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjQ5NzAxMjUxOnYy", "diffSide": "RIGHT", "path": "extensions/funqy/funqy-knative/deployment/src/test/java/io/quarkus/funqy/test/GreetingFunctions.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wMlQyMTo1NzozMVrOF_98lw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wMlQyMTo1NzozMVrOF_98lw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMjYxOTU0Mw==", "bodyText": "Create a separate test for CompletionStage please, don't replace the old one.", "url": "https://github.com/quarkusio/quarkus/pull/8367#discussion_r402619543", "createdAt": "2020-04-02T21:57:31Z", "author": {"login": "patriot1burke"}, "path": "extensions/funqy/funqy-knative/deployment/src/test/java/io/quarkus/funqy/test/GreetingFunctions.java", "diffHunk": "@@ -9,12 +12,12 @@\n     GreetingService service;\n \n     @Funq\n-    public Greeting greet(Identity name) {\n+    public CompletionStage greet(Identity name) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "9d56ec791cf7eacee8aaef0a59fcc33e1d513be8"}, "originalPosition": 14}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjQ5NzAzMzM1OnYy", "diffSide": "RIGHT", "path": "extensions/funqy/funqy-server-common/runtime/src/main/java/io/quarkus/funqy/runtime/FunctionInvoker.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wMlQyMjowNDo1M1rOF_-JNw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wMlQyMjowNDo1M1rOF_-JNw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMjYyMjc3NQ==", "bodyText": "I think we need to require that the CompletionStage generic type be filled in.  Jackson Readers and Writers are initialized at static initialization time to speed up boot time for native.  I don't want to support dynamic marshalling of types.\nThe deployment code (@buildstep) should check that if it is a CompletionStage that the generic type is filled in.  Otherwise it should warn and abort the build.", "url": "https://github.com/quarkusio/quarkus/pull/8367#discussion_r402622775", "createdAt": "2020-04-02T22:04:53Z", "author": {"login": "patriot1burke"}, "path": "extensions/funqy/funqy-server-common/runtime/src/main/java/io/quarkus/funqy/runtime/FunctionInvoker.java", "diffHunk": "@@ -36,8 +37,19 @@ public FunctionInvoker(String name, Class targetClass, Method method) {\n             }\n         }\n         constructor = new FunctionConstructor(targetClass);\n-        if (method.getReturnType() != null) {\n-            outputType = method.getReturnType();\n+        Class rt = method.getReturnType();\n+        if (rt != null) {\n+            if (CompletionStage.class.isAssignableFrom(rt)) {\n+                try {\n+                    Type type = ((ParameterizedType) method.getGenericReturnType()).getActualTypeArguments()[0];\n+                    outputType = (Class) type;\n+                } catch (Exception ex) {\n+                    outputType = Object.class;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "9d56ec791cf7eacee8aaef0a59fcc33e1d513be8"}, "originalPosition": 36}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjUwOTc3MjA5OnYy", "diffSide": "RIGHT", "path": "extensions/funqy/funqy-knative/deployment/src/test/java/io/quarkus/funqy/test/GreetingFunctions.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wN1QwMDoxMjoxOFrOGBubhA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wN1QwMDoxMjoxOFrOGBubhA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNDQ2MjQ2OA==", "bodyText": "Do not delete the old synchronous function.  Write a new test for CompletionStage<> return value.  Also, please duplicate the separate CompletionStage test in Lambda and HTTP.", "url": "https://github.com/quarkusio/quarkus/pull/8367#discussion_r404462468", "createdAt": "2020-04-07T00:12:18Z", "author": {"login": "patriot1burke"}, "path": "extensions/funqy/funqy-knative/deployment/src/test/java/io/quarkus/funqy/test/GreetingFunctions.java", "diffHunk": "@@ -9,12 +15,25 @@\n     GreetingService service;\n \n     @Funq\n-    public Greeting greet(Identity name) {\n-        String message = service.hello(name.getName());\n-        Greeting greeting = new Greeting();\n-        greeting.setMessage(message);\n-        greeting.setName(name.getName());\n-        return greeting;\n+    public CompletionStage<Greeting> greet(Identity name) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "719221dfab7e149f04fe3850389ca000ae1642f9"}, "originalPosition": 22}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjUxMzQ5Mzg0OnYy", "diffSide": "RIGHT", "path": "extensions/funqy/funqy-server-common/runtime/src/main/java/io/quarkus/funqy/runtime/FunctionInvoker.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wN1QxOToxNzo0OVrOGCSc6w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wN1QxOToxNzo0OVrOGCSc6w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNTA1MjY1MQ==", "bodyText": "This error check should be done in a deployment @buildstep so it pops up at build time.", "url": "https://github.com/quarkusio/quarkus/pull/8367#discussion_r405052651", "createdAt": "2020-04-07T19:17:49Z", "author": {"login": "patriot1burke"}, "path": "extensions/funqy/funqy-server-common/runtime/src/main/java/io/quarkus/funqy/runtime/FunctionInvoker.java", "diffHunk": "@@ -41,16 +41,19 @@ public FunctionInvoker(String name, Class<?> targetClass, Method method) {\n         Class<?> returnType = method.getReturnType();\n         if (returnType != null) {\n             if (CompletionStage.class.isAssignableFrom(returnType)) {\n-                outputType = Object.class;\n+                outputType = null;\n                 isAsync = true;\n-\n                 Type genericReturnType = method.getGenericReturnType();\n                 if (genericReturnType instanceof ParameterizedType) {\n                     Type[] actualParams = ((ParameterizedType) genericReturnType).getActualTypeArguments();\n                     if (actualParams.length == 1 && actualParams[0] instanceof Class<?>) {\n                         outputType = (Class<?>) actualParams[0];\n                     }\n                 }\n+                if (outputType == null) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "3b5bd98e440f5140cef67b7a4ff2e05b159cf93b"}, "originalPosition": 15}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3621, "cost": 1, "resetAt": "2021-11-13T14:23:39Z"}}}