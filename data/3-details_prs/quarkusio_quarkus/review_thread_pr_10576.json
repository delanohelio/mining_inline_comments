{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDQ2Mjk5MDY2", "number": 10576, "reviewThreads": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wOFQxNTozMzoxNlrOEMiwrQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wOFQxNTozMzoxNlrOEMiwrQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjgxNTg3ODg1OnYy", "diffSide": "RIGHT", "path": "independent-projects/bootstrap/maven-resolver/src/main/java/io/quarkus/bootstrap/resolver/maven/workspace/LocalProject.java", "isResolved": true, "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wOFQxNTozMzoxNlrOGuttew==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wOFQxNTo0MzowNVrOGuuHew==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MTYzNjYwMw==", "bodyText": "This snippet can be replaced with:\n        private Model model(Path pomFile) throws BootstrapMavenException {\n            return cachedModels.computeIfEmpty(pomFile.getParent(), parent->readModel(pomFile));\n        }", "url": "https://github.com/quarkusio/quarkus/pull/10576#discussion_r451636603", "createdAt": "2020-07-08T15:33:16Z", "author": {"login": "gastaldi"}, "path": "independent-projects/bootstrap/maven-resolver/src/main/java/io/quarkus/bootstrap/resolver/maven/workspace/LocalProject.java", "diffHunk": "@@ -30,6 +31,124 @@\n     private static final String PROJECT_BASEDIR = \"${project.basedir}\";\n     private static final String POM_XML = \"pom.xml\";\n \n+    private static class WorkspaceLoader {\n+\n+        private final LocalWorkspace workspace = new LocalWorkspace();\n+        private final Map<Path, Model> cachedModels = new HashMap<>();\n+        private final Path currentProjectPom;\n+        private Path workspaceRootPom;\n+\n+        private WorkspaceLoader(Path currentProjectPom) throws BootstrapMavenException {\n+            this.currentProjectPom = isPom(currentProjectPom) ? currentProjectPom : locateCurrentProjectPom(currentProjectPom, true);\n+        }\n+\n+        private boolean isPom(Path p) {\n+            if (Files.exists(p) && !Files.isDirectory(p)) {\n+                try {\n+                    loadAndCache(p);\n+                    return true;\n+                } catch (BootstrapMavenException e) {\n+                    // not a POM file\n+                }\n+            }\n+            return false;\n+        }\n+\n+        private Model model(Path pomFile) throws BootstrapMavenException {\n+            Model model = cachedModels.get(pomFile.getParent());\n+            if(model == null) {\n+                model = loadAndCache(pomFile);\n+            }\n+            return model;\n+        }\n+\n+        private Model loadAndCache(Path pomFile) throws BootstrapMavenException {\n+            final Model model = readModel(pomFile);\n+            cachedModels.put(pomFile.getParent(), model);\n+            return model;\n+        }", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b07e455d5121f95f7a337d87f4824c95c7146fcd"}, "originalPosition": 57}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MTYzOTQxOQ==", "bodyText": "computeIfAbsent()? But then I'd have to catch the exception and re-throw a runtime one.", "url": "https://github.com/quarkusio/quarkus/pull/10576#discussion_r451639419", "createdAt": "2020-07-08T15:37:20Z", "author": {"login": "aloubyansky"}, "path": "independent-projects/bootstrap/maven-resolver/src/main/java/io/quarkus/bootstrap/resolver/maven/workspace/LocalProject.java", "diffHunk": "@@ -30,6 +31,124 @@\n     private static final String PROJECT_BASEDIR = \"${project.basedir}\";\n     private static final String POM_XML = \"pom.xml\";\n \n+    private static class WorkspaceLoader {\n+\n+        private final LocalWorkspace workspace = new LocalWorkspace();\n+        private final Map<Path, Model> cachedModels = new HashMap<>();\n+        private final Path currentProjectPom;\n+        private Path workspaceRootPom;\n+\n+        private WorkspaceLoader(Path currentProjectPom) throws BootstrapMavenException {\n+            this.currentProjectPom = isPom(currentProjectPom) ? currentProjectPom : locateCurrentProjectPom(currentProjectPom, true);\n+        }\n+\n+        private boolean isPom(Path p) {\n+            if (Files.exists(p) && !Files.isDirectory(p)) {\n+                try {\n+                    loadAndCache(p);\n+                    return true;\n+                } catch (BootstrapMavenException e) {\n+                    // not a POM file\n+                }\n+            }\n+            return false;\n+        }\n+\n+        private Model model(Path pomFile) throws BootstrapMavenException {\n+            Model model = cachedModels.get(pomFile.getParent());\n+            if(model == null) {\n+                model = loadAndCache(pomFile);\n+            }\n+            return model;\n+        }\n+\n+        private Model loadAndCache(Path pomFile) throws BootstrapMavenException {\n+            final Model model = readModel(pomFile);\n+            cachedModels.put(pomFile.getParent(), model);\n+            return model;\n+        }", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MTYzNjYwMw=="}, "originalCommit": {"oid": "b07e455d5121f95f7a337d87f4824c95c7146fcd"}, "originalPosition": 57}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MTY0MzI1OQ==", "bodyText": "Ah damn checked exceptions, you're right :(", "url": "https://github.com/quarkusio/quarkus/pull/10576#discussion_r451643259", "createdAt": "2020-07-08T15:43:05Z", "author": {"login": "gastaldi"}, "path": "independent-projects/bootstrap/maven-resolver/src/main/java/io/quarkus/bootstrap/resolver/maven/workspace/LocalProject.java", "diffHunk": "@@ -30,6 +31,124 @@\n     private static final String PROJECT_BASEDIR = \"${project.basedir}\";\n     private static final String POM_XML = \"pom.xml\";\n \n+    private static class WorkspaceLoader {\n+\n+        private final LocalWorkspace workspace = new LocalWorkspace();\n+        private final Map<Path, Model> cachedModels = new HashMap<>();\n+        private final Path currentProjectPom;\n+        private Path workspaceRootPom;\n+\n+        private WorkspaceLoader(Path currentProjectPom) throws BootstrapMavenException {\n+            this.currentProjectPom = isPom(currentProjectPom) ? currentProjectPom : locateCurrentProjectPom(currentProjectPom, true);\n+        }\n+\n+        private boolean isPom(Path p) {\n+            if (Files.exists(p) && !Files.isDirectory(p)) {\n+                try {\n+                    loadAndCache(p);\n+                    return true;\n+                } catch (BootstrapMavenException e) {\n+                    // not a POM file\n+                }\n+            }\n+            return false;\n+        }\n+\n+        private Model model(Path pomFile) throws BootstrapMavenException {\n+            Model model = cachedModels.get(pomFile.getParent());\n+            if(model == null) {\n+                model = loadAndCache(pomFile);\n+            }\n+            return model;\n+        }\n+\n+        private Model loadAndCache(Path pomFile) throws BootstrapMavenException {\n+            final Model model = readModel(pomFile);\n+            cachedModels.put(pomFile.getParent(), model);\n+            return model;\n+        }", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MTYzNjYwMw=="}, "originalCommit": {"oid": "b07e455d5121f95f7a337d87f4824c95c7146fcd"}, "originalPosition": 57}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2619, "cost": 1, "resetAt": "2021-11-13T14:23:39Z"}}}