{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDIyNjYyMjc1", "number": 9570, "title": "Support Charset in Quarkus Config - Use it in Hibernate", "bodyText": "Relates to: #9542\nAlso set the default charset for Hibernate to UTF-8", "createdAt": "2020-05-25T10:01:21Z", "url": "https://github.com/quarkusio/quarkus/pull/9570", "merged": true, "mergeCommit": {"oid": "eafe54b3625215c83c8b68df1d1f045e3f33bafb"}, "closed": true, "closedAt": "2020-05-26T11:16:29Z", "author": {"login": "geoand"}, "timelineItems": {"totalCount": 14, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABckt0EAgFqTQxNzYyODczNg==", "endCursor": "Y3Vyc29yOnYyOpPPAAABclAyX1AFqTQxODEwMDA2MQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDE3NjI4NzM2", "url": "https://github.com/quarkusio/quarkus/pull/9570#pullrequestreview-417628736", "createdAt": "2020-05-25T10:49:56Z", "commit": {"oid": "b610601ffe00a656c9258b8d02da60792b6feda8"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yNVQxMDo0OTo1NlrOGZ9KpQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yNVQxMDo0OTo1NlrOGZ9KpQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTg2OTczMw==", "bodyText": "Hello @geoand, perhaps this should just be defaulted to UTF-8 to remove the inconsistency of system level defaults? AFAIK, Java (in recent versions) too has started defaulting to UTF-8 for some of its IO APIs to avoid this system level inconsistencies.", "url": "https://github.com/quarkusio/quarkus/pull/9570#discussion_r429869733", "createdAt": "2020-05-25T10:49:56Z", "author": {"login": "jaikiran"}, "path": "extensions/hibernate-orm/deployment/src/main/java/io/quarkus/hibernate/orm/deployment/HibernateOrmConfig.java", "diffHunk": "@@ -75,6 +76,13 @@\n     @ConfigItem(defaultValueDocumentation = \"import.sql in DEV, TEST ; no-file otherwise\")\n     public Optional<String> sqlLoadScript;\n \n+    /**\n+     * The name of the charset used by the schema generation resource. Without specifying this configuration property, the JVM\n+     * default charset is used.\n+     */\n+    @ConfigItem(defaultValueDocumentation = \"JVM default charset\")\n+    public Optional<Charset> ddlCharset;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b610601ffe00a656c9258b8d02da60792b6feda8"}, "originalPosition": 16}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDE3Njg1NTc5", "url": "https://github.com/quarkusio/quarkus/pull/9570#pullrequestreview-417685579", "createdAt": "2020-05-25T12:43:17Z", "commit": {"oid": "b610601ffe00a656c9258b8d02da60792b6feda8"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yNVQxMjo0MzoxN1rOGZ_7yA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yNVQxMjo1NTo1NVrOGaAQWg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTkxNTA4MA==", "bodyText": "Maybe add a Unable to create Charset from: \" + value message? (JVM messages can be very obscure sometimes, not sure about that one)", "url": "https://github.com/quarkusio/quarkus/pull/9570#discussion_r429915080", "createdAt": "2020-05-25T12:43:17Z", "author": {"login": "gsmet"}, "path": "core/runtime/src/main/java/io/quarkus/runtime/configuration/CharsetConverter.java", "diffHunk": "@@ -0,0 +1,28 @@\n+package io.quarkus.runtime.configuration;\n+\n+import static io.quarkus.runtime.configuration.ConverterSupport.DEFAULT_QUARKUS_CONVERTER_PRIORITY;\n+\n+import java.io.Serializable;\n+import java.nio.charset.Charset;\n+\n+import javax.annotation.Priority;\n+\n+import org.eclipse.microprofile.config.spi.Converter;\n+\n+/**\n+ * A converter which converts a Charset string into an instance of {@link java.nio.charset.Charset}.\n+ */\n+@Priority(DEFAULT_QUARKUS_CONVERTER_PRIORITY)\n+public class CharsetConverter implements Converter<Charset>, Serializable {\n+\n+    private static final long serialVersionUID = 2320905063828247874L;\n+\n+    @Override\n+    public Charset convert(String value) {\n+        try {\n+            return Charset.forName(value);\n+        } catch (Exception e) {\n+            throw new IllegalArgumentException(e);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b610601ffe00a656c9258b8d02da60792b6feda8"}, "originalPosition": 25}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTkxOTkyNA==", "bodyText": "My inclination would be to go with UTF-8 by default too.\nI don't like the name though because it's not the DDL charset, it's the charset used for schema generation and the import scripts (or database initialization in general).", "url": "https://github.com/quarkusio/quarkus/pull/9570#discussion_r429919924", "createdAt": "2020-05-25T12:54:55Z", "author": {"login": "gsmet"}, "path": "extensions/hibernate-orm/deployment/src/main/java/io/quarkus/hibernate/orm/deployment/HibernateOrmConfig.java", "diffHunk": "@@ -75,6 +76,13 @@\n     @ConfigItem(defaultValueDocumentation = \"import.sql in DEV, TEST ; no-file otherwise\")\n     public Optional<String> sqlLoadScript;\n \n+    /**\n+     * The name of the charset used by the schema generation resource. Without specifying this configuration property, the JVM\n+     * default charset is used.\n+     */\n+    @ConfigItem(defaultValueDocumentation = \"JVM default charset\")\n+    public Optional<Charset> ddlCharset;", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTg2OTczMw=="}, "originalCommit": {"oid": "b610601ffe00a656c9258b8d02da60792b6feda8"}, "originalPosition": 16}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTkyMDM0Ng==", "bodyText": "So isn't it already implemented then? :]\n(have a look at the name of the property)", "url": "https://github.com/quarkusio/quarkus/pull/9570#discussion_r429920346", "createdAt": "2020-05-25T12:55:55Z", "author": {"login": "gsmet"}, "path": "extensions/hibernate-orm/deployment/src/main/java/io/quarkus/hibernate/orm/deployment/HibernateOrmProcessor.java", "diffHunk": "@@ -785,7 +785,7 @@ private void handleHibernateORMWithNoPersistenceXml(\n                 }\n \n                 hibernateConfig.database.charset.ifPresent(\n-                        charset -> desc.getProperties().setProperty(AvailableSettings.HBM2DDL_CHARSET_NAME, charset));\n+                        charset -> desc.getProperties().setProperty(AvailableSettings.HBM2DDL_CHARSET_NAME, charset.name()));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b610601ffe00a656c9258b8d02da60792b6feda8"}, "originalPosition": 5}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "b610601ffe00a656c9258b8d02da60792b6feda8", "author": {"user": {"login": "geoand", "name": "Georgios Andrianakis"}}, "url": "https://github.com/quarkusio/quarkus/commit/b610601ffe00a656c9258b8d02da60792b6feda8", "committedDate": "2020-05-25T09:59:36Z", "message": "Add support for Charset in Quarkus config objects"}, "afterCommit": {"oid": "a957a10b11405da56e0f0afd51df20af43cb01fb", "author": {"user": {"login": "geoand", "name": "Georgios Andrianakis"}}, "url": "https://github.com/quarkusio/quarkus/commit/a957a10b11405da56e0f0afd51df20af43cb01fb", "committedDate": "2020-05-25T13:13:36Z", "message": "Use Charset in HibernateOrmConfig and default to UTF-8"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDE3NzA2MjAw", "url": "https://github.com/quarkusio/quarkus/pull/9570#pullrequestreview-417706200", "createdAt": "2020-05-25T13:20:03Z", "commit": {"oid": "a957a10b11405da56e0f0afd51df20af43cb01fb"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yNVQxMzoyMDowM1rOGaA6MA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yNVQxMzoyMDowM1rOGaA6MA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTkzMTA1Ng==", "bodyText": "So let's not make it an Optional anymore.", "url": "https://github.com/quarkusio/quarkus/pull/9570#discussion_r429931056", "createdAt": "2020-05-25T13:20:03Z", "author": {"login": "gsmet"}, "path": "extensions/hibernate-orm/deployment/src/main/java/io/quarkus/hibernate/orm/deployment/HibernateOrmConfig.java", "diffHunk": "@@ -250,8 +253,8 @@ public boolean isAnyPropertySet() {\n         /**\n          * The charset of the database.\n          */\n-        @ConfigItem\n-        public Optional<String> charset;\n+        @ConfigItem(defaultValue = \"UTF-8\")\n+        public Optional<Charset> charset;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a957a10b11405da56e0f0afd51df20af43cb01fb"}, "originalPosition": 23}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDE3NzA2ODQz", "url": "https://github.com/quarkusio/quarkus/pull/9570#pullrequestreview-417706843", "createdAt": "2020-05-25T13:21:10Z", "commit": {"oid": "a957a10b11405da56e0f0afd51df20af43cb01fb"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yNVQxMzoyMToxMFrOGaA8QA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yNVQxMzoyMToxMFrOGaA8QA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTkzMTU4NA==", "bodyText": "Maybe add to the doc:\n<p>\nUsed for DDL generation and also for the SQL import scripts.", "url": "https://github.com/quarkusio/quarkus/pull/9570#discussion_r429931584", "createdAt": "2020-05-25T13:21:10Z", "author": {"login": "gsmet"}, "path": "extensions/hibernate-orm/deployment/src/main/java/io/quarkus/hibernate/orm/deployment/HibernateOrmConfig.java", "diffHunk": "@@ -250,8 +253,8 @@ public boolean isAnyPropertySet() {\n         /**\n          * The charset of the database.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a957a10b11405da56e0f0afd51df20af43cb01fb"}, "originalPosition": 18}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "a957a10b11405da56e0f0afd51df20af43cb01fb", "author": {"user": {"login": "geoand", "name": "Georgios Andrianakis"}}, "url": "https://github.com/quarkusio/quarkus/commit/a957a10b11405da56e0f0afd51df20af43cb01fb", "committedDate": "2020-05-25T13:13:36Z", "message": "Use Charset in HibernateOrmConfig and default to UTF-8"}, "afterCommit": {"oid": "e958ebada3a43597ba6ff5c073705d7946cb1daf", "author": {"user": {"login": "geoand", "name": "Georgios Andrianakis"}}, "url": "https://github.com/quarkusio/quarkus/commit/e958ebada3a43597ba6ff5c073705d7946cb1daf", "committedDate": "2020-05-25T13:22:10Z", "message": "Use Charset in HibernateOrmConfig and default to UTF-8"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "e958ebada3a43597ba6ff5c073705d7946cb1daf", "author": {"user": {"login": "geoand", "name": "Georgios Andrianakis"}}, "url": "https://github.com/quarkusio/quarkus/commit/e958ebada3a43597ba6ff5c073705d7946cb1daf", "committedDate": "2020-05-25T13:22:10Z", "message": "Use Charset in HibernateOrmConfig and default to UTF-8"}, "afterCommit": {"oid": "a97554572747a8eb5ae289f6b96144be8a3726cc", "author": {"user": {"login": "geoand", "name": "Georgios Andrianakis"}}, "url": "https://github.com/quarkusio/quarkus/commit/a97554572747a8eb5ae289f6b96144be8a3726cc", "committedDate": "2020-05-25T13:24:53Z", "message": "Use Charset in HibernateOrmConfig and default to UTF-8"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "a97554572747a8eb5ae289f6b96144be8a3726cc", "author": {"user": {"login": "geoand", "name": "Georgios Andrianakis"}}, "url": "https://github.com/quarkusio/quarkus/commit/a97554572747a8eb5ae289f6b96144be8a3726cc", "committedDate": "2020-05-25T13:24:53Z", "message": "Use Charset in HibernateOrmConfig and default to UTF-8"}, "afterCommit": {"oid": "53def9ffdec28566edf95bdc6ab2a2fe0fa9dc96", "author": {"user": {"login": "geoand", "name": "Georgios Andrianakis"}}, "url": "https://github.com/quarkusio/quarkus/commit/53def9ffdec28566edf95bdc6ab2a2fe0fa9dc96", "committedDate": "2020-05-26T07:18:49Z", "message": "Use Charset in HibernateOrmConfig and default to UTF-8"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "53def9ffdec28566edf95bdc6ab2a2fe0fa9dc96", "author": {"user": {"login": "geoand", "name": "Georgios Andrianakis"}}, "url": "https://github.com/quarkusio/quarkus/commit/53def9ffdec28566edf95bdc6ab2a2fe0fa9dc96", "committedDate": "2020-05-26T07:18:49Z", "message": "Use Charset in HibernateOrmConfig and default to UTF-8"}, "afterCommit": {"oid": "f594dd68f89f73a3e47f58d4a5860f25f5e8213e", "author": {"user": {"login": "geoand", "name": "Georgios Andrianakis"}}, "url": "https://github.com/quarkusio/quarkus/commit/f594dd68f89f73a3e47f58d4a5860f25f5e8213e", "committedDate": "2020-05-26T08:41:33Z", "message": "Use Charset in HibernateOrmConfig and default to UTF-8"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "f594dd68f89f73a3e47f58d4a5860f25f5e8213e", "author": {"user": {"login": "geoand", "name": "Georgios Andrianakis"}}, "url": "https://github.com/quarkusio/quarkus/commit/f594dd68f89f73a3e47f58d4a5860f25f5e8213e", "committedDate": "2020-05-26T08:41:33Z", "message": "Use Charset in HibernateOrmConfig and default to UTF-8"}, "afterCommit": {"oid": "7e8875a8da3194ef90bdb769429f99863811bb1a", "author": {"user": {"login": "geoand", "name": "Georgios Andrianakis"}}, "url": "https://github.com/quarkusio/quarkus/commit/7e8875a8da3194ef90bdb769429f99863811bb1a", "committedDate": "2020-05-26T08:42:15Z", "message": "Use Charset in HibernateOrmConfig and default to UTF-8"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ceba39c03b300d779c35413c65528b87fca90253", "author": {"user": {"login": "geoand", "name": "Georgios Andrianakis"}}, "url": "https://github.com/quarkusio/quarkus/commit/ceba39c03b300d779c35413c65528b87fca90253", "committedDate": "2020-05-26T08:42:49Z", "message": "Add support for Charset in Quarkus Config system"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "94256b9c08f7b25d4d80f4b10147877382e3c498", "author": {"user": {"login": "geoand", "name": "Georgios Andrianakis"}}, "url": "https://github.com/quarkusio/quarkus/commit/94256b9c08f7b25d4d80f4b10147877382e3c498", "committedDate": "2020-05-26T08:42:49Z", "message": "Use Charset in HibernateOrmConfig and default to UTF-8"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "7e8875a8da3194ef90bdb769429f99863811bb1a", "author": {"user": {"login": "geoand", "name": "Georgios Andrianakis"}}, "url": "https://github.com/quarkusio/quarkus/commit/7e8875a8da3194ef90bdb769429f99863811bb1a", "committedDate": "2020-05-26T08:42:15Z", "message": "Use Charset in HibernateOrmConfig and default to UTF-8"}, "afterCommit": {"oid": "94256b9c08f7b25d4d80f4b10147877382e3c498", "author": {"user": {"login": "geoand", "name": "Georgios Andrianakis"}}, "url": "https://github.com/quarkusio/quarkus/commit/94256b9c08f7b25d4d80f4b10147877382e3c498", "committedDate": "2020-05-26T08:42:49Z", "message": "Use Charset in HibernateOrmConfig and default to UTF-8"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDE4MTAwMDYx", "url": "https://github.com/quarkusio/quarkus/pull/9570#pullrequestreview-418100061", "createdAt": "2020-05-26T08:56:18Z", "commit": {"oid": "94256b9c08f7b25d4d80f4b10147877382e3c498"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3191, "cost": 1, "resetAt": "2021-11-02T10:47:05Z"}}}