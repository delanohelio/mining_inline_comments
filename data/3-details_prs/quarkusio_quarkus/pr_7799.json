{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0Mzg2OTgwOTMw", "number": 7799, "title": "Fix intermittent windows failures", "bodyText": "Fixes #7643", "createdAt": "2020-03-12T00:26:04Z", "url": "https://github.com/quarkusio/quarkus/pull/7799", "merged": true, "mergeCommit": {"oid": "7d9ded174bae1e52670d5fc0e5e9eb9bef38a053"}, "closed": true, "closedAt": "2020-03-12T11:31:16Z", "author": {"login": "stuartwdouglas"}, "timelineItems": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcMwkmyABqjMxMjA5OTkzMDk=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcM49fIgFqTM3MzQyNjU4Mg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "895a6d3b9773d7db2afd521e1a10436635ed61f1", "author": {"user": {"login": "stuartwdouglas", "name": "Stuart Douglas"}}, "url": "https://github.com/quarkusio/quarkus/commit/895a6d3b9773d7db2afd521e1a10436635ed61f1", "committedDate": "2020-03-12T00:23:34Z", "message": "Fix intermittent windows failures\n\nFixes #7643"}, "afterCommit": {"oid": "9fde13441484357bef80061bc2a691e1da34a94f", "author": {"user": {"login": "stuartwdouglas", "name": "Stuart Douglas"}}, "url": "https://github.com/quarkusio/quarkus/commit/9fde13441484357bef80061bc2a691e1da34a94f", "committedDate": "2020-03-12T00:27:26Z", "message": "Fix intermittent windows failures\n\nFixes #7643"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzczMzI1NDE1", "url": "https://github.com/quarkusio/quarkus/pull/7799#pullrequestreview-373325415", "createdAt": "2020-03-12T07:26:10Z", "commit": {"oid": "9fde13441484357bef80061bc2a691e1da34a94f"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xMlQwNzoyNjoxMVrOF1TlIQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xMlQwNzoyNjoxMVrOF1TlIQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MTQzOTY0OQ==", "bodyText": "I don't really understand this, why sleep when the timeout has been exceeded and not just throw the exception right away?", "url": "https://github.com/quarkusio/quarkus/pull/7799#discussion_r391439649", "createdAt": "2020-03-12T07:26:11Z", "author": {"login": "geoand"}, "path": "test-framework/junit5-internal/src/main/java/io/quarkus/test/QuarkusDevModeTest.java", "diffHunk": "@@ -404,10 +404,27 @@ public void addResourceFile(String path, byte[] data) {\n      */\n     public void deleteResourceFile(String path) {\n         final Path resourceFilePath = deploymentResourcePath.resolve(path);\n-        try {\n-            Files.delete(resourceFilePath);\n-        } catch (IOException e) {\n-            throw new UncheckedIOException(e);\n+        long timeout = System.currentTimeMillis() + 5000;\n+        //in general there is a potential race here\n+        //if you serve a file you will send the data to the client, then close the resource\n+        //this means that by the time the client request is run the file may not \n+        //have been closed yet, as the test sees the response as being complete after the last data is send\n+        //we wait up to 5s for this condition to be resolved\n+        for (;;) {\n+            try {\n+                Files.delete(resourceFilePath);\n+                break;\n+            } catch (IOException e) {\n+                if (System.currentTimeMillis() < timeout) {\n+                    continue;\n+                }\n+                try {\n+                    Thread.sleep(50);\n+                } catch (InterruptedException ex) {\n+                    //ignore\n+                }", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "9fde13441484357bef80061bc2a691e1da34a94f"}, "originalPosition": 26}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "5353234275cb6f19c40b60c8483af746acc69fff", "author": {"user": {"login": "stuartwdouglas", "name": "Stuart Douglas"}}, "url": "https://github.com/quarkusio/quarkus/commit/5353234275cb6f19c40b60c8483af746acc69fff", "committedDate": "2020-03-12T10:02:47Z", "message": "Fix intermittent windows failures\n\nFixes #7643"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "9fde13441484357bef80061bc2a691e1da34a94f", "author": {"user": {"login": "stuartwdouglas", "name": "Stuart Douglas"}}, "url": "https://github.com/quarkusio/quarkus/commit/9fde13441484357bef80061bc2a691e1da34a94f", "committedDate": "2020-03-12T00:27:26Z", "message": "Fix intermittent windows failures\n\nFixes #7643"}, "afterCommit": {"oid": "5353234275cb6f19c40b60c8483af746acc69fff", "author": {"user": {"login": "stuartwdouglas", "name": "Stuart Douglas"}}, "url": "https://github.com/quarkusio/quarkus/commit/5353234275cb6f19c40b60c8483af746acc69fff", "committedDate": "2020-03-12T10:02:47Z", "message": "Fix intermittent windows failures\n\nFixes #7643"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzczNDI2NTgy", "url": "https://github.com/quarkusio/quarkus/pull/7799#pullrequestreview-373426582", "createdAt": "2020-03-12T10:15:01Z", "commit": {"oid": "5353234275cb6f19c40b60c8483af746acc69fff"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3842, "cost": 1, "resetAt": "2021-11-02T10:47:05Z"}}}