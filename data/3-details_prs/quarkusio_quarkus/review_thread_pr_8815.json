{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDA4NDE5NjEx", "number": 8815, "reviewThreads": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yNFQwOToxNjoyNFrOD1rWpg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yNFQwOTozNzozNVrOD1r6Lg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjU3NjExNDMwOnYy", "diffSide": "RIGHT", "path": "extensions/kubernetes/vanilla/deployment/src/main/java/io/quarkus/kubernetes/deployment/KubernetesProcessor.java", "isResolved": true, "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yNFQwOToxNjoyNFrOGLOcxA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yNFQwOToyMTo1MFrOGLOq9A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNDQyNDI2MA==", "bodyText": "Should inline the determineImagePullPolicy call like the subsequent applyConfig calls do?", "url": "https://github.com/quarkusio/quarkus/pull/8815#discussion_r414424260", "createdAt": "2020-04-24T09:16:24Z", "author": {"login": "Ladicek"}, "path": "extensions/kubernetes/vanilla/deployment/src/main/java/io/quarkus/kubernetes/deployment/KubernetesProcessor.java", "diffHunk": "@@ -225,10 +230,13 @@ public void build(ApplicationInfoBuildItem applicationInfo,\n         //Apply configuration\n         applyGlobalConfig(session, kubernetesConfig);\n         ZonedDateTime now = ZonedDateTime.now(ZoneOffset.UTC);\n+        ImagePullPolicy imagePullPolicy = determineImagePullPolicy(kubernetesConfig, containerImage, capabilities);\n         applyConfig(session, project, KUBERNETES, getResourceName(kubernetesConfig, applicationInfo), kubernetesConfig,", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "de7177bf438c5921395dca6fbea35d2367d7ff30"}, "originalPosition": 38}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNDQyNzE2OA==", "bodyText": "Yeah, that makes sense.", "url": "https://github.com/quarkusio/quarkus/pull/8815#discussion_r414427168", "createdAt": "2020-04-24T09:20:49Z", "author": {"login": "geoand"}, "path": "extensions/kubernetes/vanilla/deployment/src/main/java/io/quarkus/kubernetes/deployment/KubernetesProcessor.java", "diffHunk": "@@ -225,10 +230,13 @@ public void build(ApplicationInfoBuildItem applicationInfo,\n         //Apply configuration\n         applyGlobalConfig(session, kubernetesConfig);\n         ZonedDateTime now = ZonedDateTime.now(ZoneOffset.UTC);\n+        ImagePullPolicy imagePullPolicy = determineImagePullPolicy(kubernetesConfig, containerImage, capabilities);\n         applyConfig(session, project, KUBERNETES, getResourceName(kubernetesConfig, applicationInfo), kubernetesConfig,", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNDQyNDI2MA=="}, "originalCommit": {"oid": "de7177bf438c5921395dca6fbea35d2367d7ff30"}, "originalPosition": 38}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNDQyNzg5Mg==", "bodyText": "I must have missed it, thanks for pointing it out :)", "url": "https://github.com/quarkusio/quarkus/pull/8815#discussion_r414427892", "createdAt": "2020-04-24T09:21:50Z", "author": {"login": "geoand"}, "path": "extensions/kubernetes/vanilla/deployment/src/main/java/io/quarkus/kubernetes/deployment/KubernetesProcessor.java", "diffHunk": "@@ -225,10 +230,13 @@ public void build(ApplicationInfoBuildItem applicationInfo,\n         //Apply configuration\n         applyGlobalConfig(session, kubernetesConfig);\n         ZonedDateTime now = ZonedDateTime.now(ZoneOffset.UTC);\n+        ImagePullPolicy imagePullPolicy = determineImagePullPolicy(kubernetesConfig, containerImage, capabilities);\n         applyConfig(session, project, KUBERNETES, getResourceName(kubernetesConfig, applicationInfo), kubernetesConfig,", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNDQyNDI2MA=="}, "originalCommit": {"oid": "de7177bf438c5921395dca6fbea35d2367d7ff30"}, "originalPosition": 38}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjU3NjIwNTI2OnYy", "diffSide": "RIGHT", "path": "extensions/kubernetes/vanilla/deployment/src/main/java/io/quarkus/kubernetes/deployment/KubernetesProcessor.java", "isResolved": false, "comments": {"totalCount": 13, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yNFQwOTozNzozNVrOGLPSOQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yNFQxMToxMDo1NlrOGLSpXQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNDQzNzk0NQ==", "bodyText": "I don't really get the purpose of calling kubernetesDeploy.getAsBoolean().\nWhatever the reason, this needs to change, as this call is performing an actual request to kubernetes. This should never be the case when generating resources. Generated resources should be the same regardless of the if and what is the configured environment on the user side.", "url": "https://github.com/quarkusio/quarkus/pull/8815#discussion_r414437945", "createdAt": "2020-04-24T09:37:35Z", "author": {"login": "iocanel"}, "path": "extensions/kubernetes/vanilla/deployment/src/main/java/io/quarkus/kubernetes/deployment/KubernetesProcessor.java", "diffHunk": "@@ -391,6 +399,22 @@ private void applyConfig(Session session, Project project, String target, String\n         });\n     }\n \n+    /**\n+     * When there is no registry defined and s2i isn't being used, the only ImagePullPolicy that can work is 'IfNotPresent'.\n+     * This case comes up when users want to deploy their application to a cluster like Minikube where no registry is used\n+     * and instead they rely on the image being built directly into the docker daemon that the cluster uses.\n+     */\n+    private ImagePullPolicy determineImagePullPolicy(PlatformConfiguration config,\n+            Optional<ContainerImageInfoBuildItem> containerImage, Capabilities capabilities) {\n+        ImagePullPolicy imagePullPolicy = config.getImagePullPolicy();\n+        if (containerImage.isPresent()\n+                && ContainerImageUtil.isRegistryMissingAndNotS2I(capabilities, containerImage.get())\n+                && kubernetesDeploy.getAsBoolean()) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "12ba684fc7074138b347b51b41e654c3cebf8e16"}, "originalPosition": 91}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNDQzOTYyMQ==", "bodyText": "The idea is that the resource only changes if you are actually deploying, if you are not deploying you get what you configured.\nI think it's the best compromise.", "url": "https://github.com/quarkusio/quarkus/pull/8815#discussion_r414439621", "createdAt": "2020-04-24T09:40:13Z", "author": {"login": "geoand"}, "path": "extensions/kubernetes/vanilla/deployment/src/main/java/io/quarkus/kubernetes/deployment/KubernetesProcessor.java", "diffHunk": "@@ -391,6 +399,22 @@ private void applyConfig(Session session, Project project, String target, String\n         });\n     }\n \n+    /**\n+     * When there is no registry defined and s2i isn't being used, the only ImagePullPolicy that can work is 'IfNotPresent'.\n+     * This case comes up when users want to deploy their application to a cluster like Minikube where no registry is used\n+     * and instead they rely on the image being built directly into the docker daemon that the cluster uses.\n+     */\n+    private ImagePullPolicy determineImagePullPolicy(PlatformConfiguration config,\n+            Optional<ContainerImageInfoBuildItem> containerImage, Capabilities capabilities) {\n+        ImagePullPolicy imagePullPolicy = config.getImagePullPolicy();\n+        if (containerImage.isPresent()\n+                && ContainerImageUtil.isRegistryMissingAndNotS2I(capabilities, containerImage.get())\n+                && kubernetesDeploy.getAsBoolean()) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNDQzNzk0NQ=="}, "originalCommit": {"oid": "12ba684fc7074138b347b51b41e654c3cebf8e16"}, "originalPosition": 91}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNDQ0MzA5Mw==", "bodyText": "I would rather decorate what we deploy rather than the physical generated file.", "url": "https://github.com/quarkusio/quarkus/pull/8815#discussion_r414443093", "createdAt": "2020-04-24T09:45:40Z", "author": {"login": "iocanel"}, "path": "extensions/kubernetes/vanilla/deployment/src/main/java/io/quarkus/kubernetes/deployment/KubernetesProcessor.java", "diffHunk": "@@ -391,6 +399,22 @@ private void applyConfig(Session session, Project project, String target, String\n         });\n     }\n \n+    /**\n+     * When there is no registry defined and s2i isn't being used, the only ImagePullPolicy that can work is 'IfNotPresent'.\n+     * This case comes up when users want to deploy their application to a cluster like Minikube where no registry is used\n+     * and instead they rely on the image being built directly into the docker daemon that the cluster uses.\n+     */\n+    private ImagePullPolicy determineImagePullPolicy(PlatformConfiguration config,\n+            Optional<ContainerImageInfoBuildItem> containerImage, Capabilities capabilities) {\n+        ImagePullPolicy imagePullPolicy = config.getImagePullPolicy();\n+        if (containerImage.isPresent()\n+                && ContainerImageUtil.isRegistryMissingAndNotS2I(capabilities, containerImage.get())\n+                && kubernetesDeploy.getAsBoolean()) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNDQzNzk0NQ=="}, "originalCommit": {"oid": "12ba684fc7074138b347b51b41e654c3cebf8e16"}, "originalPosition": 91}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNDQ1Mzg0Ng==", "bodyText": "That sounds weird to me. -Dquarkus.kubernetes.deploy=true should, in my opinion, be the same as kubectl apply -f target/kubernetes/kubernetes.yml. Why not do this always?", "url": "https://github.com/quarkusio/quarkus/pull/8815#discussion_r414453846", "createdAt": "2020-04-24T10:02:44Z", "author": {"login": "Ladicek"}, "path": "extensions/kubernetes/vanilla/deployment/src/main/java/io/quarkus/kubernetes/deployment/KubernetesProcessor.java", "diffHunk": "@@ -391,6 +399,22 @@ private void applyConfig(Session session, Project project, String target, String\n         });\n     }\n \n+    /**\n+     * When there is no registry defined and s2i isn't being used, the only ImagePullPolicy that can work is 'IfNotPresent'.\n+     * This case comes up when users want to deploy their application to a cluster like Minikube where no registry is used\n+     * and instead they rely on the image being built directly into the docker daemon that the cluster uses.\n+     */\n+    private ImagePullPolicy determineImagePullPolicy(PlatformConfiguration config,\n+            Optional<ContainerImageInfoBuildItem> containerImage, Capabilities capabilities) {\n+        ImagePullPolicy imagePullPolicy = config.getImagePullPolicy();\n+        if (containerImage.isPresent()\n+                && ContainerImageUtil.isRegistryMissingAndNotS2I(capabilities, containerImage.get())\n+                && kubernetesDeploy.getAsBoolean()) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNDQzNzk0NQ=="}, "originalCommit": {"oid": "12ba684fc7074138b347b51b41e654c3cebf8e16"}, "originalPosition": 91}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNDQ1ODkwMg==", "bodyText": "I agree with @Ladicek. If it's not the same thing, I think users will be very confused", "url": "https://github.com/quarkusio/quarkus/pull/8815#discussion_r414458902", "createdAt": "2020-04-24T10:10:50Z", "author": {"login": "geoand"}, "path": "extensions/kubernetes/vanilla/deployment/src/main/java/io/quarkus/kubernetes/deployment/KubernetesProcessor.java", "diffHunk": "@@ -391,6 +399,22 @@ private void applyConfig(Session session, Project project, String target, String\n         });\n     }\n \n+    /**\n+     * When there is no registry defined and s2i isn't being used, the only ImagePullPolicy that can work is 'IfNotPresent'.\n+     * This case comes up when users want to deploy their application to a cluster like Minikube where no registry is used\n+     * and instead they rely on the image being built directly into the docker daemon that the cluster uses.\n+     */\n+    private ImagePullPolicy determineImagePullPolicy(PlatformConfiguration config,\n+            Optional<ContainerImageInfoBuildItem> containerImage, Capabilities capabilities) {\n+        ImagePullPolicy imagePullPolicy = config.getImagePullPolicy();\n+        if (containerImage.isPresent()\n+                && ContainerImageUtil.isRegistryMissingAndNotS2I(capabilities, containerImage.get())\n+                && kubernetesDeploy.getAsBoolean()) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNDQzNzk0NQ=="}, "originalCommit": {"oid": "12ba684fc7074138b347b51b41e654c3cebf8e16"}, "originalPosition": 91}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNDQ2MTY4MA==", "bodyText": "The idea for me is to surprise users the least. With the proposed PR, users get an indicative warning message and they can inspect what was generated.\nHaving what is deployed different from what is generated would cause a lot of surprise I think.", "url": "https://github.com/quarkusio/quarkus/pull/8815#discussion_r414461680", "createdAt": "2020-04-24T10:15:25Z", "author": {"login": "geoand"}, "path": "extensions/kubernetes/vanilla/deployment/src/main/java/io/quarkus/kubernetes/deployment/KubernetesProcessor.java", "diffHunk": "@@ -391,6 +399,22 @@ private void applyConfig(Session session, Project project, String target, String\n         });\n     }\n \n+    /**\n+     * When there is no registry defined and s2i isn't being used, the only ImagePullPolicy that can work is 'IfNotPresent'.\n+     * This case comes up when users want to deploy their application to a cluster like Minikube where no registry is used\n+     * and instead they rely on the image being built directly into the docker daemon that the cluster uses.\n+     */\n+    private ImagePullPolicy determineImagePullPolicy(PlatformConfiguration config,\n+            Optional<ContainerImageInfoBuildItem> containerImage, Capabilities capabilities) {\n+        ImagePullPolicy imagePullPolicy = config.getImagePullPolicy();\n+        if (containerImage.isPresent()\n+                && ContainerImageUtil.isRegistryMissingAndNotS2I(capabilities, containerImage.get())\n+                && kubernetesDeploy.getAsBoolean()) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNDQzNzk0NQ=="}, "originalCommit": {"oid": "12ba684fc7074138b347b51b41e654c3cebf8e16"}, "originalPosition": 91}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNDQ2MzU5MA==", "bodyText": "I was trying to ask, why not remove the && kubernetesDeploy.getAsBoolean() condition. What is it good for?", "url": "https://github.com/quarkusio/quarkus/pull/8815#discussion_r414463590", "createdAt": "2020-04-24T10:18:38Z", "author": {"login": "Ladicek"}, "path": "extensions/kubernetes/vanilla/deployment/src/main/java/io/quarkus/kubernetes/deployment/KubernetesProcessor.java", "diffHunk": "@@ -391,6 +399,22 @@ private void applyConfig(Session session, Project project, String target, String\n         });\n     }\n \n+    /**\n+     * When there is no registry defined and s2i isn't being used, the only ImagePullPolicy that can work is 'IfNotPresent'.\n+     * This case comes up when users want to deploy their application to a cluster like Minikube where no registry is used\n+     * and instead they rely on the image being built directly into the docker daemon that the cluster uses.\n+     */\n+    private ImagePullPolicy determineImagePullPolicy(PlatformConfiguration config,\n+            Optional<ContainerImageInfoBuildItem> containerImage, Capabilities capabilities) {\n+        ImagePullPolicy imagePullPolicy = config.getImagePullPolicy();\n+        if (containerImage.isPresent()\n+                && ContainerImageUtil.isRegistryMissingAndNotS2I(capabilities, containerImage.get())\n+                && kubernetesDeploy.getAsBoolean()) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNDQzNzk0NQ=="}, "originalCommit": {"oid": "12ba684fc7074138b347b51b41e654c3cebf8e16"}, "originalPosition": 91}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNDQ2NTA2Nw==", "bodyText": "My idea is to only change the policy when we absolutely have to - which is only when deploying. A user may for some reason want to just generate the resources and in that case I don't see why we should change it.\nIt's an edge case, so I am happy to go either way", "url": "https://github.com/quarkusio/quarkus/pull/8815#discussion_r414465067", "createdAt": "2020-04-24T10:21:08Z", "author": {"login": "geoand"}, "path": "extensions/kubernetes/vanilla/deployment/src/main/java/io/quarkus/kubernetes/deployment/KubernetesProcessor.java", "diffHunk": "@@ -391,6 +399,22 @@ private void applyConfig(Session session, Project project, String target, String\n         });\n     }\n \n+    /**\n+     * When there is no registry defined and s2i isn't being used, the only ImagePullPolicy that can work is 'IfNotPresent'.\n+     * This case comes up when users want to deploy their application to a cluster like Minikube where no registry is used\n+     * and instead they rely on the image being built directly into the docker daemon that the cluster uses.\n+     */\n+    private ImagePullPolicy determineImagePullPolicy(PlatformConfiguration config,\n+            Optional<ContainerImageInfoBuildItem> containerImage, Capabilities capabilities) {\n+        ImagePullPolicy imagePullPolicy = config.getImagePullPolicy();\n+        if (containerImage.isPresent()\n+                && ContainerImageUtil.isRegistryMissingAndNotS2I(capabilities, containerImage.get())\n+                && kubernetesDeploy.getAsBoolean()) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNDQzNzk0NQ=="}, "originalCommit": {"oid": "12ba684fc7074138b347b51b41e654c3cebf8e16"}, "originalPosition": 91}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNDQ2OTk3MA==", "bodyText": "So, in addition to \"-Dquarkus.kubernetes.deploy=true should be the same as kubectl apply -f target/kubernetes/kubernetes.yml\", I also believe that target/kubernetes/kubernetes.yml should be the same regardless of quarkus.kubernetes.deploy value. I know, I'm demanding :-)", "url": "https://github.com/quarkusio/quarkus/pull/8815#discussion_r414469970", "createdAt": "2020-04-24T10:29:34Z", "author": {"login": "Ladicek"}, "path": "extensions/kubernetes/vanilla/deployment/src/main/java/io/quarkus/kubernetes/deployment/KubernetesProcessor.java", "diffHunk": "@@ -391,6 +399,22 @@ private void applyConfig(Session session, Project project, String target, String\n         });\n     }\n \n+    /**\n+     * When there is no registry defined and s2i isn't being used, the only ImagePullPolicy that can work is 'IfNotPresent'.\n+     * This case comes up when users want to deploy their application to a cluster like Minikube where no registry is used\n+     * and instead they rely on the image being built directly into the docker daemon that the cluster uses.\n+     */\n+    private ImagePullPolicy determineImagePullPolicy(PlatformConfiguration config,\n+            Optional<ContainerImageInfoBuildItem> containerImage, Capabilities capabilities) {\n+        ImagePullPolicy imagePullPolicy = config.getImagePullPolicy();\n+        if (containerImage.isPresent()\n+                && ContainerImageUtil.isRegistryMissingAndNotS2I(capabilities, containerImage.get())\n+                && kubernetesDeploy.getAsBoolean()) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNDQzNzk0NQ=="}, "originalCommit": {"oid": "12ba684fc7074138b347b51b41e654c3cebf8e16"}, "originalPosition": 91}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNDQ3MDY5OQ==", "bodyText": "If that isn't possible, then I think I agree with @geoand that it's important to deploy the same thing that is on the filesystem.", "url": "https://github.com/quarkusio/quarkus/pull/8815#discussion_r414470699", "createdAt": "2020-04-24T10:30:51Z", "author": {"login": "Ladicek"}, "path": "extensions/kubernetes/vanilla/deployment/src/main/java/io/quarkus/kubernetes/deployment/KubernetesProcessor.java", "diffHunk": "@@ -391,6 +399,22 @@ private void applyConfig(Session session, Project project, String target, String\n         });\n     }\n \n+    /**\n+     * When there is no registry defined and s2i isn't being used, the only ImagePullPolicy that can work is 'IfNotPresent'.\n+     * This case comes up when users want to deploy their application to a cluster like Minikube where no registry is used\n+     * and instead they rely on the image being built directly into the docker daemon that the cluster uses.\n+     */\n+    private ImagePullPolicy determineImagePullPolicy(PlatformConfiguration config,\n+            Optional<ContainerImageInfoBuildItem> containerImage, Capabilities capabilities) {\n+        ImagePullPolicy imagePullPolicy = config.getImagePullPolicy();\n+        if (containerImage.isPresent()\n+                && ContainerImageUtil.isRegistryMissingAndNotS2I(capabilities, containerImage.get())\n+                && kubernetesDeploy.getAsBoolean()) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNDQzNzk0NQ=="}, "originalCommit": {"oid": "12ba684fc7074138b347b51b41e654c3cebf8e16"}, "originalPosition": 91}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNDQ3MTU0Ng==", "bodyText": "Well I don't think we can do everything, so we need to find a good compromise. My opinion is obviously that the current PR is the best compromise, but I am open to other ideas.", "url": "https://github.com/quarkusio/quarkus/pull/8815#discussion_r414471546", "createdAt": "2020-04-24T10:32:08Z", "author": {"login": "geoand"}, "path": "extensions/kubernetes/vanilla/deployment/src/main/java/io/quarkus/kubernetes/deployment/KubernetesProcessor.java", "diffHunk": "@@ -391,6 +399,22 @@ private void applyConfig(Session session, Project project, String target, String\n         });\n     }\n \n+    /**\n+     * When there is no registry defined and s2i isn't being used, the only ImagePullPolicy that can work is 'IfNotPresent'.\n+     * This case comes up when users want to deploy their application to a cluster like Minikube where no registry is used\n+     * and instead they rely on the image being built directly into the docker daemon that the cluster uses.\n+     */\n+    private ImagePullPolicy determineImagePullPolicy(PlatformConfiguration config,\n+            Optional<ContainerImageInfoBuildItem> containerImage, Capabilities capabilities) {\n+        ImagePullPolicy imagePullPolicy = config.getImagePullPolicy();\n+        if (containerImage.isPresent()\n+                && ContainerImageUtil.isRegistryMissingAndNotS2I(capabilities, containerImage.get())\n+                && kubernetesDeploy.getAsBoolean()) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNDQzNzk0NQ=="}, "originalCommit": {"oid": "12ba684fc7074138b347b51b41e654c3cebf8e16"}, "originalPosition": 91}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNDQ5MjEzMA==", "bodyText": "I think that the absence of a registry is enough to trigger the desired behaviour and keeps things simple. Having, the runtime affect in any way the generated resources is going to bite us.", "url": "https://github.com/quarkusio/quarkus/pull/8815#discussion_r414492130", "createdAt": "2020-04-24T11:09:19Z", "author": {"login": "iocanel"}, "path": "extensions/kubernetes/vanilla/deployment/src/main/java/io/quarkus/kubernetes/deployment/KubernetesProcessor.java", "diffHunk": "@@ -391,6 +399,22 @@ private void applyConfig(Session session, Project project, String target, String\n         });\n     }\n \n+    /**\n+     * When there is no registry defined and s2i isn't being used, the only ImagePullPolicy that can work is 'IfNotPresent'.\n+     * This case comes up when users want to deploy their application to a cluster like Minikube where no registry is used\n+     * and instead they rely on the image being built directly into the docker daemon that the cluster uses.\n+     */\n+    private ImagePullPolicy determineImagePullPolicy(PlatformConfiguration config,\n+            Optional<ContainerImageInfoBuildItem> containerImage, Capabilities capabilities) {\n+        ImagePullPolicy imagePullPolicy = config.getImagePullPolicy();\n+        if (containerImage.isPresent()\n+                && ContainerImageUtil.isRegistryMissingAndNotS2I(capabilities, containerImage.get())\n+                && kubernetesDeploy.getAsBoolean()) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNDQzNzk0NQ=="}, "originalCommit": {"oid": "12ba684fc7074138b347b51b41e654c3cebf8e16"}, "originalPosition": 91}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNDQ5MzAyMQ==", "bodyText": "So you prefer that I remove the kubernetesDeploy.getAsBoolean() check altogether?", "url": "https://github.com/quarkusio/quarkus/pull/8815#discussion_r414493021", "createdAt": "2020-04-24T11:10:56Z", "author": {"login": "geoand"}, "path": "extensions/kubernetes/vanilla/deployment/src/main/java/io/quarkus/kubernetes/deployment/KubernetesProcessor.java", "diffHunk": "@@ -391,6 +399,22 @@ private void applyConfig(Session session, Project project, String target, String\n         });\n     }\n \n+    /**\n+     * When there is no registry defined and s2i isn't being used, the only ImagePullPolicy that can work is 'IfNotPresent'.\n+     * This case comes up when users want to deploy their application to a cluster like Minikube where no registry is used\n+     * and instead they rely on the image being built directly into the docker daemon that the cluster uses.\n+     */\n+    private ImagePullPolicy determineImagePullPolicy(PlatformConfiguration config,\n+            Optional<ContainerImageInfoBuildItem> containerImage, Capabilities capabilities) {\n+        ImagePullPolicy imagePullPolicy = config.getImagePullPolicy();\n+        if (containerImage.isPresent()\n+                && ContainerImageUtil.isRegistryMissingAndNotS2I(capabilities, containerImage.get())\n+                && kubernetesDeploy.getAsBoolean()) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNDQzNzk0NQ=="}, "originalCommit": {"oid": "12ba684fc7074138b347b51b41e654c3cebf8e16"}, "originalPosition": 91}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3443, "cost": 1, "resetAt": "2021-11-13T14:23:39Z"}}}