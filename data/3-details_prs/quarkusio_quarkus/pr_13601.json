{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTMwNTQ2MTE1", "number": 13601, "title": "Move non application endpoints to separate URL path", "bodyText": "Fixes #13144\nOpenAPI, Metrics, Micrometer, Health, Health UI endpoints are all now served under /q by default\nPrevious behavior can be attained by setting quarkus.http.non-application-root-path to /\n\nSubsequent issue will be created for handling port and binding changes for non application endpoints", "createdAt": "2020-12-01T20:10:54Z", "url": "https://github.com/quarkusio/quarkus/pull/13601", "merged": true, "mergeCommit": {"oid": "1f2e7df57c18b8714172ba79b4c0335de969c6ca"}, "closed": true, "closedAt": "2020-12-11T13:39:00Z", "author": {"login": "kenfinnigan"}, "timelineItems": {"totalCount": 16, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdix-WtgFqTU0NDY4OTQ1OQ==", "endCursor": "Y3Vyc29yOnYyOpPPAAABdk4mVkAFqTU0OTUzNjg4MQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTQ0Njg5NDU5", "url": "https://github.com/quarkusio/quarkus/pull/13601#pullrequestreview-544689459", "createdAt": "2020-12-04T06:35:58Z", "commit": {"oid": "fe24084c5ace32ad009faa20f610a569fdfa2519"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0wNFQwNjozNTo1OFrOH_C2Sw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0wNFQwNjo0MzoxOFrOH_DBEA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNTg2OTAwMw==", "bodyText": "So, does that mean that Framework is equivalent to NonApplication?\nCan't we have a single word?", "url": "https://github.com/quarkusio/quarkus/pull/13601#discussion_r535869003", "createdAt": "2020-12-04T06:35:58Z", "author": {"login": "cescoffier"}, "path": "extensions/smallrye-metrics/deployment/src/main/java/io/quarkus/smallrye/metrics/deployment/SmallRyeMetricsProcessor.java", "diffHunk": "@@ -154,7 +153,7 @@ MetricsCapabilityBuildItem metricsCapabilityBuildItem() {\n     @Record(STATIC_INIT)\n     void createRoute(BuildProducer<RouteBuildItem> routes,\n             SmallRyeMetricsRecorder recorder,\n-            HttpRootPathBuildItem httpRoot,\n+            FrameworkRootPathBuildItem frameworkRoot,", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "fe24084c5ace32ad009faa20f610a569fdfa2519"}, "originalPosition": 17}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNTg2OTYwMA==", "bodyText": "Why does swagger-ui stay on the main router?\nI understand it's an asset, but that looks not totally right.", "url": "https://github.com/quarkusio/quarkus/pull/13601#discussion_r535869600", "createdAt": "2020-12-04T06:37:30Z", "author": {"login": "cescoffier"}, "path": "extensions/smallrye-openapi/deployment/src/test/java/io/quarkus/smallrye/openapi/test/spring/SwaggerAndOpenAPIWithCommonPrefixTest.java", "diffHunk": "@@ -25,7 +25,7 @@\n     @Test\n     public void shouldWorkEvenWithCommonPrefix() {\n         RestAssured.when().get(\"/swagger-ui/index.html\").then().statusCode(200).body(containsString(\"/swagger\"));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "fe24084c5ace32ad009faa20f610a569fdfa2519"}, "originalPosition": 3}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNTg3MDIxMA==", "bodyText": "That only configure the \"/q\".\nDon't you want to allow having a separate HTTP server (maybe it's done somewhere else)", "url": "https://github.com/quarkusio/quarkus/pull/13601#discussion_r535870210", "createdAt": "2020-12-04T06:39:06Z", "author": {"login": "cescoffier"}, "path": "extensions/vertx-http/deployment/src/main/java/io/quarkus/vertx/http/deployment/FrameworkRootPathBuildItem.java", "diffHunk": "@@ -0,0 +1,33 @@\n+package io.quarkus.vertx.http.deployment;\n+\n+import io.quarkus.builder.item.SimpleBuildItem;\n+\n+public final class FrameworkRootPathBuildItem extends SimpleBuildItem {\n+    private final String frameworkRootPath;\n+    private final boolean separateRoot;\n+\n+    public FrameworkRootPathBuildItem(String frameworkRootPath) {\n+        this.frameworkRootPath = frameworkRootPath;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "fe24084c5ace32ad009faa20f610a569fdfa2519"}, "originalPosition": 10}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNTg3MTA0OA==", "bodyText": "So, we have /quarkus for the console and /q for framework.\nI may be wrong but I don't believe the console should be \"application\".\nAlso, all guides, workshops and quickstarts would need an update once this is merged", "url": "https://github.com/quarkusio/quarkus/pull/13601#discussion_r535871048", "createdAt": "2020-12-04T06:41:25Z", "author": {"login": "cescoffier"}, "path": "extensions/vertx-http/runtime/src/main/java/io/quarkus/vertx/http/runtime/HttpBuildTimeConfig.java", "diffHunk": "@@ -35,4 +35,13 @@\n      */\n     @ConfigItem(defaultValue = \"/quarkus\")\n     public String consolePath;\n+\n+    /**\n+     * The HTTP root path for framework endpoints. Various endpoints such as metrics, health,\n+     * and open api are deployed under this path.\n+     * Setting the value to \"/\" disables the separate framework root,\n+     * resulting in all framework endpoints being served from \"/\" along with the application.\n+     */\n+    @ConfigItem(defaultValue = \"/q\")\n+    public String frameworkRootPath;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "fe24084c5ace32ad009faa20f610a569fdfa2519"}, "originalPosition": 12}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNTg3MTc2MA==", "bodyText": "Should we consider updating the TCKs to allows setting the prefix?", "url": "https://github.com/quarkusio/quarkus/pull/13601#discussion_r535871760", "createdAt": "2020-12-04T06:43:18Z", "author": {"login": "cescoffier"}, "path": "tcks/microprofile-health/pom.xml", "diffHunk": "@@ -18,6 +18,10 @@\n                 <groupId>org.apache.maven.plugins</groupId>\n                 <artifactId>maven-surefire-plugin</artifactId>\n                 <configuration>\n+                    <systemPropertyVariables>\n+                        <!-- Change metrics endpoint to be /metrics -->", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "fe24084c5ace32ad009faa20f610a569fdfa2519"}, "originalPosition": 5}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "fe24084c5ace32ad009faa20f610a569fdfa2519", "author": {"user": {"login": "kenfinnigan", "name": "Ken Finnigan"}}, "url": "https://github.com/quarkusio/quarkus/commit/fe24084c5ace32ad009faa20f610a569fdfa2519", "committedDate": "2020-12-01T23:11:12Z", "message": "Fix Keycloak test"}, "afterCommit": {"oid": "75ef760ea20034436e3fa7c1855d49e3f3bffd49", "author": {"user": {"login": "kenfinnigan", "name": "Ken Finnigan"}}, "url": "https://github.com/quarkusio/quarkus/commit/75ef760ea20034436e3fa7c1855d49e3f3bffd49", "committedDate": "2020-12-07T16:17:35Z", "message": "- Adds documentation updates\n- Includes Swagger UI under the new non application endpoint path\n- Changes names to refer to \"NonApplication\" instead of Framework"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "81c5b7b44e2774d644d3a07b6e0dff30489b6173", "author": {"user": {"login": "kenfinnigan", "name": "Ken Finnigan"}}, "url": "https://github.com/quarkusio/quarkus/commit/81c5b7b44e2774d644d3a07b6e0dff30489b6173", "committedDate": "2020-12-09T17:55:45Z", "message": "Move non application endpoints to separate URL path\n\n- Fixes #13144\n- OpenAPI, Metrics, Micrometer, Health, Health UI endpoints are all now served under /q by default\n- Previous behavior can be attained by setting `quarkus.http.framework-root-path` to `/`\n\nSubsequent issue will be created for handling port and binding changes for non application endpoints"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "815f4d1dfa335344f176e1c21339dc6d9adedab0", "author": {"user": {"login": "kenfinnigan", "name": "Ken Finnigan"}}, "url": "https://github.com/quarkusio/quarkus/commit/815f4d1dfa335344f176e1c21339dc6d9adedab0", "committedDate": "2020-12-09T17:55:45Z", "message": "Fix some more url references in tests found from CI"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "7c3b4d4c802155031c2bb4b0a5f7bdd3d67bb559", "author": {"user": {"login": "kenfinnigan", "name": "Ken Finnigan"}}, "url": "https://github.com/quarkusio/quarkus/commit/7c3b4d4c802155031c2bb4b0a5f7bdd3d67bb559", "committedDate": "2020-12-09T17:55:46Z", "message": "- Adds documentation updates\n- Includes Swagger UI under the new non application endpoint path\n- Changes names to refer to \"NonApplication\" instead of Framework"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "52a3a0a8c3702712296a6ef40e5fed5ffb0aea09", "author": {"user": {"login": "kenfinnigan", "name": "Ken Finnigan"}}, "url": "https://github.com/quarkusio/quarkus/commit/52a3a0a8c3702712296a6ef40e5fed5ffb0aea09", "committedDate": "2020-12-09T17:55:46Z", "message": "Forgot I fixed this test in GH UI last week"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "90f5e5706ccd3303f831d74748f786e335c048b3", "author": {"user": {"login": "kenfinnigan", "name": "Ken Finnigan"}}, "url": "https://github.com/quarkusio/quarkus/commit/90f5e5706ccd3303f831d74748f786e335c048b3", "committedDate": "2020-12-09T17:55:46Z", "message": "Missed a couple of Swagger UI path usages"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b9a8fcfddc973b407d54f5c1657db33f45147c65", "author": {"user": {"login": "kenfinnigan", "name": "Ken Finnigan"}}, "url": "https://github.com/quarkusio/quarkus/commit/b9a8fcfddc973b407d54f5c1657db33f45147c65", "committedDate": "2020-12-09T17:56:30Z", "message": "Add HTTP Redirect from current path to new non application endpoint root path"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "f120f5a18087f69044e965278cabfa9848dddb30", "author": {"user": {"login": "kenfinnigan", "name": "Ken Finnigan"}}, "url": "https://github.com/quarkusio/quarkus/commit/f120f5a18087f69044e965278cabfa9848dddb30", "committedDate": "2020-12-07T20:47:07Z", "message": "Missed a couple of Swagger UI path usages"}, "afterCommit": {"oid": "b9a8fcfddc973b407d54f5c1657db33f45147c65", "author": {"user": {"login": "kenfinnigan", "name": "Ken Finnigan"}}, "url": "https://github.com/quarkusio/quarkus/commit/b9a8fcfddc973b407d54f5c1657db33f45147c65", "committedDate": "2020-12-09T17:56:30Z", "message": "Add HTTP Redirect from current path to new non application endpoint root path"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "44d55418d49e5eeec611a31ef82750ccdd61eb0e", "author": {"user": {"login": "kenfinnigan", "name": "Ken Finnigan"}}, "url": "https://github.com/quarkusio/quarkus/commit/44d55418d49e5eeec611a31ef82750ccdd61eb0e", "committedDate": "2020-12-09T18:17:44Z", "message": "Minor grammar cleanup in docs"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "578016b2ec3a0fa3ed006042a4f2ac659451d1ad", "author": {"user": {"login": "kenfinnigan", "name": "Ken Finnigan"}}, "url": "https://github.com/quarkusio/quarkus/commit/578016b2ec3a0fa3ed006042a4f2ac659451d1ad", "committedDate": "2020-12-09T18:28:33Z", "message": "- Add ability to disable redirect of non application endpoints to non application root path\n- Renamed property for defining non application root path to no longer use \"framework\""}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTQ4NDc4MTQz", "url": "https://github.com/quarkusio/quarkus/pull/13601#pullrequestreview-548478143", "createdAt": "2020-12-09T18:27:52Z", "commit": {"oid": "44d55418d49e5eeec611a31ef82750ccdd61eb0e"}, "state": "COMMENTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0wOVQxODoyNzo1MlrOICjNmg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0wOVQxODozMjoyMVrOICjZnA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzOTU0NDk4Ng==", "bodyText": "Should this be disable-able?", "url": "https://github.com/quarkusio/quarkus/pull/13601#discussion_r539544986", "createdAt": "2020-12-09T18:27:52Z", "author": {"login": "ebullient"}, "path": "extensions/vertx-http/deployment/src/main/java/io/quarkus/vertx/http/deployment/VertxHttpProcessor.java", "diffHunk": "@@ -117,11 +122,28 @@ public KubernetesPortBuildItem kubernetes() {\n     VertxWebRouterBuildItem initializeRouter(VertxHttpRecorder recorder,\n             CoreVertxBuildItem vertx,\n             List<RouteBuildItem> routes,\n+            NonApplicationRootPathBuildItem nonApplicationRootPath,\n+            BuildProducer<VertxNonApplicationRouterBuildItem> frameworkRouterBuildProducer,\n             ShutdownContextBuildItem shutdown) {\n \n         RuntimeValue<Router> router = recorder.initializeRouter(vertx.getVertx());\n+        RuntimeValue<Router> frameworkRouter = recorder.initializeRouter(vertx.getVertx());\n+        boolean frameworkRouterFound = false;\n+\n         for (RouteBuildItem route : routes) {\n-            recorder.addRoute(router, route.getRouteFunction(), route.getHandler(), route.getType());\n+            if (nonApplicationRootPath.isSeparateRoot() && route.isFrameworkRoute()) {\n+                frameworkRouterFound = true;\n+                recorder.addRoute(frameworkRouter, route.getRouteFunction(), route.getHandler(), route.getType());\n+            } else {\n+                recorder.addRoute(router, route.getRouteFunction(), route.getHandler(), route.getType());\n+            }\n+        }\n+\n+        if (frameworkRouterFound && nonApplicationRootPath.isSeparateRoot()) {\n+            // Handle redirects from old paths to new non application endpoint root\n+            recorder.addNonApplicationPathRedirect(router, frameworkRouter, nonApplicationRootPath.getFrameworkRootPath());\n+", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "44d55418d49e5eeec611a31ef82750ccdd61eb0e"}, "originalPosition": 37}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzOTU0ODA2MA==", "bodyText": "This is one of the only places w/o the leading '/' ...\nwhile it may work, the inconsistency is noticable", "url": "https://github.com/quarkusio/quarkus/pull/13601#discussion_r539548060", "createdAt": "2020-12-09T18:32:21Z", "author": {"login": "ebullient"}, "path": "integration-tests/main/src/test/java/io/quarkus/it/main/OpenApiTestCase.java", "diffHunk": "@@ -22,7 +22,7 @@\n \n     private static final String DEFAULT_MEDIA_TYPE = \"application/json\";\n \n-    @TestHTTPResource(\"openapi\")\n+    @TestHTTPResource(\"q/openapi\")", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "44d55418d49e5eeec611a31ef82750ccdd61eb0e"}, "originalPosition": 5}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTQ4NDg2NzM2", "url": "https://github.com/quarkusio/quarkus/pull/13601#pullrequestreview-548486736", "createdAt": "2020-12-09T18:36:00Z", "commit": {"oid": "578016b2ec3a0fa3ed006042a4f2ac659451d1ad"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "663570cd008a0fa892b06a2ffc3d08cec3a261a1", "author": {"user": {"login": "kenfinnigan", "name": "Ken Finnigan"}}, "url": "https://github.com/quarkusio/quarkus/commit/663570cd008a0fa892b06a2ffc3d08cec3a261a1", "committedDate": "2020-12-09T20:26:09Z", "message": "Fix my bad substring!"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTQ4NTgzNTIy", "url": "https://github.com/quarkusio/quarkus/pull/13601#pullrequestreview-548583522", "createdAt": "2020-12-09T20:31:44Z", "commit": {"oid": "663570cd008a0fa892b06a2ffc3d08cec3a261a1"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTQ5NTM2ODgx", "url": "https://github.com/quarkusio/quarkus/pull/13601#pullrequestreview-549536881", "createdAt": "2020-12-10T19:35:04Z", "commit": {"oid": "663570cd008a0fa892b06a2ffc3d08cec3a261a1"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1358, "cost": 1, "resetAt": "2021-11-01T16:37:27Z"}}}