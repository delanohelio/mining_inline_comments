{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTAwMTA5MTIx", "number": 12608, "title": "Add commonTags to micrometer doc", "bodyText": "Add an example of configuring common tags to micrometer docs", "createdAt": "2020-10-08T18:31:14Z", "url": "https://github.com/quarkusio/quarkus/pull/12608", "merged": true, "mergeCommit": {"oid": "80a444dfd25d4e23f4d88056d7c2c5869f4e5a06"}, "closed": true, "closedAt": "2020-10-09T07:48:29Z", "author": {"login": "ebullient"}, "timelineItems": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdQmL6vAFqTUwNTA3MDY0Nw==", "endCursor": "Y3Vyc29yOnYyOpPPAAABdQnKP_gFqTUwNTEyMDA2NA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTA1MDcwNjQ3", "url": "https://github.com/quarkusio/quarkus/pull/12608#pullrequestreview-505070647", "createdAt": "2020-10-08T18:48:54Z", "commit": {"oid": "3ef2acb82f688b7ae2b15a2b4264ae0b070a2ba4"}, "state": "APPROVED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wOFQxODo0ODo1NFrOHer_AQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wOFQxODo0ODo1NFrOHer_AQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMTkzOTk2OQ==", "bodyText": "Remove the extra \"the\" before \"this example\"", "url": "https://github.com/quarkusio/quarkus/pull/12608#discussion_r501939969", "createdAt": "2020-10-08T18:48:54Z", "author": {"login": "kenfinnigan"}, "path": "docs/src/main/asciidoc/micrometer.adoc", "diffHunk": "@@ -280,6 +280,42 @@ jvm_memory_committed_bytes{area=\"nonheap\",id=\"CodeHeap 'non-profiled nmethods'\",\n Note that metrics appear lazily, you often won't see any data for your endpoint until\n something tries to access it, etc.\n \n+== Adding custom configuration or common tags\n+\n+Micrometer uses `MeterFilter` instances to customize the metrics emitted by `MeterRegistry` instances.\n+The Micrometer extension will detect `MeterFilter` CDI beans and use them when initializing `MeterRegistry` instances.\n+\n+[source,java]\n+----\n+@Singleton\n+public class CustomConfiguration {\n+\n+    @ConfigProperty(name = \"deployment.env\")\n+    String deploymentEnv;\n+\n+    /** Define common tags that apply only to a Prometheus Registry */\n+    @Produces\n+    @Singleton\n+    @MeterFilterConstraint(applyTo = PrometheusMeterRegistry.class)\n+    public MeterFilter configurePrometheusRegistries() {\n+        return MeterFilter.commonTags(Arrays.asList(\n+                Tag.of(\"registry\", \"prometheus\")));\n+    }\n+\n+    /** Define common tags that apply globally */\n+    @Produces\n+    @Singleton\n+    public MeterFilter configureAllRegistries() {\n+        return MeterFilter.commonTags(Arrays.asList(\n+                Tag.of(\"env\", deploymentEnv)));\n+    }\n+}\n+----\n+\n+In the this example, a singleton CDI bean will produce two different `MeterFilter` beans. One will be applied only to", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "3ef2acb82f688b7ae2b15a2b4264ae0b070a2ba4"}, "originalPosition": 36}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a89fba7a1c622619b90719d4d097b9b3e3256022", "author": {"user": {"login": "ebullient", "name": "Erin Schnabel"}}, "url": "https://github.com/quarkusio/quarkus/commit/a89fba7a1c622619b90719d4d097b9b3e3256022", "committedDate": "2020-10-08T19:01:58Z", "message": "Add commonTags to micrometer doc"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "3ef2acb82f688b7ae2b15a2b4264ae0b070a2ba4", "author": {"user": {"login": "ebullient", "name": "Erin Schnabel"}}, "url": "https://github.com/quarkusio/quarkus/commit/3ef2acb82f688b7ae2b15a2b4264ae0b070a2ba4", "committedDate": "2020-10-08T18:29:41Z", "message": "Add commonTags to micrometer doc"}, "afterCommit": {"oid": "a89fba7a1c622619b90719d4d097b9b3e3256022", "author": {"user": {"login": "ebullient", "name": "Erin Schnabel"}}, "url": "https://github.com/quarkusio/quarkus/commit/a89fba7a1c622619b90719d4d097b9b3e3256022", "committedDate": "2020-10-08T19:01:58Z", "message": "Add commonTags to micrometer doc"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTA1MTIwMDY0", "url": "https://github.com/quarkusio/quarkus/pull/12608#pullrequestreview-505120064", "createdAt": "2020-10-08T19:57:31Z", "commit": {"oid": "a89fba7a1c622619b90719d4d097b9b3e3256022"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1735, "cost": 1, "resetAt": "2021-11-01T16:37:27Z"}}}