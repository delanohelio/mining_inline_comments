{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDkyMDU5NTE3", "number": 12309, "title": "Remove reference to metrics classes in deployment", "bodyText": "Avoid importing a class with direct reference to MP Metrics in the deployment module.\nResolves #12289", "createdAt": "2020-09-23T21:51:35Z", "url": "https://github.com/quarkusio/quarkus/pull/12309", "merged": true, "mergeCommit": {"oid": "080a245cf99cc62acf6df78bc084839000a560af"}, "closed": true, "closedAt": "2020-09-24T17:06:04Z", "author": {"login": "ebullient"}, "timelineItems": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdLzxsDAH2gAyNDkyMDU5NTE3OjhlNjFmNGQ2YTg0MTJlMTg0YmJmYTRkZTFhMDdiOGNjN2EzMGU0ZWQ=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdMEULNgFqTQ5NTc3ODQ5OA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "8e61f4d6a8412e184bbfa4de1a07b8cc7a30e4ed", "author": {"user": {"login": "ebullient", "name": "Erin Schnabel"}}, "url": "https://github.com/quarkusio/quarkus/commit/8e61f4d6a8412e184bbfa4de1a07b8cc7a30e4ed", "committedDate": "2020-09-23T21:49:50Z", "message": "Remove reference to metrics classes in deployment"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDk1MjQzNzcz", "url": "https://github.com/quarkusio/quarkus/pull/12309#pullrequestreview-495243773", "createdAt": "2020-09-24T06:06:16Z", "commit": {"oid": "8e61f4d6a8412e184bbfa4de1a07b8cc7a30e4ed"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yNFQwNjowNjoxNlrOHXK90A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yNFQwNjowNjoxNlrOHXK90A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NDA1ODk2MA==", "bodyText": "If it uses micrometer, how are the metrics reported?", "url": "https://github.com/quarkusio/quarkus/pull/12309#discussion_r494058960", "createdAt": "2020-09-24T06:06:16Z", "author": {"login": "cescoffier"}, "path": "extensions/smallrye-reactive-messaging/deployment/src/main/java/io/quarkus/smallrye/reactivemessaging/deployment/SmallRyeReactiveMessagingProcessor.java", "diffHunk": "@@ -282,11 +282,14 @@ private void createEmitter(BuildProducer<EmitterBuildItem> emitters, InjectionPo\n \n     @BuildStep\n     public void enableMetrics(BuildProducer<AnnotationsTransformerBuildItem> transformers,\n-            Capabilities capabilities, ReactiveMessagingConfiguration configuration) {\n-        boolean isMetricEnabled = capabilities.isPresent(Capability.METRICS) && configuration.metricsEnabled;\n-        if (!isMetricEnabled) {\n-            LOGGER.debug(\"Metric is disabled - vetoing the MetricDecorator\");\n-            // We veto the Metric Decorator\n+            Optional<MetricsCapabilityBuildItem> metricsCapability,\n+            ReactiveMessagingConfiguration configuration) {\n+        boolean isMetricEnabled = metricsCapability.isPresent() && configuration.metricsEnabled;\n+        boolean useMicrometer = isMetricEnabled && metricsCapability.get().metricsSupported(MetricsFactory.MICROMETER);\n+        if (!isMetricEnabled || useMicrometer) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "8e61f4d6a8412e184bbfa4de1a07b8cc7a30e4ed"}, "originalPosition": 38}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDk1Nzc4NDk4", "url": "https://github.com/quarkusio/quarkus/pull/12309#pullrequestreview-495778498", "createdAt": "2020-09-24T17:05:59Z", "commit": {"oid": "8e61f4d6a8412e184bbfa4de1a07b8cc7a30e4ed"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 416, "cost": 1, "resetAt": "2021-11-01T16:37:27Z"}}}