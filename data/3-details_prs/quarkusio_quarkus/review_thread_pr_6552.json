{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0MzYyNzA5MDMy", "number": 6552, "reviewThreads": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0xNFQxNzowMzowOFrODX6_ng==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0xNFQxNzoyMDoyMlrODX7UMA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjI2NDEwMzk4OnYy", "diffSide": "RIGHT", "path": "extensions/undertow-websockets/deployment/src/main/java/io/quarkus/undertow/websockets/deployment/WebsocketHotReloadSetup.java", "isResolved": true, "comments": {"totalCount": 12, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0xNFQxNzowMzowOFrOFde-OQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0xNFQyMDo1MzoyMFrOFdldRw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NjQ2MDQ3Mw==", "bodyText": "You also need an InputStreamReader explicitly set up with UTF-8 here, and load the properties from the reader, else there will be encoding problems.", "url": "https://github.com/quarkusio/quarkus/pull/6552#discussion_r366460473", "createdAt": "2020-01-14T17:03:08Z", "author": {"login": "dmlloyd"}, "path": "extensions/undertow-websockets/deployment/src/main/java/io/quarkus/undertow/websockets/deployment/WebsocketHotReloadSetup.java", "diffHunk": "@@ -31,17 +31,27 @@\n \n     @Override\n     public void setupHotDeployment(HotReplacementContext hotReplacementContext) {\n-        List<Path> resources = hotReplacementContext.getResourcesDir();\n-        if (!resources.isEmpty()) {\n-            //TODO: fix this\n-            File appConfig = resources.get(0).resolve(\"application.properties\").toFile();\n-            if (appConfig.isFile()) {\n-                try (InputStream pw = new FileInputStream(appConfig)) {\n-                    Properties p = new Properties();\n-                    p.load(pw);\n-                    replacementPassword = p.getProperty(HotReplacementWebsocketEndpoint.QUARKUS_HOT_RELOAD_PASSWORD);\n-                } catch (IOException e) {\n-                    logger.error(\"Failed to read application.properties\", e);\n+        // we can't use the typical ConfigProvider.getConfig() because it throws an ISE\n+        String password = System.getProperty(HotReplacementWebsocketEndpoint.QUARKUS_HOT_RELOAD_PASSWORD);\n+        if (password == null || password.isEmpty()) {\n+            password = System.getenv(HotReplacementWebsocketEndpoint.QUARKUS_HOT_RELOAD_PASSWORD_ENV);\n+        }\n+\n+        if (password != null && !password.isEmpty()) {\n+            replacementPassword = password;\n+        } else {\n+            List<Path> resources = hotReplacementContext.getResourcesDir();\n+            if (!resources.isEmpty()) {\n+                //TODO: fix this\n+                File appConfig = resources.get(0).resolve(\"application.properties\").toFile();\n+                if (appConfig.isFile()) {\n+                    try (InputStream pw = new FileInputStream(appConfig)) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c96f24ac3472627c3f93c408049a6931e99cae47"}, "originalPosition": 29}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NjQ2NjcwNg==", "bodyText": "Well I just copied what was already in place, I didn't change anything there.\nThe UI probably shows a change because I moved it inside else.\nI just added the reading from the system property and env var", "url": "https://github.com/quarkusio/quarkus/pull/6552#discussion_r366466706", "createdAt": "2020-01-14T17:15:25Z", "author": {"login": "geoand"}, "path": "extensions/undertow-websockets/deployment/src/main/java/io/quarkus/undertow/websockets/deployment/WebsocketHotReloadSetup.java", "diffHunk": "@@ -31,17 +31,27 @@\n \n     @Override\n     public void setupHotDeployment(HotReplacementContext hotReplacementContext) {\n-        List<Path> resources = hotReplacementContext.getResourcesDir();\n-        if (!resources.isEmpty()) {\n-            //TODO: fix this\n-            File appConfig = resources.get(0).resolve(\"application.properties\").toFile();\n-            if (appConfig.isFile()) {\n-                try (InputStream pw = new FileInputStream(appConfig)) {\n-                    Properties p = new Properties();\n-                    p.load(pw);\n-                    replacementPassword = p.getProperty(HotReplacementWebsocketEndpoint.QUARKUS_HOT_RELOAD_PASSWORD);\n-                } catch (IOException e) {\n-                    logger.error(\"Failed to read application.properties\", e);\n+        // we can't use the typical ConfigProvider.getConfig() because it throws an ISE\n+        String password = System.getProperty(HotReplacementWebsocketEndpoint.QUARKUS_HOT_RELOAD_PASSWORD);\n+        if (password == null || password.isEmpty()) {\n+            password = System.getenv(HotReplacementWebsocketEndpoint.QUARKUS_HOT_RELOAD_PASSWORD_ENV);\n+        }\n+\n+        if (password != null && !password.isEmpty()) {\n+            replacementPassword = password;\n+        } else {\n+            List<Path> resources = hotReplacementContext.getResourcesDir();\n+            if (!resources.isEmpty()) {\n+                //TODO: fix this\n+                File appConfig = resources.get(0).resolve(\"application.properties\").toFile();\n+                if (appConfig.isFile()) {\n+                    try (InputStream pw = new FileInputStream(appConfig)) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NjQ2MDQ3Mw=="}, "originalCommit": {"oid": "c96f24ac3472627c3f93c408049a6931e99cae47"}, "originalPosition": 29}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NjQ2NzM1OA==", "bodyText": "Would you like me to fix it anyway?", "url": "https://github.com/quarkusio/quarkus/pull/6552#discussion_r366467358", "createdAt": "2020-01-14T17:16:40Z", "author": {"login": "geoand"}, "path": "extensions/undertow-websockets/deployment/src/main/java/io/quarkus/undertow/websockets/deployment/WebsocketHotReloadSetup.java", "diffHunk": "@@ -31,17 +31,27 @@\n \n     @Override\n     public void setupHotDeployment(HotReplacementContext hotReplacementContext) {\n-        List<Path> resources = hotReplacementContext.getResourcesDir();\n-        if (!resources.isEmpty()) {\n-            //TODO: fix this\n-            File appConfig = resources.get(0).resolve(\"application.properties\").toFile();\n-            if (appConfig.isFile()) {\n-                try (InputStream pw = new FileInputStream(appConfig)) {\n-                    Properties p = new Properties();\n-                    p.load(pw);\n-                    replacementPassword = p.getProperty(HotReplacementWebsocketEndpoint.QUARKUS_HOT_RELOAD_PASSWORD);\n-                } catch (IOException e) {\n-                    logger.error(\"Failed to read application.properties\", e);\n+        // we can't use the typical ConfigProvider.getConfig() because it throws an ISE\n+        String password = System.getProperty(HotReplacementWebsocketEndpoint.QUARKUS_HOT_RELOAD_PASSWORD);\n+        if (password == null || password.isEmpty()) {\n+            password = System.getenv(HotReplacementWebsocketEndpoint.QUARKUS_HOT_RELOAD_PASSWORD_ENV);\n+        }\n+\n+        if (password != null && !password.isEmpty()) {\n+            replacementPassword = password;\n+        } else {\n+            List<Path> resources = hotReplacementContext.getResourcesDir();\n+            if (!resources.isEmpty()) {\n+                //TODO: fix this\n+                File appConfig = resources.get(0).resolve(\"application.properties\").toFile();\n+                if (appConfig.isFile()) {\n+                    try (InputStream pw = new FileInputStream(appConfig)) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NjQ2MDQ3Mw=="}, "originalCommit": {"oid": "c96f24ac3472627c3f93c408049a6931e99cae47"}, "originalPosition": 29}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NjQ2ODY2NQ==", "bodyText": "Yes, please let's do it.", "url": "https://github.com/quarkusio/quarkus/pull/6552#discussion_r366468665", "createdAt": "2020-01-14T17:19:34Z", "author": {"login": "gsmet"}, "path": "extensions/undertow-websockets/deployment/src/main/java/io/quarkus/undertow/websockets/deployment/WebsocketHotReloadSetup.java", "diffHunk": "@@ -31,17 +31,27 @@\n \n     @Override\n     public void setupHotDeployment(HotReplacementContext hotReplacementContext) {\n-        List<Path> resources = hotReplacementContext.getResourcesDir();\n-        if (!resources.isEmpty()) {\n-            //TODO: fix this\n-            File appConfig = resources.get(0).resolve(\"application.properties\").toFile();\n-            if (appConfig.isFile()) {\n-                try (InputStream pw = new FileInputStream(appConfig)) {\n-                    Properties p = new Properties();\n-                    p.load(pw);\n-                    replacementPassword = p.getProperty(HotReplacementWebsocketEndpoint.QUARKUS_HOT_RELOAD_PASSWORD);\n-                } catch (IOException e) {\n-                    logger.error(\"Failed to read application.properties\", e);\n+        // we can't use the typical ConfigProvider.getConfig() because it throws an ISE\n+        String password = System.getProperty(HotReplacementWebsocketEndpoint.QUARKUS_HOT_RELOAD_PASSWORD);\n+        if (password == null || password.isEmpty()) {\n+            password = System.getenv(HotReplacementWebsocketEndpoint.QUARKUS_HOT_RELOAD_PASSWORD_ENV);\n+        }\n+\n+        if (password != null && !password.isEmpty()) {\n+            replacementPassword = password;\n+        } else {\n+            List<Path> resources = hotReplacementContext.getResourcesDir();\n+            if (!resources.isEmpty()) {\n+                //TODO: fix this\n+                File appConfig = resources.get(0).resolve(\"application.properties\").toFile();\n+                if (appConfig.isFile()) {\n+                    try (InputStream pw = new FileInputStream(appConfig)) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NjQ2MDQ3Mw=="}, "originalCommit": {"oid": "c96f24ac3472627c3f93c408049a6931e99cae47"}, "originalPosition": 29}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NjQ2OTA4NA==", "bodyText": "Well I just copied what was already in place, I didn't change anything there.\nThe UI probably shows a change because I moved it inside else.\nI just added the reading from the system property and env var\n\nAh, that's not good, it should be fixed in the original place too.\n\nWould you like me to fix it anyway?\n\nYes, please.", "url": "https://github.com/quarkusio/quarkus/pull/6552#discussion_r366469084", "createdAt": "2020-01-14T17:20:25Z", "author": {"login": "dmlloyd"}, "path": "extensions/undertow-websockets/deployment/src/main/java/io/quarkus/undertow/websockets/deployment/WebsocketHotReloadSetup.java", "diffHunk": "@@ -31,17 +31,27 @@\n \n     @Override\n     public void setupHotDeployment(HotReplacementContext hotReplacementContext) {\n-        List<Path> resources = hotReplacementContext.getResourcesDir();\n-        if (!resources.isEmpty()) {\n-            //TODO: fix this\n-            File appConfig = resources.get(0).resolve(\"application.properties\").toFile();\n-            if (appConfig.isFile()) {\n-                try (InputStream pw = new FileInputStream(appConfig)) {\n-                    Properties p = new Properties();\n-                    p.load(pw);\n-                    replacementPassword = p.getProperty(HotReplacementWebsocketEndpoint.QUARKUS_HOT_RELOAD_PASSWORD);\n-                } catch (IOException e) {\n-                    logger.error(\"Failed to read application.properties\", e);\n+        // we can't use the typical ConfigProvider.getConfig() because it throws an ISE\n+        String password = System.getProperty(HotReplacementWebsocketEndpoint.QUARKUS_HOT_RELOAD_PASSWORD);\n+        if (password == null || password.isEmpty()) {\n+            password = System.getenv(HotReplacementWebsocketEndpoint.QUARKUS_HOT_RELOAD_PASSWORD_ENV);\n+        }\n+\n+        if (password != null && !password.isEmpty()) {\n+            replacementPassword = password;\n+        } else {\n+            List<Path> resources = hotReplacementContext.getResourcesDir();\n+            if (!resources.isEmpty()) {\n+                //TODO: fix this\n+                File appConfig = resources.get(0).resolve(\"application.properties\").toFile();\n+                if (appConfig.isFile()) {\n+                    try (InputStream pw = new FileInputStream(appConfig)) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NjQ2MDQ3Mw=="}, "originalCommit": {"oid": "c96f24ac3472627c3f93c408049a6931e99cae47"}, "originalPosition": 29}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NjQ2OTU0Ng==", "bodyText": "So I reckon this doesn't work with Yaml as we are playing with the properties file directly?", "url": "https://github.com/quarkusio/quarkus/pull/6552#discussion_r366469546", "createdAt": "2020-01-14T17:21:29Z", "author": {"login": "gsmet"}, "path": "extensions/undertow-websockets/deployment/src/main/java/io/quarkus/undertow/websockets/deployment/WebsocketHotReloadSetup.java", "diffHunk": "@@ -31,17 +31,27 @@\n \n     @Override\n     public void setupHotDeployment(HotReplacementContext hotReplacementContext) {\n-        List<Path> resources = hotReplacementContext.getResourcesDir();\n-        if (!resources.isEmpty()) {\n-            //TODO: fix this\n-            File appConfig = resources.get(0).resolve(\"application.properties\").toFile();\n-            if (appConfig.isFile()) {\n-                try (InputStream pw = new FileInputStream(appConfig)) {\n-                    Properties p = new Properties();\n-                    p.load(pw);\n-                    replacementPassword = p.getProperty(HotReplacementWebsocketEndpoint.QUARKUS_HOT_RELOAD_PASSWORD);\n-                } catch (IOException e) {\n-                    logger.error(\"Failed to read application.properties\", e);\n+        // we can't use the typical ConfigProvider.getConfig() because it throws an ISE\n+        String password = System.getProperty(HotReplacementWebsocketEndpoint.QUARKUS_HOT_RELOAD_PASSWORD);\n+        if (password == null || password.isEmpty()) {\n+            password = System.getenv(HotReplacementWebsocketEndpoint.QUARKUS_HOT_RELOAD_PASSWORD_ENV);\n+        }\n+\n+        if (password != null && !password.isEmpty()) {\n+            replacementPassword = password;\n+        } else {\n+            List<Path> resources = hotReplacementContext.getResourcesDir();\n+            if (!resources.isEmpty()) {\n+                //TODO: fix this\n+                File appConfig = resources.get(0).resolve(\"application.properties\").toFile();\n+                if (appConfig.isFile()) {\n+                    try (InputStream pw = new FileInputStream(appConfig)) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NjQ2MDQ3Mw=="}, "originalCommit": {"oid": "c96f24ac3472627c3f93c408049a6931e99cae47"}, "originalPosition": 29}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NjQ3MTkxOA==", "bodyText": "Sorry I didn't mean copy - paste, I meant move into the else branch.\nI'm only on my phone now so I can't really fix it, I'll do that later on tonight or tomorrow morning.\nAnd yes it won't work with YAML. We could of course add the YAML dependency and try to locate that file as well. Should we do it now or wait until someone complains?", "url": "https://github.com/quarkusio/quarkus/pull/6552#discussion_r366471918", "createdAt": "2020-01-14T17:26:11Z", "author": {"login": "geoand"}, "path": "extensions/undertow-websockets/deployment/src/main/java/io/quarkus/undertow/websockets/deployment/WebsocketHotReloadSetup.java", "diffHunk": "@@ -31,17 +31,27 @@\n \n     @Override\n     public void setupHotDeployment(HotReplacementContext hotReplacementContext) {\n-        List<Path> resources = hotReplacementContext.getResourcesDir();\n-        if (!resources.isEmpty()) {\n-            //TODO: fix this\n-            File appConfig = resources.get(0).resolve(\"application.properties\").toFile();\n-            if (appConfig.isFile()) {\n-                try (InputStream pw = new FileInputStream(appConfig)) {\n-                    Properties p = new Properties();\n-                    p.load(pw);\n-                    replacementPassword = p.getProperty(HotReplacementWebsocketEndpoint.QUARKUS_HOT_RELOAD_PASSWORD);\n-                } catch (IOException e) {\n-                    logger.error(\"Failed to read application.properties\", e);\n+        // we can't use the typical ConfigProvider.getConfig() because it throws an ISE\n+        String password = System.getProperty(HotReplacementWebsocketEndpoint.QUARKUS_HOT_RELOAD_PASSWORD);\n+        if (password == null || password.isEmpty()) {\n+            password = System.getenv(HotReplacementWebsocketEndpoint.QUARKUS_HOT_RELOAD_PASSWORD_ENV);\n+        }\n+\n+        if (password != null && !password.isEmpty()) {\n+            replacementPassword = password;\n+        } else {\n+            List<Path> resources = hotReplacementContext.getResourcesDir();\n+            if (!resources.isEmpty()) {\n+                //TODO: fix this\n+                File appConfig = resources.get(0).resolve(\"application.properties\").toFile();\n+                if (appConfig.isFile()) {\n+                    try (InputStream pw = new FileInputStream(appConfig)) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NjQ2MDQ3Mw=="}, "originalCommit": {"oid": "c96f24ac3472627c3f93c408049a6931e99cae47"}, "originalPosition": 29}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NjQ3MzE3OA==", "bodyText": "It would be nice to fix the underlying problem...", "url": "https://github.com/quarkusio/quarkus/pull/6552#discussion_r366473178", "createdAt": "2020-01-14T17:28:51Z", "author": {"login": "dmlloyd"}, "path": "extensions/undertow-websockets/deployment/src/main/java/io/quarkus/undertow/websockets/deployment/WebsocketHotReloadSetup.java", "diffHunk": "@@ -31,17 +31,27 @@\n \n     @Override\n     public void setupHotDeployment(HotReplacementContext hotReplacementContext) {\n-        List<Path> resources = hotReplacementContext.getResourcesDir();\n-        if (!resources.isEmpty()) {\n-            //TODO: fix this\n-            File appConfig = resources.get(0).resolve(\"application.properties\").toFile();\n-            if (appConfig.isFile()) {\n-                try (InputStream pw = new FileInputStream(appConfig)) {\n-                    Properties p = new Properties();\n-                    p.load(pw);\n-                    replacementPassword = p.getProperty(HotReplacementWebsocketEndpoint.QUARKUS_HOT_RELOAD_PASSWORD);\n-                } catch (IOException e) {\n-                    logger.error(\"Failed to read application.properties\", e);\n+        // we can't use the typical ConfigProvider.getConfig() because it throws an ISE\n+        String password = System.getProperty(HotReplacementWebsocketEndpoint.QUARKUS_HOT_RELOAD_PASSWORD);\n+        if (password == null || password.isEmpty()) {\n+            password = System.getenv(HotReplacementWebsocketEndpoint.QUARKUS_HOT_RELOAD_PASSWORD_ENV);\n+        }\n+\n+        if (password != null && !password.isEmpty()) {\n+            replacementPassword = password;\n+        } else {\n+            List<Path> resources = hotReplacementContext.getResourcesDir();\n+            if (!resources.isEmpty()) {\n+                //TODO: fix this\n+                File appConfig = resources.get(0).resolve(\"application.properties\").toFile();\n+                if (appConfig.isFile()) {\n+                    try (InputStream pw = new FileInputStream(appConfig)) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NjQ2MDQ3Mw=="}, "originalCommit": {"oid": "c96f24ac3472627c3f93c408049a6931e99cae47"}, "originalPosition": 29}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NjQ3ODIwNA==", "bodyText": "Underlying problem, meaning? \ud83d\ude05", "url": "https://github.com/quarkusio/quarkus/pull/6552#discussion_r366478204", "createdAt": "2020-01-14T17:39:08Z", "author": {"login": "geoand"}, "path": "extensions/undertow-websockets/deployment/src/main/java/io/quarkus/undertow/websockets/deployment/WebsocketHotReloadSetup.java", "diffHunk": "@@ -31,17 +31,27 @@\n \n     @Override\n     public void setupHotDeployment(HotReplacementContext hotReplacementContext) {\n-        List<Path> resources = hotReplacementContext.getResourcesDir();\n-        if (!resources.isEmpty()) {\n-            //TODO: fix this\n-            File appConfig = resources.get(0).resolve(\"application.properties\").toFile();\n-            if (appConfig.isFile()) {\n-                try (InputStream pw = new FileInputStream(appConfig)) {\n-                    Properties p = new Properties();\n-                    p.load(pw);\n-                    replacementPassword = p.getProperty(HotReplacementWebsocketEndpoint.QUARKUS_HOT_RELOAD_PASSWORD);\n-                } catch (IOException e) {\n-                    logger.error(\"Failed to read application.properties\", e);\n+        // we can't use the typical ConfigProvider.getConfig() because it throws an ISE\n+        String password = System.getProperty(HotReplacementWebsocketEndpoint.QUARKUS_HOT_RELOAD_PASSWORD);\n+        if (password == null || password.isEmpty()) {\n+            password = System.getenv(HotReplacementWebsocketEndpoint.QUARKUS_HOT_RELOAD_PASSWORD_ENV);\n+        }\n+\n+        if (password != null && !password.isEmpty()) {\n+            replacementPassword = password;\n+        } else {\n+            List<Path> resources = hotReplacementContext.getResourcesDir();\n+            if (!resources.isEmpty()) {\n+                //TODO: fix this\n+                File appConfig = resources.get(0).resolve(\"application.properties\").toFile();\n+                if (appConfig.isFile()) {\n+                    try (InputStream pw = new FileInputStream(appConfig)) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NjQ2MDQ3Mw=="}, "originalCommit": {"oid": "c96f24ac3472627c3f93c408049a6931e99cae47"}, "originalPosition": 29}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NjQ4MjI5Mg==", "bodyText": "I mean actually loading these values from config instead of using this outside channel to access the values.", "url": "https://github.com/quarkusio/quarkus/pull/6552#discussion_r366482292", "createdAt": "2020-01-14T17:47:38Z", "author": {"login": "dmlloyd"}, "path": "extensions/undertow-websockets/deployment/src/main/java/io/quarkus/undertow/websockets/deployment/WebsocketHotReloadSetup.java", "diffHunk": "@@ -31,17 +31,27 @@\n \n     @Override\n     public void setupHotDeployment(HotReplacementContext hotReplacementContext) {\n-        List<Path> resources = hotReplacementContext.getResourcesDir();\n-        if (!resources.isEmpty()) {\n-            //TODO: fix this\n-            File appConfig = resources.get(0).resolve(\"application.properties\").toFile();\n-            if (appConfig.isFile()) {\n-                try (InputStream pw = new FileInputStream(appConfig)) {\n-                    Properties p = new Properties();\n-                    p.load(pw);\n-                    replacementPassword = p.getProperty(HotReplacementWebsocketEndpoint.QUARKUS_HOT_RELOAD_PASSWORD);\n-                } catch (IOException e) {\n-                    logger.error(\"Failed to read application.properties\", e);\n+        // we can't use the typical ConfigProvider.getConfig() because it throws an ISE\n+        String password = System.getProperty(HotReplacementWebsocketEndpoint.QUARKUS_HOT_RELOAD_PASSWORD);\n+        if (password == null || password.isEmpty()) {\n+            password = System.getenv(HotReplacementWebsocketEndpoint.QUARKUS_HOT_RELOAD_PASSWORD_ENV);\n+        }\n+\n+        if (password != null && !password.isEmpty()) {\n+            replacementPassword = password;\n+        } else {\n+            List<Path> resources = hotReplacementContext.getResourcesDir();\n+            if (!resources.isEmpty()) {\n+                //TODO: fix this\n+                File appConfig = resources.get(0).resolve(\"application.properties\").toFile();\n+                if (appConfig.isFile()) {\n+                    try (InputStream pw = new FileInputStream(appConfig)) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NjQ2MDQ3Mw=="}, "originalCommit": {"oid": "c96f24ac3472627c3f93c408049a6931e99cae47"}, "originalPosition": 29}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NjQ5MTc2NA==", "bodyText": "Oh, yeah! I'll give it a shot and see if I can come up with anything", "url": "https://github.com/quarkusio/quarkus/pull/6552#discussion_r366491764", "createdAt": "2020-01-14T18:08:15Z", "author": {"login": "geoand"}, "path": "extensions/undertow-websockets/deployment/src/main/java/io/quarkus/undertow/websockets/deployment/WebsocketHotReloadSetup.java", "diffHunk": "@@ -31,17 +31,27 @@\n \n     @Override\n     public void setupHotDeployment(HotReplacementContext hotReplacementContext) {\n-        List<Path> resources = hotReplacementContext.getResourcesDir();\n-        if (!resources.isEmpty()) {\n-            //TODO: fix this\n-            File appConfig = resources.get(0).resolve(\"application.properties\").toFile();\n-            if (appConfig.isFile()) {\n-                try (InputStream pw = new FileInputStream(appConfig)) {\n-                    Properties p = new Properties();\n-                    p.load(pw);\n-                    replacementPassword = p.getProperty(HotReplacementWebsocketEndpoint.QUARKUS_HOT_RELOAD_PASSWORD);\n-                } catch (IOException e) {\n-                    logger.error(\"Failed to read application.properties\", e);\n+        // we can't use the typical ConfigProvider.getConfig() because it throws an ISE\n+        String password = System.getProperty(HotReplacementWebsocketEndpoint.QUARKUS_HOT_RELOAD_PASSWORD);\n+        if (password == null || password.isEmpty()) {\n+            password = System.getenv(HotReplacementWebsocketEndpoint.QUARKUS_HOT_RELOAD_PASSWORD_ENV);\n+        }\n+\n+        if (password != null && !password.isEmpty()) {\n+            replacementPassword = password;\n+        } else {\n+            List<Path> resources = hotReplacementContext.getResourcesDir();\n+            if (!resources.isEmpty()) {\n+                //TODO: fix this\n+                File appConfig = resources.get(0).resolve(\"application.properties\").toFile();\n+                if (appConfig.isFile()) {\n+                    try (InputStream pw = new FileInputStream(appConfig)) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NjQ2MDQ3Mw=="}, "originalCommit": {"oid": "c96f24ac3472627c3f93c408049a6931e99cae47"}, "originalPosition": 29}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NjU2NjcyNw==", "bodyText": "I pushed a fix to use InputStreamReader for now. I'll dig into the issue more to see if there is any change using the regular config infrastructure tomorrow morning", "url": "https://github.com/quarkusio/quarkus/pull/6552#discussion_r366566727", "createdAt": "2020-01-14T20:53:20Z", "author": {"login": "geoand"}, "path": "extensions/undertow-websockets/deployment/src/main/java/io/quarkus/undertow/websockets/deployment/WebsocketHotReloadSetup.java", "diffHunk": "@@ -31,17 +31,27 @@\n \n     @Override\n     public void setupHotDeployment(HotReplacementContext hotReplacementContext) {\n-        List<Path> resources = hotReplacementContext.getResourcesDir();\n-        if (!resources.isEmpty()) {\n-            //TODO: fix this\n-            File appConfig = resources.get(0).resolve(\"application.properties\").toFile();\n-            if (appConfig.isFile()) {\n-                try (InputStream pw = new FileInputStream(appConfig)) {\n-                    Properties p = new Properties();\n-                    p.load(pw);\n-                    replacementPassword = p.getProperty(HotReplacementWebsocketEndpoint.QUARKUS_HOT_RELOAD_PASSWORD);\n-                } catch (IOException e) {\n-                    logger.error(\"Failed to read application.properties\", e);\n+        // we can't use the typical ConfigProvider.getConfig() because it throws an ISE\n+        String password = System.getProperty(HotReplacementWebsocketEndpoint.QUARKUS_HOT_RELOAD_PASSWORD);\n+        if (password == null || password.isEmpty()) {\n+            password = System.getenv(HotReplacementWebsocketEndpoint.QUARKUS_HOT_RELOAD_PASSWORD_ENV);\n+        }\n+\n+        if (password != null && !password.isEmpty()) {\n+            replacementPassword = password;\n+        } else {\n+            List<Path> resources = hotReplacementContext.getResourcesDir();\n+            if (!resources.isEmpty()) {\n+                //TODO: fix this\n+                File appConfig = resources.get(0).resolve(\"application.properties\").toFile();\n+                if (appConfig.isFile()) {\n+                    try (InputStream pw = new FileInputStream(appConfig)) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NjQ2MDQ3Mw=="}, "originalCommit": {"oid": "c96f24ac3472627c3f93c408049a6931e99cae47"}, "originalPosition": 29}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjI2NDE1NjY0OnYy", "diffSide": "RIGHT", "path": "extensions/undertow-websockets/deployment/src/main/java/io/quarkus/undertow/websockets/deployment/HotReplacementWebsocketEndpoint.java", "isResolved": true, "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0xNFQxNzoyMDoyMlrOFdffuw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0xNFQyMDo1MzoyOFrOFdldfg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NjQ2OTA1MQ==", "bodyText": "Should we rename the _HOT_RELOAD constants to _LIVE_RELOAD (it can be done in a separate commit/pr)", "url": "https://github.com/quarkusio/quarkus/pull/6552#discussion_r366469051", "createdAt": "2020-01-14T17:20:22Z", "author": {"login": "gsmet"}, "path": "extensions/undertow-websockets/deployment/src/main/java/io/quarkus/undertow/websockets/deployment/HotReplacementWebsocketEndpoint.java", "diffHunk": "@@ -36,6 +36,7 @@\n     static final String QUARKUS_HOT_RELOAD = \"/quarkus/live-reload\";\n     static final String QUARKUS_SECURITY_KEY = \"quarkus-security-key\";\n     static final String QUARKUS_HOT_RELOAD_PASSWORD = \"quarkus.live-reload.password\";\n+    static final String QUARKUS_HOT_RELOAD_PASSWORD_ENV = \"QUARKUS_LIVE_RELOAD_PASSWORD\";", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c96f24ac3472627c3f93c408049a6931e99cae47"}, "originalPosition": 4}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NjQ3MjY4Nw==", "bodyText": "Good idea, we use that terminology elsewhere so it makes sense to be consistent", "url": "https://github.com/quarkusio/quarkus/pull/6552#discussion_r366472687", "createdAt": "2020-01-14T17:27:47Z", "author": {"login": "geoand"}, "path": "extensions/undertow-websockets/deployment/src/main/java/io/quarkus/undertow/websockets/deployment/HotReplacementWebsocketEndpoint.java", "diffHunk": "@@ -36,6 +36,7 @@\n     static final String QUARKUS_HOT_RELOAD = \"/quarkus/live-reload\";\n     static final String QUARKUS_SECURITY_KEY = \"quarkus-security-key\";\n     static final String QUARKUS_HOT_RELOAD_PASSWORD = \"quarkus.live-reload.password\";\n+    static final String QUARKUS_HOT_RELOAD_PASSWORD_ENV = \"QUARKUS_LIVE_RELOAD_PASSWORD\";", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NjQ2OTA1MQ=="}, "originalCommit": {"oid": "c96f24ac3472627c3f93c408049a6931e99cae47"}, "originalPosition": 4}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NjU2Njc4Mg==", "bodyText": "Done", "url": "https://github.com/quarkusio/quarkus/pull/6552#discussion_r366566782", "createdAt": "2020-01-14T20:53:28Z", "author": {"login": "geoand"}, "path": "extensions/undertow-websockets/deployment/src/main/java/io/quarkus/undertow/websockets/deployment/HotReplacementWebsocketEndpoint.java", "diffHunk": "@@ -36,6 +36,7 @@\n     static final String QUARKUS_HOT_RELOAD = \"/quarkus/live-reload\";\n     static final String QUARKUS_SECURITY_KEY = \"quarkus-security-key\";\n     static final String QUARKUS_HOT_RELOAD_PASSWORD = \"quarkus.live-reload.password\";\n+    static final String QUARKUS_HOT_RELOAD_PASSWORD_ENV = \"QUARKUS_LIVE_RELOAD_PASSWORD\";", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NjQ2OTA1MQ=="}, "originalCommit": {"oid": "c96f24ac3472627c3f93c408049a6931e99cae47"}, "originalPosition": 4}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1197, "cost": 1, "resetAt": "2021-11-13T12:26:42Z"}}}