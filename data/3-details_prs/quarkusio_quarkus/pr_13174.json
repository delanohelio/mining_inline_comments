{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTE3MzEwMTMx", "number": 13174, "title": "Handle gradle multiple source directories in test extension", "bodyText": "Gradle source output depends on the language:\n\njava output goes to build/classes/java/main\nkotlin output goes to build/classes/kotlin/main\nscala output goes to build/classes/scala/main\n\nIn the QuarkusTestExtension, there is a one-to-one matching that is done from the test class directory to find the corresponding main source directory.\nIn a gradle project, if there is more than just one language, only one source output will be added to the context.\nclose #13155", "createdAt": "2020-11-08T14:02:28Z", "url": "https://github.com/quarkusio/quarkus/pull/13174", "merged": true, "mergeCommit": {"oid": "546b906104d7c9f1ad97d99941d1ce524a6b61bb"}, "closed": true, "closedAt": "2020-11-11T11:16:13Z", "author": {"login": "glefloch"}, "timelineItems": {"totalCount": 8, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdawHTOgBqjM5NzIzNjE5NTc=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdbPiYNgFqTUyNzU4ODY4Mw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "af3c7660b8323125531a24dc25608ceae8894171", "author": {"user": {"login": "glefloch", "name": "Guillaume Le Floch"}}, "url": "https://github.com/quarkusio/quarkus/commit/af3c7660b8323125531a24dc25608ceae8894171", "committedDate": "2020-11-08T13:55:37Z", "message": "Handle gradle mutliple source directories in test extension"}, "afterCommit": {"oid": "9a17a0236c2a7899c2c78477bbeb2e82ecf91fd9", "author": {"user": {"login": "glefloch", "name": "Guillaume Le Floch"}}, "url": "https://github.com/quarkusio/quarkus/commit/9a17a0236c2a7899c2c78477bbeb2e82ecf91fd9", "committedDate": "2020-11-09T08:02:16Z", "message": "Handle gradle mutliple source directories in test extension"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTI2MDE3NjM3", "url": "https://github.com/quarkusio/quarkus/pull/13174#pullrequestreview-526017637", "createdAt": "2020-11-09T08:26:21Z", "commit": {"oid": "9a17a0236c2a7899c2c78477bbeb2e82ecf91fd9"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wOVQwODoyNjoyMVrOHvjhag==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wOVQwODoyNjoyMVrOHvjhag==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxOTYyNzExNA==", "bodyText": "If a project has only one output test dir, wouldn't this dir be added twice? I.e. through this property and the default test dir that would have been added w/o this code?", "url": "https://github.com/quarkusio/quarkus/pull/13174#discussion_r519627114", "createdAt": "2020-11-09T08:26:21Z", "author": {"login": "aloubyansky"}, "path": "test-framework/junit5/src/main/java/io/quarkus/test/junit/QuarkusTestExtension.java", "diffHunk": "@@ -195,7 +198,21 @@ private ExtensionState doJavaStart(ExtensionContext context, Class<? extends Qua\n \n             // If gradle project running directly with IDE\n             if (System.getProperty(BootstrapConstants.SERIALIZED_APP_MODEL) == null) {\n-                BuildToolHelper.enableGradleAppModelForTest(projectRoot);\n+                QuarkusModel model = BuildToolHelper.enableGradleAppModelForTest(projectRoot);\n+                final Set<File> classDirectories = model.getWorkspace().getMainModule().getSourceSet().getSourceDirectories();\n+                for (File classes : classDirectories) {\n+                    if (!rootBuilder.contains(classes.toPath())) {\n+                        rootBuilder.add(classes.toPath());\n+                    }\n+                }\n+            } else if (System.getProperty(BootstrapConstants.OUTPUT_SOURCES_DIR) != null) {\n+                final String[] sourceDirectories = System.getProperty(BootstrapConstants.OUTPUT_SOURCES_DIR).split(\",\");", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "9a17a0236c2a7899c2c78477bbeb2e82ecf91fd9"}, "originalPosition": 37}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "9a17a0236c2a7899c2c78477bbeb2e82ecf91fd9", "author": {"user": {"login": "glefloch", "name": "Guillaume Le Floch"}}, "url": "https://github.com/quarkusio/quarkus/commit/9a17a0236c2a7899c2c78477bbeb2e82ecf91fd9", "committedDate": "2020-11-09T08:02:16Z", "message": "Handle gradle mutliple source directories in test extension"}, "afterCommit": {"oid": "757e43a6ac85f2f806fbfa6d45dde9824f9aee7e", "author": {"user": {"login": "glefloch", "name": "Guillaume Le Floch"}}, "url": "https://github.com/quarkusio/quarkus/commit/757e43a6ac85f2f806fbfa6d45dde9824f9aee7e", "committedDate": "2020-11-09T16:41:22Z", "message": "Handle gradle mutliple source directories in test extension"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "757e43a6ac85f2f806fbfa6d45dde9824f9aee7e", "author": {"user": {"login": "glefloch", "name": "Guillaume Le Floch"}}, "url": "https://github.com/quarkusio/quarkus/commit/757e43a6ac85f2f806fbfa6d45dde9824f9aee7e", "committedDate": "2020-11-09T16:41:22Z", "message": "Handle gradle mutliple source directories in test extension"}, "afterCommit": {"oid": "d15556421304a87957d071f54a70fd3742efa683", "author": {"user": {"login": "glefloch", "name": "Guillaume Le Floch"}}, "url": "https://github.com/quarkusio/quarkus/commit/d15556421304a87957d071f54a70fd3742efa683", "committedDate": "2020-11-10T08:37:33Z", "message": "Handle gradle mutliple source directories in test extension"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "dfc9e32aa2ca5f128c4d334361c6094283ccbb3d", "author": {"user": {"login": "glefloch", "name": "Guillaume Le Floch"}}, "url": "https://github.com/quarkusio/quarkus/commit/dfc9e32aa2ca5f128c4d334361c6094283ccbb3d", "committedDate": "2020-11-10T19:22:44Z", "message": "Handle gradle mutliple source directories in test extension"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "d15556421304a87957d071f54a70fd3742efa683", "author": {"user": {"login": "glefloch", "name": "Guillaume Le Floch"}}, "url": "https://github.com/quarkusio/quarkus/commit/d15556421304a87957d071f54a70fd3742efa683", "committedDate": "2020-11-10T08:37:33Z", "message": "Handle gradle mutliple source directories in test extension"}, "afterCommit": {"oid": "dfc9e32aa2ca5f128c4d334361c6094283ccbb3d", "author": {"user": {"login": "glefloch", "name": "Guillaume Le Floch"}}, "url": "https://github.com/quarkusio/quarkus/commit/dfc9e32aa2ca5f128c4d334361c6094283ccbb3d", "committedDate": "2020-11-10T19:22:44Z", "message": "Handle gradle mutliple source directories in test extension"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTI3NTg3NTc0", "url": "https://github.com/quarkusio/quarkus/pull/13174#pullrequestreview-527587574", "createdAt": "2020-11-10T20:37:37Z", "commit": {"oid": "dfc9e32aa2ca5f128c4d334361c6094283ccbb3d"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTI3NTg4Njgz", "url": "https://github.com/quarkusio/quarkus/pull/13174#pullrequestreview-527588683", "createdAt": "2020-11-10T20:39:19Z", "commit": {"oid": "dfc9e32aa2ca5f128c4d334361c6094283ccbb3d"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1497, "cost": 1, "resetAt": "2021-11-01T16:37:27Z"}}}