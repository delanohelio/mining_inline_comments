{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0Mzk5NTM5NTIy", "number": 8412, "title": "Test that CDI beans in SmallRye Health are present", "bodyText": "fixes #7030\nTest that CDI beans in SmallRye Health are present and defined HealthCheck beans are registered once with the expected metadata", "createdAt": "2020-04-06T10:23:09Z", "url": "https://github.com/quarkusio/quarkus/pull/8412", "merged": true, "mergeCommit": {"oid": "f866a7f4a4a03d6b59e07028e8e55264f2c7c16e"}, "closed": true, "closedAt": "2020-04-06T20:54:04Z", "author": {"login": "antoinesd"}, "timelineItems": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcU9B0nAFqTM4ODE2MDQ2Mw==", "endCursor": "Y3Vyc29yOnYyOpPPAAABcVFFWwAFqTM4ODYwODgyOQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzg4MTYwNDYz", "url": "https://github.com/quarkusio/quarkus/pull/8412#pullrequestreview-388160463", "createdAt": "2020-04-06T11:30:02Z", "commit": {"oid": "850041eab6e4c5910cf9f5520ac5643e08801a02"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wNlQxMTozMDowMlrOGBTZ9Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wNlQxMTozMDozM1rOGBTa7Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNDAxOTcwMQ==", "bodyText": "I suppose that by \"is unique\" you mean \"is exactly one\" right? In that case this should probably be\n!instances.isAmbiguous() && !instances.isUnsatisfied()\nOtherwise you would get true here even if the Instance is ambiguous or unsatisfied (the only way to get false returned would be that the Instance is ambiguous and unsatisfied at the same time, which is a nonsense), therefore the test would pass even if there were two eligible checks", "url": "https://github.com/quarkusio/quarkus/pull/8412#discussion_r404019701", "createdAt": "2020-04-06T11:30:02Z", "author": {"login": "jmartisk"}, "path": "extensions/smallrye-health/deployment/src/test/java/io/quarkus/smallrye/health/test/ExpectedBeansUnitTest.java", "diffHunk": "@@ -0,0 +1,84 @@\n+package io.quarkus.smallrye.health.test;\n+\n+import javax.enterprise.inject.Any;\n+import javax.enterprise.inject.Instance;\n+import javax.inject.Inject;\n+\n+import org.eclipse.microprofile.health.HealthCheck;\n+import org.eclipse.microprofile.health.Liveness;\n+import org.eclipse.microprofile.health.Readiness;\n+import org.jboss.shrinkwrap.api.ShrinkWrap;\n+import org.jboss.shrinkwrap.api.asset.EmptyAsset;\n+import org.jboss.shrinkwrap.api.spec.JavaArchive;\n+import org.junit.jupiter.api.Test;\n+import org.junit.jupiter.api.extension.RegisterExtension;\n+import org.wildfly.common.Assert;\n+\n+import io.quarkus.test.QuarkusUnitTest;\n+import io.smallrye.health.HealthGroup;\n+import io.smallrye.health.SmallRyeHealthReporter;\n+\n+public class ExpectedBeansUnitTest {\n+\n+    @RegisterExtension\n+    static final QuarkusUnitTest config = new QuarkusUnitTest()\n+            .setArchiveProducer(() -> ShrinkWrap.create(JavaArchive.class)\n+                    .addClasses(FailingHealthCheck.class)\n+                    .addAsManifestResource(EmptyAsset.INSTANCE, \"beans.xml\"));\n+    @Inject\n+    @Any\n+    Instance<HealthCheck> checks;\n+\n+    @Inject\n+    Instance<SmallRyeHealthReporter> reporters;\n+\n+    private boolean isUnique(Instance<?> instances) {\n+        return !(instances.isAmbiguous() && instances.isUnsatisfied());", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "850041eab6e4c5910cf9f5520ac5643e08801a02"}, "originalPosition": 36}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNDAxOTk0OQ==", "bodyText": "Wrong import, you want to use org.junit.jupiter.api.Assertions or something like that", "url": "https://github.com/quarkusio/quarkus/pull/8412#discussion_r404019949", "createdAt": "2020-04-06T11:30:33Z", "author": {"login": "jmartisk"}, "path": "extensions/smallrye-health/deployment/src/test/java/io/quarkus/smallrye/health/test/ExpectedBeansUnitTest.java", "diffHunk": "@@ -0,0 +1,84 @@\n+package io.quarkus.smallrye.health.test;\n+\n+import javax.enterprise.inject.Any;\n+import javax.enterprise.inject.Instance;\n+import javax.inject.Inject;\n+\n+import org.eclipse.microprofile.health.HealthCheck;\n+import org.eclipse.microprofile.health.Liveness;\n+import org.eclipse.microprofile.health.Readiness;\n+import org.jboss.shrinkwrap.api.ShrinkWrap;\n+import org.jboss.shrinkwrap.api.asset.EmptyAsset;\n+import org.jboss.shrinkwrap.api.spec.JavaArchive;\n+import org.junit.jupiter.api.Test;\n+import org.junit.jupiter.api.extension.RegisterExtension;\n+import org.wildfly.common.Assert;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "850041eab6e4c5910cf9f5520ac5643e08801a02"}, "originalPosition": 15}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzg4MTcwNzIz", "url": "https://github.com/quarkusio/quarkus/pull/8412#pullrequestreview-388170723", "createdAt": "2020-04-06T11:46:11Z", "commit": {"oid": "b45f887e050819f042887b254ebecaf6705fe331"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "5dbdc1efb718a3b029e39af0a11d0d60191f6390", "author": {"user": {"login": "antoinesd", "name": "Antoine Sabot-Durand"}}, "url": "https://github.com/quarkusio/quarkus/commit/5dbdc1efb718a3b029e39af0a11d0d60191f6390", "committedDate": "2020-04-06T13:05:58Z", "message": "quarkus-7030 Test that CDI beans in SmallRye Health are present"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "b45f887e050819f042887b254ebecaf6705fe331", "author": {"user": {"login": "antoinesd", "name": "Antoine Sabot-Durand"}}, "url": "https://github.com/quarkusio/quarkus/commit/b45f887e050819f042887b254ebecaf6705fe331", "committedDate": "2020-04-06T11:40:22Z", "message": "Fixing logic and import"}, "afterCommit": {"oid": "5dbdc1efb718a3b029e39af0a11d0d60191f6390", "author": {"user": {"login": "antoinesd", "name": "Antoine Sabot-Durand"}}, "url": "https://github.com/quarkusio/quarkus/commit/5dbdc1efb718a3b029e39af0a11d0d60191f6390", "committedDate": "2020-04-06T13:05:58Z", "message": "quarkus-7030 Test that CDI beans in SmallRye Health are present"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzg4NjA4ODI5", "url": "https://github.com/quarkusio/quarkus/pull/8412#pullrequestreview-388608829", "createdAt": "2020-04-06T20:53:52Z", "commit": {"oid": "5dbdc1efb718a3b029e39af0a11d0d60191f6390"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4741, "cost": 1, "resetAt": "2021-11-02T10:47:05Z"}}}