{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0MzY2MTE4ODUz", "number": 6733, "reviewThreads": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yM1QwOToxMDozM1rODaGOeQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yM1QyMTozMToyNlrODaUYjw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjI4NjkxNTc3OnYy", "diffSide": "RIGHT", "path": "extensions/vertx-http/runtime/src/main/java/io/quarkus/vertx/http/runtime/HttpConfiguration.java", "isResolved": true, "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yM1QwOToxMDozM1rOFg3DLw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yM1QxMDoxNzowM1rOFg5Dsg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MDAwMDY4Nw==", "bodyText": "Why isn't it the default to use those values if present? Security reasons because any user could use them?", "url": "https://github.com/quarkusio/quarkus/pull/6733#discussion_r370000687", "createdAt": "2020-01-23T09:10:33Z", "author": {"login": "FroMage"}, "path": "extensions/vertx-http/runtime/src/main/java/io/quarkus/vertx/http/runtime/HttpConfiguration.java", "diffHunk": "@@ -49,6 +49,20 @@\n     @ConfigItem(defaultValue = \"8444\")\n     public int testSslPort;\n \n+    /**\n+     * If this is true then the address, scheme etc will be set from headers forwarded by the proxy server, such as\n+     * {@code X-Forwarded-For}. This should only be set if you are behind a proxy that sets these headers.\n+     */\n+    @ConfigItem(defaultValue = \"false\")\n+    public boolean proxyAddressForwarding;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "176a1838b61c5759adbf678140a425c4308cfd85"}, "originalPosition": 9}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MDAyNDkwOA==", "bodyText": "Yea, any client can add them if this is not configured and spoof their address etc.", "url": "https://github.com/quarkusio/quarkus/pull/6733#discussion_r370024908", "createdAt": "2020-01-23T09:59:45Z", "author": {"login": "stuartwdouglas"}, "path": "extensions/vertx-http/runtime/src/main/java/io/quarkus/vertx/http/runtime/HttpConfiguration.java", "diffHunk": "@@ -49,6 +49,20 @@\n     @ConfigItem(defaultValue = \"8444\")\n     public int testSslPort;\n \n+    /**\n+     * If this is true then the address, scheme etc will be set from headers forwarded by the proxy server, such as\n+     * {@code X-Forwarded-For}. This should only be set if you are behind a proxy that sets these headers.\n+     */\n+    @ConfigItem(defaultValue = \"false\")\n+    public boolean proxyAddressForwarding;", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MDAwMDY4Nw=="}, "originalCommit": {"oid": "176a1838b61c5759adbf678140a425c4308cfd85"}, "originalPosition": 9}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MDAzMzU4Ng==", "bodyText": "OK thanks.", "url": "https://github.com/quarkusio/quarkus/pull/6733#discussion_r370033586", "createdAt": "2020-01-23T10:17:03Z", "author": {"login": "FroMage"}, "path": "extensions/vertx-http/runtime/src/main/java/io/quarkus/vertx/http/runtime/HttpConfiguration.java", "diffHunk": "@@ -49,6 +49,20 @@\n     @ConfigItem(defaultValue = \"8444\")\n     public int testSslPort;\n \n+    /**\n+     * If this is true then the address, scheme etc will be set from headers forwarded by the proxy server, such as\n+     * {@code X-Forwarded-For}. This should only be set if you are behind a proxy that sets these headers.\n+     */\n+    @ConfigItem(defaultValue = \"false\")\n+    public boolean proxyAddressForwarding;", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MDAwMDY4Nw=="}, "originalCommit": {"oid": "176a1838b61c5759adbf678140a425c4308cfd85"}, "originalPosition": 9}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjI4NjkxODA4OnYy", "diffSide": "RIGHT", "path": "extensions/vertx-http/runtime/src/main/java/io/quarkus/vertx/http/runtime/HttpConfiguration.java", "isResolved": true, "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yM1QwOToxMToxMFrOFg3Eag==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yM1QxMDoxNjo1NVrOFg5DdA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MDAwMTAwMg==", "bodyText": "Why not use Forwarded if present (since it's the new preferred header) and fall-back to X-Forwarded otherwise? Why do we need a config?", "url": "https://github.com/quarkusio/quarkus/pull/6733#discussion_r370001002", "createdAt": "2020-01-23T09:11:10Z", "author": {"login": "FroMage"}, "path": "extensions/vertx-http/runtime/src/main/java/io/quarkus/vertx/http/runtime/HttpConfiguration.java", "diffHunk": "@@ -49,6 +49,20 @@\n     @ConfigItem(defaultValue = \"8444\")\n     public int testSslPort;\n \n+    /**\n+     * If this is true then the address, scheme etc will be set from headers forwarded by the proxy server, such as\n+     * {@code X-Forwarded-For}. This should only be set if you are behind a proxy that sets these headers.\n+     */\n+    @ConfigItem(defaultValue = \"false\")\n+    public boolean proxyAddressForwarding;\n+\n+    /**\n+     * If this is true and proxy address forwarding is enabled then the standard {@code Forwarded} header will be used,\n+     * rather than the more common but not standard {@code X-Forwarded-For}.\n+     */\n+    @ConfigItem(defaultValue = \"false\")\n+    public boolean allowForwarded;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "176a1838b61c5759adbf678140a425c4308cfd85"}, "originalPosition": 16}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MDAyNTU5NQ==", "bodyText": "Because an old proxy that is using X-Forwarded likely does not understand Forwarded, and will just pass it through to the backend, allowing any remote client to spoof their address. The code I copied this from actually does this, and I think it is wrong: vert-x3/vertx-web#1519", "url": "https://github.com/quarkusio/quarkus/pull/6733#discussion_r370025595", "createdAt": "2020-01-23T10:01:05Z", "author": {"login": "stuartwdouglas"}, "path": "extensions/vertx-http/runtime/src/main/java/io/quarkus/vertx/http/runtime/HttpConfiguration.java", "diffHunk": "@@ -49,6 +49,20 @@\n     @ConfigItem(defaultValue = \"8444\")\n     public int testSslPort;\n \n+    /**\n+     * If this is true then the address, scheme etc will be set from headers forwarded by the proxy server, such as\n+     * {@code X-Forwarded-For}. This should only be set if you are behind a proxy that sets these headers.\n+     */\n+    @ConfigItem(defaultValue = \"false\")\n+    public boolean proxyAddressForwarding;\n+\n+    /**\n+     * If this is true and proxy address forwarding is enabled then the standard {@code Forwarded} header will be used,\n+     * rather than the more common but not standard {@code X-Forwarded-For}.\n+     */\n+    @ConfigItem(defaultValue = \"false\")\n+    public boolean allowForwarded;", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MDAwMTAwMg=="}, "originalCommit": {"oid": "176a1838b61c5759adbf678140a425c4308cfd85"}, "originalPosition": 16}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MDAzMzUyNA==", "bodyText": "Oh damn, that's subtle. OK.", "url": "https://github.com/quarkusio/quarkus/pull/6733#discussion_r370033524", "createdAt": "2020-01-23T10:16:55Z", "author": {"login": "FroMage"}, "path": "extensions/vertx-http/runtime/src/main/java/io/quarkus/vertx/http/runtime/HttpConfiguration.java", "diffHunk": "@@ -49,6 +49,20 @@\n     @ConfigItem(defaultValue = \"8444\")\n     public int testSslPort;\n \n+    /**\n+     * If this is true then the address, scheme etc will be set from headers forwarded by the proxy server, such as\n+     * {@code X-Forwarded-For}. This should only be set if you are behind a proxy that sets these headers.\n+     */\n+    @ConfigItem(defaultValue = \"false\")\n+    public boolean proxyAddressForwarding;\n+\n+    /**\n+     * If this is true and proxy address forwarding is enabled then the standard {@code Forwarded} header will be used,\n+     * rather than the more common but not standard {@code X-Forwarded-For}.\n+     */\n+    @ConfigItem(defaultValue = \"false\")\n+    public boolean allowForwarded;", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MDAwMTAwMg=="}, "originalCommit": {"oid": "176a1838b61c5759adbf678140a425c4308cfd85"}, "originalPosition": 16}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjI4OTIzNTM1OnYy", "diffSide": "RIGHT", "path": "extensions/vertx-http/runtime/src/main/java/io/quarkus/vertx/http/runtime/ForwardedServerRequestWrapper.java", "isResolved": true, "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yM1QyMTozMToyNlrOFhNTPw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yOFQxMDo0ODo0NVrOFigniA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MDM2NTI0Nw==", "bodyText": "@stuartwdouglas Hi Stuart, can it be of some help if the request info being replaced with this wrapper be contained as HttpServerRequest attribute ? So that it can be logged if needed etc ? Not really sure, just checking.\nAll looks good", "url": "https://github.com/quarkusio/quarkus/pull/6733#discussion_r370365247", "createdAt": "2020-01-23T21:31:26Z", "author": {"login": "sberyozkin"}, "path": "extensions/vertx-http/runtime/src/main/java/io/quarkus/vertx/http/runtime/ForwardedServerRequestWrapper.java", "diffHunk": "@@ -0,0 +1,314 @@\n+package io.quarkus.vertx.http.runtime;\n+\n+import java.util.Map;\n+\n+import javax.net.ssl.SSLPeerUnverifiedException;\n+import javax.net.ssl.SSLSession;\n+import javax.security.cert.X509Certificate;\n+\n+import io.vertx.core.Handler;\n+import io.vertx.core.MultiMap;\n+import io.vertx.core.buffer.Buffer;\n+import io.vertx.core.http.*;\n+import io.vertx.core.net.NetSocket;\n+import io.vertx.core.net.SocketAddress;\n+\n+class ForwardedServerRequestWrapper implements HttpServerRequest {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "176a1838b61c5759adbf678140a425c4308cfd85"}, "originalPosition": 16}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MDQwMTEwMQ==", "bodyText": "I don't really know if it is needed, generally you know what your proxies are. Maybe wait and see if anyone asks for it?", "url": "https://github.com/quarkusio/quarkus/pull/6733#discussion_r370401101", "createdAt": "2020-01-23T23:03:09Z", "author": {"login": "stuartwdouglas"}, "path": "extensions/vertx-http/runtime/src/main/java/io/quarkus/vertx/http/runtime/ForwardedServerRequestWrapper.java", "diffHunk": "@@ -0,0 +1,314 @@\n+package io.quarkus.vertx.http.runtime;\n+\n+import java.util.Map;\n+\n+import javax.net.ssl.SSLPeerUnverifiedException;\n+import javax.net.ssl.SSLSession;\n+import javax.security.cert.X509Certificate;\n+\n+import io.vertx.core.Handler;\n+import io.vertx.core.MultiMap;\n+import io.vertx.core.buffer.Buffer;\n+import io.vertx.core.http.*;\n+import io.vertx.core.net.NetSocket;\n+import io.vertx.core.net.SocketAddress;\n+\n+class ForwardedServerRequestWrapper implements HttpServerRequest {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MDM2NTI0Nw=="}, "originalCommit": {"oid": "176a1838b61c5759adbf678140a425c4308cfd85"}, "originalPosition": 16}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MTczMDMxMg==", "bodyText": "@stuartwdouglas sorry, I keep missing the comments from Github...yes, makes sense", "url": "https://github.com/quarkusio/quarkus/pull/6733#discussion_r371730312", "createdAt": "2020-01-28T10:48:45Z", "author": {"login": "sberyozkin"}, "path": "extensions/vertx-http/runtime/src/main/java/io/quarkus/vertx/http/runtime/ForwardedServerRequestWrapper.java", "diffHunk": "@@ -0,0 +1,314 @@\n+package io.quarkus.vertx.http.runtime;\n+\n+import java.util.Map;\n+\n+import javax.net.ssl.SSLPeerUnverifiedException;\n+import javax.net.ssl.SSLSession;\n+import javax.security.cert.X509Certificate;\n+\n+import io.vertx.core.Handler;\n+import io.vertx.core.MultiMap;\n+import io.vertx.core.buffer.Buffer;\n+import io.vertx.core.http.*;\n+import io.vertx.core.net.NetSocket;\n+import io.vertx.core.net.SocketAddress;\n+\n+class ForwardedServerRequestWrapper implements HttpServerRequest {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MDM2NTI0Nw=="}, "originalCommit": {"oid": "176a1838b61c5759adbf678140a425c4308cfd85"}, "originalPosition": 16}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1137, "cost": 1, "resetAt": "2021-11-13T12:26:42Z"}}}