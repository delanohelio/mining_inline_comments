{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDIwNjA2NDQy", "number": 9484, "reviewThreads": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yMFQxMzoxNzo0MFrOD-NkPQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yMFQxMzoxNzo0MFrOD-NkPQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjY2NTYwNTczOnYy", "diffSide": "RIGHT", "path": "extensions/undertow/runtime/src/main/java/io/quarkus/undertow/runtime/QuarkusErrorServlet.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yMFQxMzoxNzo0MFrOGYLJfg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yMFQyMTowMDowMFrOGYdn5Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyODAwMTY2Mg==", "bodyText": "I think it is escaped later in TemplateHtmlBuilder so we don't need to escape it here. Am I right?", "url": "https://github.com/quarkusio/quarkus/pull/9484#discussion_r428001662", "createdAt": "2020-05-20T13:17:40Z", "author": {"login": "gsmet"}, "path": "extensions/undertow/runtime/src/main/java/io/quarkus/undertow/runtime/QuarkusErrorServlet.java", "diffHunk": "@@ -40,15 +40,17 @@ protected void service(HttpServletRequest req, HttpServletResponse resp) throws\n         if (accept != null && accept.contains(\"application/json\")) {\n             resp.setContentType(\"application/json\");\n             resp.setCharacterEncoding(StandardCharsets.UTF_8.name());\n-            String escapedStack = stack.replace(System.lineSeparator(), \"\\\\n\").replace(\"\\\"\", \"\\\\\\\"\");\n-            StringBuilder jsonPayload = new StringBuilder(\"{\\\"details\\\":\\\"\").append(details).append(\"\\\",\\\"stack\\\":\\\"\")\n-                    .append(escapedStack).append(\"\\\"}\");\n+            String escapedDetails = escapeJsonString(details);\n+            String escapedStack = escapeJsonString(stack);\n+            StringBuilder jsonPayload = new StringBuilder(\"{\\\"details\\\":\\\"\").append(escapedDetails)\n+                    .append(\"\\\",\\\"stack\\\":\\\"\").append(escapedStack).append(\"\\\"}\");\n             resp.getWriter().write(jsonPayload.toString());\n         } else {\n             //We default to HTML representation\n+            String escapedDetails = escapeHtml(details);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c56855997c1b4ddf33ddb4c5a30b59f34073f013"}, "originalPosition": 14}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyODMwNDM1Nw==", "bodyText": "Yes, it is also escaped in the TemplateHtmlBuilder directly in the used constructor. I just removed the escaping from QuarkusErrorServlet.", "url": "https://github.com/quarkusio/quarkus/pull/9484#discussion_r428304357", "createdAt": "2020-05-20T21:00:00Z", "author": {"login": "lodrantl"}, "path": "extensions/undertow/runtime/src/main/java/io/quarkus/undertow/runtime/QuarkusErrorServlet.java", "diffHunk": "@@ -40,15 +40,17 @@ protected void service(HttpServletRequest req, HttpServletResponse resp) throws\n         if (accept != null && accept.contains(\"application/json\")) {\n             resp.setContentType(\"application/json\");\n             resp.setCharacterEncoding(StandardCharsets.UTF_8.name());\n-            String escapedStack = stack.replace(System.lineSeparator(), \"\\\\n\").replace(\"\\\"\", \"\\\\\\\"\");\n-            StringBuilder jsonPayload = new StringBuilder(\"{\\\"details\\\":\\\"\").append(details).append(\"\\\",\\\"stack\\\":\\\"\")\n-                    .append(escapedStack).append(\"\\\"}\");\n+            String escapedDetails = escapeJsonString(details);\n+            String escapedStack = escapeJsonString(stack);\n+            StringBuilder jsonPayload = new StringBuilder(\"{\\\"details\\\":\\\"\").append(escapedDetails)\n+                    .append(\"\\\",\\\"stack\\\":\\\"\").append(escapedStack).append(\"\\\"}\");\n             resp.getWriter().write(jsonPayload.toString());\n         } else {\n             //We default to HTML representation\n+            String escapedDetails = escapeHtml(details);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyODAwMTY2Mg=="}, "originalCommit": {"oid": "c56855997c1b4ddf33ddb4c5a30b59f34073f013"}, "originalPosition": 14}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3121, "cost": 1, "resetAt": "2021-11-13T14:23:39Z"}}}