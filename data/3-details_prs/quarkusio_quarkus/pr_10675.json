{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDQ4MTc3NzYz", "number": 10675, "title": "Make sure that test callbacks always work on the proper test method", "bodyText": "Without this fix, the testMethod of QuarkusTestMethodContext was using the method of the original class - which was not of much use since for example annotations could not be fetched unless the callback itself resorted to classloader hacks.\nFurthermore, the callbacks were misbehaving when multiple test profiles were being used in the testsuite.\nFixes: #10623", "createdAt": "2020-07-13T10:54:00Z", "url": "https://github.com/quarkusio/quarkus/pull/10675", "merged": true, "mergeCommit": {"oid": "0fe9e89b46a830eb4994caba643cb8247624b195"}, "closed": true, "closedAt": "2020-07-16T01:28:42Z", "author": {"login": "geoand"}, "timelineItems": {"totalCount": 7, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABc0gSJwAFqTQ0NzE4OTI3MA==", "endCursor": "Y3Vyc29yOnYyOpPPAAABc1U80aAFqTQ0OTQ0NzE4MQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDQ3MTg5Mjcw", "url": "https://github.com/quarkusio/quarkus/pull/10675#pullrequestreview-447189270", "createdAt": "2020-07-13T12:06:56Z", "commit": {"oid": "f3813efab4ed9ce3c60294be5398c4e118f5ab31"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xM1QxMjowNjo1NlrOGwlrZQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xM1QxMjowNjo1NlrOGwlrZQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MzYwMjE0OQ==", "bodyText": "This is done for every class in hierarchy (until the method is found). Wouldn't once be sufficient?", "url": "https://github.com/quarkusio/quarkus/pull/10675#discussion_r453602149", "createdAt": "2020-07-13T12:06:56Z", "author": {"login": "famod"}, "path": "test-framework/junit5/src/main/java/io/quarkus/test/junit/QuarkusTestExtension.java", "diffHunk": "@@ -363,14 +370,45 @@ public void afterEach(ExtensionContext context) throws Exception {\n         }\n     }\n \n+    // We need the usual ClassLoader hacks in order to present the callbacks with the proper test object and context\n     private Map.Entry<Class<?>, ?> createQuarkusTestMethodContextTuple(ExtensionContext context) throws Exception {\n+        ClassLoader classLoader = runningQuarkusApplication.getClassLoader();\n         if (quarkusTestMethodContextClass == null) {\n-            quarkusTestMethodContextClass = Class.forName(QuarkusTestMethodContext.class.getName(), true,\n-                    runningQuarkusApplication.getClassLoader());\n+            quarkusTestMethodContextClass = Class.forName(QuarkusTestMethodContext.class.getName(), true, classLoader);\n         }\n+\n+        Method originalTestMethod = context.getRequiredTestMethod();\n+        Class<?>[] originalParameterTypes = originalTestMethod.getParameterTypes();\n+        Method actualTestMethod = null;\n+\n+        // go up the class hierachy to fetch the proper test method\n+        Class<?> c = actualTestClass;\n+        while (c != Object.class) {\n+            try {\n+                List<Class<?>> parameterTypesFromTccl = new ArrayList<>(originalParameterTypes.length);\n+                for (Class<?> type : originalParameterTypes) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f3813efab4ed9ce3c60294be5398c4e118f5ab31"}, "originalPosition": 49}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "f3813efab4ed9ce3c60294be5398c4e118f5ab31", "author": {"user": {"login": "geoand", "name": "Georgios Andrianakis"}}, "url": "https://github.com/quarkusio/quarkus/commit/f3813efab4ed9ce3c60294be5398c4e118f5ab31", "committedDate": "2020-07-13T10:53:32Z", "message": "Make sure that test callbacks always work on the proper test method\n\nFixes: #10623"}, "afterCommit": {"oid": "a7ec72bfb619886f836b37b6a49cae2a124200a5", "author": {"user": {"login": "geoand", "name": "Georgios Andrianakis"}}, "url": "https://github.com/quarkusio/quarkus/commit/a7ec72bfb619886f836b37b6a49cae2a124200a5", "committedDate": "2020-07-13T12:28:58Z", "message": "Make sure that test callbacks always work on the proper test method\n\nFixes: #10623"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "a7ec72bfb619886f836b37b6a49cae2a124200a5", "author": {"user": {"login": "geoand", "name": "Georgios Andrianakis"}}, "url": "https://github.com/quarkusio/quarkus/commit/a7ec72bfb619886f836b37b6a49cae2a124200a5", "committedDate": "2020-07-13T12:28:58Z", "message": "Make sure that test callbacks always work on the proper test method\n\nFixes: #10623"}, "afterCommit": {"oid": "9e439f2bdc673836caa958909c2e067883665bbf", "author": {"user": {"login": "geoand", "name": "Georgios Andrianakis"}}, "url": "https://github.com/quarkusio/quarkus/commit/9e439f2bdc673836caa958909c2e067883665bbf", "committedDate": "2020-07-13T12:29:13Z", "message": "Make sure that test callbacks always work on the proper test method\n\nFixes: #10623"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "9e439f2bdc673836caa958909c2e067883665bbf", "author": {"user": {"login": "geoand", "name": "Georgios Andrianakis"}}, "url": "https://github.com/quarkusio/quarkus/commit/9e439f2bdc673836caa958909c2e067883665bbf", "committedDate": "2020-07-13T12:29:13Z", "message": "Make sure that test callbacks always work on the proper test method\n\nFixes: #10623"}, "afterCommit": {"oid": "ec45cc2063d92b25e1c6a5b2e840b3027301580a", "author": {"user": {"login": "geoand", "name": "Georgios Andrianakis"}}, "url": "https://github.com/quarkusio/quarkus/commit/ec45cc2063d92b25e1c6a5b2e840b3027301580a", "committedDate": "2020-07-13T12:31:21Z", "message": "Make sure that test callbacks always work on the proper test method\n\nFixes: #10623"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "3be2f5254d422ec256bfce36644c3f0c370a982e", "author": {"user": {"login": "geoand", "name": "Georgios Andrianakis"}}, "url": "https://github.com/quarkusio/quarkus/commit/3be2f5254d422ec256bfce36644c3f0c370a982e", "committedDate": "2020-07-14T06:27:33Z", "message": "Make sure that test callbacks always work on the proper test method\n\nFixes: #10623"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "ec45cc2063d92b25e1c6a5b2e840b3027301580a", "author": {"user": {"login": "geoand", "name": "Georgios Andrianakis"}}, "url": "https://github.com/quarkusio/quarkus/commit/ec45cc2063d92b25e1c6a5b2e840b3027301580a", "committedDate": "2020-07-13T12:31:21Z", "message": "Make sure that test callbacks always work on the proper test method\n\nFixes: #10623"}, "afterCommit": {"oid": "3be2f5254d422ec256bfce36644c3f0c370a982e", "author": {"user": {"login": "geoand", "name": "Georgios Andrianakis"}}, "url": "https://github.com/quarkusio/quarkus/commit/3be2f5254d422ec256bfce36644c3f0c370a982e", "committedDate": "2020-07-14T06:27:33Z", "message": "Make sure that test callbacks always work on the proper test method\n\nFixes: #10623"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDQ5NDQ3MTgx", "url": "https://github.com/quarkusio/quarkus/pull/10675#pullrequestreview-449447181", "createdAt": "2020-07-16T01:28:36Z", "commit": {"oid": "3be2f5254d422ec256bfce36644c3f0c370a982e"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3535, "cost": 1, "resetAt": "2021-11-01T16:37:27Z"}}}