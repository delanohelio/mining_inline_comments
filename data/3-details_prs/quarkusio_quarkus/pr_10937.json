{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDU1NzA1MDE2", "number": 10937, "title": "Make security.adoc the main Quarkus Security document", "bodyText": "Fixes #10694\nFixes #10856\nFixes #10427\nFixes #10361\nThis PR attempts to re-purpose security.adoc into the main entry page about everything related to Quarkus Security. Right now Googling for Quarkus Security links to security.adoc so it would be good if the users who land on this page can have an immediate high-level picture of what Quarkus Security offers.\nSome help from @stuartwdouglas and other colleagues will most likely needed to complete this PR and improve the language where needed.\nNote this PR does not aim to change the layout of the docs/etc, the immediate task is to have a central page about the security which does a brief overview of all the security features and links to the specific docs/guides. Further overall doc optimizations can follow independently.\nSo in this PR:\n\nsecurity.adoc provides a brief overview of various sec features and links further. It would be good to have a small diagram in its Architrecture section but we can add it later.\nAll the info related to the authorization is now in security-authorization.adoc (where more can be added as needed)\nAll the info related to the core/built-in authentication (Basic, Form, MTLS) + proactive authentication - is now in security-built-in-authentication.adoc\nAll the info related to the customizations and other useful tips is now in security-customization.adoc\nAll the info related to the testing is in security-testing.adoc\n\nSome sections can be moved around but IMHO it is not a bad start toward consolidating the security documentation.\nI'll be off for the next 3 weeks, I'll take care of all the review comments when I get back but it this PR will have been merged by then then it would be great too :-)", "createdAt": "2020-07-23T13:24:12Z", "url": "https://github.com/quarkusio/quarkus/pull/10937", "merged": true, "mergeCommit": {"oid": "abb0c966f1148e414e3046738e7a46ffaaf1d6d9"}, "closed": true, "closedAt": "2020-07-28T13:23:58Z", "author": {"login": "sberyozkin"}, "timelineItems": {"totalCount": 19, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABc3vgBhAFqTQ1NDEzMzM0OA==", "endCursor": "Y3Vyc29yOnYyOpPPAAABc5WQBxgFqTQ1NjYxNzg3Ng==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDU0MTMzMzQ4", "url": "https://github.com/quarkusio/quarkus/pull/10937#pullrequestreview-454133348", "createdAt": "2020-07-23T13:32:25Z", "commit": {"oid": "f81fb4733c2cd802a277568a68cb9dcb96bc209a"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yM1QxMzozMjoyNVrOG2Kq7A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yM1QxMzozMjoyNVrOG2Kq7A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1OTQ1MTExNg==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            Quarkus has an integrated plugable web security layer. If security is enabled all HTTP requests will have a permission\n          \n          \n            \n            Quarkus has an integrated pluggable web security layer. If security is enabled all HTTP requests will have a permission", "url": "https://github.com/quarkusio/quarkus/pull/10937#discussion_r459451116", "createdAt": "2020-07-23T13:32:25Z", "author": {"login": "gastaldi"}, "path": "docs/src/main/asciidoc/security-authorization.adoc", "diffHunk": "@@ -0,0 +1,139 @@\n+////\n+This guide is maintained in the main Quarkus repository\n+and pull requests should be submitted there:\n+https://github.com/quarkusio/quarkus/tree/master/docs/src/main/asciidoc\n+////\n+= Quarkus - Authorization of Web Endpoints\n+\n+include::./attributes.adoc[]\n+\n+Quarkus has an integrated plugable web security layer. If security is enabled all HTTP requests will have a permission", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f81fb4733c2cd802a277568a68cb9dcb96bc209a"}, "originalPosition": 10}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "f81fb4733c2cd802a277568a68cb9dcb96bc209a", "author": {"user": {"login": "sberyozkin", "name": null}}, "url": "https://github.com/quarkusio/quarkus/commit/f81fb4733c2cd802a277568a68cb9dcb96bc209a", "committedDate": "2020-07-23T12:41:30Z", "message": "Make security.adoc the main Quarkus Security document"}, "afterCommit": {"oid": "ab9afac77f47883e94b7d03fc3f01fa798b6c2ec", "author": {"user": {"login": "sberyozkin", "name": null}}, "url": "https://github.com/quarkusio/quarkus/commit/ab9afac77f47883e94b7d03fc3f01fa798b6c2ec", "committedDate": "2020-07-23T13:32:50Z", "message": "Make security.adoc the main Quarkus Security document"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "8647c933a313023a62c546c08b874f2084f63f4f", "author": {"user": {"login": "sberyozkin", "name": null}}, "url": "https://github.com/quarkusio/quarkus/commit/8647c933a313023a62c546c08b874f2084f63f4f", "committedDate": "2020-07-23T13:40:47Z", "message": "Update docs/src/main/asciidoc/security-authorization.adoc\n\nCo-authored-by: George Gastaldi <gegastaldi@gmail.com>"}, "afterCommit": {"oid": "9dc4035fe35956767c207a98f0636674b8ffdcd8", "author": {"user": {"login": "sberyozkin", "name": null}}, "url": "https://github.com/quarkusio/quarkus/commit/9dc4035fe35956767c207a98f0636674b8ffdcd8", "committedDate": "2020-07-23T13:50:39Z", "message": "Make security.adoc the main Quarkus Security document"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDU0MTQzNzY4", "url": "https://github.com/quarkusio/quarkus/pull/10937#pullrequestreview-454143768", "createdAt": "2020-07-23T13:43:57Z", "commit": {"oid": "8647c933a313023a62c546c08b874f2084f63f4f"}, "state": "COMMENTED", "comments": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yM1QxMzo0Mzo1N1rOG2LKUQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yM1QxMzo1MTo0MVrOG2Lfzw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1OTQ1OTE1Mw==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            check performed to make sure they are permitted to continue.\n          \n          \n            \n            check performed to make sure they are allowed to continue.", "url": "https://github.com/quarkusio/quarkus/pull/10937#discussion_r459459153", "createdAt": "2020-07-23T13:43:57Z", "author": {"login": "gastaldi"}, "path": "docs/src/main/asciidoc/security-authorization.adoc", "diffHunk": "@@ -0,0 +1,138 @@\n+////\n+This guide is maintained in the main Quarkus repository\n+and pull requests should be submitted there:\n+https://github.com/quarkusio/quarkus/tree/master/docs/src/main/asciidoc\n+////\n+= Quarkus - Authorization of Web Endpoints\n+\n+include::./attributes.adoc[]\n+\n+Quarkus has an integrated pluggable web security layer. If security is enabled all HTTP requests will have a permission\n+check performed to make sure they are permitted to continue.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "8647c933a313023a62c546c08b874f2084f63f4f"}, "originalPosition": 11}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1OTQ2MDc3Nw==", "bodyText": "Maybe list the core extensions that provide that with links to their respective docs?", "url": "https://github.com/quarkusio/quarkus/pull/10937#discussion_r459460777", "createdAt": "2020-07-23T13:46:16Z", "author": {"login": "gastaldi"}, "path": "docs/src/main/asciidoc/security-built-in-authentication.adoc", "diffHunk": "@@ -0,0 +1,163 @@\n+////\n+This guide is maintained in the main Quarkus repository\n+and pull requests should be submitted there:\n+https://github.com/quarkusio/quarkus/tree/master/docs/src/main/asciidoc\n+////\n+= Quarkus - BuiltIn Authentication Support\n+\n+include::./attributes.adoc[]\n+\n+This document describes the Quarkus built in authentication mechanisms for HTTP based FORM, BASIC and Mutual TLS authentication as well as the proactive authentication.\n+\n+[[basic-auth]]\n+== Basic Authentication\n+\n+To enable basic authentication set `quarkus.http.auth.basic=true`. You must also have at least one extension installed\n+that provides a username/password based `IdentityProvider`, such as link:security-jdbc[Elytron JDBC].", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "8647c933a313023a62c546c08b874f2084f63f4f"}, "originalPosition": 16}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1OTQ2MjQ5NQ==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            traditional form authentication the authenticated user is not stored in a HTTP session, as Quarkus does not provide\n          \n          \n            \n            traditional form authentication the authenticated user is not stored in an HTTP session, as Quarkus does not provide", "url": "https://github.com/quarkusio/quarkus/pull/10937#discussion_r459462495", "createdAt": "2020-07-23T13:48:43Z", "author": {"login": "gastaldi"}, "path": "docs/src/main/asciidoc/security-built-in-authentication.adoc", "diffHunk": "@@ -0,0 +1,163 @@\n+////\n+This guide is maintained in the main Quarkus repository\n+and pull requests should be submitted there:\n+https://github.com/quarkusio/quarkus/tree/master/docs/src/main/asciidoc\n+////\n+= Quarkus - BuiltIn Authentication Support\n+\n+include::./attributes.adoc[]\n+\n+This document describes the Quarkus built in authentication mechanisms for HTTP based FORM, BASIC and Mutual TLS authentication as well as the proactive authentication.\n+\n+[[basic-auth]]\n+== Basic Authentication\n+\n+To enable basic authentication set `quarkus.http.auth.basic=true`. You must also have at least one extension installed\n+that provides a username/password based `IdentityProvider`, such as link:security-jdbc[Elytron JDBC].\n+\n+[[form-auth]]\n+== Form Based Authentication\n+\n+Quarkus provides form based authentication that works in a similar manner to traditional Servlet form based auth. Unlike\n+traditional form authentication the authenticated user is not stored in a HTTP session, as Quarkus does not provide", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "8647c933a313023a62c546c08b874f2084f63f4f"}, "originalPosition": 22}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1OTQ2NDY1NQ==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            One can customize `HttpAuthenticationMechanism` by registering an `ApplicationScoped` implemetation bean.\n          \n          \n            \n            One can customize `HttpAuthenticationMechanism` by registering an `ApplicationScoped` implementation bean.", "url": "https://github.com/quarkusio/quarkus/pull/10937#discussion_r459464655", "createdAt": "2020-07-23T13:51:41Z", "author": {"login": "gastaldi"}, "path": "docs/src/main/asciidoc/security-customization.adoc", "diffHunk": "@@ -0,0 +1,132 @@\n+////\n+This guide is maintained in the main Quarkus repository\n+and pull requests should be submitted there:\n+https://github.com/quarkusio/quarkus/tree/master/docs/src/main/asciidoc\n+////\n+= Quarkus - Security Tips and Tricks\n+\n+include::./attributes.adoc[]\n+\n+== HttpAuthenticationMechanism Customization\n+\n+One can customize `HttpAuthenticationMechanism` by registering an `ApplicationScoped` implemetation bean.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "9dc4035fe35956767c207a98f0636674b8ffdcd8"}, "originalPosition": 12}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "9dc4035fe35956767c207a98f0636674b8ffdcd8", "author": {"user": {"login": "sberyozkin", "name": null}}, "url": "https://github.com/quarkusio/quarkus/commit/9dc4035fe35956767c207a98f0636674b8ffdcd8", "committedDate": "2020-07-23T13:50:39Z", "message": "Make security.adoc the main Quarkus Security document"}, "afterCommit": {"oid": "a19488958535914b3d5fda2fe78188d212d877ce", "author": {"user": {"login": "sberyozkin", "name": null}}, "url": "https://github.com/quarkusio/quarkus/commit/a19488958535914b3d5fda2fe78188d212d877ce", "committedDate": "2020-07-23T17:32:01Z", "message": "Make security.adoc the main Quarkus Security document"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDU0NDUwNzUx", "url": "https://github.com/quarkusio/quarkus/pull/10937#pullrequestreview-454450751", "createdAt": "2020-07-23T19:56:42Z", "commit": {"oid": "a19488958535914b3d5fda2fe78188d212d877ce"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDU0NjMxMjU3", "url": "https://github.com/quarkusio/quarkus/pull/10937#pullrequestreview-454631257", "createdAt": "2020-07-24T04:42:40Z", "commit": {"oid": "a19488958535914b3d5fda2fe78188d212d877ce"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "a19488958535914b3d5fda2fe78188d212d877ce", "author": {"user": {"login": "sberyozkin", "name": null}}, "url": "https://github.com/quarkusio/quarkus/commit/a19488958535914b3d5fda2fe78188d212d877ce", "committedDate": "2020-07-23T17:32:01Z", "message": "Make security.adoc the main Quarkus Security document"}, "afterCommit": {"oid": "7aeb2661b70598941a6a4c85d71edb868b07b7d3", "author": {"user": {"login": "sberyozkin", "name": null}}, "url": "https://github.com/quarkusio/quarkus/commit/7aeb2661b70598941a6a4c85d71edb868b07b7d3", "committedDate": "2020-07-24T09:53:24Z", "message": "Make security.adoc the main Quarkus Security document"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDU0ODM3MTY2", "url": "https://github.com/quarkusio/quarkus/pull/10937#pullrequestreview-454837166", "createdAt": "2020-07-24T12:13:01Z", "commit": {"oid": "7aeb2661b70598941a6a4c85d71edb868b07b7d3"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDU0ODI4NTE5", "url": "https://github.com/quarkusio/quarkus/pull/10937#pullrequestreview-454828519", "createdAt": "2020-07-24T11:56:58Z", "commit": {"oid": "7aeb2661b70598941a6a4c85d71edb868b07b7d3"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yNFQxMTo1Njo1OFrOG2srkQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yNFQxMjoxMDozNlrOG2tBMA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MDAwODMzNw==", "bodyText": "Should the title be Authorization of Web Endpoints using configuration ?\nAs securing Web Endpoints is also possible (partialy) using annotation ?\nBy the way, always found usefull to link the guides together as it's not always clear for a user which one to read so a link to the annotation based authorization should be added somewhere (or a maybe add a small section to introduce it with a link to the guide that document extensively).", "url": "https://github.com/quarkusio/quarkus/pull/10937#discussion_r460008337", "createdAt": "2020-07-24T11:56:58Z", "author": {"login": "loicmathieu"}, "path": "docs/src/main/asciidoc/security-authorization.adoc", "diffHunk": "@@ -0,0 +1,138 @@\n+////\n+This guide is maintained in the main Quarkus repository\n+and pull requests should be submitted there:\n+https://github.com/quarkusio/quarkus/tree/master/docs/src/main/asciidoc\n+////\n+= Quarkus - Authorization of Web Endpoints", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "7aeb2661b70598941a6a4c85d71edb868b07b7d3"}, "originalPosition": 6}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MDAxMDkxMQ==", "bodyText": "Please, add a link to config based authorization as an alternative to annotation usage", "url": "https://github.com/quarkusio/quarkus/pull/10937#discussion_r460010911", "createdAt": "2020-07-24T12:03:20Z", "author": {"login": "loicmathieu"}, "path": "docs/src/main/asciidoc/security-built-in-authentication.adoc", "diffHunk": "@@ -0,0 +1,165 @@\n+////\n+This guide is maintained in the main Quarkus repository\n+and pull requests should be submitted there:\n+https://github.com/quarkusio/quarkus/tree/master/docs/src/main/asciidoc\n+////\n+= Quarkus - BuiltIn Authentication Support\n+\n+include::./attributes.adoc[]\n+\n+This document describes the Quarkus built in authentication mechanisms for HTTP based FORM, BASIC and Mutual TLS authentication as well as the proactive authentication.\n+\n+[[basic-auth]]\n+== Basic Authentication\n+\n+To enable basic authentication set `quarkus.http.auth.basic=true`. You must also have at least one extension installed\n+that provides a username/password based `IdentityProvider`, such as link:security-jdbc[Elytron JDBC].\n+\n+Please see link:security#identity-providers[Security Identity Providers] for more information.\n+\n+[[form-auth]]\n+== Form Based Authentication\n+\n+Quarkus provides form based authentication that works in a similar manner to traditional Servlet form based auth. Unlike\n+traditional form authentication the authenticated user is not stored in an HTTP session, as Quarkus does not provide\n+clustered HTTP session support. Instead the authentication information is stored in an encrypted cookie, which can\n+be read by all members of the cluster (provided they all share the same encryption key).\n+\n+The encryption key can be set using the `quarkus.http.auth.session.encryption-key` property, and it must be at least 16 characters\n+long. This key is hashed using SHA-256 and the resulting digest is used as a key for AES-256 encryption of the cookie\n+value. This cookie contains a expiry time as part of the encrypted value, so all nodes in the cluster must have their\n+clocks synchronised. At one minute intervals a new cookie will be generated with an updated expiry time if the session\n+is in use.\n+\n+The following properties can be used to configure form based auth:\n+\n+include::{generated-dir}/config/quarkus-vertx-http-config-group-form-auth-config.adoc[opts=optional, leveloffset=+1]\n+\n+[[mutual-tls]]\n+== Mutual TLS Authentication\n+\n+Quarkus provides mTLS authentication so that you can authenticate users based on their X.509 certificates.\n+\n+To use this authentication method, you should first enable SSL to your application. For more details, check the link:http-reference[Supporting secure connections with SSL] guide.\n+\n+Once your application is accepting secure connections, the next step is to configure a `quarkus.http.ssl.certificate.trust-store-file`\n+holding all the certificates that your application should trust as well as how your application should ask for certificates when\n+a client (e.g.: browser or another service) tries to access one of its protected resources.\n+\n+[source,properties]\n+----\n+quarkus.http.ssl.certificate.key-store-file=server-keystore.jks            <1>\n+quarkus.http.ssl.certificate.key-store-password=the_key_store_secret\n+quarkus.http.ssl.certificate.trust-store-file=server-truststore.jks        <2>\n+quarkus.http.ssl.certificate.trust-store-password=the_trust_store_secret\n+quarkus.http.ssl.client-auth=required                                      <3>\n+\n+quarkus.http.auth.permission.default.paths=/*                              <4>\n+quarkus.http.auth.permission.default.policy=authenticated\n+----\n+<1> Configures a key store where the server's private key is located.\n+\n+<2> Configures a trust store from where the trusted certificates are going to be loaded from.\n+\n+<3> Defines that the server should *always* ask certificates from clients. You can relax this behavior by using `REQUEST` so\n+that the server should still accept requests without a certificate. Useful when you are also supporting authentication methods other than\n+mTLS.\n+\n+<4> Defines a policy where only authenticated users should have access to resources from your application.\n+\n+Once the incoming request matches a valid certificate in the truststore, your application should be able to obtain the subject by\n+just injecting a `SecurityIdentity` as follows:\n+\n+[#x509-subject-example]\n+.Obtaining the subject\n+[source,java]\n+----\n+@Inject\n+SecurityIdentity identity;\n+\n+@GET\n+@Produces(MediaType.TEXT_PLAIN)\n+public String hello() {\n+    return String.format(\"Hello, %s\", identity.getPrincipal().getName());\n+}\n+----\n+\n+You should also be able to get the certificate as follows:\n+\n+[#x509-credential-example]\n+.Obtaining the certificate\n+[source,java]\n+----\n+CertificateCredential credential = identity.getCredential(CertificateCredential.class);\n+X509Certificate certificate = credential.getCertificate();\n+----\n+\n+[[proactive-authentication]]\n+== Proactive Authentication\n+\n+By default Quarkus does what we call proactive authentication. This means that if an incoming request has a\n+credential then that request will always be authenticated (even if the target page does not require authentication).\n+\n+This means that requests with an invalid credential will always be rejected, even for public pages. You can change\n+this behaviour and only authenticate when required by setting `quarkus.http.auth.proactive=false`.\n+\n+[#standard-security-annotations]\n+== Authorization in REST endpoints and CDI beans using annotations\n+\n+Quarkus comes with built-in security to allow for Role-Based Access Control (link:https://en.wikipedia.org/wiki/Role-based_access_control[RBAC])\n+based on the common security annotations `@RolesAllowed`, `@DenyAll`, `@PermitAll` on REST endpoints and CDI beans.\n+An example of an endpoint that makes use of both JAX-RS and Common Security annotations to describe and secure its endpoints is given in <<subject-example>>. Quarkus also provides\n+the `io.quarkus.security.Authenticated` annotation that will permit any authenticated user to access the resource\n+(equivalent to `@RolesAllowed(\"**\")`).\n+\n+[#subject-example]\n+.SubjectExposingResource Example\n+[source,java]\n+----\n+import java.security.Principal;\n+\n+import javax.annotation.security.DenyAll;\n+import javax.annotation.security.PermitAll;\n+import javax.annotation.security.RolesAllowed;\n+import javax.ws.rs.GET;\n+import javax.ws.rs.Path;\n+import javax.ws.rs.core.Context;\n+import javax.ws.rs.core.SecurityContext;\n+\n+@Path(\"subject\")\n+public class SubjectExposingResource {\n+\n+    @GET\n+    @Path(\"secured\")\n+    @RolesAllowed(\"Tester\") <1>\n+    public String getSubjectSecured(@Context SecurityContext sec) {\n+        Principal user = sec.getUserPrincipal(); <2>\n+        String name = user != null ? user.getName() : \"anonymous\";\n+        return name;\n+    }\n+\n+    @GET\n+    @Path(\"unsecured\")\n+    @PermitAll<3>\n+    public String getSubjectUnsecured(@Context SecurityContext sec) {\n+        Principal user = sec.getUserPrincipal(); <4>\n+        String name = user != null ? user.getName() : \"anonymous\";\n+        return name;\n+    }\n+\n+    @GET\n+    @Path(\"denied\")\n+    @DenyAll<5>\n+    public String getSubjectDenied(@Context SecurityContext sec) {\n+        Principal user = sec.getUserPrincipal();\n+        String name = user != null ? user.getName() : \"anonymous\";\n+        return name;\n+    }\n+}\n+----\n+<1> This `/subject/secured` endpoint requires an authenticated user that has been granted the role \"Tester\" through the use of the `@RolesAllowed(\"Tester\")` annotation.\n+<2> The endpoint obtains the user principal from the JAX-RS SecurityContext. This will be non-null for a secured endpoint.\n+<3> The `/subject/unsecured` endpoint allows for unauthenticated access by specifying the `@PermitAll` annotation.\n+<4> This call to obtain the user principal will return null if the caller is unauthenticated, non-null if the caller is authenticated.\n+<5> The `/subject/denied` endpoint disallows any access regardless of whether the call is authenticated by specifying the `@DenyAll` annotation.\n+", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "7aeb2661b70598941a6a4c85d71edb868b07b7d3"}, "originalPosition": 165}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MDAxMTgxNQ==", "bodyText": "Why must it be an ApplicationScoped ? Isn't a Singleton working ?\nFor customization via CDI bean we usually just say something like by providing a CDI bean that implements ... then in the example uses Singleton if possible (no proxy generation) or ApplicationScoped.", "url": "https://github.com/quarkusio/quarkus/pull/10937#discussion_r460011815", "createdAt": "2020-07-24T12:05:32Z", "author": {"login": "loicmathieu"}, "path": "docs/src/main/asciidoc/security-customization.adoc", "diffHunk": "@@ -0,0 +1,152 @@\n+////\n+This guide is maintained in the main Quarkus repository\n+and pull requests should be submitted there:\n+https://github.com/quarkusio/quarkus/tree/master/docs/src/main/asciidoc\n+////\n+= Quarkus - Security Tips and Tricks\n+\n+include::./attributes.adoc[]\n+\n+== HttpAuthenticationMechanism Customization\n+\n+One can customize `HttpAuthenticationMechanism` by registering an `ApplicationScoped` implementation bean.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "7aeb2661b70598941a6a4c85d71edb868b07b7d3"}, "originalPosition": 12}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MDAxMjI4Nw==", "bodyText": "Maybe add an example as I didn't really understand the purpose of this", "url": "https://github.com/quarkusio/quarkus/pull/10937#discussion_r460012287", "createdAt": "2020-07-24T12:06:46Z", "author": {"login": "loicmathieu"}, "path": "docs/src/main/asciidoc/security-customization.adoc", "diffHunk": "@@ -0,0 +1,152 @@\n+////\n+This guide is maintained in the main Quarkus repository\n+and pull requests should be submitted there:\n+https://github.com/quarkusio/quarkus/tree/master/docs/src/main/asciidoc\n+////\n+= Quarkus - Security Tips and Tricks\n+\n+include::./attributes.adoc[]\n+\n+== HttpAuthenticationMechanism Customization\n+\n+One can customize `HttpAuthenticationMechanism` by registering an `ApplicationScoped` implementation bean.\n+In the example below the custom authenticator delegates to `JWTAuthMechanism` provided by `quarkus-smallrye-jwt`: \n+\n+[source,java]\n+----\n+@Alternative\n+@Priority(1)\n+@ApplicationScoped\n+public class CustomAwareJWTAuthMechanism implements HttpAuthenticationMechanism {\n+\n+\tprivate static final Logger LOG = LoggerFactory.getLogger(CustomAwareJWTAuthMechanism.class);\n+\n+\t@Inject\n+\tJWTAuthMechanism delegate;\n+\n+\t@Override\n+\tpublic Uni<SecurityIdentity> authenticate(RoutingContext context, IdentityProviderManager identityProviderManager) {\n+\t    // do some custom action and delegate\t\n+            return delegate.authenticate(context, identityProviderManager);\n+\t}\n+\n+\t@Override\n+\tpublic Uni<ChallengeData> getChallenge(RoutingContext context) {\n+\t\treturn delegate.getChallenge(context);\n+\t}\n+\n+\t@Override\n+\tpublic Set<Class<? extends AuthenticationRequest>> getCredentialTypes() {\n+\t\treturn delegate.getCredentialTypes();\n+\t}\n+\n+\t@Override\n+\tpublic HttpCredentialTransport getCredentialTransport() {\n+\t\treturn delegate.getCredentialTransport();\n+\t}\n+\n+}\n+----\n+\n+== Security Identity Customization\n+\n+Internally, the identity providers create and update an istance of the `io.quarkus.security.identity.SecurityIdentity` class which holds the principal, roles, credentials which were used to authenticate the client (user) and other security attributes. An easy option to customize `SecurityIdentity` is to register a custom `SecurityIdentityAugmentor`, for example, the augmentor below adds an addition role:\n+\n+[source,java]\n+----\n+import io.quarkus.security.identity.AuthenticationRequestContext;\n+import io.quarkus.security.identity.SecurityIdentity;\n+import io.quarkus.security.identity.SecurityIdentityAugmentor;\n+import io.quarkus.security.runtime.QuarkusSecurityIdentity;\n+import io.smallrye.mutiny.Uni;\n+\n+import javax.enterprise.context.ApplicationScoped;\n+import java.util.function.Supplier;\n+\n+@ApplicationScoped\n+public class RolesAugmentor implements SecurityIdentityAugmentor {\n+\n+    @Override\n+    public int priority() {\n+        return 0;\n+    }\n+\n+    @Override\n+    public Uni<SecurityIdentity> augment(SecurityIdentity identity, AuthenticationRequestContext context) {\n+        return context.runBlocking(build(identity));\n+    }\n+\n+    private Supplier<SecurityIdentity> build(SecurityIdentity identity) {\n+        if(identity.isAnonymous()) {\n+            return () -> identity;\n+        } else {\n+            // create a new builder and copy principal, attributes, credentials and roles from the original\n+            QuarkusSecurityIdentity.Builder builder = QuarkusSecurityIdentity.builder()\n+                    .setPrincipal(identity.getPrincipal())\n+                    .addAttributes(identity.getAttributes())\n+                    .addCredentials(identity.getCredentials())\n+                    .addRoles(identity.getRoles());\n+\n+            // add custom role source here\n+            builder.addRole(\"dummy\");\n+            return builder::build;\n+        }\n+    }\n+}\n+----\n+\n+== Custom JAX-RS SecurityContext\n+\n+If you use JAX-RS `ContainerRequestFilter` to set a custom JAX-RS `SecurityContext` then make sure `ContainerRequestFilter` runs in the JAX-RS pre-match phase by adding a `@PreMatching` annotation to it for this custom context be linked with Quarkus `SecurityIdentity`.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "7aeb2661b70598941a6a4c85d71edb868b07b7d3"}, "originalPosition": 100}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MDAxMzg3Mg==", "bodyText": "I think more explaintation is needed.\nThe idea here is to use quarkus-properties-files for test and another one for prod right ?\nMaybe provide an application.properties example with two security extension and the right config to enable one for test and the other for prod.", "url": "https://github.com/quarkusio/quarkus/pull/10937#discussion_r460013872", "createdAt": "2020-07-24T12:10:36Z", "author": {"login": "loicmathieu"}, "path": "docs/src/main/asciidoc/security-testing.adoc", "diffHunk": "@@ -0,0 +1,79 @@\n+////\n+This guide is maintained in the main Quarkus repository\n+and pull requests should be submitted there:\n+https://github.com/quarkusio/quarkus/tree/master/docs/src/main/asciidoc\n+////\n+= Quarkus - Security Testing\n+\n+include::./attributes.adoc[]\n+\n+This document describes how to test Quarkus Security.\n+\n+== Configuring User Information\n+\n+You can use link:security-properties[quarkus-elytron-security-properties-file] for testing security. This supports both embedding user info in `application.properties` and standalone properties files.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "7aeb2661b70598941a6a4c85d71edb868b07b7d3"}, "originalPosition": 14}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "7aeb2661b70598941a6a4c85d71edb868b07b7d3", "author": {"user": {"login": "sberyozkin", "name": null}}, "url": "https://github.com/quarkusio/quarkus/commit/7aeb2661b70598941a6a4c85d71edb868b07b7d3", "committedDate": "2020-07-24T09:53:24Z", "message": "Make security.adoc the main Quarkus Security document"}, "afterCommit": {"oid": "5f153f2accf2010f423ac3b8d49943118324fbac", "author": {"user": {"login": "sberyozkin", "name": null}}, "url": "https://github.com/quarkusio/quarkus/commit/5f153f2accf2010f423ac3b8d49943118324fbac", "committedDate": "2020-07-24T15:56:05Z", "message": "Make security.adoc the main Quarkus Security document"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "5f153f2accf2010f423ac3b8d49943118324fbac", "author": {"user": {"login": "sberyozkin", "name": null}}, "url": "https://github.com/quarkusio/quarkus/commit/5f153f2accf2010f423ac3b8d49943118324fbac", "committedDate": "2020-07-24T15:56:05Z", "message": "Make security.adoc the main Quarkus Security document"}, "afterCommit": {"oid": "a01331c69b2df7342052bc670975bb17f340fb51", "author": {"user": {"login": "sberyozkin", "name": null}}, "url": "https://github.com/quarkusio/quarkus/commit/a01331c69b2df7342052bc670975bb17f340fb51", "committedDate": "2020-07-24T16:03:49Z", "message": "Make security.adoc the main Quarkus Security document"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDU1MDEwMDYx", "url": "https://github.com/quarkusio/quarkus/pull/10937#pullrequestreview-455010061", "createdAt": "2020-07-24T16:07:20Z", "commit": {"oid": "a01331c69b2df7342052bc670975bb17f340fb51"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "a01331c69b2df7342052bc670975bb17f340fb51", "author": {"user": {"login": "sberyozkin", "name": null}}, "url": "https://github.com/quarkusio/quarkus/commit/a01331c69b2df7342052bc670975bb17f340fb51", "committedDate": "2020-07-24T16:03:49Z", "message": "Make security.adoc the main Quarkus Security document"}, "afterCommit": {"oid": "8cb2cba6f574d5a1313072acc322320e7f5e7916", "author": {"user": {"login": "sberyozkin", "name": null}}, "url": "https://github.com/quarkusio/quarkus/commit/8cb2cba6f574d5a1313072acc322320e7f5e7916", "committedDate": "2020-07-24T16:08:40Z", "message": "Make security.adoc the main Quarkus Security document"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDU1MDM0MjY0", "url": "https://github.com/quarkusio/quarkus/pull/10937#pullrequestreview-455034264", "createdAt": "2020-07-24T16:43:36Z", "commit": {"oid": "8cb2cba6f574d5a1313072acc322320e7f5e7916"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "8cb2cba6f574d5a1313072acc322320e7f5e7916", "author": {"user": {"login": "sberyozkin", "name": null}}, "url": "https://github.com/quarkusio/quarkus/commit/8cb2cba6f574d5a1313072acc322320e7f5e7916", "committedDate": "2020-07-24T16:08:40Z", "message": "Make security.adoc the main Quarkus Security document"}, "afterCommit": {"oid": "87378a282cf2541ba4bb85b5632e306ae6df4083", "author": {"user": {"login": "sberyozkin", "name": null}}, "url": "https://github.com/quarkusio/quarkus/commit/87378a282cf2541ba4bb85b5632e306ae6df4083", "committedDate": "2020-07-24T21:37:17Z", "message": "Make security.adoc the main Quarkus Security document"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "0ea6d67c6f314936dc35f3686efd34f4d01fe7c0", "author": {"user": {"login": "sberyozkin", "name": null}}, "url": "https://github.com/quarkusio/quarkus/commit/0ea6d67c6f314936dc35f3686efd34f4d01fe7c0", "committedDate": "2020-07-28T13:14:16Z", "message": "Make security.adoc the main Quarkus Security document"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "87378a282cf2541ba4bb85b5632e306ae6df4083", "author": {"user": {"login": "sberyozkin", "name": null}}, "url": "https://github.com/quarkusio/quarkus/commit/87378a282cf2541ba4bb85b5632e306ae6df4083", "committedDate": "2020-07-24T21:37:17Z", "message": "Make security.adoc the main Quarkus Security document"}, "afterCommit": {"oid": "0ea6d67c6f314936dc35f3686efd34f4d01fe7c0", "author": {"user": {"login": "sberyozkin", "name": null}}, "url": "https://github.com/quarkusio/quarkus/commit/0ea6d67c6f314936dc35f3686efd34f4d01fe7c0", "committedDate": "2020-07-28T13:14:16Z", "message": "Make security.adoc the main Quarkus Security document"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDU2NjE3ODc2", "url": "https://github.com/quarkusio/quarkus/pull/10937#pullrequestreview-456617876", "createdAt": "2020-07-28T13:15:11Z", "commit": {"oid": "0ea6d67c6f314936dc35f3686efd34f4d01fe7c0"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1119, "cost": 1, "resetAt": "2021-11-01T16:37:27Z"}}}