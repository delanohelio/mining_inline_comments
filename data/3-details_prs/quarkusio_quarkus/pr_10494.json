{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDQ0NzE0MjM1", "number": 10494, "title": "Created uber-jar test for multi-module projects", "bodyText": "", "createdAt": "2020-07-06T11:28:53Z", "url": "https://github.com/quarkusio/quarkus/pull/10494", "merged": true, "mergeCommit": {"oid": "b7f686b9c3dc83c5e73f57f52874a3f0c8b1d9ca"}, "closed": true, "closedAt": "2020-07-07T06:16:11Z", "author": {"login": "Garima829"}, "timelineItems": {"totalCount": 9, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcyPkfqAFqTQ0Mjk5NDE3Mg==", "endCursor": "Y3Vyc29yOnYyOpPPAAABcyUpkWAFqTQ0MzI3MzI2Mw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDQyOTk0MTcy", "url": "https://github.com/quarkusio/quarkus/pull/10494#pullrequestreview-442994172", "createdAt": "2020-07-06T11:30:44Z", "commit": {"oid": "2bde50d3904bef689bae608fd4958bb2fb14fa56"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wNlQxMTozMDo0NFrOGtTg1g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wNlQxMTozMDo0NFrOGtTg1g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MDE1ODgwNg==", "bodyText": "You can remove this file as it's not needed", "url": "https://github.com/quarkusio/quarkus/pull/10494#discussion_r450158806", "createdAt": "2020-07-06T11:30:44Z", "author": {"login": "geoand"}, "path": "integration-tests/gradle/src/test/resources/uber-jar-for-multi-module-project/application/src/main/resources/META-INF/resources/index.html", "diffHunk": "@@ -0,0 +1,155 @@\n+<!DOCTYPE html>", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "2bde50d3904bef689bae608fd4958bb2fb14fa56"}, "originalPosition": 1}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDQyOTk2MTU0", "url": "https://github.com/quarkusio/quarkus/pull/10494#pullrequestreview-442996154", "createdAt": "2020-07-06T11:34:16Z", "commit": {"oid": "2bde50d3904bef689bae608fd4958bb2fb14fa56"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wNlQxMTozNDoxNlrOGtTm3w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wNlQxMTozNDoxNlrOGtTm3w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MDE2MDM1MQ==", "bodyText": "If this is the actual response, then something is wrong...\n    @GET\n    @Produces(MediaType.TEXT_PLAIN)\n    public String hello() {\n        return \"hello \" + common.getName();\n    }\n\nso the response should be hello common", "url": "https://github.com/quarkusio/quarkus/pull/10494#discussion_r450160351", "createdAt": "2020-07-06T11:34:16Z", "author": {"login": "geoand"}, "path": "integration-tests/gradle/src/test/java/io/quarkus/gradle/MultiModuleUberJarTest.java", "diffHunk": "@@ -0,0 +1,65 @@\n+package io.quarkus.gradle;\n+\n+import org.junit.jupiter.api.Test;\n+import org.apache.commons.io.FileUtils;\n+import static org.awaitility.Awaitility.await;\n+import static io.quarkus.gradle.LaunchUtils.launch;\n+\n+import java.io.File;\n+import java.nio.file.Path;\n+import java.util.concurrent.Future;\n+import java.util.concurrent.TimeUnit;\n+\n+import io.quarkus.test.devmode.util.DevModeTestUtils;\n+import org.awaitility.core.ConditionTimeoutException;\n+import static org.assertj.core.api.Assertions.assertThat;\n+import static io.quarkus.gradle.LaunchUtils.dumpFileContentOnFailure;\n+\n+public class MultiModuleUberJarTest extends QuarkusGradleWrapperTestBase {\n+    private static Future<?> jarRun;\n+\n+    @Test\n+    public void testUberJarForMultiModule() throws Exception {\n+\n+        final File projectDir = getProjectDir(\"uber-jar-for-multi-module-project\");\n+        runGradleWrapper(projectDir, \":application:quarkusBuild\");\n+\n+        final Path applicationJar = projectDir.toPath().resolve(\"application\").resolve(\"build\");\n+        assertThat(applicationJar).exists();\n+        Path jar =applicationJar.resolve(\"application-unspecified-runner.jar\");\n+        assertThat(jar).exists();\n+\n+        File output = new File(projectDir, \"application/build/output.log\");\n+        output.createNewFile();\n+        Process process = launch(jar, output);\n+        try {\n+            // Wait until server up\n+            dumpFileContentOnFailure(() -> {\n+                await()\n+                        .pollDelay(1, TimeUnit.SECONDS)\n+                        .atMost(1, TimeUnit.MINUTES).until(() -> DevModeTestUtils.getHttpResponse(\"/hello\", 200));\n+                return null;\n+            }, output, ConditionTimeoutException.class);\n+\n+            String logs = FileUtils.readFileToString(output, \"UTF-8\");\n+\n+            assertThatOutputWorksCorrectly(logs);\n+\n+            // test that the http response is correct \n+            assertThat(DevModeTestUtils.getHttpResponse(\"/hello\", () -> {\n+                return jarRun == null ? null : jarRun.isDone() ? \"jar run mode has terminated\" : null;\n+            }).equals(\"hello\"));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "2bde50d3904bef689bae608fd4958bb2fb14fa56"}, "originalPosition": 51}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "2bde50d3904bef689bae608fd4958bb2fb14fa56", "author": {"user": null}, "url": "https://github.com/quarkusio/quarkus/commit/2bde50d3904bef689bae608fd4958bb2fb14fa56", "committedDate": "2020-07-06T11:21:25Z", "message": "Created uber-jar test for multi-module projects"}, "afterCommit": {"oid": "954e63b2d39cb275162268471208cb91cde77215", "author": {"user": null}, "url": "https://github.com/quarkusio/quarkus/commit/954e63b2d39cb275162268471208cb91cde77215", "committedDate": "2020-07-06T11:44:04Z", "message": "Created uber-jar test for multi-module projects"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "954e63b2d39cb275162268471208cb91cde77215", "author": {"user": null}, "url": "https://github.com/quarkusio/quarkus/commit/954e63b2d39cb275162268471208cb91cde77215", "committedDate": "2020-07-06T11:44:04Z", "message": "Created uber-jar test for multi-module projects"}, "afterCommit": {"oid": "ab08cc722f113932942d5a0eebccc7d101e78787", "author": {"user": null}, "url": "https://github.com/quarkusio/quarkus/commit/ab08cc722f113932942d5a0eebccc7d101e78787", "committedDate": "2020-07-06T12:17:50Z", "message": "Created uber-jar test for multi-module projects"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDQzMjI4MjQz", "url": "https://github.com/quarkusio/quarkus/pull/10494#pullrequestreview-443228243", "createdAt": "2020-07-06T16:25:55Z", "commit": {"oid": "ab08cc722f113932942d5a0eebccc7d101e78787"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wNlQxNjoyNTo1NVrOGtefmQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wNlQxNjoyNTo1NVrOGtefmQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MDMzODcxMw==", "bodyText": "This seems like it's not used", "url": "https://github.com/quarkusio/quarkus/pull/10494#discussion_r450338713", "createdAt": "2020-07-06T16:25:55Z", "author": {"login": "geoand"}, "path": "integration-tests/gradle/src/test/java/io/quarkus/gradle/MultiModuleUberJarTest.java", "diffHunk": "@@ -0,0 +1,64 @@\n+package io.quarkus.gradle;\n+\n+import static io.quarkus.gradle.LaunchUtils.dumpFileContentOnFailure;\n+import static io.quarkus.gradle.LaunchUtils.launch;\n+import static org.assertj.core.api.Assertions.assertThat;\n+import static org.awaitility.Awaitility.await;\n+\n+import java.io.File;\n+import java.nio.file.Path;\n+import java.util.concurrent.Future;\n+import java.util.concurrent.TimeUnit;\n+\n+import org.apache.commons.io.FileUtils;\n+import org.awaitility.core.ConditionTimeoutException;\n+import org.junit.jupiter.api.Test;\n+\n+import io.quarkus.test.devmode.util.DevModeTestUtils;\n+\n+public class MultiModuleUberJarTest extends QuarkusGradleWrapperTestBase {\n+    private static Future<?> jarRun;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ab08cc722f113932942d5a0eebccc7d101e78787"}, "originalPosition": 20}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDQzMjM4NDMw", "url": "https://github.com/quarkusio/quarkus/pull/10494#pullrequestreview-443238430", "createdAt": "2020-07-06T16:38:30Z", "commit": {"oid": "ab08cc722f113932942d5a0eebccc7d101e78787"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wNlQxNjozODozMFrOGte9XQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wNlQxNjozODozMFrOGte9XQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MDM0NjMzMw==", "bodyText": "No need to have a variable for this", "url": "https://github.com/quarkusio/quarkus/pull/10494#discussion_r450346333", "createdAt": "2020-07-06T16:38:30Z", "author": {"login": "geoand"}, "path": "integration-tests/gradle/src/test/java/io/quarkus/gradle/MultiModuleUberJarTest.java", "diffHunk": "@@ -0,0 +1,64 @@\n+package io.quarkus.gradle;\n+\n+import static io.quarkus.gradle.LaunchUtils.dumpFileContentOnFailure;\n+import static io.quarkus.gradle.LaunchUtils.launch;\n+import static org.assertj.core.api.Assertions.assertThat;\n+import static org.awaitility.Awaitility.await;\n+\n+import java.io.File;\n+import java.nio.file.Path;\n+import java.util.concurrent.Future;\n+import java.util.concurrent.TimeUnit;\n+\n+import org.apache.commons.io.FileUtils;\n+import org.awaitility.core.ConditionTimeoutException;\n+import org.junit.jupiter.api.Test;\n+\n+import io.quarkus.test.devmode.util.DevModeTestUtils;\n+\n+public class MultiModuleUberJarTest extends QuarkusGradleWrapperTestBase {\n+    private static Future<?> jarRun;\n+\n+    @Test\n+    public void testUberJarForMultiModule() throws Exception {\n+\n+        final File projectDir = getProjectDir(\"uber-jar-for-multi-module-project\");\n+        runGradleWrapper(projectDir, \":application:quarkusBuild\");\n+\n+        final Path applicationJar = projectDir.toPath().resolve(\"application\").resolve(\"build\");\n+        assertThat(applicationJar).exists();\n+        Path jar = applicationJar.resolve(\"application-unspecified-runner.jar\");\n+        assertThat(jar).exists();\n+\n+        File output = new File(projectDir, \"application/build/output.log\");\n+        output.createNewFile();\n+        Process process = launch(jar, output);\n+        try {\n+            // Wait until server up\n+            dumpFileContentOnFailure(() -> {\n+                await()\n+                        .pollDelay(1, TimeUnit.SECONDS)\n+                        .atMost(1, TimeUnit.MINUTES).until(() -> DevModeTestUtils.getHttpResponse(\"/hello\", 200));\n+                return null;\n+            }, output, ConditionTimeoutException.class);\n+\n+            String logs = FileUtils.readFileToString(output, \"UTF-8\");\n+\n+            assertThatOutputWorksCorrectly(logs);\n+\n+            // test that the http response is correct\n+            assertThat(DevModeTestUtils.getHttpResponse(\"/hello\", () -> {\n+                return jarRun == null ? null : jarRun.isDone() ? \"jar run mode has terminated\" : null;\n+            }).equals(\"hello common\"));\n+        } finally {\n+            process.destroy();\n+        }\n+    }\n+\n+    private void assertThatOutputWorksCorrectly(String logs) {\n+        assertThat(logs.isEmpty()).isFalse();\n+        String infoLogLevel = \"INFO\";", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ab08cc722f113932942d5a0eebccc7d101e78787"}, "originalPosition": 60}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "79f7104cec300a0d74ee0084e1f1864c87a13b88", "author": {"user": null}, "url": "https://github.com/quarkusio/quarkus/commit/79f7104cec300a0d74ee0084e1f1864c87a13b88", "committedDate": "2020-07-06T17:18:34Z", "message": "Created uber-jar test for multi-module projects"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "8aba47aa8cbd6094fffca9b51462fb3de7678d8b", "author": {"user": {"login": "Garima829", "name": "Garima Monga"}}, "url": "https://github.com/quarkusio/quarkus/commit/8aba47aa8cbd6094fffca9b51462fb3de7678d8b", "committedDate": "2020-07-06T17:07:47Z", "message": "Removed the variable"}, "afterCommit": {"oid": "79f7104cec300a0d74ee0084e1f1864c87a13b88", "author": {"user": null}, "url": "https://github.com/quarkusio/quarkus/commit/79f7104cec300a0d74ee0084e1f1864c87a13b88", "committedDate": "2020-07-06T17:18:34Z", "message": "Created uber-jar test for multi-module projects"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDQzMjczMjYz", "url": "https://github.com/quarkusio/quarkus/pull/10494#pullrequestreview-443273263", "createdAt": "2020-07-06T17:25:48Z", "commit": {"oid": "79f7104cec300a0d74ee0084e1f1864c87a13b88"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3643, "cost": 1, "resetAt": "2021-11-01T16:37:27Z"}}}