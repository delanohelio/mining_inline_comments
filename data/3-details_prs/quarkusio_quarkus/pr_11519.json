{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDcxNTc0NDY0", "number": 11519, "title": "Multiple persistence units follow up", "bodyText": "@Sanne these are some small changes we talked about.\nThe Hibernate Validator is related to yesterday's PR: this way we won't miss bootstrap error anymore. Didn't include it in yesterday's PR because it would have conflicted with the Multi persistence units one.", "createdAt": "2020-08-21T11:19:47Z", "url": "https://github.com/quarkusio/quarkus/pull/11519", "merged": true, "mergeCommit": {"oid": "dcf945f6a05e600323d09e10720fe93259beb5fe"}, "closed": true, "closedAt": "2020-08-26T17:36:46Z", "author": {"login": "gsmet"}, "timelineItems": {"totalCount": 14, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdBDmWnAFqTQ3MjQzMTY4NA==", "endCursor": "Y3Vyc29yOnYyOpPPAAABdCvAWKAFqTQ3NTY5MzI0Mg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDcyNDMxNjg0", "url": "https://github.com/quarkusio/quarkus/pull/11519#pullrequestreview-472431684", "createdAt": "2020-08-21T12:02:45Z", "commit": {"oid": "cad4973606c695cf8ef26d2d009fdef5b9bdd11d"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yMVQxMjowMjo0NVrOHEqjCQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yMVQxMjowMjo0NVrOHEqjCQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NDY1MzQ0OQ==", "bodyText": "\ud83d\udc4d", "url": "https://github.com/quarkusio/quarkus/pull/11519#discussion_r474653449", "createdAt": "2020-08-21T12:02:45Z", "author": {"login": "Sanne"}, "path": "extensions/hibernate-orm/deployment/src/main/java/io/quarkus/hibernate/orm/deployment/HibernateOrmProcessor.java", "diffHunk": "@@ -136,7 +136,9 @@ CapabilityBuildItem capability() {\n \n     @BuildStep\n     void checkTransactionsSupport(Capabilities capabilities) {\n-        if (capabilities.isMissing(Capability.TRANSACTIONS)) {\n+        // JTA is necessary for blocking Hibernate ORM but not necessarily for Hibernate Reactive\n+        if (capabilities.isMissing(Capability.TRANSACTIONS)\n+                && capabilities.isMissing(Capability.HIBERNATE_REACTIVE)) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "cad4973606c695cf8ef26d2d009fdef5b9bdd11d"}, "originalPosition": 7}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDcyNDM1NDA5", "url": "https://github.com/quarkusio/quarkus/pull/11519#pullrequestreview-472435409", "createdAt": "2020-08-21T12:09:27Z", "commit": {"oid": "d9d715d51c74fd417545f408bbe0c2525a957d5a"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yMVQxMjowOToyN1rOHEquuQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yMVQxMjowOToyN1rOHEquuQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NDY1NjQ0MQ==", "bodyText": "there's a corner case which might have a surprise effect to users:\n\nDB-1 using MySQL (or MariaDB) and sets a weird engine like BLACKHOLE\nDB-2 using MySQL (or MariaDB) and doesn't set anything\nall data written on DB-2 disappears as well without warning ?\n\nIMO we need to require full consistency among the MySQL/MariaDB configured PUs", "url": "https://github.com/quarkusio/quarkus/pull/11519#discussion_r474656441", "createdAt": "2020-08-21T12:09:27Z", "author": {"login": "Sanne"}, "path": "extensions/hibernate-orm/deployment/src/main/java/io/quarkus/hibernate/orm/deployment/HibernateOrmProcessor.java", "diffHunk": "@@ -575,7 +577,9 @@ private void handleHibernateORMWithNoPersistenceXml(\n                     jdbcDataSources, applicationArchivesBuildItem, launchMode,\n                     systemProperties, nativeImageResources, hotDeploymentWatchedFiles, persistenceUnitDescriptors);\n \n-            storageEngines.add(persistenceUnitEntry.getValue().dialect.storageEngine);\n+            if (persistenceUnitEntry.getValue().dialect.storageEngine.isPresent()) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d9d715d51c74fd417545f408bbe0c2525a957d5a"}, "originalPosition": 25}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDcyNDM2NDY2", "url": "https://github.com/quarkusio/quarkus/pull/11519#pullrequestreview-472436466", "createdAt": "2020-08-21T12:11:16Z", "commit": {"oid": "fd072bf739c7a52a1cf53ddca2cf7691de16928a"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yMVQxMjoxMToxNlrOHEqx1w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yMVQxMjoxMToxNlrOHEqx1w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NDY1NzIzOQ==", "bodyText": "\ud83d\udc4d", "url": "https://github.com/quarkusio/quarkus/pull/11519#discussion_r474657239", "createdAt": "2020-08-21T12:11:16Z", "author": {"login": "Sanne"}, "path": "extensions/hibernate-orm/deployment/src/main/java/io/quarkus/hibernate/orm/deployment/HibernateOrmProcessor.java", "diffHunk": "@@ -773,6 +777,12 @@ private static void producePersistenceUnitDescriptorFromConfig(\n             p.put(JPA_SHARED_CACHE_MODE, SharedCacheMode.NONE);\n         }\n \n+        // Hibernate Validator integration: we force the callback mode to have bootstrap errors reported rather than validation ignored\n+        // if there is any issue when bootstrapping Hibernate Validator.\n+        if (capabilities.isPresent(Capability.HIBERNATE_VALIDATOR)) {\n+            descriptor.getProperties().setProperty(AvailableSettings.JPA_VALIDATION_MODE, ValidationMode.CALLBACK.name());\n+        }", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "fd072bf739c7a52a1cf53ddca2cf7691de16928a"}, "originalPosition": 67}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDcyNDM2NjUx", "url": "https://github.com/quarkusio/quarkus/pull/11519#pullrequestreview-472436651", "createdAt": "2020-08-21T12:11:38Z", "commit": {"oid": "3e9a8a816c8f0b590b412e3373cab0c04a435f0e"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yMVQxMjoxMTozOVrOHEqyZA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yMVQxMjoxMTozOVrOHEqyZA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NDY1NzM4MA==", "bodyText": "\ud83d\udc4d", "url": "https://github.com/quarkusio/quarkus/pull/11519#discussion_r474657380", "createdAt": "2020-08-21T12:11:39Z", "author": {"login": "Sanne"}, "path": "extensions/hibernate-orm/deployment/src/test/java/io/quarkus/hibernate/orm/multiplepersistenceunits/MultiplePersistenceUnitsUndefinedPackagesTest.java", "diffHunk": "@@ -17,7 +17,8 @@\n             .setExpectedException(ConfigurationException.class)\n             .setArchiveProducer(() -> ShrinkWrap.create(JavaArchive.class)\n                     .addClass(User.class)\n-                    .addAsResource(\"application-multiple-persistence-units-invalid.properties\", \"application.properties\"));\n+                    .addAsResource(\"application-multiple-persistence-units-undefined-packages.properties\",\n+                            \"application.properties\"));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "3e9a8a816c8f0b590b412e3373cab0c04a435f0e"}, "originalPosition": 6}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDcyODI4NDMx", "url": "https://github.com/quarkusio/quarkus/pull/11519#pullrequestreview-472828431", "createdAt": "2020-08-21T21:27:30Z", "commit": {"oid": "3e9a8a816c8f0b590b412e3373cab0c04a435f0e"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "3e9a8a816c8f0b590b412e3373cab0c04a435f0e", "author": {"user": {"login": "gsmet", "name": "Guillaume Smet"}}, "url": "https://github.com/quarkusio/quarkus/commit/3e9a8a816c8f0b590b412e3373cab0c04a435f0e", "committedDate": "2020-08-21T11:10:18Z", "message": "Rename test configuration file to avoid confusion"}, "afterCommit": {"oid": "50ee306fab35a62f256572c5a28d2436a70ae2b6", "author": {"user": {"login": "gsmet", "name": "Guillaume Smet"}}, "url": "https://github.com/quarkusio/quarkus/commit/50ee306fab35a62f256572c5a28d2436a70ae2b6", "committedDate": "2020-08-26T09:40:23Z", "message": "Only throw a storage engine exception for MySQL and MariaDB"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d6faf7b3a4d51f90123b31de33d715b39a1f55cc", "author": {"user": {"login": "gsmet", "name": "Guillaume Smet"}}, "url": "https://github.com/quarkusio/quarkus/commit/d6faf7b3a4d51f90123b31de33d715b39a1f55cc", "committedDate": "2020-08-26T15:03:50Z", "message": "Only throw an error if no JTA if Hibernate Reactive is not around"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ddde44af225122442f56344e36ddc027365d641b", "author": {"user": {"login": "gsmet", "name": "Guillaume Smet"}}, "url": "https://github.com/quarkusio/quarkus/commit/ddde44af225122442f56344e36ddc027365d641b", "committedDate": "2020-08-26T15:03:50Z", "message": "Only throw an error if two different storage engines are defined\n\nThe storage engine is only used by MySQL/MariaDB so a setup with a MySQL\nPU using a storage engine and a PostgreSQL PU not using any is perfectly\nvalid."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "54b956535ace253485c08176d7fc5eeefbfc2364", "author": {"user": {"login": "gsmet", "name": "Guillaume Smet"}}, "url": "https://github.com/quarkusio/quarkus/commit/54b956535ace253485c08176d7fc5eeefbfc2364", "committedDate": "2020-08-26T15:03:50Z", "message": "Force callback mode in Hibernate ORM when Hibernate Validator is present\n\nWith auto, if we have an error when bootstrapping the Bean Validation\nintegration, the error will be swallowed and all validation will be\nignored. It's far better to report an error in this case."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "aeab9bd2a3579b47349a821b8cc8b352faf67770", "author": {"user": {"login": "gsmet", "name": "Guillaume Smet"}}, "url": "https://github.com/quarkusio/quarkus/commit/aeab9bd2a3579b47349a821b8cc8b352faf67770", "committedDate": "2020-08-26T15:03:50Z", "message": "Rename test configuration file to avoid confusion"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "140dfcf241ec5888d5c24bd0654b2114d960e7fd", "author": {"user": {"login": "gsmet", "name": "Guillaume Smet"}}, "url": "https://github.com/quarkusio/quarkus/commit/140dfcf241ec5888d5c24bd0654b2114d960e7fd", "committedDate": "2020-08-26T15:03:50Z", "message": "Only throw a storage engine exception for MySQL and MariaDB"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "50ee306fab35a62f256572c5a28d2436a70ae2b6", "author": {"user": {"login": "gsmet", "name": "Guillaume Smet"}}, "url": "https://github.com/quarkusio/quarkus/commit/50ee306fab35a62f256572c5a28d2436a70ae2b6", "committedDate": "2020-08-26T09:40:23Z", "message": "Only throw a storage engine exception for MySQL and MariaDB"}, "afterCommit": {"oid": "140dfcf241ec5888d5c24bd0654b2114d960e7fd", "author": {"user": {"login": "gsmet", "name": "Guillaume Smet"}}, "url": "https://github.com/quarkusio/quarkus/commit/140dfcf241ec5888d5c24bd0654b2114d960e7fd", "committedDate": "2020-08-26T15:03:50Z", "message": "Only throw a storage engine exception for MySQL and MariaDB"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDc1NjkzMDE2", "url": "https://github.com/quarkusio/quarkus/pull/11519#pullrequestreview-475693016", "createdAt": "2020-08-26T17:10:43Z", "commit": {"oid": "140dfcf241ec5888d5c24bd0654b2114d960e7fd"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yNlQxNzoxMDo0M1rOHHVsnw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yNlQxNzoxMDo0M1rOHHVsnw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NzQ1NzU2Nw==", "bodyText": "funny :)", "url": "https://github.com/quarkusio/quarkus/pull/11519#discussion_r477457567", "createdAt": "2020-08-26T17:10:43Z", "author": {"login": "Sanne"}, "path": "extensions/hibernate-orm/deployment/src/test/java/io/quarkus/hibernate/orm/multiplepersistenceunits/MultiplePersistenceUnitsInconsistentStorageEnginesTest.java", "diffHunk": "@@ -30,4 +31,10 @@ public void testInvalidConfiguration() {\n         // deployment exception should happen first\n         Assertions.fail();\n     }\n+\n+    /**\n+     * This is just to have the dialect matching MySQL and trigger the MySQL + storage engines check.\n+     */\n+    public static class H2DialectWithMySQLInTheName extends H2Dialect {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "140dfcf241ec5888d5c24bd0654b2114d960e7fd"}, "originalPosition": 15}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDc1NjkzMjQy", "url": "https://github.com/quarkusio/quarkus/pull/11519#pullrequestreview-475693242", "createdAt": "2020-08-26T17:11:00Z", "commit": {"oid": "140dfcf241ec5888d5c24bd0654b2114d960e7fd"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 865, "cost": 1, "resetAt": "2021-11-01T16:37:27Z"}}}