{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDczMTYxNjMx", "number": 11599, "title": "Switch from elasticearch-maven-plugin to docker-maven-plugin to start Elasticsearch for ITs", "bodyText": "Fixes #11597\ncc @Sanne @gsmet", "createdAt": "2020-08-25T12:14:41Z", "url": "https://github.com/quarkusio/quarkus/pull/11599", "merged": true, "mergeCommit": {"oid": "239a860252fccc3c38a05a07c300e7be0fc1bf4f"}, "closed": true, "closedAt": "2020-08-26T08:53:47Z", "author": {"login": "yrodiere"}, "timelineItems": {"totalCount": 10, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdCWbJlgFqTQ3NDQzMjkyNw==", "endCursor": "Y3Vyc29yOnYyOpPPAAABdCn30YgFqTQ3NTI4NTQ0MQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDc0NDMyOTI3", "url": "https://github.com/quarkusio/quarkus/pull/11599#pullrequestreview-474432927", "createdAt": "2020-08-25T12:32:39Z", "commit": {"oid": "ad9c1182681c0b32a42782c2de9b063aaff79353"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "ad9c1182681c0b32a42782c2de9b063aaff79353", "author": {"user": {"login": "yrodiere", "name": "Yoann Rodi\u00e8re"}}, "url": "https://github.com/quarkusio/quarkus/commit/ad9c1182681c0b32a42782c2de9b063aaff79353", "committedDate": "2020-08-25T11:54:40Z", "message": "Switch from elasticearch-maven-plugin to docker-maven-plugin to start Elasticsearch for ITs"}, "afterCommit": {"oid": "ba6244a20bf9c742a2a804bb09e5d92e7506b9f9", "author": {"user": {"login": "yrodiere", "name": "Yoann Rodi\u00e8re"}}, "url": "https://github.com/quarkusio/quarkus/commit/ba6244a20bf9c742a2a804bb09e5d92e7506b9f9", "committedDate": "2020-08-25T13:17:33Z", "message": "Start Elasticsearch in the GitHub actions build"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "ba6244a20bf9c742a2a804bb09e5d92e7506b9f9", "author": {"user": {"login": "yrodiere", "name": "Yoann Rodi\u00e8re"}}, "url": "https://github.com/quarkusio/quarkus/commit/ba6244a20bf9c742a2a804bb09e5d92e7506b9f9", "committedDate": "2020-08-25T13:17:33Z", "message": "Start Elasticsearch in the GitHub actions build"}, "afterCommit": {"oid": "9e6f7b1790b5a6b71fd821adb5414ec9a38eb155", "author": {"user": {"login": "yrodiere", "name": "Yoann Rodi\u00e8re"}}, "url": "https://github.com/quarkusio/quarkus/commit/9e6f7b1790b5a6b71fd821adb5414ec9a38eb155", "committedDate": "2020-08-25T13:20:01Z", "message": "Start Elasticsearch in the GitHub actions build"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "9e6f7b1790b5a6b71fd821adb5414ec9a38eb155", "author": {"user": {"login": "yrodiere", "name": "Yoann Rodi\u00e8re"}}, "url": "https://github.com/quarkusio/quarkus/commit/9e6f7b1790b5a6b71fd821adb5414ec9a38eb155", "committedDate": "2020-08-25T13:20:01Z", "message": "Start Elasticsearch in the GitHub actions build"}, "afterCommit": {"oid": "94028a62a555d0cdf9d90a0a16b5b5ba65db9597", "author": {"user": {"login": "yrodiere", "name": "Yoann Rodi\u00e8re"}}, "url": "https://github.com/quarkusio/quarkus/commit/94028a62a555d0cdf9d90a0a16b5b5ba65db9597", "committedDate": "2020-08-25T15:53:59Z", "message": "Start Elasticsearch in the GitHub actions build"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d5c89e6bd2c4f23b0cc8522e9fe9ab455a84cf63", "author": {"user": {"login": "yrodiere", "name": "Yoann Rodi\u00e8re"}}, "url": "https://github.com/quarkusio/quarkus/commit/d5c89e6bd2c4f23b0cc8522e9fe9ab455a84cf63", "committedDate": "2020-08-26T06:54:14Z", "message": "Switch from elasticearch-maven-plugin to docker-maven-plugin to start Elasticsearch for ITs"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "410cb2f519131aa63ea6ae61e420d45451e67ef1", "author": {"user": {"login": "yrodiere", "name": "Yoann Rodi\u00e8re"}}, "url": "https://github.com/quarkusio/quarkus/commit/410cb2f519131aa63ea6ae61e420d45451e67ef1", "committedDate": "2020-08-26T06:54:14Z", "message": "Make it possible to run Elasticsearch-related tests against an external ES instance"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "2089b5154dbcae14bcfdf414a702fc75aeeeec04", "author": {"user": {"login": "yrodiere", "name": "Yoann Rodi\u00e8re"}}, "url": "https://github.com/quarkusio/quarkus/commit/2089b5154dbcae14bcfdf414a702fc75aeeeec04", "committedDate": "2020-08-26T06:54:14Z", "message": "Start Elasticsearch in the GitHub actions build"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "94028a62a555d0cdf9d90a0a16b5b5ba65db9597", "author": {"user": {"login": "yrodiere", "name": "Yoann Rodi\u00e8re"}}, "url": "https://github.com/quarkusio/quarkus/commit/94028a62a555d0cdf9d90a0a16b5b5ba65db9597", "committedDate": "2020-08-25T15:53:59Z", "message": "Start Elasticsearch in the GitHub actions build"}, "afterCommit": {"oid": "2089b5154dbcae14bcfdf414a702fc75aeeeec04", "author": {"user": {"login": "yrodiere", "name": "Yoann Rodi\u00e8re"}}, "url": "https://github.com/quarkusio/quarkus/commit/2089b5154dbcae14bcfdf414a702fc75aeeeec04", "committedDate": "2020-08-26T06:54:14Z", "message": "Start Elasticsearch in the GitHub actions build"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDc1MjgzMzM3", "url": "https://github.com/quarkusio/quarkus/pull/11599#pullrequestreview-475283337", "createdAt": "2020-08-26T08:49:45Z", "commit": {"oid": "2089b5154dbcae14bcfdf414a702fc75aeeeec04"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yNlQwODo0OTo0NVrOHHCT_Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yNlQwODo0OTo0NVrOHHCT_Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NzEzOTk2NQ==", "bodyText": "Interesting, I just learned about this script.", "url": "https://github.com/quarkusio/quarkus/pull/11599#discussion_r477139965", "createdAt": "2020-08-26T08:49:45Z", "author": {"login": "Sanne"}, "path": "integration-tests/elasticsearch-rest-client/pom.xml", "diffHunk": "@@ -91,35 +97,94 @@\n               <skip>false</skip>\n             </configuration>\n           </plugin>\n+        </plugins>\n+      </build>\n+    </profile>\n+\n+    <profile>\n+      <id>docker-elasticsearch</id>\n+      <activation>\n+        <property>\n+          <name>docker</name>\n+        </property>\n+      </activation>\n+      <properties>\n+        <elasticsearch.hosts>localhost:9200</elasticsearch.hosts>\n+        <elasticsearch.protocol>http</elasticsearch.protocol>\n+      </properties>\n+      <build>\n+        <plugins>\n           <plugin>\n-            <groupId>com.github.alexcojocaru</groupId>\n-            <artifactId>elasticsearch-maven-plugin</artifactId>\n+            <groupId>io.fabric8</groupId>\n+            <artifactId>docker-maven-plugin</artifactId>\n             <configuration>\n-              <timeout>90</timeout>\n-              <pathConf>${project.build.directory}/test-classes/elasticsearch-maven-plugin/configuration/</pathConf>\n-              <autoCreateIndex>true</autoCreateIndex>\n+              <images>\n+                <image>\n+                  <name>${elasticsearch.image}</name>\n+                  <alias>elasticsearch</alias>\n+                  <run>\n+                    <env>\n+                      <discovery.type>single-node</discovery.type>\n+                    </env>\n+                    <ports>\n+                      <port>9200:9200</port>\n+                    </ports>\n+                    <log>\n+                      <prefix>Elasticsearch: </prefix>\n+                      <date>default</date>\n+                      <color>cyan</color>\n+                    </log>\n+                    <wait>\n+                      <http>\n+                        <url>http://localhost:9200</url>\n+                        <method>GET</method>\n+                        <status>200</status>\n+                      </http>\n+                      <time>20000</time>\n+                    </wait>\n+                  </run>\n+                </image>\n+              </images>\n+              <allContainers>true</allContainers>\n             </configuration>\n-            <!-- Different executions from 2.x: the \"start\" goal has been renamed in version 5  -->\n             <executions>\n               <execution>\n-                <id>start-elasticsearch</id>\n+                <id>docker-start</id>\n                 <phase>process-test-classes</phase>\n                 <goals>\n-                  <goal>runforked</goal>\n+                  <goal>stop</goal>\n+                  <goal>start</goal>\n                 </goals>\n               </execution>\n               <execution>\n-                <id>stop-elasticsearch</id>\n+                <id>docker-stop</id>\n                 <phase>post-integration-test</phase>\n                 <goals>\n                   <goal>stop</goal>\n                 </goals>\n               </execution>\n             </executions>\n           </plugin>\n+          <plugin>\n+            <groupId>org.codehaus.mojo</groupId>\n+            <artifactId>exec-maven-plugin</artifactId>\n+            <executions>\n+              <execution>\n+                <id>docker-prune</id>\n+                <phase>generate-resources</phase>\n+                <goals>\n+                  <goal>exec</goal>\n+                </goals>\n+                <configuration>\n+                  <executable>${basedir}/../../.github/docker-prune.sh</executable>", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "2089b5154dbcae14bcfdf414a702fc75aeeeec04"}, "originalPosition": 105}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDc1Mjg1NDQx", "url": "https://github.com/quarkusio/quarkus/pull/11599#pullrequestreview-475285441", "createdAt": "2020-08-26T08:52:21Z", "commit": {"oid": "2089b5154dbcae14bcfdf414a702fc75aeeeec04"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 715, "cost": 1, "resetAt": "2021-11-01T16:37:27Z"}}}