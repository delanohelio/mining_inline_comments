{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDA5MTY4OTE5", "number": 8864, "title": "Fixes devmode for multi module projects using 'revision' property as versions", "bodyText": "Fixes #8832\nFixes #8899", "createdAt": "2020-04-26T22:25:18Z", "url": "https://github.com/quarkusio/quarkus/pull/8864", "merged": true, "mergeCommit": {"oid": "83139213f487d68f63e91cd41aece956063218b0"}, "closed": true, "closedAt": "2020-05-05T05:40:26Z", "author": {"login": "aloubyansky"}, "timelineItems": {"totalCount": 9, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABccpZLLABqjMyODgzMjEyODA=", "endCursor": "Y3Vyc29yOnYyOpPPAAABceNZYdAFqTQwNTUwMzU1MA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "b98721d335f00edd2289b59055ad3ade86aec51a", "author": {"user": {"login": "aloubyansky", "name": "Alexey Loubyansky"}}, "url": "https://github.com/quarkusio/quarkus/commit/b98721d335f00edd2289b59055ad3ade86aec51a", "committedDate": "2020-04-26T22:24:14Z", "message": "Fixes devmode for multi module projects using 'revision' property as versions"}, "afterCommit": {"oid": "2b5a0b5911eb3d17bfd9d4c41c72df10f6e36c54", "author": {"user": {"login": "aloubyansky", "name": "Alexey Loubyansky"}}, "url": "https://github.com/quarkusio/quarkus/commit/2b5a0b5911eb3d17bfd9d4c41c72df10f6e36c54", "committedDate": "2020-04-30T09:09:26Z", "message": "Fixes devmode for multi module projects using 'revision' property as versions"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDA1MDI1MzMx", "url": "https://github.com/quarkusio/quarkus/pull/8864#pullrequestreview-405025331", "createdAt": "2020-05-04T14:12:06Z", "commit": {"oid": "2b5a0b5911eb3d17bfd9d4c41c72df10f6e36c54"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wNFQxNDoxMjo0MVrOGQCPuQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wNFQxNDoxMjo0MVrOGQCPuQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxOTQ2NzE5Mw==", "bodyText": "I find this very fragile. IIRC, it's not the first time we discuss about this. What happens if there is a properly escaped space in the property? That happens a lot with paths on Windows.\nCan't we get some Maven classes to parse the command line somehow? I thought we did that somewhere else last time we discussed this.", "url": "https://github.com/quarkusio/quarkus/pull/8864#discussion_r419467193", "createdAt": "2020-05-04T14:12:41Z", "author": {"login": "gsmet"}, "path": "devtools/maven/src/main/java/io/quarkus/maven/DevMojo.java", "diffHunk": "@@ -642,13 +643,47 @@ void prepare() throws Exception {\n             if (devModeContext.isEnablePreview()) {\n                 args.add(DevModeContext.ENABLE_PREVIEW_FLAG);\n             }\n+\n+            propagateUserProperties();\n+\n             args.add(\"-jar\");\n             args.add(tempFile.getAbsolutePath());\n             if (argsString != null) {\n                 args.addAll(Arrays.asList(CommandLineUtils.translateCommandline(argsString)));\n             }\n         }\n \n+        private void propagateUserProperties() {\n+            final String mavenCmdLine = BootstrapMavenOptions.getMavenCmdLine();\n+            if (mavenCmdLine == null || mavenCmdLine.isEmpty()) {\n+                return;\n+            }\n+            int i = mavenCmdLine.indexOf(\"-D\");\n+            if (i < 0) {\n+                return;\n+            }\n+            final StringBuilder buf = new StringBuilder();\n+            buf.append(\"-D\");\n+            i += 2;\n+            while (i < mavenCmdLine.length()) {\n+                final char ch = mavenCmdLine.charAt(i++);\n+                if (!Character.isWhitespace(ch)) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "2b5a0b5911eb3d17bfd9d4c41c72df10f6e36c54"}, "originalPosition": 36}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDA1MzY0NTQy", "url": "https://github.com/quarkusio/quarkus/pull/8864#pullrequestreview-405364542", "createdAt": "2020-05-04T21:34:08Z", "commit": {"oid": "2b5a0b5911eb3d17bfd9d4c41c72df10f6e36c54"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wNFQyMTozNDowOFrOGQTEKg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wNFQyMTozNDowOFrOGQTEKg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxOTc0Mjc2Mg==", "bodyText": "added by mistake or ?", "url": "https://github.com/quarkusio/quarkus/pull/8864#discussion_r419742762", "createdAt": "2020-05-04T21:34:08Z", "author": {"login": "maxandersen"}, "path": "integration-tests/maven/src/test/resources/projects/multimodule-revision-prop/html/src/main/resources/META-INF/resources/a.html", "diffHunk": "@@ -0,0 +1 @@\n+sadfasdfasdfas", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "2b5a0b5911eb3d17bfd9d4c41c72df10f6e36c54"}, "originalPosition": 1}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDA1MzY1ODk0", "url": "https://github.com/quarkusio/quarkus/pull/8864#pullrequestreview-405365894", "createdAt": "2020-05-04T21:36:31Z", "commit": {"oid": "2b5a0b5911eb3d17bfd9d4c41c72df10f6e36c54"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wNFQyMTozNjozMVrOGQTIYw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wNFQyMTozNjozMVrOGQTIYw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxOTc0Mzg0Mw==", "bodyText": "couldn't the property expression be in any part of the version string ?", "url": "https://github.com/quarkusio/quarkus/pull/8864#discussion_r419743843", "createdAt": "2020-05-04T21:36:31Z", "author": {"login": "maxandersen"}, "path": "independent-projects/bootstrap/core/src/main/java/io/quarkus/bootstrap/resolver/maven/workspace/ModelUtils.java", "diffHunk": "@@ -184,6 +210,39 @@ public static String getVersion(Model model) {\n         throw new IllegalStateException(\"Failed to determine version for project model\");\n     }\n \n+    public static String getVersion(Model model) {\n+        final String rawVersion = getRawVersion(model);\n+        return isUnresolvedVersion(rawVersion) ? resolveVersion(rawVersion, model) : rawVersion;\n+    }\n+\n+    public static boolean isUnresolvedVersion(String version) {\n+        return version.charAt(0) == '$';//UNRESOLVED_VERSION_PATTERN.matcher(version).find();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "2b5a0b5911eb3d17bfd9d4c41c72df10f6e36c54"}, "originalPosition": 64}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDA1MzgyMjcw", "url": "https://github.com/quarkusio/quarkus/pull/8864#pullrequestreview-405382270", "createdAt": "2020-05-04T22:07:21Z", "commit": {"oid": "2b5a0b5911eb3d17bfd9d4c41c72df10f6e36c54"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wNFQyMjowNzoyMVrOGQT--Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wNFQyMjowNzoyMVrOGQT--Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxOTc1NzgxNw==", "bodyText": "might be minor issue but this will only consider things explicitly set on the command line; it will not honor .mvn/maven.config", "url": "https://github.com/quarkusio/quarkus/pull/8864#discussion_r419757817", "createdAt": "2020-05-04T22:07:21Z", "author": {"login": "maxandersen"}, "path": "devtools/maven/src/main/java/io/quarkus/maven/DevMojo.java", "diffHunk": "@@ -642,13 +643,47 @@ void prepare() throws Exception {\n             if (devModeContext.isEnablePreview()) {\n                 args.add(DevModeContext.ENABLE_PREVIEW_FLAG);\n             }\n+\n+            propagateUserProperties();\n+\n             args.add(\"-jar\");\n             args.add(tempFile.getAbsolutePath());\n             if (argsString != null) {\n                 args.addAll(Arrays.asList(CommandLineUtils.translateCommandline(argsString)));\n             }\n         }\n \n+        private void propagateUserProperties() {\n+            final String mavenCmdLine = BootstrapMavenOptions.getMavenCmdLine();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "2b5a0b5911eb3d17bfd9d4c41c72df10f6e36c54"}, "originalPosition": 23}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "af17877fc73eebd058409aee1de98fd9a6bf6083", "author": {"user": {"login": "aloubyansky", "name": "Alexey Loubyansky"}}, "url": "https://github.com/quarkusio/quarkus/commit/af17877fc73eebd058409aee1de98fd9a6bf6083", "committedDate": "2020-05-04T22:24:42Z", "message": "Fixes devmode for multi module projects using 'revision' property as versions"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "2b5a0b5911eb3d17bfd9d4c41c72df10f6e36c54", "author": {"user": {"login": "aloubyansky", "name": "Alexey Loubyansky"}}, "url": "https://github.com/quarkusio/quarkus/commit/2b5a0b5911eb3d17bfd9d4c41c72df10f6e36c54", "committedDate": "2020-04-30T09:09:26Z", "message": "Fixes devmode for multi module projects using 'revision' property as versions"}, "afterCommit": {"oid": "af17877fc73eebd058409aee1de98fd9a6bf6083", "author": {"user": {"login": "aloubyansky", "name": "Alexey Loubyansky"}}, "url": "https://github.com/quarkusio/quarkus/commit/af17877fc73eebd058409aee1de98fd9a6bf6083", "committedDate": "2020-05-04T22:24:42Z", "message": "Fixes devmode for multi module projects using 'revision' property as versions"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDA1MzkxMjM1", "url": "https://github.com/quarkusio/quarkus/pull/8864#pullrequestreview-405391235", "createdAt": "2020-05-04T22:27:02Z", "commit": {"oid": "2b5a0b5911eb3d17bfd9d4c41c72df10f6e36c54"}, "state": "APPROVED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wNFQyMjoyNzoyNFrOGQUeqg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wNFQyMjoyNzoyNFrOGQUeqg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxOTc2NTkzMA==", "bodyText": "this would not handle case where there are nested properties would it ?", "url": "https://github.com/quarkusio/quarkus/pull/8864#discussion_r419765930", "createdAt": "2020-05-04T22:27:24Z", "author": {"login": "maxandersen"}, "path": "independent-projects/bootstrap/core/src/main/java/io/quarkus/bootstrap/resolver/maven/workspace/ModelUtils.java", "diffHunk": "@@ -184,6 +210,39 @@ public static String getVersion(Model model) {\n         throw new IllegalStateException(\"Failed to determine version for project model\");\n     }\n \n+    public static String getVersion(Model model) {\n+        final String rawVersion = getRawVersion(model);\n+        return isUnresolvedVersion(rawVersion) ? resolveVersion(rawVersion, model) : rawVersion;\n+    }\n+\n+    public static boolean isUnresolvedVersion(String version) {\n+        return getUnresolvedVersionPattern().matcher(version).find();\n+    }\n+\n+    public static String resolveVersion(String rawVersion, Model rawModel) {\n+        final Map<String, String> props = new HashMap<>();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "af17877fc73eebd058409aee1de98fd9a6bf6083"}, "originalPosition": 68}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDA1NTAzNTUw", "url": "https://github.com/quarkusio/quarkus/pull/8864#pullrequestreview-405503550", "createdAt": "2020-05-05T05:40:19Z", "commit": {"oid": "af17877fc73eebd058409aee1de98fd9a6bf6083"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4356, "cost": 1, "resetAt": "2021-11-02T10:47:05Z"}}}