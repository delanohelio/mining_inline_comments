{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDA2MTI3Mjk2", "number": 8706, "title": "Add gradle wrapper into platform-descriptor", "bodyText": "When generating a project with gradle as build tool, the wrapper is generated using the gradle wrapper command. If gradle is not installed on the machine, the project creation will fail.\nThis branch adds a fallback such as, in case of failure, gradle wrapper's files are copied from platform-descriptor-json artifact.\nGradle wrapper's file are embedded in the platform-descriptor-json artifact at build time.\nThis branch can be tested using a docker container:\ndocker run --rm -v ~/.m2:/root/.m2 maven:3.6.3-jdk-11 mvn io.quarkus:quarkus-maven-plugin:999-SNAPSHOT:create \\\n            -DprojectGroupId=org.acme \\\n            -DprojectArtifactId=my-gradle-project \\        \n            -DclassName=\"org.acme.quickstart.GreetingResource\" \\\n            -DplatformArtifactId=quarkus-bom \\\n            -Dpath=\"/hello\" \\\n            -DbuildTool=gradle\n\nclose #4982", "createdAt": "2020-04-20T15:15:39Z", "url": "https://github.com/quarkusio/quarkus/pull/8706", "merged": true, "mergeCommit": {"oid": "8b252460c05cf8ba844df16740ac4e3fc6add5d1"}, "closed": true, "closedAt": "2020-04-22T12:33:31Z", "author": {"login": "glefloch"}, "timelineItems": {"totalCount": 8, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcZhx-3gFqTM5NjYyMjg3MA==", "endCursor": "Y3Vyc29yOnYyOpPPAAABcaHglDAFqTM5ODE0MTU5NA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzk2NjIyODcw", "url": "https://github.com/quarkusio/quarkus/pull/8706#pullrequestreview-396622870", "createdAt": "2020-04-20T16:35:19Z", "commit": {"oid": "5745e5f54cc158ef2c69e48583e978134a74eac1"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yMFQxNjozNToxOVrOGIdaWA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yMFQxNjozNToxOVrOGIdaWA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMTUyMzY3Mg==", "bodyText": "Two comments here. I think we should use ./gradlew. Maybe we could reuse the one in devtools/gradle. We would need to support both Unix-based OSes and Windows (so use the gradlew.bat on Windows).\nAlso, I think we should specify the version by using the gradle-wrapper.version property defined in build-parent/pom.xml.", "url": "https://github.com/quarkusio/quarkus/pull/8706#discussion_r411523672", "createdAt": "2020-04-20T16:35:19Z", "author": {"login": "gsmet"}, "path": "devtools/platform-descriptor-json/pom.xml", "diffHunk": "@@ -65,6 +65,27 @@\n                     </execution>\n                 </executions>\n             </plugin>\n+            <plugin>\n+                <groupId>org.codehaus.mojo</groupId>\n+                <artifactId>exec-maven-plugin</artifactId>\n+                <executions>\n+                    <execution>\n+                        <id>generate-gradle-wrapper</id>\n+                        <phase>prepare-package</phase>\n+                        <configuration>\n+                            <executable>gradle</executable>\n+                            <arguments>\n+                                <argument>wrapper</argument>\n+                            </arguments>", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "5745e5f54cc158ef2c69e48583e978134a74eac1"}, "originalPosition": 15}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "5745e5f54cc158ef2c69e48583e978134a74eac1", "author": {"user": {"login": "glefloch", "name": "Guillaume Le Floch"}}, "url": "https://github.com/quarkusio/quarkus/commit/5745e5f54cc158ef2c69e48583e978134a74eac1", "committedDate": "2020-04-20T15:01:02Z", "message": "Add gradle wrapper into platform-descriptor"}, "afterCommit": {"oid": "71eed2f7ecdb2f6bac75711a3fff4f656a56120d", "author": {"user": {"login": "glefloch", "name": "Guillaume Le Floch"}}, "url": "https://github.com/quarkusio/quarkus/commit/71eed2f7ecdb2f6bac75711a3fff4f656a56120d", "committedDate": "2020-04-21T08:21:37Z", "message": "Add gradle wrapper into platform-descriptor"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzk3MTc2OTgy", "url": "https://github.com/quarkusio/quarkus/pull/8706#pullrequestreview-397176982", "createdAt": "2020-04-21T09:58:39Z", "commit": {"oid": "71eed2f7ecdb2f6bac75711a3fff4f656a56120d"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yMVQwOTo1ODo0MFrOGI9Vfg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yMVQwOTo1ODo1MlrOGI9WEw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMjA0NjcxOA==", "bodyText": "Shouldn't we just drop the part where we try to use a local Gradle? I think copying things is better.", "url": "https://github.com/quarkusio/quarkus/pull/8706#discussion_r412046718", "createdAt": "2020-04-21T09:58:40Z", "author": {"login": "gsmet"}, "path": "devtools/maven/src/main/java/io/quarkus/maven/CreateProjectMojo.java", "diffHunk": "@@ -248,7 +253,10 @@ private void createGradleWrapper(File projectDirectory, Properties props) {\n                 getLog().warn(\"Unable to install the Gradle wrapper (./gradlew) in project. See log for details.\");\n             }\n \n-        } catch (InterruptedException | IOException e) {\n+        } catch (IOException e) {\n+            getLog().warn(\"Unable to install the Gradle wrapper with gradle. Gradle wrapper is going to be copy.\");\n+            copyGradleWrapperFiles(platform, writer);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "71eed2f7ecdb2f6bac75711a3fff4f656a56120d"}, "originalPosition": 44}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMjA0Njg2Nw==", "bodyText": "We don't want to lose the exception.", "url": "https://github.com/quarkusio/quarkus/pull/8706#discussion_r412046867", "createdAt": "2020-04-21T09:58:52Z", "author": {"login": "gsmet"}, "path": "devtools/maven/src/main/java/io/quarkus/maven/CreateProjectMojo.java", "diffHunk": "@@ -257,6 +265,28 @@ private void createGradleWrapper(File projectDirectory, Properties props) {\n \n     }\n \n+    private void copyGradleWrapperFiles(QuarkusPlatformDescriptor platform, ProjectWriter writer) {\n+        try {\n+            writer.mkdirs(\"gradle/wrapper\");\n+\n+            for (String filename : CreateUtils.GRADLE_WRAPPER_FILES) {\n+                byte[] fileContent = platform.loadResource(Paths.get(CreateUtils.GRADLE_WRAPPER_PATH, filename).toString(),\n+                        is -> {\n+                            byte[] buffer = new byte[is.available()];\n+                            is.read(buffer);\n+                            return buffer;\n+                        });\n+                final Path destination = writer.getProjectFolder().toPath().resolve(filename);\n+                Files.write(destination, fileContent);\n+            }\n+\n+            new File(writer.getProjectFolder(), \"gradlew\").setExecutable(true);\n+            new File(writer.getProjectFolder(), \"gradlew.bat\").setExecutable(true);\n+        } catch (IOException e) {\n+            getLog().error(\"Unable to copy Gradle wrapper from platform descriptor\");", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "71eed2f7ecdb2f6bac75711a3fff4f656a56120d"}, "originalPosition": 71}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "71eed2f7ecdb2f6bac75711a3fff4f656a56120d", "author": {"user": {"login": "glefloch", "name": "Guillaume Le Floch"}}, "url": "https://github.com/quarkusio/quarkus/commit/71eed2f7ecdb2f6bac75711a3fff4f656a56120d", "committedDate": "2020-04-21T08:21:37Z", "message": "Add gradle wrapper into platform-descriptor"}, "afterCommit": {"oid": "80b00577e919fc0db08ad1cbea34e5d7325e458f", "author": {"user": {"login": "glefloch", "name": "Guillaume Le Floch"}}, "url": "https://github.com/quarkusio/quarkus/commit/80b00577e919fc0db08ad1cbea34e5d7325e458f", "committedDate": "2020-04-21T13:36:36Z", "message": "Add gradle wrapper into platform-descriptor"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ddf4358cf7e4bf74603b550fd2c15e840e9683b9", "author": {"user": {"login": "glefloch", "name": "Guillaume Le Floch"}}, "url": "https://github.com/quarkusio/quarkus/commit/ddf4358cf7e4bf74603b550fd2c15e840e9683b9", "committedDate": "2020-04-21T13:54:25Z", "message": "Add gradle wrapper into platform-descriptor"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "80b00577e919fc0db08ad1cbea34e5d7325e458f", "author": {"user": {"login": "glefloch", "name": "Guillaume Le Floch"}}, "url": "https://github.com/quarkusio/quarkus/commit/80b00577e919fc0db08ad1cbea34e5d7325e458f", "committedDate": "2020-04-21T13:36:36Z", "message": "Add gradle wrapper into platform-descriptor"}, "afterCommit": {"oid": "ddf4358cf7e4bf74603b550fd2c15e840e9683b9", "author": {"user": {"login": "glefloch", "name": "Guillaume Le Floch"}}, "url": "https://github.com/quarkusio/quarkus/commit/ddf4358cf7e4bf74603b550fd2c15e840e9683b9", "committedDate": "2020-04-21T13:54:25Z", "message": "Add gradle wrapper into platform-descriptor"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzk3OTM5Njk0", "url": "https://github.com/quarkusio/quarkus/pull/8706#pullrequestreview-397939694", "createdAt": "2020-04-22T08:03:08Z", "commit": {"oid": "ddf4358cf7e4bf74603b550fd2c15e840e9683b9"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzk4MTQxNTk0", "url": "https://github.com/quarkusio/quarkus/pull/8706#pullrequestreview-398141594", "createdAt": "2020-04-22T12:33:02Z", "commit": {"oid": "ddf4358cf7e4bf74603b550fd2c15e840e9683b9"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4459, "cost": 1, "resetAt": "2021-11-02T10:47:05Z"}}}