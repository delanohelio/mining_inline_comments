{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDgxMzk1MzA3", "number": 11941, "title": "Various multiple persistence units adjustments", "bodyText": "", "createdAt": "2020-09-07T13:34:03Z", "url": "https://github.com/quarkusio/quarkus/pull/11941", "merged": true, "mergeCommit": {"oid": "377a34f704be52afb5b71581987df484de1a6182"}, "closed": true, "closedAt": "2020-09-08T13:47:33Z", "author": {"login": "gsmet"}, "timelineItems": {"totalCount": 9, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdGyvKggFqTQ4Mzg3NzY1MQ==", "endCursor": "Y3Vyc29yOnYyOpPPAAABdG19jfgBqjM3NDA0NzU0NzQ=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDgzODc3NjUx", "url": "https://github.com/quarkusio/quarkus/pull/11941#pullrequestreview-483877651", "createdAt": "2020-09-08T07:47:32Z", "commit": {"oid": "e8a9a19f6886bf58aa966af17c93275a608c1632"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wOFQwNzo0NzozMlrOHOQ3MA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wOFQwNzo0NzozMlrOHOQ3MA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NDcxODM4NA==", "bodyText": "Minor suggestion: Make sure to use the @io.quarkus.hibernate.orm.PersistenceUnit` ...", "url": "https://github.com/quarkusio/quarkus/pull/11941#discussion_r484718384", "createdAt": "2020-09-08T07:47:32Z", "author": {"login": "geoand"}, "path": "docs/src/main/asciidoc/hibernate-orm.adoc", "diffHunk": "@@ -822,9 +822,36 @@ public class CustomTenantResolver implements TenantResolver {\n     \n }\n ----\n+<1> The bean is made `@RequestScoped` as the tenant resolution depends on the incoming request.\n \n From the implementation above, tenants are resolved from the request path so that in case no tenant could be inferred, the default tenant identifier is returned.\n \n+[NOTE]\n+====\n+If <<multiple-persistence-units,named persistence units>> are used, you need to qualify the `TenantResolver` with the persistence unit name:\n+\n+[source,java]\n+----\n+import javax.enterprise.context.ApplicationScoped;\n+\n+import io.quarkus.arc.Arc;\n+import io.quarkus.arc.Unremovable;\n+import io.quarkus.hibernate.orm.PersistenceUnit;\n+import io.quarkus.hibernate.orm.runtime.tenant.TenantResolver;\n+import io.vertx.ext.web.RoutingContext;\n+\n+@PersistenceUnit(\"name-of-persistence-unit\") <1>\n+@RequestScoped\n+@Unremovable\n+public class CustomTenantResolver implements TenantResolver {\n+\n+   // ...\n+\n+}\n+----\n+<1> Be careful to use the `@io.quarkus.hibernate.orm.PersistenceUnit` annotation, not the JPA one.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e8a9a19f6886bf58aa966af17c93275a608c1632"}, "originalPosition": 51}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDgzODg5NjMz", "url": "https://github.com/quarkusio/quarkus/pull/11941#pullrequestreview-483889633", "createdAt": "2020-09-08T08:03:48Z", "commit": {"oid": "94657d6b2aea7bba33da0aefc49f811dc1cb891f"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wOFQwODowMzo0OFrOHORbWg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wOFQwODowMzo0OFrOHORbWg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NDcyNzY0Mg==", "bodyText": "Is this needed? If so, then we probably want to mention it in the example in the docs as well", "url": "https://github.com/quarkusio/quarkus/pull/11941#discussion_r484727642", "createdAt": "2020-09-08T08:03:48Z", "author": {"login": "geoand"}, "path": "integration-tests/hibernate-tenancy/src/main/java/io/quarkus/it/hibernate/multitenancy/inventory/InventoryTenantResolver.java", "diffHunk": "@@ -0,0 +1,41 @@\n+package io.quarkus.it.hibernate.multitenancy.inventory;\n+\n+import javax.enterprise.context.RequestScoped;\n+import javax.inject.Inject;\n+\n+import org.jboss.logging.Logger;\n+\n+import io.quarkus.arc.Unremovable;\n+import io.quarkus.hibernate.orm.PersistenceUnit;\n+import io.quarkus.hibernate.orm.runtime.tenant.TenantResolver;\n+import io.vertx.ext.web.RoutingContext;\n+\n+@RequestScoped\n+@Unremovable", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "94657d6b2aea7bba33da0aefc49f811dc1cb891f"}, "originalPosition": 14}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDgzODkxODQ5", "url": "https://github.com/quarkusio/quarkus/pull/11941#pullrequestreview-483891849", "createdAt": "2020-09-08T08:06:46Z", "commit": {"oid": "e8a9a19f6886bf58aa966af17c93275a608c1632"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "3587bd827cdaea4d1885aca7c4619dd5ae867acc", "author": {"user": {"login": "gsmet", "name": "Guillaume Smet"}}, "url": "https://github.com/quarkusio/quarkus/commit/3587bd827cdaea4d1885aca7c4619dd5ae867acc", "committedDate": "2020-09-08T11:15:01Z", "message": "Documentation adjustments for multiple persistence units support"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "e8a9a19f6886bf58aa966af17c93275a608c1632", "author": {"user": {"login": "gsmet", "name": "Guillaume Smet"}}, "url": "https://github.com/quarkusio/quarkus/commit/e8a9a19f6886bf58aa966af17c93275a608c1632", "committedDate": "2020-09-07T15:31:44Z", "message": "Throw an error if @PersistenceUnit is put on model classes\n\nWe only support them at package-level for now.\nAlso tweak some error messages and avoid an error in a perfectly valid\ncase."}, "afterCommit": {"oid": "a4ab19155a1a2c32440c6cbc92836984c46f4a49", "author": {"user": {"login": "gsmet", "name": "Guillaume Smet"}}, "url": "https://github.com/quarkusio/quarkus/commit/a4ab19155a1a2c32440c6cbc92836984c46f4a49", "committedDate": "2020-09-08T11:30:07Z", "message": "Make the multitenancy beans unremovable\n\nAnd drop it from the documentation."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "681a29e7ae744011e4c38aca6e70802c00a0d326", "author": {"user": {"login": "gsmet", "name": "Guillaume Smet"}}, "url": "https://github.com/quarkusio/quarkus/commit/681a29e7ae744011e4c38aca6e70802c00a0d326", "committedDate": "2020-09-08T11:32:46Z", "message": "Fix a few loose ends in the multitenancy + multi PUs code path\n\nAlso add a proper test. That's something I wanted to do during the CR\nphase anyway."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "2dbe5fa1885cb00e7b067bd7f6f02faee8308370", "author": {"user": {"login": "gsmet", "name": "Guillaume Smet"}}, "url": "https://github.com/quarkusio/quarkus/commit/2dbe5fa1885cb00e7b067bd7f6f02faee8308370", "committedDate": "2020-09-08T11:32:46Z", "message": "Throw an error if @PersistenceUnit is put on model classes\n\nWe only support them at package-level for now.\nAlso tweak some error messages and avoid an error in a perfectly valid\ncase."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "03805e40705d4266079a16d0757e4114beb84029", "author": {"user": {"login": "gsmet", "name": "Guillaume Smet"}}, "url": "https://github.com/quarkusio/quarkus/commit/03805e40705d4266079a16d0757e4114beb84029", "committedDate": "2020-09-08T11:32:46Z", "message": "Make the multitenancy beans unremovable\n\nAnd drop it from the documentation."}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "a4ab19155a1a2c32440c6cbc92836984c46f4a49", "author": {"user": {"login": "gsmet", "name": "Guillaume Smet"}}, "url": "https://github.com/quarkusio/quarkus/commit/a4ab19155a1a2c32440c6cbc92836984c46f4a49", "committedDate": "2020-09-08T11:30:07Z", "message": "Make the multitenancy beans unremovable\n\nAnd drop it from the documentation."}, "afterCommit": {"oid": "03805e40705d4266079a16d0757e4114beb84029", "author": {"user": {"login": "gsmet", "name": "Guillaume Smet"}}, "url": "https://github.com/quarkusio/quarkus/commit/03805e40705d4266079a16d0757e4114beb84029", "committedDate": "2020-09-08T11:32:46Z", "message": "Make the multitenancy beans unremovable\n\nAnd drop it from the documentation."}}]}}}, "rateLimit": {"limit": 5000, "remaining": 567, "cost": 1, "resetAt": "2021-11-01T16:37:27Z"}}}