{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDQwNDUyNzM5", "number": 10294, "title": "Add the ability to print the startup time of each build step", "bodyText": "This has been discussed a couple times and I myself could have\nused it when I was looking into the Flyway startup times", "createdAt": "2020-06-26T08:27:33Z", "url": "https://github.com/quarkusio/quarkus/pull/10294", "merged": true, "mergeCommit": {"oid": "30baf785a7f69ab65904faf32714f8b3242a2a30"}, "closed": true, "closedAt": "2020-07-06T12:36:07Z", "author": {"login": "geoand"}, "timelineItems": {"totalCount": 12, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcu_BbvgBqjM0ODU2NTQyMzc=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcyQbFzABqjM1MTU2ODk1MjI=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "faf55a23ce25dbc37588647d0215850e14a794f5", "author": {"user": {"login": "geoand", "name": "Georgios Andrianakis"}}, "url": "https://github.com/quarkusio/quarkus/commit/faf55a23ce25dbc37588647d0215850e14a794f5", "committedDate": "2020-06-26T08:27:13Z", "message": "Add the ability to print the startup time of each build step\n\nThis has been discussed a couple times and I myself could have\nused it when I was looking into the Flwyay startup times"}, "afterCommit": {"oid": "9e81161a67caa372417e6c60034ecdf15d8b9aba", "author": {"user": {"login": "geoand", "name": "Georgios Andrianakis"}}, "url": "https://github.com/quarkusio/quarkus/commit/9e81161a67caa372417e6c60034ecdf15d8b9aba", "committedDate": "2020-06-26T08:32:04Z", "message": "Add the ability to print the startup time of each build step\n\nThis has been discussed a couple times and I myself could have\nused it when I was looking into the Flwyay startup times"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "9e81161a67caa372417e6c60034ecdf15d8b9aba", "author": {"user": {"login": "geoand", "name": "Georgios Andrianakis"}}, "url": "https://github.com/quarkusio/quarkus/commit/9e81161a67caa372417e6c60034ecdf15d8b9aba", "committedDate": "2020-06-26T08:32:04Z", "message": "Add the ability to print the startup time of each build step\n\nThis has been discussed a couple times and I myself could have\nused it when I was looking into the Flwyay startup times"}, "afterCommit": {"oid": "eac1ec06470849d8c9b8a6905ac157eda0490293", "author": {"user": {"login": "geoand", "name": "Georgios Andrianakis"}}, "url": "https://github.com/quarkusio/quarkus/commit/eac1ec06470849d8c9b8a6905ac157eda0490293", "committedDate": "2020-07-02T11:44:13Z", "message": "Add the ability to print the startup time of each build step\n\nThis has been discussed a couple times and I myself could have\nused it when I was looking into the Flwyay startup times"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "eac1ec06470849d8c9b8a6905ac157eda0490293", "author": {"user": {"login": "geoand", "name": "Georgios Andrianakis"}}, "url": "https://github.com/quarkusio/quarkus/commit/eac1ec06470849d8c9b8a6905ac157eda0490293", "committedDate": "2020-07-02T11:44:13Z", "message": "Add the ability to print the startup time of each build step\n\nThis has been discussed a couple times and I myself could have\nused it when I was looking into the Flwyay startup times"}, "afterCommit": {"oid": "b64f4f1a5d164a62610706454065cbe2651bffba", "author": {"user": {"login": "geoand", "name": "Georgios Andrianakis"}}, "url": "https://github.com/quarkusio/quarkus/commit/b64f4f1a5d164a62610706454065cbe2651bffba", "committedDate": "2020-07-03T12:15:40Z", "message": "Add the ability to print the startup time of each build step - v2"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "b64f4f1a5d164a62610706454065cbe2651bffba", "author": {"user": {"login": "geoand", "name": "Georgios Andrianakis"}}, "url": "https://github.com/quarkusio/quarkus/commit/b64f4f1a5d164a62610706454065cbe2651bffba", "committedDate": "2020-07-03T12:15:40Z", "message": "Add the ability to print the startup time of each build step - v2"}, "afterCommit": {"oid": "c9faf62ef3cd9498e546058775ee122fded6ee5c", "author": {"user": {"login": "geoand", "name": "Georgios Andrianakis"}}, "url": "https://github.com/quarkusio/quarkus/commit/c9faf62ef3cd9498e546058775ee122fded6ee5c", "committedDate": "2020-07-03T12:20:42Z", "message": "Add the ability to print the startup time of each build step - v2"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDQyNzQ4ODQx", "url": "https://github.com/quarkusio/quarkus/pull/10294#pullrequestreview-442748841", "createdAt": "2020-07-06T03:01:04Z", "commit": {"oid": "c9faf62ef3cd9498e546058775ee122fded6ee5c"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wNlQwMzowMTowNVrOGtHebA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wNlQwMzowMTowNVrOGtHebA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0OTk2MTU4MA==", "bodyText": "Does this actually need to be generated? Can't it just be a static utility method?", "url": "https://github.com/quarkusio/quarkus/pull/10294#discussion_r449961580", "createdAt": "2020-07-06T03:01:05Z", "author": {"login": "stuartwdouglas"}, "path": "core/deployment/src/main/java/io/quarkus/deployment/steps/MainClassBuildStep.java", "diffHunk": "@@ -308,6 +333,78 @@ void build(List<StaticBytecodeRecorderBuildItem> staticInitTasks,\n         file.close();\n     }\n \n+    /**\n+     * Step timing is enabled only if 'quarkus.debug.print-startup-times' is set.\n+     * This method should be called both in static init and runtime init in order to\n+     * make sure that the system properly works properly in native mode\n+     */\n+    private void setStepTimingField(MethodCreator mv) {\n+        ResultHandle timingEnabledProp = mv.invokeStaticMethod(\n+                ofMethod(System.class, \"getProperty\", String.class, String.class, String.class),\n+                mv.load(MainClassBuildStep.PRINT_STARTUP_TIMES_PROPERTY), mv.load(\"false\"));\n+        mv.writeStaticField(STEP_TIMING_ENABLED_FIELD, mv.invokeStaticMethod(\n+                ofMethod(Boolean.class, \"parseBoolean\", boolean.class, String.class), timingEnabledProp));\n+    }\n+\n+    /**\n+     * Generates the following bytecode:\n+     * \n+     * <pre>\n+     *\n+     * private static void printStepTime() {\n+     *     if (stepTimingEnabled) {\n+     *         long var2 = System.currentTimeMillis();\n+     *         String var0 = STARTUP_CONTEXT.getCurrentBuildStepName();\n+     *         StringBuilder var1 = new StringBuilder(\"Build step \");\n+     *         var1.append(var0);\n+     *         var1.append(\" completed in: \");\n+     *         long var4 = stepTimingStart;\n+     *         String var6 = String.valueOf(Math.subtractExact(var2, var4));\n+     *         var1.append(var6);\n+     *         var1.append(\"ms\");\n+     *         PrintStream var7 = System.out;\n+     *         String var8 = var1.toString();\n+     *         var7.println(var8);\n+     *         stepTimingStart = System.currentTimeMillis();\n+     *     }\n+     * }\n+     *\n+     * </pre>\n+     *\n+     * This is used to print the time it took for a build step to execute. The first invocation of this method\n+     * assumes that the static {@code stepTimingStart} field has been set.\n+     *\n+     * After printing the time, it also resets {@code stepTimingStart} because steps are executed one after the other.\n+     */\n+    private void generationPrintStepTimeMethod(ClassCreator file) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c9faf62ef3cd9498e546058775ee122fded6ee5c"}, "originalPosition": 121}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "c9faf62ef3cd9498e546058775ee122fded6ee5c", "author": {"user": {"login": "geoand", "name": "Georgios Andrianakis"}}, "url": "https://github.com/quarkusio/quarkus/commit/c9faf62ef3cd9498e546058775ee122fded6ee5c", "committedDate": "2020-07-03T12:20:42Z", "message": "Add the ability to print the startup time of each build step - v2"}, "afterCommit": {"oid": "69398b5778111c297a251dd9ed849a44422f2f24", "author": {"user": {"login": "geoand", "name": "Georgios Andrianakis"}}, "url": "https://github.com/quarkusio/quarkus/commit/69398b5778111c297a251dd9ed849a44422f2f24", "committedDate": "2020-07-06T05:10:24Z", "message": "Add the ability to print the startup time of each build step - v3"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "69398b5778111c297a251dd9ed849a44422f2f24", "author": {"user": {"login": "geoand", "name": "Georgios Andrianakis"}}, "url": "https://github.com/quarkusio/quarkus/commit/69398b5778111c297a251dd9ed849a44422f2f24", "committedDate": "2020-07-06T05:10:24Z", "message": "Add the ability to print the startup time of each build step - v3"}, "afterCommit": {"oid": "4015a51a989fd9c781927a2c1730c972a114d995", "author": {"user": {"login": "geoand", "name": "Georgios Andrianakis"}}, "url": "https://github.com/quarkusio/quarkus/commit/4015a51a989fd9c781927a2c1730c972a114d995", "committedDate": "2020-07-06T05:11:45Z", "message": "Add the ability to print the startup time of each build step - v3"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDQyNzk1MjM2", "url": "https://github.com/quarkusio/quarkus/pull/10294#pullrequestreview-442795236", "createdAt": "2020-07-06T06:09:31Z", "commit": {"oid": "4015a51a989fd9c781927a2c1730c972a114d995"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "4015a51a989fd9c781927a2c1730c972a114d995", "author": {"user": {"login": "geoand", "name": "Georgios Andrianakis"}}, "url": "https://github.com/quarkusio/quarkus/commit/4015a51a989fd9c781927a2c1730c972a114d995", "committedDate": "2020-07-06T05:11:45Z", "message": "Add the ability to print the startup time of each build step - v3"}, "afterCommit": {"oid": "18d66e6a2daafa6fe524b987613b72e921b4d159", "author": {"user": {"login": "geoand", "name": "Georgios Andrianakis"}}, "url": "https://github.com/quarkusio/quarkus/commit/18d66e6a2daafa6fe524b987613b72e921b4d159", "committedDate": "2020-07-06T06:13:11Z", "message": "Add the ability to print the startup time of each build step"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "18d66e6a2daafa6fe524b987613b72e921b4d159", "author": {"user": {"login": "geoand", "name": "Georgios Andrianakis"}}, "url": "https://github.com/quarkusio/quarkus/commit/18d66e6a2daafa6fe524b987613b72e921b4d159", "committedDate": "2020-07-06T06:13:11Z", "message": "Add the ability to print the startup time of each build step"}, "afterCommit": {"oid": "fa70fb634d3262fb275aed6fbb38258c63c4d2a3", "author": {"user": {"login": "geoand", "name": "Georgios Andrianakis"}}, "url": "https://github.com/quarkusio/quarkus/commit/fa70fb634d3262fb275aed6fbb38258c63c4d2a3", "committedDate": "2020-07-06T08:01:53Z", "message": "Add the ability to print the startup time of each build step"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "86b9fda5342d8f48b16e1a8e6a710d883caab033", "author": {"user": {"login": "geoand", "name": "Georgios Andrianakis"}}, "url": "https://github.com/quarkusio/quarkus/commit/86b9fda5342d8f48b16e1a8e6a710d883caab033", "committedDate": "2020-07-06T12:30:12Z", "message": "Add the ability to print the startup time of each build step"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "fa70fb634d3262fb275aed6fbb38258c63c4d2a3", "author": {"user": {"login": "geoand", "name": "Georgios Andrianakis"}}, "url": "https://github.com/quarkusio/quarkus/commit/fa70fb634d3262fb275aed6fbb38258c63c4d2a3", "committedDate": "2020-07-06T08:01:53Z", "message": "Add the ability to print the startup time of each build step"}, "afterCommit": {"oid": "86b9fda5342d8f48b16e1a8e6a710d883caab033", "author": {"user": {"login": "geoand", "name": "Georgios Andrianakis"}}, "url": "https://github.com/quarkusio/quarkus/commit/86b9fda5342d8f48b16e1a8e6a710d883caab033", "committedDate": "2020-07-06T12:30:12Z", "message": "Add the ability to print the startup time of each build step"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4999, "cost": 1, "resetAt": "2021-11-02T10:47:05Z"}}}