{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0MzkyMzkzODk1", "number": 8082, "title": "fix security checks to make @RolesAllowed(\"**\") work", "bodyText": "The correct wildcard to use seems to be **, because that's what\nthe Jakarta EE specifications use. More specifically:\n\nthe EJB spec says that ** means all roles\n(chapter 12.2.5.2 in EJB 3.2 Core spec)\nthe Servlet spec says that ** means all roles and * should\nnever be used (chapter 13.3 in Servlet 4.0 spec)\nthe JAX-RS specification doesn't seem to define this, but\nQuarkusResteasySecurityContext.isUserInRole already uses **\n\nResolves #7994.", "createdAt": "2020-03-23T13:43:33Z", "url": "https://github.com/quarkusio/quarkus/pull/8082", "merged": true, "mergeCommit": {"oid": "6a60d00082fc16eadeb9aef49d1f13117a3301fe"}, "closed": true, "closedAt": "2020-03-24T12:18:26Z", "author": {"login": "Ladicek"}, "timelineItems": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcQeaCqAH2gAyMzkyMzkzODk1OmJkMDRkYzc3NzViMDQ1NzA1MDM3MWU5OGM4NTU3MjJlZjAzMGQ0ZWQ=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcQwbg7AFqTM4MDE4MTYyNg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "bd04dc7775b0457050371e98c855722ef030d4ed", "author": {"user": {"login": "Ladicek", "name": "Ladislav Thon"}}, "url": "https://github.com/quarkusio/quarkus/commit/bd04dc7775b0457050371e98c855722ef030d4ed", "committedDate": "2020-03-23T13:34:28Z", "message": "fix security checks to make @RolesAllowed(\"**\") work\n\nThe correct wildcard to use seems to be `**`, because that's what\nthe Jakarta EE specifications use. More specifically:\n\n- the EJB spec says that `**` means all roles\n  (chapter 12.2.5.2 in EJB 3.2 Core spec)\n- the Servlet spec says that `**` means all roles and `*` should\n  never be used (chapter 13.3 in Servlet 4.0 spec)\n- the JAX-RS specification doesn't seem to define this, but\n  `QuarkusResteasySecurityContext.isUserInRole` already uses `**`"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzc5NDUxNTYw", "url": "https://github.com/quarkusio/quarkus/pull/8082#pullrequestreview-379451560", "createdAt": "2020-03-23T13:56:27Z", "commit": {"oid": "bd04dc7775b0457050371e98c855722ef030d4ed"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzc5NDgyODIz", "url": "https://github.com/quarkusio/quarkus/pull/8082#pullrequestreview-379482823", "createdAt": "2020-03-23T14:29:19Z", "commit": {"oid": "bd04dc7775b0457050371e98c855722ef030d4ed"}, "state": "DISMISSED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yM1QxNDoyOToyMFrOF6H_EA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yM1QxNDoyOToyMFrOF6H_EA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NjQ5MjU2MA==", "bodyText": "So do we support *?\nIf it's what we documented before, we should probably support it.", "url": "https://github.com/quarkusio/quarkus/pull/8082#discussion_r396492560", "createdAt": "2020-03-23T14:29:20Z", "author": {"login": "gsmet"}, "path": "extensions/security/runtime/src/main/java/io/quarkus/security/runtime/interceptor/check/RolesAllowedCheck.java", "diffHunk": "@@ -54,7 +54,7 @@ public void apply(SecurityIdentity identity, Method method, Object[] parameters)\n         Set<String> roles = identity.getRoles();\n         if (roles != null) {\n             for (String role : allowedRoles) {\n-                if (roles.contains(role)) {\n+                if (roles.contains(role) || (\"**\".equals(role) && !identity.isAnonymous())) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "bd04dc7775b0457050371e98c855722ef030d4ed"}, "originalPosition": 5}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzc5NjUxMTQ0", "url": "https://github.com/quarkusio/quarkus/pull/8082#pullrequestreview-379651144", "createdAt": "2020-03-23T17:22:35Z", "commit": {"oid": "bd04dc7775b0457050371e98c855722ef030d4ed"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yM1QxNzoyMjozNVrOF6P8xA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yM1QxNzoyMjozNVrOF6P8xA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NjYyMzA0NA==", "bodyText": "@Ladicek That looks fine, but do we also have to tweak smallrye-jwt code somewhere as you said it supports * ?", "url": "https://github.com/quarkusio/quarkus/pull/8082#discussion_r396623044", "createdAt": "2020-03-23T17:22:35Z", "author": {"login": "sberyozkin"}, "path": "extensions/security/runtime/src/main/java/io/quarkus/security/runtime/interceptor/check/RolesAllowedCheck.java", "diffHunk": "@@ -54,7 +54,7 @@ public void apply(SecurityIdentity identity, Method method, Object[] parameters)\n         Set<String> roles = identity.getRoles();\n         if (roles != null) {\n             for (String role : allowedRoles) {\n-                if (roles.contains(role)) {\n+                if (roles.contains(role) || (\"**\".equals(role) && !identity.isAnonymous())) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "bd04dc7775b0457050371e98c855722ef030d4ed"}, "originalPosition": 5}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzgwMTgxNjI2", "url": "https://github.com/quarkusio/quarkus/pull/8082#pullrequestreview-380181626", "createdAt": "2020-03-24T10:34:22Z", "commit": {"oid": "bd04dc7775b0457050371e98c855722ef030d4ed"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3576, "cost": 1, "resetAt": "2021-11-02T10:47:05Z"}}}