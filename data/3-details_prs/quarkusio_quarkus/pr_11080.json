{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDU4OTE1NTcx", "number": 11080, "title": "Add ability to directly specify endpoints in tests", "bodyText": "This makes it easy to specify exactly what endpoint is being\ntested.\nI am not 100% sure about the annotation name. At the moment it only affects RESTAssured but it could be expanded in future.", "createdAt": "2020-07-30T06:47:01Z", "url": "https://github.com/quarkusio/quarkus/pull/11080", "merged": true, "mergeCommit": {"oid": "95ff1cc198bc38d4ec79005a0e45f0b44531e3d1"}, "closed": true, "closedAt": "2020-07-31T09:18:30Z", "author": {"login": "stuartwdouglas"}, "timelineItems": {"totalCount": 11, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABc56HElgFqTQ1ODEyNjAwOQ==", "endCursor": "Y3Vyc29yOnYyOpPPAAABc6KY0dgBqjM2MDY1MjU0MDY=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDU4MTI2MDA5", "url": "https://github.com/quarkusio/quarkus/pull/11080#pullrequestreview-458126009", "createdAt": "2020-07-30T06:47:59Z", "commit": {"oid": "ccc93842cc70386fa01d33cdf2080190df9a1dd8"}, "state": "COMMENTED", "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0zMFQwNjo0Nzo1OVrOG5VfHQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0zMFQwNjo1ODo0N1rOG5V_nA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2Mjc3NDA0NQ==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            Both RESTassured and ``@TestHTTPResource` allow you to specify the endpoint class you are testing rather than hard coding\n          \n          \n            \n            Both RESTassured and `@TestHTTPResource` allow you to specify the endpoint class you are testing rather than hard coding", "url": "https://github.com/quarkusio/quarkus/pull/11080#discussion_r462774045", "createdAt": "2020-07-30T06:47:59Z", "author": {"login": "geoand"}, "path": "docs/src/main/asciidoc/getting-started-testing.adoc", "diffHunk": "@@ -228,6 +228,115 @@ public class StaticContentTest {\n \n For now `@TestHTTPResource` allows you to inject `URI`, `URL` and `String` representations of the URL.\n \n+== Testing a specific endpoint\n+\n+Both RESTassured and ``@TestHTTPResource` allow you to specify the endpoint class you are testing rather than hard coding", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ccc93842cc70386fa01d33cdf2080190df9a1dd8"}, "originalPosition": 6}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2Mjc3NDM1Ng==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            a path. This current supports both JAX-RS endpoints and Servlet's. This makes it a lot easier to see exactly which endpoints\n          \n          \n            \n            a path. This currently supports both JAX-RS endpoints and Servlets. This makes it a lot easier to see exactly which endpoints", "url": "https://github.com/quarkusio/quarkus/pull/11080#discussion_r462774356", "createdAt": "2020-07-30T06:48:24Z", "author": {"login": "geoand"}, "path": "docs/src/main/asciidoc/getting-started-testing.adoc", "diffHunk": "@@ -228,6 +228,115 @@ public class StaticContentTest {\n \n For now `@TestHTTPResource` allows you to inject `URI`, `URL` and `String` representations of the URL.\n \n+== Testing a specific endpoint\n+\n+Both RESTassured and ``@TestHTTPResource` allow you to specify the endpoint class you are testing rather than hard coding\n+a path. This current supports both JAX-RS endpoints and Servlet's. This makes it a lot easier to see exactly which endpoints", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ccc93842cc70386fa01d33cdf2080190df9a1dd8"}, "originalPosition": 7}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2Mjc4MjM2NA==", "bodyText": "Does this really need to be volatile?", "url": "https://github.com/quarkusio/quarkus/pull/11080#discussion_r462782364", "createdAt": "2020-07-30T06:58:47Z", "author": {"login": "geoand"}, "path": "test-framework/junit5/src/main/java/io/quarkus/test/junit/QuarkusTestExtension.java", "diffHunk": "@@ -103,6 +105,7 @@\n     private static List<Object> afterEachCallbacks;\n     private static Class<?> quarkusTestMethodContextClass;\n     private static Class<? extends QuarkusTestProfile> quarkusTestProfile;\n+    private static volatile List<Function<Class<?>, String>> testHttpEndpointProviders;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ccc93842cc70386fa01d33cdf2080190df9a1dd8"}, "originalPosition": 19}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "ccc93842cc70386fa01d33cdf2080190df9a1dd8", "author": {"user": {"login": "stuartwdouglas", "name": "Stuart Douglas"}}, "url": "https://github.com/quarkusio/quarkus/commit/ccc93842cc70386fa01d33cdf2080190df9a1dd8", "committedDate": "2020-07-30T06:45:16Z", "message": "Add ability to directly specify endpoints in tests\n\nThis makes it easy to specify eactly what endpoint is being\ntested."}, "afterCommit": {"oid": "52da5e265e0b44784b39b27b5b716e4f4bc8233d", "author": {"user": {"login": "stuartwdouglas", "name": "Stuart Douglas"}}, "url": "https://github.com/quarkusio/quarkus/commit/52da5e265e0b44784b39b27b5b716e4f4bc8233d", "committedDate": "2020-07-30T08:23:49Z", "message": "Add ability to directly specify endpoints in tests\n\nThis makes it easy to specify eactly what endpoint is being\ntested."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDU4MjAwNjc1", "url": "https://github.com/quarkusio/quarkus/pull/11080#pullrequestreview-458200675", "createdAt": "2020-07-30T08:40:56Z", "commit": {"oid": "52da5e265e0b44784b39b27b5b716e4f4bc8233d"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDU4MjgzMDE4", "url": "https://github.com/quarkusio/quarkus/pull/11080#pullrequestreview-458283018", "createdAt": "2020-07-30T10:36:26Z", "commit": {"oid": "52da5e265e0b44784b39b27b5b716e4f4bc8233d"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0zMFQxMDozNjoyN1rOG5dlmw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0zMFQxMDozNjoyN1rOG5dlmw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MjkwNjc3OQ==", "bodyText": "Does it take into account the root path? And the potential @ApplicationPath?", "url": "https://github.com/quarkusio/quarkus/pull/11080#discussion_r462906779", "createdAt": "2020-07-30T10:36:27Z", "author": {"login": "gsmet"}, "path": "docs/src/main/asciidoc/getting-started-testing.adoc", "diffHunk": "@@ -228,6 +228,118 @@ public class StaticContentTest {\n \n For now `@TestHTTPResource` allows you to inject `URI`, `URL` and `String` representations of the URL.\n \n+== Testing a specific endpoint\n+\n+Both RESTassured and `@TestHTTPResource` allow you to specify the endpoint class you are testing rather than hard coding\n+a path. This currently supports both JAX-RS endpoints and Servlets. This makes it a lot easier to see exactly which endpoints\n+a given test is testing.\n+\n+For the purposes of these examples I am going to assume we have an endpoint that looks like the following:\n+\n+[source,java]\n+----\n+@Path(\"/hello\")\n+public class GreetingResource {\n+\n+    @GET\n+    @Produces(MediaType.TEXT_PLAIN)\n+    public String hello() {\n+        return \"hello\";\n+    }\n+}\n+----\n+\n+NOTE: This currently does not support the `@ApplicationPath()` annotation to set the JAX-RS context path. Use the\n+`quarkus.resteasy.path` config value instead if you want a custom context path.\n+\n+=== TestHTTPResource\n+\n+You can the use the `io.quarkus.test.common.http.TestHTTPEndpoint` annotation to specify the endpoint path, and the path\n+will be extracted from the provided endpoint. If you also specify a value for the `TestHTTPResource` endpoint it will\n+be appended to the end of the endpoint path.\n+\n+[source,java]\n+----\n+package org.acme.getting.started.testing;\n+\n+import java.io.ByteArrayOutputStream;\n+import java.io.IOException;\n+import java.io.InputStream;\n+import java.net.URL;\n+import java.nio.charset.StandardCharsets;\n+\n+import org.junit.jupiter.api.Assertions;\n+import org.junit.jupiter.api.Test;\n+\n+import io.quarkus.test.common.http.TestHTTPEndpoint;\n+import io.quarkus.test.common.http.TestHTTPResource;\n+import io.quarkus.test.junit.QuarkusTest;\n+\n+@QuarkusTest\n+public class StaticContentTest {\n+\n+    @TestHTTPEndpoint(GreetingResource.class)  // <1>\n+    @TestHTTPResource\n+    URL url;\n+\n+    @Test\n+    public void testIndexHtml() throws Exception {\n+        try (InputStream in = url.openStream()) {\n+            String contents = readStream(in);\n+            Assertions.assertTrue(contents.equals(\"hello\"));\n+        }\n+    }\n+\n+    private static String readStream(InputStream in) throws IOException {\n+        byte[] data = new byte[1024];\n+        int r;\n+        ByteArrayOutputStream out = new ByteArrayOutputStream();\n+        while ((r = in.read(data)) > 0) {\n+            out.write(data, 0, r);\n+        }\n+        return new String(out.toByteArray(), StandardCharsets.UTF_8);\n+    }\n+}\n+----\n+<1> Because `GreetingResource` is annotated with `@Path(\"/hello\")` the injected URL", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "52da5e265e0b44784b39b27b5b716e4f4bc8233d"}, "originalPosition": 77}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "52da5e265e0b44784b39b27b5b716e4f4bc8233d", "author": {"user": {"login": "stuartwdouglas", "name": "Stuart Douglas"}}, "url": "https://github.com/quarkusio/quarkus/commit/52da5e265e0b44784b39b27b5b716e4f4bc8233d", "committedDate": "2020-07-30T08:23:49Z", "message": "Add ability to directly specify endpoints in tests\n\nThis makes it easy to specify eactly what endpoint is being\ntested."}, "afterCommit": {"oid": "3ccb86a8a74d73fe09eee4dca935b3afdb9ef3c7", "author": {"user": {"login": "stuartwdouglas", "name": "Stuart Douglas"}}, "url": "https://github.com/quarkusio/quarkus/commit/3ccb86a8a74d73fe09eee4dca935b3afdb9ef3c7", "committedDate": "2020-07-30T10:54:14Z", "message": "Add ability to directly specify endpoints in tests\n\nThis makes it easy to specify eactly what endpoint is being\ntested."}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "69fe0b7bd7a68a07b73a015d655bd55c43f6c2c1", "author": {"user": {"login": "geoand", "name": "Georgios Andrianakis"}}, "url": "https://github.com/quarkusio/quarkus/commit/69fe0b7bd7a68a07b73a015d655bd55c43f6c2c1", "committedDate": "2020-07-30T13:02:46Z", "message": "Fix broken native tests with @TestHTTPEndpoint"}, "afterCommit": {"oid": "8adee0d978f3590dae8e71719cf0e5c3f268b85f", "author": {"user": {"login": "geoand", "name": "Georgios Andrianakis"}}, "url": "https://github.com/quarkusio/quarkus/commit/8adee0d978f3590dae8e71719cf0e5c3f268b85f", "committedDate": "2020-07-30T15:16:15Z", "message": "Fix broken native tests with @TestHTTPEndpoint"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "8adee0d978f3590dae8e71719cf0e5c3f268b85f", "author": {"user": {"login": "geoand", "name": "Georgios Andrianakis"}}, "url": "https://github.com/quarkusio/quarkus/commit/8adee0d978f3590dae8e71719cf0e5c3f268b85f", "committedDate": "2020-07-30T15:16:15Z", "message": "Fix broken native tests with @TestHTTPEndpoint"}, "afterCommit": {"oid": "ee4dd0a205af898ae527941f74e2a2ac88e0ddce", "author": {"user": {"login": "stuartwdouglas", "name": "Stuart Douglas"}}, "url": "https://github.com/quarkusio/quarkus/commit/ee4dd0a205af898ae527941f74e2a2ac88e0ddce", "committedDate": "2020-07-30T22:55:29Z", "message": "Add ability to directly specify endpoints in tests\n\nThis makes it easy to specify eactly what endpoint is being\ntested."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "bc681175138374b023d8a98971739672978fae4a", "author": {"user": {"login": "stuartwdouglas", "name": "Stuart Douglas"}}, "url": "https://github.com/quarkusio/quarkus/commit/bc681175138374b023d8a98971739672978fae4a", "committedDate": "2020-07-31T01:33:57Z", "message": "Add ability to directly specify endpoints in tests\n\nThis makes it easy to specify eactly what endpoint is being\ntested."}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "ee4dd0a205af898ae527941f74e2a2ac88e0ddce", "author": {"user": {"login": "stuartwdouglas", "name": "Stuart Douglas"}}, "url": "https://github.com/quarkusio/quarkus/commit/ee4dd0a205af898ae527941f74e2a2ac88e0ddce", "committedDate": "2020-07-30T22:55:29Z", "message": "Add ability to directly specify endpoints in tests\n\nThis makes it easy to specify eactly what endpoint is being\ntested."}, "afterCommit": {"oid": "44b177aa613e98079a37e9a4d2b30b7427a28b8e", "author": {"user": {"login": "geoand", "name": "Georgios Andrianakis"}}, "url": "https://github.com/quarkusio/quarkus/commit/44b177aa613e98079a37e9a4d2b30b7427a28b8e", "committedDate": "2020-07-31T01:34:03Z", "message": "Add Reactive Routes support to @TestHTTPEndpoint"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "fddd2e1e89230e46a49724312f8c2f7c144554ee", "author": {"user": {"login": "geoand", "name": "Georgios Andrianakis"}}, "url": "https://github.com/quarkusio/quarkus/commit/fddd2e1e89230e46a49724312f8c2f7c144554ee", "committedDate": "2020-07-31T01:59:39Z", "message": "Add Reactive Routes support to @TestHTTPEndpoint"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "44b177aa613e98079a37e9a4d2b30b7427a28b8e", "author": {"user": {"login": "geoand", "name": "Georgios Andrianakis"}}, "url": "https://github.com/quarkusio/quarkus/commit/44b177aa613e98079a37e9a4d2b30b7427a28b8e", "committedDate": "2020-07-31T01:34:03Z", "message": "Add Reactive Routes support to @TestHTTPEndpoint"}, "afterCommit": {"oid": "fddd2e1e89230e46a49724312f8c2f7c144554ee", "author": {"user": {"login": "geoand", "name": "Georgios Andrianakis"}}, "url": "https://github.com/quarkusio/quarkus/commit/fddd2e1e89230e46a49724312f8c2f7c144554ee", "committedDate": "2020-07-31T01:59:39Z", "message": "Add Reactive Routes support to @TestHTTPEndpoint"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1029, "cost": 1, "resetAt": "2021-11-01T16:37:27Z"}}}