{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0MzkyMzkzODk1", "number": 8082, "reviewThreads": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yM1QxNDoyOToyMFrODqZvPw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yM1QxNzoyMjozNVrODqeitg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjQ1Nzg4NDc5OnYy", "diffSide": "RIGHT", "path": "extensions/security/runtime/src/main/java/io/quarkus/security/runtime/interceptor/check/RolesAllowedCheck.java", "isResolved": false, "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yM1QxNDoyOToyMFrOF6H_EA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yM1QxNDo1MDozNlrOF6I9kw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NjQ5MjU2MA==", "bodyText": "So do we support *?\nIf it's what we documented before, we should probably support it.", "url": "https://github.com/quarkusio/quarkus/pull/8082#discussion_r396492560", "createdAt": "2020-03-23T14:29:20Z", "author": {"login": "gsmet"}, "path": "extensions/security/runtime/src/main/java/io/quarkus/security/runtime/interceptor/check/RolesAllowedCheck.java", "diffHunk": "@@ -54,7 +54,7 @@ public void apply(SecurityIdentity identity, Method method, Object[] parameters)\n         Set<String> roles = identity.getRoles();\n         if (roles != null) {\n             for (String role : allowedRoles) {\n-                if (roles.contains(role)) {\n+                if (roles.contains(role) || (\"**\".equals(role) && !identity.isAnonymous())) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "bd04dc7775b0457050371e98c855722ef030d4ed"}, "originalPosition": 5}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NjUwNDQzMg==", "bodyText": "It was in the documentation, but didn't work. ** is what used to work (and still works) on other places (such as isUserInRole), this commit just brings @RolesAllowed on par.", "url": "https://github.com/quarkusio/quarkus/pull/8082#discussion_r396504432", "createdAt": "2020-03-23T14:45:15Z", "author": {"login": "Ladicek"}, "path": "extensions/security/runtime/src/main/java/io/quarkus/security/runtime/interceptor/check/RolesAllowedCheck.java", "diffHunk": "@@ -54,7 +54,7 @@ public void apply(SecurityIdentity identity, Method method, Object[] parameters)\n         Set<String> roles = identity.getRoles();\n         if (roles != null) {\n             for (String role : allowedRoles) {\n-                if (roles.contains(role)) {\n+                if (roles.contains(role) || (\"**\".equals(role) && !identity.isAnonymous())) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NjQ5MjU2MA=="}, "originalCommit": {"oid": "bd04dc7775b0457050371e98c855722ef030d4ed"}, "originalPosition": 5}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NjUwODU2Mw==", "bodyText": "OK, let's have @sberyozkin check that.", "url": "https://github.com/quarkusio/quarkus/pull/8082#discussion_r396508563", "createdAt": "2020-03-23T14:50:36Z", "author": {"login": "gsmet"}, "path": "extensions/security/runtime/src/main/java/io/quarkus/security/runtime/interceptor/check/RolesAllowedCheck.java", "diffHunk": "@@ -54,7 +54,7 @@ public void apply(SecurityIdentity identity, Method method, Object[] parameters)\n         Set<String> roles = identity.getRoles();\n         if (roles != null) {\n             for (String role : allowedRoles) {\n-                if (roles.contains(role)) {\n+                if (roles.contains(role) || (\"**\".equals(role) && !identity.isAnonymous())) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NjQ5MjU2MA=="}, "originalCommit": {"oid": "bd04dc7775b0457050371e98c855722ef030d4ed"}, "originalPosition": 5}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjQ1ODY3MTkwOnYy", "diffSide": "RIGHT", "path": "extensions/security/runtime/src/main/java/io/quarkus/security/runtime/interceptor/check/RolesAllowedCheck.java", "isResolved": false, "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yM1QxNzoyMjozNVrOF6P8xA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yNFQxMDozMzoxM1rOF6qDSw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NjYyMzA0NA==", "bodyText": "@Ladicek That looks fine, but do we also have to tweak smallrye-jwt code somewhere as you said it supports * ?", "url": "https://github.com/quarkusio/quarkus/pull/8082#discussion_r396623044", "createdAt": "2020-03-23T17:22:35Z", "author": {"login": "sberyozkin"}, "path": "extensions/security/runtime/src/main/java/io/quarkus/security/runtime/interceptor/check/RolesAllowedCheck.java", "diffHunk": "@@ -54,7 +54,7 @@ public void apply(SecurityIdentity identity, Method method, Object[] parameters)\n         Set<String> roles = identity.getRoles();\n         if (roles != null) {\n             for (String role : allowedRoles) {\n-                if (roles.contains(role)) {\n+                if (roles.contains(role) || (\"**\".equals(role) && !identity.isAnonymous())) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "bd04dc7775b0457050371e98c855722ef030d4ed"}, "originalPosition": 5}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5Njk2NDE2Mg==", "bodyText": "Yea: https://github.com/smallrye/smallrye-jwt/blob/master/implementation/src/main/java/io/smallrye/jwt/auth/jaxrs/RolesAllowedFilter.java#L45\nI'll submit a PR to SmallRye JWT once I verify that the SmallRye JWT code is actually used. The security stuff in Quarkus is hard to navigate :-)", "url": "https://github.com/quarkusio/quarkus/pull/8082#discussion_r396964162", "createdAt": "2020-03-24T08:07:32Z", "author": {"login": "Ladicek"}, "path": "extensions/security/runtime/src/main/java/io/quarkus/security/runtime/interceptor/check/RolesAllowedCheck.java", "diffHunk": "@@ -54,7 +54,7 @@ public void apply(SecurityIdentity identity, Method method, Object[] parameters)\n         Set<String> roles = identity.getRoles();\n         if (roles != null) {\n             for (String role : allowedRoles) {\n-                if (roles.contains(role)) {\n+                if (roles.contains(role) || (\"**\".equals(role) && !identity.isAnonymous())) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NjYyMzA0NA=="}, "originalCommit": {"oid": "bd04dc7775b0457050371e98c855722ef030d4ed"}, "originalPosition": 5}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NzA1MDY5OQ==", "bodyText": "@Ladicek Cool, thanks for spotting it, that JAX-RS code is not used by quarkus-smallrye-jwt", "url": "https://github.com/quarkusio/quarkus/pull/8082#discussion_r397050699", "createdAt": "2020-03-24T10:33:13Z", "author": {"login": "sberyozkin"}, "path": "extensions/security/runtime/src/main/java/io/quarkus/security/runtime/interceptor/check/RolesAllowedCheck.java", "diffHunk": "@@ -54,7 +54,7 @@ public void apply(SecurityIdentity identity, Method method, Object[] parameters)\n         Set<String> roles = identity.getRoles();\n         if (roles != null) {\n             for (String role : allowedRoles) {\n-                if (roles.contains(role)) {\n+                if (roles.contains(role) || (\"**\".equals(role) && !identity.isAnonymous())) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NjYyMzA0NA=="}, "originalCommit": {"oid": "bd04dc7775b0457050371e98c855722ef030d4ed"}, "originalPosition": 5}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4582, "cost": 1, "resetAt": "2021-11-13T14:23:39Z"}}}