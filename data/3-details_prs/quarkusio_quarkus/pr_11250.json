{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDYzOTUwNDc3", "number": 11250, "title": "Debug info improvements for Mandrel", "bodyText": "Replaces #10759.\nThis PR targets Quarkus 1.8 to avoid last minute changes with Quarkus 1.7 release.\nThird party sources\nAdd third party source jars support.\nThird party jars not downloaded by default, so it requires user to call mvn dependencies:sources or equivalent. Checked with @aloubyansky and we might want to automate this extra step somehow. I'll create a separate issue to track this.\nIf source jars are found, they're put next to the jars in the lib directory. After generating native executable, the source jars are removed, so it has no visible effect. Having the source jars next to the jars means they're automatically detected.\nApplication sources added to the sources cache\nApplication sources are added individually using -H:DebugInfoSourceSearchPath option. They're only added if the directory exists.\nMove the sources cache folder to be under target/sources-cache\nSources cache has been moved to target/sources-cache using the -H:DebugInfoSourceCacheRoot option. This makes sources cache more closely available. gdb should discover these automatically, but it does not seem to work, so better use set directories pointing to them. I'm working with @zakkak to see what's up there.\nGraalVM version and distribution resolution.\nThese changes only work on Mandrel or GraalVM 20.2, so reworked the whole GraalVM version and distribution resolution logic to make this easier to handle. Previous ad-hoc GraalVM version resolution has been been replaced by a type-safe regex based solution. We can now compare versions to enable things only for versions newer than X.\nAdded unit tests to verify that GraalVM versions and distributions are resolved correctly with a diverse set of native-image --version outputs. If there are any issues we can just add other outputs and see what happens.\nOthers\nDebug symbols flag switched from -H:GenerateDebugInfo=1 to -g.", "createdAt": "2020-08-06T10:54:25Z", "url": "https://github.com/quarkusio/quarkus/pull/11250", "merged": true, "mergeCommit": {"oid": "4a68e9eb8ef3a288eb8e2570f83bde22aa9c3c37"}, "closed": true, "closedAt": "2020-08-06T21:41:35Z", "author": {"login": "galderz"}, "timelineItems": {"totalCount": 8, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABc8No0EgBqjM2Mjg1MDEwMTk=", "endCursor": "Y3Vyc29yOnYyOpPPAAABc8W4yygFqTQ2Mjg5NjA4Mg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "9c5827b75b0883a2df65b298850e3b71862e2d24", "author": {"user": {"login": "galderz", "name": "Galder Zamarre\u00f1o"}}, "url": "https://github.com/quarkusio/quarkus/commit/9c5827b75b0883a2df65b298850e3b71862e2d24", "committedDate": "2020-08-06T10:24:02Z", "message": "Debug info improvements #9792\n\n* Add third party source jars support.\n* Third party jars not downloaded by default,\nso it requires user to call `mvn dependencies:sources`\nor equivalent.\n* If source jars are found,\nthey're put next to the jars in the lib directory.\n* After generating native executable,\nthe source jars are removed.\n* Application sources are added individually using\n-H:DebugInfoSourceSearchPath option.\nThey're only added if the directory exists.\n* Debug symbols flag switched\nfrom -H:GenerateDebugInfo=1 to `-g`.\n* Sources cache has been moved to target/sources-cache\nusing the -H:DebugInfoSourceCacheRoot option.\nThis makes sources cache more closely available.\ngdb should discover these automatically,\nbut it does not seem to work,\nso better use `set directories` pointing to them.\n* These changes only work on Mandrel or GraalVM 20.2,\nso reworked the whole GraalVM version and distribution\nresolution logic to make this easier to handle.\n* Previous ad-hoc GraalVM version resolution\nhas been been replaced by a regex solution.\n* Added unit tests to verify that\nGraalVM versions and distributions are resolved correctly\nwith a diverse set of `native-image --version` outputs."}, "afterCommit": {"oid": "f89d6c770ea5e60becf862e6bfdc40eca525ccdf", "author": {"user": {"login": "galderz", "name": "Galder Zamarre\u00f1o"}}, "url": "https://github.com/quarkusio/quarkus/commit/f89d6c770ea5e60becf862e6bfdc40eca525ccdf", "committedDate": "2020-08-06T10:54:43Z", "message": "Debug info improvements #9792\n\n* Add third party source jars support.\n* Third party jars not downloaded by default,\nso it requires user to call `mvn dependencies:sources`\nor equivalent.\n* If source jars are found,\nthey're put next to the jars in the lib directory.\n* After generating native executable,\nthe source jars are removed.\n* Application sources are added individually using\n-H:DebugInfoSourceSearchPath option.\nThey're only added if the directory exists.\n* Debug symbols flag switched\nfrom -H:GenerateDebugInfo=1 to `-g`.\n* Sources cache has been moved to target/sources-cache\nusing the -H:DebugInfoSourceCacheRoot option.\nThis makes sources cache more closely available.\ngdb should discover these automatically,\nbut it does not seem to work,\nso better use `set directories` pointing to them.\n* These changes only work on Mandrel or GraalVM 20.2,\nso reworked the whole GraalVM version and distribution\nresolution logic to make this easier to handle.\n* Previous ad-hoc GraalVM version resolution\nhas been been replaced by a regex solution.\n* Added unit tests to verify that\nGraalVM versions and distributions are resolved correctly\nwith a diverse set of `native-image --version` outputs."}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "f89d6c770ea5e60becf862e6bfdc40eca525ccdf", "author": {"user": {"login": "galderz", "name": "Galder Zamarre\u00f1o"}}, "url": "https://github.com/quarkusio/quarkus/commit/f89d6c770ea5e60becf862e6bfdc40eca525ccdf", "committedDate": "2020-08-06T10:54:43Z", "message": "Debug info improvements #9792\n\n* Add third party source jars support.\n* Third party jars not downloaded by default,\nso it requires user to call `mvn dependencies:sources`\nor equivalent.\n* If source jars are found,\nthey're put next to the jars in the lib directory.\n* After generating native executable,\nthe source jars are removed.\n* Application sources are added individually using\n-H:DebugInfoSourceSearchPath option.\nThey're only added if the directory exists.\n* Debug symbols flag switched\nfrom -H:GenerateDebugInfo=1 to `-g`.\n* Sources cache has been moved to target/sources-cache\nusing the -H:DebugInfoSourceCacheRoot option.\nThis makes sources cache more closely available.\ngdb should discover these automatically,\nbut it does not seem to work,\nso better use `set directories` pointing to them.\n* These changes only work on Mandrel or GraalVM 20.2,\nso reworked the whole GraalVM version and distribution\nresolution logic to make this easier to handle.\n* Previous ad-hoc GraalVM version resolution\nhas been been replaced by a regex solution.\n* Added unit tests to verify that\nGraalVM versions and distributions are resolved correctly\nwith a diverse set of `native-image --version` outputs."}, "afterCommit": {"oid": "edd672e69a1953a084809f85259fbdee78e4ffde", "author": {"user": {"login": "galderz", "name": "Galder Zamarre\u00f1o"}}, "url": "https://github.com/quarkusio/quarkus/commit/edd672e69a1953a084809f85259fbdee78e4ffde", "committedDate": "2020-08-06T10:56:39Z", "message": "Debug info improvements #9792\n\n* Add third party source jars support.\n* Third party jars not downloaded by default,\nso it requires user to call `mvn dependencies:sources`\nor equivalent.\n* If source jars are found,\nthey're put next to the jars in the lib directory.\n* After generating native executable,\nthe source jars are removed.\n* Application sources are added individually using\n-H:DebugInfoSourceSearchPath option.\nThey're only added if the directory exists.\n* Debug symbols flag switched\nfrom -H:GenerateDebugInfo=1 to `-g`.\n* Sources cache has been moved to target/sources-cache\nusing the -H:DebugInfoSourceCacheRoot option.\nThis makes sources cache more closely available.\ngdb should discover these automatically,\nbut it does not seem to work,\nso better use `set directories` pointing to them.\n* These changes only work on Mandrel or GraalVM 20.2,\nso reworked the whole GraalVM version and distribution\nresolution logic to make this easier to handle.\n* Previous ad-hoc GraalVM version resolution\nhas been been replaced by a regex solution.\n* Added unit tests to verify that\nGraalVM versions and distributions are resolved correctly\nwith a diverse set of `native-image --version` outputs."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDYyNjIxNDcw", "url": "https://github.com/quarkusio/quarkus/pull/11250#pullrequestreview-462621470", "createdAt": "2020-08-06T15:18:46Z", "commit": {"oid": "edd672e69a1953a084809f85259fbdee78e4ffde"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0wNlQxNToxODo0N1rOG84QNw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0wNlQxNToxODo0N1rOG84QNw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NjQ4OTM5OQ==", "bodyText": "The pattern is not good enough IMHO. I will push a commit to fix it.", "url": "https://github.com/quarkusio/quarkus/pull/11250#discussion_r466489399", "createdAt": "2020-08-06T15:18:47Z", "author": {"login": "gsmet"}, "path": "core/deployment/src/main/java/io/quarkus/deployment/pkg/steps/NativeImageBuildStep.java", "diffHunk": "@@ -572,4 +646,104 @@ private static void objcopy(String... args) {\n             }\n         }\n     }\n+\n+    protected static final class GraalVM {\n+        static final class Version implements Comparable<Version> {\n+            private static final Pattern PATTERN = Pattern.compile(\n+                    \"GraalVM Version ((1|[1-9][0-9]).([0-3]).[0-9]|\\\\p{XDigit}*)[^(\\n$]*(\\\\(Mandrel Distribution\\\\))?\\\\s*\");", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "edd672e69a1953a084809f85259fbdee78e4ffde"}, "originalPosition": 196}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "6190179febd50d71db17fd80392c67ec3275191c", "author": {"user": {"login": "galderz", "name": "Galder Zamarre\u00f1o"}}, "url": "https://github.com/quarkusio/quarkus/commit/6190179febd50d71db17fd80392c67ec3275191c", "committedDate": "2020-08-06T15:19:23Z", "message": "Debug info improvements #9792\n\n* Add third party source jars support.\n* Third party jars not downloaded by default,\nso it requires user to call `mvn dependencies:sources`\nor equivalent.\n* If source jars are found,\nthey're put next to the jars in the lib directory.\n* After generating native executable,\nthe source jars are removed.\n* Application sources are added individually using\n-H:DebugInfoSourceSearchPath option.\nThey're only added if the directory exists.\n* Debug symbols flag switched\nfrom -H:GenerateDebugInfo=1 to `-g`.\n* Sources cache has been moved to target/sources-cache\nusing the -H:DebugInfoSourceCacheRoot option.\nThis makes sources cache more closely available.\ngdb should discover these automatically,\nbut it does not seem to work,\nso better use `set directories` pointing to them.\n* These changes only work on Mandrel or GraalVM 20.2,\nso reworked the whole GraalVM version and distribution\nresolution logic to make this easier to handle.\n* Previous ad-hoc GraalVM version resolution\nhas been been replaced by a regex solution.\n* Added unit tests to verify that\nGraalVM versions and distributions are resolved correctly\nwith a diverse set of `native-image --version` outputs."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "da44c26ca9f5458a207527b91d8c80ecb234a218", "author": {"user": {"login": "gsmet", "name": "Guillaume Smet"}}, "url": "https://github.com/quarkusio/quarkus/commit/da44c26ca9f5458a207527b91d8c80ecb234a218", "committedDate": "2020-08-06T15:29:36Z", "message": "Fix the GraalVM version regexp"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "edd672e69a1953a084809f85259fbdee78e4ffde", "author": {"user": {"login": "galderz", "name": "Galder Zamarre\u00f1o"}}, "url": "https://github.com/quarkusio/quarkus/commit/edd672e69a1953a084809f85259fbdee78e4ffde", "committedDate": "2020-08-06T10:56:39Z", "message": "Debug info improvements #9792\n\n* Add third party source jars support.\n* Third party jars not downloaded by default,\nso it requires user to call `mvn dependencies:sources`\nor equivalent.\n* If source jars are found,\nthey're put next to the jars in the lib directory.\n* After generating native executable,\nthe source jars are removed.\n* Application sources are added individually using\n-H:DebugInfoSourceSearchPath option.\nThey're only added if the directory exists.\n* Debug symbols flag switched\nfrom -H:GenerateDebugInfo=1 to `-g`.\n* Sources cache has been moved to target/sources-cache\nusing the -H:DebugInfoSourceCacheRoot option.\nThis makes sources cache more closely available.\ngdb should discover these automatically,\nbut it does not seem to work,\nso better use `set directories` pointing to them.\n* These changes only work on Mandrel or GraalVM 20.2,\nso reworked the whole GraalVM version and distribution\nresolution logic to make this easier to handle.\n* Previous ad-hoc GraalVM version resolution\nhas been been replaced by a regex solution.\n* Added unit tests to verify that\nGraalVM versions and distributions are resolved correctly\nwith a diverse set of `native-image --version` outputs."}, "afterCommit": {"oid": "da44c26ca9f5458a207527b91d8c80ecb234a218", "author": {"user": {"login": "gsmet", "name": "Guillaume Smet"}}, "url": "https://github.com/quarkusio/quarkus/commit/da44c26ca9f5458a207527b91d8c80ecb234a218", "committedDate": "2020-08-06T15:29:36Z", "message": "Fix the GraalVM version regexp"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b08e71429d4959e6ab5f1d2288b643527092da10", "author": {"user": {"login": "gsmet", "name": "Guillaume Smet"}}, "url": "https://github.com/quarkusio/quarkus/commit/b08e71429d4959e6ab5f1d2288b643527092da10", "committedDate": "2020-08-06T16:53:41Z", "message": "Get back to displaying the full version in log messages\n\nThe toString() is really not user-friendly."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDYyODk2MDgy", "url": "https://github.com/quarkusio/quarkus/pull/11250#pullrequestreview-462896082", "createdAt": "2020-08-06T21:41:29Z", "commit": {"oid": "b08e71429d4959e6ab5f1d2288b643527092da10"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 928, "cost": 1, "resetAt": "2021-11-01T16:37:27Z"}}}