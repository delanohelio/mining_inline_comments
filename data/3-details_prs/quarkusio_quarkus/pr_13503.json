{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTI4MjgzMzc2", "number": 13503, "title": "Runtime classloader micro optimisations", "bodyText": "Some small polishing to the RuntimeClassLoader. Mostly a follow-up to #13383 as I was having a look.", "createdAt": "2020-11-26T22:19:50Z", "url": "https://github.com/quarkusio/quarkus/pull/13503", "merged": true, "mergeCommit": {"oid": "a2a8e47f264b2b59bd78ea363bcea2b40d748125"}, "closed": true, "closedAt": "2020-11-27T15:07:33Z", "author": {"login": "Sanne"}, "timelineItems": {"totalCount": 8, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdghZm7gFqTUzOTcyOTY1Mg==", "endCursor": "Y3Vyc29yOnYyOpPPAAABdglLmPAFqTUzOTg3ODc4Mw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTM5NzI5NjUy", "url": "https://github.com/quarkusio/quarkus/pull/13503#pullrequestreview-539729652", "createdAt": "2020-11-27T06:17:12Z", "commit": {"oid": "e6942e4afd58c6f542c1621fa067706938b8f25f"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0yN1QwNjoxNzoxMlrOH6yLBg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0yN1QwNjoxNzoxMlrOH6yLBg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMTQwMTQ3OA==", "bodyText": "Are we sure about using a method reference here?", "url": "https://github.com/quarkusio/quarkus/pull/13503#discussion_r531401478", "createdAt": "2020-11-27T06:17:12Z", "author": {"login": "geoand"}, "path": "independent-projects/bootstrap/runner/src/main/java/io/quarkus/bootstrap/runner/RunnerClassLoader.java", "diffHunk": "@@ -73,33 +71,35 @@\n             if (loaded != null) {\n                 return loaded;\n             }\n-            ClassLoadingResource[] resources;\n+            final ClassLoadingResource[] resources;\n             if (packageName == null) {\n                 resources = resourceDirectoryMap.get(\"\");\n             } else {\n-                String dirName = packageName.replace(\".\", \"/\");\n+                String dirName = packageName.replace('.', '/');\n                 resources = resourceDirectoryMap.get(dirName);\n             }\n             if (resources != null) {\n-                String classResource = name.replace(\".\", \"/\") + \".class\";\n+                String classResource = name.replace('.', '/') + \".class\";\n                 for (ClassLoadingResource resource : resources) {\n                     byte[] data = resource.getResourceData(classResource);\n                     if (data == null) {\n                         continue;\n                     }\n                     definePackage(packageName, resources);\n                     return defineClass(name, data, 0, data.length,\n-                            protectionDomains.computeIfAbsent(resource, new Function<ClassLoadingResource, ProtectionDomain>() {\n-                                @Override\n-                                public ProtectionDomain apply(ClassLoadingResource ce) {\n-                                    return ce.getProtectionDomain(RunnerClassLoader.this);\n-                                }\n-                            }));\n+                            getProtectionDomain(resource));\n                 }\n             }\n         }\n         return getParent().loadClass(name);\n+    }\n+\n+    private ProtectionDomain getProtectionDomain(ClassLoadingResource resource) {\n+        return protectionDomains.computeIfAbsent(resource, this::extractProtectionDomainFromClassLoadingResource);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e6942e4afd58c6f542c1621fa067706938b8f25f"}, "originalPosition": 58}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "611ee15a04c97a939739bfc75c9d31969c231448", "author": {"user": {"login": "Sanne", "name": "Sanne Grinovero"}}, "url": "https://github.com/quarkusio/quarkus/commit/611ee15a04c97a939739bfc75c9d31969c231448", "committedDate": "2020-11-27T10:34:37Z", "message": "Micro-optimise sanitizeName(String)"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "7c916e9b05be2c7a822241918e7d0ef97be89516", "author": {"user": {"login": "Sanne", "name": "Sanne Grinovero"}}, "url": "https://github.com/quarkusio/quarkus/commit/7c916e9b05be2c7a822241918e7d0ef97be89516", "committedDate": "2020-11-27T10:34:37Z", "message": "Character replacements in String are better off by passing a char"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "9890b211373c2be3800a443934baef63cabb3a4f", "author": {"user": {"login": "Sanne", "name": "Sanne Grinovero"}}, "url": "https://github.com/quarkusio/quarkus/commit/9890b211373c2be3800a443934baef63cabb3a4f", "committedDate": "2020-11-27T10:34:37Z", "message": "Adding a toString method to JarResource greatly helps debugging"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e39fd4d6f4e9fe1f440d1b0abaaaca933c75c82d", "author": {"user": {"login": "Sanne", "name": "Sanne Grinovero"}}, "url": "https://github.com/quarkusio/quarkus/commit/e39fd4d6f4e9fe1f440d1b0abaaaca933c75c82d", "committedDate": "2020-11-27T10:35:23Z", "message": "Remove never thrown IOException from signature"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ebb85186e7be2c443f18f3d84c64268707c51a49", "author": {"user": {"login": "Sanne", "name": "Sanne Grinovero"}}, "url": "https://github.com/quarkusio/quarkus/commit/ebb85186e7be2c443f18f3d84c64268707c51a49", "committedDate": "2020-11-27T10:35:23Z", "message": "Make RunnerClassLoader final"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "e6942e4afd58c6f542c1621fa067706938b8f25f", "author": {"user": {"login": "Sanne", "name": "Sanne Grinovero"}}, "url": "https://github.com/quarkusio/quarkus/commit/e6942e4afd58c6f542c1621fa067706938b8f25f", "committedDate": "2020-11-26T22:12:14Z", "message": "Make RunnerClassLoader final"}, "afterCommit": {"oid": "ebb85186e7be2c443f18f3d84c64268707c51a49", "author": {"user": {"login": "Sanne", "name": "Sanne Grinovero"}}, "url": "https://github.com/quarkusio/quarkus/commit/ebb85186e7be2c443f18f3d84c64268707c51a49", "committedDate": "2020-11-27T10:35:23Z", "message": "Make RunnerClassLoader final"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTM5ODc4Nzgz", "url": "https://github.com/quarkusio/quarkus/pull/13503#pullrequestreview-539878783", "createdAt": "2020-11-27T10:41:58Z", "commit": {"oid": "ebb85186e7be2c443f18f3d84c64268707c51a49"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1312, "cost": 1, "resetAt": "2021-11-01T16:37:27Z"}}}