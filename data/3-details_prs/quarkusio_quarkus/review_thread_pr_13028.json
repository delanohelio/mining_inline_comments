{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTEyODk0NTM4", "number": 13028, "reviewThreads": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0zMFQxMDoyMzoyMlrOEzuvMA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0zMFQxNDoyNzoyM1rOEz0R9A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzIyNjc4NTc2OnYy", "diffSide": "RIGHT", "path": "independent-projects/tools/platform-descriptor-resolver-json/src/main/java/io/quarkus/platform/descriptor/resolver/json/QuarkusJsonPlatformDescriptorResolver.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0zMFQxMDoyMzoyMlrOHrI_xQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0zMFQxNDoxODoxMVrOHrRGqQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNDk5ODIxMw==", "bodyText": "@gastaldi this PR changes the coordinates of the JSON descriptor and will require adjustments in the extension catalog project. To hopefully make it easier to maintain, I introduced this method and a couple interfaces right above this class. This specific method returns a JSON resolver that will try resolving the JSON for the BOM coordinates using the legacy and the new JSON coordinates conventions.", "url": "https://github.com/quarkusio/quarkus/pull/13028#discussion_r514998213", "createdAt": "2020-10-30T10:23:22Z", "author": {"login": "aloubyansky"}, "path": "independent-projects/tools/platform-descriptor-resolver-json/src/main/java/io/quarkus/platform/descriptor/resolver/json/QuarkusJsonPlatformDescriptorResolver.java", "diffHunk": "@@ -58,21 +59,43 @@\n     public static final String PROP_PLATFORM_JSON_VERSION = \"quarkus.platform.json.version\";\n     public static final String PROP_PLATFORM_JSON_VERSION_RANGE = \"quarkus.platform.json.version-range\";\n \n+    private static final JsonDescriptorResolver jsonDescriptorResolver;\n+    static {\n+        jsonDescriptorResolver = new ChainedJsonDescriptorResolver(\n+                ((bomGroupId, bomArtifactId, bomVersion, jsonResolver, log) -> jsonResolver.resolveArtifact(bomGroupId,\n+                        bomArtifactId + \"-\" + BootstrapConstants.PLATFORM_DESCRIPTOR_ARTIFACT_ID_SUFFIX, bomVersion, \"json\",\n+                        bomVersion, log)),\n+                ((bomGroupId, bomArtifactId, bomVersion, jsonResolver, log) -> jsonResolver.resolveArtifact(bomGroupId,\n+                        bomArtifactId, null, \"json\", bomVersion, log)),\n+                ((bomGroupId, bomArtifactId, bomVersion, jsonResolver, log) -> jsonResolver.resolveArtifact(bomGroupId,\n+                        bomArtifactId + \"-descriptor-json\", null, \"json\", bomVersion, log)));\n+    }\n+\n+    public static JsonDescriptorResolver jsonDescriptorResolver() {\n+        return jsonDescriptorResolver;\n+    }", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "4b7e1a2b8fc46543753d2cccc8b7f31dda660446"}, "originalPosition": 26}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNTEzMTA0OQ==", "bodyText": "@aloubyansky No problem, it's just a matter of changing the platforms.json to the new GAV", "url": "https://github.com/quarkusio/quarkus/pull/13028#discussion_r515131049", "createdAt": "2020-10-30T14:18:11Z", "author": {"login": "gastaldi"}, "path": "independent-projects/tools/platform-descriptor-resolver-json/src/main/java/io/quarkus/platform/descriptor/resolver/json/QuarkusJsonPlatformDescriptorResolver.java", "diffHunk": "@@ -58,21 +59,43 @@\n     public static final String PROP_PLATFORM_JSON_VERSION = \"quarkus.platform.json.version\";\n     public static final String PROP_PLATFORM_JSON_VERSION_RANGE = \"quarkus.platform.json.version-range\";\n \n+    private static final JsonDescriptorResolver jsonDescriptorResolver;\n+    static {\n+        jsonDescriptorResolver = new ChainedJsonDescriptorResolver(\n+                ((bomGroupId, bomArtifactId, bomVersion, jsonResolver, log) -> jsonResolver.resolveArtifact(bomGroupId,\n+                        bomArtifactId + \"-\" + BootstrapConstants.PLATFORM_DESCRIPTOR_ARTIFACT_ID_SUFFIX, bomVersion, \"json\",\n+                        bomVersion, log)),\n+                ((bomGroupId, bomArtifactId, bomVersion, jsonResolver, log) -> jsonResolver.resolveArtifact(bomGroupId,\n+                        bomArtifactId, null, \"json\", bomVersion, log)),\n+                ((bomGroupId, bomArtifactId, bomVersion, jsonResolver, log) -> jsonResolver.resolveArtifact(bomGroupId,\n+                        bomArtifactId + \"-descriptor-json\", null, \"json\", bomVersion, log)));\n+    }\n+\n+    public static JsonDescriptorResolver jsonDescriptorResolver() {\n+        return jsonDescriptorResolver;\n+    }", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNDk5ODIxMw=="}, "originalCommit": {"oid": "4b7e1a2b8fc46543753d2cccc8b7f31dda660446"}, "originalPosition": 26}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzIyNzY5MTE5OnYy", "diffSide": "RIGHT", "path": "devtools/gradle/src/main/java/io/quarkus/gradle/tasks/QuarkusListExtensions.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0zMFQxNDoyNjo0NFrOHrRdwQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0zMFQxNDoyNjo0NFrOHrRdwQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNTEzNjk2MQ==", "bodyText": "Excellent! \ud83d\udc4f", "url": "https://github.com/quarkusio/quarkus/pull/13028#discussion_r515136961", "createdAt": "2020-10-30T14:26:44Z", "author": {"login": "gastaldi"}, "path": "devtools/gradle/src/main/java/io/quarkus/gradle/tasks/QuarkusListExtensions.java", "diffHunk": "@@ -96,7 +97,11 @@ public QuarkusListExtensions() {\n     @TaskAction\n     public void listExtensions() {\n         try {\n-            ListExtensions listExtensions = new ListExtensions(getQuarkusProject())\n+            final QuarkusProject quarkusProject = getQuarkusProject();\n+            getLogger().info(\"Quarkus platform \" + quarkusProject.getPlatformDescriptor().getBomGroupId() + \":\"", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d8db99b335021b178ce3dfe3d5d01d41b9b60532"}, "originalPosition": 14}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzIyNzY5Mzk2OnYy", "diffSide": "RIGHT", "path": "devtools/gradle/src/main/java/io/quarkus/gradle/tasks/QuarkusPlatformTask.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0zMFQxNDoyNzoyM1rOHrRfdQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0zMFQxNDoyNzoyM1rOHrRfdQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNTEzNzM5Nw==", "bodyText": "This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters. Learn more about bidirectional Unicode characters\n\n\n  \n\n\n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                        throw new GradleException(\"Failed to determine Quarkus platform for the project\");\n          \n          \n            \n                        throw new GradleException(\"Failed to determine the Quarkus platform for the project\");", "url": "https://github.com/quarkusio/quarkus/pull/13028#discussion_r515137397", "createdAt": "2020-10-30T14:27:23Z", "author": {"login": "gastaldi"}, "path": "devtools/gradle/src/main/java/io/quarkus/gradle/tasks/QuarkusPlatformTask.java", "diffHunk": "@@ -30,48 +39,148 @@\n \n     protected QuarkusPlatformDescriptor platformDescriptor() {\n \n+        final List<Dependency> boms = boms();\n+        if (boms.isEmpty()) {\n+            throw new GradleException(\"No platforms detected in the project\");\n+        }\n+\n         final QuarkusJsonPlatformDescriptorResolver platformResolver = QuarkusJsonPlatformDescriptorResolver.newInstance()\n                 .setArtifactResolver(extension().getAppModelResolver())\n                 .setMessageWriter(new GradleMessageWriter(getProject().getLogger()));\n \n-        List<QuarkusPlatformDescriptor> platforms = new ArrayList<>(2);\n+        final QuarkusPlatformDescriptor platform = resolvePlatformDescriptor(platformResolver, getProject(), boms);\n+        if (platform != null) {\n+            return platform;\n+        }\n+\n+        final List<QuarkusPlatformDescriptor> platforms = resolveLegacyPlatforms(platformResolver, boms);\n+        if (platforms.isEmpty()) {\n+            throw new GradleException(\"Failed to determine Quarkus platform for the project\");", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d8db99b335021b178ce3dfe3d5d01d41b9b60532"}, "originalPosition": 46}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4120, "cost": 1, "resetAt": "2021-11-13T14:23:39Z"}}}