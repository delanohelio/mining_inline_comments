{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTMyNDExNzcw", "number": 13694, "title": "Allow injection of Session/SessionFactory ", "bodyText": "Currently, @Inject Session and @Inject SessionFactory don't work in Quarkus; only @Inject EntityManager and @Inject EntityManagerFactory do.\nThis patches solves this problem.\nRelated note: ForwardingEntityManager and TransactionScopedEntityManager were quite large to begin with, and ForwardingSession and TransactionScopedSession even more so, because Session has many methods.\nI wonder if we should use proxies rather than implementing these by hand? I think that would be a simpler solution to implementing these \"forwarding\" sessions. I would do it in a follow-up PR, of course.", "createdAt": "2020-12-04T09:38:18Z", "url": "https://github.com/quarkusio/quarkus/pull/13694", "merged": true, "mergeCommit": {"oid": "7dac2765ad565dd05aef0c85fb2f73ed20c712d0"}, "closed": true, "closedAt": "2020-12-04T14:43:55Z", "author": {"login": "yrodiere"}, "timelineItems": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdizFqMAH2gAyNTMyNDExNzcwOjdhMjc1ZTgxNTI0ZTM0NzczOGIyYjIyNjQxMjZlYzkyZmE3NjI2MTU=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdi0iXyAFqTU0NDgwMDQ1Mg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "7a275e81524e347738b2b2264126ec92fa762615", "author": {"user": {"login": "yrodiere", "name": "Yoann Rodi\u00e8re"}}, "url": "https://github.com/quarkusio/quarkus/commit/7a275e81524e347738b2b2264126ec92fa762615", "committedDate": "2020-12-04T08:02:00Z", "message": "Dedicated tests for EntityManager injection with a single PU\n\nSigned-off-by: Yoann Rodi\u00e8re <yoann@hibernate.org>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "1aec4e32af10cc90a54db1f104268694a2270043", "author": {"user": {"login": "yrodiere", "name": "Yoann Rodi\u00e8re"}}, "url": "https://github.com/quarkusio/quarkus/commit/1aec4e32af10cc90a54db1f104268694a2270043", "committedDate": "2020-12-04T08:02:06Z", "message": "Allow injection of Session/SessionFactory\n\nSigned-off-by: Yoann Rodi\u00e8re <yoann@hibernate.org>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "219c4505dba96fdf3e33c53dca3562854a171a6f", "author": {"user": {"login": "yrodiere", "name": "Yoann Rodi\u00e8re"}}, "url": "https://github.com/quarkusio/quarkus/commit/219c4505dba96fdf3e33c53dca3562854a171a6f", "committedDate": "2020-12-04T08:02:06Z", "message": "Test injection of a Hibernate ORM Session\n\nSigned-off-by: Yoann Rodi\u00e8re <yoann@hibernate.org>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTQ0Nzk4ODk1", "url": "https://github.com/quarkusio/quarkus/pull/13694#pullrequestreview-544798895", "createdAt": "2020-12-04T09:41:16Z", "commit": {"oid": "219c4505dba96fdf3e33c53dca3562854a171a6f"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0wNFQwOTo0MToxN1rOH_IxGA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0wNFQwOTo0MToxN1rOH_IxGA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNTk2NTk3Ng==", "bodyText": "ok that's interesting. Didn't expect to be able to combine PersistenceUnit on Session, but it's nice.", "url": "https://github.com/quarkusio/quarkus/pull/13694#discussion_r535965976", "createdAt": "2020-12-04T09:41:17Z", "author": {"login": "Sanne"}, "path": "extensions/hibernate-orm/deployment/src/test/java/io/quarkus/hibernate/orm/multiplepersistenceunits/MultiplePersistenceUnitsCdiSessionTest.java", "diffHunk": "@@ -0,0 +1,79 @@\n+package io.quarkus.hibernate.orm.multiplepersistenceunits;\n+\n+import static org.assertj.core.api.Assertions.assertThatThrownBy;\n+import static org.junit.jupiter.api.Assertions.assertEquals;\n+\n+import javax.inject.Inject;\n+import javax.transaction.Transactional;\n+\n+import org.hibernate.Session;\n+import org.jboss.shrinkwrap.api.ShrinkWrap;\n+import org.jboss.shrinkwrap.api.spec.JavaArchive;\n+import org.junit.jupiter.api.Test;\n+import org.junit.jupiter.api.extension.RegisterExtension;\n+\n+import io.quarkus.hibernate.orm.PersistenceUnit;\n+import io.quarkus.hibernate.orm.multiplepersistenceunits.model.config.DefaultEntity;\n+import io.quarkus.hibernate.orm.multiplepersistenceunits.model.config.inventory.Plane;\n+import io.quarkus.hibernate.orm.multiplepersistenceunits.model.config.user.User;\n+import io.quarkus.test.QuarkusUnitTest;\n+\n+public class MultiplePersistenceUnitsCdiSessionTest {\n+\n+    @RegisterExtension\n+    static QuarkusUnitTest runner = new QuarkusUnitTest()\n+            .setArchiveProducer(() -> ShrinkWrap.create(JavaArchive.class)\n+                    .addClass(DefaultEntity.class)\n+                    .addClass(User.class)\n+                    .addClass(Plane.class)\n+                    .addAsResource(\"application-multiple-persistence-units.properties\", \"application.properties\"));\n+\n+    @Inject\n+    Session defaultSession;\n+\n+    @Inject\n+    @PersistenceUnit(\"users\")\n+    Session usersSession;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "219c4505dba96fdf3e33c53dca3562854a171a6f"}, "originalPosition": 36}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTQ0ODAwNDUy", "url": "https://github.com/quarkusio/quarkus/pull/13694#pullrequestreview-544800452", "createdAt": "2020-12-04T09:43:16Z", "commit": {"oid": "219c4505dba96fdf3e33c53dca3562854a171a6f"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1234, "cost": 1, "resetAt": "2021-11-01T16:37:27Z"}}}