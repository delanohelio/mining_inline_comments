{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDMyODExMTIw", "number": 9933, "title": "Add ability to run tests with different config profiles", "bodyText": "I don't know if 'profile' is the correct word, as it is not really directly related to the existing profile stuff.\nThere is also lots more we can do with this, including per profile test resources, per profile TestContainer support, and probably more.", "createdAt": "2020-06-11T03:09:29Z", "url": "https://github.com/quarkusio/quarkus/pull/9933", "merged": true, "mergeCommit": {"oid": "a6c68b28bba866cabe37f986867eb31d8642710b"}, "closed": true, "closedAt": "2020-06-16T05:03:31Z", "author": {"login": "stuartwdouglas"}, "timelineItems": {"totalCount": 10, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcqFiPzABqjM0MzIyNzUzMTc=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcvBGrFgFqTQzODIwMjY3Nw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "0501a5daad7c26344e992a6fc038645777eefc44", "author": {"user": {"login": "stuartwdouglas", "name": "Stuart Douglas"}}, "url": "https://github.com/quarkusio/quarkus/commit/0501a5daad7c26344e992a6fc038645777eefc44", "committedDate": "2020-06-11T03:08:25Z", "message": "Add ability to run tests with different config profiles"}, "afterCommit": {"oid": "8a18bad995745e2e2d1a47064f67721d0ca05fe1", "author": {"user": {"login": "stuartwdouglas", "name": "Stuart Douglas"}}, "url": "https://github.com/quarkusio/quarkus/commit/8a18bad995745e2e2d1a47064f67721d0ca05fe1", "committedDate": "2020-06-11T03:17:32Z", "message": "Add ability to run tests with different config profiles"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDI4NjEyNjc5", "url": "https://github.com/quarkusio/quarkus/pull/9933#pullrequestreview-428612679", "createdAt": "2020-06-11T05:59:30Z", "commit": {"oid": "8a18bad995745e2e2d1a47064f67721d0ca05fe1"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xMVQwNTo1OTozMVrOGiPhpg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xMVQwNTo1OTozMVrOGiPhpg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzODU1OTE0Mg==", "bodyText": "Perhaps this should be called TestProfile?", "url": "https://github.com/quarkusio/quarkus/pull/9933#discussion_r438559142", "createdAt": "2020-06-11T05:59:31Z", "author": {"login": "geoand"}, "path": "test-framework/junit5/src/main/java/io/quarkus/test/junit/WithProfile.java", "diffHunk": "@@ -0,0 +1,31 @@\n+package io.quarkus.test.junit;\n+\n+import java.lang.annotation.ElementType;\n+import java.lang.annotation.Retention;\n+import java.lang.annotation.RetentionPolicy;\n+import java.lang.annotation.Target;\n+\n+/**\n+ * Defines a 'test profile'. Tests run under a test profile\n+ * will have different configuration options to other tests.\n+ *\n+ * Due to the global nature of Quarkus if a previous test was\n+ * run under a different profile then Quarkus will need to be\n+ * restarted when the profile changes. Unfortunately there\n+ * is currently no way to order tests based on profile, however\n+ * this can be done manually by running tests in alphabetical\n+ * order and putting all tests with the same profile in the same\n+ * package.\n+ */\n+@Retention(RetentionPolicy.RUNTIME)\n+@Target(ElementType.TYPE)\n+public @interface WithProfile {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "8a18bad995745e2e2d1a47064f67721d0ca05fe1"}, "originalPosition": 22}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDI4NjEzMDA0", "url": "https://github.com/quarkusio/quarkus/pull/9933#pullrequestreview-428613004", "createdAt": "2020-06-11T06:00:19Z", "commit": {"oid": "8a18bad995745e2e2d1a47064f67721d0ca05fe1"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xMVQwNjowMDoxOVrOGiPimA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xMVQwNjowMDoxOVrOGiPimA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzODU1OTM4NA==", "bodyText": "I love the idea of having all per-test configuration under one class, really simplifies things both for users and for us :)", "url": "https://github.com/quarkusio/quarkus/pull/9933#discussion_r438559384", "createdAt": "2020-06-11T06:00:19Z", "author": {"login": "geoand"}, "path": "test-framework/junit5/src/main/java/io/quarkus/test/junit/QuarkusTestProfile.java", "diffHunk": "@@ -0,0 +1,42 @@\n+package io.quarkus.test.junit;\n+\n+import java.util.Collections;\n+import java.util.Map;\n+import java.util.Set;\n+\n+/**\n+ * Defines a 'test profile'. Tests run under a test profile\n+ * will have different configuration options to other tests.\n+ *\n+ */\n+public interface QuarkusTestProfile {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "8a18bad995745e2e2d1a47064f67721d0ca05fe1"}, "originalPosition": 12}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "8a18bad995745e2e2d1a47064f67721d0ca05fe1", "author": {"user": {"login": "stuartwdouglas", "name": "Stuart Douglas"}}, "url": "https://github.com/quarkusio/quarkus/commit/8a18bad995745e2e2d1a47064f67721d0ca05fe1", "committedDate": "2020-06-11T03:17:32Z", "message": "Add ability to run tests with different config profiles"}, "afterCommit": {"oid": "a2ff59a02b47549841a81a5572508a13eb5e2e58", "author": {"user": {"login": "stuartwdouglas", "name": "Stuart Douglas"}}, "url": "https://github.com/quarkusio/quarkus/commit/a2ff59a02b47549841a81a5572508a13eb5e2e58", "committedDate": "2020-06-15T03:55:26Z", "message": "Add ability to run tests with different config profiles"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDMwMzEzNTgx", "url": "https://github.com/quarkusio/quarkus/pull/9933#pullrequestreview-430313581", "createdAt": "2020-06-15T04:22:50Z", "commit": {"oid": "a2ff59a02b47549841a81a5572508a13eb5e2e58"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "a2ff59a02b47549841a81a5572508a13eb5e2e58", "author": {"user": {"login": "stuartwdouglas", "name": "Stuart Douglas"}}, "url": "https://github.com/quarkusio/quarkus/commit/a2ff59a02b47549841a81a5572508a13eb5e2e58", "committedDate": "2020-06-15T03:55:26Z", "message": "Add ability to run tests with different config profiles"}, "afterCommit": {"oid": "f0eabb050b1325624bac9858cac3f147ade989cc", "author": {"user": {"login": "stuartwdouglas", "name": "Stuart Douglas"}}, "url": "https://github.com/quarkusio/quarkus/commit/f0eabb050b1325624bac9858cac3f147ade989cc", "committedDate": "2020-06-15T04:43:39Z", "message": "Add ability to run tests with different config profiles"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "2f7b40c343c81c61212c3497b6594f3b68d29feb", "author": {"user": {"login": "stuartwdouglas", "name": "Stuart Douglas"}}, "url": "https://github.com/quarkusio/quarkus/commit/2f7b40c343c81c61212c3497b6594f3b68d29feb", "committedDate": "2020-06-15T04:44:50Z", "message": "Add ability to run tests with different config profiles"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "f0eabb050b1325624bac9858cac3f147ade989cc", "author": {"user": {"login": "stuartwdouglas", "name": "Stuart Douglas"}}, "url": "https://github.com/quarkusio/quarkus/commit/f0eabb050b1325624bac9858cac3f147ade989cc", "committedDate": "2020-06-15T04:43:39Z", "message": "Add ability to run tests with different config profiles"}, "afterCommit": {"oid": "2f7b40c343c81c61212c3497b6594f3b68d29feb", "author": {"user": {"login": "stuartwdouglas", "name": "Stuart Douglas"}}, "url": "https://github.com/quarkusio/quarkus/commit/2f7b40c343c81c61212c3497b6594f3b68d29feb", "committedDate": "2020-06-15T04:44:50Z", "message": "Add ability to run tests with different config profiles"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDMxMjgwMDQx", "url": "https://github.com/quarkusio/quarkus/pull/9933#pullrequestreview-431280041", "createdAt": "2020-06-16T08:34:07Z", "commit": {"oid": "2f7b40c343c81c61212c3497b6594f3b68d29feb"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xNlQwODozNDowN1rOGkQ_WA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xNlQwODozNDowN1rOGkQ_WA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MDY4MDI4MA==", "bodyText": "FYI there is also quarkus.arc.exclude-types that allows you to exclude types from discovery, i.e. ignore the specified types. And it hase the same syntax as selected alternatives: https://github.com/quarkusio/quarkus/blob/master/extensions/arc/deployment/src/main/java/io/quarkus/arc/deployment/ArcConfig.java#L99-L113", "url": "https://github.com/quarkusio/quarkus/pull/9933#discussion_r440680280", "createdAt": "2020-06-16T08:34:07Z", "author": {"login": "mkouba"}, "path": "test-framework/junit5/src/main/java/io/quarkus/test/junit/QuarkusTestExtension.java", "diffHunk": "@@ -114,10 +121,38 @@ private ExtensionState doJavaStart(ExtensionContext context) throws Throwable {\n                 }\n             }\n             originalCl = Thread.currentThread().getContextClassLoader();\n+            Map<String, String> sysPropRestore = new HashMap<>();\n+            sysPropRestore.put(ProfileManager.QUARKUS_TEST_PROFILE_PROP,\n+                    System.getProperty(ProfileManager.QUARKUS_TEST_PROFILE_PROP));\n \n             final QuarkusBootstrap.Builder runnerBuilder = QuarkusBootstrap.builder()\n                     .setIsolateDeployment(true)\n                     .setMode(QuarkusBootstrap.Mode.TEST);\n+            if (profile != null) {\n+                QuarkusTestProfile profileInstance = profile.newInstance();\n+                Map<String, String> additional = new HashMap<>(profileInstance.getConfigOverrides());\n+                if (!profileInstance.getEnabledAlternatives().isEmpty()) {\n+                    additional.put(\"quarkus.arc.selected-alternatives\", profileInstance.getEnabledAlternatives().stream()", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "2f7b40c343c81c61212c3497b6594f3b68d29feb"}, "originalPosition": 53}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDM4MjAyNjc3", "url": "https://github.com/quarkusio/quarkus/pull/9933#pullrequestreview-438202677", "createdAt": "2020-06-26T10:57:43Z", "commit": {"oid": "2f7b40c343c81c61212c3497b6594f3b68d29feb"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yNlQxMDo1Nzo0M1rOGpcqlQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yNlQxMDo1Nzo0M1rOGpcqlQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NjExNDQ1Mw==", "bodyText": "IMHO it would make sense to define this interface as @Inherited in case someone wants to define it on a common superclass.\nFor JUnit 5 tests I am also used to be able to define my own composed annotations with meta-annotations, which I think could also be very useful for Quarkus' test annotations like @QuarkusTestResource and @TestProfile. But for this I will file a separate enhancement request.", "url": "https://github.com/quarkusio/quarkus/pull/9933#discussion_r446114453", "createdAt": "2020-06-26T10:57:43Z", "author": {"login": "knutwannheden"}, "path": "test-framework/junit5/src/main/java/io/quarkus/test/junit/TestProfile.java", "diffHunk": "@@ -0,0 +1,31 @@\n+package io.quarkus.test.junit;\n+\n+import java.lang.annotation.ElementType;\n+import java.lang.annotation.Retention;\n+import java.lang.annotation.RetentionPolicy;\n+import java.lang.annotation.Target;\n+\n+/**\n+ * Defines a 'test profile'. Tests run under a test profile\n+ * will have different configuration options to other tests.\n+ *\n+ * Due to the global nature of Quarkus if a previous test was\n+ * run under a different profile then Quarkus will need to be\n+ * restarted when the profile changes. Unfortunately there\n+ * is currently no way to order tests based on profile, however\n+ * this can be done manually by running tests in alphabetical\n+ * order and putting all tests with the same profile in the same\n+ * package.\n+ */\n+@Retention(RetentionPolicy.RUNTIME)\n+@Target(ElementType.TYPE)\n+public @interface TestProfile {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "2f7b40c343c81c61212c3497b6594f3b68d29feb"}, "originalPosition": 22}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4344, "cost": 1, "resetAt": "2021-11-01T16:37:27Z"}}}