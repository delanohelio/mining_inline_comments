{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDA5MDQyNjA1", "number": 8860, "title": "Generate uber jar for native image source jar if the uberJar option of quarkus-maven-plugin is enabled", "bodyText": "\u2026option of quarkus-maven-plugin is enabled\nfixes #8850", "createdAt": "2020-04-26T08:31:21Z", "url": "https://github.com/quarkusio/quarkus/pull/8860", "merged": true, "mergeCommit": {"oid": "f1f0b119398dc9aabcaef0ed7586322329660139"}, "closed": true, "closedAt": "2020-06-01T01:05:13Z", "author": {"login": "Mobe91"}, "timelineItems": {"totalCount": 7, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABclZmYpAH2gAyNDA5MDQyNjA1OjVlNGM4M2RiNmM4YzRjMWZmOGJkNjNhNWExNDJlM2JiOTdkNmYzZGM=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcm1o5zgFqTQyMTU0ODM2NA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "5e4c83db6c8c4c1ff8bd63a5a142e3bb97d6f3dc", "author": {"user": {"login": "Mobe91", "name": "Moritz Becker"}}, "url": "https://github.com/quarkusio/quarkus/commit/5e4c83db6c8c4c1ff8bd63a5a142e3bb97d6f3dc", "committedDate": "2020-05-27T13:50:50Z", "message": "[#8850] Generate uber jar for native image source jar if the uberJar option of quarkus-maven-plugin is enabled"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "450776c1a3a7496b2181bfaa60f609044687f5f8", "author": {"user": {"login": "Mobe91", "name": "Moritz Becker"}}, "url": "https://github.com/quarkusio/quarkus/commit/450776c1a3a7496b2181bfaa60f609044687f5f8", "committedDate": "2020-05-27T13:50:52Z", "message": "[#8850] Enable uber jar strategy for Windows automatically and add in-code documentation plus logging"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "199c4a9cb7e3aabd3f64ef8591d5d95a94605c28", "author": {"user": {"login": "Mobe91", "name": "Moritz Becker"}}, "url": "https://github.com/quarkusio/quarkus/commit/199c4a9cb7e3aabd3f64ef8591d5d95a94605c28", "committedDate": "2020-04-28T07:14:52Z", "message": "[#8850] Enable uber jar strategy for Windows automatically and add in-code documentation plus logging"}, "afterCommit": {"oid": "450776c1a3a7496b2181bfaa60f609044687f5f8", "author": {"user": {"login": "Mobe91", "name": "Moritz Becker"}}, "url": "https://github.com/quarkusio/quarkus/commit/450776c1a3a7496b2181bfaa60f609044687f5f8", "committedDate": "2020-05-27T13:50:52Z", "message": "[#8850] Enable uber jar strategy for Windows automatically and add in-code documentation plus logging"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDE5NzE1MTU5", "url": "https://github.com/quarkusio/quarkus/pull/8860#pullrequestreview-419715159", "createdAt": "2020-05-28T01:20:10Z", "commit": {"oid": "450776c1a3a7496b2181bfaa60f609044687f5f8"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yOFQwMToyMDoxMFrOGbihhg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yOFQwMToyMDoxMFrOGbihhg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMTUzMDM3NA==", "bodyText": "I think this should only be for windows. We just want one format to build the native image from in general, this is an intermediate state so it should not matter to the user, but having two different formats means more possible things to debug.", "url": "https://github.com/quarkusio/quarkus/pull/8860#discussion_r431530374", "createdAt": "2020-05-28T01:20:10Z", "author": {"login": "stuartwdouglas"}, "path": "core/deployment/src/main/java/io/quarkus/deployment/pkg/steps/JarResultBuildStep.java", "diffHunk": "@@ -593,23 +616,54 @@ public NativeImageSourceJarBuildItem buildNativeImageJar(CurateOutcomeBuildItem\n             List<GeneratedClassBuildItem> generatedClasses,\n             List<GeneratedNativeImageClassBuildItem> nativeImageResources,\n             List<GeneratedResourceBuildItem> generatedResources,\n-            MainClassBuildItem mainClassBuildItem) throws Exception {\n-        Path thinJarDirectory = outputTargetBuildItem.getOutputDirectory()\n+            MainClassBuildItem mainClassBuildItem,\n+            List<UberJarRequiredBuildItem> uberJarRequired) throws Exception {\n+        Path targetDirectory = outputTargetBuildItem.getOutputDirectory()\n                 .resolve(outputTargetBuildItem.getBaseName() + \"-native-image-source-jar\");\n-        IoUtils.recursiveDelete(thinJarDirectory);\n-        Files.createDirectories(thinJarDirectory);\n-        copyJsonConfigFiles(applicationArchivesBuildItem, thinJarDirectory);\n-\n-        Path runnerJar = thinJarDirectory\n-                .resolve(outputTargetBuildItem.getBaseName() + packageConfig.runnerSuffix + \".jar\");\n-        Path libDir = thinJarDirectory.resolve(LIB);\n-        Files.createDirectories(libDir);\n+        IoUtils.recursiveDelete(targetDirectory);\n+        Files.createDirectories(targetDirectory);\n \n         List<GeneratedClassBuildItem> allClasses = new ArrayList<>(generatedClasses);\n         allClasses.addAll(nativeImageResources.stream()\n                 .map((s) -> new GeneratedClassBuildItem(true, s.getName(), s.getClassData()))\n                 .collect(Collectors.toList()));\n \n+        boolean uberJarRequested = !uberJarRequired.isEmpty() || packageConfig.uberJar;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "450776c1a3a7496b2181bfaa60f609044687f5f8"}, "originalPosition": 105}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDE5NzE1MzQ1", "url": "https://github.com/quarkusio/quarkus/pull/8860#pullrequestreview-419715345", "createdAt": "2020-05-28T01:20:45Z", "commit": {"oid": "450776c1a3a7496b2181bfaa60f609044687f5f8"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f86565a5af72090e1ea6e4f19a77595cf400d0eb", "author": {"user": {"login": "Mobe91", "name": "Moritz Becker"}}, "url": "https://github.com/quarkusio/quarkus/commit/f86565a5af72090e1ea6e4f19a77595cf400d0eb", "committedDate": "2020-05-29T12:12:33Z", "message": "[#8850] Change windows logic for uber jar generation"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDIxNTQ4MzY0", "url": "https://github.com/quarkusio/quarkus/pull/8860#pullrequestreview-421548364", "createdAt": "2020-06-01T01:04:52Z", "commit": {"oid": "f86565a5af72090e1ea6e4f19a77595cf400d0eb"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4352, "cost": 1, "resetAt": "2021-11-02T10:47:05Z"}}}