{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDMxNDQwMjcx", "number": 9872, "title": "Block usage of persistence.xml for Hibernate Reactive", "bodyText": "Closes #9859\nIn this PR also reviewed the hibernate reactive config options here: https://github.com/hibernate/hibernate-reactive/blob/master/hibernate-reactive-core/src/main/java/org/hibernate/reactive/provider/Settings.java\nand determined that none of these options needed to be exposed in Quarkus for now because the non-reactive settings we expose are all pretty high-level. However, we might want to expose more low-level config options for hibernate reactive since the user has no other option besides application.properties now. With non-reactive, the user could always define a persistence.xml if they needed to specify some advanced/low-level config options that are not exposed in quarkus conifg.\n@Sanne curious to know your thoughts on this", "createdAt": "2020-06-08T23:00:02Z", "url": "https://github.com/quarkusio/quarkus/pull/9872", "merged": true, "mergeCommit": {"oid": "10f3b66879f8099ef2fd841fc3d957c67fd6076e"}, "closed": true, "closedAt": "2020-06-10T17:25:58Z", "author": {"login": "aguibert"}, "timelineItems": {"totalCount": 9, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcpcfBOABqjM0MjI4NTgyNzQ=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcp9D60AFqTQyODI3NTQ5OQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "36ac099f578dc4b551fa3bfd3be366ed265b50a0", "author": {"user": {"login": "aguibert", "name": "Andrew Guibert"}}, "url": "https://github.com/quarkusio/quarkus/commit/36ac099f578dc4b551fa3bfd3be366ed265b50a0", "committedDate": "2020-06-08T22:55:12Z", "message": "Remove beans.xml from Hibernate Reactive ITs"}, "afterCommit": {"oid": "581d31a6fa34088d68d5e3a6832f730d6ed6532c", "author": {"user": {"login": "aguibert", "name": "Andrew Guibert"}}, "url": "https://github.com/quarkusio/quarkus/commit/581d31a6fa34088d68d5e3a6832f730d6ed6532c", "committedDate": "2020-06-09T03:28:04Z", "message": "Remove beans.xml from Hibernate Reactive ITs"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "581d31a6fa34088d68d5e3a6832f730d6ed6532c", "author": {"user": {"login": "aguibert", "name": "Andrew Guibert"}}, "url": "https://github.com/quarkusio/quarkus/commit/581d31a6fa34088d68d5e3a6832f730d6ed6532c", "committedDate": "2020-06-09T03:28:04Z", "message": "Remove beans.xml from Hibernate Reactive ITs"}, "afterCommit": {"oid": "0b2b6526649d5bead89127c1e5e06024809e216d", "author": {"user": {"login": "aguibert", "name": "Andrew Guibert"}}, "url": "https://github.com/quarkusio/quarkus/commit/0b2b6526649d5bead89127c1e5e06024809e216d", "committedDate": "2020-06-09T13:34:46Z", "message": "Remove beans.xml from Hibernate Reactive ITs"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDI3MjEzODM5", "url": "https://github.com/quarkusio/quarkus/pull/9872#pullrequestreview-427213839", "createdAt": "2020-06-09T14:32:05Z", "commit": {"oid": "0b2b6526649d5bead89127c1e5e06024809e216d"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wOVQxNDozMjowNlrOGhNCsA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wOVQxNDozODo0NlrOGhNWRA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNzQ2OTg3Mg==", "bodyText": "This way the mere presence of the HIBERNATE_REACTIVE capability would break existing ORM applications, I don't think we can have that. Can you think of a better way?", "url": "https://github.com/quarkusio/quarkus/pull/9872#discussion_r437469872", "createdAt": "2020-06-09T14:32:06Z", "author": {"login": "Sanne"}, "path": "extensions/hibernate-orm/deployment/src/main/java/io/quarkus/hibernate/orm/deployment/HibernateOrmProcessor.java", "diffHunk": "@@ -208,8 +210,12 @@ public void configurationDescriptorBuilding(\n         for (PersistenceXmlDescriptorBuildItem persistenceXmlDescriptorBuildItem : persistenceXmlDescriptors) {\n             allDescriptors.add(persistenceXmlDescriptorBuildItem.getDescriptor());\n         }\n-        handleHibernateORMWithNoPersistenceXml(allDescriptors, resourceProducer, systemPropertyProducer,\n-                defaultJdbcDataSourceBuildItem, applicationArchivesBuildItem, launchMode.getLaunchMode());\n+\n+        final boolean hibernateReactivePresent = capabilities.isCapabilityPresent(Capabilities.HIBERNATE_REACTIVE);\n+        if (!hibernateReactivePresent) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "0b2b6526649d5bead89127c1e5e06024809e216d"}, "originalPosition": 35}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNzQ3MDY2MA==", "bodyText": "Since we don't have the same drivers for Hibernate Reactive, should it have its own code for this?", "url": "https://github.com/quarkusio/quarkus/pull/9872#discussion_r437470660", "createdAt": "2020-06-09T14:33:05Z", "author": {"login": "Sanne"}, "path": "extensions/hibernate-orm/deployment/src/main/java/io/quarkus/hibernate/orm/deployment/HibernateOrmProcessor.java", "diffHunk": "@@ -934,11 +940,14 @@ public void test(CombinedIndexBuildItem index,\n         }\n     }\n \n-    private Optional<String> guessDialect(Optional<String> dbKind) {\n+    public static Optional<String> guessDialect(Optional<String> dbKind) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "0b2b6526649d5bead89127c1e5e06024809e216d"}, "originalPosition": 47}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNzQ3MzE4MQ==", "bodyText": "This looks like largely copied from the blocking ORM processor. Could you add a comment to highlight what's similar and what's intentionally different?", "url": "https://github.com/quarkusio/quarkus/pull/9872#discussion_r437473181", "createdAt": "2020-06-09T14:36:29Z", "author": {"login": "Sanne"}, "path": "extensions/hibernate-reactive/deployment/src/main/java/io/quarkus/hibernate/reactive/deployment/HibernateReactiveProcessor.java", "diffHunk": "@@ -61,6 +97,194 @@ public void build(RecorderContext recorderContext,\n         recorder.callHibernateReactiveFeatureInit(enableRx);\n     }\n \n+    @BuildStep", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "0b2b6526649d5bead89127c1e5e06024809e216d"}, "originalPosition": 71}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNzQ3NDg4NA==", "bodyText": "This makes me wonder if we really shouldn't have something different for reactive than reusing the existing quarkus.hibernate-orm . Thoughts?", "url": "https://github.com/quarkusio/quarkus/pull/9872#discussion_r437474884", "createdAt": "2020-06-09T14:38:46Z", "author": {"login": "Sanne"}, "path": "integration-tests/hibernate-reactive/src/main/resources/application.properties", "diffHunk": "@@ -2,6 +2,10 @@ quarkus.datasource.db-kind=postgresql\n quarkus.datasource.username=hibernate_orm_test\n quarkus.datasource.password=hibernate_orm_test\n \n+# Hibernate config\n+quarkus.hibernate-orm.log.sql=true", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "0b2b6526649d5bead89127c1e5e06024809e216d"}, "originalPosition": 5}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "cfa2d644d290501f0f3bfa076ada88b366501618", "author": {"user": {"login": "aguibert", "name": "Andrew Guibert"}}, "url": "https://github.com/quarkusio/quarkus/commit/cfa2d644d290501f0f3bfa076ada88b366501618", "committedDate": "2020-06-10T14:15:06Z", "message": "Block usage of persistence.xml for Hibernate Reactive"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "08c17bdc91ea9923cb92aa9665af9eb284becae4", "author": {"user": {"login": "aguibert", "name": "Andrew Guibert"}}, "url": "https://github.com/quarkusio/quarkus/commit/08c17bdc91ea9923cb92aa9665af9eb284becae4", "committedDate": "2020-06-10T14:15:08Z", "message": "Remove beans.xml from Hibernate Reactive ITs"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "98aa6b921a42b074ed564a932909460502077742", "author": {"user": {"login": "aguibert", "name": "Andrew Guibert"}}, "url": "https://github.com/quarkusio/quarkus/commit/98aa6b921a42b074ed564a932909460502077742", "committedDate": "2020-06-09T16:19:01Z", "message": "Review comments from Sanne"}, "afterCommit": {"oid": "b2faaf14b79c0fb637c61f61ad5d6031bd7984df", "author": {"user": {"login": "aguibert", "name": "Andrew Guibert"}}, "url": "https://github.com/quarkusio/quarkus/commit/b2faaf14b79c0fb637c61f61ad5d6031bd7984df", "committedDate": "2020-06-10T14:21:55Z", "message": "Review comments from Sanne"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ff28fd71898934ef45999bf4588ca9db396362bb", "author": {"user": {"login": "aguibert", "name": "Andrew Guibert"}}, "url": "https://github.com/quarkusio/quarkus/commit/ff28fd71898934ef45999bf4588ca9db396362bb", "committedDate": "2020-06-10T14:44:26Z", "message": "Merges and review comments from Sanne"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "b2faaf14b79c0fb637c61f61ad5d6031bd7984df", "author": {"user": {"login": "aguibert", "name": "Andrew Guibert"}}, "url": "https://github.com/quarkusio/quarkus/commit/b2faaf14b79c0fb637c61f61ad5d6031bd7984df", "committedDate": "2020-06-10T14:21:55Z", "message": "Review comments from Sanne"}, "afterCommit": {"oid": "ff28fd71898934ef45999bf4588ca9db396362bb", "author": {"user": {"login": "aguibert", "name": "Andrew Guibert"}}, "url": "https://github.com/quarkusio/quarkus/commit/ff28fd71898934ef45999bf4588ca9db396362bb", "committedDate": "2020-06-10T14:44:26Z", "message": "Merges and review comments from Sanne"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDI4Mjc1NDk5", "url": "https://github.com/quarkusio/quarkus/pull/9872#pullrequestreview-428275499", "createdAt": "2020-06-10T17:25:28Z", "commit": {"oid": "ff28fd71898934ef45999bf4588ca9db396362bb"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4318, "cost": 1, "resetAt": "2021-11-01T16:37:27Z"}}}