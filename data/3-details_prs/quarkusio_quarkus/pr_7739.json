{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0Mzg2MTg5MDYx", "number": 7739, "title": "Ensure that a .env file at the root of the project can be used in dev-mode", "bodyText": "\u2026-mode\nThis includes having the capability to update the file\nFixes: #7519", "createdAt": "2020-03-10T15:05:30Z", "url": "https://github.com/quarkusio/quarkus/pull/7739", "merged": true, "mergeCommit": {"oid": "35ccf7dd90a1a87b8caba91c6c672d39658e388a"}, "closed": true, "closedAt": "2020-03-11T12:39:11Z", "author": {"login": "geoand"}, "timelineItems": {"totalCount": 10, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcMUa-GABqjMxMTUyODE2NDE=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcMlSzeABqjMxMTgzNjcyNzc=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "95182a2eabbbdac055f98059361a23b2fce922c7", "author": {"user": {"login": "geoand", "name": "Georgios Andrianakis"}}, "url": "https://github.com/quarkusio/quarkus/commit/95182a2eabbbdac055f98059361a23b2fce922c7", "committedDate": "2020-03-10T15:04:20Z", "message": "Ensure that a .env file at the root of the project can be used in dev-mode\n\nThis includes having the capability to update the file\n\nFixes: #7519"}, "afterCommit": {"oid": "6fca5731e80fcf7b988c635325b53b4794d29641", "author": {"user": {"login": "geoand", "name": "Georgios Andrianakis"}}, "url": "https://github.com/quarkusio/quarkus/commit/6fca5731e80fcf7b988c635325b53b4794d29641", "committedDate": "2020-03-10T15:40:36Z", "message": "Ensure that a .env file at the root of the project can be used in dev-mode\n\nThis includes having the capability to update the file\n\nFixes: #7519"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "6fca5731e80fcf7b988c635325b53b4794d29641", "author": {"user": {"login": "geoand", "name": "Georgios Andrianakis"}}, "url": "https://github.com/quarkusio/quarkus/commit/6fca5731e80fcf7b988c635325b53b4794d29641", "committedDate": "2020-03-10T15:40:36Z", "message": "Ensure that a .env file at the root of the project can be used in dev-mode\n\nThis includes having the capability to update the file\n\nFixes: #7519"}, "afterCommit": {"oid": "985c8cbdceb4b1911d3ecd57954fc9a2b191a3d1", "author": {"user": {"login": "geoand", "name": "Georgios Andrianakis"}}, "url": "https://github.com/quarkusio/quarkus/commit/985c8cbdceb4b1911d3ecd57954fc9a2b191a3d1", "committedDate": "2020-03-10T19:59:29Z", "message": "Ensure that a .env file at the root of the project can be used in dev-mode\n\nThis includes having the capability to update the file\n\nFixes: #7519"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzcyMzg2MTM4", "url": "https://github.com/quarkusio/quarkus/pull/7739#pullrequestreview-372386138", "createdAt": "2020-03-10T23:21:26Z", "commit": {"oid": "985c8cbdceb4b1911d3ecd57954fc9a2b191a3d1"}, "state": "DISMISSED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xMFQyMzoyMToyN1rOF0kZsQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xMFQyMzoyMjowMlrOF0kaig==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MDY2NjY3Mw==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                // this is done because the for the .env file to take effect, it needs to be\n          \n          \n            \n                // this is done because for the .env file to take effect, it needs to be", "url": "https://github.com/quarkusio/quarkus/pull/7739#discussion_r390666673", "createdAt": "2020-03-10T23:21:27Z", "author": {"login": "gsmet"}, "path": "core/devmode/src/main/java/io/quarkus/dev/DevModeMain.java", "diffHunk": "@@ -110,6 +114,36 @@ public void start() throws Exception {\n         }\n     }\n \n+    // copies the .env file to the directory where the process is running\n+    // this is done because the for the .env file to take effect, it needs to be", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "985c8cbdceb4b1911d3ecd57954fc9a2b191a3d1"}, "originalPosition": 23}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MDY2Njg5MA==", "bodyText": "Does it work on Windows?", "url": "https://github.com/quarkusio/quarkus/pull/7739#discussion_r390666890", "createdAt": "2020-03-10T23:22:02Z", "author": {"login": "gsmet"}, "path": "core/devmode/src/main/java/io/quarkus/dev/DevModeMain.java", "diffHunk": "@@ -110,6 +114,36 @@ public void start() throws Exception {\n         }\n     }\n \n+    // copies the .env file to the directory where the process is running\n+    // this is done because the for the .env file to take effect, it needs to be\n+    // in the same directory as the running process\n+    private void copyDotEnvFile() {\n+        File projectDir = context.getProjectDir();\n+        if (projectDir == null) { // this is the case for QuarkusDevModeTest\n+            return;\n+        }\n+        Path currentDir = Paths.get(\"\").toAbsolutePath().normalize();\n+        Path dotEnvPath = projectDir.toPath().resolve(\".env\");\n+        if (Files.exists(dotEnvPath)) {\n+            try {\n+                Path link = currentDir.resolve(\".env\");\n+                silentDeleteFile(link);\n+                // create a symlink to ensure that user updates to the file have the expected effect in dev-mode\n+                Files.createSymbolicLink(link, dotEnvPath);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "985c8cbdceb4b1911d3ecd57954fc9a2b191a3d1"}, "originalPosition": 37}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "985c8cbdceb4b1911d3ecd57954fc9a2b191a3d1", "author": {"user": {"login": "geoand", "name": "Georgios Andrianakis"}}, "url": "https://github.com/quarkusio/quarkus/commit/985c8cbdceb4b1911d3ecd57954fc9a2b191a3d1", "committedDate": "2020-03-10T19:59:29Z", "message": "Ensure that a .env file at the root of the project can be used in dev-mode\n\nThis includes having the capability to update the file\n\nFixes: #7519"}, "afterCommit": {"oid": "c1ffc2a98208664b2334f0c6f568e55e30f496b6", "author": {"user": {"login": "geoand", "name": "Georgios Andrianakis"}}, "url": "https://github.com/quarkusio/quarkus/commit/c1ffc2a98208664b2334f0c6f568e55e30f496b6", "committedDate": "2020-03-11T07:10:01Z", "message": "Ensure that a .env file at the root of the project can be used in dev-mode\n\nThis includes having the capability to update the file\n\nFixes: #7519"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzcyNjU1NDgz", "url": "https://github.com/quarkusio/quarkus/pull/7739#pullrequestreview-372655483", "createdAt": "2020-03-11T10:57:20Z", "commit": {"oid": "c1ffc2a98208664b2334f0c6f568e55e30f496b6"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xMVQxMDo1NzoyMFrOF0yGIA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xMVQxMDo1NzoyMFrOF0yGIA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MDg5MTA0MA==", "bodyText": "This seems like it might be overkill... would something like this work?\n\n  \n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                                    Paths.get(\"\").toAbsolutePath().normalize().resolve(\".env\").toAbsolutePath().toString()));\n          \n          \n            \n                                    Paths.get(\".env\").toAbsolutePath().toString()));", "url": "https://github.com/quarkusio/quarkus/pull/7739#discussion_r390891040", "createdAt": "2020-03-11T10:57:20Z", "author": {"login": "dmlloyd"}, "path": "core/deployment/src/main/java/io/quarkus/deployment/steps/DevModeBuildStep.java", "diffHunk": "@@ -11,6 +12,7 @@\n     @BuildStep\n     List<HotDeploymentWatchedFileBuildItem> config() {\n         return Arrays.asList(new HotDeploymentWatchedFileBuildItem(\"META-INF/microprofile-config.properties\"),\n-                new HotDeploymentWatchedFileBuildItem(\"application.properties\"));\n+                new HotDeploymentWatchedFileBuildItem(\"application.properties\"), new HotDeploymentWatchedFileBuildItem(\n+                        Paths.get(\"\").toAbsolutePath().normalize().resolve(\".env\").toAbsolutePath().toString()));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c1ffc2a98208664b2334f0c6f568e55e30f496b6"}, "originalPosition": 13}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzcyNjU3MDMx", "url": "https://github.com/quarkusio/quarkus/pull/7739#pullrequestreview-372657031", "createdAt": "2020-03-11T10:59:32Z", "commit": {"oid": "c1ffc2a98208664b2334f0c6f568e55e30f496b6"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xMVQxMDo1OTozMlrOF0yLNA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xMVQxMDo1OTozMlrOF0yLNA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MDg5MjM0MA==", "bodyText": "This seems wrong... unless we know for a fact that the current directory is going to be target/?  We don't want to modify anything outside target for any reason.  It would be better to modify the config source impl if that's the case.", "url": "https://github.com/quarkusio/quarkus/pull/7739#discussion_r390892340", "createdAt": "2020-03-11T10:59:32Z", "author": {"login": "dmlloyd"}, "path": "core/devmode/src/main/java/io/quarkus/dev/DevModeMain.java", "diffHunk": "@@ -110,6 +114,36 @@ public void start() throws Exception {\n         }\n     }\n \n+    // copies the .env file to the directory where the process is running\n+    // this is done because for the .env file to take effect, it needs to be\n+    // in the same directory as the running process\n+    private void copyDotEnvFile() {\n+        File projectDir = context.getProjectDir();\n+        if (projectDir == null) { // this is the case for QuarkusDevModeTest\n+            return;\n+        }\n+        Path currentDir = Paths.get(\"\").toAbsolutePath().normalize();\n+        Path dotEnvPath = projectDir.toPath().resolve(\".env\");\n+        if (Files.exists(dotEnvPath)) {\n+            try {\n+                Path link = currentDir.resolve(\".env\");\n+                silentDeleteFile(link);\n+                // create a symlink to ensure that user updates to the file have the expected effect in dev-mode\n+                Files.createSymbolicLink(link, dotEnvPath);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c1ffc2a98208664b2334f0c6f568e55e30f496b6"}, "originalPosition": 37}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzcyNjY2Nzcz", "url": "https://github.com/quarkusio/quarkus/pull/7739#pullrequestreview-372666773", "createdAt": "2020-03-11T11:14:33Z", "commit": {"oid": "c1ffc2a98208664b2334f0c6f568e55e30f496b6"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "c1ffc2a98208664b2334f0c6f568e55e30f496b6", "author": {"user": {"login": "geoand", "name": "Georgios Andrianakis"}}, "url": "https://github.com/quarkusio/quarkus/commit/c1ffc2a98208664b2334f0c6f568e55e30f496b6", "committedDate": "2020-03-11T07:10:01Z", "message": "Ensure that a .env file at the root of the project can be used in dev-mode\n\nThis includes having the capability to update the file\n\nFixes: #7519"}, "afterCommit": {"oid": "de155a07b937014445e575598d18b3c5f6b8e53d", "author": {"user": {"login": "geoand", "name": "Georgios Andrianakis"}}, "url": "https://github.com/quarkusio/quarkus/commit/de155a07b937014445e575598d18b3c5f6b8e53d", "committedDate": "2020-03-11T11:15:03Z", "message": "Ensure that a .env file at the root of the project can be used in dev-mode\n\nThis includes having the capability to update the file\n\nFixes: #7519"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b4d7778f891ab6061e4f556cda275169941d48e6", "author": {"user": {"login": "geoand", "name": "Georgios Andrianakis"}}, "url": "https://github.com/quarkusio/quarkus/commit/b4d7778f891ab6061e4f556cda275169941d48e6", "committedDate": "2020-03-11T11:20:05Z", "message": "Ensure that a .env file at the root of the project can be used in dev-mode\n\nThis includes having the capability to update the file\n\nFixes: #7519"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "de155a07b937014445e575598d18b3c5f6b8e53d", "author": {"user": {"login": "geoand", "name": "Georgios Andrianakis"}}, "url": "https://github.com/quarkusio/quarkus/commit/de155a07b937014445e575598d18b3c5f6b8e53d", "committedDate": "2020-03-11T11:15:03Z", "message": "Ensure that a .env file at the root of the project can be used in dev-mode\n\nThis includes having the capability to update the file\n\nFixes: #7519"}, "afterCommit": {"oid": "b4d7778f891ab6061e4f556cda275169941d48e6", "author": {"user": {"login": "geoand", "name": "Georgios Andrianakis"}}, "url": "https://github.com/quarkusio/quarkus/commit/b4d7778f891ab6061e4f556cda275169941d48e6", "committedDate": "2020-03-11T11:20:05Z", "message": "Ensure that a .env file at the root of the project can be used in dev-mode\n\nThis includes having the capability to update the file\n\nFixes: #7519"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3796, "cost": 1, "resetAt": "2021-11-02T10:47:05Z"}}}