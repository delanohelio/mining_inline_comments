{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDY4ODY2MjEy", "number": 11420, "title": "URL patterns for WebFilters are optional", "bodyText": "According to the spec, servlet names can be specified instead\nFixes #11417", "createdAt": "2020-08-17T14:24:45Z", "url": "https://github.com/quarkusio/quarkus/pull/11420", "merged": true, "mergeCommit": {"oid": "7a1826dc3a72b2319cc140b171982133795b70ed"}, "closed": true, "closedAt": "2020-08-20T09:03:32Z", "author": {"login": "gastaldi"}, "timelineItems": {"totalCount": 8, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABc_zVBjABqjM2NjIxNTM5Nzg=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdAsb0xgFqTQ3MTQwMTM1Nw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "a08d28a44feccf06f24272b437b1d2ab60e1065b", "author": {"user": {"login": "gastaldi", "name": "George Gastaldi"}}, "url": "https://github.com/quarkusio/quarkus/commit/a08d28a44feccf06f24272b437b1d2ab60e1065b", "committedDate": "2020-08-17T14:23:39Z", "message": "URL patterns for WebFilters are optional\n\nAccording to the spec, servlet names can be specified instead\nFixes #11417"}, "afterCommit": {"oid": "8a630b3fabcffc4c190a108a0a1256208ce2b276", "author": {"user": {"login": "gastaldi", "name": "George Gastaldi"}}, "url": "https://github.com/quarkusio/quarkus/commit/8a630b3fabcffc4c190a108a0a1256208ce2b276", "committedDate": "2020-08-17T14:31:16Z", "message": "URL patterns for WebFilters are optional\n\nAccording to the spec, servlet names can be specified instead\nFixes #11417"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDY4OTI2MTY5", "url": "https://github.com/quarkusio/quarkus/pull/11420#pullrequestreview-468926169", "createdAt": "2020-08-18T01:07:47Z", "commit": {"oid": "aab50b33a17d5d6c6fed284e19c9c9b9b4223937"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xOFQwMTowNzo0OFrOHB_0Pg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xOFQwMTowNzo0OFrOHB_0Pg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MTg1NjE5MA==", "bodyText": "this should not be an error. 3rd party jars sometimes define these in web-framgement.xml, with the intention the application can map them if required.", "url": "https://github.com/quarkusio/quarkus/pull/11420#discussion_r471856190", "createdAt": "2020-08-18T01:07:48Z", "author": {"login": "stuartwdouglas"}, "path": "extensions/undertow/deployment/src/main/java/io/quarkus/undertow/deployment/UndertowBuildStep.java", "diffHunk": "@@ -417,16 +417,34 @@ public ServletDeploymentManagerBuildItem build(List<ServletBuildItem> servlets,\n         }\n         if (webMetaData.getFilterMappings() != null) {\n             for (FilterMappingMetaData mapping : webMetaData.getFilterMappings()) {\n-                for (String m : mapping.getUrlPatterns()) {\n-                    if (mapping.getDispatchers() == null || mapping.getDispatchers().isEmpty()) {\n-                        recorder.addFilterURLMapping(deployment, mapping.getFilterName(), m, REQUEST);\n-                    } else {\n-\n-                        for (DispatcherType dispatcher : mapping.getDispatchers()) {\n-                            recorder.addFilterURLMapping(deployment, mapping.getFilterName(), m,\n-                                    javax.servlet.DispatcherType.valueOf(dispatcher.name()));\n+                List<String> urlPatterns = mapping.getUrlPatterns();\n+                List<String> servletNames = mapping.getServletNames();\n+                if (urlPatterns != null && !urlPatterns.isEmpty()) {\n+                    for (String m : urlPatterns) {\n+                        if (mapping.getDispatchers() == null || mapping.getDispatchers().isEmpty()) {\n+                            recorder.addFilterURLMapping(deployment, mapping.getFilterName(), m, REQUEST);\n+                        } else {\n+                            for (DispatcherType dispatcher : mapping.getDispatchers()) {\n+                                recorder.addFilterURLMapping(deployment, mapping.getFilterName(), m,\n+                                        javax.servlet.DispatcherType.valueOf(dispatcher.name()));\n+                            }\n+                        }\n+                    }\n+                } else if (servletNames != null && !servletNames.isEmpty()) {\n+                    // No URL Patterns found, map to servlet name instead\n+                    for (String name : servletNames) {\n+                        if (mapping.getDispatchers() == null || mapping.getDispatchers().isEmpty()) {\n+                            recorder.addFilterServletNameMapping(deployment, mapping.getFilterName(), name, REQUEST);\n+                        } else {\n+                            for (DispatcherType dispatcher : mapping.getDispatchers()) {\n+                                recorder.addFilterServletNameMapping(deployment, mapping.getFilterName(), name,\n+                                        javax.servlet.DispatcherType.valueOf(dispatcher.name()));\n+                            }\n                         }\n                     }\n+                } else {\n+                    throw new IllegalStateException(", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "aab50b33a17d5d6c6fed284e19c9c9b9b4223937"}, "originalPosition": 38}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "aab50b33a17d5d6c6fed284e19c9c9b9b4223937", "author": {"user": {"login": "gastaldi", "name": "George Gastaldi"}}, "url": "https://github.com/quarkusio/quarkus/commit/aab50b33a17d5d6c6fed284e19c9c9b9b4223937", "committedDate": "2020-08-17T14:33:37Z", "message": "Using StandardCharsets in test case"}, "afterCommit": {"oid": "60955c39a726b6dfd4e64b303c24578e93eb8632", "author": {"user": {"login": "gastaldi", "name": "George Gastaldi"}}, "url": "https://github.com/quarkusio/quarkus/commit/60955c39a726b6dfd4e64b303c24578e93eb8632", "committedDate": "2020-08-18T01:14:15Z", "message": "Using StandardCharsets in test case"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDY4OTMwMDg5", "url": "https://github.com/quarkusio/quarkus/pull/11420#pullrequestreview-468930089", "createdAt": "2020-08-18T01:21:21Z", "commit": {"oid": "60955c39a726b6dfd4e64b303c24578e93eb8632"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "3bd8254045a0353500ec41b02982b5091607ccb5", "author": {"user": {"login": "gastaldi", "name": "George Gastaldi"}}, "url": "https://github.com/quarkusio/quarkus/commit/3bd8254045a0353500ec41b02982b5091607ccb5", "committedDate": "2020-08-18T14:44:12Z", "message": "URL patterns for WebFilters are optional\n\nAccording to the spec, servlet names can be specified instead\nFixes #11417"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "98a819db73add32c25b815c7b8d040a19aec2aee", "author": {"user": {"login": "gastaldi", "name": "George Gastaldi"}}, "url": "https://github.com/quarkusio/quarkus/commit/98a819db73add32c25b815c7b8d040a19aec2aee", "committedDate": "2020-08-18T14:44:14Z", "message": "Using StandardCharsets in test case"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "60955c39a726b6dfd4e64b303c24578e93eb8632", "author": {"user": {"login": "gastaldi", "name": "George Gastaldi"}}, "url": "https://github.com/quarkusio/quarkus/commit/60955c39a726b6dfd4e64b303c24578e93eb8632", "committedDate": "2020-08-18T01:14:15Z", "message": "Using StandardCharsets in test case"}, "afterCommit": {"oid": "98a819db73add32c25b815c7b8d040a19aec2aee", "author": {"user": {"login": "gastaldi", "name": "George Gastaldi"}}, "url": "https://github.com/quarkusio/quarkus/commit/98a819db73add32c25b815c7b8d040a19aec2aee", "committedDate": "2020-08-18T14:44:14Z", "message": "Using StandardCharsets in test case"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDcxNDAxMzU3", "url": "https://github.com/quarkusio/quarkus/pull/11420#pullrequestreview-471401357", "createdAt": "2020-08-20T09:03:27Z", "commit": {"oid": "98a819db73add32c25b815c7b8d040a19aec2aee"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 797, "cost": 1, "resetAt": "2021-11-01T16:37:27Z"}}}