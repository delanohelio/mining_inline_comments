{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTE3MzEwMTMx", "number": 13174, "reviewThreads": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wOVQwODoyNjoyMVrOE2pvhA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wOVQwODoyNjoyMVrOE2pvhA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzI1NzQyNDY4OnYy", "diffSide": "RIGHT", "path": "test-framework/junit5/src/main/java/io/quarkus/test/junit/QuarkusTestExtension.java", "isResolved": false, "comments": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wOVQwODoyNjoyMVrOHvjhag==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xMFQxNzoyOTozMFrOHwnjww==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxOTYyNzExNA==", "bodyText": "If a project has only one output test dir, wouldn't this dir be added twice? I.e. through this property and the default test dir that would have been added w/o this code?", "url": "https://github.com/quarkusio/quarkus/pull/13174#discussion_r519627114", "createdAt": "2020-11-09T08:26:21Z", "author": {"login": "aloubyansky"}, "path": "test-framework/junit5/src/main/java/io/quarkus/test/junit/QuarkusTestExtension.java", "diffHunk": "@@ -195,7 +198,21 @@ private ExtensionState doJavaStart(ExtensionContext context, Class<? extends Qua\n \n             // If gradle project running directly with IDE\n             if (System.getProperty(BootstrapConstants.SERIALIZED_APP_MODEL) == null) {\n-                BuildToolHelper.enableGradleAppModelForTest(projectRoot);\n+                QuarkusModel model = BuildToolHelper.enableGradleAppModelForTest(projectRoot);\n+                final Set<File> classDirectories = model.getWorkspace().getMainModule().getSourceSet().getSourceDirectories();\n+                for (File classes : classDirectories) {\n+                    if (!rootBuilder.contains(classes.toPath())) {\n+                        rootBuilder.add(classes.toPath());\n+                    }\n+                }\n+            } else if (System.getProperty(BootstrapConstants.OUTPUT_SOURCES_DIR) != null) {\n+                final String[] sourceDirectories = System.getProperty(BootstrapConstants.OUTPUT_SOURCES_DIR).split(\",\");", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "9a17a0236c2a7899c2c78477bbeb2e82ecf91fd9"}, "originalPosition": 37}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxOTY1OTE4NQ==", "bodyText": "I check if the directory is already in the rootBuilder before adding it in order to avoid duplicate", "url": "https://github.com/quarkusio/quarkus/pull/13174#discussion_r519659185", "createdAt": "2020-11-09T09:20:54Z", "author": {"login": "glefloch"}, "path": "test-framework/junit5/src/main/java/io/quarkus/test/junit/QuarkusTestExtension.java", "diffHunk": "@@ -195,7 +198,21 @@ private ExtensionState doJavaStart(ExtensionContext context, Class<? extends Qua\n \n             // If gradle project running directly with IDE\n             if (System.getProperty(BootstrapConstants.SERIALIZED_APP_MODEL) == null) {\n-                BuildToolHelper.enableGradleAppModelForTest(projectRoot);\n+                QuarkusModel model = BuildToolHelper.enableGradleAppModelForTest(projectRoot);\n+                final Set<File> classDirectories = model.getWorkspace().getMainModule().getSourceSet().getSourceDirectories();\n+                for (File classes : classDirectories) {\n+                    if (!rootBuilder.contains(classes.toPath())) {\n+                        rootBuilder.add(classes.toPath());\n+                    }\n+                }\n+            } else if (System.getProperty(BootstrapConstants.OUTPUT_SOURCES_DIR) != null) {\n+                final String[] sourceDirectories = System.getProperty(BootstrapConstants.OUTPUT_SOURCES_DIR).split(\",\");", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxOTYyNzExNA=="}, "originalCommit": {"oid": "9a17a0236c2a7899c2c78477bbeb2e82ecf91fd9"}, "originalPosition": 37}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMDcwNjAzMQ==", "bodyText": "Yes, that's ok.\nHowever, could you remind me why we did BuildToolHelper.enableGradleAppModelForTest(projectRoot)? Is this to support IDEs?", "url": "https://github.com/quarkusio/quarkus/pull/13174#discussion_r520706031", "createdAt": "2020-11-10T16:39:27Z", "author": {"login": "aloubyansky"}, "path": "test-framework/junit5/src/main/java/io/quarkus/test/junit/QuarkusTestExtension.java", "diffHunk": "@@ -195,7 +198,21 @@ private ExtensionState doJavaStart(ExtensionContext context, Class<? extends Qua\n \n             // If gradle project running directly with IDE\n             if (System.getProperty(BootstrapConstants.SERIALIZED_APP_MODEL) == null) {\n-                BuildToolHelper.enableGradleAppModelForTest(projectRoot);\n+                QuarkusModel model = BuildToolHelper.enableGradleAppModelForTest(projectRoot);\n+                final Set<File> classDirectories = model.getWorkspace().getMainModule().getSourceSet().getSourceDirectories();\n+                for (File classes : classDirectories) {\n+                    if (!rootBuilder.contains(classes.toPath())) {\n+                        rootBuilder.add(classes.toPath());\n+                    }\n+                }\n+            } else if (System.getProperty(BootstrapConstants.OUTPUT_SOURCES_DIR) != null) {\n+                final String[] sourceDirectories = System.getProperty(BootstrapConstants.OUTPUT_SOURCES_DIR).split(\",\");", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxOTYyNzExNA=="}, "originalCommit": {"oid": "9a17a0236c2a7899c2c78477bbeb2e82ecf91fd9"}, "originalPosition": 37}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMDcwOTYyNQ==", "bodyText": "BuildToolHelper.enableGradleAppModelForTest(projectRoot) is already checking whether it's a gradle project, btw.", "url": "https://github.com/quarkusio/quarkus/pull/13174#discussion_r520709625", "createdAt": "2020-11-10T16:44:24Z", "author": {"login": "aloubyansky"}, "path": "test-framework/junit5/src/main/java/io/quarkus/test/junit/QuarkusTestExtension.java", "diffHunk": "@@ -195,7 +198,21 @@ private ExtensionState doJavaStart(ExtensionContext context, Class<? extends Qua\n \n             // If gradle project running directly with IDE\n             if (System.getProperty(BootstrapConstants.SERIALIZED_APP_MODEL) == null) {\n-                BuildToolHelper.enableGradleAppModelForTest(projectRoot);\n+                QuarkusModel model = BuildToolHelper.enableGradleAppModelForTest(projectRoot);\n+                final Set<File> classDirectories = model.getWorkspace().getMainModule().getSourceSet().getSourceDirectories();\n+                for (File classes : classDirectories) {\n+                    if (!rootBuilder.contains(classes.toPath())) {\n+                        rootBuilder.add(classes.toPath());\n+                    }\n+                }\n+            } else if (System.getProperty(BootstrapConstants.OUTPUT_SOURCES_DIR) != null) {\n+                final String[] sourceDirectories = System.getProperty(BootstrapConstants.OUTPUT_SOURCES_DIR).split(\",\");", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxOTYyNzExNA=="}, "originalCommit": {"oid": "9a17a0236c2a7899c2c78477bbeb2e82ecf91fd9"}, "originalPosition": 37}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMDc0MTgyNw==", "bodyText": "Yes exactly if you come from the IDE the model has not been serialized yet. This is why there is those two similar blocks.\nI added the check in the if because the BuildToolHelper.enableGradleAppModelForTest(projectRoot) returns null if it's not a Gradle project. You are right, it's better to check if the returned model is not null rather than checking if this a Gradle project (as the method recursively look for a build file). I will update the code", "url": "https://github.com/quarkusio/quarkus/pull/13174#discussion_r520741827", "createdAt": "2020-11-10T17:29:30Z", "author": {"login": "glefloch"}, "path": "test-framework/junit5/src/main/java/io/quarkus/test/junit/QuarkusTestExtension.java", "diffHunk": "@@ -195,7 +198,21 @@ private ExtensionState doJavaStart(ExtensionContext context, Class<? extends Qua\n \n             // If gradle project running directly with IDE\n             if (System.getProperty(BootstrapConstants.SERIALIZED_APP_MODEL) == null) {\n-                BuildToolHelper.enableGradleAppModelForTest(projectRoot);\n+                QuarkusModel model = BuildToolHelper.enableGradleAppModelForTest(projectRoot);\n+                final Set<File> classDirectories = model.getWorkspace().getMainModule().getSourceSet().getSourceDirectories();\n+                for (File classes : classDirectories) {\n+                    if (!rootBuilder.contains(classes.toPath())) {\n+                        rootBuilder.add(classes.toPath());\n+                    }\n+                }\n+            } else if (System.getProperty(BootstrapConstants.OUTPUT_SOURCES_DIR) != null) {\n+                final String[] sourceDirectories = System.getProperty(BootstrapConstants.OUTPUT_SOURCES_DIR).split(\",\");", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxOTYyNzExNA=="}, "originalCommit": {"oid": "9a17a0236c2a7899c2c78477bbeb2e82ecf91fd9"}, "originalPosition": 37}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4032, "cost": 1, "resetAt": "2021-11-13T14:23:39Z"}}}