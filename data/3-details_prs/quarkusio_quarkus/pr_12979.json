{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTEwNzc0MDY0", "number": 12979, "title": "Init container probes", "bodyText": "Resolves: #12824", "createdAt": "2020-10-27T13:57:42Z", "url": "https://github.com/quarkusio/quarkus/pull/12979", "merged": true, "mergeCommit": {"oid": "248f20114d2764a7ce77a19fa43393b8941c77fb"}, "closed": true, "closedAt": "2020-11-03T07:35:13Z", "author": {"login": "iocanel"}, "timelineItems": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdXNrYzgBqjM5MzQ5OTIwNjg=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdYmlzVAFqTUyMTc1MzI1Mw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "d2b9d48032ef58d58dd2d12d5014281ad7c30de3", "author": {"user": {"login": "iocanel", "name": "Ioannis Canellos"}}, "url": "https://github.com/quarkusio/quarkus/commit/d2b9d48032ef58d58dd2d12d5014281ad7c30de3", "committedDate": "2020-10-27T13:57:06Z", "message": "fix: (#12824) Init container probes"}, "afterCommit": {"oid": "9cafb932e44ddeeefb56cf8e1aabb79d63eb123f", "author": {"user": {"login": "iocanel", "name": "Ioannis Canellos"}}, "url": "https://github.com/quarkusio/quarkus/commit/9cafb932e44ddeeefb56cf8e1aabb79d63eb123f", "committedDate": "2020-10-29T08:12:55Z", "message": "fix (#12824) Init containers are now stripped of probes"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTIxNDc0MTc2", "url": "https://github.com/quarkusio/quarkus/pull/12979#pullrequestreview-521474176", "createdAt": "2020-11-02T09:48:45Z", "commit": {"oid": "9cafb932e44ddeeefb56cf8e1aabb79d63eb123f"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wMlQwOTo0ODo0NlrOHr9Gww==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wMlQwOTo0ODo0NlrOHr9Gww==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNTg1MTk3MQ==", "bodyText": "Can we have an assertion if the image and and command?", "url": "https://github.com/quarkusio/quarkus/pull/12979#discussion_r515851971", "createdAt": "2020-11-02T09:48:46Z", "author": {"login": "geoand"}, "path": "integration-tests/kubernetes/quarkus-standard-way/src/test/java/io/quarkus/it/kubernetes/KubernetesWithInitContainerProbeTest.java", "diffHunk": "@@ -0,0 +1,70 @@\n+package io.quarkus.it.kubernetes;\n+\n+import static org.assertj.core.api.Assertions.assertThat;\n+\n+import java.io.IOException;\n+import java.nio.file.Path;\n+import java.util.Collections;\n+import java.util.List;\n+\n+import org.jboss.shrinkwrap.api.ShrinkWrap;\n+import org.jboss.shrinkwrap.api.spec.JavaArchive;\n+import org.junit.jupiter.api.Test;\n+import org.junit.jupiter.api.extension.RegisterExtension;\n+\n+import io.fabric8.kubernetes.api.model.HasMetadata;\n+import io.fabric8.kubernetes.api.model.apps.Deployment;\n+import io.quarkus.bootstrap.model.AppArtifact;\n+import io.quarkus.builder.Version;\n+import io.quarkus.test.ProdBuildResults;\n+import io.quarkus.test.ProdModeTestResults;\n+import io.quarkus.test.QuarkusProdModeTest;\n+\n+public class KubernetesWithInitContainerProbeTest {\n+\n+    @RegisterExtension\n+    static final QuarkusProdModeTest config = new QuarkusProdModeTest()\n+            .setArchiveProducer(() -> ShrinkWrap.create(JavaArchive.class).addClasses(GreetingResource.class))\n+            .setApplicationName(\"kubernetes-with-init-container-probe\")\n+            .setApplicationVersion(\"0.1-SNAPSHOT\")\n+            .withConfigurationResource(\"kubernetes-with-init-container-probe.properties\")\n+            .setForcedDependencies(\n+                    Collections.singletonList(new AppArtifact(\"io.quarkus\", \"quarkus-smallrye-health\", Version.getVersion())));\n+\n+    @ProdBuildResults\n+    private ProdModeTestResults prodModeTestResults;\n+\n+    @Test\n+    public void assertGeneratedResources() throws IOException {\n+        Path kubernetesDir = prodModeTestResults.getBuildDir().resolve(\"kubernetes\");\n+        assertThat(kubernetesDir)\n+                .isDirectoryContaining(p -> p.getFileName().endsWith(\"kubernetes.json\"))\n+                .isDirectoryContaining(p -> p.getFileName().endsWith(\"kubernetes.yml\"));\n+        List<HasMetadata> kubernetesList = DeserializationUtil\n+                .deserializeAsList(kubernetesDir.resolve(\"kubernetes.yml\"));\n+\n+        assertThat(kubernetesList).filteredOn(i -> \"Deployment\".equals(i.getKind())).singleElement().satisfies(i -> {\n+            assertThat(i).isInstanceOfSatisfying(Deployment.class, d -> {\n+\n+                assertThat(d.getSpec()).satisfies(deploymentSpec -> {\n+                    assertThat(deploymentSpec.getReplicas()).isEqualTo(1);\n+                    assertThat(deploymentSpec.getTemplate()).satisfies(t -> {\n+                        assertThat(t.getSpec()).satisfies(podSpec -> {\n+                            assertThat(podSpec.getServiceAccount()).isNull();\n+                            assertThat(podSpec.getInitContainers()).singleElement().satisfies(container -> {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "9cafb932e44ddeeefb56cf8e1aabb79d63eb123f"}, "originalPosition": 54}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "9cafb932e44ddeeefb56cf8e1aabb79d63eb123f", "author": {"user": {"login": "iocanel", "name": "Ioannis Canellos"}}, "url": "https://github.com/quarkusio/quarkus/commit/9cafb932e44ddeeefb56cf8e1aabb79d63eb123f", "committedDate": "2020-10-29T08:12:55Z", "message": "fix (#12824) Init containers are now stripped of probes"}, "afterCommit": {"oid": "d3050f68c392d6c496b343b3b304b423d5552ef6", "author": {"user": {"login": "iocanel", "name": "Ioannis Canellos"}}, "url": "https://github.com/quarkusio/quarkus/commit/d3050f68c392d6c496b343b3b304b423d5552ef6", "committedDate": "2020-11-02T15:37:09Z", "message": "fix (#12824) Init containers are now stripped of probes"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d3050f68c392d6c496b343b3b304b423d5552ef6", "author": {"user": {"login": "iocanel", "name": "Ioannis Canellos"}}, "url": "https://github.com/quarkusio/quarkus/commit/d3050f68c392d6c496b343b3b304b423d5552ef6", "committedDate": "2020-11-02T15:37:09Z", "message": "fix (#12824) Init containers are now stripped of probes"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTIxNzUzMjUz", "url": "https://github.com/quarkusio/quarkus/pull/12979#pullrequestreview-521753253", "createdAt": "2020-11-02T15:49:06Z", "commit": {"oid": "d3050f68c392d6c496b343b3b304b423d5552ef6"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1574, "cost": 1, "resetAt": "2021-11-01T16:37:27Z"}}}