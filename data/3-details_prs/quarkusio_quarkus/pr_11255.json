{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDY0MDE3NDMy", "number": 11255, "title": "Avoid including platform BOM twice in the Gradle plugin", "bodyText": "Fixes #11251\nAdd test", "createdAt": "2020-08-06T13:10:29Z", "url": "https://github.com/quarkusio/quarkus/pull/11255", "merged": true, "mergeCommit": {"oid": "34d4129b3fc65b8e5e7f24a453167c90624d11bf"}, "closed": true, "closedAt": "2020-08-07T01:18:54Z", "author": {"login": "gastaldi"}, "timelineItems": {"totalCount": 7, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABc8Pkk-AH2gAyNDY0MDE3NDMyOmZkZjA4NWIwM2E5N2E1MTYxYTQ5YjRkYWQ0N2MwOTUxMzJiM2JjODU=", "endCursor": "Y3Vyc29yOnYyOpPPAAABc8UukHAFqTQ2MjgwMjQ2Mw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "fdf085b03a97a5161a49b4dad47c095132b3bc85", "author": {"user": {"login": "gastaldi", "name": "George Gastaldi"}}, "url": "https://github.com/quarkusio/quarkus/commit/fdf085b03a97a5161a49b4dad47c095132b3bc85", "committedDate": "2020-08-06T13:10:04Z", "message": "Avoid including platform BOM twice in the Gradle plugin\n\nFixes #11251\n\nAdd test"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDYyNTIyNjU1", "url": "https://github.com/quarkusio/quarkus/pull/11255#pullrequestreview-462522655", "createdAt": "2020-08-06T13:34:00Z", "commit": {"oid": "fdf085b03a97a5161a49b4dad47c095132b3bc85"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0wNlQxMzozNDowMFrOG8zvnQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0wNlQxMzozNDowMFrOG8zvnQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NjQxNTUxNw==", "bodyText": "Do we really want to compare with the version?", "url": "https://github.com/quarkusio/quarkus/pull/11255#discussion_r466415517", "createdAt": "2020-08-06T13:34:00Z", "author": {"login": "gsmet"}, "path": "independent-projects/tools/devtools-common/src/main/java/io/quarkus/devtools/project/buildfile/AbstractGradleBuildFile.java", "diffHunk": "@@ -61,11 +61,30 @@ protected boolean addDependency(AppArtifactCoords coords, boolean managed) {\n     }\n \n     static boolean addDependencyInModel(Model model, AppArtifactCoords coords, boolean managed) {\n-        StringBuilder newDependency = new StringBuilder()\n-                .append(\"    implementation '\")\n-                .append(coords.getGroupId())\n-                .append(\":\")\n-                .append(coords.getArtifactId());\n+        boolean isBOM = \"pom\".equals(coords.getType());\n+        StringBuilder newDependency;\n+        if (isBOM) {\n+            // Check if BOM is not included already\n+            String resolvedPlatform = String\n+                    .format(\"%s:%s:%s\", getProperty(model, \"quarkusPlatformGroupId\"),\n+                            getProperty(model, \"quarkusPlatformArtifactId\"),\n+                            getProperty(model, \"quarkusPlatformVersion\"));\n+            String thisBOM = String.format(\"%s:%s:%s\", coords.getGroupId(), coords.getArtifactId(), coords.getVersion());", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "fdf085b03a97a5161a49b4dad47c095132b3bc85"}, "originalPosition": 17}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDYyNTI1MDk0", "url": "https://github.com/quarkusio/quarkus/pull/11255#pullrequestreview-462525094", "createdAt": "2020-08-06T13:36:39Z", "commit": {"oid": "fdf085b03a97a5161a49b4dad47c095132b3bc85"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0wNlQxMzozNjozOVrOG8z2kA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0wNlQxMzozNjozOVrOG8z2kA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NjQxNzI5Ng==", "bodyText": "It seems really weird to have the quarkus bom insertion as part of the addDependencyInModel", "url": "https://github.com/quarkusio/quarkus/pull/11255#discussion_r466417296", "createdAt": "2020-08-06T13:36:39Z", "author": {"login": "ia3andy"}, "path": "independent-projects/tools/devtools-common/src/main/java/io/quarkus/devtools/project/buildfile/AbstractGradleBuildFile.java", "diffHunk": "@@ -61,11 +61,30 @@ protected boolean addDependency(AppArtifactCoords coords, boolean managed) {\n     }\n \n     static boolean addDependencyInModel(Model model, AppArtifactCoords coords, boolean managed) {\n-        StringBuilder newDependency = new StringBuilder()\n-                .append(\"    implementation '\")\n-                .append(coords.getGroupId())\n-                .append(\":\")\n-                .append(coords.getArtifactId());\n+        boolean isBOM = \"pom\".equals(coords.getType());\n+        StringBuilder newDependency;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "fdf085b03a97a5161a49b4dad47c095132b3bc85"}, "originalPosition": 10}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "9e5b108d0a58d6d4536dc5000409fabb47d47b31", "author": {"user": {"login": "gastaldi", "name": "George Gastaldi"}}, "url": "https://github.com/quarkusio/quarkus/commit/9e5b108d0a58d6d4536dc5000409fabb47d47b31", "committedDate": "2020-08-06T14:16:26Z", "message": "Do not check the version when comparing the BOM"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c869bc7111fdf1fb626ce6e9f684eb6a33d04fcc", "author": {"user": {"login": "gastaldi", "name": "George Gastaldi"}}, "url": "https://github.com/quarkusio/quarkus/commit/c869bc7111fdf1fb626ce6e9f684eb6a33d04fcc", "committedDate": "2020-08-06T14:18:11Z", "message": "Fixed minor IDE warnings"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDYyNTY5NjA0", "url": "https://github.com/quarkusio/quarkus/pull/11255#pullrequestreview-462569604", "createdAt": "2020-08-06T14:24:13Z", "commit": {"oid": "c869bc7111fdf1fb626ce6e9f684eb6a33d04fcc"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDYyODAyNDYz", "url": "https://github.com/quarkusio/quarkus/pull/11255#pullrequestreview-462802463", "createdAt": "2020-08-06T19:10:30Z", "commit": {"oid": "c869bc7111fdf1fb626ce6e9f684eb6a33d04fcc"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0wNlQxOToxMDozMFrOG9Aucw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0wNlQxOToxMDozMFrOG9Aucw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NjYyODIxMQ==", "bodyText": "It's better but works on the assumption that these properties are used. In general there could be any property or direct coordinates.", "url": "https://github.com/quarkusio/quarkus/pull/11255#discussion_r466628211", "createdAt": "2020-08-06T19:10:30Z", "author": {"login": "aloubyansky"}, "path": "independent-projects/tools/devtools-common/src/main/java/io/quarkus/devtools/project/buildfile/AbstractGradleBuildFile.java", "diffHunk": "@@ -61,11 +61,29 @@ protected boolean addDependency(AppArtifactCoords coords, boolean managed) {\n     }\n \n     static boolean addDependencyInModel(Model model, AppArtifactCoords coords, boolean managed) {\n-        StringBuilder newDependency = new StringBuilder()\n-                .append(\"    implementation '\")\n-                .append(coords.getGroupId())\n-                .append(\":\")\n-                .append(coords.getArtifactId());\n+        boolean isBOM = \"pom\".equals(coords.getType());\n+        StringBuilder newDependency;\n+        if (isBOM) {\n+            // Check if BOM is not included already\n+            String resolvedPlatform = String\n+                    .format(\"%s:%s\", getProperty(model, \"quarkusPlatformGroupId\"),\n+                            getProperty(model, \"quarkusPlatformArtifactId\"));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c869bc7111fdf1fb626ce6e9f684eb6a33d04fcc"}, "originalPosition": 24}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 931, "cost": 1, "resetAt": "2021-11-01T16:37:27Z"}}}