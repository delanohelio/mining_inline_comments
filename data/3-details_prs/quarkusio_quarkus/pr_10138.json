{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDM3NTA4NDkw", "number": 10138, "title": "Enable forwarded for host header configuration", "bodyText": "This is the first part of #9622 that enable users to configure the header to be used to override the HTTP request's host.", "createdAt": "2020-06-21T07:28:07Z", "url": "https://github.com/quarkusio/quarkus/pull/10138", "merged": true, "mergeCommit": {"oid": "97ad4fe754bf0aea78305f840ff1902c2d89bae0"}, "closed": true, "closedAt": "2020-06-24T05:24:28Z", "author": {"login": "ejba"}, "timelineItems": {"totalCount": 9, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABctXTLHABqjM0NjUyODgyNzc=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcuTIhPAFqTQzNjMzMjExNA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "eb76ffe5033680a98687eb33ad0b58651f7f73f2", "author": {"user": {"login": "ejba", "name": "Emanuel Alves"}}, "url": "https://github.com/quarkusio/quarkus/commit/eb76ffe5033680a98687eb33ad0b58651f7f73f2", "committedDate": "2020-06-21T07:21:22Z", "message": "Enable forwarded for host header configuration"}, "afterCommit": {"oid": "1283922327f5c668ff1c10bcf7ef731772609c59", "author": {"user": {"login": "ejba", "name": "Emanuel Alves"}}, "url": "https://github.com/quarkusio/quarkus/commit/1283922327f5c668ff1c10bcf7ef731772609c59", "committedDate": "2020-06-21T07:41:15Z", "message": "Enable forwarded for host header configuration"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "1283922327f5c668ff1c10bcf7ef731772609c59", "author": {"user": {"login": "ejba", "name": "Emanuel Alves"}}, "url": "https://github.com/quarkusio/quarkus/commit/1283922327f5c668ff1c10bcf7ef731772609c59", "committedDate": "2020-06-21T07:41:15Z", "message": "Enable forwarded for host header configuration"}, "afterCommit": {"oid": "4c62aec4ec21470f7cca5307928c76d6015fb0c0", "author": {"user": {"login": "ejba", "name": "Emanuel Alves"}}, "url": "https://github.com/quarkusio/quarkus/commit/4c62aec4ec21470f7cca5307928c76d6015fb0c0", "committedDate": "2020-06-21T07:42:55Z", "message": "Enable forwarded for host header configuration"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "4c62aec4ec21470f7cca5307928c76d6015fb0c0", "author": {"user": {"login": "ejba", "name": "Emanuel Alves"}}, "url": "https://github.com/quarkusio/quarkus/commit/4c62aec4ec21470f7cca5307928c76d6015fb0c0", "committedDate": "2020-06-21T07:42:55Z", "message": "Enable forwarded for host header configuration"}, "afterCommit": {"oid": "12b3076f5818abfa998454e358ad03ebe04b05ee", "author": {"user": {"login": "ejba", "name": "Emanuel Alves"}}, "url": "https://github.com/quarkusio/quarkus/commit/12b3076f5818abfa998454e358ad03ebe04b05ee", "committedDate": "2020-06-21T07:54:46Z", "message": "Enable forwarded for host header configuration"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDM0NjE5NDc2", "url": "https://github.com/quarkusio/quarkus/pull/10138#pullrequestreview-434619476", "createdAt": "2020-06-22T05:52:08Z", "commit": {"oid": "12b3076f5818abfa998454e358ad03ebe04b05ee"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yMlQwNTo1MjowOFrOGmytBw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yMlQwNTo1NjowMVrOGmyxMg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MzMyOTc5OQ==", "bodyText": "This feels a bit long, maybe 'enableForwardedHost' ?", "url": "https://github.com/quarkusio/quarkus/pull/10138#discussion_r443329799", "createdAt": "2020-06-22T05:52:08Z", "author": {"login": "stuartwdouglas"}, "path": "extensions/vertx-http/runtime/src/main/java/io/quarkus/vertx/http/runtime/ProxyConfig.java", "diffHunk": "@@ -0,0 +1,22 @@\n+package io.quarkus.vertx.http.runtime;\n+\n+import io.quarkus.runtime.annotations.ConfigGroup;\n+import io.quarkus.runtime.annotations.ConfigItem;\n+\n+/**\n+ * Holds configuration related with proxy addressing forward.\n+ */\n+@ConfigGroup\n+public class ProxyConfig {\n+    /**\n+     * Enable override the received request's host through a forwarded host header.\n+     */\n+    @ConfigItem(defaultValue = \"false\")\n+    public boolean enableForwardedForHostHeader;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "12b3076f5818abfa998454e358ad03ebe04b05ee"}, "originalPosition": 15}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MzMzMDEyMw==", "bodyText": "It would be better to do this in the recorder, and pass it into the parser, so it is only done once and not once per request.", "url": "https://github.com/quarkusio/quarkus/pull/10138#discussion_r443330123", "createdAt": "2020-06-22T05:53:24Z", "author": {"login": "stuartwdouglas"}, "path": "extensions/vertx-http/runtime/src/main/java/io/quarkus/vertx/http/runtime/ForwardedParser.java", "diffHunk": "@@ -134,9 +136,12 @@ private void calculate() {\n                 port = -1;\n             }\n \n-            String hostHeader = delegate.getHeader(X_FORWARDED_HOST);\n-            if (hostHeader != null) {\n-                setHostAndPort(hostHeader.split(\",\")[0], port);\n+            if (proxyConfig.enableForwardedForHostHeader) {\n+                AsciiString forwardedHeader = AsciiString.cached(proxyConfig.forwardedHostHeader);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "12b3076f5818abfa998454e358ad03ebe04b05ee"}, "originalPosition": 38}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MzMzMDg2Ng==", "bodyText": "I think the existing proxy config should be moved to this class as well (proxyAddressForwarding and allowForwarded).\nTo do this mark the original ones deprecated, change them to Optional, and then add new ones here. If the old ones are set then log a warning about deprecation and use those values, otherwise use the new config.", "url": "https://github.com/quarkusio/quarkus/pull/10138#discussion_r443330866", "createdAt": "2020-06-22T05:56:01Z", "author": {"login": "stuartwdouglas"}, "path": "extensions/vertx-http/runtime/src/main/java/io/quarkus/vertx/http/runtime/ProxyConfig.java", "diffHunk": "@@ -0,0 +1,22 @@\n+package io.quarkus.vertx.http.runtime;\n+\n+import io.quarkus.runtime.annotations.ConfigGroup;\n+import io.quarkus.runtime.annotations.ConfigItem;\n+\n+/**\n+ * Holds configuration related with proxy addressing forward.\n+ */\n+@ConfigGroup\n+public class ProxyConfig {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "12b3076f5818abfa998454e358ad03ebe04b05ee"}, "originalPosition": 10}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "12b3076f5818abfa998454e358ad03ebe04b05ee", "author": {"user": {"login": "ejba", "name": "Emanuel Alves"}}, "url": "https://github.com/quarkusio/quarkus/commit/12b3076f5818abfa998454e358ad03ebe04b05ee", "committedDate": "2020-06-21T07:54:46Z", "message": "Enable forwarded for host header configuration"}, "afterCommit": {"oid": "46195658aebc99708efb358ea4bfa620ff2f013e", "author": {"user": {"login": "ejba", "name": "Emanuel Alves"}}, "url": "https://github.com/quarkusio/quarkus/commit/46195658aebc99708efb358ea4bfa620ff2f013e", "committedDate": "2020-06-23T16:03:46Z", "message": "Enable forwarded for host header configuration"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "46195658aebc99708efb358ea4bfa620ff2f013e", "author": {"user": {"login": "ejba", "name": "Emanuel Alves"}}, "url": "https://github.com/quarkusio/quarkus/commit/46195658aebc99708efb358ea4bfa620ff2f013e", "committedDate": "2020-06-23T16:03:46Z", "message": "Enable forwarded for host header configuration"}, "afterCommit": {"oid": "f97a3f0e33b16c3083157c3c5a55c0ad3b09d7f2", "author": {"user": {"login": "ejba", "name": "Emanuel Alves"}}, "url": "https://github.com/quarkusio/quarkus/commit/f97a3f0e33b16c3083157c3c5a55c0ad3b09d7f2", "committedDate": "2020-06-23T16:37:50Z", "message": "Enable forwarded for host header configuration"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "626c3395e81482a55111652a8d53fac50795cebd", "author": {"user": {"login": "ejba", "name": "Emanuel Alves"}}, "url": "https://github.com/quarkusio/quarkus/commit/626c3395e81482a55111652a8d53fac50795cebd", "committedDate": "2020-06-23T19:49:04Z", "message": "Enable forwarded for host header configuration"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "f97a3f0e33b16c3083157c3c5a55c0ad3b09d7f2", "author": {"user": {"login": "ejba", "name": "Emanuel Alves"}}, "url": "https://github.com/quarkusio/quarkus/commit/f97a3f0e33b16c3083157c3c5a55c0ad3b09d7f2", "committedDate": "2020-06-23T16:37:50Z", "message": "Enable forwarded for host header configuration"}, "afterCommit": {"oid": "626c3395e81482a55111652a8d53fac50795cebd", "author": {"user": {"login": "ejba", "name": "Emanuel Alves"}}, "url": "https://github.com/quarkusio/quarkus/commit/626c3395e81482a55111652a8d53fac50795cebd", "committedDate": "2020-06-23T19:49:04Z", "message": "Enable forwarded for host header configuration"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDM2MzMyMTE0", "url": "https://github.com/quarkusio/quarkus/pull/10138#pullrequestreview-436332114", "createdAt": "2020-06-24T05:24:06Z", "commit": {"oid": "626c3395e81482a55111652a8d53fac50795cebd"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4276, "cost": 1, "resetAt": "2021-11-01T16:37:27Z"}}}