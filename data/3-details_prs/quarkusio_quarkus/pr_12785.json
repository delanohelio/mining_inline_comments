{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTA1ODU5NTg4", "number": 12785, "title": "Externalized Quarkus platform properties", "bodyText": "Introduces a Quarkus platform properties as an artifact that is configured in the dependencyManagement section of the platform BOM. There is a naming convention for the the artifactId of the platform properties artifact which is it has to end with the  quarkus-platform-properties suffix (to easily locate it among the platform dependency constraints configured in the BOM). In fact, in this PR, the artifact's GA is simply io.quarkus:quarkus-platform-properties.\nIn case multiple platform properties artifacts are found in the project's effective dependencyManagement configuration (whic could happen in case the project is importing multiple Quarkus platforms), the platform properties will be merged with the properties imported later overwriting those that are imported earlier.\nPlatform properties can be used to set the default values that are platform release-specific. E.g. quarkus.native.builder-image (in this PR the default value of this property was moved from io.quarkus.deployment.pkg.NativeConfig to io.quarkus:quarkus-platform-properties).\nFixes #11096", "createdAt": "2020-10-19T10:23:55Z", "url": "https://github.com/quarkusio/quarkus/pull/12785", "merged": true, "mergeCommit": {"oid": "1abba828f4538f7f13a829d8909792cadc126ab7"}, "closed": true, "closedAt": "2020-11-03T17:01:01Z", "author": {"login": "aloubyansky"}, "timelineItems": {"totalCount": 30, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdUBm-mAFqTUxMTYyMTY5MQ==", "endCursor": "Y3Vyc29yOnYyOpPPAAABdY6nmfAFqTUyMjU5MjA3Nw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTExNjIxNjkx", "url": "https://github.com/quarkusio/quarkus/pull/12785#pullrequestreview-511621691", "createdAt": "2020-10-19T10:28:12Z", "commit": {"oid": "398e4cee9972f80956df0245d853c071c560c274"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xOVQxMDoyODoxMlrOHkH2PQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xOVQxMDoyODoxMlrOHkH2PQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNzYzOTM1Nw==", "bodyText": "This could probably be removed. I added it to make sure the build order is always correct even when it's concurrent.", "url": "https://github.com/quarkusio/quarkus/pull/12785#discussion_r507639357", "createdAt": "2020-10-19T10:28:12Z", "author": {"login": "aloubyansky"}, "path": "core/deployment/pom.xml", "diffHunk": "@@ -15,6 +15,18 @@\n     <name>Quarkus - Core - Deployment</name>\n \n     <dependencies>\n+        <dependency>\n+            <groupId>io.quarkus</groupId>\n+            <artifactId>quarkus-platform-properties</artifactId>\n+            <type>pom</type>\n+            <version>${project.version}</version>\n+            <exclusions>\n+                <exclusion>\n+                    <groupId>*</groupId>\n+                    <artifactId>*</artifactId>\n+                </exclusion>\n+            </exclusions>\n+        </dependency>", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "398e4cee9972f80956df0245d853c071c560c274"}, "originalPosition": 15}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "398e4cee9972f80956df0245d853c071c560c274", "author": {"user": {"login": "aloubyansky", "name": "Alexey Loubyansky"}}, "url": "https://github.com/quarkusio/quarkus/commit/398e4cee9972f80956df0245d853c071c560c274", "committedDate": "2020-10-19T10:18:15Z", "message": "Introduces support for Quarkus platform properties as an artifact that is configured in the dependencyManagement section of the platform BOM.\nPlatform properties can be used to set the default values that are platform release-specific. E.g. quarkus.native.builder-image, etc"}, "afterCommit": {"oid": "49a93cf2b404cb77f8c1bd345673a59ddef49c16", "author": {"user": {"login": "aloubyansky", "name": "Alexey Loubyansky"}}, "url": "https://github.com/quarkusio/quarkus/commit/49a93cf2b404cb77f8c1bd345673a59ddef49c16", "committedDate": "2020-10-19T12:55:55Z", "message": "Introduces support for Quarkus platform properties as an artifact that is configured in the dependencyManagement section of the platform BOM.\nPlatform properties can be used to set the default values that are platform release-specific. E.g. quarkus.native.builder-image, etc"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "49a93cf2b404cb77f8c1bd345673a59ddef49c16", "author": {"user": {"login": "aloubyansky", "name": "Alexey Loubyansky"}}, "url": "https://github.com/quarkusio/quarkus/commit/49a93cf2b404cb77f8c1bd345673a59ddef49c16", "committedDate": "2020-10-19T12:55:55Z", "message": "Introduces support for Quarkus platform properties as an artifact that is configured in the dependencyManagement section of the platform BOM.\nPlatform properties can be used to set the default values that are platform release-specific. E.g. quarkus.native.builder-image, etc"}, "afterCommit": {"oid": "68d0226d3257fa6af463c39753c1c867a7a1138a", "author": {"user": {"login": "aloubyansky", "name": "Alexey Loubyansky"}}, "url": "https://github.com/quarkusio/quarkus/commit/68d0226d3257fa6af463c39753c1c867a7a1138a", "committedDate": "2020-10-19T15:54:16Z", "message": "Introduces support for Quarkus platform properties as an artifact that is configured in the dependencyManagement section of the platform BOM.\nPlatform properties can be used to set the default values that are platform release-specific. E.g. quarkus.native.builder-image, etc"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "68d0226d3257fa6af463c39753c1c867a7a1138a", "author": {"user": {"login": "aloubyansky", "name": "Alexey Loubyansky"}}, "url": "https://github.com/quarkusio/quarkus/commit/68d0226d3257fa6af463c39753c1c867a7a1138a", "committedDate": "2020-10-19T15:54:16Z", "message": "Introduces support for Quarkus platform properties as an artifact that is configured in the dependencyManagement section of the platform BOM.\nPlatform properties can be used to set the default values that are platform release-specific. E.g. quarkus.native.builder-image, etc"}, "afterCommit": {"oid": "41835820cff3630ff9f4049fe70955506b7d7aa0", "author": {"user": {"login": "aloubyansky", "name": "Alexey Loubyansky"}}, "url": "https://github.com/quarkusio/quarkus/commit/41835820cff3630ff9f4049fe70955506b7d7aa0", "committedDate": "2020-10-19T20:10:57Z", "message": "Introduces support for Quarkus platform properties as an artifact that is configured in the dependencyManagement section of the platform BOM.\nPlatform properties can be used to set the default values that are platform release-specific. E.g. quarkus.native.builder-image, etc"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTEyNjQ2NTA5", "url": "https://github.com/quarkusio/quarkus/pull/12785#pullrequestreview-512646509", "createdAt": "2020-10-20T12:23:27Z", "commit": {"oid": "41835820cff3630ff9f4049fe70955506b7d7aa0"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yMFQxMjoyMzoyOFrOHk5nhw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yMFQxMjoyMzoyOFrOHk5nhw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwODQ1NDc5MQ==", "bodyText": "should be endsWith, right?", "url": "https://github.com/quarkusio/quarkus/pull/12785#discussion_r508454791", "createdAt": "2020-10-20T12:23:28Z", "author": {"login": "michalszynkiewicz"}, "path": "independent-projects/bootstrap/maven-resolver/src/main/java/io/quarkus/bootstrap/resolver/BootstrapAppModelResolver.java", "diffHunk": "@@ -281,6 +291,31 @@ public boolean visitLeave(DependencyNode node) {\n                 .build();\n     }\n \n+    private void collectPlatformProperties(AppModel.Builder appBuilder, List<Dependency> managedDeps)\n+            throws AppModelResolverException {\n+        for (Dependency d : managedDeps) {\n+            // assuming platform properties artifacts have the same reserved groupId\n+            Artifact artifact = d.getArtifact();\n+            if (artifact.getArtifactId().contains(BootstrapConstants.PLATFORM_PROPERTIES_ARTIFACT_ID_SUFFIX)) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "41835820cff3630ff9f4049fe70955506b7d7aa0"}, "originalPosition": 44}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "41835820cff3630ff9f4049fe70955506b7d7aa0", "author": {"user": {"login": "aloubyansky", "name": "Alexey Loubyansky"}}, "url": "https://github.com/quarkusio/quarkus/commit/41835820cff3630ff9f4049fe70955506b7d7aa0", "committedDate": "2020-10-19T20:10:57Z", "message": "Introduces support for Quarkus platform properties as an artifact that is configured in the dependencyManagement section of the platform BOM.\nPlatform properties can be used to set the default values that are platform release-specific. E.g. quarkus.native.builder-image, etc"}, "afterCommit": {"oid": "9da89271cb0bb351742e280c2582048dcf1ff820", "author": {"user": {"login": "aloubyansky", "name": "Alexey Loubyansky"}}, "url": "https://github.com/quarkusio/quarkus/commit/9da89271cb0bb351742e280c2582048dcf1ff820", "committedDate": "2020-10-20T14:22:57Z", "message": "Introduces support for Quarkus platform properties as an artifact that is configured in the dependencyManagement section of the platform BOM.\nPlatform properties can be used to set the default values that are platform release-specific. E.g. quarkus.native.builder-image, etc"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTEyODIyMDQ0", "url": "https://github.com/quarkusio/quarkus/pull/12785#pullrequestreview-512822044", "createdAt": "2020-10-20T15:04:42Z", "commit": {"oid": "9da89271cb0bb351742e280c2582048dcf1ff820"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yMFQxNTowNDo0M1rOHlBxaA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yMFQxNTowNDo0M1rOHlBxaA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwODU4ODM5Mg==", "bodyText": "is the extension here the file extension?", "url": "https://github.com/quarkusio/quarkus/pull/12785#discussion_r508588392", "createdAt": "2020-10-20T15:04:43Z", "author": {"login": "michalszynkiewicz"}, "path": "independent-projects/bootstrap/maven-resolver/src/main/java/io/quarkus/bootstrap/resolver/BootstrapAppModelResolver.java", "diffHunk": "@@ -281,6 +291,31 @@ public boolean visitLeave(DependencyNode node) {\n                 .build();\n     }\n \n+    private void collectPlatformProperties(AppModel.Builder appBuilder, List<Dependency> managedDeps)\n+            throws AppModelResolverException {\n+        for (Dependency d : managedDeps) {\n+            // assuming platform properties artifacts have the same reserved groupId\n+            Artifact artifact = d.getArtifact();\n+            if (artifact.getArtifactId().endsWith(BootstrapConstants.PLATFORM_PROPERTIES_ARTIFACT_ID_SUFFIX)) {\n+                final AppArtifact appArtifact = artifact.getExtension().equals(\"properties\") ? toAppArtifact(artifact)", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "9da89271cb0bb351742e280c2582048dcf1ff820"}, "originalPosition": 45}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTEyODIzMjIw", "url": "https://github.com/quarkusio/quarkus/pull/12785#pullrequestreview-512823220", "createdAt": "2020-10-20T15:05:49Z", "commit": {"oid": "9da89271cb0bb351742e280c2582048dcf1ff820"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yMFQxNTowNTo0OVrOHlB0wg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yMFQxNTowNTo0OVrOHlB0wg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwODU4OTI1MA==", "bodyText": "creating new AppArtifact looks a bit weird to me. When will it be necessary to create it? Are we sure that resolve(appArtifact) in this case returns an existing thing?", "url": "https://github.com/quarkusio/quarkus/pull/12785#discussion_r508589250", "createdAt": "2020-10-20T15:05:49Z", "author": {"login": "michalszynkiewicz"}, "path": "independent-projects/bootstrap/maven-resolver/src/main/java/io/quarkus/bootstrap/resolver/BootstrapAppModelResolver.java", "diffHunk": "@@ -281,6 +291,31 @@ public boolean visitLeave(DependencyNode node) {\n                 .build();\n     }\n \n+    private void collectPlatformProperties(AppModel.Builder appBuilder, List<Dependency> managedDeps)\n+            throws AppModelResolverException {\n+        for (Dependency d : managedDeps) {\n+            // assuming platform properties artifacts have the same reserved groupId\n+            Artifact artifact = d.getArtifact();\n+            if (artifact.getArtifactId().endsWith(BootstrapConstants.PLATFORM_PROPERTIES_ARTIFACT_ID_SUFFIX)) {\n+                final AppArtifact appArtifact = artifact.getExtension().equals(\"properties\") ? toAppArtifact(artifact)\n+                        : new AppArtifact(artifact.getGroupId(), artifact.getArtifactId(), artifact.getClassifier(),", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "9da89271cb0bb351742e280c2582048dcf1ff820"}, "originalPosition": 46}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTEyODIzMzQ0", "url": "https://github.com/quarkusio/quarkus/pull/12785#pullrequestreview-512823344", "createdAt": "2020-10-20T15:05:56Z", "commit": {"oid": "9da89271cb0bb351742e280c2582048dcf1ff820"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yMFQxNTowNTo1NlrOHlB1Lg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yMFQxNTowNTo1NlrOHlB1Lg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwODU4OTM1OA==", "bodyText": "where is this assumption in the code?", "url": "https://github.com/quarkusio/quarkus/pull/12785#discussion_r508589358", "createdAt": "2020-10-20T15:05:56Z", "author": {"login": "michalszynkiewicz"}, "path": "independent-projects/bootstrap/maven-resolver/src/main/java/io/quarkus/bootstrap/resolver/BootstrapAppModelResolver.java", "diffHunk": "@@ -281,6 +291,31 @@ public boolean visitLeave(DependencyNode node) {\n                 .build();\n     }\n \n+    private void collectPlatformProperties(AppModel.Builder appBuilder, List<Dependency> managedDeps)\n+            throws AppModelResolverException {\n+        for (Dependency d : managedDeps) {\n+            // assuming platform properties artifacts have the same reserved groupId", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "9da89271cb0bb351742e280c2582048dcf1ff820"}, "originalPosition": 42}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "9da89271cb0bb351742e280c2582048dcf1ff820", "author": {"user": {"login": "aloubyansky", "name": "Alexey Loubyansky"}}, "url": "https://github.com/quarkusio/quarkus/commit/9da89271cb0bb351742e280c2582048dcf1ff820", "committedDate": "2020-10-20T14:22:57Z", "message": "Introduces support for Quarkus platform properties as an artifact that is configured in the dependencyManagement section of the platform BOM.\nPlatform properties can be used to set the default values that are platform release-specific. E.g. quarkus.native.builder-image, etc"}, "afterCommit": {"oid": "2709fab70cc26ba73cf4e93869707e50cf8dc272", "author": {"user": {"login": "aloubyansky", "name": "Alexey Loubyansky"}}, "url": "https://github.com/quarkusio/quarkus/commit/2709fab70cc26ba73cf4e93869707e50cf8dc272", "committedDate": "2020-10-20T15:18:16Z", "message": "Introduces support for Quarkus platform properties as an artifact that is configured in the dependencyManagement section of the platform BOM.\nPlatform properties can be used to set the default values that are platform release-specific. E.g. quarkus.native.builder-image, etc"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "2709fab70cc26ba73cf4e93869707e50cf8dc272", "author": {"user": {"login": "aloubyansky", "name": "Alexey Loubyansky"}}, "url": "https://github.com/quarkusio/quarkus/commit/2709fab70cc26ba73cf4e93869707e50cf8dc272", "committedDate": "2020-10-20T15:18:16Z", "message": "Introduces support for Quarkus platform properties as an artifact that is configured in the dependencyManagement section of the platform BOM.\nPlatform properties can be used to set the default values that are platform release-specific. E.g. quarkus.native.builder-image, etc"}, "afterCommit": {"oid": "2f82434b4ff204340b43e24b085f94171d5a4488", "author": {"user": {"login": "aloubyansky", "name": "Alexey Loubyansky"}}, "url": "https://github.com/quarkusio/quarkus/commit/2f82434b4ff204340b43e24b085f94171d5a4488", "committedDate": "2020-10-20T15:19:17Z", "message": "Introduces support for Quarkus platform properties as an artifact that is configured in the dependencyManagement section of the platform BOM.\nPlatform properties can be used to set the default values that are platform release-specific. E.g. quarkus.native.builder-image, etc"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "2f82434b4ff204340b43e24b085f94171d5a4488", "author": {"user": {"login": "aloubyansky", "name": "Alexey Loubyansky"}}, "url": "https://github.com/quarkusio/quarkus/commit/2f82434b4ff204340b43e24b085f94171d5a4488", "committedDate": "2020-10-20T15:19:17Z", "message": "Introduces support for Quarkus platform properties as an artifact that is configured in the dependencyManagement section of the platform BOM.\nPlatform properties can be used to set the default values that are platform release-specific. E.g. quarkus.native.builder-image, etc"}, "afterCommit": {"oid": "7ea9a180e56c2e1b07de0ffaa56d02ff354990f2", "author": {"user": {"login": "aloubyansky", "name": "Alexey Loubyansky"}}, "url": "https://github.com/quarkusio/quarkus/commit/7ea9a180e56c2e1b07de0ffaa56d02ff354990f2", "committedDate": "2020-10-20T19:48:16Z", "message": "Introduces support for Quarkus platform properties as an artifact that is configured in the dependencyManagement section of the platform BOM.\nPlatform properties can be used to set the default values that are platform release-specific. E.g. quarkus.native.builder-image, etc"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "7ea9a180e56c2e1b07de0ffaa56d02ff354990f2", "author": {"user": {"login": "aloubyansky", "name": "Alexey Loubyansky"}}, "url": "https://github.com/quarkusio/quarkus/commit/7ea9a180e56c2e1b07de0ffaa56d02ff354990f2", "committedDate": "2020-10-20T19:48:16Z", "message": "Introduces support for Quarkus platform properties as an artifact that is configured in the dependencyManagement section of the platform BOM.\nPlatform properties can be used to set the default values that are platform release-specific. E.g. quarkus.native.builder-image, etc"}, "afterCommit": {"oid": "034d49deaeba84a3deede9e5f1720ee0cf1e72ee", "author": {"user": {"login": "aloubyansky", "name": "Alexey Loubyansky"}}, "url": "https://github.com/quarkusio/quarkus/commit/034d49deaeba84a3deede9e5f1720ee0cf1e72ee", "committedDate": "2020-10-21T04:25:21Z", "message": "Introduces support for Quarkus platform properties as an artifact that is configured in the dependencyManagement section of the platform BOM.\nPlatform properties can be used to set the default values that are platform release-specific. E.g. quarkus.native.builder-image, etc"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTEzNjUwNDA2", "url": "https://github.com/quarkusio/quarkus/pull/12785#pullrequestreview-513650406", "createdAt": "2020-10-21T13:02:09Z", "commit": {"oid": "034d49deaeba84a3deede9e5f1720ee0cf1e72ee"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "034d49deaeba84a3deede9e5f1720ee0cf1e72ee", "author": {"user": {"login": "aloubyansky", "name": "Alexey Loubyansky"}}, "url": "https://github.com/quarkusio/quarkus/commit/034d49deaeba84a3deede9e5f1720ee0cf1e72ee", "committedDate": "2020-10-21T04:25:21Z", "message": "Introduces support for Quarkus platform properties as an artifact that is configured in the dependencyManagement section of the platform BOM.\nPlatform properties can be used to set the default values that are platform release-specific. E.g. quarkus.native.builder-image, etc"}, "afterCommit": {"oid": "16fdeeaefa1e449338fc8e4a7393ed6d10d5eb0d", "author": {"user": {"login": "aloubyansky", "name": "Alexey Loubyansky"}}, "url": "https://github.com/quarkusio/quarkus/commit/16fdeeaefa1e449338fc8e4a7393ed6d10d5eb0d", "committedDate": "2020-10-27T10:34:58Z", "message": "Introduces support for Quarkus platform properties as an artifact that is configured in the dependencyManagement section of the platform BOM.\nPlatform properties can be used to set the default values that are platform release-specific. E.g. quarkus.native.builder-image, etc"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "16fdeeaefa1e449338fc8e4a7393ed6d10d5eb0d", "author": {"user": {"login": "aloubyansky", "name": "Alexey Loubyansky"}}, "url": "https://github.com/quarkusio/quarkus/commit/16fdeeaefa1e449338fc8e4a7393ed6d10d5eb0d", "committedDate": "2020-10-27T10:34:58Z", "message": "Introduces support for Quarkus platform properties as an artifact that is configured in the dependencyManagement section of the platform BOM.\nPlatform properties can be used to set the default values that are platform release-specific. E.g. quarkus.native.builder-image, etc"}, "afterCommit": {"oid": "0c8117819e193e177a809fca6ef08fa07d2b9e19", "author": {"user": {"login": "aloubyansky", "name": "Alexey Loubyansky"}}, "url": "https://github.com/quarkusio/quarkus/commit/0c8117819e193e177a809fca6ef08fa07d2b9e19", "committedDate": "2020-10-27T11:25:44Z", "message": "Introduces support for Quarkus platform properties as an artifact that is configured in the dependencyManagement section of the platform BOM.\nPlatform properties can be used to set the default values that are platform release-specific. E.g. quarkus.native.builder-image, etc"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "0c8117819e193e177a809fca6ef08fa07d2b9e19", "author": {"user": {"login": "aloubyansky", "name": "Alexey Loubyansky"}}, "url": "https://github.com/quarkusio/quarkus/commit/0c8117819e193e177a809fca6ef08fa07d2b9e19", "committedDate": "2020-10-27T11:25:44Z", "message": "Introduces support for Quarkus platform properties as an artifact that is configured in the dependencyManagement section of the platform BOM.\nPlatform properties can be used to set the default values that are platform release-specific. E.g. quarkus.native.builder-image, etc"}, "afterCommit": {"oid": "91aaaa891b73f363495e6e99d0c1176a42f3bc00", "author": {"user": {"login": "aloubyansky", "name": "Alexey Loubyansky"}}, "url": "https://github.com/quarkusio/quarkus/commit/91aaaa891b73f363495e6e99d0c1176a42f3bc00", "committedDate": "2020-10-28T14:29:35Z", "message": "Introduces support for Quarkus platform properties as an artifact that is configured in the dependencyManagement section of the platform BOM.\nPlatform properties can be used to set the default values that are platform release-specific. E.g. quarkus.native.builder-image, etc"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "91aaaa891b73f363495e6e99d0c1176a42f3bc00", "author": {"user": {"login": "aloubyansky", "name": "Alexey Loubyansky"}}, "url": "https://github.com/quarkusio/quarkus/commit/91aaaa891b73f363495e6e99d0c1176a42f3bc00", "committedDate": "2020-10-28T14:29:35Z", "message": "Introduces support for Quarkus platform properties as an artifact that is configured in the dependencyManagement section of the platform BOM.\nPlatform properties can be used to set the default values that are platform release-specific. E.g. quarkus.native.builder-image, etc"}, "afterCommit": {"oid": "54cb0a545d87365e18e2e5ce3ba166b6b8d176ca", "author": {"user": {"login": "aloubyansky", "name": "Alexey Loubyansky"}}, "url": "https://github.com/quarkusio/quarkus/commit/54cb0a545d87365e18e2e5ce3ba166b6b8d176ca", "committedDate": "2020-10-28T15:03:10Z", "message": "Introduces support for Quarkus platform properties as an artifact that is configured in the dependencyManagement section of the platform BOM.\nPlatform properties can be used to set the default values that are platform release-specific. E.g. quarkus.native.builder-image, etc"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTIwMDQzMDc5", "url": "https://github.com/quarkusio/quarkus/pull/12785#pullrequestreview-520043079", "createdAt": "2020-10-29T20:11:06Z", "commit": {"oid": "54cb0a545d87365e18e2e5ce3ba166b6b8d176ca"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yOVQyMDoxMTowN1rOHqs2pw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yOVQyMDoxMTowN1rOHqs2pw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNDUzNzEyNw==", "bodyText": "Since these would be default values, they should have a low ordinal.  The constant DEFAULT_ORDINAL is the default ordinal for config sources, not the ordinal for default config sources, in case that was a point of confusion.  Using the default ordinal means that the defaults may take precedence over some explicitly configured values.\nOur default value configuration source is using an ordinal of Integer.MIN_VALUE (see io.quarkus.deployment.configuration.DefaultValuesConfigurationSource), so I think it would be appropriate to use, say, Integer.MIN_VALUE + 1000 or something along those lines.", "url": "https://github.com/quarkusio/quarkus/pull/12785#discussion_r514537127", "createdAt": "2020-10-29T20:11:07Z", "author": {"login": "dmlloyd"}, "path": "core/deployment/src/main/java/io/quarkus/deployment/ExtensionLoader.java", "diffHunk": "@@ -183,9 +201,11 @@ private static boolean isRecorder(AnnotatedElement element) {\n                 reader.getBuildTimePatternMap());\n         final DefaultValuesConfigurationSource ds2 = new DefaultValuesConfigurationSource(\n                 reader.getBuildTimeRunTimePatternMap());\n+        final PropertiesConfigSource platformConfigSource = new PropertiesConfigSource(platformProperties, \"Quarkus platform\",\n+                ConfigSource.DEFAULT_ORDINAL);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "54cb0a545d87365e18e2e5ce3ba166b6b8d176ca"}, "originalPosition": 38}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "54cb0a545d87365e18e2e5ce3ba166b6b8d176ca", "author": {"user": {"login": "aloubyansky", "name": "Alexey Loubyansky"}}, "url": "https://github.com/quarkusio/quarkus/commit/54cb0a545d87365e18e2e5ce3ba166b6b8d176ca", "committedDate": "2020-10-28T15:03:10Z", "message": "Introduces support for Quarkus platform properties as an artifact that is configured in the dependencyManagement section of the platform BOM.\nPlatform properties can be used to set the default values that are platform release-specific. E.g. quarkus.native.builder-image, etc"}, "afterCommit": {"oid": "c80abf192db8c8271990583420fb7ad6ae3cdeec", "author": {"user": {"login": "aloubyansky", "name": "Alexey Loubyansky"}}, "url": "https://github.com/quarkusio/quarkus/commit/c80abf192db8c8271990583420fb7ad6ae3cdeec", "committedDate": "2020-10-30T17:38:49Z", "message": "Introduces support for Quarkus platform properties as an artifact that is configured in the dependencyManagement section of the platform BOM.\nPlatform properties can be used to set the default values that are platform release-specific. E.g. quarkus.native.builder-image, etc"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "d840cb9abb31b4f816a50be8a03f33e3b042ad4e", "author": {"user": {"login": "aloubyansky", "name": "Alexey Loubyansky"}}, "url": "https://github.com/quarkusio/quarkus/commit/d840cb9abb31b4f816a50be8a03f33e3b042ad4e", "committedDate": "2020-10-30T21:12:29Z", "message": "Require platform properties to have the 'platform.' prefix"}, "afterCommit": {"oid": "7639267f7f9c077d0bd7f95247ef0092b1682eed", "author": {"user": {"login": "aloubyansky", "name": "Alexey Loubyansky"}}, "url": "https://github.com/quarkusio/quarkus/commit/7639267f7f9c077d0bd7f95247ef0092b1682eed", "committedDate": "2020-11-02T13:55:17Z", "message": "Require platform properties to have the 'platform.' prefix"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "7639267f7f9c077d0bd7f95247ef0092b1682eed", "author": {"user": {"login": "aloubyansky", "name": "Alexey Loubyansky"}}, "url": "https://github.com/quarkusio/quarkus/commit/7639267f7f9c077d0bd7f95247ef0092b1682eed", "committedDate": "2020-11-02T13:55:17Z", "message": "Require platform properties to have the 'platform.' prefix"}, "afterCommit": {"oid": "29fcbf48ac8a88bfa6d249d98b656f3991ca7349", "author": {"user": {"login": "aloubyansky", "name": "Alexey Loubyansky"}}, "url": "https://github.com/quarkusio/quarkus/commit/29fcbf48ac8a88bfa6d249d98b656f3991ca7349", "committedDate": "2020-11-02T17:48:53Z", "message": "Introduces support for Quarkus platform properties as an artifact that is configured in the dependencyManagement section of the platform BOM.\nPlatform properties can be used to set the default values that are platform release-specific. E.g. quarkus.native.builder-image, etc"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTIxOTY1OTY0", "url": "https://github.com/quarkusio/quarkus/pull/12785#pullrequestreview-521965964", "createdAt": "2020-11-02T20:23:01Z", "commit": {"oid": "29fcbf48ac8a88bfa6d249d98b656f3991ca7349"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wMlQyMDoyMzowMVrOHsUWcw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wMlQyMDoyMzowMVrOHsUWcw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNjIzMjgxOQ==", "bodyText": "I was thinking about this further and I had a concern.  The platform configuration source most likely should be based on a io.smallrye.config.KeyMapBackedConfigSource which can have a default value that matches a pattern.  This would allow configuration keys which have map key components to have a default value.", "url": "https://github.com/quarkusio/quarkus/pull/12785#discussion_r516232819", "createdAt": "2020-11-02T20:23:01Z", "author": {"login": "dmlloyd"}, "path": "core/deployment/src/main/java/io/quarkus/deployment/ExtensionLoader.java", "diffHunk": "@@ -183,9 +200,13 @@ private static boolean isRecorder(AnnotatedElement element) {\n                 reader.getBuildTimePatternMap());\n         final DefaultValuesConfigurationSource ds2 = new DefaultValuesConfigurationSource(\n                 reader.getBuildTimeRunTimePatternMap());\n+        final PropertiesConfigSource platformConfigSource = new PropertiesConfigSource(platformProperties, \"Quarkus platform\",\n+                // Our default value configuration source is using an ordinal of Integer.MIN_VALUE\n+                // (see io.quarkus.deployment.configuration.DefaultValuesConfigurationSource)\n+                Integer.MIN_VALUE + 1000);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "29fcbf48ac8a88bfa6d249d98b656f3991ca7349"}, "originalPosition": 32}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "29fcbf48ac8a88bfa6d249d98b656f3991ca7349", "author": {"user": {"login": "aloubyansky", "name": "Alexey Loubyansky"}}, "url": "https://github.com/quarkusio/quarkus/commit/29fcbf48ac8a88bfa6d249d98b656f3991ca7349", "committedDate": "2020-11-02T17:48:53Z", "message": "Introduces support for Quarkus platform properties as an artifact that is configured in the dependencyManagement section of the platform BOM.\nPlatform properties can be used to set the default values that are platform release-specific. E.g. quarkus.native.builder-image, etc"}, "afterCommit": {"oid": "e62b22e62999f09eec5b53ca36af2f4e8fb1443e", "author": {"user": {"login": "aloubyansky", "name": "Alexey Loubyansky"}}, "url": "https://github.com/quarkusio/quarkus/commit/e62b22e62999f09eec5b53ca36af2f4e8fb1443e", "committedDate": "2020-11-03T09:00:04Z", "message": "Introduces support for Quarkus platform properties as an artifact that is configured in the dependencyManagement section of the platform BOM.\nPlatform properties can be used to set the default values that are platform release-specific. E.g. quarkus.native.builder-image, etc"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "e62b22e62999f09eec5b53ca36af2f4e8fb1443e", "author": {"user": {"login": "aloubyansky", "name": "Alexey Loubyansky"}}, "url": "https://github.com/quarkusio/quarkus/commit/e62b22e62999f09eec5b53ca36af2f4e8fb1443e", "committedDate": "2020-11-03T09:00:04Z", "message": "Introduces support for Quarkus platform properties as an artifact that is configured in the dependencyManagement section of the platform BOM.\nPlatform properties can be used to set the default values that are platform release-specific. E.g. quarkus.native.builder-image, etc"}, "afterCommit": {"oid": "4fe2adf7cbba95fc0bb95df6c038198508fcfdab", "author": {"user": {"login": "aloubyansky", "name": "Alexey Loubyansky"}}, "url": "https://github.com/quarkusio/quarkus/commit/4fe2adf7cbba95fc0bb95df6c038198508fcfdab", "committedDate": "2020-11-03T09:04:07Z", "message": "Introduces support for Quarkus platform properties as an artifact that is configured in the dependencyManagement section of the platform BOM.\nPlatform properties can be used to set the default values that are platform release-specific. E.g. quarkus.native.builder-image, etc"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTIyMjk1NzMy", "url": "https://github.com/quarkusio/quarkus/pull/12785#pullrequestreview-522295732", "createdAt": "2020-11-03T09:05:53Z", "commit": {"oid": "4fe2adf7cbba95fc0bb95df6c038198508fcfdab"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wM1QwOTowNTo1M1rOHslcUg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wM1QwOTowNTo1M1rOHslcUg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNjUxMjg1MA==", "bodyText": "@dmlloyd is this looking ok?", "url": "https://github.com/quarkusio/quarkus/pull/12785#discussion_r516512850", "createdAt": "2020-11-03T09:05:53Z", "author": {"login": "aloubyansky"}, "path": "core/deployment/src/main/java/io/quarkus/deployment/ExtensionLoader.java", "diffHunk": "@@ -184,8 +203,19 @@ private static boolean isRecorder(AnnotatedElement element) {\n         final DefaultValuesConfigurationSource ds2 = new DefaultValuesConfigurationSource(\n                 reader.getBuildTimeRunTimePatternMap());\n         final PropertiesConfigSource pcs = new PropertiesConfigSource(buildSystemProps, \"Build system\");\n-\n-        builder.withSources(ds1, ds2, pcs);\n+        if (platformProperties.isEmpty()) {\n+            builder.withSources(ds1, ds2, pcs);\n+        } else {\n+            final KeyMap<String> props = new KeyMap<>(platformProperties.size());\n+            for (Map.Entry<String, String> prop : platformProperties.entrySet()) {\n+                props.findOrAdd(prop.getKey().split(\"\\\\.\")).putRootValue(prop.getValue());\n+            }\n+            final KeyMapBackedConfigSource platformConfigSource = new KeyMapBackedConfigSource(\"Quarkus platform\",\n+                    // Our default value configuration source is using an ordinal of Integer.MIN_VALUE\n+                    // (see io.quarkus.deployment.configuration.DefaultValuesConfigurationSource)\n+                    Integer.MIN_VALUE + 1000, props);\n+            builder.withSources(ds1, ds2, platformConfigSource, pcs);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "4fe2adf7cbba95fc0bb95df6c038198508fcfdab"}, "originalPosition": 51}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTIyNDY3NTQ2", "url": "https://github.com/quarkusio/quarkus/pull/12785#pullrequestreview-522467546", "createdAt": "2020-11-03T12:56:37Z", "commit": {"oid": "4fe2adf7cbba95fc0bb95df6c038198508fcfdab"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wM1QxMjo1NjozOFrOHstkXQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wM1QxMjo1NjozOFrOHstkXQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNjY0NTk4MQ==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                            props.findOrAdd(prop.getKey().split(\"\\\\.\")).putRootValue(prop.getValue());\n          \n          \n            \n                            props.findOrAdd(new NameIterator(prop.getKey())).putRootValue(prop.getValue());\n          \n      \n    \n    \n  \n\nYou'll have to add an import for NameIterator too.  But it occurred to me that NameIterator already handles interior \" and escaping for you, and is more efficient than split anyway.", "url": "https://github.com/quarkusio/quarkus/pull/12785#discussion_r516645981", "createdAt": "2020-11-03T12:56:38Z", "author": {"login": "dmlloyd"}, "path": "core/deployment/src/main/java/io/quarkus/deployment/ExtensionLoader.java", "diffHunk": "@@ -184,8 +203,19 @@ private static boolean isRecorder(AnnotatedElement element) {\n         final DefaultValuesConfigurationSource ds2 = new DefaultValuesConfigurationSource(\n                 reader.getBuildTimeRunTimePatternMap());\n         final PropertiesConfigSource pcs = new PropertiesConfigSource(buildSystemProps, \"Build system\");\n-\n-        builder.withSources(ds1, ds2, pcs);\n+        if (platformProperties.isEmpty()) {\n+            builder.withSources(ds1, ds2, pcs);\n+        } else {\n+            final KeyMap<String> props = new KeyMap<>(platformProperties.size());\n+            for (Map.Entry<String, String> prop : platformProperties.entrySet()) {\n+                props.findOrAdd(prop.getKey().split(\"\\\\.\")).putRootValue(prop.getValue());", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "4fe2adf7cbba95fc0bb95df6c038198508fcfdab"}, "originalPosition": 45}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "3d6574f9f000816e09d43150362c52901bb5d773", "author": {"user": {"login": "aloubyansky", "name": "Alexey Loubyansky"}}, "url": "https://github.com/quarkusio/quarkus/commit/3d6574f9f000816e09d43150362c52901bb5d773", "committedDate": "2020-11-03T14:36:46Z", "message": "Introduces support for Quarkus platform properties as an artifact that is configured in the dependencyManagement section of the platform BOM.\nPlatform properties can be used to set the default values that are platform release-specific. E.g. quarkus.native.builder-image, etc"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "4fe2adf7cbba95fc0bb95df6c038198508fcfdab", "author": {"user": {"login": "aloubyansky", "name": "Alexey Loubyansky"}}, "url": "https://github.com/quarkusio/quarkus/commit/4fe2adf7cbba95fc0bb95df6c038198508fcfdab", "committedDate": "2020-11-03T09:04:07Z", "message": "Introduces support for Quarkus platform properties as an artifact that is configured in the dependencyManagement section of the platform BOM.\nPlatform properties can be used to set the default values that are platform release-specific. E.g. quarkus.native.builder-image, etc"}, "afterCommit": {"oid": "3d6574f9f000816e09d43150362c52901bb5d773", "author": {"user": {"login": "aloubyansky", "name": "Alexey Loubyansky"}}, "url": "https://github.com/quarkusio/quarkus/commit/3d6574f9f000816e09d43150362c52901bb5d773", "committedDate": "2020-11-03T14:36:46Z", "message": "Introduces support for Quarkus platform properties as an artifact that is configured in the dependencyManagement section of the platform BOM.\nPlatform properties can be used to set the default values that are platform release-specific. E.g. quarkus.native.builder-image, etc"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTIyNTkyMDc3", "url": "https://github.com/quarkusio/quarkus/pull/12785#pullrequestreview-522592077", "createdAt": "2020-11-03T15:09:10Z", "commit": {"oid": "3d6574f9f000816e09d43150362c52901bb5d773"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1641, "cost": 1, "resetAt": "2021-11-01T16:37:27Z"}}}