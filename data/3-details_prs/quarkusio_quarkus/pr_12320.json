{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDkyNDYzNDcz", "number": 12320, "title": "Support OIDC hybrid application type", "bodyText": "Fixes #12297\nThis PR introduces a hybrid application type. Effectively it allows the users to optimize the configuration, collapse 2 nearly identical tenant configuration into one, see the test, tenant-hybrid-webapp + tenant-hybrid-service vs a single tenant-hybrid-webapp-service in the situations where a user wants to drive the authentication based on the presence of the Authorization header. If it is set - it is Bearer auth, if not - code flow.\nThis is a visible optimization and to be honest I'd not be too keen on it because one can just avoid this static configuration duplication with TenantConfigResolver but the main saving comes from sharing a single Keycloak connection.\nWhen we have 2 tenants then per every tenant there will be its own Vert.X OAuth connection - which is fine when one has different realms, but in this case, one would also have a duplicate local JWT set copy, which is sub-optimal.\nSo, hybrid does not introduce any new flow, it simply allows to optimize the way the 2 tenants which differ only by its type (service vs web-app) can be configured", "createdAt": "2020-09-24T13:51:28Z", "url": "https://github.com/quarkusio/quarkus/pull/12320", "merged": true, "mergeCommit": {"oid": "138acdb67e8eeace9cfe4ad306a3c3f2b76a9f64"}, "closed": true, "closedAt": "2020-09-29T09:24:54Z", "author": {"login": "sberyozkin"}, "timelineItems": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdMEfVFABqjM4MDQyODUyMzA=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdNchpwgFqTQ5Nzk3MjY5Mw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "78c6738b7536b1acd09dab6f72ffb748819da903", "author": {"user": {"login": "sberyozkin", "name": null}}, "url": "https://github.com/quarkusio/quarkus/commit/78c6738b7536b1acd09dab6f72ffb748819da903", "committedDate": "2020-09-24T13:35:50Z", "message": "Support OIDC hybrid application type"}, "afterCommit": {"oid": "e1269c45c00bab359ce179eb51f5f5267d8c097a", "author": {"user": {"login": "sberyozkin", "name": null}}, "url": "https://github.com/quarkusio/quarkus/commit/e1269c45c00bab359ce179eb51f5f5267d8c097a", "committedDate": "2020-09-24T17:16:55Z", "message": "Support OIDC hybrid application type"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDk3NDEzNTkw", "url": "https://github.com/quarkusio/quarkus/pull/12320#pullrequestreview-497413590", "createdAt": "2020-09-28T11:17:01Z", "commit": {"oid": "e1269c45c00bab359ce179eb51f5f5267d8c097a"}, "state": "APPROVED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yOFQxMToxNzowMVrOHY5JRg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yOFQxMToxNzowMVrOHY5JRg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NTg2NDEzNA==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                        return context.request().getHeader(\"Authorization\") == null ? true : false;\n          \n          \n            \n                        return context.request().getHeader(\"Authorization\") == null;", "url": "https://github.com/quarkusio/quarkus/pull/12320#discussion_r495864134", "createdAt": "2020-09-28T11:17:01Z", "author": {"login": "pedroigor"}, "path": "extensions/oidc/runtime/src/main/java/io/quarkus/oidc/runtime/OidcAuthenticationMechanism.java", "diffHunk": "@@ -55,7 +55,10 @@ private TenantConfigContext resolve(RoutingContext context) {\n         return tenantContext;\n     }\n \n-    private boolean isWebApp(TenantConfigContext tenantContext) {\n+    private boolean isWebApp(RoutingContext context, TenantConfigContext tenantContext) {\n+        if (OidcTenantConfig.ApplicationType.HYBRID == tenantContext.oidcConfig.applicationType) {\n+            return context.request().getHeader(\"Authorization\") == null ? true : false;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e1269c45c00bab359ce179eb51f5f5267d8c097a"}, "originalPosition": 25}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ea6a6a26fa045e20c146fb60a1b7c28e30d3c660", "author": {"user": {"login": "sberyozkin", "name": null}}, "url": "https://github.com/quarkusio/quarkus/commit/ea6a6a26fa045e20c146fb60a1b7c28e30d3c660", "committedDate": "2020-09-28T15:43:45Z", "message": "Support OIDC hybrid application type"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "7df9f0e51f7650bc57ca04a31753e5fb4af9ad99", "author": {"user": {"login": "sberyozkin", "name": null}}, "url": "https://github.com/quarkusio/quarkus/commit/7df9f0e51f7650bc57ca04a31753e5fb4af9ad99", "committedDate": "2020-09-28T15:42:23Z", "message": "Update extensions/oidc/runtime/src/main/java/io/quarkus/oidc/runtime/OidcAuthenticationMechanism.java\n\nCo-authored-by: Pedro Igor <pigor.craveiro@gmail.com>"}, "afterCommit": {"oid": "ea6a6a26fa045e20c146fb60a1b7c28e30d3c660", "author": {"user": {"login": "sberyozkin", "name": null}}, "url": "https://github.com/quarkusio/quarkus/commit/ea6a6a26fa045e20c146fb60a1b7c28e30d3c660", "committedDate": "2020-09-28T15:43:45Z", "message": "Support OIDC hybrid application type"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDk3OTcyNjkz", "url": "https://github.com/quarkusio/quarkus/pull/12320#pullrequestreview-497972693", "createdAt": "2020-09-28T23:52:21Z", "commit": {"oid": "ea6a6a26fa045e20c146fb60a1b7c28e30d3c660"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 427, "cost": 1, "resetAt": "2021-11-01T16:37:27Z"}}}