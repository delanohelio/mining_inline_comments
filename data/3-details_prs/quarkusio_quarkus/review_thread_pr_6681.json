{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0MzY1Mjg0NjAw", "number": 6681, "reviewThreads": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yMVQxMzo1MDo0OVrODZf2YQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yMVQxNjoxNzoyOVrODZjS4Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjI4MDYyODE3OnYy", "diffSide": "RIGHT", "path": "core/runtime/src/main/java/io/quarkus/runtime/configuration/LocaleConverter.java", "isResolved": true, "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yMVQxMzo1MDo0OVrOFf6m9w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yMVQxNDoxODowN1rOFf7iyA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2OTAxMDQyMw==", "bodyText": "The idea here is to return null only when no locale value is set explicitly, but instead the defaults are both empty. This allows the user explicitly set locale strings like en- or en-US even when there are no default values.\nIf the default values are empty and the user doesn't specify any locales, then a higher up layer will end up throwing an exception like:\njava.lang.RuntimeException: java.util.NoSuchElementException: Property quarkus.locales not found", "url": "https://github.com/quarkusio/quarkus/pull/6681#discussion_r369010423", "createdAt": "2020-01-21T13:50:49Z", "author": {"login": "geoand"}, "path": "core/runtime/src/main/java/io/quarkus/runtime/configuration/LocaleConverter.java", "diffHunk": "@@ -29,6 +32,11 @@ public Locale convert(final String value) {\n             return null;\n         }\n \n+        if (localeValue.equals(\"-\")) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "19c60b6107a49b0c3f8eddafbf8c1055a407ef1b"}, "originalPosition": 21}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2OTAxMTEwNQ==", "bodyText": "In this case the warning message will at least give the user the opportunity to know to set user.language instead of having to set quarkus.locales and quarkus.default-locale", "url": "https://github.com/quarkusio/quarkus/pull/6681#discussion_r369011105", "createdAt": "2020-01-21T13:51:59Z", "author": {"login": "geoand"}, "path": "core/runtime/src/main/java/io/quarkus/runtime/configuration/LocaleConverter.java", "diffHunk": "@@ -29,6 +32,11 @@ public Locale convert(final String value) {\n             return null;\n         }\n \n+        if (localeValue.equals(\"-\")) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2OTAxMDQyMw=="}, "originalCommit": {"oid": "19c60b6107a49b0c3f8eddafbf8c1055a407ef1b"}, "originalPosition": 21}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2OTAyNTczNg==", "bodyText": "After talking we @gsmet we decided to use en as the last line of defence, so this stuff is no longer needed", "url": "https://github.com/quarkusio/quarkus/pull/6681#discussion_r369025736", "createdAt": "2020-01-21T14:18:07Z", "author": {"login": "geoand"}, "path": "core/runtime/src/main/java/io/quarkus/runtime/configuration/LocaleConverter.java", "diffHunk": "@@ -29,6 +32,11 @@ public Locale convert(final String value) {\n             return null;\n         }\n \n+        if (localeValue.equals(\"-\")) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2OTAxMDQyMw=="}, "originalCommit": {"oid": "19c60b6107a49b0c3f8eddafbf8c1055a407ef1b"}, "originalPosition": 21}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjI4MTE2MzIxOnYy", "diffSide": "RIGHT", "path": "test-framework/junit5-internal/src/main/java/io/quarkus/test/QuarkusUnitTest.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yMVQxNjowOTozMVrOFf_wAg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yMVQxNjoyMDo1NlrOFgAKzw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2OTA5NDY1OA==", "bodyText": "Why not use the @BeforeAll annotation in a static method?", "url": "https://github.com/quarkusio/quarkus/pull/6681#discussion_r369094658", "createdAt": "2020-01-21T16:09:31Z", "author": {"login": "gastaldi"}, "path": "test-framework/junit5-internal/src/main/java/io/quarkus/test/QuarkusUnitTest.java", "diffHunk": "@@ -133,6 +135,18 @@ public QuarkusUnitTest setLogFileName(String logFileName) {\n         return this;\n     }\n \n+    // set a Runnable that will run before ANYTHING else is done\n+    public QuarkusUnitTest setBeforeAllCustomizer(Runnable beforeAllCustomizer) {\n+        this.beforeAllCustomizer = beforeAllCustomizer;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c9a79be6b4d18e0b2ae1eeeac396c5778e690629"}, "originalPosition": 15}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2OTEwMTUxOQ==", "bodyText": "That's the first thing I tried \ud83d\ude09 . However that is executed after the Quarkus extension and I needed it to execute before the build.", "url": "https://github.com/quarkusio/quarkus/pull/6681#discussion_r369101519", "createdAt": "2020-01-21T16:20:56Z", "author": {"login": "geoand"}, "path": "test-framework/junit5-internal/src/main/java/io/quarkus/test/QuarkusUnitTest.java", "diffHunk": "@@ -133,6 +135,18 @@ public QuarkusUnitTest setLogFileName(String logFileName) {\n         return this;\n     }\n \n+    // set a Runnable that will run before ANYTHING else is done\n+    public QuarkusUnitTest setBeforeAllCustomizer(Runnable beforeAllCustomizer) {\n+        this.beforeAllCustomizer = beforeAllCustomizer;", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2OTA5NDY1OA=="}, "originalCommit": {"oid": "c9a79be6b4d18e0b2ae1eeeac396c5778e690629"}, "originalPosition": 15}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjI4MTE5MjY1OnYy", "diffSide": "RIGHT", "path": "extensions/hibernate-validator/deployment/src/test/java/io/quarkus/hibernate/validator/test/UserCountryNotSetValidatorLocaleTest.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yMVQxNjoxNzozMFrOFgACiA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yMVQxNjoyMTowOVrOFgALXw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2OTA5OTQwMA==", "bodyText": "Using @BeforeAll and @AfterAll static methods should be the standard way of invoking code before and after tests (If not through a junit extension using callbacks). Not sure if it's worth adding another strategy to do the same thing, unless I am missing something, of course", "url": "https://github.com/quarkusio/quarkus/pull/6681#discussion_r369099400", "createdAt": "2020-01-21T16:17:30Z", "author": {"login": "gastaldi"}, "path": "extensions/hibernate-validator/deployment/src/test/java/io/quarkus/hibernate/validator/test/UserCountryNotSetValidatorLocaleTest.java", "diffHunk": "@@ -0,0 +1,56 @@\n+package io.quarkus.hibernate.validator.test;\n+\n+import javax.inject.Inject;\n+import javax.validation.ValidatorFactory;\n+import javax.validation.constraints.Pattern;\n+\n+import org.jboss.shrinkwrap.api.ShrinkWrap;\n+import org.jboss.shrinkwrap.api.asset.StringAsset;\n+import org.jboss.shrinkwrap.api.spec.JavaArchive;\n+import org.junit.jupiter.api.Test;\n+import org.junit.jupiter.api.extension.RegisterExtension;\n+\n+import io.quarkus.test.QuarkusUnitTest;\n+\n+public class UserCountryNotSetValidatorLocaleTest {\n+\n+    @Inject\n+    ValidatorFactory validatorFactory;\n+\n+    @RegisterExtension\n+    static final QuarkusUnitTest test = new QuarkusUnitTest().setArchiveProducer(() -> ShrinkWrap\n+            .create(JavaArchive.class).addClasses(Bean.class)\n+            .addAsResource(new StringAsset(\"foo=bar\"), \"application.properties\"))\n+            .setBeforeAllCustomizer(new Runnable() {\n+                @Override\n+                public void run() {\n+                    userCountry = System.clearProperty(\"user.country\");\n+                    userLanguage = System.clearProperty(\"user.language\");\n+                }\n+            }).setAfterAllCustomizer(new Runnable() {\n+                @Override\n+                public void run() {\n+                    System.setProperty(\"user.country\", userCountry);\n+                    System.setProperty(\"user.language\", userLanguage);\n+                }", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c9a79be6b4d18e0b2ae1eeeac396c5778e690629"}, "originalPosition": 35}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2OTEwMTY2Mw==", "bodyText": "See my comment above", "url": "https://github.com/quarkusio/quarkus/pull/6681#discussion_r369101663", "createdAt": "2020-01-21T16:21:09Z", "author": {"login": "geoand"}, "path": "extensions/hibernate-validator/deployment/src/test/java/io/quarkus/hibernate/validator/test/UserCountryNotSetValidatorLocaleTest.java", "diffHunk": "@@ -0,0 +1,56 @@\n+package io.quarkus.hibernate.validator.test;\n+\n+import javax.inject.Inject;\n+import javax.validation.ValidatorFactory;\n+import javax.validation.constraints.Pattern;\n+\n+import org.jboss.shrinkwrap.api.ShrinkWrap;\n+import org.jboss.shrinkwrap.api.asset.StringAsset;\n+import org.jboss.shrinkwrap.api.spec.JavaArchive;\n+import org.junit.jupiter.api.Test;\n+import org.junit.jupiter.api.extension.RegisterExtension;\n+\n+import io.quarkus.test.QuarkusUnitTest;\n+\n+public class UserCountryNotSetValidatorLocaleTest {\n+\n+    @Inject\n+    ValidatorFactory validatorFactory;\n+\n+    @RegisterExtension\n+    static final QuarkusUnitTest test = new QuarkusUnitTest().setArchiveProducer(() -> ShrinkWrap\n+            .create(JavaArchive.class).addClasses(Bean.class)\n+            .addAsResource(new StringAsset(\"foo=bar\"), \"application.properties\"))\n+            .setBeforeAllCustomizer(new Runnable() {\n+                @Override\n+                public void run() {\n+                    userCountry = System.clearProperty(\"user.country\");\n+                    userLanguage = System.clearProperty(\"user.language\");\n+                }\n+            }).setAfterAllCustomizer(new Runnable() {\n+                @Override\n+                public void run() {\n+                    System.setProperty(\"user.country\", userCountry);\n+                    System.setProperty(\"user.language\", userLanguage);\n+                }", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2OTA5OTQwMA=="}, "originalCommit": {"oid": "c9a79be6b4d18e0b2ae1eeeac396c5778e690629"}, "originalPosition": 35}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1257, "cost": 1, "resetAt": "2021-11-13T12:26:42Z"}}}