{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDM5MjQxMjIw", "number": 10222, "reviewThreads": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yNFQxNjozNDo0OFrOEIcWbg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yNFQxNjozODowNlrOEIcbBw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjc3Mjg4NTU4OnYy", "diffSide": "RIGHT", "path": "extensions/agroal/runtime/src/main/java/io/quarkus/agroal/runtime/DataSources.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yNFQxNjozNDo0OFrOGoaJIw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yNFQxNjo1MzozMFrOGoa1dw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NTAyNDU0Nw==", "bodyText": "isn't it quarkus.datasource.<name>.jdbc.url?", "url": "https://github.com/quarkusio/quarkus/pull/10222#discussion_r445024547", "createdAt": "2020-06-24T16:34:48Z", "author": {"login": "gsmet"}, "path": "extensions/agroal/runtime/src/main/java/io/quarkus/agroal/runtime/DataSources.java", "diffHunk": "@@ -142,12 +150,38 @@ public AgroalDataSource doCreateDataSource(String dataSourceName) {\n         DataSourceSupport.Entry matchingSupportEntry = dataSourceSupport.entries.get(dataSourceName);\n         boolean isLegacy = matchingSupportEntry.isLegacy;\n         if (!isLegacy) {\n+            if (!dataSourceJdbcRuntimeConfig.url.isPresent() && legacyDataSourceRuntimeConfig.url.isPresent()) {\n+                String errorMessage;\n+                if (DataSourceUtil.isDefault(dataSourceName)) {\n+                    errorMessage = \"`quarkus.datasource.url` is deprecated and will be removed in a future version - it is \" +\n+                            \"recommended to switch to `quarkus.datasource.jdbc.url`. See https://quarkus.io/guides/datasource\";\n+                } else {\n+                    errorMessage = \"`quarkus.datasource.\" + dataSourceName\n+                            + \".url` is deprecated and will be removed in a future version - it is \" +\n+                            \"recommended to switch to `quarkus.datasource.\" + dataSourceName\n+                            + \".jdbc.url`. See https://quarkus.io/guides/datasource\";\n+                }\n+                throw new ConfigurationException(errorMessage);\n+            }\n+\n             if (!dataSourceJdbcRuntimeConfig.url.isPresent()) {\n-                throw new ConfigurationException(\"URL is not defined for datasource \" + dataSourceName);\n+                String errorMessage;\n+                if (DataSourceUtil.isDefault(dataSourceName)) {\n+                    errorMessage = \"`quarkus.datasource.jdbc.url` has not been defined\";\n+                } else {\n+                    errorMessage = \"`quarkus.datasource.jdbc.\" + dataSourceName + \".url` has not been defined\";", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "163dbef1cfed022cc782116eb792c1e7e3e4a9ab"}, "originalPosition": 39}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NTAzNTg5NQ==", "bodyText": "fixed", "url": "https://github.com/quarkusio/quarkus/pull/10222#discussion_r445035895", "createdAt": "2020-06-24T16:53:30Z", "author": {"login": "ejba"}, "path": "extensions/agroal/runtime/src/main/java/io/quarkus/agroal/runtime/DataSources.java", "diffHunk": "@@ -142,12 +150,38 @@ public AgroalDataSource doCreateDataSource(String dataSourceName) {\n         DataSourceSupport.Entry matchingSupportEntry = dataSourceSupport.entries.get(dataSourceName);\n         boolean isLegacy = matchingSupportEntry.isLegacy;\n         if (!isLegacy) {\n+            if (!dataSourceJdbcRuntimeConfig.url.isPresent() && legacyDataSourceRuntimeConfig.url.isPresent()) {\n+                String errorMessage;\n+                if (DataSourceUtil.isDefault(dataSourceName)) {\n+                    errorMessage = \"`quarkus.datasource.url` is deprecated and will be removed in a future version - it is \" +\n+                            \"recommended to switch to `quarkus.datasource.jdbc.url`. See https://quarkus.io/guides/datasource\";\n+                } else {\n+                    errorMessage = \"`quarkus.datasource.\" + dataSourceName\n+                            + \".url` is deprecated and will be removed in a future version - it is \" +\n+                            \"recommended to switch to `quarkus.datasource.\" + dataSourceName\n+                            + \".jdbc.url`. See https://quarkus.io/guides/datasource\";\n+                }\n+                throw new ConfigurationException(errorMessage);\n+            }\n+\n             if (!dataSourceJdbcRuntimeConfig.url.isPresent()) {\n-                throw new ConfigurationException(\"URL is not defined for datasource \" + dataSourceName);\n+                String errorMessage;\n+                if (DataSourceUtil.isDefault(dataSourceName)) {\n+                    errorMessage = \"`quarkus.datasource.jdbc.url` has not been defined\";\n+                } else {\n+                    errorMessage = \"`quarkus.datasource.jdbc.\" + dataSourceName + \".url` has not been defined\";", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NTAyNDU0Nw=="}, "originalCommit": {"oid": "163dbef1cfed022cc782116eb792c1e7e3e4a9ab"}, "originalPosition": 39}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjc3Mjg4NjUzOnYy", "diffSide": "RIGHT", "path": "extensions/agroal/runtime/src/main/java/io/quarkus/agroal/runtime/DataSources.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yNFQxNjozNTowNFrOGoaJvg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yNFQxNjo0Njo1OVrOGoamHw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NTAyNDcwMg==", "bodyText": "Please avoid reformatting this.", "url": "https://github.com/quarkusio/quarkus/pull/10222#discussion_r445024702", "createdAt": "2020-06-24T16:35:04Z", "author": {"login": "gsmet"}, "path": "extensions/agroal/runtime/src/main/java/io/quarkus/agroal/runtime/DataSources.java", "diffHunk": "@@ -202,7 +236,8 @@ public AgroalDataSource doCreateDataSource(String dataSourceName) {\n         // Explicit reference to bypass reflection need of the ServiceLoader used by AgroalDataSource#from\n         AgroalDataSourceConfiguration agroalConfiguration = dataSourceConfiguration.get();\n         AgroalDataSource dataSource = new io.agroal.pool.DataSource(agroalConfiguration,\n-                new AgroalEventLoggingListener(dataSourceName));\n+                new AgroalEventLoggingListener(\n+                        dataSourceName));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "163dbef1cfed022cc782116eb792c1e7e3e4a9ab"}, "originalPosition": 62}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NTAzMTk2Nw==", "bodyText": "Fighting against the IDE, sure I will!", "url": "https://github.com/quarkusio/quarkus/pull/10222#discussion_r445031967", "createdAt": "2020-06-24T16:46:59Z", "author": {"login": "ejba"}, "path": "extensions/agroal/runtime/src/main/java/io/quarkus/agroal/runtime/DataSources.java", "diffHunk": "@@ -202,7 +236,8 @@ public AgroalDataSource doCreateDataSource(String dataSourceName) {\n         // Explicit reference to bypass reflection need of the ServiceLoader used by AgroalDataSource#from\n         AgroalDataSourceConfiguration agroalConfiguration = dataSourceConfiguration.get();\n         AgroalDataSource dataSource = new io.agroal.pool.DataSource(agroalConfiguration,\n-                new AgroalEventLoggingListener(dataSourceName));\n+                new AgroalEventLoggingListener(\n+                        dataSourceName));", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NTAyNDcwMg=="}, "originalCommit": {"oid": "163dbef1cfed022cc782116eb792c1e7e3e4a9ab"}, "originalPosition": 62}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjc3Mjg4ODU5OnYy", "diffSide": "RIGHT", "path": "extensions/agroal/runtime/src/main/java/io/quarkus/agroal/runtime/DataSources.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yNFQxNjozNTozOFrOGoaLDg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yNFQxNjo1Mzo0MFrOGoa15Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NTAyNTAzOA==", "bodyText": "I would avoid the backticks in log messages.", "url": "https://github.com/quarkusio/quarkus/pull/10222#discussion_r445025038", "createdAt": "2020-06-24T16:35:38Z", "author": {"login": "gsmet"}, "path": "extensions/agroal/runtime/src/main/java/io/quarkus/agroal/runtime/DataSources.java", "diffHunk": "@@ -142,12 +150,38 @@ public AgroalDataSource doCreateDataSource(String dataSourceName) {\n         DataSourceSupport.Entry matchingSupportEntry = dataSourceSupport.entries.get(dataSourceName);\n         boolean isLegacy = matchingSupportEntry.isLegacy;\n         if (!isLegacy) {\n+            if (!dataSourceJdbcRuntimeConfig.url.isPresent() && legacyDataSourceRuntimeConfig.url.isPresent()) {\n+                String errorMessage;\n+                if (DataSourceUtil.isDefault(dataSourceName)) {\n+                    errorMessage = \"`quarkus.datasource.url` is deprecated and will be removed in a future version - it is \" +\n+                            \"recommended to switch to `quarkus.datasource.jdbc.url`. See https://quarkus.io/guides/datasource\";\n+                } else {\n+                    errorMessage = \"`quarkus.datasource.\" + dataSourceName\n+                            + \".url` is deprecated and will be removed in a future version - it is \" +\n+                            \"recommended to switch to `quarkus.datasource.\" + dataSourceName\n+                            + \".jdbc.url`. See https://quarkus.io/guides/datasource\";\n+                }\n+                throw new ConfigurationException(errorMessage);\n+            }\n+\n             if (!dataSourceJdbcRuntimeConfig.url.isPresent()) {\n-                throw new ConfigurationException(\"URL is not defined for datasource \" + dataSourceName);\n+                String errorMessage;\n+                if (DataSourceUtil.isDefault(dataSourceName)) {\n+                    errorMessage = \"`quarkus.datasource.jdbc.url` has not been defined\";\n+                } else {\n+                    errorMessage = \"`quarkus.datasource.jdbc.\" + dataSourceName + \".url` has not been defined\";\n+                }\n+                throw new ConfigurationException(errorMessage);\n             }\n         } else {\n             if (!legacyDataSourceRuntimeConfig.url.isPresent()) {\n-                throw new ConfigurationException(\"URL is not defined for datasource \" + dataSourceName);\n+                String errorMessage;\n+                if (DataSourceUtil.isDefault(dataSourceName)) {\n+                    errorMessage = \"`quarkus.datasource.url` has not been defined\";\n+                } else {\n+                    errorMessage = \"`quarkus.datasource.\" + dataSourceName + \".url` has not been defined\";", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "163dbef1cfed022cc782116eb792c1e7e3e4a9ab"}, "originalPosition": 50}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NTAzNjAwNQ==", "bodyText": "fixed", "url": "https://github.com/quarkusio/quarkus/pull/10222#discussion_r445036005", "createdAt": "2020-06-24T16:53:40Z", "author": {"login": "ejba"}, "path": "extensions/agroal/runtime/src/main/java/io/quarkus/agroal/runtime/DataSources.java", "diffHunk": "@@ -142,12 +150,38 @@ public AgroalDataSource doCreateDataSource(String dataSourceName) {\n         DataSourceSupport.Entry matchingSupportEntry = dataSourceSupport.entries.get(dataSourceName);\n         boolean isLegacy = matchingSupportEntry.isLegacy;\n         if (!isLegacy) {\n+            if (!dataSourceJdbcRuntimeConfig.url.isPresent() && legacyDataSourceRuntimeConfig.url.isPresent()) {\n+                String errorMessage;\n+                if (DataSourceUtil.isDefault(dataSourceName)) {\n+                    errorMessage = \"`quarkus.datasource.url` is deprecated and will be removed in a future version - it is \" +\n+                            \"recommended to switch to `quarkus.datasource.jdbc.url`. See https://quarkus.io/guides/datasource\";\n+                } else {\n+                    errorMessage = \"`quarkus.datasource.\" + dataSourceName\n+                            + \".url` is deprecated and will be removed in a future version - it is \" +\n+                            \"recommended to switch to `quarkus.datasource.\" + dataSourceName\n+                            + \".jdbc.url`. See https://quarkus.io/guides/datasource\";\n+                }\n+                throw new ConfigurationException(errorMessage);\n+            }\n+\n             if (!dataSourceJdbcRuntimeConfig.url.isPresent()) {\n-                throw new ConfigurationException(\"URL is not defined for datasource \" + dataSourceName);\n+                String errorMessage;\n+                if (DataSourceUtil.isDefault(dataSourceName)) {\n+                    errorMessage = \"`quarkus.datasource.jdbc.url` has not been defined\";\n+                } else {\n+                    errorMessage = \"`quarkus.datasource.jdbc.\" + dataSourceName + \".url` has not been defined\";\n+                }\n+                throw new ConfigurationException(errorMessage);\n             }\n         } else {\n             if (!legacyDataSourceRuntimeConfig.url.isPresent()) {\n-                throw new ConfigurationException(\"URL is not defined for datasource \" + dataSourceName);\n+                String errorMessage;\n+                if (DataSourceUtil.isDefault(dataSourceName)) {\n+                    errorMessage = \"`quarkus.datasource.url` has not been defined\";\n+                } else {\n+                    errorMessage = \"`quarkus.datasource.\" + dataSourceName + \".url` has not been defined\";", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NTAyNTAzOA=="}, "originalCommit": {"oid": "163dbef1cfed022cc782116eb792c1e7e3e4a9ab"}, "originalPosition": 50}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjc3Mjg5MDIwOnYy", "diffSide": "RIGHT", "path": "extensions/agroal/runtime/src/main/java/io/quarkus/agroal/runtime/DataSources.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yNFQxNjozNjowNFrOGoaMGw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yNFQxNjo1Mzo0OFrOGoa2RA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NTAyNTMwNw==", "bodyText": "I would get rid of these constants, there's no value for them IMHO.", "url": "https://github.com/quarkusio/quarkus/pull/10222#discussion_r445025307", "createdAt": "2020-06-24T16:36:04Z", "author": {"login": "gsmet"}, "path": "extensions/agroal/runtime/src/main/java/io/quarkus/agroal/runtime/DataSources.java", "diffHunk": "@@ -64,6 +64,14 @@\n public class DataSources {\n \n     private static final Logger log = Logger.getLogger(DataSources.class.getName());\n+    public static final String DEPRECATED_URL_PROPERTY_NAME_ERROR_MESSAGE_FORMAT = \"`quarkus.datasource.%s.url` is deprecated and will be removed in a future version - it is \"\n+            +\n+            \"recommended to switch to `quarkus.datasource.%s.jdbc.url`. See https://quarkus.io/guides/datasource\";\n+    public static final String DEPRECATED_URL_PROPERTY_ERROR_MESSAGE = \"`quarkus.datasource.url` is deprecated and will be removed in a future version - it is \"\n+            +\n+            \"recommended to switch to `quarkus.datasource.jdbc.url`. See https://quarkus.io/guides/datasource\";\n+    public static final String DATASOURCE_JDBC_URL_HAS_NOT_BEEN_DEFINED = \"`quarkus.datasource.jdbc.url` has not been defined\";\n+    public static final String DATASOURCE_JDBC_S_URL_HAS_NOT_BEEN_DEFINED_MESSAGE_FORMAT = \"`quarkus.datasource.jdbc.%s.url` has not been defined\";", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "163dbef1cfed022cc782116eb792c1e7e3e4a9ab"}, "originalPosition": 11}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NTAzNjEwMA==", "bodyText": "fixed", "url": "https://github.com/quarkusio/quarkus/pull/10222#discussion_r445036100", "createdAt": "2020-06-24T16:53:48Z", "author": {"login": "ejba"}, "path": "extensions/agroal/runtime/src/main/java/io/quarkus/agroal/runtime/DataSources.java", "diffHunk": "@@ -64,6 +64,14 @@\n public class DataSources {\n \n     private static final Logger log = Logger.getLogger(DataSources.class.getName());\n+    public static final String DEPRECATED_URL_PROPERTY_NAME_ERROR_MESSAGE_FORMAT = \"`quarkus.datasource.%s.url` is deprecated and will be removed in a future version - it is \"\n+            +\n+            \"recommended to switch to `quarkus.datasource.%s.jdbc.url`. See https://quarkus.io/guides/datasource\";\n+    public static final String DEPRECATED_URL_PROPERTY_ERROR_MESSAGE = \"`quarkus.datasource.url` is deprecated and will be removed in a future version - it is \"\n+            +\n+            \"recommended to switch to `quarkus.datasource.jdbc.url`. See https://quarkus.io/guides/datasource\";\n+    public static final String DATASOURCE_JDBC_URL_HAS_NOT_BEEN_DEFINED = \"`quarkus.datasource.jdbc.url` has not been defined\";\n+    public static final String DATASOURCE_JDBC_S_URL_HAS_NOT_BEEN_DEFINED_MESSAGE_FORMAT = \"`quarkus.datasource.jdbc.%s.url` has not been defined\";", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NTAyNTMwNw=="}, "originalCommit": {"oid": "163dbef1cfed022cc782116eb792c1e7e3e4a9ab"}, "originalPosition": 11}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjc3Mjg5NzM1OnYy", "diffSide": "RIGHT", "path": "extensions/agroal/runtime/src/main/java/io/quarkus/agroal/runtime/DataSources.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yNFQxNjozODowNlrOGoaQzg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yNFQxNjo1Mzo1NlrOGoa2iQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NTAyNjUxMA==", "bodyText": "I would have had something like:\nif (!dataSourceJdbcRuntimeConfig.url.isPresent()) {\n    if (!legacyDataSourceRuntimeConfig.url.isPresent()) {\n        // no legacy JDBC URL either so proceed with the standard message\n    } else {\n        // the user provided a legacy JDBC URL, provide an explicit error message\n    }\n}", "url": "https://github.com/quarkusio/quarkus/pull/10222#discussion_r445026510", "createdAt": "2020-06-24T16:38:06Z", "author": {"login": "gsmet"}, "path": "extensions/agroal/runtime/src/main/java/io/quarkus/agroal/runtime/DataSources.java", "diffHunk": "@@ -142,12 +150,38 @@ public AgroalDataSource doCreateDataSource(String dataSourceName) {\n         DataSourceSupport.Entry matchingSupportEntry = dataSourceSupport.entries.get(dataSourceName);\n         boolean isLegacy = matchingSupportEntry.isLegacy;\n         if (!isLegacy) {\n+            if (!dataSourceJdbcRuntimeConfig.url.isPresent() && legacyDataSourceRuntimeConfig.url.isPresent()) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "163dbef1cfed022cc782116eb792c1e7e3e4a9ab"}, "originalPosition": 19}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NTAzNjE2OQ==", "bodyText": "done", "url": "https://github.com/quarkusio/quarkus/pull/10222#discussion_r445036169", "createdAt": "2020-06-24T16:53:56Z", "author": {"login": "ejba"}, "path": "extensions/agroal/runtime/src/main/java/io/quarkus/agroal/runtime/DataSources.java", "diffHunk": "@@ -142,12 +150,38 @@ public AgroalDataSource doCreateDataSource(String dataSourceName) {\n         DataSourceSupport.Entry matchingSupportEntry = dataSourceSupport.entries.get(dataSourceName);\n         boolean isLegacy = matchingSupportEntry.isLegacy;\n         if (!isLegacy) {\n+            if (!dataSourceJdbcRuntimeConfig.url.isPresent() && legacyDataSourceRuntimeConfig.url.isPresent()) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NTAyNjUxMA=="}, "originalCommit": {"oid": "163dbef1cfed022cc782116eb792c1e7e3e4a9ab"}, "originalPosition": 19}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2632, "cost": 1, "resetAt": "2021-11-13T14:23:39Z"}}}