{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0Mzg3Njk1Mzky", "number": 7837, "title": "ArC - transform unproxyable bean classes by default", "bodyText": "new transformations: remove final flag from a bean class, change\nvisibility of private no-args constructor\ndeprecate quarkus.arc.remove-final-for-proxyable-methods\nintroduce quarkus.arc.transfrorm-unproxyable-classes\nthis should also help kotlin developers where classes are final by\ndefault", "createdAt": "2020-03-13T10:13:11Z", "url": "https://github.com/quarkusio/quarkus/pull/7837", "merged": true, "mergeCommit": {"oid": "3621aebb67c452240ad376709ce7d28978cf2053"}, "closed": true, "closedAt": "2020-03-17T13:49:04Z", "author": {"login": "mkouba"}, "timelineItems": {"totalCount": 12, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcNRetzAFqTM3NDM2MDk1Mg==", "endCursor": "Y3Vyc29yOnYyOpPPAAABcOg5V4gBqjMxMzY4OTMyMjU=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzc0MzYwOTUy", "url": "https://github.com/quarkusio/quarkus/pull/7837#pullrequestreview-374360952", "createdAt": "2020-03-13T14:49:02Z", "commit": {"oid": "bd54dd64b0ccf1a52a93b8071bf3f2ddb1d34752"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xM1QxNDo0OTowMlrOF2GifA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xM1QxNDo0OTowMlrOF2GifA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MjI3NDU1Ng==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                @Deprecated\n          \n          \n            \n                @Deprecated(forRemoval=true)", "url": "https://github.com/quarkusio/quarkus/pull/7837#discussion_r392274556", "createdAt": "2020-03-13T14:49:02Z", "author": {"login": "geoand"}, "path": "extensions/arc/deployment/src/main/java/io/quarkus/arc/deployment/ArcConfig.java", "diffHunk": "@@ -54,13 +52,25 @@\n     /**\n      * If set to true, Arc will transform the bytecode of beans containing methods that need to be proxyable\n      * but have been declared as final. The transformation is simply a matter of removing final.\n-     * This ensures that a proxy can be created properly.\n+     * This ensures that a proxy/subclass can be created properly.\n      * If the value is set to false, then an exception is thrown at build time indicating\n      * that a proxy could not be created because a method was final.\n+     * \n+     * @deprecated This config property is ignored and will be removed at some point post Quarkus 1.4\n+     * @see #transformUnproxyableClasses\n      */\n+    @Deprecated", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "bd54dd64b0ccf1a52a93b8071bf3f2ddb1d34752"}, "originalPosition": 28}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzc0MzY3MTk3", "url": "https://github.com/quarkusio/quarkus/pull/7837#pullrequestreview-374367197", "createdAt": "2020-03-13T14:56:38Z", "commit": {"oid": "bd54dd64b0ccf1a52a93b8071bf3f2ddb1d34752"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xM1QxNDo1NjozOFrOF2G1Jw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xM1QxNDo1NjozOFrOF2G1Jw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MjI3OTMzNQ==", "bodyText": "I think this comment needs to be augmented, right? Since the transformation isn't only about removing final anymore", "url": "https://github.com/quarkusio/quarkus/pull/7837#discussion_r392279335", "createdAt": "2020-03-13T14:56:38Z", "author": {"login": "geoand"}, "path": "independent-projects/arc/processor/src/main/java/io/quarkus/arc/processor/BeanProcessor.java", "diffHunk": "@@ -403,8 +413,26 @@ public Builder addRemovalExclusion(Predicate<BeanInfo> exclusion) {\n             return this;\n         }\n \n+        /**\n+         * \n+         * @param removeFinalForProxyableMethods\n+         * @return self\n+         * @deprecated This method will be removed at some point post Quarkus 1.4\n+         */\n+        @Deprecated\n         public Builder setRemoveFinalFromProxyableMethods(boolean removeFinalForProxyableMethods) {\n-            this.removeFinalForProxyableMethods = removeFinalForProxyableMethods;\n+            return this;\n+        }\n+\n+        /**\n+         * If set to true the container will attempt to remove the final flag from a bean class that must be proxyable during", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "bd54dd64b0ccf1a52a93b8071bf3f2ddb1d34752"}, "originalPosition": 117}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzc0MzcxMTc0", "url": "https://github.com/quarkusio/quarkus/pull/7837#pullrequestreview-374371174", "createdAt": "2020-03-13T15:01:35Z", "commit": {"oid": "bd54dd64b0ccf1a52a93b8071bf3f2ddb1d34752"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xM1QxNTowMTozNVrOF2HBMQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xM1QxNTowMTozNVrOF2HBMQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MjI4MjQxNw==", "bodyText": "These tests are great! I think that having a extra test where the bean extends some class that doesn't have a no-args constructor would be beneficial - to ensure that a build error is encountered. I don't think I saw such a test.", "url": "https://github.com/quarkusio/quarkus/pull/7837#discussion_r392282417", "createdAt": "2020-03-13T15:01:35Z", "author": {"login": "geoand"}, "path": "extensions/arc/deployment/src/test/java/io/quarkus/arc/test/unproxyable/PrivateNoArgsConstructorDoNotChangeFlagTest.java", "diffHunk": "@@ -0,0 +1,48 @@\n+package io.quarkus.arc.test.unproxyable;\n+\n+import javax.enterprise.context.ApplicationScoped;\n+import javax.enterprise.inject.spi.DeploymentException;\n+\n+import org.jboss.shrinkwrap.api.ShrinkWrap;\n+import org.jboss.shrinkwrap.api.asset.StringAsset;\n+import org.jboss.shrinkwrap.api.spec.JavaArchive;\n+import org.junit.jupiter.api.Assertions;\n+import org.junit.jupiter.api.Test;\n+import org.junit.jupiter.api.extension.RegisterExtension;\n+\n+import io.quarkus.arc.Unremovable;\n+import io.quarkus.test.QuarkusUnitTest;\n+\n+public class PrivateNoArgsConstructorDoNotChangeFlagTest {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "bd54dd64b0ccf1a52a93b8071bf3f2ddb1d34752"}, "originalPosition": 16}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzc0ODQ1MzIx", "url": "https://github.com/quarkusio/quarkus/pull/7837#pullrequestreview-374845321", "createdAt": "2020-03-15T23:28:04Z", "commit": {"oid": "bd54dd64b0ccf1a52a93b8071bf3f2ddb1d34752"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzc0OTc5NDU3", "url": "https://github.com/quarkusio/quarkus/pull/7837#pullrequestreview-374979457", "createdAt": "2020-03-16T07:55:24Z", "commit": {"oid": "d9ea47d4779796308beb649e179124da9e9ef2bd"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzc1MjM1ODYw", "url": "https://github.com/quarkusio/quarkus/pull/7837#pullrequestreview-375235860", "createdAt": "2020-03-16T13:57:51Z", "commit": {"oid": "d9ea47d4779796308beb649e179124da9e9ef2bd"}, "state": "COMMENTED", "comments": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xNlQxMzo1Nzo1MlrOF21S9Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xNlQxNDoxNToxNVrOF22D4w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MzA0MDYyOQ==", "bodyText": "Minor - aren't you going to miss the closing tag here? Line 28 still has <p>...", "url": "https://github.com/quarkusio/quarkus/pull/7837#discussion_r393040629", "createdAt": "2020-03-16T13:57:52Z", "author": {"login": "manovotn"}, "path": "extensions/arc/deployment/src/main/java/io/quarkus/arc/deployment/ArcConfig.java", "diffHunk": "@@ -37,7 +36,6 @@\n      * <li>does not declare any producer which is eligible for injection to any injection point,</li>\n      * <li>is not directly eligible for injection into any {@link javax.enterprise.inject.Instance} injection point</li>\n      * </ul>\n-     * </p>", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d9ea47d4779796308beb649e179124da9e9ef2bd"}, "originalPosition": 12}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MzA0NjAxNA==", "bodyText": "Do we have a substitute for this now or do we just drop it?", "url": "https://github.com/quarkusio/quarkus/pull/7837#discussion_r393046014", "createdAt": "2020-03-16T14:05:45Z", "author": {"login": "manovotn"}, "path": "independent-projects/arc/processor/src/main/java/io/quarkus/arc/processor/BeanDeploymentValidator.java", "diffHunk": "@@ -23,11 +23,14 @@ default void validate(ValidationContext context) {\n     }\n \n     /**\n+     * This method is deprecated and is not used internally.\n      * \n      * @param target\n      * @param rule\n      * @return {@code true} if the given validation rule should be skipped for the specified target\n+     * @deprecated This method will be removed at some point post Quarkus 1.4\n      */\n+    @Deprecated", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d9ea47d4779796308beb649e179124da9e9ef2bd"}, "originalPosition": 11}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MzA1MTI5Mg==", "bodyText": "Why unsupported as opposed to just no-op? Also a comment would be nice to know that this is only for test container and is not going to be actually invoked.", "url": "https://github.com/quarkusio/quarkus/pull/7837#discussion_r393051292", "createdAt": "2020-03-16T14:13:31Z", "author": {"login": "manovotn"}, "path": "independent-projects/arc/processor/src/main/java/io/quarkus/arc/processor/BeanProcessor.java", "diffHunk": "@@ -223,16 +232,17 @@ public BeanDeployment getBeanDeployment() {\n     }\n \n     public BeanDeployment process() throws IOException {\n-        registerCustomContexts();\n-        registerBeans();\n-        registerSyntheticObservers();\n-        initialize(new Consumer<BytecodeTransformer>() {\n+        Consumer<BytecodeTransformer> unsupportedBytecodeTransformer = new Consumer<BytecodeTransformer>() {\n             @Override\n             public void accept(BytecodeTransformer transformer) {\n-\n+                throw new UnsupportedOperationException();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d9ea47d4779796308beb649e179124da9e9ef2bd"}, "originalPosition": 65}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MzA1MzE1NQ==", "bodyText": "Add @see setRemoveFinalFromProxyableMethods(boolean)`.", "url": "https://github.com/quarkusio/quarkus/pull/7837#discussion_r393053155", "createdAt": "2020-03-16T14:15:15Z", "author": {"login": "manovotn"}, "path": "independent-projects/arc/processor/src/main/java/io/quarkus/arc/processor/BeanProcessor.java", "diffHunk": "@@ -403,8 +413,25 @@ public Builder addRemovalExclusion(Predicate<BeanInfo> exclusion) {\n             return this;\n         }\n \n+        /**\n+         * \n+         * @param removeFinalForProxyableMethods\n+         * @return self\n+         * @deprecated This method will be removed at some point post Quarkus 1.4\n+         */", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d9ea47d4779796308beb649e179124da9e9ef2bd"}, "originalPosition": 109}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzc1MzMwMDYx", "url": "https://github.com/quarkusio/quarkus/pull/7837#pullrequestreview-375330061", "createdAt": "2020-03-16T15:32:07Z", "commit": {"oid": "d9ea47d4779796308beb649e179124da9e9ef2bd"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "9a661c8a9e5d372ea21240de5d5f83a27a256efd", "author": {"user": {"login": "mkouba", "name": "Martin Kouba"}}, "url": "https://github.com/quarkusio/quarkus/commit/9a661c8a9e5d372ea21240de5d5f83a27a256efd", "committedDate": "2020-03-17T10:42:27Z", "message": "ArC - transform unproxyable bean classes by default\n\n- new transformations: remove final flag from a bean class, change\nvisibility of private no-args constructor\n- deprecate quarkus.arc.remove-final-for-proxyable-methods\n- introduce quarkus.arc.transfrorm-unproxyable-classes\n- this should also help kotlin developers where classes are final by\ndefault"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "4ded145cd7a88ad826214336955c108bf5de4ce6", "author": {"user": {"login": "mkouba", "name": "Martin Kouba"}}, "url": "https://github.com/quarkusio/quarkus/commit/4ded145cd7a88ad826214336955c108bf5de4ce6", "committedDate": "2020-03-17T10:42:27Z", "message": "MP Config TCK - disable transformation of unproxyable types"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "4df8c5848d51f6f6136439d0d6bc6cdd811c14a2", "author": {"user": {"login": "mkouba", "name": "Martin Kouba"}}, "url": "https://github.com/quarkusio/quarkus/commit/4df8c5848d51f6f6136439d0d6bc6cdd811c14a2", "committedDate": "2020-03-17T10:42:27Z", "message": "Update BeanProcessor.Builder.setTransformUnproxyableClasses() javadoc"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d297891f6501c67591fd02c7df66051ab0308813", "author": {"user": {"login": "mkouba", "name": "Martin Kouba"}}, "url": "https://github.com/quarkusio/quarkus/commit/d297891f6501c67591fd02c7df66051ab0308813", "committedDate": "2020-03-17T10:42:27Z", "message": "Refine BeanProcessor.Builder javadoc\n\n- BeanProcessor.Builder.setRemoveFinalFromProxyableMethods()"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "f0028148469f5ebf85e1ce7552ef62dd284d4efb", "author": {"user": {"login": "mkouba", "name": "Martin Kouba"}}, "url": "https://github.com/quarkusio/quarkus/commit/f0028148469f5ebf85e1ce7552ef62dd284d4efb", "committedDate": "2020-03-17T10:38:50Z", "message": "Refine BeanProcessor.Builder javadoc\n\n- BeanProcessor.Builder.setRemoveFinalFromProxyableMethods()"}, "afterCommit": {"oid": "d297891f6501c67591fd02c7df66051ab0308813", "author": {"user": {"login": "mkouba", "name": "Martin Kouba"}}, "url": "https://github.com/quarkusio/quarkus/commit/d297891f6501c67591fd02c7df66051ab0308813", "committedDate": "2020-03-17T10:42:27Z", "message": "Refine BeanProcessor.Builder javadoc\n\n- BeanProcessor.Builder.setRemoveFinalFromProxyableMethods()"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3865, "cost": 1, "resetAt": "2021-11-02T10:47:05Z"}}}