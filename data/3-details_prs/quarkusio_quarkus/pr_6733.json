{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0MzY2MTE4ODUz", "number": 6733, "title": "Add support for proxy address forwarding", "bodyText": "This also now includes the fix for #5809 as they would conflict.", "createdAt": "2020-01-22T23:49:48Z", "url": "https://github.com/quarkusio/quarkus/pull/6733", "merged": true, "mergeCommit": {"oid": "6af8b0053eb83aaac3ff297c9b8a17290436c068"}, "closed": true, "closedAt": "2020-01-31T18:09:02Z", "author": {"login": "stuartwdouglas"}, "timelineItems": {"totalCount": 8, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABb9Gr7JgFqTM0NzE0NTc1MQ==", "endCursor": "Y3Vyc29yOnYyOpPPAAABb-5SUhABqjI5ODc1NDcyNjA=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzQ3MTQ1NzUx", "url": "https://github.com/quarkusio/quarkus/pull/6733#pullrequestreview-347145751", "createdAt": "2020-01-23T09:10:32Z", "commit": {"oid": "176a1838b61c5759adbf678140a425c4308cfd85"}, "state": "COMMENTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yM1QwOToxMDozM1rOFg3DLw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yM1QwOToxMToxMFrOFg3Eag==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MDAwMDY4Nw==", "bodyText": "Why isn't it the default to use those values if present? Security reasons because any user could use them?", "url": "https://github.com/quarkusio/quarkus/pull/6733#discussion_r370000687", "createdAt": "2020-01-23T09:10:33Z", "author": {"login": "FroMage"}, "path": "extensions/vertx-http/runtime/src/main/java/io/quarkus/vertx/http/runtime/HttpConfiguration.java", "diffHunk": "@@ -49,6 +49,20 @@\n     @ConfigItem(defaultValue = \"8444\")\n     public int testSslPort;\n \n+    /**\n+     * If this is true then the address, scheme etc will be set from headers forwarded by the proxy server, such as\n+     * {@code X-Forwarded-For}. This should only be set if you are behind a proxy that sets these headers.\n+     */\n+    @ConfigItem(defaultValue = \"false\")\n+    public boolean proxyAddressForwarding;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "176a1838b61c5759adbf678140a425c4308cfd85"}, "originalPosition": 9}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MDAwMTAwMg==", "bodyText": "Why not use Forwarded if present (since it's the new preferred header) and fall-back to X-Forwarded otherwise? Why do we need a config?", "url": "https://github.com/quarkusio/quarkus/pull/6733#discussion_r370001002", "createdAt": "2020-01-23T09:11:10Z", "author": {"login": "FroMage"}, "path": "extensions/vertx-http/runtime/src/main/java/io/quarkus/vertx/http/runtime/HttpConfiguration.java", "diffHunk": "@@ -49,6 +49,20 @@\n     @ConfigItem(defaultValue = \"8444\")\n     public int testSslPort;\n \n+    /**\n+     * If this is true then the address, scheme etc will be set from headers forwarded by the proxy server, such as\n+     * {@code X-Forwarded-For}. This should only be set if you are behind a proxy that sets these headers.\n+     */\n+    @ConfigItem(defaultValue = \"false\")\n+    public boolean proxyAddressForwarding;\n+\n+    /**\n+     * If this is true and proxy address forwarding is enabled then the standard {@code Forwarded} header will be used,\n+     * rather than the more common but not standard {@code X-Forwarded-For}.\n+     */\n+    @ConfigItem(defaultValue = \"false\")\n+    public boolean allowForwarded;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "176a1838b61c5759adbf678140a425c4308cfd85"}, "originalPosition": 16}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzQ3NjIxNDU3", "url": "https://github.com/quarkusio/quarkus/pull/6733#pullrequestreview-347621457", "createdAt": "2020-01-23T21:31:26Z", "commit": {"oid": "176a1838b61c5759adbf678140a425c4308cfd85"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yM1QyMTozMToyNlrOFhNTPw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yM1QyMTozMToyNlrOFhNTPw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MDM2NTI0Nw==", "bodyText": "@stuartwdouglas Hi Stuart, can it be of some help if the request info being replaced with this wrapper be contained as HttpServerRequest attribute ? So that it can be logged if needed etc ? Not really sure, just checking.\nAll looks good", "url": "https://github.com/quarkusio/quarkus/pull/6733#discussion_r370365247", "createdAt": "2020-01-23T21:31:26Z", "author": {"login": "sberyozkin"}, "path": "extensions/vertx-http/runtime/src/main/java/io/quarkus/vertx/http/runtime/ForwardedServerRequestWrapper.java", "diffHunk": "@@ -0,0 +1,314 @@\n+package io.quarkus.vertx.http.runtime;\n+\n+import java.util.Map;\n+\n+import javax.net.ssl.SSLPeerUnverifiedException;\n+import javax.net.ssl.SSLSession;\n+import javax.security.cert.X509Certificate;\n+\n+import io.vertx.core.Handler;\n+import io.vertx.core.MultiMap;\n+import io.vertx.core.buffer.Buffer;\n+import io.vertx.core.http.*;\n+import io.vertx.core.net.NetSocket;\n+import io.vertx.core.net.SocketAddress;\n+\n+class ForwardedServerRequestWrapper implements HttpServerRequest {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "176a1838b61c5759adbf678140a425c4308cfd85"}, "originalPosition": 16}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "176a1838b61c5759adbf678140a425c4308cfd85", "author": {"user": {"login": "stuartwdouglas", "name": "Stuart Douglas"}}, "url": "https://github.com/quarkusio/quarkus/commit/176a1838b61c5759adbf678140a425c4308cfd85", "committedDate": "2020-01-22T23:48:44Z", "message": "Add support for proxy address forwarding"}, "afterCommit": {"oid": "47de644518173ee6dc4d43cb40d69b6861334c98", "author": {"user": {"login": "stuartwdouglas", "name": "Stuart Douglas"}}, "url": "https://github.com/quarkusio/quarkus/commit/47de644518173ee6dc4d43cb40d69b6861334c98", "committedDate": "2020-01-27T05:18:42Z", "message": "Fix vert.x resuming handling if security performs a blocking operation\n\nFixes #5809"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "47de644518173ee6dc4d43cb40d69b6861334c98", "author": {"user": {"login": "stuartwdouglas", "name": "Stuart Douglas"}}, "url": "https://github.com/quarkusio/quarkus/commit/47de644518173ee6dc4d43cb40d69b6861334c98", "committedDate": "2020-01-27T05:18:42Z", "message": "Fix vert.x resuming handling if security performs a blocking operation\n\nFixes #5809"}, "afterCommit": {"oid": "56477f2c1537c58bb3ddc61382a8a35b6438f063", "author": {"user": {"login": "stuartwdouglas", "name": "Stuart Douglas"}}, "url": "https://github.com/quarkusio/quarkus/commit/56477f2c1537c58bb3ddc61382a8a35b6438f063", "committedDate": "2020-01-28T05:20:47Z", "message": "Fix vert.x resuming handling if security performs a blocking operation\n\nFixes #5809"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzQ5MjgxOTE1", "url": "https://github.com/quarkusio/quarkus/pull/6733#pullrequestreview-349281915", "createdAt": "2020-01-28T10:49:42Z", "commit": {"oid": "56477f2c1537c58bb3ddc61382a8a35b6438f063"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "64ad71f4eadb201465de414a177d25dd00cb3cf5", "author": {"user": {"login": "stuartwdouglas", "name": "Stuart Douglas"}}, "url": "https://github.com/quarkusio/quarkus/commit/64ad71f4eadb201465de414a177d25dd00cb3cf5", "committedDate": "2020-01-28T22:37:21Z", "message": "Add support for proxy address forwarding"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ab10d2e5990354901bc745b3ac2c9d15299c8be2", "author": {"user": {"login": "stuartwdouglas", "name": "Stuart Douglas"}}, "url": "https://github.com/quarkusio/quarkus/commit/ab10d2e5990354901bc745b3ac2c9d15299c8be2", "committedDate": "2020-01-28T22:37:21Z", "message": "Fix vert.x resuming handling if security performs a blocking operation\n\nFixes #5809"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "56477f2c1537c58bb3ddc61382a8a35b6438f063", "author": {"user": {"login": "stuartwdouglas", "name": "Stuart Douglas"}}, "url": "https://github.com/quarkusio/quarkus/commit/56477f2c1537c58bb3ddc61382a8a35b6438f063", "committedDate": "2020-01-28T05:20:47Z", "message": "Fix vert.x resuming handling if security performs a blocking operation\n\nFixes #5809"}, "afterCommit": {"oid": "ab10d2e5990354901bc745b3ac2c9d15299c8be2", "author": {"user": {"login": "stuartwdouglas", "name": "Stuart Douglas"}}, "url": "https://github.com/quarkusio/quarkus/commit/ab10d2e5990354901bc745b3ac2c9d15299c8be2", "committedDate": "2020-01-28T22:37:21Z", "message": "Fix vert.x resuming handling if security performs a blocking operation\n\nFixes #5809"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 123, "cost": 1, "resetAt": "2021-11-01T16:37:27Z"}}}