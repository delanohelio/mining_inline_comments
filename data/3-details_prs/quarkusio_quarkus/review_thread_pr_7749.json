{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0Mzg2MzExNzQw", "number": 7749, "reviewThreads": {"totalCount": 7, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xMVQwNjoyMToxM1rODm80Yw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xMlQxNjo0OTo0NlrODni19Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjQyMTY4OTMxOnYy", "diffSide": "RIGHT", "path": "extensions/container-image/container-image-s2i/deployment/src/main/java/io/quarkus/container/image/s2i/deployment/S2iProcessor.java", "isResolved": true, "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xMVQwNjoyMToxM1rOF0qaLg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xMVQxMTowMzo0MVrOF0yTxg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MDc2NTEwMg==", "bodyText": "wait - so our own native s2i builder goes an rename to something even more different ?", "url": "https://github.com/quarkusio/quarkus/pull/7749#discussion_r390765102", "createdAt": "2020-03-11T06:21:13Z", "author": {"login": "maxandersen"}, "path": "extensions/container-image/container-image-s2i/deployment/src/main/java/io/quarkus/container/image/s2i/deployment/S2iProcessor.java", "diffHunk": "@@ -102,11 +109,30 @@ public void s2iRequirementsNative(S2iConfig s2iConfig,\n             CurateOutcomeBuildItem curateOutcomeBuildItem,\n             OutputTargetBuildItem out,\n             PackageConfig packageConfig,\n+            NativeImageBuildItem nativeImage,\n             BuildProducer<BaseImageInfoBuildItem> builderImageProducer,\n             BuildProducer<KubernetesCommandBuildItem> commandProducer) {\n \n+        boolean usingDefaultBuilder = ImageUtil.getRepository(S2iConfig.DEFAULT_BASE_NATIVE_IMAGE)\n+                .equals(ImageUtil.getRepository(s2iConfig.baseNativeImage));\n+        String outputNativeBinaryFileName = nativeImage.getPath().getFileName().toString();\n+\n+        String nativeBinaryFileName = null;\n+\n+        //The default s2i builder for native builds, renames the native binary.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "2a5afba54012530256689e03015d0cf0219f059e"}, "originalPosition": 54}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MDc4NTc2Ng==", "bodyText": "I also think this shouldn't happen. It was probably a shortcut to make the run script easier. If anything, it shouldn't be a rename but a symlink.", "url": "https://github.com/quarkusio/quarkus/pull/7749#discussion_r390785766", "createdAt": "2020-03-11T07:31:19Z", "author": {"login": "Ladicek"}, "path": "extensions/container-image/container-image-s2i/deployment/src/main/java/io/quarkus/container/image/s2i/deployment/S2iProcessor.java", "diffHunk": "@@ -102,11 +109,30 @@ public void s2iRequirementsNative(S2iConfig s2iConfig,\n             CurateOutcomeBuildItem curateOutcomeBuildItem,\n             OutputTargetBuildItem out,\n             PackageConfig packageConfig,\n+            NativeImageBuildItem nativeImage,\n             BuildProducer<BaseImageInfoBuildItem> builderImageProducer,\n             BuildProducer<KubernetesCommandBuildItem> commandProducer) {\n \n+        boolean usingDefaultBuilder = ImageUtil.getRepository(S2iConfig.DEFAULT_BASE_NATIVE_IMAGE)\n+                .equals(ImageUtil.getRepository(s2iConfig.baseNativeImage));\n+        String outputNativeBinaryFileName = nativeImage.getPath().getFileName().toString();\n+\n+        String nativeBinaryFileName = null;\n+\n+        //The default s2i builder for native builds, renames the native binary.", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MDc2NTEwMg=="}, "originalCommit": {"oid": "2a5afba54012530256689e03015d0cf0219f059e"}, "originalPosition": 54}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MDg5NDUzNA==", "bodyText": "I logged an issue: quarkusio/quarkus-images#58\nUntil the issue is address we need this, so I'll mark this discussion as resolved.", "url": "https://github.com/quarkusio/quarkus/pull/7749#discussion_r390894534", "createdAt": "2020-03-11T11:03:41Z", "author": {"login": "iocanel"}, "path": "extensions/container-image/container-image-s2i/deployment/src/main/java/io/quarkus/container/image/s2i/deployment/S2iProcessor.java", "diffHunk": "@@ -102,11 +109,30 @@ public void s2iRequirementsNative(S2iConfig s2iConfig,\n             CurateOutcomeBuildItem curateOutcomeBuildItem,\n             OutputTargetBuildItem out,\n             PackageConfig packageConfig,\n+            NativeImageBuildItem nativeImage,\n             BuildProducer<BaseImageInfoBuildItem> builderImageProducer,\n             BuildProducer<KubernetesCommandBuildItem> commandProducer) {\n \n+        boolean usingDefaultBuilder = ImageUtil.getRepository(S2iConfig.DEFAULT_BASE_NATIVE_IMAGE)\n+                .equals(ImageUtil.getRepository(s2iConfig.baseNativeImage));\n+        String outputNativeBinaryFileName = nativeImage.getPath().getFileName().toString();\n+\n+        String nativeBinaryFileName = null;\n+\n+        //The default s2i builder for native builds, renames the native binary.", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MDc2NTEwMg=="}, "originalCommit": {"oid": "2a5afba54012530256689e03015d0cf0219f059e"}, "originalPosition": 54}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjQyMjM0MzU2OnYy", "diffSide": "RIGHT", "path": "extensions/container-image/container-image-s2i/deployment/src/main/java/io/quarkus/container/image/s2i/deployment/S2iConfig.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xMVQxMDoxNDozOFrOF0wpcw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xMVQxMDoxNDozOFrOF0wpcw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MDg2NzMxNQ==", "bodyText": "This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters. Learn more about bidirectional Unicode characters\n\n\n  \n\n\n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                 * This option may be used of the selected s2i image uses a fixed name for the jar.\n          \n          \n            \n                 * This option may be used if the selected s2i image uses a fixed name for the jar.", "url": "https://github.com/quarkusio/quarkus/pull/7749#discussion_r390867315", "createdAt": "2020-03-11T10:14:38Z", "author": {"login": "geoand"}, "path": "extensions/container-image/container-image-s2i/deployment/src/main/java/io/quarkus/container/image/s2i/deployment/S2iConfig.java", "diffHunk": "@@ -38,18 +40,32 @@\n     public List<String> nativeArguments;\n \n     /**\n-     * The path to where the jar is added during the assemble phase.\n+     * The directory where the jar is added during the assemble phase.\n      * This is dependant on the s2i image and should be supplied if a non default image is used.\n      */\n-    @ConfigItem(defaultValue = \"/deployments/application${quarkus.package.runner-suffix}.jar\")\n-    public String jarPath;\n+    @ConfigItem(defaultValue = \"/deployments/\")\n+    public String jarDirectory;\n \n     /**\n-     * The path to where the native binary is added during the assemble phase.\n+     * The resulting filename of the jar in the s2i image.\n+     * This option may be used of the selected s2i image uses a fixed name for the jar.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "2a5afba54012530256689e03015d0cf0219f059e"}, "originalPosition": 32}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjQyMjM0NjE4OnYy", "diffSide": "RIGHT", "path": "extensions/container-image/container-image-s2i/deployment/src/main/java/io/quarkus/container/image/s2i/deployment/S2iConfig.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xMVQxMDoxNToyNFrOF0wrDg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xMVQxMDoxNToyNFrOF0wrDg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MDg2NzcyNg==", "bodyText": "This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters. Learn more about bidirectional Unicode characters\n\n\n  \n\n\n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                 * This is dependant on the s2i image and should be supplied if a non default image is used.\n          \n          \n            \n                 * This is dependant on the s2i image and should be supplied if a non-default image is used.", "url": "https://github.com/quarkusio/quarkus/pull/7749#discussion_r390867726", "createdAt": "2020-03-11T10:15:24Z", "author": {"login": "geoand"}, "path": "extensions/container-image/container-image-s2i/deployment/src/main/java/io/quarkus/container/image/s2i/deployment/S2iConfig.java", "diffHunk": "@@ -38,18 +40,32 @@\n     public List<String> nativeArguments;\n \n     /**\n-     * The path to where the jar is added during the assemble phase.\n+     * The directory where the jar is added during the assemble phase.\n      * This is dependant on the s2i image and should be supplied if a non default image is used.\n      */\n-    @ConfigItem(defaultValue = \"/deployments/application${quarkus.package.runner-suffix}.jar\")\n-    public String jarPath;\n+    @ConfigItem(defaultValue = \"/deployments/\")\n+    public String jarDirectory;\n \n     /**\n-     * The path to where the native binary is added during the assemble phase.\n+     * The resulting filename of the jar in the s2i image.\n+     * This option may be used of the selected s2i image uses a fixed name for the jar.\n+     */\n+    @ConfigItem\n+    public Optional<String> jarFileName;\n+\n+    /**\n+     * The directory where the native binary is added during the assemble phase.\n      * This is dependant on the s2i image and should be supplied if a non default image is used.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "2a5afba54012530256689e03015d0cf0219f059e"}, "originalPosition": 39}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjQyMjM0NzU1OnYy", "diffSide": "RIGHT", "path": "extensions/container-image/container-image-s2i/deployment/src/main/java/io/quarkus/container/image/s2i/deployment/S2iConfig.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xMVQxMDoxNTo0OVrOF0wr5A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xMVQxMDoxNTo0OVrOF0wr5A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MDg2Nzk0MA==", "bodyText": "This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters. Learn more about bidirectional Unicode characters\n\n\n  \n\n\n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                 * This option may be used of the selected s2i image uses a fixed name for the native binary.\n          \n          \n            \n                 * This option may be used if the selected s2i image uses a fixed name for the native binary.", "url": "https://github.com/quarkusio/quarkus/pull/7749#discussion_r390867940", "createdAt": "2020-03-11T10:15:49Z", "author": {"login": "geoand"}, "path": "extensions/container-image/container-image-s2i/deployment/src/main/java/io/quarkus/container/image/s2i/deployment/S2iConfig.java", "diffHunk": "@@ -38,18 +40,32 @@\n     public List<String> nativeArguments;\n \n     /**\n-     * The path to where the jar is added during the assemble phase.\n+     * The directory where the jar is added during the assemble phase.\n      * This is dependant on the s2i image and should be supplied if a non default image is used.\n      */\n-    @ConfigItem(defaultValue = \"/deployments/application${quarkus.package.runner-suffix}.jar\")\n-    public String jarPath;\n+    @ConfigItem(defaultValue = \"/deployments/\")\n+    public String jarDirectory;\n \n     /**\n-     * The path to where the native binary is added during the assemble phase.\n+     * The resulting filename of the jar in the s2i image.\n+     * This option may be used of the selected s2i image uses a fixed name for the jar.\n+     */\n+    @ConfigItem\n+    public Optional<String> jarFileName;\n+\n+    /**\n+     * The directory where the native binary is added during the assemble phase.\n      * This is dependant on the s2i image and should be supplied if a non default image is used.\n      */\n-    @ConfigItem(defaultValue = \"/home/quarkus/application\")\n-    public String nativeBinaryPath;\n+    @ConfigItem(defaultValue = \"/home/quarkus/\")\n+    public String nativeBinaryDirectory;\n+\n+    /**\n+     * The resulting filename of the native binary in the s2i image.\n+     * This option may be used of the selected s2i image uses a fixed name for the native binary.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "2a5afba54012530256689e03015d0cf0219f059e"}, "originalPosition": 48}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjQyNjEzMTU1OnYy", "diffSide": "RIGHT", "path": "extensions/container-image/container-image-s2i/deployment/src/main/java/io/quarkus/container/image/s2i/deployment/S2iConfig.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xMlQwODozNzo0NVrOF1VURA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xMlQwODozOTozMFrOF1VXaA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MTQ2ODEwMA==", "bodyText": "I'm not sure if this is a good idea, purely from \"legal\" point of view. This is RHEL, after all. Too bad UBI Java isn't ready yet :-(", "url": "https://github.com/quarkusio/quarkus/pull/7749#discussion_r391468100", "createdAt": "2020-03-12T08:37:45Z", "author": {"login": "Ladicek"}, "path": "extensions/container-image/container-image-s2i/deployment/src/main/java/io/quarkus/container/image/s2i/deployment/S2iConfig.java", "diffHunk": "@@ -11,7 +11,7 @@\n @ConfigRoot(phase = ConfigPhase.BUILD_TIME)\n public class S2iConfig {\n \n-    public static final String DEFAULT_BASE_JVM_IMAGE = \"fabric8/s2i-java:2.3\";\n+    public static final String DEFAULT_BASE_JVM_IMAGE = \"registry.access.redhat.com/openjdk/openjdk-11-rhel7\";", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a3a666fc002e576443823dc64ea8b3a8848dbd3e"}, "originalPosition": 5}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MTQ2ODkwNA==", "bodyText": "@maxandersen any idea about this?", "url": "https://github.com/quarkusio/quarkus/pull/7749#discussion_r391468904", "createdAt": "2020-03-12T08:39:30Z", "author": {"login": "geoand"}, "path": "extensions/container-image/container-image-s2i/deployment/src/main/java/io/quarkus/container/image/s2i/deployment/S2iConfig.java", "diffHunk": "@@ -11,7 +11,7 @@\n @ConfigRoot(phase = ConfigPhase.BUILD_TIME)\n public class S2iConfig {\n \n-    public static final String DEFAULT_BASE_JVM_IMAGE = \"fabric8/s2i-java:2.3\";\n+    public static final String DEFAULT_BASE_JVM_IMAGE = \"registry.access.redhat.com/openjdk/openjdk-11-rhel7\";", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MTQ2ODEwMA=="}, "originalCommit": {"oid": "a3a666fc002e576443823dc64ea8b3a8848dbd3e"}, "originalPosition": 5}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjQyNjE2NTAwOnYy", "diffSide": "RIGHT", "path": "extensions/container-image/container-image-s2i/deployment/src/main/java/io/quarkus/container/image/s2i/deployment/S2iBaseJavaImage.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xMlQwODo0ODo0M1rOF1VpCQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xMlQxMDowNDoyOFrOF1YIhA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MTQ3MzQxNw==", "bodyText": "There are 4 Red Hat OpenJDK images that I'm aware of (OpenJDK 8 and 11, RHEL 7 and 8), some of them being available from 2 registries (authenticated and unauthenticated).\n\nOpenJDK 8 (I'm not sure if we still support Java 8, but we probably do. Defaulting to 11 is probably good though.)\n\nRHEL 7\n\nregistry.access.redhat.com/redhat-openjdk-18/openjdk18-openshift\nregistry.redhat.io/redhat-openjdk-18/openjdk18-openshift\n\n\nRHEL 8\n\nregistry.redhat.io/openjdk/openjdk-8-rhel8 (registry.access.redhat.com variant not available)\n\n\n\n\nOpenJDK 11\n\nRHEL 7\n\nregistry.access.redhat.com/openjdk/openjdk-11-rhel7\nregistry.redhat.io/openjdk/openjdk-11-rhel7\n\n\nRHEL 8\n\nregistry.redhat.io/openjdk/openjdk-11-rhel8 (registry.access.redhat.com variant not available)\n\n\n\n\n\nThey all have different tags (as does the Fabric8 image), which should all be recognized. (That is, tag should be ignored when searching.)", "url": "https://github.com/quarkusio/quarkus/pull/7749#discussion_r391473417", "createdAt": "2020-03-12T08:48:43Z", "author": {"login": "Ladicek"}, "path": "extensions/container-image/container-image-s2i/deployment/src/main/java/io/quarkus/container/image/s2i/deployment/S2iBaseJavaImage.java", "diffHunk": "@@ -0,0 +1,64 @@\n+\n+package io.quarkus.container.image.s2i.deployment;\n+\n+import java.util.Optional;\n+\n+import io.quarkus.container.image.deployment.util.ImageUtil;\n+\n+public enum S2iBaseJavaImage {\n+\n+    FABRIC8(\"fabric8/s2i-java:2.3\", \"JAVA_MAIN_CLASS\", \"JAVA_APP_JAR\", \"JAVA_LIB_DIR\", \"JAVA_CLASSPATH\", \"JAVA_OPTIONS\"),\n+    OPENJDK(\"registry.access.redhat.com/openjdk/openjdk-11-rhel7\", \"JAVA_MAIN_CLASS\", \"JAVA_APP_JAR\", \"JAVA_LIB_DIR\",", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "135dc61be2b39f45039b1401ad3b822511121050"}, "originalPosition": 11}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MTUxNDI0NA==", "bodyText": "Added more images. Also cleaned them up a little bit, as the registry is stripped when performing the comparison.", "url": "https://github.com/quarkusio/quarkus/pull/7749#discussion_r391514244", "createdAt": "2020-03-12T10:04:28Z", "author": {"login": "iocanel"}, "path": "extensions/container-image/container-image-s2i/deployment/src/main/java/io/quarkus/container/image/s2i/deployment/S2iBaseJavaImage.java", "diffHunk": "@@ -0,0 +1,64 @@\n+\n+package io.quarkus.container.image.s2i.deployment;\n+\n+import java.util.Optional;\n+\n+import io.quarkus.container.image.deployment.util.ImageUtil;\n+\n+public enum S2iBaseJavaImage {\n+\n+    FABRIC8(\"fabric8/s2i-java:2.3\", \"JAVA_MAIN_CLASS\", \"JAVA_APP_JAR\", \"JAVA_LIB_DIR\", \"JAVA_CLASSPATH\", \"JAVA_OPTIONS\"),\n+    OPENJDK(\"registry.access.redhat.com/openjdk/openjdk-11-rhel7\", \"JAVA_MAIN_CLASS\", \"JAVA_APP_JAR\", \"JAVA_LIB_DIR\",", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MTQ3MzQxNw=="}, "originalCommit": {"oid": "135dc61be2b39f45039b1401ad3b822511121050"}, "originalPosition": 11}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjQyNzkxOTI1OnYy", "diffSide": "RIGHT", "path": "extensions/container-image/container-image-s2i/deployment/src/main/java/io/quarkus/container/image/s2i/deployment/S2iProcessor.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xMlQxNjo0OTo0NlrOF1m0iw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xMlQxNjo0OTo0NlrOF1m0iw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MTc1NDg5MQ==", "bodyText": "I wonder what happens on Windows, would this possibly generate Windows-style paths into the Kubernetes YAML? (Didn't check, just thinking aloud.)", "url": "https://github.com/quarkusio/quarkus/pull/7749#discussion_r391754891", "createdAt": "2020-03-12T16:49:46Z", "author": {"login": "Ladicek"}, "path": "extensions/container-image/container-image-s2i/deployment/src/main/java/io/quarkus/container/image/s2i/deployment/S2iProcessor.java", "diffHunk": "@@ -61,53 +65,100 @@\n import io.quarkus.kubernetes.client.deployment.KubernetesClientErrorHanlder;\n import io.quarkus.kubernetes.client.spi.KubernetesClientBuildItem;\n import io.quarkus.kubernetes.spi.KubernetesCommandBuildItem;\n+import io.quarkus.kubernetes.spi.KubernetesEnvBuildItem;\n \n public class S2iProcessor {\n \n     private static final String S2I = \"s2i\";\n-    private static final String JAR_ARTIFACT_FORMAT = \"%s%s.jar\";\n-    private static final String NATIVE_ARTIFACT_FORMAT = \"%s%s\";\n+    private static final String OPENSHIFT = \"openshift\";\n     private static final String BUILD_CONFIG_NAME = \"openshift.io/build-config.name\";\n     private static final String RUNNING = \"Running\";\n \n     private static final Logger LOG = Logger.getLogger(S2iProcessor.class);\n \n-    @BuildStep(onlyIf = { IsNormal.class, S2iBuild.class }, onlyIfNot = NativeBuild.class)\n+    @BuildStep(onlyIf = IsNormal.class, onlyIfNot = NativeBuild.class)\n     public void s2iRequirementsJvm(S2iConfig s2iConfig,\n             CurateOutcomeBuildItem curateOutcomeBuildItem,\n             OutputTargetBuildItem out,\n             PackageConfig packageConfig,\n+            JarBuildItem jarBuildItem,\n+            BuildProducer<KubernetesEnvBuildItem> envProducer,\n             BuildProducer<BaseImageInfoBuildItem> builderImageProducer,\n             BuildProducer<KubernetesCommandBuildItem> commandProducer) {\n \n         final List<AppDependency> appDeps = curateOutcomeBuildItem.getEffectiveModel().getUserDependencies();\n+        String outputJarFileName = jarBuildItem.getPath().getFileName().toString();\n         String classpath = appDeps.stream()\n-                .map(d -> Paths.get(s2iConfig.jarPath).getParent().resolve(\"lib\")\n-                        .resolve(d.getArtifact().getGroupId() + \".\" + d.getArtifact().getPath().getFileName()).toAbsolutePath()\n+                .map(d -> String.valueOf(d.getArtifact().getGroupId() + \".\" + d.getArtifact().getPath().getFileName()))\n+                .map(s -> Paths.get(s2iConfig.jarDirectory).resolve(\"lib\").resolve(s).toAbsolutePath()", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "66dd28cf8e71f859554566c7646839eacc250132"}, "originalPosition": 51}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4804, "cost": 1, "resetAt": "2021-11-13T14:23:39Z"}}}