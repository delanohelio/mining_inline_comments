{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTA2NzQxMjcw", "number": 12825, "reviewThreads": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yMFQxNDo0ODo0MFrOEv0d2w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yMFQxNDo0ODo0MFrOEv0d2w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzE4NTc4MTM5OnYy", "diffSide": "RIGHT", "path": "extensions/jdbc/jdbc-mysql/deployment/src/main/java/io/quarkus/jdbc/mysql/deployment/JDBCMySQLProcessor.java", "isResolved": true, "comments": {"totalCount": 7, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yMFQxNDo0ODo0MFrOHlA8cA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yMFQxNToyMToxNVrOHlClRQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwODU3NDgzMg==", "bodyText": "This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters. Learn more about bidirectional Unicode characters\n\n\n  \n\n\n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                @BuildStep\n          \n          \n            \n                @BuildStep(onlyIfNot = NativeBuild.class)\n          \n      \n    \n    \n  \n\nwould make it clearer.", "url": "https://github.com/quarkusio/quarkus/pull/12825#discussion_r508574832", "createdAt": "2020-10-20T14:48:40Z", "author": {"login": "gsmet"}, "path": "extensions/jdbc/jdbc-mysql/deployment/src/main/java/io/quarkus/jdbc/mysql/deployment/JDBCMySQLProcessor.java", "diffHunk": "@@ -86,6 +78,16 @@ NativeImageEnableAllTimeZonesBuildItem enableAllTimeZones() {\n         return new NativeImageEnableAllTimeZonesBuildItem();\n     }\n \n+    @BuildStep\n+    NativeImageSystemPropertyBuildItem disableAbandonedConnectionCleanUpInNativeMode() {\n+        return new NativeImageSystemPropertyBuildItem(\"com.mysql.cj.disableAbandonedConnectionCleanup\", \"true\");\n+    }\n+\n+    @BuildStep", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "62ee0faaf5105ab6a7e993c8be29bee2e49ee8fb"}, "originalPosition": 42}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwODU3NzA1Mg==", "bodyText": "I was wondering about that.. woudldn't it be enough to just have this single buildStep?", "url": "https://github.com/quarkusio/quarkus/pull/12825#discussion_r508577052", "createdAt": "2020-10-20T14:51:13Z", "author": {"login": "Sanne"}, "path": "extensions/jdbc/jdbc-mysql/deployment/src/main/java/io/quarkus/jdbc/mysql/deployment/JDBCMySQLProcessor.java", "diffHunk": "@@ -86,6 +78,16 @@ NativeImageEnableAllTimeZonesBuildItem enableAllTimeZones() {\n         return new NativeImageEnableAllTimeZonesBuildItem();\n     }\n \n+    @BuildStep\n+    NativeImageSystemPropertyBuildItem disableAbandonedConnectionCleanUpInNativeMode() {\n+        return new NativeImageSystemPropertyBuildItem(\"com.mysql.cj.disableAbandonedConnectionCleanup\", \"true\");\n+    }\n+\n+    @BuildStep", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwODU3NDgzMg=="}, "originalCommit": {"oid": "62ee0faaf5105ab6a7e993c8be29bee2e49ee8fb"}, "originalPosition": 42}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwODU4MTAzMQ==", "bodyText": "I was wondering about that.. woudldn't it be enough to just have this single buildStep?\n\nWould SystemPropertyBuildItem be consumed and produce the NativeImageSystemPropertyBuildItem? My first time producing either of them so I might be missing something.", "url": "https://github.com/quarkusio/quarkus/pull/12825#discussion_r508581031", "createdAt": "2020-10-20T14:55:50Z", "author": {"login": "machi1990"}, "path": "extensions/jdbc/jdbc-mysql/deployment/src/main/java/io/quarkus/jdbc/mysql/deployment/JDBCMySQLProcessor.java", "diffHunk": "@@ -86,6 +78,16 @@ NativeImageEnableAllTimeZonesBuildItem enableAllTimeZones() {\n         return new NativeImageEnableAllTimeZonesBuildItem();\n     }\n \n+    @BuildStep\n+    NativeImageSystemPropertyBuildItem disableAbandonedConnectionCleanUpInNativeMode() {\n+        return new NativeImageSystemPropertyBuildItem(\"com.mysql.cj.disableAbandonedConnectionCleanup\", \"true\");\n+    }\n+\n+    @BuildStep", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwODU3NDgzMg=="}, "originalCommit": {"oid": "62ee0faaf5105ab6a7e993c8be29bee2e49ee8fb"}, "originalPosition": 42}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwODU4MzM5MQ==", "bodyText": "I don't know :) @gsmet ?", "url": "https://github.com/quarkusio/quarkus/pull/12825#discussion_r508583391", "createdAt": "2020-10-20T14:58:34Z", "author": {"login": "Sanne"}, "path": "extensions/jdbc/jdbc-mysql/deployment/src/main/java/io/quarkus/jdbc/mysql/deployment/JDBCMySQLProcessor.java", "diffHunk": "@@ -86,6 +78,16 @@ NativeImageEnableAllTimeZonesBuildItem enableAllTimeZones() {\n         return new NativeImageEnableAllTimeZonesBuildItem();\n     }\n \n+    @BuildStep\n+    NativeImageSystemPropertyBuildItem disableAbandonedConnectionCleanUpInNativeMode() {\n+        return new NativeImageSystemPropertyBuildItem(\"com.mysql.cj.disableAbandonedConnectionCleanup\", \"true\");\n+    }\n+\n+    @BuildStep", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwODU3NDgzMg=="}, "originalCommit": {"oid": "62ee0faaf5105ab6a7e993c8be29bee2e49ee8fb"}, "originalPosition": 42}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwODU5NDYwNg==", "bodyText": "I think it's OK the way it is now.", "url": "https://github.com/quarkusio/quarkus/pull/12825#discussion_r508594606", "createdAt": "2020-10-20T15:12:32Z", "author": {"login": "gsmet"}, "path": "extensions/jdbc/jdbc-mysql/deployment/src/main/java/io/quarkus/jdbc/mysql/deployment/JDBCMySQLProcessor.java", "diffHunk": "@@ -86,6 +78,16 @@ NativeImageEnableAllTimeZonesBuildItem enableAllTimeZones() {\n         return new NativeImageEnableAllTimeZonesBuildItem();\n     }\n \n+    @BuildStep\n+    NativeImageSystemPropertyBuildItem disableAbandonedConnectionCleanUpInNativeMode() {\n+        return new NativeImageSystemPropertyBuildItem(\"com.mysql.cj.disableAbandonedConnectionCleanup\", \"true\");\n+    }\n+\n+    @BuildStep", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwODU3NDgzMg=="}, "originalCommit": {"oid": "62ee0faaf5105ab6a7e993c8be29bee2e49ee8fb"}, "originalPosition": 42}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwODU5ODExNg==", "bodyText": "I was wondering about that.. woudldn't it be enough to just have this single buildStep?\n\n\nTested it and it works by only producing the SystemPropertyBuildItem. But to get an answer to my question below ...\n\nWould SystemPropertyBuildItem be consumed and produce the NativeImageSystemPropertyBuildItem? My first time producing either of them so I might be missing something.\n\nWith only the SystemPropertyBuildItem the command to generate native image is:\nnative-image -J-Djava.util.logging.manager=org.jboss.logmanager.LogManager -J-Dsun.nio.ch.maxUpdateArraySize=100 -J-DCoordinatorEnvironmentBean.transactionStatusManagerEnable=false -J-Dvertx.logger-delegate-factory-class-name=io.quarkus.vertx.core.runtime.VertxLogDelegateFactory -J-Dvertx.disableDnsResolver=true -J-Dio.netty.leakDetection.level=DISABLED -J-Dio.netty.allocator.maxOrder=1 -J-Duser.language=en -J-Dfile.encoding=UTF-8 --initialize-at-build-time= -H:InitialCollectionPolicy=com.oracle.svm.core.genscavenge.CollectionPolicy\\$BySpaceAndTime -H:+JNI -jar quarkus-integration-test-jpa-mysql-999-SNAPSHOT-runner.jar -H:FallbackThreshold=0 -H:+ReportExceptionStackTraces -H:+AddAllCharsets -H:EnableURLProtocols=http,https --enable-all-security-services -H:NativeLinkerOption=-no-pie --no-server -H:-UseServiceLoaderFeature -H:+StackTrace quarkus-integration-test-jpa-mysql-999-SNAPSHOT-runner\nWith the NativeImageSystemPropertyBuildItem the command become:\nnative-image -J-Dsun.nio.ch.maxUpdateArraySize=100 -J-Djava.util.logging.manager=org.jboss.logmanager.LogManager -J-Dcom.mysql.cj.disableAbandonedConnectionCleanup=true -J-DCoordinatorEnvironmentBean.transactionStatusManagerEnable=false -J-Dvertx.logger-delegate-factory-class-name=io.quarkus.vertx.core.runtime.VertxLogDelegateFactory -J-Dvertx.disableDnsResolver=true -J-Dio.netty.leakDetection.level=DISABLED -J-Dio.netty.allocator.maxOrder=1 -J-Duser.language=en -J-Dfile.encoding=UTF-8 --initialize-at-build-time= -H:InitialCollectionPolicy=com.oracle.svm.core.genscavenge.CollectionPolicy\\$BySpaceAndTime -H:+JNI -jar quarkus-integration-test-jpa-mysql-999-SNAPSHOT-runner.jar -H:FallbackThreshold=0 -H:+ReportExceptionStackTraces -H:+AddAllCharsets -H:EnableURLProtocols=http,https --enable-all-security-services -H:NativeLinkerOption=-no-pie --no-server -H:-UseServiceLoaderFeature -H:+StackTrace quarkus-integration-test-jpa-mysql-999-SNAPSHOT-runner\nNotice the -J-Dcom.mysql.cj.disableAbandonedConnectionCleanup=true in the second command which is missing from the first.\nI think for the sake of being explicit in the generated command, I'd stick with producing the two build items.", "url": "https://github.com/quarkusio/quarkus/pull/12825#discussion_r508598116", "createdAt": "2020-10-20T15:17:02Z", "author": {"login": "machi1990"}, "path": "extensions/jdbc/jdbc-mysql/deployment/src/main/java/io/quarkus/jdbc/mysql/deployment/JDBCMySQLProcessor.java", "diffHunk": "@@ -86,6 +78,16 @@ NativeImageEnableAllTimeZonesBuildItem enableAllTimeZones() {\n         return new NativeImageEnableAllTimeZonesBuildItem();\n     }\n \n+    @BuildStep\n+    NativeImageSystemPropertyBuildItem disableAbandonedConnectionCleanUpInNativeMode() {\n+        return new NativeImageSystemPropertyBuildItem(\"com.mysql.cj.disableAbandonedConnectionCleanup\", \"true\");\n+    }\n+\n+    @BuildStep", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwODU3NDgzMg=="}, "originalCommit": {"oid": "62ee0faaf5105ab6a7e993c8be29bee2e49ee8fb"}, "originalPosition": 42}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwODYwMTY2OQ==", "bodyText": "Sure. But thanks for testing it! Good to know.", "url": "https://github.com/quarkusio/quarkus/pull/12825#discussion_r508601669", "createdAt": "2020-10-20T15:21:15Z", "author": {"login": "Sanne"}, "path": "extensions/jdbc/jdbc-mysql/deployment/src/main/java/io/quarkus/jdbc/mysql/deployment/JDBCMySQLProcessor.java", "diffHunk": "@@ -86,6 +78,16 @@ NativeImageEnableAllTimeZonesBuildItem enableAllTimeZones() {\n         return new NativeImageEnableAllTimeZonesBuildItem();\n     }\n \n+    @BuildStep\n+    NativeImageSystemPropertyBuildItem disableAbandonedConnectionCleanUpInNativeMode() {\n+        return new NativeImageSystemPropertyBuildItem(\"com.mysql.cj.disableAbandonedConnectionCleanup\", \"true\");\n+    }\n+\n+    @BuildStep", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwODU3NDgzMg=="}, "originalCommit": {"oid": "62ee0faaf5105ab6a7e993c8be29bee2e49ee8fb"}, "originalPosition": 42}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4190, "cost": 1, "resetAt": "2021-11-13T14:23:39Z"}}}