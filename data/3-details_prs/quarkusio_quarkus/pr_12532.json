{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDk4MDc5MjMz", "number": 12532, "title": "Ability to handle both exit code and exception when running CLI applications", "bodyText": "Fixes #12397\nA few points:\n\nBasically, if an exit handler is provided we don't do any logging but leave to the custom exit handler to deal with both exit code and exception\nI've removed logging from Application so that any logging can be done depending on whether or not an exit handler is provided.\n\nI'm not sure if that is the best approach but it helps to allow CLI applications to better handle messages to their users without necessarily show Quarkus messages and stack traces.", "createdAt": "2020-10-05T19:49:55Z", "url": "https://github.com/quarkusio/quarkus/pull/12532", "merged": true, "mergeCommit": {"oid": "c82e3047269b551c81881b2490a2b211eb6378ea"}, "closed": true, "closedAt": "2020-10-08T09:40:46Z", "author": {"login": "pedroigor"}, "timelineItems": {"totalCount": 7, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdPqHvZABqjM4NDIzNzg5ODY=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdQWtErAFqTUwNDM2MDEzNA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "4fe3952549588e8cde08b163a59f16eefde67432", "author": {"user": {"login": "pedroigor", "name": "Pedro Igor"}}, "url": "https://github.com/quarkusio/quarkus/commit/4fe3952549588e8cde08b163a59f16eefde67432", "committedDate": "2020-10-05T19:42:47Z", "message": "Ability to handle both exit code and exception when running CLI applications"}, "afterCommit": {"oid": "17cfbcf235ed5f00b90600025c64494268547bad", "author": {"user": {"login": "pedroigor", "name": "Pedro Igor"}}, "url": "https://github.com/quarkusio/quarkus/commit/17cfbcf235ed5f00b90600025c64494268547bad", "committedDate": "2020-10-05T20:50:25Z", "message": "Ability to handle both exit code and exception when running CLI applications"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "17cfbcf235ed5f00b90600025c64494268547bad", "author": {"user": {"login": "pedroigor", "name": "Pedro Igor"}}, "url": "https://github.com/quarkusio/quarkus/commit/17cfbcf235ed5f00b90600025c64494268547bad", "committedDate": "2020-10-05T20:50:25Z", "message": "Ability to handle both exit code and exception when running CLI applications"}, "afterCommit": {"oid": "ac593bfae6fc45d1eea21f2dd4c5e64c7e32570f", "author": {"user": {"login": "pedroigor", "name": "Pedro Igor"}}, "url": "https://github.com/quarkusio/quarkus/commit/ac593bfae6fc45d1eea21f2dd4c5e64c7e32570f", "committedDate": "2020-10-05T21:35:13Z", "message": "Ability to handle both exit code and exception when running CLI applications"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "ac593bfae6fc45d1eea21f2dd4c5e64c7e32570f", "author": {"user": {"login": "pedroigor", "name": "Pedro Igor"}}, "url": "https://github.com/quarkusio/quarkus/commit/ac593bfae6fc45d1eea21f2dd4c5e64c7e32570f", "committedDate": "2020-10-05T21:35:13Z", "message": "Ability to handle both exit code and exception when running CLI applications"}, "afterCommit": {"oid": "95470281c06dcd19361e198695144859e4fb9d3c", "author": {"user": {"login": "pedroigor", "name": "Pedro Igor"}}, "url": "https://github.com/quarkusio/quarkus/commit/95470281c06dcd19361e198695144859e4fb9d3c", "committedDate": "2020-10-05T22:37:28Z", "message": "Ability to handle both exit code and exception when running CLI applications"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTAzNDk1MTU2", "url": "https://github.com/quarkusio/quarkus/pull/12532#pullrequestreview-503495156", "createdAt": "2020-10-07T03:10:17Z", "commit": {"oid": "95470281c06dcd19361e198695144859e4fb9d3c"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wN1QwMzoxMDoxN1rOHdhDwA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wN1QwMzoxOToyOFrOHdhMaQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMDcxMjM4NA==", "bodyText": "I don't think this is true any more.", "url": "https://github.com/quarkusio/quarkus/pull/12532#discussion_r500712384", "createdAt": "2020-10-07T03:10:17Z", "author": {"login": "stuartwdouglas"}, "path": "core/runtime/src/main/java/io/quarkus/runtime/ApplicationLifecycleManager.java", "diffHunk": "@@ -136,10 +138,15 @@ public static void run(Application application, Class<? extends QuarkusApplicati\n                 }\n             }\n         } catch (Exception e) {\n-            if (appStarted) {\n-                //we only log if the error occurred after the application was started\n-                //as the generated application class already has logging\n-                Logger.getLogger(Application.class).error(\"Error running Quarkus application\", e);\n+            if (exitCodeHandler == null) {\n+                if (appStarted) {\n+                    //we only log if the error occurred after the application was started\n+                    //as the generated application class already has logging", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "95470281c06dcd19361e198695144859e4fb9d3c"}, "originalPosition": 57}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMDcxNDYwMQ==", "bodyText": "I don't think the if statement is necessary here any more.", "url": "https://github.com/quarkusio/quarkus/pull/12532#discussion_r500714601", "createdAt": "2020-10-07T03:19:28Z", "author": {"login": "stuartwdouglas"}, "path": "core/runtime/src/main/java/io/quarkus/runtime/ApplicationLifecycleManager.java", "diffHunk": "@@ -136,10 +138,15 @@ public static void run(Application application, Class<? extends QuarkusApplicati\n                 }\n             }\n         } catch (Exception e) {\n-            if (appStarted) {\n-                //we only log if the error occurred after the application was started\n-                //as the generated application class already has logging\n-                Logger.getLogger(Application.class).error(\"Error running Quarkus application\", e);\n+            if (exitCodeHandler == null) {\n+                if (appStarted) {\n+                    //we only log if the error occurred after the application was started\n+                    //as the generated application class already has logging\n+                    Logger.getLogger(Application.class).error(\"Error running Quarkus application\", e);\n+                } else {\n+                    Logger.getLogger(Application.class).errorv(e, \"Failed to start application (with profile {0})\",", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "95470281c06dcd19361e198695144859e4fb9d3c"}, "originalPosition": 60}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "1e6302b4b4a32b5d7b25cc08869c7445489cb0d6", "author": {"user": {"login": "pedroigor", "name": "Pedro Igor"}}, "url": "https://github.com/quarkusio/quarkus/commit/1e6302b4b4a32b5d7b25cc08869c7445489cb0d6", "committedDate": "2020-10-07T11:18:42Z", "message": "Ability to handle both exit code and exception when running CLI applications"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "95470281c06dcd19361e198695144859e4fb9d3c", "author": {"user": {"login": "pedroigor", "name": "Pedro Igor"}}, "url": "https://github.com/quarkusio/quarkus/commit/95470281c06dcd19361e198695144859e4fb9d3c", "committedDate": "2020-10-05T22:37:28Z", "message": "Ability to handle both exit code and exception when running CLI applications"}, "afterCommit": {"oid": "1e6302b4b4a32b5d7b25cc08869c7445489cb0d6", "author": {"user": {"login": "pedroigor", "name": "Pedro Igor"}}, "url": "https://github.com/quarkusio/quarkus/commit/1e6302b4b4a32b5d7b25cc08869c7445489cb0d6", "committedDate": "2020-10-07T11:18:42Z", "message": "Ability to handle both exit code and exception when running CLI applications"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTA0MzYwMTM0", "url": "https://github.com/quarkusio/quarkus/pull/12532#pullrequestreview-504360134", "createdAt": "2020-10-08T00:47:11Z", "commit": {"oid": "1e6302b4b4a32b5d7b25cc08869c7445489cb0d6"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1869, "cost": 1, "resetAt": "2021-11-01T16:37:27Z"}}}