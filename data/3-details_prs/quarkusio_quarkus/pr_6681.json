{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0MzY1Mjg0NjAw", "number": 6681, "title": "Ensure that a missing user.country system property doesn't break the application", "bodyText": "", "createdAt": "2020-01-21T12:41:23Z", "url": "https://github.com/quarkusio/quarkus/pull/6681", "merged": true, "mergeCommit": {"oid": "d890466091be6954d08e939ca32f777db49a73c1"}, "closed": true, "closedAt": "2020-01-21T21:11:39Z", "author": {"login": "geoand"}, "timelineItems": {"totalCount": 15, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABb8ghY4gFqTM0NTg0ODAyNg==", "endCursor": "Y3Vyc29yOnYyOpPPAAABb8mGjSABqjI5Njc0MzQzODY=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzQ1ODQ4MDI2", "url": "https://github.com/quarkusio/quarkus/pull/6681#pullrequestreview-345848026", "createdAt": "2020-01-21T12:43:49Z", "commit": {"oid": "bcda3882a6173df10781668a3cdea603e0a9cf4c"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "bcda3882a6173df10781668a3cdea603e0a9cf4c", "author": {"user": {"login": "geoand", "name": "Georgios Andrianakis"}}, "url": "https://github.com/quarkusio/quarkus/commit/bcda3882a6173df10781668a3cdea603e0a9cf4c", "committedDate": "2020-01-21T12:40:46Z", "message": "Ensure that a missing user.country system property doesn't break the application\n\nThis can happen in CI:\nhttps://github.com/apache/camel-quarkus/pull/603#issuecomment-576636989"}, "afterCommit": {"oid": "a6047d02efdbe949ac0ee1a3db11bdea6019828c", "author": {"user": {"login": "geoand", "name": "Georgios Andrianakis"}}, "url": "https://github.com/quarkusio/quarkus/commit/a6047d02efdbe949ac0ee1a3db11bdea6019828c", "committedDate": "2020-01-21T12:45:48Z", "message": "Ensure that a missing user.country system property doesn't break the application\n\nThis can happen in CI:\nhttps://github.com/apache/camel-quarkus/pull/603#issuecomment-576636989\n\nCo-Authored-By: Guillaume Smet <guillaume.smet@gmail.com>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzQ1ODg5NTA0", "url": "https://github.com/quarkusio/quarkus/pull/6681#pullrequestreview-345889504", "createdAt": "2020-01-21T13:50:49Z", "commit": {"oid": "19c60b6107a49b0c3f8eddafbf8c1055a407ef1b"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yMVQxMzo1MDo0OVrOFf6m9w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yMVQxMzo1MDo0OVrOFf6m9w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2OTAxMDQyMw==", "bodyText": "The idea here is to return null only when no locale value is set explicitly, but instead the defaults are both empty. This allows the user explicitly set locale strings like en- or en-US even when there are no default values.\nIf the default values are empty and the user doesn't specify any locales, then a higher up layer will end up throwing an exception like:\njava.lang.RuntimeException: java.util.NoSuchElementException: Property quarkus.locales not found", "url": "https://github.com/quarkusio/quarkus/pull/6681#discussion_r369010423", "createdAt": "2020-01-21T13:50:49Z", "author": {"login": "geoand"}, "path": "core/runtime/src/main/java/io/quarkus/runtime/configuration/LocaleConverter.java", "diffHunk": "@@ -29,6 +32,11 @@ public Locale convert(final String value) {\n             return null;\n         }\n \n+        if (localeValue.equals(\"-\")) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "19c60b6107a49b0c3f8eddafbf8c1055a407ef1b"}, "originalPosition": 21}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "19c60b6107a49b0c3f8eddafbf8c1055a407ef1b", "author": {"user": {"login": "geoand", "name": "Georgios Andrianakis"}}, "url": "https://github.com/quarkusio/quarkus/commit/19c60b6107a49b0c3f8eddafbf8c1055a407ef1b", "committedDate": "2020-01-21T13:44:44Z", "message": "Also ensure that user.language can be empty\n\nThis property is also not a spec property:\nhttps://docs.oracle.com/en/java/javase/13/docs/api/java.base/java/lang/System.html#getProperties()"}, "afterCommit": {"oid": "f93e01a5de5c893b088bed09f04a94480dfe1fde", "author": {"user": {"login": "geoand", "name": "Georgios Andrianakis"}}, "url": "https://github.com/quarkusio/quarkus/commit/f93e01a5de5c893b088bed09f04a94480dfe1fde", "committedDate": "2020-01-21T14:14:43Z", "message": "Use en as the default language when all else is empty\n\nCo-Authored-By: Guillaume Smet <guillaume.smet@gmail.com>"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "f93e01a5de5c893b088bed09f04a94480dfe1fde", "author": {"user": {"login": "geoand", "name": "Georgios Andrianakis"}}, "url": "https://github.com/quarkusio/quarkus/commit/f93e01a5de5c893b088bed09f04a94480dfe1fde", "committedDate": "2020-01-21T14:14:43Z", "message": "Use en as the default language when all else is empty\n\nCo-Authored-By: Guillaume Smet <guillaume.smet@gmail.com>"}, "afterCommit": {"oid": "fbb246d00bc2d7eed07e9544b409f8e1676f02de", "author": {"user": {"login": "geoand", "name": "Georgios Andrianakis"}}, "url": "https://github.com/quarkusio/quarkus/commit/fbb246d00bc2d7eed07e9544b409f8e1676f02de", "committedDate": "2020-01-21T14:15:51Z", "message": "Use en as the default language when all else is empty\n\nCo-Authored-By: Guillaume Smet <guillaume.smet@gmail.com>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzQ1OTE3MTQ4", "url": "https://github.com/quarkusio/quarkus/pull/6681#pullrequestreview-345917148", "createdAt": "2020-01-21T14:27:45Z", "commit": {"oid": "fbb246d00bc2d7eed07e9544b409f8e1676f02de"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "fbb246d00bc2d7eed07e9544b409f8e1676f02de", "author": {"user": {"login": "geoand", "name": "Georgios Andrianakis"}}, "url": "https://github.com/quarkusio/quarkus/commit/fbb246d00bc2d7eed07e9544b409f8e1676f02de", "committedDate": "2020-01-21T14:15:51Z", "message": "Use en as the default language when all else is empty\n\nCo-Authored-By: Guillaume Smet <guillaume.smet@gmail.com>"}, "afterCommit": {"oid": "c9a79be6b4d18e0b2ae1eeeac396c5778e690629", "author": {"user": {"login": "geoand", "name": "Georgios Andrianakis"}}, "url": "https://github.com/quarkusio/quarkus/commit/c9a79be6b4d18e0b2ae1eeeac396c5778e690629", "committedDate": "2020-01-21T16:03:09Z", "message": "Use en as the default language when all else is empty\n\nCo-Authored-By: Guillaume Smet <guillaume.smet@gmail.com>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzQ1OTk5NDE5", "url": "https://github.com/quarkusio/quarkus/pull/6681#pullrequestreview-345999419", "createdAt": "2020-01-21T16:09:31Z", "commit": {"oid": "c9a79be6b4d18e0b2ae1eeeac396c5778e690629"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yMVQxNjowOTozMVrOFf_wAg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yMVQxNjowOTozMVrOFf_wAg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2OTA5NDY1OA==", "bodyText": "Why not use the @BeforeAll annotation in a static method?", "url": "https://github.com/quarkusio/quarkus/pull/6681#discussion_r369094658", "createdAt": "2020-01-21T16:09:31Z", "author": {"login": "gastaldi"}, "path": "test-framework/junit5-internal/src/main/java/io/quarkus/test/QuarkusUnitTest.java", "diffHunk": "@@ -133,6 +135,18 @@ public QuarkusUnitTest setLogFileName(String logFileName) {\n         return this;\n     }\n \n+    // set a Runnable that will run before ANYTHING else is done\n+    public QuarkusUnitTest setBeforeAllCustomizer(Runnable beforeAllCustomizer) {\n+        this.beforeAllCustomizer = beforeAllCustomizer;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c9a79be6b4d18e0b2ae1eeeac396c5778e690629"}, "originalPosition": 15}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzQ2MDA1OTA4", "url": "https://github.com/quarkusio/quarkus/pull/6681#pullrequestreview-346005908", "createdAt": "2020-01-21T16:17:29Z", "commit": {"oid": "c9a79be6b4d18e0b2ae1eeeac396c5778e690629"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yMVQxNjoxNzozMFrOFgACiA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yMVQxNjoxNzozMFrOFgACiA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2OTA5OTQwMA==", "bodyText": "Using @BeforeAll and @AfterAll static methods should be the standard way of invoking code before and after tests (If not through a junit extension using callbacks). Not sure if it's worth adding another strategy to do the same thing, unless I am missing something, of course", "url": "https://github.com/quarkusio/quarkus/pull/6681#discussion_r369099400", "createdAt": "2020-01-21T16:17:30Z", "author": {"login": "gastaldi"}, "path": "extensions/hibernate-validator/deployment/src/test/java/io/quarkus/hibernate/validator/test/UserCountryNotSetValidatorLocaleTest.java", "diffHunk": "@@ -0,0 +1,56 @@\n+package io.quarkus.hibernate.validator.test;\n+\n+import javax.inject.Inject;\n+import javax.validation.ValidatorFactory;\n+import javax.validation.constraints.Pattern;\n+\n+import org.jboss.shrinkwrap.api.ShrinkWrap;\n+import org.jboss.shrinkwrap.api.asset.StringAsset;\n+import org.jboss.shrinkwrap.api.spec.JavaArchive;\n+import org.junit.jupiter.api.Test;\n+import org.junit.jupiter.api.extension.RegisterExtension;\n+\n+import io.quarkus.test.QuarkusUnitTest;\n+\n+public class UserCountryNotSetValidatorLocaleTest {\n+\n+    @Inject\n+    ValidatorFactory validatorFactory;\n+\n+    @RegisterExtension\n+    static final QuarkusUnitTest test = new QuarkusUnitTest().setArchiveProducer(() -> ShrinkWrap\n+            .create(JavaArchive.class).addClasses(Bean.class)\n+            .addAsResource(new StringAsset(\"foo=bar\"), \"application.properties\"))\n+            .setBeforeAllCustomizer(new Runnable() {\n+                @Override\n+                public void run() {\n+                    userCountry = System.clearProperty(\"user.country\");\n+                    userLanguage = System.clearProperty(\"user.language\");\n+                }\n+            }).setAfterAllCustomizer(new Runnable() {\n+                @Override\n+                public void run() {\n+                    System.setProperty(\"user.country\", userCountry);\n+                    System.setProperty(\"user.language\", userLanguage);\n+                }", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c9a79be6b4d18e0b2ae1eeeac396c5778e690629"}, "originalPosition": 35}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzQ2MDA4MTU5", "url": "https://github.com/quarkusio/quarkus/pull/6681#pullrequestreview-346008159", "createdAt": "2020-01-21T16:20:17Z", "commit": {"oid": "c9a79be6b4d18e0b2ae1eeeac396c5778e690629"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzQ2MDE1NDQ0", "url": "https://github.com/quarkusio/quarkus/pull/6681#pullrequestreview-346015444", "createdAt": "2020-01-21T16:29:09Z", "commit": {"oid": "c9a79be6b4d18e0b2ae1eeeac396c5778e690629"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c92a512b5aa4fe3d885ffe8a4a99f5aa9cf9f35f", "author": {"user": {"login": "geoand", "name": "Georgios Andrianakis"}}, "url": "https://github.com/quarkusio/quarkus/commit/c92a512b5aa4fe3d885ffe8a4a99f5aa9cf9f35f", "committedDate": "2020-01-21T19:13:47Z", "message": "Add beforeAll and afterAll hooks for QuarkusUnitTest"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d8aa18536798829868d180f48e0e5ef889cf2383", "author": {"user": {"login": "geoand", "name": "Georgios Andrianakis"}}, "url": "https://github.com/quarkusio/quarkus/commit/d8aa18536798829868d180f48e0e5ef889cf2383", "committedDate": "2020-01-21T19:13:47Z", "message": "Ensure that a missing user.country system property doesn't break the application\n\nThis can happen in CI:\nhttps://github.com/apache/camel-quarkus/pull/603#issuecomment-576636989\n\nCo-Authored-By: Guillaume Smet <guillaume.smet@gmail.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a79162e32110839f86f584ba0ef898d699f56e6b", "author": {"user": {"login": "geoand", "name": "Georgios Andrianakis"}}, "url": "https://github.com/quarkusio/quarkus/commit/a79162e32110839f86f584ba0ef898d699f56e6b", "committedDate": "2020-01-21T19:13:47Z", "message": "Use en as the default language when all else is empty\n\nCo-Authored-By: Guillaume Smet <guillaume.smet@gmail.com>"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "c9a79be6b4d18e0b2ae1eeeac396c5778e690629", "author": {"user": {"login": "geoand", "name": "Georgios Andrianakis"}}, "url": "https://github.com/quarkusio/quarkus/commit/c9a79be6b4d18e0b2ae1eeeac396c5778e690629", "committedDate": "2020-01-21T16:03:09Z", "message": "Use en as the default language when all else is empty\n\nCo-Authored-By: Guillaume Smet <guillaume.smet@gmail.com>"}, "afterCommit": {"oid": "a79162e32110839f86f584ba0ef898d699f56e6b", "author": {"user": {"login": "geoand", "name": "Georgios Andrianakis"}}, "url": "https://github.com/quarkusio/quarkus/commit/a79162e32110839f86f584ba0ef898d699f56e6b", "committedDate": "2020-01-21T19:13:47Z", "message": "Use en as the default language when all else is empty\n\nCo-Authored-By: Guillaume Smet <guillaume.smet@gmail.com>"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 261, "cost": 1, "resetAt": "2021-11-01T16:37:27Z"}}}