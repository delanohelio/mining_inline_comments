{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0MzcwODQzOTgw", "number": 6990, "reviewThreads": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0wNFQxMzo0Njo0MFrODc-2dQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0wNFQxNTo0MzozNFrODdBqHw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjMxNzE2NDY5OnYy", "diffSide": "RIGHT", "path": "independent-projects/arc/runtime/src/main/java/io/quarkus/arc/impl/Reflections.java", "isResolved": false, "comments": {"totalCount": 7, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0wNFQxMzo0Njo0MFrOFlUhnQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0wNFQxNTo0MjowMFrOFlY4_g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NDY3NzkxNw==", "bodyText": "Could you try with:\n\nremoving the finals here and in the other key class\ncaching the hashCode in the constructor\nnot using Objects.hash(clazz, methodName) as it does one more array allocation\n\nThat's what I did in HV and it was beneficial. If it doesn't make any significant difference, we can keep it your way but as you have a benchmark and we are optimizing things, it's worth a quick check IMHO", "url": "https://github.com/quarkusio/quarkus/pull/6990#discussion_r374677917", "createdAt": "2020-02-04T13:46:40Z", "author": {"login": "gsmet"}, "path": "independent-projects/arc/runtime/src/main/java/io/quarkus/arc/impl/Reflections.java", "diffHunk": "@@ -148,4 +197,74 @@ public static Object invokeMethod(Class<?> clazz, String name, Class<?>[] paramT\n         }\n     }\n \n+    static final class MethodKey {\n+\n+        final Class<?> clazz;\n+        final String methodName;\n+        final Class<?>[] parameterTypes;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "88ca9511cdbb51b20f63f678aea523d35ab9fd4f"}, "originalPosition": 89}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NDY3OTMyNw==", "bodyText": "I can give it a try!", "url": "https://github.com/quarkusio/quarkus/pull/6990#discussion_r374679327", "createdAt": "2020-02-04T13:49:13Z", "author": {"login": "mkouba"}, "path": "independent-projects/arc/runtime/src/main/java/io/quarkus/arc/impl/Reflections.java", "diffHunk": "@@ -148,4 +197,74 @@ public static Object invokeMethod(Class<?> clazz, String name, Class<?>[] paramT\n         }\n     }\n \n+    static final class MethodKey {\n+\n+        final Class<?> clazz;\n+        final String methodName;\n+        final Class<?>[] parameterTypes;", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NDY3NzkxNw=="}, "originalCommit": {"oid": "88ca9511cdbb51b20f63f678aea523d35ab9fd4f"}, "originalPosition": 89}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NDY4MDAzNA==", "bodyText": "Btw, the remark on Objects.hash() is also valid for the Method one.", "url": "https://github.com/quarkusio/quarkus/pull/6990#discussion_r374680034", "createdAt": "2020-02-04T13:50:36Z", "author": {"login": "gsmet"}, "path": "independent-projects/arc/runtime/src/main/java/io/quarkus/arc/impl/Reflections.java", "diffHunk": "@@ -148,4 +197,74 @@ public static Object invokeMethod(Class<?> clazz, String name, Class<?>[] paramT\n         }\n     }\n \n+    static final class MethodKey {\n+\n+        final Class<?> clazz;\n+        final String methodName;\n+        final Class<?>[] parameterTypes;", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NDY3NzkxNw=="}, "originalCommit": {"oid": "88ca9511cdbb51b20f63f678aea523d35ab9fd4f"}, "originalPosition": 89}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NDY4Mzk1OQ==", "bodyText": "After giving it some thoughts, let's keep the finals and just experiment with the rest.\nIt's a bit different than in HV as you don't really publish these maps safely before accessing them in a multi-threaded environments.", "url": "https://github.com/quarkusio/quarkus/pull/6990#discussion_r374683959", "createdAt": "2020-02-04T13:57:39Z", "author": {"login": "gsmet"}, "path": "independent-projects/arc/runtime/src/main/java/io/quarkus/arc/impl/Reflections.java", "diffHunk": "@@ -148,4 +197,74 @@ public static Object invokeMethod(Class<?> clazz, String name, Class<?>[] paramT\n         }\n     }\n \n+    static final class MethodKey {\n+\n+        final Class<?> clazz;\n+        final String methodName;\n+        final Class<?>[] parameterTypes;", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NDY3NzkxNw=="}, "originalCommit": {"oid": "88ca9511cdbb51b20f63f678aea523d35ab9fd4f"}, "originalPosition": 89}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NDc0MTQ0OA==", "bodyText": "So I've tried to cache the hashCodes and the results are:\nBenchmark                         Mode  Cnt         Score         Error  Units\nReflectionsBenchmark.findField   thrpt   25  70640655,243 \u00b1 1919015,675  ops/s\nReflectionsBenchmark.findMethod  thrpt   25  57293358,785 \u00b1 1065670,627  ops/s\n\nNow I'm going to replace the Objects.hash() ...", "url": "https://github.com/quarkusio/quarkus/pull/6990#discussion_r374741448", "createdAt": "2020-02-04T15:29:26Z", "author": {"login": "mkouba"}, "path": "independent-projects/arc/runtime/src/main/java/io/quarkus/arc/impl/Reflections.java", "diffHunk": "@@ -148,4 +197,74 @@ public static Object invokeMethod(Class<?> clazz, String name, Class<?>[] paramT\n         }\n     }\n \n+    static final class MethodKey {\n+\n+        final Class<?> clazz;\n+        final String methodName;\n+        final Class<?>[] parameterTypes;", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NDY3NzkxNw=="}, "originalCommit": {"oid": "88ca9511cdbb51b20f63f678aea523d35ab9fd4f"}, "originalPosition": 89}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NDc0Nzk2Mg==", "bodyText": "Benchmark                         Mode  Cnt          Score         Error  Units\nReflectionsBenchmark.findField   thrpt   25  104686242,346 \u00b1 3802225,528  ops/s\nReflectionsBenchmark.findMethod  thrpt   25   81447915,881 \u00b1  661570,727  ops/s\n\nAwesome, thanks for your tips ;-)", "url": "https://github.com/quarkusio/quarkus/pull/6990#discussion_r374747962", "createdAt": "2020-02-04T15:39:34Z", "author": {"login": "mkouba"}, "path": "independent-projects/arc/runtime/src/main/java/io/quarkus/arc/impl/Reflections.java", "diffHunk": "@@ -148,4 +197,74 @@ public static Object invokeMethod(Class<?> clazz, String name, Class<?>[] paramT\n         }\n     }\n \n+    static final class MethodKey {\n+\n+        final Class<?> clazz;\n+        final String methodName;\n+        final Class<?>[] parameterTypes;", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NDY3NzkxNw=="}, "originalCommit": {"oid": "88ca9511cdbb51b20f63f678aea523d35ab9fd4f"}, "originalPosition": 89}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NDc0OTQzOA==", "bodyText": "Yeah, we have a lot of pressure on the memory in HV as the path is really very optimized CPU-wise so we ended up with all sort of tricks to optimize the map lookups :).\nGlad it could be of use for another project.", "url": "https://github.com/quarkusio/quarkus/pull/6990#discussion_r374749438", "createdAt": "2020-02-04T15:42:00Z", "author": {"login": "gsmet"}, "path": "independent-projects/arc/runtime/src/main/java/io/quarkus/arc/impl/Reflections.java", "diffHunk": "@@ -148,4 +197,74 @@ public static Object invokeMethod(Class<?> clazz, String name, Class<?>[] paramT\n         }\n     }\n \n+    static final class MethodKey {\n+\n+        final Class<?> clazz;\n+        final String methodName;\n+        final Class<?>[] parameterTypes;", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NDY3NzkxNw=="}, "originalCommit": {"oid": "88ca9511cdbb51b20f63f678aea523d35ab9fd4f"}, "originalPosition": 89}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjMxNzYyNDYzOnYy", "diffSide": "RIGHT", "path": "independent-projects/arc/runtime/src/main/java/io/quarkus/arc/impl/Reflections.java", "isResolved": false, "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0wNFQxNTo0MzozNFrOFlY9Lg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0wNFQxNTo1MDoyMFrOFlZOGg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NDc1MDUxMA==", "bodyText": "Maybe move that part to a buildHashCode method? :)", "url": "https://github.com/quarkusio/quarkus/pull/6990#discussion_r374750510", "createdAt": "2020-02-04T15:43:34Z", "author": {"login": "gsmet"}, "path": "independent-projects/arc/runtime/src/main/java/io/quarkus/arc/impl/Reflections.java", "diffHunk": "@@ -148,4 +197,84 @@ public static Object invokeMethod(Class<?> clazz, String name, Class<?>[] paramT\n         }\n     }\n \n+    static final class MethodKey {\n+\n+        final Class<?> clazz;\n+        final String methodName;\n+        final Class<?>[] parameterTypes;\n+        final int hashCode;\n+\n+        public MethodKey(Class<?> clazz, String methodName, Class<?>[] parameterTypes) {\n+            this.clazz = clazz;\n+            this.methodName = methodName;\n+            this.parameterTypes = parameterTypes;\n+            final int prime = 31;\n+            int result = 1;\n+            result = prime * result + Arrays.hashCode(parameterTypes);\n+            result = prime * result + ((clazz == null) ? 0 : clazz.hashCode());\n+            result = prime * result + ((methodName == null) ? 0 : methodName.hashCode());\n+            this.hashCode = result;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "5812f7bb8a4800fcad1ca8f5b4217539fa048cb9"}, "originalPosition": 101}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NDc1MTY0MA==", "bodyText": "I don't think it's necessary to create a separate method for this ;-).", "url": "https://github.com/quarkusio/quarkus/pull/6990#discussion_r374751640", "createdAt": "2020-02-04T15:45:22Z", "author": {"login": "mkouba"}, "path": "independent-projects/arc/runtime/src/main/java/io/quarkus/arc/impl/Reflections.java", "diffHunk": "@@ -148,4 +197,84 @@ public static Object invokeMethod(Class<?> clazz, String name, Class<?>[] paramT\n         }\n     }\n \n+    static final class MethodKey {\n+\n+        final Class<?> clazz;\n+        final String methodName;\n+        final Class<?>[] parameterTypes;\n+        final int hashCode;\n+\n+        public MethodKey(Class<?> clazz, String methodName, Class<?>[] parameterTypes) {\n+            this.clazz = clazz;\n+            this.methodName = methodName;\n+            this.parameterTypes = parameterTypes;\n+            final int prime = 31;\n+            int result = 1;\n+            result = prime * result + Arrays.hashCode(parameterTypes);\n+            result = prime * result + ((clazz == null) ? 0 : clazz.hashCode());\n+            result = prime * result + ((methodName == null) ? 0 : methodName.hashCode());\n+            this.hashCode = result;", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NDc1MDUxMA=="}, "originalCommit": {"oid": "5812f7bb8a4800fcad1ca8f5b4217539fa048cb9"}, "originalPosition": 101}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NDc1NDg0Mg==", "bodyText": "As you prefer. Looks good to me, then!", "url": "https://github.com/quarkusio/quarkus/pull/6990#discussion_r374754842", "createdAt": "2020-02-04T15:50:20Z", "author": {"login": "gsmet"}, "path": "independent-projects/arc/runtime/src/main/java/io/quarkus/arc/impl/Reflections.java", "diffHunk": "@@ -148,4 +197,84 @@ public static Object invokeMethod(Class<?> clazz, String name, Class<?>[] paramT\n         }\n     }\n \n+    static final class MethodKey {\n+\n+        final Class<?> clazz;\n+        final String methodName;\n+        final Class<?>[] parameterTypes;\n+        final int hashCode;\n+\n+        public MethodKey(Class<?> clazz, String methodName, Class<?>[] parameterTypes) {\n+            this.clazz = clazz;\n+            this.methodName = methodName;\n+            this.parameterTypes = parameterTypes;\n+            final int prime = 31;\n+            int result = 1;\n+            result = prime * result + Arrays.hashCode(parameterTypes);\n+            result = prime * result + ((clazz == null) ? 0 : clazz.hashCode());\n+            result = prime * result + ((methodName == null) ? 0 : methodName.hashCode());\n+            this.hashCode = result;", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NDc1MDUxMA=="}, "originalCommit": {"oid": "5812f7bb8a4800fcad1ca8f5b4217539fa048cb9"}, "originalPosition": 101}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1099, "cost": 1, "resetAt": "2021-11-13T12:26:42Z"}}}