{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0MzY1NzIzNDY0", "number": 6714, "title": "Fix bug in KubernetesClientProducer causing wrong config for kubernetes client", "bodyText": "Currently, the KubernetesClientProducer sets the caCertData to the clientCertData field of the kubernetes client config.\nFor reference to others looking for a fix to this bug: this causes connection errors like the following:\n2020-01-22 09:18:29,427 ERROR [io.qua.application] (main) Failed to start application: io.fabric8.kubernetes.client.KubernetesClientException: Operation: [list]  for kind: [Pod]  with name: [null]  in namespace: [null]  failed.\n\tat io.fabric8.kubernetes.client.KubernetesClientException.launderThrowable(KubernetesClientException.java:64)\n\tat io.fabric8.kubernetes.client.KubernetesClientException.launderThrowable(KubernetesClientException.java:72)\n\tat io.fabric8.kubernetes.client.dsl.base.BaseOperation.listRequestHelper(BaseOperation.java:157)\n\tat io.fabric8.kubernetes.client.dsl.base.BaseOperation.list(BaseOperation.java:620)\n\tat io.fabric8.kubernetes.client.dsl.base.BaseOperation.list(BaseOperation.java:69)\n\tat com.arconsis.test.service.KubernetesService.onStart(KubernetesService.java:33)\n\tat com.arconsis.test.service.KubernetesService_Observer_onStart_fd71b5e0b207b7d1ef838b94eaeff75e52b8f463.notify(KubernetesService_Observer_onStart_fd71b5e0b207b7d1ef838b94eaeff75e52b8f463.zig:51)\n\tat io.quarkus.arc.impl.EventImpl$Notifier.notify(EventImpl.java:224)\n\tat io.quarkus.arc.impl.EventImpl.fire(EventImpl.java:65)\n\tat io.quarkus.arc.runtime.LifecycleEventRunner.fireStartupEvent(LifecycleEventRunner.java:23)\n\tat io.quarkus.arc.runtime.ArcRecorder.handleLifecycleEvents(ArcRecorder.java:108)\n\tat io.quarkus.deployment.steps.LifecycleEventsBuildStep$startupEvent25.deploy_0(LifecycleEventsBuildStep$startupEvent25.zig:58)\n\tat io.quarkus.deployment.steps.LifecycleEventsBuildStep$startupEvent25.deploy(LifecycleEventsBuildStep$startupEvent25.zig:77)\n\tat io.quarkus.runner.ApplicationImpl.doStart(ApplicationImpl.zig:213)\n\tat io.quarkus.runtime.Application.start(Application.java:87)\n\tat io.quarkus.runner.RuntimeRunner.run(RuntimeRunner.java:167)\n\tat io.quarkus.dev.DevModeMain.doStart(DevModeMain.java:178)\n\tat io.quarkus.dev.DevModeMain.start(DevModeMain.java:96)\n\tat io.quarkus.dev.DevModeMain.main(DevModeMain.java:67)\nCaused by: javax.net.ssl.SSLHandshakeException: Received fatal alert: bad_certificate\n\tat sun.security.ssl.Alerts.getSSLException(Alerts.java:192)\n\tat sun.security.ssl.Alerts.getSSLException(Alerts.java:154)\n\tat sun.security.ssl.SSLSocketImpl.recvAlert(SSLSocketImpl.java:2020)\n\tat sun.security.ssl.SSLSocketImpl.readRecord(SSLSocketImpl.java:1127)\n\tat sun.security.ssl.SSLSocketImpl.performInitialHandshake(SSLSocketImpl.java:1367)\n\tat sun.security.ssl.SSLSocketImpl.startHandshake(SSLSocketImpl.java:1395)\n\tat sun.security.ssl.SSLSocketImpl.startHandshake(SSLSocketImpl.java:1379)\n\tat okhttp3.internal.connection.RealConnection.connectTls(RealConnection.java:320)\n\tat okhttp3.internal.connection.RealConnection.establishProtocol(RealConnection.java:284)\n\tat okhttp3.internal.connection.RealConnection.connect(RealConnection.java:169)\n\tat okhttp3.internal.connection.StreamAllocation.findConnection(StreamAllocation.java:258)\n\tat okhttp3.internal.connection.StreamAllocation.findHealthyConnection(StreamAllocation.java:135)\n\tat okhttp3.internal.connection.StreamAllocation.newStream(StreamAllocation.java:114)\n\tat okhttp3.internal.connection.ConnectInterceptor.intercept(ConnectInterceptor.java:42)\n\tat okhttp3.internal.http.RealInterceptorChain.proceed(RealInterceptorChain.java:147)\n\tat okhttp3.internal.http.RealInterceptorChain.proceed(RealInterceptorChain.java:121)\n\tat okhttp3.internal.cache.CacheInterceptor.intercept(CacheInterceptor.java:93)\n\tat okhttp3.internal.http.RealInterceptorChain.proceed(RealInterceptorChain.java:147)\n\tat okhttp3.internal.http.RealInterceptorChain.proceed(RealInterceptorChain.java:121)\n\tat okhttp3.internal.http.BridgeInterceptor.intercept(BridgeInterceptor.java:93)\n\tat okhttp3.internal.http.RealInterceptorChain.proceed(RealInterceptorChain.java:147)\n\tat okhttp3.internal.http.RetryAndFollowUpInterceptor.intercept(RetryAndFollowUpInterceptor.java:127)\n\tat okhttp3.internal.http.RealInterceptorChain.proceed(RealInterceptorChain.java:147)\n\tat okhttp3.internal.http.RealInterceptorChain.proceed(RealInterceptorChain.java:121)\n\tat io.fabric8.kubernetes.client.utils.BackwardsCompatibilityInterceptor.intercept(BackwardsCompatibilityInterceptor.java:119)\n\tat okhttp3.internal.http.RealInterceptorChain.proceed(RealInterceptorChain.java:147)\n\tat okhttp3.internal.http.RealInterceptorChain.proceed(RealInterceptorChain.java:121)\n\tat io.fabric8.kubernetes.client.utils.ImpersonatorInterceptor.intercept(ImpersonatorInterceptor.java:68)\n\tat okhttp3.internal.http.RealInterceptorChain.proceed(RealInterceptorChain.java:147)\n\tat okhttp3.internal.http.RealInterceptorChain.proceed(RealInterceptorChain.java:121)\n\tat io.fabric8.kubernetes.client.utils.HttpClientUtils.lambda$createHttpClient$3(HttpClientUtils.java:111)\n\tat okhttp3.internal.http.RealInterceptorChain.proceed(RealInterceptorChain.java:147)\n\tat okhttp3.internal.http.RealInterceptorChain.proceed(RealInterceptorChain.java:121)\n\tat okhttp3.RealCall.getResponseWithInterceptorChain(RealCall.java:257)\n\tat okhttp3.RealCall.execute(RealCall.java:93)\n\tat io.fabric8.kubernetes.client.dsl.base.OperationSupport.handleResponse(OperationSupport.java:411)\n\tat io.fabric8.kubernetes.client.dsl.base.OperationSupport.handleResponse(OperationSupport.java:372)\n\tat io.fabric8.kubernetes.client.dsl.base.OperationSupport.handleResponse(OperationSupport.java:354)\n\tat io.fabric8.kubernetes.client.dsl.base.BaseOperation.listRequestHelper(BaseOperation.java:153)\n\t... 16 more\n\n2020-01-22 09:18:29,453 INFO  [io.sma.rea.mes.ext.MediatorManager] (main) Cancel subscriptions\n2020-01-22 09:18:29,454 FINE  [pro.trace] (vert.x-eventloop-thread-0) IN: CH[0] : Close{error=null}\n2020-01-22 09:18:29,455 DEBUG [io.qua.arc.impl] (main) ArC DI container shut down\n2020-01-22 09:18:29,455 ERROR [io.qua.dev.DevModeMain] (main) Failed to start Quarkus: java.lang.RuntimeException: Failed to start quarkus\n\tat io.quarkus.runner.ApplicationImpl.doStart(ApplicationImpl.zig:243)\n\tat io.quarkus.runtime.Application.start(Application.java:87)\n\tat io.quarkus.runner.RuntimeRunner.run(RuntimeRunner.java:167)\n\tat io.quarkus.dev.DevModeMain.doStart(DevModeMain.java:178)\n\tat io.quarkus.dev.DevModeMain.start(DevModeMain.java:96)\n\tat io.quarkus.dev.DevModeMain.main(DevModeMain.java:67)\nCaused by: io.fabric8.kubernetes.client.KubernetesClientException: Operation: [list]  for kind: [Pod]  with name: [null]  in namespace: [null]  failed.\n\tat io.fabric8.kubernetes.client.KubernetesClientException.launderThrowable(KubernetesClientException.java:64)\n\tat io.fabric8.kubernetes.client.KubernetesClientException.launderThrowable(KubernetesClientException.java:72)\n\tat io.fabric8.kubernetes.client.dsl.base.BaseOperation.listRequestHelper(BaseOperation.java:157)\n\tat io.fabric8.kubernetes.client.dsl.base.BaseOperation.list(BaseOperation.java:620)\n\tat io.fabric8.kubernetes.client.dsl.base.BaseOperation.list(BaseOperation.java:69)\n\tat com.arconsis.test.service.KubernetesService.onStart(KubernetesService.java:33)\n\tat com.arconsis.test.service.KubernetesService_Observer_onStart_fd71b5e0b207b7d1ef838b94eaeff75e52b8f463.notify(KubernetesService_Observer_onStart_fd71b5e0b207b7d1ef838b94eaeff75e52b8f463.zig:51)\n\tat io.quarkus.arc.impl.EventImpl$Notifier.notify(EventImpl.java:224)\n\tat io.quarkus.arc.impl.EventImpl.fire(EventImpl.java:65)\n\tat io.quarkus.arc.runtime.LifecycleEventRunner.fireStartupEvent(LifecycleEventRunner.java:23)\n\tat io.quarkus.arc.runtime.ArcRecorder.handleLifecycleEvents(ArcRecorder.java:108)\n\tat io.quarkus.deployment.steps.LifecycleEventsBuildStep$startupEvent25.deploy_0(LifecycleEventsBuildStep$startupEvent25.zig:58)\n\tat io.quarkus.deployment.steps.LifecycleEventsBuildStep$startupEvent25.deploy(LifecycleEventsBuildStep$startupEvent25.zig:77)\n\tat io.quarkus.runner.ApplicationImpl.doStart(ApplicationImpl.zig:213)\n\t... 5 more\nCaused by: javax.net.ssl.SSLHandshakeException: Received fatal alert: bad_certificate\n\tat sun.security.ssl.Alerts.getSSLException(Alerts.java:192)\n\tat sun.security.ssl.Alerts.getSSLException(Alerts.java:154)\n\tat sun.security.ssl.SSLSocketImpl.recvAlert(SSLSocketImpl.java:2020)\n\tat sun.security.ssl.SSLSocketImpl.readRecord(SSLSocketImpl.java:1127)\n\tat sun.security.ssl.SSLSocketImpl.performInitialHandshake(SSLSocketImpl.java:1367)\n\tat sun.security.ssl.SSLSocketImpl.startHandshake(SSLSocketImpl.java:1395)\n\tat sun.security.ssl.SSLSocketImpl.startHandshake(SSLSocketImpl.java:1379)\n\tat okhttp3.internal.connection.RealConnection.connectTls(RealConnection.java:320)\n\tat okhttp3.internal.connection.RealConnection.establishProtocol(RealConnection.java:284)\n\tat okhttp3.internal.connection.RealConnection.connect(RealConnection.java:169)\n\tat okhttp3.internal.connection.StreamAllocation.findConnection(StreamAllocation.java:258)\n\tat okhttp3.internal.connection.StreamAllocation.findHealthyConnection(StreamAllocation.java:135)\n\tat okhttp3.internal.connection.StreamAllocation.newStream(StreamAllocation.java:114)\n\tat okhttp3.internal.connection.ConnectInterceptor.intercept(ConnectInterceptor.java:42)\n\tat okhttp3.internal.http.RealInterceptorChain.proceed(RealInterceptorChain.java:147)\n\tat okhttp3.internal.http.RealInterceptorChain.proceed(RealInterceptorChain.java:121)\n\tat okhttp3.internal.cache.CacheInterceptor.intercept(CacheInterceptor.java:93)\n\tat okhttp3.internal.http.RealInterceptorChain.proceed(RealInterceptorChain.java:147)\n\tat okhttp3.internal.http.RealInterceptorChain.proceed(RealInterceptorChain.java:121)\n\tat okhttp3.internal.http.BridgeInterceptor.intercept(BridgeInterceptor.java:93)\n\tat okhttp3.internal.http.RealInterceptorChain.proceed(RealInterceptorChain.java:147)\n\tat okhttp3.internal.http.RetryAndFollowUpInterceptor.intercept(RetryAndFollowUpInterceptor.java:127)\n\tat okhttp3.internal.http.RealInterceptorChain.proceed(RealInterceptorChain.java:147)\n\tat okhttp3.internal.http.RealInterceptorChain.proceed(RealInterceptorChain.java:121)\n\tat io.fabric8.kubernetes.client.utils.BackwardsCompatibilityInterceptor.intercept(BackwardsCompatibilityInterceptor.java:119)\n\tat okhttp3.internal.http.RealInterceptorChain.proceed(RealInterceptorChain.java:147)\n\tat okhttp3.internal.http.RealInterceptorChain.proceed(RealInterceptorChain.java:121)\n\tat io.fabric8.kubernetes.client.utils.ImpersonatorInterceptor.intercept(ImpersonatorInterceptor.java:68)\n\tat okhttp3.internal.http.RealInterceptorChain.proceed(RealInterceptorChain.java:147)\n\tat okhttp3.internal.http.RealInterceptorChain.proceed(RealInterceptorChain.java:121)\n\tat io.fabric8.kubernetes.client.utils.HttpClientUtils.lambda$createHttpClient$3(HttpClientUtils.java:111)\n\tat okhttp3.internal.http.RealInterceptorChain.proceed(RealInterceptorChain.java:147)\n\tat okhttp3.internal.http.RealInterceptorChain.proceed(RealInterceptorChain.java:121)\n\tat okhttp3.RealCall.getResponseWithInterceptorChain(RealCall.java:257)\n\tat okhttp3.RealCall.execute(RealCall.java:93)\n\tat io.fabric8.kubernetes.client.dsl.base.OperationSupport.handleResponse(OperationSupport.java:411)\n\tat io.fabric8.kubernetes.client.dsl.base.OperationSupport.handleResponse(OperationSupport.java:372)\n\tat io.fabric8.kubernetes.client.dsl.base.OperationSupport.handleResponse(OperationSupport.java:354)\n\tat io.fabric8.kubernetes.client.dsl.base.BaseOperation.listRequestHelper(BaseOperation.java:153)\n\t... 16 more\n\n2020-01-22 09:18:29,455 INFO  [io.qua.dev.DevModeMain] (main) Attempting to start hot replacement endpoint to recover from previous Quarkus startup failure", "createdAt": "2020-01-22T08:22:12Z", "url": "https://github.com/quarkusio/quarkus/pull/6714", "merged": true, "mergeCommit": {"oid": "dbeb73f5f40c952e44ed73970e6525cf168408e7"}, "closed": true, "closedAt": "2020-01-22T12:12:11Z", "author": {"login": "andreas-eberle"}, "timelineItems": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABb8xqohAFqTM0NjQxNzk3OA==", "endCursor": "Y3Vyc29yOnYyOpPPAAABb80ajTgFqTM0NjUzMjA4OA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzQ2NDE3OTc4", "url": "https://github.com/quarkusio/quarkus/pull/6714#pullrequestreview-346417978", "createdAt": "2020-01-22T08:42:17Z", "commit": {"oid": "f41d7ea09ae180cac7a35c80648b578e13784b6f"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yMlQwODo0MjoxOFrOFgUIIw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yMlQwODo0MjoxOFrOFgUIIw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2OTQyODUxNQ==", "bodyText": "I assume this line needs to be fixed as well?", "url": "https://github.com/quarkusio/quarkus/pull/6714#discussion_r369428515", "createdAt": "2020-01-22T08:42:18Z", "author": {"login": "geoand"}, "path": "extensions/kubernetes-client/runtime/src/main/java/io/quarkus/kubernetes/client/runtime/KubernetesClientProducer.java", "diffHunk": "@@ -34,7 +34,7 @@ public Config config() {\n                 .withCaCertFile(buildConfig.caCertFile.orElse(base.getCaCertFile()))\n                 .withCaCertData(buildConfig.caCertData.orElse(base.getCaCertData()))\n                 .withClientCertFile(buildConfig.clientCertFile.orElse(base.getCaCertFile()))", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f41d7ea09ae180cac7a35c80648b578e13784b6f"}, "originalPosition": 3}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ed34d3af3cdb68b333088615b291028a215a68b0", "author": {"user": {"login": "andreas-eberle", "name": "Andreas Eberle"}}, "url": "https://github.com/quarkusio/quarkus/commit/ed34d3af3cdb68b333088615b291028a215a68b0", "committedDate": "2020-01-22T08:55:26Z", "message": "Fix bug in KubernetesClientProducer causing bad_certificate errors when trying to connect to local cluster with kubernetes-client."}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "51a595f2542551124b58669b398689d0f3ee3b1c", "author": {"user": {"login": "andreas-eberle", "name": "Andreas Eberle"}}, "url": "https://github.com/quarkusio/quarkus/commit/51a595f2542551124b58669b398689d0f3ee3b1c", "committedDate": "2020-01-22T08:47:08Z", "message": "Also fix clientCertFile config"}, "afterCommit": {"oid": "ed34d3af3cdb68b333088615b291028a215a68b0", "author": {"user": {"login": "andreas-eberle", "name": "Andreas Eberle"}}, "url": "https://github.com/quarkusio/quarkus/commit/ed34d3af3cdb68b333088615b291028a215a68b0", "committedDate": "2020-01-22T08:55:26Z", "message": "Fix bug in KubernetesClientProducer causing bad_certificate errors when trying to connect to local cluster with kubernetes-client."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzQ2NTMyMDg4", "url": "https://github.com/quarkusio/quarkus/pull/6714#pullrequestreview-346532088", "createdAt": "2020-01-22T11:54:28Z", "commit": {"oid": "ed34d3af3cdb68b333088615b291028a215a68b0"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 105, "cost": 1, "resetAt": "2021-11-01T16:37:27Z"}}}