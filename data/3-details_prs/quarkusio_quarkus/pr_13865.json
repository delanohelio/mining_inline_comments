{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTM5MTc2MDA0", "number": 13865, "title": "Add test for MTLS+Basic Auth", "bodyText": "", "createdAt": "2020-12-14T06:26:58Z", "url": "https://github.com/quarkusio/quarkus/pull/13865", "merged": true, "mergeCommit": {"oid": "1f74575e409fe8167c8e6f4355f7a1cecac8d4b1"}, "closed": true, "closedAt": "2020-12-15T16:05:53Z", "author": {"login": "stuartwdouglas"}, "timelineItems": {"totalCount": 6, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdl_xCigFqTU1MTA3NDU0NA==", "endCursor": "Y3Vyc29yOnYyOpPPAAABdmPKPRgBqjQxMTE5NjgzNDQ=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTUxMDc0NTQ0", "url": "https://github.com/quarkusio/quarkus/pull/13865#pullrequestreview-551074544", "createdAt": "2020-12-14T06:30:01Z", "commit": {"oid": "aa62b9c2dc91e2a19fd0410642e862990fb6e972"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTUxMjMyNjA3", "url": "https://github.com/quarkusio/quarkus/pull/13865#pullrequestreview-551232607", "createdAt": "2020-12-14T10:26:10Z", "commit": {"oid": "aa62b9c2dc91e2a19fd0410642e862990fb6e972"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTUxMjUxMzQz", "url": "https://github.com/quarkusio/quarkus/pull/13865#pullrequestreview-551251343", "createdAt": "2020-12-14T10:49:56Z", "commit": {"oid": "aa62b9c2dc91e2a19fd0410642e862990fb6e972"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xNFQxMDo0OTo1N1rOIFKriw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xNFQxMDo0OTo1N1rOIFKriw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MjI4ODc3OQ==", "bodyText": "Hi Stuart @stuartwdouglas , this is probably it, should be urlNoTls here", "url": "https://github.com/quarkusio/quarkus/pull/13865#discussion_r542288779", "createdAt": "2020-12-14T10:49:57Z", "author": {"login": "sberyozkin"}, "path": "extensions/vertx-http/deployment/src/test/java/io/quarkus/vertx/http/security/MtlsRequestBasicAuthTest.java", "diffHunk": "@@ -0,0 +1,83 @@\n+package io.quarkus.vertx.http.security;\n+\n+import static org.hamcrest.Matchers.is;\n+\n+import java.io.File;\n+import java.net.URL;\n+\n+import javax.enterprise.context.ApplicationScoped;\n+import javax.enterprise.event.Observes;\n+\n+import org.jboss.shrinkwrap.api.ShrinkWrap;\n+import org.jboss.shrinkwrap.api.spec.JavaArchive;\n+import org.junit.jupiter.api.BeforeAll;\n+import org.junit.jupiter.api.Test;\n+import org.junit.jupiter.api.extension.RegisterExtension;\n+\n+import io.quarkus.security.test.utils.TestIdentityController;\n+import io.quarkus.security.test.utils.TestIdentityProvider;\n+import io.quarkus.test.QuarkusUnitTest;\n+import io.quarkus.test.common.http.TestHTTPResource;\n+import io.quarkus.vertx.http.runtime.security.QuarkusHttpUser;\n+import io.restassured.RestAssured;\n+import io.vertx.ext.web.Router;\n+\n+public class MtlsRequestBasicAuthTest {\n+\n+    @TestHTTPResource(value = \"/mtls\", ssl = true)\n+    URL url;\n+\n+    @TestHTTPResource(value = \"/mtls\", ssl = false)\n+    URL urlNoTls;\n+\n+    @RegisterExtension\n+    static final QuarkusUnitTest config = new QuarkusUnitTest()\n+            .setArchiveProducer(() -> ShrinkWrap.create(JavaArchive.class)\n+                    .addClasses(MyBean.class)\n+                    .addClasses(TestIdentityProvider.class, TestTrustedIdentityProvider.class, TestIdentityController.class)\n+                    .addAsResource(\"conf/mtls/mtls-basic-jks.conf\", \"application.properties\")\n+                    .addAsResource(\"conf/mtls/server-keystore.jks\", \"server-keystore.jks\")\n+                    .addAsResource(\"conf/mtls/server-truststore.jks\", \"server-truststore.jks\"));\n+\n+    @BeforeAll\n+    public static void setup() {\n+        TestIdentityController.resetRoles()\n+                .add(\"admin\", \"admin\", \"admin\");\n+    }\n+\n+    @Test\n+    public void testClientAuthentication() {\n+        RestAssured.given()\n+                .keyStore(new File(\"src/test/resources/conf/mtls/client-keystore.jks\"), \"password\")\n+                .trustStore(new File(\"src/test/resources/conf/mtls/client-truststore.jks\"), \"password\")\n+                .get(url).then().statusCode(200).body(is(\"CN=client,OU=cert,O=quarkus,L=city,ST=state,C=AU\"));\n+    }\n+\n+    @Test\n+    public void testNoClientCert() {\n+        RestAssured.given()\n+                .trustStore(new File(\"src/test/resources/conf/mtls/client-truststore.jks\"), \"password\")\n+                .get(url).then().statusCode(200).body(is(\"\"));\n+    }\n+\n+    @Test\n+    public void testNoClientCertBasicAuth() {\n+        RestAssured.given()\n+                .auth()\n+                .preemptive()\n+                .basic(\"admin\", \"admin\")\n+                .trustStore(new File(\"src/test/resources/conf/mtls/client-truststore.jks\"), \"password\")\n+                .get(url).then().statusCode(200).body(is(\"admin\"));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "aa62b9c2dc91e2a19fd0410642e862990fb6e972"}, "originalPosition": 70}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTUxMjUzNDA4", "url": "https://github.com/quarkusio/quarkus/pull/13865#pullrequestreview-551253408", "createdAt": "2020-12-14T10:52:36Z", "commit": {"oid": "aa62b9c2dc91e2a19fd0410642e862990fb6e972"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xNFQxMDo1MjozNlrOIFKypQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xNFQxMDo1MjozNlrOIFKypQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MjI5MDU5Nw==", "bodyText": "Did you plan to use this property as well ?", "url": "https://github.com/quarkusio/quarkus/pull/13865#discussion_r542290597", "createdAt": "2020-12-14T10:52:36Z", "author": {"login": "sberyozkin"}, "path": "extensions/vertx-http/deployment/src/test/java/io/quarkus/vertx/http/security/MtlsRequestBasicAuthTest.java", "diffHunk": "@@ -0,0 +1,83 @@\n+package io.quarkus.vertx.http.security;\n+\n+import static org.hamcrest.Matchers.is;\n+\n+import java.io.File;\n+import java.net.URL;\n+\n+import javax.enterprise.context.ApplicationScoped;\n+import javax.enterprise.event.Observes;\n+\n+import org.jboss.shrinkwrap.api.ShrinkWrap;\n+import org.jboss.shrinkwrap.api.spec.JavaArchive;\n+import org.junit.jupiter.api.BeforeAll;\n+import org.junit.jupiter.api.Test;\n+import org.junit.jupiter.api.extension.RegisterExtension;\n+\n+import io.quarkus.security.test.utils.TestIdentityController;\n+import io.quarkus.security.test.utils.TestIdentityProvider;\n+import io.quarkus.test.QuarkusUnitTest;\n+import io.quarkus.test.common.http.TestHTTPResource;\n+import io.quarkus.vertx.http.runtime.security.QuarkusHttpUser;\n+import io.restassured.RestAssured;\n+import io.vertx.ext.web.Router;\n+\n+public class MtlsRequestBasicAuthTest {\n+\n+    @TestHTTPResource(value = \"/mtls\", ssl = true)\n+    URL url;\n+\n+    @TestHTTPResource(value = \"/mtls\", ssl = false)\n+    URL urlNoTls;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "aa62b9c2dc91e2a19fd0410642e862990fb6e972"}, "originalPosition": 31}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c5bd959845cb4096abb7239e1cea3f749e68bb52", "author": {"user": {"login": "stuartwdouglas", "name": "Stuart Douglas"}}, "url": "https://github.com/quarkusio/quarkus/commit/c5bd959845cb4096abb7239e1cea3f749e68bb52", "committedDate": "2020-12-15T00:25:53Z", "message": "Add test for MTLS+Basic Auth"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "aa62b9c2dc91e2a19fd0410642e862990fb6e972", "author": {"user": {"login": "stuartwdouglas", "name": "Stuart Douglas"}}, "url": "https://github.com/quarkusio/quarkus/commit/aa62b9c2dc91e2a19fd0410642e862990fb6e972", "committedDate": "2020-12-14T06:26:34Z", "message": "Add test for MTLS+Basic Auth"}, "afterCommit": {"oid": "c5bd959845cb4096abb7239e1cea3f749e68bb52", "author": {"user": {"login": "stuartwdouglas", "name": "Stuart Douglas"}}, "url": "https://github.com/quarkusio/quarkus/commit/c5bd959845cb4096abb7239e1cea3f749e68bb52", "committedDate": "2020-12-15T00:25:53Z", "message": "Add test for MTLS+Basic Auth"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4313, "cost": 1, "resetAt": "2021-11-02T10:47:05Z"}}}