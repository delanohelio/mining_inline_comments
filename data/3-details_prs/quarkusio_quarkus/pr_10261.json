{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDM5OTY3MjIy", "number": 10261, "title": "Provide warning for unsupported rest-client features in native", "bodyText": "This doesn't fix anything, but does at the least warn users building\na native binary that rest-client with @ClientHeaderParam\nand default methods may not work.\nRelates to #10249", "createdAt": "2020-06-25T11:46:58Z", "url": "https://github.com/quarkusio/quarkus/pull/10261", "merged": true, "mergeCommit": {"oid": "dfd7336db6ebb50cf1d8cf73cc8c6263219ecf12"}, "closed": true, "closedAt": "2020-06-25T18:34:35Z", "author": {"login": "geoand"}, "timelineItems": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcutVZjAFqTQzNzQyMDE2Ng==", "endCursor": "Y3Vyc29yOnYyOpPPAAABcuwWcCgBqjM0ODI5MzU5OTU=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDM3NDIwMTY2", "url": "https://github.com/quarkusio/quarkus/pull/10261#pullrequestreview-437420166", "createdAt": "2020-06-25T11:55:42Z", "commit": {"oid": "aba30563bed279008eefd240081e85ec928f17a2"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDM3NTg3Njcw", "url": "https://github.com/quarkusio/quarkus/pull/10261#pullrequestreview-437587670", "createdAt": "2020-06-25T15:04:51Z", "commit": {"oid": "aba30563bed279008eefd240081e85ec928f17a2"}, "state": "DISMISSED", "comments": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yNVQxNTowNDo1MVrOGo_A5w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yNVQxNTowNjowNVrOGo_EgQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NTYyODY0Nw==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                // so lets warn users about it's use\n          \n          \n            \n                // so lets warn users about its use", "url": "https://github.com/quarkusio/quarkus/pull/10261#discussion_r445628647", "createdAt": "2020-06-25T15:04:51Z", "author": {"login": "gsmet"}, "path": "extensions/rest-client/deployment/src/main/java/io/quarkus/restclient/deployment/RestClientProcessor.java", "diffHunk": "@@ -220,6 +227,40 @@ public void register(RegistrationContext registrationContext) {\n         extensionSslNativeSupport.produce(new ExtensionSslNativeSupportBuildItem(Feature.REST_CLIENT));\n     }\n \n+    // currently default methods on a rest-client interface\n+    // that is annotated with ClientHeaderParam\n+    // leads to NPEs (see https://github.com/quarkusio/quarkus/issues/10249)\n+    // so lets warn users about it's use", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "aba30563bed279008eefd240081e85ec928f17a2"}, "originalPosition": 56}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NTYyODg5OA==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                    for (ClassInfo intefaze : interfaces.values()) {\n          \n          \n            \n                    for (ClassInfo interfaze : interfaces.values()) {", "url": "https://github.com/quarkusio/quarkus/pull/10261#discussion_r445628898", "createdAt": "2020-06-25T15:05:11Z", "author": {"login": "gsmet"}, "path": "extensions/rest-client/deployment/src/main/java/io/quarkus/restclient/deployment/RestClientProcessor.java", "diffHunk": "@@ -220,6 +227,40 @@ public void register(RegistrationContext registrationContext) {\n         extensionSslNativeSupport.produce(new ExtensionSslNativeSupportBuildItem(Feature.REST_CLIENT));\n     }\n \n+    // currently default methods on a rest-client interface\n+    // that is annotated with ClientHeaderParam\n+    // leads to NPEs (see https://github.com/quarkusio/quarkus/issues/10249)\n+    // so lets warn users about it's use\n+    private void warnAboutNotWorkingFeaturesInNative(PackageConfig packageConfig, Map<DotName, ClassInfo> interfaces) {\n+        if (!packageConfig.type.equalsIgnoreCase(PackageConfig.NATIVE)) {\n+            return;\n+        }\n+        Set<DotName> dotNames = new HashSet<>();\n+        for (ClassInfo intefaze : interfaces.values()) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "aba30563bed279008eefd240081e85ec928f17a2"}, "originalPosition": 62}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NTYyOTQ2MA==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                                + \"' might not work properly in native-mode. Offending interfaces are: \"\n          \n          \n            \n                                + \"' might not work properly in native mode. Offending interfaces are: \"", "url": "https://github.com/quarkusio/quarkus/pull/10261#discussion_r445629460", "createdAt": "2020-06-25T15:05:55Z", "author": {"login": "gsmet"}, "path": "extensions/rest-client/deployment/src/main/java/io/quarkus/restclient/deployment/RestClientProcessor.java", "diffHunk": "@@ -220,6 +227,40 @@ public void register(RegistrationContext registrationContext) {\n         extensionSslNativeSupport.produce(new ExtensionSslNativeSupportBuildItem(Feature.REST_CLIENT));\n     }\n \n+    // currently default methods on a rest-client interface\n+    // that is annotated with ClientHeaderParam\n+    // leads to NPEs (see https://github.com/quarkusio/quarkus/issues/10249)\n+    // so lets warn users about it's use\n+    private void warnAboutNotWorkingFeaturesInNative(PackageConfig packageConfig, Map<DotName, ClassInfo> interfaces) {\n+        if (!packageConfig.type.equalsIgnoreCase(PackageConfig.NATIVE)) {\n+            return;\n+        }\n+        Set<DotName> dotNames = new HashSet<>();\n+        for (ClassInfo intefaze : interfaces.values()) {\n+            if (intefaze.classAnnotation(CLIENT_HEADER_PARAM) != null) {\n+                boolean hasDefault = false;\n+                for (MethodInfo method : intefaze.methods()) {\n+                    if (isDefault(method.flags())) {\n+                        hasDefault = true;\n+                        break;\n+                    }\n+                }\n+                if (hasDefault) {\n+                    dotNames.add(intefaze.name());\n+                }\n+            }\n+        }\n+        if (!dotNames.isEmpty()) {\n+            log.warnf(\"rest-client interfaces that contain default methods and are annotated with '@\" + CLIENT_HEADER_PARAM\n+                    + \"' might not work properly in native-mode. Offending interfaces are: \"", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "aba30563bed279008eefd240081e85ec928f17a2"}, "originalPosition": 78}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NTYyOTU2OQ==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                                + dotNames.stream().map(d -> \"'\" + d.toString() + \"'\").collect(Collectors.joining(\",\")));\n          \n          \n            \n                                + dotNames.stream().map(d -> \"'\" + d.toString() + \"'\").collect(Collectors.joining(\", \")));", "url": "https://github.com/quarkusio/quarkus/pull/10261#discussion_r445629569", "createdAt": "2020-06-25T15:06:05Z", "author": {"login": "gsmet"}, "path": "extensions/rest-client/deployment/src/main/java/io/quarkus/restclient/deployment/RestClientProcessor.java", "diffHunk": "@@ -220,6 +227,40 @@ public void register(RegistrationContext registrationContext) {\n         extensionSslNativeSupport.produce(new ExtensionSslNativeSupportBuildItem(Feature.REST_CLIENT));\n     }\n \n+    // currently default methods on a rest-client interface\n+    // that is annotated with ClientHeaderParam\n+    // leads to NPEs (see https://github.com/quarkusio/quarkus/issues/10249)\n+    // so lets warn users about it's use\n+    private void warnAboutNotWorkingFeaturesInNative(PackageConfig packageConfig, Map<DotName, ClassInfo> interfaces) {\n+        if (!packageConfig.type.equalsIgnoreCase(PackageConfig.NATIVE)) {\n+            return;\n+        }\n+        Set<DotName> dotNames = new HashSet<>();\n+        for (ClassInfo intefaze : interfaces.values()) {\n+            if (intefaze.classAnnotation(CLIENT_HEADER_PARAM) != null) {\n+                boolean hasDefault = false;\n+                for (MethodInfo method : intefaze.methods()) {\n+                    if (isDefault(method.flags())) {\n+                        hasDefault = true;\n+                        break;\n+                    }\n+                }\n+                if (hasDefault) {\n+                    dotNames.add(intefaze.name());\n+                }\n+            }\n+        }\n+        if (!dotNames.isEmpty()) {\n+            log.warnf(\"rest-client interfaces that contain default methods and are annotated with '@\" + CLIENT_HEADER_PARAM\n+                    + \"' might not work properly in native-mode. Offending interfaces are: \"\n+                    + dotNames.stream().map(d -> \"'\" + d.toString() + \"'\").collect(Collectors.joining(\",\")));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "aba30563bed279008eefd240081e85ec928f17a2"}, "originalPosition": 79}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "1a8c6e1476267c8d50973cebe621b1dba44fac09", "author": {"user": {"login": "geoand", "name": "Georgios Andrianakis"}}, "url": "https://github.com/quarkusio/quarkus/commit/1a8c6e1476267c8d50973cebe621b1dba44fac09", "committedDate": "2020-06-25T15:24:04Z", "message": "Update extensions/rest-client/deployment/src/main/java/io/quarkus/restclient/deployment/RestClientProcessor.java\n\nCo-authored-by: Guillaume Smet <guillaume.smet@gmail.com>"}, "afterCommit": {"oid": "1182c18fe08653d1c4ba3d5bc1d0e0d1cb934f6e", "author": {"user": {"login": "geoand", "name": "Georgios Andrianakis"}}, "url": "https://github.com/quarkusio/quarkus/commit/1182c18fe08653d1c4ba3d5bc1d0e0d1cb934f6e", "committedDate": "2020-06-25T15:25:25Z", "message": "Provide warning for unsupported rest-client features in native\n\nThis doesn't fix anything, but does at the least warn users building\na native binary that rest-client with @ClientHeaderParam\nand default methods may not work.\n\nRelates to #10249\n\nCo-authored-by: Guillaume Smet <guillaume.smet@gmail.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "40ae7414ba808976ef2fe6a26c873b90056d3f37", "author": {"user": {"login": "geoand", "name": "Georgios Andrianakis"}}, "url": "https://github.com/quarkusio/quarkus/commit/40ae7414ba808976ef2fe6a26c873b90056d3f37", "committedDate": "2020-06-25T15:26:26Z", "message": "Provide warning for unsupported rest-client features in native\n\nThis doesn't fix anything, but does at the least warn users building\na native binary that rest-client with @ClientHeaderParam\nand default methods may not work.\n\nRelates to #10249\n\nCo-authored-by: Guillaume Smet <guillaume.smet@gmail.com>"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "1182c18fe08653d1c4ba3d5bc1d0e0d1cb934f6e", "author": {"user": {"login": "geoand", "name": "Georgios Andrianakis"}}, "url": "https://github.com/quarkusio/quarkus/commit/1182c18fe08653d1c4ba3d5bc1d0e0d1cb934f6e", "committedDate": "2020-06-25T15:25:25Z", "message": "Provide warning for unsupported rest-client features in native\n\nThis doesn't fix anything, but does at the least warn users building\na native binary that rest-client with @ClientHeaderParam\nand default methods may not work.\n\nRelates to #10249\n\nCo-authored-by: Guillaume Smet <guillaume.smet@gmail.com>"}, "afterCommit": {"oid": "40ae7414ba808976ef2fe6a26c873b90056d3f37", "author": {"user": {"login": "geoand", "name": "Georgios Andrianakis"}}, "url": "https://github.com/quarkusio/quarkus/commit/40ae7414ba808976ef2fe6a26c873b90056d3f37", "committedDate": "2020-06-25T15:26:26Z", "message": "Provide warning for unsupported rest-client features in native\n\nThis doesn't fix anything, but does at the least warn users building\na native binary that rest-client with @ClientHeaderParam\nand default methods may not work.\n\nRelates to #10249\n\nCo-authored-by: Guillaume Smet <guillaume.smet@gmail.com>"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3712, "cost": 1, "resetAt": "2021-11-01T16:37:27Z"}}}