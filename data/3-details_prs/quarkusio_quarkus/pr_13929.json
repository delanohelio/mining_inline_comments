{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTQxMjcwODQz", "number": 13929, "title": "Disable XML mapping by default and allow Hibernate ORM integrations to re-enable it if necessary", "bodyText": "Based on #13924 , which should be merged first.\ncc @gsmet @Sanne", "createdAt": "2020-12-16T16:03:06Z", "url": "https://github.com/quarkusio/quarkus/pull/13929", "merged": true, "mergeCommit": {"oid": "a562e27009d8955cf6ea2b3d883b5a8baab27866"}, "closed": true, "closedAt": "2020-12-17T19:53:36Z", "author": {"login": "yrodiere"}, "timelineItems": {"totalCount": 11, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdmxUTegFqTU1Mzg0ODc1Mg==", "endCursor": "Y3Vyc29yOnYyOpPPAAABdnGKm_AFqTU1NDc3NTE0OA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTUzODQ4NzUy", "url": "https://github.com/quarkusio/quarkus/pull/13929#pullrequestreview-553848752", "createdAt": "2020-12-16T16:13:53Z", "commit": {"oid": "15f4662b8644f41f26665ef677cd7b26b9cd712c"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "15f4662b8644f41f26665ef677cd7b26b9cd712c", "author": {"user": {"login": "yrodiere", "name": "Yoann Rodi\u00e8re"}}, "url": "https://github.com/quarkusio/quarkus/commit/15f4662b8644f41f26665ef677cd7b26b9cd712c", "committedDate": "2020-12-16T16:02:51Z", "message": "Disable XML mapping by default\n\nOnly enable it if extensions specifically request it.\n\nSigned-off-by: Yoann Rodi\u00e8re <yoann@hibernate.org>"}, "afterCommit": {"oid": "1b2a0db368fe766f45958bf6d99ed73ac640249c", "author": {"user": {"login": "yrodiere", "name": "Yoann Rodi\u00e8re"}}, "url": "https://github.com/quarkusio/quarkus/commit/1b2a0db368fe766f45958bf6d99ed73ac640249c", "committedDate": "2020-12-17T09:10:35Z", "message": "Disable XML mapping by default\n\nOnly enable it if extensions specifically request it.\n\nSigned-off-by: Yoann Rodi\u00e8re <yoann@hibernate.org>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a30209ff0cf1e0c3db7e64e27ba5918eb00d3ac1", "author": {"user": {"login": "yrodiere", "name": "Yoann Rodi\u00e8re"}}, "url": "https://github.com/quarkusio/quarkus/commit/a30209ff0cf1e0c3db7e64e27ba5918eb00d3ac1", "committedDate": "2020-12-17T12:49:24Z", "message": "Enable XML mapping by default (temporarily)\n\nThis is needed not just for envers, but also for external extensions, in\nparticular debezium-quarkus-outbox.\n\nSigned-off-by: Yoann Rodi\u00e8re <yoann@hibernate.org>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "95d3897d05e2eeb5d7a9a53f64d1b6be5337c0db", "author": {"user": {"login": "yrodiere", "name": "Yoann Rodi\u00e8re"}}, "url": "https://github.com/quarkusio/quarkus/commit/95d3897d05e2eeb5d7a9a53f64d1b6be5337c0db", "committedDate": "2020-12-17T12:49:24Z", "message": "Introduce descriptors for Hibernate ORM integrations\n\nFor now these descriptors only contain an optional init listener, but\nwe're going to add more.\n\nSigned-off-by: Yoann Rodi\u00e8re <yoann@hibernate.org>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "4c6d7918b8af4a68863b86314a02a83cdbf55a83", "author": {"user": {"login": "yrodiere", "name": "Yoann Rodi\u00e8re"}}, "url": "https://github.com/quarkusio/quarkus/commit/4c6d7918b8af4a68863b86314a02a83cdbf55a83", "committedDate": "2020-12-17T12:49:25Z", "message": "Allow Hibernate ORM integrations to declare their reliance on XML mapping\n\nSigned-off-by: Yoann Rodi\u00e8re <yoann@hibernate.org>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "8a4d6e065071be1e48fb1a98735c95a37cd4a846", "author": {"user": {"login": "yrodiere", "name": "Yoann Rodi\u00e8re"}}, "url": "https://github.com/quarkusio/quarkus/commit/8a4d6e065071be1e48fb1a98735c95a37cd4a846", "committedDate": "2020-12-17T12:49:25Z", "message": "Disable XML mapping by default\n\nOnly enable it if extensions specifically request it.\n\nSigned-off-by: Yoann Rodi\u00e8re <yoann@hibernate.org>"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "1b2a0db368fe766f45958bf6d99ed73ac640249c", "author": {"user": {"login": "yrodiere", "name": "Yoann Rodi\u00e8re"}}, "url": "https://github.com/quarkusio/quarkus/commit/1b2a0db368fe766f45958bf6d99ed73ac640249c", "committedDate": "2020-12-17T09:10:35Z", "message": "Disable XML mapping by default\n\nOnly enable it if extensions specifically request it.\n\nSigned-off-by: Yoann Rodi\u00e8re <yoann@hibernate.org>"}, "afterCommit": {"oid": "8a4d6e065071be1e48fb1a98735c95a37cd4a846", "author": {"user": {"login": "yrodiere", "name": "Yoann Rodi\u00e8re"}}, "url": "https://github.com/quarkusio/quarkus/commit/8a4d6e065071be1e48fb1a98735c95a37cd4a846", "committedDate": "2020-12-17T12:49:25Z", "message": "Disable XML mapping by default\n\nOnly enable it if extensions specifically request it.\n\nSigned-off-by: Yoann Rodi\u00e8re <yoann@hibernate.org>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTU0NzA5ODg4", "url": "https://github.com/quarkusio/quarkus/pull/13929#pullrequestreview-554709888", "createdAt": "2020-12-17T15:24:32Z", "commit": {"oid": "8a4d6e065071be1e48fb1a98735c95a37cd4a846"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xN1QxNToyNDozMlrOIH621A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xN1QxNToyNToyNVrOIH65qg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NTE3NTI1Mg==", "bodyText": "We try to avoid lambdas at runtime.", "url": "https://github.com/quarkusio/quarkus/pull/13929#discussion_r545175252", "createdAt": "2020-12-17T15:24:32Z", "author": {"login": "gsmet"}, "path": "extensions/hibernate-orm/runtime/src/main/java/io/quarkus/hibernate/orm/runtime/FastBootHibernatePersistenceProvider.java", "diffHunk": "@@ -176,12 +176,9 @@ private EntityManagerFactoryBuilder getEntityManagerFactoryBuilderOrNull(String\n                 injectRuntimeConfiguration(persistenceUnitName, hibernateOrmRuntimeConfig, runtimeSettingsBuilder);\n             }\n \n-            for (HibernateOrmIntegrationRuntimeInitListener listener : integrationRuntimeInitListeners\n+            for (HibernateOrmIntegrationRuntimeDescriptor descriptor : integrationRuntimeDescriptors\n                     .getOrDefault(persistenceUnitName, Collections.emptyList())) {\n-                if (listener == null) {\n-                    continue;\n-                }\n-                listener.contributeRuntimeProperties(runtimeSettingsBuilder::put);\n+                descriptor.getInitListener().ifPresent(l -> l.contributeRuntimeProperties(runtimeSettingsBuilder::put));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "8a4d6e065071be1e48fb1a98735c95a37cd4a846"}, "originalPosition": 36}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NTE3NTk3OA==", "bodyText": "Same here.", "url": "https://github.com/quarkusio/quarkus/pull/13929#discussion_r545175978", "createdAt": "2020-12-17T15:25:25Z", "author": {"login": "gsmet"}, "path": "extensions/hibernate-orm/runtime/src/main/java/io/quarkus/hibernate/orm/runtime/boot/FastBootMetadataBuilder.java", "diffHunk": "@@ -319,12 +320,10 @@ public RecordedState build() {\n \n         IntegrationSettings.Builder integrationSettingsBuilder = new IntegrationSettings.Builder();\n \n-        for (HibernateOrmIntegrationStaticInitListener listener : integrationStaticInitListeners) {\n-            if (listener == null) {\n-                continue;\n-            }\n-            listener.onMetadataInitialized(fullMeta, metamodelBuilder.getBootstrapContext(),\n-                    integrationSettingsBuilder::put);\n+        for (HibernateOrmIntegrationStaticDescriptor descriptor : integrationStaticDescriptors) {\n+            descriptor.getInitListener()\n+                    .ifPresent(listener -> listener.onMetadataInitialized(fullMeta, metamodelBuilder.getBootstrapContext(),", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "8a4d6e065071be1e48fb1a98735c95a37cd4a846"}, "originalPosition": 84}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c840579ee5927051da70dbbcf988a02f260a2b7b", "author": {"user": {"login": "yrodiere", "name": "Yoann Rodi\u00e8re"}}, "url": "https://github.com/quarkusio/quarkus/commit/c840579ee5927051da70dbbcf988a02f260a2b7b", "committedDate": "2020-12-17T15:48:45Z", "message": "Avoid lambdas\n\nSigned-off-by: Yoann Rodi\u00e8re <yoann@hibernate.org>"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "2c5912b0b12ea90dc581114cf6101b73bc55e80a", "author": {"user": {"login": "yrodiere", "name": "Yoann Rodi\u00e8re"}}, "url": "https://github.com/quarkusio/quarkus/commit/2c5912b0b12ea90dc581114cf6101b73bc55e80a", "committedDate": "2020-12-17T15:37:07Z", "message": "Avoid lambdas\n\nSigned-off-by: Yoann Rodi\u00e8re <yoann@hibernate.org>"}, "afterCommit": {"oid": "c840579ee5927051da70dbbcf988a02f260a2b7b", "author": {"user": {"login": "yrodiere", "name": "Yoann Rodi\u00e8re"}}, "url": "https://github.com/quarkusio/quarkus/commit/c840579ee5927051da70dbbcf988a02f260a2b7b", "committedDate": "2020-12-17T15:48:45Z", "message": "Avoid lambdas\n\nSigned-off-by: Yoann Rodi\u00e8re <yoann@hibernate.org>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTU0Nzc1MTQ4", "url": "https://github.com/quarkusio/quarkus/pull/13929#pullrequestreview-554775148", "createdAt": "2020-12-17T16:31:18Z", "commit": {"oid": "c840579ee5927051da70dbbcf988a02f260a2b7b"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4207, "cost": 1, "resetAt": "2021-11-02T10:47:05Z"}}}