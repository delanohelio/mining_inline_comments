{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDM1Mzk2MDUx", "number": 10060, "title": "Make Hibernate Reactive work w/o Narayana and Agroal", "bodyText": "The Narayana and Agroal extensions are hardcoded dependencies of the Hibernate ORM extension,\nwhich is a dependency of Hibernate Reactive.\nAnd yet when using Hibernate Reactive these are unnecessary; this PR makes it possible to run Hibernate Reactive without actually having Narayana and Agroal running as well, and excludes the dependency from the Hibernate Reactive classpath.\nThe substitution is necessary as otherwise the module suffers from a broken classpath: it might be cleaner to fully separate such code in a dedicated module, but it's not a great time for large refactorings as there's several works in progress that affect this module.", "createdAt": "2020-06-16T18:29:22Z", "url": "https://github.com/quarkusio/quarkus/pull/10060", "merged": true, "mergeCommit": {"oid": "5c518a17ff55bed735c3712a891f33e6f46a25f3"}, "closed": true, "closedAt": "2020-06-22T11:51:19Z", "author": {"login": "Sanne"}, "timelineItems": {"totalCount": 8, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcr4gEMAH2gAyNDM1Mzk2MDUxOmUyNGNiNDJlN2QyZWEwZTZlOGNlNWMxMDBmZTBiMWEwMGRkYWIzNGQ=", "endCursor": "Y3Vyc29yOnYyOpPPAAABctvidVgFqTQzNDg1MTI2NQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "e24cb42e7d2ea0e6e8ce5c100fe0b1a00ddab34d", "author": {"user": {"login": "Sanne", "name": "Sanne Grinovero"}}, "url": "https://github.com/quarkusio/quarkus/commit/e24cb42e7d2ea0e6e8ce5c100fe0b1a00ddab34d", "committedDate": "2020-06-16T17:14:32Z", "message": "Exclude Agroal and Narayana from Hibernate Reactive dependencies"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "96ed095b7e2bf098c648542e7cdfe0cd3485997b", "author": {"user": {"login": "Sanne", "name": "Sanne Grinovero"}}, "url": "https://github.com/quarkusio/quarkus/commit/96ed095b7e2bf098c648542e7cdfe0cd3485997b", "committedDate": "2020-06-16T17:27:37Z", "message": "No longer need to disable the jdbc extension in integration tests"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "22b57e5ff4c0d424ecf124b1a7c94ab0f4ed8b84", "author": {"user": {"login": "Sanne", "name": "Sanne Grinovero"}}, "url": "https://github.com/quarkusio/quarkus/commit/22b57e5ff4c0d424ecf124b1a7c94ab0f4ed8b84", "committedDate": "2020-06-16T17:27:37Z", "message": "Avoid the TransactionEntityManagers bean to introduce a hard need on the Narayana deployment module"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "8ad5448add13f9e93a690ca763f05cf7181a3d50", "author": {"user": {"login": "Sanne", "name": "Sanne Grinovero"}}, "url": "https://github.com/quarkusio/quarkus/commit/8ad5448add13f9e93a690ca763f05cf7181a3d50", "committedDate": "2020-06-16T17:27:37Z", "message": "Make the JTA integration depend on the presence of the JTA capability"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "8ef31272d351128ebd963d0a64e774b175d28318", "author": {"user": {"login": "Sanne", "name": "Sanne Grinovero"}}, "url": "https://github.com/quarkusio/quarkus/commit/8ef31272d351128ebd963d0a64e774b175d28318", "committedDate": "2020-06-16T17:36:27Z", "message": "Help the native-image compiler with an explicit substitution"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDM0ODI0ODk1", "url": "https://github.com/quarkusio/quarkus/pull/10060#pullrequestreview-434824895", "createdAt": "2020-06-22T11:12:25Z", "commit": {"oid": "8ef31272d351128ebd963d0a64e774b175d28318"}, "state": "COMMENTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yMlQxMToxMjoyNlrOGm8NBA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yMlQxMToyODoxN1rOGm8pgw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MzQ4NTQ0NA==", "bodyText": "Doesn't this dependency cause the TRANSACTIONS capability to be available at build time, and therefore  QuarkusJtaPlatform used? Does this need to be excluded from the deps?", "url": "https://github.com/quarkusio/quarkus/pull/10060#discussion_r443485444", "createdAt": "2020-06-22T11:12:26Z", "author": {"login": "johnaohara"}, "path": "extensions/hibernate-reactive/deployment/pom.xml", "diffHunk": "@@ -20,6 +20,28 @@\n         <dependency>\n             <groupId>io.quarkus</groupId>\n             <artifactId>quarkus-hibernate-orm-deployment</artifactId>\n+            <exclusions>\n+                <exclusion>\n+                    <groupId>io.quarkus</groupId>\n+                    <artifactId>quarkus-narayana-jta-deployment</artifactId>\n+                </exclusion>\n+                <exclusion>\n+                    <groupId>io.quarkus</groupId>\n+                    <artifactId>quarkus-narayana-jta</artifactId>\n+                </exclusion>\n+                <exclusion>", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "8ef31272d351128ebd963d0a64e774b175d28318"}, "originalPosition": 13}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MzQ5MjczOQ==", "bodyText": "Could QuarkusJtaPlatformInitiator be resolved from the service registry?", "url": "https://github.com/quarkusio/quarkus/pull/10060#discussion_r443492739", "createdAt": "2020-06-22T11:28:17Z", "author": {"login": "johnaohara"}, "path": "extensions/hibernate-orm/runtime/src/main/java/io/quarkus/hibernate/orm/runtime/boot/FastBootMetadataBuilder.java", "diffHunk": "@@ -379,7 +383,8 @@ private PrevalidatedQuarkusMetadata trimBootstrapMetadata(MetadataImpl fullMeta)\n     }\n \n     private JtaPlatform extractJtaPlatform() {\n-        return QuarkusJtaPlatform.INSTANCE;\n+        final QuarkusJtaPlatformInitiator quarkusJtaPlatformInitiator = new QuarkusJtaPlatformInitiator(jtaPresent);\n+        return quarkusJtaPlatformInitiator.buildJtaPlatformInstance();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "8ef31272d351128ebd963d0a64e774b175d28318"}, "originalPosition": 52}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDM0ODQ4MTI4", "url": "https://github.com/quarkusio/quarkus/pull/10060#pullrequestreview-434848128", "createdAt": "2020-06-22T11:49:58Z", "commit": {"oid": "8ef31272d351128ebd963d0a64e774b175d28318"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDM0ODUxMjY1", "url": "https://github.com/quarkusio/quarkus/pull/10060#pullrequestreview-434851265", "createdAt": "2020-06-22T11:54:49Z", "commit": {"oid": "8ef31272d351128ebd963d0a64e774b175d28318"}, "state": "APPROVED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yMlQxMTo1NDo0OVrOGm9aVg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yMlQxMTo1NDo0OVrOGm9aVg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MzUwNTIzOA==", "bodyText": "Don't you run the risk of those beans being removed by ArC's optimisation, or are they already unremovable if Agroal is present?", "url": "https://github.com/quarkusio/quarkus/pull/10060#discussion_r443505238", "createdAt": "2020-06-22T11:54:49Z", "author": {"login": "FroMage"}, "path": "extensions/hibernate-orm/runtime/src/main/java/io/quarkus/hibernate/orm/runtime/TransactionEntityManagers.java", "diffHunk": "@@ -39,8 +34,18 @@ public EntityManager getEntityManager(String unitName) {\n             return entityManager;\n         }\n         return managers.computeIfAbsent(unitName, (un) -> new TransactionScopedEntityManager(\n-                transactionManager, transactionSynchronizationRegistry, jpaConfig.getEntityManagerFactory(un), un,\n+                getTransactionManager(), getTransactionSynchronizationRegistry(), jpaConfig.getEntityManagerFactory(un), un,\n                 requestScopedEntityManagers));\n     }\n \n+    private TransactionManager getTransactionManager() {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "8ef31272d351128ebd963d0a64e774b175d28318"}, "originalPosition": 28}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4239, "cost": 1, "resetAt": "2021-11-01T16:37:27Z"}}}