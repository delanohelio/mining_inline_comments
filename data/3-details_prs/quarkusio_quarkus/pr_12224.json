{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDkwMTI2MDI4", "number": 12224, "title": "Solves quarkus kakfa-streams extension devmode issue", "bodyText": "Fixes #12223", "createdAt": "2020-09-21T08:19:04Z", "url": "https://github.com/quarkusio/quarkus/pull/12224", "merged": true, "mergeCommit": {"oid": "9d3ebaf418a7d9f378f60b1032944f3f4b095ec2"}, "closed": true, "closedAt": "2020-09-30T14:53:21Z", "author": {"login": "vietk"}, "timelineItems": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdLCirAgFqTQ5MjU0NDE2NQ==", "endCursor": "Y3Vyc29yOnYyOpPPAAABdN-Az3gFqTQ5OTUxOTE2OA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDkyNTQ0MTY1", "url": "https://github.com/quarkusio/quarkus/pull/12224#pullrequestreview-492544165", "createdAt": "2020-09-21T12:27:06Z", "commit": {"oid": "d08186f6e93a240f0a72b37f11b299651834a066"}, "state": "COMMENTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yMVQxMjoyNzowNlrOHVNeXQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yMVQxMjoyNzo1NFrOHVNgIw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MjAwMjkwOQ==", "bodyText": "Instead of having to reason about the two booleans, how about establishing an enum which exposes all the potential states the producer can be in, e.g. enum State { RUNNING, RUNNING_NON_STOPPABLE, STOPPED}?", "url": "https://github.com/quarkusio/quarkus/pull/12224#discussion_r492002909", "createdAt": "2020-09-21T12:27:06Z", "author": {"login": "gunnarmorling"}, "path": "extensions/kafka-streams/runtime/src/main/java/io/quarkus/kafka/streams/runtime/KafkaStreamsProducer.java", "diffHunk": "@@ -54,6 +54,8 @@\n     private static final Logger LOGGER = Logger.getLogger(KafkaStreamsProducer.class.getName());\n     private static volatile boolean shutdown = false;\n \n+    public static volatile boolean ignoreShutdownFlag = false;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d08186f6e93a240f0a72b37f11b299651834a066"}, "originalPosition": 4}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MjAwMzM2Mw==", "bodyText": "Won't this cause things to not shut down properly? If a shutdown request comes in while this flag is set, this request will be ignored, but it seems we'd never do the shutdown later on then?", "url": "https://github.com/quarkusio/quarkus/pull/12224#discussion_r492003363", "createdAt": "2020-09-21T12:27:54Z", "author": {"login": "gunnarmorling"}, "path": "extensions/kafka-streams/runtime/src/main/java/io/quarkus/kafka/streams/runtime/devmode/KafkaStreamsHotReplacementSetup.java", "diffHunk": "@@ -32,11 +33,14 @@ public void run() {\n                             @Override\n                             public void run() {\n                                 try {\n+                                    KafkaStreamsProducer.ignoreShutdownFlag = true;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d08186f6e93a240f0a72b37f11b299651834a066"}, "originalPosition": 12}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDkyNTQ3NjU4", "url": "https://github.com/quarkusio/quarkus/pull/12224#pullrequestreview-492547658", "createdAt": "2020-09-21T12:29:52Z", "commit": {"oid": "d08186f6e93a240f0a72b37f11b299651834a066"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yMVQxMjoyOTo1MlrOHVNmvg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yMVQxMjoyOTo1MlrOHVNmvg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MjAwNTA1NA==", "bodyText": "It may be simpler to set shutdown to false in KafkaStreamsProducer constructor ?\nIf injection is being re-triggered, I suppose it means a restart is happening in same classloader.", "url": "https://github.com/quarkusio/quarkus/pull/12224#discussion_r492005054", "createdAt": "2020-09-21T12:29:52Z", "author": {"login": "rquinio"}, "path": "extensions/kafka-streams/runtime/src/main/java/io/quarkus/kafka/streams/runtime/KafkaStreamsProducer.java", "diffHunk": "@@ -103,7 +105,9 @@ public KafkaStreamsTopologyManager kafkaStreamsTopologyManager() {\n     }\n \n     void onStop(@Observes ShutdownEvent event) {\n-        shutdown = true;\n+        if (!ignoreShutdownFlag) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d08186f6e93a240f0a72b37f11b299651834a066"}, "originalPosition": 14}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "12c66131b67525c5f563a5eb1d027519aff16031", "author": {"user": {"login": "vietk", "name": null}}, "url": "https://github.com/quarkusio/quarkus/commit/12c66131b67525c5f563a5eb1d027519aff16031", "committedDate": "2020-09-21T15:01:00Z", "message": "Solves quarkus kakfa-streams extension devmode issue"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "d08186f6e93a240f0a72b37f11b299651834a066", "author": {"user": {"login": "vietk", "name": null}}, "url": "https://github.com/quarkusio/quarkus/commit/d08186f6e93a240f0a72b37f11b299651834a066", "committedDate": "2020-09-21T08:03:10Z", "message": "Solves quarkus kakfa-streams extension devmode issue"}, "afterCommit": {"oid": "12c66131b67525c5f563a5eb1d027519aff16031", "author": {"user": {"login": "vietk", "name": null}}, "url": "https://github.com/quarkusio/quarkus/commit/12c66131b67525c5f563a5eb1d027519aff16031", "committedDate": "2020-09-21T15:01:00Z", "message": "Solves quarkus kakfa-streams extension devmode issue"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDk5NTE5MTY4", "url": "https://github.com/quarkusio/quarkus/pull/12224#pullrequestreview-499519168", "createdAt": "2020-09-30T14:53:15Z", "commit": {"oid": "12c66131b67525c5f563a5eb1d027519aff16031"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 386, "cost": 1, "resetAt": "2021-11-01T16:37:27Z"}}}