{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0MzczMDUyMDUy", "number": 7115, "title": "Support Hibernate ORM's generation of Enhanced Proxies", "bodyText": "The high level ideas is very simple: the proxy class definitions need to be generated before we reach \"runtime\". Instances of such class can be instantiated later.\nThe details of boot in ORM made this quite complex though; this needed first to revisit how tuplizers are initialized, and make the BytecodeEnhancers a stateful service which could be injected and hold some sessionfactory specific state; the complexity mainly was that Bytecode enhancers were being used as a global static helper across the codebase.\nAlso, needs to actually make sure we can extrapolate from the metadata all proxy class definitions which will be needed at runtime; there's a fallback implementation in place which should mimick the same fallback patterns as ORM \"vanilla\": it's not always possible to use the Enhanced Proxy feature, but we can degrade gracefully to have the same semantics as not having this turned on on specific entities.\nFixes #6063\nSee also:\n\nhttps://hibernate.atlassian.net/browse/HHH-13804\nhttps://hibernate.atlassian.net/browse/HHH-13849\nhttps://hibernate.atlassian.net/browse/HHH-13851\nhttps://hibernate.atlassian.net/browse/HHH-13850", "createdAt": "2020-02-10T10:22:36Z", "url": "https://github.com/quarkusio/quarkus/pull/7115", "merged": true, "mergeCommit": {"oid": "a9aa5b21caf9ab9b2e0816883893011eeacb9108"}, "closed": true, "closedAt": "2020-02-13T16:27:03Z", "author": {"login": "Sanne"}, "timelineItems": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcC-lb0AH2gAyMzczMDUyMDUyOmEwYzEzYTFiZWIxZmQzZjI1NDAzOGNjNmU5OTU0YzYwMTdmZWU0OGM=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcD8yHfAFqTM1ODMxNjc2OA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "a0c13a1beb1fd3f254038cc6e9954c6017fee48c", "author": {"user": {"login": "Sanne", "name": "Sanne Grinovero"}}, "url": "https://github.com/quarkusio/quarkus/commit/a0c13a1beb1fd3f254038cc6e9954c6017fee48c", "committedDate": "2020-02-10T15:08:56Z", "message": "Introduce an integration test triggering the need for enhanced proxies"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f45e6f1287fc9406658cc26bc3c92f4484f37ef6", "author": {"user": {"login": "Sanne", "name": "Sanne Grinovero"}}, "url": "https://github.com/quarkusio/quarkus/commit/f45e6f1287fc9406658cc26bc3c92f4484f37ef6", "committedDate": "2020-02-10T15:08:56Z", "message": "Build Enhanced Proxy class instances during augmentation, then inject them in custom ProxyFactoryFactory implementation\n\nThis will allow to use the new feature \"Enhanced Proxy\" from Hibernate ORM upstream without needing runtime enhancers."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "af8b5b23b75b41d47000a2e64f0cd66dbc18499d", "author": {"user": {"login": "Sanne", "name": "Sanne Grinovero"}}, "url": "https://github.com/quarkusio/quarkus/commit/af8b5b23b75b41d47000a2e64f0cd66dbc18499d", "committedDate": "2020-02-10T15:08:56Z", "message": "Make it an explicit requirement to have default constructors of entities"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "ed536e3b8fb7a5f860f0491e13cb324876843dd9", "author": {"user": {"login": "Sanne", "name": "Sanne Grinovero"}}, "url": "https://github.com/quarkusio/quarkus/commit/ed536e3b8fb7a5f860f0491e13cb324876843dd9", "committedDate": "2020-02-10T09:29:54Z", "message": "Make it an explicit requirement to have default constructors of entities"}, "afterCommit": {"oid": "af8b5b23b75b41d47000a2e64f0cd66dbc18499d", "author": {"user": {"login": "Sanne", "name": "Sanne Grinovero"}}, "url": "https://github.com/quarkusio/quarkus/commit/af8b5b23b75b41d47000a2e64f0cd66dbc18499d", "committedDate": "2020-02-10T15:08:56Z", "message": "Make it an explicit requirement to have default constructors of entities"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzU4MzE2NzY4", "url": "https://github.com/quarkusio/quarkus/pull/7115#pullrequestreview-358316768", "createdAt": "2020-02-13T15:36:06Z", "commit": {"oid": "af8b5b23b75b41d47000a2e64f0cd66dbc18499d"}, "state": "APPROVED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xM1QxNTozNjowNlrOFpYh7A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xM1QxNTozNjowNlrOFpYh7A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3ODkzNzgzNg==", "bodyText": "Does that one throw the exception? It needs proxying?", "url": "https://github.com/quarkusio/quarkus/pull/7115#discussion_r378937836", "createdAt": "2020-02-13T15:36:06Z", "author": {"login": "gsmet"}, "path": "extensions/hibernate-orm/deployment/src/test/java/io/quarkus/hibernate/orm/HibernateMetricsTestCase.java", "diffHunk": "@@ -64,7 +60,8 @@ public void testMetrics() {\n         assertEquals(0L, getCounterValueOrNull(\"hibernate-orm.entities.inserted\"));\n         Arc.container().requestContext().activate();\n         try {\n-            DummyEntity entity = new DummyEntity(12345L);\n+            DummyEntity entity = new DummyEntity();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "af8b5b23b75b41d47000a2e64f0cd66dbc18499d"}, "originalPosition": 16}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4890, "cost": 1, "resetAt": "2021-11-02T10:47:05Z"}}}