{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDEwMDkzNTk2", "number": 8911, "reviewThreads": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yOFQxMzo0NDowMVrOD3M6og==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yOFQxMzo0NDowMVrOD3M6og==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjU5MjA5ODkwOnYy", "diffSide": "RIGHT", "path": "extensions/jsonb/runtime/src/main/java/io/quarkus/jsonb/JsonbProducer.java", "isResolved": false, "comments": {"totalCount": 9, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yOFQxMzo0NDowMVrOGNUuyA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yOFQxNDozMDoxMFrOGNW91g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNjYyNDMyOA==", "bodyText": "JsonbConfig is not thread safe. So I don't think it's a good idea to share the instance. Do we really need to expose it as a bean?", "url": "https://github.com/quarkusio/quarkus/pull/8911#discussion_r416624328", "createdAt": "2020-04-28T13:44:01Z", "author": {"login": "mkouba"}, "path": "extensions/jsonb/runtime/src/main/java/io/quarkus/jsonb/JsonbProducer.java", "diffHunk": "@@ -13,6 +13,7 @@\n public class JsonbProducer {\n \n     @Produces\n+    @Singleton\n     @DefaultBean\n     public JsonbConfig jsonbConfig(Instance<JsonbConfigCustomizer> customizers) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "14ac3da4c86e55893c04f4d3c5fda3791d98b831"}, "originalPosition": 6}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNjYyNDU4MA==", "bodyText": "@geoand @loicmathieu ^ ?", "url": "https://github.com/quarkusio/quarkus/pull/8911#discussion_r416624580", "createdAt": "2020-04-28T13:44:21Z", "author": {"login": "mkouba"}, "path": "extensions/jsonb/runtime/src/main/java/io/quarkus/jsonb/JsonbProducer.java", "diffHunk": "@@ -13,6 +13,7 @@\n public class JsonbProducer {\n \n     @Produces\n+    @Singleton\n     @DefaultBean\n     public JsonbConfig jsonbConfig(Instance<JsonbConfigCustomizer> customizers) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNjYyNDMyOA=="}, "originalCommit": {"oid": "14ac3da4c86e55893c04f4d3c5fda3791d98b831"}, "originalPosition": 6}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNjYyNzEyMg==", "bodyText": "@mkouba ah, great catch!\nBy making it a bean users are able to supply there own configuration by means of a CDI producer, which you of course know is super helpful :).\nSo let's just remove the @Singleton here and add a comment on why we can't make it @Singleton, OK?", "url": "https://github.com/quarkusio/quarkus/pull/8911#discussion_r416627122", "createdAt": "2020-04-28T13:47:39Z", "author": {"login": "geoand"}, "path": "extensions/jsonb/runtime/src/main/java/io/quarkus/jsonb/JsonbProducer.java", "diffHunk": "@@ -13,6 +13,7 @@\n public class JsonbProducer {\n \n     @Produces\n+    @Singleton\n     @DefaultBean\n     public JsonbConfig jsonbConfig(Instance<JsonbConfigCustomizer> customizers) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNjYyNDMyOA=="}, "originalCommit": {"oid": "14ac3da4c86e55893c04f4d3c5fda3791d98b831"}, "originalPosition": 6}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNjYzMzM5MQ==", "bodyText": "By making it a bean users are able to supply there own configuration by means of a CDI producer, which you of course know is super helpful :).\n\nSo an alternative could be to fire an event of type JsonbConfig when creating a Jsonb instance so that users can observe the config and modify it. But this would break the compatibility of course.\n\nSo let's just remove the @singleton here and add a comment on why we can't make it @singleton, OK?\n\nSounds good enough. If there is a doc about overriding the JsonbConfig bean we should mention it there as well.", "url": "https://github.com/quarkusio/quarkus/pull/8911#discussion_r416633391", "createdAt": "2020-04-28T13:55:44Z", "author": {"login": "mkouba"}, "path": "extensions/jsonb/runtime/src/main/java/io/quarkus/jsonb/JsonbProducer.java", "diffHunk": "@@ -13,6 +13,7 @@\n public class JsonbProducer {\n \n     @Produces\n+    @Singleton\n     @DefaultBean\n     public JsonbConfig jsonbConfig(Instance<JsonbConfigCustomizer> customizers) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNjYyNDMyOA=="}, "originalCommit": {"oid": "14ac3da4c86e55893c04f4d3c5fda3791d98b831"}, "originalPosition": 6}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNjY0MjIxMg==", "bodyText": "@loicmathieu can you adjust your PR to only make Jsonb singleton.\nAlso I would add a comment for JsonbConfig: \"JsonbConfig is not thread safe so it must not be made singleton.\"", "url": "https://github.com/quarkusio/quarkus/pull/8911#discussion_r416642212", "createdAt": "2020-04-28T14:06:48Z", "author": {"login": "gsmet"}, "path": "extensions/jsonb/runtime/src/main/java/io/quarkus/jsonb/JsonbProducer.java", "diffHunk": "@@ -13,6 +13,7 @@\n public class JsonbProducer {\n \n     @Produces\n+    @Singleton\n     @DefaultBean\n     public JsonbConfig jsonbConfig(Instance<JsonbConfigCustomizer> customizers) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNjYyNDMyOA=="}, "originalCommit": {"oid": "14ac3da4c86e55893c04f4d3c5fda3791d98b831"}, "originalPosition": 6}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNjY0NDM1MQ==", "bodyText": "must be @Dependent maybe? It can't be @ApplicationScoped or any other scope that is shared.", "url": "https://github.com/quarkusio/quarkus/pull/8911#discussion_r416644351", "createdAt": "2020-04-28T14:09:42Z", "author": {"login": "mkouba"}, "path": "extensions/jsonb/runtime/src/main/java/io/quarkus/jsonb/JsonbProducer.java", "diffHunk": "@@ -13,6 +13,7 @@\n public class JsonbProducer {\n \n     @Produces\n+    @Singleton\n     @DefaultBean\n     public JsonbConfig jsonbConfig(Instance<JsonbConfigCustomizer> customizers) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNjYyNDMyOA=="}, "originalCommit": {"oid": "14ac3da4c86e55893c04f4d3c5fda3791d98b831"}, "originalPosition": 6}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNjY0NDQ0MA==", "bodyText": "And also like @mkouba mentioned to mention the fact here: \n  \n    \n      quarkus/docs/src/main/asciidoc/rest-json.adoc\n    \n    \n         Line 162\n      in\n      a1380ee\n    \n    \n    \n    \n\n        \n          \n           ==== JSON-B", "url": "https://github.com/quarkusio/quarkus/pull/8911#discussion_r416644440", "createdAt": "2020-04-28T14:09:48Z", "author": {"login": "geoand"}, "path": "extensions/jsonb/runtime/src/main/java/io/quarkus/jsonb/JsonbProducer.java", "diffHunk": "@@ -13,6 +13,7 @@\n public class JsonbProducer {\n \n     @Produces\n+    @Singleton\n     @DefaultBean\n     public JsonbConfig jsonbConfig(Instance<JsonbConfigCustomizer> customizers) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNjYyNDMyOA=="}, "originalCommit": {"oid": "14ac3da4c86e55893c04f4d3c5fda3791d98b831"}, "originalPosition": 6}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNjY2MDEyMQ==", "bodyText": "I switch to @Dependent even if it's the default scope so it's explicit that we want it.\nI added the comment.\nI also add the two scopes to the documentation so if someone provides their own beans they know which scope to add to them.", "url": "https://github.com/quarkusio/quarkus/pull/8911#discussion_r416660121", "createdAt": "2020-04-28T14:29:11Z", "author": {"login": "loicmathieu"}, "path": "extensions/jsonb/runtime/src/main/java/io/quarkus/jsonb/JsonbProducer.java", "diffHunk": "@@ -13,6 +13,7 @@\n public class JsonbProducer {\n \n     @Produces\n+    @Singleton\n     @DefaultBean\n     public JsonbConfig jsonbConfig(Instance<JsonbConfigCustomizer> customizers) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNjYyNDMyOA=="}, "originalCommit": {"oid": "14ac3da4c86e55893c04f4d3c5fda3791d98b831"}, "originalPosition": 6}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNjY2MDk1MA==", "bodyText": "Great, thanks!", "url": "https://github.com/quarkusio/quarkus/pull/8911#discussion_r416660950", "createdAt": "2020-04-28T14:30:10Z", "author": {"login": "geoand"}, "path": "extensions/jsonb/runtime/src/main/java/io/quarkus/jsonb/JsonbProducer.java", "diffHunk": "@@ -13,6 +13,7 @@\n public class JsonbProducer {\n \n     @Produces\n+    @Singleton\n     @DefaultBean\n     public JsonbConfig jsonbConfig(Instance<JsonbConfigCustomizer> customizers) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNjYyNDMyOA=="}, "originalCommit": {"oid": "14ac3da4c86e55893c04f4d3c5fda3791d98b831"}, "originalPosition": 6}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3312, "cost": 1, "resetAt": "2021-11-13T14:23:39Z"}}}