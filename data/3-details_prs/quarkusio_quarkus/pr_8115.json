{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0MzkzMTQyMjAx", "number": 8115, "title": "Use CustomScopeAnnotationsBuildItem where needed", "bodyText": "follows up on #7076", "createdAt": "2020-03-24T17:25:49Z", "url": "https://github.com/quarkusio/quarkus/pull/8115", "merged": true, "mergeCommit": {"oid": "d73930b1c9710a85394f0fe5d8b8c7a20c0186ee"}, "closed": true, "closedAt": "2020-03-25T12:06:32Z", "author": {"login": "mkouba"}, "timelineItems": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcRDekdAFqTM4MDkyNzI3Ng==", "endCursor": "Y3Vyc29yOnYyOpPPAAABcRGPTAAFqTM4MTA4MTMxMA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzgwOTI3Mjc2", "url": "https://github.com/quarkusio/quarkus/pull/8115#pullrequestreview-380927276", "createdAt": "2020-03-25T08:11:26Z", "commit": {"oid": "9ba607113fe974601f06eaf54706a03f1bae0217"}, "state": "APPROVED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yNVQwODoxMToyNlrOF7P1oQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yNVQwODoxMToyNlrOF7P1oQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NzY2OTc5Mw==", "bodyText": "would be better to say \"with no scope defined\", there could be some other unrelated annotations", "url": "https://github.com/quarkusio/quarkus/pull/8115#discussion_r397669793", "createdAt": "2020-03-25T08:11:26Z", "author": {"login": "jmartisk"}, "path": "extensions/scheduler/deployment/src/main/java/io/quarkus/scheduler/deployment/SchedulerProcessor.java", "diffHunk": "@@ -104,14 +104,14 @@ public boolean appliesTo(org.jboss.jandex.AnnotationTarget.Kind kind) {\n \n             @Override\n             public void transform(TransformationContext context) {\n-                if (context.isClass() && !scopes.isScopeDeclaredOn(context.getTarget().asClass())) {\n+                ClassInfo target = context.getTarget().asClass();\n+                if (!scopes.isScopeIn(context.getAnnotations())\n+                        && (target.annotations().containsKey(SCHEDULED_NAME)\n+                                || target.annotations().containsKey(SCHEDULES_NAME))) {\n                     // Class with no scope annotation but with @Scheduled method\n-                    if (context.getTarget().asClass().annotations().containsKey(SCHEDULED_NAME)\n-                            || context.getTarget().asClass().annotations().containsKey(SCHEDULES_NAME)) {\n-                        LOGGER.debugf(\"Found scheduled business methods on a class %s with no annotations - adding @Singleton\",\n-                                context.getTarget());\n-                        context.transform().add(Singleton.class).done();\n-                    }\n+                    LOGGER.debugf(\"Found scheduled business methods on a class %s with no annotations - adding @Singleton\",", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "9ba607113fe974601f06eaf54706a03f1bae0217"}, "originalPosition": 16}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "3851472f6b42b01b2fcc5d7b5e048440c44a0351", "author": {"user": {"login": "mkouba", "name": "Martin Kouba"}}, "url": "https://github.com/quarkusio/quarkus/commit/3851472f6b42b01b2fcc5d7b5e048440c44a0351", "committedDate": "2020-03-25T08:58:48Z", "message": "Use CustomScopeAnnotationsBuildItem where needed\n\n- follows up on #7076"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "9ba607113fe974601f06eaf54706a03f1bae0217", "author": {"user": {"login": "mkouba", "name": "Martin Kouba"}}, "url": "https://github.com/quarkusio/quarkus/commit/9ba607113fe974601f06eaf54706a03f1bae0217", "committedDate": "2020-03-24T17:25:10Z", "message": "Use CustomScopeAnnotationsBuildItem where needed\n\n- follows up on #7076"}, "afterCommit": {"oid": "3851472f6b42b01b2fcc5d7b5e048440c44a0351", "author": {"user": {"login": "mkouba", "name": "Martin Kouba"}}, "url": "https://github.com/quarkusio/quarkus/commit/3851472f6b42b01b2fcc5d7b5e048440c44a0351", "committedDate": "2020-03-25T08:58:48Z", "message": "Use CustomScopeAnnotationsBuildItem where needed\n\n- follows up on #7076"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzgxMDgxMzEw", "url": "https://github.com/quarkusio/quarkus/pull/8115#pullrequestreview-381081310", "createdAt": "2020-03-25T11:58:56Z", "commit": {"oid": "3851472f6b42b01b2fcc5d7b5e048440c44a0351"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3601, "cost": 1, "resetAt": "2021-11-02T10:47:05Z"}}}