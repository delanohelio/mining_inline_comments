{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDMxNDQwMjcx", "number": 9872, "reviewThreads": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wOVQxNDozMjowNlrOED6L_g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wOVQxNDozODo0NlrOED6X5Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjcyNTM0NTI2OnYy", "diffSide": "RIGHT", "path": "extensions/hibernate-orm/deployment/src/main/java/io/quarkus/hibernate/orm/deployment/HibernateOrmProcessor.java", "isResolved": false, "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wOVQxNDozMjowNlrOGhNCsA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wOVQxODo0Nzo0NVrOGhXuJQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNzQ2OTg3Mg==", "bodyText": "This way the mere presence of the HIBERNATE_REACTIVE capability would break existing ORM applications, I don't think we can have that. Can you think of a better way?", "url": "https://github.com/quarkusio/quarkus/pull/9872#discussion_r437469872", "createdAt": "2020-06-09T14:32:06Z", "author": {"login": "Sanne"}, "path": "extensions/hibernate-orm/deployment/src/main/java/io/quarkus/hibernate/orm/deployment/HibernateOrmProcessor.java", "diffHunk": "@@ -208,8 +210,12 @@ public void configurationDescriptorBuilding(\n         for (PersistenceXmlDescriptorBuildItem persistenceXmlDescriptorBuildItem : persistenceXmlDescriptors) {\n             allDescriptors.add(persistenceXmlDescriptorBuildItem.getDescriptor());\n         }\n-        handleHibernateORMWithNoPersistenceXml(allDescriptors, resourceProducer, systemPropertyProducer,\n-                defaultJdbcDataSourceBuildItem, applicationArchivesBuildItem, launchMode.getLaunchMode());\n+\n+        final boolean hibernateReactivePresent = capabilities.isCapabilityPresent(Capabilities.HIBERNATE_REACTIVE);\n+        if (!hibernateReactivePresent) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "0b2b6526649d5bead89127c1e5e06024809e216d"}, "originalPosition": 35}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNzU1MDM3Nw==", "bodyText": "For now, simultaneous usage of Hibernate ORM and Reactive is not really tested, and therefore not supported (yet), so that is a current limitation.\nExisting ORM apps should still work if they have persistence.xml based config, but once they pull in HR it is assumed that the default PU is a reactive one.\nPerhaps we could key this off of the default datasource configuration also? So if the default JDBC datasource is NOT enabled (i.e. quarkus.datasource.jdbc=false) then this can stay as-is, but if the default JDBC datasource IS enabled, then we'd still want to produce this somehow. But this goes back to the current limitation of not being able to use ORM and HR at the same time.", "url": "https://github.com/quarkusio/quarkus/pull/9872#discussion_r437550377", "createdAt": "2020-06-09T16:08:47Z", "author": {"login": "aguibert"}, "path": "extensions/hibernate-orm/deployment/src/main/java/io/quarkus/hibernate/orm/deployment/HibernateOrmProcessor.java", "diffHunk": "@@ -208,8 +210,12 @@ public void configurationDescriptorBuilding(\n         for (PersistenceXmlDescriptorBuildItem persistenceXmlDescriptorBuildItem : persistenceXmlDescriptors) {\n             allDescriptors.add(persistenceXmlDescriptorBuildItem.getDescriptor());\n         }\n-        handleHibernateORMWithNoPersistenceXml(allDescriptors, resourceProducer, systemPropertyProducer,\n-                defaultJdbcDataSourceBuildItem, applicationArchivesBuildItem, launchMode.getLaunchMode());\n+\n+        final boolean hibernateReactivePresent = capabilities.isCapabilityPresent(Capabilities.HIBERNATE_REACTIVE);\n+        if (!hibernateReactivePresent) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNzQ2OTg3Mg=="}, "originalCommit": {"oid": "0b2b6526649d5bead89127c1e5e06024809e216d"}, "originalPosition": 35}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNzY0NDgzNw==", "bodyText": "ok, fair enough - especially as I don't have a better idea to suggest :)", "url": "https://github.com/quarkusio/quarkus/pull/9872#discussion_r437644837", "createdAt": "2020-06-09T18:47:45Z", "author": {"login": "Sanne"}, "path": "extensions/hibernate-orm/deployment/src/main/java/io/quarkus/hibernate/orm/deployment/HibernateOrmProcessor.java", "diffHunk": "@@ -208,8 +210,12 @@ public void configurationDescriptorBuilding(\n         for (PersistenceXmlDescriptorBuildItem persistenceXmlDescriptorBuildItem : persistenceXmlDescriptors) {\n             allDescriptors.add(persistenceXmlDescriptorBuildItem.getDescriptor());\n         }\n-        handleHibernateORMWithNoPersistenceXml(allDescriptors, resourceProducer, systemPropertyProducer,\n-                defaultJdbcDataSourceBuildItem, applicationArchivesBuildItem, launchMode.getLaunchMode());\n+\n+        final boolean hibernateReactivePresent = capabilities.isCapabilityPresent(Capabilities.HIBERNATE_REACTIVE);\n+        if (!hibernateReactivePresent) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNzQ2OTg3Mg=="}, "originalCommit": {"oid": "0b2b6526649d5bead89127c1e5e06024809e216d"}, "originalPosition": 35}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjcyNTM1MDEzOnYy", "diffSide": "RIGHT", "path": "extensions/hibernate-orm/deployment/src/main/java/io/quarkus/hibernate/orm/deployment/HibernateOrmProcessor.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wOVQxNDozMzowNVrOGhNFxA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wOVQxNDo1NToxMVrOGhOJ7Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNzQ3MDY2MA==", "bodyText": "Since we don't have the same drivers for Hibernate Reactive, should it have its own code for this?", "url": "https://github.com/quarkusio/quarkus/pull/9872#discussion_r437470660", "createdAt": "2020-06-09T14:33:05Z", "author": {"login": "Sanne"}, "path": "extensions/hibernate-orm/deployment/src/main/java/io/quarkus/hibernate/orm/deployment/HibernateOrmProcessor.java", "diffHunk": "@@ -934,11 +940,14 @@ public void test(CombinedIndexBuildItem index,\n         }\n     }\n \n-    private Optional<String> guessDialect(Optional<String> dbKind) {\n+    public static Optional<String> guessDialect(Optional<String> dbKind) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "0b2b6526649d5bead89127c1e5e06024809e216d"}, "originalPosition": 47}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNzQ4ODEwOQ==", "bodyText": "We don't have the same drivers, but we do have the same dialects. The same SQL should be valid in either JDBC or Vertx. If that ever changes and we need to make special reactive-only dialects we can revisit this, but I don't foresee that happening.", "url": "https://github.com/quarkusio/quarkus/pull/9872#discussion_r437488109", "createdAt": "2020-06-09T14:55:11Z", "author": {"login": "aguibert"}, "path": "extensions/hibernate-orm/deployment/src/main/java/io/quarkus/hibernate/orm/deployment/HibernateOrmProcessor.java", "diffHunk": "@@ -934,11 +940,14 @@ public void test(CombinedIndexBuildItem index,\n         }\n     }\n \n-    private Optional<String> guessDialect(Optional<String> dbKind) {\n+    public static Optional<String> guessDialect(Optional<String> dbKind) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNzQ3MDY2MA=="}, "originalCommit": {"oid": "0b2b6526649d5bead89127c1e5e06024809e216d"}, "originalPosition": 47}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjcyNTM2NTQxOnYy", "diffSide": "RIGHT", "path": "extensions/hibernate-reactive/deployment/src/main/java/io/quarkus/hibernate/reactive/deployment/HibernateReactiveProcessor.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wOVQxNDozNjoyOVrOGhNPnQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wOVQxNjoxOTozM1rOGhSX0Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNzQ3MzE4MQ==", "bodyText": "This looks like largely copied from the blocking ORM processor. Could you add a comment to highlight what's similar and what's intentionally different?", "url": "https://github.com/quarkusio/quarkus/pull/9872#discussion_r437473181", "createdAt": "2020-06-09T14:36:29Z", "author": {"login": "Sanne"}, "path": "extensions/hibernate-reactive/deployment/src/main/java/io/quarkus/hibernate/reactive/deployment/HibernateReactiveProcessor.java", "diffHunk": "@@ -61,6 +97,194 @@ public void build(RecorderContext recorderContext,\n         recorder.callHibernateReactiveFeatureInit(enableRx);\n     }\n \n+    @BuildStep", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "0b2b6526649d5bead89127c1e5e06024809e216d"}, "originalPosition": 71}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNzU1NzIwMQ==", "bodyText": "Sure thing, just pushed another commit with the comments", "url": "https://github.com/quarkusio/quarkus/pull/9872#discussion_r437557201", "createdAt": "2020-06-09T16:19:33Z", "author": {"login": "aguibert"}, "path": "extensions/hibernate-reactive/deployment/src/main/java/io/quarkus/hibernate/reactive/deployment/HibernateReactiveProcessor.java", "diffHunk": "@@ -61,6 +97,194 @@ public void build(RecorderContext recorderContext,\n         recorder.callHibernateReactiveFeatureInit(enableRx);\n     }\n \n+    @BuildStep", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNzQ3MzE4MQ=="}, "originalCommit": {"oid": "0b2b6526649d5bead89127c1e5e06024809e216d"}, "originalPosition": 71}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjcyNTM3NTczOnYy", "diffSide": "RIGHT", "path": "integration-tests/hibernate-reactive/src/main/resources/application.properties", "isResolved": true, "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wOVQxNDozODo0NlrOGhNWRA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wOVQxNToxNDowOFrOGhPM7g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNzQ3NDg4NA==", "bodyText": "This makes me wonder if we really shouldn't have something different for reactive than reusing the existing quarkus.hibernate-orm . Thoughts?", "url": "https://github.com/quarkusio/quarkus/pull/9872#discussion_r437474884", "createdAt": "2020-06-09T14:38:46Z", "author": {"login": "Sanne"}, "path": "integration-tests/hibernate-reactive/src/main/resources/application.properties", "diffHunk": "@@ -2,6 +2,10 @@ quarkus.datasource.db-kind=postgresql\n quarkus.datasource.username=hibernate_orm_test\n quarkus.datasource.password=hibernate_orm_test\n \n+# Hibernate config\n+quarkus.hibernate-orm.log.sql=true", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "0b2b6526649d5bead89127c1e5e06024809e216d"}, "originalPosition": 5}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNzQ5MDQzMQ==", "bodyText": "The prefix quarkus.hibernate-orm is the config root for the io.quarkus.hibernate.orm.deployment.HibernateOrmConfig class. The \"ORM\" reference in that root is a bit unfortunate, but besides that it seemed to be properly organized because all of the JDBC-specific config options are isolated under the quarkus.hibernate-orm.jdbc prefix. So if/when we ever add reactive-only configs, we can put them under their own prefix such as quarkus.hibernate-orm.reactive", "url": "https://github.com/quarkusio/quarkus/pull/9872#discussion_r437490431", "createdAt": "2020-06-09T14:58:16Z", "author": {"login": "aguibert"}, "path": "integration-tests/hibernate-reactive/src/main/resources/application.properties", "diffHunk": "@@ -2,6 +2,10 @@ quarkus.datasource.db-kind=postgresql\n quarkus.datasource.username=hibernate_orm_test\n quarkus.datasource.password=hibernate_orm_test\n \n+# Hibernate config\n+quarkus.hibernate-orm.log.sql=true", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNzQ3NDg4NA=="}, "originalCommit": {"oid": "0b2b6526649d5bead89127c1e5e06024809e216d"}, "originalPosition": 5}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNzUwNTI2Mg==", "bodyText": "ok.", "url": "https://github.com/quarkusio/quarkus/pull/9872#discussion_r437505262", "createdAt": "2020-06-09T15:14:08Z", "author": {"login": "Sanne"}, "path": "integration-tests/hibernate-reactive/src/main/resources/application.properties", "diffHunk": "@@ -2,6 +2,10 @@ quarkus.datasource.db-kind=postgresql\n quarkus.datasource.username=hibernate_orm_test\n quarkus.datasource.password=hibernate_orm_test\n \n+# Hibernate config\n+quarkus.hibernate-orm.log.sql=true", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNzQ3NDg4NA=="}, "originalCommit": {"oid": "0b2b6526649d5bead89127c1e5e06024809e216d"}, "originalPosition": 5}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2828, "cost": 1, "resetAt": "2021-11-13T14:23:39Z"}}}