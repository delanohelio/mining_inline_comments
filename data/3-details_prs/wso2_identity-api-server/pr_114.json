{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0Mzg2NDQyMDU5", "number": 114, "title": "Fix the issue of Identity Provider REST API Patch operation", "bodyText": "Purpose\nResolves: wso2/product-is#7851", "createdAt": "2020-03-11T01:46:09Z", "url": "https://github.com/wso2/identity-api-server/pull/114", "merged": true, "mergeCommit": {"oid": "76cd175f74f1770bede67a295fbbcd36840a5715"}, "closed": true, "closedAt": "2020-03-13T11:31:51Z", "author": {"login": "GANGANI"}, "timelineItems": {"totalCount": 14, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcMWZEaAH2gAyMzg2NDQyMDU5OjQ3NThlMzA4ZTQxMjFkOGZhMGE5NDBiMDA3NmZlNzk3ZDAwMmM0MDQ=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcNOhZlgFqTM3NDIyNDU0Ng==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "4758e308e4121d8fa0a940b0076fe797d002c404", "author": {"user": {"login": "GANGANI", "name": "Gangani Chamika"}}, "url": "https://github.com/wso2/identity-api-server/commit/4758e308e4121d8fa0a940b0076fe797d002c404", "committedDate": "2020-03-10T17:58:28Z", "message": "Fix the issue of Identity Provider REST API Patch operation"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzcyNDYyNTA4", "url": "https://github.com/wso2/identity-api-server/pull/114#pullrequestreview-372462508", "createdAt": "2020-03-11T03:58:12Z", "commit": {"oid": "4758e308e4121d8fa0a940b0076fe797d002c404"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xMVQwMzo1ODoxMlrOF0ogvg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xMVQwMzo1ODoxMlrOF0ogvg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MDczNDAxNA==", "bodyText": "if its a certificate it will be an object. so we need to do something similar to https://github.com/wso2/identity-api-server/blob/master/components/org.wso2.carbon.identity.api.server.idp/org.wso2.carbon.identity.api.server.idp.v1/src/main/java/org/wso2/carbon/identity/api/server/idp/v1/core/ServerIdpManagementService.java#L1136-L1141", "url": "https://github.com/wso2/identity-api-server/pull/114#discussion_r390734014", "createdAt": "2020-03-11T03:58:12Z", "author": {"login": "emswbandara"}, "path": "components/org.wso2.carbon.identity.api.server.idp/org.wso2.carbon.identity.api.server.idp.v1/src/main/java/org/wso2/carbon/identity/api/server/idp/v1/core/ServerIdpManagementService.java", "diffHunk": "@@ -1953,6 +1953,12 @@ private void processPatchRequest(List<Patch> patchRequest, IdentityProvider idpT\n                     case Constants.HOME_REALM_PATH:\n                         idpToUpdate.setHomeRealmId(value);\n                         break;\n+                    case Constants.ALIAS:\n+                        idpToUpdate.setAlias(value);\n+                        break;\n+                    case Constants.CERTIFICATE:\n+                        idpToUpdate.setCertificate(value);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "4758e308e4121d8fa0a940b0076fe797d002c404"}, "originalPosition": 8}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "8382cd79bb7b201e3bf5e9c66077c0b748be4bde", "author": {"user": {"login": "GANGANI", "name": "Gangani Chamika"}}, "url": "https://github.com/wso2/identity-api-server/commit/8382cd79bb7b201e3bf5e9c66077c0b748be4bde", "committedDate": "2020-03-12T09:06:06Z", "message": "Fix patch operation for certificate attribute"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzczMzkxMDcy", "url": "https://github.com/wso2/identity-api-server/pull/114#pullrequestreview-373391072", "createdAt": "2020-03-12T09:25:15Z", "commit": {"oid": "8382cd79bb7b201e3bf5e9c66077c0b748be4bde"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xMlQwOToyNToxNlrOF1WxmA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xMlQwOToyNToxNlrOF1WxmA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MTQ5MTk5Mg==", "bodyText": "let's add ArrayUtils.isnotEmpty(idpToUpdate.getCertificateInfoArray()) here before iterating", "url": "https://github.com/wso2/identity-api-server/pull/114#discussion_r391491992", "createdAt": "2020-03-12T09:25:16Z", "author": {"login": "emswbandara"}, "path": "components/org.wso2.carbon.identity.api.server.idp/org.wso2.carbon.identity.api.server.idp.v1/src/main/java/org/wso2/carbon/identity/api/server/idp/v1/core/ServerIdpManagementService.java", "diffHunk": "@@ -1931,31 +1931,53 @@ private void processPatchRequest(List<Patch> patchRequest, IdentityProvider idpT\n             // We support only 'REPLACE' patch operation.\n             if (operation == Patch.OperationEnum.REPLACE) {\n                 String value = patch.getValue();\n-                switch (path) {\n-                    case Constants.NAME_PATH:\n-                        idpToUpdate.setIdentityProviderName(value);\n-                        break;\n-                    case Constants.DESCRIPTION_PATH:\n-                        idpToUpdate.setIdentityProviderDescription(value);\n-                        break;\n-                    case Constants.IMAGE_PATH:\n-                        idpToUpdate.setImageUrl(value);\n-                        break;\n-                    case Constants.IS_PRIMARY_PATH:\n-                        idpToUpdate.setPrimary(Boolean.parseBoolean(value));\n-                        break;\n-                    case Constants.IS_ENABLED_PATH:\n-                        idpToUpdate.setEnable(Boolean.parseBoolean(value));\n-                        break;\n-                    case Constants.IS_FEDERATION_HUB_PATH:\n-                        idpToUpdate.setFederationHub(Boolean.parseBoolean(value));\n-                        break;\n-                    case Constants.HOME_REALM_PATH:\n-                        idpToUpdate.setHomeRealmId(value);\n-                        break;\n-                    default:\n-                        throw handleException(Response.Status.BAD_REQUEST, Constants.ErrorMessage\n-                                .ERROR_CODE_INVALID_INPUT, null);\n+                if (path.contains(Constants.CERTIFICATE)) {\n+                    List<String> certificates = new ArrayList<>();\n+                    for (CertificateInfo certInfo : idpToUpdate.getCertificateInfoArray()) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "8382cd79bb7b201e3bf5e9c66077c0b748be4bde"}, "originalPosition": 31}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzczMzk1MTgx", "url": "https://github.com/wso2/identity-api-server/pull/114#pullrequestreview-373395181", "createdAt": "2020-03-12T09:31:10Z", "commit": {"oid": "8382cd79bb7b201e3bf5e9c66077c0b748be4bde"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xMlQwOTozMToxMFrOF1W-Jw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xMlQwOTozMToxMFrOF1W-Jw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MTQ5NTIwNw==", "bodyText": "if we do contains here, it will allow invalid paths as well. Its better to define a regex for this and do a regex match.\ne.g. you can use a regex similar to 'certificate/certificates/\\d+'", "url": "https://github.com/wso2/identity-api-server/pull/114#discussion_r391495207", "createdAt": "2020-03-12T09:31:10Z", "author": {"login": "emswbandara"}, "path": "components/org.wso2.carbon.identity.api.server.idp/org.wso2.carbon.identity.api.server.idp.v1/src/main/java/org/wso2/carbon/identity/api/server/idp/v1/core/ServerIdpManagementService.java", "diffHunk": "@@ -1931,31 +1931,53 @@ private void processPatchRequest(List<Patch> patchRequest, IdentityProvider idpT\n             // We support only 'REPLACE' patch operation.\n             if (operation == Patch.OperationEnum.REPLACE) {\n                 String value = patch.getValue();\n-                switch (path) {\n-                    case Constants.NAME_PATH:\n-                        idpToUpdate.setIdentityProviderName(value);\n-                        break;\n-                    case Constants.DESCRIPTION_PATH:\n-                        idpToUpdate.setIdentityProviderDescription(value);\n-                        break;\n-                    case Constants.IMAGE_PATH:\n-                        idpToUpdate.setImageUrl(value);\n-                        break;\n-                    case Constants.IS_PRIMARY_PATH:\n-                        idpToUpdate.setPrimary(Boolean.parseBoolean(value));\n-                        break;\n-                    case Constants.IS_ENABLED_PATH:\n-                        idpToUpdate.setEnable(Boolean.parseBoolean(value));\n-                        break;\n-                    case Constants.IS_FEDERATION_HUB_PATH:\n-                        idpToUpdate.setFederationHub(Boolean.parseBoolean(value));\n-                        break;\n-                    case Constants.HOME_REALM_PATH:\n-                        idpToUpdate.setHomeRealmId(value);\n-                        break;\n-                    default:\n-                        throw handleException(Response.Status.BAD_REQUEST, Constants.ErrorMessage\n-                                .ERROR_CODE_INVALID_INPUT, null);\n+                if (path.contains(Constants.CERTIFICATE)) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "8382cd79bb7b201e3bf5e9c66077c0b748be4bde"}, "originalPosition": 29}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d8c03ce82b78b02cebb6f87be8ce9e77c1973a80", "author": {"user": {"login": "GANGANI", "name": "Gangani Chamika"}}, "url": "https://github.com/wso2/identity-api-server/commit/d8c03ce82b78b02cebb6f87be8ce9e77c1973a80", "committedDate": "2020-03-12T11:26:31Z", "message": "Add regex to match certificate path"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzczNDkwMzc3", "url": "https://github.com/wso2/identity-api-server/pull/114#pullrequestreview-373490377", "createdAt": "2020-03-12T11:54:20Z", "commit": {"oid": "d8c03ce82b78b02cebb6f87be8ce9e77c1973a80"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xMlQxMTo1NDoyMFrOF1bjiA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xMlQxMTo1NDoyMFrOF1bjiA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MTU3MDMxMg==", "bodyText": "lets verify whether 0 < index <= idpToUpdate.getCertificateInfoArray().length as well.", "url": "https://github.com/wso2/identity-api-server/pull/114#discussion_r391570312", "createdAt": "2020-03-12T11:54:20Z", "author": {"login": "emswbandara"}, "path": "components/org.wso2.carbon.identity.api.server.idp/org.wso2.carbon.identity.api.server.idp.v1/src/main/java/org/wso2/carbon/identity/api/server/idp/v1/core/ServerIdpManagementService.java", "diffHunk": "@@ -1931,31 +1931,54 @@ private void processPatchRequest(List<Patch> patchRequest, IdentityProvider idpT\n             // We support only 'REPLACE' patch operation.\n             if (operation == Patch.OperationEnum.REPLACE) {\n                 String value = patch.getValue();\n-                switch (path) {\n-                    case Constants.NAME_PATH:\n-                        idpToUpdate.setIdentityProviderName(value);\n-                        break;\n-                    case Constants.DESCRIPTION_PATH:\n-                        idpToUpdate.setIdentityProviderDescription(value);\n-                        break;\n-                    case Constants.IMAGE_PATH:\n-                        idpToUpdate.setImageUrl(value);\n-                        break;\n-                    case Constants.IS_PRIMARY_PATH:\n-                        idpToUpdate.setPrimary(Boolean.parseBoolean(value));\n-                        break;\n-                    case Constants.IS_ENABLED_PATH:\n-                        idpToUpdate.setEnable(Boolean.parseBoolean(value));\n-                        break;\n-                    case Constants.IS_FEDERATION_HUB_PATH:\n-                        idpToUpdate.setFederationHub(Boolean.parseBoolean(value));\n-                        break;\n-                    case Constants.HOME_REALM_PATH:\n-                        idpToUpdate.setHomeRealmId(value);\n-                        break;\n-                    default:\n-                        throw handleException(Response.Status.BAD_REQUEST, Constants.ErrorMessage\n-                                .ERROR_CODE_INVALID_INPUT, null);\n+                if (path.matches(\"/certificate/certificates/[0-9]+\")) {\n+                    List<String> certificates = new ArrayList<>();\n+                    int index = Integer.parseInt(path.split(\"/\")[3]);\n+                    if (ArrayUtils.isNotEmpty(idpToUpdate.getCertificateInfoArray())) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d8c03ce82b78b02cebb6f87be8ce9e77c1973a80"}, "originalPosition": 32}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "caa5f02e2d13533499f8730c7d67af32843f80a5", "author": {"user": {"login": "GANGANI", "name": "Gangani Chamika"}}, "url": "https://github.com/wso2/identity-api-server/commit/caa5f02e2d13533499f8730c7d67af32843f80a5", "committedDate": "2020-03-13T03:55:07Z", "message": "Validate the certificate path"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzc0MDU0MTA2", "url": "https://github.com/wso2/identity-api-server/pull/114#pullrequestreview-374054106", "createdAt": "2020-03-13T05:12:58Z", "commit": {"oid": "caa5f02e2d13533499f8730c7d67af32843f80a5"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xM1QwNToxMjo1OFrOF130_A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xM1QwNToxMjo1OFrOF130_A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MjAzMzUzMg==", "bodyText": "do we use this constant anywhere? if not, let's remove it", "url": "https://github.com/wso2/identity-api-server/pull/114#discussion_r392033532", "createdAt": "2020-03-13T05:12:58Z", "author": {"login": "emswbandara"}, "path": "components/org.wso2.carbon.identity.api.server.idp/org.wso2.carbon.identity.api.server.idp.common/src/main/java/org/wso2/carbon/identity/api/server/idp/common/Constants.java", "diffHunk": "@@ -40,6 +41,9 @@\n     public static final String IS_ENABLED_PATH = \"/isEnabled\";\n     public static final String IS_FEDERATION_HUB_PATH = \"/isFederationHub\";\n     public static final String HOME_REALM_PATH = \"/homeRealmIdentifier\";\n+    public static final String ALIAS = \"/alias\";\n+    public static final String CERTIFICATE_JWKSURI = \"/certificate/jwksUri\";\n+    public static final String CERTIFICATE = \"/certificate/certificates\";", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "caa5f02e2d13533499f8730c7d67af32843f80a5"}, "originalPosition": 14}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzc0MDU0MjMy", "url": "https://github.com/wso2/identity-api-server/pull/114#pullrequestreview-374054232", "createdAt": "2020-03-13T05:13:32Z", "commit": {"oid": "caa5f02e2d13533499f8730c7d67af32843f80a5"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xM1QwNToxMzozMlrOF131XQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xM1QwNToxMzozMlrOF131XQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MjAzMzYyOQ==", "bodyText": "move this constant to under  Patch operation paths.", "url": "https://github.com/wso2/identity-api-server/pull/114#discussion_r392033629", "createdAt": "2020-03-13T05:13:32Z", "author": {"login": "emswbandara"}, "path": "components/org.wso2.carbon.identity.api.server.idp/org.wso2.carbon.identity.api.server.idp.common/src/main/java/org/wso2/carbon/identity/api/server/idp/common/Constants.java", "diffHunk": "@@ -28,6 +28,7 @@\n     public static final String META_DATA_SAML = \"meta_data_saml\";\n     public static final String SELECT_MODE = \"SelectMode\";\n     public static final String SELECT_MODE_METADATA = \"Metadata File Configuration\";\n+    public static final String CERTIFICATE_PATH_REGEX = \"/certificate/certificates/[0-9]+\";", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "caa5f02e2d13533499f8730c7d67af32843f80a5"}, "originalPosition": 4}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzc0MDU0NTc0", "url": "https://github.com/wso2/identity-api-server/pull/114#pullrequestreview-374054574", "createdAt": "2020-03-13T05:15:07Z", "commit": {"oid": "caa5f02e2d13533499f8730c7d67af32843f80a5"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xM1QwNToxNTowN1rOF132og==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xM1QwNToxNTowN1rOF132og==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MjAzMzk1NA==", "bodyText": "do we need to define a default value for index?", "url": "https://github.com/wso2/identity-api-server/pull/114#discussion_r392033954", "createdAt": "2020-03-13T05:15:07Z", "author": {"login": "emswbandara"}, "path": "components/org.wso2.carbon.identity.api.server.idp/org.wso2.carbon.identity.api.server.idp.v1/src/main/java/org/wso2/carbon/identity/api/server/idp/v1/core/ServerIdpManagementService.java", "diffHunk": "@@ -1922,6 +1922,7 @@ private OutboundConnector createOutboundConnector(String connectorId, IdentityPr\n      */\n     private void processPatchRequest(List<Patch> patchRequest, IdentityProvider idpToUpdate) {\n \n+        int index = 0;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "caa5f02e2d13533499f8730c7d67af32843f80a5"}, "originalPosition": 4}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "9d6a54b25602a0777a002ef0db1440fd95f0fdff", "author": {"user": {"login": "GANGANI", "name": "Gangani Chamika"}}, "url": "https://github.com/wso2/identity-api-server/commit/9d6a54b25602a0777a002ef0db1440fd95f0fdff", "committedDate": "2020-03-13T11:03:04Z", "message": "Modify processPatchRequest method"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e9d5f277a1c5c19e7302bd430944352484bd3b85", "author": {"user": {"login": "GANGANI", "name": "Gangani Chamika"}}, "url": "https://github.com/wso2/identity-api-server/commit/e9d5f277a1c5c19e7302bd430944352484bd3b85", "committedDate": "2020-03-13T11:20:14Z", "message": "Redefine index variable"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzc0MjI0NTQ2", "url": "https://github.com/wso2/identity-api-server/pull/114#pullrequestreview-374224546", "createdAt": "2020-03-13T11:22:15Z", "commit": {"oid": "e9d5f277a1c5c19e7302bd430944352484bd3b85"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1421, "cost": 1, "resetAt": "2021-11-02T10:47:05Z"}}}