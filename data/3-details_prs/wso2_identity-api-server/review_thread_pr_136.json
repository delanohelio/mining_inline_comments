{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDAwMzYzMjIy", "number": 136, "reviewThreads": {"totalCount": 7, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wOFQwMzoxODoyOFrODv0UpQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wOFQwNzowNDowNFrODv2__Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjUxNDY2OTE3OnYy", "diffSide": "RIGHT", "path": "components/org.wso2.carbon.identity.api.server.idp/org.wso2.carbon.identity.api.server.idp.common/src/main/java/org/wso2/carbon/identity/api/server/idp/common/Constants.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wOFQwMzoxODoyOFrOGCdlhg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wOFQwMzoxODoyOFrOGCdlhg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNTIzNTA3OA==", "bodyText": "use standard comment format. add space after // and add fullstop at the end.", "url": "https://github.com/wso2/identity-api-server/pull/136#discussion_r405235078", "createdAt": "2020-04-08T03:18:28Z", "author": {"login": "emswbandara"}, "path": "components/org.wso2.carbon.identity.api.server.idp/org.wso2.carbon.identity.api.server.idp.common/src/main/java/org/wso2/carbon/identity/api/server/idp/common/Constants.java", "diffHunk": "@@ -66,7 +66,11 @@\n     // IdP template property keys\n     public static final String PROP_CATEGORY = \"category\";\n     public static final String PROP_DISPLAY_ORDER = \"displayOrder\";\n+    public static final String PROP_SERVICES = \"services\";\n \n+    //IdP template services", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f57d02c564d03038b32a2f8d136da0e022b959ae"}, "originalPosition": 6}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjUxNDY3MTYzOnYy", "diffSide": "RIGHT", "path": "components/org.wso2.carbon.identity.api.server.idp/org.wso2.carbon.identity.api.server.idp.v1/src/main/java/org/wso2/carbon/identity/api/server/idp/v1/core/ServerIdpManagementService.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wOFQwMzoxOTozNlrOGCdm3Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wOFQwMzoxOTozNlrOGCdm3Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNTIzNTQyMQ==", "bodyText": "check whether idpTemplate.getPropertiesMap().get(PROP_SERVICES) is not null before splitting", "url": "https://github.com/wso2/identity-api-server/pull/136#discussion_r405235421", "createdAt": "2020-04-08T03:19:36Z", "author": {"login": "emswbandara"}, "path": "components/org.wso2.carbon.identity.api.server.idp/org.wso2.carbon.identity.api.server.idp.v1/src/main/java/org/wso2/carbon/identity/api/server/idp/v1/core/ServerIdpManagementService.java", "diffHunk": "@@ -951,6 +954,10 @@ private IdentityProviderTemplateListResponse createIDPTemplateListResponse(\n                     idpTemplateListItem.setDisplayOrder(\n                             Integer.valueOf(idpTemplate.getPropertiesMap().get(PROP_DISPLAY_ORDER)));\n                 }\n+                if (idpTemplate.getPropertiesMap().containsKey(PROP_SERVICES)) {\n+                    idpTemplateListItem.setServices(Arrays.asList(\n+                            idpTemplate.getPropertiesMap().get(PROP_SERVICES).split(\",\")));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f57d02c564d03038b32a2f8d136da0e022b959ae"}, "originalPosition": 16}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjUxNDY3NDQzOnYy", "diffSide": "RIGHT", "path": "components/org.wso2.carbon.identity.api.server.idp/org.wso2.carbon.identity.api.server.idp.v1/src/main/resources/idp.yaml", "isResolved": true, "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wOFQwMzoyMToxMFrOGCdoWw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wOFQwNDoxODoyMFrOGCebfQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNTIzNTgwMw==", "bodyText": "here also services can be an array. Let's change it to be the same as IdentityProviderTemplateListItem", "url": "https://github.com/wso2/identity-api-server/pull/136#discussion_r405235803", "createdAt": "2020-04-08T03:21:10Z", "author": {"login": "emswbandara"}, "path": "components/org.wso2.carbon.identity.api.server.idp/org.wso2.carbon.identity.api.server.idp.v1/src/main/resources/idp.yaml", "diffHunk": "@@ -2388,3 +2392,6 @@ components:\n       required:\n         - name\n         - idp\n+    Service:\n+      type: string", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f57d02c564d03038b32a2f8d136da0e022b959ae"}, "originalPosition": 16}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNTI0NzM4MA==", "bodyText": "also make it readOnly.. such that it cannot be sent via request.", "url": "https://github.com/wso2/identity-api-server/pull/136#discussion_r405247380", "createdAt": "2020-04-08T04:11:42Z", "author": {"login": "emswbandara"}, "path": "components/org.wso2.carbon.identity.api.server.idp/org.wso2.carbon.identity.api.server.idp.v1/src/main/resources/idp.yaml", "diffHunk": "@@ -2388,3 +2392,6 @@ components:\n       required:\n         - name\n         - idp\n+    Service:\n+      type: string", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNTIzNTgwMw=="}, "originalCommit": {"oid": "f57d02c564d03038b32a2f8d136da0e022b959ae"}, "originalPosition": 16}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNTI0ODg5Mw==", "bodyText": "Here service is the list item for services attribute in IdentityProviderTemplateListItem. I didn't add services attribute for IdentityProviderTemplate. Since we get the full template when we retrieve templates by the id.", "url": "https://github.com/wso2/identity-api-server/pull/136#discussion_r405248893", "createdAt": "2020-04-08T04:18:20Z", "author": {"login": "mevan-karu"}, "path": "components/org.wso2.carbon.identity.api.server.idp/org.wso2.carbon.identity.api.server.idp.v1/src/main/resources/idp.yaml", "diffHunk": "@@ -2388,3 +2392,6 @@ components:\n       required:\n         - name\n         - idp\n+    Service:\n+      type: string", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNTIzNTgwMw=="}, "originalCommit": {"oid": "f57d02c564d03038b32a2f8d136da0e022b959ae"}, "originalPosition": 16}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjUxNDg4MDgxOnYy", "diffSide": "RIGHT", "path": "components/org.wso2.carbon.identity.api.server.idp/org.wso2.carbon.identity.api.server.idp.v1/src/main/java/org/wso2/carbon/identity/api/server/idp/v1/core/ServerIdpManagementService.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wOFQwNTozMDoyOVrOGCfg2Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wOFQwNTozMDoyOVrOGCfg2Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNTI2NjY0OQ==", "bodyText": "formatting issue . double spaces after", "url": "https://github.com/wso2/identity-api-server/pull/136#discussion_r405266649", "createdAt": "2020-04-08T05:30:29Z", "author": {"login": "emswbandara"}, "path": "components/org.wso2.carbon.identity.api.server.idp/org.wso2.carbon.identity.api.server.idp.v1/src/main/java/org/wso2/carbon/identity/api/server/idp/v1/core/ServerIdpManagementService.java", "diffHunk": "@@ -1004,17 +1013,42 @@ private Template generateIDPTemplate(IdentityProviderTemplate idpTemplate) throw\n         identityProviderTemplate.setImageUrl(idpTemplate.getImage());\n         identityProviderTemplate.setTenantId(IdentityTenantUtil\n                 .getTenantId(ContextLoader.getTenantDomainFromContext()));\n+        Map<String, String> properties = createPropertiesMapForIdPTemplate(idpTemplate);\n+        identityProviderTemplate.setTemplateType(TemplateMgtConstants.TemplateType.IDP_TEMPLATE);\n+        identityProviderTemplate.setPropertiesMap(properties);\n+        identityProviderTemplate.setTemplateScript(createIDPTemplateScript(idpTemplate.getIdp()));\n+        return identityProviderTemplate;\n+    }\n+\n+    private Map<String, String> createPropertiesMapForIdPTemplate(IdentityProviderTemplate idpTemplate) {\n+\n         Map<String, String> properties = new HashMap<>();\n         if (idpTemplate.getCategory() != null) {\n             properties.put(PROP_CATEGORY, idpTemplate.getCategory().toString());\n         }\n         if (idpTemplate.getDisplayOrder() != null) {\n             properties.put(PROP_DISPLAY_ORDER, String.valueOf(idpTemplate.getDisplayOrder()));\n         }\n-        identityProviderTemplate.setTemplateType(TemplateMgtConstants.TemplateType.IDP_TEMPLATE);\n-        identityProviderTemplate.setPropertiesMap(properties);\n-        identityProviderTemplate.setTemplateScript(createIDPTemplateScript(idpTemplate.getIdp()));\n-        return identityProviderTemplate;\n+        ArrayList<String> services = createServicesListForIdP(idpTemplate.getIdp());\n+        if (!services.isEmpty()) {\n+            String servicesString = String.join(\",\", services);\n+            properties.put(PROP_SERVICES, servicesString);\n+        }\n+        return properties;\n+    }\n+\n+    private ArrayList<String>   createServicesListForIdP(IdentityProviderPOSTRequest idp) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ed774550c6fec90046c6a5219ce605db74ef642d"}, "originalPosition": 55}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjUxNDg4MzAxOnYy", "diffSide": "RIGHT", "path": "components/org.wso2.carbon.identity.api.server.idp/org.wso2.carbon.identity.api.server.idp.v1/src/main/java/org/wso2/carbon/identity/api/server/idp/v1/core/ServerIdpManagementService.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wOFQwNTozMTo1OVrOGCfiNQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wOFQwNTozMTo1OVrOGCfiNQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNTI2Njk5Nw==", "bodyText": "We can use CollectionUtils.isNotEmpty which checks for both null and empty.", "url": "https://github.com/wso2/identity-api-server/pull/136#discussion_r405266997", "createdAt": "2020-04-08T05:31:59Z", "author": {"login": "emswbandara"}, "path": "components/org.wso2.carbon.identity.api.server.idp/org.wso2.carbon.identity.api.server.idp.v1/src/main/java/org/wso2/carbon/identity/api/server/idp/v1/core/ServerIdpManagementService.java", "diffHunk": "@@ -1004,17 +1013,42 @@ private Template generateIDPTemplate(IdentityProviderTemplate idpTemplate) throw\n         identityProviderTemplate.setImageUrl(idpTemplate.getImage());\n         identityProviderTemplate.setTenantId(IdentityTenantUtil\n                 .getTenantId(ContextLoader.getTenantDomainFromContext()));\n+        Map<String, String> properties = createPropertiesMapForIdPTemplate(idpTemplate);\n+        identityProviderTemplate.setTemplateType(TemplateMgtConstants.TemplateType.IDP_TEMPLATE);\n+        identityProviderTemplate.setPropertiesMap(properties);\n+        identityProviderTemplate.setTemplateScript(createIDPTemplateScript(idpTemplate.getIdp()));\n+        return identityProviderTemplate;\n+    }\n+\n+    private Map<String, String> createPropertiesMapForIdPTemplate(IdentityProviderTemplate idpTemplate) {\n+\n         Map<String, String> properties = new HashMap<>();\n         if (idpTemplate.getCategory() != null) {\n             properties.put(PROP_CATEGORY, idpTemplate.getCategory().toString());\n         }\n         if (idpTemplate.getDisplayOrder() != null) {\n             properties.put(PROP_DISPLAY_ORDER, String.valueOf(idpTemplate.getDisplayOrder()));\n         }\n-        identityProviderTemplate.setTemplateType(TemplateMgtConstants.TemplateType.IDP_TEMPLATE);\n-        identityProviderTemplate.setPropertiesMap(properties);\n-        identityProviderTemplate.setTemplateScript(createIDPTemplateScript(idpTemplate.getIdp()));\n-        return identityProviderTemplate;\n+        ArrayList<String> services = createServicesListForIdP(idpTemplate.getIdp());\n+        if (!services.isEmpty()) {\n+            String servicesString = String.join(\",\", services);\n+            properties.put(PROP_SERVICES, servicesString);\n+        }\n+        return properties;\n+    }\n+\n+    private ArrayList<String>   createServicesListForIdP(IdentityProviderPOSTRequest idp) {\n+\n+        ArrayList<String> services = new ArrayList<>();\n+        if ((idp.getProvisioning().getOutboundConnectors() != null)\n+                && (!idp.getProvisioning().getOutboundConnectors().getConnectors().isEmpty())) {\n+            services.add(SERV_PROVISIONING);\n+        }\n+        if ((idp.getFederatedAuthenticators().getAuthenticators() != null)", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ed774550c6fec90046c6a5219ce605db74ef642d"}, "originalPosition": 62}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjUxNTEwNTAyOnYy", "diffSide": "RIGHT", "path": "components/org.wso2.carbon.identity.api.server.idp/org.wso2.carbon.identity.api.server.idp.v1/src/main/java/org/wso2/carbon/identity/api/server/idp/v1/core/ServerIdpManagementService.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wOFQwNzowMzoxMVrOGChl6Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wOFQwNzowMzoxMVrOGChl6Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNTMwMDcxMw==", "bodyText": "shall we combine the nested if condition with &&", "url": "https://github.com/wso2/identity-api-server/pull/136#discussion_r405300713", "createdAt": "2020-04-08T07:03:11Z", "author": {"login": "emswbandara"}, "path": "components/org.wso2.carbon.identity.api.server.idp/org.wso2.carbon.identity.api.server.idp.v1/src/main/java/org/wso2/carbon/identity/api/server/idp/v1/core/ServerIdpManagementService.java", "diffHunk": "@@ -951,6 +954,12 @@ private IdentityProviderTemplateListResponse createIDPTemplateListResponse(\n                     idpTemplateListItem.setDisplayOrder(\n                             Integer.valueOf(idpTemplate.getPropertiesMap().get(PROP_DISPLAY_ORDER)));\n                 }\n+                if (idpTemplate.getPropertiesMap().containsKey(PROP_SERVICES)) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "772b0def51e4c7db8045c3cc11b58e11990cac4b"}, "originalPosition": 14}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjUxNTEwNzgxOnYy", "diffSide": "RIGHT", "path": "components/org.wso2.carbon.identity.api.server.idp/org.wso2.carbon.identity.api.server.idp.v1/src/main/java/org/wso2/carbon/identity/api/server/idp/v1/core/ServerIdpManagementService.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wOFQwNzowNDowNFrOGChnoQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wOFQwNzowNDowNFrOGChnoQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNTMwMTE1Mw==", "bodyText": "formatting issue", "url": "https://github.com/wso2/identity-api-server/pull/136#discussion_r405301153", "createdAt": "2020-04-08T07:04:04Z", "author": {"login": "emswbandara"}, "path": "components/org.wso2.carbon.identity.api.server.idp/org.wso2.carbon.identity.api.server.idp.v1/src/main/java/org/wso2/carbon/identity/api/server/idp/v1/core/ServerIdpManagementService.java", "diffHunk": "@@ -1004,17 +1013,40 @@ private Template generateIDPTemplate(IdentityProviderTemplate idpTemplate) throw\n         identityProviderTemplate.setImageUrl(idpTemplate.getImage());\n         identityProviderTemplate.setTenantId(IdentityTenantUtil\n                 .getTenantId(ContextLoader.getTenantDomainFromContext()));\n+        Map<String, String> properties = createPropertiesMapForIdPTemplate(idpTemplate);\n+        identityProviderTemplate.setTemplateType(TemplateMgtConstants.TemplateType.IDP_TEMPLATE);\n+        identityProviderTemplate.setPropertiesMap(properties);\n+        identityProviderTemplate.setTemplateScript(createIDPTemplateScript(idpTemplate.getIdp()));\n+        return identityProviderTemplate;\n+    }\n+\n+    private Map<String, String> createPropertiesMapForIdPTemplate(IdentityProviderTemplate idpTemplate) {\n+\n         Map<String, String> properties = new HashMap<>();\n         if (idpTemplate.getCategory() != null) {\n             properties.put(PROP_CATEGORY, idpTemplate.getCategory().toString());\n         }\n         if (idpTemplate.getDisplayOrder() != null) {\n             properties.put(PROP_DISPLAY_ORDER, String.valueOf(idpTemplate.getDisplayOrder()));\n         }\n-        identityProviderTemplate.setTemplateType(TemplateMgtConstants.TemplateType.IDP_TEMPLATE);\n-        identityProviderTemplate.setPropertiesMap(properties);\n-        identityProviderTemplate.setTemplateScript(createIDPTemplateScript(idpTemplate.getIdp()));\n-        return identityProviderTemplate;\n+        ArrayList<String> services = createServicesListForIdP(idpTemplate.getIdp());\n+        if (!services.isEmpty()) {\n+            String servicesString = String.join(\",\", services);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "772b0def51e4c7db8045c3cc11b58e11990cac4b"}, "originalPosition": 49}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1462, "cost": 1, "resetAt": "2021-11-13T14:23:39Z"}}}