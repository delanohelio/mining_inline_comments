{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDY0ODU3ODY2", "number": 193, "title": "Apply fixes to the CORS REST API", "bodyText": "Purpose\n\nImplement CORS origin cleanup\nRemove tagRequests option in CORS Configurations\n\nRelated to\nwso2/product-is#8550\nwso2/product-is#9047", "createdAt": "2020-08-07T22:30:25Z", "url": "https://github.com/wso2/identity-api-server/pull/193", "merged": true, "mergeCommit": {"oid": "6dee2edb69d9c7537d23252a4ffd004ebbbc66f0"}, "closed": true, "closedAt": "2020-08-10T09:16:39Z", "author": {"login": "ivantha"}, "timelineItems": {"totalCount": 7, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABc8rGtVgH2gAyNDY0ODU3ODY2OjZmNjI4Y2NiMDJiZDg4OGNmMTU5ZmY2NzQyZGM1YzQxNDczMmIzNTY=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdJCVjFAFqTQ4ODM4MzQ1NA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "6f628ccb02bd888cf159ff6742dc5c414732b356", "author": {"user": {"login": "ivantha", "name": "Ivantha"}}, "url": "https://github.com/wso2/identity-api-server/commit/6f628ccb02bd888cf159ff6742dc5c414732b356", "committedDate": "2020-08-07T21:14:47Z", "message": "Implement CORS origin cleanup"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "de6822a45e37eede172bf0ec8abc469324c57170", "author": {"user": {"login": "ivantha", "name": "Ivantha"}}, "url": "https://github.com/wso2/identity-api-server/commit/de6822a45e37eede172bf0ec8abc469324c57170", "committedDate": "2020-08-07T22:23:10Z", "message": "Remove tagRequests option in CORS Configurations"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDYzOTYwMTk0", "url": "https://github.com/wso2/identity-api-server/pull/193#pullrequestreview-463960194", "createdAt": "2020-08-10T05:10:39Z", "commit": {"oid": "de6822a45e37eede172bf0ec8abc469324c57170"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xMFQwNToxMDozOVrOG-BjIg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xMFQwNToxMDozOVrOG-BjIg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NzY5MDI3NA==", "bodyText": "Can we remove this additional line?", "url": "https://github.com/wso2/identity-api-server/pull/193#discussion_r467690274", "createdAt": "2020-08-10T05:10:39Z", "author": {"login": "mevan-karu"}, "path": "components/org.wso2.carbon.identity.api.server.application.management/org.wso2.carbon.identity.api.server.application.management.v1/src/main/java/org/wso2/carbon/identity/api/server/application/management/v1/core/ServerApplicationManagementService.java", "diffHunk": "@@ -812,6 +804,34 @@ private void deleteInbound(String applicationId, String inboundType) {\n             appToUpdate.getInboundAuthenticationConfig().setInboundAuthenticationRequestConfigs(filteredInbounds);\n             updateServiceProvider(applicationId, appToUpdate);\n         }\n+\n+        // Delete the associated CORS origins if the inboundType is oauth2.\n+        if (inboundType.equals(OAUTH2)) {\n+            String tenantDomain = PrivilegedCarbonContext.getThreadLocalCarbonContext().getTenantDomain();\n+            int tenantId = IdentityTenantUtil.getTenantId(tenantDomain);\n+            CORSOriginDAO corsOriginDAO = new CORSOriginDAOImpl();\n+            List<CORSOrigin> existingCORSOrigins = null;\n+            ApplicationBasicInfo applicationBasicInfo = null;\n+            try {\n+                applicationBasicInfo = ApplicationManagementService.getInstance()\n+                        .getApplicationBasicInfoByResourceId(applicationId, tenantDomain);\n+                existingCORSOrigins = corsOriginDAO.getCORSOriginsByApplicationId(\n+                        applicationBasicInfo.getApplicationId(), tenantId);\n+", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "de6822a45e37eede172bf0ec8abc469324c57170"}, "originalPosition": 97}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "df6828dbadeca0cab87d81f8334b02d8556b5697", "author": {"user": {"login": "ivantha", "name": "Ivantha"}}, "url": "https://github.com/wso2/identity-api-server/commit/df6828dbadeca0cab87d81f8334b02d8556b5697", "committedDate": "2020-08-10T08:42:16Z", "message": "Rename CORS factory bean\n\n- Bump the framework version"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "1cc02576a430145f86ac834f140333f1b1378729", "author": {"user": {"login": "ivantha", "name": "Ivantha"}}, "url": "https://github.com/wso2/identity-api-server/commit/1cc02576a430145f86ac834f140333f1b1378729", "committedDate": "2020-08-10T08:34:25Z", "message": "Rename CORS factory bean\n\n- Bump the framework version"}, "afterCommit": {"oid": "df6828dbadeca0cab87d81f8334b02d8556b5697", "author": {"user": {"login": "ivantha", "name": "Ivantha"}}, "url": "https://github.com/wso2/identity-api-server/commit/df6828dbadeca0cab87d81f8334b02d8556b5697", "committedDate": "2020-08-10T08:42:16Z", "message": "Rename CORS factory bean\n\n- Bump the framework version"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDY0MDcwNzky", "url": "https://github.com/wso2/identity-api-server/pull/193#pullrequestreview-464070792", "createdAt": "2020-08-10T09:16:30Z", "commit": {"oid": "df6828dbadeca0cab87d81f8334b02d8556b5697"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDg4MzgzNDU0", "url": "https://github.com/wso2/identity-api-server/pull/193#pullrequestreview-488383454", "createdAt": "2020-09-15T07:05:54Z", "commit": {"oid": "df6828dbadeca0cab87d81f8334b02d8556b5697"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xNVQwNzowNTo1NFrOHRzptA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xNVQwNzowNTo1NFrOHRzptA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4ODQzNDEwMA==", "bodyText": "Fix character length", "url": "https://github.com/wso2/identity-api-server/pull/193#discussion_r488434100", "createdAt": "2020-09-15T07:05:54Z", "author": {"login": "jeradrutnam"}, "path": "components/org.wso2.carbon.identity.api.server.configs/org.wso2.carbon.identity.api.server.configs.v1/src/gen/java/org/wso2/carbon/identity/api/server/configs/v1/model/CORSConfig.java", "diffHunk": "@@ -239,13 +219,12 @@ public boolean equals(java.lang.Object o) {\n             Objects.equals(this.supportedHeaders, coRSConfig.supportedHeaders) &&\n             Objects.equals(this.exposedHeaders, coRSConfig.exposedHeaders) &&\n             Objects.equals(this.supportsCredentials, coRSConfig.supportsCredentials) &&\n-            Objects.equals(this.maxAge, coRSConfig.maxAge) &&\n-            Objects.equals(this.tagRequests, coRSConfig.tagRequests);\n+            Objects.equals(this.maxAge, coRSConfig.maxAge);\n     }\n \n     @Override\n     public int hashCode() {\n-        return Objects.hash(allowGenericHttpRequests, allowSubdomains, supportedMethods, supportedHeaders, exposedHeaders, supportsCredentials, maxAge, tagRequests);\n+        return Objects.hash(allowGenericHttpRequests, allowSubdomains, supportedMethods, supportedHeaders, exposedHeaders, supportsCredentials, maxAge);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "df6828dbadeca0cab87d81f8334b02d8556b5697"}, "originalPosition": 46}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1382, "cost": 1, "resetAt": "2021-11-02T10:47:05Z"}}}