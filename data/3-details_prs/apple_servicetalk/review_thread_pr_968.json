{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0Mzg5MzcyMzg0", "number": 968, "reviewThreads": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xNlQxODoyNToyMVrODodByw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xNlQxODoyNToyMVrODodByw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjQzNzQ1MjI3OnYy", "diffSide": "RIGHT", "path": "servicetalk-http-netty/src/test/java/io/servicetalk/http/netty/Tls13Test.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xNlQxODoyNToyMVrOF3AyBw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xNlQxODoyNToyMVrOF3AyBw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MzIyODgwNw==", "bodyText": "Can we also verify the cipher here?", "url": "https://github.com/apple/servicetalk/pull/968#discussion_r393228807", "createdAt": "2020-03-16T18:25:21Z", "author": {"login": "NiteshKant"}, "path": "servicetalk-http-netty/src/test/java/io/servicetalk/http/netty/Tls13Test.java", "diffHunk": "@@ -40,61 +50,88 @@\n import static java.util.Arrays.asList;\n import static java.util.Collections.singletonList;\n import static java.util.Objects.requireNonNull;\n+import static org.hamcrest.MatcherAssert.assertThat;\n+import static org.hamcrest.Matchers.equalTo;\n import static org.hamcrest.Matchers.is;\n-import static org.junit.Assert.assertThat;\n+import static org.hamcrest.Matchers.notNullValue;\n \n @RunWith(Parameterized.class)\n public class Tls13Test {\n     private static final String TLS1_3 = \"TLSv1.3\";\n     private static final String TLS1_3_REQUIRED_CIPHER = \"TLS_AES_128_GCM_SHA256\";\n \n+    @Rule\n+    public final Timeout timeout = new ServiceTalkTestTimeout();\n+\n     private final SslProvider serverSslProvider;\n     private final SslProvider clientSslProvider;\n+    @Nullable\n+    private final String cipher;\n \n-    public Tls13Test(SslProvider serverSslProvider, SslProvider clientSslProvider) {\n+    public Tls13Test(SslProvider serverSslProvider, SslProvider clientSslProvider, @Nullable String cipher) {\n         this.serverSslProvider = requireNonNull(serverSslProvider);\n         this.clientSslProvider = requireNonNull(clientSslProvider);\n+        this.cipher = cipher;\n     }\n \n-    @Parameterized.Parameters(name = \"server={0} client={1}\")\n+    @Parameterized.Parameters(name = \"server={0} client={1} cipher={2}\")\n     public static Collection<Object[]> sslProviders() {\n         // TLSv1.3 is not currently supported in JDK8.\n-        return javaVersion() < 11 ? singletonList(new Object[]{OPENSSL, OPENSSL}) :\n-                asList(new Object[]{JDK, JDK},\n-                        new Object[]{JDK, OPENSSL},\n-                        new Object[]{OPENSSL, JDK},\n-                        new Object[]{OPENSSL, OPENSSL}\n+        return javaVersion() < 11 ?\n+                asList(new Object[]{OPENSSL, OPENSSL, null},\n+                        new Object[]{OPENSSL, OPENSSL, TLS1_3_REQUIRED_CIPHER}) :\n+                asList(new Object[]{JDK, JDK, null},\n+                        new Object[]{JDK, JDK, TLS1_3_REQUIRED_CIPHER},\n+                        new Object[]{JDK, OPENSSL, null},\n+                        new Object[]{JDK, OPENSSL, TLS1_3_REQUIRED_CIPHER},\n+                        new Object[]{OPENSSL, JDK, null},\n+                        new Object[]{OPENSSL, JDK, TLS1_3_REQUIRED_CIPHER},\n+                        new Object[]{OPENSSL, OPENSSL, null},\n+                        new Object[]{OPENSSL, OPENSSL, TLS1_3_REQUIRED_CIPHER}\n         );\n     }\n \n     @Test\n     public void requiredCipher() throws Exception {\n-        try (ServerContext serverContext = HttpServers.forAddress(localAddress(0))\n+        HttpServerSecurityConfigurator serverSecurityConfigurator = HttpServers.forAddress(localAddress(0))\n                 .secure()\n                 .protocols(TLS1_3)\n-                .ciphers(singletonList(TLS1_3_REQUIRED_CIPHER))\n-                .provider(serverSslProvider)\n+                .provider(serverSslProvider);\n+        if (cipher != null) {\n+            serverSecurityConfigurator.ciphers(singletonList(cipher));\n+        }\n+        try (ServerContext serverContext = serverSecurityConfigurator\n                 .commit(DefaultTestCerts::loadServerPem, DefaultTestCerts::loadServerKey)\n-                .listenBlockingAndAwait((ctx, request, responseFactory) -> responseFactory.ok()\n-                        .payloadBody(request.payloadBody(textDeserializer()), textSerializer()))) {\n+                .listenBlockingAndAwait((ctx, request, responseFactory) -> {\n+                    assertThat(request.payloadBody(textDeserializer()), equalTo(\"request-payload-body\"));\n+                    SSLSession sslSession = ctx.sslSession();\n+                    assertThat(sslSession, is(notNullValue()));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "19e9f3644a634783c840e13c1ad481d80634e75e"}, "originalPosition": 100}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2894, "cost": 1, "resetAt": "2021-11-12T09:44:50Z"}}}