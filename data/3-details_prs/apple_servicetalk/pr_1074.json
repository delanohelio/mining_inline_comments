{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDI1MzcxNDMw", "number": 1074, "title": "Avoid blocking JDK DNS resolutions", "bodyText": "Motivation:\nUsers of HttpClients.forResolvedAddress(HostAndPort) API could end up\nusing blocking JDK DNS resolution if they pass unresolved hostname.\nModification:\n\nAdd BuilderUtils.toResolvedInetSocketAddress(HostAndPort) that creates\na resolved InetSocketAddress without DNS resolution;\nAdd tests for new utility method;\nUse this new utility for HttpClients. forResolvedAddress instead of\nnew java.net.InetSocketAddress;\n\nResult:\nUsers who pass unresolved hostname will see IllegalArgumentException\nwith UnknownHostException cause and should use HttpClients.forAddress\ninstead that performs async DNS resolutions using netty-dns-resolver.", "createdAt": "2020-05-29T23:15:44Z", "url": "https://github.com/apple/servicetalk/pull/1074", "merged": true, "mergeCommit": {"oid": "5e83430adf69174d66dc06fc306522970161b5cd"}, "closed": true, "closedAt": "2020-06-01T22:08:35Z", "author": {"login": "idelpivnitskiy"}, "timelineItems": {"totalCount": 9, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcmK3z-gH2gAyNDI1MzcxNDMwOmZlYTRlYWIwOTBjM2VkZDI4NWE0YTYyYjM0ZmJhZmY0YmE1NGJlMzE=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcnGS8XgH2gAyNDI1MzcxNDMwOjJlNjllYjQ3NGFkNWU1MmQxYTc0OWIwYjNjYTc4Y2Q2ZjY1YjY4MjA=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "fea4eab090c3edd285a4a62b34fbaff4ba54be31", "author": {"user": {"login": "idelpivnitskiy", "name": "Idel Pivnitskiy"}}, "url": "https://github.com/apple/servicetalk/commit/fea4eab090c3edd285a4a62b34fbaff4ba54be31", "committedDate": "2020-05-29T23:15:13Z", "message": "Avoid blocking JDK DNS resolutions\n\nMotivation:\n\nUsers of `HttpClients.forResolvedAddress(HostAndPort)` API could end up\nusing blocking JDK DNS resolution if they pass unresolved hostname.\n\nModification:\n\n- Use `java.net.InetSocketAddress.createUnresolved` instead of\n`new java.net.InetSocketAddress`;\n\nResult:\n\nUsers who pass unresolved hostname will see `UnresolvedAddressException`\nand should use `HttpClients.forAddress` instead that performs async DNS\nresolutions using netty-dns-resolver."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDIxMzQ1OTE4", "url": "https://github.com/apple/servicetalk/pull/1074#pullrequestreview-421345918", "createdAt": "2020-05-29T23:22:26Z", "commit": {"oid": "fea4eab090c3edd285a4a62b34fbaff4ba54be31"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "57d936ba0a640a246265531f6f741aae4115eb88", "author": {"user": {"login": "idelpivnitskiy", "name": "Idel Pivnitskiy"}}, "url": "https://github.com/apple/servicetalk/commit/57d936ba0a640a246265531f6f741aae4115eb88", "committedDate": "2020-05-30T00:06:39Z", "message": "Add a utility toInetSocketAddress and tests"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDIxMzU2NDQ4", "url": "https://github.com/apple/servicetalk/pull/1074#pullrequestreview-421356448", "createdAt": "2020-05-30T00:12:34Z", "commit": {"oid": "57d936ba0a640a246265531f6f741aae4115eb88"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0zMFQwMDoxMjozNFrOGcvVhw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0zMFQwMDoxMjozNFrOGcvVhw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMjc4ODg3MQ==", "bodyText": "@Scottmitch createUnresolved doesn't work when you pass an IP-address. I had to create a utility for this conversion.", "url": "https://github.com/apple/servicetalk/pull/1074#discussion_r432788871", "createdAt": "2020-05-30T00:12:34Z", "author": {"login": "idelpivnitskiy"}, "path": "servicetalk-http-netty/src/main/java/io/servicetalk/http/netty/HttpClients.java", "diffHunk": "@@ -221,7 +221,7 @@ private HttpClients() {\n     public static SingleAddressHttpClientBuilder<HostAndPort, InetSocketAddress> forResolvedAddressViaProxy(\n             final HostAndPort address, final HostAndPort proxyAddress) {\n         return DefaultSingleAddressHttpClientBuilder.forResolvedAddressViaProxy(address,\n-                new InetSocketAddress(address.hostName(), address.port()), proxyAddress);\n+                toInetSocketAddress(address), proxyAddress);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "57d936ba0a640a246265531f6f741aae4115eb88"}, "originalPosition": 23}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "09cddf5e6d8dee737efc1ad4ab483492322d2596", "author": {"user": {"login": "idelpivnitskiy", "name": "Idel Pivnitskiy"}}, "url": "https://github.com/apple/servicetalk/commit/09cddf5e6d8dee737efc1ad4ab483492322d2596", "committedDate": "2020-05-30T06:45:05Z", "message": "Suppress PMD warnings"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDIxNjEwMjI1", "url": "https://github.com/apple/servicetalk/pull/1074#pullrequestreview-421610225", "createdAt": "2020-06-01T06:01:33Z", "commit": {"oid": "09cddf5e6d8dee737efc1ad4ab483492322d2596"}, "state": "APPROVED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wMVQwNjowMTozM1rOGc_myw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wMVQwNjowMjowNlrOGc_nSQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMzA1NTQzNQ==", "bodyText": "nit: Rename to toUnresolvedAddress() to indicate it is unresolved?", "url": "https://github.com/apple/servicetalk/pull/1074#discussion_r433055435", "createdAt": "2020-06-01T06:01:33Z", "author": {"login": "NiteshKant"}, "path": "servicetalk-transport-netty-internal/src/main/java/io/servicetalk/transport/netty/internal/BuilderUtils.java", "diffHunk": "@@ -158,12 +163,27 @@ public static SocketAddress toNettyAddress(Object address) {\n             return (SocketAddress) address;\n         }\n         if (address instanceof HostAndPort) {\n-            HostAndPort hostAndPort = (HostAndPort) address;\n-            return new InetSocketAddress(hostAndPort.hostName(), hostAndPort.port());\n+            return toInetSocketAddress((HostAndPort) address);\n         }\n         throw new IllegalArgumentException(\"Unsupported address: \" + address);\n     }\n \n+    /**\n+     * Converts {@link HostAndPort} that contains a resolved address into {@link InetSocketAddress}.\n+     *\n+     * @param resolvedAddress the resolved address to convert.\n+     * @return {@link InetSocketAddress} from the passed resolved {@link HostAndPort}.\n+     */\n+    public static InetSocketAddress toInetSocketAddress(final HostAndPort resolvedAddress) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "09cddf5e6d8dee737efc1ad4ab483492322d2596"}, "originalPosition": 31}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMzA1NTU2MQ==", "bodyText": "Use loopback IPs instead of some specific IPs here and below?", "url": "https://github.com/apple/servicetalk/pull/1074#discussion_r433055561", "createdAt": "2020-06-01T06:02:06Z", "author": {"login": "NiteshKant"}, "path": "servicetalk-transport-netty-internal/src/test/java/io/servicetalk/transport/netty/internal/BuilderUtilsTest.java", "diffHunk": "@@ -0,0 +1,54 @@\n+/*\n+ * Copyright \u00a9 2020 Apple Inc. and the ServiceTalk project authors\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *   http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+package io.servicetalk.transport.netty.internal;\n+\n+import io.servicetalk.transport.api.HostAndPort;\n+\n+import org.junit.Test;\n+\n+import java.net.InetSocketAddress;\n+import java.net.UnknownHostException;\n+\n+import static io.servicetalk.transport.netty.internal.BuilderUtils.toInetSocketAddress;\n+import static org.hamcrest.MatcherAssert.assertThat;\n+import static org.hamcrest.Matchers.equalTo;\n+import static org.hamcrest.Matchers.is;\n+\n+public class BuilderUtilsTest {\n+\n+    @Test\n+    @SuppressWarnings(\"PMD.AvoidUsingHardCodedIP\")\n+    public void toInetSocketAddressFromIPv4() {\n+        InetSocketAddress address = toInetSocketAddress(HostAndPort.of(\"192.168.1.1\", 8080));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "09cddf5e6d8dee737efc1ad4ab483492322d2596"}, "originalPosition": 35}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "67b63bdd0855fe8ed15d768c15b2d273e11b654b", "author": {"user": {"login": "idelpivnitskiy", "name": "Idel Pivnitskiy"}}, "url": "https://github.com/apple/servicetalk/commit/67b63bdd0855fe8ed15d768c15b2d273e11b654b", "committedDate": "2020-06-01T16:46:15Z", "message": "Use local addresses"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c70a77bf8afc150aee42136be85ec259e5e9c67c", "author": {"user": {"login": "idelpivnitskiy", "name": "Idel Pivnitskiy"}}, "url": "https://github.com/apple/servicetalk/commit/c70a77bf8afc150aee42136be85ec259e5e9c67c", "committedDate": "2020-06-01T20:21:17Z", "message": "toInetSocketAddress -> toResolvedInetSocketAddress"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "2e69eb474ad5e52d1a749b0b3ca78cd6f65b6820", "author": {"user": {"login": "idelpivnitskiy", "name": "Idel Pivnitskiy"}}, "url": "https://github.com/apple/servicetalk/commit/2e69eb474ad5e52d1a749b0b3ca78cd6f65b6820", "committedDate": "2020-06-01T20:29:15Z", "message": "Throw IllegalArgumentException"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3727, "cost": 1, "resetAt": "2021-11-01T11:59:11Z"}}}