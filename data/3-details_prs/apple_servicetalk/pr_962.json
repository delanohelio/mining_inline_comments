{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0Mzg2Mjc1NDA0", "number": 962, "title": "MultiAddressUrl client fails to send http request after https request", "bodyText": "Motivation:\nIf MultiAddressUrl was used to send an HTTPS request over secure\nconnection, all other requests to new non-secure servers will fail\nwith DecoderException. It happens because we incorrectly copy the\nHttpClientBuilder template. We did not create a new instance of\nTcpClientConfig and HttpConfig.\nModifications:\n\nAdd copy ctor for HttpConfig;\nUse copy ctors for TcpClientConfig and HttpConfig in\nHttpClientConfig;\nAdd test to verify that MultiAddressUrl client can connect to\ninsecure server after connecting to a secure server and vice versa;\n\nResult:\nHttpClientConfig makes a full copy of TcpClientConfig and\nHttpConfig that prevents the HttpClientBuilder template from\nmodifications. MultiAddressUrl client correctly copies the\nbuilder template without internal state modifications.", "createdAt": "2020-03-10T17:43:57Z", "url": "https://github.com/apple/servicetalk/pull/962", "merged": true, "mergeCommit": {"oid": "8e4f5702e77ea59b51535db41671403c017ae040"}, "closed": true, "closedAt": "2020-03-10T21:18:05Z", "author": {"login": "idelpivnitskiy"}, "timelineItems": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcMWKvagH2gAyMzg2Mjc1NDA0OjE2YzFhNGY2NjM5MGNhNDBiZGZkNzY2MWQyYmFmODc4YjY4NmNjYjA=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcMYxVhgH2gAyMzg2Mjc1NDA0OmU0MjJjZmZhM2I2ZjQxMzY0MzQ4ZjVjYmMyY2VmMWExMGJkYjJmMzE=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "16c1a4f66390ca40bdfd7661d2baf878b686ccb0", "author": {"user": {"login": "idelpivnitskiy", "name": "Idel Pivnitskiy"}}, "url": "https://github.com/apple/servicetalk/commit/16c1a4f66390ca40bdfd7661d2baf878b686ccb0", "committedDate": "2020-03-10T17:42:49Z", "message": "MultiAddressUrl client fails to send http request after https request\n\nMotivation:\n\nIf `MultiAddressUrl` was used to send an HTTPS request over secure\nconnection, all other requests to a new non-secure servers will fail\nwith `DecoderException`. It happens because we incorrectly copy the\n`HttpClientBuilder` template. We did not create a new instance of\n`TcpClientConfig` and `HttpConfig`.\n\nModifications:\n\n- Add copy ctor for `HttpConfig`;\n- Use copy ctors for `TcpClientConfig` and `HttpConfig` in\n`HttpClientConfig`;\n- Add test to verify that `MultiAddressUrl` client can connect to\ninsecure server after connecting to a secure server and vice versa;\n\nResult:\n\n`HttpClientConfig` makes a full copy of `TcpClientConfig` and\n`HttpConfig` that prevents the `HttpClientBuilder` template from\nmodifications. `MultiAddressUrl` client correctly copies the\nbuilder template without internal state modifications."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzcyMjMyNTc5", "url": "https://github.com/apple/servicetalk/pull/962#pullrequestreview-372232579", "createdAt": "2020-03-10T18:51:45Z", "commit": {"oid": "16c1a4f66390ca40bdfd7661d2baf878b686ccb0"}, "state": "APPROVED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xMFQxODo1MTo0NVrOF0ckzg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xMFQxODo1MTo0NVrOF0ckzg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MDUzODQ0Ng==", "bodyText": "nit: consider reverting changes which are just about formatting", "url": "https://github.com/apple/servicetalk/pull/962#discussion_r390538446", "createdAt": "2020-03-10T18:51:45Z", "author": {"login": "normanmaurer"}, "path": "servicetalk-http-netty/src/main/java/io/servicetalk/http/netty/DefaultMultiAddressUrlHttpClientBuilder.java", "diffHunk": "@@ -289,8 +289,7 @@ public StreamingHttpClient apply(final UrlKey urlKey) {\n             this.executionContext = requireNonNull(executionContext);\n         }\n \n-        private FilterableStreamingHttpClient selectClient(\n-                HttpRequestMetaData metaData) {\n+        private FilterableStreamingHttpClient selectClient(final HttpRequestMetaData metaData) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "16c1a4f66390ca40bdfd7661d2baf878b686ccb0"}, "originalPosition": 6}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c2b09d501029d16a6faa2b6861091212c862bdd1", "author": {"user": {"login": "idelpivnitskiy", "name": "Idel Pivnitskiy"}}, "url": "https://github.com/apple/servicetalk/commit/c2b09d501029d16a6faa2b6861091212c862bdd1", "committedDate": "2020-03-10T20:30:33Z", "message": "revert formatting changes"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e422cffa3b6f41364348f5cbc2cef1a10bdb2f31", "author": {"user": {"login": "idelpivnitskiy", "name": "Idel Pivnitskiy"}}, "url": "https://github.com/apple/servicetalk/commit/e422cffa3b6f41364348f5cbc2cef1a10bdb2f31", "committedDate": "2020-03-10T20:44:47Z", "message": "Update copyright years"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3311, "cost": 1, "resetAt": "2021-11-01T11:59:11Z"}}}