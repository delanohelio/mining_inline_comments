{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0Mzk3ODc0MzEy", "number": 998, "reviewThreads": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wM1QwMDo0NToyMlrODuKzIw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wM1QwMDo0NjoyNlrODuKz1w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjQ5NzM4MDE5OnYy", "diffSide": "RIGHT", "path": "servicetalk-grpc-api/src/main/java/io/servicetalk/grpc/api/DefaultGrpcClientCallFactory.java", "isResolved": false, "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wM1QwMDo0NToyMlrOGABYLA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wM1QwNTowODoxMlrOGAFRIQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMjY3NTc1Ng==", "bodyText": "null value here is essentially OK from the context of this call and we generally pass through null.", "url": "https://github.com/apple/servicetalk/pull/998#discussion_r402675756", "createdAt": "2020-04-03T00:45:22Z", "author": {"login": "NiteshKant"}, "path": "servicetalk-grpc-api/src/main/java/io/servicetalk/grpc/api/DefaultGrpcClientCallFactory.java", "diffHunk": "@@ -155,7 +156,10 @@\n                 newBlockingStreamingCall(serializationProvider, requestClass, responseClass);\n         return (metadata, request) -> {\n             try (BlockingIterator<Resp> iterator = streamingClientCall.request(metadata, request).iterator()) {\n-                final Resp firstItem = iterator.next();\n+                final Resp firstItem;\n+                if (!iterator.hasNext() || (firstItem = iterator.next()) == null) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "af98928a486c937250eb418ca26f5998cfeb9ab0"}, "originalPosition": 14}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMjY3NzkyMQ==", "bodyText": "Can you clarify in which situations we expect to return a null value for a scalar blocking RPC call?", "url": "https://github.com/apple/servicetalk/pull/998#discussion_r402677921", "createdAt": "2020-04-03T00:53:25Z", "author": {"login": "Scottmitch"}, "path": "servicetalk-grpc-api/src/main/java/io/servicetalk/grpc/api/DefaultGrpcClientCallFactory.java", "diffHunk": "@@ -155,7 +156,10 @@\n                 newBlockingStreamingCall(serializationProvider, requestClass, responseClass);\n         return (metadata, request) -> {\n             try (BlockingIterator<Resp> iterator = streamingClientCall.request(metadata, request).iterator()) {\n-                final Resp firstItem = iterator.next();\n+                final Resp firstItem;\n+                if (!iterator.hasNext() || (firstItem = iterator.next()) == null) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMjY3NTc1Ng=="}, "originalCommit": {"oid": "af98928a486c937250eb418ca26f5998cfeb9ab0"}, "originalPosition": 14}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMjczOTQ4OQ==", "bodyText": "The scalar/streaming blocking/async variant is immaterial here and no we do not expect a null value but neither do we use the Resp here in a way that it can not be null.\nHypothesizing situations, streamingClientCall that is giving the BlockingIterator here is created using a StreamingHttpClient that is provided by the user of GrpcClientCallFactory API. It is nowhere we check that the payload of the response returned by the client can not be null unless we actually use it, eg: while deserializing. Deserializer here also is provided by the user. So really a user can pass null from everywhere and get back a null response and we really do not care.\nSo the point here isn't whether it is fair to make that assumption, it is really about whether there is any positive of making that assumption. Same argument as passing null through async sources, we do not care about it being null unless we use it.", "url": "https://github.com/apple/servicetalk/pull/998#discussion_r402739489", "createdAt": "2020-04-03T05:08:12Z", "author": {"login": "NiteshKant"}, "path": "servicetalk-grpc-api/src/main/java/io/servicetalk/grpc/api/DefaultGrpcClientCallFactory.java", "diffHunk": "@@ -155,7 +156,10 @@\n                 newBlockingStreamingCall(serializationProvider, requestClass, responseClass);\n         return (metadata, request) -> {\n             try (BlockingIterator<Resp> iterator = streamingClientCall.request(metadata, request).iterator()) {\n-                final Resp firstItem = iterator.next();\n+                final Resp firstItem;\n+                if (!iterator.hasNext() || (firstItem = iterator.next()) == null) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMjY3NTc1Ng=="}, "originalCommit": {"oid": "af98928a486c937250eb418ca26f5998cfeb9ab0"}, "originalPosition": 14}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjQ5NzM4MTk5OnYy", "diffSide": "RIGHT", "path": "servicetalk-grpc-api/src/main/java/io/servicetalk/grpc/api/GrpcRouter.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wM1QwMDo0NjoyNlrOGABZQA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wM1QwMDo0NjoyNlrOGABZQA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMjY3NjAzMg==", "bodyText": "Same here, we should pass through null values.", "url": "https://github.com/apple/servicetalk/pull/998#discussion_r402676032", "createdAt": "2020-04-03T00:46:26Z", "author": {"login": "NiteshKant"}, "path": "servicetalk-grpc-api/src/main/java/io/servicetalk/grpc/api/GrpcRouter.java", "diffHunk": "@@ -593,11 +593,10 @@ public void handle(final GrpcServiceContext ctx, final BlockingIterable<Req> req\n                                            final GrpcPayloadWriter<Resp> responseWriter) throws Exception {\n                             final Req firstItem;\n                             try (BlockingIterator<Req> requestIterator = request.iterator()) {\n-                                if (!requestIterator.hasNext()) {\n+                                if (!requestIterator.hasNext() || (firstItem = requestIterator.next()) == null) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "af98928a486c937250eb418ca26f5998cfeb9ab0"}, "originalPosition": 5}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2648, "cost": 1, "resetAt": "2021-11-12T09:44:50Z"}}}