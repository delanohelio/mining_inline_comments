{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDk3MDYwMTgx", "number": 1165, "title": "Support half-closure for UnixDomainSockets", "bodyText": "Motivation:\nCloseHandler.forPipelinedRequestResponse enables half-closure only for\nSocketChannelConfig. DomainSocketChannel does not use this config.\nAs the result, half-closure does not work for UnixDomainSockets.\nModifications:\n\nUse ALLOW_HALF_CLOSURE socket option to enable half-closure for the\nChannel;\nAssert in RequestResponseCloseHandler that Channel implements\nDuplexChannel and also has ALLOW_HALF_CLOSURE socket option enabled;\nEnhance ConnectionCloseHeaderHandlingTest to test the same scenarios\nfor DomainSocketAddress;\nMove newSocketAddress() utility to AddressUtils;\n\nResult:\nHalf-closure is enabled for DomainSocketChannel.", "createdAt": "2020-10-02T18:11:39Z", "url": "https://github.com/apple/servicetalk/pull/1165", "merged": true, "mergeCommit": {"oid": "d89d81459713b781cc1a41b32fae1fdb0200b966"}, "closed": true, "closedAt": "2020-10-03T01:00:36Z", "author": {"login": "idelpivnitskiy"}, "timelineItems": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdOp9DRAH2gAyNDk3MDYwMTgxOjE4MTEyZDYwYTYyNjc1MDgwNmRjZGMyNzNlNjFlZGMyZjYxOGNjY2I=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdOt9iTgFqTUwMTQ4Mjg2Ng==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "18112d60a626750806dcdc273e61edc2f618cccb", "author": {"user": {"login": "idelpivnitskiy", "name": "Idel Pivnitskiy"}}, "url": "https://github.com/apple/servicetalk/commit/18112d60a626750806dcdc273e61edc2f618cccb", "committedDate": "2020-10-02T18:04:58Z", "message": "Support half-closure for UnixDomainSockets\n\nMotivation:\n\n`CloseHandler.forPipelinedRequestResponse` enables half-closure only for\n`SocketChannelConfig`. `DomainSocketChannel` does not use this config.\nAs the result, half-closure does not work for UnixDomainSockets.\n\nModifications:\n\n- Use `ALLOW_HALF_CLOSURE` socket option to enable half-closure for the\n`Channel`;\n- Assert in `RequestResponseCloseHandler` that `Channel` implements\n`DuplexChannel` and also has `ALLOW_HALF_CLOSURE` socket option enabled;\n- Enhance `ConnectionCloseHeaderHandlingTest` to test the same scenarios\nfor `DomainSocketAddress`;\n- Move `newSocketAddress()` utility to `AddressUtils`;\n\nResult:\n\nHalf-closure is enabled for `DomainSocketChannel`."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "18fede06bf60ac2003fc2156d1debb6d18a163da", "author": {"user": {"login": "idelpivnitskiy", "name": "Idel Pivnitskiy"}}, "url": "https://github.com/apple/servicetalk/commit/18fede06bf60ac2003fc2156d1debb6d18a163da", "committedDate": "2020-10-02T19:56:54Z", "message": "Temporary disable test cases that require \"discarding inbound\" instead of \"half-close inbound\"\n\nFor more information, see https://github.com/apple/servicetalk/issues/1154\n\"half-close inbound\" is harmful for UDS, bcz it breaks the pipe"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "2ea245fec562b593518b0478b32d99caf22231d3", "author": {"user": {"login": "idelpivnitskiy", "name": "Idel Pivnitskiy"}}, "url": "https://github.com/apple/servicetalk/commit/2ea245fec562b593518b0478b32d99caf22231d3", "committedDate": "2020-10-02T21:37:45Z", "message": "Fix RequestResponseCloseHandlerTest"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "9791048b706aa23f5eb8c2d7ea72483ec78374f6", "author": {"user": {"login": "idelpivnitskiy", "name": "Idel Pivnitskiy"}}, "url": "https://github.com/apple/servicetalk/commit/9791048b706aa23f5eb8c2d7ea72483ec78374f6", "committedDate": "2020-10-02T22:42:25Z", "message": "fix spotbugs warning"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTAxNDgyODY2", "url": "https://github.com/apple/servicetalk/pull/1165#pullrequestreview-501482866", "createdAt": "2020-10-02T22:42:07Z", "commit": {"oid": "2ea245fec562b593518b0478b32d99caf22231d3"}, "state": "APPROVED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wMlQyMjo0MjowOFrOHb9UpA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wMlQyMjo0MjoyNVrOHb9U4w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5OTA3ODMwOA==", "bodyText": "can we revert this portion now that we have the @Ignore?", "url": "https://github.com/apple/servicetalk/pull/1165#discussion_r499078308", "createdAt": "2020-10-02T22:42:08Z", "author": {"login": "Scottmitch"}, "path": "servicetalk-http-netty/src/test/java/io/servicetalk/http/netty/ConnectionCloseHeaderHandlingTest.java", "diffHunk": "@@ -338,14 +359,13 @@ public void serverCloseTwoPipelinedRequestsSentBeforeFirstResponse() throws Exce\n             assertResponsePayloadBody(response);\n \n             awaitConnectionClosed();\n-            // FIXME: temporary disable check for /second until https://github.com/apple/servicetalk/pull/1141", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "2ea245fec562b593518b0478b32d99caf22231d3"}, "originalPosition": 141}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5OTA3ODM3MQ==", "bodyText": "(same comment below)", "url": "https://github.com/apple/servicetalk/pull/1165#discussion_r499078371", "createdAt": "2020-10-02T22:42:25Z", "author": {"login": "Scottmitch"}, "path": "servicetalk-http-netty/src/test/java/io/servicetalk/http/netty/ConnectionCloseHeaderHandlingTest.java", "diffHunk": "@@ -338,14 +359,13 @@ public void serverCloseTwoPipelinedRequestsSentBeforeFirstResponse() throws Exce\n             assertResponsePayloadBody(response);\n \n             awaitConnectionClosed();\n-            // FIXME: temporary disable check for /second until https://github.com/apple/servicetalk/pull/1141", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5OTA3ODMwOA=="}, "originalCommit": {"oid": "2ea245fec562b593518b0478b32d99caf22231d3"}, "originalPosition": 141}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3498, "cost": 1, "resetAt": "2021-11-01T11:59:11Z"}}}