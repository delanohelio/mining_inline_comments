{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0MzYwODc5NzUw", "number": 915, "title": "Generated gRPC interfaces should be annotated as `@FunctionalInterface`", "bodyText": "Generated gRPC RPC interfaces should be annotated as @FunctionalInterface #908\nMotivation:\nGenerated gRPC RPC interfaces should be annotated as @FunctionalInterface #908\nModifications:\n\nAdd @FunctionalInterface to generated interfaces as part of the method addServiceRpcInterfaces():\n\nResult:\nFixes #908", "createdAt": "2020-01-09T10:18:51Z", "url": "https://github.com/apple/servicetalk/pull/915", "merged": true, "mergeCommit": {"oid": "6cfd434b0dfd6f5634799cc4d85190a710700423"}, "closed": true, "closedAt": "2020-01-14T17:37:10Z", "author": {"login": "volyx"}, "timelineItems": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABb5CowEAFqTM0MTMzMTQ2Ng==", "endCursor": "Y3Vyc29yOnYyOpPPAAABb5qATCgBqjI5NDEzMzAyMDE=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzQxMzMxNDY2", "url": "https://github.com/apple/servicetalk/pull/915#pullrequestreview-341331466", "createdAt": "2020-01-10T18:05:55Z", "commit": {"oid": "bc2802d2f35daa976654b5a29316bd7f25795fa1"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0xMFQxODowNTo1NlrOFcb16A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0xMFQxODoxMjo0N1rOFccAMg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NTM2MDYxNg==", "bodyText": "This will add annotation only for the Blocking*Rpc interfaces, you should do the same in another forEach above.", "url": "https://github.com/apple/servicetalk/pull/915#discussion_r365360616", "createdAt": "2020-01-10T18:05:56Z", "author": {"login": "idelpivnitskiy"}, "path": "servicetalk-grpc-protoc/src/main/java/io/servicetalk/grpc/protoc/Generator.java", "diffHunk": "@@ -252,6 +252,7 @@ private void addServiceRpcInterfaces(final State state, final TypeSpec.Builder s\n             final FieldSpec.Builder pathSpecBuilder = FieldSpec.builder(String.class, RPC_PATH, PUBLIC, STATIC, FINAL);\n             pathSpecBuilder.initializer(\"$T.$L\", rpcInterface.className, RPC_PATH);\n             final TypeSpec.Builder interfaceSpecBuilder = interfaceBuilder(name)\n+                    .addAnnotation(FunctionalInterface.class)", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "bc2802d2f35daa976654b5a29316bd7f25795fa1"}, "originalPosition": 4}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NTM2MTUwNA==", "bodyText": "Please, prefer assertThat instead of assertNotNull and assertEquals. It produces better exception messages in case of failures.", "url": "https://github.com/apple/servicetalk/pull/915#discussion_r365361504", "createdAt": "2020-01-10T18:08:15Z", "author": {"login": "idelpivnitskiy"}, "path": "servicetalk-grpc-netty/src/test/java/io/servicetalk/grpc/protoc/GeneratorTest.java", "diffHunk": "@@ -0,0 +1,57 @@\n+/*\n+ * Copyright \u00a9 2019 Apple Inc. and the ServiceTalk project authors\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *   http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+package io.servicetalk.grpc.protoc;\n+\n+import io.servicetalk.grpc.netty.TesterProto.Tester;\n+import io.servicetalk.grpc.netty.TesterProto.Tester.RpcPaths;\n+\n+import org.junit.Test;\n+\n+import java.util.ArrayList;\n+import java.util.List;\n+\n+import static io.servicetalk.grpc.protoc.Words.Blocking;\n+import static io.servicetalk.grpc.protoc.Words.Rpc;\n+import static java.lang.Character.toUpperCase;\n+import static java.util.Arrays.stream;\n+import static java.util.stream.Collectors.toList;\n+import static org.junit.Assert.assertEquals;\n+import static org.junit.Assert.assertNotNull;\n+\n+public class GeneratorTest {\n+\n+    @Test\n+    public void testGeneratedFunctionalInterfaces() {\n+\n+        final List<String> generatedInterfaces = new ArrayList<>();\n+\n+        for (RpcPaths rpcPath : RpcPaths.values()) {\n+            final String interfaceName = toUpperCase(rpcPath.name().charAt(0)) + rpcPath.name().substring(1);\n+            generatedInterfaces.add(interfaceName + Rpc);\n+            generatedInterfaces.add(Blocking + interfaceName + Rpc);\n+        }\n+\n+        final List<Class<?>> generatedRpcInterfaces = stream(Tester.class.getDeclaredClasses())\n+                .filter(declaredClass -> generatedInterfaces.contains(declaredClass.getSimpleName()))\n+                .collect(toList());\n+\n+        assertEquals(RpcPaths.values().length * 2, generatedRpcInterfaces.size());\n+\n+        for (Class<?> declaredClass : generatedRpcInterfaces) {\n+            assertNotNull(declaredClass.getAnnotation(FunctionalInterface.class));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "bc2802d2f35daa976654b5a29316bd7f25795fa1"}, "originalPosition": 54}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NTM2MzI1MA==", "bodyText": "We do not have RpcPaths enum anymore. Looks like you used the old generated code. To regenerate it, use ./gradlew clean classes testClasses.", "url": "https://github.com/apple/servicetalk/pull/915#discussion_r365363250", "createdAt": "2020-01-10T18:12:47Z", "author": {"login": "idelpivnitskiy"}, "path": "servicetalk-grpc-netty/src/test/java/io/servicetalk/grpc/protoc/GeneratorTest.java", "diffHunk": "@@ -0,0 +1,57 @@\n+/*\n+ * Copyright \u00a9 2019 Apple Inc. and the ServiceTalk project authors\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *   http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+package io.servicetalk.grpc.protoc;\n+\n+import io.servicetalk.grpc.netty.TesterProto.Tester;\n+import io.servicetalk.grpc.netty.TesterProto.Tester.RpcPaths;\n+\n+import org.junit.Test;\n+\n+import java.util.ArrayList;\n+import java.util.List;\n+\n+import static io.servicetalk.grpc.protoc.Words.Blocking;\n+import static io.servicetalk.grpc.protoc.Words.Rpc;\n+import static java.lang.Character.toUpperCase;\n+import static java.util.Arrays.stream;\n+import static java.util.stream.Collectors.toList;\n+import static org.junit.Assert.assertEquals;\n+import static org.junit.Assert.assertNotNull;\n+\n+public class GeneratorTest {\n+\n+    @Test\n+    public void testGeneratedFunctionalInterfaces() {\n+\n+        final List<String> generatedInterfaces = new ArrayList<>();\n+\n+        for (RpcPaths rpcPath : RpcPaths.values()) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "bc2802d2f35daa976654b5a29316bd7f25795fa1"}, "originalPosition": 41}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzQxNDQ5OTMx", "url": "https://github.com/apple/servicetalk/pull/915#pullrequestreview-341449931", "createdAt": "2020-01-10T22:11:51Z", "commit": {"oid": "68170a8261b6b020f5bf20bf1507931cbac86f14"}, "state": "APPROVED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0xMFQyMjoxMTo1MVrOFchWgA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0xMFQyMjoxMTo1MVrOFchWgA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NTQ1MDg4MA==", "bodyText": "Because we want to test all 4 different API variants and we know that Tester class defines them all, I would make sure that the size of both Lists is 4.", "url": "https://github.com/apple/servicetalk/pull/915#discussion_r365450880", "createdAt": "2020-01-10T22:11:51Z", "author": {"login": "idelpivnitskiy"}, "path": "servicetalk-grpc-netty/src/test/java/io/servicetalk/grpc/protoc/GeneratorTest.java", "diffHunk": "@@ -0,0 +1,52 @@\n+/*\n+ * Copyright \u00a9 2019 Apple Inc. and the ServiceTalk project authors\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *   http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+package io.servicetalk.grpc.protoc;\n+\n+import io.servicetalk.grpc.netty.TesterProto.Tester;\n+\n+import org.junit.Test;\n+\n+import java.util.List;\n+\n+import static io.servicetalk.grpc.protoc.Words.Blocking;\n+import static io.servicetalk.grpc.protoc.Words.Rpc;\n+import static java.util.Arrays.stream;\n+import static java.util.stream.Collectors.toList;\n+import static org.hamcrest.Matchers.greaterThan;\n+import static org.hamcrest.Matchers.is;\n+import static org.junit.Assert.assertThat;\n+\n+public class GeneratorTest {\n+\n+    @Test\n+    public void testGeneratedFunctionalInterfaces() {\n+\n+        final List<Class<?>> generatedRpcInterfaces = stream(Tester.class.getDeclaredClasses())\n+                .filter(declaredClass -> declaredClass.getAnnotation(FunctionalInterface.class) != null\n+                        && !declaredClass.getSimpleName().startsWith(Blocking)\n+                        && declaredClass.getSimpleName().endsWith(Rpc))\n+                .collect(toList());\n+\n+        final List<Class<?>> generatedBlockingRpcInterfaces = stream(Tester.class.getDeclaredClasses())\n+                .filter(declaredClass -> declaredClass.getAnnotation(FunctionalInterface.class) != null\n+                        && declaredClass.getSimpleName().startsWith(Blocking)\n+                        && declaredClass.getSimpleName().endsWith(Rpc))\n+                .collect(toList());\n+\n+        assertThat(generatedRpcInterfaces.size(), greaterThan(0));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "68170a8261b6b020f5bf20bf1507931cbac86f14"}, "originalPosition": 49}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "6d8d8788184bc97452c96ca63bf39fe2d9cd3a1f", "author": {"user": {"login": "volyx", "name": "Dmitrii Volykhin"}}, "url": "https://github.com/apple/servicetalk/commit/6d8d8788184bc97452c96ca63bf39fe2d9cd3a1f", "committedDate": "2020-01-12T15:59:41Z", "message": "Generated gRPC RPC interfaces should be annotated as `@FunctionalInterface` #908\n\nMotivation:\n\nGenerated gRPC RPC interfaces should be annotated as `@FunctionalInterface` #908\n\nModifications:\n\n- add `@FunctionalInterface` to generated interfaces as part of the method addServiceRpcInterfaces()\n- add test scope dependency `servicetalk-grpc-protoc` for `servicetalk-grpc-netty`\n- add `GeneratorTest`\n\nResult:\n\nFixes #908"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "10069e8f071b1e4cc5f4f2583a3c0fbb0f6d02fb", "author": {"user": {"login": "volyx", "name": "Dmitrii Volykhin"}}, "url": "https://github.com/apple/servicetalk/commit/10069e8f071b1e4cc5f4f2583a3c0fbb0f6d02fb", "committedDate": "2020-01-11T10:25:08Z", "message": "- check interfaces amount"}, "afterCommit": {"oid": "6d8d8788184bc97452c96ca63bf39fe2d9cd3a1f", "author": {"user": {"login": "volyx", "name": "Dmitrii Volykhin"}}, "url": "https://github.com/apple/servicetalk/commit/6d8d8788184bc97452c96ca63bf39fe2d9cd3a1f", "committedDate": "2020-01-12T15:59:41Z", "message": "Generated gRPC RPC interfaces should be annotated as `@FunctionalInterface` #908\n\nMotivation:\n\nGenerated gRPC RPC interfaces should be annotated as `@FunctionalInterface` #908\n\nModifications:\n\n- add `@FunctionalInterface` to generated interfaces as part of the method addServiceRpcInterfaces()\n- add test scope dependency `servicetalk-grpc-protoc` for `servicetalk-grpc-netty`\n- add `GeneratorTest`\n\nResult:\n\nFixes #908"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3239, "cost": 1, "resetAt": "2021-11-01T11:59:11Z"}}}