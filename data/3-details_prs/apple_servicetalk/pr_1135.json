{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDcyODYwODQ4", "number": 1135, "title": "Provide a public factory for `BiTransportObserver`", "bodyText": "Motivation:\nUsers who need to report events to two TransportObservers simultaneously\non the server-side or who need their own variant of\nTransportObserverConnectionFactoryFilter will find it useful.\nModifications:\n\nMove BiTransportObserver from client-api to transport-api;\nConvert passes first and second observers into safe observers;\nAdd public TransportObservers.biTransportObserver factory;\n\nResult:\nUsers can easily report events to two TransportObservers.", "createdAt": "2020-08-25T00:55:05Z", "url": "https://github.com/apple/servicetalk/pull/1135", "merged": true, "mergeCommit": {"oid": "11f911d47a1adc496528f99553afdaf7150db941"}, "closed": true, "closedAt": "2020-08-25T21:51:59Z", "author": {"login": "idelpivnitskiy"}, "timelineItems": {"totalCount": 7, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdCMbuvAH2gAyNDcyODYwODQ4OmJjNDlmMTlmNzdkZDcwMWU3ZWFkMjA3MDY4NjNhOTYyNzU2ZDNmZjI=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdCeWSngFqTQ3NDkzNTI4OA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "bc49f19f77dd701e7ead20706863a962756d3ff2", "author": {"user": {"login": "idelpivnitskiy", "name": "Idel Pivnitskiy"}}, "url": "https://github.com/apple/servicetalk/commit/bc49f19f77dd701e7ead20706863a962756d3ff2", "committedDate": "2020-08-25T00:54:14Z", "message": "Provide a public factory for `BiTransportObserver`\n\nMotivation:\n\nUsers who need to report events to two `TransportObserver`s simultaneously\non the server side or who need their own variant of\n`TransportObserverConnectionFactoryFilter` will find it useful.\n\nModifications:\n\n- Move `BiTransportObserver` from `client-api` to `transport-api`;\n- Convert passes first and second observers into safe observers;\n- Add public `TransportObservers.biTransportObserver` factory;\n\nResult:\n\nUsers can easily report events to two `TransportObserver`s."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDc0MDIzNDY0", "url": "https://github.com/apple/servicetalk/pull/1135#pullrequestreview-474023464", "createdAt": "2020-08-25T01:00:28Z", "commit": {"oid": "bc49f19f77dd701e7ead20706863a962756d3ff2"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yNVQwMTowMDoyOFrOHF9--w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yNVQwMTowMDoyOFrOHF9--w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NjAyMDQ3NQ==", "bodyText": "For a public API, I would prefer a combine() method with a var-arg and if we want, we can optimize for 2 vs many cases.", "url": "https://github.com/apple/servicetalk/pull/1135#discussion_r476020475", "createdAt": "2020-08-25T01:00:28Z", "author": {"login": "NiteshKant"}, "path": "servicetalk-transport-api/src/main/java/io/servicetalk/transport/api/TransportObservers.java", "diffHunk": "@@ -38,4 +38,16 @@ public static TransportObserver asSafeObserver(final TransportObserver observer)\n         }\n         return new CatchAllTransportObserver(observer);\n     }\n+\n+    /**\n+     * Combines two {@link TransportObserver}s into a single {@link TransportObserver}.\n+     *\n+     * @param first the {@link TransportObserver} that will receive events first\n+     * @param second the {@link TransportObserver} that will receive events second\n+     * @return a {@link TransportObserver} that delegates all invocations to the {@code first} and {@code second}\n+     * {@link TransportObserver}s\n+     */\n+    public static TransportObserver biTransportObserver(final TransportObserver first, final TransportObserver second) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "bc49f19f77dd701e7ead20706863a962756d3ff2"}, "originalPosition": 13}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e70112b6c8e7e2c7ecf569b34a438282bc212941", "author": {"user": {"login": "idelpivnitskiy", "name": "Idel Pivnitskiy"}}, "url": "https://github.com/apple/servicetalk/commit/e70112b6c8e7e2c7ecf569b34a438282bc212941", "committedDate": "2020-08-25T02:22:36Z", "message": "Support multiple `TransportObserver`s"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDc0NjUyMjA4", "url": "https://github.com/apple/servicetalk/pull/1135#pullrequestreview-474652208", "createdAt": "2020-08-25T16:28:53Z", "commit": {"oid": "e70112b6c8e7e2c7ecf569b34a438282bc212941"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yNVQxNjoyODo1NFrOHGgIDw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yNVQxNjoyODo1NFrOHGgIDw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NjU3OTg1NQ==", "bodyText": "Why not just have combine(final TransportObserver... observers) ?\nAlso, may be modify the BiTransportObserver to accept an array instead of two observers.", "url": "https://github.com/apple/servicetalk/pull/1135#discussion_r476579855", "createdAt": "2020-08-25T16:28:54Z", "author": {"login": "NiteshKant"}, "path": "servicetalk-transport-api/src/main/java/io/servicetalk/transport/api/TransportObservers.java", "diffHunk": "@@ -36,18 +36,27 @@ public static TransportObserver asSafeObserver(final TransportObserver observer)\n         if (observer instanceof CatchAllTransportObserver) {\n             return observer;\n         }\n+        if (observer instanceof BiTransportObserver) {\n+            // BiTransportObserver is always safe\n+            return observer;\n+        }\n         return new CatchAllTransportObserver(observer);\n     }\n \n     /**\n-     * Combines two {@link TransportObserver}s into a single {@link TransportObserver}.\n+     * Combines multiple {@link TransportObserver}s into a single {@link TransportObserver}.\n      *\n      * @param first the {@link TransportObserver} that will receive events first\n      * @param second the {@link TransportObserver} that will receive events second\n-     * @return a {@link TransportObserver} that delegates all invocations to the {@code first} and {@code second}\n-     * {@link TransportObserver}s\n+     * @param others additional {@link TransportObserver}s that will receive events\n+     * @return a {@link TransportObserver} that delegates all invocations to the provided {@link TransportObserver}s\n      */\n-    public static TransportObserver biTransportObserver(final TransportObserver first, final TransportObserver second) {\n-        return new BiTransportObserver(first, second);\n+    public static TransportObserver combine(final TransportObserver first, final TransportObserver second,", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e70112b6c8e7e2c7ecf569b34a438282bc212941"}, "originalPosition": 24}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "98d29d5a0bcdd581e946e19be7360b19b318a292", "author": {"user": {"login": "idelpivnitskiy", "name": "Idel Pivnitskiy"}}, "url": "https://github.com/apple/servicetalk/commit/98d29d5a0bcdd581e946e19be7360b19b318a292", "committedDate": "2020-08-25T21:24:46Z", "message": "use varargs only"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDc0OTI2MzY5", "url": "https://github.com/apple/servicetalk/pull/1135#pullrequestreview-474926369", "createdAt": "2020-08-25T21:28:49Z", "commit": {"oid": "98d29d5a0bcdd581e946e19be7360b19b318a292"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yNVQyMToyODo1MFrOHGqqpQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yNVQyMToyODo1MFrOHGqqpQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3Njc1MjU0OQ==", "bodyText": "This is what I was trying to avoid by having first, second, others arguments: http://jtechies.blogspot.com/2012/07/item-42-use-varargs-judiciously.html", "url": "https://github.com/apple/servicetalk/pull/1135#discussion_r476752549", "createdAt": "2020-08-25T21:28:50Z", "author": {"login": "idelpivnitskiy"}, "path": "servicetalk-transport-api/src/main/java/io/servicetalk/transport/api/TransportObservers.java", "diffHunk": "@@ -36,6 +38,31 @@ public static TransportObserver asSafeObserver(final TransportObserver observer)\n         if (observer instanceof CatchAllTransportObserver) {\n             return observer;\n         }\n+        if (observer instanceof BiTransportObserver) {\n+            // BiTransportObserver is always safe\n+            return observer;\n+        }\n         return new CatchAllTransportObserver(observer);\n     }\n+\n+    /**\n+     * Combines multiple {@link TransportObserver}s into a single {@link TransportObserver}.\n+     *\n+     * @param other {@link TransportObserver}s to combine\n+     * @return a {@link TransportObserver} that delegates all invocations to the provided {@link TransportObserver}s\n+     */\n+    public static TransportObserver combine(final TransportObserver... other) {\n+        switch (other.length) {\n+            case 0:\n+                throw new IllegalArgumentException(\"At least one TransportObserver is required to combine\");", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "98d29d5a0bcdd581e946e19be7360b19b318a292"}, "originalPosition": 29}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDc0OTM1Mjg4", "url": "https://github.com/apple/servicetalk/pull/1135#pullrequestreview-474935288", "createdAt": "2020-08-25T21:45:06Z", "commit": {"oid": "98d29d5a0bcdd581e946e19be7360b19b318a292"}, "state": "APPROVED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yNVQyMTo0NTowNlrOHGrhRg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yNVQyMTo0NTowNlrOHGrhRg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3Njc2NjUzNA==", "bodyText": "I think this is OK and inline with what we do elsewhere:\nhttps://github.com/apple/servicetalk/blob/main/servicetalk-concurrent-api/src/main/java/io/servicetalk/concurrent/api/MergeCompletable.java#L41", "url": "https://github.com/apple/servicetalk/pull/1135#discussion_r476766534", "createdAt": "2020-08-25T21:45:06Z", "author": {"login": "NiteshKant"}, "path": "servicetalk-transport-api/src/main/java/io/servicetalk/transport/api/TransportObservers.java", "diffHunk": "@@ -36,6 +38,31 @@ public static TransportObserver asSafeObserver(final TransportObserver observer)\n         if (observer instanceof CatchAllTransportObserver) {\n             return observer;\n         }\n+        if (observer instanceof BiTransportObserver) {\n+            // BiTransportObserver is always safe\n+            return observer;\n+        }\n         return new CatchAllTransportObserver(observer);\n     }\n+\n+    /**\n+     * Combines multiple {@link TransportObserver}s into a single {@link TransportObserver}.\n+     *\n+     * @param other {@link TransportObserver}s to combine\n+     * @return a {@link TransportObserver} that delegates all invocations to the provided {@link TransportObserver}s\n+     */\n+    public static TransportObserver combine(final TransportObserver... other) {\n+        switch (other.length) {\n+            case 0:\n+                throw new IllegalArgumentException(\"At least one TransportObserver is required to combine\");", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3Njc1MjU0OQ=="}, "originalCommit": {"oid": "98d29d5a0bcdd581e946e19be7360b19b318a292"}, "originalPosition": 29}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3467, "cost": 1, "resetAt": "2021-11-01T11:59:11Z"}}}