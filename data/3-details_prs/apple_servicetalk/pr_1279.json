{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTM5MDI1OTc0", "number": 1279, "title": "Github Actions, use pull_request and workflow_run instead of pull_request_target", "bodyText": "Motivation:\npull_request_target will run against the commit where a PR is branched\noff of. This may result in errors not being detected until after the\nchange is merged (e.g. checkstyle, etc.).\nModifications:\n\nInstead use the pull_request event to build pull requests, and publish\nthe artifacts which need post analysis (test results, checkstyle, etc.).\nA workflow_run job can run with the permissions of the original repo and\npost annotations to PRs indicating any issues with the build. This\nseparation is done for security reasons to prevent forks from getting\naccess to credentials/secrets.\n\nResult:\nPull requests build/analysis is done on the code in the pull request,\ninstead of from the target branch.", "createdAt": "2020-12-13T21:42:19Z", "url": "https://github.com/apple/servicetalk/pull/1279", "merged": true, "mergeCommit": {"oid": "50da2127162b39997684a037454bab3a323e5eb6"}, "closed": true, "closedAt": "2020-12-14T21:05:37Z", "author": {"login": "Scottmitch"}, "timelineItems": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdlhpF3gH2gAyNTM5MDI1OTc0OjBkMjVmZDI3M2Y2MTRiZWI5NGM0Y2VjZWZlZWEwNGRmYThhZTZiNmQ=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdmMQqUgFqTU1MTg5MDUwOQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "0d25fd273f614beb94c4cecefeea04dfa8ae6b6d", "author": {"user": {"login": "Scottmitch", "name": "Scott Mitchell"}}, "url": "https://github.com/apple/servicetalk/commit/0d25fd273f614beb94c4cecefeea04dfa8ae6b6d", "committedDate": "2020-12-12T19:24:11Z", "message": "Github Actions, use pull_request and workflow_run instead of pull_request_target\n\nMotivation:\npull_request_target will run against the commit where a PR is branched\noff of. This may result in errors not being detected until after the\nchange is merged (e.g. checkstyle, etc.).\n\nModifications:\n- Instead use the pull_request event to build pull requests, and publish\nthe artifacts which need post analysis (test results, checkstyle, etc.).\nA workflow_run job can run with the permissions of the original repo and\npost annotations to PRs indicating any issues with the build. This\nseparation is done for security reasons to prevent forks from getting\naccess to credentials/secrets.\n\nResult:\nPull requests build/analysis is done on the code in the pull request,\ninstead of from the target branch."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTUxODkwNTA5", "url": "https://github.com/apple/servicetalk/pull/1279#pullrequestreview-551890509", "createdAt": "2020-12-14T21:03:25Z", "commit": {"oid": "0d25fd273f614beb94c4cecefeea04dfa8ae6b6d"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xNFQyMTowMzoyNVrOIFo20g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xNFQyMTowMzoyNVrOIFo20g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0Mjc4MzE4Ng==", "bodyText": "note we will not get the quality reports or GitHub annotations until the Github Actions resolve these issues.", "url": "https://github.com/apple/servicetalk/pull/1279#discussion_r542783186", "createdAt": "2020-12-14T21:03:25Z", "author": {"login": "Scottmitch"}, "path": ".github/workflows/ci-prq-reports.yml", "diffHunk": "@@ -0,0 +1,76 @@\n+name: PR Quality Reports\n+on:\n+  workflow_run:\n+    workflows: [ \"PR Quality\" ]\n+    types:\n+      - completed\n+jobs:\n+  checkstyle:\n+    runs-on: ubuntu-latest\n+    strategy:\n+      matrix:\n+        java: [ 8, 11 ]\n+    steps:\n+      - name: Download Artifacts\n+        # v2.10.0\n+        uses: dawidd6/action-download-artifact@5b72739630efa11b8d81784b89adf5246a5fc475\n+        with:\n+          github_token: ${{ secrets.GITHUB_TOKEN }}\n+          workflow: ${{ github.event.workflow_run.workflow_id }}\n+          commit: ${{ github.event.workflow_run.head_commit.id }}\n+          name: checkstyle-results-${{ matrix.java }}\n+      - name: Publish Checkstyle Report\n+        # v1.2\n+        uses: jwgmeligmeyling/checkstyle-github-action@50292990e18466f2c5d95d04ff5fab931254fa5f\n+        with:\n+          name: Checkstyle Report JDK ${{ matrix.java }}\n+          path: '**/build/reports/checkstyle/*.xml'\n+          token: ${{ secrets.GITHUB_TOKEN }}\n+          # TODO https://github.com/jwgmeligmeyling/checkstyle-github-action/issues/6", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "0d25fd273f614beb94c4cecefeea04dfa8ae6b6d"}, "originalPosition": 29}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3386, "cost": 1, "resetAt": "2021-11-01T11:59:11Z"}}}