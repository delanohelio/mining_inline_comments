{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDY2OTA0NDU1", "number": 1124, "title": "Propagate ConnectionObserver without channel attribute", "bodyText": "Motivation:\nUsage of Channel's attributes increase a shared state of the Channel.\nConnectionObserver can be propagated without using it.\nModifications:\n\nReport onNewConnection() inside connectionFactory functions;\nRename TransportObserverInitializer -> ConnectionObserverInitializer;\nPass the created ConnectionObserver to the first and last netty handlers;\nUse ChannelCloseUtils to register a reason exception for Channel closure;\nImprove tests related to stream and connection closure;\n\nResult:\nLess state on the Channel instance, better handling of the Channel close reason.", "createdAt": "2020-08-12T17:19:08Z", "url": "https://github.com/apple/servicetalk/pull/1124", "merged": true, "mergeCommit": {"oid": "e94eb6af2fbd8ea0fe01cc51c1803dc6cf855726"}, "closed": true, "closedAt": "2020-08-17T22:26:29Z", "author": {"login": "idelpivnitskiy"}, "timelineItems": {"totalCount": 9, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABc-BN2OgH2gAyNDY2OTA0NDU1OmFhNzkxMmY5MDM2NGJmNTMxYTFjZDhiNTk4MDk0N2Q4MmY4Mjg0ZmY=", "endCursor": "Y3Vyc29yOnYyOpPPAAABc_5oPNgH2gAyNDY2OTA0NDU1OmIxNmI5Yzg2NWRjMjZjYjNjZjRhMmZlZGQwZDVhMDY3ZmRiODAxNDQ=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "aa7912f90364bf531a1cd8b5980947d82f8284ff", "author": {"user": {"login": "idelpivnitskiy", "name": "Idel Pivnitskiy"}}, "url": "https://github.com/apple/servicetalk/commit/aa7912f90364bf531a1cd8b5980947d82f8284ff", "committedDate": "2020-08-12T01:34:25Z", "message": "Reduce usage of `Channel` attributes\n\nMotivation:\n\nUsage of `Channel`'s attributes increase a shared state of the `Channel`.\n\nModifications:\n\n- Introduce `ObservabilityProvider` to share observers between different\nlayers instead of using `Channel` attributes;\n- Eliminate usage of `CONNECTION_OBSERVER` attribute;\n- Eliminate usage of `SECURITY_HANDSHAKE_OBSERVER` attribute;\n- Use `ChannelCloseUtils` to register a reason exception for `Channel` closure;\n- Improve tests related to stream and connection closure;\n\nResult:\n\nLess state on the `Channel` instance, better handling of the close reason."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "1598de173abdadbe4c8955edb6635def81e82c63", "author": {"user": {"login": "idelpivnitskiy", "name": "Idel Pivnitskiy"}}, "url": "https://github.com/apple/servicetalk/commit/1598de173abdadbe4c8955edb6635def81e82c63", "committedDate": "2020-08-12T17:34:24Z", "message": "fix quality warnings"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDY2MzUyODEx", "url": "https://github.com/apple/servicetalk/pull/1124#pullrequestreview-466352811", "createdAt": "2020-08-12T23:58:00Z", "commit": {"oid": "1598de173abdadbe4c8955edb6635def81e82c63"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xMlQyMzo1ODowMFrOG_20YA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xMlQyMzo1ODowMFrOG_20YA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2OTYxMTYxNg==", "bodyText": "I do not quite understand the reasoning behind this class. connectionObserver and handshakeObserver references are temporary, i.e. they can only be retrieved once which makes the contract very error prone and not very different than the connection attribute approach. My hope was that we can be explicit in contract while passing these objects between classes, can we try doing that?", "url": "https://github.com/apple/servicetalk/pull/1124#discussion_r469611616", "createdAt": "2020-08-12T23:58:00Z", "author": {"login": "NiteshKant"}, "path": "servicetalk-transport-netty-internal/src/main/java/io/servicetalk/transport/netty/internal/ObservabilityProvider.java", "diffHunk": "@@ -0,0 +1,79 @@\n+/*\n+ * Copyright \u00a9 2020 Apple Inc. and the ServiceTalk project authors\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *   http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+package io.servicetalk.transport.netty.internal;\n+\n+import io.servicetalk.transport.api.ConnectionObserver;\n+import io.servicetalk.transport.api.ConnectionObserver.SecurityHandshakeObserver;\n+import io.servicetalk.transport.api.TransportObserver;\n+\n+import javax.annotation.Nullable;\n+\n+/**\n+ * A helper class which allows sharing observers between different layers and handlers.\n+ */\n+public final class ObservabilityProvider {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "1598de173abdadbe4c8955edb6635def81e82c63"}, "originalPosition": 27}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a09ec7c0578b33d118f12f211c27ed5a05d5a52d", "author": {"user": {"login": "idelpivnitskiy", "name": "Idel Pivnitskiy"}}, "url": "https://github.com/apple/servicetalk/commit/a09ec7c0578b33d118f12f211c27ed5a05d5a52d", "committedDate": "2020-08-15T01:35:14Z", "message": "Kill `ObservabilityProvider`"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "48749b31f51d38257a8fa5cdd371c37f85e2f6b8", "author": {"user": {"login": "idelpivnitskiy", "name": "Idel Pivnitskiy"}}, "url": "https://github.com/apple/servicetalk/commit/48749b31f51d38257a8fa5cdd371c37f85e2f6b8", "committedDate": "2020-08-15T01:47:12Z", "message": "Rename `TransportObserverInitializer` -> `ConnectionObserverInitializer`"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a58cf1c8badc4ae2a3f5ec44dd73fe06baa4291e", "author": {"user": {"login": "idelpivnitskiy", "name": "Idel Pivnitskiy"}}, "url": "https://github.com/apple/servicetalk/commit/a58cf1c8badc4ae2a3f5ec44dd73fe06baa4291e", "committedDate": "2020-08-15T03:45:59Z", "message": "Convert to safe observer"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDY4ODIyMzY3", "url": "https://github.com/apple/servicetalk/pull/1124#pullrequestreview-468822367", "createdAt": "2020-08-17T20:48:52Z", "commit": {"oid": "a58cf1c8badc4ae2a3f5ec44dd73fe06baa4291e"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "7c0f1fb42130d15ef0d7944c5cbbbd008461360e", "author": {"user": {"login": "idelpivnitskiy", "name": "Idel Pivnitskiy"}}, "url": "https://github.com/apple/servicetalk/commit/7c0f1fb42130d15ef0d7944c5cbbbd008461360e", "committedDate": "2020-08-17T21:36:51Z", "message": "Improve verify ordering for echoRequestResponse to avoid flaky behavior"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b16b9c865dc26cb3cf4a2fedd0d5a067fdb80144", "author": {"user": {"login": "idelpivnitskiy", "name": "Idel Pivnitskiy"}}, "url": "https://github.com/apple/servicetalk/commit/b16b9c865dc26cb3cf4a2fedd0d5a067fdb80144", "committedDate": "2020-08-17T21:51:51Z", "message": "Fix DeferSslHandler"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3449, "cost": 1, "resetAt": "2021-11-01T11:59:11Z"}}}