{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0Mzg3Njk0Mzk5", "number": 1953, "title": "Improve resolution of elevation profiles with 3D Douglas Peucker and long edge sampling", "bodyText": "Improve the resolution of elevation profiles by:\n\nsampling points along long edges so we don't miss elevation changes over that segment\nmaking Douglas Peucker polyline simplification elevation-aware so it keeps points that only impact the elevation profile and not the 2D shape\n\nThese options have the potential to increase geometry size, so I added 2 configuration options to control them:\n\ngraph.elevation.long_edge_sampling_distance which defines the distance in meters that it will sample points along long edges, for example you might set this to somewhere around 30m if your elevation provider has 30m resolution. It defaults to 0 which disables long edge sampling.\ngraph.elevation.way_point_max_distance which defines the elevation tolerance during polyline simplification, for example with a 1m lat/lon and elevation tolerance removes points that result in a <1m shift of the 3D polyline. It defaults to Double.MAX_VALUE which disables elevation-influenced simplification.\n\nEdge Geometry Size Increase\nI ran this code on north-america_us_pennsylvania.pbf with CGIAR and bilinear interpolation with different values of those parameters and saw these edge geometry size increases over what's on master now:\n\n\n\nsampling distance \u27a1\ufe0f elevation max distance \u2b07\ufe0f\u00a0\n15m\n30m\n45m\n60m\n100m\n500m\noff (\u221e)\n\n\n\n\n1m\n19%\n17%\n17%\n15%\n11%\n6%\n6%\n\n\n1.5m\n11%\n11%\n9%\n9%\n6%\n2%\n2%\n\n\n2m\n6%\n6%\n6%\n6%\n4%\n2%\n2%\n\n\n3m\n2%\n2%\n2%\n2%\n2%\n0%\n0%\n\n\n4m\n2%\n2%\n2%\n2%\n0%\n0%\n0%\n\n\n5m\n0%\n0%\n0%\n0%\n0%\n0%\n0%\n\n\n10m\n0%\n0%\n0%\n0%\n0%\n0%\n0%\n\n\n50m\n0%\n0%\n0%\n0%\n0%\n0%\n0%\n\n\noff (\u221e)\n0%\n0%\n0%\n0%\n0%\n0%\n0%\n\n\n\nI ran the same test with mapzen/skadi provider from #1929. Results were similar, but the increase was slightly larger (26% instead of 19% for 15m/1m) probably because of the higher resolution of the underlying data.\nImport time performance\nI observed the \"pass2\" time during import. There was no change for different values of the elevation factor, but shorter long edge sampling distances did increase that time by 25% for 15m, 9% for 30m, 8% for 45m, and <2% for longer distances. Last time I imported the world pass2 took 110 minutes, so even a 25% increase is only about a 28 minute increase which seems negligible to me.\nExamples\nThis 2km straight segment loses all elevation details on master\n\nbut with 30m edge sampling and 1m elevation resolution we get that elevation detail back:\n\nLet me know if there are other examples or different values of the 2 parameters you want to see.\nSee further discussion here", "createdAt": "2020-03-13T10:10:57Z", "url": "https://github.com/graphhopper/graphhopper/pull/1953", "merged": true, "mergeCommit": {"oid": "699043fd9ba1bce309ebd175fe5c25e63bbc1d58"}, "closed": true, "closedAt": "2020-06-11T10:53:20Z", "author": {"login": "msbarry"}, "timelineItems": {"totalCount": 77, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcI67SuAH2gAyMzg3Njk0Mzk5OmQ1YmY1ZGEzYWQ5MTQyMzIzZDJiMTliZjg5ZGI0Nzk5NGZmOTc4ZDM=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcqLcDfAH2gAyMzg3Njk0Mzk5OjlhMmEwNjc5MTQzYzgyMmM1MWIwNmY3ZmRjYTljZTQyOThiMDMwMmU=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "d5bf5da3ad9142323d2b19bf89db47994ff978d3", "author": {"user": {"login": "msbarry", "name": "Michael Barry"}}, "url": "https://github.com/graphhopper/graphhopper/commit/d5bf5da3ad9142323d2b19bf89db47994ff978d3", "committedDate": "2020-02-29T02:16:44Z", "message": "replace calcMean with bilinear interpolate"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "0942ee78f1cd8ee2694c9a69474df76ea6436552", "author": {"user": {"login": "msbarry", "name": "Michael Barry"}}, "url": "https://github.com/graphhopper/graphhopper/commit/0942ee78f1cd8ee2694c9a69474df76ea6436552", "committedDate": "2020-02-29T02:42:02Z", "message": "fix"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "106f3b83174276fda64d9741d5dedf2f9b2c7da1", "author": {"user": {"login": "msbarry", "name": "Michael Barry"}}, "url": "https://github.com/graphhopper/graphhopper/commit/106f3b83174276fda64d9741d5dedf2f9b2c7da1", "committedDate": "2020-03-03T01:48:12Z", "message": "refactor all distance calculations to be elevation-aware"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "9391008ac157effdb25bc4f880f14e161633d085", "author": {"user": {"login": "msbarry", "name": "Michael Barry"}}, "url": "https://github.com/graphhopper/graphhopper/commit/9391008ac157effdb25bc4f880f14e161633d085", "committedDate": "2020-03-03T10:46:10Z", "message": "some edge case handling and remove DistanceCalc2D"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ed2eb1898a96194ce8890526e6520697bdb95c5f", "author": {"user": {"login": "msbarry", "name": "Michael Barry"}}, "url": "https://github.com/graphhopper/graphhopper/commit/ed2eb1898a96194ce8890526e6520697bdb95c5f", "committedDate": "2020-03-04T01:32:50Z", "message": "throw error on graph.elevation.calcmean"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "2e88b5dc77baaa4ee613aecdc8f45deb9828bbdc", "author": {"user": {"login": "msbarry", "name": "Michael Barry"}}, "url": "https://github.com/graphhopper/graphhopper/commit/2e88b5dc77baaa4ee613aecdc8f45deb9828bbdc", "committedDate": "2020-03-05T01:16:58Z", "message": "tighten range check"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "731220a7f12d2fbc2ce24165104e0658c419705c", "author": {"user": {"login": "msbarry", "name": "Michael Barry"}}, "url": "https://github.com/graphhopper/graphhopper/commit/731220a7f12d2fbc2ce24165104e0658c419705c", "committedDate": "2020-03-05T01:33:20Z", "message": "Merge branch 'master' into 3d-distance-utilities"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "959c1b3608a82335ea7c55b92beb5f259a58cc02", "author": {"user": {"login": "msbarry", "name": "Michael Barry"}}, "url": "https://github.com/graphhopper/graphhopper/commit/959c1b3608a82335ea7c55b92beb5f259a58cc02", "committedDate": "2020-03-05T01:34:03Z", "message": "Merge branch 'master' into bilinear-interpolation"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "25c3d9bcec3347625f72026cc9d8f1c1103c985a", "author": {"user": {"login": "msbarry", "name": "Michael Barry"}}, "url": "https://github.com/graphhopper/graphhopper/commit/25c3d9bcec3347625f72026cc9d8f1c1103c985a", "committedDate": "2020-03-06T13:51:49Z", "message": "change config parameter to 'graph.elevation.interpolate: bilinear'"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "abccb415e874155049ab0023ef4464dd7b29ffc7", "author": {"user": {"login": "msbarry", "name": "Michael Barry"}}, "url": "https://github.com/graphhopper/graphhopper/commit/abccb415e874155049ab0023ef4464dd7b29ffc7", "committedDate": "2020-03-10T12:48:41Z", "message": "Merge branch 'master' into 3d-distance-utilities"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "de000185907628819d96660f6ea54cc471d78200", "author": {"user": {"login": "msbarry", "name": "Michael Barry"}}, "url": "https://github.com/graphhopper/graphhopper/commit/de000185907628819d96660f6ea54cc471d78200", "committedDate": "2020-03-10T12:49:39Z", "message": "Merge branch 'master' into bilinear-interpolation"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "78a4a3669854a0d1594791e34fbda86976281689", "author": {"user": {"login": "msbarry", "name": "Michael Barry"}}, "url": "https://github.com/graphhopper/graphhopper/commit/78a4a3669854a0d1594791e34fbda86976281689", "committedDate": "2020-03-10T23:48:52Z", "message": "Merge branch 'master' into 3d-distance-utilities"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "40120050b7ba8022c0e329131e785d6ad6f3c425", "author": {"user": {"login": "msbarry", "name": "Michael Barry"}}, "url": "https://github.com/graphhopper/graphhopper/commit/40120050b7ba8022c0e329131e785d6ad6f3c425", "committedDate": "2020-03-10T23:50:29Z", "message": "rm extra change"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "727181e8e0ff5c7a1dce8729f9b58a77390d66fc", "author": {"user": {"login": "msbarry", "name": "Michael Barry"}}, "url": "https://github.com/graphhopper/graphhopper/commit/727181e8e0ff5c7a1dce8729f9b58a77390d66fc", "committedDate": "2020-03-10T23:58:27Z", "message": "Merge branch 'master' into bilinear-interpolation"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "5cb26d5e0ac5e5bed070097d2e0835a406b24950", "author": {"user": {"login": "msbarry", "name": "Michael Barry"}}, "url": "https://github.com/graphhopper/graphhopper/commit/5cb26d5e0ac5e5bed070097d2e0835a406b24950", "committedDate": "2020-03-10T23:59:03Z", "message": "Revert \"change config parameter to 'graph.elevation.interpolate: bilinear'\"\n\nThis reverts commit 25c3d9bcec3347625f72026cc9d8f1c1103c985a."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "cdb12065af89ba0d419814f43e7cce780628909b", "author": {"user": {"login": "msbarry", "name": "Michael Barry"}}, "url": "https://github.com/graphhopper/graphhopper/commit/cdb12065af89ba0d419814f43e7cce780628909b", "committedDate": "2020-03-11T00:03:08Z", "message": "handle graph.elevation.interpolate=bilinear"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c39bc5eb923018ccf10f8b8ef0c5900c286a71d5", "author": {"user": {"login": "msbarry", "name": "Michael Barry"}}, "url": "https://github.com/graphhopper/graphhopper/commit/c39bc5eb923018ccf10f8b8ef0c5900c286a71d5", "committedDate": "2020-03-11T10:16:31Z", "message": "edge sampling and 3d polyline simplification"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "9562b8e8ddac0efd699b363d296c9c83719b173a", "author": {"user": {"login": "msbarry", "name": "Michael Barry"}}, "url": "https://github.com/graphhopper/graphhopper/commit/9562b8e8ddac0efd699b363d296c9c83719b173a", "committedDate": "2020-03-12T00:25:18Z", "message": "add integration test"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "43f6623ba0e39daa8c7495a6c280dca6407ec8c9", "author": {"user": {"login": "msbarry", "name": "Michael Barry"}}, "url": "https://github.com/graphhopper/graphhopper/commit/43f6623ba0e39daa8c7495a6c280dca6407ec8c9", "committedDate": "2020-03-12T00:25:22Z", "message": "Merge branch 'bilinear-interpolation' into sample-and-3d-simplify"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ae2c0ea2bbc90484357f0769768cf605883aa6e6", "author": {"user": {"login": "msbarry", "name": "Michael Barry"}}, "url": "https://github.com/graphhopper/graphhopper/commit/ae2c0ea2bbc90484357f0769768cf605883aa6e6", "committedDate": "2020-03-12T00:34:15Z", "message": "integration test"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f27a6743c49ddaac52e32d5fb71827a87a4bf3c8", "author": {"user": {"login": "msbarry", "name": "Michael Barry"}}, "url": "https://github.com/graphhopper/graphhopper/commit/f27a6743c49ddaac52e32d5fb71827a87a4bf3c8", "committedDate": "2020-03-13T00:15:47Z", "message": "Merge branch 'master' into sample-and-3d-simplify"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "42a7346e98e0c8c02f1f01225e25fe035c432b75", "author": {"user": {"login": "msbarry", "name": "Michael Barry"}}, "url": "https://github.com/graphhopper/graphhopper/commit/42a7346e98e0c8c02f1f01225e25fe035c432b75", "committedDate": "2020-03-13T00:21:58Z", "message": "todo"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a89a062fcca795e0e65e31c8bf53a37c793c8210", "author": {"user": {"login": "msbarry", "name": "Michael Barry"}}, "url": "https://github.com/graphhopper/graphhopper/commit/a89a062fcca795e0e65e31c8bf53a37c793c8210", "committedDate": "2020-03-13T09:30:22Z", "message": "simplify IT"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f53e5275bb7ef1fb148a99dc3664f83b740a9e5a", "author": {"user": {"login": "msbarry", "name": "Michael Barry"}}, "url": "https://github.com/graphhopper/graphhopper/commit/f53e5275bb7ef1fb148a99dc3664f83b740a9e5a", "committedDate": "2020-03-13T09:32:14Z", "message": "license"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzc0MTkyNzg4", "url": "https://github.com/graphhopper/graphhopper/pull/1953#pullrequestreview-374192788", "createdAt": "2020-03-13T10:28:14Z", "commit": {"oid": "f53e5275bb7ef1fb148a99dc3664f83b740a9e5a"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xM1QxMDoyODoxNFrOF1-pew==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xM1QxMDoyODoxNFrOF1-pew==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MjE0NTI3NQ==", "bodyText": "Do we think that this assumption and approximation are fine? Or should we use a more exact calculation to interpolate between points.", "url": "https://github.com/graphhopper/graphhopper/pull/1953#discussion_r392145275", "createdAt": "2020-03-13T10:28:14Z", "author": {"login": "msbarry"}, "path": "core/src/main/java/com/graphhopper/reader/dem/EdgeSampling.java", "diffHunk": "@@ -0,0 +1,72 @@\n+/*\n+ *  Licensed to GraphHopper GmbH under one or more contributor\n+ *  license agreements. See the NOTICE file distributed with this work for\n+ *  additional information regarding copyright ownership.\n+ *\n+ *  GraphHopper GmbH licenses this file to you under the Apache License,\n+ *  Version 2.0 (the \"License\"); you may not use this file except in\n+ *  compliance with the License. You may obtain a copy of the License at\n+ *\n+ *       http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ *  Unless required by applicable law or agreed to in writing, software\n+ *  distributed under the License is distributed on an \"AS IS\" BASIS,\n+ *  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ *  See the License for the specific language governing permissions and\n+ *  limitations under the License.\n+ */\n+package com.graphhopper.reader.dem;\n+\n+import com.graphhopper.util.DistanceCalc;\n+import com.graphhopper.util.DistanceCalcEarth;\n+import com.graphhopper.util.PointList;\n+import org.slf4j.Logger;\n+import org.slf4j.LoggerFactory;\n+\n+/**\n+ * Ensures that elevation is sampled along a point list with no more than maxDistance between samples. Works by adding\n+ * points along long edges and fetching elevation at each inserted point.\n+ *\n+ * This uses a simple linear approximation to interpolate between points which should be fine for short distances, but\n+ * if support for longer distances is needed or to handle segments crossing the international date line, should use a\n+ * more robust algorithm that interpolates along the great circle path between points.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f53e5275bb7ef1fb148a99dc3664f83b740a9e5a"}, "originalPosition": 32}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzc0MTkzODQz", "url": "https://github.com/graphhopper/graphhopper/pull/1953#pullrequestreview-374193843", "createdAt": "2020-03-13T10:29:52Z", "commit": {"oid": "f53e5275bb7ef1fb148a99dc3664f83b740a9e5a"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xM1QxMDoyOTo1M1rOF1-smA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xM1QxMDoyOTo1M1rOF1-smA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MjE0NjA3Mg==", "bodyText": "Do we want to stay with this unit and name for the elevation factor param? I had thought about making it either elevation max dist (with unit meters) or just inverse of what this is now.", "url": "https://github.com/graphhopper/graphhopper/pull/1953#discussion_r392146072", "createdAt": "2020-03-13T10:29:53Z", "author": {"login": "msbarry"}, "path": "core/src/main/java/com/graphhopper/util/DouglasPeucker.java", "diffHunk": "@@ -53,6 +56,17 @@ public DouglasPeucker setMaxDistance(double dist) {\n         return this;\n     }\n \n+    /**\n+     * Weight to give elevation changes during simplification:\n+     * 0 means elevation is ignored during simplification\n+     * 0.2 means that 5 meters of elevation change is treated like\n+     * 1m of lat/lon change\n+     */\n+    public DouglasPeucker setElevationFactor(double factor) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f53e5275bb7ef1fb148a99dc3664f83b740a9e5a"}, "originalPosition": 27}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzc0MTk2MTAz", "url": "https://github.com/graphhopper/graphhopper/pull/1953#pullrequestreview-374196103", "createdAt": "2020-03-13T10:33:29Z", "commit": {"oid": "f53e5275bb7ef1fb148a99dc3664f83b740a9e5a"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xM1QxMDozMzoyOVrOF1-ziA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xM1QxMDozMzoyOVrOF1-ziA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MjE0Nzg0OA==", "bodyText": "Without bilinear interpolation, the output can look pretty bad because it enhances the resolution on blockiness. Do we want to warn when long edge sampling is used without bilinear interpolation?\nFor example with SRTM and no bilinear interpolation:", "url": "https://github.com/graphhopper/graphhopper/pull/1953#discussion_r392147848", "createdAt": "2020-03-13T10:33:29Z", "author": {"login": "msbarry"}, "path": "core/src/main/java/com/graphhopper/GraphHopper.java", "diffHunk": "@@ -542,6 +560,8 @@ public GraphHopper init(GraphHopperConfig ghConfig) {\n \n         // elevation\n         this.smoothElevation = ghConfig.getBool(\"graph.elevation.smoothing\", false);\n+        this.longEdgeSamplingDistance = ghConfig.getDouble(\"graph.elevation.long_edge_sampling_distance\", 0);\n+        this.elevationSimplifyFactor = ghConfig.getDouble(\"graph.elevation.simplify_factor\", 0);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f53e5275bb7ef1fb148a99dc3664f83b740a9e5a"}, "originalPosition": 37}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzc0MTk2NTE5", "url": "https://github.com/graphhopper/graphhopper/pull/1953#pullrequestreview-374196519", "createdAt": "2020-03-13T10:34:06Z", "commit": {"oid": "f53e5275bb7ef1fb148a99dc3664f83b740a9e5a"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xM1QxMDozNDowNlrOF1-00A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xM1QxMDozNDowNlrOF1-00A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MjE0ODE3Ng==", "bodyText": "Also, should these be enabled by default? If so, what values should we use?", "url": "https://github.com/graphhopper/graphhopper/pull/1953#discussion_r392148176", "createdAt": "2020-03-13T10:34:06Z", "author": {"login": "msbarry"}, "path": "core/src/main/java/com/graphhopper/GraphHopper.java", "diffHunk": "@@ -542,6 +560,8 @@ public GraphHopper init(GraphHopperConfig ghConfig) {\n \n         // elevation\n         this.smoothElevation = ghConfig.getBool(\"graph.elevation.smoothing\", false);\n+        this.longEdgeSamplingDistance = ghConfig.getDouble(\"graph.elevation.long_edge_sampling_distance\", 0);\n+        this.elevationSimplifyFactor = ghConfig.getDouble(\"graph.elevation.simplify_factor\", 0);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f53e5275bb7ef1fb148a99dc3664f83b740a9e5a"}, "originalPosition": 37}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzc1MTM5MDY4", "url": "https://github.com/graphhopper/graphhopper/pull/1953#pullrequestreview-375139068", "createdAt": "2020-03-16T11:54:40Z", "commit": {"oid": "f53e5275bb7ef1fb148a99dc3664f83b740a9e5a"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xNlQxMTo1NDo0MFrOF2wm1A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xNlQxMjowMjozNFrOF2w1zA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5Mjk2Mzc5Ng==", "bodyText": "Do we want to warn when long edge sampling is used without bilinear interpolation?\n\nYes, sounds good.\nWhat does the elevation simplify factor do?", "url": "https://github.com/graphhopper/graphhopper/pull/1953#discussion_r392963796", "createdAt": "2020-03-16T11:54:40Z", "author": {"login": "karussell"}, "path": "core/src/main/java/com/graphhopper/GraphHopper.java", "diffHunk": "@@ -542,6 +560,8 @@ public GraphHopper init(GraphHopperConfig ghConfig) {\n \n         // elevation\n         this.smoothElevation = ghConfig.getBool(\"graph.elevation.smoothing\", false);\n+        this.longEdgeSamplingDistance = ghConfig.getDouble(\"graph.elevation.long_edge_sampling_distance\", 0);\n+        this.elevationSimplifyFactor = ghConfig.getDouble(\"graph.elevation.simplify_factor\", 0);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MjE0Nzg0OA=="}, "originalCommit": {"oid": "f53e5275bb7ef1fb148a99dc3664f83b740a9e5a"}, "originalPosition": 37}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5Mjk2NDM2MQ==", "bodyText": "For now I think this is fine.", "url": "https://github.com/graphhopper/graphhopper/pull/1953#discussion_r392964361", "createdAt": "2020-03-16T11:55:47Z", "author": {"login": "karussell"}, "path": "core/src/main/java/com/graphhopper/reader/dem/EdgeSampling.java", "diffHunk": "@@ -0,0 +1,72 @@\n+/*\n+ *  Licensed to GraphHopper GmbH under one or more contributor\n+ *  license agreements. See the NOTICE file distributed with this work for\n+ *  additional information regarding copyright ownership.\n+ *\n+ *  GraphHopper GmbH licenses this file to you under the Apache License,\n+ *  Version 2.0 (the \"License\"); you may not use this file except in\n+ *  compliance with the License. You may obtain a copy of the License at\n+ *\n+ *       http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ *  Unless required by applicable law or agreed to in writing, software\n+ *  distributed under the License is distributed on an \"AS IS\" BASIS,\n+ *  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ *  See the License for the specific language governing permissions and\n+ *  limitations under the License.\n+ */\n+package com.graphhopper.reader.dem;\n+\n+import com.graphhopper.util.DistanceCalc;\n+import com.graphhopper.util.DistanceCalcEarth;\n+import com.graphhopper.util.PointList;\n+import org.slf4j.Logger;\n+import org.slf4j.LoggerFactory;\n+\n+/**\n+ * Ensures that elevation is sampled along a point list with no more than maxDistance between samples. Works by adding\n+ * points along long edges and fetching elevation at each inserted point.\n+ *\n+ * This uses a simple linear approximation to interpolate between points which should be fine for short distances, but\n+ * if support for longer distances is needed or to handle segments crossing the international date line, should use a\n+ * more robust algorithm that interpolates along the great circle path between points.", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MjE0NTI3NQ=="}, "originalCommit": {"oid": "f53e5275bb7ef1fb148a99dc3664f83b740a9e5a"}, "originalPosition": 32}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5Mjk2NjY1MA==", "bodyText": "The absolute value (elevation max dist in meters) makes sense and would be preferred (I initially did not understand the factor ... see above ;) ). But I guess there is a reason why you chose the factor over the absolute max ele?", "url": "https://github.com/graphhopper/graphhopper/pull/1953#discussion_r392966650", "createdAt": "2020-03-16T12:00:38Z", "author": {"login": "karussell"}, "path": "core/src/main/java/com/graphhopper/util/DouglasPeucker.java", "diffHunk": "@@ -53,6 +56,17 @@ public DouglasPeucker setMaxDistance(double dist) {\n         return this;\n     }\n \n+    /**\n+     * Weight to give elevation changes during simplification:\n+     * 0 means elevation is ignored during simplification\n+     * 0.2 means that 5 meters of elevation change is treated like\n+     * 1m of lat/lon change\n+     */\n+    public DouglasPeucker setElevationFactor(double factor) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MjE0NjA3Mg=="}, "originalCommit": {"oid": "f53e5275bb7ef1fb148a99dc3664f83b740a9e5a"}, "originalPosition": 27}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5Mjk2NzYyOA==", "bodyText": "Yes, for now I would keep the current settings as default (i.e. disabling 'long edge sampling'). But if we learn that it is worth the extra costs we can change it to like 60m (and 1m for max ele simplify)?\n\ngraph.elevation.long_edge_sampling_distance\n\nShouldn't the default for this be Double.MAX_VALUE?", "url": "https://github.com/graphhopper/graphhopper/pull/1953#discussion_r392967628", "createdAt": "2020-03-16T12:02:34Z", "author": {"login": "karussell"}, "path": "core/src/main/java/com/graphhopper/GraphHopper.java", "diffHunk": "@@ -542,6 +560,8 @@ public GraphHopper init(GraphHopperConfig ghConfig) {\n \n         // elevation\n         this.smoothElevation = ghConfig.getBool(\"graph.elevation.smoothing\", false);\n+        this.longEdgeSamplingDistance = ghConfig.getDouble(\"graph.elevation.long_edge_sampling_distance\", 0);\n+        this.elevationSimplifyFactor = ghConfig.getDouble(\"graph.elevation.simplify_factor\", 0);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MjE0ODE3Ng=="}, "originalCommit": {"oid": "f53e5275bb7ef1fb148a99dc3664f83b740a9e5a"}, "originalPosition": 37}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "57d345163c095e42eb977cdefdb9c02f1bf48933", "author": {"user": {"login": "msbarry", "name": "Michael Barry"}}, "url": "https://github.com/graphhopper/graphhopper/commit/57d345163c095e42eb977cdefdb9c02f1bf48933", "committedDate": "2020-03-17T09:07:36Z", "message": "switch elevation factor to elevation max distance"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "cffce4fa24a22fed7ad727c1d57d1218ef5dfd88", "author": {"user": {"login": "msbarry", "name": "Michael Barry"}}, "url": "https://github.com/graphhopper/graphhopper/commit/cffce4fa24a22fed7ad727c1d57d1218ef5dfd88", "committedDate": "2020-03-17T09:21:30Z", "message": "fix comment and warn on long edge sampling without bilinear interpolation"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "0613ac2ce358c3ef96f3539d8d7b519f6ddbe97b", "author": {"user": {"login": "msbarry", "name": "Michael Barry"}}, "url": "https://github.com/graphhopper/graphhopper/commit/0613ac2ce358c3ef96f3539d8d7b519f6ddbe97b", "committedDate": "2020-03-17T09:28:19Z", "message": "new line"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "6dda28032ee367d6221e705bdd6bd2cb5dece439", "author": {"user": {"login": "msbarry", "name": "Michael Barry"}}, "url": "https://github.com/graphhopper/graphhopper/commit/6dda28032ee367d6221e705bdd6bd2cb5dece439", "committedDate": "2020-03-17T09:32:41Z", "message": "Merge branch 'master' into sample-and-3d-simplify"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "456c341c24c952c95dffeabea313b97fe28a78ec", "author": {"user": {"login": "msbarry", "name": "Michael Barry"}}, "url": "https://github.com/graphhopper/graphhopper/commit/456c341c24c952c95dffeabea313b97fe28a78ec", "committedDate": "2020-03-17T09:43:47Z", "message": "add import"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "03e27034e410887ee0189548733f79609e0bdaa8", "author": {"user": {"login": "msbarry", "name": "Michael Barry"}}, "url": "https://github.com/graphhopper/graphhopper/commit/03e27034e410887ee0189548733f79609e0bdaa8", "committedDate": "2020-03-17T11:05:48Z", "message": "config-example comments"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "249eb8fbc02456453701fc2dda07e8514f895bf8", "author": {"user": {"login": "msbarry", "name": "Michael Barry"}}, "url": "https://github.com/graphhopper/graphhopper/commit/249eb8fbc02456453701fc2dda07e8514f895bf8", "committedDate": "2020-03-18T10:07:55Z", "message": "tweak config-example"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b163e0d29ced742f9122b56aeafddf6c1bb2c7d3", "author": {"user": {"login": "msbarry", "name": "Michael Barry"}}, "url": "https://github.com/graphhopper/graphhopper/commit/b163e0d29ced742f9122b56aeafddf6c1bb2c7d3", "committedDate": "2020-03-20T11:23:02Z", "message": "Merge branch 'master' into sample-and-3d-simplify"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "71d6050ff7a1eaceb4de2d1cd66fb46e971f0971", "author": {"user": {"login": "msbarry", "name": "Michael Barry"}}, "url": "https://github.com/graphhopper/graphhopper/commit/71d6050ff7a1eaceb4de2d1cd66fb46e971f0971", "committedDate": "2020-03-24T09:43:40Z", "message": "Merge branch 'master' into sample-and-3d-simplify"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "df5eaa8386e6d066df292cd5b7a879d35b9d33ab", "author": {"user": {"login": "msbarry", "name": "Michael Barry"}}, "url": "https://github.com/graphhopper/graphhopper/commit/df5eaa8386e6d066df292cd5b7a879d35b9d33ab", "committedDate": "2020-03-25T09:30:31Z", "message": "fix integration test"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "76ea4164b3177d7dcf2a59216966d72c40d3c576", "author": {"user": {"login": "msbarry", "name": "Michael Barry"}}, "url": "https://github.com/graphhopper/graphhopper/commit/76ea4164b3177d7dcf2a59216966d72c40d3c576", "committedDate": "2020-03-29T19:19:35Z", "message": "Merge branch 'master' into sample-and-3d-simplify"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "93976261b612a60143de5667af827b75f69a7d74", "author": {"user": {"login": "msbarry", "name": "Michael Barry"}}, "url": "https://github.com/graphhopper/graphhopper/commit/93976261b612a60143de5667af827b75f69a7d74", "committedDate": "2020-04-05T10:04:48Z", "message": "Merge branch 'master' into sample-and-3d-simplify"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d521ff541d83bb7db7276bad7bb1d736bca58024", "author": {"user": {"login": "msbarry", "name": "Michael Barry"}}, "url": "https://github.com/graphhopper/graphhopper/commit/d521ff541d83bb7db7276bad7bb1d736bca58024", "committedDate": "2020-04-11T10:49:51Z", "message": "Merge branch 'master' into sample-and-3d-simplify"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e5a7770622f3095ec0fcee76ed5c03df4a33e47a", "author": {"user": {"login": "msbarry", "name": "Michael Barry"}}, "url": "https://github.com/graphhopper/graphhopper/commit/e5a7770622f3095ec0fcee76ed5c03df4a33e47a", "committedDate": "2020-04-19T19:55:02Z", "message": "Merge branch 'master' into sample-and-3d-simplify"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e90ffb5b188d8c0ec84015a0b87281a30dd648da", "author": {"user": {"login": "msbarry", "name": "Michael Barry"}}, "url": "https://github.com/graphhopper/graphhopper/commit/e90ffb5b188d8c0ec84015a0b87281a30dd648da", "committedDate": "2020-04-19T19:59:53Z", "message": "fix bad merge"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "bc1e31872df4bfbe0e431f5345a8d348b252532a", "author": {"user": {"login": "karussell", "name": "Peter"}}, "url": "https://github.com/graphhopper/graphhopper/commit/bc1e31872df4bfbe0e431f5345a8d348b252532a", "committedDate": "2020-04-23T22:41:47Z", "message": "Merge branch 'master' into sample-and-3d-simplify"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "87c67ea3fd844def0b436ccc7cce908488038284", "author": {"user": {"login": "msbarry", "name": "Michael Barry"}}, "url": "https://github.com/graphhopper/graphhopper/commit/87c67ea3fd844def0b436ccc7cce908488038284", "committedDate": "2020-04-29T09:29:20Z", "message": "Merge branch 'master' into sample-and-3d-simplify"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "47b1f3e13f592806482e303b59ad12e427f99d7e", "author": {"user": {"login": "msbarry", "name": "Michael Barry"}}, "url": "https://github.com/graphhopper/graphhopper/commit/47b1f3e13f592806482e303b59ad12e427f99d7e", "committedDate": "2020-04-29T09:29:54Z", "message": "Merge branch 'sample-and-3d-simplify' of https://github.com/msbarry/graphhopper into sample-and-3d-simplify"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDA1NzY1ODY5", "url": "https://github.com/graphhopper/graphhopper/pull/1953#pullrequestreview-405765869", "createdAt": "2020-05-05T13:04:48Z", "commit": {"oid": "47b1f3e13f592806482e303b59ad12e427f99d7e"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wNVQxMzowNDo0OFrOGQoYDg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wNVQxMzowNDo0OFrOGQoYDg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMDA5MTkxOA==", "bodyText": "I am wondering if we should make this warning a bit more explicit / self-explaining or maybe add a note what the user can do about it?\nCrossing the date line should not happen, since we check isCrossBoundary a few lines above.\nWhat are other cases where this could happen? For ferries, this might be an issue. For regular roads, not having a node every few kms could indicate a mapping error. For OSM this could mean to double check the roads at the given coordinates and maybe align the roads.\nI haven't tested the PR yet, are there many of these logs? I could imagine that for example in Canada or Australia, this could be an issue.", "url": "https://github.com/graphhopper/graphhopper/pull/1953#discussion_r420091918", "createdAt": "2020-05-05T13:04:48Z", "author": {"login": "boldtrn"}, "path": "core/src/main/java/com/graphhopper/reader/dem/EdgeSampling.java", "diffHunk": "@@ -0,0 +1,72 @@\n+/*\n+ *  Licensed to GraphHopper GmbH under one or more contributor\n+ *  license agreements. See the NOTICE file distributed with this work for\n+ *  additional information regarding copyright ownership.\n+ *\n+ *  GraphHopper GmbH licenses this file to you under the Apache License,\n+ *  Version 2.0 (the \"License\"); you may not use this file except in\n+ *  compliance with the License. You may obtain a copy of the License at\n+ *\n+ *       http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ *  Unless required by applicable law or agreed to in writing, software\n+ *  distributed under the License is distributed on an \"AS IS\" BASIS,\n+ *  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ *  See the License for the specific language governing permissions and\n+ *  limitations under the License.\n+ */\n+package com.graphhopper.reader.dem;\n+\n+import com.graphhopper.util.DistanceCalc;\n+import com.graphhopper.util.DistanceCalcEarth;\n+import com.graphhopper.util.PointList;\n+import org.slf4j.Logger;\n+import org.slf4j.LoggerFactory;\n+\n+/**\n+ * Ensures that elevation is sampled along a point list with no more than maxDistance between samples. Works by adding\n+ * points along long edges and fetching elevation at each inserted point.\n+ *\n+ * This uses a simple linear approximation to interpolate between points which should be fine for short distances, but\n+ * if support for longer distances is needed or to handle segments crossing the international date line, should use a\n+ * more robust algorithm that interpolates along the great circle path between points.\n+ */\n+public class EdgeSampling {\n+    private static final Logger logger = LoggerFactory.getLogger(EdgeSampling.class);\n+    private static final double WARN_ON_SEGMENT_LENGTH = DistanceCalcEarth.METERS_PER_DEGREE / 4;\n+\n+    private EdgeSampling() {}\n+\n+    public static PointList sample(PointList input, double maxDistance, DistanceCalc distCalc, ElevationProvider elevation) {\n+        PointList output = new PointList(input.getSize() * 2, input.is3D());\n+        if (input.isEmpty()) return output;\n+        int nodes = input.getSize();\n+        double lastLat = input.getLat(0), lastLon = input.getLon(0), thisLat, thisLon, thisEle;\n+        for (int i = 0; i < nodes; i++) {\n+            thisLat = input.getLat(i);\n+            thisLon = input.getLon(i);\n+            thisEle = input.getEle(i);\n+            if (i > 0 && !distCalc.isCrossBoundary(lastLon, thisLon)) {\n+                double segmentLength = distCalc.calcDist(lastLat, lastLon, thisLat, thisLon);\n+                if (segmentLength > WARN_ON_SEGMENT_LENGTH) {\n+                    logger.warn(\"Edge from \" + lastLat + \",\" + lastLon + \" to \" + thisLat + \",\" + thisLon + \" is \" +\n+                            (int)segmentLength + \"m long, might cause issues with edge sampling.\");", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "47b1f3e13f592806482e303b59ad12e427f99d7e"}, "originalPosition": 53}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDA1NzY5Nzc5", "url": "https://github.com/graphhopper/graphhopper/pull/1953#pullrequestreview-405769779", "createdAt": "2020-05-05T13:09:19Z", "commit": {"oid": "47b1f3e13f592806482e303b59ad12e427f99d7e"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wNVQxMzowOToxOVrOGQoj0Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wNVQxMzowOToxOVrOGQoj0Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMDA5NDkyOQ==", "bodyText": "Shouldn't this use the 3D distance?", "url": "https://github.com/graphhopper/graphhopper/pull/1953#discussion_r420094929", "createdAt": "2020-05-05T13:09:19Z", "author": {"login": "boldtrn"}, "path": "core/src/main/java/com/graphhopper/reader/dem/EdgeSampling.java", "diffHunk": "@@ -0,0 +1,72 @@\n+/*\n+ *  Licensed to GraphHopper GmbH under one or more contributor\n+ *  license agreements. See the NOTICE file distributed with this work for\n+ *  additional information regarding copyright ownership.\n+ *\n+ *  GraphHopper GmbH licenses this file to you under the Apache License,\n+ *  Version 2.0 (the \"License\"); you may not use this file except in\n+ *  compliance with the License. You may obtain a copy of the License at\n+ *\n+ *       http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ *  Unless required by applicable law or agreed to in writing, software\n+ *  distributed under the License is distributed on an \"AS IS\" BASIS,\n+ *  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ *  See the License for the specific language governing permissions and\n+ *  limitations under the License.\n+ */\n+package com.graphhopper.reader.dem;\n+\n+import com.graphhopper.util.DistanceCalc;\n+import com.graphhopper.util.DistanceCalcEarth;\n+import com.graphhopper.util.PointList;\n+import org.slf4j.Logger;\n+import org.slf4j.LoggerFactory;\n+\n+/**\n+ * Ensures that elevation is sampled along a point list with no more than maxDistance between samples. Works by adding\n+ * points along long edges and fetching elevation at each inserted point.\n+ *\n+ * This uses a simple linear approximation to interpolate between points which should be fine for short distances, but\n+ * if support for longer distances is needed or to handle segments crossing the international date line, should use a\n+ * more robust algorithm that interpolates along the great circle path between points.\n+ */\n+public class EdgeSampling {\n+    private static final Logger logger = LoggerFactory.getLogger(EdgeSampling.class);\n+    private static final double WARN_ON_SEGMENT_LENGTH = DistanceCalcEarth.METERS_PER_DEGREE / 4;\n+\n+    private EdgeSampling() {}\n+\n+    public static PointList sample(PointList input, double maxDistance, DistanceCalc distCalc, ElevationProvider elevation) {\n+        PointList output = new PointList(input.getSize() * 2, input.is3D());\n+        if (input.isEmpty()) return output;\n+        int nodes = input.getSize();\n+        double lastLat = input.getLat(0), lastLon = input.getLon(0), thisLat, thisLon, thisEle;\n+        for (int i = 0; i < nodes; i++) {\n+            thisLat = input.getLat(i);\n+            thisLon = input.getLon(i);\n+            thisEle = input.getEle(i);\n+            if (i > 0 && !distCalc.isCrossBoundary(lastLon, thisLon)) {\n+                double segmentLength = distCalc.calcDist(lastLat, lastLon, thisLat, thisLon);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "47b1f3e13f592806482e303b59ad12e427f99d7e"}, "originalPosition": 50}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "5205042c1b3b1c30675907c644cf6994b5603d59", "author": {"user": {"login": "msbarry", "name": "Michael Barry"}}, "url": "https://github.com/graphhopper/graphhopper/commit/5205042c1b3b1c30675907c644cf6994b5603d59", "committedDate": "2020-05-06T01:29:09Z", "message": "calc 3d distance"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "37cdadec62c2f3110bd506d8d30be672ce8851a3", "author": {"user": {"login": "msbarry", "name": "Michael Barry"}}, "url": "https://github.com/graphhopper/graphhopper/commit/37cdadec62c2f3110bd506d8d30be672ce8851a3", "committedDate": "2020-05-06T01:32:37Z", "message": "Merge branch 'master' into sample-and-3d-simplify"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "7c3bac11f515ad81c300e148c5d283512f70829f", "author": {"user": {"login": "msbarry", "name": "Michael Barry"}}, "url": "https://github.com/graphhopper/graphhopper/commit/7c3bac11f515ad81c300e148c5d283512f70829f", "committedDate": "2020-05-06T01:46:13Z", "message": "fix"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "4c10f280362db211a3ecc6ee9e3d371a3cb5a48a", "author": {"user": {"login": "msbarry", "name": "Michael Barry"}}, "url": "https://github.com/graphhopper/graphhopper/commit/4c10f280362db211a3ecc6ee9e3d371a3cb5a48a", "committedDate": "2020-05-06T11:32:44Z", "message": "fix start/end being the same during simplification"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "91267315ecee0dc9707d32c1aaf9a8fe8daddac2", "author": {"user": {"login": "msbarry", "name": "Michael Barry"}}, "url": "https://github.com/graphhopper/graphhopper/commit/91267315ecee0dc9707d32c1aaf9a8fe8daddac2", "committedDate": "2020-05-06T11:38:18Z", "message": "fix normalized edge distance 3d euclidean"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDA2NTMwMzU5", "url": "https://github.com/graphhopper/graphhopper/pull/1953#pullrequestreview-406530359", "createdAt": "2020-05-06T11:41:51Z", "commit": {"oid": "91267315ecee0dc9707d32c1aaf9a8fe8daddac2"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wNlQxMTo0MTo1MVrOGRPD0w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wNlQxMTo0MTo1MVrOGRPD0w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMDcyNTcxNQ==", "bodyText": "@boldtrn this fixed the Australia issue and fixed some unit tests I added, I saw that other code was not trimming segments (calcNormalizedEdgeDistance sets reduceToSegment to false) - is there a reason to retain that behavior here and only handle the NaN case?", "url": "https://github.com/graphhopper/graphhopper/pull/1953#discussion_r420725715", "createdAt": "2020-05-06T11:41:51Z", "author": {"login": "msbarry"}, "path": "api/src/main/java/com/graphhopper/util/DistanceCalcEarth.java", "diffHunk": "@@ -149,6 +149,8 @@ public double calcNormalizedEdgeDistance3D(double r_lat_deg, double r_lon_deg, d\n \n         double norm = delta_lon * delta_lon + delta_lat * delta_lat + delta_ele * delta_ele;\n         double factor = ((r_lon - a_lon) * delta_lon + (r_lat - a_lat) * delta_lat + (r_ele - a_ele) * delta_ele) / norm;\n+        if (factor < 0 || Double.isNaN(factor)) factor = 0;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "91267315ecee0dc9707d32c1aaf9a8fe8daddac2"}, "originalPosition": 4}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b52fefcf87aa42aa12be79abea473c0347c33572", "author": {"user": {"login": "msbarry", "name": "Michael Barry"}}, "url": "https://github.com/graphhopper/graphhopper/commit/b52fefcf87aa42aa12be79abea473c0347c33572", "committedDate": "2020-05-07T01:02:10Z", "message": "fix calc edge distance"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "61adc84cea6797ea613519edce632e7057a8c420", "author": {"user": {"login": "msbarry", "name": "Michael Barry"}}, "url": "https://github.com/graphhopper/graphhopper/commit/61adc84cea6797ea613519edce632e7057a8c420", "committedDate": "2020-05-07T01:31:18Z", "message": "fix"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "7f2449245fa86890030fe43cc509d387cb62e486", "author": {"user": {"login": "msbarry", "name": "Michael Barry"}}, "url": "https://github.com/graphhopper/graphhopper/commit/7f2449245fa86890030fe43cc509d387cb62e486", "committedDate": "2020-05-07T10:52:14Z", "message": "use great circle interpolation on long segments"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDA4MjE2NDEw", "url": "https://github.com/graphhopper/graphhopper/pull/1953#pullrequestreview-408216410", "createdAt": "2020-05-08T12:53:37Z", "commit": {"oid": "7f2449245fa86890030fe43cc509d387cb62e486"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wOFQxMjo1MzozN1rOGSkgmw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wOFQxMjo1MzozN1rOGSkgmw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMjEyNTcyMw==", "bodyText": "We should probably avoid to recompute stuff like Math.cos(lat1radians).", "url": "https://github.com/graphhopper/graphhopper/pull/1953#discussion_r422125723", "createdAt": "2020-05-08T12:53:37Z", "author": {"login": "otbutz"}, "path": "api/src/main/java/com/graphhopper/util/DistanceCalcEarth.java", "diffHunk": "@@ -300,6 +280,35 @@ public GHPoint projectCoordinate(double latInDeg, double lonInDeg, double distan\n         return new GHPoint(projectedLat, projectedLon);\n     }\n \n+    @Override\n+    public GHPoint intermediatePoint(double f, double lat1, double lon1, double lat2, double lon2) {\n+        double lat1radians = Math.toRadians(lat1);\n+        double lon1radians = Math.toRadians(lon1);\n+        double lat2radians = Math.toRadians(lat2);\n+        double lon2radians = Math.toRadians(lon2);\n+\n+        // This formula is taken from: (http://www.movable-type.co.uk/scripts/latlong.html -> https://github.com/chrisveness/geodesy MIT)\n+\n+        double deltaLat = lat2radians - lat1radians;\n+        double deltaLon = lon2radians - lon1radians;\n+        double a = Math.sin(deltaLat/2) * Math.sin(deltaLat/2)\n+                + Math.cos(lat1radians) * Math.cos(lat2radians) * Math.sin(deltaLon/2) * Math.sin(deltaLon/2);\n+        double angularDistance =  2 * Math.atan2(Math.sqrt(a), Math.sqrt(1-a));\n+        if (angularDistance == 0) return new GHPoint(lat1, lon1);\n+\n+        double A = Math.sin((1-f)*angularDistance) / Math.sin(angularDistance);\n+        double B = Math.sin(f*angularDistance) / Math.sin(angularDistance);\n+\n+        double x = A * Math.cos(lat1radians) * Math.cos(lon1radians) + B * Math.cos(lat2radians) * Math.cos(lon2radians);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "7f2449245fa86890030fe43cc509d387cb62e486"}, "originalPosition": 144}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "30f08d505eb164204aada18fc57e071ff5c5c6fc", "author": {"user": {"login": "msbarry", "name": "Michael Barry"}}, "url": "https://github.com/graphhopper/graphhopper/commit/30f08d505eb164204aada18fc57e071ff5c5c6fc", "committedDate": "2020-05-09T00:18:06Z", "message": "dont recompute same thing"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDEwOTQ0NDY1", "url": "https://github.com/graphhopper/graphhopper/pull/1953#pullrequestreview-410944465", "createdAt": "2020-05-13T13:50:20Z", "commit": {"oid": "30f08d505eb164204aada18fc57e071ff5c5c6fc"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d8acfd537b4881016e89ab9a165aeaaa26b7946b", "author": {"user": {"login": "msbarry", "name": "Michael Barry"}}, "url": "https://github.com/graphhopper/graphhopper/commit/d8acfd537b4881016e89ab9a165aeaaa26b7946b", "committedDate": "2020-05-15T12:42:26Z", "message": "default values"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "1c797f4a47bdfd27b499bb33a03f7a8f5e810a69", "author": {"user": {"login": "msbarry", "name": "Michael Barry"}}, "url": "https://github.com/graphhopper/graphhopper/commit/1c797f4a47bdfd27b499bb33a03f7a8f5e810a69", "committedDate": "2020-05-15T12:42:52Z", "message": "Merge branch 'master' into sample-and-3d-simplify"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e5f6377a30931d288ee4e4d378dbe084cd1d4bb9", "author": {"user": {"login": "msbarry", "name": "Michael Barry"}}, "url": "https://github.com/graphhopper/graphhopper/commit/e5f6377a30931d288ee4e4d378dbe084cd1d4bb9", "committedDate": "2020-05-15T13:06:44Z", "message": "fix test"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a15b7088d87b20dbd0c73959bafdd4672121f9cd", "author": {"user": {"login": "msbarry", "name": "Michael Barry"}}, "url": "https://github.com/graphhopper/graphhopper/commit/a15b7088d87b20dbd0c73959bafdd4672121f9cd", "committedDate": "2020-05-19T09:12:57Z", "message": "Merge branch 'master' into sample-and-3d-simplify"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e799a9232b2c1d1984a0a962d34dfac4a6d169f8", "author": {"user": {"login": "msbarry", "name": "Michael Barry"}}, "url": "https://github.com/graphhopper/graphhopper/commit/e799a9232b2c1d1984a0a962d34dfac4a6d169f8", "committedDate": "2020-06-01T09:46:49Z", "message": "Merge branch 'master' into sample-and-3d-simplify"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ede78cf4ab438d2f2ae71893a69931448c699cef", "author": {"user": {"login": "msbarry", "name": "Michael Barry"}}, "url": "https://github.com/graphhopper/graphhopper/commit/ede78cf4ab438d2f2ae71893a69931448c699cef", "committedDate": "2020-06-01T10:49:15Z", "message": "fix merge issues"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "27343aee24345faec25aefc670da96247f14c1fe", "author": {"user": {"login": "msbarry", "name": "Michael Barry"}}, "url": "https://github.com/graphhopper/graphhopper/commit/27343aee24345faec25aefc670da96247f14c1fe", "committedDate": "2020-06-09T00:04:56Z", "message": "Merge branch 'master' into sample-and-3d-simplify"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDI3MjE2ODEy", "url": "https://github.com/graphhopper/graphhopper/pull/1953#pullrequestreview-427216812", "createdAt": "2020-06-09T14:35:02Z", "commit": {"oid": "27343aee24345faec25aefc670da96247f14c1fe"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDI3MjIyMDI1", "url": "https://github.com/graphhopper/graphhopper/pull/1953#pullrequestreview-427222025", "createdAt": "2020-06-09T14:40:03Z", "commit": {"oid": "27343aee24345faec25aefc670da96247f14c1fe"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wOVQxNDo0MDowM1rOGhNaRg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wOVQxNDo0MDowM1rOGhNaRg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNzQ3NTkxMA==", "bodyText": "This file needs to be removed as it is now auto-created.", "url": "https://github.com/graphhopper/graphhopper/pull/1953#discussion_r437475910", "createdAt": "2020-06-09T14:40:03Z", "author": {"login": "karussell"}, "path": "web/src/main/resources/assets/js/main.js", "diffHunk": "@@ -0,0 +1,284 @@\n+(function(){function r(e,n,t){function o(i,f){if(!n[i]){if(!e[i]){var c=\"function\"==typeof require&&require;if(!f&&c)return c(i,!0);if(u)return u(i,!0);var a=new Error(\"Cannot find module '\"+i+\"'\");throw a.code=\"MODULE_NOT_FOUND\",a}var p=n[i]={exports:{}};e[i][0].call(p.exports,function(r){var n=e[i][1][r];return o(n||r)},p,p.exports,r,e,n,t)}return n[i].exports}for(var u=\"function\"==typeof require&&require,i=0;i<t.length;i++)o(t[i]);return o}return r})()({1:[function(require,module,exports){", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "27343aee24345faec25aefc670da96247f14c1fe"}, "originalPosition": 1}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "7c08d4ecc8d9335eaa000435af50c5dc306f2276", "author": {"user": {"login": "msbarry", "name": "Michael Barry"}}, "url": "https://github.com/graphhopper/graphhopper/commit/7c08d4ecc8d9335eaa000435af50c5dc306f2276", "committedDate": "2020-06-10T00:12:57Z", "message": "rm extra file"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "68885217865741ed09cbdd871151fefe94ed6115", "author": {"user": {"login": "karussell", "name": "Peter"}}, "url": "https://github.com/graphhopper/graphhopper/commit/68885217865741ed09cbdd871151fefe94ed6115", "committedDate": "2020-06-10T16:49:38Z", "message": "Merge branch 'master' into sample-and-3d-simplify"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "901087427ecf12433363df8bd3304b1c6a0e90e2", "author": {"user": {"login": "karussell", "name": "Peter"}}, "url": "https://github.com/graphhopper/graphhopper/commit/901087427ecf12433363df8bd3304b1c6a0e90e2", "committedDate": "2020-06-10T19:36:14Z", "message": "merged master"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "8d8d7fd7611779be657e61dcacc7d4aee5302f0d", "author": {"user": {"login": "karussell", "name": "Peter"}}, "url": "https://github.com/graphhopper/graphhopper/commit/8d8d7fd7611779be657e61dcacc7d4aee5302f0d", "committedDate": "2020-06-10T19:42:41Z", "message": "remove local, duplicated variable elevationWayPointMaxDistance"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDI4MzkyMzk4", "url": "https://github.com/graphhopper/graphhopper/pull/1953#pullrequestreview-428392398", "createdAt": "2020-06-10T20:11:57Z", "commit": {"oid": "8d8d7fd7611779be657e61dcacc7d4aee5302f0d"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xMFQyMDoxMTo1N1rOGiEqQQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xMFQyMDoxMTo1N1rOGiEqQQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzODM4MTEyMQ==", "bodyText": "@easbar probably a matter of taste but ... there are properties that are used while import and for the routing and they could be different which would motivate two variables, but likely not here. Should we still keep the two variables?", "url": "https://github.com/graphhopper/graphhopper/pull/1953#discussion_r438381121", "createdAt": "2020-06-10T20:11:57Z", "author": {"login": "karussell"}, "path": "core/src/main/java/com/graphhopper/GraphHopper.java", "diffHunk": "@@ -711,7 +709,7 @@ protected DataReader initDataReader(DataReader reader) {\n                 setElevationProvider(eleProvider).\n                 setWorkerThreads(dataReaderWorkerThreads).\n                 setWayPointMaxDistance(dataReaderWayPointMaxDistance).\n-                setWayPointElevationMaxDistance(elevationWayPointMaxDistance).", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "8d8d7fd7611779be657e61dcacc7d4aee5302f0d"}, "originalPosition": 20}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "9edbfbf2002b3309ef816ed7ac6777aeaa5d5028", "author": {"user": {"login": "msbarry", "name": "Michael Barry"}}, "url": "https://github.com/graphhopper/graphhopper/commit/9edbfbf2002b3309ef816ed7ac6777aeaa5d5028", "committedDate": "2020-06-11T09:39:42Z", "message": "let elevation_way_point_max_distance be controlled per-request"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "9a2a0679143c822c51b06f7fdca9ce4298b0302e", "author": {"user": {"login": "karussell", "name": "Peter"}}, "url": "https://github.com/graphhopper/graphhopper/commit/9a2a0679143c822c51b06f7fdca9ce4298b0302e", "committedDate": "2020-06-11T10:10:30Z", "message": "Merge branch 'master' into sample-and-3d-simplify"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4605, "cost": 1, "resetAt": "2021-11-01T14:51:55Z"}}}