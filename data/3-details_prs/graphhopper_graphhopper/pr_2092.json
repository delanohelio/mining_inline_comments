{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDU1MjIzNjU3", "number": 2092, "title": "Work around slow PriorityQueue.remove", "bodyText": "See #2086.", "createdAt": "2020-07-22T16:23:22Z", "url": "https://github.com/graphhopper/graphhopper/pull/2092", "merged": true, "mergeCommit": {"oid": "e14da304022c80cf432c6b7c839c60243b3d8952"}, "closed": true, "closedAt": "2020-07-24T07:43:15Z", "author": {"login": "michaz"}, "timelineItems": {"totalCount": 8, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABc3dVgJgH2gAyNDU1MjIzNjU3OmJmNzVhNzkzMjBjNjg5ZWNkNDk1ZDIyZTlmMWJlZTU4NDdkNjZhMDE=", "endCursor": "Y3Vyc29yOnYyOpPPAAABc3tWeyAH2gAyNDU1MjIzNjU3OjI1MzZlMzEwYWQwMDFiNmE5MGNkMTVlODQzZDc3NGFiMjY1ZWZkZmQ=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "bf75a79320c689ecd495d22e9f1bee5847d66a01", "author": {"user": {"login": "michaz", "name": "Michael Zilske"}}, "url": "https://github.com/graphhopper/graphhopper/commit/bf75a79320c689ecd495d22e9f1bee5847d66a01", "committedDate": "2020-07-22T16:22:39Z", "message": "Work around slow PriorityQueue.remove"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "50617c75adc36af379ecc3e03baf734fb2191204", "author": {"user": {"login": "michaz", "name": "Michael Zilske"}}, "url": "https://github.com/graphhopper/graphhopper/commit/50617c75adc36af379ecc3e03baf734fb2191204", "committedDate": "2020-07-22T16:26:35Z", "message": "Finish comment"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDUzODY1NzY3", "url": "https://github.com/graphhopper/graphhopper/pull/2092#pullrequestreview-453865767", "createdAt": "2020-07-23T06:36:28Z", "commit": {"oid": "50617c75adc36af379ecc3e03baf734fb2191204"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yM1QwNjozNjoyOFrOG191TQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yM1QwNjozNjoyOFrOG191TQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1OTI0MDc4MQ==", "bodyText": "Is this used?", "url": "https://github.com/graphhopper/graphhopper/pull/2092#discussion_r459240781", "createdAt": "2020-07-23T06:36:28Z", "author": {"login": "otbutz"}, "path": "isochrone/src/main/java/com/graphhopper/isochrone/algorithm/ShortestPathTree.java", "diffHunk": "@@ -78,6 +86,7 @@ public String toString() {\n         }\n     }\n \n+    private IntHashSet queueDeleted = new IntHashSet();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "50617c75adc36af379ecc3e03baf734fb2191204"}, "originalPosition": 33}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDUzODgxMjc0", "url": "https://github.com/graphhopper/graphhopper/pull/2092#pullrequestreview-453881274", "createdAt": "2020-07-23T07:10:33Z", "commit": {"oid": "50617c75adc36af379ecc3e03baf734fb2191204"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yM1QwNzoxMDozM1rOG1-oAg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yM1QwNzoxMDozM1rOG1-oAg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1OTI1Mzc2Mg==", "bodyText": "while (!queueByZ.isEmpty()) {\n    IsoLabel head = queueByZ.poll();\n    if (!head.deleted) {\n        return getExploreValue(head) >= limit;\n    }\n}\nreturn true;\nDepending on the size of the underlying array it would probably be faster to sort it once and iterate over the array.", "url": "https://github.com/graphhopper/graphhopper/pull/2092#discussion_r459253762", "createdAt": "2020-07-23T07:10:33Z", "author": {"login": "otbutz"}, "path": "isochrone/src/main/java/com/graphhopper/isochrone/algorithm/ShortestPathTree.java", "diffHunk": "@@ -187,7 +194,11 @@ private double getExploreValue(IsoLabel label) {\n \n     @Override\n     protected boolean finished() {\n-        return queueByZ.isEmpty() || getExploreValue(queueByZ.peek()) >= limit;\n+        while (queueByZ.peek() != null && queueByZ.peek().deleted)\n+            queueByZ.poll();\n+        if (queueByZ.peek() == null)\n+            return true;\n+        return getExploreValue(queueByZ.peek()) >= limit;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "50617c75adc36af379ecc3e03baf734fb2191204"}, "originalPosition": 77}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "92a047cb1a848ac2869140563f8b4c9f3d5abca7", "author": {"user": {"login": "michaz", "name": "Michael Zilske"}}, "url": "https://github.com/graphhopper/graphhopper/commit/92a047cb1a848ac2869140563f8b4c9f3d5abca7", "committedDate": "2020-07-23T08:49:32Z", "message": "Remove unused code"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "9ba3a83f7db230f3363a8b25c238fa3e7a3999d1", "author": {"user": {"login": "michaz", "name": "Michael Zilske"}}, "url": "https://github.com/graphhopper/graphhopper/commit/9ba3a83f7db230f3363a8b25c238fa3e7a3999d1", "committedDate": "2020-07-23T09:09:33Z", "message": "Typo"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDUzOTYyMTQ4", "url": "https://github.com/graphhopper/graphhopper/pull/2092#pullrequestreview-453962148", "createdAt": "2020-07-23T09:18:46Z", "commit": {"oid": "9ba3a83f7db230f3363a8b25c238fa3e7a3999d1"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yM1QwOToxODo0NlrOG2CmCg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yM1QwOToxODo0NlrOG2CmCg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1OTMxODc5NA==", "bodyText": "The Java PriorityQueue is an extreme fast implementation (also backed on an array) and so it is incredible hard to beat it even if alternatives are theoretically faster.", "url": "https://github.com/graphhopper/graphhopper/pull/2092#discussion_r459318794", "createdAt": "2020-07-23T09:18:46Z", "author": {"login": "karussell"}, "path": "isochrone/src/main/java/com/graphhopper/isochrone/algorithm/ShortestPathTree.java", "diffHunk": "@@ -187,7 +194,11 @@ private double getExploreValue(IsoLabel label) {\n \n     @Override\n     protected boolean finished() {\n-        return queueByZ.isEmpty() || getExploreValue(queueByZ.peek()) >= limit;\n+        while (queueByZ.peek() != null && queueByZ.peek().deleted)\n+            queueByZ.poll();\n+        if (queueByZ.peek() == null)\n+            return true;\n+        return getExploreValue(queueByZ.peek()) >= limit;", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1OTI1Mzc2Mg=="}, "originalCommit": {"oid": "50617c75adc36af379ecc3e03baf734fb2191204"}, "originalPosition": 77}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "2536e310ad001b6a90cd15e843d774ab265efdfd", "author": {"user": {"login": "michaz", "name": "Michael Zilske"}}, "url": "https://github.com/graphhopper/graphhopper/commit/2536e310ad001b6a90cd15e843d774ab265efdfd", "committedDate": "2020-07-23T11:02:12Z", "message": "Test U-turns with time penalty"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4682, "cost": 1, "resetAt": "2021-11-01T14:51:55Z"}}}