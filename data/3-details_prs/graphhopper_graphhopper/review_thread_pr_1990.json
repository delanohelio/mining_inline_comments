{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDA0MTc5ODg3", "number": 1990, "reviewThreads": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xNlQwOTozOToxOFrODya_UA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xNlQxMDo1NTo0NlrODycubA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjU0MTk3NTg0OnYy", "diffSide": "RIGHT", "path": "Dockerfile", "isResolved": true, "comments": {"totalCount": 6, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xNlQwOTozOToxOFrOGGdE3w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xNlQxNzowNDowMFrOGGu4gQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwOTQyMTAyMw==", "bodyText": "Is the pom.xml file really necessary here? As we use a jre (second FROM) compiling is not possible anymore.", "url": "https://github.com/graphhopper/graphhopper/pull/1990#discussion_r409421023", "createdAt": "2020-04-16T09:39:18Z", "author": {"login": "karussell"}, "path": "Dockerfile", "diffHunk": "@@ -1,23 +1,36 @@\n-FROM openjdk:8-jdk\n+FROM maven:3.6.3-jdk-8 as build\n \n ENV JAVA_OPTS \"-server -Xconcurrentio -Xmx1g -Xms1g -XX:+UseG1GC -Ddw.server.application_connectors[0].bind_host=0.0.0.0 -Ddw.server.application_connectors[0].port=8989\"\n \n-RUN mkdir -p /data && mkdir -p /graphhopper\n-\n # install node - only required for JS UI\n RUN apt-get install -y wget \\\n        && curl -sL https://deb.nodesource.com/setup_13.x | bash - \\\n        && apt-get install -y nodejs\n \n-COPY . /graphhopper/\n-\n WORKDIR /graphhopper\n \n+COPY . .\n+\n # create main.js - only required for JS UI\n-RUN cd web && npm install && npm run bundleProduction && cd ..\n+WORKDIR /graphhopper/web\n+\n+RUN npm install && npm run bundleProduction\n+\n+WORKDIR /graphhopper\n \n RUN ./graphhopper.sh build\n \n+FROM openjdk:11.0.5-jre\n+\n+ENV JAVA_OPTS \"-server -Xconcurrentio -Xmx1g -Xms1g -XX:+UseG1GC -Ddw.server.application_connectors[0].bind_host=0.0.0.0 -Ddw.server.application_connectors[0].port=8989\"\n+\n+RUN mkdir -p /data\n+\n+WORKDIR /graphhopper\n+\n+COPY --from=build /graphhopper/web/target/*.jar ./web/target/\n+COPY ./graphhopper.sh ./pom.xml ./config-example.yml ./", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "bde6db0d722b6201f3f156baa75a5dda6ef592f8"}, "originalPosition": 38}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwOTQzODgwNg==", "bodyText": "It is used to get the version in the bash script. Changing the bash script will allow removing this file from the docker file if the version will be fetched from other location or getting the jar file in another method.\nMy initial attempt where without it, but this is the simplest solution for the docker.\nI think the version in the bash file to find the right jar file should use the jar file name instead, but it is fragile and I think out of this scope..", "url": "https://github.com/graphhopper/graphhopper/pull/1990#discussion_r409438806", "createdAt": "2020-04-16T10:07:52Z", "author": {"login": "HarelM"}, "path": "Dockerfile", "diffHunk": "@@ -1,23 +1,36 @@\n-FROM openjdk:8-jdk\n+FROM maven:3.6.3-jdk-8 as build\n \n ENV JAVA_OPTS \"-server -Xconcurrentio -Xmx1g -Xms1g -XX:+UseG1GC -Ddw.server.application_connectors[0].bind_host=0.0.0.0 -Ddw.server.application_connectors[0].port=8989\"\n \n-RUN mkdir -p /data && mkdir -p /graphhopper\n-\n # install node - only required for JS UI\n RUN apt-get install -y wget \\\n        && curl -sL https://deb.nodesource.com/setup_13.x | bash - \\\n        && apt-get install -y nodejs\n \n-COPY . /graphhopper/\n-\n WORKDIR /graphhopper\n \n+COPY . .\n+\n # create main.js - only required for JS UI\n-RUN cd web && npm install && npm run bundleProduction && cd ..\n+WORKDIR /graphhopper/web\n+\n+RUN npm install && npm run bundleProduction\n+\n+WORKDIR /graphhopper\n \n RUN ./graphhopper.sh build\n \n+FROM openjdk:11.0.5-jre\n+\n+ENV JAVA_OPTS \"-server -Xconcurrentio -Xmx1g -Xms1g -XX:+UseG1GC -Ddw.server.application_connectors[0].bind_host=0.0.0.0 -Ddw.server.application_connectors[0].port=8989\"\n+\n+RUN mkdir -p /data\n+\n+WORKDIR /graphhopper\n+\n+COPY --from=build /graphhopper/web/target/*.jar ./web/target/\n+COPY ./graphhopper.sh ./pom.xml ./config-example.yml ./", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwOTQyMTAyMw=="}, "originalCommit": {"oid": "bde6db0d722b6201f3f156baa75a5dda6ef592f8"}, "originalPosition": 38}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwOTQ0ODk1NA==", "bodyText": "Ah, thanks for finding this out. Can you add a comment and point to this issue on why these files need to be in the Docker image?", "url": "https://github.com/graphhopper/graphhopper/pull/1990#discussion_r409448954", "createdAt": "2020-04-16T10:25:07Z", "author": {"login": "karussell"}, "path": "Dockerfile", "diffHunk": "@@ -1,23 +1,36 @@\n-FROM openjdk:8-jdk\n+FROM maven:3.6.3-jdk-8 as build\n \n ENV JAVA_OPTS \"-server -Xconcurrentio -Xmx1g -Xms1g -XX:+UseG1GC -Ddw.server.application_connectors[0].bind_host=0.0.0.0 -Ddw.server.application_connectors[0].port=8989\"\n \n-RUN mkdir -p /data && mkdir -p /graphhopper\n-\n # install node - only required for JS UI\n RUN apt-get install -y wget \\\n        && curl -sL https://deb.nodesource.com/setup_13.x | bash - \\\n        && apt-get install -y nodejs\n \n-COPY . /graphhopper/\n-\n WORKDIR /graphhopper\n \n+COPY . .\n+\n # create main.js - only required for JS UI\n-RUN cd web && npm install && npm run bundleProduction && cd ..\n+WORKDIR /graphhopper/web\n+\n+RUN npm install && npm run bundleProduction\n+\n+WORKDIR /graphhopper\n \n RUN ./graphhopper.sh build\n \n+FROM openjdk:11.0.5-jre\n+\n+ENV JAVA_OPTS \"-server -Xconcurrentio -Xmx1g -Xms1g -XX:+UseG1GC -Ddw.server.application_connectors[0].bind_host=0.0.0.0 -Ddw.server.application_connectors[0].port=8989\"\n+\n+RUN mkdir -p /data\n+\n+WORKDIR /graphhopper\n+\n+COPY --from=build /graphhopper/web/target/*.jar ./web/target/\n+COPY ./graphhopper.sh ./pom.xml ./config-example.yml ./", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwOTQyMTAyMw=="}, "originalCommit": {"oid": "bde6db0d722b6201f3f156baa75a5dda6ef592f8"}, "originalPosition": 38}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwOTQ1Mzg4MA==", "bodyText": "Done.", "url": "https://github.com/graphhopper/graphhopper/pull/1990#discussion_r409453880", "createdAt": "2020-04-16T10:33:42Z", "author": {"login": "HarelM"}, "path": "Dockerfile", "diffHunk": "@@ -1,23 +1,36 @@\n-FROM openjdk:8-jdk\n+FROM maven:3.6.3-jdk-8 as build\n \n ENV JAVA_OPTS \"-server -Xconcurrentio -Xmx1g -Xms1g -XX:+UseG1GC -Ddw.server.application_connectors[0].bind_host=0.0.0.0 -Ddw.server.application_connectors[0].port=8989\"\n \n-RUN mkdir -p /data && mkdir -p /graphhopper\n-\n # install node - only required for JS UI\n RUN apt-get install -y wget \\\n        && curl -sL https://deb.nodesource.com/setup_13.x | bash - \\\n        && apt-get install -y nodejs\n \n-COPY . /graphhopper/\n-\n WORKDIR /graphhopper\n \n+COPY . .\n+\n # create main.js - only required for JS UI\n-RUN cd web && npm install && npm run bundleProduction && cd ..\n+WORKDIR /graphhopper/web\n+\n+RUN npm install && npm run bundleProduction\n+\n+WORKDIR /graphhopper\n \n RUN ./graphhopper.sh build\n \n+FROM openjdk:11.0.5-jre\n+\n+ENV JAVA_OPTS \"-server -Xconcurrentio -Xmx1g -Xms1g -XX:+UseG1GC -Ddw.server.application_connectors[0].bind_host=0.0.0.0 -Ddw.server.application_connectors[0].port=8989\"\n+\n+RUN mkdir -p /data\n+\n+WORKDIR /graphhopper\n+\n+COPY --from=build /graphhopper/web/target/*.jar ./web/target/\n+COPY ./graphhopper.sh ./pom.xml ./config-example.yml ./", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwOTQyMTAyMw=="}, "originalCommit": {"oid": "bde6db0d722b6201f3f156baa75a5dda6ef592f8"}, "originalPosition": 38}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwOTY2NzYwNQ==", "bodyText": "Somehow there are 0 commits in this PR now. Can you have a look?", "url": "https://github.com/graphhopper/graphhopper/pull/1990#discussion_r409667605", "createdAt": "2020-04-16T15:55:22Z", "author": {"login": "karussell"}, "path": "Dockerfile", "diffHunk": "@@ -1,23 +1,36 @@\n-FROM openjdk:8-jdk\n+FROM maven:3.6.3-jdk-8 as build\n \n ENV JAVA_OPTS \"-server -Xconcurrentio -Xmx1g -Xms1g -XX:+UseG1GC -Ddw.server.application_connectors[0].bind_host=0.0.0.0 -Ddw.server.application_connectors[0].port=8989\"\n \n-RUN mkdir -p /data && mkdir -p /graphhopper\n-\n # install node - only required for JS UI\n RUN apt-get install -y wget \\\n        && curl -sL https://deb.nodesource.com/setup_13.x | bash - \\\n        && apt-get install -y nodejs\n \n-COPY . /graphhopper/\n-\n WORKDIR /graphhopper\n \n+COPY . .\n+\n # create main.js - only required for JS UI\n-RUN cd web && npm install && npm run bundleProduction && cd ..\n+WORKDIR /graphhopper/web\n+\n+RUN npm install && npm run bundleProduction\n+\n+WORKDIR /graphhopper\n \n RUN ./graphhopper.sh build\n \n+FROM openjdk:11.0.5-jre\n+\n+ENV JAVA_OPTS \"-server -Xconcurrentio -Xmx1g -Xms1g -XX:+UseG1GC -Ddw.server.application_connectors[0].bind_host=0.0.0.0 -Ddw.server.application_connectors[0].port=8989\"\n+\n+RUN mkdir -p /data\n+\n+WORKDIR /graphhopper\n+\n+COPY --from=build /graphhopper/web/target/*.jar ./web/target/\n+COPY ./graphhopper.sh ./pom.xml ./config-example.yml ./", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwOTQyMTAyMw=="}, "originalCommit": {"oid": "bde6db0d722b6201f3f156baa75a5dda6ef592f8"}, "originalPosition": 38}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwOTcxMjc2OQ==", "bodyText": "I'm not sure what happened, some automatic merge of some sort. Should be OK now...", "url": "https://github.com/graphhopper/graphhopper/pull/1990#discussion_r409712769", "createdAt": "2020-04-16T17:04:00Z", "author": {"login": "HarelM"}, "path": "Dockerfile", "diffHunk": "@@ -1,23 +1,36 @@\n-FROM openjdk:8-jdk\n+FROM maven:3.6.3-jdk-8 as build\n \n ENV JAVA_OPTS \"-server -Xconcurrentio -Xmx1g -Xms1g -XX:+UseG1GC -Ddw.server.application_connectors[0].bind_host=0.0.0.0 -Ddw.server.application_connectors[0].port=8989\"\n \n-RUN mkdir -p /data && mkdir -p /graphhopper\n-\n # install node - only required for JS UI\n RUN apt-get install -y wget \\\n        && curl -sL https://deb.nodesource.com/setup_13.x | bash - \\\n        && apt-get install -y nodejs\n \n-COPY . /graphhopper/\n-\n WORKDIR /graphhopper\n \n+COPY . .\n+\n # create main.js - only required for JS UI\n-RUN cd web && npm install && npm run bundleProduction && cd ..\n+WORKDIR /graphhopper/web\n+\n+RUN npm install && npm run bundleProduction\n+\n+WORKDIR /graphhopper\n \n RUN ./graphhopper.sh build\n \n+FROM openjdk:11.0.5-jre\n+\n+ENV JAVA_OPTS \"-server -Xconcurrentio -Xmx1g -Xms1g -XX:+UseG1GC -Ddw.server.application_connectors[0].bind_host=0.0.0.0 -Ddw.server.application_connectors[0].port=8989\"\n+\n+RUN mkdir -p /data\n+\n+WORKDIR /graphhopper\n+\n+COPY --from=build /graphhopper/web/target/*.jar ./web/target/\n+COPY ./graphhopper.sh ./pom.xml ./config-example.yml ./", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwOTQyMTAyMw=="}, "originalCommit": {"oid": "bde6db0d722b6201f3f156baa75a5dda6ef592f8"}, "originalPosition": 38}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjU0MTk4MDU0OnYy", "diffSide": "RIGHT", "path": "Dockerfile", "isResolved": true, "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xNlQwOTo0MDozNFrOGGdH8Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xNlQxMDoxNTo1MlrOGGecYA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwOTQyMTgwOQ==", "bodyText": "Can you remove the options -server -Xconcurrentio and -XX:+UseG1GC? We should use the JVM defaults.", "url": "https://github.com/graphhopper/graphhopper/pull/1990#discussion_r409421809", "createdAt": "2020-04-16T09:40:34Z", "author": {"login": "karussell"}, "path": "Dockerfile", "diffHunk": "@@ -1,23 +1,36 @@\n-FROM openjdk:8-jdk\n+FROM maven:3.6.3-jdk-8 as build\n \n ENV JAVA_OPTS \"-server -Xconcurrentio -Xmx1g -Xms1g -XX:+UseG1GC -Ddw.server.application_connectors[0].bind_host=0.0.0.0 -Ddw.server.application_connectors[0].port=8989\"\n \n-RUN mkdir -p /data && mkdir -p /graphhopper\n-\n # install node - only required for JS UI\n RUN apt-get install -y wget \\\n        && curl -sL https://deb.nodesource.com/setup_13.x | bash - \\\n        && apt-get install -y nodejs\n \n-COPY . /graphhopper/\n-\n WORKDIR /graphhopper\n \n+COPY . .\n+\n # create main.js - only required for JS UI\n-RUN cd web && npm install && npm run bundleProduction && cd ..\n+WORKDIR /graphhopper/web\n+\n+RUN npm install && npm run bundleProduction\n+\n+WORKDIR /graphhopper\n \n RUN ./graphhopper.sh build\n \n+FROM openjdk:11.0.5-jre\n+\n+ENV JAVA_OPTS \"-server -Xconcurrentio -Xmx1g -Xms1g -XX:+UseG1GC -Ddw.server.application_connectors[0].bind_host=0.0.0.0 -Ddw.server.application_connectors[0].port=8989\"", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "bde6db0d722b6201f3f156baa75a5dda6ef592f8"}, "originalPosition": 31}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwOTQzOTI2NQ==", "bodyText": "Sure, I have no clue what all these variables mean so I decided to leave them as they were...", "url": "https://github.com/graphhopper/graphhopper/pull/1990#discussion_r409439265", "createdAt": "2020-04-16T10:08:38Z", "author": {"login": "HarelM"}, "path": "Dockerfile", "diffHunk": "@@ -1,23 +1,36 @@\n-FROM openjdk:8-jdk\n+FROM maven:3.6.3-jdk-8 as build\n \n ENV JAVA_OPTS \"-server -Xconcurrentio -Xmx1g -Xms1g -XX:+UseG1GC -Ddw.server.application_connectors[0].bind_host=0.0.0.0 -Ddw.server.application_connectors[0].port=8989\"\n \n-RUN mkdir -p /data && mkdir -p /graphhopper\n-\n # install node - only required for JS UI\n RUN apt-get install -y wget \\\n        && curl -sL https://deb.nodesource.com/setup_13.x | bash - \\\n        && apt-get install -y nodejs\n \n-COPY . /graphhopper/\n-\n WORKDIR /graphhopper\n \n+COPY . .\n+\n # create main.js - only required for JS UI\n-RUN cd web && npm install && npm run bundleProduction && cd ..\n+WORKDIR /graphhopper/web\n+\n+RUN npm install && npm run bundleProduction\n+\n+WORKDIR /graphhopper\n \n RUN ./graphhopper.sh build\n \n+FROM openjdk:11.0.5-jre\n+\n+ENV JAVA_OPTS \"-server -Xconcurrentio -Xmx1g -Xms1g -XX:+UseG1GC -Ddw.server.application_connectors[0].bind_host=0.0.0.0 -Ddw.server.application_connectors[0].port=8989\"", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwOTQyMTgwOQ=="}, "originalCommit": {"oid": "bde6db0d722b6201f3f156baa75a5dda6ef592f8"}, "originalPosition": 31}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwOTQ0MzQyNA==", "bodyText": "Done.", "url": "https://github.com/graphhopper/graphhopper/pull/1990#discussion_r409443424", "createdAt": "2020-04-16T10:15:52Z", "author": {"login": "HarelM"}, "path": "Dockerfile", "diffHunk": "@@ -1,23 +1,36 @@\n-FROM openjdk:8-jdk\n+FROM maven:3.6.3-jdk-8 as build\n \n ENV JAVA_OPTS \"-server -Xconcurrentio -Xmx1g -Xms1g -XX:+UseG1GC -Ddw.server.application_connectors[0].bind_host=0.0.0.0 -Ddw.server.application_connectors[0].port=8989\"\n \n-RUN mkdir -p /data && mkdir -p /graphhopper\n-\n # install node - only required for JS UI\n RUN apt-get install -y wget \\\n        && curl -sL https://deb.nodesource.com/setup_13.x | bash - \\\n        && apt-get install -y nodejs\n \n-COPY . /graphhopper/\n-\n WORKDIR /graphhopper\n \n+COPY . .\n+\n # create main.js - only required for JS UI\n-RUN cd web && npm install && npm run bundleProduction && cd ..\n+WORKDIR /graphhopper/web\n+\n+RUN npm install && npm run bundleProduction\n+\n+WORKDIR /graphhopper\n \n RUN ./graphhopper.sh build\n \n+FROM openjdk:11.0.5-jre\n+\n+ENV JAVA_OPTS \"-server -Xconcurrentio -Xmx1g -Xms1g -XX:+UseG1GC -Ddw.server.application_connectors[0].bind_host=0.0.0.0 -Ddw.server.application_connectors[0].port=8989\"", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwOTQyMTgwOQ=="}, "originalCommit": {"oid": "bde6db0d722b6201f3f156baa75a5dda6ef592f8"}, "originalPosition": 31}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjU0MjI0Nzg4OnYy", "diffSide": "RIGHT", "path": "Dockerfile", "isResolved": true, "comments": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xNlQxMDo1MjoyNFrOGGft7A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xNlQxMzowNzo0MFrOGGkY9g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwOTQ2NDMwMA==", "bodyText": "Do we need to hardcode minor/patch versions?", "url": "https://github.com/graphhopper/graphhopper/pull/1990#discussion_r409464300", "createdAt": "2020-04-16T10:52:24Z", "author": {"login": "otbutz"}, "path": "Dockerfile", "diffHunk": "@@ -1,23 +1,37 @@\n-FROM openjdk:8-jdk\n+FROM maven:3.6.3-jdk-8 as build\n \n ENV JAVA_OPTS \"-server -Xconcurrentio -Xmx1g -Xms1g -XX:+UseG1GC -Ddw.server.application_connectors[0].bind_host=0.0.0.0 -Ddw.server.application_connectors[0].port=8989\"\n \n-RUN mkdir -p /data && mkdir -p /graphhopper\n-\n # install node - only required for JS UI\n RUN apt-get install -y wget \\\n        && curl -sL https://deb.nodesource.com/setup_13.x | bash - \\\n        && apt-get install -y nodejs\n \n-COPY . /graphhopper/\n-\n WORKDIR /graphhopper\n \n+COPY . .\n+\n # create main.js - only required for JS UI\n-RUN cd web && npm install && npm run bundleProduction && cd ..\n+WORKDIR /graphhopper/web\n+\n+RUN npm install && npm run bundleProduction\n+\n+WORKDIR /graphhopper\n \n RUN ./graphhopper.sh build\n \n+FROM openjdk:11.0.5-jre", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "4af8f1dc14a08dbafd6666c7f1eb5081d4bbb7dd"}, "originalPosition": 29}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwOTQ4NzI1MQ==", "bodyText": "Thanks for the tip. I have removed the .5, using 11.0 now.", "url": "https://github.com/graphhopper/graphhopper/pull/1990#discussion_r409487251", "createdAt": "2020-04-16T11:36:23Z", "author": {"login": "HarelM"}, "path": "Dockerfile", "diffHunk": "@@ -1,23 +1,37 @@\n-FROM openjdk:8-jdk\n+FROM maven:3.6.3-jdk-8 as build\n \n ENV JAVA_OPTS \"-server -Xconcurrentio -Xmx1g -Xms1g -XX:+UseG1GC -Ddw.server.application_connectors[0].bind_host=0.0.0.0 -Ddw.server.application_connectors[0].port=8989\"\n \n-RUN mkdir -p /data && mkdir -p /graphhopper\n-\n # install node - only required for JS UI\n RUN apt-get install -y wget \\\n        && curl -sL https://deb.nodesource.com/setup_13.x | bash - \\\n        && apt-get install -y nodejs\n \n-COPY . /graphhopper/\n-\n WORKDIR /graphhopper\n \n+COPY . .\n+\n # create main.js - only required for JS UI\n-RUN cd web && npm install && npm run bundleProduction && cd ..\n+WORKDIR /graphhopper/web\n+\n+RUN npm install && npm run bundleProduction\n+\n+WORKDIR /graphhopper\n \n RUN ./graphhopper.sh build\n \n+FROM openjdk:11.0.5-jre", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwOTQ2NDMwMA=="}, "originalCommit": {"oid": "4af8f1dc14a08dbafd6666c7f1eb5081d4bbb7dd"}, "originalPosition": 29}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwOTQ5MDY0MQ==", "bodyText": "i think openjdk:11-jre should work too", "url": "https://github.com/graphhopper/graphhopper/pull/1990#discussion_r409490641", "createdAt": "2020-04-16T11:43:05Z", "author": {"login": "otbutz"}, "path": "Dockerfile", "diffHunk": "@@ -1,23 +1,37 @@\n-FROM openjdk:8-jdk\n+FROM maven:3.6.3-jdk-8 as build\n \n ENV JAVA_OPTS \"-server -Xconcurrentio -Xmx1g -Xms1g -XX:+UseG1GC -Ddw.server.application_connectors[0].bind_host=0.0.0.0 -Ddw.server.application_connectors[0].port=8989\"\n \n-RUN mkdir -p /data && mkdir -p /graphhopper\n-\n # install node - only required for JS UI\n RUN apt-get install -y wget \\\n        && curl -sL https://deb.nodesource.com/setup_13.x | bash - \\\n        && apt-get install -y nodejs\n \n-COPY . /graphhopper/\n-\n WORKDIR /graphhopper\n \n+COPY . .\n+\n # create main.js - only required for JS UI\n-RUN cd web && npm install && npm run bundleProduction && cd ..\n+WORKDIR /graphhopper/web\n+\n+RUN npm install && npm run bundleProduction\n+\n+WORKDIR /graphhopper\n \n RUN ./graphhopper.sh build\n \n+FROM openjdk:11.0.5-jre", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwOTQ2NDMwMA=="}, "originalCommit": {"oid": "4af8f1dc14a08dbafd6666c7f1eb5081d4bbb7dd"}, "originalPosition": 29}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwOTQ5MjY5Nw==", "bodyText": "Minor version changes can still break some code, I prefer to be on the safe side. Feel free to change it though. :-)", "url": "https://github.com/graphhopper/graphhopper/pull/1990#discussion_r409492697", "createdAt": "2020-04-16T11:46:59Z", "author": {"login": "HarelM"}, "path": "Dockerfile", "diffHunk": "@@ -1,23 +1,37 @@\n-FROM openjdk:8-jdk\n+FROM maven:3.6.3-jdk-8 as build\n \n ENV JAVA_OPTS \"-server -Xconcurrentio -Xmx1g -Xms1g -XX:+UseG1GC -Ddw.server.application_connectors[0].bind_host=0.0.0.0 -Ddw.server.application_connectors[0].port=8989\"\n \n-RUN mkdir -p /data && mkdir -p /graphhopper\n-\n # install node - only required for JS UI\n RUN apt-get install -y wget \\\n        && curl -sL https://deb.nodesource.com/setup_13.x | bash - \\\n        && apt-get install -y nodejs\n \n-COPY . /graphhopper/\n-\n WORKDIR /graphhopper\n \n+COPY . .\n+\n # create main.js - only required for JS UI\n-RUN cd web && npm install && npm run bundleProduction && cd ..\n+WORKDIR /graphhopper/web\n+\n+RUN npm install && npm run bundleProduction\n+\n+WORKDIR /graphhopper\n \n RUN ./graphhopper.sh build\n \n+FROM openjdk:11.0.5-jre", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwOTQ2NDMwMA=="}, "originalCommit": {"oid": "4af8f1dc14a08dbafd6666c7f1eb5081d4bbb7dd"}, "originalPosition": 29}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwOTU0MDg1NA==", "bodyText": "I prefer stable and specific versions too. So I would keep it as it is.", "url": "https://github.com/graphhopper/graphhopper/pull/1990#discussion_r409540854", "createdAt": "2020-04-16T13:07:40Z", "author": {"login": "karussell"}, "path": "Dockerfile", "diffHunk": "@@ -1,23 +1,37 @@\n-FROM openjdk:8-jdk\n+FROM maven:3.6.3-jdk-8 as build\n \n ENV JAVA_OPTS \"-server -Xconcurrentio -Xmx1g -Xms1g -XX:+UseG1GC -Ddw.server.application_connectors[0].bind_host=0.0.0.0 -Ddw.server.application_connectors[0].port=8989\"\n \n-RUN mkdir -p /data && mkdir -p /graphhopper\n-\n # install node - only required for JS UI\n RUN apt-get install -y wget \\\n        && curl -sL https://deb.nodesource.com/setup_13.x | bash - \\\n        && apt-get install -y nodejs\n \n-COPY . /graphhopper/\n-\n WORKDIR /graphhopper\n \n+COPY . .\n+\n # create main.js - only required for JS UI\n-RUN cd web && npm install && npm run bundleProduction && cd ..\n+WORKDIR /graphhopper/web\n+\n+RUN npm install && npm run bundleProduction\n+\n+WORKDIR /graphhopper\n \n RUN ./graphhopper.sh build\n \n+FROM openjdk:11.0.5-jre", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwOTQ2NDMwMA=="}, "originalCommit": {"oid": "4af8f1dc14a08dbafd6666c7f1eb5081d4bbb7dd"}, "originalPosition": 29}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjU0MjI2MDI4OnYy", "diffSide": "RIGHT", "path": "Dockerfile", "isResolved": true, "comments": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xNlQxMDo1NTo0NlrOGGf1ew==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xNlQxNzowMzoyN1rOGGu3FA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwOTQ2NjIzNQ==", "bodyText": "Dropping the package cache might further reduce image size:\nRUN apt-get install -y wget \\\n       && curl -sL https://deb.nodesource.com/setup_13.x | bash - \\\n       && apt-get install -y nodejs \\\n       && rm -rf /var/lib/apt/lists/*", "url": "https://github.com/graphhopper/graphhopper/pull/1990#discussion_r409466235", "createdAt": "2020-04-16T10:55:46Z", "author": {"login": "otbutz"}, "path": "Dockerfile", "diffHunk": "@@ -1,23 +1,37 @@\n-FROM openjdk:8-jdk\n+FROM maven:3.6.3-jdk-8 as build\n \n ENV JAVA_OPTS \"-server -Xconcurrentio -Xmx1g -Xms1g -XX:+UseG1GC -Ddw.server.application_connectors[0].bind_host=0.0.0.0 -Ddw.server.application_connectors[0].port=8989\"\n \n-RUN mkdir -p /data && mkdir -p /graphhopper\n-\n # install node - only required for JS UI\n RUN apt-get install -y wget \\\n        && curl -sL https://deb.nodesource.com/setup_13.x | bash - \\\n        && apt-get install -y nodejs", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "4af8f1dc14a08dbafd6666c7f1eb5081d4bbb7dd"}, "originalPosition": 11}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwOTQ5MTM3NQ==", "bodyText": "This is not part of the deployed image but it is part of the build image, which is not reflected in the total size.\nThe current image size is about 130 Mb, there's a way to reduce it if we use jre-slim but then we'll need to add wget to the image, which I'm not sure is so simple.\nAlso I guess that not all jar files are needed but probably just one which will reduce the image size significantly. But I'm not sure this is entirely related to this issue as the main purpose of this PR is to allow continuous images build.\nI can create another PR and open anther issue if there's a need to reduce image size more.", "url": "https://github.com/graphhopper/graphhopper/pull/1990#discussion_r409491375", "createdAt": "2020-04-16T11:44:22Z", "author": {"login": "HarelM"}, "path": "Dockerfile", "diffHunk": "@@ -1,23 +1,37 @@\n-FROM openjdk:8-jdk\n+FROM maven:3.6.3-jdk-8 as build\n \n ENV JAVA_OPTS \"-server -Xconcurrentio -Xmx1g -Xms1g -XX:+UseG1GC -Ddw.server.application_connectors[0].bind_host=0.0.0.0 -Ddw.server.application_connectors[0].port=8989\"\n \n-RUN mkdir -p /data && mkdir -p /graphhopper\n-\n # install node - only required for JS UI\n RUN apt-get install -y wget \\\n        && curl -sL https://deb.nodesource.com/setup_13.x | bash - \\\n        && apt-get install -y nodejs", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwOTQ2NjIzNQ=="}, "originalCommit": {"oid": "4af8f1dc14a08dbafd6666c7f1eb5081d4bbb7dd"}, "originalPosition": 11}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwOTUwMzU5OA==", "bodyText": "Sorry, I now see the name I gave to this pull request... :-/ In any case, the current changes are good enough on their own I believe. further improvement can be made later on assuming this will be tested to work as expected not just by me :-)", "url": "https://github.com/graphhopper/graphhopper/pull/1990#discussion_r409503598", "createdAt": "2020-04-16T12:07:21Z", "author": {"login": "HarelM"}, "path": "Dockerfile", "diffHunk": "@@ -1,23 +1,37 @@\n-FROM openjdk:8-jdk\n+FROM maven:3.6.3-jdk-8 as build\n \n ENV JAVA_OPTS \"-server -Xconcurrentio -Xmx1g -Xms1g -XX:+UseG1GC -Ddw.server.application_connectors[0].bind_host=0.0.0.0 -Ddw.server.application_connectors[0].port=8989\"\n \n-RUN mkdir -p /data && mkdir -p /graphhopper\n-\n # install node - only required for JS UI\n RUN apt-get install -y wget \\\n        && curl -sL https://deb.nodesource.com/setup_13.x | bash - \\\n        && apt-get install -y nodejs", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwOTQ2NjIzNQ=="}, "originalCommit": {"oid": "4af8f1dc14a08dbafd6666c7f1eb5081d4bbb7dd"}, "originalPosition": 11}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwOTU0MTkzNw==", "bodyText": "which I'm not sure is so simple.\n\nSee https://stackoverflow.com/a/28885237/194609", "url": "https://github.com/graphhopper/graphhopper/pull/1990#discussion_r409541937", "createdAt": "2020-04-16T13:09:14Z", "author": {"login": "karussell"}, "path": "Dockerfile", "diffHunk": "@@ -1,23 +1,37 @@\n-FROM openjdk:8-jdk\n+FROM maven:3.6.3-jdk-8 as build\n \n ENV JAVA_OPTS \"-server -Xconcurrentio -Xmx1g -Xms1g -XX:+UseG1GC -Ddw.server.application_connectors[0].bind_host=0.0.0.0 -Ddw.server.application_connectors[0].port=8989\"\n \n-RUN mkdir -p /data && mkdir -p /graphhopper\n-\n # install node - only required for JS UI\n RUN apt-get install -y wget \\\n        && curl -sL https://deb.nodesource.com/setup_13.x | bash - \\\n        && apt-get install -y nodejs", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwOTQ2NjIzNQ=="}, "originalCommit": {"oid": "4af8f1dc14a08dbafd6666c7f1eb5081d4bbb7dd"}, "originalPosition": 11}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwOTcxMjQwNA==", "bodyText": "My concern is not how simple it is to add wget to the image but rather what else is missing...\nSince I don't know I prefer to start of like that and maybe later on reduce the size more when the whole process is up and running.\nAs I said, there are further improvements that can be made later on.", "url": "https://github.com/graphhopper/graphhopper/pull/1990#discussion_r409712404", "createdAt": "2020-04-16T17:03:27Z", "author": {"login": "HarelM"}, "path": "Dockerfile", "diffHunk": "@@ -1,23 +1,37 @@\n-FROM openjdk:8-jdk\n+FROM maven:3.6.3-jdk-8 as build\n \n ENV JAVA_OPTS \"-server -Xconcurrentio -Xmx1g -Xms1g -XX:+UseG1GC -Ddw.server.application_connectors[0].bind_host=0.0.0.0 -Ddw.server.application_connectors[0].port=8989\"\n \n-RUN mkdir -p /data && mkdir -p /graphhopper\n-\n # install node - only required for JS UI\n RUN apt-get install -y wget \\\n        && curl -sL https://deb.nodesource.com/setup_13.x | bash - \\\n        && apt-get install -y nodejs", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwOTQ2NjIzNQ=="}, "originalCommit": {"oid": "4af8f1dc14a08dbafd6666c7f1eb5081d4bbb7dd"}, "originalPosition": 11}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4784, "cost": 1, "resetAt": "2021-11-12T20:28:25Z"}}}