{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDEwOTY5Nzg2", "number": 2023, "reviewThreads": {"totalCount": 6, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yOVQyMTo0NjozM1rOD30EUg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wMlQxOToyMzoxOVrOD4r_IA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjU5ODUxMzQ2OnYy", "diffSide": "RIGHT", "path": "web/src/main/resources/assets/js/graphhopper/GHRequest.js", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yOVQyMTo0NjozM1rOGOSOgA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wMlQxMDowMDo0OVrOGPiBsA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNzYzMTg3Mg==", "bodyText": "elevation is now treated like a global parameter (instead of being different for every vehicle). for one server this is always the case, but in case there were multiple servers some of which do not support elevation this could be a problem?", "url": "https://github.com/graphhopper/graphhopper/pull/2023#discussion_r417631872", "createdAt": "2020-04-29T21:46:33Z", "author": {"login": "easbar"}, "path": "web/src/main/resources/assets/js/graphhopper/GHRequest.js", "diffHunk": "@@ -118,34 +119,60 @@ GHRequest.prototype.getEarliestDepartureTime = function () {\n     return undefined;\n };\n \n-GHRequest.prototype.initVehicle = function (vehicle) {\n-    this.api_params.vehicle = vehicle;\n-    if(this.api_params.elevation !== false) {\n-        var featureSet = this.features[vehicle];\n-        this.api_params.elevation = featureSet && featureSet.elevation;\n-    }\n-    this.hasTCSupport();\n+GHRequest.prototype.setProfile = function (profileName) {\n+    this.api_params.profile = profileName;\n+};\n+\n+GHRequest.prototype.getProfile = function () {\n+    return this.api_params.profile;\n };\n \n-GHRequest.prototype.hasTCSupport = function() {\n-   if(this.api_params.turn_costs !== false) {\n-      var featureSet = this.features[this.api_params.vehicle];\n-      this.api_params.turn_costs = featureSet && featureSet.turn_costs;\n-   }\n+GHRequest.prototype.setElevation = function (elevation) {\n+    this.api_params.elevation = elevation;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "9c646c44a0c54df5532080e4bc66399a9de7e06b"}, "originalPosition": 50}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxODkzOTMxMg==", "bodyText": "Yes, let's keep it this way for now.", "url": "https://github.com/graphhopper/graphhopper/pull/2023#discussion_r418939312", "createdAt": "2020-05-02T10:00:49Z", "author": {"login": "karussell"}, "path": "web/src/main/resources/assets/js/graphhopper/GHRequest.js", "diffHunk": "@@ -118,34 +119,60 @@ GHRequest.prototype.getEarliestDepartureTime = function () {\n     return undefined;\n };\n \n-GHRequest.prototype.initVehicle = function (vehicle) {\n-    this.api_params.vehicle = vehicle;\n-    if(this.api_params.elevation !== false) {\n-        var featureSet = this.features[vehicle];\n-        this.api_params.elevation = featureSet && featureSet.elevation;\n-    }\n-    this.hasTCSupport();\n+GHRequest.prototype.setProfile = function (profileName) {\n+    this.api_params.profile = profileName;\n+};\n+\n+GHRequest.prototype.getProfile = function () {\n+    return this.api_params.profile;\n };\n \n-GHRequest.prototype.hasTCSupport = function() {\n-   if(this.api_params.turn_costs !== false) {\n-      var featureSet = this.features[this.api_params.vehicle];\n-      this.api_params.turn_costs = featureSet && featureSet.turn_costs;\n-   }\n+GHRequest.prototype.setElevation = function (elevation) {\n+    this.api_params.elevation = elevation;", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNzYzMTg3Mg=="}, "originalCommit": {"oid": "9c646c44a0c54df5532080e4bc66399a9de7e06b"}, "originalPosition": 50}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjU5ODUxNTM1OnYy", "diffSide": "RIGHT", "path": "web/src/main/resources/assets/js/graphhopper/GHRequest.js", "isResolved": true, "comments": {"totalCount": 7, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yOVQyMTo0NzoxNVrOGOSPtQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wNVQxMjo0MDoxN1rOGQnc0A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNzYzMjE4MQ==", "bodyText": "@karussell would you mind taking a look at this? I did not manage to fix this and not even sure if this needs to be fixed.", "url": "https://github.com/graphhopper/graphhopper/pull/2023#discussion_r417632181", "createdAt": "2020-04-29T21:47:15Z", "author": {"login": "easbar"}, "path": "web/src/main/resources/assets/js/graphhopper/GHRequest.js", "diffHunk": "@@ -118,34 +119,60 @@ GHRequest.prototype.getEarliestDepartureTime = function () {\n     return undefined;\n };\n \n-GHRequest.prototype.initVehicle = function (vehicle) {\n-    this.api_params.vehicle = vehicle;\n-    if(this.api_params.elevation !== false) {\n-        var featureSet = this.features[vehicle];\n-        this.api_params.elevation = featureSet && featureSet.elevation;\n-    }\n-    this.hasTCSupport();\n+GHRequest.prototype.setProfile = function (profileName) {\n+    this.api_params.profile = profileName;\n+};\n+\n+GHRequest.prototype.getProfile = function () {\n+    return this.api_params.profile;\n };\n \n-GHRequest.prototype.hasTCSupport = function() {\n-   if(this.api_params.turn_costs !== false) {\n-      var featureSet = this.features[this.api_params.vehicle];\n-      this.api_params.turn_costs = featureSet && featureSet.turn_costs;\n-   }\n+GHRequest.prototype.setElevation = function (elevation) {\n+    this.api_params.elevation = elevation;\n };\n \n GHRequest.prototype.hasElevation = function () {\n     return this.api_params.elevation === true;\n };\n \n GHRequest.prototype.getVehicle = function () {\n-    return this.api_params.vehicle;\n+    var profileName = this.api_params.profile;\n+    var profile = this.profiles.find(function(p) { return p.profile_name === profileName; });\n+    if (!profile)\n+        return \"\";\n+    else\n+        return profile.vehicle;\n };\n \n GHRequest.prototype.isPublicTransit = function () {\n-    return this.getVehicle() === \"pt\";\n+    // legacy support: we might have set vehicle=pt instead of pt\n+    return this.getProfile() === \"pt\" || this.getVehicle() === \"pt\";;\n };\n \n+GHRequest.prototype.removeProfileParameterIfLegacyRequest = function() {\n+     // we still allow using legacy parameters to support older urls pasted from somewhere, but when they are used\n+     // we may not add the profile parameter to the url\n+     if (\n+            this.api_params[\"vehicle\"] ||\n+            this.api_params[\"weighting\"] ||\n+            this.api_params[\"turn_costs\"] ||\n+            this.api_params[\"edge_based\"]\n+        ) {\n+            delete this.api_params.profile;\n+        }\n+     // todonow: pasting a legacy url already works the only thing that is ugly is that when we do a normal request\n+     // (including profile) then add something like vehicle=car the the profile parameter appears still in the url field\n+     // (even though it will not be sent to the server). when we drag a marker afterwards it finally disappears, how can\n+     // we do this already here?", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "9c646c44a0c54df5532080e4bc66399a9de7e06b"}, "originalPosition": 87}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxODk5MTAzMg==", "bodyText": "URL rewriting is only done after the request. But I'm not exactly sure what you mean here. And shouldn't we remove the vehicle parameter from the URL if vehicle and profile parameter exist in the URL?", "url": "https://github.com/graphhopper/graphhopper/pull/2023#discussion_r418991032", "createdAt": "2020-05-02T18:22:30Z", "author": {"login": "karussell"}, "path": "web/src/main/resources/assets/js/graphhopper/GHRequest.js", "diffHunk": "@@ -118,34 +119,60 @@ GHRequest.prototype.getEarliestDepartureTime = function () {\n     return undefined;\n };\n \n-GHRequest.prototype.initVehicle = function (vehicle) {\n-    this.api_params.vehicle = vehicle;\n-    if(this.api_params.elevation !== false) {\n-        var featureSet = this.features[vehicle];\n-        this.api_params.elevation = featureSet && featureSet.elevation;\n-    }\n-    this.hasTCSupport();\n+GHRequest.prototype.setProfile = function (profileName) {\n+    this.api_params.profile = profileName;\n+};\n+\n+GHRequest.prototype.getProfile = function () {\n+    return this.api_params.profile;\n };\n \n-GHRequest.prototype.hasTCSupport = function() {\n-   if(this.api_params.turn_costs !== false) {\n-      var featureSet = this.features[this.api_params.vehicle];\n-      this.api_params.turn_costs = featureSet && featureSet.turn_costs;\n-   }\n+GHRequest.prototype.setElevation = function (elevation) {\n+    this.api_params.elevation = elevation;\n };\n \n GHRequest.prototype.hasElevation = function () {\n     return this.api_params.elevation === true;\n };\n \n GHRequest.prototype.getVehicle = function () {\n-    return this.api_params.vehicle;\n+    var profileName = this.api_params.profile;\n+    var profile = this.profiles.find(function(p) { return p.profile_name === profileName; });\n+    if (!profile)\n+        return \"\";\n+    else\n+        return profile.vehicle;\n };\n \n GHRequest.prototype.isPublicTransit = function () {\n-    return this.getVehicle() === \"pt\";\n+    // legacy support: we might have set vehicle=pt instead of pt\n+    return this.getProfile() === \"pt\" || this.getVehicle() === \"pt\";;\n };\n \n+GHRequest.prototype.removeProfileParameterIfLegacyRequest = function() {\n+     // we still allow using legacy parameters to support older urls pasted from somewhere, but when they are used\n+     // we may not add the profile parameter to the url\n+     if (\n+            this.api_params[\"vehicle\"] ||\n+            this.api_params[\"weighting\"] ||\n+            this.api_params[\"turn_costs\"] ||\n+            this.api_params[\"edge_based\"]\n+        ) {\n+            delete this.api_params.profile;\n+        }\n+     // todonow: pasting a legacy url already works the only thing that is ugly is that when we do a normal request\n+     // (including profile) then add something like vehicle=car the the profile parameter appears still in the url field\n+     // (even though it will not be sent to the server). when we drag a marker afterwards it finally disappears, how can\n+     // we do this already here?", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNzYzMjE4MQ=="}, "originalCommit": {"oid": "9c646c44a0c54df5532080e4bc66399a9de7e06b"}, "originalPosition": 87}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxOTI3NjQ2MQ==", "bodyText": "the problem is this:\n\nuse the UI (profile will be in the address line)\nmanually add something like vehicle=car and press enter\nthe profile will not be sent to the server (only the vehicle), but the address line is not updated accordingly\nmove a marker. same as 3) but this time the profile is removed from the address line\n\n\nAnd shouldn't we remove the vehicle parameter from the URL if vehicle and profile parameter exist in the URL?\n\nYes that sounds right. So we only support 'real' legacy requests (without profile) and the (now) standard (including (only) a profile). I probably tried this but ran into similar problems as above?", "url": "https://github.com/graphhopper/graphhopper/pull/2023#discussion_r419276461", "createdAt": "2020-05-04T08:17:23Z", "author": {"login": "easbar"}, "path": "web/src/main/resources/assets/js/graphhopper/GHRequest.js", "diffHunk": "@@ -118,34 +119,60 @@ GHRequest.prototype.getEarliestDepartureTime = function () {\n     return undefined;\n };\n \n-GHRequest.prototype.initVehicle = function (vehicle) {\n-    this.api_params.vehicle = vehicle;\n-    if(this.api_params.elevation !== false) {\n-        var featureSet = this.features[vehicle];\n-        this.api_params.elevation = featureSet && featureSet.elevation;\n-    }\n-    this.hasTCSupport();\n+GHRequest.prototype.setProfile = function (profileName) {\n+    this.api_params.profile = profileName;\n+};\n+\n+GHRequest.prototype.getProfile = function () {\n+    return this.api_params.profile;\n };\n \n-GHRequest.prototype.hasTCSupport = function() {\n-   if(this.api_params.turn_costs !== false) {\n-      var featureSet = this.features[this.api_params.vehicle];\n-      this.api_params.turn_costs = featureSet && featureSet.turn_costs;\n-   }\n+GHRequest.prototype.setElevation = function (elevation) {\n+    this.api_params.elevation = elevation;\n };\n \n GHRequest.prototype.hasElevation = function () {\n     return this.api_params.elevation === true;\n };\n \n GHRequest.prototype.getVehicle = function () {\n-    return this.api_params.vehicle;\n+    var profileName = this.api_params.profile;\n+    var profile = this.profiles.find(function(p) { return p.profile_name === profileName; });\n+    if (!profile)\n+        return \"\";\n+    else\n+        return profile.vehicle;\n };\n \n GHRequest.prototype.isPublicTransit = function () {\n-    return this.getVehicle() === \"pt\";\n+    // legacy support: we might have set vehicle=pt instead of pt\n+    return this.getProfile() === \"pt\" || this.getVehicle() === \"pt\";;\n };\n \n+GHRequest.prototype.removeProfileParameterIfLegacyRequest = function() {\n+     // we still allow using legacy parameters to support older urls pasted from somewhere, but when they are used\n+     // we may not add the profile parameter to the url\n+     if (\n+            this.api_params[\"vehicle\"] ||\n+            this.api_params[\"weighting\"] ||\n+            this.api_params[\"turn_costs\"] ||\n+            this.api_params[\"edge_based\"]\n+        ) {\n+            delete this.api_params.profile;\n+        }\n+     // todonow: pasting a legacy url already works the only thing that is ugly is that when we do a normal request\n+     // (including profile) then add something like vehicle=car the the profile parameter appears still in the url field\n+     // (even though it will not be sent to the server). when we drag a marker afterwards it finally disappears, how can\n+     // we do this already here?", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNzYzMjE4MQ=="}, "originalCommit": {"oid": "9c646c44a0c54df5532080e4bc66399a9de7e06b"}, "originalPosition": 87}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxOTMwOTM4OA==", "bodyText": "manually add something like vehicle=car and press enter\n\nAh, ok. Then this is not a legacy use case and either the profile parameter needs to be removed or instead of the vehicle the profile needs to be changed.\n\nSo we only support 'real' legacy requests (without profile) and the (now) standard (including (only) a profile)\n\nYes\n\nI probably tried this but ran into similar problems as above?\n\nUnfortunately I was not able to reproduce this mixture (yet) using a \"purely\" legacy URL.", "url": "https://github.com/graphhopper/graphhopper/pull/2023#discussion_r419309388", "createdAt": "2020-05-04T09:21:28Z", "author": {"login": "karussell"}, "path": "web/src/main/resources/assets/js/graphhopper/GHRequest.js", "diffHunk": "@@ -118,34 +119,60 @@ GHRequest.prototype.getEarliestDepartureTime = function () {\n     return undefined;\n };\n \n-GHRequest.prototype.initVehicle = function (vehicle) {\n-    this.api_params.vehicle = vehicle;\n-    if(this.api_params.elevation !== false) {\n-        var featureSet = this.features[vehicle];\n-        this.api_params.elevation = featureSet && featureSet.elevation;\n-    }\n-    this.hasTCSupport();\n+GHRequest.prototype.setProfile = function (profileName) {\n+    this.api_params.profile = profileName;\n+};\n+\n+GHRequest.prototype.getProfile = function () {\n+    return this.api_params.profile;\n };\n \n-GHRequest.prototype.hasTCSupport = function() {\n-   if(this.api_params.turn_costs !== false) {\n-      var featureSet = this.features[this.api_params.vehicle];\n-      this.api_params.turn_costs = featureSet && featureSet.turn_costs;\n-   }\n+GHRequest.prototype.setElevation = function (elevation) {\n+    this.api_params.elevation = elevation;\n };\n \n GHRequest.prototype.hasElevation = function () {\n     return this.api_params.elevation === true;\n };\n \n GHRequest.prototype.getVehicle = function () {\n-    return this.api_params.vehicle;\n+    var profileName = this.api_params.profile;\n+    var profile = this.profiles.find(function(p) { return p.profile_name === profileName; });\n+    if (!profile)\n+        return \"\";\n+    else\n+        return profile.vehicle;\n };\n \n GHRequest.prototype.isPublicTransit = function () {\n-    return this.getVehicle() === \"pt\";\n+    // legacy support: we might have set vehicle=pt instead of pt\n+    return this.getProfile() === \"pt\" || this.getVehicle() === \"pt\";;\n };\n \n+GHRequest.prototype.removeProfileParameterIfLegacyRequest = function() {\n+     // we still allow using legacy parameters to support older urls pasted from somewhere, but when they are used\n+     // we may not add the profile parameter to the url\n+     if (\n+            this.api_params[\"vehicle\"] ||\n+            this.api_params[\"weighting\"] ||\n+            this.api_params[\"turn_costs\"] ||\n+            this.api_params[\"edge_based\"]\n+        ) {\n+            delete this.api_params.profile;\n+        }\n+     // todonow: pasting a legacy url already works the only thing that is ugly is that when we do a normal request\n+     // (including profile) then add something like vehicle=car the the profile parameter appears still in the url field\n+     // (even though it will not be sent to the server). when we drag a marker afterwards it finally disappears, how can\n+     // we do this already here?", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNzYzMjE4MQ=="}, "originalCommit": {"oid": "9c646c44a0c54df5532080e4bc66399a9de7e06b"}, "originalPosition": 87}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxOTMxMTQ0Mw==", "bodyText": "Ah, ok. Then this is not a legacy use case and either the profile parameter needs to be removed or instead of the vehicle the profile needs to be changed.\n\nYeah its really a very minor issue / very exotic '(mis)-use-case'. I was just annoyed by the fact that moving the marker does something that pressing enter does not do. Even when doing this (add vehicle to a profile url manually) the UI keeps working (using the vehicle), it just does not remove the profile from the url (and yes maybe it would better remove the vehicle in this case but this is probably the same problem).", "url": "https://github.com/graphhopper/graphhopper/pull/2023#discussion_r419311443", "createdAt": "2020-05-04T09:25:26Z", "author": {"login": "easbar"}, "path": "web/src/main/resources/assets/js/graphhopper/GHRequest.js", "diffHunk": "@@ -118,34 +119,60 @@ GHRequest.prototype.getEarliestDepartureTime = function () {\n     return undefined;\n };\n \n-GHRequest.prototype.initVehicle = function (vehicle) {\n-    this.api_params.vehicle = vehicle;\n-    if(this.api_params.elevation !== false) {\n-        var featureSet = this.features[vehicle];\n-        this.api_params.elevation = featureSet && featureSet.elevation;\n-    }\n-    this.hasTCSupport();\n+GHRequest.prototype.setProfile = function (profileName) {\n+    this.api_params.profile = profileName;\n+};\n+\n+GHRequest.prototype.getProfile = function () {\n+    return this.api_params.profile;\n };\n \n-GHRequest.prototype.hasTCSupport = function() {\n-   if(this.api_params.turn_costs !== false) {\n-      var featureSet = this.features[this.api_params.vehicle];\n-      this.api_params.turn_costs = featureSet && featureSet.turn_costs;\n-   }\n+GHRequest.prototype.setElevation = function (elevation) {\n+    this.api_params.elevation = elevation;\n };\n \n GHRequest.prototype.hasElevation = function () {\n     return this.api_params.elevation === true;\n };\n \n GHRequest.prototype.getVehicle = function () {\n-    return this.api_params.vehicle;\n+    var profileName = this.api_params.profile;\n+    var profile = this.profiles.find(function(p) { return p.profile_name === profileName; });\n+    if (!profile)\n+        return \"\";\n+    else\n+        return profile.vehicle;\n };\n \n GHRequest.prototype.isPublicTransit = function () {\n-    return this.getVehicle() === \"pt\";\n+    // legacy support: we might have set vehicle=pt instead of pt\n+    return this.getProfile() === \"pt\" || this.getVehicle() === \"pt\";;\n };\n \n+GHRequest.prototype.removeProfileParameterIfLegacyRequest = function() {\n+     // we still allow using legacy parameters to support older urls pasted from somewhere, but when they are used\n+     // we may not add the profile parameter to the url\n+     if (\n+            this.api_params[\"vehicle\"] ||\n+            this.api_params[\"weighting\"] ||\n+            this.api_params[\"turn_costs\"] ||\n+            this.api_params[\"edge_based\"]\n+        ) {\n+            delete this.api_params.profile;\n+        }\n+     // todonow: pasting a legacy url already works the only thing that is ugly is that when we do a normal request\n+     // (including profile) then add something like vehicle=car the the profile parameter appears still in the url field\n+     // (even though it will not be sent to the server). when we drag a marker afterwards it finally disappears, how can\n+     // we do this already here?", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNzYzMjE4MQ=="}, "originalCommit": {"oid": "9c646c44a0c54df5532080e4bc66399a9de7e06b"}, "originalPosition": 87}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMDA1OTM0NQ==", "bodyText": "Shall we do anything about this?", "url": "https://github.com/graphhopper/graphhopper/pull/2023#discussion_r420059345", "createdAt": "2020-05-05T12:09:14Z", "author": {"login": "easbar"}, "path": "web/src/main/resources/assets/js/graphhopper/GHRequest.js", "diffHunk": "@@ -118,34 +119,60 @@ GHRequest.prototype.getEarliestDepartureTime = function () {\n     return undefined;\n };\n \n-GHRequest.prototype.initVehicle = function (vehicle) {\n-    this.api_params.vehicle = vehicle;\n-    if(this.api_params.elevation !== false) {\n-        var featureSet = this.features[vehicle];\n-        this.api_params.elevation = featureSet && featureSet.elevation;\n-    }\n-    this.hasTCSupport();\n+GHRequest.prototype.setProfile = function (profileName) {\n+    this.api_params.profile = profileName;\n+};\n+\n+GHRequest.prototype.getProfile = function () {\n+    return this.api_params.profile;\n };\n \n-GHRequest.prototype.hasTCSupport = function() {\n-   if(this.api_params.turn_costs !== false) {\n-      var featureSet = this.features[this.api_params.vehicle];\n-      this.api_params.turn_costs = featureSet && featureSet.turn_costs;\n-   }\n+GHRequest.prototype.setElevation = function (elevation) {\n+    this.api_params.elevation = elevation;\n };\n \n GHRequest.prototype.hasElevation = function () {\n     return this.api_params.elevation === true;\n };\n \n GHRequest.prototype.getVehicle = function () {\n-    return this.api_params.vehicle;\n+    var profileName = this.api_params.profile;\n+    var profile = this.profiles.find(function(p) { return p.profile_name === profileName; });\n+    if (!profile)\n+        return \"\";\n+    else\n+        return profile.vehicle;\n };\n \n GHRequest.prototype.isPublicTransit = function () {\n-    return this.getVehicle() === \"pt\";\n+    // legacy support: we might have set vehicle=pt instead of pt\n+    return this.getProfile() === \"pt\" || this.getVehicle() === \"pt\";;\n };\n \n+GHRequest.prototype.removeProfileParameterIfLegacyRequest = function() {\n+     // we still allow using legacy parameters to support older urls pasted from somewhere, but when they are used\n+     // we may not add the profile parameter to the url\n+     if (\n+            this.api_params[\"vehicle\"] ||\n+            this.api_params[\"weighting\"] ||\n+            this.api_params[\"turn_costs\"] ||\n+            this.api_params[\"edge_based\"]\n+        ) {\n+            delete this.api_params.profile;\n+        }\n+     // todonow: pasting a legacy url already works the only thing that is ugly is that when we do a normal request\n+     // (including profile) then add something like vehicle=car the the profile parameter appears still in the url field\n+     // (even though it will not be sent to the server). when we drag a marker afterwards it finally disappears, how can\n+     // we do this already here?", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNzYzMjE4MQ=="}, "originalCommit": {"oid": "9c646c44a0c54df5532080e4bc66399a9de7e06b"}, "originalPosition": 87}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMDA3Njc1Mg==", "bodyText": "I tried to deploy this code to production and had a problem that although only profile=car was specified in the URL still the weighting was added in the request (resulting in an error). It could be that this is some internal problem as the /info endpoint is not yet updated. Will need to investigate this further but we can also merge here and fix later.", "url": "https://github.com/graphhopper/graphhopper/pull/2023#discussion_r420076752", "createdAt": "2020-05-05T12:40:17Z", "author": {"login": "karussell"}, "path": "web/src/main/resources/assets/js/graphhopper/GHRequest.js", "diffHunk": "@@ -118,34 +119,60 @@ GHRequest.prototype.getEarliestDepartureTime = function () {\n     return undefined;\n };\n \n-GHRequest.prototype.initVehicle = function (vehicle) {\n-    this.api_params.vehicle = vehicle;\n-    if(this.api_params.elevation !== false) {\n-        var featureSet = this.features[vehicle];\n-        this.api_params.elevation = featureSet && featureSet.elevation;\n-    }\n-    this.hasTCSupport();\n+GHRequest.prototype.setProfile = function (profileName) {\n+    this.api_params.profile = profileName;\n+};\n+\n+GHRequest.prototype.getProfile = function () {\n+    return this.api_params.profile;\n };\n \n-GHRequest.prototype.hasTCSupport = function() {\n-   if(this.api_params.turn_costs !== false) {\n-      var featureSet = this.features[this.api_params.vehicle];\n-      this.api_params.turn_costs = featureSet && featureSet.turn_costs;\n-   }\n+GHRequest.prototype.setElevation = function (elevation) {\n+    this.api_params.elevation = elevation;\n };\n \n GHRequest.prototype.hasElevation = function () {\n     return this.api_params.elevation === true;\n };\n \n GHRequest.prototype.getVehicle = function () {\n-    return this.api_params.vehicle;\n+    var profileName = this.api_params.profile;\n+    var profile = this.profiles.find(function(p) { return p.profile_name === profileName; });\n+    if (!profile)\n+        return \"\";\n+    else\n+        return profile.vehicle;\n };\n \n GHRequest.prototype.isPublicTransit = function () {\n-    return this.getVehicle() === \"pt\";\n+    // legacy support: we might have set vehicle=pt instead of pt\n+    return this.getProfile() === \"pt\" || this.getVehicle() === \"pt\";;\n };\n \n+GHRequest.prototype.removeProfileParameterIfLegacyRequest = function() {\n+     // we still allow using legacy parameters to support older urls pasted from somewhere, but when they are used\n+     // we may not add the profile parameter to the url\n+     if (\n+            this.api_params[\"vehicle\"] ||\n+            this.api_params[\"weighting\"] ||\n+            this.api_params[\"turn_costs\"] ||\n+            this.api_params[\"edge_based\"]\n+        ) {\n+            delete this.api_params.profile;\n+        }\n+     // todonow: pasting a legacy url already works the only thing that is ugly is that when we do a normal request\n+     // (including profile) then add something like vehicle=car the the profile parameter appears still in the url field\n+     // (even though it will not be sent to the server). when we drag a marker afterwards it finally disappears, how can\n+     // we do this already here?", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNzYzMjE4MQ=="}, "originalCommit": {"oid": "9c646c44a0c54df5532080e4bc66399a9de7e06b"}, "originalPosition": 87}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjU5ODUxNjgxOnYy", "diffSide": "RIGHT", "path": "web/src/main/resources/assets/js/graphhopper/GHRequest.js", "isResolved": true, "comments": {"totalCount": 7, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yOVQyMTo0Nzo0NlrOGOSQmQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wNFQwOTowMDoyOVrOGP39_A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNzYzMjQwOQ==", "bodyText": "this can be used to recognize that a request was sent using this client", "url": "https://github.com/graphhopper/graphhopper/pull/2023#discussion_r417632409", "createdAt": "2020-04-29T21:47:46Z", "author": {"login": "easbar"}, "path": "web/src/main/resources/assets/js/graphhopper/GHRequest.js", "diffHunk": "@@ -232,6 +259,10 @@ GHRequest.prototype.doRequest = function (url, callback) {\n     $.ajax({\n         timeout: 30000,\n         url: url,\n+        beforeSend: function(request) {\n+            // todonow: maybe rename\n+            request.setRequestHeader(\"gh-client\", \"web-ui\")", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "9c646c44a0c54df5532080e4bc66399a9de7e06b"}, "originalPosition": 106}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxODkzOTUwMw==", "bodyText": "Good idea. Is there a way we could include some version? And isn't it usually called \"User-Agent\" ... ah, no, this will collide with browser version etc.", "url": "https://github.com/graphhopper/graphhopper/pull/2023#discussion_r418939503", "createdAt": "2020-05-02T10:02:48Z", "author": {"login": "karussell"}, "path": "web/src/main/resources/assets/js/graphhopper/GHRequest.js", "diffHunk": "@@ -232,6 +259,10 @@ GHRequest.prototype.doRequest = function (url, callback) {\n     $.ajax({\n         timeout: 30000,\n         url: url,\n+        beforeSend: function(request) {\n+            // todonow: maybe rename\n+            request.setRequestHeader(\"gh-client\", \"web-ui\")", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNzYzMjQwOQ=="}, "originalCommit": {"oid": "9c646c44a0c54df5532080e4bc66399a9de7e06b"}, "originalPosition": 106}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxOTI3Nzk5NQ==", "bodyText": "Is there a way we could include some version?\n\nSure we could add another header with a version. Would be nice to get this via maven or even git commit hash or tag during from the build process? Or simply hard-code it ;)\n\nAnd isn't it usually called \"User-Agent\"\n\nYeah I think user-agent is used for browser version, using a custom / non-standard header for what we want to achieve here seems reasonable to me", "url": "https://github.com/graphhopper/graphhopper/pull/2023#discussion_r419277995", "createdAt": "2020-05-04T08:20:25Z", "author": {"login": "easbar"}, "path": "web/src/main/resources/assets/js/graphhopper/GHRequest.js", "diffHunk": "@@ -232,6 +259,10 @@ GHRequest.prototype.doRequest = function (url, callback) {\n     $.ajax({\n         timeout: 30000,\n         url: url,\n+        beforeSend: function(request) {\n+            // todonow: maybe rename\n+            request.setRequestHeader(\"gh-client\", \"web-ui\")", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNzYzMjQwOQ=="}, "originalCommit": {"oid": "9c646c44a0c54df5532080e4bc66399a9de7e06b"}, "originalPosition": 106}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxOTI4NTY1OA==", "bodyText": "Would be nice to get this via maven or even git commit hash or tag during from the build process?\n\nAh, yes. This sounds doable but for a later issue ;)", "url": "https://github.com/graphhopper/graphhopper/pull/2023#discussion_r419285658", "createdAt": "2020-05-04T08:35:32Z", "author": {"login": "karussell"}, "path": "web/src/main/resources/assets/js/graphhopper/GHRequest.js", "diffHunk": "@@ -232,6 +259,10 @@ GHRequest.prototype.doRequest = function (url, callback) {\n     $.ajax({\n         timeout: 30000,\n         url: url,\n+        beforeSend: function(request) {\n+            // todonow: maybe rename\n+            request.setRequestHeader(\"gh-client\", \"web-ui\")", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNzYzMjQwOQ=="}, "originalCommit": {"oid": "9c646c44a0c54df5532080e4bc66399a9de7e06b"}, "originalPosition": 106}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxOTI4NzAwNg==", "bodyText": "I would not recommend overwriting the User-Agent.\nIIRC a lot of browsers don't allow that, also some CDNs/Firewalls might check that string and if it looks tempered they might assume something funny is going on and potentially block the request.", "url": "https://github.com/graphhopper/graphhopper/pull/2023#discussion_r419287006", "createdAt": "2020-05-04T08:38:06Z", "author": {"login": "boldtrn"}, "path": "web/src/main/resources/assets/js/graphhopper/GHRequest.js", "diffHunk": "@@ -232,6 +259,10 @@ GHRequest.prototype.doRequest = function (url, callback) {\n     $.ajax({\n         timeout: 30000,\n         url: url,\n+        beforeSend: function(request) {\n+            // todonow: maybe rename\n+            request.setRequestHeader(\"gh-client\", \"web-ui\")", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNzYzMjQwOQ=="}, "originalCommit": {"oid": "9c646c44a0c54df5532080e4bc66399a9de7e06b"}, "originalPosition": 106}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxOTI5NTUzNg==", "bodyText": "Ah, yes. This sounds doable but for a later issue ;)\n\nWe could still hard-code it for now, that would be more information than not sending any version (even though it might be outdated sometimes) :)", "url": "https://github.com/graphhopper/graphhopper/pull/2023#discussion_r419295536", "createdAt": "2020-05-04T08:54:05Z", "author": {"login": "easbar"}, "path": "web/src/main/resources/assets/js/graphhopper/GHRequest.js", "diffHunk": "@@ -232,6 +259,10 @@ GHRequest.prototype.doRequest = function (url, callback) {\n     $.ajax({\n         timeout: 30000,\n         url: url,\n+        beforeSend: function(request) {\n+            // todonow: maybe rename\n+            request.setRequestHeader(\"gh-client\", \"web-ui\")", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNzYzMjQwOQ=="}, "originalCommit": {"oid": "9c646c44a0c54df5532080e4bc66399a9de7e06b"}, "originalPosition": 106}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxOTI5ODgxMg==", "bodyText": "You could take a look at the buildnumber maven plugin: https://www.mojohaus.org/buildnumber-maven-plugin/usage.html", "url": "https://github.com/graphhopper/graphhopper/pull/2023#discussion_r419298812", "createdAt": "2020-05-04T09:00:29Z", "author": {"login": "otbutz"}, "path": "web/src/main/resources/assets/js/graphhopper/GHRequest.js", "diffHunk": "@@ -232,6 +259,10 @@ GHRequest.prototype.doRequest = function (url, callback) {\n     $.ajax({\n         timeout: 30000,\n         url: url,\n+        beforeSend: function(request) {\n+            // todonow: maybe rename\n+            request.setRequestHeader(\"gh-client\", \"web-ui\")", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNzYzMjQwOQ=="}, "originalCommit": {"oid": "9c646c44a0c54df5532080e4bc66399a9de7e06b"}, "originalPosition": 106}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjU5ODUxNzcyOnYy", "diffSide": "LEFT", "path": "web/src/main/resources/assets/js/main-template.js", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yOVQyMTo0ODowN1rOGOSRKQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yOVQyMTo0ODowN1rOGOSRKQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNzYzMjU1Mw==", "bodyText": "this can probably be done server-side (using the header telling us the request comes from the client)", "url": "https://github.com/graphhopper/graphhopper/pull/2023#discussion_r417632553", "createdAt": "2020-04-29T21:48:07Z", "author": {"login": "easbar"}, "path": "web/src/main/resources/assets/js/main-template.js", "diffHunk": "@@ -34,11 +34,6 @@ if (ghenv.environment === 'development') {\n     var autocomplete = AutoComplete.prototype.createStub();\n } else {\n     var autocomplete = new AutoComplete(ghenv.geocoding.host, ghenv.geocoding.api_key);\n-    // overwrite default for production\n-    GHRequest.prototype.hasTCSupport = function() {\n-       if(this.api_params.turn_costs !== false)\n-          this.api_params.turn_costs = new Set([\"car\", \"truck\", \"small_truck\", \"scooter\"]).has(this.api_params.vehicle);\n-    };", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "9c646c44a0c54df5532080e4bc66399a9de7e06b"}, "originalPosition": 8}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjU5ODUyMzU0OnYy", "diffSide": "RIGHT", "path": "web/src/main/resources/assets/js/main-template.js", "isResolved": true, "comments": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yOVQyMTo1MDowN1rOGOSU7g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wNFQwOTowNDozMFrOGP4FvQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNzYzMzUxOA==", "bodyText": "Any better idea? For profile names like my_special_super_car we will get something like \"web.my_special_super_car (my_special_super_car)\"...", "url": "https://github.com/graphhopper/graphhopper/pull/2023#discussion_r417633518", "createdAt": "2020-04-29T21:50:07Z", "author": {"login": "easbar"}, "path": "web/src/main/resources/assets/js/main-template.js", "diffHunk": "@@ -239,6 +252,17 @@ $(document).ready(function (e) {\n     checkInput();\n });\n \n+function profileDisplayName(profileName) {\n+   return translate.tr(profileName) + ' (' + profileName + ')'", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "9c646c44a0c54df5532080e4bc66399a9de7e06b"}, "originalPosition": 130}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxODkzOTI1Nw==", "bodyText": "I would remove the info in brackets or why would you add it?", "url": "https://github.com/graphhopper/graphhopper/pull/2023#discussion_r418939257", "createdAt": "2020-05-02T10:00:13Z", "author": {"login": "karussell"}, "path": "web/src/main/resources/assets/js/main-template.js", "diffHunk": "@@ -239,6 +252,17 @@ $(document).ready(function (e) {\n     checkInput();\n });\n \n+function profileDisplayName(profileName) {\n+   return translate.tr(profileName) + ' (' + profileName + ')'", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNzYzMzUxOA=="}, "originalCommit": {"oid": "9c646c44a0c54df5532080e4bc66399a9de7e06b"}, "originalPosition": 130}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxOTI3OTMzNw==", "bodyText": "Initially I was concerned that some non-standard custom names cannot be translated, but you are right probably just one of the two is enough. If we remove the info in brackets we would get something like web.my_special_car for non-standard names, and something like Auto for standard-names like car. This could be slightly improved by removing the web. for non-standard names. Is this what you mean?", "url": "https://github.com/graphhopper/graphhopper/pull/2023#discussion_r419279337", "createdAt": "2020-05-04T08:23:15Z", "author": {"login": "easbar"}, "path": "web/src/main/resources/assets/js/main-template.js", "diffHunk": "@@ -239,6 +252,17 @@ $(document).ready(function (e) {\n     checkInput();\n });\n \n+function profileDisplayName(profileName) {\n+   return translate.tr(profileName) + ' (' + profileName + ')'", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNzYzMzUxOA=="}, "originalCommit": {"oid": "9c646c44a0c54df5532080e4bc66399a9de7e06b"}, "originalPosition": 130}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxOTI4NTkyMw==", "bodyText": "Yes", "url": "https://github.com/graphhopper/graphhopper/pull/2023#discussion_r419285923", "createdAt": "2020-05-04T08:35:59Z", "author": {"login": "karussell"}, "path": "web/src/main/resources/assets/js/main-template.js", "diffHunk": "@@ -239,6 +252,17 @@ $(document).ready(function (e) {\n     checkInput();\n });\n \n+function profileDisplayName(profileName) {\n+   return translate.tr(profileName) + ' (' + profileName + ')'", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNzYzMzUxOA=="}, "originalCommit": {"oid": "9c646c44a0c54df5532080e4bc66399a9de7e06b"}, "originalPosition": 130}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxOTMwMDc5Nw==", "bodyText": "Cool yes this is better, done.", "url": "https://github.com/graphhopper/graphhopper/pull/2023#discussion_r419300797", "createdAt": "2020-05-04T09:04:30Z", "author": {"login": "easbar"}, "path": "web/src/main/resources/assets/js/main-template.js", "diffHunk": "@@ -239,6 +252,17 @@ $(document).ready(function (e) {\n     checkInput();\n });\n \n+function profileDisplayName(profileName) {\n+   return translate.tr(profileName) + ' (' + profileName + ')'", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNzYzMzUxOA=="}, "originalCommit": {"oid": "9c646c44a0c54df5532080e4bc66399a9de7e06b"}, "originalPosition": 130}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjYwNzY3NTIwOnYy", "diffSide": "RIGHT", "path": "web-bundle/src/main/java/com/graphhopper/http/PtRedirectFilter.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wMlQxOToyMzoxOVrOGPlkVQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wNFQwODoyNDo1NVrOGP21gA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxODk5NzMzMw==", "bodyText": "this could be a bit shorter ;)\nreturn \"pt\".equals(maybeProfile)\nAnd should we also remove the profile param in the filter method above? (replaceQueryParam(\"profile\"))", "url": "https://github.com/graphhopper/graphhopper/pull/2023#discussion_r418997333", "createdAt": "2020-05-02T19:23:19Z", "author": {"login": "karussell"}, "path": "web-bundle/src/main/java/com/graphhopper/http/PtRedirectFilter.java", "diffHunk": "@@ -40,6 +40,13 @@ public void filter(ContainerRequestContext requestContext) {\n \n     private boolean shouldRedirect(ContainerRequestContext requestContext) {\n         String maybeVehicle = requestContext.getUriInfo().getQueryParameters().getFirst(\"vehicle\");\n-        return maybeVehicle != null && maybeVehicle.equals(\"pt\");\n+        if (maybeVehicle != null && maybeVehicle.equals(\"pt\")) {\n+            return true;\n+        }\n+        String maybeProfile = requestContext.getUriInfo().getQueryParameters().getFirst(\"profile\");\n+        if (maybeProfile != null && maybeProfile.equals(\"pt\")) {\n+            return true;\n+        }\n+        return false;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "5020b7e2e89d9fb4f3b2af7630bbdaf0cb168819"}, "originalPosition": 12}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxOTI4MDI1Ng==", "bodyText": "this could be a bit shorter ;) return \"pt\".equals(maybeProfile)\n\nAh yes I was trying to keep the symmetry :)\n\nAnd should we also remove the profile param in the filter method above?\n\nGood idea, yes, I think so.", "url": "https://github.com/graphhopper/graphhopper/pull/2023#discussion_r419280256", "createdAt": "2020-05-04T08:24:55Z", "author": {"login": "easbar"}, "path": "web-bundle/src/main/java/com/graphhopper/http/PtRedirectFilter.java", "diffHunk": "@@ -40,6 +40,13 @@ public void filter(ContainerRequestContext requestContext) {\n \n     private boolean shouldRedirect(ContainerRequestContext requestContext) {\n         String maybeVehicle = requestContext.getUriInfo().getQueryParameters().getFirst(\"vehicle\");\n-        return maybeVehicle != null && maybeVehicle.equals(\"pt\");\n+        if (maybeVehicle != null && maybeVehicle.equals(\"pt\")) {\n+            return true;\n+        }\n+        String maybeProfile = requestContext.getUriInfo().getQueryParameters().getFirst(\"profile\");\n+        if (maybeProfile != null && maybeProfile.equals(\"pt\")) {\n+            return true;\n+        }\n+        return false;", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxODk5NzMzMw=="}, "originalCommit": {"oid": "5020b7e2e89d9fb4f3b2af7630bbdaf0cb168819"}, "originalPosition": 12}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4801, "cost": 1, "resetAt": "2021-11-12T20:28:25Z"}}}