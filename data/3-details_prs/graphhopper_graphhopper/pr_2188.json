{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTI2NTc5MDQ3", "number": 2188, "title": "Refactor spatialrule border handling", "bodyText": "intersection free border polygons with admin level 2\nonly keep intersections of border polygons with the max bbox\nrefactored CountriesSpatialRuleFactory", "createdAt": "2020-11-24T15:47:27Z", "url": "https://github.com/graphhopper/graphhopper/pull/2188", "merged": true, "mergeCommit": {"oid": "76a22e1222dd090025393a81a9c18cb40456923d"}, "closed": true, "closedAt": "2020-11-30T14:35:30Z", "author": {"login": "otbutz"}, "timelineItems": {"totalCount": 16, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdfqrWZgH2gAyNTI2NTc5MDQ3OmQxOTViOTkzNmU0MzgyNjUyN2NhMmVhMDBmMWZhMGZiNTcyZjI0NWY=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdgTzdegH2gAyNTI2NTc5MDQ3OmY3YjE3NDM4YTExN2I3YmNkMTRhNTc5ZDUzNTRlMDJkODUzOGI2NjQ=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "d195b9936e43826527ca2ea00f1fa0fb572f245f", "author": {"user": null}, "url": "https://github.com/graphhopper/graphhopper/commit/d195b9936e43826527ca2ea00f1fa0fb572f245f", "committedDate": "2020-11-24T14:32:15Z", "message": "Move SpatialRuleFactory into its own file"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "6da48c3b235c538e6fb45816c86e38cc95970246", "author": {"user": null}, "url": "https://github.com/graphhopper/graphhopper/commit/6da48c3b235c538e6fb45816c86e38cc95970246", "committedDate": "2020-11-24T14:32:25Z", "message": "Directly use an envelope"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTM3Nzc2ODY0", "url": "https://github.com/graphhopper/graphhopper/pull/2188#pullrequestreview-537776864", "createdAt": "2020-11-24T18:05:08Z", "commit": {"oid": "d6c6925b68856c96ffff685f7311de66b9166bb1"}, "state": "APPROVED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0yNFQxODowNTowOFrOH5O_zw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0yNFQxODo0ODowMVrOH5Qk2Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyOTc3NjU5MQ==", "bodyText": "This change should be included in the changelog.\nAnd is this used elsewhere or why did you make it public? E.g. it could be used in Measurement?", "url": "https://github.com/graphhopper/graphhopper/pull/2188#discussion_r529776591", "createdAt": "2020-11-24T18:05:08Z", "author": {"login": "karussell"}, "path": "core/src/main/java/com/graphhopper/routing/util/spatialrules/SpatialRuleLookupHelper.java", "diffHunk": "@@ -41,7 +41,7 @@\n public class SpatialRuleLookupHelper {\n \n     private static final Logger logger = LoggerFactory.getLogger(SpatialRuleLookupHelper.class);\n-    static String JSON_ID_FIELD = \"ISO_A3\";\n+    public static String JSON_ID_FIELD = \"ISO3166-1:alpha3\";", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d6c6925b68856c96ffff685f7311de66b9166bb1"}, "originalPosition": 5}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyOTgwMjQ1Nw==", "bodyText": "Why is this necessary and not just borders.add(intersection)? Isn't intersection always a Polygon?", "url": "https://github.com/graphhopper/graphhopper/pull/2188#discussion_r529802457", "createdAt": "2020-11-24T18:48:01Z", "author": {"login": "karussell"}, "path": "core/src/main/java/com/graphhopper/routing/util/spatialrules/SpatialRuleLookupBuilder.java", "diffHunk": "@@ -53,27 +54,27 @@ public static SpatialRuleLookup buildIndex(List<JsonFeatureCollection> jsonFeatu\n                 List<Polygon> borders = new ArrayList<>();\n                 for (int i = 0; i < jsonFeature.getGeometry().getNumGeometries(); i++) {\n                     Geometry poly = jsonFeature.getGeometry().getGeometryN(i);\n-                    if (poly instanceof Polygon)\n-                        borders.add((Polygon) poly);\n-                    else\n+                    if (poly instanceof Polygon) {\n+                        Geometry intersection = bboxGeometry.intersection(poly);\n+                        if (!intersection.isEmpty()) {\n+                            PolygonExtracter.getPolygons(intersection, borders);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d6c6925b68856c96ffff685f7311de66b9166bb1"}, "originalPosition": 44}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "c7c1fa5b941abf96bc2e4bc2ffdfd18d7162de1d", "author": {"user": null}, "url": "https://github.com/graphhopper/graphhopper/commit/c7c1fa5b941abf96bc2e4bc2ffdfd18d7162de1d", "committedDate": "2020-11-25T14:27:10Z", "message": "Switch to `intersects()` for faster PIP checks"}, "afterCommit": {"oid": "f1e5458fa0e89e9e0cb04ab39af66e4c35942794", "author": {"user": null}, "url": "https://github.com/graphhopper/graphhopper/commit/f1e5458fa0e89e9e0cb04ab39af66e4c35942794", "committedDate": "2020-11-26T10:28:59Z", "message": "Switch to `intersects()` for faster PIP checks"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "cc404c8cf8eba4ebad42c736e1a1e62068305120", "author": {"user": null}, "url": "https://github.com/graphhopper/graphhopper/commit/cc404c8cf8eba4ebad42c736e1a1e62068305120", "committedDate": "2020-11-26T11:18:24Z", "message": "Use intersection free border polygons"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a919503f942458baa96795c8fd4212c2d46e78fd", "author": {"user": null}, "url": "https://github.com/graphhopper/graphhopper/commit/a919503f942458baa96795c8fd4212c2d46e78fd", "committedDate": "2020-11-26T11:18:24Z", "message": "Use intersections with the max bbox as spatial rule borders"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "4db016d0a2ab482ab94e282e2175e2af2e311dd5", "author": {"user": null}, "url": "https://github.com/graphhopper/graphhopper/commit/4db016d0a2ab482ab94e282e2175e2af2e311dd5", "committedDate": "2020-11-26T11:18:25Z", "message": "Treat `JSON_ID_FIELD` as a constant"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "1da4a3b23a7d9cf672497b195d46e7f548d9e94d", "author": {"user": null}, "url": "https://github.com/graphhopper/graphhopper/commit/1da4a3b23a7d9cf672497b195d46e7f548d9e94d", "committedDate": "2020-11-26T11:18:25Z", "message": "Provide a find method for Country"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e6c285635f56384509bae018c699afc5084966ae", "author": {"user": null}, "url": "https://github.com/graphhopper/graphhopper/commit/e6c285635f56384509bae018c699afc5084966ae", "committedDate": "2020-11-26T11:18:25Z", "message": "Use Country.find() to lookup enum value"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "da0e02cfd93a194fa33354459bd076cdc9c71403", "author": {"user": null}, "url": "https://github.com/graphhopper/graphhopper/commit/da0e02cfd93a194fa33354459bd076cdc9c71403", "committedDate": "2020-11-26T11:18:25Z", "message": "Use static helper method"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "021b85a608950152d6c32a3c61a6aa7381cb841b", "author": {"user": null}, "url": "https://github.com/graphhopper/graphhopper/commit/021b85a608950152d6c32a3c61a6aa7381cb841b", "committedDate": "2020-11-26T11:18:25Z", "message": "Mark JSON_ID_FIELD as a package scoped constant"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "312e8c3d556225ef20d8f5a4301004b735f355f8", "author": {"user": null}, "url": "https://github.com/graphhopper/graphhopper/commit/312e8c3d556225ef20d8f5a4301004b735f355f8", "committedDate": "2020-11-26T11:18:25Z", "message": "Switch to `intersects()` for faster PIP checks"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "f1e5458fa0e89e9e0cb04ab39af66e4c35942794", "author": {"user": null}, "url": "https://github.com/graphhopper/graphhopper/commit/f1e5458fa0e89e9e0cb04ab39af66e4c35942794", "committedDate": "2020-11-26T10:28:59Z", "message": "Switch to `intersects()` for faster PIP checks"}, "afterCommit": {"oid": "312e8c3d556225ef20d8f5a4301004b735f355f8", "author": {"user": null}, "url": "https://github.com/graphhopper/graphhopper/commit/312e8c3d556225ef20d8f5a4301004b735f355f8", "committedDate": "2020-11-26T11:18:25Z", "message": "Switch to `intersects()` for faster PIP checks"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f5cd2123e341d53ba071db062d34b9a2340986ee", "author": {"user": null}, "url": "https://github.com/graphhopper/graphhopper/commit/f5cd2123e341d53ba071db062d34b9a2340986ee", "committedDate": "2020-11-26T12:52:41Z", "message": "Mention different id field in the changelog"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTM5MzU5NzU3", "url": "https://github.com/graphhopper/graphhopper/pull/2188#pullrequestreview-539359757", "createdAt": "2020-11-26T14:27:08Z", "commit": {"oid": "f5cd2123e341d53ba071db062d34b9a2340986ee"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f7b17438a117b7bcd14a579d5354e02d8538b664", "author": {"user": {"login": "karussell", "name": "Peter"}}, "url": "https://github.com/graphhopper/graphhopper/commit/f7b17438a117b7bcd14a579d5354e02d8538b664", "committedDate": "2020-11-26T14:27:13Z", "message": "Merge branch 'master' into spatial_rules_refactor"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4513, "cost": 1, "resetAt": "2021-11-01T14:51:55Z"}}}