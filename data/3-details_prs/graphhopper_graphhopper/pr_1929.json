{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0Mzc5NTA2NDAx", "number": 1929, "title": "Mapzen (skadi) elevation provider", "bodyText": "Fixes #384 by adding an option to use Mapzen's skadi elevation data by setting graph.elevation.provider: skadi in config.yml.", "createdAt": "2020-02-25T10:51:27Z", "url": "https://github.com/graphhopper/graphhopper/pull/1929", "merged": true, "mergeCommit": {"oid": "fe3525239a3b90136914ef9b6079091f9846e6c4"}, "closed": true, "closedAt": "2020-03-17T08:47:19Z", "author": {"login": "msbarry"}, "timelineItems": {"totalCount": 12, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcHviHMgH2gAyMzc5NTA2NDAxOjE2N2ZkNDliNjlmNjc5M2YzMGFlYTFjZDE0ZTZjMTA5ZjJiN2FlNDA=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcOXoGHAH2gAyMzc5NTA2NDAxOjRmZjU1NThjMjUzNTlkMTdkYjY1YWQxMWFhMGQ1ZjhlMzgzYjgzYjA=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "167fd49b69f6793f30aea1cd14e6c109f2b7ae40", "author": {"user": {"login": "msbarry", "name": "Michael Barry"}}, "url": "https://github.com/graphhopper/graphhopper/commit/167fd49b69f6793f30aea1cd14e6c109f2b7ae40", "committedDate": "2020-02-25T10:26:21Z", "message": "implement skadi elevation provider"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "47f7c4d6d29deed8fa1a02d20e8746a592c5bb00", "author": {"user": {"login": "msbarry", "name": "Michael Barry"}}, "url": "https://github.com/graphhopper/graphhopper/commit/47f7c4d6d29deed8fa1a02d20e8746a592c5bb00", "committedDate": "2020-02-25T10:26:36Z", "message": "Merge branch 'master' into skadi-provider"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "bd87ee11750433c9e50faf7a32d81287dffec8ac", "author": {"user": {"login": "msbarry", "name": "Michael Barry"}}, "url": "https://github.com/graphhopper/graphhopper/commit/bd87ee11750433c9e50faf7a32d81287dffec8ac", "committedDate": "2020-02-25T10:50:51Z", "message": "add integration test for skadi"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b34ea8890f14df98169434e65f8b51568cd39a4c", "author": {"user": {"login": "msbarry", "name": "Michael Barry"}}, "url": "https://github.com/graphhopper/graphhopper/commit/b34ea8890f14df98169434e65f8b51568cd39a4c", "committedDate": "2020-02-25T11:07:12Z", "message": "dont use String.format"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "09a1eaea70b763b6495262364edad8eb68ca6da9", "author": {"user": {"login": "msbarry", "name": "Michael Barry"}}, "url": "https://github.com/graphhopper/graphhopper/commit/09a1eaea70b763b6495262364edad8eb68ca6da9", "committedDate": "2020-02-28T10:59:46Z", "message": "Merge branch 'master' into skadi-provider"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "7de85b56f5bdb96d9c2767f8f9b1fdfd7c1905d6", "author": {"user": {"login": "msbarry", "name": "Michael Barry"}}, "url": "https://github.com/graphhopper/graphhopper/commit/7de85b56f5bdb96d9c2767f8f9b1fdfd7c1905d6", "committedDate": "2020-03-05T01:34:19Z", "message": "Merge branch 'master' into skadi-provider"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "adcf7654505071e510e4600e3e1c3a453be64407", "author": {"user": {"login": "msbarry", "name": "Michael Barry"}}, "url": "https://github.com/graphhopper/graphhopper/commit/adcf7654505071e510e4600e3e1c3a453be64407", "committedDate": "2020-03-10T12:50:08Z", "message": "Merge branch 'master' into skadi-provider"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "9222b172e9bd265f536bac0798bfcc33468d0057", "author": {"user": {"login": "msbarry", "name": "Michael Barry"}}, "url": "https://github.com/graphhopper/graphhopper/commit/9222b172e9bd265f536bac0798bfcc33468d0057", "committedDate": "2020-03-12T09:59:37Z", "message": "Merge branch 'master' into skadi-provider"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "051ccecc38c5baf9700c1cc5f5f895c664a300a1", "author": {"user": {"login": "msbarry", "name": "Michael Barry"}}, "url": "https://github.com/graphhopper/graphhopper/commit/051ccecc38c5baf9700c1cc5f5f895c664a300a1", "committedDate": "2020-03-15T10:52:41Z", "message": "Merge branch 'master' into skadi-provider"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c4c29cc53214c52a8de07e05e10088923e8dbf20", "author": {"user": {"login": "msbarry", "name": "Michael Barry"}}, "url": "https://github.com/graphhopper/graphhopper/commit/c4c29cc53214c52a8de07e05e10088923e8dbf20", "committedDate": "2020-03-15T10:55:36Z", "message": "fix integration test"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzc1MTM2ODY2", "url": "https://github.com/graphhopper/graphhopper/pull/1929#pullrequestreview-375136866", "createdAt": "2020-03-16T11:51:10Z", "commit": {"oid": "c4c29cc53214c52a8de07e05e10088923e8dbf20"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xNlQxMTo1MToxMFrOF2wgCA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xNlQxMTo1Mjo1NFrOF2wjiA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5Mjk2MjA1Ng==", "bodyText": "Can you add it also to this table? https://github.com/graphhopper/graphhopper/blob/master/NOTICE.md#data", "url": "https://github.com/graphhopper/graphhopper/pull/1929#discussion_r392962056", "createdAt": "2020-03-16T11:51:10Z", "author": {"login": "karussell"}, "path": "core/src/main/java/com/graphhopper/GraphHopper.java", "diffHunk": "@@ -625,6 +625,8 @@ private static ElevationProvider createElevationProvider(GraphHopperConfig ghCon\n             elevationProvider = new SRTMGL1Provider(cacheDirStr);\n         } else if (eleProviderStr.equalsIgnoreCase(\"multi\")) {\n             elevationProvider = new MultiSourceElevationProvider(cacheDirStr);\n+        } else if (eleProviderStr.equalsIgnoreCase(\"skadi\")) {\n+            elevationProvider = new SkadiProvider(cacheDirStr);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c4c29cc53214c52a8de07e05e10088923e8dbf20"}, "originalPosition": 5}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5Mjk2MjY1Mw==", "bodyText": "Due to consistency I would just return \"skadi\" here", "url": "https://github.com/graphhopper/graphhopper/pull/1929#discussion_r392962653", "createdAt": "2020-03-16T11:52:17Z", "author": {"login": "karussell"}, "path": "core/src/main/java/com/graphhopper/reader/dem/SkadiProvider.java", "diffHunk": "@@ -0,0 +1,106 @@\n+package com.graphhopper.reader.dem;\n+\n+import java.io.*;\n+import java.util.zip.GZIPInputStream;\n+\n+import static com.graphhopper.util.Helper.close;\n+import static com.graphhopper.util.Helper.toLowerCase;\n+\n+/**\n+ * Skadi contains elevation data for the entire world with 1 arc second (~30m) accuracy in SRTM format stitched\n+ * together from many sources (https://github.com/tilezen/joerd/blob/master/docs/data-sources.md).\n+ *\n+ * We use the hosted AWS Open Data mirror (https://registry.opendata.aws/terrain-tiles/) by default but you can\n+ * change to any mirror by updating the base URL.\n+ *\n+ * See https://github.com/tilezen/joerd/blob/master/docs/attribution.md for required attribution of any project\n+ * using this data.\n+ *\n+ * Detailed information can be found here: https://github.com/tilezen/joerd\n+ */\n+public class SkadiProvider extends AbstractSRTMElevationProvider {\n+    public SkadiProvider() {\n+        this(\"\");\n+    }\n+    public SkadiProvider(String cacheDir) {\n+        super(\n+                \"https://elevation-tiles-prod.s3.amazonaws.com/skadi/\",\n+                cacheDir.isEmpty()? \"/tmp/srtm\": cacheDir,\n+                \"GraphHopper SRTMReader\",\n+                -90,\n+                90,\n+                3601\n+        );\n+    }\n+\n+    public static void main(String[] args) throws IOException {\n+        SkadiProvider provider = new SkadiProvider();\n+        // 338\n+        System.out.println(provider.getEle(49.949784, 11.57517));\n+        // 468\n+        System.out.println(provider.getEle(49.968668, 11.575127));\n+        // 467\n+        System.out.println(provider.getEle(49.968682, 11.574842));\n+        // 3110\n+        System.out.println(provider.getEle(-22.532854, -65.110474));\n+        // 115\n+        System.out.println(provider.getEle(38.065392, -87.099609));\n+        // 1612\n+        System.out.println(provider.getEle(40, -105.2277023));\n+        System.out.println(provider.getEle(39.99999999, -105.2277023));\n+        System.out.println(provider.getEle(39.9999999, -105.2277023));\n+        System.out.println(provider.getEle(39.999999, -105.2277023));\n+        // 1015\n+        System.out.println(provider.getEle(47.468668, 14.575127));\n+        // 1107\n+        System.out.println(provider.getEle(47.467753, 14.573911));\n+        // 1930\n+        System.out.println(provider.getEle(46.468835, 12.578777));\n+        // 844\n+        System.out.println(provider.getEle(48.469123, 9.576393));\n+    }\n+\n+    @Override\n+    byte[] readFile(File file) throws IOException {\n+        InputStream is = new FileInputStream(file);\n+        GZIPInputStream gzis = new GZIPInputStream(is);\n+        BufferedInputStream buff = new BufferedInputStream(gzis);\n+        ByteArrayOutputStream os = new ByteArrayOutputStream();\n+        byte[] buffer = new byte[0xFFFF];\n+        int len;\n+        while ((len = buff.read(buffer)) > 0) {\n+            os.write(buffer, 0, len);\n+        }\n+        os.flush();\n+        close(buff);\n+        return os.toByteArray();\n+    }\n+\n+    private String getLatString(double lat) {\n+        int minLat = (int) Math.floor(lat);\n+        return (minLat < 0 ? \"S\" : \"N\") + getPaddedLatString(minLat);\n+    }\n+\n+    private String getLonString(double lon) {\n+        int minLon = (int) Math.floor(lon);\n+        return (minLon < 0 ? \"W\" : \"E\") + getPaddedLonString(minLon);\n+    }\n+\n+    String getFileName(double lat, double lon) {\n+        String latStr = getLatString(lat);\n+        String lonStr = getLonString(lon);\n+        return toLowerCase(latStr + lonStr);\n+    }\n+\n+    String getDownloadURL(double lat, double lon) {\n+        String latStr = getLatString(lat);\n+        String lonStr = getLonString(lon);\n+\n+        return latStr + \"/\" + latStr + lonStr + \".hgt.gz\";\n+    }\n+\n+    @Override\n+    public String toString() {\n+        return \"skadi(\" + baseUrl + \")\";", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c4c29cc53214c52a8de07e05e10088923e8dbf20"}, "originalPosition": 104}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5Mjk2Mjk1Mg==", "bodyText": "Are you ok with adding the usual License header here?", "url": "https://github.com/graphhopper/graphhopper/pull/1929#discussion_r392962952", "createdAt": "2020-03-16T11:52:54Z", "author": {"login": "karussell"}, "path": "core/src/main/java/com/graphhopper/reader/dem/SkadiProvider.java", "diffHunk": "@@ -0,0 +1,106 @@\n+package com.graphhopper.reader.dem;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c4c29cc53214c52a8de07e05e10088923e8dbf20"}, "originalPosition": 1}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "4ff5558c25359d17db65ad11aa0d5f8e383b83b0", "author": {"user": {"login": "msbarry", "name": "Michael Barry"}}, "url": "https://github.com/graphhopper/graphhopper/commit/4ff5558c25359d17db65ad11aa0d5f8e383b83b0", "committedDate": "2020-03-17T00:32:38Z", "message": "respond to comments"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4582, "cost": 1, "resetAt": "2021-11-01T14:51:55Z"}}}