{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0MzY2MjU4OTY5", "number": 1861, "title": " Use Strings to add CH profiles to GraphBuilder ", "bodyText": "This is a little spin-off from https://github.com/graphhopper/graphhopper/tree/remove_turn_weighting. Whats the issue here? In #1820 I want to move the turn weight calculation into AbstractWeighting instead of (as we do so far) wrapping Weightings into TurnWeighting. This requires passing the turn weight stuff into the weighting constructors (which is also a good thing: the turn cost configuration must be defined at the time the weighting is created as is the case when including the turn weighting in configurable weightings). However, this means to create a Weighting we need the TurnCostStorage already, which on the other hand is not available as long as there is no graph. The ugly part here is that to create a graph we already need the weightings to add CHGraphs, which we can see looking at the current usage of GraphBuilder:\nGraph graph = new GraphBuilder(encodingManager)\n  .setCHProfile(CHProfile.edge(weighting))\n  .create();\nWith the turn cost stuff this becomes:\nGraph graph = new GraphBuilder(encodingManager)\n   .build(); // graph not created yet, we can still add CH profiles\nWeighting w = new FastestWeighting(encoder, new DefaultTurnCostProvider(encoder, graph.getTurnCostStorage());\ngraph.addCHGraph(CHProfile.edge(w));\ngraph.create();\nSo I thought its useful to use a string representation to add the CH profiles and create the CH profiles in GraphBuilder#build() when the turn cost storage is available:\nGraph graph = new GraphBuilder(encodingManager)\n  .setCHProfileStrings(\"car|fastest|edge\")\n  .create();\nObviously this is limited to some hard-coded weightings in GraphBuilder, then again these are sufficient for the testing purposes (where GraphBuilder is mainly used) and of course one can always use the more verbose and flexible way above.\nI don't know its a bit of a workaround because really I think there is no reason we cannot add CHGraphs after GraphHopperStorage has been created, but this seems like a bigger undertaking and not sure if its worth atm, especially since I think the string method above is nice and readable (just not type-safe).\nAny thoughts?", "createdAt": "2020-01-23T09:19:49Z", "url": "https://github.com/graphhopper/graphhopper/pull/1861", "merged": true, "mergeCommit": {"oid": "4ab3635e1b08399df44b5c19c2dcafb7743f5c64"}, "closed": true, "closedAt": "2020-01-23T12:52:53Z", "author": {"login": "easbar"}, "timelineItems": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABb9GhVagH2gAyMzY2MjU4OTY5OmZjY2FkYTcxYWY0YjNkZDNjMzI0MzZhMjc1M2M2ODUwOGQ4YjhjOWU=", "endCursor": "Y3Vyc29yOnYyOpPPAAABb9IhsQgFqTM0NzIyMDEyMg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "fccada71af4b3dd3c32436a2753c68508d8b8c9e", "author": {"user": {"login": "easbar", "name": "Andi"}}, "url": "https://github.com/graphhopper/graphhopper/commit/fccada71af4b3dd3c32436a2753c68508d8b8c9e", "committedDate": "2020-01-23T09:00:09Z", "message": "Use Strings to add CH profiles to GraphBuilder"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "aad8fde907f419364b70fdcd4523e00c8b71ce54", "author": {"user": {"login": "easbar", "name": "Andi"}}, "url": "https://github.com/graphhopper/graphhopper/commit/aad8fde907f419364b70fdcd4523e00c8b71ce54", "committedDate": "2020-01-23T09:01:33Z", "message": "Merge branch 'master' into graph_builder_ch_strings"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "570d592770bd74fc81c79063e46aee3e46f65a74", "author": {"user": {"login": "easbar", "name": "Andi"}}, "url": "https://github.com/graphhopper/graphhopper/commit/570d592770bd74fc81c79063e46aee3e46f65a74", "committedDate": "2020-01-23T09:39:15Z", "message": "Fix test"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzQ3MjIwMTIy", "url": "https://github.com/graphhopper/graphhopper/pull/1861#pullrequestreview-347220122", "createdAt": "2020-01-23T11:14:09Z", "commit": {"oid": "570d592770bd74fc81c79063e46aee3e46f65a74"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yM1QxMToxNDowOVrOFg6pNQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yM1QxMToxNDowOVrOFg6pNQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MDA1OTU3Mw==", "bodyText": "E.g. here.", "url": "https://github.com/graphhopper/graphhopper/pull/1861#discussion_r370059573", "createdAt": "2020-01-23T11:14:09Z", "author": {"login": "karussell"}, "path": "core/src/test/java/com/graphhopper/routing/RandomCHRoutingTest.java", "diffHunk": "@@ -62,10 +62,11 @@ public void init() {\n         dir = new RAMDirectory();\n         encoder = new CarFlagEncoder(5, 5, maxTurnCosts);\n         encodingManager = EncodingManager.create(encoder);\n-        weighting = new FastestWeighting(encoder);\n         graph = new GraphBuilder(encodingManager)\n-                .setCHProfiles(new CHProfile(weighting, traversalMode.isEdgeBased(), uTurnCosts))\n+                .setCHProfileStrings(\"car|fastest|\" + (traversalMode.isEdgeBased() ? \"edge\" : \"node\") + \"|\" + uTurnCosts)\n                 .create();\n+        chProfile = graph.getCHGraph().getCHProfile();\n+        weighting = chProfile.getWeighting();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "570d592770bd74fc81c79063e46aee3e46f65a74"}, "originalPosition": 26}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4696, "cost": 1, "resetAt": "2021-11-01T14:51:55Z"}}}