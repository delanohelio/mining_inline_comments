{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTIxNzYyMzQ1", "number": 2756, "title": "Use GQLDocument for validation/IR building", "bodyText": "Use GQLDocument for building the IR. GQLDocument maps 1:1 to the GraphQL (except for whitespaces) so it's easier to modify the source. Using it for validation also allows for a better separation of the different stages of the parsing:\nAntlr parsing\n\u2b07\ufe0f \nGQLDocument construction\n\u2b07\ufe0f \nValidation\n\u2b07\ufe0f \nAssociate operation with their named fragments\n\u2b07\ufe0f \nAdd typenames when needed\n\u2b07\ufe0f \nGenerate document source\n\u2b07\ufe0f \nCompute used types\n\u2b07\ufe0f \nGenerate IR\n\nThe produced IR is not 100% compatible yet because it does not attempt to merge fields (hero_name test is disabled for an example).\nThis PR adresses the following issues that were not merged from main in the last merge:\n4fa0158 default deprecationReason\n60d7e1c optional mutations/subscriptions\nf3dca03 type extensions\nc330ab4 @deprecated(reason: \"\")\nRemaining features/commits that needs to be ported/decided in 3.x:\nd9039bf default variable values\n019edd0 fragment package name\nFixes #2727\nFixes #2572", "createdAt": "2020-11-16T16:05:41Z", "url": "https://github.com/apollographql/apollo-android/pull/2756", "merged": true, "mergeCommit": {"oid": "3cd142a200cb0911d1da3ee3f829729ee8c72b66"}, "closed": true, "closedAt": "2020-11-26T15:10:15Z", "author": {"login": "martinbonnin"}, "timelineItems": {"totalCount": 44, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABddG-_GAH2gAyNTIxNzYyMzQ1OjI5YmM4ZTI4YjhkOWJkNzBmNGRhMmUxNjMyMzliYTYzYTEwMGEwYzI=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdgQrwOgH2gAyNTIxNzYyMzQ1OmM3NmFiNWM1NDVmYTIxY2RlMmQ5YWYzNDRhYTQ1ZDIxYWM5NTMyZDM=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "29bc8e28b8d9bd70f4da2e163239ba63a100a0c2", "author": {"user": {"login": "martinbonnin", "name": "Martin Bonnin"}}, "url": "https://github.com/apollographql/apollo-android/commit/29bc8e28b8d9bd70f4da2e163239ba63a100a0c2", "committedDate": "2020-11-16T15:49:16Z", "message": "wip"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "dff0901dcee8f9bcfebb545df252331c8f9b1287", "author": {"user": {"login": "martinbonnin", "name": "Martin Bonnin"}}, "url": "https://github.com/apollographql/apollo-android/commit/dff0901dcee8f9bcfebb545df252331c8f9b1287", "committedDate": "2020-11-16T15:49:16Z", "message": "add types extensions"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c74c9ebc57d00c6ae2c5c8802920e17abe6580e1", "author": {"user": {"login": "martinbonnin", "name": "Martin Bonnin"}}, "url": "https://github.com/apollographql/apollo-android/commit/c74c9ebc57d00c6ae2c5c8802920e17abe6580e1", "committedDate": "2020-11-16T15:49:16Z", "message": "operation name might be null for anonymous operations"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b1895d3d9d41b70f05e21fd11cbe12f73a7bad5a", "author": {"user": {"login": "martinbonnin", "name": "Martin Bonnin"}}, "url": "https://github.com/apollographql/apollo-android/commit/b1895d3d9d41b70f05e21fd11cbe12f73a7bad5a", "committedDate": "2020-11-16T15:49:16Z", "message": "added GQLNode"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b41df38b12543b217d23a2929876628d59b5b70a", "author": {"user": {"login": "martinbonnin", "name": "Martin Bonnin"}}, "url": "https://github.com/apollographql/apollo-android/commit/b41df38b12543b217d23a2929876628d59b5b70a", "committedDate": "2020-11-16T15:49:16Z", "message": "implement type extensions"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "8efaa66376280f758ee6e0018ece2592d99b79b3", "author": {"user": {"login": "martinbonnin", "name": "Martin Bonnin"}}, "url": "https://github.com/apollographql/apollo-android/commit/8efaa66376280f758ee6e0018ece2592d99b79b3", "committedDate": "2020-11-16T15:49:16Z", "message": "rename"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "bbc146b310fb6e5c602c1000ab611fc770a01474", "author": {"user": {"login": "martinbonnin", "name": "Martin Bonnin"}}, "url": "https://github.com/apollographql/apollo-android/commit/bbc146b310fb6e5c602c1000ab611fc770a01474", "committedDate": "2020-11-16T15:49:16Z", "message": "implement AST to Introspection"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "6e974d1f2e60b2f1c31008e8343bdd8fa100741f", "author": {"user": {"login": "martinbonnin", "name": "Martin Bonnin"}}, "url": "https://github.com/apollographql/apollo-android/commit/6e974d1f2e60b2f1c31008e8343bdd8fa100741f", "committedDate": "2020-11-16T15:49:16Z", "message": "update builtins, add GQLDocument constructor"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "fdf26beca4005f37337a80d7c2bfa05264a1f034", "author": {"user": {"login": "martinbonnin", "name": "Martin Bonnin"}}, "url": "https://github.com/apollographql/apollo-android/commit/fdf26beca4005f37337a80d7c2bfa05264a1f034", "committedDate": "2020-11-16T15:49:16Z", "message": "fix the VERSION property not being recognized by intelliJ"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "198d957c3b9ad4259dda814eb5d745adac61705e", "author": {"user": {"login": "martinbonnin", "name": "Martin Bonnin"}}, "url": "https://github.com/apollographql/apollo-android/commit/198d957c3b9ad4259dda814eb5d745adac61705e", "committedDate": "2020-11-16T15:49:16Z", "message": "implement Introspection -> AST conversion"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "406c92d4dac888e13d3b577760ddcb5d99c64c54", "author": {"user": {"login": "martinbonnin", "name": "Martin Bonnin"}}, "url": "https://github.com/apollographql/apollo-android/commit/406c92d4dac888e13d3b577760ddcb5d99c64c54", "committedDate": "2020-11-16T15:49:16Z", "message": "wip on writing GQL documents"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "226a9c7391f08fdaeadcc3640de94d56e3ec69d0", "author": {"user": {"login": "martinbonnin", "name": "Martin Bonnin"}}, "url": "https://github.com/apollographql/apollo-android/commit/226a9c7391f08fdaeadcc3640de94d56e3ec69d0", "committedDate": "2020-11-16T15:49:16Z", "message": "work on schemaWriter"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "8c591d635f4183cd92b4ded22e0c697068467d38", "author": {"user": {"login": "martinbonnin", "name": "Martin Bonnin"}}, "url": "https://github.com/apollographql/apollo-android/commit/8c591d635f4183cd92b4ded22e0c697068467d38", "committedDate": "2020-11-16T15:49:16Z", "message": "fix antlr ambiguity"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "46ef780dbd0d8067332e8f654799a1364f49e2f1", "author": {"user": {"login": "martinbonnin", "name": "Martin Bonnin"}}, "url": "https://github.com/apollographql/apollo-android/commit/46ef780dbd0d8067332e8f654799a1364f49e2f1", "committedDate": "2020-11-16T15:49:16Z", "message": "finish writers implementations"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "8967da5b59525add927d47f362e1955821b6faa8", "author": {"user": {"login": "martinbonnin", "name": "Martin Bonnin"}}, "url": "https://github.com/apollographql/apollo-android/commit/8967da5b59525add927d47f362e1955821b6faa8", "committedDate": "2020-11-16T15:49:16Z", "message": "better file names"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "8d1d2183a8260f6a2417478f518b65a8cd1e1e54", "author": {"user": {"login": "martinbonnin", "name": "Martin Bonnin"}}, "url": "https://github.com/apollographql/apollo-android/commit/8d1d2183a8260f6a2417478f518b65a8cd1e1e54", "committedDate": "2020-11-16T15:49:17Z", "message": "use the GraphQL AST for SDL"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "1c10c92484fe727180f1114c91c34f086c77b666", "author": {"user": {"login": "martinbonnin", "name": "Martin Bonnin"}}, "url": "https://github.com/apollographql/apollo-android/commit/1c10c92484fe727180f1114c91c34f086c77b666", "committedDate": "2020-11-16T15:49:17Z", "message": "fix tests"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e2a4eda99951a930342ea2b8b495081d513af143", "author": {"user": {"login": "martinbonnin", "name": "Martin Bonnin"}}, "url": "https://github.com/apollographql/apollo-android/commit/e2a4eda99951a930342ea2b8b495081d513af143", "committedDate": "2020-11-16T15:49:17Z", "message": "fix tests"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f783c7b200a5a8c049c1a82823313d8ce73aae1c", "author": {"user": {"login": "martinbonnin", "name": "Martin Bonnin"}}, "url": "https://github.com/apollographql/apollo-android/commit/f783c7b200a5a8c049c1a82823313d8ce73aae1c", "committedDate": "2020-11-16T15:49:17Z", "message": "fix some tests"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "3d8b2c37ae5df641e45747a63236a46ffb5dacea", "author": {"user": {"login": "martinbonnin", "name": "Martin Bonnin"}}, "url": "https://github.com/apollographql/apollo-android/commit/3d8b2c37ae5df641e45747a63236a46ffb5dacea", "committedDate": "2020-11-16T15:49:17Z", "message": "update test fixtures"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a2d322d59757e2f7d5196097c9782d35c488f4a2", "author": {"user": {"login": "martinbonnin", "name": "Martin Bonnin"}}, "url": "https://github.com/apollographql/apollo-android/commit/a2d322d59757e2f7d5196097c9782d35c488f4a2", "committedDate": "2020-11-16T15:49:17Z", "message": "remove old SDL package"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "24e9c54ec8e2982ec9f2539e0c582e5a04e7c02c", "author": {"user": {"login": "martinbonnin", "name": "Martin Bonnin"}}, "url": "https://github.com/apollographql/apollo-android/commit/24e9c54ec8e2982ec9f2539e0c582e5a04e7c02c", "committedDate": "2020-11-16T15:49:17Z", "message": "prettify SDL output"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "5ec3645215db7c01be795b35ba3861c1a4b6195e", "author": {"user": {"login": "martinbonnin", "name": "Martin Bonnin"}}, "url": "https://github.com/apollographql/apollo-android/commit/5ec3645215db7c01be795b35ba3861c1a4b6195e", "committedDate": "2020-11-16T15:49:17Z", "message": "keep the alias space and the diff small"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "cb3abf7396b080a319b2e61fdb738d0a478ac1b8", "author": {"user": {"login": "martinbonnin", "name": "Martin Bonnin"}}, "url": "https://github.com/apollographql/apollo-android/commit/cb3abf7396b080a319b2e61fdb738d0a478ac1b8", "committedDate": "2020-11-16T15:49:17Z", "message": "create the directory if it doen't exist, fixes tests"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "5c78c00c9fc9532ae551fa6b789b5642cad97b15", "author": {"user": {"login": "martinbonnin", "name": "Martin Bonnin"}}, "url": "https://github.com/apollographql/apollo-android/commit/5c78c00c9fc9532ae551fa6b789b5642cad97b15", "committedDate": "2020-11-16T15:49:17Z", "message": "use GQLDocument in the download task"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ec9190dd77d6421cd7878dc3bc86ab83e7aa6f9f", "author": {"user": {"login": "martinbonnin", "name": "Martin Bonnin"}}, "url": "https://github.com/apollographql/apollo-android/commit/ec9190dd77d6421cd7878dc3bc86ab83e7aa6f9f", "committedDate": "2020-11-21T00:58:38Z", "message": "First drop for using GQLDocument for validation and IR building"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "3685285f3f40c42c8e22d64e094a508117d3fec9", "author": {"user": {"login": "martinbonnin", "name": "Martin Bonnin"}}, "url": "https://github.com/apollographql/apollo-android/commit/3685285f3f40c42c8e22d64e094a508117d3fec9", "committedDate": "2020-11-21T00:59:29Z", "message": "update test fixtures"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "f676d6b6e06c95e256293f56c71aba5122bf7b59", "author": {"user": {"login": "martinbonnin", "name": "Martin Bonnin"}}, "url": "https://github.com/apollographql/apollo-android/commit/f676d6b6e06c95e256293f56c71aba5122bf7b59", "committedDate": "2020-11-17T23:53:29Z", "message": "some renaming/javadoc"}, "afterCommit": {"oid": "3685285f3f40c42c8e22d64e094a508117d3fec9", "author": {"user": {"login": "martinbonnin", "name": "Martin Bonnin"}}, "url": "https://github.com/apollographql/apollo-android/commit/3685285f3f40c42c8e22d64e094a508117d3fec9", "committedDate": "2020-11-21T00:59:29Z", "message": "update test fixtures"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "458047913284d30bd9fa1b8d379fb9d7d5101bec", "author": {"user": {"login": "martinbonnin", "name": "Martin Bonnin"}}, "url": "https://github.com/apollographql/apollo-android/commit/458047913284d30bd9fa1b8d379fb9d7d5101bec", "committedDate": "2020-11-21T15:24:18Z", "message": "fix SDL tests\n\ncreate the test directory if it does not exist"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTM3Njc4MTY4", "url": "https://github.com/apollographql/apollo-android/pull/2756#pullrequestreview-537678168", "createdAt": "2020-11-24T16:13:28Z", "commit": {"oid": "458047913284d30bd9fa1b8d379fb9d7d5101bec"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0yNFQxNjoxMzoyOVrOH5KMpQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0yNFQxNjoxMzoyOVrOH5KMpQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyOTY5Nzk1Nw==", "bodyText": "\ud83d\udc4d", "url": "https://github.com/apollographql/apollo-android/pull/2756#discussion_r529697957", "createdAt": "2020-11-24T16:13:29Z", "author": {"login": "sav007"}, "path": "apollo-compiler/src/main/kotlin/com/apollographql/apollo/compiler/ast/CodeGenerationAst.kt", "diffHunk": "@@ -43,6 +43,7 @@ internal data class CodeGenerationAst(\n   data class FragmentType(\n       val graphqlName: String,\n       val rootType: TypeRef,\n+      val description: String,", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "458047913284d30bd9fa1b8d379fb9d7d5101bec"}, "originalPosition": 4}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTM3Njg1NDE5", "url": "https://github.com/apollographql/apollo-android/pull/2756#pullrequestreview-537685419", "createdAt": "2020-11-24T16:20:55Z", "commit": {"oid": "458047913284d30bd9fa1b8d379fb9d7d5101bec"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0yNFQxNjoyMDo1NVrOH5KoUw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0yNFQxNjoyMDo1NVrOH5KoUw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyOTcwNTA0Mw==", "bodyText": "nit: should we call it GQLSchema?", "url": "https://github.com/apollographql/apollo-android/pull/2756#discussion_r529705043", "createdAt": "2020-11-24T16:20:55Z", "author": {"login": "sav007"}, "path": "apollo-compiler/src/main/kotlin/com/apollographql/apollo/compiler/parser/gql/Schema.kt", "diffHunk": "@@ -0,0 +1,56 @@\n+package com.apollographql.apollo.compiler.parser.gql\n+\n+/**\n+ * a very thin wrapper around a schema GQLDocument\n+ *\n+ * It serves as a common ground between GQLDocument and IntrospectionSchema\n+ *\n+ * Schema should always contain all types, including the builtin ones\n+ */\n+class Schema(", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "458047913284d30bd9fa1b8d379fb9d7d5101bec"}, "originalPosition": 10}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTM3Njg2NTY2", "url": "https://github.com/apollographql/apollo-android/pull/2756#pullrequestreview-537686566", "createdAt": "2020-11-24T16:22:04Z", "commit": {"oid": "458047913284d30bd9fa1b8d379fb9d7d5101bec"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0yNFQxNjoyMjowNVrOH5KrtQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0yNFQxNjoyMjowNVrOH5KrtQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyOTcwNTkwOQ==", "bodyText": "\ud83d\udc4d \ud83d\udc4d \ud83d\udc4d  very important for fragment parsing", "url": "https://github.com/apollographql/apollo-android/pull/2756#discussion_r529705909", "createdAt": "2020-11-24T16:22:05Z", "author": {"login": "sav007"}, "path": "apollo-compiler/src/main/kotlin/com/apollographql/apollo/compiler/parser/gql/add_typename.kt", "diffHunk": "@@ -0,0 +1,57 @@\n+package com.apollographql.apollo.compiler.parser.gql\n+\n+fun GQLOperationDefinition.withTypenameWhenNeeded(schema: Schema): GQLOperationDefinition {\n+  val hasFragmentSpread = selectionSet.selections.filterIsInstance<GQLFragmentSpread>().isNotEmpty()\n+\n+  return copy(\n+      selectionSet = selectionSet.withTypenameWhenNeeded(schema, hasFragmentSpread)\n+  )\n+}\n+\n+fun GQLFragmentDefinition.withTypenameWhenNeeded(schema: Schema): GQLFragmentDefinition {\n+  return copy(\n+      selectionSet = selectionSet.withTypenameWhenNeeded(schema, true)\n+  )\n+}\n+\n+private val typeNameField = GQLField(\n+    name = \"__typename\",\n+    arguments = null,\n+    selectionSet = null,\n+    sourceLocation = SourceLocation.UNKNOWN,\n+    directives = emptyList(),\n+    alias = null\n+)\n+\n+/**\n+ * XXX: add typename less often\n+ */\n+private fun GQLSelectionSet.withTypenameWhenNeeded(schema: Schema, needed: Boolean): GQLSelectionSet {\n+\n+  var newSelections = selections.map {\n+    when (it) {\n+      is GQLInlineFragment -> {\n+        val neededInInlineFragments = it.selectionSet.selections.filterIsInstance<GQLInlineFragment>().isNotEmpty()\n+        it.copy(\n+            selectionSet = it.selectionSet.withTypenameWhenNeeded(schema, neededInInlineFragments)\n+        )\n+      }\n+      is GQLFragmentSpread -> it\n+      is GQLField -> it.copy(\n+          selectionSet = it.selectionSet?.withTypenameWhenNeeded(schema, true)\n+      )\n+    }\n+  }\n+\n+  newSelections = if (needed) {\n+    // remove the __typename if it exists\n+    // and add it again at the top so we're guaranteed to have it at the beginning of json parsing", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "458047913284d30bd9fa1b8d379fb9d7d5101bec"}, "originalPosition": 48}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "000dd2090793fdaa53a92f45851708e065bfbe62", "author": {"user": {"login": "martinbonnin", "name": "Martin Bonnin"}}, "url": "https://github.com/apollographql/apollo-android/commit/000dd2090793fdaa53a92f45851708e065bfbe62", "committedDate": "2020-11-24T17:09:57Z", "message": "tweak the add_typename algorythm and add unit tests for it"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b1290544f0fbb6b0768ab9822056275a96b96d95", "author": {"user": {"login": "martinbonnin", "name": "Martin Bonnin"}}, "url": "https://github.com/apollographql/apollo-android/commit/b1290544f0fbb6b0768ab9822056275a96b96d95", "committedDate": "2020-11-24T18:00:35Z", "message": "fix typo"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTM4MTU5OTU2", "url": "https://github.com/apollographql/apollo-android/pull/2756#pullrequestreview-538159956", "createdAt": "2020-11-25T05:06:08Z", "commit": {"oid": "000dd2090793fdaa53a92f45851708e065bfbe62"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0yNVQwNTowNjowOFrOH5jYag==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0yNVQwNTowNjowOFrOH5jYag==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMDExMDU3MA==", "bodyText": "it should because we have nested inline fragment here Droid", "url": "https://github.com/apollographql/apollo-android/pull/2756#discussion_r530110570", "createdAt": "2020-11-25T05:06:08Z", "author": {"login": "sav007"}, "path": "apollo-compiler/src/test/typename/fragment_spread.graphql", "diffHunk": "@@ -0,0 +1,13 @@\n+query TestQuery {\n+    hero {\n+        ...heroFragment\n+    }\n+}\n+\n+fragment heroFragment on Character {\n+    # No typename should be appended here", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "000dd2090793fdaa53a92f45851708e065bfbe62"}, "originalPosition": 8}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTM4MTcxNDIy", "url": "https://github.com/apollographql/apollo-android/pull/2756#pullrequestreview-538171422", "createdAt": "2020-11-25T05:42:14Z", "commit": {"oid": "000dd2090793fdaa53a92f45851708e065bfbe62"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0yNVQwNTo0MjoxNFrOH5j-Bg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0yNVQwNTo0MjoxNFrOH5j-Bg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMDEyMDE5OA==", "bodyText": "remove?", "url": "https://github.com/apollographql/apollo-android/pull/2756#discussion_r530120198", "createdAt": "2020-11-25T05:42:14Z", "author": {"login": "sav007"}, "path": "apollo-compiler/src/test/kotlin/com/apollographql/apollo/compiler/TypenameTest.kt", "diffHunk": "@@ -0,0 +1,63 @@\n+package com.apollographql.apollo.compiler\n+\n+import com.apollographql.apollo.compiler.parser.gql.GQLFragmentDefinition\n+import com.apollographql.apollo.compiler.parser.gql.GQLOperationDefinition\n+import com.apollographql.apollo.compiler.parser.gql.GraphQLParser\n+import com.apollographql.apollo.compiler.parser.gql.toFile\n+import com.apollographql.apollo.compiler.parser.gql.toSchema\n+import com.apollographql.apollo.compiler.parser.gql.toUtf8\n+import com.apollographql.apollo.compiler.parser.gql.toUtf8WithIndents\n+import com.apollographql.apollo.compiler.parser.gql.withTypenameWhenNeeded\n+import com.apollographql.apollo.compiler.parser.introspection.IntrospectionSchema\n+import com.google.common.truth.Truth.assertThat\n+import org.junit.Test\n+import org.junit.runner.RunWith\n+import org.junit.runners.Parameterized\n+import java.io.File\n+\n+@Suppress(\"UNUSED_PARAMETER\")\n+@RunWith(Parameterized::class)\n+class TypenameTest(val name: String, private val graphQLFile: File) {\n+\n+  @Test\n+  fun testTypename() {\n+    val schemaFile = File(\"src/test/graphql/schema.sdl\")\n+    val schema = GraphQLParser.parseSchema(schemaFile)\n+\n+    val document = GraphQLParser.parseOperations(graphQLFile, schema).orThrow()\n+\n+    val documentWithTypename = document.copy(\n+        definitions = document.definitions.map {\n+          when (it) {\n+            is GQLOperationDefinition -> it.withTypenameWhenNeeded(schema)\n+            is GQLFragmentDefinition -> it.withTypenameWhenNeeded(schema)\n+            else -> it\n+          }\n+        }\n+    ).toUtf8WithIndents()\n+\n+    val expectedFile = File(graphQLFile.parentFile, \"${name}.with_typename\")\n+\n+\n+    if (TestUtils.shouldUpdateTestFixtures()) {\n+      expectedFile.writeText(documentWithTypename)\n+    } else {\n+      assertThat(documentWithTypename).isEqualTo(expectedFile.readText())\n+    }\n+  }\n+\n+  companion object {\n+    @JvmStatic\n+    @Parameterized.Parameters(name = \"{0}\")\n+    fun data(): Collection<Array<Any>> {\n+      return File(\"src/test/typename/\")\n+          .walk()\n+          .toList()\n+          .filter { it.isFile }\n+          .filter { it.extension == \"graphql\" }\n+          .sortedBy { it.name }\n+          //.filter { it.name.contains(\"InputObjectFieldType\") }", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "000dd2090793fdaa53a92f45851708e065bfbe62"}, "originalPosition": 59}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ced68811fe49796cb4ae1535afe2a1d4bbd48d50", "author": {"user": {"login": "martinbonnin", "name": "Martin Bonnin"}}, "url": "https://github.com/apollographql/apollo-android/commit/ced68811fe49796cb4ae1535afe2a1d4bbd48d50", "committedDate": "2020-11-25T09:37:51Z", "message": "remove bad copy/paste"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ca4e028f295aaa07bf55e64e70c2fc4be8214127", "author": {"user": {"login": "martinbonnin", "name": "Martin Bonnin"}}, "url": "https://github.com/apollographql/apollo-android/commit/ca4e028f295aaa07bf55e64e70c2fc4be8214127", "committedDate": "2020-11-25T10:50:21Z", "message": "move everything to the 'frontend' package"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTM4NzQ5ODI5", "url": "https://github.com/apollographql/apollo-android/pull/2756#pullrequestreview-538749829", "createdAt": "2020-11-25T18:15:52Z", "commit": {"oid": "ca4e028f295aaa07bf55e64e70c2fc4be8214127"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c181b9c37d87c0732c901691a302b0c5c5fcaec3", "author": {"user": {"login": "martinbonnin", "name": "Martin Bonnin"}}, "url": "https://github.com/apollographql/apollo-android/commit/c181b9c37d87c0732c901691a302b0c5c5fcaec3", "committedDate": "2020-11-25T18:16:15Z", "message": "add typename to fragments as well"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "39fbfe7dd9344ced58f677e5012f93c6451d1e3a", "author": {"user": {"login": "martinbonnin", "name": "Martin Bonnin"}}, "url": "https://github.com/apollographql/apollo-android/commit/39fbfe7dd9344ced58f677e5012f93c6451d1e3a", "committedDate": "2020-11-25T18:52:54Z", "message": "fix tests"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "08ef7536c9f8b45e4476f61ee6b545ebe7af639e", "author": {"user": {"login": "martinbonnin", "name": "Martin Bonnin"}}, "url": "https://github.com/apollographql/apollo-android/commit/08ef7536c9f8b45e4476f61ee6b545ebe7af639e", "committedDate": "2020-11-25T19:07:48Z", "message": "force typename on all fragments, update test fixtures"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "cca243e01b510728fea5b46a3fbf4406e550afb2", "author": {"user": {"login": "martinbonnin", "name": "Martin Bonnin"}}, "url": "https://github.com/apollographql/apollo-android/commit/cca243e01b510728fea5b46a3fbf4406e550afb2", "committedDate": "2020-11-25T19:58:21Z", "message": "update tests"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c76ab5c545fa21cde2d9af344aa45d21ac9532d3", "author": {"user": {"login": "martinbonnin", "name": "Martin Bonnin"}}, "url": "https://github.com/apollographql/apollo-android/commit/c76ab5c545fa21cde2d9af344aa45d21ac9532d3", "committedDate": "2020-11-26T10:49:05Z", "message": "fix integration tests"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4200, "cost": 1, "resetAt": "2021-11-01T11:59:11Z"}}}