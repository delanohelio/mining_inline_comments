{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTEyMTc4MzYw", "number": 2711, "title": "[Compiler] support multiple arguments in directives", "bodyText": "closes #2708", "createdAt": "2020-10-29T10:39:06Z", "url": "https://github.com/apollographql/apollo-android/pull/2711", "merged": true, "mergeCommit": {"oid": "b356f5a0fc2b65d5b6f57283fb6031d968b0e95d"}, "closed": true, "closedAt": "2020-10-30T09:37:17Z", "author": {"login": "martinbonnin"}, "timelineItems": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdXPuy9gH2gAyNTEyMTc4MzYwOjQ2YTFmYzFiMmJhNDM3MzA2NGFkOTU3NTViZjQ3MjY5MTFjMDUyYmU=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdXdoz5gFqTUyMDM0MzgwNQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "46a1fc1b2ba4373064ad95755bf4726911c052be", "author": {"user": {"login": "martinbonnin", "name": "Martin Bonnin"}}, "url": "https://github.com/apollographql/apollo-android/commit/46a1fc1b2ba4373064ad95755bf4726911c052be", "committedDate": "2020-10-29T10:37:11Z", "message": "support multiple arguments in directives"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "6f18b250a91e5ec799bd86c1e15a8ff718b575a3", "author": {"user": {"login": "martinbonnin", "name": "Martin Bonnin"}}, "url": "https://github.com/apollographql/apollo-android/commit/6f18b250a91e5ec799bd86c1e15a8ff718b575a3", "committedDate": "2020-10-29T10:37:46Z", "message": "update test fixtures"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTE5NTM0NTY2", "url": "https://github.com/apollographql/apollo-android/pull/2711#pullrequestreview-519534566", "createdAt": "2020-10-29T10:40:02Z", "commit": {"oid": "6f18b250a91e5ec799bd86c1e15a8ff718b575a3"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yOVQxMDo0MDowMlrOHqV5hg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yOVQxMDo0MDowMlrOHqV5hg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNDE2MTAzMA==", "bodyText": "Not sure what the ':' was up there but I didn't find it in http://spec.graphql.org/draft/#Directives so I'm assuming it's safe to remove that case.", "url": "https://github.com/apollographql/apollo-android/pull/2711#discussion_r514161030", "createdAt": "2020-10-29T10:40:02Z", "author": {"login": "martinbonnin"}, "path": "apollo-compiler/src/main/antlr/com/apollographql/apollo/compiler/parser/antlr/GraphQL.g4", "diffHunk": "@@ -96,7 +96,7 @@ directives\n    ;\n \n directive\n-   : '@' NAME ':' valueOrVariable | '@' NAME | '@' NAME '(' argument ')'\n+   : '@' NAME arguments?", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "6f18b250a91e5ec799bd86c1e15a8ff718b575a3"}, "originalPosition": 5}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTE5NTM4Nzc2", "url": "https://github.com/apollographql/apollo-android/pull/2711#pullrequestreview-519538776", "createdAt": "2020-10-29T10:45:39Z", "commit": {"oid": "6f18b250a91e5ec799bd86c1e15a8ff718b575a3"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yOVQxMDo0NTozOVrOHqWFog==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yOVQxMDo0NTozOVrOHqWFog==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNDE2NDEzMA==", "bodyText": "It looks like a field with @include(if: false) will still generate a non-nullable field. That sounds like a bug?", "url": "https://github.com/apollographql/apollo-android/pull/2711#discussion_r514164130", "createdAt": "2020-10-29T10:45:39Z", "author": {"login": "martinbonnin"}, "path": "apollo-compiler/src/main/kotlin/com/apollographql/apollo/compiler/parser/graphql/GraphQLDocumentParser.kt", "diffHunk": "@@ -361,18 +361,30 @@ class GraphQLDocumentParser(\n   private fun GraphQLParser.DirectivesContext?.parse(): List<Condition> {\n     return this?.directive()?.mapNotNull { ctx ->\n       val name = ctx.NAME().text\n-      val argument = ctx.argument()\n-      when {\n-        argument == null -> null\n-        name != \"skip\" && name != \"include\" -> null\n-        argument.NAME()?.text != \"if\" || argument.valueOrVariable()?.variable() == null -> null\n-        else -> Condition(\n-            kind = \"BooleanCondition\",\n-            variableName = argument.valueOrVariable().variable().NAME().text,\n-            inverted = ctx.NAME().text == \"skip\",\n-            sourceLocation = SourceLocation(argument.valueOrVariable()?.start ?: argument.NAME().symbol)\n-        )\n+      val arguments = ctx.arguments()\n+\n+      if (name != \"skip\" && name != \"include\" ) {\n+        // we only support skip and include directives for now\n+        return@mapNotNull null\n+      }\n+\n+      if (arguments.argument().size != 1) {\n+        // skip and include should only have a single argument\n+        return@mapNotNull null\n       }\n+\n+      val argument = arguments.argument().first()\n+      if (argument.NAME().text != \"if\" || argument.valueOrVariable().variable() == null) {\n+        // The argument should be named \"if\"\n+        // Not 100% why we ignore non-variable arguments", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "6f18b250a91e5ec799bd86c1e15a8ff718b575a3"}, "originalPosition": 30}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTIwMzQzODA1", "url": "https://github.com/apollographql/apollo-android/pull/2711#pullrequestreview-520343805", "createdAt": "2020-10-30T02:49:20Z", "commit": {"oid": "6f18b250a91e5ec799bd86c1e15a8ff718b575a3"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4183, "cost": 1, "resetAt": "2021-11-01T11:59:11Z"}}}