{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDAyMDUwNjI3", "number": 2151, "title": "More Kotlin in normalized-cache", "bodyText": "Convert NormalizedCache and its implementations.\n\nFirst converted NormalizedCache to Kotlin by removing Optional.\nAnd did necessary changes in other classes in Java first.\nThen converted those as well.\nMoved prettyDump to test code since it was only used there. reverted\n\nBackward Compatibility\nNo change in tests.\nnextCache() is deprecated and kept as is and returns Optional for now.", "createdAt": "2020-04-10T20:12:05Z", "url": "https://github.com/apollographql/apollo-android/pull/2151", "merged": true, "mergeCommit": {"oid": "4280f037f409f93fcb227939bd434792b98951fd"}, "closed": true, "closedAt": "2020-04-12T09:01:13Z", "author": {"login": "tasomaniac"}, "timelineItems": {"totalCount": 18, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcWUwpPgH2gAyNDAyMDUwNjI3Ojk3MzFhMDEyMDUyYWZjOWVlYzk3MjI2MTRiYzMwYTZhOWU3OWExN2I=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcWxPZfgFqTM5MTgxNzAyNA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "9731a012052afc9eec9722614bc30a6a9e79a17b", "author": {"user": {"login": "tasomaniac", "name": "Said Tahsin Dane"}}, "url": "https://github.com/apollographql/apollo-android/commit/9731a012052afc9eec9722614bc30a6a9e79a17b", "committedDate": "2020-04-10T17:43:39Z", "message": "Remove unnecessary gradle file"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "9867f8f9212441f327ff8301a3f94910fef5c83a", "author": {"user": {"login": "tasomaniac", "name": "Said Tahsin Dane"}}, "url": "https://github.com/apollographql/apollo-android/commit/9867f8f9212441f327ff8301a3f94910fef5c83a", "committedDate": "2020-04-10T19:05:22Z", "message": "Rename .java to .kt"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "2d633db5b8d5766c3077d6317150d08e4010ab4b", "author": {"user": {"login": "tasomaniac", "name": "Said Tahsin Dane"}}, "url": "https://github.com/apollographql/apollo-android/commit/2d633db5b8d5766c3077d6317150d08e4010ab4b", "committedDate": "2020-04-10T19:16:53Z", "message": "Convert NormalizedCache to Kotlin"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a6960cf0d2801958f91483839554a28da9c4ac2e", "author": {"user": {"login": "tasomaniac", "name": "Said Tahsin Dane"}}, "url": "https://github.com/apollographql/apollo-android/commit/a6960cf0d2801958f91483839554a28da9c4ac2e", "committedDate": "2020-04-10T19:31:30Z", "message": "Rename .java to .kt"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b59222bc42e016355adb36898489a4b4e3716eb9", "author": {"user": {"login": "tasomaniac", "name": "Said Tahsin Dane"}}, "url": "https://github.com/apollographql/apollo-android/commit/b59222bc42e016355adb36898489a4b4e3716eb9", "committedDate": "2020-04-10T19:32:46Z", "message": "Migrate LruNormalizedCache"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "47ade249efd1690f8222723da739a8cb905c595f", "author": {"user": {"login": "tasomaniac", "name": "Said Tahsin Dane"}}, "url": "https://github.com/apollographql/apollo-android/commit/47ade249efd1690f8222723da739a8cb905c595f", "committedDate": "2020-04-10T19:51:17Z", "message": "Rename .java to .kt"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d8a06d071abb4bc3060a048bca797d8e69818d4a", "author": {"user": {"login": "tasomaniac", "name": "Said Tahsin Dane"}}, "url": "https://github.com/apollographql/apollo-android/commit/d8a06d071abb4bc3060a048bca797d8e69818d4a", "committedDate": "2020-04-10T19:51:17Z", "message": "Migrate OptimisticNormalizedCache"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "df59e582ef8a5e1e8bdc2f9b3fa558db62c30639", "author": {"user": {"login": "tasomaniac", "name": "Said Tahsin Dane"}}, "url": "https://github.com/apollographql/apollo-android/commit/df59e582ef8a5e1e8bdc2f9b3fa558db62c30639", "committedDate": "2020-04-10T20:16:50Z", "message": "Revert changes in tests by keeping API backward compatible."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzkxNjM5ODQx", "url": "https://github.com/apollographql/apollo-android/pull/2151#pullrequestreview-391639841", "createdAt": "2020-04-10T20:17:11Z", "commit": {"oid": "df59e582ef8a5e1e8bdc2f9b3fa558db62c30639"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xMFQyMDoxNzoxMVrOGEEsrg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xMFQyMDoxNzoxMVrOGEEsrg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNjkyNDQ2Mg==", "bodyText": "This is out of scope but it was redundant.", "url": "https://github.com/apollographql/apollo-android/pull/2151#discussion_r406924462", "createdAt": "2020-04-10T20:17:11Z", "author": {"login": "tasomaniac"}, "path": "apollo-android-support/build.gradle.kts", "diffHunk": "@@ -1,10 +1,4 @@\n import com.android.build.gradle.BaseExtension\n-buildscript {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "df59e582ef8a5e1e8bdc2f9b3fa558db62c30639"}, "originalPosition": 2}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "89d3fe378cc17fd436629e9317508a0f9794faa1", "author": {"user": {"login": "tasomaniac", "name": "Said Tahsin Dane"}}, "url": "https://github.com/apollographql/apollo-android/commit/89d3fe378cc17fd436629e9317508a0f9794faa1", "committedDate": "2020-04-10T20:31:12Z", "message": "Rename .java to .kt"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ac1e1c19d10ceee990e5f4e918ad05742a90b594", "author": {"user": {"login": "tasomaniac", "name": "Said Tahsin Dane"}}, "url": "https://github.com/apollographql/apollo-android/commit/ac1e1c19d10ceee990e5f4e918ad05742a90b594", "committedDate": "2020-04-10T21:29:51Z", "message": "Also convert NormalizedCacheFactory"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "c3cc87774a4a6f0b1f2171559cdf1736d291188e", "author": {"user": {"login": "tasomaniac", "name": "Said Tahsin Dane"}}, "url": "https://github.com/apollographql/apollo-android/commit/c3cc87774a4a6f0b1f2171559cdf1736d291188e", "committedDate": "2020-04-10T20:32:43Z", "message": "Also convert NormalizedCacheFactory"}, "afterCommit": {"oid": "ac1e1c19d10ceee990e5f4e918ad05742a90b594", "author": {"user": {"login": "tasomaniac", "name": "Said Tahsin Dane"}}, "url": "https://github.com/apollographql/apollo-android/commit/ac1e1c19d10ceee990e5f4e918ad05742a90b594", "committedDate": "2020-04-10T21:29:51Z", "message": "Also convert NormalizedCacheFactory"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b87ef9d8212689867548c0389eb9a6e537d335c8", "author": {"user": {"login": "tasomaniac", "name": "Said Tahsin Dane"}}, "url": "https://github.com/apollographql/apollo-android/commit/b87ef9d8212689867548c0389eb9a6e537d335c8", "committedDate": "2020-04-11T10:48:30Z", "message": "Move prettifyDump back to NormalizedCache"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "0e59ab841f39fc324be255dae1f9f34d80f0e1c4", "author": {"user": {"login": "tasomaniac", "name": "Said Tahsin Dane"}}, "url": "https://github.com/apollographql/apollo-android/commit/0e59ab841f39fc324be255dae1f9f34d80f0e1c4", "committedDate": "2020-04-11T10:46:45Z", "message": "Move prettifyDump back to NormalizedCache"}, "afterCommit": {"oid": "b87ef9d8212689867548c0389eb9a6e537d335c8", "author": {"user": {"login": "tasomaniac", "name": "Said Tahsin Dane"}}, "url": "https://github.com/apollographql/apollo-android/commit/b87ef9d8212689867548c0389eb9a6e537d335c8", "committedDate": "2020-04-11T10:48:30Z", "message": "Move prettifyDump back to NormalizedCache"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzkxNzc5MzYx", "url": "https://github.com/apollographql/apollo-android/pull/2151#pullrequestreview-391779361", "createdAt": "2020-04-11T16:15:54Z", "commit": {"oid": "b87ef9d8212689867548c0389eb9a6e537d335c8"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xMVQxNjoxNTo1NFrOGEOSLg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xMVQxNjoxNTo1NFrOGEOSLg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNzA4MTUxOA==", "bodyText": "I have to double check entire logic of this function, after quick look at the logic that was before looks suspicious.\nIt looks like we remove only from the nextCache if it present and never from current instance \ud83e\udd14", "url": "https://github.com/apollographql/apollo-android/pull/2151#discussion_r407081518", "createdAt": "2020-04-11T16:15:54Z", "author": {"login": "sav007"}, "path": "apollo-android-support/src/main/java/com/apollographql/apollo/cache/normalized/sql/SqlNormalizedCache.java", "diffHunk": "@@ -102,40 +99,35 @@\n     return changedKeys;\n   }\n \n-  @SuppressWarnings(\"ResultOfMethodCallIgnored\")\n   @Override public void clearAll() {\n-    //noinspection ResultOfMethodCallIgnored\n-    nextCache().apply(new Action<NormalizedCache>() {\n-      @Override public void apply(@NotNull NormalizedCache cache) {\n-        cache.clearAll();\n-      }\n-    });\n+    NormalizedCache nextCache = getNextCache();\n+    if (nextCache != null) {\n+      nextCache.clearAll();\n+    }\n     clearCurrentCache();\n   }\n \n   @Override public boolean remove(@NotNull final CacheKey cacheKey, final boolean cascade) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b87ef9d8212689867548c0389eb9a6e537d335c8"}, "originalPosition": 64}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzkxNzc5Nzk0", "url": "https://github.com/apollographql/apollo-android/pull/2151#pullrequestreview-391779794", "createdAt": "2020-04-11T16:21:33Z", "commit": {"oid": "b87ef9d8212689867548c0389eb9a6e537d335c8"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xMVQxNjoyMTozM1rOGEOUbw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xMVQxNjoyMTozM1rOGEOUbw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNzA4MjA5NQ==", "bodyText": "what is the implication on the user side, will it be required to include this compiler arg on the library consumer side as well?", "url": "https://github.com/apollographql/apollo-android/pull/2151#discussion_r407082095", "createdAt": "2020-04-11T16:21:33Z", "author": {"login": "sav007"}, "path": "build.gradle.kts", "diffHunk": "@@ -71,7 +71,10 @@ subprojects {\n   }\n \n   tasks.withType<KotlinCompile> {\n-    kotlinOptions.jvmTarget = JavaVersion.VERSION_1_8.toString()\n+    kotlinOptions {\n+      jvmTarget = JavaVersion.VERSION_1_8.toString()\n+      freeCompilerArgs += \"-Xopt-in=kotlin.RequiresOptIn\"", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b87ef9d8212689867548c0389eb9a6e537d335c8"}, "originalPosition": 7}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "32893ca1f8f847a5bd0d0caf5f96beaa555aee0f", "author": {"user": {"login": "tasomaniac", "name": "Said Tahsin Dane"}}, "url": "https://github.com/apollographql/apollo-android/commit/32893ca1f8f847a5bd0d0caf5f96beaa555aee0f", "committedDate": "2020-04-11T19:24:48Z", "message": "2nd iteration on remove function to keep it closer to the original implementation"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzkxODE3MDI0", "url": "https://github.com/apollographql/apollo-android/pull/2151#pullrequestreview-391817024", "createdAt": "2020-04-12T02:54:36Z", "commit": {"oid": "32893ca1f8f847a5bd0d0caf5f96beaa555aee0f"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3927, "cost": 1, "resetAt": "2021-11-01T11:59:11Z"}}}