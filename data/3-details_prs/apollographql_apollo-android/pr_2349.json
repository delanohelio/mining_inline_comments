{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDMxNzcyOTQ1", "number": 2349, "title": "[Runtime] fix AbstractMethodError due to @JvmSynthetic", "bodyText": "Convert SortedInputFieldMapWriter to Kotlin so that we can remove @JvmSynthetic and the writeList method gets generated correctly.\nDecompiling the Kotlin .class file shows\n    public void writeList(@NotNull String fieldName, @NotNull Function1<? super InputFieldWriter.ListItemWriter, Unit> block) {\n        Intrinsics.checkParameterIsNotNull((Object)fieldName, (String)\"fieldName\");\n        Intrinsics.checkParameterIsNotNull(block, (String)\"block\");\n        InputFieldWriter.DefaultImpls.writeList((InputFieldWriter)this, (String)fieldName, block);\n    }\n\nThis method doesn't get generated in Java due to the @JvmSynthetic.\ncloses #2333", "createdAt": "2020-06-09T12:53:23Z", "url": "https://github.com/apollographql/apollo-android/pull/2349", "merged": true, "mergeCommit": {"oid": "a741ef69136447cfbd81fa6d1cb2f092f658b24f"}, "closed": true, "closedAt": "2020-06-10T10:49:03Z", "author": {"login": "martinbonnin"}, "timelineItems": {"totalCount": 10, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcpj2BwAH2gAyNDMxNzcyOTQ1OjFlNTVhNWZkMjk3NTQwZGRlNTVhYzIyOTUxMTMyOGNlZjZkNDhlOWY=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcpnB4oAH2gAyNDMxNzcyOTQ1Ojg5Y2FhMjI4OTZmYjdjYmZmNmRmOGUzNjI3MjFhMzJiZDUwMDdhNjA=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "1e55a5fd297540dde55ac229511328cef6d48e9f", "author": {"user": {"login": "martinbonnin", "name": "Martin Bonnin"}}, "url": "https://github.com/apollographql/apollo-android/commit/1e55a5fd297540dde55ac229511328cef6d48e9f", "committedDate": "2020-06-09T12:02:40Z", "message": "convert CacheKeyBuilderTest to kotlin"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "1f6337686774d494feda3ee3a66b7268379fa329", "author": {"user": {"login": "martinbonnin", "name": "Martin Bonnin"}}, "url": "https://github.com/apollographql/apollo-android/commit/1f6337686774d494feda3ee3a66b7268379fa329", "committedDate": "2020-06-09T12:42:44Z", "message": "convert SortedInputFieldMapWriter to kotlin"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "0ca57eb7e26391e2baef08dbf8890335f96bbf0b", "author": {"user": {"login": "martinbonnin", "name": "Martin Bonnin"}}, "url": "https://github.com/apollographql/apollo-android/commit/0ca57eb7e26391e2baef08dbf8890335f96bbf0b", "committedDate": "2020-06-09T12:44:58Z", "message": "remove JvmSynthetic"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "1669fc93878db9054ba590f6125600c128cb2fcd", "author": {"user": {"login": "martinbonnin", "name": "Martin Bonnin"}}, "url": "https://github.com/apollographql/apollo-android/commit/1669fc93878db9054ba590f6125600c128cb2fcd", "committedDate": "2020-06-09T13:01:03Z", "message": "restore @JvmSynthetic on the `invoke` method"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "c7062ba4b9ab956de487db9ecc423718f3f3d697", "author": {"user": {"login": "martinbonnin", "name": "Martin Bonnin"}}, "url": "https://github.com/apollographql/apollo-android/commit/c7062ba4b9ab956de487db9ecc423718f3f3d697", "committedDate": "2020-06-09T12:59:56Z", "message": "restore @JvmSyntetic on the `\u00ecnvoke` method"}, "afterCommit": {"oid": "1669fc93878db9054ba590f6125600c128cb2fcd", "author": {"user": {"login": "martinbonnin", "name": "Martin Bonnin"}}, "url": "https://github.com/apollographql/apollo-android/commit/1669fc93878db9054ba590f6125600c128cb2fcd", "committedDate": "2020-06-09T13:01:03Z", "message": "restore @JvmSynthetic on the `invoke` method"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDI3MTU1NDc3", "url": "https://github.com/apollographql/apollo-android/pull/2349#pullrequestreview-427155477", "createdAt": "2020-06-09T13:37:18Z", "commit": {"oid": "1669fc93878db9054ba590f6125600c128cb2fcd"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wOVQxMzozNzoxOFrOGhKKfQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wOVQxMzozNzoxOFrOGhKKfQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNzQyMjcxNw==", "bodyText": "Just curious why this test was converted to Kotlin, is it required by this PR?", "url": "https://github.com/apollographql/apollo-android/pull/2349#discussion_r437422717", "createdAt": "2020-06-09T13:37:18Z", "author": {"login": "sav007"}, "path": "apollo-normalized-cache/src/test/java/com/apollographql/apollo/cache/normalized/internal/CacheKeyBuilderTest.kt", "diffHunk": "@@ -0,0 +1,369 @@\n+package com.apollographql.apollo.cache.normalized.internal\n+\n+import com.apollographql.apollo.api.InputType\n+import com.apollographql.apollo.api.Operation\n+import com.apollographql.apollo.api.ResponseField\n+import com.apollographql.apollo.api.ResponseField.Companion.forString\n+import com.apollographql.apollo.api.ScalarType\n+import com.apollographql.apollo.api.internal.InputFieldMarshaller\n+import com.apollographql.apollo.api.internal.InputFieldWriter\n+import com.apollographql.apollo.api.internal.UnmodifiableMapBuilder\n+import com.google.common.truth.Truth\n+import org.junit.Test\n+import java.io.IOException\n+import java.math.BigDecimal\n+import java.util.HashMap\n+\n+class CacheKeyBuilderTest {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "1669fc93878db9054ba590f6125600c128cb2fcd"}, "originalPosition": 17}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDI3MTYxNjU1", "url": "https://github.com/apollographql/apollo-android/pull/2349#pullrequestreview-427161655", "createdAt": "2020-06-09T13:41:13Z", "commit": {"oid": "1669fc93878db9054ba590f6125600c128cb2fcd"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "cead9b2efe2103d9188829c27fdf35c6ef359d2c", "author": {"user": {"login": "martinbonnin", "name": "Martin Bonnin"}}, "url": "https://github.com/apollographql/apollo-android/commit/cead9b2efe2103d9188829c27fdf35c6ef359d2c", "committedDate": "2020-06-09T14:40:34Z", "message": "ignore javadoc errors for apollo-api"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDI3Mjc0MDMy", "url": "https://github.com/apollographql/apollo-android/pull/2349#pullrequestreview-427274032", "createdAt": "2020-06-09T15:20:36Z", "commit": {"oid": "cead9b2efe2103d9188829c27fdf35c6ef359d2c"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wOVQxNToyMDozNlrOGhPugw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wOVQxNToyMDozNlrOGhPugw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNzUxMzg1OQ==", "bodyText": "Instead of init, can you move this to constructor. We also shouldn't use checkNotNull in kotlin.", "url": "https://github.com/apollographql/apollo-android/pull/2349#discussion_r437513859", "createdAt": "2020-06-09T15:20:36Z", "author": {"login": "tasomaniac"}, "path": "apollo-normalized-cache/src/main/java/com/apollographql/apollo/cache/normalized/internal/SortedInputFieldMapWriter.kt", "diffHunk": "@@ -0,0 +1,148 @@\n+package com.apollographql.apollo.cache.normalized.internal\n+\n+import com.apollographql.apollo.api.ScalarType\n+import com.apollographql.apollo.api.internal.InputFieldMarshaller\n+import com.apollographql.apollo.api.internal.InputFieldWriter\n+import com.apollographql.apollo.api.internal.Utils.__checkNotNull\n+import java.io.IOException\n+import java.util.ArrayList\n+import java.util.Collections\n+import java.util.Comparator\n+import java.util.TreeMap\n+\n+class SortedInputFieldMapWriter(fieldNameComparator: Comparator<String>) : InputFieldWriter {\n+  private val fieldNameComparator: Comparator<String>\n+  private val buffer: MutableMap<String, Any?>\n+  fun map(): Map<String, Any?> {\n+    return Collections.unmodifiableMap(buffer)\n+  }\n+\n+  override fun writeString(fieldName: String, value: String?) {\n+    buffer[fieldName] = value\n+  }\n+\n+  override fun writeInt(fieldName: String, value: Int?) {\n+    buffer[fieldName] = value\n+  }\n+\n+  override fun writeLong(fieldName: String, value: Long?) {\n+    buffer[fieldName] = value\n+  }\n+\n+  override fun writeDouble(fieldName: String, value: Double?) {\n+    buffer[fieldName] = value\n+  }\n+\n+  override fun writeNumber(fieldName: String, value: Number?) {\n+    buffer[fieldName] = value\n+  }\n+\n+  override fun writeBoolean(fieldName: String, value: Boolean?) {\n+    buffer[fieldName] = value\n+  }\n+\n+  override fun writeCustom(fieldName: String, scalarType: ScalarType, value: Any?) {\n+    buffer[fieldName] = value\n+  }\n+\n+  @Throws(IOException::class)\n+  override fun writeObject(fieldName: String, marshaller: InputFieldMarshaller?) {\n+    if (marshaller == null) {\n+      buffer[fieldName] = null\n+    } else {\n+      val nestedWriter = SortedInputFieldMapWriter(fieldNameComparator)\n+      marshaller.marshal(nestedWriter)\n+      buffer[fieldName] = nestedWriter.buffer\n+    }\n+  }\n+\n+  @Throws(IOException::class)\n+  override fun writeList(fieldName: String, listWriter: InputFieldWriter.ListWriter?) {\n+    if (listWriter == null) {\n+      buffer[fieldName] = null\n+    } else {\n+      val listItemWriter = ListItemWriter(fieldNameComparator)\n+      listWriter.write(listItemWriter)\n+      buffer[fieldName] = listItemWriter.list\n+    }\n+  }\n+\n+  override fun writeMap(fieldName: String, value: Map<String, Any?>?) {\n+    buffer[fieldName] = value\n+  }\n+\n+  private open class ListItemWriter internal constructor(val fieldNameComparator: Comparator<String>) : InputFieldWriter.ListItemWriter {\n+    val list: MutableList<Any?> = ArrayList<Any?>()\n+    override fun writeString(value: String?) {\n+      if (value != null) {\n+        list.add(value)\n+      }\n+    }\n+\n+    override fun writeInt(value: Int?) {\n+      if (value != null) {\n+        list.add(value)\n+      }\n+    }\n+\n+    override fun writeLong(value: Long?) {\n+      if (value != null) {\n+        list.add(value)\n+      }\n+    }\n+\n+    override fun writeDouble(value: Double?) {\n+      if (value != null) {\n+        list.add(value)\n+      }\n+    }\n+\n+    override fun writeNumber(value: Number?) {\n+      if (value != null) {\n+        list.add(value)\n+      }\n+    }\n+\n+    override fun writeBoolean(value: Boolean?) {\n+      if (value != null) {\n+        list.add(value)\n+      }\n+    }\n+\n+    override fun writeCustom(scalarType: ScalarType, value: Any?) {\n+      if (value != null) {\n+        list.add(value)\n+      }\n+    }\n+\n+    @Throws(IOException::class)\n+    override fun writeObject(marshaller: InputFieldMarshaller?) {\n+      if (marshaller != null) {\n+        val nestedWriter = SortedInputFieldMapWriter(fieldNameComparator)\n+        marshaller.marshal(nestedWriter)\n+        list.add(nestedWriter.buffer)\n+      }\n+    }\n+\n+    @Throws(IOException::class)\n+    override fun writeList(listWriter: InputFieldWriter.ListWriter?) {\n+      if (listWriter != null) {\n+        val nestedListItemWriter = ListItemWriter(fieldNameComparator)\n+        listWriter.write(nestedListItemWriter)\n+        list.add(nestedListItemWriter.list)\n+      }\n+    }\n+\n+    override fun writeMap(value: Map<String, Any?>?) {\n+      if (value != null) {\n+        list.add(value)\n+      }\n+    }\n+\n+  }\n+\n+  init {\n+    this.fieldNameComparator = __checkNotNull(fieldNameComparator, \"fieldNameComparator == null\")", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "cead9b2efe2103d9188829c27fdf35c6ef359d2c"}, "originalPosition": 145}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "89caa22896fb7cbff6df8e362721a32bd5007a60", "author": {"user": {"login": "martinbonnin", "name": "Martin Bonnin"}}, "url": "https://github.com/apollographql/apollo-android/commit/89caa22896fb7cbff6df8e362721a32bd5007a60", "committedDate": "2020-06-09T15:45:20Z", "message": "cleanup the Java -> Kotlin conversion"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3836, "cost": 1, "resetAt": "2021-11-01T11:59:11Z"}}}