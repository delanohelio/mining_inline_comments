{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDE5MTUyOTQw", "number": 2279, "title": "Feature to generate GraphQL enum types as sealed classes", "bodyText": "Update Kotlin compiler to generate GraphQL enum type as sealed class.\nCloses #2065", "createdAt": "2020-05-17T18:25:39Z", "url": "https://github.com/apollographql/apollo-android/pull/2279", "merged": true, "mergeCommit": {"oid": "cbce2c1dc78b56e4480930e3c6cb4e2de322f840"}, "closed": true, "closedAt": "2020-05-19T23:01:23Z", "author": {"login": "sav007"}, "timelineItems": {"totalCount": 11, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABciPiAxAH2gAyNDE5MTUyOTQwOmQwMjI2ZGMyYWFkMjA2NTc2NjgxZDg5ZDBkZjZmYzQ3ZmIxZWE4YjY=", "endCursor": "Y3Vyc29yOnYyOpPPAAABci2CE9gBqjMzNTIzNjc1Mzc=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "d0226dc2aad206576681d89d0df6fc47fb1ea8b6", "author": {"user": {"login": "sav007", "name": "Ivan Savytskyi"}}, "url": "https://github.com/apollographql/apollo-android/commit/d0226dc2aad206576681d89d0df6fc47fb1ea8b6", "committedDate": "2020-05-17T18:25:14Z", "message": "Feature to generate GraphQL enum types as sealed classes\n\nThis is a part one: update Kotlin compiler to generate GraphQL enum type as sealed class.\n\nPart of https://github.com/apollographql/apollo-android/issues/2065"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b71e89073bd092ce581a462c9b2b254c4b9b22ec", "author": {"user": {"login": "sav007", "name": "Ivan Savytskyi"}}, "url": "https://github.com/apollographql/apollo-android/commit/b71e89073bd092ce581a462c9b2b254c4b9b22ec", "committedDate": "2020-05-18T03:50:18Z", "message": "Second part: add gradle plugin configuration"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDEzMzI0MTQx", "url": "https://github.com/apollographql/apollo-android/pull/2279#pullrequestreview-413324141", "createdAt": "2020-05-18T07:12:45Z", "commit": {"oid": "b71e89073bd092ce581a462c9b2b254c4b9b22ec"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xOFQwNzoxMjo0NVrOGWqHqw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xOFQwNzoxMjo0NVrOGWqHqw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNjQxMTk0Nw==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n              /**\n          \n          \n            \n               * Whether to generate GraphQL enum types by matching as Kotlin sealed classes if they match one of provided regex patterns.\n          \n          \n            \n               * By default any GraphQL enum type is generated as `enum class`.\n          \n          \n            \n               */\n          \n          \n            \n              /**\n          \n          \n            \n               * A list of [Regex] patterns for GraphQL enums that should be generated as Kotlin sealed classes instead\n          \n          \n            \n               * of the default Kotlin enums.\n          \n          \n            \n               * Use this if you want your client to have access to the rawValue of the enum. This can be useful if new\n          \n          \n            \n               * GraphQL enums are added but the client was compiled against an older schema that doesn't have knowledge\n          \n          \n            \n               * of the new enums.\n          \n          \n            \n               */", "url": "https://github.com/apollographql/apollo-android/pull/2279#discussion_r426411947", "createdAt": "2020-05-18T07:12:45Z", "author": {"login": "martinbonnin"}, "path": "apollo-gradle-plugin/src/main/kotlin/com/apollographql/apollo/gradle/api/CompilerParams.kt", "diffHunk": "@@ -154,4 +154,10 @@ interface CompilerParams {\n    * Default value: false\n    */\n   val generateAsInternal: Property<Boolean>\n+\n+  /**\n+   * Whether to generate GraphQL enum types by matching as Kotlin sealed classes if they match one of provided regex patterns.\n+   * By default any GraphQL enum type is generated as `enum class`.\n+   */", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b71e89073bd092ce581a462c9b2b254c4b9b22ec"}, "originalPosition": 19}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDEzMzI1Nzk3", "url": "https://github.com/apollographql/apollo-android/pull/2279#pullrequestreview-413325797", "createdAt": "2020-05-18T07:15:35Z", "commit": {"oid": "b71e89073bd092ce581a462c9b2b254c4b9b22ec"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xOFQwNzoxNTozNlrOGWqMhg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xOFQwNzoxNTozNlrOGWqMhg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNjQxMzE5MA==", "bodyText": "Nit: Maybe name this enumAsSealedClassPatterns? generate is used above for Boolean properties and making the property plural would also hint that it is a List.\nEDIT: I just saw the property is named enumAsSealedClassPatternFilters  in GraphQLCompiler.Arguments. Maybe use that everywhere ?", "url": "https://github.com/apollographql/apollo-android/pull/2279#discussion_r426413190", "createdAt": "2020-05-18T07:15:36Z", "author": {"login": "martinbonnin"}, "path": "apollo-gradle-plugin/src/main/kotlin/com/apollographql/apollo/gradle/api/CompilerParams.kt", "diffHunk": "@@ -154,4 +154,10 @@ interface CompilerParams {\n    * Default value: false\n    */\n   val generateAsInternal: Property<Boolean>\n+\n+  /**\n+   * Whether to generate GraphQL enum types by matching as Kotlin sealed classes if they match one of provided regex patterns.\n+   * By default any GraphQL enum type is generated as `enum class`.\n+   */\n+  val generateEnumAsSealedClass: ListProperty<String>", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b71e89073bd092ce581a462c9b2b254c4b9b22ec"}, "originalPosition": 20}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDEzMzI4NzM1", "url": "https://github.com/apollographql/apollo-android/pull/2279#pullrequestreview-413328735", "createdAt": "2020-05-18T07:20:42Z", "commit": {"oid": "b71e89073bd092ce581a462c9b2b254c4b9b22ec"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xOFQwNzoyMDo0MlrOGWqVuA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xOFQwNzoyMDo0MlrOGWqVuA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNjQxNTU0NA==", "bodyText": "Nice \ud83d\ude03", "url": "https://github.com/apollographql/apollo-android/pull/2279#discussion_r426415544", "createdAt": "2020-05-18T07:20:42Z", "author": {"login": "martinbonnin"}, "path": "apollo-compiler/src/test/kotlin/com/apollographql/apollo/compiler/CodegenTest.kt", "diffHunk": "@@ -96,13 +96,19 @@ class CodeGenTest(private val folder: File) {\n         jvmTarget = \"1.8\"\n         sources = kotlinFiles\n \n-        val expectedWarnings = folder.name in listOf(\"deprecation\", \"custom_scalar_type_warnings\")\n+        val expectedWarnings = folder.name in listOf(\"deprecation\", \"custom_scalar_type_warnings\", \"arguments_complex\", \"arguments_simple\")\n         allWarningsAsErrors = expectedWarnings.not()\n         inheritClassPath = true\n         messageOutputStream = System.out // see diagnostics in real time\n       }.compile()\n \n-      assertThat(result.exitCode).isEqualTo(KotlinCompilation.ExitCode.OK)\n+      if (result.exitCode != KotlinCompilation.ExitCode.OK) {\n+        val compilationErrorMessages = \"\\\\ne: .*\\\\n+\".toRegex().find(result.messages)?.groupValues ?: emptyList()\n+        val errorMessages = compilationErrorMessages.joinToString(prefix = \"\\n\", separator = \"\\n\", postfix = \"\\n\") {\n+          \"`${it.replace(\"\\n\", \"\")}`\"\n+        }\n+        fail(\"Failed to compile generated Kotlin files due to compiler errors: $errorMessages\")", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b71e89073bd092ce581a462c9b2b254c4b9b22ec"}, "originalPosition": 48}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDEzMzMwMjU5", "url": "https://github.com/apollographql/apollo-android/pull/2279#pullrequestreview-413330259", "createdAt": "2020-05-18T07:23:11Z", "commit": {"oid": "b71e89073bd092ce581a462c9b2b254c4b9b22ec"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xOFQwNzoyMzoxMVrOGWqaZg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xOFQwNzoyMzoxMVrOGWqaZg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNjQxNjc0Mg==", "bodyText": "Is the check for isNotEmpty() needed here ? I would expect any to return false on empty lists.", "url": "https://github.com/apollographql/apollo-android/pull/2279#discussion_r426416742", "createdAt": "2020-05-18T07:23:11Z", "author": {"login": "martinbonnin"}, "path": "apollo-compiler/src/main/kotlin/com/apollographql/apollo/compiler/codegen/kotlin/EnumType.kt", "diffHunk": "@@ -4,19 +4,32 @@ import com.apollographql.apollo.compiler.applyIf\n import com.apollographql.apollo.compiler.ast.EnumType\n import com.squareup.kotlinpoet.*\n \n-internal fun EnumType.typeSpec(generateAsInternal: Boolean = false) =\n-    TypeSpec\n-        .enumBuilder(name)\n-        .applyIf(description.isNotBlank()) { addKdoc(\"%L\\n\", description) }\n-        .applyIf(generateAsInternal) { addModifiers(KModifier.INTERNAL) }\n-        .primaryConstructor(primaryConstructorSpec)\n-        .addProperty(rawValuePropertySpec)\n-        .apply {\n-          values.forEach { value -> addEnumConstant(value.constName, value.enumConstTypeSpec) }\n-          addEnumConstant(\"UNKNOWN__\", unknownEnumConstTypeSpec)\n-        }\n-        .addType(companionObjectSpec)\n-        .build()\n+internal fun EnumType.typeSpec(\n+    generateAsInternal: Boolean = false,\n+    enumAsSealedClassPatternFilters: List<Regex>\n+): TypeSpec {\n+  val asSealedClass = enumAsSealedClassPatternFilters.isNotEmpty() && enumAsSealedClassPatternFilters.any { pattern ->", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b71e89073bd092ce581a462c9b2b254c4b9b22ec"}, "originalPosition": 21}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDEzNDg0NDc3", "url": "https://github.com/apollographql/apollo-android/pull/2279#pullrequestreview-413484477", "createdAt": "2020-05-18T10:55:46Z", "commit": {"oid": "b71e89073bd092ce581a462c9b2b254c4b9b22ec"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "0a679f85077dd14f378dbadb444fabdf27c89ccd", "author": {"user": {"login": "sav007", "name": "Ivan Savytskyi"}}, "url": "https://github.com/apollographql/apollo-android/commit/0a679f85077dd14f378dbadb444fabdf27c89ccd", "committedDate": "2020-05-18T16:57:26Z", "message": "Update apollo-gradle-plugin/src/main/kotlin/com/apollographql/apollo/gradle/api/CompilerParams.kt\n\nCo-authored-by: Martin Bonnin <martin@mbonnin.net>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDE0NTI0NTc5", "url": "https://github.com/apollographql/apollo-android/pull/2279#pullrequestreview-414524579", "createdAt": "2020-05-19T14:47:42Z", "commit": {"oid": "fc1f6d8d5225b8b6382c7d0767b0121fedca6cca"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "62fd4f6abeea6c87ae0424bb8746fdc5d0be0aa4", "author": {"user": {"login": "sav007", "name": "Ivan Savytskyi"}}, "url": "https://github.com/apollographql/apollo-android/commit/62fd4f6abeea6c87ae0424bb8746fdc5d0be0aa4", "committedDate": "2020-05-19T15:16:22Z", "message": "Feedback"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "fc1f6d8d5225b8b6382c7d0767b0121fedca6cca", "author": {"user": {"login": "sav007", "name": "Ivan Savytskyi"}}, "url": "https://github.com/apollographql/apollo-android/commit/fc1f6d8d5225b8b6382c7d0767b0121fedca6cca", "committedDate": "2020-05-19T14:40:04Z", "message": "Feedback"}, "afterCommit": {"oid": "62fd4f6abeea6c87ae0424bb8746fdc5d0be0aa4", "author": {"user": {"login": "sav007", "name": "Ivan Savytskyi"}}, "url": "https://github.com/apollographql/apollo-android/commit/62fd4f6abeea6c87ae0424bb8746fdc5d0be0aa4", "committedDate": "2020-05-19T15:16:22Z", "message": "Feedback"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3793, "cost": 1, "resetAt": "2021-11-01T11:59:11Z"}}}