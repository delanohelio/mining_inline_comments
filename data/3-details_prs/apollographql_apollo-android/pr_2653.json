{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTAxOTgzMjQ3", "number": 2653, "title": "Add Operation Inline Fragment Support", "bodyText": "This is a continuation of #2647 and adds inline fragment support to Operations.", "createdAt": "2020-10-13T05:00:59Z", "url": "https://github.com/apollographql/apollo-android/pull/2653", "merged": true, "mergeCommit": {"oid": "3aa18bb480cb1002eebcef974dfbd6dc95b1ec18"}, "closed": true, "closedAt": "2020-10-16T19:19:31Z", "author": {"login": "tylerbwong"}, "timelineItems": {"totalCount": 23, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdRGmUdAH2gAyNTAxOTgzMjQ3OjZhZjRkZGE0M2I5YTFjNjc2Yzc3ZWMwMzg3MTI0NmI0MjMxZmRjN2E=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdSuesjAH2gAyNTAxOTgzMjQ3OjAxYjcwNDc4ZDA3OTVkYTQ3NjJkYjg0YTBlMGI2ODkxMGEyNWQwNTg=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "6af4dda43b9a1c676c77ec03871246b4231fdc7a", "author": {"user": {"login": "tylerbwong", "name": "Tyler Wong"}}, "url": "https://github.com/apollographql/apollo-android/commit/6af4dda43b9a1c676c77ec03871246b4231fdc7a", "committedDate": "2020-10-10T08:35:14Z", "message": "Fix Missing Referenced Fragments in Query Document"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "52ad7cf20944b74a2b3064620cb418d946dcb3d0", "author": {"user": {"login": "tylerbwong", "name": "Tyler Wong"}}, "url": "https://github.com/apollographql/apollo-android/commit/52ad7cf20944b74a2b3064620cb418d946dcb3d0", "committedDate": "2020-10-10T08:39:49Z", "message": "Revert unnecessary formatting"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "08c12102763abc80b390ec334a31303961c3f099", "author": {"user": {"login": "tylerbwong", "name": "Tyler Wong"}}, "url": "https://github.com/apollographql/apollo-android/commit/08c12102763abc80b390ec334a31303961c3f099", "committedDate": "2020-10-10T08:50:36Z", "message": "Clean up declarations"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "1b5b275e59316fd9bc7b2132ba9f5ab2e070d811", "author": {"user": {"login": "tylerbwong", "name": "Tyler Wong"}}, "url": "https://github.com/apollographql/apollo-android/commit/1b5b275e59316fd9bc7b2132ba9f5ab2e070d811", "committedDate": "2020-10-10T09:13:50Z", "message": "Use Union over + and toSet()"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b7dcb05d691892e71cd260f47c6315c8fe863386", "author": {"user": {"login": "tylerbwong", "name": "Tyler Wong"}}, "url": "https://github.com/apollographql/apollo-android/commit/b7dcb05d691892e71cd260f47c6315c8fe863386", "committedDate": "2020-10-10T12:31:39Z", "message": "Fix nested fragments on root query and add test case"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "8c3a0663242ddae8d11660f14bbdb9c59d5eabb0", "author": {"user": {"login": "tylerbwong", "name": "Tyler Wong"}}, "url": "https://github.com/apollographql/apollo-android/commit/8c3a0663242ddae8d11660f14bbdb9c59d5eabb0", "committedDate": "2020-10-12T07:39:18Z", "message": "Add Validation for Root Fragments on Invalid Type"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "aaec7db5693e9c188bd4b35537cec8af9015dbe9", "author": {"user": {"login": "tylerbwong", "name": "Tyler Wong"}}, "url": "https://github.com/apollographql/apollo-android/commit/aaec7db5693e9c188bd4b35537cec8af9015dbe9", "committedDate": "2020-10-12T20:54:16Z", "message": "Re-use List<FragmentRef>.findFragments"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "30958fb1ebace50ed231fff6ca4f6e9d005d476f", "author": {"user": {"login": "tylerbwong", "name": "Tyler Wong"}}, "url": "https://github.com/apollographql/apollo-android/commit/30958fb1ebace50ed231fff6ca4f6e9d005d476f", "committedDate": "2020-10-13T04:26:20Z", "message": "Merge latest from root-query-document"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "efa60de888914fc08818b99a5175a23b97b57a19", "author": {"user": {"login": "tylerbwong", "name": "Tyler Wong"}}, "url": "https://github.com/apollographql/apollo-android/commit/efa60de888914fc08818b99a5175a23b97b57a19", "committedDate": "2020-10-13T04:35:10Z", "message": "Update test fixtures for root fragments"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "0408dd6c6425d346086844cfdf0aa377865ea540", "author": {"user": {"login": "tylerbwong", "name": "Tyler Wong"}}, "url": "https://github.com/apollographql/apollo-android/commit/0408dd6c6425d346086844cfdf0aa377865ea540", "committedDate": "2020-10-13T04:54:41Z", "message": "Add Root Inline Fragment Support"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "cf296f3750db9f14fb7cfb89fd3443c001c5314b", "author": {"user": {"login": "tylerbwong", "name": "Tyler Wong"}}, "url": "https://github.com/apollographql/apollo-android/commit/cf296f3750db9f14fb7cfb89fd3443c001c5314b", "committedDate": "2020-10-13T04:56:10Z", "message": "Revert \"fix the license url and a few other dangling urls after the master -> (#2639)\"\n\nThis reverts commit 577cc7d97b5882c5065bca71cf1ce3f335d55bf6."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "6343d1152979844c9086f5394686264781bcda16", "author": {"user": {"login": "tylerbwong", "name": "Tyler Wong"}}, "url": "https://github.com/apollographql/apollo-android/commit/6343d1152979844c9086f5394686264781bcda16", "committedDate": "2020-10-13T18:24:03Z", "message": "Merge dev-3.x"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c539e358e839d0483354faac29a350a81d3aebc5", "author": {"user": {"login": "tylerbwong", "name": "Tyler Wong"}}, "url": "https://github.com/apollographql/apollo-android/commit/c539e358e839d0483354faac29a350a81d3aebc5", "committedDate": "2020-10-13T18:30:22Z", "message": "Merge dev-3.x"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "fe2f01a422128a3a02907d9878f277875d0b49fb", "author": {"user": {"login": "tylerbwong", "name": "Tyler Wong"}}, "url": "https://github.com/apollographql/apollo-android/commit/fe2f01a422128a3a02907d9878f277875d0b49fb", "committedDate": "2020-10-13T18:33:13Z", "message": "Remove leftover Java codegen"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTA4MTU0MDM0", "url": "https://github.com/apollographql/apollo-android/pull/2653#pullrequestreview-508154034", "createdAt": "2020-10-14T09:20:07Z", "commit": {"oid": "fe2f01a422128a3a02907d9878f277875d0b49fb"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xNFQwOToyMDowOFrOHhKBpQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xNFQwOToyMDowOFrOHhKBpQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNDUyOTMxNw==", "bodyText": "Double check: passing ParseResult(result = emptyList())) as parentFields is ok I think because there's no polymorphism on the root query and the parent fields will be merged in all cases?  @sav007 does that sound good to you?", "url": "https://github.com/apollographql/apollo-android/pull/2653#discussion_r504529317", "createdAt": "2020-10-14T09:20:08Z", "author": {"login": "martinbonnin"}, "path": "apollo-compiler/src/main/kotlin/com/apollographql/apollo/compiler/parser/graphql/GraphQLDocumentParser.kt", "diffHunk": "@@ -371,6 +374,20 @@ class GraphQLDocumentParser(\n         ?: emptyList()\n   }\n \n+  private fun GraphQLParser.SelectionSetContext?.inlineFragments(operationType: String): List<InlineFragment> {\n+    val rawRootParentType = schema.rootTypeForOperationType(operationType) ?: throw ParseException(\n+        message = \"Invalid operation type `${operationType}`\"\n+    )\n+    val rootParentType = schema.resolveType(schema.resolveType(rawRootParentType))\n+\n+    return this\n+        ?.selection()\n+        ?.mapNotNull { ctx ->\n+          ctx.inlineFragment()?.parse(parentSchemaType = rootParentType, ParseResult(result = emptyList()))?.result", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "fe2f01a422128a3a02907d9878f277875d0b49fb"}, "originalPosition": 30}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTA4MTU1NzU0", "url": "https://github.com/apollographql/apollo-android/pull/2653#pullrequestreview-508155754", "createdAt": "2020-10-14T09:22:11Z", "commit": {"oid": "fe2f01a422128a3a02907d9878f277875d0b49fb"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xNFQwOToyMjoxMVrOHhKHEA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xNFQwOToyMjoxMVrOHhKHEA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNDUzMDcwNA==", "bodyText": "I think we want the result to be a List<ParseResult<InlineFragment>> to correctly track the used types. If you do something like:\nquery TestQuery {\n  ... on Query {\n    hero {\n      appearsIn\n    }\n  }\n}\n\nappearsIn is an enum type that needs to be generated but won't be if the \"usedTypes\" are not \"bubbled\" up.", "url": "https://github.com/apollographql/apollo-android/pull/2653#discussion_r504530704", "createdAt": "2020-10-14T09:22:11Z", "author": {"login": "martinbonnin"}, "path": "apollo-compiler/src/main/kotlin/com/apollographql/apollo/compiler/parser/graphql/GraphQLDocumentParser.kt", "diffHunk": "@@ -371,6 +374,20 @@ class GraphQLDocumentParser(\n         ?: emptyList()\n   }\n \n+  private fun GraphQLParser.SelectionSetContext?.inlineFragments(operationType: String): List<InlineFragment> {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "fe2f01a422128a3a02907d9878f277875d0b49fb"}, "originalPosition": 21}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "0ed96fb0e5137350ae240e701b1bdbd96f43b2e9", "author": {"user": {"login": "tylerbwong", "name": "Tyler Wong"}}, "url": "https://github.com/apollographql/apollo-android/commit/0ed96fb0e5137350ae240e701b1bdbd96f43b2e9", "committedDate": "2020-10-14T09:58:28Z", "message": "Properly pass usedTypes from ParseResult"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTA4ODc3Njkz", "url": "https://github.com/apollographql/apollo-android/pull/2653#pullrequestreview-508877693", "createdAt": "2020-10-15T01:33:11Z", "commit": {"oid": "fe2f01a422128a3a02907d9878f277875d0b49fb"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xNVQwMTozMzoxMlrOHhtoew==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xNVQwMTozMzoxMlrOHhtoew==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNTExMjY5OQ==", "bodyText": "should we omit named fragment to make this test fixture more simple? As I understood we testing just a case when inline fragment is used as root.", "url": "https://github.com/apollographql/apollo-android/pull/2653#discussion_r505112699", "createdAt": "2020-10-15T01:33:12Z", "author": {"login": "sav007"}, "path": "apollo-compiler/src/test/graphql/com/example/root_query_inline_fragment/TestOperation.graphql", "diffHunk": "@@ -0,0 +1,26 @@\n+query TestQuery {\n+  ... on Query {\n+    __typename\n+    hero {\n+      ...heroFragment\n+    }\n+    droid(id: 1) {\n+      ...droidFragment\n+    }\n+    human(id: 1) {\n+      ... on Human {\n+       name\n+       homePlanet\n+      }\n+    }\n+  }\n+}\n+\n+fragment heroFragment on Character {\n+  name\n+}\n+\n+fragment droidFragment on Droid {\n+  name\n+  primaryFunction\n+}", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "fe2f01a422128a3a02907d9878f277875d0b49fb"}, "originalPosition": 26}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "6fbb8af557a47381f78fdf487d5b891bc28a6701", "author": {"user": {"login": "tylerbwong", "name": "Tyler Wong"}}, "url": "https://github.com/apollographql/apollo-android/commit/6fbb8af557a47381f78fdf487d5b891bc28a6701", "committedDate": "2020-10-15T01:37:00Z", "message": "Remove named fragment from test fixture"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d665d934749ccd33abe5219acd66d5a5fb999b6a", "author": {"user": {"login": "tylerbwong", "name": "Tyler Wong"}}, "url": "https://github.com/apollographql/apollo-android/commit/d665d934749ccd33abe5219acd66d5a5fb999b6a", "committedDate": "2020-10-15T01:51:13Z", "message": "Pass parentFields"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "95d79e9818c098d165ee285cc3eff13dca0b6d83", "author": {"user": {"login": "tylerbwong", "name": "Tyler Wong"}}, "url": "https://github.com/apollographql/apollo-android/commit/95d79e9818c098d165ee285cc3eff13dca0b6d83", "committedDate": "2020-10-15T02:06:56Z", "message": "Update test"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "6783eafa130e4b3513528be8792fea39743cc7fc", "author": {"user": {"login": "tylerbwong", "name": "Tyler Wong"}}, "url": "https://github.com/apollographql/apollo-android/commit/6783eafa130e4b3513528be8792fea39743cc7fc", "committedDate": "2020-10-15T02:14:59Z", "message": "Simplify test case"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "01b70478d0795da4762db84a0e0b68910a25d058", "author": {"user": {"login": "tylerbwong", "name": "Tyler Wong"}}, "url": "https://github.com/apollographql/apollo-android/commit/01b70478d0795da4762db84a0e0b68910a25d058", "committedDate": "2020-10-15T09:37:02Z", "message": "Add comment about passing parentFields"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4149, "cost": 1, "resetAt": "2021-11-01T11:59:11Z"}}}