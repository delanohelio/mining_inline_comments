{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTA0ODg4NTk4", "number": 2666, "title": "[SDL] add support for type extensions", "bodyText": "Add support for SDL type extensions: https://spec.graphql.org/June2018/#sec-Type-System-Extensions\ncloses #2656\nPS: This PR also adds a test case for operation directives, (see #2661)", "createdAt": "2020-10-16T14:24:38Z", "url": "https://github.com/apollographql/apollo-android/pull/2666", "merged": true, "mergeCommit": {"oid": "f3dca0383980359ff453749a74748f140daf8eb3"}, "closed": true, "closedAt": "2020-10-18T23:37:30Z", "author": {"login": "martinbonnin"}, "timelineItems": {"totalCount": 9, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdTHKcEAH2gAyNTA0ODg4NTk4OjQ3Zjk1ZmFkOGJlZWZjYjNhOTgzYWY5ZDVlYjEzNTkwMTZkM2EwMGI=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdTy3HXgFqTUxMTE2Mzg5Mg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "47f95fad8beefcb3a983af9d5eb1359016d3a00b", "author": {"user": {"login": "martinbonnin", "name": "Martin Bonnin"}}, "url": "https://github.com/apollographql/apollo-android/commit/47f95fad8beefcb3a983af9d5eb1359016d3a00b", "committedDate": "2020-10-16T14:22:32Z", "message": "add support for type extensions\n\ncloses #2656"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "5f6a57dd3431004e8b43f86029c3d5e000195b16", "author": {"user": {"login": "martinbonnin", "name": "Martin Bonnin"}}, "url": "https://github.com/apollographql/apollo-android/commit/5f6a57dd3431004e8b43f86029c3d5e000195b16", "committedDate": "2020-10-16T14:25:12Z", "message": "fix typo"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTExMDE2MTc3", "url": "https://github.com/apollographql/apollo-android/pull/2666#pullrequestreview-511016177", "createdAt": "2020-10-17T21:24:18Z", "commit": {"oid": "5f6a57dd3431004e8b43f86029c3d5e000195b16"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xN1QyMToyNDoxOFrOHjf8ow==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xN1QyMToyNDoxOFrOHjf8ow==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNjk4NTYzNQ==", "bodyText": "nit:  just a preference\nval scalar = typeDefinitions.get(name) ?: throw ParseException(\n          message = \"Cannot add scalar type extension on unknown scalar `$name`\",\n          token = start\n      )", "url": "https://github.com/apollographql/apollo-android/pull/2666#discussion_r506985635", "createdAt": "2020-10-17T21:24:18Z", "author": {"login": "sav007"}, "path": "apollo-compiler/src/main/kotlin/com/apollographql/apollo/compiler/parser/sdl/GraphSDLSchemaParser.kt", "diffHunk": "@@ -106,6 +109,218 @@ object GraphSDLSchemaParser {\n     )\n   }\n \n+  private fun List<GraphSDLParser.TypeSystemExtensionContext>.parse(\n+      typeDefinitions: MutableMap<String, GraphSdlSchema.TypeDefinition>\n+  ) {\n+    forEach {\n+      it.typeExtension()?.apply {\n+        scalarTypeExtensionDefinition()?.parse(typeDefinitions)\n+        enumTypeExtensionDefinition()?.parse(typeDefinitions)\n+        objectTypeExtensionDefinition()?.parse(typeDefinitions)\n+        interfaceTypeExtensionDefinition()?.parse(typeDefinitions)\n+        unionTypeExtensionDefinition()?.parse(typeDefinitions)\n+        inputObjectTypeExtensionDefinition()?.parse(typeDefinitions)\n+      }\n+    }\n+  }\n+\n+  private fun GraphSDLParser.ScalarTypeExtensionDefinitionContext.parse(typeDefinitions: MutableMap<String, GraphSdlSchema.TypeDefinition>) {\n+    val name = name().text\n+    val scalar = typeDefinitions.get(name)\n+    if (scalar == null) {\n+      throw ParseException(\n+          message = \"Cannot add scalar type extension on unknown scalar `$name`\",\n+          token = start\n+      )\n+    }", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "5f6a57dd3431004e8b43f86029c3d5e000195b16"}, "originalPosition": 37}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTExMDE2NTQy", "url": "https://github.com/apollographql/apollo-android/pull/2666#pullrequestreview-511016542", "createdAt": "2020-10-17T21:31:46Z", "commit": {"oid": "5f6a57dd3431004e8b43f86029c3d5e000195b16"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xN1QyMTozMTo0N1rOHjf-6Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xN1QyMTozMTo0N1rOHjf-6Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNjk4NjIxNw==", "bodyText": "not a big fan of passing mutable map and having side affect to mutate typeDefinitions map, but don't see easy way to make it pure. We might consider to rename this function to smth that describes mutation maybe like MutableMap<String, GraphSdlSchema.TypeDefinition>.decorateWithTypeExtentantion()?", "url": "https://github.com/apollographql/apollo-android/pull/2666#discussion_r506986217", "createdAt": "2020-10-17T21:31:47Z", "author": {"login": "sav007"}, "path": "apollo-compiler/src/main/kotlin/com/apollographql/apollo/compiler/parser/sdl/GraphSDLSchemaParser.kt", "diffHunk": "@@ -106,6 +109,218 @@ object GraphSDLSchemaParser {\n     )\n   }\n \n+  private fun List<GraphSDLParser.TypeSystemExtensionContext>.parse(\n+      typeDefinitions: MutableMap<String, GraphSdlSchema.TypeDefinition>", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "5f6a57dd3431004e8b43f86029c3d5e000195b16"}, "originalPosition": 15}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTExMDE3ODcw", "url": "https://github.com/apollographql/apollo-android/pull/2666#pullrequestreview-511017870", "createdAt": "2020-10-17T21:59:42Z", "commit": {"oid": "5f6a57dd3431004e8b43f86029c3d5e000195b16"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xN1QyMTo1OTo0MlrOHjgHaA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xN1QyMTo1OTo0MlrOHjgHaA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNjk4ODM5Mg==", "bodyText": "that interesting am I right that this myModifier directive is not declared in the schema? I thought that GraphQL spec says that directive also must be declared in the schema?", "url": "https://github.com/apollographql/apollo-android/pull/2666#discussion_r506988392", "createdAt": "2020-10-17T21:59:42Z", "author": {"login": "sav007"}, "path": "apollo-compiler/src/test/graphql/com/example/operation_directive/TestOperation.graphql", "diffHunk": "@@ -0,0 +1,5 @@\n+query TestQuery @myModifier {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "5f6a57dd3431004e8b43f86029c3d5e000195b16"}, "originalPosition": 1}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "21cdf5b662ba1a539684ac953d749ab227001ecb", "author": {"user": {"login": "martinbonnin", "name": "Martin Bonnin"}}, "url": "https://github.com/apollographql/apollo-android/commit/21cdf5b662ba1a539684ac953d749ab227001ecb", "committedDate": "2020-10-17T22:50:36Z", "message": "use Elvis operator"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "3919f05040d35b7674143421b12545c39f79c960", "author": {"user": {"login": "martinbonnin", "name": "Martin Bonnin"}}, "url": "https://github.com/apollographql/apollo-android/commit/3919f05040d35b7674143421b12545c39f79c960", "committedDate": "2020-10-17T23:09:56Z", "message": "keep everything immutable"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "6e39e2ac4b7bedc991247f88c3110795ae1c2d30", "author": {"user": {"login": "martinbonnin", "name": "Martin Bonnin"}}, "url": "https://github.com/apollographql/apollo-android/commit/6e39e2ac4b7bedc991247f88c3110795ae1c2d30", "committedDate": "2020-10-17T23:12:34Z", "message": "fix bad copy paste"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTExMTYzODky", "url": "https://github.com/apollographql/apollo-android/pull/2666#pullrequestreview-511163892", "createdAt": "2020-10-18T17:17:15Z", "commit": {"oid": "6e39e2ac4b7bedc991247f88c3110795ae1c2d30"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4152, "cost": 1, "resetAt": "2021-11-01T11:59:11Z"}}}