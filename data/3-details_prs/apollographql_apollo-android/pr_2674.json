{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTA2MDUxNzA4", "number": 2674, "title": "[Performance] Add a Benchmark project", "bodyText": "Add an Android benchmark project based on Jetpack Benchmark.\nIt uses the same models as zacsweers/json-serialization-benchmarking. They're not super deep but they should give a good first point of comparison.\nGoing from 2.4.1 to 3.0.0-SNAPSHOT (commit)\n2.4.1 Java codegen:\nbenchmark:    23,697,764 ns Benchmark.apollo\nbenchmark:    12,750,782 ns Benchmark.moshi\n\n2.4.1 Kotlin codegen:\nbenchmark:    23,854,430 ns Benchmark.apollo\nbenchmark:    12,649,481 ns Benchmark.moshi\n\n3.0.0-SNAPSHOT Kotlin codegen:\nbenchmark:    14,700,418 ns Benchmark.apollo\nbenchmark:    12,862,032 ns Benchmark.moshi\n\nEdit: this was comparing 2.4.1 Java codegen to 3.0.0-SNAPSHOT Kotlin codegen. I just added the test with 2.4.1 Kotlin codegen. Let me know if I'm missing something else.\ncloses #2655", "createdAt": "2020-10-19T14:57:57Z", "url": "https://github.com/apollographql/apollo-android/pull/2674", "merged": true, "mergeCommit": {"oid": "0c278b45131b0d5fc2b68e361931dbb26c75fd01"}, "closed": true, "closedAt": "2020-10-23T11:55:34Z", "author": {"login": "martinbonnin"}, "timelineItems": {"totalCount": 7, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdUGLPrAH2gAyNTA2MDUxNzA4OmJiZWI5MTcwNDMyNzc0Mzk3ZWY1ZTQ2MDU0NDdkYmI4YTgyOTk0NWU=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdVKJsYgH2gAyNTA2MDUxNzA4OmMzY2U3MWNhYzFmYTBmZjRlMTcwYmYyZWM3ZTgyZmZkZTBjOWM3ZTc=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "bbeb9170432774397ef5e4605447dbb8a829945e", "author": {"user": {"login": "martinbonnin", "name": "Martin Bonnin"}}, "url": "https://github.com/apollographql/apollo-android/commit/bbeb9170432774397ef5e4605447dbb8a829945e", "committedDate": "2020-10-19T15:47:26Z", "message": "add a benchmark test"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "7e49670ce969fd2d82174e6e39f87db2c74ac243", "author": {"user": {"login": "martinbonnin", "name": "Martin Bonnin"}}, "url": "https://github.com/apollographql/apollo-android/commit/7e49670ce969fd2d82174e6e39f87db2c74ac243", "committedDate": "2020-10-19T15:47:26Z", "message": "update to 3.0.0-SNAPSHOT"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "bbb6a4081ff79a9bef8a230a24a2f4f9601f5848", "author": {"user": {"login": "martinbonnin", "name": "Martin Bonnin"}}, "url": "https://github.com/apollographql/apollo-android/commit/bbb6a4081ff79a9bef8a230a24a2f4f9601f5848", "committedDate": "2020-10-19T15:47:26Z", "message": "fix typo"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c0e8e5e02f98a75561671e1d4f1c8f9f0ca39d2d", "author": {"user": {"login": "martinbonnin", "name": "Martin Bonnin"}}, "url": "https://github.com/apollographql/apollo-android/commit/c0e8e5e02f98a75561671e1d4f1c8f9f0ca39d2d", "committedDate": "2020-10-19T15:47:26Z", "message": "tweak the gitignore to share codestyle between all projects"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "9a90af7c6170e78d6b94b0d5a1624a477b597f72", "author": {"user": {"login": "martinbonnin", "name": "Martin Bonnin"}}, "url": "https://github.com/apollographql/apollo-android/commit/9a90af7c6170e78d6b94b0d5a1624a477b597f72", "committedDate": "2020-10-19T15:19:38Z", "message": "tweak the gitignore to share codestyle between all projects"}, "afterCommit": {"oid": "c0e8e5e02f98a75561671e1d4f1c8f9f0ca39d2d", "author": {"user": {"login": "martinbonnin", "name": "Martin Bonnin"}}, "url": "https://github.com/apollographql/apollo-android/commit/c0e8e5e02f98a75561671e1d4f1c8f9f0ca39d2d", "committedDate": "2020-10-19T15:47:26Z", "message": "tweak the gitignore to share codestyle between all projects"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTE1MTM3NzIx", "url": "https://github.com/apollographql/apollo-android/pull/2674#pullrequestreview-515137721", "createdAt": "2020-10-22T21:36:06Z", "commit": {"oid": "c0e8e5e02f98a75561671e1d4f1c8f9f0ca39d2d"}, "state": "APPROVED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yMlQyMTozNjowNlrOHm0wRQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yMlQyMTo0NjowMVrOHm1B0A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMDQ3MjI2MQ==", "bodyText": "what is this file? Is it meant to be committed - it doesn't seem to be used in the actual benchmark from what I can tell?", "url": "https://github.com/apollographql/apollo-android/pull/2674#discussion_r510472261", "createdAt": "2020-10-22T21:36:06Z", "author": {"login": "BenSchwab"}, "path": "benchmark/addTypename.main.kts", "diffHunk": "@@ -0,0 +1,45 @@\n+#!/usr/bin/env kotlin\n+@file:DependsOn(\"com.squareup.okio:okio:2.9.0\")\n+@file:DependsOn(\"com.squareup.moshi:moshi:1.11.0\")\n+\n+import com.squareup.moshi.Moshi\n+import okio.buffer\n+import okio.sink\n+import okio.source\n+import java.io.File\n+\n+val adapter = Moshi.Builder().build().adapter(Any::class.java)", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c0e8e5e02f98a75561671e1d4f1c8f9f0ca39d2d"}, "originalPosition": 11}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMDQ3Njc1Mg==", "bodyText": "I would love to also see a benchmark that goes the actual apollo client with response normalization enabled", "url": "https://github.com/apollographql/apollo-android/pull/2674#discussion_r510476752", "createdAt": "2020-10-22T21:46:01Z", "author": {"login": "BenSchwab"}, "path": "benchmark/src/androidTest/java/com/apollographql/apollo/benchmark/Benchmark.kt", "diffHunk": "@@ -0,0 +1,43 @@\n+package com.apollographql.apollo.benchmark\n+\n+import androidx.benchmark.junit4.BenchmarkRule\n+import androidx.benchmark.junit4.measureRepeated\n+import androidx.test.platform.app.InstrumentationRegistry\n+import com.apollographql.apollo.benchmark.moshi.Query\n+import com.apollographql.apollo.benchmark.test.R\n+import com.squareup.moshi.Moshi\n+import okio.buffer\n+import okio.source\n+import org.junit.Rule\n+import org.junit.Test\n+\n+class Benchmark {\n+  @get:Rule\n+  val benchmarkRule = BenchmarkRule()\n+\n+  private val operation = GetResponseQuery()\n+\n+  private val moshiAdapter = Moshi.Builder().build().adapter(Query::class.java)\n+\n+  private fun bufferedSource() = InstrumentationRegistry.getInstrumentation().context.resources.openRawResource(R.raw.largesample)\n+      .source()\n+      .buffer()\n+\n+  @Test\n+  fun apollo() = benchmarkRule.measureRepeated {\n+    val bufferedSource = runWithTimingDisabled {\n+      bufferedSource()\n+    }\n+\n+    operation.parse(bufferedSource)", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c0e8e5e02f98a75561671e1d4f1c8f9f0ca39d2d"}, "originalPosition": 32}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c3ce71cac1fa0ff4e170bf2ec7e82ffde0c9c7e7", "author": {"user": {"login": "martinbonnin", "name": "Martin Bonnin"}}, "url": "https://github.com/apollographql/apollo-android/commit/c3ce71cac1fa0ff4e170bf2ec7e82ffde0c9c7e7", "committedDate": "2020-10-22T22:59:17Z", "message": "remove unused script"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4162, "cost": 1, "resetAt": "2021-11-01T11:59:11Z"}}}