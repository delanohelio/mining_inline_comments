{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDI0MDc3NjMx", "number": 2311, "title": "Provide base websocket abstraction", "bodyText": "Introduce websocket abstraction targeting both Android and iOS for later use in ApolloWebSocketNetworkTransport.\nUse OkHttpClient and NSURLSession for Android and iOS targets accordingly as web socket implementation under the hood.\nProvide ApolloWebSocketNetworkTransport implementation responsible for open and share web socket connection between query requests, establish and configure GraphQL web socket connection.\nPart of #2222", "createdAt": "2020-05-27T19:44:30Z", "url": "https://github.com/apollographql/apollo-android/pull/2311", "merged": true, "mergeCommit": {"oid": "6c397a17de849b47249212a38169536e5616c3ee"}, "closed": true, "closedAt": "2020-06-03T15:18:24Z", "author": {"login": "sav007"}, "timelineItems": {"totalCount": 20, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABclpASTAFqTQxOTg1NzQxMQ==", "endCursor": "Y3Vyc29yOnYyOpPPAAABcnqQLqgBqjM0MDI0MjcwODc=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDE5ODU3NDEx", "url": "https://github.com/apollographql/apollo-android/pull/2311#pullrequestreview-419857411", "createdAt": "2020-05-28T07:47:41Z", "commit": {"oid": "df9d76c8f942e4096c5315265ba403415b74e874"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yOFQwNzo0Nzo0MlrOGbpgdg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yOFQwNzo0Nzo0MlrOGbpgdg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMTY0NDc5MA==", "bodyText": "Feels weird to name it NetworkTransport if it inherits from Interceptor", "url": "https://github.com/apollographql/apollo-android/pull/2311#discussion_r431644790", "createdAt": "2020-05-28T07:47:42Z", "author": {"login": "martinbonnin"}, "path": "apollo-runtime-kotlin/src/commonMain/kotlin/com/apollographql/apollo/network/websocket/ApolloWebSocketNetworkTransport.kt", "diffHunk": "@@ -0,0 +1,18 @@\n+package com.apollographql.apollo.network.websocket\n+\n+import com.apollographql.apollo.api.ApolloExperimental\n+import com.apollographql.apollo.api.Response\n+import com.apollographql.apollo.interceptor.ApolloInterceptorChain\n+import com.apollographql.apollo.interceptor.ApolloRequest\n+import com.apollographql.apollo.interceptor.ApolloRequestInterceptor\n+import kotlinx.coroutines.flow.Flow\n+\n+@ApolloExperimental\n+class ApolloWebSocketNetworkTransport(\n+    private val apolloWebSocketFactory: ApolloWebSocketFactory\n+) : ApolloRequestInterceptor {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "df9d76c8f942e4096c5315265ba403415b74e874"}, "originalPosition": 13}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "01f4af67ecfa0eb4ae618448093f815ae622a17f", "author": {"user": {"login": "sav007", "name": "Ivan Savytskyi"}}, "url": "https://github.com/apollographql/apollo-android/commit/01f4af67ecfa0eb4ae618448093f815ae622a17f", "committedDate": "2020-05-28T14:11:12Z", "message": "ApolloWebSocketNetworkTransport implementation"}, "afterCommit": {"oid": "289fe751044df788974d9ad4decfdc9f2c42158b", "author": {"user": {"login": "sav007", "name": "Ivan Savytskyi"}}, "url": "https://github.com/apollographql/apollo-android/commit/289fe751044df788974d9ad4decfdc9f2c42158b", "committedDate": "2020-05-28T14:15:16Z", "message": "ApolloWebSocketNetworkTransport implementation"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDIwMjA3NDc0", "url": "https://github.com/apollographql/apollo-android/pull/2311#pullrequestreview-420207474", "createdAt": "2020-05-28T15:05:30Z", "commit": {"oid": "289fe751044df788974d9ad4decfdc9f2c42158b"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yOFQxNTowNTozMFrOGb5qnQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yOFQxNTowNTozMFrOGb5qnQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMTkwOTUzMw==", "bodyText": "This is a big one: We need to make it clear that this will only work with iOS 13+ - I don't think this will even compile on older versions of iOS since it leverages web socket stuff introduced in iOS 13.\nIf we're not making iOS 13 a requirement for KMP (which we could, but I think might be a smidge premature), then there needs to be a way to prevent this from compiling or being available on iOS 12 and below.", "url": "https://github.com/apollographql/apollo-android/pull/2311#discussion_r431909533", "createdAt": "2020-05-28T15:05:30Z", "author": {"login": "designatednerd"}, "path": "apollo-runtime-kotlin/src/iosMain/kotlin/com/apollographql/apollo/network/websocket/ApolloWebSocket.kt", "diffHunk": "@@ -0,0 +1,160 @@\n+package com.apollographql.apollo.network.websocket\n+\n+import com.apollographql.apollo.ApolloWebSocketException\n+import com.apollographql.apollo.network.toNSData\n+import kotlinx.coroutines.channels.Channel\n+import kotlinx.coroutines.channels.ReceiveChannel\n+import okio.ByteString\n+import okio.ByteString.Companion.toByteString\n+import okio.IOException\n+import okio.internal.commonAsUtf8ToByteArray\n+import okio.toByteString\n+import platform.Foundation.NSMutableURLRequest\n+import platform.Foundation.NSOperationQueue\n+import platform.Foundation.NSThread\n+import platform.Foundation.NSURL\n+import platform.Foundation.NSURLRequest\n+import platform.Foundation.NSURLSession\n+import platform.Foundation.NSURLSessionConfiguration\n+import platform.Foundation.NSURLSessionWebSocketCloseCode\n+import platform.Foundation.NSURLSessionWebSocketMessage\n+import platform.Foundation.NSURLSessionWebSocketMessageTypeData\n+import platform.Foundation.NSURLSessionWebSocketMessageTypeString\n+import platform.Foundation.NSURLSessionWebSocketTask\n+import platform.Foundation.setValue\n+import kotlin.native.concurrent.AtomicReference\n+\n+typealias WebSocketFactory = (NSURLRequest) -> NSURLSessionWebSocketTask\n+\n+actual class ApolloWebSocketFactory(", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "289fe751044df788974d9ad4decfdc9f2c42158b"}, "originalPosition": 29}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "92f77fd4b3ef009abb7d3614de2ccc099b55f649", "author": {"user": {"login": "sav007", "name": "Ivan Savytskyi"}}, "url": "https://github.com/apollographql/apollo-android/commit/92f77fd4b3ef009abb7d3614de2ccc099b55f649", "committedDate": "2020-05-29T21:01:19Z", "message": "Tests + refactoring"}, "afterCommit": {"oid": "df973cf1f1058d5de6cc5d08e2b631dbc8937cad", "author": {"user": {"login": "sav007", "name": "Ivan Savytskyi"}}, "url": "https://github.com/apollographql/apollo-android/commit/df973cf1f1058d5de6cc5d08e2b631dbc8937cad", "committedDate": "2020-05-29T22:40:30Z", "message": "Tests + refactoring"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDIxNTI4ODMz", "url": "https://github.com/apollographql/apollo-android/pull/2311#pullrequestreview-421528833", "createdAt": "2020-05-31T21:24:03Z", "commit": {"oid": "0ac2eba87bd1fab7ebe9b034b58f7a91befb8900"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "289a1cd9312f7af511910270d4b00ef4d95457c3", "author": {"user": {"login": "sav007", "name": "Ivan Savytskyi"}}, "url": "https://github.com/apollographql/apollo-android/commit/289a1cd9312f7af511910270d4b00ef4d95457c3", "committedDate": "2020-06-02T22:14:09Z", "message": "Provide base websocket abstraction\n\nIntroduce websocket abstraction targeting both Android and iOS for later use in `ApolloWebSocketNetworkTransport`.\n\nUse `OkHttpClient` and `NSURLSession` for Android and iOS targets accordingly as web socket implementation under the hood.\n\nPart of https://github.com/apollographql/apollo-android/issues/2222"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "5410edac9be55004d2df46209e05ee2695cf92a8", "author": {"user": {"login": "sav007", "name": "Ivan Savytskyi"}}, "url": "https://github.com/apollographql/apollo-android/commit/5410edac9be55004d2df46209e05ee2695cf92a8", "committedDate": "2020-06-02T22:14:12Z", "message": "Remove hardcoded token"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "803398ab5cc95fd97be4c6fae0c69207a02d0358", "author": {"user": {"login": "sav007", "name": "Ivan Savytskyi"}}, "url": "https://github.com/apollographql/apollo-android/commit/803398ab5cc95fd97be4c6fae0c69207a02d0358", "committedDate": "2020-06-02T22:14:12Z", "message": "ApolloWebSocketNetworkTransport implementation"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "3eee52bce54e72ac7558330134695442435ce1f8", "author": {"user": {"login": "sav007", "name": "Ivan Savytskyi"}}, "url": "https://github.com/apollographql/apollo-android/commit/3eee52bce54e72ac7558330134695442435ce1f8", "committedDate": "2020-06-02T22:14:56Z", "message": "Tests + refactoring"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d503278649924bf09da71ce4bdeffe240133dacc", "author": {"user": {"login": "sav007", "name": "Ivan Savytskyi"}}, "url": "https://github.com/apollographql/apollo-android/commit/d503278649924bf09da71ce4bdeffe240133dacc", "committedDate": "2020-06-02T22:14:59Z", "message": "Rename + refactor"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "434b3924173fabc92e65980d978266fbf4a702c4", "author": {"user": {"login": "sav007", "name": "Ivan Savytskyi"}}, "url": "https://github.com/apollographql/apollo-android/commit/434b3924173fabc92e65980d978266fbf4a702c4", "committedDate": "2020-06-02T22:14:59Z", "message": "Fix issues after testing with real websocket"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "366d42d6869f71adfc246160183e5a3270452f10", "author": {"user": {"login": "sav007", "name": "Ivan Savytskyi"}}, "url": "https://github.com/apollographql/apollo-android/commit/366d42d6869f71adfc246160183e5a3270452f10", "committedDate": "2020-06-02T22:14:59Z", "message": "Fix test"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d5b90e0e365977b87ce57ad72b5e82ef24d76fb5", "author": {"user": {"login": "sav007", "name": "Ivan Savytskyi"}}, "url": "https://github.com/apollographql/apollo-android/commit/d5b90e0e365977b87ce57ad72b5e82ef24d76fb5", "committedDate": "2020-06-02T22:14:59Z", "message": "Refactor to auto add `Sec-WebSocket-Protocol: to graphql-ws` header for Apollo WS protocol implementation"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "755e87cbe760254d9d54dac515ac391225a84580", "author": {"user": {"login": "sav007", "name": "Ivan Savytskyi"}}, "url": "https://github.com/apollographql/apollo-android/commit/755e87cbe760254d9d54dac515ac391225a84580", "committedDate": "2020-06-02T22:14:59Z", "message": "Send stop message on complete + fix test"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "a4c1633b03dbef76b57638eab01dc87940f94b15", "author": {"user": {"login": "sav007", "name": "Ivan Savytskyi"}}, "url": "https://github.com/apollographql/apollo-android/commit/a4c1633b03dbef76b57638eab01dc87940f94b15", "committedDate": "2020-06-02T22:11:57Z", "message": "Introduce `WebSocketFactory` interface and default Apollo KN `ApolloWebSocketFactory` implementation"}, "afterCommit": {"oid": "fb8e8b64d81e668f2ebc1e36e3e14811c0ab83c6", "author": {"user": {"login": "sav007", "name": "Ivan Savytskyi"}}, "url": "https://github.com/apollographql/apollo-android/commit/fb8e8b64d81e668f2ebc1e36e3e14811c0ab83c6", "committedDate": "2020-06-02T22:14:59Z", "message": "Introduce `WebSocketFactory` interface and default Apollo KN `ApolloWebSocketFactory` implementation"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "fb8e8b64d81e668f2ebc1e36e3e14811c0ab83c6", "author": {"user": {"login": "sav007", "name": "Ivan Savytskyi"}}, "url": "https://github.com/apollographql/apollo-android/commit/fb8e8b64d81e668f2ebc1e36e3e14811c0ab83c6", "committedDate": "2020-06-02T22:14:59Z", "message": "Introduce `WebSocketFactory` interface and default Apollo KN `ApolloWebSocketFactory` implementation"}, "afterCommit": {"oid": "6889606013bd2658c3883890b6c55bce9f2c4940", "author": {"user": {"login": "sav007", "name": "Ivan Savytskyi"}}, "url": "https://github.com/apollographql/apollo-android/commit/6889606013bd2658c3883890b6c55bce9f2c4940", "committedDate": "2020-06-02T23:21:03Z", "message": "Introduce `WebSocketFactory` interface and default Apollo KN `ApolloWebSocketFactory` implementation"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "6889606013bd2658c3883890b6c55bce9f2c4940", "author": {"user": {"login": "sav007", "name": "Ivan Savytskyi"}}, "url": "https://github.com/apollographql/apollo-android/commit/6889606013bd2658c3883890b6c55bce9f2c4940", "committedDate": "2020-06-02T23:21:03Z", "message": "Introduce `WebSocketFactory` interface and default Apollo KN `ApolloWebSocketFactory` implementation"}, "afterCommit": {"oid": "b9dd0fdb8581ab93917c1f37ba6164ea9721106e", "author": {"user": {"login": "sav007", "name": "Ivan Savytskyi"}}, "url": "https://github.com/apollographql/apollo-android/commit/b9dd0fdb8581ab93917c1f37ba6164ea9721106e", "committedDate": "2020-06-03T00:26:12Z", "message": "Introduce `WebSocketFactory` interface and default Apollo KN `ApolloWebSocketFactory` implementation"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "b9dd0fdb8581ab93917c1f37ba6164ea9721106e", "author": {"user": {"login": "sav007", "name": "Ivan Savytskyi"}}, "url": "https://github.com/apollographql/apollo-android/commit/b9dd0fdb8581ab93917c1f37ba6164ea9721106e", "committedDate": "2020-06-03T00:26:12Z", "message": "Introduce `WebSocketFactory` interface and default Apollo KN `ApolloWebSocketFactory` implementation"}, "afterCommit": {"oid": "40521cd8d42e18c16a6fcfd22bbcb255b55ea7d1", "author": {"user": {"login": "sav007", "name": "Ivan Savytskyi"}}, "url": "https://github.com/apollographql/apollo-android/commit/40521cd8d42e18c16a6fcfd22bbcb255b55ea7d1", "committedDate": "2020-06-03T01:06:03Z", "message": "Introduce `WebSocketFactory` interface and default Apollo KN `ApolloWebSocketFactory` implementation"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "49b2820fbab856e60cb96cd7922b18e22abcb435", "author": {"user": {"login": "sav007", "name": "Ivan Savytskyi"}}, "url": "https://github.com/apollographql/apollo-android/commit/49b2820fbab856e60cb96cd7922b18e22abcb435", "committedDate": "2020-06-03T14:22:40Z", "message": "Introduce `WebSocketFactory` interface and default Apollo KN `ApolloWebSocketFactory` implementation"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "40521cd8d42e18c16a6fcfd22bbcb255b55ea7d1", "author": {"user": {"login": "sav007", "name": "Ivan Savytskyi"}}, "url": "https://github.com/apollographql/apollo-android/commit/40521cd8d42e18c16a6fcfd22bbcb255b55ea7d1", "committedDate": "2020-06-03T01:06:03Z", "message": "Introduce `WebSocketFactory` interface and default Apollo KN `ApolloWebSocketFactory` implementation"}, "afterCommit": {"oid": "49b2820fbab856e60cb96cd7922b18e22abcb435", "author": {"user": {"login": "sav007", "name": "Ivan Savytskyi"}}, "url": "https://github.com/apollographql/apollo-android/commit/49b2820fbab856e60cb96cd7922b18e22abcb435", "committedDate": "2020-06-03T14:22:40Z", "message": "Introduce `WebSocketFactory` interface and default Apollo KN `ApolloWebSocketFactory` implementation"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3817, "cost": 1, "resetAt": "2021-11-01T11:59:11Z"}}}