{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0MzkyMDQwODg2", "number": 2091, "title": "Move to GitHub actions", "bodyText": "Move to Github Actions for MacOS (and potentially later) windows builds.\nAlso update publishing for KMP artifacts based on #2069\nSee https://github.com/martinbonnin/apollo-android/runs/525635751?check_suite_focus=true for an example build", "createdAt": "2020-03-22T17:21:46Z", "url": "https://github.com/apollographql/apollo-android/pull/2091", "merged": true, "mergeCommit": {"oid": "7605169412af63cd7402003248e8fc5b199989f5"}, "closed": true, "closedAt": "2020-03-22T21:20:12Z", "author": {"login": "martinbonnin"}, "timelineItems": {"totalCount": 12, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcQLbE2AH2gAyMzkyMDQwODg2Ojc5ODVhMTc2NzM2YjdkMjIxOGU3Nzk0MzBjNGFiYWQwMTFiYjEyZTM=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcWk79AgFqTM5MTc2Mjc5Mw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "7985a176736b7d2218e779430c4abad011bb12e3", "author": {"user": {"login": "martinbonnin", "name": "Martin Bonnin"}}, "url": "https://github.com/apollographql/apollo-android/commit/7985a176736b7d2218e779430c4abad011bb12e3", "committedDate": "2020-03-22T15:27:24Z", "message": "Move to Github actions"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "40c952fc2081351dc90a694fb22cb59beb2162a3", "author": {"user": {"login": "martinbonnin", "name": "Martin Bonnin"}}, "url": "https://github.com/apollographql/apollo-android/commit/40c952fc2081351dc90a694fb22cb59beb2162a3", "committedDate": "2020-03-22T15:35:06Z", "message": "use a x86_64 emulator"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "fa55e4031993ed8ff867480e8d239718139699a3", "author": {"user": {"login": "martinbonnin", "name": "Martin Bonnin"}}, "url": "https://github.com/apollographql/apollo-android/commit/fa55e4031993ed8ff867480e8d239718139699a3", "committedDate": "2020-03-22T16:02:07Z", "message": "maybe justt x86"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "efab907d7bf2cdb359c8b964f5618b3babad56e0", "author": {"user": {"login": "martinbonnin", "name": "Martin Bonnin"}}, "url": "https://github.com/apollographql/apollo-android/commit/efab907d7bf2cdb359c8b964f5618b3babad56e0", "committedDate": "2020-03-22T16:05:18Z", "message": "more emulator options"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "5e1875c1de1a7c7f5bfbe49d5086fda7ec8dd4ed", "author": {"user": {"login": "martinbonnin", "name": "Martin Bonnin"}}, "url": "https://github.com/apollographql/apollo-android/commit/5e1875c1de1a7c7f5bfbe49d5086fda7ec8dd4ed", "committedDate": "2020-03-22T16:16:41Z", "message": "use appropriate emulator"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzc5MDMwMTE4", "url": "https://github.com/apollographql/apollo-android/pull/2091#pullrequestreview-379030118", "createdAt": "2020-03-22T17:48:38Z", "commit": {"oid": "5e1875c1de1a7c7f5bfbe49d5086fda7ec8dd4ed"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzc5MDMwMzI0", "url": "https://github.com/apollographql/apollo-android/pull/2091#pullrequestreview-379030324", "createdAt": "2020-03-22T17:51:02Z", "commit": {"oid": "5e1875c1de1a7c7f5bfbe49d5086fda7ec8dd4ed"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yMlQxNzo1MTowMlrOF5xWyA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yMlQxNzo1MTowMlrOF5xWyA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NjEyMTgwMA==", "bodyText": "nit: I thought Gradle project provides logger, should we use proper project.logger?\nThe same comment for any usage println below", "url": "https://github.com/apollographql/apollo-android/pull/2091#discussion_r396121800", "createdAt": "2020-03-22T17:51:02Z", "author": {"login": "sav007"}, "path": "build.gradle.kts", "diffHunk": "@@ -300,4 +319,47 @@ fun PublicationContainer.setDefaultPomFields() {\n       }\n     }\n   }\n+}\n+\n+tasks.register(\"publishIfNeeded\") {\n+  val eventName = System.getenv(\"GITHUB_EVENT_NAME\")\n+  val ref = System.getenv(\"GITHUB_REF\")\n+  println(\"publishIfNeeded eventName=$eventName ref=$ref\")\n+\n+  if (eventName == \"push\" && ref == \"ref/heads/master\") {\n+    println(\"Deploying snapshot to OSS...\")", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "5e1875c1de1a7c7f5bfbe49d5086fda7ec8dd4ed"}, "originalPosition": 53}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzc5MDMwNDQz", "url": "https://github.com/apollographql/apollo-android/pull/2091#pullrequestreview-379030443", "createdAt": "2020-03-22T17:52:31Z", "commit": {"oid": "5e1875c1de1a7c7f5bfbe49d5086fda7ec8dd4ed"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzc5MDMxMDUy", "url": "https://github.com/apollographql/apollo-android/pull/2091#pullrequestreview-379031052", "createdAt": "2020-03-22T17:58:43Z", "commit": {"oid": "5e1875c1de1a7c7f5bfbe49d5086fda7ec8dd4ed"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yMlQxNzo1ODo0M1rOF5xaAA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yMlQxNzo1ODo0M1rOF5xaAA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NjEyMjYyNA==", "bodyText": "\ud83e\udd14 isn't ./gradlew clean connectedCheck will do the same? I mean build first?", "url": "https://github.com/apollographql/apollo-android/pull/2091#discussion_r396122624", "createdAt": "2020-03-22T17:58:43Z", "author": {"login": "sav007"}, "path": "scripts/ci.sh", "diffHunk": "@@ -0,0 +1,23 @@\n+#!/usr/bin/env bash\n+\n+set -e\n+set -x\n+\n+export PATH=\"$ANDROID_HOME\"/tools/bin:$PATH\n+\n+which emulator\n+\n+sdkmanager --install 'system-images;android-28;default;x86_64' 'emulator'\n+echo \"no\" |avdmanager create avd --force -n test -k 'system-images;android-28;default;x86_64'\n+\n+\"$ANDROID_HOME\"/emulator/emulator -avd test -no-window -gpu swiftshader_indirect -no-snapshot -noaudio -no-boot-anim &\n+\n+# theorically, we should wait here for the emulator to boot but compilation is slow enough\n+# that the emulator will be up by the time we reach the connectedTests. This saves writing\n+# some bash code and a few seconds of total build time.\n+\n+./gradlew clean connectedCheck\n+./gradlew build -x checkstyleTest --stacktrace --max-workers=2", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "5e1875c1de1a7c7f5bfbe49d5086fda7ec8dd4ed"}, "originalPosition": 20}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "3cce6a5651278e65e74a2d232a88cd93cdf88c03", "author": {"user": {"login": "martinbonnin", "name": "Martin Bonnin"}}, "url": "https://github.com/apollographql/apollo-android/commit/3cce6a5651278e65e74a2d232a88cd93cdf88c03", "committedDate": "2020-03-22T18:24:37Z", "message": "move back connectedCheck with the other targets"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "74ccc82374cda3538ead51df1b0214f1b103da7e", "author": {"user": {"login": "martinbonnin", "name": "Martin Bonnin"}}, "url": "https://github.com/apollographql/apollo-android/commit/74ccc82374cda3538ead51df1b0214f1b103da7e", "committedDate": "2020-03-22T18:29:00Z", "message": "use project.logger"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzkxNzYyNzkz", "url": "https://github.com/apollographql/apollo-android/pull/2091#pullrequestreview-391762793", "createdAt": "2020-04-11T12:34:29Z", "commit": {"oid": "74ccc82374cda3538ead51df1b0214f1b103da7e"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xMVQxMjozNDoyOVrOGEM5Vg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xMVQxMjozNDoyOVrOGEM5Vg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNzA1ODc3NA==", "bodyText": "@martinbonnin\nHow can it.name == \"apollo-gradle-plugin\" be true and it.name in arrayOf(\"publishDefaultPublicationToOjoRepository\", \"publishApolloGradlePluginPluginMarkerMavenPublicationToOjoRepository\") be true at the same time?\nThe content of that if branch looks incorrect as to what would be a intent that makes sense.", "url": "https://github.com/apollographql/apollo-android/pull/2091#discussion_r407058774", "createdAt": "2020-04-11T12:34:29Z", "author": {"login": "LouisCAD"}, "path": "build.gradle.kts", "diffHunk": "@@ -300,4 +319,47 @@ fun PublicationContainer.setDefaultPomFields() {\n       }\n     }\n   }\n+}\n+\n+tasks.register(\"publishIfNeeded\") {\n+  val eventName = System.getenv(\"GITHUB_EVENT_NAME\")\n+  val ref = System.getenv(\"GITHUB_REF\")\n+  project.logger.log(LogLevel.LIFECYCLE, \"publishIfNeeded eventName=$eventName ref=$ref\")\n+\n+  if (eventName == \"push\" && ref == \"ref/heads/master\") {\n+    project.logger.log(LogLevel.LIFECYCLE, \"Deploying snapshot to OSS...\")\n+    dependsOn(subprojects.flatMap {\n+      tasks.matching {\n+        if (it.name == \"apollo-gradle-plugin\") {\n+          it.name in arrayOf(\"publishDefaultPublicationToOjoRepository\",\n+              \"publishApolloGradlePluginPluginMarkerMavenPublicationToOjoRepository\")\n+        } else {\n+          it.name == \"publishAllPublicationsToOjoRepository\"\n+        }", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "74ccc82374cda3538ead51df1b0214f1b103da7e"}, "originalPosition": 61}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3891, "cost": 1, "resetAt": "2021-11-01T11:59:11Z"}}}