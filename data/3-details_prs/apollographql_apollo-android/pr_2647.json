{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTAwOTM4ODY0", "number": 2647, "title": "Fix Missing Referenced Fragments in Query Document", "bodyText": "Fixes #2644.", "createdAt": "2020-10-10T08:40:39Z", "url": "https://github.com/apollographql/apollo-android/pull/2647", "merged": true, "mergeCommit": {"oid": "4cb0c479c832629140aa4b07b6dd11e81649e9f0"}, "closed": true, "closedAt": "2020-10-13T08:35:27Z", "author": {"login": "tylerbwong"}, "timelineItems": {"totalCount": 11, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdRGmUdAH2gAyNTAwOTM4ODY0OjZhZjRkZGE0M2I5YTFjNjc2Yzc3ZWMwMzg3MTI0NmI0MjMxZmRjN2E=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdR7RbbgFqTUwNjk0MjA0Mw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "6af4dda43b9a1c676c77ec03871246b4231fdc7a", "author": {"user": {"login": "tylerbwong", "name": "Tyler Wong"}}, "url": "https://github.com/apollographql/apollo-android/commit/6af4dda43b9a1c676c77ec03871246b4231fdc7a", "committedDate": "2020-10-10T08:35:14Z", "message": "Fix Missing Referenced Fragments in Query Document"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "52ad7cf20944b74a2b3064620cb418d946dcb3d0", "author": {"user": {"login": "tylerbwong", "name": "Tyler Wong"}}, "url": "https://github.com/apollographql/apollo-android/commit/52ad7cf20944b74a2b3064620cb418d946dcb3d0", "committedDate": "2020-10-10T08:39:49Z", "message": "Revert unnecessary formatting"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "08c12102763abc80b390ec334a31303961c3f099", "author": {"user": {"login": "tylerbwong", "name": "Tyler Wong"}}, "url": "https://github.com/apollographql/apollo-android/commit/08c12102763abc80b390ec334a31303961c3f099", "committedDate": "2020-10-10T08:50:36Z", "message": "Clean up declarations"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "1b5b275e59316fd9bc7b2132ba9f5ab2e070d811", "author": {"user": {"login": "tylerbwong", "name": "Tyler Wong"}}, "url": "https://github.com/apollographql/apollo-android/commit/1b5b275e59316fd9bc7b2132ba9f5ab2e070d811", "committedDate": "2020-10-10T09:13:50Z", "message": "Use Union over + and toSet()"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTA2MDgyMzM5", "url": "https://github.com/apollographql/apollo-android/pull/2647#pullrequestreview-506082339", "createdAt": "2020-10-10T09:19:49Z", "commit": {"oid": "1b5b275e59316fd9bc7b2132ba9f5ab2e070d811"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b7dcb05d691892e71cd260f47c6315c8fe863386", "author": {"user": {"login": "tylerbwong", "name": "Tyler Wong"}}, "url": "https://github.com/apollographql/apollo-android/commit/b7dcb05d691892e71cd260f47c6315c8fe863386", "committedDate": "2020-10-10T12:31:39Z", "message": "Fix nested fragments on root query and add test case"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "8c3a0663242ddae8d11660f14bbdb9c59d5eabb0", "author": {"user": {"login": "tylerbwong", "name": "Tyler Wong"}}, "url": "https://github.com/apollographql/apollo-android/commit/8c3a0663242ddae8d11660f14bbdb9c59d5eabb0", "committedDate": "2020-10-12T07:39:18Z", "message": "Add Validation for Root Fragments on Invalid Type"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTA2NDA2MDE2", "url": "https://github.com/apollographql/apollo-android/pull/2647#pullrequestreview-506406016", "createdAt": "2020-10-12T08:34:15Z", "commit": {"oid": "8c3a0663242ddae8d11660f14bbdb9c59d5eabb0"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xMlQwODozNDoxNVrOHf0fng==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xMlQwODozNDoxNVrOHf0fng==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMzEyNzk2Ng==", "bodyText": "Mostly nitpicking at this point but it feels a bit \"off\" that we need a special case for the root fragmentsRefs compared to field.fragmentRefs. What about moving the schema.rootTypeForOperationType(operationType) to the call site and re-using List<FragmentRef>.findFragments ?", "url": "https://github.com/apollographql/apollo-android/pull/2647#discussion_r503127966", "createdAt": "2020-10-12T08:34:15Z", "author": {"login": "martinbonnin"}, "path": "apollo-compiler/src/main/kotlin/com/apollographql/apollo/compiler/ir/IRBuilder.kt", "diffHunk": "@@ -188,6 +195,21 @@ class IRBuilder(private val schema: IntrospectionSchema,\n     return usedTypes\n   }\n \n+  private fun List<FragmentRef>.referencedRootFragmentNames(operationType: String, fragments: List<Fragment>, filePath: String): Set<String> {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "8c3a0663242ddae8d11660f14bbdb9c59d5eabb0"}, "originalPosition": 38}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTA2NDA2NjYz", "url": "https://github.com/apollographql/apollo-android/pull/2647#pullrequestreview-506406663", "createdAt": "2020-10-12T08:35:02Z", "commit": {"oid": "8c3a0663242ddae8d11660f14bbdb9c59d5eabb0"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xMlQwODozNTowMlrOHf0iCw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xMlQwODozNTowMlrOHf0iCw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMzEyODU4Nw==", "bodyText": "\ud83d\udc4d", "url": "https://github.com/apollographql/apollo-android/pull/2647#discussion_r503128587", "createdAt": "2020-10-12T08:35:02Z", "author": {"login": "martinbonnin"}, "path": "apollo-compiler/src/main/kotlin/com/apollographql/apollo/compiler/ir/IRBuilder.kt", "diffHunk": "@@ -237,22 +259,26 @@ class IRBuilder(private val schema: IntrospectionSchema,\n               filePath = filePath\n           )\n \n-      when (val schemaType = schema[typeCondition]) {\n-        is IntrospectionSchema.Type.Object -> schemaType.possibleTypes(schema)\n-        is IntrospectionSchema.Type.Interface -> schemaType.possibleTypes(schema)\n-        is IntrospectionSchema.Type.Union -> schemaType.possibleTypes(schema)\n-        else -> emptySet()\n-      }.also { possibleTypes ->\n-        if (fragment.possibleTypes.intersect(possibleTypes).isEmpty()) {\n-          throw DocumentParseException(\n-              message = \"Fragment `${ref.name}` can't be spread here as result can never be of type `${fragment.typeCondition}`\",\n-              sourceLocation = ref.sourceLocation,\n-              filePath = filePath\n-          )\n-        }\n-      }\n+      fragment.validateTypeCondition(ref, typeCondition, filePath)\n \n       fragment\n     }\n   }\n+\n+  private fun Fragment.validateTypeCondition(fragmentRef: FragmentRef, typeCondition: String, filePath: String) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "8c3a0663242ddae8d11660f14bbdb9c59d5eabb0"}, "originalPosition": 80}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "aaec7db5693e9c188bd4b35537cec8af9015dbe9", "author": {"user": {"login": "tylerbwong", "name": "Tyler Wong"}}, "url": "https://github.com/apollographql/apollo-android/commit/aaec7db5693e9c188bd4b35537cec8af9015dbe9", "committedDate": "2020-10-12T20:54:16Z", "message": "Re-use List<FragmentRef>.findFragments"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTA2OTQyMDQz", "url": "https://github.com/apollographql/apollo-android/pull/2647#pullrequestreview-506942043", "createdAt": "2020-10-12T21:57:23Z", "commit": {"oid": "aaec7db5693e9c188bd4b35537cec8af9015dbe9"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4143, "cost": 1, "resetAt": "2021-11-01T11:59:11Z"}}}