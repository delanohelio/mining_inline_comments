{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTA2Nzc5NDc1", "number": 2677, "title": "[Gradle Plugin] Add helpers for android and multi source sets", "bodyText": "Follow up from #2668\nAdd createAllAndroidVariantServices and createAllKotlinJvmSourceSetSevices. These are long method names for use cases where adding GraphQL files to non-main source sets/variants is needed:\napollo {\n  // Will create\n  // - mainExample\n  // - testExample\n  createAllKotlinJvmSourceSetServices(\"example\") {\n    schemaFile.set(file(\"src/main/graphql/com/example/schema.sdl\"))\n  }\n}\napollo {\n  // Will create the services below and collect all graphql files according to Android source sets rules\n  // - debugExample\n  // - debugUnitTestExample\n  // - debugAndroidTestExample\n  // - releaseExample\n  // - releaseUnitTestExample\n  createAllAndroidVariantServices(\"example\") {\n    // It's ok to omit this in which case there should be one and only one schema per source set\n    schemaFile.set(file(\"src/main/graphql/com/example/schema.sdl\"))\n  }\n}", "createdAt": "2020-10-20T13:01:48Z", "url": "https://github.com/apollographql/apollo-android/pull/2677", "merged": true, "mergeCommit": {"oid": "f45db5ac459fcba3bf327e4f0f87ca0910b3bd92"}, "closed": true, "closedAt": "2020-10-23T19:18:10Z", "author": {"login": "martinbonnin"}, "timelineItems": {"totalCount": 9, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdUYOkGgH2gAyNTA2Nzc5NDc1OjNhMWZkNTQ2ODc1ZjkzZGY1YTQ5MmViMTE0ZDNlYTgyNTllNzg5YmU=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdVKZcMgH2gAyNTA2Nzc5NDc1OmUyMjEyZDU0ZWRlNjc1ZTY0NGIwMzE3MWJhNjljM2E1ZjBmMzYzYTI=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "3a1fd546875f93df5a492eb114d3ea8259e789be", "author": {"user": {"login": "martinbonnin", "name": "Martin Bonnin"}}, "url": "https://github.com/apollographql/apollo-android/commit/3a1fd546875f93df5a492eb114d3ea8259e789be", "committedDate": "2020-10-20T12:49:21Z", "message": "add createAllAndroidVariantServices and createAllKotlinJvmSourceSetServices\n\nThese are long specific methods that will create multiple services for\nadvanced users that want their graphql in multiple source sets"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "eab76b24dcb5c891a6358316775aa4cf7b928303", "author": {"user": {"login": "martinbonnin", "name": "Martin Bonnin"}}, "url": "https://github.com/apollographql/apollo-android/commit/eab76b24dcb5c891a6358316775aa4cf7b928303", "committedDate": "2020-10-20T12:49:30Z", "message": "reorgnize tests and add tests for multiple variants/sourceSets"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTEzMzk3MTA0", "url": "https://github.com/apollographql/apollo-android/pull/2677#pullrequestreview-513397104", "createdAt": "2020-10-21T07:50:57Z", "commit": {"oid": "eab76b24dcb5c891a6358316775aa4cf7b928303"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yMVQwNzo1MDo1OFrOHleuJA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yMVQwNzo1MDo1OFrOHleuJA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwOTA2MjY5Mg==", "bodyText": "Shouldn't we just delete this completely now?", "url": "https://github.com/apollographql/apollo-android/pull/2677#discussion_r509062692", "createdAt": "2020-10-21T07:50:58Z", "author": {"login": "tasomaniac"}, "path": "apollo-compiler/src/main/kotlin/com/apollographql/apollo/compiler/GraphQLCompiler.kt", "diffHunk": "@@ -45,7 +45,10 @@ class GraphQLCompiler(val logger: Logger = NoOpLogger) {\n     )\n \n     val files = args.graphqlFiles\n-    checkDuplicateFiles(roots, files)\n+    /**\n+     * Android can have duplicate files but that's ok as long as they do not define the same operations (which is checked in IRBuilder)\n+     */\n+    // checkDuplicateFiles(roots, files)", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "eab76b24dcb5c891a6358316775aa4cf7b928303"}, "originalPosition": 8}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "be28b2fd06a0ff097bb244c09dc78469bd510851", "author": {"user": {"login": "martinbonnin", "name": "Martin Bonnin"}}, "url": "https://github.com/apollographql/apollo-android/commit/be28b2fd06a0ff097bb244c09dc78469bd510851", "committedDate": "2020-10-21T08:00:46Z", "message": "remove unused method"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTEzMzk4MTY1", "url": "https://github.com/apollographql/apollo-android/pull/2677#pullrequestreview-513398165", "createdAt": "2020-10-21T07:52:19Z", "commit": {"oid": "eab76b24dcb5c891a6358316775aa4cf7b928303"}, "state": "COMMENTED", "comments": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yMVQwNzo1MjoxOVrOHlexfA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yMlQwODoyNTowOFrOHmWRQw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwOTA2MzU0OA==", "bodyText": "project is not used in this function. What about making this an extension over androidExtension or making androidExtension a parameter?", "url": "https://github.com/apollographql/apollo-android/pull/2677#discussion_r509063548", "createdAt": "2020-10-21T07:52:19Z", "author": {"login": "tasomaniac"}, "path": "apollo-gradle-plugin/src/main/kotlin/com/apollographql/apollo/gradle/api/AndroidProject.kt", "diffHunk": "@@ -0,0 +1,76 @@\n+package com.apollographql.apollo.gradle.api\n+\n+import com.android.build.gradle.AppExtension\n+import com.android.build.gradle.BaseExtension\n+import com.android.build.gradle.LibraryExtension\n+import com.android.build.gradle.TestedExtension\n+import com.android.build.gradle.api.BaseVariant\n+import com.apollographql.apollo.gradle.internal.ApolloGenerateSourcesTask\n+import org.gradle.api.Project\n+import org.gradle.api.Task\n+import org.gradle.api.file.Directory\n+import org.gradle.api.provider.Provider\n+import org.gradle.api.tasks.TaskContainer\n+import org.gradle.api.tasks.TaskProvider\n+import org.jetbrains.kotlin.gradle.tasks.KotlinCompile\n+\n+object AndroidProject {\n+  fun onEachVariant(project: Project, withTestVariants: Boolean = false, block: (BaseVariant) -> Unit) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "eab76b24dcb5c891a6358316775aa4cf7b928303"}, "originalPosition": 18}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwOTA2NDYxMg==", "bodyText": "Hmm, I see now that you do a null check with a proper message. But it looks like the usages also check that.", "url": "https://github.com/apollographql/apollo-android/pull/2677#discussion_r509064612", "createdAt": "2020-10-21T07:54:05Z", "author": {"login": "tasomaniac"}, "path": "apollo-gradle-plugin/src/main/kotlin/com/apollographql/apollo/gradle/api/AndroidProject.kt", "diffHunk": "@@ -0,0 +1,76 @@\n+package com.apollographql.apollo.gradle.api\n+\n+import com.android.build.gradle.AppExtension\n+import com.android.build.gradle.BaseExtension\n+import com.android.build.gradle.LibraryExtension\n+import com.android.build.gradle.TestedExtension\n+import com.android.build.gradle.api.BaseVariant\n+import com.apollographql.apollo.gradle.internal.ApolloGenerateSourcesTask\n+import org.gradle.api.Project\n+import org.gradle.api.Task\n+import org.gradle.api.file.Directory\n+import org.gradle.api.provider.Provider\n+import org.gradle.api.tasks.TaskContainer\n+import org.gradle.api.tasks.TaskProvider\n+import org.jetbrains.kotlin.gradle.tasks.KotlinCompile\n+\n+object AndroidProject {\n+  fun onEachVariant(project: Project, withTestVariants: Boolean = false, block: (BaseVariant) -> Unit) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwOTA2MzU0OA=="}, "originalCommit": {"oid": "eab76b24dcb5c891a6358316775aa4cf7b928303"}, "originalPosition": 18}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwOTk3MjAyMg==", "bodyText": "Can we not target 6.2 now?", "url": "https://github.com/apollographql/apollo-android/pull/2677#discussion_r509972022", "createdAt": "2020-10-22T08:23:56Z", "author": {"login": "tasomaniac"}, "path": "apollo-gradle-plugin/src/main/kotlin/com/apollographql/apollo/gradle/internal/DefaultService.kt", "diffHunk": "@@ -20,14 +21,22 @@ import javax.inject.Inject\n abstract class DefaultService @Inject constructor(val objects: ObjectFactory, override val name: String)\n   : Service {\n \n+  init {\n+    // see https://github.com/gradle/gradle/issues/7485\n+    // TODO replace with `convention(null)` when we can target Gradle 6.2", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "be28b2fd06a0ff097bb244c09dc78469bd510851"}, "originalPosition": 14}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwOTk3MjgwMw==", "bodyText": "This error is now missing a suggestion. When we fail because of multiple schemas, what should they do?", "url": "https://github.com/apollographql/apollo-android/pull/2677#discussion_r509972803", "createdAt": "2020-10-22T08:25:08Z", "author": {"login": "tasomaniac"}, "path": "apollo-gradle-plugin/src/main/kotlin/com/apollographql/apollo/gradle/internal/DefaultService.kt", "diffHunk": "@@ -123,16 +128,7 @@ abstract class DefaultService @Inject constructor(val objects: ObjectFactory, ov\n         \"\"\"\n Multiple schemas found:\n ${candidates.joinToString(separator = \"\\n\")}", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "be28b2fd06a0ff097bb244c09dc78469bd510851"}, "originalPosition": 55}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "56e3499889701e750b986c44e95e4c746eaba8f8", "author": {"user": {"login": "martinbonnin", "name": "Martin Bonnin"}}, "url": "https://github.com/apollographql/apollo-android/commit/56e3499889701e750b986c44e95e4c746eaba8f8", "committedDate": "2020-10-22T13:12:31Z", "message": "use androidExtensionOrFail"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTE1MDg3OTg2", "url": "https://github.com/apollographql/apollo-android/pull/2677#pullrequestreview-515087986", "createdAt": "2020-10-22T20:20:09Z", "commit": {"oid": "56e3499889701e750b986c44e95e4c746eaba8f8"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "50b711fc4ff3d81de7781f53a330b8f412a1be8e", "author": {"user": {"login": "martinbonnin", "name": "Martin Bonnin"}}, "url": "https://github.com/apollographql/apollo-android/commit/50b711fc4ff3d81de7781f53a330b8f412a1be8e", "committedDate": "2020-10-22T23:14:12Z", "message": "allow to call customTypeMapping.put"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e2212d54ede675e644b03171ba69c3a5f0f363a2", "author": {"user": {"login": "martinbonnin", "name": "Martin Bonnin"}}, "url": "https://github.com/apollographql/apollo-android/commit/e2212d54ede675e644b03171ba69c3a5f0f363a2", "committedDate": "2020-10-22T23:16:29Z", "message": "add more details"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4165, "cost": 1, "resetAt": "2021-11-01T11:59:11Z"}}}