{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTI4MjE5MzEz", "number": 2776, "reviewThreads": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0yNlQxODoxNToyOVrOE9upvg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0yNlQyMzowNzowMFrOE9xvQQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzMzMTYyOTQyOnYy", "diffSide": "RIGHT", "path": "apollo-api/src/commonMain/kotlin/com/apollographql/apollo/api/SealedEnumType.kt", "isResolved": true, "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0yNlQxODoxNTozMFrOH6kjtQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0yNlQyMTo0ODoxM1rOH6n6pQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMTE3ODQyMQ==", "bodyText": "I kind of wanted to follow ScalarType naming, but of course can change it to whatever is more appropriate.\nAlso, @martinbonnin suggested using an interface (#2775 (comment)), but I wasn't sure it's okay to have a default method with toString implementation. And if the idea was to add a case here then of course I can also do that, it's just overriding toString feels like a good solution", "url": "https://github.com/apollographql/apollo-android/pull/2776#discussion_r531178421", "createdAt": "2020-11-26T18:15:30Z", "author": {"login": "lwasyl"}, "path": "apollo-api/src/commonMain/kotlin/com/apollographql/apollo/api/SealedEnumType.kt", "diffHunk": "@@ -0,0 +1,11 @@\n+package com.apollographql.apollo.api\n+\n+/**\n+ * Base class for an enum type when generating sealed Kotlin class\n+ */\n+abstract class SealedEnumType {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "1d67c78800f32224143f43c65971318371c96da5"}, "originalPosition": 6}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMTIwNzEwNQ==", "bodyText": "I kind of wanted to follow ScalarType naming, but of course can change it to whatever is more appropriate.\n\nNaming is hard... I'm personnaly not a fan of ScalarType as it acts more like a type-safe Binding or Mapping between a GraphQL type and a Kotlin one, rather than a proper type. So I don't mind not following the logic here.\nWhat about the below:\ninterface EnumValue {\n  val rawValue: String\n}\n\n? This will be closest to the spec: https://spec.graphql.org/draft/#EnumValue\n\nAnd if the idea was to add a case here then of course I can also do that, it's just overriding toString feels like a good solution\n\nIt was the original intent. I feel it's dangerous to rely on toString() because it typically exposes to these kind of bugs that we're seeing here. The compiler cannot catch if a new type is added a someone forgets to override toString().\nUltimately, I was thinking of moving this:\nfun writeToJson(value: Any?, jsonWriter: JsonWriter) {\n\nto something more like:\nfun writeToJson(value: InputValue, jsonWriter: JsonWriter) {\n\nwhere InputValue would be an instance of an InputType as defined by https://spec.graphql.org/draft/#IsInputType(), i.e. scalar, enum or InputObject\nWe're not there yet but adding EnumValue might be a step in the good direction?", "url": "https://github.com/apollographql/apollo-android/pull/2776#discussion_r531207105", "createdAt": "2020-11-26T19:56:13Z", "author": {"login": "martinbonnin"}, "path": "apollo-api/src/commonMain/kotlin/com/apollographql/apollo/api/SealedEnumType.kt", "diffHunk": "@@ -0,0 +1,11 @@\n+package com.apollographql.apollo.api\n+\n+/**\n+ * Base class for an enum type when generating sealed Kotlin class\n+ */\n+abstract class SealedEnumType {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMTE3ODQyMQ=="}, "originalCommit": {"oid": "1d67c78800f32224143f43c65971318371c96da5"}, "originalPosition": 6}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMTIzMzQ0NQ==", "bodyText": "I changed the abstract class to interface EnumValue, following the GraphQL spec definitely makes sense! Also with that change I now could implement that interface for all enum classes, not only the ones generated as sealed classes.\nwriteToJson(value: InputValue also makes perfect sense. I originally thought it's more of a general-purpose utility, that's why I had doubts :)", "url": "https://github.com/apollographql/apollo-android/pull/2776#discussion_r531233445", "createdAt": "2020-11-26T21:48:13Z", "author": {"login": "lwasyl"}, "path": "apollo-api/src/commonMain/kotlin/com/apollographql/apollo/api/SealedEnumType.kt", "diffHunk": "@@ -0,0 +1,11 @@\n+package com.apollographql.apollo.api\n+\n+/**\n+ * Base class for an enum type when generating sealed Kotlin class\n+ */\n+abstract class SealedEnumType {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMTE3ODQyMQ=="}, "originalCommit": {"oid": "1d67c78800f32224143f43c65971318371c96da5"}, "originalPosition": 6}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzMzMTYzMTU4OnYy", "diffSide": "RIGHT", "path": "apollo-compiler/src/main/kotlin/com/apollographql/apollo/compiler/codegen/kotlin/EnumType.kt", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0yNlQxODoxNjozMFrOH6kk6Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0yNlQxOTo1NzoyOFrOH6mVOQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMTE3ODcyOQ==", "bodyText": "The primaryConstructorSpec is used also when generating enum class and for Unknown case, so we need a new one that overrides the raw value", "url": "https://github.com/apollographql/apollo-android/pull/2776#discussion_r531178729", "createdAt": "2020-11-26T18:16:30Z", "author": {"login": "lwasyl"}, "path": "apollo-compiler/src/main/kotlin/com/apollographql/apollo/compiler/codegen/kotlin/EnumType.kt", "diffHunk": "@@ -37,6 +38,12 @@ private val primaryConstructorSpec =\n         .addParameter(\"rawValue\", String::class)\n         .build()\n \n+private val sealedSubclassPrimaryConstructorSpec =", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "1d67c78800f32224143f43c65971318371c96da5"}, "originalPosition": 11}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMTIwNzQ4MQ==", "bodyText": "Makes sense \ud83d\udc4d", "url": "https://github.com/apollographql/apollo-android/pull/2776#discussion_r531207481", "createdAt": "2020-11-26T19:57:28Z", "author": {"login": "martinbonnin"}, "path": "apollo-compiler/src/main/kotlin/com/apollographql/apollo/compiler/codegen/kotlin/EnumType.kt", "diffHunk": "@@ -37,6 +38,12 @@ private val primaryConstructorSpec =\n         .addParameter(\"rawValue\", String::class)\n         .build()\n \n+private val sealedSubclassPrimaryConstructorSpec =", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMTE3ODcyOQ=="}, "originalCommit": {"oid": "1d67c78800f32224143f43c65971318371c96da5"}, "originalPosition": 11}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzMzMjEzNTA1OnYy", "diffSide": "RIGHT", "path": "apollo-compiler/src/test/graphql/com/example/java_beans_semantic_naming/type/Episode.kt", "isResolved": true, "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0yNlQyMzowNzowMFrOH6o24Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0yNlQyMzoyNTozNFrOH6pDoA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMTI0ODg2NQ==", "bodyText": "Paranoid checks: I think this is a backward compatible change but since it touches regular enums and not only sealed classes this has the potential to impact a lot more users. Are we possibly missing a weird edge case?", "url": "https://github.com/apollographql/apollo-android/pull/2776#discussion_r531248865", "createdAt": "2020-11-26T23:07:00Z", "author": {"login": "martinbonnin"}, "path": "apollo-compiler/src/test/graphql/com/example/java_beans_semantic_naming/type/Episode.kt", "diffHunk": "@@ -5,15 +5,16 @@\n //\n package com.example.java_beans_semantic_naming.type\n \n+import com.apollographql.apollo.api.EnumValue\n import kotlin.Deprecated\n import kotlin.String\n \n /**\n  * The episodes in the Star Wars trilogy\n  */\n enum class Episode(\n-  val rawValue: String\n-) {\n+  override val rawValue: String\n+) : EnumValue {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "8153582764492c37e9d16ca396beff18d6033c92"}, "originalPosition": 15}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMTI1MTIwNA==", "bodyText": "I don't see any \ud83e\udd14 One edge case would be using jar with generated old classes (no interface) with new runtime, but it should work (just the check won't trigger). For enum classes behavior doesn't change at all, as from what I see both raw value and enum name always match (so cache won't break when updating app with new generated classes).\nI can of course revert this if you find some problem or just feel I should only fix the bug with sealed classes and let enum classes as is. It just felt weird leaving actual enum classes without having them implement EnumValue interface \ud83d\ude42", "url": "https://github.com/apollographql/apollo-android/pull/2776#discussion_r531251204", "createdAt": "2020-11-26T23:20:36Z", "author": {"login": "lwasyl"}, "path": "apollo-compiler/src/test/graphql/com/example/java_beans_semantic_naming/type/Episode.kt", "diffHunk": "@@ -5,15 +5,16 @@\n //\n package com.example.java_beans_semantic_naming.type\n \n+import com.apollographql.apollo.api.EnumValue\n import kotlin.Deprecated\n import kotlin.String\n \n /**\n  * The episodes in the Star Wars trilogy\n  */\n enum class Episode(\n-  val rawValue: String\n-) {\n+  override val rawValue: String\n+) : EnumValue {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMTI0ODg2NQ=="}, "originalCommit": {"oid": "8153582764492c37e9d16ca396beff18d6033c92"}, "originalPosition": 15}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMTI1MjEyOA==", "bodyText": "Yep, I think it's safe too \ud83d\udc4d and way more uniform like this \ud83d\udc4d .", "url": "https://github.com/apollographql/apollo-android/pull/2776#discussion_r531252128", "createdAt": "2020-11-26T23:25:34Z", "author": {"login": "martinbonnin"}, "path": "apollo-compiler/src/test/graphql/com/example/java_beans_semantic_naming/type/Episode.kt", "diffHunk": "@@ -5,15 +5,16 @@\n //\n package com.example.java_beans_semantic_naming.type\n \n+import com.apollographql.apollo.api.EnumValue\n import kotlin.Deprecated\n import kotlin.String\n \n /**\n  * The episodes in the Star Wars trilogy\n  */\n enum class Episode(\n-  val rawValue: String\n-) {\n+  override val rawValue: String\n+) : EnumValue {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMTI0ODg2NQ=="}, "originalCommit": {"oid": "8153582764492c37e9d16ca396beff18d6033c92"}, "originalPosition": 15}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2983, "cost": 1, "resetAt": "2021-11-12T09:44:50Z"}}}