{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDE5MTUyOTQw", "number": 2279, "reviewThreads": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xOFQwNzoxMjo0NVrOD9RDIw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xOFQwNzoyMzoxMVrOD9RO8Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjY1NTY5MDU5OnYy", "diffSide": "RIGHT", "path": "apollo-gradle-plugin/src/main/kotlin/com/apollographql/apollo/gradle/api/CompilerParams.kt", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xOFQwNzoxMjo0NVrOGWqHqw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xOFQwNzoxMjo0NVrOGWqHqw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNjQxMTk0Nw==", "bodyText": "This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters. Learn more about bidirectional Unicode characters\n\n\n  \n\n\n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n              /**\n          \n          \n            \n               * Whether to generate GraphQL enum types by matching as Kotlin sealed classes if they match one of provided regex patterns.\n          \n          \n            \n               * By default any GraphQL enum type is generated as `enum class`.\n          \n          \n            \n               */\n          \n          \n            \n              /**\n          \n          \n            \n               * A list of [Regex] patterns for GraphQL enums that should be generated as Kotlin sealed classes instead\n          \n          \n            \n               * of the default Kotlin enums.\n          \n          \n            \n               * Use this if you want your client to have access to the rawValue of the enum. This can be useful if new\n          \n          \n            \n               * GraphQL enums are added but the client was compiled against an older schema that doesn't have knowledge\n          \n          \n            \n               * of the new enums.\n          \n          \n            \n               */", "url": "https://github.com/apollographql/apollo-android/pull/2279#discussion_r426411947", "createdAt": "2020-05-18T07:12:45Z", "author": {"login": "martinbonnin"}, "path": "apollo-gradle-plugin/src/main/kotlin/com/apollographql/apollo/gradle/api/CompilerParams.kt", "diffHunk": "@@ -154,4 +154,10 @@ interface CompilerParams {\n    * Default value: false\n    */\n   val generateAsInternal: Property<Boolean>\n+\n+  /**\n+   * Whether to generate GraphQL enum types by matching as Kotlin sealed classes if they match one of provided regex patterns.\n+   * By default any GraphQL enum type is generated as `enum class`.\n+   */", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b71e89073bd092ce581a462c9b2b254c4b9b22ec"}, "originalPosition": 19}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjY1NTY5ODM1OnYy", "diffSide": "RIGHT", "path": "apollo-gradle-plugin/src/main/kotlin/com/apollographql/apollo/gradle/api/CompilerParams.kt", "isResolved": true, "comments": {"totalCount": 8, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xOFQwNzoxNTozNlrOGWqMhg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xOVQxMDoyNTo0NFrOGXZ7yg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNjQxMzE5MA==", "bodyText": "Nit: Maybe name this enumAsSealedClassPatterns? generate is used above for Boolean properties and making the property plural would also hint that it is a List.\nEDIT: I just saw the property is named enumAsSealedClassPatternFilters  in GraphQLCompiler.Arguments. Maybe use that everywhere ?", "url": "https://github.com/apollographql/apollo-android/pull/2279#discussion_r426413190", "createdAt": "2020-05-18T07:15:36Z", "author": {"login": "martinbonnin"}, "path": "apollo-gradle-plugin/src/main/kotlin/com/apollographql/apollo/gradle/api/CompilerParams.kt", "diffHunk": "@@ -154,4 +154,10 @@ interface CompilerParams {\n    * Default value: false\n    */\n   val generateAsInternal: Property<Boolean>\n+\n+  /**\n+   * Whether to generate GraphQL enum types by matching as Kotlin sealed classes if they match one of provided regex patterns.\n+   * By default any GraphQL enum type is generated as `enum class`.\n+   */\n+  val generateEnumAsSealedClass: ListProperty<String>", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b71e89073bd092ce581a462c9b2b254c4b9b22ec"}, "originalPosition": 20}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNjc3Mzc2Nw==", "bodyText": "Yeah, hard to come up with proper name my thought enumAsSealedClassPatternFilters   is ok for internal usage but was not great for public API.\ngenerateSealedClassForEnums, sealedClassForEnums, enumsAsClasses, enumAsSealedClassPatterns?\nOr do you think enumAsSealedClassPatternFilters should be fine?", "url": "https://github.com/apollographql/apollo-android/pull/2279#discussion_r426773767", "createdAt": "2020-05-18T17:07:48Z", "author": {"login": "sav007"}, "path": "apollo-gradle-plugin/src/main/kotlin/com/apollographql/apollo/gradle/api/CompilerParams.kt", "diffHunk": "@@ -154,4 +154,10 @@ interface CompilerParams {\n    * Default value: false\n    */\n   val generateAsInternal: Property<Boolean>\n+\n+  /**\n+   * Whether to generate GraphQL enum types by matching as Kotlin sealed classes if they match one of provided regex patterns.\n+   * By default any GraphQL enum type is generated as `enum class`.\n+   */\n+  val generateEnumAsSealedClass: ListProperty<String>", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNjQxMzE5MA=="}, "originalCommit": {"oid": "b71e89073bd092ce581a462c9b2b254c4b9b22ec"}, "originalPosition": 20}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNjgwNzA3MQ==", "bodyText": "I also think that the one used in the code internally is not super clear for external facing extension. We can make it plural easily to indicate that. Since they're enum in GraphQL convention, I like starting with generateEnums\nWhat about\ngenerateEnumsAsSealedClassesFor\n\nor\ngenerateSealedClassesForEnums\n\n2nd one is already suggested by Ivan. First one is little uglier but make it clear that it expect complex input \ud83d\ude0a", "url": "https://github.com/apollographql/apollo-android/pull/2279#discussion_r426807071", "createdAt": "2020-05-18T18:09:55Z", "author": {"login": "tasomaniac"}, "path": "apollo-gradle-plugin/src/main/kotlin/com/apollographql/apollo/gradle/api/CompilerParams.kt", "diffHunk": "@@ -154,4 +154,10 @@ interface CompilerParams {\n    * Default value: false\n    */\n   val generateAsInternal: Property<Boolean>\n+\n+  /**\n+   * Whether to generate GraphQL enum types by matching as Kotlin sealed classes if they match one of provided regex patterns.\n+   * By default any GraphQL enum type is generated as `enum class`.\n+   */\n+  val generateEnumAsSealedClass: ListProperty<String>", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNjQxMzE5MA=="}, "originalCommit": {"oid": "b71e89073bd092ce581a462c9b2b254c4b9b22ec"}, "originalPosition": 20}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNjgxOTE4MA==", "bodyText": "Maybe something that describes the end functionality instead of the codegen details ?\nexposeRawValueForUnknownEnums\n\nor\nexposeRawValueForEnumsMatching", "url": "https://github.com/apollographql/apollo-android/pull/2279#discussion_r426819180", "createdAt": "2020-05-18T18:33:25Z", "author": {"login": "martinbonnin"}, "path": "apollo-gradle-plugin/src/main/kotlin/com/apollographql/apollo/gradle/api/CompilerParams.kt", "diffHunk": "@@ -154,4 +154,10 @@ interface CompilerParams {\n    * Default value: false\n    */\n   val generateAsInternal: Property<Boolean>\n+\n+  /**\n+   * Whether to generate GraphQL enum types by matching as Kotlin sealed classes if they match one of provided regex patterns.\n+   * By default any GraphQL enum type is generated as `enum class`.\n+   */\n+  val generateEnumAsSealedClass: ListProperty<String>", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNjQxMzE5MA=="}, "originalCommit": {"oid": "b71e89073bd092ce581a462c9b2b254c4b9b22ec"}, "originalPosition": 20}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNjkzMjk0Nw==", "bodyText": "but then it's not clear that the end result is going to be a sealed class generated instead of regular enum, I think it's important to have sealedClass in there.\n1 - enumsAsSealedClassesMatching\n2 - enumsAsClassesMatching\n3 - sealedClassesForEnums\n4 - sealedClassesForEnumsMatching\nAnother option if this make sense make it lambda:\napollo {\n  enumsAsSealedClasses {\n    matching = [\".*\"]\n  }\n}", "url": "https://github.com/apollographql/apollo-android/pull/2279#discussion_r426932947", "createdAt": "2020-05-18T22:48:02Z", "author": {"login": "sav007"}, "path": "apollo-gradle-plugin/src/main/kotlin/com/apollographql/apollo/gradle/api/CompilerParams.kt", "diffHunk": "@@ -154,4 +154,10 @@ interface CompilerParams {\n    * Default value: false\n    */\n   val generateAsInternal: Property<Boolean>\n+\n+  /**\n+   * Whether to generate GraphQL enum types by matching as Kotlin sealed classes if they match one of provided regex patterns.\n+   * By default any GraphQL enum type is generated as `enum class`.\n+   */\n+  val generateEnumAsSealedClass: ListProperty<String>", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNjQxMzE5MA=="}, "originalCommit": {"oid": "b71e89073bd092ce581a462c9b2b254c4b9b22ec"}, "originalPosition": 20}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNzEwOTExMw==", "bodyText": "I like sealedClassesForEnumsMatching", "url": "https://github.com/apollographql/apollo-android/pull/2279#discussion_r427109113", "createdAt": "2020-05-19T08:08:23Z", "author": {"login": "martinbonnin"}, "path": "apollo-gradle-plugin/src/main/kotlin/com/apollographql/apollo/gradle/api/CompilerParams.kt", "diffHunk": "@@ -154,4 +154,10 @@ interface CompilerParams {\n    * Default value: false\n    */\n   val generateAsInternal: Property<Boolean>\n+\n+  /**\n+   * Whether to generate GraphQL enum types by matching as Kotlin sealed classes if they match one of provided regex patterns.\n+   * By default any GraphQL enum type is generated as `enum class`.\n+   */\n+  val generateEnumAsSealedClass: ListProperty<String>", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNjQxMzE5MA=="}, "originalCommit": {"oid": "b71e89073bd092ce581a462c9b2b254c4b9b22ec"}, "originalPosition": 20}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNzE0NjQ3OA==", "bodyText": "I definitely like that too. \ud83d\udc4d", "url": "https://github.com/apollographql/apollo-android/pull/2279#discussion_r427146478", "createdAt": "2020-05-19T09:05:07Z", "author": {"login": "tasomaniac"}, "path": "apollo-gradle-plugin/src/main/kotlin/com/apollographql/apollo/gradle/api/CompilerParams.kt", "diffHunk": "@@ -154,4 +154,10 @@ interface CompilerParams {\n    * Default value: false\n    */\n   val generateAsInternal: Property<Boolean>\n+\n+  /**\n+   * Whether to generate GraphQL enum types by matching as Kotlin sealed classes if they match one of provided regex patterns.\n+   * By default any GraphQL enum type is generated as `enum class`.\n+   */\n+  val generateEnumAsSealedClass: ListProperty<String>", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNjQxMzE5MA=="}, "originalCommit": {"oid": "b71e89073bd092ce581a462c9b2b254c4b9b22ec"}, "originalPosition": 20}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNzE5NTMzOA==", "bodyText": "We got a winner \ud83c\udf89 \ud83d\ude03", "url": "https://github.com/apollographql/apollo-android/pull/2279#discussion_r427195338", "createdAt": "2020-05-19T10:25:44Z", "author": {"login": "martinbonnin"}, "path": "apollo-gradle-plugin/src/main/kotlin/com/apollographql/apollo/gradle/api/CompilerParams.kt", "diffHunk": "@@ -154,4 +154,10 @@ interface CompilerParams {\n    * Default value: false\n    */\n   val generateAsInternal: Property<Boolean>\n+\n+  /**\n+   * Whether to generate GraphQL enum types by matching as Kotlin sealed classes if they match one of provided regex patterns.\n+   * By default any GraphQL enum type is generated as `enum class`.\n+   */\n+  val generateEnumAsSealedClass: ListProperty<String>", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNjQxMzE5MA=="}, "originalCommit": {"oid": "b71e89073bd092ce581a462c9b2b254c4b9b22ec"}, "originalPosition": 20}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjY1NTcxMzE1OnYy", "diffSide": "RIGHT", "path": "apollo-compiler/src/test/kotlin/com/apollographql/apollo/compiler/CodegenTest.kt", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xOFQwNzoyMDo0MlrOGWqVuA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xOFQwNzoyMDo0MlrOGWqVuA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNjQxNTU0NA==", "bodyText": "Nice \ud83d\ude03", "url": "https://github.com/apollographql/apollo-android/pull/2279#discussion_r426415544", "createdAt": "2020-05-18T07:20:42Z", "author": {"login": "martinbonnin"}, "path": "apollo-compiler/src/test/kotlin/com/apollographql/apollo/compiler/CodegenTest.kt", "diffHunk": "@@ -96,13 +96,19 @@ class CodeGenTest(private val folder: File) {\n         jvmTarget = \"1.8\"\n         sources = kotlinFiles\n \n-        val expectedWarnings = folder.name in listOf(\"deprecation\", \"custom_scalar_type_warnings\")\n+        val expectedWarnings = folder.name in listOf(\"deprecation\", \"custom_scalar_type_warnings\", \"arguments_complex\", \"arguments_simple\")\n         allWarningsAsErrors = expectedWarnings.not()\n         inheritClassPath = true\n         messageOutputStream = System.out // see diagnostics in real time\n       }.compile()\n \n-      assertThat(result.exitCode).isEqualTo(KotlinCompilation.ExitCode.OK)\n+      if (result.exitCode != KotlinCompilation.ExitCode.OK) {\n+        val compilationErrorMessages = \"\\\\ne: .*\\\\n+\".toRegex().find(result.messages)?.groupValues ?: emptyList()\n+        val errorMessages = compilationErrorMessages.joinToString(prefix = \"\\n\", separator = \"\\n\", postfix = \"\\n\") {\n+          \"`${it.replace(\"\\n\", \"\")}`\"\n+        }\n+        fail(\"Failed to compile generated Kotlin files due to compiler errors: $errorMessages\")", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b71e89073bd092ce581a462c9b2b254c4b9b22ec"}, "originalPosition": 48}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjY1NTcyMDgxOnYy", "diffSide": "RIGHT", "path": "apollo-compiler/src/main/kotlin/com/apollographql/apollo/compiler/codegen/kotlin/EnumType.kt", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xOFQwNzoyMzoxMVrOGWqaZg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xOFQwNzoyMzoxMVrOGWqaZg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNjQxNjc0Mg==", "bodyText": "Is the check for isNotEmpty() needed here ? I would expect any to return false on empty lists.", "url": "https://github.com/apollographql/apollo-android/pull/2279#discussion_r426416742", "createdAt": "2020-05-18T07:23:11Z", "author": {"login": "martinbonnin"}, "path": "apollo-compiler/src/main/kotlin/com/apollographql/apollo/compiler/codegen/kotlin/EnumType.kt", "diffHunk": "@@ -4,19 +4,32 @@ import com.apollographql.apollo.compiler.applyIf\n import com.apollographql.apollo.compiler.ast.EnumType\n import com.squareup.kotlinpoet.*\n \n-internal fun EnumType.typeSpec(generateAsInternal: Boolean = false) =\n-    TypeSpec\n-        .enumBuilder(name)\n-        .applyIf(description.isNotBlank()) { addKdoc(\"%L\\n\", description) }\n-        .applyIf(generateAsInternal) { addModifiers(KModifier.INTERNAL) }\n-        .primaryConstructor(primaryConstructorSpec)\n-        .addProperty(rawValuePropertySpec)\n-        .apply {\n-          values.forEach { value -> addEnumConstant(value.constName, value.enumConstTypeSpec) }\n-          addEnumConstant(\"UNKNOWN__\", unknownEnumConstTypeSpec)\n-        }\n-        .addType(companionObjectSpec)\n-        .build()\n+internal fun EnumType.typeSpec(\n+    generateAsInternal: Boolean = false,\n+    enumAsSealedClassPatternFilters: List<Regex>\n+): TypeSpec {\n+  val asSealedClass = enumAsSealedClassPatternFilters.isNotEmpty() && enumAsSealedClassPatternFilters.any { pattern ->", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b71e89073bd092ce581a462c9b2b254c4b9b22ec"}, "originalPosition": 21}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3077, "cost": 1, "resetAt": "2021-11-12T09:44:50Z"}}}