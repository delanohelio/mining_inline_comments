{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0Mzg2NDE1OTEw", "number": 2062, "title": "Introduce Kotlin Multiplatform into apollo-api module", "bodyText": "For now, we only have jvm as a target. That means that all changes in JVM should be backward compatible.\nWhat is next?\n\nMaven publish should be tested (probably needs to be adjusted) More info: https://kotlinlang.org/docs/reference/building-mpp-with-gradle.html#publishing-a-multiplatform-library\nFileUpload, ScalarTypeAdapters implementations only exist in jvm. So in a potential native implementation, these need to be reimplemented.\nBigDecimal is typealiased to java.math.BigDecimal. Investigation showed that using ULong in possible native impl should be enough.\nOptional, its siblings and UnmodifiableMapBuilder classes are kept in Java and only ever going to be available for Java code generation. This should just work for now.\n\nUnit tests\nKept all tests in Java (Checkstyle suddenly started to yell and had to little style fixes)\nIn apolli-api module, we only have jvmTest target. Once we have actual multi-platform code, this needs to be moved into commonTest as much as possible.", "createdAt": "2020-03-10T23:46:26Z", "url": "https://github.com/apollographql/apollo-android/pull/2062", "merged": true, "mergeCommit": {"oid": "c3a264ceecfc8617b5b526e297f9d6d3c1c9947c"}, "closed": true, "closedAt": "2020-03-13T08:19:39Z", "author": {"login": "tasomaniac"}, "timelineItems": {"totalCount": 22, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcMbRjbgH2gAyMzg2NDE1OTEwOjAzOTE1YmM4NTU4NDQyYzcxMTNmYzgxMzNlMWI0Mjk1NmY5YjM3ODg=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcNDuTHgFqTM3Mzk0OTQyNA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "03915bc8558442c7113fc8133e1b42956f9b3788", "author": {"user": {"login": "tasomaniac", "name": "Said Tahsin Dane"}}, "url": "https://github.com/apollographql/apollo-android/commit/03915bc8558442c7113fc8133e1b42956f9b3788", "committedDate": "2020-03-10T23:39:47Z", "message": "Introduce Kotlin Multiplatform into apollo-api module"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a76050801e72145db5861dc5ff3c57c52519e24a", "author": {"user": {"login": "tasomaniac", "name": "Said Tahsin Dane"}}, "url": "https://github.com/apollographql/apollo-android/commit/a76050801e72145db5861dc5ff3c57c52519e24a", "committedDate": "2020-03-10T23:47:16Z", "message": "Revert unnecessary change"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzcyMzk1MDIz", "url": "https://github.com/apollographql/apollo-android/pull/2062#pullrequestreview-372395023", "createdAt": "2020-03-10T23:48:01Z", "commit": {"oid": "03915bc8558442c7113fc8133e1b42956f9b3788"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xMFQyMzo0ODowMVrOF0k4bQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xMFQyMzo0ODowMVrOF0k4bQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MDY3NDU0MQ==", "bodyText": "Here hashCode has been always the same value. Was that intentional?", "url": "https://github.com/apollographql/apollo-android/pull/2062#discussion_r390674541", "createdAt": "2020-03-10T23:48:01Z", "author": {"login": "tasomaniac"}, "path": "apollo-api/src/commonMain/kotlin/com/apollographql/apollo/api/CustomTypeValue.kt", "diffHunk": "@@ -13,11 +16,12 @@ sealed class CustomTypeValue<T>(@JvmField val value: T) {\n     override fun equals(other: Any?): Boolean {\n       if (this === other) return true\n       if (other !is GraphQLString) return false\n+      if (value != other.value) return false\n       return true\n     }\n \n     override fun hashCode(): Int {\n-      return javaClass.hashCode()", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "03915bc8558442c7113fc8133e1b42956f9b3788"}, "originalPosition": 18}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzcyMzk1NzUx", "url": "https://github.com/apollographql/apollo-android/pull/2062#pullrequestreview-372395751", "createdAt": "2020-03-10T23:50:16Z", "commit": {"oid": "03915bc8558442c7113fc8133e1b42956f9b3788"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xMFQyMzo1MDoxNlrOF0k63Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xMFQyMzo1MDoxNlrOF0k63Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MDY3NTE2NQ==", "bodyText": "I want to say that this is the same as before. But I'm not sure.", "url": "https://github.com/apollographql/apollo-android/pull/2062#discussion_r390675165", "createdAt": "2020-03-10T23:50:16Z", "author": {"login": "tasomaniac"}, "path": "apollo-api/src/commonMain/kotlin/com/apollographql/apollo/api/internal/SimpleResponseReader.kt", "diffHunk": "@@ -125,12 +124,12 @@ class SimpleResponseReader private constructor(\n         val conditionValue = variableValues[condition.variableName] as Boolean\n         if (condition.inverted) {\n           // means it's a skip directive\n-          if (java.lang.Boolean.TRUE == conditionValue) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "03915bc8558442c7113fc8133e1b42956f9b3788"}, "originalPosition": 12}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "7aa804cd43c808b3b6f25f927db50bb786cfc64c", "author": {"user": {"login": "tasomaniac", "name": "Said Tahsin Dane"}}, "url": "https://github.com/apollographql/apollo-android/commit/7aa804cd43c808b3b6f25f927db50bb786cfc64c", "committedDate": "2020-03-10T23:53:46Z", "message": "Have String.format in common code"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzcyMzk3NjYz", "url": "https://github.com/apollographql/apollo-android/pull/2062#pullrequestreview-372397663", "createdAt": "2020-03-10T23:56:15Z", "commit": {"oid": "03915bc8558442c7113fc8133e1b42956f9b3788"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xMFQyMzo1NjoxNVrOF0lBiA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xMFQyMzo1NjoxNVrOF0lBiA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MDY3Njg3Mg==", "bodyText": "I'm not 100% sure about this. Right now, this is the only choice to keep it compatible. This means, javaType will work as before for Jvm/Android.\nRight now, this is also used by generated code. So, it would be blocker moving forward to figure this out.", "url": "https://github.com/apollographql/apollo-android/pull/2062#discussion_r390676872", "createdAt": "2020-03-10T23:56:15Z", "author": {"login": "tasomaniac"}, "path": "apollo-api/src/jvmMain/kotlin/com/apollographql/apollo/api/ScalarType.kt", "diffHunk": "@@ -0,0 +1,10 @@\n+package com.apollographql.apollo.api\n+\n+/**\n+ * Represents a custom GraphQL scalar type\n+ */\n+actual interface ScalarType {\n+  actual fun typeName(): String\n+\n+  fun javaType(): Class<*>", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "03915bc8558442c7113fc8133e1b42956f9b3788"}, "originalPosition": 9}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "1595070d772398418a47fb22d5f335edd43affc9", "author": {"user": {"login": "tasomaniac", "name": "Said Tahsin Dane"}}, "url": "https://github.com/apollographql/apollo-android/commit/1595070d772398418a47fb22d5f335edd43affc9", "committedDate": "2020-03-11T00:03:27Z", "message": "Try with jvm suffix on artifact id"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "bea17e0864bdf99ef2e676f109a4ea8bb84b52b3", "author": {"user": {"login": "tasomaniac", "name": "Said Tahsin Dane"}}, "url": "https://github.com/apollographql/apollo-android/commit/bea17e0864bdf99ef2e676f109a4ea8bb84b52b3", "committedDate": "2020-03-11T00:04:35Z", "message": "Revert checkstyle changes in tests"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzcyNDAzMTMx", "url": "https://github.com/apollographql/apollo-android/pull/2062#pullrequestreview-372403131", "createdAt": "2020-03-11T00:14:03Z", "commit": {"oid": "bea17e0864bdf99ef2e676f109a4ea8bb84b52b3"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xMVQwMDoxNDowM1rOF0lUyQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xMVQwMDoxNDowM1rOF0lUyQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MDY4MTgwMQ==", "bodyText": "is it intentionally? I thought we keep the name of artifact the same.", "url": "https://github.com/apollographql/apollo-android/pull/2062#discussion_r390681801", "createdAt": "2020-03-11T00:14:03Z", "author": {"login": "sav007"}, "path": "apollo-api/gradle.properties", "diffHunk": "@@ -1,4 +1,4 @@\n-POM_ARTIFACT_ID=apollo-api\n+POM_ARTIFACT_ID=apollo-api-jvm", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "bea17e0864bdf99ef2e676f109a4ea8bb84b52b3"}, "originalPosition": 2}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "16111dcd40a0bc3fa6638bc00c00bc8e89419389", "author": {"user": {"login": "tasomaniac", "name": "Said Tahsin Dane"}}, "url": "https://github.com/apollographql/apollo-android/commit/16111dcd40a0bc3fa6638bc00c00bc8e89419389", "committedDate": "2020-03-11T00:14:03Z", "message": "Revert \"Try with jvm suffix on artifact id\"\n\nThis reverts commit 1595070d"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzcyNDA0NDk4", "url": "https://github.com/apollographql/apollo-android/pull/2062#pullrequestreview-372404498", "createdAt": "2020-03-11T00:18:39Z", "commit": {"oid": "bea17e0864bdf99ef2e676f109a4ea8bb84b52b3"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xMVQwMDoxODozOVrOF0lZYg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xMVQwMDoxODozOVrOF0lZYg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MDY4Mjk3OA==", "bodyText": "I have in one of my project this https://gist.github.com/sav007/8bf365e7eaa86f4f4b6c890ea3ce47e6", "url": "https://github.com/apollographql/apollo-android/pull/2062#discussion_r390682978", "createdAt": "2020-03-11T00:18:39Z", "author": {"login": "sav007"}, "path": "apollo-api/src/commonMain/kotlin/com/apollographql/apollo/api/BigDecimal.kt", "diffHunk": "@@ -0,0 +1,7 @@\n+package com.apollographql.apollo.api\n+\n+expect class BigDecimal(value: String?) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "bea17e0864bdf99ef2e676f109a4ea8bb84b52b3"}, "originalPosition": 3}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "df06210d025711714ee90777c02dfad513160b75", "author": {"user": {"login": "tasomaniac", "name": "Said Tahsin Dane"}}, "url": "https://github.com/apollographql/apollo-android/commit/df06210d025711714ee90777c02dfad513160b75", "committedDate": "2020-03-11T00:22:14Z", "message": "Fix StackOverflow"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzcyNDA2Njgw", "url": "https://github.com/apollographql/apollo-android/pull/2062#pullrequestreview-372406680", "createdAt": "2020-03-11T00:25:57Z", "commit": {"oid": "bea17e0864bdf99ef2e676f109a4ea8bb84b52b3"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xMVQwMDoyNTo1N1rOF0lhBQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xMVQwMDoyNTo1N1rOF0lhBQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MDY4NDkzMw==", "bodyText": "Wonder if we should replace this with KClass, the only place where it used is to find default scalar type adapter.\ncom.apollographql.apollo.api.ScalarTypeAdapters", "url": "https://github.com/apollographql/apollo-android/pull/2062#discussion_r390684933", "createdAt": "2020-03-11T00:25:57Z", "author": {"login": "sav007"}, "path": "apollo-api/src/commonMain/kotlin/com/apollographql/apollo/api/ScalarType.kt", "diffHunk": "@@ -3,8 +3,6 @@ package com.apollographql.apollo.api\n /**\n  * Represents a custom GraphQL scalar type\n  */\n-interface ScalarType {\n+expect interface ScalarType {\n   fun typeName(): String\n-\n-  fun javaType(): Class<*>", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "bea17e0864bdf99ef2e676f109a4ea8bb84b52b3"}, "originalPosition": 8}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzcyNDA5Mjcx", "url": "https://github.com/apollographql/apollo-android/pull/2062#pullrequestreview-372409271", "createdAt": "2020-03-11T00:35:16Z", "commit": {"oid": "df06210d025711714ee90777c02dfad513160b75"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xMVQwMDozNToxNlrOF0lqOA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xMVQwMDozNToxNlrOF0lqOA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MDY4NzI4OA==", "bodyText": "nit: should it be moved to dep.gradle?", "url": "https://github.com/apollographql/apollo-android/pull/2062#discussion_r390687288", "createdAt": "2020-03-11T00:35:16Z", "author": {"login": "sav007"}, "path": "apollo-api/build.gradle.kts", "diffHunk": "@@ -1,18 +1,36 @@\n plugins {\n   `java-library`\n-  kotlin(\"jvm\")\n+  kotlin(\"multiplatform\")\n }\n \n-dependencies {\n-  add(\"compileOnly\", groovy.util.Eval.x(project, \"x.dep.kotlin.stdLib\"))\n-  add(\"compileOnly\", groovy.util.Eval.x(project, \"x.dep.okHttp.okHttp\"))\n+kotlin {\n+  jvm {\n+    withJava()\n+  }\n \n-  add(\"api\", groovy.util.Eval.x(project, \"x.dep.kotlin.stdLib\"))\n-  add(\"api\", groovy.util.Eval.x(project, \"x.dep.okio\"))\n+  sourceSets {\n+    val commonMain by getting {\n+      dependencies {\n+        implementation(kotlin(\"stdlib-common\"))\n+        api(\"com.squareup.okio:okio-multiplatform:2.4.3\")", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "df06210d025711714ee90777c02dfad513160b75"}, "originalPosition": 21}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzcyNDA5OTMz", "url": "https://github.com/apollographql/apollo-android/pull/2062#pullrequestreview-372409933", "createdAt": "2020-03-11T00:37:53Z", "commit": {"oid": "df06210d025711714ee90777c02dfad513160b75"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xMVQwMDozNzo1M1rOF0lskA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xMVQwMDozNzo1M1rOF0lskA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MDY4Nzg4OA==", "bodyText": "What holds us to move this class to common?", "url": "https://github.com/apollographql/apollo-android/pull/2062#discussion_r390687888", "createdAt": "2020-03-11T00:37:53Z", "author": {"login": "sav007"}, "path": "apollo-api/src/commonMain/kotlin/com/apollographql/apollo/api/ScalarTypeAdapters.kt", "diffHunk": "@@ -0,0 +1,10 @@\n+package com.apollographql.apollo.api\n+\n+expect class ScalarTypeAdapters(customAdapters: Map<ScalarType, CustomTypeAdapter<*>>) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "df06210d025711714ee90777c02dfad513160b75"}, "originalPosition": 3}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f31d5f0bd77532a1e0c1fe9a66f65ba0cf10b798", "author": {"user": {"login": "tasomaniac", "name": "Said Tahsin Dane"}}, "url": "https://github.com/apollographql/apollo-android/commit/f31d5f0bd77532a1e0c1fe9a66f65ba0cf10b798", "committedDate": "2020-03-11T00:41:14Z", "message": "Fix publish task"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "49b0f6293cffbeec9618828fa871ef80c319f910", "author": {"user": {"login": "martinbonnin", "name": "Martin Bonnin"}}, "url": "https://github.com/apollographql/apollo-android/commit/49b0f6293cffbeec9618828fa871ef80c319f910", "committedDate": "2020-03-11T18:27:09Z", "message": "upload the jar for plugin tests"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "652d7d0a69f5a7d389343161eb2c4c382eb8d0cb", "author": {"user": {"login": "martinbonnin", "name": "Martin Bonnin"}}, "url": "https://github.com/apollographql/apollo-android/commit/652d7d0a69f5a7d389343161eb2c4c382eb8d0cb", "committedDate": "2020-03-11T18:53:13Z", "message": "hopefully make tests pass"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "77bffe03b72f1523589635dea9aae2d92cfb8b38", "author": {"user": {"login": "tasomaniac", "name": "Said Tahsin Dane"}}, "url": "https://github.com/apollographql/apollo-android/commit/77bffe03b72f1523589635dea9aae2d92cfb8b38", "committedDate": "2020-03-11T19:07:51Z", "message": "Move okioMultiplatform to dependencies.gradle"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ddd010d828736946bd7552910bd7631fce4147e2", "author": {"user": {"login": "tasomaniac", "name": "Said Tahsin Dane"}}, "url": "https://github.com/apollographql/apollo-android/commit/ddd010d828736946bd7552910bd7631fce4147e2", "committedDate": "2020-03-11T19:20:16Z", "message": "Fix okio reference in dependencies.gradle"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "bf9d23f037d76edfc3d2a1c3716ca86dd276c62e", "author": {"user": {"login": "tasomaniac", "name": "Said Tahsin Dane"}}, "url": "https://github.com/apollographql/apollo-android/commit/bf9d23f037d76edfc3d2a1c3716ca86dd276c62e", "committedDate": "2020-03-11T19:22:08Z", "message": "Keep original dependency artifact"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzczOTQ5NDI0", "url": "https://github.com/apollographql/apollo-android/pull/2062#pullrequestreview-373949424", "createdAt": "2020-03-12T22:47:23Z", "commit": {"oid": "bf9d23f037d76edfc3d2a1c3716ca86dd276c62e"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4087, "cost": 1, "resetAt": "2021-11-01T11:59:11Z"}}}