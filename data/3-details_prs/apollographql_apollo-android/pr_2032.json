{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0MzgzNjkxMzI1", "number": 2032, "title": "Expose Compilation Units earlier", "bodyText": "Fixes #1970\nAlso fix doc\nSorry for the big diff, most of it is a schema file for tests. I'm hoping git does the right thing and just stores this once.", "createdAt": "2020-03-04T16:37:52Z", "url": "https://github.com/apollographql/apollo-android/pull/2032", "merged": true, "mergeCommit": {"oid": "4c20c178357c151abea29689bb4cd77a4b8560d5"}, "closed": true, "closedAt": "2020-03-09T20:21:44Z", "author": {"login": "martinbonnin"}, "timelineItems": {"totalCount": 16, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcKZpzsgH2gAyMzgzNjkxMzI1OjM2ZDM2MmIzMGVmNDdkZTg4NTY0NGYxMDMxMjMzOTUyOTY1MzExMWE=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcLb3rVAFqTM3MDc5MDgwMg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "36d362b30ef47de885644f10312339529653111a", "author": {"user": {"login": "martinbonnin", "name": "Martin Bonnin"}}, "url": "https://github.com/apollographql/apollo-android/commit/36d362b30ef47de885644f10312339529653111a", "committedDate": "2020-03-04T16:38:37Z", "message": "added a test to debug https://github.com/apollographql/apollo-android/issues/1970"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "95b48015f7bb7f184e4c629cb602b363999182ed", "author": {"user": {"login": "martinbonnin", "name": "Martin Bonnin"}}, "url": "https://github.com/apollographql/apollo-android/commit/95b48015f7bb7f184e4c629cb602b363999182ed", "committedDate": "2020-03-04T16:37:00Z", "message": "added a test to debug https://github.com/apollographql/apollo-android/issues/1970"}, "afterCommit": {"oid": "36d362b30ef47de885644f10312339529653111a", "author": {"user": {"login": "martinbonnin", "name": "Martin Bonnin"}}, "url": "https://github.com/apollographql/apollo-android/commit/36d362b30ef47de885644f10312339529653111a", "committedDate": "2020-03-04T16:38:37Z", "message": "added a test to debug https://github.com/apollographql/apollo-android/issues/1970"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzY4OTQ1MDEx", "url": "https://github.com/apollographql/apollo-android/pull/2032#pullrequestreview-368945011", "createdAt": "2020-03-04T16:46:38Z", "commit": {"oid": "36d362b30ef47de885644f10312339529653111a"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wNFQxNjo0NjozOVrOFx1I4Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wNFQxNjo0NjozOVrOFx1I4Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4Nzc5NTE2OQ==", "bodyText": "Shouldn't this be\nschemaFile = file(\"/path/to/your/schema.json\")", "url": "https://github.com/apollographql/apollo-android/pull/2032#discussion_r387795169", "createdAt": "2020-03-04T16:46:39Z", "author": {"login": "japplin"}, "path": "README.md", "diffHunk": "@@ -304,9 +304,9 @@ apollo {\n // With:\n apollo {\n   onCompilationUnit {\n-     schemaFile = \"/path/to/your/schema.json\"\n+     schemaFile.set(\"/path/to/your/schema.json\")", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "36d362b30ef47de885644f10312339529653111a"}, "originalPosition": 5}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e3e6c7c4b1e8dac957d530f74a9a0100730c264a", "author": {"user": {"login": "martinbonnin", "name": "Martin Bonnin"}}, "url": "https://github.com/apollographql/apollo-android/commit/e3e6c7c4b1e8dac957d530f74a9a0100730c264a", "committedDate": "2020-03-04T16:52:27Z", "message": "fix doc"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzY5OTY0ODEz", "url": "https://github.com/apollographql/apollo-android/pull/2032#pullrequestreview-369964813", "createdAt": "2020-03-05T22:37:36Z", "commit": {"oid": "e3e6c7c4b1e8dac957d530f74a9a0100730c264a"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "fa6ac7b5a09ad620345f21015dfaf69409fc84b8", "author": {"user": {"login": "martinbonnin", "name": "Martin Bonnin"}}, "url": "https://github.com/apollographql/apollo-android/commit/fa6ac7b5a09ad620345f21015dfaf69409fc84b8", "committedDate": "2020-03-06T11:04:05Z", "message": "added a comment"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a14d479cba8347e0b8db7c61964b1b013a11ebe5", "author": {"user": {"login": "martinbonnin", "name": "Martin Bonnin"}}, "url": "https://github.com/apollographql/apollo-android/commit/a14d479cba8347e0b8db7c61964b1b013a11ebe5", "committedDate": "2020-03-06T11:04:13Z", "message": "added a new test project"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzcwMjkwMjQy", "url": "https://github.com/apollographql/apollo-android/pull/2032#pullrequestreview-370290242", "createdAt": "2020-03-06T12:36:32Z", "commit": {"oid": "a14d479cba8347e0b8db7c61964b1b013a11ebe5"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wNlQxMjozNjozMlrOFy3R2A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wNlQxMjozNjozMlrOFy3R2A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4ODg3ODgwOA==", "bodyText": "@tasomaniac if ok with you, I'll switch to using plain test directories for plugin tests instead of programmatically constructing them like it was the case before. It's just easier to maintain and debug.", "url": "https://github.com/apollographql/apollo-android/pull/2032#discussion_r388878808", "createdAt": "2020-03-06T12:36:32Z", "author": {"login": "martinbonnin"}, "path": "apollo-gradle-plugin/testProjects/README.md", "diffHunk": "@@ -0,0 +1,13 @@\n+# testProjects\n+\n+This directory contains projects used by the plugin tests.\n+\n+You can find other files in [../src/test/files](../src/test/files). These projects are programmatically constructed but it becomes harder and harder to maintain so new test projects should be added here. It will duplicate some files and schemas but git should do the correct thing and only store objects once.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a14d479cba8347e0b8db7c61964b1b013a11ebe5"}, "originalPosition": 5}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzcwNDMyMDc2", "url": "https://github.com/apollographql/apollo-android/pull/2032#pullrequestreview-370432076", "createdAt": "2020-03-06T15:59:15Z", "commit": {"oid": "a14d479cba8347e0b8db7c61964b1b013a11ebe5"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "5c46eaa2e1281a72435d8f590617beac40414e74", "author": {"user": {"login": "martinbonnin", "name": "Martin Bonnin"}}, "url": "https://github.com/apollographql/apollo-android/commit/5c46eaa2e1281a72435d8f590617beac40414e74", "committedDate": "2020-03-07T20:34:54Z", "message": "added a simple project"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ca6eba407a3f5d8ae0fe27cae81d375e17db8810", "author": {"user": {"login": "martinbonnin", "name": "Martin Bonnin"}}, "url": "https://github.com/apollographql/apollo-android/commit/ca6eba407a3f5d8ae0fe27cae81d375e17db8810", "committedDate": "2020-03-07T20:37:46Z", "message": "added a simple Kotlin project"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "5dbe6593b35439c54d865d1ddf1cdf37c1f659aa", "author": {"user": {"login": "martinbonnin", "name": "Martin Bonnin"}}, "url": "https://github.com/apollographql/apollo-android/commit/5dbe6593b35439c54d865d1ddf1cdf37c1f659aa", "committedDate": "2020-03-07T21:02:09Z", "message": "cleanup"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d4d5ba0a6c5a9fa99cee275bf53e0236f054bc13", "author": {"user": {"login": "martinbonnin", "name": "Martin Bonnin"}}, "url": "https://github.com/apollographql/apollo-android/commit/d4d5ba0a6c5a9fa99cee275bf53e0236f054bc13", "committedDate": "2020-03-07T21:44:10Z", "message": "expose compilationUnits to users before the task is configured"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "32ed91184b2294ea99a89ad995fa4a968ec504b1", "author": {"user": {"login": "martinbonnin", "name": "Martin Bonnin"}}, "url": "https://github.com/apollographql/apollo-android/commit/32ed91184b2294ea99a89ad995fa4a968ec504b1", "committedDate": "2020-03-07T21:46:11Z", "message": "remove unused test projects"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzcwNzkwNzc4", "url": "https://github.com/apollographql/apollo-android/pull/2032#pullrequestreview-370790778", "createdAt": "2020-03-07T21:46:48Z", "commit": {"oid": "d4d5ba0a6c5a9fa99cee275bf53e0236f054bc13"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzcwNzkwODAy", "url": "https://github.com/apollographql/apollo-android/pull/2032#pullrequestreview-370790802", "createdAt": "2020-03-07T21:47:24Z", "commit": {"oid": "d4d5ba0a6c5a9fa99cee275bf53e0236f054bc13"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wN1QyMTo0NzoyNFrOFzR4Cw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wN1QyMTo0NzoyNFrOFzR4Cw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4OTMxNDU3MQ==", "bodyText": "\ud83d\udcaf", "url": "https://github.com/apollographql/apollo-android/pull/2032#discussion_r389314571", "createdAt": "2020-03-07T21:47:24Z", "author": {"login": "tasomaniac"}, "path": "apollo-gradle-plugin/src/main/kotlin/com/apollographql/apollo/gradle/internal/ApolloPlugin.kt", "diffHunk": "@@ -99,16 +99,22 @@ open class ApolloPlugin : Plugin<Project> {\n             it.dependsOn(codegenProvider)\n           }\n \n+          compilationUnit.outputDir.set(codegenProvider.flatMap { it.outputDir })\n+          compilationUnit.operationOutputFile.set(codegenProvider.flatMap { it.operationOutputFile })\n+\n+          /**\n+           * Order matters here. See https://github.com/apollographql/apollo-android/issues/1970\n+           * We want to expose the `CompilationUnit` to users before the task is configured by\n+           * AndroidTaskConfigurator.registerGeneratedDirectory so that schemaFile and sourceDirectorySet are\n+           * correctly set\n+           */\n+          apolloExtension.compilationUnits.add(compilationUnit)", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d4d5ba0a6c5a9fa99cee275bf53e0236f054bc13"}, "originalPosition": 13}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4058, "cost": 1, "resetAt": "2021-11-01T11:59:11Z"}}}