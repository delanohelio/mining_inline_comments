{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0Mzk0OTUzNzMw", "number": 2106, "title": "Fix duplicate class generation in test folders", "bodyText": "Modify and auto-add sourceSets only for non-test variants", "createdAt": "2020-03-27T20:23:00Z", "url": "https://github.com/apollographql/apollo-android/pull/2106", "merged": true, "mergeCommit": {"oid": "10c04ee451fe24b5f492374d8c3e57ce9d0fa81a"}, "closed": true, "closedAt": "2020-03-28T16:30:27Z", "author": {"login": "tasomaniac"}, "timelineItems": {"totalCount": 8, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcR2fcmgH2gAyMzk0OTUzNzMwOjRlZTM0ZGZkZDk0Zjc4MTY2NjZkMzM2ZjNmNTY0ZTZmZWZjZWY1NmI=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcR4umtgFqTM4MzI0MDQyOA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "4ee34dfdd94f7816666d336f3f564e6fefcef56b", "author": {"user": {"login": "tasomaniac", "name": "Said Tahsin Dane"}}, "url": "https://github.com/apollographql/apollo-android/commit/4ee34dfdd94f7816666d336f3f564e6fefcef56b", "committedDate": "2020-03-27T20:12:01Z", "message": "Replace deprecated AGP function"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c80fae375159e5134fcb623570b7fe422fc5e79f", "author": {"user": {"login": "tasomaniac", "name": "Said Tahsin Dane"}}, "url": "https://github.com/apollographql/apollo-android/commit/c80fae375159e5134fcb623570b7fe422fc5e79f", "committedDate": "2020-03-27T20:22:31Z", "message": "Modify and auto-add sourceSets only for non-test variants"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzgzMTc2MTAy", "url": "https://github.com/apollographql/apollo-android/pull/2106#pullrequestreview-383176102", "createdAt": "2020-03-27T20:23:38Z", "commit": {"oid": "c80fae375159e5134fcb623570b7fe422fc5e79f"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yN1QyMDoyMzozOFrOF9Atyw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yN1QyMDoyMzozOFrOF9Atyw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5OTUxOTE3OQ==", "bodyText": "I just noticed that this is deprecated in AGP 3.6.1 and removed in 4.0", "url": "https://github.com/apollographql/apollo-android/pull/2106#discussion_r399519179", "createdAt": "2020-03-27T20:23:38Z", "author": {"login": "tasomaniac"}, "path": "build.gradle.kts", "diffHunk": "@@ -55,7 +55,7 @@ subprojects {\n   }\n \n   plugins.withType(com.android.build.gradle.BasePlugin::class.java) {\n-    extension.compileOptions {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c80fae375159e5134fcb623570b7fe422fc5e79f"}, "originalPosition": 4}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "8143fac6393946ea5ad796efd81ce81decec5f13", "author": {"user": {"login": "tasomaniac", "name": "Said Tahsin Dane"}}, "url": "https://github.com/apollographql/apollo-android/commit/8143fac6393946ea5ad796efd81ce81decec5f13", "committedDate": "2020-03-27T20:49:11Z", "message": "Add tests to verify the fix"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "3396e5f184b8701dcfe142d63460da732760ec15", "author": {"user": {"login": "tasomaniac", "name": "Said Tahsin Dane"}}, "url": "https://github.com/apollographql/apollo-android/commit/3396e5f184b8701dcfe142d63460da732760ec15", "committedDate": "2020-03-27T21:47:41Z", "message": "Revert change in Plugin and adjust finding soources based on test sources"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzgzMjIzMzk2", "url": "https://github.com/apollographql/apollo-android/pull/2106#pullrequestreview-383223396", "createdAt": "2020-03-27T21:58:39Z", "commit": {"oid": "3396e5f184b8701dcfe142d63460da732760ec15"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yN1QyMTo1ODozOVrOF9DCqQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yN1QyMTo1ODozOVrOF9DCqQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5OTU1NzI4OQ==", "bodyText": "Starting from suggestions in the IDE, I ended up refactoring this to make it easier to follow. This is the only behavior change.\nI recommend reviewing this in \"split\" view.", "url": "https://github.com/apollographql/apollo-android/pull/2106#discussion_r399557289", "createdAt": "2020-03-27T21:58:39Z", "author": {"login": "tasomaniac"}, "path": "apollo-gradle-plugin/src/main/kotlin/com/apollographql/apollo/gradle/internal/DefaultCompilationUnit.kt", "diffHunk": "@@ -65,29 +66,38 @@ abstract class DefaultCompilationUnit @Inject constructor(\n     }\n   }\n \n-  fun setSourcesIfNeeded(graphqlSourceDirectorySet: SourceDirectorySet, schemaFile: RegularFileProperty) {\n-    if (graphqlSourceDirectorySet.srcDirs.isEmpty()) {\n-      if (schemaFile.isPresent) {\n-        graphqlSourceDirectorySet.srcDir(schemaFile.asFile.get().parent)\n-      } else {\n+  fun setSourcesIfNeeded(sourceDirectorySet: SourceDirectorySet, schemaFile: RegularFileProperty) {\n+    if (sourceDirectorySet.srcDirs.isEmpty()) {\n+      sourceDirectorySet.findSources(schemaFile)\n+    }\n+\n+    if (!schemaFile.isPresent) {\n+      schemaFile.set { resolveSchema(sourceDirectorySet) }\n+    }\n+  }\n+\n+  private fun SourceDirectorySet.findSources(schemaFile: RegularFileProperty) {\n+    when {\n+      apolloVariant.isTest -> srcDirFromVariant(apolloVariant)", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "3396e5f184b8701dcfe142d63460da732760ec15"}, "originalPosition": 44}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ec6d1e99137604777ba0cc9a249f4ef826dcb859", "author": {"user": {"login": "tasomaniac", "name": "Said Tahsin Dane"}}, "url": "https://github.com/apollographql/apollo-android/commit/ec6d1e99137604777ba0cc9a249f4ef826dcb859", "committedDate": "2020-03-27T22:46:34Z", "message": "Do not take sourceFolder into account"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzgzMjQwNDI4", "url": "https://github.com/apollographql/apollo-android/pull/2106#pullrequestreview-383240428", "createdAt": "2020-03-27T22:48:23Z", "commit": {"oid": "ec6d1e99137604777ba0cc9a249f4ef826dcb859"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3897, "cost": 1, "resetAt": "2021-11-01T11:59:11Z"}}}