{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTEyMTc4MzYw", "number": 2711, "reviewThreads": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yOVQxMDo0MDowMlrOEzPTBA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yOVQxMDo0NTozOVrOEzPaow==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzIyMTYzNDYwOnYy", "diffSide": "RIGHT", "path": "apollo-compiler/src/main/antlr/com/apollographql/apollo/compiler/parser/antlr/GraphQL.g4", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yOVQxMDo0MDowMlrOHqV5hg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yOVQxMDo0MDowMlrOHqV5hg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNDE2MTAzMA==", "bodyText": "Not sure what the ':' was up there but I didn't find it in http://spec.graphql.org/draft/#Directives so I'm assuming it's safe to remove that case.", "url": "https://github.com/apollographql/apollo-android/pull/2711#discussion_r514161030", "createdAt": "2020-10-29T10:40:02Z", "author": {"login": "martinbonnin"}, "path": "apollo-compiler/src/main/antlr/com/apollographql/apollo/compiler/parser/antlr/GraphQL.g4", "diffHunk": "@@ -96,7 +96,7 @@ directives\n    ;\n \n directive\n-   : '@' NAME ':' valueOrVariable | '@' NAME | '@' NAME '(' argument ')'\n+   : '@' NAME arguments?", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "6f18b250a91e5ec799bd86c1e15a8ff718b575a3"}, "originalPosition": 5}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzIyMTY1NDExOnYy", "diffSide": "RIGHT", "path": "apollo-compiler/src/main/kotlin/com/apollographql/apollo/compiler/parser/graphql/GraphQLDocumentParser.kt", "isResolved": true, "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yOVQxMDo0NTozOVrOHqWFog==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0zMFQwOTozNzoxMlrOHrHdfQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNDE2NDEzMA==", "bodyText": "It looks like a field with @include(if: false) will still generate a non-nullable field. That sounds like a bug?", "url": "https://github.com/apollographql/apollo-android/pull/2711#discussion_r514164130", "createdAt": "2020-10-29T10:45:39Z", "author": {"login": "martinbonnin"}, "path": "apollo-compiler/src/main/kotlin/com/apollographql/apollo/compiler/parser/graphql/GraphQLDocumentParser.kt", "diffHunk": "@@ -361,18 +361,30 @@ class GraphQLDocumentParser(\n   private fun GraphQLParser.DirectivesContext?.parse(): List<Condition> {\n     return this?.directive()?.mapNotNull { ctx ->\n       val name = ctx.NAME().text\n-      val argument = ctx.argument()\n-      when {\n-        argument == null -> null\n-        name != \"skip\" && name != \"include\" -> null\n-        argument.NAME()?.text != \"if\" || argument.valueOrVariable()?.variable() == null -> null\n-        else -> Condition(\n-            kind = \"BooleanCondition\",\n-            variableName = argument.valueOrVariable().variable().NAME().text,\n-            inverted = ctx.NAME().text == \"skip\",\n-            sourceLocation = SourceLocation(argument.valueOrVariable()?.start ?: argument.NAME().symbol)\n-        )\n+      val arguments = ctx.arguments()\n+\n+      if (name != \"skip\" && name != \"include\" ) {\n+        // we only support skip and include directives for now\n+        return@mapNotNull null\n+      }\n+\n+      if (arguments.argument().size != 1) {\n+        // skip and include should only have a single argument\n+        return@mapNotNull null\n       }\n+\n+      val argument = arguments.argument().first()\n+      if (argument.NAME().text != \"if\" || argument.valueOrVariable().variable() == null) {\n+        // The argument should be named \"if\"\n+        // Not 100% why we ignore non-variable arguments", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "6f18b250a91e5ec799bd86c1e15a8ff718b575a3"}, "originalPosition": 30}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNDc0MDM5Nw==", "bodyText": "Yeah look like a bug to me. Just I guessed we missed it.", "url": "https://github.com/apollographql/apollo-android/pull/2711#discussion_r514740397", "createdAt": "2020-10-30T02:47:10Z", "author": {"login": "sav007"}, "path": "apollo-compiler/src/main/kotlin/com/apollographql/apollo/compiler/parser/graphql/GraphQLDocumentParser.kt", "diffHunk": "@@ -361,18 +361,30 @@ class GraphQLDocumentParser(\n   private fun GraphQLParser.DirectivesContext?.parse(): List<Condition> {\n     return this?.directive()?.mapNotNull { ctx ->\n       val name = ctx.NAME().text\n-      val argument = ctx.argument()\n-      when {\n-        argument == null -> null\n-        name != \"skip\" && name != \"include\" -> null\n-        argument.NAME()?.text != \"if\" || argument.valueOrVariable()?.variable() == null -> null\n-        else -> Condition(\n-            kind = \"BooleanCondition\",\n-            variableName = argument.valueOrVariable().variable().NAME().text,\n-            inverted = ctx.NAME().text == \"skip\",\n-            sourceLocation = SourceLocation(argument.valueOrVariable()?.start ?: argument.NAME().symbol)\n-        )\n+      val arguments = ctx.arguments()\n+\n+      if (name != \"skip\" && name != \"include\" ) {\n+        // we only support skip and include directives for now\n+        return@mapNotNull null\n+      }\n+\n+      if (arguments.argument().size != 1) {\n+        // skip and include should only have a single argument\n+        return@mapNotNull null\n       }\n+\n+      val argument = arguments.argument().first()\n+      if (argument.NAME().text != \"if\" || argument.valueOrVariable().variable() == null) {\n+        // The argument should be named \"if\"\n+        // Not 100% why we ignore non-variable arguments", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNDE2NDEzMA=="}, "originalCommit": {"oid": "6f18b250a91e5ec799bd86c1e15a8ff718b575a3"}, "originalPosition": 30}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNDk3MzA1Mw==", "bodyText": "\ud83d\udc4d will fix in a follow-up PR", "url": "https://github.com/apollographql/apollo-android/pull/2711#discussion_r514973053", "createdAt": "2020-10-30T09:37:12Z", "author": {"login": "martinbonnin"}, "path": "apollo-compiler/src/main/kotlin/com/apollographql/apollo/compiler/parser/graphql/GraphQLDocumentParser.kt", "diffHunk": "@@ -361,18 +361,30 @@ class GraphQLDocumentParser(\n   private fun GraphQLParser.DirectivesContext?.parse(): List<Condition> {\n     return this?.directive()?.mapNotNull { ctx ->\n       val name = ctx.NAME().text\n-      val argument = ctx.argument()\n-      when {\n-        argument == null -> null\n-        name != \"skip\" && name != \"include\" -> null\n-        argument.NAME()?.text != \"if\" || argument.valueOrVariable()?.variable() == null -> null\n-        else -> Condition(\n-            kind = \"BooleanCondition\",\n-            variableName = argument.valueOrVariable().variable().NAME().text,\n-            inverted = ctx.NAME().text == \"skip\",\n-            sourceLocation = SourceLocation(argument.valueOrVariable()?.start ?: argument.NAME().symbol)\n-        )\n+      val arguments = ctx.arguments()\n+\n+      if (name != \"skip\" && name != \"include\" ) {\n+        // we only support skip and include directives for now\n+        return@mapNotNull null\n+      }\n+\n+      if (arguments.argument().size != 1) {\n+        // skip and include should only have a single argument\n+        return@mapNotNull null\n       }\n+\n+      val argument = arguments.argument().first()\n+      if (argument.NAME().text != \"if\" || argument.valueOrVariable().variable() == null) {\n+        // The argument should be named \"if\"\n+        // Not 100% why we ignore non-variable arguments", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNDE2NDEzMA=="}, "originalCommit": {"oid": "6f18b250a91e5ec799bd86c1e15a8ff718b575a3"}, "originalPosition": 30}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2970, "cost": 1, "resetAt": "2021-11-12T09:44:50Z"}}}