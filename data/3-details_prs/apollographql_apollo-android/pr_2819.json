{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTQ1MjUwODM5", "number": 2819, "title": "Cleanup the custom scalar APIs 1/3", "bodyText": "First PR of a series of PR to tweak the custom scalar APIs. I wanted to do everything in 1 PR but this turned out to be pretty big already so I'll split it in multiple PRs, hopefully, not too many.\nRenaming/consistency is the main change in this PR. CustomType is replaced by CustomScalar to make it clear that there is no other custom type than scalar types in GraphQL. There are a few other changes outlined in the diff.\nNote: For the record, I considered generating the CustomScalarAdapters from the Gradle config as part of this PR so that we wouldn't need to register them manually. Something like:\n// build.gradle.kts\n\napollo {\n  service(\"github\") {\n    customScalar(\"DATE\", \"java.util.Date\", \"com.example.Iso8601DateAdapter\")\n    customScalar(\"URL\", \"kotlin.String\", \"com.example.UrlAdapter\")\n  }\n}\n\n// Main.kt\n// GithubBuilder would be auto-generated and pre-configured with the adapters from the Gradle config\nval apolloClient = ApolloClient.GithubBuilder().build()\n\nWhile that makes the Gradle config the single source of truth for custom scalars, I ultimately gave up on this idea because:\n\nit forces adapters to have a no-arg constructor, which is a weird limitation\nmore importantly, it means generated code now requires apollo-runtime-kotlin in the classpath, which is not something we want. We could configure that in Gradle but the additional configuration would make it more complicated than actually having to register adapters manually.", "createdAt": "2020-12-24T10:22:24Z", "url": "https://github.com/apollographql/apollo-android/pull/2819", "merged": true, "mergeCommit": {"oid": "da17be30df4477cee7d2abb32b970bff4f4119ca"}, "closed": true, "closedAt": "2021-01-04T09:03:24Z", "author": {"login": "martinbonnin"}, "timelineItems": {"totalCount": 25, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdpRIIiAFqTU1ODQ1MDAwOA==", "endCursor": "Y3Vyc29yOnYyOpPPAAABdsjy5_gH2gAyNTQ1MjUwODM5OmMyY2YyZjhhMWJjMTU4ZWE3YTNiM2E2YWZjY2Y3ZTU3NGYwMzU5MmI=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTU4NDUwMDA4", "url": "https://github.com/apollographql/apollo-android/pull/2819#pullrequestreview-558450008", "createdAt": "2020-12-24T10:25:24Z", "commit": {"oid": "6bf620041caa95abbef030e1c7465262f415682b"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0yNFQxMDoyNToyNFrOILExCA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0yNFQxMDoyNToyNFrOILExCA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0ODQ4MzMzNg==", "bodyText": "Removed the api.txt for now. I'll re-add them for 3.0.0-alpha01", "url": "https://github.com/apollographql/apollo-android/pull/2819#discussion_r548483336", "createdAt": "2020-12-24T10:25:24Z", "author": {"login": "martinbonnin"}, "path": "apollo-android-support/api.txt", "diffHunk": "@@ -1,31 +0,0 @@\n-// Signature format: 3.0\n-package com.apollographql.apollo {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "6bf620041caa95abbef030e1c7465262f415682b"}, "originalPosition": 2}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTU4NDUwOTcy", "url": "https://github.com/apollographql/apollo-android/pull/2819#pullrequestreview-558450972", "createdAt": "2020-12-24T10:28:09Z", "commit": {"oid": "6bf620041caa95abbef030e1c7465262f415682b"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0yNFQxMDoyODowOVrOILE0TA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0yNFQxMDoyODowOVrOILE0TA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0ODQ4NDE3Mg==", "bodyText": "JsonElement is the new, more type safe CustomTypeValue. It makes it clear that CustomScalarAdapters ultimately work on Json:\ninterface CustomScalarAdapter<T> {\n  fun decode(jsonElement: JsonElement): T\n  fun encode(value: T): JsonElement\n}\nI know GraphQL is not Json-only but so far it is so we'll see when (if...) that changes.", "url": "https://github.com/apollographql/apollo-android/pull/2819#discussion_r548484172", "createdAt": "2020-12-24T10:28:09Z", "author": {"login": "martinbonnin"}, "path": "apollo-api/src/commonMain/kotlin/com/apollographql/apollo/api/BuiltinAdapters.kt", "diffHunk": "@@ -0,0 +1,113 @@\n+package com.apollographql.apollo.api\n+\n+import com.apollographql.apollo.api.internal.json.JsonWriter\n+import com.apollographql.apollo.api.internal.json.Utils\n+import com.apollographql.apollo.api.internal.json.use\n+import okio.Buffer\n+\n+/**\n+ * Builtin CustomScalarTypeAdapter provided for convenience. Encoding is most of the times straightforward. Decoding\n+ * can involve coercion. If you need stricter decoding or different logic, define your own adapter\n+ */\n+object BuiltinScalarTypeAdapters {\n+  val STRING_ADAPTER = adapterWithDefaultEncode { jsonElement ->\n+    when (jsonElement) {\n+      is JsonElement.JsonString -> jsonElement.value\n+      is JsonElement.JsonNull -> null\n+      is JsonElement.JsonBoolean -> jsonElement.value.toString()\n+      is JsonElement.JsonNumber -> jsonElement.value.toString()\n+      is JsonElement.JsonObject,\n+      is JsonElement.JsonList -> {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "6bf620041caa95abbef030e1c7465262f415682b"}, "originalPosition": 20}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTU4NDUyNDYx", "url": "https://github.com/apollographql/apollo-android/pull/2819#pullrequestreview-558452461", "createdAt": "2020-12-24T10:32:18Z", "commit": {"oid": "6bf620041caa95abbef030e1c7465262f415682b"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0yNFQxMDozMjoxOFrOILE5QA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0yNFQxMDozMjoxOFrOILE5QA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0ODQ4NTQ0MA==", "bodyText": "Converted a bunch of files to Kotlin as I'd like to get rid of @JvmField annotation for 3.0.0-alpha01", "url": "https://github.com/apollographql/apollo-android/pull/2819#discussion_r548485440", "createdAt": "2020-12-24T10:32:18Z", "author": {"login": "martinbonnin"}, "path": "apollo-idling-resource/src/test/java/com/apollographql/apollo/test/espresso/ApolloIdlingResourceTest.kt", "diffHunk": "@@ -0,0 +1,210 @@\n+package com.apollographql.apollo.test.espresso", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "6bf620041caa95abbef030e1c7465262f415682b"}, "originalPosition": 1}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTU4ODg4ODI1", "url": "https://github.com/apollographql/apollo-android/pull/2819#pullrequestreview-558888825", "createdAt": "2020-12-26T19:40:52Z", "commit": {"oid": "a28a7502cee70a35d0715ca78b741fd7c4e3afae"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0yNlQxOTo0MDo1MlrOILlzKg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0yNlQxOTo0MDo1MlrOILlzKg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0OTAyNDU1NA==", "bodyText": "nit: should we move this into /json subfolder?", "url": "https://github.com/apollographql/apollo-android/pull/2819#discussion_r549024554", "createdAt": "2020-12-26T19:40:52Z", "author": {"login": "sav007"}, "path": "apollo-api/src/commonMain/kotlin/com/apollographql/apollo/api/JsonElement.kt", "diffHunk": "@@ -0,0 +1,61 @@\n+package com.apollographql.apollo.api\n+\n+/**\n+ * A wrapper class for representation of custom GraphQL type value, used in user provided [CustomScalarAdapter]\n+ * encoding / decoding functions.\n+ **/\n+sealed class JsonElement {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a28a7502cee70a35d0715ca78b741fd7c4e3afae"}, "originalPosition": 7}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTU4ODg4OTE1", "url": "https://github.com/apollographql/apollo-android/pull/2819#pullrequestreview-558888915", "createdAt": "2020-12-26T19:43:44Z", "commit": {"oid": "a28a7502cee70a35d0715ca78b741fd7c4e3afae"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0yNlQxOTo0Mzo0NFrOILlz6g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0yNlQxOTo0Mzo0NFrOILlz6g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0OTAyNDc0Ng==", "bodyText": "nit: should we rename this to CustomScalarType?", "url": "https://github.com/apollographql/apollo-android/pull/2819#discussion_r549024746", "createdAt": "2020-12-26T19:43:44Z", "author": {"login": "sav007"}, "path": "apollo-api/src/commonMain/kotlin/com/apollographql/apollo/api/ScalarType.kt", "diffHunk": "@@ -1,17 +1,17 @@\n package com.apollographql.apollo.api\n \n /**\n- * Represents a custom GraphQL scalar type\n+ * Represents a mapping from a custom GraphQL scalar type to a Java/Kotlin class\n  */\n interface ScalarType {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a28a7502cee70a35d0715ca78b741fd7c4e3afae"}, "originalPosition": 7}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTU4ODg4OTc2", "url": "https://github.com/apollographql/apollo-android/pull/2819#pullrequestreview-558888976", "createdAt": "2020-12-26T19:45:29Z", "commit": {"oid": "a28a7502cee70a35d0715ca78b741fd7c4e3afae"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0yNlQxOTo0NToyOVrOILl0iw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0yNlQxOTo0NToyOVrOILl0iw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0OTAyNDkwNw==", "bodyText": "same should we use naming CustomScalar* everywhere?", "url": "https://github.com/apollographql/apollo-android/pull/2819#discussion_r549024907", "createdAt": "2020-12-26T19:45:29Z", "author": {"login": "sav007"}, "path": "apollo-api/src/commonMain/kotlin/com/apollographql/apollo/api/ScalarTypeAdapters.kt", "diffHunk": "@@ -1,129 +1,65 @@\n package com.apollographql.apollo.api\n \n-import com.apollographql.apollo.api.CustomTypeValue.*\n-import com.apollographql.apollo.api.CustomTypeValue.Companion.fromRawValue\n-import com.apollographql.apollo.api.internal.json.JsonWriter\n-import com.apollographql.apollo.api.internal.json.Utils\n-import com.apollographql.apollo.api.internal.json.use\n-import okio.Buffer\n-import kotlin.jvm.JvmField\n+class ScalarTypeAdapters(val customScalarAdapters: Map<ScalarType, CustomScalarAdapter<*>>) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a28a7502cee70a35d0715ca78b741fd7c4e3afae"}, "originalPosition": 10}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTU4ODg5MDc3", "url": "https://github.com/apollographql/apollo-android/pull/2819#pullrequestreview-558889077", "createdAt": "2020-12-26T19:48:17Z", "commit": {"oid": "a28a7502cee70a35d0715ca78b741fd7c4e3afae"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "39a9e10876cd285b3e5f2da3632666e2ab39add0", "author": {"user": {"login": "martinbonnin", "name": "Martin Bonnin"}}, "url": "https://github.com/apollographql/apollo-android/commit/39a9e10876cd285b3e5f2da3632666e2ab39add0", "committedDate": "2021-01-03T15:44:04Z", "message": "CustomTypeAdapter -> CustomScalarTypeAdapter"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "bfa466e98b3d2c2ccb752f34efcf35e710152026", "author": {"user": {"login": "martinbonnin", "name": "Martin Bonnin"}}, "url": "https://github.com/apollographql/apollo-android/commit/bfa466e98b3d2c2ccb752f34efcf35e710152026", "committedDate": "2021-01-03T15:44:04Z", "message": "customTypeMap -> customScalarsMapping"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a245ece6abe534d0596bc06b52bb0bde4a188ccd", "author": {"user": {"login": "martinbonnin", "name": "Martin Bonnin"}}, "url": "https://github.com/apollographql/apollo-android/commit/a245ece6abe534d0596bc06b52bb0bde4a188ccd", "committedDate": "2021-01-03T15:44:04Z", "message": "more renaming to customScalarsMapping"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "750770ecc4dcfa7fd1cb2f07001cc4fa3212a1d5", "author": {"user": {"login": "martinbonnin", "name": "Martin Bonnin"}}, "url": "https://github.com/apollographql/apollo-android/commit/750770ecc4dcfa7fd1cb2f07001cc4fa3212a1d5", "committedDate": "2021-01-03T15:44:47Z", "message": "Simplify ScalarType\n\nScalarType.typeName() -> ScalarType.graphqlName\nScalarType.className() -> ScalarType.className"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "841ae135372e8dabba2b7c4d92c5ff4852a43a60", "author": {"user": {"login": "martinbonnin", "name": "Martin Bonnin"}}, "url": "https://github.com/apollographql/apollo-android/commit/841ae135372e8dabba2b7c4d92c5ff4852a43a60", "committedDate": "2021-01-03T15:44:50Z", "message": "added ./gradlew rmbuild"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "1a755fb4154520d04d320c983421e1138579abf6", "author": {"user": {"login": "martinbonnin", "name": "Martin Bonnin"}}, "url": "https://github.com/apollographql/apollo-android/commit/1a755fb4154520d04d320c983421e1138579abf6", "committedDate": "2021-01-03T15:44:50Z", "message": "forgot to add files"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "50aad989ee547470844c6ec38cc87c516b70401d", "author": {"user": {"login": "martinbonnin", "name": "Martin Bonnin"}}, "url": "https://github.com/apollographql/apollo-android/commit/50aad989ee547470844c6ec38cc87c516b70401d", "committedDate": "2021-01-03T15:45:04Z", "message": "customType -> customScalarType"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "2093acb9a8ddaa6097d42c4cc5e0686644aa2369", "author": {"user": {"login": "martinbonnin", "name": "Martin Bonnin"}}, "url": "https://github.com/apollographql/apollo-android/commit/2093acb9a8ddaa6097d42c4cc5e0686644aa2369", "committedDate": "2021-01-03T15:45:06Z", "message": "more renaming"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "315677198566389216adacbf066803711b0f789a", "author": {"user": {"login": "martinbonnin", "name": "Martin Bonnin"}}, "url": "https://github.com/apollographql/apollo-android/commit/315677198566389216adacbf066803711b0f789a", "committedDate": "2021-01-03T15:45:06Z", "message": "fix tests"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "9a57bfaf2f4c048387b76fe4f470e2aa9e97c151", "author": {"user": {"login": "martinbonnin", "name": "Martin Bonnin"}}, "url": "https://github.com/apollographql/apollo-android/commit/9a57bfaf2f4c048387b76fe4f470e2aa9e97c151", "committedDate": "2021-01-03T15:45:06Z", "message": "wip"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c4770918e5d4b7a50c1783d4d8a46a757c15b104", "author": {"user": {"login": "martinbonnin", "name": "Martin Bonnin"}}, "url": "https://github.com/apollographql/apollo-android/commit/c4770918e5d4b7a50c1783d4d8a46a757c15b104", "committedDate": "2021-01-03T15:45:06Z", "message": "convert ApolloIdlingResource to kotlin"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "cd63466b37bff512c44bd6bd32e3192a4b8f44c2", "author": {"user": {"login": "martinbonnin", "name": "Martin Bonnin"}}, "url": "https://github.com/apollographql/apollo-android/commit/cd63466b37bff512c44bd6bd32e3192a4b8f44c2", "committedDate": "2021-01-03T15:45:06Z", "message": "convert some more tests to Kotlin"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a30d79217d73ac5647c894c33d8a2f8766a926e2", "author": {"user": {"login": "martinbonnin", "name": "Martin Bonnin"}}, "url": "https://github.com/apollographql/apollo-android/commit/a30d79217d73ac5647c894c33d8a2f8766a926e2", "committedDate": "2021-01-03T15:45:06Z", "message": "remove the api.txt files from dev-3.x, they make the diffs harder to\nread\n\nI will re-enable them when the API stabilizes"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d33906f19ff6c82146492719711ded35daec6151", "author": {"user": {"login": "martinbonnin", "name": "Martin Bonnin"}}, "url": "https://github.com/apollographql/apollo-android/commit/d33906f19ff6c82146492719711ded35daec6151", "committedDate": "2021-01-03T15:45:12Z", "message": "simplify even more and drop the `Type`"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "69a6806148bfda52b4fb2331679a54d762aa8901", "author": {"user": {"login": "martinbonnin", "name": "Martin Bonnin"}}, "url": "https://github.com/apollographql/apollo-android/commit/69a6806148bfda52b4fb2331679a54d762aa8901", "committedDate": "2021-01-03T15:45:14Z", "message": "forgot to add files + make things more consistent"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e8549559aa812e62b585b9a95dcdcd8fab2baf2d", "author": {"user": {"login": "martinbonnin", "name": "Martin Bonnin"}}, "url": "https://github.com/apollographql/apollo-android/commit/e8549559aa812e62b585b9a95dcdcd8fab2baf2d", "committedDate": "2021-01-03T15:45:14Z", "message": "be more robust to thread scheduling randomness"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "a28a7502cee70a35d0715ca78b741fd7c4e3afae", "author": {"user": {"login": "martinbonnin", "name": "Martin Bonnin"}}, "url": "https://github.com/apollographql/apollo-android/commit/a28a7502cee70a35d0715ca78b741fd7c4e3afae", "committedDate": "2020-12-24T13:46:06Z", "message": "be more robust to thread scheduling randomness"}, "afterCommit": {"oid": "e8549559aa812e62b585b9a95dcdcd8fab2baf2d", "author": {"user": {"login": "martinbonnin", "name": "Martin Bonnin"}}, "url": "https://github.com/apollographql/apollo-android/commit/e8549559aa812e62b585b9a95dcdcd8fab2baf2d", "committedDate": "2021-01-03T15:45:14Z", "message": "be more robust to thread scheduling randomness"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c2cf2f8a1bc158ea7a3b3a6afccf7e574f03592b", "author": {"user": {"login": "martinbonnin", "name": "Martin Bonnin"}}, "url": "https://github.com/apollographql/apollo-android/commit/c2cf2f8a1bc158ea7a3b3a6afccf7e574f03592b", "committedDate": "2021-01-03T15:52:11Z", "message": "fix tests"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4125, "cost": 1, "resetAt": "2021-11-01T11:59:11Z"}}}