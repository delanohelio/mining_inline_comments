{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDAzMzI2Njc3", "number": 2172, "title": "Update maven publishing", "bodyText": "use the Android software components available with AGP 3.6\ndo not create publications if the java-gradle-plugin or org.jetbrains.kotlin.multiplatform did it for us\nproperly configure the pom metadata\nremove the bintrayMarker repository\nupload everything to the merged apollo package\nsince the publications do not overlap anymore, we can call \"publishAllPublications\"", "createdAt": "2020-04-14T17:47:50Z", "url": "https://github.com/apollographql/apollo-android/pull/2172", "merged": true, "mergeCommit": {"oid": "2c1870bf0186064e50ad5f676aee05f53f12b85f"}, "closed": true, "closedAt": "2020-04-15T14:08:47Z", "author": {"login": "martinbonnin"}, "timelineItems": {"totalCount": 10, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcXm9qUgH2gAyNDAzMzI2Njc3OjExNjdhMjczOWIyZDBlZmVmNjU0N2E4NzVhOGEwYWUzNDRlZmMwODQ=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcXzW47AFqTM5MzUzNzg3OQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "1167a2739b2d0efef6547a875a8a0ae344efc084", "author": {"user": {"login": "martinbonnin", "name": "Martin Bonnin"}}, "url": "https://github.com/apollographql/apollo-android/commit/1167a2739b2d0efef6547a875a8a0ae344efc084", "committedDate": "2020-04-14T17:30:05Z", "message": "update maven publishing\n\n* use the Android software components available with AGP 3.6\n* do not create publications if the java-gradle-plugin or org.jetbrains.kotlin.multiplatform did it for us\n* properly configure the pom metadata\n* remove the bintrayMarker repository"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "01a45282db9313dd656aff9f3fba66db70b90960", "author": {"user": {"login": "martinbonnin", "name": "Martin Bonnin"}}, "url": "https://github.com/apollographql/apollo-android/commit/01a45282db9313dd656aff9f3fba66db70b90960", "committedDate": "2020-04-14T17:34:56Z", "message": "everything goes in the same bintray package now"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ed71c1c18e9907c61ba304cb7baef0414dac3130", "author": {"user": {"login": "martinbonnin", "name": "Martin Bonnin"}}, "url": "https://github.com/apollographql/apollo-android/commit/ed71c1c18e9907c61ba304cb7baef0414dac3130", "committedDate": "2020-04-14T17:45:36Z", "message": "since the publications do not overlap anymore, we can use publishAllPublicationXYZ"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzkzMTY0Njg2", "url": "https://github.com/apollographql/apollo-android/pull/2172#pullrequestreview-393164686", "createdAt": "2020-04-14T17:56:19Z", "commit": {"oid": "ed71c1c18e9907c61ba304cb7baef0414dac3130"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "63186853aa6773a967246df7621ccd5487877b8d", "author": {"user": {"login": "martinbonnin", "name": "Martin Bonnin"}}, "url": "https://github.com/apollographql/apollo-android/commit/63186853aa6773a967246df7621ccd5487877b8d", "committedDate": "2020-04-14T17:56:56Z", "message": "fix tests"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzkzMTkwOTcx", "url": "https://github.com/apollographql/apollo-android/pull/2172#pullrequestreview-393190971", "createdAt": "2020-04-14T18:32:33Z", "commit": {"oid": "63186853aa6773a967246df7621ccd5487877b8d"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xNFQxODozMjozM1rOGFbsRA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xNFQxODozMjozM1rOGFbsRA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwODM0OTc2NA==", "bodyText": "This was missing and preventing the license url to be present in the pom files", "url": "https://github.com/apollographql/apollo-android/pull/2172#discussion_r408349764", "createdAt": "2020-04-14T18:32:33Z", "author": {"login": "martinbonnin"}, "path": "build.gradle.kts", "diffHunk": "@@ -209,43 +208,43 @@ fun Project.configurePublishing() {\n \n   configure<PublishingExtension> {\n     publications {\n-      if (plugins.hasPlugin(\"org.jetbrains.kotlin.multiplatform\")) {\n-        withType<MavenPublication>().getByName(\"jvm\") {\n-          if (javadocJarTaskProvider != null) {\n-            artifact(javadocJarTaskProvider.get())\n+      when {\n+        plugins.hasPlugin(\"org.jetbrains.kotlin.multiplatform\") -> {\n+          withType<MavenPublication>().getByName(\"jvm\") {\n+            if (javadocJarTaskProvider != null) {\n+              artifact(javadocJarTaskProvider.get())\n+            }\n           }\n         }\n-      } else {\n-        create<MavenPublication>(publicationName) {\n-          val javaComponent = components.findByName(\"java\")\n-          if (javaComponent != null) {\n-            from(javaComponent)\n-          } else if (android != null) {\n-            // this is a workaround while the below is fixed.\n-            // dependency information in the pom file will most likely be wrong\n-            // but it's been like that for some time now. As long as users still\n-            // import apollo-runtime in addition to the android artifacts, it\n-            // should be fine.\n-            //\n-            // https://issuetracker.google.com/issues/37055147\n-            // https://github.com/gradle/gradle/pull/8399\n-            afterEvaluate {\n-              artifact(tasks.named(\"bundleReleaseAar\").get())\n+        plugins.hasPlugin(\"java-gradle-plugin\") -> {\n+          // do nothing, the plugin will create the publications for us\n+        }\n+        else -> {\n+          create<MavenPublication>(\"default\") {\n+            val javaComponent = components.findByName(\"java\")\n+            if (javaComponent != null) {\n+              from(javaComponent)\n+            } else if (android != null) {\n+              from(components.findByName(\"release\"))\n             }\n-          }\n \n-          if (javadocJarTaskProvider != null) {\n-            artifact(javadocJarTaskProvider.get())\n-          }\n-          if (sourcesJarTaskProvider != null) {\n-            artifact(sourcesJarTaskProvider.get())\n-          }\n+            if (javadocJarTaskProvider != null) {\n+              artifact(javadocJarTaskProvider.get())\n+            }\n+            if (sourcesJarTaskProvider != null) {\n+              artifact(sourcesJarTaskProvider.get())\n+            }\n \n-          pom {\n-            artifactId = findProperty(\"POM_ARTIFACT_ID\") as String?\n+            pom {\n+              artifactId = findProperty(\"POM_ARTIFACT_ID\") as String?\n+            }\n           }\n         }\n       }\n+\n+      withType<MavenPublication>() {\n+        setDefaultPomFields()", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "63186853aa6773a967246df7621ccd5487877b8d"}, "originalPosition": 76}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "8c0a0d54c18c900d8041b4491fef6fb888558281", "author": {"user": {"login": "martinbonnin", "name": "Martin Bonnin"}}, "url": "https://github.com/apollographql/apollo-android/commit/8c0a0d54c18c900d8041b4491fef6fb888558281", "committedDate": "2020-04-14T19:09:38Z", "message": "fix artifact id"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b7de8fd4b08485af21f462f0c5f60295b146babb", "author": {"user": {"login": "martinbonnin", "name": "Martin Bonnin"}}, "url": "https://github.com/apollographql/apollo-android/commit/b7de8fd4b08485af21f462f0c5f60295b146babb", "committedDate": "2020-04-14T19:11:25Z", "message": "wrap in afterEvaluate so that the component is actually there"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "528407644623b02c25d4fa71782f0e276e4d9dd2", "author": {"user": {"login": "martinbonnin", "name": "Martin Bonnin"}}, "url": "https://github.com/apollographql/apollo-android/commit/528407644623b02c25d4fa71782f0e276e4d9dd2", "committedDate": "2020-04-14T21:38:19Z", "message": "add javadoc/sources for the plugin too"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzkzNTM3ODc5", "url": "https://github.com/apollographql/apollo-android/pull/2172#pullrequestreview-393537879", "createdAt": "2020-04-15T07:55:59Z", "commit": {"oid": "528407644623b02c25d4fa71782f0e276e4d9dd2"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xNVQwNzo1NjowMFrOGFuD8g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xNVQwNzo1NjowMFrOGFuD8g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwODY1MDczOA==", "bodyText": "Ops", "url": "https://github.com/apollographql/apollo-android/pull/2172#discussion_r408650738", "createdAt": "2020-04-15T07:56:00Z", "author": {"login": "tasomaniac"}, "path": "apollo-normalized-cache-sqlite/gradle.properties", "diffHunk": "@@ -1,4 +1,4 @@\n-POM_ARTIFACT_ID=apollo-sqlite-cache\n+POM_ARTIFACT_ID=apollo-normalized-cache-sqlite", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "528407644623b02c25d4fa71782f0e276e4d9dd2"}, "originalPosition": 2}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3947, "cost": 1, "resetAt": "2021-11-01T11:59:11Z"}}}