{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDI0MDc3NjMx", "number": 2311, "reviewThreads": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yOFQwNzo0Nzo0MlrOEAZbGg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yOFQxNTowNTozMFrOEAjSEw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjY4ODUxOTk0OnYy", "diffSide": "RIGHT", "path": "apollo-runtime-kotlin/src/commonMain/kotlin/com/apollographql/apollo/network/websocket/ApolloWebSocketNetworkTransport.kt", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yOFQwNzo0Nzo0MlrOGbpgdg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yOFQxNDoxMjo0NlrOGb3CFA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMTY0NDc5MA==", "bodyText": "Feels weird to name it NetworkTransport if it inherits from Interceptor", "url": "https://github.com/apollographql/apollo-android/pull/2311#discussion_r431644790", "createdAt": "2020-05-28T07:47:42Z", "author": {"login": "martinbonnin"}, "path": "apollo-runtime-kotlin/src/commonMain/kotlin/com/apollographql/apollo/network/websocket/ApolloWebSocketNetworkTransport.kt", "diffHunk": "@@ -0,0 +1,18 @@\n+package com.apollographql.apollo.network.websocket\n+\n+import com.apollographql.apollo.api.ApolloExperimental\n+import com.apollographql.apollo.api.Response\n+import com.apollographql.apollo.interceptor.ApolloInterceptorChain\n+import com.apollographql.apollo.interceptor.ApolloRequest\n+import com.apollographql.apollo.interceptor.ApolloRequestInterceptor\n+import kotlinx.coroutines.flow.Flow\n+\n+@ApolloExperimental\n+class ApolloWebSocketNetworkTransport(\n+    private val apolloWebSocketFactory: ApolloWebSocketFactory\n+) : ApolloRequestInterceptor {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "df9d76c8f942e4096c5315265ba403415b74e874"}, "originalPosition": 13}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMTg2NjM4OA==", "bodyText": "Sorry it was a mistake, it supposed to inherit NetworkTransport", "url": "https://github.com/apollographql/apollo-android/pull/2311#discussion_r431866388", "createdAt": "2020-05-28T14:12:46Z", "author": {"login": "sav007"}, "path": "apollo-runtime-kotlin/src/commonMain/kotlin/com/apollographql/apollo/network/websocket/ApolloWebSocketNetworkTransport.kt", "diffHunk": "@@ -0,0 +1,18 @@\n+package com.apollographql.apollo.network.websocket\n+\n+import com.apollographql.apollo.api.ApolloExperimental\n+import com.apollographql.apollo.api.Response\n+import com.apollographql.apollo.interceptor.ApolloInterceptorChain\n+import com.apollographql.apollo.interceptor.ApolloRequest\n+import com.apollographql.apollo.interceptor.ApolloRequestInterceptor\n+import kotlinx.coroutines.flow.Flow\n+\n+@ApolloExperimental\n+class ApolloWebSocketNetworkTransport(\n+    private val apolloWebSocketFactory: ApolloWebSocketFactory\n+) : ApolloRequestInterceptor {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMTY0NDc5MA=="}, "originalCommit": {"oid": "df9d76c8f942e4096c5315265ba403415b74e874"}, "originalPosition": 13}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjY5MDEzNTIzOnYy", "diffSide": "RIGHT", "path": "apollo-runtime-kotlin/src/iosMain/kotlin/com/apollographql/apollo/network/websocket/ApolloWebSocket.kt", "isResolved": false, "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yOFQxNTowNTozMFrOGb5qnQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yOVQyMTozOToxOFrOGcszrQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMTkwOTUzMw==", "bodyText": "This is a big one: We need to make it clear that this will only work with iOS 13+ - I don't think this will even compile on older versions of iOS since it leverages web socket stuff introduced in iOS 13.\nIf we're not making iOS 13 a requirement for KMP (which we could, but I think might be a smidge premature), then there needs to be a way to prevent this from compiling or being available on iOS 12 and below.", "url": "https://github.com/apollographql/apollo-android/pull/2311#discussion_r431909533", "createdAt": "2020-05-28T15:05:30Z", "author": {"login": "designatednerd"}, "path": "apollo-runtime-kotlin/src/iosMain/kotlin/com/apollographql/apollo/network/websocket/ApolloWebSocket.kt", "diffHunk": "@@ -0,0 +1,160 @@\n+package com.apollographql.apollo.network.websocket\n+\n+import com.apollographql.apollo.ApolloWebSocketException\n+import com.apollographql.apollo.network.toNSData\n+import kotlinx.coroutines.channels.Channel\n+import kotlinx.coroutines.channels.ReceiveChannel\n+import okio.ByteString\n+import okio.ByteString.Companion.toByteString\n+import okio.IOException\n+import okio.internal.commonAsUtf8ToByteArray\n+import okio.toByteString\n+import platform.Foundation.NSMutableURLRequest\n+import platform.Foundation.NSOperationQueue\n+import platform.Foundation.NSThread\n+import platform.Foundation.NSURL\n+import platform.Foundation.NSURLRequest\n+import platform.Foundation.NSURLSession\n+import platform.Foundation.NSURLSessionConfiguration\n+import platform.Foundation.NSURLSessionWebSocketCloseCode\n+import platform.Foundation.NSURLSessionWebSocketMessage\n+import platform.Foundation.NSURLSessionWebSocketMessageTypeData\n+import platform.Foundation.NSURLSessionWebSocketMessageTypeString\n+import platform.Foundation.NSURLSessionWebSocketTask\n+import platform.Foundation.setValue\n+import kotlin.native.concurrent.AtomicReference\n+\n+typealias WebSocketFactory = (NSURLRequest) -> NSURLSessionWebSocketTask\n+\n+actual class ApolloWebSocketFactory(", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "289fe751044df788974d9ad4decfdc9f2c42158b"}, "originalPosition": 29}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMTk3ODQ4MQ==", "bodyText": "I was thinking on adding this as part of documentation later as we don't really promote new kotlin runtime module.\nIt's interesting is there any way to put restriction on iOS version in KN configuration? We should check that.", "url": "https://github.com/apollographql/apollo-android/pull/2311#discussion_r431978481", "createdAt": "2020-05-28T16:45:54Z", "author": {"login": "sav007"}, "path": "apollo-runtime-kotlin/src/iosMain/kotlin/com/apollographql/apollo/network/websocket/ApolloWebSocket.kt", "diffHunk": "@@ -0,0 +1,160 @@\n+package com.apollographql.apollo.network.websocket\n+\n+import com.apollographql.apollo.ApolloWebSocketException\n+import com.apollographql.apollo.network.toNSData\n+import kotlinx.coroutines.channels.Channel\n+import kotlinx.coroutines.channels.ReceiveChannel\n+import okio.ByteString\n+import okio.ByteString.Companion.toByteString\n+import okio.IOException\n+import okio.internal.commonAsUtf8ToByteArray\n+import okio.toByteString\n+import platform.Foundation.NSMutableURLRequest\n+import platform.Foundation.NSOperationQueue\n+import platform.Foundation.NSThread\n+import platform.Foundation.NSURL\n+import platform.Foundation.NSURLRequest\n+import platform.Foundation.NSURLSession\n+import platform.Foundation.NSURLSessionConfiguration\n+import platform.Foundation.NSURLSessionWebSocketCloseCode\n+import platform.Foundation.NSURLSessionWebSocketMessage\n+import platform.Foundation.NSURLSessionWebSocketMessageTypeData\n+import platform.Foundation.NSURLSessionWebSocketMessageTypeString\n+import platform.Foundation.NSURLSessionWebSocketTask\n+import platform.Foundation.setValue\n+import kotlin.native.concurrent.AtomicReference\n+\n+typealias WebSocketFactory = (NSURLRequest) -> NSURLSessionWebSocketTask\n+\n+actual class ApolloWebSocketFactory(", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMTkwOTUzMw=="}, "originalCommit": {"oid": "289fe751044df788974d9ad4decfdc9f2c42158b"}, "originalPosition": 29}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMjc0NzQzNw==", "bodyText": "I have to imagine there's a way to do it somehow - Or I wonder if maybe the K/N shims are doing the work of no-op'ing new APIs on older versions under the hood? I haven't looked into it tbh.", "url": "https://github.com/apollographql/apollo-android/pull/2311#discussion_r432747437", "createdAt": "2020-05-29T21:39:18Z", "author": {"login": "designatednerd"}, "path": "apollo-runtime-kotlin/src/iosMain/kotlin/com/apollographql/apollo/network/websocket/ApolloWebSocket.kt", "diffHunk": "@@ -0,0 +1,160 @@\n+package com.apollographql.apollo.network.websocket\n+\n+import com.apollographql.apollo.ApolloWebSocketException\n+import com.apollographql.apollo.network.toNSData\n+import kotlinx.coroutines.channels.Channel\n+import kotlinx.coroutines.channels.ReceiveChannel\n+import okio.ByteString\n+import okio.ByteString.Companion.toByteString\n+import okio.IOException\n+import okio.internal.commonAsUtf8ToByteArray\n+import okio.toByteString\n+import platform.Foundation.NSMutableURLRequest\n+import platform.Foundation.NSOperationQueue\n+import platform.Foundation.NSThread\n+import platform.Foundation.NSURL\n+import platform.Foundation.NSURLRequest\n+import platform.Foundation.NSURLSession\n+import platform.Foundation.NSURLSessionConfiguration\n+import platform.Foundation.NSURLSessionWebSocketCloseCode\n+import platform.Foundation.NSURLSessionWebSocketMessage\n+import platform.Foundation.NSURLSessionWebSocketMessageTypeData\n+import platform.Foundation.NSURLSessionWebSocketMessageTypeString\n+import platform.Foundation.NSURLSessionWebSocketTask\n+import platform.Foundation.setValue\n+import kotlin.native.concurrent.AtomicReference\n+\n+typealias WebSocketFactory = (NSURLRequest) -> NSURLSessionWebSocketTask\n+\n+actual class ApolloWebSocketFactory(", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMTkwOTUzMw=="}, "originalCommit": {"oid": "289fe751044df788974d9ad4decfdc9f2c42158b"}, "originalPosition": 29}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3096, "cost": 1, "resetAt": "2021-11-12T09:44:50Z"}}}