{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDA5MjIxMjE4", "number": 2223, "title": "Swift UI funtimes for iOS Sample App on KMP", "bodyText": "Implementation of #2188 (repos pictured are mine since it's my github key I'm using while working on this).\n\n\nNotes:\n\nUsed SwiftUI instead of storyboards mostly for funsies and practice, also to prove it could be done. \u26f0\ufe0f\nSomewhat obnoxious side effect of K/N compiling down to Objective-C instead of Swift is that I needed to make an @ObservableObject to handle publishing changes of arrays instead of using @State for various properties since @State only works on structs (and arrays of structs - even if the Array itself is a struct, it has to contain structs for the SwiftUI magic\u2122 to work properly) and anything coming out of ObjC is going to be a class.\nDue to stupidity with Objective-C runtime collision, I've had to typealias one of the RepoFragments properties named description. On every NSObject subclass, description is essentially a debug description of an object, and whether the dynamic dispatch will resolve to that implementation or the implementation of a property named description is basically a crapshoot, with the dice slightly weighted in favor of Apple's implementation. I don't know if there's a great way to add an iOS-only alias - I think an extension that, within Kotlin, still called into .description, would run into the same problem on iOS, but I didn't try that since aliasing was easier.\n\nQuestions:\n\nOn the commits I'm running into the issue that the closure I get back from fetchCommits(repositoryName:) is returning [Any] - I'm guessing because this could return multiple possible types. Can you point me in the direction of what those possible types are, and how I'd find them in the future? (Addressed)\nI noticed every K/N object is generating this componentN for all the properties - I don't think I've seen this in my prior work with K/N, so is this something we're doing (or causing it to do)? It still has the appropriate property names on top of this, but I thought this was weird:\n\n\nNow working all the way through and ready for review!", "createdAt": "2020-04-27T03:04:18Z", "url": "https://github.com/apollographql/apollo-android/pull/2223", "merged": true, "mergeCommit": {"oid": "666a7f99e91e6163626922436d9d60136236dfdc"}, "closed": true, "closedAt": "2020-04-30T23:47:21Z", "author": {"login": "designatednerd"}, "timelineItems": {"totalCount": 14, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcbl8MEAH2gAyNDA5MjIxMjE4OjQ1NWYxZjNlN2YyZjc0MTZiNGI1YzY1MDAxMmVlZTlkMmVmMzA0ZGQ=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcc0I42AFqTQwMzg5NzI2MA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "455f1f3e7f2f7416b4b5c650012eee9d2ef304dd", "author": {"user": {"login": "designatednerd", "name": "Ellen Shapiro"}}, "url": "https://github.com/apollographql/apollo-android/commit/455f1f3e7f2f7416b4b5c650012eee9d2ef304dd", "committedDate": "2020-04-27T02:34:16Z", "message": "alias name of `description` because otherwise it causes Obj-C runtime confusion"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "1c3c760072080cb5c429fb3f2771914e153757bb", "author": {"user": {"login": "designatednerd", "name": "Ellen Shapiro"}}, "url": "https://github.com/apollographql/apollo-android/commit/1c3c760072080cb5c429fb3f2771914e153757bb", "committedDate": "2020-04-27T02:45:38Z", "message": "UI featuring SwiftUI"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b6dd7e570246fd0d33ab5969745550c142e2e328", "author": {"user": {"login": "designatednerd", "name": "Ellen Shapiro"}}, "url": "https://github.com/apollographql/apollo-android/commit/b6dd7e570246fd0d33ab5969745550c142e2e328", "committedDate": "2020-04-27T20:13:44Z", "message": "remove old \"Hello-world\""}}, {"__typename": "PullRequestCommit", "commit": {"oid": "406f2a80f87451a2ea8989d097049a0051aebb6d", "author": {"user": {"login": "designatednerd", "name": "Ellen Shapiro"}}, "url": "https://github.com/apollographql/apollo-android/commit/406f2a80f87451a2ea8989d097049a0051aebb6d", "committedDate": "2020-04-27T20:14:09Z", "message": "byeee whitespace"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d21d2697b8679d687f53443068272a04a69ef3e2", "author": {"user": {"login": "designatednerd", "name": "Ellen Shapiro"}}, "url": "https://github.com/apollographql/apollo-android/commit/d21d2697b8679d687f53443068272a04a69ef3e2", "committedDate": "2020-04-27T20:15:26Z", "message": "fix which screen gets an inline title"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "7afb11d44e6499bee967e18c0716423b6c7320ce", "author": {"user": {"login": "designatednerd", "name": "Ellen Shapiro"}}, "url": "https://github.com/apollographql/apollo-android/commit/7afb11d44e6499bee967e18c0716423b6c7320ce", "committedDate": "2020-04-27T20:19:22Z", "message": "Add note about commit types vs. generics and map to Nodes."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "addec177d0f0369c55b6a3372fc1595bd3569944", "author": {"user": {"login": "designatednerd", "name": "Ellen Shapiro"}}, "url": "https://github.com/apollographql/apollo-android/commit/addec177d0f0369c55b6a3372fc1595bd3569944", "committedDate": "2020-04-27T20:19:36Z", "message": "create UI for commit list"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "5884b1840a3c7ceba4901ba2c3d62754c6ee53a1", "author": {"user": {"login": "designatednerd", "name": "Ellen Shapiro"}}, "url": "https://github.com/apollographql/apollo-android/commit/5884b1840a3c7ceba4901ba2c3d62754c6ee53a1", "committedDate": "2020-04-27T20:30:58Z", "message": "update repo description on details and update Android app so everything compiles"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "6fabd869ca178c061dbd47c134b94d060abbd19e", "author": {"user": {"login": "designatednerd", "name": "Ellen Shapiro"}}, "url": "https://github.com/apollographql/apollo-android/commit/6fabd869ca178c061dbd47c134b94d060abbd19e", "committedDate": "2020-04-27T20:42:39Z", "message": "Add readme with a bunch of notes about Obj-C shenanigans"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDAxMzQxMTQy", "url": "https://github.com/apollographql/apollo-android/pull/2223#pullrequestreview-401341142", "createdAt": "2020-04-27T21:29:53Z", "commit": {"oid": "6fabd869ca178c061dbd47c134b94d060abbd19e"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "cdef9c2841e4c5a19da7f09850cbf26c33613b0c", "author": {"user": {"login": "designatednerd", "name": "Ellen Shapiro"}}, "url": "https://github.com/apollographql/apollo-android/commit/cdef9c2841e4c5a19da7f09850cbf26c33613b0c", "committedDate": "2020-04-28T21:30:50Z", "message": "actually set content view on repo detail activity"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "027cc4781870e81168efb224e6027acc2d5fa934", "author": {"user": {"login": "designatednerd", "name": "Ellen Shapiro"}}, "url": "https://github.com/apollographql/apollo-android/commit/027cc4781870e81168efb224e6027acc2d5fa934", "committedDate": "2020-04-28T22:52:23Z", "message": "fix parent activity for commits activity"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDAzMzcyNDky", "url": "https://github.com/apollographql/apollo-android/pull/2223#pullrequestreview-403372492", "createdAt": "2020-04-30T09:56:30Z", "commit": {"oid": "027cc4781870e81168efb224e6027acc2d5fa934"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0zMFQwOTo1NjozMFrOGOiORw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0zMFQwOTo1NjozMFrOGOiORw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNzg5Mzk1OQ==", "bodyText": "Is there a way to force a crash if $0 is not nil but not of type GithubRepositoryCommitsQuery.Edge either? Some swift equivalent of mapNotNull { it as GithubRepositoryCommitsQuery.Edge? } in Kotlin?", "url": "https://github.com/apollographql/apollo-android/pull/2223#discussion_r417893959", "createdAt": "2020-04-30T09:56:30Z", "author": {"login": "martinbonnin"}, "path": "samples/multiplatform/kmp-ios-app/kmp-ios-app/RepositoryManager.swift", "diffHunk": "@@ -0,0 +1,46 @@\n+//\n+//  RepositoryManager.swift\n+//  kmp-ios-app\n+//\n+//  Created by Ellen Shapiro on 4/26/20.\n+//\n+\n+import Foundation\n+import kmp_lib_sample\n+import SwiftUI\n+\n+class RepositoryManager: ObservableObject {\n+    \n+    private let repository = ApolloiOSRepositoryKt.create()\n+    \n+    @Published var repos: [RepositoryFragment] = []\n+    @Published var repoDetails: [String: RepositoryDetail] = [:]\n+    @Published var commits: [String: [GithubRepositoryCommitsQuery.Node]] = [:]\n+    \n+    func fetch() {\n+        self.repository.fetchRepositories { [weak self] repos in\n+            self?.repos = repos\n+        }\n+    }\n+    \n+    func fetchDetails(for repo: RepositoryFragment) {        \n+        self.repository.fetchRepositoryDetail(repositoryName: repo.name) { [weak self] detail in\n+            if let detail = detail {\n+                self?.repoDetails[repo.name] = detail\n+            }\n+        }\n+    }\n+    \n+    func fetchCommits(for repo: RepositoryFragment) {\n+        // NOTE: This comes in as `[Any]` due to some some issues with representing\n+        // optional types in a generic array in Objective-C from K/N. The actual\n+        // type coming back here is `GithubRepositoryCommitsQuery.Edge`, and the\n+        // `Node` it contains is where actual information about the commit lives.\n+        self.repository.fetchCommits(repositoryName: repo.name) { [weak self] commits in\n+            let filteredCommits = commits\n+                .compactMap { $0 as? GithubRepositoryCommitsQuery.Edge }", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "027cc4781870e81168efb224e6027acc2d5fa934"}, "originalPosition": 41}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDAzODk3MjYw", "url": "https://github.com/apollographql/apollo-android/pull/2223#pullrequestreview-403897260", "createdAt": "2020-04-30T21:40:44Z", "commit": {"oid": "027cc4781870e81168efb224e6027acc2d5fa934"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3989, "cost": 1, "resetAt": "2021-11-01T11:59:11Z"}}}