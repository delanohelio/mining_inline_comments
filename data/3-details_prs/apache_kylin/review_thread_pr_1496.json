{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTMyMjE5MTY1", "number": 1496, "reviewThreads": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0wNFQwMzo1NToyMFrOFAnNiw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0wNFQxMDo1Mzo1OVrOFAvlPw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzM2MTg2NzYzOnYy", "diffSide": "RIGHT", "path": "kylin-spark-project/kylin-spark-common/src/main/java/org/apache/kylin/engine/spark/metadata/cube/PathManager.java", "isResolved": true, "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0wNFQwMzo1NToyMFrOH-_trg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0wNFQwODo0NzoyMlrOH_GpQw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNTgxNzY0Ng==", "bodyText": "Is there a File.separator between hdfsWorkDir and parquet", "url": "https://github.com/apache/kylin/pull/1496#discussion_r535817646", "createdAt": "2020-12-04T03:55:20Z", "author": {"login": "hit-lacus"}, "path": "kylin-spark-project/kylin-spark-common/src/main/java/org/apache/kylin/engine/spark/metadata/cube/PathManager.java", "diffHunk": "@@ -49,6 +49,12 @@ public static String getSegmentParquetStoragePath(CubeInstance cube, String segN\n         return hdfsWorkDir + \"parquet\" + File.separator + cube.getName() + File.separator + segName + \"_\" + identifier;\n     }\n \n+    public static String getSegmentParquetStoragePath(String hdfsWorkDir, String cubeName, CubeSegment segment) {\n+        String segmentName = segment.getName();\n+        String identifier = segment.getStorageLocationIdentifier();\n+        return hdfsWorkDir + \"parquet\" + File.separator + cubeName + File.separator + segmentName + \"_\" + identifier;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e0cfed812a59399ebdd4283e384b2bce19719ed2"}, "originalPosition": 7}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNTgzNTk1NQ==", "bodyText": "Actually  the end of hdfsWorkDir already comes with a File.separator.", "url": "https://github.com/apache/kylin/pull/1496#discussion_r535835955", "createdAt": "2020-12-04T04:56:41Z", "author": {"login": "zhangayqian"}, "path": "kylin-spark-project/kylin-spark-common/src/main/java/org/apache/kylin/engine/spark/metadata/cube/PathManager.java", "diffHunk": "@@ -49,6 +49,12 @@ public static String getSegmentParquetStoragePath(CubeInstance cube, String segN\n         return hdfsWorkDir + \"parquet\" + File.separator + cube.getName() + File.separator + segName + \"_\" + identifier;\n     }\n \n+    public static String getSegmentParquetStoragePath(String hdfsWorkDir, String cubeName, CubeSegment segment) {\n+        String segmentName = segment.getName();\n+        String identifier = segment.getStorageLocationIdentifier();\n+        return hdfsWorkDir + \"parquet\" + File.separator + cubeName + File.separator + segmentName + \"_\" + identifier;", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNTgxNzY0Ng=="}, "originalCommit": {"oid": "e0cfed812a59399ebdd4283e384b2bce19719ed2"}, "originalPosition": 7}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNTkzMTIwMw==", "bodyText": "OK", "url": "https://github.com/apache/kylin/pull/1496#discussion_r535931203", "createdAt": "2020-12-04T08:47:22Z", "author": {"login": "hit-lacus"}, "path": "kylin-spark-project/kylin-spark-common/src/main/java/org/apache/kylin/engine/spark/metadata/cube/PathManager.java", "diffHunk": "@@ -49,6 +49,12 @@ public static String getSegmentParquetStoragePath(CubeInstance cube, String segN\n         return hdfsWorkDir + \"parquet\" + File.separator + cube.getName() + File.separator + segName + \"_\" + identifier;\n     }\n \n+    public static String getSegmentParquetStoragePath(String hdfsWorkDir, String cubeName, CubeSegment segment) {\n+        String segmentName = segment.getName();\n+        String identifier = segment.getStorageLocationIdentifier();\n+        return hdfsWorkDir + \"parquet\" + File.separator + cubeName + File.separator + segmentName + \"_\" + identifier;", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNTgxNzY0Ng=="}, "originalCommit": {"oid": "e0cfed812a59399ebdd4283e384b2bce19719ed2"}, "originalPosition": 7}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzM2MzIwNjU2OnYy", "diffSide": "LEFT", "path": "tool/src/main/java/org/apache/kylin/tool/CubeMigrationCLI.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0wNFQxMDo0NjozNVrOH_LUNw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0wNFQxMDo0NjozNVrOH_LUNw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNjAwNzczNQ==", "bodyText": "After remove HBase, looks like we do not need CubeMigrationCheckCLI any more.", "url": "https://github.com/apache/kylin/pull/1496#discussion_r536007735", "createdAt": "2020-12-04T10:46:35Z", "author": {"login": "hit-lacus"}, "path": "tool/src/main/java/org/apache/kylin/tool/CubeMigrationCLI.java", "diffHunk": "@@ -192,20 +184,12 @@ public void moveCube(KylinConfig srcCfg, KylinConfig dstCfg, String cubeName, St\n \n         if (realExecute) {\n             doOpts();\n-            if (migrateSegment) {\n-                checkMigrationSuccess(dstConfig, cubeName, true);\n-            }\n             updateMeta(dstConfig, projectName, cubeName, cube.getModel());\n         } else {\n             showOpts();\n         }\n     }\n \n-    public void checkMigrationSuccess(KylinConfig kylinConfig, String cubeName, Boolean ifFix) throws IOException {\n-        CubeMigrationCheckCLI checkCLI = new CubeMigrationCheckCLI(kylinConfig, ifFix);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e0cfed812a59399ebdd4283e384b2bce19719ed2"}, "originalPosition": 162}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzM2MzIzOTAzOnYy", "diffSide": "RIGHT", "path": "tool/src/main/java/org/apache/kylin/tool/CubeMigrationCLI.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0wNFQxMDo1Mzo1OVrOH_Lm6g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0wNFQxMDo1Mzo1OVrOH_Lm6g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNjAxMjUyMg==", "bodyText": "In which case columnInfo.length is not 3?", "url": "https://github.com/apache/kylin/pull/1496#discussion_r536012522", "createdAt": "2020-12-04T10:53:59Z", "author": {"login": "hit-lacus"}, "path": "tool/src/main/java/org/apache/kylin/tool/CubeMigrationCLI.java", "diffHunk": "@@ -326,22 +292,32 @@ protected void listCubeRelatedResources(CubeInstance cube, List<String> metaReso\n         metaResource.addAll(getCompatibleTablePath(tblRefs, prj, ResourceStore.TABLE_EXD_RESOURCE_ROOT));\n \n         if (doMigrateSegment) {\n+            for (DictionaryDesc dictionaryDesc : cubeDesc.getDictionaries()) {\n+                String[] columnInfo = dictionaryDesc.getColumnRef().getColumnWithTable().split(\"\\\\.\");\n+                String globalDictPath;\n+                if (columnInfo.length == 3) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e0cfed812a59399ebdd4283e384b2bce19719ed2"}, "originalPosition": 268}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1573, "cost": 1, "resetAt": "2021-11-12T11:18:39Z"}}}