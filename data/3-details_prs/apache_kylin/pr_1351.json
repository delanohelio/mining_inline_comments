{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDYzOTQxNDUz", "number": 1351, "title": "KYLIN-4683 Fail to consume kafka when partition number get larger", "bodyText": "Proposed changes\nJIRA\uff1ahttps://issues.apache.org/jira/browse/KYLIN-4683\nTypes of changes\n\n Bugfix (non-breaking change which fixes an issue)\n New feature (non-breaking change which adds functionality)\n Breaking change (fix or feature that would cause existing functionality to not work as expected)\n Documentation Update (if none of the other choices apply)\n\nChecklist\n\n I have create an issue on Kylin's jira, and have described the bug/feature there in detail\n Commit messages in my PR start with the related jira ID, like \"KYLIN-0000 Make Kylin project open-source\"\n Compiling and unit tests pass locally with my changes\n I have added tests that prove my fix is effective or that my feature works\n If this change need a document change, I will prepare another pr against the document branch\n Any dependent changes have been merged", "createdAt": "2020-08-06T10:35:22Z", "url": "https://github.com/apache/kylin/pull/1351", "merged": true, "mergeCommit": {"oid": "88cebbdfbb42f914deed1543c8a6b82ab7a4b890"}, "closed": true, "closedAt": "2020-09-17T08:34:45Z", "author": {"login": "tianhui5"}, "timelineItems": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABc9P-yQgFqTQ2Mzg4NTc4Mg==", "endCursor": "Y3Vyc29yOnYyOpPPAAABdJsythAFqTQ5MDM2NDkxMg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDYzODg1Nzgy", "url": "https://github.com/apache/kylin/pull/1351#pullrequestreview-463885782", "createdAt": "2020-08-09T16:11:49Z", "commit": {"oid": "35ed1b6bafc3f97752aea6405de2a82d690b8c61"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0wOVQxNjoxMTo0OVrOG98HRQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0wOVQxNjoxMTo0OVrOG98HRQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NzYwMTIyMQ==", "bodyText": "I think kafkaConsumer.seekToBeginning(newTopicPartitions); should not in for-loop .", "url": "https://github.com/apache/kylin/pull/1351#discussion_r467601221", "createdAt": "2020-08-09T16:11:49Z", "author": {"login": "hit-lacus"}, "path": "stream-source-kafka/src/main/java/org/apache/kylin/stream/source/kafka/consumer/KafkaConnector.java", "diffHunk": "@@ -81,9 +81,15 @@ public void open() {\n         } else if (startMode == ConsumerStartMode.LATEST) {\n             kafkaConsumer.seekToEnd(topicPartitions);\n         } else {\n+            List<TopicPartition> newTopicPartitions = Lists.newArrayList();\n             for (TopicPartition topicPartition : topicPartitions) {\n                 Long offset = partitionOffsets.get(topicPartition.partition());\n-                kafkaConsumer.seek(topicPartition, offset);\n+                if (offset != null) {\n+                    kafkaConsumer.seek(topicPartition, offset);\n+                } else {\n+                    newTopicPartitions.add(topicPartition);\n+                }\n+                kafkaConsumer.seekToBeginning(newTopicPartitions);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "35ed1b6bafc3f97752aea6405de2a82d690b8c61"}, "originalPosition": 13}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "fe5c56eab33e7a6dd7a815a5f07d7e95f0a0cb21", "author": {"user": null}, "url": "https://github.com/apache/kylin/commit/fe5c56eab33e7a6dd7a815a5f07d7e95f0a0cb21", "committedDate": "2020-08-10T02:10:29Z", "message": "KYLIN-4683 Fail to consume kafka when partition number get larger"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDkwMzY0OTEy", "url": "https://github.com/apache/kylin/pull/1351#pullrequestreview-490364912", "createdAt": "2020-09-17T08:33:46Z", "commit": {"oid": "fe5c56eab33e7a6dd7a815a5f07d7e95f0a0cb21"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2864, "cost": 1, "resetAt": "2021-10-29T19:57:52Z"}}}