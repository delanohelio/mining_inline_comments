{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDU3NTk3MjM5", "number": 1332, "reviewThreads": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yOVQwNDoxODoyNFrOETFntQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yOVQwNDoyNjowNVrOETFsUA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjg4NDUwNDg1OnYy", "diffSide": "RIGHT", "path": "kylin-spark-project/kylin-spark-engine/src/main/scala/org/apache/kylin/engine/spark/builder/CubeDictionaryBuilder.scala", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yOVQwNDoxODoyNFrOG4n-ng==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yOVQwNDozNzo0MFrOG4oQmg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MjAyODQ0Ng==", "bodyText": "V2 need to be removed?", "url": "https://github.com/apache/kylin/pull/1332#discussion_r462028446", "createdAt": "2020-07-29T04:18:24Z", "author": {"login": "hit-lacus"}, "path": "kylin-spark-project/kylin-spark-engine/src/main/scala/org/apache/kylin/engine/spark/builder/CubeDictionaryBuilder.scala", "diffHunk": "@@ -70,7 +70,7 @@ class DFDictionaryBuilder(val dataset: Dataset[Row],\n     val columnName = ref.identity\n     logInfo(s\"Start building global dictionaries V2 for column $columnName.\")", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "0e9535d20f0a3d396f627b64024b0003b094d44b"}, "originalPosition": 30}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MjAzMzA1MA==", "bodyText": "Right, there're still some logs need to be modified.", "url": "https://github.com/apache/kylin/pull/1332#discussion_r462033050", "createdAt": "2020-07-29T04:37:40Z", "author": {"login": "RupengWang"}, "path": "kylin-spark-project/kylin-spark-engine/src/main/scala/org/apache/kylin/engine/spark/builder/CubeDictionaryBuilder.scala", "diffHunk": "@@ -70,7 +70,7 @@ class DFDictionaryBuilder(val dataset: Dataset[Row],\n     val columnName = ref.identity\n     logInfo(s\"Start building global dictionaries V2 for column $columnName.\")", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MjAyODQ0Ng=="}, "originalCommit": {"oid": "0e9535d20f0a3d396f627b64024b0003b094d44b"}, "originalPosition": 30}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjg4NDUxMDI1OnYy", "diffSide": "LEFT", "path": "kylin-spark-project/kylin-spark-engine/src/main/scala/org/apache/kylin/engine/spark/job/ParentSourceChooser.scala", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yOVQwNDoyMTo1NlrOG4oBwA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yOVQwNDoyMTo1NlrOG4oBwA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MjAyOTI0OA==", "bodyText": "Good catch!", "url": "https://github.com/apache/kylin/pull/1332#discussion_r462029248", "createdAt": "2020-07-29T04:21:56Z", "author": {"login": "hit-lacus"}, "path": "kylin-spark-project/kylin-spark-engine/src/main/scala/org/apache/kylin/engine/spark/job/ParentSourceChooser.scala", "diffHunk": "@@ -163,7 +162,6 @@ class ParentSourceChooser(\n     val flatTable = new CreateFlatTable(seg, toBuildTree, ss, sourceInfo)\n     val afterJoin: Dataset[Row] = flatTable.generateDataset(needEncoding, true)\n     sourceInfo.setFlattableDS(afterJoin)\n-    sourceInfo.setCount(afterJoin.count())", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "0e9535d20f0a3d396f627b64024b0003b094d44b"}, "originalPosition": 21}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjg4NDUxNjY0OnYy", "diffSide": "RIGHT", "path": "kylin-spark-project/kylin-spark-engine/src/main/scala/org/apache/kylin/engine/spark/job/CubeBuildJob.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yOVQwNDoyNjowNVrOG4oFbg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yOVQwNDozNjo1NFrOG4oP_w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MjAzMDE5MA==", "bodyText": "What's the reason of getParentDS?", "url": "https://github.com/apache/kylin/pull/1332#discussion_r462030190", "createdAt": "2020-07-29T04:26:05Z", "author": {"login": "hit-lacus"}, "path": "kylin-spark-project/kylin-spark-engine/src/main/scala/org/apache/kylin/engine/spark/job/CubeBuildJob.java", "diffHunk": "@@ -120,7 +120,7 @@ protected void doExecute() throws Exception {\n                 infos.recordSpanningTree(segId, spanningTree);\n \n                 logger.info(\"Updating segment info\");\n-                updateSegmentInfo(getParam(MetadataConstants.P_CUBE_ID), seg, buildFromFlatTable.getCount());\n+                updateSegmentInfo(getParam(MetadataConstants.P_CUBE_ID), seg, buildFromFlatTable.getParentDS().count());", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "0e9535d20f0a3d396f627b64024b0003b094d44b"}, "originalPosition": 16}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MjAzMjg5NQ==", "bodyText": "Well, it'd be better to use getFlattableDS.", "url": "https://github.com/apache/kylin/pull/1332#discussion_r462032895", "createdAt": "2020-07-29T04:36:54Z", "author": {"login": "RupengWang"}, "path": "kylin-spark-project/kylin-spark-engine/src/main/scala/org/apache/kylin/engine/spark/job/CubeBuildJob.java", "diffHunk": "@@ -120,7 +120,7 @@ protected void doExecute() throws Exception {\n                 infos.recordSpanningTree(segId, spanningTree);\n \n                 logger.info(\"Updating segment info\");\n-                updateSegmentInfo(getParam(MetadataConstants.P_CUBE_ID), seg, buildFromFlatTable.getCount());\n+                updateSegmentInfo(getParam(MetadataConstants.P_CUBE_ID), seg, buildFromFlatTable.getParentDS().count());", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MjAzMDE5MA=="}, "originalCommit": {"oid": "0e9535d20f0a3d396f627b64024b0003b094d44b"}, "originalPosition": 16}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1645, "cost": 1, "resetAt": "2021-11-12T11:18:39Z"}}}