{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDA3MzAzNTU5", "number": 1182, "title": "KYLIN-4446 Kylin on kubernetes in quick-start and production env", "bodyText": "Proposed changes\nDescribe the big picture of your changes here to communicate to the maintainers why we should accept this pull request. If it fixes a bug or resolves a feature request, be sure to link to that issue.\nTypes of changes\nWhat types of changes does your code introduce to Kylin?\nPut an x in the boxes that apply\n\n Bugfix (non-breaking change which fixes an issue)\n New feature (non-breaking change which adds functionality)\n Breaking change (fix or feature that would cause existing functionality to not work as expected)\n Documentation Update (if none of the other choices apply)\n\nChecklist\nPut an x in the boxes that apply. You can also fill these out after creating the PR. If you're unsure about any of them, don't hesitate to ask. We're here to help! This is simply a reminder of what we are going to look for before merging your code.\n\n I have create an issue on Kylin's jira, and have described the bug/feature there in detail\n Commit messages in my PR start with the related jira ID, like \"KYLIN-0000 Make Kylin project open-source\"\n Compiling and unit tests pass locally with my changes\n I have added tests that prove my fix is effective or that my feature works\n If this change need a document change, I will prepare another pr against the document branch\n Any dependent changes have been merged\n\nFurther comments\nIf this is a relatively large or complex change, kick off the discussion at user@kylin or dev@kylin by explaining why you chose the solution you did and what alternatives you considered, etc...", "createdAt": "2020-04-22T13:49:02Z", "url": "https://github.com/apache/kylin/pull/1182", "merged": true, "mergeCommit": {"oid": "50c374be7d02ab3e29b24cf7b16b0d1b6047d9b7"}, "closed": true, "closedAt": "2020-05-05T17:35:22Z", "author": {"login": "hit-lacus"}, "timelineItems": {"totalCount": 17, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcbTfZwAH2gAyNDA3MzAzNTU5OmE5YTcwM2Y5OTU0MTA2MTk2NjRhNjAzMTBjYTg4ZTUyMjcyYzM0Njc=", "endCursor": "Y3Vyc29yOnYyOpPPAAABceXLa3AH2gAyNDA3MzAzNTU5OjQxZWI0Zjk5MmJjMTM4ZWI5MGJlYmIzZWJlNTM3YTM3M2U3MzAwYjk=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "a9a703f995410619664a60310ca88e52272c3467", "author": {"user": {"login": "TempleZhou", "name": null}}, "url": "https://github.com/apache/kylin/commit/a9a703f995410619664a60310ca88e52272c3467", "committedDate": "2020-04-26T05:04:32Z", "message": "KYLIN-4181 Schedule Kylin using Kubernetes"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "949ac4d05284f4a97b2a851cdf0d80bbf20c2c78", "author": {"user": {"login": "sanjulian", "name": "Julian Pan"}}, "url": "https://github.com/apache/kylin/commit/949ac4d05284f4a97b2a851cdf0d80bbf20c2c78", "committedDate": "2020-04-26T05:07:29Z", "message": "KYLIN-4447 Kylin on kubernetes in a production env"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "3e3086749a431b8d99e3bb096444a38ffb4c93eb", "author": {"user": {"login": "hit-lacus", "name": "Xiaoxiang Yu"}}, "url": "https://github.com/apache/kylin/commit/3e3086749a431b8d99e3bb096444a38ffb4c93eb", "committedDate": "2020-04-26T06:32:03Z", "message": "KYLIN-4447 Refactor and merge two related commits"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "7af072a13845b4b4339a107fbfd6c8d0ec86e3f8", "author": {"user": {"login": "hit-lacus", "name": "Xiaoxiang Yu"}}, "url": "https://github.com/apache/kylin/commit/7af072a13845b4b4339a107fbfd6c8d0ec86e3f8", "committedDate": "2020-04-22T13:46:20Z", "message": "KYLIN-4446 Kylin on kubernetes in quick-start and production env"}, "afterCommit": {"oid": "d2f6b713b13fde48840f254aff1f8b4524c1c8bb", "author": {"user": {"login": "hit-lacus", "name": "Xiaoxiang Yu"}}, "url": "https://github.com/apache/kylin/commit/d2f6b713b13fde48840f254aff1f8b4524c1c8bb", "committedDate": "2020-04-26T12:05:26Z", "message": "KYLIN-4447 Upload a complete example for CDH5.7 env(2 job + 2 query)"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "d2f6b713b13fde48840f254aff1f8b4524c1c8bb", "author": {"user": {"login": "hit-lacus", "name": "Xiaoxiang Yu"}}, "url": "https://github.com/apache/kylin/commit/d2f6b713b13fde48840f254aff1f8b4524c1c8bb", "committedDate": "2020-04-26T12:05:26Z", "message": "KYLIN-4447 Upload a complete example for CDH5.7 env(2 job + 2 query)"}, "afterCommit": {"oid": "8ee919facb6dbac8cebd813cfdd08fe94fdcb617", "author": {"user": {"login": "hit-lacus", "name": "Xiaoxiang Yu"}}, "url": "https://github.com/apache/kylin/commit/8ee919facb6dbac8cebd813cfdd08fe94fdcb617", "committedDate": "2020-04-26T12:35:40Z", "message": "KYLIN-4447 Upload a complete example for CDH5.7 env(2 job + 2 query)"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "8ee919facb6dbac8cebd813cfdd08fe94fdcb617", "author": {"user": {"login": "hit-lacus", "name": "Xiaoxiang Yu"}}, "url": "https://github.com/apache/kylin/commit/8ee919facb6dbac8cebd813cfdd08fe94fdcb617", "committedDate": "2020-04-26T12:35:40Z", "message": "KYLIN-4447 Upload a complete example for CDH5.7 env(2 job + 2 query)"}, "afterCommit": {"oid": "4e053b77dbbfef32df032805227ecfea0b57af50", "author": {"user": {"login": "hit-lacus", "name": "Xiaoxiang Yu"}}, "url": "https://github.com/apache/kylin/commit/4e053b77dbbfef32df032805227ecfea0b57af50", "committedDate": "2020-04-26T13:04:57Z", "message": "KYLIN-4447 Upload a complete example for CDH5.7 env(2 job + 2 query)"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "4e053b77dbbfef32df032805227ecfea0b57af50", "author": {"user": {"login": "hit-lacus", "name": "Xiaoxiang Yu"}}, "url": "https://github.com/apache/kylin/commit/4e053b77dbbfef32df032805227ecfea0b57af50", "committedDate": "2020-04-26T13:04:57Z", "message": "KYLIN-4447 Upload a complete example for CDH5.7 env(2 job + 2 query)"}, "afterCommit": {"oid": "f34497551d71968d62c161323cd338902dd07203", "author": {"user": {"login": "hit-lacus", "name": "Xiaoxiang Yu"}}, "url": "https://github.com/apache/kylin/commit/f34497551d71968d62c161323cd338902dd07203", "committedDate": "2020-04-26T13:10:22Z", "message": "KYLIN-4447 Upload a complete example for CDH5.7 env(2 job + 2 query)"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "f34497551d71968d62c161323cd338902dd07203", "author": {"user": {"login": "hit-lacus", "name": "Xiaoxiang Yu"}}, "url": "https://github.com/apache/kylin/commit/f34497551d71968d62c161323cd338902dd07203", "committedDate": "2020-04-26T13:10:22Z", "message": "KYLIN-4447 Upload a complete example for CDH5.7 env(2 job + 2 query)"}, "afterCommit": {"oid": "005ad7f228fff4124505986aa44fe33d5ca0ad60", "author": {"user": {"login": "hit-lacus", "name": "Xiaoxiang Yu"}}, "url": "https://github.com/apache/kylin/commit/005ad7f228fff4124505986aa44fe33d5ca0ad60", "committedDate": "2020-04-27T07:52:04Z", "message": "KYLIN-4447 Upload a complete example for CDH5.7 env(2 job + 2 query)"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "005ad7f228fff4124505986aa44fe33d5ca0ad60", "author": {"user": {"login": "hit-lacus", "name": "Xiaoxiang Yu"}}, "url": "https://github.com/apache/kylin/commit/005ad7f228fff4124505986aa44fe33d5ca0ad60", "committedDate": "2020-04-27T07:52:04Z", "message": "KYLIN-4447 Upload a complete example for CDH5.7 env(2 job + 2 query)"}, "afterCommit": {"oid": "7d5aedf323b4c3ccc9fa98bd8818fb7ca6487a81", "author": {"user": {"login": "hit-lacus", "name": "Xiaoxiang Yu"}}, "url": "https://github.com/apache/kylin/commit/7d5aedf323b4c3ccc9fa98bd8818fb7ca6487a81", "committedDate": "2020-04-27T10:05:19Z", "message": "KYLIN-4447 Upload a complete example for CDH5.7 env(2 job + 2 query)"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "7d5aedf323b4c3ccc9fa98bd8818fb7ca6487a81", "author": {"user": {"login": "hit-lacus", "name": "Xiaoxiang Yu"}}, "url": "https://github.com/apache/kylin/commit/7d5aedf323b4c3ccc9fa98bd8818fb7ca6487a81", "committedDate": "2020-04-27T10:05:19Z", "message": "KYLIN-4447 Upload a complete example for CDH5.7 env(2 job + 2 query)"}, "afterCommit": {"oid": "1a2c06c26c8894ae2ee7b1b72781780fb45d30b0", "author": {"user": {"login": "hit-lacus", "name": "Xiaoxiang Yu"}}, "url": "https://github.com/apache/kylin/commit/1a2c06c26c8894ae2ee7b1b72781780fb45d30b0", "committedDate": "2020-04-27T10:38:17Z", "message": "KYLIN-4447 Upload a complete example for CDH5.7 env(2 job + 2 query)"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "1a2c06c26c8894ae2ee7b1b72781780fb45d30b0", "author": {"user": {"login": "hit-lacus", "name": "Xiaoxiang Yu"}}, "url": "https://github.com/apache/kylin/commit/1a2c06c26c8894ae2ee7b1b72781780fb45d30b0", "committedDate": "2020-04-27T10:38:17Z", "message": "KYLIN-4447 Upload a complete example for CDH5.7 env(2 job + 2 query)"}, "afterCommit": {"oid": "6b649604cb7b50c17c3da50961ac8d708241f48e", "author": {"user": {"login": "hit-lacus", "name": "Xiaoxiang Yu"}}, "url": "https://github.com/apache/kylin/commit/6b649604cb7b50c17c3da50961ac8d708241f48e", "committedDate": "2020-04-27T13:02:05Z", "message": "KYLIN-4447 Upload a complete example for CDH5.7 env(2 job + 2 query)"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "6b649604cb7b50c17c3da50961ac8d708241f48e", "author": {"user": {"login": "hit-lacus", "name": "Xiaoxiang Yu"}}, "url": "https://github.com/apache/kylin/commit/6b649604cb7b50c17c3da50961ac8d708241f48e", "committedDate": "2020-04-27T13:02:05Z", "message": "KYLIN-4447 Upload a complete example for CDH5.7 env(2 job + 2 query)"}, "afterCommit": {"oid": "977c93ebeec003bc2bfa0d4d643c0a9219e2531a", "author": {"user": {"login": "hit-lacus", "name": "Xiaoxiang Yu"}}, "url": "https://github.com/apache/kylin/commit/977c93ebeec003bc2bfa0d4d643c0a9219e2531a", "committedDate": "2020-04-28T02:37:05Z", "message": "KYLIN-4447 Upload a complete example for CDH5.7 env(2 job + 2 query)"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDAzMTkzOTQ1", "url": "https://github.com/apache/kylin/pull/1182#pullrequestreview-403193945", "createdAt": "2020-04-30T04:35:05Z", "commit": {"oid": "977c93ebeec003bc2bfa0d4d643c0a9219e2531a"}, "state": "COMMENTED", "comments": {"totalCount": 6, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0zMFQwNDozNTowNVrOGOZUGQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wMVQwMzoxNTowNlrOGPBBGg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNzc0Nzk5Mw==", "bodyText": "I suppose we should remove the hadoop config. There are hadoop config for configmap in development files.", "url": "https://github.com/apache/kylin/pull/1182#discussion_r417747993", "createdAt": "2020-04-30T04:35:05Z", "author": {"login": "sanjulian"}, "path": "kubernetes/docker/hadoop-client/apache-hadoop2.7/Dockerfile", "diffHunk": "@@ -0,0 +1,85 @@\n+#\n+# Licensed to the Apache Software Foundation (ASF) under one or more\n+# contributor license agreements.  See the NOTICE file distributed with\n+# this work for additional information regarding copyright ownership.\n+# The ASF licenses this file to You under the Apache License, Version 2.0\n+# (the \"License\"); you may not use this file except in compliance with\n+# the License.  You may obtain a copy of the License at\n+#\n+#    http://www.apache.org/licenses/LICENSE-2.0\n+#\n+# Unless required by applicable law or agreed to in writing, software\n+# distributed under the License is distributed on an \"AS IS\" BASIS,\n+# WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+# See the License for the specific language governing permissions and\n+# limitations under the License.\n+#\n+\n+FROM centos:7.3.1611\n+\n+MAINTAINER Apache Kylin\n+\n+WORKDIR /tmp\n+\n+# install jdk and other commands\n+RUN set -x \\\n+    && yum install -y which \\\n+       java-1.8.0-openjdk \\\n+       java-1.8.0-openjdk-devel \\\n+       krb5-workstation \\\n+    && yum clean all\n+\n+\n+# version variables\n+ARG HADOOP_VERSION=2.7.4\n+ARG HIVE_VERSION=1.2.2\n+ARG HBASE_VERSION=1.3.1\n+ARG SPARK_VERSION=2.2.1\n+ARG ZK_VERSION=3.4.6\n+\n+ARG APACHE_HOME=/apache\n+\n+RUN set -x \\\n+    && mkdir -p $APACHE_HOME\n+\n+ENV JAVA_HOME /etc/alternatives/jre\n+\n+# install hadoop\n+ENV HADOOP_HOME=$APACHE_HOME/hadoop\n+ADD hdp-clients/hadoop-${HADOOP_VERSION}.tar.gz $APACHE_HOME\n+RUN set -x \\\n+    && ln -s $APACHE_HOME/hadoop-${HADOOP_VERSION} $HADOOP_HOME\n+\n+#install hive\n+ENV HIVE_HOME=$APACHE_HOME/hive \n+ADD hdp-clients/apache-hive-${HIVE_VERSION}.tar.gz $APACHE_HOME\n+RUN set -x \\\n+    && ln -s $APACHE_HOME/apache-hive-${HIVE_VERSION} $HIVE_HOME\n+\n+#install hbase\n+ENV HBASE_HOME=$APACHE_HOME/hbase\n+ADD hdp-clients/hbase-${HBASE_VERSION}.tar.gz $APACHE_HOME\n+RUN set -x \\\n+    && ln -s $APACHE_HOME/hbase-${HBASE_VERSION} $HBASE_HOME\n+\n+#install spark\n+ENV SPARK_HOME=$APACHE_HOME/spark\n+ADD hdp-clients/spark-${SPARK_VERSION}.tar.gz $APACHE_HOME\n+RUN set -x \\\n+    && ln -s $APACHE_HOME/spark-${SPARK_VERSION} $SPARK_HOME\n+\n+#install zk\n+ENV ZK_HOME=$APACHE_HOME/zookeeper\n+ADD hdp-clients/zookeeper-${ZK_VERSION}.tar.gz $APACHE_HOME\n+RUN set -x \\\n+    && ln -s $APACHE_HOME/zookeeper-${ZK_VERSION} $ZK_HOME\n+\n+ENV PATH=$PATH:$JAVA_HOME/bin:$HADOOP_HOME/bin:$HADOOP_HOME/sbin:$HIVE_HOME/bin:$HBASE_HOME/bin:$ZK_HOME/bin\n+\n+COPY conf/hadoop $HADOOP_HOME/etc/hadoop", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "977c93ebeec003bc2bfa0d4d643c0a9219e2531a"}, "originalPosition": 79}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNzc0ODQ3NA==", "bodyText": "Could we add the some build step for apache hadoop client?\nSuch as download hadoop client first, and update version in dockerfile.", "url": "https://github.com/apache/kylin/pull/1182#discussion_r417748474", "createdAt": "2020-04-30T04:37:03Z", "author": {"login": "sanjulian"}, "path": "kubernetes/docker/hadoop-client/README.md", "diffHunk": "@@ -0,0 +1,18 @@\n+## Background\n+### What is hadoop-client docker image and why we need this? \n+As we all know, the node you want to deploy Kylin, should has provided Hadoop \n+dependency(jars and configuration files), these dependency let you have access\n+ to Hadoop Service, such as HDFS, HBase, Hive, which are needed by Apache Kylin. \n+Unfortunately, each Hadoop distribution(CHD or HDP etc.) has its own specific jars. So, we \n+can provided specific image for specific Hadoop distribution, which will make image management task\n+more easier. This will have following two benefits:\n+1. Someone who has better knowledge on Hadoop can do this work, and let kylin \n+ user build their Kylin image base on provided Hadoop-Client image.\n+2. Upgrade Kylin will be much easier.\n+\n+### Build Step for CDH5.7\n+1. Place Spark binary(*spark-2.3.2-bin-hadoop2.7.tgz*) into dir `provided-binary`.\n+2. Run `build-image.sh` to build image.\n+\n+> If you are using other hadoop distribution, please consider build image yourself.\n+", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "977c93ebeec003bc2bfa0d4d643c0a9219e2531a"}, "originalPosition": 18}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNzc1NzM2MA==", "bodyText": "I suppose we do not need the services for job, since the job pod only for building cube instead of query.", "url": "https://github.com/apache/kylin/pull/1182#discussion_r417757360", "createdAt": "2020-04-30T05:13:22Z", "author": {"login": "sanjulian"}, "path": "kubernetes/example/deployment/kylin-job/kylin-job-service.yaml", "diffHunk": "@@ -0,0 +1,36 @@\n+#\n+# Licensed to the Apache Software Foundation (ASF) under one or more\n+# contributor license agreements.  See the NOTICE file distributed with\n+# this work for additional information regarding copyright ownership.\n+# The ASF licenses this file to You under the Apache License, Version 2.0\n+# (the \"License\"); you may not use this file except in compliance with\n+# the License.  You may obtain a copy of the License at\n+#\n+#    http://www.apache.org/licenses/LICENSE-2.0\n+#\n+# Unless required by applicable law or agreed to in writing, software\n+# distributed under the License is distributed on an \"AS IS\" BASIS,\n+# WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+# See the License for the specific language governing permissions and\n+# limitations under the License.\n+#\n+\n+apiVersion: v1\n+kind: Service\n+metadata:\n+  name: kylin-job-svc", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "977c93ebeec003bc2bfa0d4d643c0a9219e2531a"}, "originalPosition": 21}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxODM5NzMzNQ==", "bodyText": "Remove the copy before the init.\nPlease use subPath to mount configMap or secret files for tomcat and kylin configuration.\nHere is the reference: https://kubernetes.io/docs/concepts/storage/volumes/#using-subpath", "url": "https://github.com/apache/kylin/pull/1182#discussion_r418397335", "createdAt": "2020-05-01T03:08:48Z", "author": {"login": "sanjulian"}, "path": "kubernetes/example/deployment/kylin-query/kylin-query-statefulset.yaml", "diffHunk": "@@ -0,0 +1,143 @@\n+#\n+# Licensed to the Apache Software Foundation (ASF) under one or more\n+# contributor license agreements.  See the NOTICE file distributed with\n+# this work for additional information regarding copyright ownership.\n+# The ASF licenses this file to You under the Apache License, Version 2.0\n+# (the \"License\"); you may not use this file except in compliance with\n+# the License.  You may obtain a copy of the License at\n+#\n+#    http://www.apache.org/licenses/LICENSE-2.0\n+#\n+# Unless required by applicable law or agreed to in writing, software\n+# distributed under the License is distributed on an \"AS IS\" BASIS,\n+# WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+# See the License for the specific language governing permissions and\n+# limitations under the License.\n+#\n+\n+apiVersion: apps/v1\n+kind: StatefulSet\n+metadata:\n+  name: kylin-query\n+  namespace: kylin-example\n+  labels:\n+    app: kylin\n+    role: query\n+    environment: poc\n+    version: 3.0.1\n+    hadoop.version: cdh5.7\n+spec:\n+  serviceName: kylin-query-svc\n+  replicas: 1\n+  selector:\n+    matchLabels:\n+      app: kylin\n+      role: query\n+  template:\n+    metadata:\n+      labels:\n+        app: kylin\n+        role: query\n+    spec:\n+      hostAliases:\n+        - ip: \"10.1.3.90\"\n+          hostnames:\n+            - \"cdh-master\"\n+        - ip: \"10.1.3.93\"\n+          hostnames:\n+            - \"cdh-worker-1\"\n+        - ip: \"10.1.3.94\"\n+          hostnames:\n+            - \"cdh-worker-2\"\n+        - ip: \"10.1.3.91\"\n+          hostnames:\n+            - \"cdh-client\"\n+      containers:\n+      - name: kylin\n+        image: kylin-client:3.0.1-cdh57\n+        imagePullPolicy: IfNotPresent\n+        command:\n+        - sh\n+        - -c\n+        args:\n+        - cp $KYLIN_HOME/tomcat-config/* $KYLIN_HOME/tomcat/conf;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "977c93ebeec003bc2bfa0d4d643c0a9219e2531a"}, "originalPosition": 63}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxODM5NzcxNA==", "bodyText": "The hadoop configmap is not used. Should we delete them or add the volume mount for hdp configuration?", "url": "https://github.com/apache/kylin/pull/1182#discussion_r418397714", "createdAt": "2020-05-01T03:10:27Z", "author": {"login": "sanjulian"}, "path": "kubernetes/example/deployment/kylin-query/kylin-query-statefulset.yaml", "diffHunk": "@@ -0,0 +1,143 @@\n+#\n+# Licensed to the Apache Software Foundation (ASF) under one or more\n+# contributor license agreements.  See the NOTICE file distributed with\n+# this work for additional information regarding copyright ownership.\n+# The ASF licenses this file to You under the Apache License, Version 2.0\n+# (the \"License\"); you may not use this file except in compliance with\n+# the License.  You may obtain a copy of the License at\n+#\n+#    http://www.apache.org/licenses/LICENSE-2.0\n+#\n+# Unless required by applicable law or agreed to in writing, software\n+# distributed under the License is distributed on an \"AS IS\" BASIS,\n+# WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+# See the License for the specific language governing permissions and\n+# limitations under the License.\n+#\n+\n+apiVersion: apps/v1\n+kind: StatefulSet\n+metadata:\n+  name: kylin-query\n+  namespace: kylin-example\n+  labels:\n+    app: kylin\n+    role: query\n+    environment: poc\n+    version: 3.0.1\n+    hadoop.version: cdh5.7\n+spec:\n+  serviceName: kylin-query-svc\n+  replicas: 1\n+  selector:\n+    matchLabels:\n+      app: kylin\n+      role: query\n+  template:\n+    metadata:\n+      labels:\n+        app: kylin\n+        role: query\n+    spec:\n+      hostAliases:\n+        - ip: \"10.1.3.90\"\n+          hostnames:\n+            - \"cdh-master\"\n+        - ip: \"10.1.3.93\"\n+          hostnames:\n+            - \"cdh-worker-1\"\n+        - ip: \"10.1.3.94\"\n+          hostnames:\n+            - \"cdh-worker-2\"\n+        - ip: \"10.1.3.91\"\n+          hostnames:\n+            - \"cdh-client\"\n+      containers:\n+      - name: kylin\n+        image: kylin-client:3.0.1-cdh57\n+        imagePullPolicy: IfNotPresent\n+        command:\n+        - sh\n+        - -c\n+        args:\n+        - cp $KYLIN_HOME/tomcat-config/* $KYLIN_HOME/tomcat/conf;\n+          cp $KYLIN_HOME/kylin-more-config $KYLIN_HOME/tomcat/webapps/kylin/WEB-INF/classes/;\n+          $TOOL_HOME/bootstrap.sh server -d;\n+        ports:\n+        - containerPort: 7070\n+        - containerPort: 7443\n+        volumeMounts:\n+          - name: kylin-query-config\n+            mountPath: /home/apache_kylin/kylin/conf\n+          - name: tomcat-config\n+            mountPath: /home/apache_kylin/kylin/tomcat-config\n+          - name: kylin-more-config\n+            mountPath: /home/apache_kylin/kylin/kylin-more-config/\n+          - name: hadoop-config\n+            mountPath: /etc/hadoop/conf\n+          - name: hive-config\n+            mountPath: /etc/hive/conf\n+          - name: hbase-config\n+            mountPath: /etc/hbase/conf\n+          - name: kylin-logs\n+            mountPath: /home/apache_kylin/kylin/logs\n+          - name: tomcat-logs\n+            mountPath: /home/apache_kylin/kylin/tomcat/logs\n+        resources:\n+          requests:\n+            memory: 2Gi\n+            cpu: 700m\n+          limits:\n+            memory: 2Gi\n+            cpu: 700m\n+      - name: filebeat\n+        image: docker.elastic.co/beats/filebeat:6.4.3\n+        args:\n+        - -c\n+        - /usr/share/filebeat/config/filebeat.yml\n+        - -e\n+        volumeMounts:\n+        - name: kylin-logs\n+          mountPath: /home/apache_kylin/kylin/logs\n+        - name: tomcat-logs\n+          mountPath: /home/apache_kylin/kylin/tomcat/logs\n+        - name: filebeat-config\n+          mountPath: /usr/share/filebeat/config\n+          readOnly: true\n+        resources:\n+          requests:\n+            memory: 1Gi\n+            cpu: 300m\n+          limits:\n+            memory: 1Gi\n+            cpu: 300m\n+      volumes:\n+      - name: kylin-logs\n+        emptyDir:\n+          sizeLimit: 3Gi\n+      - name: tomcat-logs\n+        emptyDir:\n+          sizeLimit: 2Gi\n+      - configMap:", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "977c93ebeec003bc2bfa0d4d643c0a9219e2531a"}, "originalPosition": 121}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxODM5ODQ5MA==", "bodyText": "As I know, there are some secret files in kylin.properties, such as kylin.job.notification-mail-password, kylin.security.ldap.connection-password... Could we change the kylin-***-config as secrets instead of configMap?", "url": "https://github.com/apache/kylin/pull/1182#discussion_r418398490", "createdAt": "2020-05-01T03:15:06Z", "author": {"login": "sanjulian"}, "path": "kubernetes/example/deployment/kylin-query/kylin-query-statefulset.yaml", "diffHunk": "@@ -0,0 +1,143 @@\n+#\n+# Licensed to the Apache Software Foundation (ASF) under one or more\n+# contributor license agreements.  See the NOTICE file distributed with\n+# this work for additional information regarding copyright ownership.\n+# The ASF licenses this file to You under the Apache License, Version 2.0\n+# (the \"License\"); you may not use this file except in compliance with\n+# the License.  You may obtain a copy of the License at\n+#\n+#    http://www.apache.org/licenses/LICENSE-2.0\n+#\n+# Unless required by applicable law or agreed to in writing, software\n+# distributed under the License is distributed on an \"AS IS\" BASIS,\n+# WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+# See the License for the specific language governing permissions and\n+# limitations under the License.\n+#\n+\n+apiVersion: apps/v1\n+kind: StatefulSet\n+metadata:\n+  name: kylin-query\n+  namespace: kylin-example\n+  labels:\n+    app: kylin\n+    role: query\n+    environment: poc\n+    version: 3.0.1\n+    hadoop.version: cdh5.7\n+spec:\n+  serviceName: kylin-query-svc\n+  replicas: 1\n+  selector:\n+    matchLabels:\n+      app: kylin\n+      role: query\n+  template:\n+    metadata:\n+      labels:\n+        app: kylin\n+        role: query\n+    spec:\n+      hostAliases:\n+        - ip: \"10.1.3.90\"\n+          hostnames:\n+            - \"cdh-master\"\n+        - ip: \"10.1.3.93\"\n+          hostnames:\n+            - \"cdh-worker-1\"\n+        - ip: \"10.1.3.94\"\n+          hostnames:\n+            - \"cdh-worker-2\"\n+        - ip: \"10.1.3.91\"\n+          hostnames:\n+            - \"cdh-client\"\n+      containers:\n+      - name: kylin\n+        image: kylin-client:3.0.1-cdh57\n+        imagePullPolicy: IfNotPresent\n+        command:\n+        - sh\n+        - -c\n+        args:\n+        - cp $KYLIN_HOME/tomcat-config/* $KYLIN_HOME/tomcat/conf;\n+          cp $KYLIN_HOME/kylin-more-config $KYLIN_HOME/tomcat/webapps/kylin/WEB-INF/classes/;\n+          $TOOL_HOME/bootstrap.sh server -d;\n+        ports:\n+        - containerPort: 7070\n+        - containerPort: 7443\n+        volumeMounts:\n+          - name: kylin-query-config\n+            mountPath: /home/apache_kylin/kylin/conf\n+          - name: tomcat-config\n+            mountPath: /home/apache_kylin/kylin/tomcat-config\n+          - name: kylin-more-config\n+            mountPath: /home/apache_kylin/kylin/kylin-more-config/\n+          - name: hadoop-config\n+            mountPath: /etc/hadoop/conf\n+          - name: hive-config\n+            mountPath: /etc/hive/conf\n+          - name: hbase-config\n+            mountPath: /etc/hbase/conf\n+          - name: kylin-logs\n+            mountPath: /home/apache_kylin/kylin/logs\n+          - name: tomcat-logs\n+            mountPath: /home/apache_kylin/kylin/tomcat/logs\n+        resources:\n+          requests:\n+            memory: 2Gi\n+            cpu: 700m\n+          limits:\n+            memory: 2Gi\n+            cpu: 700m\n+      - name: filebeat\n+        image: docker.elastic.co/beats/filebeat:6.4.3\n+        args:\n+        - -c\n+        - /usr/share/filebeat/config/filebeat.yml\n+        - -e\n+        volumeMounts:\n+        - name: kylin-logs\n+          mountPath: /home/apache_kylin/kylin/logs\n+        - name: tomcat-logs\n+          mountPath: /home/apache_kylin/kylin/tomcat/logs\n+        - name: filebeat-config\n+          mountPath: /usr/share/filebeat/config\n+          readOnly: true\n+        resources:\n+          requests:\n+            memory: 1Gi\n+            cpu: 300m\n+          limits:\n+            memory: 1Gi\n+            cpu: 300m\n+      volumes:\n+      - name: kylin-logs\n+        emptyDir:\n+          sizeLimit: 3Gi\n+      - name: tomcat-logs\n+        emptyDir:\n+          sizeLimit: 2Gi\n+      - configMap:\n+          name: hadoop-config\n+        name: hadoop-config\n+      - configMap:\n+          name: hive-config\n+        name: hive-config\n+      - configMap:\n+          name: hbase-config\n+        name: hbase-config\n+      - configMap:", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "977c93ebeec003bc2bfa0d4d643c0a9219e2531a"}, "originalPosition": 130}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "977c93ebeec003bc2bfa0d4d643c0a9219e2531a", "author": {"user": {"login": "hit-lacus", "name": "Xiaoxiang Yu"}}, "url": "https://github.com/apache/kylin/commit/977c93ebeec003bc2bfa0d4d643c0a9219e2531a", "committedDate": "2020-04-28T02:37:05Z", "message": "KYLIN-4447 Upload a complete example for CDH5.7 env(2 job + 2 query)"}, "afterCommit": {"oid": "4274aec8b2276221f30ad1a90785640c9a8f35cf", "author": {"user": {"login": "hit-lacus", "name": "Xiaoxiang Yu"}}, "url": "https://github.com/apache/kylin/commit/4274aec8b2276221f30ad1a90785640c9a8f35cf", "committedDate": "2020-05-05T16:30:59Z", "message": "KYLIN-4447 Upload a complete example for CDH5.7 env(2 job + 2 query)"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "4274aec8b2276221f30ad1a90785640c9a8f35cf", "author": {"user": {"login": "hit-lacus", "name": "Xiaoxiang Yu"}}, "url": "https://github.com/apache/kylin/commit/4274aec8b2276221f30ad1a90785640c9a8f35cf", "committedDate": "2020-05-05T16:30:59Z", "message": "KYLIN-4447 Upload a complete example for CDH5.7 env(2 job + 2 query)"}, "afterCommit": {"oid": "17cd40dc7d3b15e19dbf1eb682543b769a7d2061", "author": {"user": {"login": "hit-lacus", "name": "Xiaoxiang Yu"}}, "url": "https://github.com/apache/kylin/commit/17cd40dc7d3b15e19dbf1eb682543b769a7d2061", "committedDate": "2020-05-05T16:35:52Z", "message": "KYLIN-4447 Upload a complete example for CDH5.7 env(2 job + 2 query)"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "17cd40dc7d3b15e19dbf1eb682543b769a7d2061", "author": {"user": {"login": "hit-lacus", "name": "Xiaoxiang Yu"}}, "url": "https://github.com/apache/kylin/commit/17cd40dc7d3b15e19dbf1eb682543b769a7d2061", "committedDate": "2020-05-05T16:35:52Z", "message": "KYLIN-4447 Upload a complete example for CDH5.7 env(2 job + 2 query)"}, "afterCommit": {"oid": "41eb4f992bc138eb90bebb3ebe537a373e7300b9", "author": {"user": {"login": "hit-lacus", "name": "Xiaoxiang Yu"}}, "url": "https://github.com/apache/kylin/commit/41eb4f992bc138eb90bebb3ebe537a373e7300b9", "committedDate": "2020-05-05T17:04:06Z", "message": "KYLIN-4447 Upload a complete example for CDH5.7 env(2 job + 2 query)"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "41eb4f992bc138eb90bebb3ebe537a373e7300b9", "author": {"user": {"login": "hit-lacus", "name": "Xiaoxiang Yu"}}, "url": "https://github.com/apache/kylin/commit/41eb4f992bc138eb90bebb3ebe537a373e7300b9", "committedDate": "2020-05-05T17:04:06Z", "message": "KYLIN-4447 Upload a complete example for CDH5.7 env(2 job + 2 query)"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2882, "cost": 1, "resetAt": "2021-10-29T19:57:52Z"}}}