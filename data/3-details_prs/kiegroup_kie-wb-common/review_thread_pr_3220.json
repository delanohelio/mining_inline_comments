{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0Mzg5MjgzNTI3", "number": 3220, "reviewThreads": {"totalCount": 6, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xOVQwOToxMzoxNFrODpbKHA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xOVQxOTo0NTo0NFrODppz_g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjQ0NzYzMTY0OnYy", "diffSide": "RIGHT", "path": "kie-wb-common-dmn/kie-wb-common-dmn-client/src/main/java/org/kie/workbench/common/dmn/client/editors/expressions/types/list/ListEditorDefinition.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xOVQwOToxMzoxNFrOF4lvYw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xOVQxNToyMzoyMVrOF4zmjA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NDg4MjkxNQ==", "bodyText": "Question, can we use some private static final new List()? In other words, is result of this used juts to determine what UI is shown or is it use in runtime, accessing, changing its vales.", "url": "https://github.com/kiegroup/kie-wb-common/pull/3220#discussion_r394882915", "createdAt": "2020-03-19T09:13:14Z", "author": {"login": "jomarko"}, "path": "kie-wb-common-dmn/kie-wb-common-dmn-client/src/main/java/org/kie/workbench/common/dmn/client/editors/expressions/types/list/ListEditorDefinition.java", "diffHunk": "@@ -0,0 +1,152 @@\n+/*\n+ * Copyright 2020 Red Hat, Inc. and/or its affiliates.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+package org.kie.workbench.common.dmn.client.editors.expressions.types.list;\n+\n+import java.util.Optional;\n+import java.util.function.Supplier;\n+\n+import javax.enterprise.context.ApplicationScoped;\n+import javax.enterprise.event.Event;\n+import javax.inject.Inject;\n+\n+import org.jboss.errai.ui.client.local.spi.TranslationService;\n+import org.kie.workbench.common.dmn.api.definition.HasExpression;\n+import org.kie.workbench.common.dmn.api.definition.HasName;\n+import org.kie.workbench.common.dmn.api.definition.model.Expression;\n+import org.kie.workbench.common.dmn.api.definition.model.List;\n+import org.kie.workbench.common.dmn.api.definition.model.LiteralExpression;\n+import org.kie.workbench.common.dmn.api.qualifiers.DMNEditor;\n+import org.kie.workbench.common.dmn.client.commands.factory.DefaultCanvasCommandFactory;\n+import org.kie.workbench.common.dmn.client.editors.expressions.types.BaseEditorDefinition;\n+import org.kie.workbench.common.dmn.client.editors.expressions.types.ExpressionEditorDefinitions;\n+import org.kie.workbench.common.dmn.client.editors.expressions.types.ExpressionType;\n+import org.kie.workbench.common.dmn.client.editors.types.ValueAndDataTypePopoverView;\n+import org.kie.workbench.common.dmn.client.resources.i18n.DMNEditorConstants;\n+import org.kie.workbench.common.dmn.client.widgets.grid.BaseExpressionGrid;\n+import org.kie.workbench.common.dmn.client.widgets.grid.controls.list.ListSelectorView;\n+import org.kie.workbench.common.dmn.client.widgets.grid.model.BaseUIModelMapper;\n+import org.kie.workbench.common.dmn.client.widgets.grid.model.DMNGridData;\n+import org.kie.workbench.common.dmn.client.widgets.grid.model.ExpressionEditorChanged;\n+import org.kie.workbench.common.dmn.client.widgets.grid.model.GridCellTuple;\n+import org.kie.workbench.common.stunner.core.client.api.SessionManager;\n+import org.kie.workbench.common.stunner.core.client.canvas.AbstractCanvasHandler;\n+import org.kie.workbench.common.stunner.core.client.canvas.event.selection.DomainObjectSelectionEvent;\n+import org.kie.workbench.common.stunner.core.client.command.SessionCommandManager;\n+import org.kie.workbench.common.stunner.core.util.DefinitionUtils;\n+import org.kie.workbench.common.stunner.forms.client.event.RefreshFormPropertiesEvent;\n+import org.uberfire.ext.wires.core.grids.client.model.GridData;\n+\n+@ApplicationScoped\n+public class ListEditorDefinition extends BaseEditorDefinition<List, ListGridData> {\n+\n+    private Supplier<ExpressionEditorDefinitions> expressionEditorDefinitionsSupplier;\n+    private ValueAndDataTypePopoverView.Presenter headerEditor;\n+\n+    public ListEditorDefinition() {\n+        //CDI proxy\n+    }\n+\n+    @Inject\n+    public ListEditorDefinition(final DefinitionUtils definitionUtils,\n+                                final SessionManager sessionManager,\n+                                final SessionCommandManager<AbstractCanvasHandler> sessionCommandManager,\n+                                final @DMNEditor DefaultCanvasCommandFactory canvasCommandFactory,\n+                                final Event<ExpressionEditorChanged> editorSelectedEvent,\n+                                final Event<RefreshFormPropertiesEvent> refreshFormPropertiesEvent,\n+                                final Event<DomainObjectSelectionEvent> domainObjectSelectionEvent,\n+                                final ListSelectorView.Presenter listSelector,\n+                                final TranslationService translationService,\n+                                final @DMNEditor Supplier<ExpressionEditorDefinitions> expressionEditorDefinitionsSupplier,\n+                                final ValueAndDataTypePopoverView.Presenter headerEditor) {\n+        super(definitionUtils,\n+              sessionManager,\n+              sessionCommandManager,\n+              canvasCommandFactory,\n+              editorSelectedEvent,\n+              refreshFormPropertiesEvent,\n+              domainObjectSelectionEvent,\n+              listSelector,\n+              translationService);\n+        this.expressionEditorDefinitionsSupplier = expressionEditorDefinitionsSupplier;\n+        this.headerEditor = headerEditor;\n+    }\n+\n+    @Override\n+    public ExpressionType getType() {\n+        return ExpressionType.LIST;\n+    }\n+\n+    @Override\n+    public String getName() {\n+        return translationService.format(DMNEditorConstants.ExpressionEditor_ListType);\n+    }\n+\n+    @Override\n+    public Optional<List> getModelClass() {\n+        return Optional.of(new List());", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "19205611aeb71a020ddcc44bbecc4dcc7a7ee2c7"}, "originalPosition": 99}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NTExMDAyOA==", "bodyText": "Good question... it is used as the expression instance behind the grid and hence needs to be a new instance each time... BUT the class is also used to lookup an editor for the expression instance. See ExpressionEditorDefinitions. I guess these two concerns should be separated and ExpressionEditorDefinition have two methods; one to return a Class used to lookup editors; and another to provide a new instance of an expression for editors.\nWDYT? Adding it to https://issues.redhat.com/browse/DROOLS-2974 would be best.\nIf you agree I can do the necessary admin.", "url": "https://github.com/kiegroup/kie-wb-common/pull/3220#discussion_r395110028", "createdAt": "2020-03-19T15:23:21Z", "author": {"login": "manstis"}, "path": "kie-wb-common-dmn/kie-wb-common-dmn-client/src/main/java/org/kie/workbench/common/dmn/client/editors/expressions/types/list/ListEditorDefinition.java", "diffHunk": "@@ -0,0 +1,152 @@\n+/*\n+ * Copyright 2020 Red Hat, Inc. and/or its affiliates.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+package org.kie.workbench.common.dmn.client.editors.expressions.types.list;\n+\n+import java.util.Optional;\n+import java.util.function.Supplier;\n+\n+import javax.enterprise.context.ApplicationScoped;\n+import javax.enterprise.event.Event;\n+import javax.inject.Inject;\n+\n+import org.jboss.errai.ui.client.local.spi.TranslationService;\n+import org.kie.workbench.common.dmn.api.definition.HasExpression;\n+import org.kie.workbench.common.dmn.api.definition.HasName;\n+import org.kie.workbench.common.dmn.api.definition.model.Expression;\n+import org.kie.workbench.common.dmn.api.definition.model.List;\n+import org.kie.workbench.common.dmn.api.definition.model.LiteralExpression;\n+import org.kie.workbench.common.dmn.api.qualifiers.DMNEditor;\n+import org.kie.workbench.common.dmn.client.commands.factory.DefaultCanvasCommandFactory;\n+import org.kie.workbench.common.dmn.client.editors.expressions.types.BaseEditorDefinition;\n+import org.kie.workbench.common.dmn.client.editors.expressions.types.ExpressionEditorDefinitions;\n+import org.kie.workbench.common.dmn.client.editors.expressions.types.ExpressionType;\n+import org.kie.workbench.common.dmn.client.editors.types.ValueAndDataTypePopoverView;\n+import org.kie.workbench.common.dmn.client.resources.i18n.DMNEditorConstants;\n+import org.kie.workbench.common.dmn.client.widgets.grid.BaseExpressionGrid;\n+import org.kie.workbench.common.dmn.client.widgets.grid.controls.list.ListSelectorView;\n+import org.kie.workbench.common.dmn.client.widgets.grid.model.BaseUIModelMapper;\n+import org.kie.workbench.common.dmn.client.widgets.grid.model.DMNGridData;\n+import org.kie.workbench.common.dmn.client.widgets.grid.model.ExpressionEditorChanged;\n+import org.kie.workbench.common.dmn.client.widgets.grid.model.GridCellTuple;\n+import org.kie.workbench.common.stunner.core.client.api.SessionManager;\n+import org.kie.workbench.common.stunner.core.client.canvas.AbstractCanvasHandler;\n+import org.kie.workbench.common.stunner.core.client.canvas.event.selection.DomainObjectSelectionEvent;\n+import org.kie.workbench.common.stunner.core.client.command.SessionCommandManager;\n+import org.kie.workbench.common.stunner.core.util.DefinitionUtils;\n+import org.kie.workbench.common.stunner.forms.client.event.RefreshFormPropertiesEvent;\n+import org.uberfire.ext.wires.core.grids.client.model.GridData;\n+\n+@ApplicationScoped\n+public class ListEditorDefinition extends BaseEditorDefinition<List, ListGridData> {\n+\n+    private Supplier<ExpressionEditorDefinitions> expressionEditorDefinitionsSupplier;\n+    private ValueAndDataTypePopoverView.Presenter headerEditor;\n+\n+    public ListEditorDefinition() {\n+        //CDI proxy\n+    }\n+\n+    @Inject\n+    public ListEditorDefinition(final DefinitionUtils definitionUtils,\n+                                final SessionManager sessionManager,\n+                                final SessionCommandManager<AbstractCanvasHandler> sessionCommandManager,\n+                                final @DMNEditor DefaultCanvasCommandFactory canvasCommandFactory,\n+                                final Event<ExpressionEditorChanged> editorSelectedEvent,\n+                                final Event<RefreshFormPropertiesEvent> refreshFormPropertiesEvent,\n+                                final Event<DomainObjectSelectionEvent> domainObjectSelectionEvent,\n+                                final ListSelectorView.Presenter listSelector,\n+                                final TranslationService translationService,\n+                                final @DMNEditor Supplier<ExpressionEditorDefinitions> expressionEditorDefinitionsSupplier,\n+                                final ValueAndDataTypePopoverView.Presenter headerEditor) {\n+        super(definitionUtils,\n+              sessionManager,\n+              sessionCommandManager,\n+              canvasCommandFactory,\n+              editorSelectedEvent,\n+              refreshFormPropertiesEvent,\n+              domainObjectSelectionEvent,\n+              listSelector,\n+              translationService);\n+        this.expressionEditorDefinitionsSupplier = expressionEditorDefinitionsSupplier;\n+        this.headerEditor = headerEditor;\n+    }\n+\n+    @Override\n+    public ExpressionType getType() {\n+        return ExpressionType.LIST;\n+    }\n+\n+    @Override\n+    public String getName() {\n+        return translationService.format(DMNEditorConstants.ExpressionEditor_ListType);\n+    }\n+\n+    @Override\n+    public Optional<List> getModelClass() {\n+        return Optional.of(new List());", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NDg4MjkxNQ=="}, "originalCommit": {"oid": "19205611aeb71a020ddcc44bbecc4dcc7a7ee2c7"}, "originalPosition": 99}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjQ0NzYzOTkyOnYy", "diffSide": "RIGHT", "path": "kie-wb-common-dmn/kie-wb-common-dmn-client/src/main/java/org/kie/workbench/common/dmn/client/editors/expressions/types/list/ListGrid.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xOVQwOToxNTozOFrOF4l0qA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xOVQxNTowMjowNFrOF4ymww==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NDg4NDI2NA==", "bodyText": "please remove comment", "url": "https://github.com/kiegroup/kie-wb-common/pull/3220#discussion_r394884264", "createdAt": "2020-03-19T09:15:38Z", "author": {"login": "jomarko"}, "path": "kie-wb-common-dmn/kie-wb-common-dmn-client/src/main/java/org/kie/workbench/common/dmn/client/editors/expressions/types/list/ListGrid.java", "diffHunk": "@@ -0,0 +1,337 @@\n+/*\n+ * Copyright 2020 Red Hat, Inc. and/or its affiliates.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+package org.kie.workbench.common.dmn.client.editors.expressions.types.list;\n+\n+import java.util.ArrayList;\n+import java.util.Optional;\n+import java.util.function.Supplier;\n+\n+import javax.enterprise.event.Event;\n+\n+import com.ait.lienzo.shared.core.types.EventPropagationMode;\n+import org.jboss.errai.ui.client.local.spi.TranslationService;\n+import org.kie.workbench.common.dmn.api.definition.HasExpression;\n+import org.kie.workbench.common.dmn.api.definition.HasName;\n+import org.kie.workbench.common.dmn.api.definition.model.DMNModelInstrumentedBase;\n+import org.kie.workbench.common.dmn.api.definition.model.Expression;\n+import org.kie.workbench.common.dmn.api.definition.model.List;\n+import org.kie.workbench.common.dmn.api.definition.model.LiteralExpression;\n+import org.kie.workbench.common.dmn.api.property.dmn.Name;\n+import org.kie.workbench.common.dmn.client.commands.expressions.types.list.AddListRowCommand;\n+import org.kie.workbench.common.dmn.client.commands.expressions.types.list.ClearExpressionTypeCommand;\n+import org.kie.workbench.common.dmn.client.commands.expressions.types.list.DeleteListRowCommand;\n+import org.kie.workbench.common.dmn.client.commands.factory.DefaultCanvasCommandFactory;\n+import org.kie.workbench.common.dmn.client.editors.expressions.types.ExpressionEditorDefinitions;\n+import org.kie.workbench.common.dmn.client.editors.expressions.types.context.ContextGridRowNumberColumn;\n+import org.kie.workbench.common.dmn.client.editors.expressions.types.context.ExpressionCellValue;\n+import org.kie.workbench.common.dmn.client.editors.expressions.types.context.ExpressionEditorColumn;\n+import org.kie.workbench.common.dmn.client.editors.expressions.types.undefined.UndefinedExpressionGrid;\n+import org.kie.workbench.common.dmn.client.editors.expressions.util.SelectionUtils;\n+import org.kie.workbench.common.dmn.client.editors.types.ValueAndDataTypePopoverView;\n+import org.kie.workbench.common.dmn.client.resources.i18n.DMNEditorConstants;\n+import org.kie.workbench.common.dmn.client.widgets.grid.BaseExpressionGrid;\n+import org.kie.workbench.common.dmn.client.widgets.grid.BaseExpressionGridRenderer;\n+import org.kie.workbench.common.dmn.client.widgets.grid.controls.container.CellEditorControlsView;\n+import org.kie.workbench.common.dmn.client.widgets.grid.controls.list.HasListSelectorControl;\n+import org.kie.workbench.common.dmn.client.widgets.grid.controls.list.ListSelectorView;\n+import org.kie.workbench.common.dmn.client.widgets.grid.model.ExpressionEditorChanged;\n+import org.kie.workbench.common.dmn.client.widgets.grid.model.ExpressionEditorGridRow;\n+import org.kie.workbench.common.dmn.client.widgets.grid.model.GridCellTuple;\n+import org.kie.workbench.common.dmn.client.widgets.layer.DMNGridLayer;\n+import org.kie.workbench.common.dmn.client.widgets.panel.DMNGridPanel;\n+import org.kie.workbench.common.stunner.core.client.api.SessionManager;\n+import org.kie.workbench.common.stunner.core.client.canvas.AbstractCanvasHandler;\n+import org.kie.workbench.common.stunner.core.client.canvas.event.selection.DomainObjectSelectionEvent;\n+import org.kie.workbench.common.stunner.core.client.command.SessionCommandManager;\n+import org.kie.workbench.common.stunner.core.domainobject.DomainObject;\n+import org.kie.workbench.common.stunner.core.util.DefinitionUtils;\n+import org.kie.workbench.common.stunner.forms.client.event.RefreshFormPropertiesEvent;\n+import org.uberfire.ext.wires.core.grids.client.model.GridCell;\n+import org.uberfire.ext.wires.core.grids.client.model.GridColumn;\n+import org.uberfire.ext.wires.core.grids.client.model.GridRow;\n+import org.uberfire.ext.wires.core.grids.client.model.impl.BaseHeaderMetaData;\n+\n+public class ListGrid extends BaseExpressionGrid<List, ListGridData, ListUIModelMapper> implements HasListSelectorControl {\n+\n+    private final ValueAndDataTypePopoverView.Presenter headerEditor;\n+\n+    private final Supplier<ExpressionEditorDefinitions> expressionEditorDefinitionsSupplier;\n+\n+    public ListGrid(final GridCellTuple parent,\n+                    final Optional<String> nodeUUID,\n+                    final HasExpression hasExpression,\n+                    final Optional<HasName> hasName,\n+                    final DMNGridPanel gridPanel,\n+                    final DMNGridLayer gridLayer,\n+                    final ListGridData gridData,\n+                    final DefinitionUtils definitionUtils,\n+                    final SessionManager sessionManager,\n+                    final SessionCommandManager<AbstractCanvasHandler> sessionCommandManager,\n+                    final DefaultCanvasCommandFactory canvasCommandFactory,\n+                    final Event<ExpressionEditorChanged> editorSelectedEvent,\n+                    final Event<RefreshFormPropertiesEvent> refreshFormPropertiesEvent,\n+                    final Event<DomainObjectSelectionEvent> domainObjectSelectionEvent,\n+                    final CellEditorControlsView.Presenter cellEditorControls,\n+                    final ListSelectorView.Presenter listSelector,\n+                    final TranslationService translationService,\n+                    final boolean isOnlyVisualChangeAllowed,\n+                    final int nesting,\n+                    final Supplier<ExpressionEditorDefinitions> expressionEditorDefinitionsSupplier,\n+                    final ValueAndDataTypePopoverView.Presenter headerEditor) {\n+        super(parent,\n+              nodeUUID,\n+              hasExpression,\n+              hasName,\n+              gridPanel,\n+              gridLayer,\n+              gridData,\n+              new BaseExpressionGridRenderer(gridData),\n+              definitionUtils,\n+              sessionManager,\n+              sessionCommandManager,\n+              canvasCommandFactory,\n+              editorSelectedEvent,\n+              refreshFormPropertiesEvent,\n+              domainObjectSelectionEvent,\n+              cellEditorControls,\n+              listSelector,\n+              translationService,\n+              isOnlyVisualChangeAllowed,\n+              nesting);\n+        this.expressionEditorDefinitionsSupplier = expressionEditorDefinitionsSupplier;\n+        this.headerEditor = headerEditor;\n+\n+        setEventPropagationMode(EventPropagationMode.NO_ANCESTORS);\n+\n+        super.doInitialisation();\n+    }\n+\n+    @Override\n+    protected void doInitialisation() {\n+        // Defer initialisation until after the constructor completes as\n+        // makeUiModelMapper needs expressionEditorDefinitionsSupplier to have been set\n+    }\n+\n+    @Override\n+    public ListUIModelMapper makeUiModelMapper() {\n+        return new ListUIModelMapper(this,\n+                                     this::getModel,/**/", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "19205611aeb71a020ddcc44bbecc4dcc7a7ee2c7"}, "originalPosition": 131}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NTA5MzY5OQ==", "bodyText": "Done.", "url": "https://github.com/kiegroup/kie-wb-common/pull/3220#discussion_r395093699", "createdAt": "2020-03-19T15:02:04Z", "author": {"login": "manstis"}, "path": "kie-wb-common-dmn/kie-wb-common-dmn-client/src/main/java/org/kie/workbench/common/dmn/client/editors/expressions/types/list/ListGrid.java", "diffHunk": "@@ -0,0 +1,337 @@\n+/*\n+ * Copyright 2020 Red Hat, Inc. and/or its affiliates.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+package org.kie.workbench.common.dmn.client.editors.expressions.types.list;\n+\n+import java.util.ArrayList;\n+import java.util.Optional;\n+import java.util.function.Supplier;\n+\n+import javax.enterprise.event.Event;\n+\n+import com.ait.lienzo.shared.core.types.EventPropagationMode;\n+import org.jboss.errai.ui.client.local.spi.TranslationService;\n+import org.kie.workbench.common.dmn.api.definition.HasExpression;\n+import org.kie.workbench.common.dmn.api.definition.HasName;\n+import org.kie.workbench.common.dmn.api.definition.model.DMNModelInstrumentedBase;\n+import org.kie.workbench.common.dmn.api.definition.model.Expression;\n+import org.kie.workbench.common.dmn.api.definition.model.List;\n+import org.kie.workbench.common.dmn.api.definition.model.LiteralExpression;\n+import org.kie.workbench.common.dmn.api.property.dmn.Name;\n+import org.kie.workbench.common.dmn.client.commands.expressions.types.list.AddListRowCommand;\n+import org.kie.workbench.common.dmn.client.commands.expressions.types.list.ClearExpressionTypeCommand;\n+import org.kie.workbench.common.dmn.client.commands.expressions.types.list.DeleteListRowCommand;\n+import org.kie.workbench.common.dmn.client.commands.factory.DefaultCanvasCommandFactory;\n+import org.kie.workbench.common.dmn.client.editors.expressions.types.ExpressionEditorDefinitions;\n+import org.kie.workbench.common.dmn.client.editors.expressions.types.context.ContextGridRowNumberColumn;\n+import org.kie.workbench.common.dmn.client.editors.expressions.types.context.ExpressionCellValue;\n+import org.kie.workbench.common.dmn.client.editors.expressions.types.context.ExpressionEditorColumn;\n+import org.kie.workbench.common.dmn.client.editors.expressions.types.undefined.UndefinedExpressionGrid;\n+import org.kie.workbench.common.dmn.client.editors.expressions.util.SelectionUtils;\n+import org.kie.workbench.common.dmn.client.editors.types.ValueAndDataTypePopoverView;\n+import org.kie.workbench.common.dmn.client.resources.i18n.DMNEditorConstants;\n+import org.kie.workbench.common.dmn.client.widgets.grid.BaseExpressionGrid;\n+import org.kie.workbench.common.dmn.client.widgets.grid.BaseExpressionGridRenderer;\n+import org.kie.workbench.common.dmn.client.widgets.grid.controls.container.CellEditorControlsView;\n+import org.kie.workbench.common.dmn.client.widgets.grid.controls.list.HasListSelectorControl;\n+import org.kie.workbench.common.dmn.client.widgets.grid.controls.list.ListSelectorView;\n+import org.kie.workbench.common.dmn.client.widgets.grid.model.ExpressionEditorChanged;\n+import org.kie.workbench.common.dmn.client.widgets.grid.model.ExpressionEditorGridRow;\n+import org.kie.workbench.common.dmn.client.widgets.grid.model.GridCellTuple;\n+import org.kie.workbench.common.dmn.client.widgets.layer.DMNGridLayer;\n+import org.kie.workbench.common.dmn.client.widgets.panel.DMNGridPanel;\n+import org.kie.workbench.common.stunner.core.client.api.SessionManager;\n+import org.kie.workbench.common.stunner.core.client.canvas.AbstractCanvasHandler;\n+import org.kie.workbench.common.stunner.core.client.canvas.event.selection.DomainObjectSelectionEvent;\n+import org.kie.workbench.common.stunner.core.client.command.SessionCommandManager;\n+import org.kie.workbench.common.stunner.core.domainobject.DomainObject;\n+import org.kie.workbench.common.stunner.core.util.DefinitionUtils;\n+import org.kie.workbench.common.stunner.forms.client.event.RefreshFormPropertiesEvent;\n+import org.uberfire.ext.wires.core.grids.client.model.GridCell;\n+import org.uberfire.ext.wires.core.grids.client.model.GridColumn;\n+import org.uberfire.ext.wires.core.grids.client.model.GridRow;\n+import org.uberfire.ext.wires.core.grids.client.model.impl.BaseHeaderMetaData;\n+\n+public class ListGrid extends BaseExpressionGrid<List, ListGridData, ListUIModelMapper> implements HasListSelectorControl {\n+\n+    private final ValueAndDataTypePopoverView.Presenter headerEditor;\n+\n+    private final Supplier<ExpressionEditorDefinitions> expressionEditorDefinitionsSupplier;\n+\n+    public ListGrid(final GridCellTuple parent,\n+                    final Optional<String> nodeUUID,\n+                    final HasExpression hasExpression,\n+                    final Optional<HasName> hasName,\n+                    final DMNGridPanel gridPanel,\n+                    final DMNGridLayer gridLayer,\n+                    final ListGridData gridData,\n+                    final DefinitionUtils definitionUtils,\n+                    final SessionManager sessionManager,\n+                    final SessionCommandManager<AbstractCanvasHandler> sessionCommandManager,\n+                    final DefaultCanvasCommandFactory canvasCommandFactory,\n+                    final Event<ExpressionEditorChanged> editorSelectedEvent,\n+                    final Event<RefreshFormPropertiesEvent> refreshFormPropertiesEvent,\n+                    final Event<DomainObjectSelectionEvent> domainObjectSelectionEvent,\n+                    final CellEditorControlsView.Presenter cellEditorControls,\n+                    final ListSelectorView.Presenter listSelector,\n+                    final TranslationService translationService,\n+                    final boolean isOnlyVisualChangeAllowed,\n+                    final int nesting,\n+                    final Supplier<ExpressionEditorDefinitions> expressionEditorDefinitionsSupplier,\n+                    final ValueAndDataTypePopoverView.Presenter headerEditor) {\n+        super(parent,\n+              nodeUUID,\n+              hasExpression,\n+              hasName,\n+              gridPanel,\n+              gridLayer,\n+              gridData,\n+              new BaseExpressionGridRenderer(gridData),\n+              definitionUtils,\n+              sessionManager,\n+              sessionCommandManager,\n+              canvasCommandFactory,\n+              editorSelectedEvent,\n+              refreshFormPropertiesEvent,\n+              domainObjectSelectionEvent,\n+              cellEditorControls,\n+              listSelector,\n+              translationService,\n+              isOnlyVisualChangeAllowed,\n+              nesting);\n+        this.expressionEditorDefinitionsSupplier = expressionEditorDefinitionsSupplier;\n+        this.headerEditor = headerEditor;\n+\n+        setEventPropagationMode(EventPropagationMode.NO_ANCESTORS);\n+\n+        super.doInitialisation();\n+    }\n+\n+    @Override\n+    protected void doInitialisation() {\n+        // Defer initialisation until after the constructor completes as\n+        // makeUiModelMapper needs expressionEditorDefinitionsSupplier to have been set\n+    }\n+\n+    @Override\n+    public ListUIModelMapper makeUiModelMapper() {\n+        return new ListUIModelMapper(this,\n+                                     this::getModel,/**/", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NDg4NDI2NA=="}, "originalCommit": {"oid": "19205611aeb71a020ddcc44bbecc4dcc7a7ee2c7"}, "originalPosition": 131}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjQ0Nzc2NTI2OnYy", "diffSide": "RIGHT", "path": "kie-wb-common-dmn/kie-wb-common-dmn-client/src/main/java/org/kie/workbench/common/dmn/client/editors/expressions/types/list/ListGrid.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xOVQwOTo1MTozNVrOF4nGAg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xOVQxNTowNToxMVrOF4ywGA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NDkwNTA5MA==", "bodyText": "In getItems we create also ListSelectorHeaderItem is this cast safe?", "url": "https://github.com/kiegroup/kie-wb-common/pull/3220#discussion_r394905090", "createdAt": "2020-03-19T09:51:35Z", "author": {"login": "jomarko"}, "path": "kie-wb-common-dmn/kie-wb-common-dmn-client/src/main/java/org/kie/workbench/common/dmn/client/editors/expressions/types/list/ListGrid.java", "diffHunk": "@@ -0,0 +1,337 @@\n+/*\n+ * Copyright 2020 Red Hat, Inc. and/or its affiliates.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+package org.kie.workbench.common.dmn.client.editors.expressions.types.list;\n+\n+import java.util.ArrayList;\n+import java.util.Optional;\n+import java.util.function.Supplier;\n+\n+import javax.enterprise.event.Event;\n+\n+import com.ait.lienzo.shared.core.types.EventPropagationMode;\n+import org.jboss.errai.ui.client.local.spi.TranslationService;\n+import org.kie.workbench.common.dmn.api.definition.HasExpression;\n+import org.kie.workbench.common.dmn.api.definition.HasName;\n+import org.kie.workbench.common.dmn.api.definition.model.DMNModelInstrumentedBase;\n+import org.kie.workbench.common.dmn.api.definition.model.Expression;\n+import org.kie.workbench.common.dmn.api.definition.model.List;\n+import org.kie.workbench.common.dmn.api.definition.model.LiteralExpression;\n+import org.kie.workbench.common.dmn.api.property.dmn.Name;\n+import org.kie.workbench.common.dmn.client.commands.expressions.types.list.AddListRowCommand;\n+import org.kie.workbench.common.dmn.client.commands.expressions.types.list.ClearExpressionTypeCommand;\n+import org.kie.workbench.common.dmn.client.commands.expressions.types.list.DeleteListRowCommand;\n+import org.kie.workbench.common.dmn.client.commands.factory.DefaultCanvasCommandFactory;\n+import org.kie.workbench.common.dmn.client.editors.expressions.types.ExpressionEditorDefinitions;\n+import org.kie.workbench.common.dmn.client.editors.expressions.types.context.ContextGridRowNumberColumn;\n+import org.kie.workbench.common.dmn.client.editors.expressions.types.context.ExpressionCellValue;\n+import org.kie.workbench.common.dmn.client.editors.expressions.types.context.ExpressionEditorColumn;\n+import org.kie.workbench.common.dmn.client.editors.expressions.types.undefined.UndefinedExpressionGrid;\n+import org.kie.workbench.common.dmn.client.editors.expressions.util.SelectionUtils;\n+import org.kie.workbench.common.dmn.client.editors.types.ValueAndDataTypePopoverView;\n+import org.kie.workbench.common.dmn.client.resources.i18n.DMNEditorConstants;\n+import org.kie.workbench.common.dmn.client.widgets.grid.BaseExpressionGrid;\n+import org.kie.workbench.common.dmn.client.widgets.grid.BaseExpressionGridRenderer;\n+import org.kie.workbench.common.dmn.client.widgets.grid.controls.container.CellEditorControlsView;\n+import org.kie.workbench.common.dmn.client.widgets.grid.controls.list.HasListSelectorControl;\n+import org.kie.workbench.common.dmn.client.widgets.grid.controls.list.ListSelectorView;\n+import org.kie.workbench.common.dmn.client.widgets.grid.model.ExpressionEditorChanged;\n+import org.kie.workbench.common.dmn.client.widgets.grid.model.ExpressionEditorGridRow;\n+import org.kie.workbench.common.dmn.client.widgets.grid.model.GridCellTuple;\n+import org.kie.workbench.common.dmn.client.widgets.layer.DMNGridLayer;\n+import org.kie.workbench.common.dmn.client.widgets.panel.DMNGridPanel;\n+import org.kie.workbench.common.stunner.core.client.api.SessionManager;\n+import org.kie.workbench.common.stunner.core.client.canvas.AbstractCanvasHandler;\n+import org.kie.workbench.common.stunner.core.client.canvas.event.selection.DomainObjectSelectionEvent;\n+import org.kie.workbench.common.stunner.core.client.command.SessionCommandManager;\n+import org.kie.workbench.common.stunner.core.domainobject.DomainObject;\n+import org.kie.workbench.common.stunner.core.util.DefinitionUtils;\n+import org.kie.workbench.common.stunner.forms.client.event.RefreshFormPropertiesEvent;\n+import org.uberfire.ext.wires.core.grids.client.model.GridCell;\n+import org.uberfire.ext.wires.core.grids.client.model.GridColumn;\n+import org.uberfire.ext.wires.core.grids.client.model.GridRow;\n+import org.uberfire.ext.wires.core.grids.client.model.impl.BaseHeaderMetaData;\n+\n+public class ListGrid extends BaseExpressionGrid<List, ListGridData, ListUIModelMapper> implements HasListSelectorControl {\n+\n+    private final ValueAndDataTypePopoverView.Presenter headerEditor;\n+\n+    private final Supplier<ExpressionEditorDefinitions> expressionEditorDefinitionsSupplier;\n+\n+    public ListGrid(final GridCellTuple parent,\n+                    final Optional<String> nodeUUID,\n+                    final HasExpression hasExpression,\n+                    final Optional<HasName> hasName,\n+                    final DMNGridPanel gridPanel,\n+                    final DMNGridLayer gridLayer,\n+                    final ListGridData gridData,\n+                    final DefinitionUtils definitionUtils,\n+                    final SessionManager sessionManager,\n+                    final SessionCommandManager<AbstractCanvasHandler> sessionCommandManager,\n+                    final DefaultCanvasCommandFactory canvasCommandFactory,\n+                    final Event<ExpressionEditorChanged> editorSelectedEvent,\n+                    final Event<RefreshFormPropertiesEvent> refreshFormPropertiesEvent,\n+                    final Event<DomainObjectSelectionEvent> domainObjectSelectionEvent,\n+                    final CellEditorControlsView.Presenter cellEditorControls,\n+                    final ListSelectorView.Presenter listSelector,\n+                    final TranslationService translationService,\n+                    final boolean isOnlyVisualChangeAllowed,\n+                    final int nesting,\n+                    final Supplier<ExpressionEditorDefinitions> expressionEditorDefinitionsSupplier,\n+                    final ValueAndDataTypePopoverView.Presenter headerEditor) {\n+        super(parent,\n+              nodeUUID,\n+              hasExpression,\n+              hasName,\n+              gridPanel,\n+              gridLayer,\n+              gridData,\n+              new BaseExpressionGridRenderer(gridData),\n+              definitionUtils,\n+              sessionManager,\n+              sessionCommandManager,\n+              canvasCommandFactory,\n+              editorSelectedEvent,\n+              refreshFormPropertiesEvent,\n+              domainObjectSelectionEvent,\n+              cellEditorControls,\n+              listSelector,\n+              translationService,\n+              isOnlyVisualChangeAllowed,\n+              nesting);\n+        this.expressionEditorDefinitionsSupplier = expressionEditorDefinitionsSupplier;\n+        this.headerEditor = headerEditor;\n+\n+        setEventPropagationMode(EventPropagationMode.NO_ANCESTORS);\n+\n+        super.doInitialisation();\n+    }\n+\n+    @Override\n+    protected void doInitialisation() {\n+        // Defer initialisation until after the constructor completes as\n+        // makeUiModelMapper needs expressionEditorDefinitionsSupplier to have been set\n+    }\n+\n+    @Override\n+    public ListUIModelMapper makeUiModelMapper() {\n+        return new ListUIModelMapper(this,\n+                                     this::getModel,/**/\n+                                     getExpression(),\n+                                     () -> isOnlyVisualChangeAllowed,\n+                                     expressionEditorDefinitionsSupplier,\n+                                     listSelector,\n+                                     nesting);\n+    }\n+\n+    @Override\n+    public void initialiseUiColumns() {\n+        final java.util.List<GridColumn.HeaderMetaData> headerMetaData = new ArrayList<>();\n+        final ContextGridRowNumberColumn rowNumberColumn = new ContextGridRowNumberColumn(headerMetaData,\n+                                                                                          getAndSetInitialWidth(ListUIModelMapperHelper.ROW_COLUMN_INDEX,\n+                                                                                                                ContextGridRowNumberColumn.DEFAULT_WIDTH));\n+\n+        if (nesting == 0) {\n+            rowNumberColumn.getHeaderMetaData().add(new BaseHeaderMetaData(\"#\"));\n+            headerMetaData.add(new ListExpressionColumnHeaderMetaData(hasExpression,\n+                                                                      hasName,\n+                                                                      clearValueConsumer(true, new Name()),\n+                                                                      setValueConsumer(true),\n+                                                                      setTypeRefConsumer(),\n+                                                                      translationService,\n+                                                                      cellEditorControls,\n+                                                                      headerEditor));\n+        }\n+\n+        final GridColumn listColumn = new ListExpressionEditorColumn(gridLayer,\n+                                                                     headerMetaData,\n+                                                                     getAndSetInitialWidth(ListUIModelMapperHelper.EXPRESSION_COLUMN_INDEX,\n+                                                                                           ExpressionEditorColumn.DEFAULT_WIDTH),\n+                                                                     this);\n+        model.appendColumn(rowNumberColumn);\n+        model.appendColumn(listColumn);\n+\n+        getRenderer().setColumnRenderConstraint((isSelectionLayer, gridColumn) -> true);\n+    }\n+\n+    @Override\n+    public void initialiseUiRows() {\n+        getExpression().get().ifPresent(list -> {\n+            list.getExpression().forEach(e -> model.appendRow(new ExpressionEditorGridRow()));\n+        });\n+    }\n+\n+    @Override\n+    public void initialiseUiCells() {\n+        getExpression().get().ifPresent(list -> {\n+            for (int rowIndex = 0; rowIndex < list.getExpression().size(); rowIndex++) {\n+                uiModelMapper.fromDMNModel(rowIndex,\n+                                           0);\n+                uiModelMapper.fromDMNModel(rowIndex,\n+                                           1);\n+            }\n+        });\n+    }\n+\n+    @Override\n+    public java.util.List<ListSelectorItem> getItems(final int uiRowIndex,\n+                                                     final int uiColumnIndex) {\n+        final java.util.List<ListSelectorItem> items = new ArrayList<>();\n+        final boolean isMultiRow = SelectionUtils.isMultiRow(model);\n+        final boolean isMultiSelect = SelectionUtils.isMultiSelect(model);\n+\n+        items.add(ListSelectorHeaderItem.build(translationService.format(DMNEditorConstants.ListEditor_HeaderRows)));\n+        items.add(ListSelectorTextItem.build(translationService.format(DMNEditorConstants.ListEditor_InsertRowAbove),\n+                                             !isMultiRow,\n+                                             () -> {\n+                                                 cellEditorControls.hide();\n+                                                 getExpression().get().ifPresent(e -> addRow(uiRowIndex));\n+                                             }));\n+        items.add(ListSelectorTextItem.build(translationService.format(DMNEditorConstants.ListEditor_InsertRowBelow),\n+                                             !isMultiRow,\n+                                             () -> {\n+                                                 cellEditorControls.hide();\n+                                                 getExpression().get().ifPresent(e -> addRow(uiRowIndex + 1));\n+                                             }));\n+        items.add(ListSelectorTextItem.build(translationService.format(DMNEditorConstants.ListEditor_DeleteRow),\n+                                             !isMultiRow && model.getRowCount() > 1,\n+                                             () -> {\n+                                                 cellEditorControls.hide();\n+                                                 getExpression().get().ifPresent(e -> deleteRow(uiRowIndex));\n+                                             }));\n+\n+        //If not ExpressionEditor column don't add extra items\n+        if (ListUIModelMapperHelper.getSection(uiColumnIndex) != ListUIModelMapperHelper.ListSection.EXPRESSION) {\n+            return items;\n+        }\n+\n+        //If cell editor is UndefinedExpressionGrid don't add extra items\n+        final GridCell<?> cell = model.getCell(uiRowIndex, uiColumnIndex);\n+        final ExpressionCellValue ecv = (ExpressionCellValue) cell.getValue();\n+        if (!ecv.getValue().isPresent()) {\n+            return items;\n+        }\n+        final BaseExpressionGrid grid = ecv.getValue().get();\n+        if (grid instanceof UndefinedExpressionGrid) {\n+            return items;\n+        }\n+\n+        if (items.size() > 0) {\n+            items.add(new ListSelectorDividerItem());\n+        }\n+        items.add(ListSelectorTextItem.build(translationService.format(DMNEditorConstants.ExpressionEditor_Clear),\n+                                             !isMultiSelect,\n+                                             () -> {\n+                                                 cellEditorControls.hide();\n+                                                 clearExpressionType(uiRowIndex);\n+                                             }));\n+\n+        return items;\n+    }\n+\n+    @Override\n+    public void onItemSelected(final ListSelectorItem item) {\n+        final ListSelectorTextItem li = (ListSelectorTextItem) item;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "19205611aeb71a020ddcc44bbecc4dcc7a7ee2c7"}, "originalPosition": 246}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NTA5NjA4OA==", "bodyText": "Yes, as the clickable items added to it are all ListSelectorTextItem\nSee these lines.", "url": "https://github.com/kiegroup/kie-wb-common/pull/3220#discussion_r395096088", "createdAt": "2020-03-19T15:05:11Z", "author": {"login": "manstis"}, "path": "kie-wb-common-dmn/kie-wb-common-dmn-client/src/main/java/org/kie/workbench/common/dmn/client/editors/expressions/types/list/ListGrid.java", "diffHunk": "@@ -0,0 +1,337 @@\n+/*\n+ * Copyright 2020 Red Hat, Inc. and/or its affiliates.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+package org.kie.workbench.common.dmn.client.editors.expressions.types.list;\n+\n+import java.util.ArrayList;\n+import java.util.Optional;\n+import java.util.function.Supplier;\n+\n+import javax.enterprise.event.Event;\n+\n+import com.ait.lienzo.shared.core.types.EventPropagationMode;\n+import org.jboss.errai.ui.client.local.spi.TranslationService;\n+import org.kie.workbench.common.dmn.api.definition.HasExpression;\n+import org.kie.workbench.common.dmn.api.definition.HasName;\n+import org.kie.workbench.common.dmn.api.definition.model.DMNModelInstrumentedBase;\n+import org.kie.workbench.common.dmn.api.definition.model.Expression;\n+import org.kie.workbench.common.dmn.api.definition.model.List;\n+import org.kie.workbench.common.dmn.api.definition.model.LiteralExpression;\n+import org.kie.workbench.common.dmn.api.property.dmn.Name;\n+import org.kie.workbench.common.dmn.client.commands.expressions.types.list.AddListRowCommand;\n+import org.kie.workbench.common.dmn.client.commands.expressions.types.list.ClearExpressionTypeCommand;\n+import org.kie.workbench.common.dmn.client.commands.expressions.types.list.DeleteListRowCommand;\n+import org.kie.workbench.common.dmn.client.commands.factory.DefaultCanvasCommandFactory;\n+import org.kie.workbench.common.dmn.client.editors.expressions.types.ExpressionEditorDefinitions;\n+import org.kie.workbench.common.dmn.client.editors.expressions.types.context.ContextGridRowNumberColumn;\n+import org.kie.workbench.common.dmn.client.editors.expressions.types.context.ExpressionCellValue;\n+import org.kie.workbench.common.dmn.client.editors.expressions.types.context.ExpressionEditorColumn;\n+import org.kie.workbench.common.dmn.client.editors.expressions.types.undefined.UndefinedExpressionGrid;\n+import org.kie.workbench.common.dmn.client.editors.expressions.util.SelectionUtils;\n+import org.kie.workbench.common.dmn.client.editors.types.ValueAndDataTypePopoverView;\n+import org.kie.workbench.common.dmn.client.resources.i18n.DMNEditorConstants;\n+import org.kie.workbench.common.dmn.client.widgets.grid.BaseExpressionGrid;\n+import org.kie.workbench.common.dmn.client.widgets.grid.BaseExpressionGridRenderer;\n+import org.kie.workbench.common.dmn.client.widgets.grid.controls.container.CellEditorControlsView;\n+import org.kie.workbench.common.dmn.client.widgets.grid.controls.list.HasListSelectorControl;\n+import org.kie.workbench.common.dmn.client.widgets.grid.controls.list.ListSelectorView;\n+import org.kie.workbench.common.dmn.client.widgets.grid.model.ExpressionEditorChanged;\n+import org.kie.workbench.common.dmn.client.widgets.grid.model.ExpressionEditorGridRow;\n+import org.kie.workbench.common.dmn.client.widgets.grid.model.GridCellTuple;\n+import org.kie.workbench.common.dmn.client.widgets.layer.DMNGridLayer;\n+import org.kie.workbench.common.dmn.client.widgets.panel.DMNGridPanel;\n+import org.kie.workbench.common.stunner.core.client.api.SessionManager;\n+import org.kie.workbench.common.stunner.core.client.canvas.AbstractCanvasHandler;\n+import org.kie.workbench.common.stunner.core.client.canvas.event.selection.DomainObjectSelectionEvent;\n+import org.kie.workbench.common.stunner.core.client.command.SessionCommandManager;\n+import org.kie.workbench.common.stunner.core.domainobject.DomainObject;\n+import org.kie.workbench.common.stunner.core.util.DefinitionUtils;\n+import org.kie.workbench.common.stunner.forms.client.event.RefreshFormPropertiesEvent;\n+import org.uberfire.ext.wires.core.grids.client.model.GridCell;\n+import org.uberfire.ext.wires.core.grids.client.model.GridColumn;\n+import org.uberfire.ext.wires.core.grids.client.model.GridRow;\n+import org.uberfire.ext.wires.core.grids.client.model.impl.BaseHeaderMetaData;\n+\n+public class ListGrid extends BaseExpressionGrid<List, ListGridData, ListUIModelMapper> implements HasListSelectorControl {\n+\n+    private final ValueAndDataTypePopoverView.Presenter headerEditor;\n+\n+    private final Supplier<ExpressionEditorDefinitions> expressionEditorDefinitionsSupplier;\n+\n+    public ListGrid(final GridCellTuple parent,\n+                    final Optional<String> nodeUUID,\n+                    final HasExpression hasExpression,\n+                    final Optional<HasName> hasName,\n+                    final DMNGridPanel gridPanel,\n+                    final DMNGridLayer gridLayer,\n+                    final ListGridData gridData,\n+                    final DefinitionUtils definitionUtils,\n+                    final SessionManager sessionManager,\n+                    final SessionCommandManager<AbstractCanvasHandler> sessionCommandManager,\n+                    final DefaultCanvasCommandFactory canvasCommandFactory,\n+                    final Event<ExpressionEditorChanged> editorSelectedEvent,\n+                    final Event<RefreshFormPropertiesEvent> refreshFormPropertiesEvent,\n+                    final Event<DomainObjectSelectionEvent> domainObjectSelectionEvent,\n+                    final CellEditorControlsView.Presenter cellEditorControls,\n+                    final ListSelectorView.Presenter listSelector,\n+                    final TranslationService translationService,\n+                    final boolean isOnlyVisualChangeAllowed,\n+                    final int nesting,\n+                    final Supplier<ExpressionEditorDefinitions> expressionEditorDefinitionsSupplier,\n+                    final ValueAndDataTypePopoverView.Presenter headerEditor) {\n+        super(parent,\n+              nodeUUID,\n+              hasExpression,\n+              hasName,\n+              gridPanel,\n+              gridLayer,\n+              gridData,\n+              new BaseExpressionGridRenderer(gridData),\n+              definitionUtils,\n+              sessionManager,\n+              sessionCommandManager,\n+              canvasCommandFactory,\n+              editorSelectedEvent,\n+              refreshFormPropertiesEvent,\n+              domainObjectSelectionEvent,\n+              cellEditorControls,\n+              listSelector,\n+              translationService,\n+              isOnlyVisualChangeAllowed,\n+              nesting);\n+        this.expressionEditorDefinitionsSupplier = expressionEditorDefinitionsSupplier;\n+        this.headerEditor = headerEditor;\n+\n+        setEventPropagationMode(EventPropagationMode.NO_ANCESTORS);\n+\n+        super.doInitialisation();\n+    }\n+\n+    @Override\n+    protected void doInitialisation() {\n+        // Defer initialisation until after the constructor completes as\n+        // makeUiModelMapper needs expressionEditorDefinitionsSupplier to have been set\n+    }\n+\n+    @Override\n+    public ListUIModelMapper makeUiModelMapper() {\n+        return new ListUIModelMapper(this,\n+                                     this::getModel,/**/\n+                                     getExpression(),\n+                                     () -> isOnlyVisualChangeAllowed,\n+                                     expressionEditorDefinitionsSupplier,\n+                                     listSelector,\n+                                     nesting);\n+    }\n+\n+    @Override\n+    public void initialiseUiColumns() {\n+        final java.util.List<GridColumn.HeaderMetaData> headerMetaData = new ArrayList<>();\n+        final ContextGridRowNumberColumn rowNumberColumn = new ContextGridRowNumberColumn(headerMetaData,\n+                                                                                          getAndSetInitialWidth(ListUIModelMapperHelper.ROW_COLUMN_INDEX,\n+                                                                                                                ContextGridRowNumberColumn.DEFAULT_WIDTH));\n+\n+        if (nesting == 0) {\n+            rowNumberColumn.getHeaderMetaData().add(new BaseHeaderMetaData(\"#\"));\n+            headerMetaData.add(new ListExpressionColumnHeaderMetaData(hasExpression,\n+                                                                      hasName,\n+                                                                      clearValueConsumer(true, new Name()),\n+                                                                      setValueConsumer(true),\n+                                                                      setTypeRefConsumer(),\n+                                                                      translationService,\n+                                                                      cellEditorControls,\n+                                                                      headerEditor));\n+        }\n+\n+        final GridColumn listColumn = new ListExpressionEditorColumn(gridLayer,\n+                                                                     headerMetaData,\n+                                                                     getAndSetInitialWidth(ListUIModelMapperHelper.EXPRESSION_COLUMN_INDEX,\n+                                                                                           ExpressionEditorColumn.DEFAULT_WIDTH),\n+                                                                     this);\n+        model.appendColumn(rowNumberColumn);\n+        model.appendColumn(listColumn);\n+\n+        getRenderer().setColumnRenderConstraint((isSelectionLayer, gridColumn) -> true);\n+    }\n+\n+    @Override\n+    public void initialiseUiRows() {\n+        getExpression().get().ifPresent(list -> {\n+            list.getExpression().forEach(e -> model.appendRow(new ExpressionEditorGridRow()));\n+        });\n+    }\n+\n+    @Override\n+    public void initialiseUiCells() {\n+        getExpression().get().ifPresent(list -> {\n+            for (int rowIndex = 0; rowIndex < list.getExpression().size(); rowIndex++) {\n+                uiModelMapper.fromDMNModel(rowIndex,\n+                                           0);\n+                uiModelMapper.fromDMNModel(rowIndex,\n+                                           1);\n+            }\n+        });\n+    }\n+\n+    @Override\n+    public java.util.List<ListSelectorItem> getItems(final int uiRowIndex,\n+                                                     final int uiColumnIndex) {\n+        final java.util.List<ListSelectorItem> items = new ArrayList<>();\n+        final boolean isMultiRow = SelectionUtils.isMultiRow(model);\n+        final boolean isMultiSelect = SelectionUtils.isMultiSelect(model);\n+\n+        items.add(ListSelectorHeaderItem.build(translationService.format(DMNEditorConstants.ListEditor_HeaderRows)));\n+        items.add(ListSelectorTextItem.build(translationService.format(DMNEditorConstants.ListEditor_InsertRowAbove),\n+                                             !isMultiRow,\n+                                             () -> {\n+                                                 cellEditorControls.hide();\n+                                                 getExpression().get().ifPresent(e -> addRow(uiRowIndex));\n+                                             }));\n+        items.add(ListSelectorTextItem.build(translationService.format(DMNEditorConstants.ListEditor_InsertRowBelow),\n+                                             !isMultiRow,\n+                                             () -> {\n+                                                 cellEditorControls.hide();\n+                                                 getExpression().get().ifPresent(e -> addRow(uiRowIndex + 1));\n+                                             }));\n+        items.add(ListSelectorTextItem.build(translationService.format(DMNEditorConstants.ListEditor_DeleteRow),\n+                                             !isMultiRow && model.getRowCount() > 1,\n+                                             () -> {\n+                                                 cellEditorControls.hide();\n+                                                 getExpression().get().ifPresent(e -> deleteRow(uiRowIndex));\n+                                             }));\n+\n+        //If not ExpressionEditor column don't add extra items\n+        if (ListUIModelMapperHelper.getSection(uiColumnIndex) != ListUIModelMapperHelper.ListSection.EXPRESSION) {\n+            return items;\n+        }\n+\n+        //If cell editor is UndefinedExpressionGrid don't add extra items\n+        final GridCell<?> cell = model.getCell(uiRowIndex, uiColumnIndex);\n+        final ExpressionCellValue ecv = (ExpressionCellValue) cell.getValue();\n+        if (!ecv.getValue().isPresent()) {\n+            return items;\n+        }\n+        final BaseExpressionGrid grid = ecv.getValue().get();\n+        if (grid instanceof UndefinedExpressionGrid) {\n+            return items;\n+        }\n+\n+        if (items.size() > 0) {\n+            items.add(new ListSelectorDividerItem());\n+        }\n+        items.add(ListSelectorTextItem.build(translationService.format(DMNEditorConstants.ExpressionEditor_Clear),\n+                                             !isMultiSelect,\n+                                             () -> {\n+                                                 cellEditorControls.hide();\n+                                                 clearExpressionType(uiRowIndex);\n+                                             }));\n+\n+        return items;\n+    }\n+\n+    @Override\n+    public void onItemSelected(final ListSelectorItem item) {\n+        final ListSelectorTextItem li = (ListSelectorTextItem) item;", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NDkwNTA5MA=="}, "originalCommit": {"oid": "19205611aeb71a020ddcc44bbecc4dcc7a7ee2c7"}, "originalPosition": 246}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjQ0Nzg3MTgyOnYy", "diffSide": "RIGHT", "path": "kie-wb-common-dmn/kie-wb-common-dmn-client/src/test/java/org/kie/workbench/common/dmn/client/commands/expressions/types/list/MoveListRowsCommandTest.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xOVQxMDoyMDozM1rOF4oJlQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xOVQxNTowNjoyNVrOF4yzvA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NDkyMjM4OQ==", "bodyText": "2020", "url": "https://github.com/kiegroup/kie-wb-common/pull/3220#discussion_r394922389", "createdAt": "2020-03-19T10:20:33Z", "author": {"login": "jomarko"}, "path": "kie-wb-common-dmn/kie-wb-common-dmn-client/src/test/java/org/kie/workbench/common/dmn/client/commands/expressions/types/list/MoveListRowsCommandTest.java", "diffHunk": "@@ -0,0 +1,373 @@\n+/*\n+ * Copyright 2017 Red Hat, Inc. and/or its affiliates.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "19205611aeb71a020ddcc44bbecc4dcc7a7ee2c7"}, "originalPosition": 2}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NTA5NzAyMA==", "bodyText": "Done.", "url": "https://github.com/kiegroup/kie-wb-common/pull/3220#discussion_r395097020", "createdAt": "2020-03-19T15:06:25Z", "author": {"login": "manstis"}, "path": "kie-wb-common-dmn/kie-wb-common-dmn-client/src/test/java/org/kie/workbench/common/dmn/client/commands/expressions/types/list/MoveListRowsCommandTest.java", "diffHunk": "@@ -0,0 +1,373 @@\n+/*\n+ * Copyright 2017 Red Hat, Inc. and/or its affiliates.", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NDkyMjM4OQ=="}, "originalCommit": {"oid": "19205611aeb71a020ddcc44bbecc4dcc7a7ee2c7"}, "originalPosition": 2}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjQ0Nzg3MzYwOnYy", "diffSide": "RIGHT", "path": "kie-wb-common-dmn/kie-wb-common-dmn-client/src/test/java/org/kie/workbench/common/dmn/client/editors/expressions/types/list/ListExpressionColumnHeaderMetaDataTest.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xOVQxMDoyMTowNVrOF4oKvg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xOVQxNToxODo1MVrOF4zZWw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NDkyMjY4Ng==", "bodyText": "2020", "url": "https://github.com/kiegroup/kie-wb-common/pull/3220#discussion_r394922686", "createdAt": "2020-03-19T10:21:05Z", "author": {"login": "jomarko"}, "path": "kie-wb-common-dmn/kie-wb-common-dmn-client/src/test/java/org/kie/workbench/common/dmn/client/editors/expressions/types/list/ListExpressionColumnHeaderMetaDataTest.java", "diffHunk": "@@ -0,0 +1,68 @@\n+/*\n+ * Copyright 2019 Red Hat, Inc. and/or its affiliates.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "19205611aeb71a020ddcc44bbecc4dcc7a7ee2c7"}, "originalPosition": 2}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NTEwNjY1MQ==", "bodyText": "Done.", "url": "https://github.com/kiegroup/kie-wb-common/pull/3220#discussion_r395106651", "createdAt": "2020-03-19T15:18:51Z", "author": {"login": "manstis"}, "path": "kie-wb-common-dmn/kie-wb-common-dmn-client/src/test/java/org/kie/workbench/common/dmn/client/editors/expressions/types/list/ListExpressionColumnHeaderMetaDataTest.java", "diffHunk": "@@ -0,0 +1,68 @@\n+/*\n+ * Copyright 2019 Red Hat, Inc. and/or its affiliates.", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NDkyMjY4Ng=="}, "originalCommit": {"oid": "19205611aeb71a020ddcc44bbecc4dcc7a7ee2c7"}, "originalPosition": 2}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjQ1MDAzMjYyOnYy", "diffSide": "RIGHT", "path": "kie-wb-common-dmn/kie-wb-common-dmn-webapp-kogito-runtime/src/test/resources/org/kie/workbench/common/dmn/showcase/client/selenium/DROOLS-5131 (List expression).xml", "isResolved": true, "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xOVQxOTo0NTo0NFrOF493xw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yMFQwNjo1MzozM1rOF5JDMQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NTI3ODI3OQ==", "bodyText": "don't we use the \"convention\" and name the file \"decision-expression-list.xml\"?", "url": "https://github.com/kiegroup/kie-wb-common/pull/3220#discussion_r395278279", "createdAt": "2020-03-19T19:45:44Z", "author": {"login": "jomarko"}, "path": "kie-wb-common-dmn/kie-wb-common-dmn-webapp-kogito-runtime/src/test/resources/org/kie/workbench/common/dmn/showcase/client/selenium/DROOLS-5131 (List expression).xml", "diffHunk": "@@ -0,0 +1,52 @@\n+<?xml version='1.0' ?>\n+<dmn:definitions xmlns:dmn='http://www.omg.org/spec/DMN/20180521/MODEL/'\n+                 xmlns='https://kiegroup.org/dmn/_A36E66A0-5CC4-494F-8E8C-47FE35520173'\n+                 xmlns:di='http://www.omg.org/spec/DMN/20180521/DI/'\n+                 xmlns:kie='http://www.drools.org/kie/dmn/1.2'\n+                 xmlns:dmndi='http://www.omg.org/spec/DMN/20180521/DMNDI/'\n+                 xmlns:dc='http://www.omg.org/spec/DMN/20180521/DC/'\n+                 id='_15712B07-1327-478A-A1A8-214878C1F307'\n+                 name='DROOLS-5131'", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "bd15b9a06f88d93dffe909ef84135f1f369cd80f"}, "originalPosition": 9}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NTI5NjgxOQ==", "bodyText": "I did do when I first wrote the suite of tests; but subsequent ones have the JIRA number in their name.. happy to do either way. I don't mind; feel free to state your preference.", "url": "https://github.com/kiegroup/kie-wb-common/pull/3220#discussion_r395296819", "createdAt": "2020-03-19T20:20:55Z", "author": {"login": "manstis"}, "path": "kie-wb-common-dmn/kie-wb-common-dmn-webapp-kogito-runtime/src/test/resources/org/kie/workbench/common/dmn/showcase/client/selenium/DROOLS-5131 (List expression).xml", "diffHunk": "@@ -0,0 +1,52 @@\n+<?xml version='1.0' ?>\n+<dmn:definitions xmlns:dmn='http://www.omg.org/spec/DMN/20180521/MODEL/'\n+                 xmlns='https://kiegroup.org/dmn/_A36E66A0-5CC4-494F-8E8C-47FE35520173'\n+                 xmlns:di='http://www.omg.org/spec/DMN/20180521/DI/'\n+                 xmlns:kie='http://www.drools.org/kie/dmn/1.2'\n+                 xmlns:dmndi='http://www.omg.org/spec/DMN/20180521/DMNDI/'\n+                 xmlns:dc='http://www.omg.org/spec/DMN/20180521/DC/'\n+                 id='_15712B07-1327-478A-A1A8-214878C1F307'\n+                 name='DROOLS-5131'", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NTI3ODI3OQ=="}, "originalCommit": {"oid": "bd15b9a06f88d93dffe909ef84135f1f369cd80f"}, "originalPosition": 9}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NTQ2MTQyNQ==", "bodyText": "ok we mix already naming, so feel free to keep as it is", "url": "https://github.com/kiegroup/kie-wb-common/pull/3220#discussion_r395461425", "createdAt": "2020-03-20T06:53:33Z", "author": {"login": "jomarko"}, "path": "kie-wb-common-dmn/kie-wb-common-dmn-webapp-kogito-runtime/src/test/resources/org/kie/workbench/common/dmn/showcase/client/selenium/DROOLS-5131 (List expression).xml", "diffHunk": "@@ -0,0 +1,52 @@\n+<?xml version='1.0' ?>\n+<dmn:definitions xmlns:dmn='http://www.omg.org/spec/DMN/20180521/MODEL/'\n+                 xmlns='https://kiegroup.org/dmn/_A36E66A0-5CC4-494F-8E8C-47FE35520173'\n+                 xmlns:di='http://www.omg.org/spec/DMN/20180521/DI/'\n+                 xmlns:kie='http://www.drools.org/kie/dmn/1.2'\n+                 xmlns:dmndi='http://www.omg.org/spec/DMN/20180521/DMNDI/'\n+                 xmlns:dc='http://www.omg.org/spec/DMN/20180521/DC/'\n+                 id='_15712B07-1327-478A-A1A8-214878C1F307'\n+                 name='DROOLS-5131'", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NTI3ODI3OQ=="}, "originalCommit": {"oid": "bd15b9a06f88d93dffe909ef84135f1f369cd80f"}, "originalPosition": 9}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1398, "cost": 1, "resetAt": "2021-11-12T20:28:25Z"}}}