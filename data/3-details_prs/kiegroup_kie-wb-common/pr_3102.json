{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0MzYwNDIyMjk0", "number": 3102, "title": "DROOLS-4485: [DMN Designer] Data Types - Add visual indication for showing the current drag level", "bodyText": "See https://issues.redhat.com/browse/DROOLS-4485", "createdAt": "2020-01-08T11:56:52Z", "url": "https://github.com/kiegroup/kie-wb-common/pull/3102", "merged": true, "mergeCommit": {"oid": "031466533d33fafe47283ee34fff1ed8b1b52a73"}, "closed": true, "closedAt": "2020-02-04T07:12:21Z", "author": {"login": "karreiro"}, "timelineItems": {"totalCount": 12, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABb4XermgFqTMzOTk2MjEzNA==", "endCursor": "Y3Vyc29yOnYyOpPPAAABcA8BEMgFqTM1Mjc1NzI3OQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzM5OTYyMTM0", "url": "https://github.com/kiegroup/kie-wb-common/pull/3102#pullrequestreview-339962134", "createdAt": "2020-01-08T15:56:01Z", "commit": {"oid": "add96cb1b7936113890b7f833ccb33fd268804ff"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "add96cb1b7936113890b7f833ccb33fd268804ff", "author": {"user": {"login": "karreiro", "name": "Guilherme Carreiro"}}, "url": "https://github.com/kiegroup/kie-wb-common/commit/add96cb1b7936113890b7f833ccb33fd268804ff", "committedDate": "2020-01-08T11:54:33Z", "message": "DROOLS-4485: [DMN Designer] Data Types - Add visual indication for showing the current drag level"}, "afterCommit": {"oid": "41924f09996c06db018f8cad755064c4caf5869d", "author": {"user": {"login": "karreiro", "name": "Guilherme Carreiro"}}, "url": "https://github.com/kiegroup/kie-wb-common/commit/41924f09996c06db018f8cad755064c4caf5869d", "committedDate": "2020-01-10T13:48:33Z", "message": "Small enhancement"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "41924f09996c06db018f8cad755064c4caf5869d", "author": {"user": {"login": "karreiro", "name": "Guilherme Carreiro"}}, "url": "https://github.com/kiegroup/kie-wb-common/commit/41924f09996c06db018f8cad755064c4caf5869d", "committedDate": "2020-01-10T13:48:33Z", "message": "Small enhancement"}, "afterCommit": {"oid": "22d85885673ba7f3b412109d4d3e9ee30c872a4d", "author": {"user": {"login": "karreiro", "name": "Guilherme Carreiro"}}, "url": "https://github.com/kiegroup/kie-wb-common/commit/22d85885673ba7f3b412109d4d3e9ee30c872a4d", "committedDate": "2020-01-10T13:48:33Z", "message": "DROOLS-4485: [DMN Designer] Data Types - Add visual indication for showing the current drag level"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "22d85885673ba7f3b412109d4d3e9ee30c872a4d", "author": {"user": {"login": "karreiro", "name": "Guilherme Carreiro"}}, "url": "https://github.com/kiegroup/kie-wb-common/commit/22d85885673ba7f3b412109d4d3e9ee30c872a4d", "committedDate": "2020-01-10T13:48:33Z", "message": "DROOLS-4485: [DMN Designer] Data Types - Add visual indication for showing the current drag level"}, "afterCommit": {"oid": "ab2f3ca5ef2fa52975a83558668007bd2b98fa4a", "author": {"user": {"login": "karreiro", "name": "Guilherme Carreiro"}}, "url": "https://github.com/kiegroup/kie-wb-common/commit/ab2f3ca5ef2fa52975a83558668007bd2b98fa4a", "committedDate": "2020-01-10T16:57:37Z", "message": "DROOLS-4485: [DMN Designer] Data Types - Add visual indication for showing the current drag level"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "ab2f3ca5ef2fa52975a83558668007bd2b98fa4a", "author": {"user": {"login": "karreiro", "name": "Guilherme Carreiro"}}, "url": "https://github.com/kiegroup/kie-wb-common/commit/ab2f3ca5ef2fa52975a83558668007bd2b98fa4a", "committedDate": "2020-01-10T16:57:37Z", "message": "DROOLS-4485: [DMN Designer] Data Types - Add visual indication for showing the current drag level"}, "afterCommit": {"oid": "36e96162a64613b6011788f93ad767fdcc18b0cf", "author": {"user": {"login": "karreiro", "name": "Guilherme Carreiro"}}, "url": "https://github.com/kiegroup/kie-wb-common/commit/36e96162a64613b6011788f93ad767fdcc18b0cf", "committedDate": "2020-01-15T12:51:48Z", "message": "DROOLS-4485: [DMN Designer] Data Types - Add visual indication for showing the current drag level"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzQzNzczNTc0", "url": "https://github.com/kiegroup/kie-wb-common/pull/3102#pullrequestreview-343773574", "createdAt": "2020-01-16T09:28:00Z", "commit": {"oid": "36e96162a64613b6011788f93ad767fdcc18b0cf"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0xNlQwOToyODowMFrOFeS7pA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0xNlQwOToyODowMFrOFeS7pA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NzMxMTc4MA==", "bodyText": "I think the name is misleading here, we are actually counting count of entries? Am I right?", "url": "https://github.com/kiegroup/kie-wb-common/pull/3102#discussion_r367311780", "createdAt": "2020-01-16T09:28:00Z", "author": {"login": "jomarko"}, "path": "kie-wb-common-dmn/kie-wb-common-dmn-client/src/main/java/org/kie/workbench/common/dmn/client/editors/types/listview/DataTypeListHighlightHelper.java", "diffHunk": "@@ -0,0 +1,160 @@\n+/*\n+ * Copyright 2020 Red Hat, Inc. and/or its affiliates.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package org.kie.workbench.common.dmn.client.editors.types.listview;\n+\n+import java.util.List;\n+import java.util.Objects;\n+import java.util.Optional;\n+\n+import javax.enterprise.context.ApplicationScoped;\n+import javax.inject.Inject;\n+\n+import elemental2.dom.DomGlobal;\n+import elemental2.dom.Element;\n+import elemental2.dom.HTMLElement;\n+import elemental2.dom.NodeList;\n+import org.kie.workbench.common.dmn.client.editors.types.common.DataType;\n+import org.kie.workbench.common.dmn.client.editors.types.common.DataTypeUtils;\n+\n+import static org.kie.workbench.common.dmn.client.editors.types.listview.DataTypeListItemView.UUID_ATTR;\n+\n+@ApplicationScoped\n+public class DataTypeListHighlightHelper {\n+\n+    static final String HIGHLIGHT = \"key-highlight\";\n+\n+    static final String LEVEL_HIGHLIGHT = \"kie-level-highlight\";\n+\n+    static final String LEVEL_BACKGROUND_LINE = \"kie-level-background-line\";\n+\n+    private final DataTypeList dataTypeList;\n+\n+    private final DataTypeUtils dataTypeUtils;\n+\n+    @Inject\n+    public DataTypeListHighlightHelper(final DataTypeList dataTypeList,\n+                                       final DataTypeUtils dataTypeUtils) {\n+        this.dataTypeList = dataTypeList;\n+        this.dataTypeUtils = dataTypeUtils;\n+    }\n+\n+    public void highlightLevel(final Element element) {\n+        cleanLevelHighlightClass();\n+        getDataTypeListItem(getUUID(element)).ifPresent(listItem -> {\n+            final DataType topLevel = dataTypeUtils.getTopLevelParent(listItem.getDataType());\n+            highlightLevel(topLevel);\n+        });\n+    }\n+\n+    public void highlight(final Element element) {\n+        cleanHighlightClass();\n+        element.classList.add(HIGHLIGHT);\n+    }\n+\n+    public void cleanHighlightClass() {\n+        cleanCSSClass(HIGHLIGHT);\n+    }\n+\n+    public void cleanLevelHighlightClass() {\n+        cleanBackgroundLine();\n+        cleanCSSClass(LEVEL_HIGHLIGHT);\n+    }\n+\n+    Optional<DataTypeListItem> getDataTypeListItem(final String uuid) {\n+        return dataTypeList\n+                .getItems()\n+                .stream()\n+                .filter(item -> Objects.equals(item.getDataType().getUUID(), uuid))\n+                .findFirst();\n+    }\n+\n+    NodeList<Element> querySelectorAll(final String selector) {\n+        return dataTypeList.getElement().querySelectorAll(selector);\n+    }\n+\n+    private void highlightLevel(final DataType dataType) {\n+\n+        getDataTypeListItem(dataType.getUUID()).ifPresent(listItem -> {\n+\n+            final HTMLElement element = listItem.getDragAndDropElement();\n+            final List<DataType> subDataTypes = dataType.getSubDataTypes();\n+            final boolean topLevel = dataType.isTopLevel();\n+\n+            highlightLevel(listItem);\n+            subDataTypes.forEach(this::highlightLevel);\n+\n+            if (topLevel && !hasBackgroundLine(element)) {\n+                appendBackgroundLine(dataType, element);\n+            }\n+        });\n+    }\n+\n+    void appendBackgroundLine(final DataType dataType,\n+                              final HTMLElement element) {\n+\n+        final int numberOfDataTypes = countDataTypes(dataType);\n+        final Element backgroundLine = createBackgroundLine();\n+        final int dataTypeRow = (int) element.offsetHeight;\n+        final int lineHeight = dataTypeRow * numberOfDataTypes;\n+\n+        element.appendChild(backgroundLine);\n+\n+        backgroundLine.setAttribute(\"style\", \"height: \" + lineHeight + \"px\");\n+    }\n+\n+    private Element createBackgroundLine() {\n+        final Element line = createElement(\"div\");\n+        line.classList.add(LEVEL_BACKGROUND_LINE);\n+        return line;\n+    }\n+\n+    Element createElement(final String tagName) {\n+        return DomGlobal.document.createElement(tagName);\n+    }\n+\n+    boolean hasBackgroundLine(final HTMLElement element) {\n+        return element.querySelector(\".\" + LEVEL_BACKGROUND_LINE) != null;\n+    }\n+\n+    private void cleanBackgroundLine() {\n+        final NodeList<Element> elementNodeList = querySelectorAll(\".\" + LEVEL_BACKGROUND_LINE);\n+        for (int i = 0; i < elementNodeList.length; i++) {\n+            final Element e = elementNodeList.getAt(i);\n+            e.parentNode.removeChild(e);\n+        }\n+    }\n+\n+    private int countDataTypes(final DataType dataType) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "36e96162a64613b6011788f93ad767fdcc18b0cf"}, "originalPosition": 141}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzQzNzc4OTk2", "url": "https://github.com/kiegroup/kie-wb-common/pull/3102#pullrequestreview-343778996", "createdAt": "2020-01-16T09:36:30Z", "commit": {"oid": "36e96162a64613b6011788f93ad767fdcc18b0cf"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "36e96162a64613b6011788f93ad767fdcc18b0cf", "author": {"user": {"login": "karreiro", "name": "Guilherme Carreiro"}}, "url": "https://github.com/kiegroup/kie-wb-common/commit/36e96162a64613b6011788f93ad767fdcc18b0cf", "committedDate": "2020-01-15T12:51:48Z", "message": "DROOLS-4485: [DMN Designer] Data Types - Add visual indication for showing the current drag level"}, "afterCommit": {"oid": "be34998b7674b3433ee65d8cfb7a4e77f94ea939", "author": {"user": {"login": "karreiro", "name": "Guilherme Carreiro"}}, "url": "https://github.com/kiegroup/kie-wb-common/commit/be34998b7674b3433ee65d8cfb7a4e77f94ea939", "committedDate": "2020-01-22T21:41:52Z", "message": "DROOLS-4485: [DMN Designer] Data Types - Add visual indication for showing the current drag level"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzQ4MjIwOTA5", "url": "https://github.com/kiegroup/kie-wb-common/pull/3102#pullrequestreview-348220909", "createdAt": "2020-01-24T20:59:04Z", "commit": {"oid": "be34998b7674b3433ee65d8cfb7a4e77f94ea939"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "fb7c14524c02d245c232f300e64ea03418f298a2", "author": {"user": {"login": "karreiro", "name": "Guilherme Carreiro"}}, "url": "https://github.com/kiegroup/kie-wb-common/commit/fb7c14524c02d245c232f300e64ea03418f298a2", "committedDate": "2020-01-28T19:21:41Z", "message": "DROOLS-4485: [DMN Designer] Data Types - Add visual indication for showing the current drag level"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "be34998b7674b3433ee65d8cfb7a4e77f94ea939", "author": {"user": {"login": "karreiro", "name": "Guilherme Carreiro"}}, "url": "https://github.com/kiegroup/kie-wb-common/commit/be34998b7674b3433ee65d8cfb7a4e77f94ea939", "committedDate": "2020-01-22T21:41:52Z", "message": "DROOLS-4485: [DMN Designer] Data Types - Add visual indication for showing the current drag level"}, "afterCommit": {"oid": "fb7c14524c02d245c232f300e64ea03418f298a2", "author": {"user": {"login": "karreiro", "name": "Guilherme Carreiro"}}, "url": "https://github.com/kiegroup/kie-wb-common/commit/fb7c14524c02d245c232f300e64ea03418f298a2", "committedDate": "2020-01-28T19:21:41Z", "message": "DROOLS-4485: [DMN Designer] Data Types - Add visual indication for showing the current drag level"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzUyNzU3Mjc5", "url": "https://github.com/kiegroup/kie-wb-common/pull/3102#pullrequestreview-352757279", "createdAt": "2020-02-04T07:01:33Z", "commit": {"oid": "fb7c14524c02d245c232f300e64ea03418f298a2"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 643, "cost": 1, "resetAt": "2021-11-01T15:33:45Z"}}}