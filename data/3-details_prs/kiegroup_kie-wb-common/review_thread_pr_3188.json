{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0MzgwNDg5NzM1", "number": 3188, "reviewThreads": {"totalCount": 7, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yN1QwNzoyNzozOVrODjWyiA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yN1QwNzo0OTo0OVrODjXGig==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjM4NDAwMTM2OnYy", "diffSide": "RIGHT", "path": "kie-wb-common-forms/kie-wb-common-dynamic-forms/kie-wb-common-dynamic-forms-client/src/main/java/org/kie/workbench/common/forms/dynamic/client/DynamicFormRenderer.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yN1QwNzoyNzozOVrOFvHk3Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yN1QwNzoyNzozOVrOFvHk3Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NDk1MTUxNw==", "bodyText": "minor: official kiegroup formatting would be: if (isInitialized()) {", "url": "https://github.com/kiegroup/kie-wb-common/pull/3188#discussion_r384951517", "createdAt": "2020-02-27T07:27:39Z", "author": {"login": "jomarko"}, "path": "kie-wb-common-forms/kie-wb-common-dynamic-forms/kie-wb-common-dynamic-forms-client/src/main/java/org/kie/workbench/common/forms/dynamic/client/DynamicFormRenderer.java", "diffHunk": "@@ -247,6 +247,12 @@ public Form getCurrentForm() {\n         return null;\n     }\n \n+    public void flush() {\n+        if(isInitialized()) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "8d2a5cc991936368e20c6be51d4ccf1e87f75cf7"}, "originalPosition": 14}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjM4NDAwOTE0OnYy", "diffSide": "RIGHT", "path": "kie-wb-common-forms/kie-wb-common-forms-commons/kie-wb-common-forms-processing-engine/src/main/java/org/kie/workbench/common/forms/processing/engine/handling/FormHandler.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yN1QwNzozMDo1OFrOFvHpXQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yN1QwNzozMDo1OFrOFvHpXQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NDk1MjY2OQ==", "bodyText": "Could we add javadoc as it is an interface?", "url": "https://github.com/kiegroup/kie-wb-common/pull/3188#discussion_r384952669", "createdAt": "2020-02-27T07:30:58Z", "author": {"login": "jomarko"}, "path": "kie-wb-common-forms/kie-wb-common-forms-commons/kie-wb-common-forms-processing-engine/src/main/java/org/kie/workbench/common/forms/processing/engine/handling/FormHandler.java", "diffHunk": "@@ -138,4 +138,7 @@\n     void setReadOnly(boolean readOnly);\n \n     Form getForm();\n+\n+    void maybeFlush();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "8d2a5cc991936368e20c6be51d4ccf1e87f75cf7"}, "originalPosition": 5}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjM4NDAyMjg4OnYy", "diffSide": "RIGHT", "path": "kie-wb-common-forms/kie-wb-common-forms-commons/kie-wb-common-forms-processing-engine/src/main/java/org/kie/workbench/common/forms/processing/engine/handling/NeedsFlush.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yN1QwNzozNzoyNFrOFvHxiQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yN1QwODozMjoxN1rOFvJHAA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NDk1NDc2MQ==", "bodyText": "Wr could add short java doc, maybe not what is flush but what classes are intended to implement it ?", "url": "https://github.com/kiegroup/kie-wb-common/pull/3188#discussion_r384954761", "createdAt": "2020-02-27T07:37:24Z", "author": {"login": "jomarko"}, "path": "kie-wb-common-forms/kie-wb-common-forms-commons/kie-wb-common-forms-processing-engine/src/main/java/org/kie/workbench/common/forms/processing/engine/handling/NeedsFlush.java", "diffHunk": "@@ -0,0 +1,22 @@\n+/*\n+ * Copyright 2020 Red Hat, Inc. and/or its affiliates.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package org.kie.workbench.common.forms.processing.engine.handling;\n+\n+public interface NeedsFlush {\n+\n+    void flush();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "8d2a5cc991936368e20c6be51d4ccf1e87f75cf7"}, "originalPosition": 21}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NDk3NjY0MA==", "bodyText": "Basically it should be implemented by nested forms. Nested forms have their own renderer and need to propagate the flush call. I decided to have a separate interface instead of reusing IsNestedModel just in case we need that functionallity for other custom form controls (stunner have some dedicated to the propreties panels)", "url": "https://github.com/kiegroup/kie-wb-common/pull/3188#discussion_r384976640", "createdAt": "2020-02-27T08:32:17Z", "author": {"login": "pefernan"}, "path": "kie-wb-common-forms/kie-wb-common-forms-commons/kie-wb-common-forms-processing-engine/src/main/java/org/kie/workbench/common/forms/processing/engine/handling/NeedsFlush.java", "diffHunk": "@@ -0,0 +1,22 @@\n+/*\n+ * Copyright 2020 Red Hat, Inc. and/or its affiliates.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package org.kie.workbench.common.forms.processing.engine.handling;\n+\n+public interface NeedsFlush {\n+\n+    void flush();", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NDk1NDc2MQ=="}, "originalCommit": {"oid": "8d2a5cc991936368e20c6be51d4ccf1e87f75cf7"}, "originalPosition": 21}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjM4NDAzODQ5OnYy", "diffSide": "RIGHT", "path": "kie-wb-common-forms/kie-wb-common-forms-commons/kie-wb-common-forms-processing-engine/src/main/java/org/kie/workbench/common/forms/processing/engine/handling/impl/FormHandlerImpl.java", "isResolved": true, "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yN1QwNzo0NDowNVrOFvH7Hg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yN1QwOToyMToxMVrOFvKjCg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NDk1NzIxNA==", "bodyText": "Not sure where to comment, but we should simplify the setUp variants to have just two (because of the passed values):\n@Override\n    public void setUp(DataBinder<T> binder) {\n        Assert.notNull(\"DataBinder cannot be null\",\n                       binder);\n\n        clear();\n\n        this.form = new Form();\n\n        this.binder = binder;\n    }\n\n    @Override\n    public void setUp(T model) {\n        Assert.notNull(\"Model cannot be null\",\n                       model);\n\n        setUp(getBinderForModel(model));\n    }", "url": "https://github.com/kiegroup/kie-wb-common/pull/3188#discussion_r384957214", "createdAt": "2020-02-27T07:44:05Z", "author": {"login": "jomarko"}, "path": "kie-wb-common-forms/kie-wb-common-forms-commons/kie-wb-common-forms-processing-engine/src/main/java/org/kie/workbench/common/forms/processing/engine/handling/impl/FormHandlerImpl.java", "diffHunk": "@@ -37,6 +37,7 @@\n import org.kie.workbench.common.forms.processing.engine.handling.FormHandler;\n import org.kie.workbench.common.forms.processing.engine.handling.FormValidator;\n import org.kie.workbench.common.forms.processing.engine.handling.IsNestedModel;\n+import org.kie.workbench.common.forms.processing.engine.handling.NeedsFlush;\n \n public class FormHandlerImpl<T> implements FormHandler<T> {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "8d2a5cc991936368e20c6be51d4ccf1e87f75cf7"}, "originalPosition": 6}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NDk5MTExMw==", "bodyText": "Let me take a look, honestly I'm not sure here. The renderer is being used in two different ways (static models like stunner properties panels & dynamic models on jbpm task list) that's the reason for both setup methods, but I cannot remember the details now.", "url": "https://github.com/kiegroup/kie-wb-common/pull/3188#discussion_r384991113", "createdAt": "2020-02-27T09:03:41Z", "author": {"login": "pefernan"}, "path": "kie-wb-common-forms/kie-wb-common-forms-commons/kie-wb-common-forms-processing-engine/src/main/java/org/kie/workbench/common/forms/processing/engine/handling/impl/FormHandlerImpl.java", "diffHunk": "@@ -37,6 +37,7 @@\n import org.kie.workbench.common.forms.processing.engine.handling.FormHandler;\n import org.kie.workbench.common.forms.processing.engine.handling.FormValidator;\n import org.kie.workbench.common.forms.processing.engine.handling.IsNestedModel;\n+import org.kie.workbench.common.forms.processing.engine.handling.NeedsFlush;\n \n public class FormHandlerImpl<T> implements FormHandler<T> {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NDk1NzIxNA=="}, "originalCommit": {"oid": "8d2a5cc991936368e20c6be51d4ccf1e87f75cf7"}, "originalPosition": 6}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NTAwMDIwMg==", "bodyText": "Ok, I think the setUp receiving a binder is legacy code from the old LiveSpark days... removing it. Thanks for the pointer.", "url": "https://github.com/kiegroup/kie-wb-common/pull/3188#discussion_r385000202", "createdAt": "2020-02-27T09:21:11Z", "author": {"login": "pefernan"}, "path": "kie-wb-common-forms/kie-wb-common-forms-commons/kie-wb-common-forms-processing-engine/src/main/java/org/kie/workbench/common/forms/processing/engine/handling/impl/FormHandlerImpl.java", "diffHunk": "@@ -37,6 +37,7 @@\n import org.kie.workbench.common.forms.processing.engine.handling.FormHandler;\n import org.kie.workbench.common.forms.processing.engine.handling.FormValidator;\n import org.kie.workbench.common.forms.processing.engine.handling.IsNestedModel;\n+import org.kie.workbench.common.forms.processing.engine.handling.NeedsFlush;\n \n public class FormHandlerImpl<T> implements FormHandler<T> {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NDk1NzIxNA=="}, "originalCommit": {"oid": "8d2a5cc991936368e20c6be51d4ccf1e87f75cf7"}, "originalPosition": 6}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjM4NDA0MTQ3OnYy", "diffSide": "RIGHT", "path": "kie-wb-common-forms/kie-wb-common-forms-commons/kie-wb-common-forms-processing-engine/src/main/java/org/kie/workbench/common/forms/processing/engine/handling/impl/FormHandlerImpl.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yN1QwNzo0NTozMlrOFvH87g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yN1QwNzo0NTozMlrOFvH87g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NDk1NzY3OA==", "bodyText": "minor: official kiegroup formatting is: if (enabledOnChangeValidations) {", "url": "https://github.com/kiegroup/kie-wb-common/pull/3188#discussion_r384957678", "createdAt": "2020-02-27T07:45:32Z", "author": {"login": "jomarko"}, "path": "kie-wb-common-forms/kie-wb-common-forms-commons/kie-wb-common-forms-processing-engine/src/main/java/org/kie/workbench/common/forms/processing/engine/handling/impl/FormHandlerImpl.java", "diffHunk": "@@ -140,17 +144,26 @@ public void registerInput(FormField formField,\n \n         if (widget instanceof IsNestedModel) {\n             IsNestedModel nestedModelWidget = (IsNestedModel) widget;\n-            nestedModelWidget.addFieldChangeHandler((childFieldName, newValue) -> fieldChangeManager.notifyFieldChange(fieldName + \".\" + childFieldName,\n-                                                                                                                       newValue));\n+            nestedModelWidget.addFieldChangeHandler((nestedFieldName, newValue) -> notifyFieldChange(formField.getFieldName() + \".\" + nestedFieldName, newValue));\n         } else {\n             PropertyChangeUnsubscribeHandle unsubscribeHandle = binder.addPropertyChangeHandler(formField.getFieldBinding(),\n-                                                                                                event -> fieldChangeManager.processFieldChange(fieldName,\n-                                                                                                                                               event.getNewValue(),\n-                                                                                                                                               binder.getModel()));\n+                                                                                                event -> processFieldChange(formField, event.getNewValue()));\n             unsubscribeHandlers.add(unsubscribeHandle);\n         }\n     }\n \n+    protected void notifyFieldChange(String fieldName, Object newValue) {\n+        fieldChangeManager.notifyFieldChange(fieldName, newValue);\n+    }\n+\n+    protected void processFieldChange(FormField formField, Object newValue) {\n+        if(enabledOnChangeValidations) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "8d2a5cc991936368e20c6be51d4ccf1e87f75cf7"}, "originalPosition": 81}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjM4NDA0NTU1OnYy", "diffSide": "RIGHT", "path": "kie-wb-common-forms/kie-wb-common-forms-commons/kie-wb-common-forms-processing-engine/src/main/java/org/kie/workbench/common/forms/processing/engine/handling/impl/FormHandlerImpl.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yN1QwNzo0NzowNFrOFvH_Qw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yN1QwNzo0NzowNFrOFvH_Qw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NDk1ODI3NQ==", "bodyText": "minor: kiegrooup formatting", "url": "https://github.com/kiegroup/kie-wb-common/pull/3188#discussion_r384958275", "createdAt": "2020-02-27T07:47:04Z", "author": {"login": "jomarko"}, "path": "kie-wb-common-forms/kie-wb-common-forms-commons/kie-wb-common-forms-processing-engine/src/main/java/org/kie/workbench/common/forms/processing/engine/handling/impl/FormHandlerImpl.java", "diffHunk": "@@ -239,7 +252,51 @@ public void clear() {\n         form = null;\n     }\n \n+    private void flushNestedForms() {\n+        form.getFields().stream()\n+                .filter(formField -> formField.getWidget() instanceof NeedsFlush)\n+                .map(formField -> (NeedsFlush) formField.getWidget())\n+                .forEach(NeedsFlush::flush);\n+    }\n+\n+    @Override\n+    public void maybeFlush() {\n+\n+        if(binder == null) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "8d2a5cc991936368e20c6be51d4ccf1e87f75cf7"}, "originalPosition": 114}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjM4NDA1MjU4OnYy", "diffSide": "RIGHT", "path": "kie-wb-common-forms/kie-wb-common-forms-commons/kie-wb-common-forms-processing-engine/src/main/java/org/kie/workbench/common/forms/processing/engine/handling/impl/FormHandlerImpl.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yN1QwNzo0OTo0OVrOFvIDaA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yN1QwODo1OToyMlrOFvJ3Lw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NDk1OTMzNg==", "bodyText": "no methods seems be throwing exception, can't be as below?:\n            flushNestedForms();\n\n            BindableProxy<T> proxy = (BindableProxy<T>) getModel();\n\n            T model = proxy.deepUnwrap();\n\n            T backupModel = proxy.deepUnwrap();\n\n            binder.setModel(model, StateSync.FROM_UI, true);\n\n            if (!validate()) {\n                binder.setModel(backupModel, StateSync.FROM_MODEL, true);\n                validate();\n            }\n        \n            setEnabledOnChangeValidations(true);", "url": "https://github.com/kiegroup/kie-wb-common/pull/3188#discussion_r384959336", "createdAt": "2020-02-27T07:49:49Z", "author": {"login": "jomarko"}, "path": "kie-wb-common-forms/kie-wb-common-forms-commons/kie-wb-common-forms-processing-engine/src/main/java/org/kie/workbench/common/forms/processing/engine/handling/impl/FormHandlerImpl.java", "diffHunk": "@@ -239,7 +252,51 @@ public void clear() {\n         form = null;\n     }\n \n+    private void flushNestedForms() {\n+        form.getFields().stream()\n+                .filter(formField -> formField.getWidget() instanceof NeedsFlush)\n+                .map(formField -> (NeedsFlush) formField.getWidget())\n+                .forEach(NeedsFlush::flush);\n+    }\n+\n+    @Override\n+    public void maybeFlush() {\n+\n+        if(binder == null) {\n+            return;\n+        }\n+\n+        setEnabledOnChangeValidations(false);\n+\n+        try {\n+            flushNestedForms();\n+\n+            BindableProxy<T> proxy = (BindableProxy<T>) getModel();\n+\n+            T model = proxy.deepUnwrap();\n+\n+            T backupModel = proxy.deepUnwrap();\n+\n+            binder.setModel(model, StateSync.FROM_UI, true);\n+\n+            if (!validate()) {\n+                binder.setModel(backupModel, StateSync.FROM_MODEL, true);\n+                validate();\n+            }\n+        } finally {\n+            setEnabledOnChangeValidations(true);\n+        }", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "8d2a5cc991936368e20c6be51d4ccf1e87f75cf7"}, "originalPosition": 137}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NDk4ODk3NQ==", "bodyText": "Well, there might be cases that Exceptions could be thrown during the form validation, kind of unlikely but possile. That's why I added the try-finally to make sure the FormHandler goes back to the normal state", "url": "https://github.com/kiegroup/kie-wb-common/pull/3188#discussion_r384988975", "createdAt": "2020-02-27T08:59:22Z", "author": {"login": "pefernan"}, "path": "kie-wb-common-forms/kie-wb-common-forms-commons/kie-wb-common-forms-processing-engine/src/main/java/org/kie/workbench/common/forms/processing/engine/handling/impl/FormHandlerImpl.java", "diffHunk": "@@ -239,7 +252,51 @@ public void clear() {\n         form = null;\n     }\n \n+    private void flushNestedForms() {\n+        form.getFields().stream()\n+                .filter(formField -> formField.getWidget() instanceof NeedsFlush)\n+                .map(formField -> (NeedsFlush) formField.getWidget())\n+                .forEach(NeedsFlush::flush);\n+    }\n+\n+    @Override\n+    public void maybeFlush() {\n+\n+        if(binder == null) {\n+            return;\n+        }\n+\n+        setEnabledOnChangeValidations(false);\n+\n+        try {\n+            flushNestedForms();\n+\n+            BindableProxy<T> proxy = (BindableProxy<T>) getModel();\n+\n+            T model = proxy.deepUnwrap();\n+\n+            T backupModel = proxy.deepUnwrap();\n+\n+            binder.setModel(model, StateSync.FROM_UI, true);\n+\n+            if (!validate()) {\n+                binder.setModel(backupModel, StateSync.FROM_MODEL, true);\n+                validate();\n+            }\n+        } finally {\n+            setEnabledOnChangeValidations(true);\n+        }", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NDk1OTMzNg=="}, "originalCommit": {"oid": "8d2a5cc991936368e20c6be51d4ccf1e87f75cf7"}, "originalPosition": 137}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1541, "cost": 1, "resetAt": "2021-11-12T20:28:25Z"}}}