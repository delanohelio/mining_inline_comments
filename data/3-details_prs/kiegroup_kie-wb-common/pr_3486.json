{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTIxODM2MjQw", "number": 3486, "title": "[KOGITO-2515] DMN Editor decision service wrong layout", "bodyText": "JIRA: KOGITO-2515\nThis issue is caused due the order of the DMNShape nodes in the .dmn files. If the Decision Service is before its children nodes, then it works. Otherwise it happens the scenario described in the JIRA (nodes in wrong position).\nThis PR ensure that all the Decision Nodes are positioned first when unmarshalling despite the order in the .dmn file.\n\n\nHow to retest this PR or trigger a specific build:\n\n\nRetest PR: jenkins retest this\nA full downstream build: jenkins do fdb\nA compile downstream build: jenkins do cdb\nA full production downstream build: jenkins do product fdb\nAn upstream build: jenkins do upstream", "createdAt": "2020-11-16T18:04:49Z", "url": "https://github.com/kiegroup/kie-wb-common/pull/3486", "merged": true, "mergeCommit": {"oid": "e02ed04643f128100582d83a72a14d44efea21d3"}, "closed": true, "closedAt": "2020-12-08T13:44:54Z", "author": {"login": "danielzhe"}, "timelineItems": {"totalCount": 13, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABddt38EABqjQwMTA1NzUwODU=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdkJ1AUgFqTU0NzIxNDMzNQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "a177d850b4dc4eaa9ceaf21388faf71cb1257820", "author": {"user": {"login": "danielzhe", "name": "Daniel J dos Santos"}}, "url": "https://github.com/kiegroup/kie-wb-common/commit/a177d850b4dc4eaa9ceaf21388faf71cb1257820", "committedDate": "2020-11-16T17:57:46Z", "message": "KOGITO-2515: DMN Editor decision service wrong layout"}, "afterCommit": {"oid": "00f99e85edf819fc187763060e7ab5051e2386bb", "author": {"user": {"login": "karreiro", "name": "Guilherme Carreiro"}}, "url": "https://github.com/kiegroup/kie-wb-common/commit/00f99e85edf819fc187763060e7ab5051e2386bb", "committedDate": "2020-11-17T12:25:30Z", "message": "Add integration test (prevent KOGITO-2515 regression)"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "00f99e85edf819fc187763060e7ab5051e2386bb", "author": {"user": {"login": "karreiro", "name": "Guilherme Carreiro"}}, "url": "https://github.com/kiegroup/kie-wb-common/commit/00f99e85edf819fc187763060e7ab5051e2386bb", "committedDate": "2020-11-17T12:25:30Z", "message": "Add integration test (prevent KOGITO-2515 regression)"}, "afterCommit": {"oid": "8eb5e54e21f71db20a463ee3e5660c96153b037b", "author": {"user": {"login": "karreiro", "name": "Guilherme Carreiro"}}, "url": "https://github.com/kiegroup/kie-wb-common/commit/8eb5e54e21f71db20a463ee3e5660c96153b037b", "committedDate": "2020-11-18T12:24:23Z", "message": "Add integration test (prevent KOGITO-2515 regression)"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTMzNTUzMjE4", "url": "https://github.com/kiegroup/kie-wb-common/pull/3486#pullrequestreview-533553218", "createdAt": "2020-11-18T15:19:17Z", "commit": {"oid": "8eb5e54e21f71db20a463ee3e5660c96153b037b"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTM2NDk0Mzc0", "url": "https://github.com/kiegroup/kie-wb-common/pull/3486#pullrequestreview-536494374", "createdAt": "2020-11-23T13:57:24Z", "commit": {"oid": "8eb5e54e21f71db20a463ee3e5660c96153b037b"}, "state": "COMMENTED", "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0yM1QxMzo1NzoyNVrOH4OioA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0yM1QxNDowMjo0N1rOH4OvoA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyODcyMDU0NA==", "bodyText": "I think this import is not used.", "url": "https://github.com/kiegroup/kie-wb-common/pull/3486#discussion_r528720544", "createdAt": "2020-11-23T13:57:25Z", "author": {"login": "jomarko"}, "path": "kie-wb-common-dmn/kie-wb-common-dmn-client/src/main/java/org/kie/workbench/common/dmn/client/marshaller/unmarshall/nodes/NodeEntriesFactory.java", "diffHunk": "@@ -17,6 +17,7 @@\n package org.kie.workbench.common.dmn.client.marshaller.unmarshall.nodes;\n \n import java.util.ArrayList;\n+import java.util.Comparator;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "8eb5e54e21f71db20a463ee3e5660c96153b037b"}, "originalPosition": 4}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyODcyMTc1OQ==", "bodyText": "shouldn't we return 1 just in case !JSITDecisionService.instanceOf(n1.getDmnElement()) && JSITDecisionService.instanceOf(n2.getDmnElement()) ?", "url": "https://github.com/kiegroup/kie-wb-common/pull/3486#discussion_r528721759", "createdAt": "2020-11-23T13:59:24Z", "author": {"login": "jomarko"}, "path": "kie-wb-common-dmn/kie-wb-common-dmn-client/src/main/java/org/kie/workbench/common/dmn/client/marshaller/unmarshall/nodes/NodeEntriesFactory.java", "diffHunk": "@@ -76,6 +78,18 @@ public NodeEntriesFactory(final StunnerConverter nodeFactory,\n                 .withComponentWidthsConsumer(componentWidthsConsumer)\n                 .buildEntries();\n \n+        // We need to put all the Decision Services at the begin of the list otherwise the nodes inside\n+        // those Decision Services will not be correctly positioned since its parents (the Decision Services nodes)\n+        // needs to be positioned first.\n+        nodeEntries.sort((n1, n2) -> {\n+            if (JSITDecisionService.instanceOf(n1.getDmnElement())) {\n+                return -1;\n+            } else if (JSITDecisionService.instanceOf(n2.getDmnElement())){\n+                return 1;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "8eb5e54e21f71db20a463ee3e5660c96153b037b"}, "originalPosition": 27}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyODcyMzg3Mg==", "bodyText": "shouldn't these resources contain more DecisionService nodes so we check NodeEntriesFactory changes more complexly ?", "url": "https://github.com/kiegroup/kie-wb-common/pull/3486#discussion_r528723872", "createdAt": "2020-11-23T14:02:47Z", "author": {"login": "jomarko"}, "path": "kie-wb-common-dmn/kie-wb-common-dmn-webapp-kogito-runtime/src/test/java/org/kie/workbench/common/dmn/showcase/client/selenium/DMNDesignerKogitoSeleniumIT.java", "diffHunk": "@@ -1745,6 +1745,25 @@ public void testDMNModelWithoutDMNDI_KOGITO3696() throws Exception {\n                 .areIdentical();\n     }\n \n+    @Test\n+    public void testDecisionServiceWrongLayout_KOGITO2515() throws Exception {\n+        final String expected = loadResource(\"KOGITO-2515 (DMN model with decision services - expected).xml\");\n+        final String fixture = loadResource(\"KOGITO-2515 (DMN model with decision services - fixture).xml\");", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "8eb5e54e21f71db20a463ee3e5660c96153b037b"}, "originalPosition": 7}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "e6b8b333284c1ca688df15f965dadea24d3f7f25", "author": {"user": {"login": "danielzhe", "name": "Daniel J dos Santos"}}, "url": "https://github.com/kiegroup/kie-wb-common/commit/e6b8b333284c1ca688df15f965dadea24d3f7f25", "committedDate": "2020-11-23T20:21:43Z", "message": "Merge branch 'KOGITO-2515' of https://github.com/danielzhe/kie-wb-common into KOGITO-2515"}, "afterCommit": {"oid": "9fa90df963286b5c19b4dc13309932ae253ac4f8", "author": {"user": {"login": "danielzhe", "name": "Daniel J dos Santos"}}, "url": "https://github.com/kiegroup/kie-wb-common/commit/9fa90df963286b5c19b4dc13309932ae253ac4f8", "committedDate": "2020-11-23T20:23:46Z", "message": "code style"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "9fa90df963286b5c19b4dc13309932ae253ac4f8", "author": {"user": {"login": "danielzhe", "name": "Daniel J dos Santos"}}, "url": "https://github.com/kiegroup/kie-wb-common/commit/9fa90df963286b5c19b4dc13309932ae253ac4f8", "committedDate": "2020-11-23T20:23:46Z", "message": "code style"}, "afterCommit": {"oid": "e3211fbb8599cbc198720aa680bc35c522ead443", "author": {"user": {"login": "danielzhe", "name": "Daniel J dos Santos"}}, "url": "https://github.com/kiegroup/kie-wb-common/commit/e3211fbb8599cbc198720aa680bc35c522ead443", "committedDate": "2020-11-24T11:20:44Z", "message": "code style"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ca598542452c884c04182035e0905636d7098043", "author": {"user": {"login": "danielzhe", "name": "Daniel J dos Santos"}}, "url": "https://github.com/kiegroup/kie-wb-common/commit/ca598542452c884c04182035e0905636d7098043", "committedDate": "2020-11-25T13:29:11Z", "message": "KOGITO-2515: DMN Editor decision service wrong layout"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "46e4168c250507772f6f155af7f62404cf624664", "author": {"user": {"login": "karreiro", "name": "Guilherme Carreiro"}}, "url": "https://github.com/kiegroup/kie-wb-common/commit/46e4168c250507772f6f155af7f62404cf624664", "committedDate": "2020-11-25T13:29:11Z", "message": "Add integration test (prevent KOGITO-2515 regression)"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "60cfd4fd8e401992fa45ca430ba5fe81984a63e6", "author": {"user": {"login": "danielzhe", "name": "Daniel J dos Santos"}}, "url": "https://github.com/kiegroup/kie-wb-common/commit/60cfd4fd8e401992fa45ca430ba5fe81984a63e6", "committedDate": "2020-11-25T13:29:11Z", "message": "code style"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e43a75a61e8038fa27715a5356babbb1558158b5", "author": {"user": {"login": "danielzhe", "name": "Daniel J dos Santos"}}, "url": "https://github.com/kiegroup/kie-wb-common/commit/e43a75a61e8038fa27715a5356babbb1558158b5", "committedDate": "2020-11-25T20:44:49Z", "message": "Models updated to the new Decision Service nodes order."}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "e3211fbb8599cbc198720aa680bc35c522ead443", "author": {"user": {"login": "danielzhe", "name": "Daniel J dos Santos"}}, "url": "https://github.com/kiegroup/kie-wb-common/commit/e3211fbb8599cbc198720aa680bc35c522ead443", "committedDate": "2020-11-24T11:20:44Z", "message": "code style"}, "afterCommit": {"oid": "e43a75a61e8038fa27715a5356babbb1558158b5", "author": {"user": {"login": "danielzhe", "name": "Daniel J dos Santos"}}, "url": "https://github.com/kiegroup/kie-wb-common/commit/e43a75a61e8038fa27715a5356babbb1558158b5", "committedDate": "2020-11-25T20:44:49Z", "message": "Models updated to the new Decision Service nodes order."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTQ3MTE2MDkx", "url": "https://github.com/kiegroup/kie-wb-common/pull/3486#pullrequestreview-547116091", "createdAt": "2020-12-08T11:11:05Z", "commit": {"oid": "e43a75a61e8038fa27715a5356babbb1558158b5"}, "state": "COMMENTED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTQ3MjE0MzM1", "url": "https://github.com/kiegroup/kie-wb-common/pull/3486#pullrequestreview-547214335", "createdAt": "2020-12-08T13:05:33Z", "commit": {"oid": "e43a75a61e8038fa27715a5356babbb1558158b5"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 369, "cost": 1, "resetAt": "2021-11-01T15:33:45Z"}}}