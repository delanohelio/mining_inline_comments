{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0MzY4OTQxNzI0", "number": 3130, "title": "RHPAM-2182 - Multiple Instance data input and output lack of Data Typ\u2026", "bodyText": "\u2026e definition", "createdAt": "2020-01-30T08:20:41Z", "url": "https://github.com/kiegroup/kie-wb-common/pull/3130", "merged": true, "mergeCommit": {"oid": "9d52649430c80628467bdb16837d73dcfdd0fd28"}, "closed": true, "closedAt": "2020-02-05T18:34:31Z", "author": {"login": "hasys"}, "timelineItems": {"totalCount": 7, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABb_WHjPgH2gAyMzY4OTQxNzI0OmM5OGJlOTFjMTA4OWJmY2Q2MjE5MGIzZjQxYjRkMTAzZTkxZTk5NmQ=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcBZCmCAFqTM1Mzg3NTQ3Ng==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "c98be91c1089bfcd62190b3f41b4d103e91e996d", "author": {"user": {"login": "hasys", "name": "Kirill Gaevskii"}}, "url": "https://github.com/kiegroup/kie-wb-common/commit/c98be91c1089bfcd62190b3f41b4d103e91e996d", "committedDate": "2020-01-30T08:18:19Z", "message": "RHPAM-2182 - Multiple Instance data input and output lack of Data Type definition"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzUwOTMzMzIy", "url": "https://github.com/kiegroup/kie-wb-common/pull/3130#pullrequestreview-350933322", "createdAt": "2020-01-30T15:53:29Z", "commit": {"oid": "c98be91c1089bfcd62190b3f41b4d103e91e996d"}, "state": "COMMENTED", "comments": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0zMFQxNTo1MzoyOVrOFjwIZQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0zMFQxNTo1Nzo1MlrOFjwTXw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MzAzMzA2MQ==", "bodyText": "maybe would resolut more readable to use Streams here, you can perform a map operation and finally collect into a Map type.. Anyway nothing major.", "url": "https://github.com/kiegroup/kie-wb-common/pull/3130#discussion_r373033061", "createdAt": "2020-01-30T15:53:29Z", "author": {"login": "romartin"}, "path": "kie-wb-common-stunner/kie-wb-common-stunner-sets/kie-wb-common-stunner-bpmn/kie-wb-common-stunner-bpmn-client/src/main/java/org/kie/workbench/common/stunner/bpmn/client/forms/fields/multipleInstanceVariableEditor/MultipleInstanceVariableEditorPresenter.java", "diffHunk": "@@ -53,18 +89,97 @@ protected IsElement getView() {\n \n     @Override\n     public void setValue(String value) {\n-        super.setValue(value);\n-        view.setVariableName(value);\n+        super.value = value;\n+        Variable variable = Variable.deserialize(value, Variable.VariableType.INPUT, simpleDataTypes);\n+        view.setModel(variable);\n     }\n \n     @Override\n     public void setReadOnly(boolean readOnly) {\n         view.setReadOnly(readOnly);\n     }\n \n-    public void onVariableNameChange() {\n+    public void onVariableChange() {\n         String oldValue = value;\n-        value = view.getVariableName();\n+        value = view.getVariableName() + \":\" + view.getVariableType();\n         notifyChange(oldValue, value);\n     }\n+\n+    public Path getDiagramPath() {\n+        final Diagram diagram = sessionManager.getCurrentSession().getCanvasHandler().getDiagram();\n+        return diagram.getMetadata().getPath();\n+    }\n+\n+    public static Map<String, String> getMapDataTypeNamesToDisplayNames() {\n+        return mapDataTypeNamesToDisplayNames;\n+    }\n+\n+    private static Map<String, String> createMapForSimpleDataTypes() {\n+        Map<String, String> mapDataTypeNamesToDisplayNames = new HashMap<>();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c98be91c1089bfcd62190b3f41b4d103e91e996d"}, "originalPosition": 102}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MzAzMzUzOQ==", "bodyText": "same here, maybe using Streams may result more readable.", "url": "https://github.com/kiegroup/kie-wb-common/pull/3130#discussion_r373033539", "createdAt": "2020-01-30T15:54:13Z", "author": {"login": "romartin"}, "path": "kie-wb-common-stunner/kie-wb-common-stunner-sets/kie-wb-common-stunner-bpmn/kie-wb-common-stunner-bpmn-client/src/main/java/org/kie/workbench/common/stunner/bpmn/client/forms/fields/multipleInstanceVariableEditor/MultipleInstanceVariableEditorPresenter.java", "diffHunk": "@@ -53,18 +89,97 @@ protected IsElement getView() {\n \n     @Override\n     public void setValue(String value) {\n-        super.setValue(value);\n-        view.setVariableName(value);\n+        super.value = value;\n+        Variable variable = Variable.deserialize(value, Variable.VariableType.INPUT, simpleDataTypes);\n+        view.setModel(variable);\n     }\n \n     @Override\n     public void setReadOnly(boolean readOnly) {\n         view.setReadOnly(readOnly);\n     }\n \n-    public void onVariableNameChange() {\n+    public void onVariableChange() {\n         String oldValue = value;\n-        value = view.getVariableName();\n+        value = view.getVariableName() + \":\" + view.getVariableType();\n         notifyChange(oldValue, value);\n     }\n+\n+    public Path getDiagramPath() {\n+        final Diagram diagram = sessionManager.getCurrentSession().getCanvasHandler().getDiagram();\n+        return diagram.getMetadata().getPath();\n+    }\n+\n+    public static Map<String, String> getMapDataTypeNamesToDisplayNames() {\n+        return mapDataTypeNamesToDisplayNames;\n+    }\n+\n+    private static Map<String, String> createMapForSimpleDataTypes() {\n+        Map<String, String> mapDataTypeNamesToDisplayNames = new HashMap<>();\n+        for (String simpleDataType : simpleDataTypes) {\n+            mapDataTypeNamesToDisplayNames.put(simpleDataType, simpleDataType);\n+        }\n+        return mapDataTypeNamesToDisplayNames;\n+    }\n+\n+    public static IThenable.ThenOnFulfilledCallbackFn<List<String>, Object> getListObjectThenOnFulfilledCallbackFn(List<String> simpleDataTypes, ListBoxValues dataTypeListBoxValues) {\n+        return serverDataTypes -> {\n+            List<String> mergedList = new ArrayList<>(simpleDataTypes);\n+\n+            for (String type : serverDataTypes) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c98be91c1089bfcd62190b3f41b4d103e91e996d"}, "originalPosition": 113}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MzAzNDg3MA==", "bodyText": "I see lots of public (and some static) methods in this class, there are others below. Are those really necessary to be public? It's better using private by default, in case you need access from test, you can also use package protected access (no access modifier specified)", "url": "https://github.com/kiegroup/kie-wb-common/pull/3130#discussion_r373034870", "createdAt": "2020-01-30T15:56:19Z", "author": {"login": "romartin"}, "path": "kie-wb-common-stunner/kie-wb-common-stunner-sets/kie-wb-common-stunner-bpmn/kie-wb-common-stunner-bpmn-client/src/main/java/org/kie/workbench/common/stunner/bpmn/client/forms/fields/multipleInstanceVariableEditor/MultipleInstanceVariableEditorPresenter.java", "diffHunk": "@@ -53,18 +89,97 @@ protected IsElement getView() {\n \n     @Override\n     public void setValue(String value) {\n-        super.setValue(value);\n-        view.setVariableName(value);\n+        super.value = value;\n+        Variable variable = Variable.deserialize(value, Variable.VariableType.INPUT, simpleDataTypes);\n+        view.setModel(variable);\n     }\n \n     @Override\n     public void setReadOnly(boolean readOnly) {\n         view.setReadOnly(readOnly);\n     }\n \n-    public void onVariableNameChange() {\n+    public void onVariableChange() {\n         String oldValue = value;\n-        value = view.getVariableName();\n+        value = view.getVariableName() + \":\" + view.getVariableType();\n         notifyChange(oldValue, value);\n     }\n+\n+    public Path getDiagramPath() {\n+        final Diagram diagram = sessionManager.getCurrentSession().getCanvasHandler().getDiagram();\n+        return diagram.getMetadata().getPath();\n+    }\n+\n+    public static Map<String, String> getMapDataTypeNamesToDisplayNames() {\n+        return mapDataTypeNamesToDisplayNames;\n+    }\n+\n+    private static Map<String, String> createMapForSimpleDataTypes() {\n+        Map<String, String> mapDataTypeNamesToDisplayNames = new HashMap<>();\n+        for (String simpleDataType : simpleDataTypes) {\n+            mapDataTypeNamesToDisplayNames.put(simpleDataType, simpleDataType);\n+        }\n+        return mapDataTypeNamesToDisplayNames;\n+    }\n+\n+    public static IThenable.ThenOnFulfilledCallbackFn<List<String>, Object> getListObjectThenOnFulfilledCallbackFn(List<String> simpleDataTypes, ListBoxValues dataTypeListBoxValues) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c98be91c1089bfcd62190b3f41b4d103e91e996d"}, "originalPosition": 109}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MzAzNTg3MQ==", "bodyText": "is this clean up necessary? I would suggest not sharing variables across tests, so no need to clean up. The JVM will do that for you :)", "url": "https://github.com/kiegroup/kie-wb-common/pull/3130#discussion_r373035871", "createdAt": "2020-01-30T15:57:52Z", "author": {"login": "romartin"}, "path": "kie-wb-common-stunner/kie-wb-common-stunner-sets/kie-wb-common-stunner-bpmn/kie-wb-common-stunner-bpmn-client/src/test/java/org/kie/workbench/common/stunner/bpmn/client/forms/fields/multipleInstanceVariableEditor/MultipleInstanceVariableEditorPresenterTest.java", "diffHunk": "@@ -65,8 +85,118 @@ public void testSetReadonlyFalse() {\n     public void testOnVariableNameChange() {\n         editor.setValue(\"oldValue\");\n         when(view.getVariableName()).thenReturn(\"newValue\");\n-        editor.onVariableNameChange();\n-        verifyValueChange(\"oldValue\", \"newValue\");\n+        when(view.getVariableType()).thenReturn(\"Float\");\n+        editor.onVariableChange();\n+        verifyValueChange(\"oldValue\", \"newValue:Float\");\n+    }\n+\n+    @Test\n+    public void testFirstIfExistsOrSecond() {\n+        String first;\n+        String second = \"some value\";\n+\n+        assertEquals(second, getFirstIfExistsOrSecond(null, second));\n+\n+        first = \"\";\n+        assertEquals(second, getFirstIfExistsOrSecond(first, second));\n+\n+        first = \"new value\";\n+        assertEquals(first, getFirstIfExistsOrSecond(first, second));\n+    }\n+\n+    @Test\n+    public void testFullListOfTypes() {\n+        List<String> testData = new ArrayList<>();\n+        testData.add(\"org.test.Person\");\n+        testData.add(\"java.util.List\");\n+\n+        getListObjectThenOnFulfilledCallbackFn(simpleDataTypes, new ListBoxValues(\"Custom\", \"Edit\", null)).onInvoke(testData);\n+\n+        assertEquals(\"org.test.Person\", getMapDataTypeNamesToDisplayNames().get(\"Person [org.test]\"));\n+        assertEquals(\"java.util.List\", getMapDataTypeNamesToDisplayNames().get(\"List [java.util]\"));\n+\n+        // Clean up\n+        getMapDataTypeNamesToDisplayNames().remove(\"Person [org.test]\");", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c98be91c1089bfcd62190b3f41b4d103e91e996d"}, "originalPosition": 93}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "af79b28125184295458c88ff3cab78123d2cf3a0", "author": {"user": {"login": "hasys", "name": "Kirill Gaevskii"}}, "url": "https://github.com/kiegroup/kie-wb-common/commit/af79b28125184295458c88ff3cab78123d2cf3a0", "committedDate": "2020-01-30T23:12:51Z", "message": "PR review and missing tests"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "69265e9b8d40f35d8143bfa53657a5677a479f5f", "author": {"user": {"login": "hasys", "name": "Kirill Gaevskii"}}, "url": "https://github.com/kiegroup/kie-wb-common/commit/69265e9b8d40f35d8143bfa53657a5677a479f5f", "committedDate": "2020-01-31T02:20:52Z", "message": "More tests"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzUxNzA4Mjk5", "url": "https://github.com/kiegroup/kie-wb-common/pull/3130#pullrequestreview-351708299", "createdAt": "2020-01-31T18:56:55Z", "commit": {"oid": "69265e9b8d40f35d8143bfa53657a5677a479f5f"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzUyMzA1NDU3", "url": "https://github.com/kiegroup/kie-wb-common/pull/3130#pullrequestreview-352305457", "createdAt": "2020-02-03T14:45:41Z", "commit": {"oid": "69265e9b8d40f35d8143bfa53657a5677a479f5f"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzUzODc1NDc2", "url": "https://github.com/kiegroup/kie-wb-common/pull/3130#pullrequestreview-353875476", "createdAt": "2020-02-05T16:50:28Z", "commit": {"oid": "69265e9b8d40f35d8143bfa53657a5677a479f5f"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 687, "cost": 1, "resetAt": "2021-11-01T15:33:45Z"}}}