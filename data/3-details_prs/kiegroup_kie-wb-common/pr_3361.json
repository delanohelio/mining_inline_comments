{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDUzODc2NTQ3", "number": 3361, "title": "KOGITO-543: DMN - Read Only mode", "bodyText": "Part of an ensemble:\nkiegroup/appformer#1034\nThis PR adds the infrastructure to support read-only mode to DMN Diagrams. See here.\nThis PR will make the DMN Editor in Chrome extension open in read only mode by default.\nYou can change this behavior here to make it easier to test the PR in other environments.", "createdAt": "2020-07-20T21:58:57Z", "url": "https://github.com/kiegroup/kie-wb-common/pull/3361", "merged": true, "mergeCommit": {"oid": "fd04debb19865cd227a3a686db0613ecb90d1886"}, "closed": true, "closedAt": "2020-08-27T13:59:59Z", "author": {"login": "danielzhe"}, "timelineItems": {"totalCount": 21, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABc3e-xdABqjM1NzY5OTM5Mzk=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdDA0vggFqTQ3Njc0NjU1Mg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "19d5e5c4d23fb6a19d472e1ce24a96cf5439a2dc", "author": {"user": {"login": "danielzhe", "name": "Daniel J dos Santos"}}, "url": "https://github.com/kiegroup/kie-wb-common/commit/19d5e5c4d23fb6a19d472e1ce24a96cf5439a2dc", "committedDate": "2020-07-20T21:53:32Z", "message": "KOGITO-543: DMN - Read Only mode"}, "afterCommit": {"oid": "1726388592031e58248e20b9e7d9515a1a53688a", "author": {"user": {"login": "danielzhe", "name": "Daniel J dos Santos"}}, "url": "https://github.com/kiegroup/kie-wb-common/commit/1726388592031e58248e20b9e7d9515a1a53688a", "committedDate": "2020-07-22T15:31:06Z", "message": "KOGITO-543: DMN - Read Only mode"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDU1MDgxNTQw", "url": "https://github.com/kiegroup/kie-wb-common/pull/3361#pullrequestreview-455081540", "createdAt": "2020-07-24T17:57:32Z", "commit": {"oid": "f0e81e35f42b58fe1f2b08e538603b7ed3665f0f"}, "state": "COMMENTED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDU2MjAxMzcw", "url": "https://github.com/kiegroup/kie-wb-common/pull/3361#pullrequestreview-456201370", "createdAt": "2020-07-27T23:25:38Z", "commit": {"oid": "385dc18f164761609df27037b43752e0225ec657"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "385dc18f164761609df27037b43752e0225ec657", "author": {"user": {"login": "danielzhe", "name": "Daniel J dos Santos"}}, "url": "https://github.com/kiegroup/kie-wb-common/commit/385dc18f164761609df27037b43752e0225ec657", "committedDate": "2020-07-27T20:31:44Z", "message": "Fixed context menu."}, "afterCommit": {"oid": "f61548de8c7f9ae42dd7278c39fca815c61f797f", "author": {"user": {"login": "danielzhe", "name": "Daniel J dos Santos"}}, "url": "https://github.com/kiegroup/kie-wb-common/commit/f61548de8c7f9ae42dd7278c39fca815c61f797f", "committedDate": "2020-08-03T16:42:34Z", "message": "Changed default behavior."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDYxMzcwMjQ2", "url": "https://github.com/kiegroup/kie-wb-common/pull/3361#pullrequestreview-461370246", "createdAt": "2020-08-05T06:20:54Z", "commit": {"oid": "f61548de8c7f9ae42dd7278c39fca815c61f797f"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0wNVQwNjoyMDo1NFrOG77ybw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0wNVQxMTozMzowN1rOG8Fv0Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NTQ5ODczNQ==", "bodyText": "Couldn't we implement temporarily as return contextProvider != null && contextProvider.getChannel() == GITHUB; ?", "url": "https://github.com/kiegroup/kie-wb-common/pull/3361#discussion_r465498735", "createdAt": "2020-08-05T06:20:54Z", "author": {"login": "jomarko"}, "path": "kie-wb-common-dmn/kie-wb-common-dmn-client/src/main/java/org/kie/workbench/common/dmn/client/api/ReadOnlyProviderImpl.java", "diffHunk": "@@ -0,0 +1,45 @@\n+/*\n+ * Copyright 2020 Red Hat, Inc. and/or its affiliates.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package org.kie.workbench.common.dmn.client.api;\n+\n+import javax.enterprise.context.ApplicationScoped;\n+import javax.enterprise.inject.Alternative;\n+import javax.inject.Inject;\n+\n+import org.appformer.client.context.EditorContextProvider;\n+import org.kie.workbench.common.dmn.api.qualifiers.DMNEditor;\n+import org.kie.workbench.common.stunner.core.client.ReadOnlyProvider;\n+\n+import static org.appformer.client.context.Channel.GITHUB;\n+\n+@Alternative\n+@ApplicationScoped\n+@DMNEditor\n+public class ReadOnlyProviderImpl implements ReadOnlyProvider {\n+\n+    private final EditorContextProvider contextProvider;\n+\n+    @Inject\n+    public ReadOnlyProviderImpl(final EditorContextProvider contextProvider) {\n+        this.contextProvider = contextProvider;\n+    }\n+\n+    @Override\n+    public boolean isReadOnlyDiagram() {\n+        return false;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f61548de8c7f9ae42dd7278c39fca815c61f797f"}, "originalPosition": 43}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NTQ5OTM2MQ==", "bodyText": "If my comment about isReadOnlyDiagram impl will be not applied, this needs to be removed.", "url": "https://github.com/kiegroup/kie-wb-common/pull/3361#discussion_r465499361", "createdAt": "2020-08-05T06:22:41Z", "author": {"login": "jomarko"}, "path": "kie-wb-common-dmn/kie-wb-common-dmn-client/src/main/java/org/kie/workbench/common/dmn/client/api/ReadOnlyProviderImpl.java", "diffHunk": "@@ -0,0 +1,45 @@\n+/*\n+ * Copyright 2020 Red Hat, Inc. and/or its affiliates.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package org.kie.workbench.common.dmn.client.api;\n+\n+import javax.enterprise.context.ApplicationScoped;\n+import javax.enterprise.inject.Alternative;\n+import javax.inject.Inject;\n+\n+import org.appformer.client.context.EditorContextProvider;\n+import org.kie.workbench.common.dmn.api.qualifiers.DMNEditor;\n+import org.kie.workbench.common.stunner.core.client.ReadOnlyProvider;\n+\n+import static org.appformer.client.context.Channel.GITHUB;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f61548de8c7f9ae42dd7278c39fca815c61f797f"}, "originalPosition": 27}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NTUwMzQ3Mw==", "bodyText": "As is single item list, we could use return Collections.singletonList(commonActionsToolboxFactories.get()); as we are just reading created list.", "url": "https://github.com/kiegroup/kie-wb-common/pull/3361#discussion_r465503473", "createdAt": "2020-08-05T06:34:00Z", "author": {"login": "jomarko"}, "path": "kie-wb-common-dmn/kie-wb-common-dmn-client/src/main/java/org/kie/workbench/common/dmn/client/canvas/controls/toolbox/DMNToolboxControl.java", "diffHunk": "@@ -35,18 +36,25 @@\n \n     private final ManagedInstance<ActionsToolboxFactory> flowActionsToolboxFactories;\n     private final ManagedInstance<ActionsToolboxFactory> commonActionsToolboxFactories;\n+    private final ReadOnlyProvider readonlyProvider;\n \n     @Inject\n     public DMNToolboxControl(final @Any @DMNFlowActionsToolbox ManagedInstance<ActionsToolboxFactory> flowActionsToolboxFactories,\n-                             final @Any @DMNCommonActionsToolbox ManagedInstance<ActionsToolboxFactory> commonActionsToolboxFactories) {\n+                             final @Any @DMNCommonActionsToolbox ManagedInstance<ActionsToolboxFactory> commonActionsToolboxFactories,\n+                             final @Any @DMNEditor ReadOnlyProvider readOnlyProvider) {\n         this.flowActionsToolboxFactories = flowActionsToolboxFactories;\n         this.commonActionsToolboxFactories = commonActionsToolboxFactories;\n+        this.readonlyProvider = readOnlyProvider;\n     }\n \n     @Override\n     protected List<ActionsToolboxFactory> getFactories() {\n-        return Arrays.asList(flowActionsToolboxFactories.get(),\n-                             commonActionsToolboxFactories.get());\n+        if (readonlyProvider.isReadOnlyDiagram()) {\n+            return Arrays.asList(commonActionsToolboxFactories.get());", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f61548de8c7f9ae42dd7278c39fca815c61f797f"}, "originalPosition": 29}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NTY2MTkwNQ==", "bodyText": "unused import", "url": "https://github.com/kiegroup/kie-wb-common/pull/3361#discussion_r465661905", "createdAt": "2020-08-05T11:33:07Z", "author": {"login": "jomarko"}, "path": "kie-wb-common-dmn/kie-wb-common-dmn-client/src/test/java/org/kie/workbench/common/dmn/client/api/ReadOnlyProviderImplTest.java", "diffHunk": "@@ -0,0 +1,84 @@\n+/*\n+ * Copyright 2020 Red Hat, Inc. and/or its affiliates.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package org.kie.workbench.common.dmn.client.api;\n+\n+import com.google.gwtmockito.GwtMockitoTestRunner;\n+import org.appformer.client.context.EditorContextProvider;\n+import org.junit.Before;\n+import org.junit.Test;\n+import org.junit.runner.RunWith;\n+import org.mockito.Mock;\n+\n+import static org.appformer.client.context.Channel.DEFAULT;\n+import static org.appformer.client.context.Channel.DESKTOP;\n+import static org.appformer.client.context.Channel.EMBEDDED;\n+import static org.appformer.client.context.Channel.GITHUB;\n+import static org.appformer.client.context.Channel.ONLINE;\n+import static org.appformer.client.context.Channel.VSCODE;\n+import static org.junit.Assert.assertFalse;\n+import static org.junit.Assert.assertTrue;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f61548de8c7f9ae42dd7278c39fca815c61f797f"}, "originalPosition": 33}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDYzMDI2NzYx", "url": "https://github.com/kiegroup/kie-wb-common/pull/3361#pullrequestreview-463026761", "createdAt": "2020-08-07T04:30:28Z", "commit": {"oid": "23549fda8aee6b7b192c1417b9efa0e9cb18075e"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0wN1QwNDozMDoyOFrOG9MFwQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0wN1QwNDozMDoyOFrOG9MFwQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NjgxNDQwMQ==", "bodyText": "please remove this comment", "url": "https://github.com/kiegroup/kie-wb-common/pull/3361#discussion_r466814401", "createdAt": "2020-08-07T04:30:28Z", "author": {"login": "jomarko"}, "path": "kie-wb-common-dmn/kie-wb-common-dmn-client/src/test/java/org/kie/workbench/common/dmn/client/commands/general/BaseNavigationCommandTest.java", "diffHunk": "@@ -109,10 +114,11 @@ public void setup(final boolean isOnlyVisualChangeAllowed) {\n         when(sessionPresenter.getDisplayer()).thenReturn(sessionView);\n         when(sessionView.getView()).thenReturn(view);\n         when(editor.getView()).thenReturn(expressionEditorView);\n+        when(sessionPresenter.getPalette()).thenReturn(palette);\n \n         this.command = spy(getCommand(isOnlyVisualChangeAllowed));\n \n-        doNothing().when(command).hidePaletteWidget(any(Boolean.class));\n+        //doNothing().when(command).hidePaletteWidget(any(Boolean.class));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "23549fda8aee6b7b192c1417b9efa0e9cb18075e"}, "originalPosition": 41}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "54455f3b0fe7847c1f27f7fabb13e0af4307c484", "author": {"user": {"login": "danielzhe", "name": "Daniel J dos Santos"}}, "url": "https://github.com/kiegroup/kie-wb-common/commit/54455f3b0fe7847c1f27f7fabb13e0af4307c484", "committedDate": "2020-08-24T14:30:39Z", "message": "KOGITO-543: DMN - Read Only mode"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "8907b1f5492232e37891ddca7a12b2fbb51990dd", "author": {"user": {"login": "danielzhe", "name": "Daniel J dos Santos"}}, "url": "https://github.com/kiegroup/kie-wb-common/commit/8907b1f5492232e37891ddca7a12b2fbb51990dd", "committedDate": "2020-08-24T14:30:40Z", "message": "Tests."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a33ff7ad3e0f31874290b608b444f807099733c8", "author": {"user": {"login": "danielzhe", "name": "Daniel J dos Santos"}}, "url": "https://github.com/kiegroup/kie-wb-common/commit/a33ff7ad3e0f31874290b608b444f807099733c8", "committedDate": "2020-08-24T14:30:40Z", "message": "Fixed context menu."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "dbd8cfdad2ad2369dd0c6f4216d93af6a184caa6", "author": {"user": {"login": "danielzhe", "name": "Daniel J dos Santos"}}, "url": "https://github.com/kiegroup/kie-wb-common/commit/dbd8cfdad2ad2369dd0c6f4216d93af6a184caa6", "committedDate": "2020-08-24T14:30:40Z", "message": "Changed default behavior."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f6418b91b050e0641fe38740af900a462490baa0", "author": {"user": {"login": "danielzhe", "name": "Daniel J dos Santos"}}, "url": "https://github.com/kiegroup/kie-wb-common/commit/f6418b91b050e0641fe38740af900a462490baa0", "committedDate": "2020-08-24T14:30:41Z", "message": "Code review."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ff9fc17b845614b8f24cbf83dcdfc8cff9b8edcc", "author": {"user": {"login": "jomarko", "name": "Jozef Marko"}}, "url": "https://github.com/kiegroup/kie-wb-common/commit/ff9fc17b845614b8f24cbf83dcdfc8cff9b8edcc", "committedDate": "2020-08-24T14:30:41Z", "message": "Reduce ReadOnlyProvider propagation"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "60668cb5b2bdf3807e6a01dcea4bfef878d26b22", "author": {"user": {"login": "danielzhe", "name": "Daniel J dos Santos"}}, "url": "https://github.com/kiegroup/kie-wb-common/commit/60668cb5b2bdf3807e6a01dcea4bfef878d26b22", "committedDate": "2020-08-24T14:30:41Z", "message": "Changed default behavior."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "3b5438ae696cb16027a97fb3bd732ac844bc3bb0", "author": {"user": {"login": "danielzhe", "name": "Daniel J dos Santos"}}, "url": "https://github.com/kiegroup/kie-wb-common/commit/3b5438ae696cb16027a97fb3bd732ac844bc3bb0", "committedDate": "2020-08-24T14:30:42Z", "message": "Fix test"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "cbc94dfe528c1c51b613f73416cf666c81276ea8", "author": {"user": {"login": "danielzhe", "name": "Daniel J dos Santos"}}, "url": "https://github.com/kiegroup/kie-wb-common/commit/cbc94dfe528c1c51b613f73416cf666c81276ea8", "committedDate": "2020-08-24T14:30:42Z", "message": "Tests."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "fb895c7031a23fcd17fc5f01bdae948d3cebbb14", "author": {"user": {"login": "danielzhe", "name": "Daniel J dos Santos"}}, "url": "https://github.com/kiegroup/kie-wb-common/commit/fb895c7031a23fcd17fc5f01bdae948d3cebbb14", "committedDate": "2020-08-24T17:00:33Z", "message": "Using editor context."}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "92bc53ba9d9e8ef891d5bffbdaeb71aa33dbfff4", "author": {"user": {"login": "danielzhe", "name": "Daniel J dos Santos"}}, "url": "https://github.com/kiegroup/kie-wb-common/commit/92bc53ba9d9e8ef891d5bffbdaeb71aa33dbfff4", "committedDate": "2020-08-13T14:03:35Z", "message": "Tests."}, "afterCommit": {"oid": "fb895c7031a23fcd17fc5f01bdae948d3cebbb14", "author": {"user": {"login": "danielzhe", "name": "Daniel J dos Santos"}}, "url": "https://github.com/kiegroup/kie-wb-common/commit/fb895c7031a23fcd17fc5f01bdae948d3cebbb14", "committedDate": "2020-08-24T17:00:33Z", "message": "Using editor context."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDczNzI0NjA5", "url": "https://github.com/kiegroup/kie-wb-common/pull/3361#pullrequestreview-473724609", "createdAt": "2020-08-24T17:47:59Z", "commit": {"oid": "fb895c7031a23fcd17fc5f01bdae948d3cebbb14"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDc0NDE1NjUx", "url": "https://github.com/kiegroup/kie-wb-common/pull/3361#pullrequestreview-474415651", "createdAt": "2020-08-25T12:09:57Z", "commit": {"oid": "fb895c7031a23fcd17fc5f01bdae948d3cebbb14"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "5fa45dfe4790b552f4742b072cfc9caadf81f507", "author": {"user": {"login": "danielzhe", "name": "Daniel J dos Santos"}}, "url": "https://github.com/kiegroup/kie-wb-common/commit/5fa45dfe4790b552f4742b072cfc9caadf81f507", "committedDate": "2020-08-26T00:41:41Z", "message": "fix"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDc2NzQ2NTUy", "url": "https://github.com/kiegroup/kie-wb-common/pull/3361#pullrequestreview-476746552", "createdAt": "2020-08-27T13:56:37Z", "commit": {"oid": "5fa45dfe4790b552f4742b072cfc9caadf81f507"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 468, "cost": 1, "resetAt": "2021-11-01T15:33:45Z"}}}