{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTEwMjQxODQz", "number": 3466, "reviewThreads": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wMlQxNToxODoyMlrOE0a_tA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wM1QxOToxNDoxOFrOE08gAQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzIzNDAzNzAwOnYy", "diffSide": "RIGHT", "path": "kie-wb-common-stunner/kie-wb-common-stunner-core/kie-wb-common-stunner-commons/kie-wb-common-stunner-client-common/src/main/java/org/kie/workbench/common/stunner/core/client/session/command/impl/DeleteSelectionSessionCommand.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wMlQxNToxODoyMlrOHsIzAw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wMlQxNToxODoyMlrOHsIzAw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNjA0MzUyMw==", "bodyText": "This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters. Learn more about bidirectional Unicode characters\n\n\n  \n\n\n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                        callback.onError((V) new ClientRuntimeError(\"Error deleing elements [message=\" +\n          \n          \n            \n                        callback.onError((V) new ClientRuntimeError(\"Error deleting elements [message=\" +", "url": "https://github.com/kiegroup/kie-wb-common/pull/3466#discussion_r516043523", "createdAt": "2020-11-02T15:18:22Z", "author": {"login": "jstastny-cz"}, "path": "kie-wb-common-stunner/kie-wb-common-stunner-core/kie-wb-common-stunner-commons/kie-wb-common-stunner-client-common/src/main/java/org/kie/workbench/common/stunner/core/client/session/command/impl/DeleteSelectionSessionCommand.java", "diffHunk": "@@ -136,31 +144,55 @@ public boolean accepts(final ClientSession session) {\n             final SelectionControl<AbstractCanvasHandler, Element> selectionControl = getSession().getSelectionControl();\n             final Collection<String> selectedItems = selectionControl.getSelectedItems();\n \n-            clearSelectionEvent.fire(new CanvasClearSelectionEvent(canvasHandler));\n-            selectionControl.clearSelection();\n-\n             if (selectedItems != null && !selectedItems.isEmpty()) {\n-                // Execute the commands.\n-                final CommandResult<CanvasViolation> result =\n-                        sessionCommandManager.execute(canvasHandler,\n-                                                      canvasCommandFactory.delete(selectedItems.stream()\n-                                                                                          .map(uuid -> canvasHandler.getGraphIndex().get(uuid))\n-                                                                                          .filter(Objects::nonNull)\n-                                                                                          .collect(Collectors.toList())));\n-\n-                // Check the results.\n-                if (!CommandUtils.isError(result)) {\n-                    callback.onSuccess();\n+                final List<Element> elements = selectedItems.stream()\n+                        .map(uuid -> canvasHandler.getGraphIndex().get(uuid))\n+                        .filter(Objects::nonNull)\n+                        .collect(Collectors.toList());\n+                if (!Objects.isNull(deleteNodeConfirmation)\n+                        && deleteNodeConfirmation.requiresDeletionConfirmation(elements)) {\n+                    deleteNodeConfirmation.confirmDeletion(() -> executeDelete(elements,\n+                                                                               canvasHandler,\n+                                                                               selectionControl,\n+                                                                               callback),\n+                                                           () -> {\n+                                                               // do nothing if user cancels\n+                                                           },\n+                                                           elements);\n                 } else {\n-                    callback.onError((V) new ClientRuntimeError(\"Error deleing elements [message=\" +\n-                                                                        result.toString() + \"]\"));\n+                    executeDelete(elements,\n+                                  canvasHandler,\n+                                  selectionControl,\n+                                  callback);\n                 }\n             } else {\n                 callback.onError((V) new ClientRuntimeError(\"Cannot delete element, no element selected on canvas\"));\n             }\n         }\n     }\n \n+    private <V> void executeDelete(final List<Element> elements,\n+                                   final AbstractCanvasHandler canvasHandler,\n+                                   final SelectionControl<AbstractCanvasHandler, Element> selectionControl,\n+                                   final Callback<V> callback) {\n+\n+        clearSelectionEvent.fire(new CanvasClearSelectionEvent(canvasHandler));\n+        selectionControl.clearSelection();\n+\n+        // Execute the commands.\n+        final CommandResult<CanvasViolation> result =\n+                sessionCommandManager.execute(canvasHandler,\n+                                              canvasCommandFactory.delete(elements));\n+\n+        // Check the results.\n+        if (!CommandUtils.isError(result)) {\n+            callback.onSuccess();\n+        } else {\n+            callback.onError((V) new ClientRuntimeError(\"Error deleing elements [message=\" +", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "75ed83ea901b1996469308e9157730afcb9f2cae"}, "originalPosition": 131}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzIzOTUyNjQxOnYy", "diffSide": "RIGHT", "path": "kie-wb-common-stunner/kie-wb-common-stunner-client/kie-wb-common-stunner-widgets/src/main/resources/org/kie/workbench/common/stunner/client/widgets/resources/i18n/StunnerWidgetsConstants.properties", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wM1QxOToxNDoxOFrOHs88gw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xMVQxNToyOTo1MlrOHxSFoQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNjg5NzkyMw==", "bodyText": "This message here ;-)", "url": "https://github.com/kiegroup/kie-wb-common/pull/3466#discussion_r516897923", "createdAt": "2020-11-03T19:14:18Z", "author": {"login": "karreiro"}, "path": "kie-wb-common-stunner/kie-wb-common-stunner-client/kie-wb-common-stunner-widgets/src/main/resources/org/kie/workbench/common/stunner/client/widgets/resources/i18n/StunnerWidgetsConstants.properties", "diffHunk": "@@ -1,3 +1,10 @@\n+ConfirmationDialogImplView.Yes=Yes\n+ConfirmationDialogImplView.No=No\n+\n+DeleteNodeConfirmationDialogImpl.ConfirmationDescription=All {0} nodes will be removed from all decision requirements diagrams (DRDs).", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "4db32a8b2e0583e97c958c022fa8f9031c5c80ca"}, "originalPosition": 4}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMTQzODYyNQ==", "bodyText": "@karreiro Thank you, message changed!", "url": "https://github.com/kiegroup/kie-wb-common/pull/3466#discussion_r521438625", "createdAt": "2020-11-11T15:29:52Z", "author": {"login": "danielzhe"}, "path": "kie-wb-common-stunner/kie-wb-common-stunner-client/kie-wb-common-stunner-widgets/src/main/resources/org/kie/workbench/common/stunner/client/widgets/resources/i18n/StunnerWidgetsConstants.properties", "diffHunk": "@@ -1,3 +1,10 @@\n+ConfirmationDialogImplView.Yes=Yes\n+ConfirmationDialogImplView.No=No\n+\n+DeleteNodeConfirmationDialogImpl.ConfirmationDescription=All {0} nodes will be removed from all decision requirements diagrams (DRDs).", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNjg5NzkyMw=="}, "originalCommit": {"oid": "4db32a8b2e0583e97c958c022fa8f9031c5c80ca"}, "originalPosition": 4}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1271, "cost": 1, "resetAt": "2021-11-12T20:28:25Z"}}}