{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTA4MDAyOTcz", "number": 3463, "title": "[7.44.x] DROOLS-5707: [DMN Designer] Multiple DRDs support - Information requirements are duplicated into the DMN XML", "bodyText": "[7.44.x] DROOLS-5707: [DMN Designer] Multiple DRDs support - Information requirements are duplicated into the DMN XML\nJIRA:\n\nDROOLS-5707 - Information requirements are duplicated into the DMN XML\nDROOLS-5749 - When users open a DMN with duplicated information requirements, the marshaller doesn't fix it\n\nBusiness Central: WAR file\n\n\nHow to retest this PR or trigger a specific build:\n\n\nRetest PR: jenkins retest this\nA full downstream build: jenkins do fdb\nA compile downstream build: jenkins do cdb\nA full production downstream build: jenkins do product fdb\nAn upstream build: jenkins do upstream", "createdAt": "2020-10-22T04:26:10Z", "url": "https://github.com/kiegroup/kie-wb-common/pull/3463", "merged": true, "mergeCommit": {"oid": "de942a3d6c1e479dbf6b04cf209b561397ca10bc"}, "closed": true, "closedAt": "2020-10-22T16:47:00Z", "author": {"login": "karreiro"}, "timelineItems": {"totalCount": 6, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdU5h4ZgH2gAyNTA4MDAyOTczOjZhYTY1YzUzMmY3ZjY5YTU3MWFmYmRlMDQ3ZmFhMzNjZjgwZGFlYmE=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdVCQtDAFqTUxNDc0NDkyNA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "6aa65c532f7f69a571afbde047faa33cf80daeba", "author": {"user": {"login": "karreiro", "name": "Guilherme Carreiro"}}, "url": "https://github.com/kiegroup/kie-wb-common/commit/6aa65c532f7f69a571afbde047faa33cf80daeba", "committedDate": "2020-10-22T03:37:19Z", "message": " - [7.44.x] DROOLS-5707: [DMN Designer] Multiple DRDs support - Information requirements are duplicated into the DMN XML\n\n - [7.44.x] DROOLS-5749: [DMN Designer] Multiple DRDs support - When users open a DMN with duplicated information requirements, the marshaller doesn't fix it"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTE0NjMxMDIy", "url": "https://github.com/kiegroup/kie-wb-common/pull/3463#pullrequestreview-514631022", "createdAt": "2020-10-22T11:38:16Z", "commit": {"oid": "6aa65c532f7f69a571afbde047faa33cf80daeba"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yMlQxMTozODoxN1rOHmdd-g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yMlQxMTozODoxN1rOHmdd-g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMDA5MDc0Ng==", "bodyText": "Could we add here second argument and combine the lists like:\nprivate <T extends JSITDMNElement> List<T> distinct(final List<T> list, final List<T> secondList) {\n    List<T> toBeProcessed = new ArrayList(list);\n    toBeProcessed.addAll(secondList);\n    // the rest is the same, just process the combined list\n    final Map<String, T> map = new HashMap<>();\n    forEach(toBeProcessed, item -> {\n        map.putIfAbsent(item.getId(), Js.uncheckedCast(item));\n    });\n    return new ArrayList<>(map.values());\n}\n\nThe usage then wouldn't need to first to invoke addAllAuthorityRequirement and then retrospectively filtering and setting using setAuthorityRequirement.\nResulting in a single call for each requirement type\nexistingKnowledgeSource.setAuthorityRequirement(\n    distinct(\n        existingKnowledgeSource.getAuthorityRequirement(),\n        nodeKnowledgeSource.getAuthorityRequirement()\n    )\n);\n\nwhich is IMO nicer than\nexistingKnowledgeSource.addAllAuthorityRequirement(nodeKnowledgeSource.getAuthorityRequirement().toArray(new JSITAuthorityRequirement[0]));\nexistingKnowledgeSource.setAuthorityRequirement(distinct(existingKnowledgeSource.getAuthorityRequirement()));", "url": "https://github.com/kiegroup/kie-wb-common/pull/3463#discussion_r510090746", "createdAt": "2020-10-22T11:38:17Z", "author": {"login": "jstastny-cz"}, "path": "kie-wb-common-dmn/kie-wb-common-dmn-client/src/main/java/org/kie/workbench/common/dmn/client/marshaller/marshall/DMNMarshaller.java", "diffHunk": "@@ -355,33 +365,41 @@ private void mergeNodeRequirements(final JSITDRGElement node,\n             final JSITBusinessKnowledgeModel existingBkm = Js.uncheckedCast(existingDRGElement);\n             final JSITBusinessKnowledgeModel nodeBkm = Js.uncheckedCast(node);\n \n-            final List<JSITAuthorityRequirement> authorityRequirement = nodeBkm.getAuthorityRequirement();\n-            final List<JSITKnowledgeRequirement> knowledgeRequirement = nodeBkm.getKnowledgeRequirement();\n+            existingBkm.addAllAuthorityRequirement(nodeBkm.getAuthorityRequirement().toArray(new JSITAuthorityRequirement[0]));\n+            existingBkm.addAllKnowledgeRequirement(nodeBkm.getKnowledgeRequirement().toArray(new JSITKnowledgeRequirement[0]));\n \n-            existingBkm.addAllAuthorityRequirement(authorityRequirement.toArray(new JSITAuthorityRequirement[0]));\n-            existingBkm.addAllKnowledgeRequirement(knowledgeRequirement.toArray(new JSITKnowledgeRequirement[0]));\n+            existingBkm.setAuthorityRequirement(distinct(existingBkm.getAuthorityRequirement()));\n+            existingBkm.setKnowledgeRequirement(distinct(existingBkm.getKnowledgeRequirement()));\n         } else if (instanceOfDecision(node)) {\n \n             final JSITDecision existingDecision = Js.uncheckedCast(existingDRGElement);\n             final JSITDecision nodeDecision = Js.uncheckedCast(node);\n \n-            final List<JSITAuthorityRequirement> authorityRequirement = nodeDecision.getAuthorityRequirement();\n-            final List<JSITInformationRequirement> informationRequirement = nodeDecision.getInformationRequirement();\n-            final List<JSITKnowledgeRequirement> knowledgeRequirement = nodeDecision.getKnowledgeRequirement();\n+            existingDecision.addAllAuthorityRequirement(nodeDecision.getAuthorityRequirement().toArray(new JSITAuthorityRequirement[0]));\n+            existingDecision.addAllInformationRequirement(nodeDecision.getInformationRequirement().toArray(new JSITInformationRequirement[0]));\n+            existingDecision.addAllKnowledgeRequirement(nodeDecision.getKnowledgeRequirement().toArray(new JSITKnowledgeRequirement[0]));\n \n-            existingDecision.addAllAuthorityRequirement(authorityRequirement.toArray(new JSITAuthorityRequirement[0]));\n-            existingDecision.addAllInformationRequirement(informationRequirement.toArray(new JSITInformationRequirement[0]));\n-            existingDecision.addAllKnowledgeRequirement(knowledgeRequirement.toArray(new JSITKnowledgeRequirement[0]));\n+            existingDecision.setAuthorityRequirement(distinct(existingDecision.getAuthorityRequirement()));\n+            existingDecision.setInformationRequirement(distinct(existingDecision.getInformationRequirement()));\n+            existingDecision.setKnowledgeRequirement(distinct(existingDecision.getKnowledgeRequirement()));\n         } else if (instanceOfKnowledgeSource(node)) {\n \n             final JSITKnowledgeSource existingKnowledgeSource = Js.uncheckedCast(existingDRGElement);\n             final JSITKnowledgeSource nodeKnowledgeSource = Js.uncheckedCast(node);\n \n-            final List<JSITAuthorityRequirement> authorityRequirement = nodeKnowledgeSource.getAuthorityRequirement();\n-            existingKnowledgeSource.addAllAuthorityRequirement(authorityRequirement.toArray(new JSITAuthorityRequirement[0]));\n+            existingKnowledgeSource.addAllAuthorityRequirement(nodeKnowledgeSource.getAuthorityRequirement().toArray(new JSITAuthorityRequirement[0]));\n+            existingKnowledgeSource.setAuthorityRequirement(distinct(existingKnowledgeSource.getAuthorityRequirement()));\n         }\n     }\n \n+    private <T extends JSITDMNElement> List<T> distinct(final List<T> list) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "6aa65c532f7f69a571afbde047faa33cf80daeba"}, "originalPosition": 62}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTE0NjcwNTYw", "url": "https://github.com/kiegroup/kie-wb-common/pull/3463#pullrequestreview-514670560", "createdAt": "2020-10-22T12:29:45Z", "commit": {"oid": "6aa65c532f7f69a571afbde047faa33cf80daeba"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e32b250a489a54c30de9e4614471c04644e04029", "author": {"user": {"login": "karreiro", "name": "Guilherme Carreiro"}}, "url": "https://github.com/kiegroup/kie-wb-common/commit/e32b250a489a54c30de9e4614471c04644e04029", "committedDate": "2020-10-22T12:38:46Z", "message": " - Simplify 'mergeNodeRequirements' (reviewer: Jan)"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "d7fe327e4348746cda083636c46687e455c4fac5", "author": {"user": {"login": "karreiro", "name": "Guilherme Carreiro"}}, "url": "https://github.com/kiegroup/kie-wb-common/commit/d7fe327e4348746cda083636c46687e455c4fac5", "committedDate": "2020-10-22T12:36:03Z", "message": " - Simplify 'mergeNodeRequirements' (reviewer: Jan)"}, "afterCommit": {"oid": "e32b250a489a54c30de9e4614471c04644e04029", "author": {"user": {"login": "karreiro", "name": "Guilherme Carreiro"}}, "url": "https://github.com/kiegroup/kie-wb-common/commit/e32b250a489a54c30de9e4614471c04644e04029", "committedDate": "2020-10-22T12:38:46Z", "message": " - Simplify 'mergeNodeRequirements' (reviewer: Jan)"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTE0NzQ0OTI0", "url": "https://github.com/kiegroup/kie-wb-common/pull/3463#pullrequestreview-514744924", "createdAt": "2020-10-22T13:47:42Z", "commit": {"oid": "e32b250a489a54c30de9e4614471c04644e04029"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 350, "cost": 1, "resetAt": "2021-11-01T15:33:45Z"}}}