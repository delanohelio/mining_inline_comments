{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDkxOTA3OTA2", "number": 3432, "reviewThreads": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yNFQxNDoxNzoyMVrOEnEUmQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yNVQxMjo0NDoyOVrOEncLOw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzA5NDAwNzI5OnYy", "diffSide": "RIGHT", "path": "kie-wb-common-screens/kie-wb-common-data-modeller/kie-wb-common-data-modeller-client/src/main/java/org/kie/workbench/common/screens/datamodeller/client/DataModelerScreenPresenter.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yNFQxNDoxNzoyMVrOHXdJfA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yNFQyMDozMDozNVrOHXrhsA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NDM1Njg2MA==", "bodyText": "This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters. Learn more about bidirectional Unicode characters\n\n\n  \n\n\n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                                * */\n          \n          \n            \n                                 */", "url": "https://github.com/kiegroup/kie-wb-common/pull/3432#discussion_r494356860", "createdAt": "2020-09-24T14:17:21Z", "author": {"login": "caponetto"}, "path": "kie-wb-common-screens/kie-wb-common-data-modeller/kie-wb-common-data-modeller-client/src/main/java/org/kie/workbench/common/screens/datamodeller/client/DataModelerScreenPresenter.java", "diffHunk": "@@ -588,23 +588,16 @@ public void execute(final String commitMessage) {\n \n                 final DataObject[] modifiedDataObject = new DataObject[1];\n                 if (isDirty()) {\n-                    if (context.isEditorChanged()) {\n-\n-                        //at save time the source has always priority over the model.\n-                        //If the source was properly parsed and the editor has changes, we need to send the DataObject\n-                        //to the server in order to let the source to be updated prior to save.\n-                        modifiedDataObject[0] = context.getDataObject();\n-                    } else {\n-                        //if the source has changes, no update form the UI to the source will be performed.\n-                        //instead the parsed DataObject must be returned from the server.\n-                        modifiedDataObject[0] = null;\n-                    }\n+                    /* when DataObject editor or source is changed we\n+                     * need to send the DataObject to the server  in order\n+                     *  to let the source to be updated prior to save.\n+                    * */", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "594b992aea0f5b47ae665f5896ba73a9cce0def6"}, "originalPosition": 18}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NDU5MjQzMg==", "bodyText": "Done!", "url": "https://github.com/kiegroup/kie-wb-common/pull/3432#discussion_r494592432", "createdAt": "2020-09-24T20:30:35Z", "author": {"login": "akumar074"}, "path": "kie-wb-common-screens/kie-wb-common-data-modeller/kie-wb-common-data-modeller-client/src/main/java/org/kie/workbench/common/screens/datamodeller/client/DataModelerScreenPresenter.java", "diffHunk": "@@ -588,23 +588,16 @@ public void execute(final String commitMessage) {\n \n                 final DataObject[] modifiedDataObject = new DataObject[1];\n                 if (isDirty()) {\n-                    if (context.isEditorChanged()) {\n-\n-                        //at save time the source has always priority over the model.\n-                        //If the source was properly parsed and the editor has changes, we need to send the DataObject\n-                        //to the server in order to let the source to be updated prior to save.\n-                        modifiedDataObject[0] = context.getDataObject();\n-                    } else {\n-                        //if the source has changes, no update form the UI to the source will be performed.\n-                        //instead the parsed DataObject must be returned from the server.\n-                        modifiedDataObject[0] = null;\n-                    }\n+                    /* when DataObject editor or source is changed we\n+                     * need to send the DataObject to the server  in order\n+                     *  to let the source to be updated prior to save.\n+                    * */", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NDM1Njg2MA=="}, "originalCommit": {"oid": "594b992aea0f5b47ae665f5896ba73a9cce0def6"}, "originalPosition": 18}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzA5NDA4MDA2OnYy", "diffSide": "RIGHT", "path": "kie-wb-common-screens/kie-wb-common-data-modeller/kie-wb-common-data-modeller-client/src/main/java/org/kie/workbench/common/screens/datamodeller/client/DataModelerScreenPresenter.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yNFQxNDozMjowM1rOHXd28Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yNFQyMDozMDo0NVrOHXriCA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NDM2ODQ5Nw==", "bodyText": "This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters. Learn more about bidirectional Unicode characters\n\n\n  \n\n\n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                private RemoteCallback<GenerationResult> getSaveSuccessCallback( final Path currentPath) {\n          \n          \n            \n                private RemoteCallback<GenerationResult> getSaveSuccessCallback(final Path currentPath) {", "url": "https://github.com/kiegroup/kie-wb-common/pull/3432#discussion_r494368497", "createdAt": "2020-09-24T14:32:03Z", "author": {"login": "caponetto"}, "path": "kie-wb-common-screens/kie-wb-common-data-modeller/kie-wb-common-data-modeller-client/src/main/java/org/kie/workbench/common/screens/datamodeller/client/DataModelerScreenPresenter.java", "diffHunk": "@@ -627,17 +619,14 @@ public void execute(final String commitMessage) {\n         };\n     }\n \n-    private RemoteCallback<GenerationResult> getSaveSuccessCallback(final JavaTypeInfo newTypeInfo,\n-                                                                    final Path currentPath) {\n+    private RemoteCallback<GenerationResult> getSaveSuccessCallback( final Path currentPath) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "594b992aea0f5b47ae665f5896ba73a9cce0def6"}, "originalPosition": 46}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NDU5MjUyMA==", "bodyText": "Done!", "url": "https://github.com/kiegroup/kie-wb-common/pull/3432#discussion_r494592520", "createdAt": "2020-09-24T20:30:45Z", "author": {"login": "akumar074"}, "path": "kie-wb-common-screens/kie-wb-common-data-modeller/kie-wb-common-data-modeller-client/src/main/java/org/kie/workbench/common/screens/datamodeller/client/DataModelerScreenPresenter.java", "diffHunk": "@@ -627,17 +619,14 @@ public void execute(final String commitMessage) {\n         };\n     }\n \n-    private RemoteCallback<GenerationResult> getSaveSuccessCallback(final JavaTypeInfo newTypeInfo,\n-                                                                    final Path currentPath) {\n+    private RemoteCallback<GenerationResult> getSaveSuccessCallback( final Path currentPath) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NDM2ODQ5Nw=="}, "originalCommit": {"oid": "594b992aea0f5b47ae665f5896ba73a9cce0def6"}, "originalPosition": 46}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzA5NDE0MTM3OnYy", "diffSide": "LEFT", "path": "kie-wb-common-screens/kie-wb-common-data-modeller/kie-wb-common-data-modeller-client/src/main/java/org/kie/workbench/common/screens/datamodeller/client/DataModelerScreenPresenter.java", "isResolved": false, "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yNFQxNDo0NDozOFrOHXec-g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yNVQxMjozMTo1M1rOHYBqTQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NDM3ODIzNA==", "bodyText": "Given the comment below If the file was renamed as part of the file saving, don't do anything.,\nwould you mind explaining the reason for removing this if-else block?\nAlso, there is no unit test for exercising this method.\nIt'd be great if you could create a few ones.", "url": "https://github.com/kiegroup/kie-wb-common/pull/3432#discussion_r494378234", "createdAt": "2020-09-24T14:44:38Z", "author": {"login": "caponetto"}, "path": "kie-wb-common-screens/kie-wb-common-data-modeller/kie-wb-common-data-modeller-client/src/main/java/org/kie/workbench/common/screens/datamodeller/client/DataModelerScreenPresenter.java", "diffHunk": "@@ -627,17 +619,14 @@ public void execute(final String commitMessage) {\n         };\n     }\n \n-    private RemoteCallback<GenerationResult> getSaveSuccessCallback(final JavaTypeInfo newTypeInfo,\n-                                                                    final Path currentPath) {\n+    private RemoteCallback<GenerationResult> getSaveSuccessCallback( final Path currentPath) {\n         return new RemoteCallback<GenerationResult>() {\n \n             @Override\n             public void callback(GenerationResult result) {\n \n                 view.hideBusyIndicator();\n \n-                if (newTypeInfo == null) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "594b992aea0f5b47ae665f5896ba73a9cce0def6"}, "originalPosition": 54}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NDQ4OTQwMw==", "bodyText": "Hi @caponetto , The condition is used to identify if we have changed the package or file name. If the package or file name is changed, the source and source hash will be updated in reload because of ResourceRenamedEvent in the observable path. The \"reload\" caused some delay before the hash could be updated and the Unsaved changes dialog can appear. Removing this condition helps to update the source before reload.\nThe method is private so, didn't add the unit test for this.", "url": "https://github.com/kiegroup/kie-wb-common/pull/3432#discussion_r494489403", "createdAt": "2020-09-24T17:27:49Z", "author": {"login": "akumar074"}, "path": "kie-wb-common-screens/kie-wb-common-data-modeller/kie-wb-common-data-modeller-client/src/main/java/org/kie/workbench/common/screens/datamodeller/client/DataModelerScreenPresenter.java", "diffHunk": "@@ -627,17 +619,14 @@ public void execute(final String commitMessage) {\n         };\n     }\n \n-    private RemoteCallback<GenerationResult> getSaveSuccessCallback(final JavaTypeInfo newTypeInfo,\n-                                                                    final Path currentPath) {\n+    private RemoteCallback<GenerationResult> getSaveSuccessCallback( final Path currentPath) {\n         return new RemoteCallback<GenerationResult>() {\n \n             @Override\n             public void callback(GenerationResult result) {\n \n                 view.hideBusyIndicator();\n \n-                if (newTypeInfo == null) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NDM3ODIzNA=="}, "originalCommit": {"oid": "594b992aea0f5b47ae665f5896ba73a9cce0def6"}, "originalPosition": 54}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NDk1NTA4NQ==", "bodyText": "I see, thanks for the explanation @akumar074!", "url": "https://github.com/kiegroup/kie-wb-common/pull/3432#discussion_r494955085", "createdAt": "2020-09-25T12:31:53Z", "author": {"login": "caponetto"}, "path": "kie-wb-common-screens/kie-wb-common-data-modeller/kie-wb-common-data-modeller-client/src/main/java/org/kie/workbench/common/screens/datamodeller/client/DataModelerScreenPresenter.java", "diffHunk": "@@ -627,17 +619,14 @@ public void execute(final String commitMessage) {\n         };\n     }\n \n-    private RemoteCallback<GenerationResult> getSaveSuccessCallback(final JavaTypeInfo newTypeInfo,\n-                                                                    final Path currentPath) {\n+    private RemoteCallback<GenerationResult> getSaveSuccessCallback( final Path currentPath) {\n         return new RemoteCallback<GenerationResult>() {\n \n             @Override\n             public void callback(GenerationResult result) {\n \n                 view.hideBusyIndicator();\n \n-                if (newTypeInfo == null) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NDM3ODIzNA=="}, "originalCommit": {"oid": "594b992aea0f5b47ae665f5896ba73a9cce0def6"}, "originalPosition": 54}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzA5NDE4MjgwOnYy", "diffSide": "RIGHT", "path": "kie-wb-common-screens/kie-wb-common-data-modeller/kie-wb-common-data-modeller-backend/src/main/java/org/kie/workbench/common/screens/datamodeller/backend/server/DataModelerServiceImpl.java", "isResolved": false, "comments": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yNFQxNDo1Mjo1MVrOHXe2fg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yNVQxMjozMjowN1rOHYBqzg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NDM4NDc2Ng==", "bodyText": "I'd move this code into the if blocks above because there is no need for doing setName and setPackageName if name and package didn't change, respectively. It also avoids having to remove \".java\" from targetName.\nSomething like this:\nif (newPackageName != null && (currentPackage == null || !newPackageName.equals(currentPackage.getPackageName()))) {\n    targetPackage = serviceHelper.ensurePackageStructure(moduleService.resolveModule(path),\n                                                         newPackageName);\n\n    // Moved here\n    if (dataObject != null && targetPackage != null) {\n        dataObject.setPackageName(targetPackage.getPackageName());\n    }\n\n    packageChanged = true;\n}\n\nif (newFileName != null && !(newFileName + \".java\").equals(path.getFileName())) {\n    targetName = newFileName + \".java\";\n\n    // Moved here\n    if (dataObject != null) {\n        dataObject.setName(newFileName);\n    }\n\n    nameChanged = true;\n}", "url": "https://github.com/kiegroup/kie-wb-common/pull/3432#discussion_r494384766", "createdAt": "2020-09-24T14:52:51Z", "author": {"login": "caponetto"}, "path": "kie-wb-common-screens/kie-wb-common-data-modeller/kie-wb-common-data-modeller-backend/src/main/java/org/kie/workbench/common/screens/datamodeller/backend/server/DataModelerServiceImpl.java", "diffHunk": "@@ -569,6 +566,19 @@ public GenerationResult saveSource(final String source,\n                 targetName = newFileName + \".java\";\n                 nameChanged = true;\n             }\n+            \n+            /* Modify data object with updated fileName and packageName\n+             * before resolving source to handle inconsistencies in\n+             * source code and data object\n+             * */\n+            if  (dataObject  != null) {\n+                dataObject.setName(targetName.replace(\".java\", \"\"));\n+                dataObject.setPackageName(targetPackage.getPackageName());\n+            }", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "594b992aea0f5b47ae665f5896ba73a9cce0def6"}, "originalPosition": 24}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NDQ5MDg3NA==", "bodyText": "Thanks @caponetto Good suggestion. I'll update this :)", "url": "https://github.com/kiegroup/kie-wb-common/pull/3432#discussion_r494490874", "createdAt": "2020-09-24T17:30:21Z", "author": {"login": "akumar074"}, "path": "kie-wb-common-screens/kie-wb-common-data-modeller/kie-wb-common-data-modeller-backend/src/main/java/org/kie/workbench/common/screens/datamodeller/backend/server/DataModelerServiceImpl.java", "diffHunk": "@@ -569,6 +566,19 @@ public GenerationResult saveSource(final String source,\n                 targetName = newFileName + \".java\";\n                 nameChanged = true;\n             }\n+            \n+            /* Modify data object with updated fileName and packageName\n+             * before resolving source to handle inconsistencies in\n+             * source code and data object\n+             * */\n+            if  (dataObject  != null) {\n+                dataObject.setName(targetName.replace(\".java\", \"\"));\n+                dataObject.setPackageName(targetPackage.getPackageName());\n+            }", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NDM4NDc2Ng=="}, "originalCommit": {"oid": "594b992aea0f5b47ae665f5896ba73a9cce0def6"}, "originalPosition": 24}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NDU5NjQzMg==", "bodyText": "Hey @caponetto , moving the DataObject update doesn't work as expected. The data object is also updated with fileName and currentPackage resolved from the path. For example, if we are changing the package or fileName in editor/source but while saving the changes we chose not to move the package or file name, then the source or DataObject editor can have changed values. In this case, we are updating the data object with the path or if package or fileName is changed update it.", "url": "https://github.com/kiegroup/kie-wb-common/pull/3432#discussion_r494596432", "createdAt": "2020-09-24T20:38:13Z", "author": {"login": "akumar074"}, "path": "kie-wb-common-screens/kie-wb-common-data-modeller/kie-wb-common-data-modeller-backend/src/main/java/org/kie/workbench/common/screens/datamodeller/backend/server/DataModelerServiceImpl.java", "diffHunk": "@@ -569,6 +566,19 @@ public GenerationResult saveSource(final String source,\n                 targetName = newFileName + \".java\";\n                 nameChanged = true;\n             }\n+            \n+            /* Modify data object with updated fileName and packageName\n+             * before resolving source to handle inconsistencies in\n+             * source code and data object\n+             * */\n+            if  (dataObject  != null) {\n+                dataObject.setName(targetName.replace(\".java\", \"\"));\n+                dataObject.setPackageName(targetPackage.getPackageName());\n+            }", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NDM4NDc2Ng=="}, "originalCommit": {"oid": "594b992aea0f5b47ae665f5896ba73a9cce0def6"}, "originalPosition": 24}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NDk1NTIxNA==", "bodyText": "I see, thanks for the explanation @akumar074!", "url": "https://github.com/kiegroup/kie-wb-common/pull/3432#discussion_r494955214", "createdAt": "2020-09-25T12:32:07Z", "author": {"login": "caponetto"}, "path": "kie-wb-common-screens/kie-wb-common-data-modeller/kie-wb-common-data-modeller-backend/src/main/java/org/kie/workbench/common/screens/datamodeller/backend/server/DataModelerServiceImpl.java", "diffHunk": "@@ -569,6 +566,19 @@ public GenerationResult saveSource(final String source,\n                 targetName = newFileName + \".java\";\n                 nameChanged = true;\n             }\n+            \n+            /* Modify data object with updated fileName and packageName\n+             * before resolving source to handle inconsistencies in\n+             * source code and data object\n+             * */\n+            if  (dataObject  != null) {\n+                dataObject.setName(targetName.replace(\".java\", \"\"));\n+                dataObject.setPackageName(targetPackage.getPackageName());\n+            }", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NDM4NDc2Ng=="}, "originalCommit": {"oid": "594b992aea0f5b47ae665f5896ba73a9cce0def6"}, "originalPosition": 24}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzA5NzkxNTQ3OnYy", "diffSide": "RIGHT", "path": "kie-wb-common-screens/kie-wb-common-data-modeller/kie-wb-common-data-modeller-backend/src/main/java/org/kie/workbench/common/screens/datamodeller/backend/server/DataModelerServiceImpl.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yNVQxMjo0NDoyOVrOHYCETQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yNVQxMjo0NDoyOVrOHYCETQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NDk2MTc0MQ==", "bodyText": "This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters. Learn more about bidirectional Unicode characters\n\n\n  \n\n\n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                        if  (dataObject  != null) {\n          \n          \n            \n                        if (dataObject != null) {\n          \n      \n    \n    \n  \n\nSince we are keeping this if block, can you please remove these extra spaces?", "url": "https://github.com/kiegroup/kie-wb-common/pull/3432#discussion_r494961741", "createdAt": "2020-09-25T12:44:29Z", "author": {"login": "caponetto"}, "path": "kie-wb-common-screens/kie-wb-common-data-modeller/kie-wb-common-data-modeller-backend/src/main/java/org/kie/workbench/common/screens/datamodeller/backend/server/DataModelerServiceImpl.java", "diffHunk": "@@ -569,6 +566,19 @@ public GenerationResult saveSource(final String source,\n                 targetName = newFileName + \".java\";\n                 nameChanged = true;\n             }\n+            \n+            /* Modify data object with updated fileName and packageName\n+             * or by resolving from @path before resolving source to handle\n+             * inconsistencies in source code and data object\n+             * */\n+            if  (dataObject  != null) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "bb37f0eda657ef39a932630f5fd88bc70d4de2f8"}, "originalPosition": 21}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1232, "cost": 1, "resetAt": "2021-11-12T20:28:25Z"}}}