{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0Mzg5MjgzNTI3", "number": 3220, "title": "DROOLS-5131: [DMN Designer] Boxed List support", "bodyText": "See https://issues.redhat.com/browse/DROOLS-5131\nNew grid type for \"Lists\"....\nI had to move both Relation and the new List to contain a List<HasExpression> rather than List<Expression> to be able to maximise re-use of existing code to get and set an expression on an object instance so this PR is bloated with related changes for Relation.", "createdAt": "2020-03-16T14:41:01Z", "url": "https://github.com/kiegroup/kie-wb-common/pull/3220", "merged": true, "mergeCommit": {"oid": "24a424c0eb4a6c1e64c18cb1f638bcc978048c11"}, "closed": true, "closedAt": "2020-03-23T10:48:41Z", "author": {"login": "manstis"}, "timelineItems": {"totalCount": 11, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcOm_U3gFqTM3NjI5NzY2NQ==", "endCursor": "Y3Vyc29yOnYyOpPPAAABcPhIcPAFqTM3ODUxNTcwMQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzc2Mjk3NjY1", "url": "https://github.com/kiegroup/kie-wb-common/pull/3220#pullrequestreview-376297665", "createdAt": "2020-03-17T18:26:35Z", "commit": {"oid": "de95d2682539c5e4555df064d5e378d5073294f0"}, "state": "COMMENTED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a4f96b270830059b6ebdad87f207dda6c297f549", "author": {"user": null}, "url": "https://github.com/kiegroup/kie-wb-common/commit/a4f96b270830059b6ebdad87f207dda6c297f549", "committedDate": "2020-03-17T19:31:42Z", "message": "DROOLS-5131: [DMN Designer] Boxed List support"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzc2NzYzNzk3", "url": "https://github.com/kiegroup/kie-wb-common/pull/3220#pullrequestreview-376763797", "createdAt": "2020-03-18T11:09:07Z", "commit": {"oid": "de95d2682539c5e4555df064d5e378d5073294f0"}, "state": "COMMENTED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "19205611aeb71a020ddcc44bbecc4dcc7a7ee2c7", "author": {"user": null}, "url": "https://github.com/kiegroup/kie-wb-common/commit/19205611aeb71a020ddcc44bbecc4dcc7a7ee2c7", "committedDate": "2020-03-18T12:52:45Z", "message": "Updates following peer review."}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "de95d2682539c5e4555df064d5e378d5073294f0", "author": {"user": null}, "url": "https://github.com/kiegroup/kie-wb-common/commit/de95d2682539c5e4555df064d5e378d5073294f0", "committedDate": "2020-03-16T14:29:57Z", "message": "DROOLS-5131: [DMN Designer] Boxed List support"}, "afterCommit": {"oid": "19205611aeb71a020ddcc44bbecc4dcc7a7ee2c7", "author": {"user": null}, "url": "https://github.com/kiegroup/kie-wb-common/commit/19205611aeb71a020ddcc44bbecc4dcc7a7ee2c7", "committedDate": "2020-03-18T12:52:45Z", "message": "Updates following peer review."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzc3NTM4MDUy", "url": "https://github.com/kiegroup/kie-wb-common/pull/3220#pullrequestreview-377538052", "createdAt": "2020-03-19T09:13:14Z", "commit": {"oid": "19205611aeb71a020ddcc44bbecc4dcc7a7ee2c7"}, "state": "COMMENTED", "comments": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xOVQwOToxMzoxNFrOF4lvYw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xOVQxMDoyMTowNVrOF4oKvg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NDg4MjkxNQ==", "bodyText": "Question, can we use some private static final new List()? In other words, is result of this used juts to determine what UI is shown or is it use in runtime, accessing, changing its vales.", "url": "https://github.com/kiegroup/kie-wb-common/pull/3220#discussion_r394882915", "createdAt": "2020-03-19T09:13:14Z", "author": {"login": "jomarko"}, "path": "kie-wb-common-dmn/kie-wb-common-dmn-client/src/main/java/org/kie/workbench/common/dmn/client/editors/expressions/types/list/ListEditorDefinition.java", "diffHunk": "@@ -0,0 +1,152 @@\n+/*\n+ * Copyright 2020 Red Hat, Inc. and/or its affiliates.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+package org.kie.workbench.common.dmn.client.editors.expressions.types.list;\n+\n+import java.util.Optional;\n+import java.util.function.Supplier;\n+\n+import javax.enterprise.context.ApplicationScoped;\n+import javax.enterprise.event.Event;\n+import javax.inject.Inject;\n+\n+import org.jboss.errai.ui.client.local.spi.TranslationService;\n+import org.kie.workbench.common.dmn.api.definition.HasExpression;\n+import org.kie.workbench.common.dmn.api.definition.HasName;\n+import org.kie.workbench.common.dmn.api.definition.model.Expression;\n+import org.kie.workbench.common.dmn.api.definition.model.List;\n+import org.kie.workbench.common.dmn.api.definition.model.LiteralExpression;\n+import org.kie.workbench.common.dmn.api.qualifiers.DMNEditor;\n+import org.kie.workbench.common.dmn.client.commands.factory.DefaultCanvasCommandFactory;\n+import org.kie.workbench.common.dmn.client.editors.expressions.types.BaseEditorDefinition;\n+import org.kie.workbench.common.dmn.client.editors.expressions.types.ExpressionEditorDefinitions;\n+import org.kie.workbench.common.dmn.client.editors.expressions.types.ExpressionType;\n+import org.kie.workbench.common.dmn.client.editors.types.ValueAndDataTypePopoverView;\n+import org.kie.workbench.common.dmn.client.resources.i18n.DMNEditorConstants;\n+import org.kie.workbench.common.dmn.client.widgets.grid.BaseExpressionGrid;\n+import org.kie.workbench.common.dmn.client.widgets.grid.controls.list.ListSelectorView;\n+import org.kie.workbench.common.dmn.client.widgets.grid.model.BaseUIModelMapper;\n+import org.kie.workbench.common.dmn.client.widgets.grid.model.DMNGridData;\n+import org.kie.workbench.common.dmn.client.widgets.grid.model.ExpressionEditorChanged;\n+import org.kie.workbench.common.dmn.client.widgets.grid.model.GridCellTuple;\n+import org.kie.workbench.common.stunner.core.client.api.SessionManager;\n+import org.kie.workbench.common.stunner.core.client.canvas.AbstractCanvasHandler;\n+import org.kie.workbench.common.stunner.core.client.canvas.event.selection.DomainObjectSelectionEvent;\n+import org.kie.workbench.common.stunner.core.client.command.SessionCommandManager;\n+import org.kie.workbench.common.stunner.core.util.DefinitionUtils;\n+import org.kie.workbench.common.stunner.forms.client.event.RefreshFormPropertiesEvent;\n+import org.uberfire.ext.wires.core.grids.client.model.GridData;\n+\n+@ApplicationScoped\n+public class ListEditorDefinition extends BaseEditorDefinition<List, ListGridData> {\n+\n+    private Supplier<ExpressionEditorDefinitions> expressionEditorDefinitionsSupplier;\n+    private ValueAndDataTypePopoverView.Presenter headerEditor;\n+\n+    public ListEditorDefinition() {\n+        //CDI proxy\n+    }\n+\n+    @Inject\n+    public ListEditorDefinition(final DefinitionUtils definitionUtils,\n+                                final SessionManager sessionManager,\n+                                final SessionCommandManager<AbstractCanvasHandler> sessionCommandManager,\n+                                final @DMNEditor DefaultCanvasCommandFactory canvasCommandFactory,\n+                                final Event<ExpressionEditorChanged> editorSelectedEvent,\n+                                final Event<RefreshFormPropertiesEvent> refreshFormPropertiesEvent,\n+                                final Event<DomainObjectSelectionEvent> domainObjectSelectionEvent,\n+                                final ListSelectorView.Presenter listSelector,\n+                                final TranslationService translationService,\n+                                final @DMNEditor Supplier<ExpressionEditorDefinitions> expressionEditorDefinitionsSupplier,\n+                                final ValueAndDataTypePopoverView.Presenter headerEditor) {\n+        super(definitionUtils,\n+              sessionManager,\n+              sessionCommandManager,\n+              canvasCommandFactory,\n+              editorSelectedEvent,\n+              refreshFormPropertiesEvent,\n+              domainObjectSelectionEvent,\n+              listSelector,\n+              translationService);\n+        this.expressionEditorDefinitionsSupplier = expressionEditorDefinitionsSupplier;\n+        this.headerEditor = headerEditor;\n+    }\n+\n+    @Override\n+    public ExpressionType getType() {\n+        return ExpressionType.LIST;\n+    }\n+\n+    @Override\n+    public String getName() {\n+        return translationService.format(DMNEditorConstants.ExpressionEditor_ListType);\n+    }\n+\n+    @Override\n+    public Optional<List> getModelClass() {\n+        return Optional.of(new List());", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "19205611aeb71a020ddcc44bbecc4dcc7a7ee2c7"}, "originalPosition": 99}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NDg4NDI2NA==", "bodyText": "please remove comment", "url": "https://github.com/kiegroup/kie-wb-common/pull/3220#discussion_r394884264", "createdAt": "2020-03-19T09:15:38Z", "author": {"login": "jomarko"}, "path": "kie-wb-common-dmn/kie-wb-common-dmn-client/src/main/java/org/kie/workbench/common/dmn/client/editors/expressions/types/list/ListGrid.java", "diffHunk": "@@ -0,0 +1,337 @@\n+/*\n+ * Copyright 2020 Red Hat, Inc. and/or its affiliates.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+package org.kie.workbench.common.dmn.client.editors.expressions.types.list;\n+\n+import java.util.ArrayList;\n+import java.util.Optional;\n+import java.util.function.Supplier;\n+\n+import javax.enterprise.event.Event;\n+\n+import com.ait.lienzo.shared.core.types.EventPropagationMode;\n+import org.jboss.errai.ui.client.local.spi.TranslationService;\n+import org.kie.workbench.common.dmn.api.definition.HasExpression;\n+import org.kie.workbench.common.dmn.api.definition.HasName;\n+import org.kie.workbench.common.dmn.api.definition.model.DMNModelInstrumentedBase;\n+import org.kie.workbench.common.dmn.api.definition.model.Expression;\n+import org.kie.workbench.common.dmn.api.definition.model.List;\n+import org.kie.workbench.common.dmn.api.definition.model.LiteralExpression;\n+import org.kie.workbench.common.dmn.api.property.dmn.Name;\n+import org.kie.workbench.common.dmn.client.commands.expressions.types.list.AddListRowCommand;\n+import org.kie.workbench.common.dmn.client.commands.expressions.types.list.ClearExpressionTypeCommand;\n+import org.kie.workbench.common.dmn.client.commands.expressions.types.list.DeleteListRowCommand;\n+import org.kie.workbench.common.dmn.client.commands.factory.DefaultCanvasCommandFactory;\n+import org.kie.workbench.common.dmn.client.editors.expressions.types.ExpressionEditorDefinitions;\n+import org.kie.workbench.common.dmn.client.editors.expressions.types.context.ContextGridRowNumberColumn;\n+import org.kie.workbench.common.dmn.client.editors.expressions.types.context.ExpressionCellValue;\n+import org.kie.workbench.common.dmn.client.editors.expressions.types.context.ExpressionEditorColumn;\n+import org.kie.workbench.common.dmn.client.editors.expressions.types.undefined.UndefinedExpressionGrid;\n+import org.kie.workbench.common.dmn.client.editors.expressions.util.SelectionUtils;\n+import org.kie.workbench.common.dmn.client.editors.types.ValueAndDataTypePopoverView;\n+import org.kie.workbench.common.dmn.client.resources.i18n.DMNEditorConstants;\n+import org.kie.workbench.common.dmn.client.widgets.grid.BaseExpressionGrid;\n+import org.kie.workbench.common.dmn.client.widgets.grid.BaseExpressionGridRenderer;\n+import org.kie.workbench.common.dmn.client.widgets.grid.controls.container.CellEditorControlsView;\n+import org.kie.workbench.common.dmn.client.widgets.grid.controls.list.HasListSelectorControl;\n+import org.kie.workbench.common.dmn.client.widgets.grid.controls.list.ListSelectorView;\n+import org.kie.workbench.common.dmn.client.widgets.grid.model.ExpressionEditorChanged;\n+import org.kie.workbench.common.dmn.client.widgets.grid.model.ExpressionEditorGridRow;\n+import org.kie.workbench.common.dmn.client.widgets.grid.model.GridCellTuple;\n+import org.kie.workbench.common.dmn.client.widgets.layer.DMNGridLayer;\n+import org.kie.workbench.common.dmn.client.widgets.panel.DMNGridPanel;\n+import org.kie.workbench.common.stunner.core.client.api.SessionManager;\n+import org.kie.workbench.common.stunner.core.client.canvas.AbstractCanvasHandler;\n+import org.kie.workbench.common.stunner.core.client.canvas.event.selection.DomainObjectSelectionEvent;\n+import org.kie.workbench.common.stunner.core.client.command.SessionCommandManager;\n+import org.kie.workbench.common.stunner.core.domainobject.DomainObject;\n+import org.kie.workbench.common.stunner.core.util.DefinitionUtils;\n+import org.kie.workbench.common.stunner.forms.client.event.RefreshFormPropertiesEvent;\n+import org.uberfire.ext.wires.core.grids.client.model.GridCell;\n+import org.uberfire.ext.wires.core.grids.client.model.GridColumn;\n+import org.uberfire.ext.wires.core.grids.client.model.GridRow;\n+import org.uberfire.ext.wires.core.grids.client.model.impl.BaseHeaderMetaData;\n+\n+public class ListGrid extends BaseExpressionGrid<List, ListGridData, ListUIModelMapper> implements HasListSelectorControl {\n+\n+    private final ValueAndDataTypePopoverView.Presenter headerEditor;\n+\n+    private final Supplier<ExpressionEditorDefinitions> expressionEditorDefinitionsSupplier;\n+\n+    public ListGrid(final GridCellTuple parent,\n+                    final Optional<String> nodeUUID,\n+                    final HasExpression hasExpression,\n+                    final Optional<HasName> hasName,\n+                    final DMNGridPanel gridPanel,\n+                    final DMNGridLayer gridLayer,\n+                    final ListGridData gridData,\n+                    final DefinitionUtils definitionUtils,\n+                    final SessionManager sessionManager,\n+                    final SessionCommandManager<AbstractCanvasHandler> sessionCommandManager,\n+                    final DefaultCanvasCommandFactory canvasCommandFactory,\n+                    final Event<ExpressionEditorChanged> editorSelectedEvent,\n+                    final Event<RefreshFormPropertiesEvent> refreshFormPropertiesEvent,\n+                    final Event<DomainObjectSelectionEvent> domainObjectSelectionEvent,\n+                    final CellEditorControlsView.Presenter cellEditorControls,\n+                    final ListSelectorView.Presenter listSelector,\n+                    final TranslationService translationService,\n+                    final boolean isOnlyVisualChangeAllowed,\n+                    final int nesting,\n+                    final Supplier<ExpressionEditorDefinitions> expressionEditorDefinitionsSupplier,\n+                    final ValueAndDataTypePopoverView.Presenter headerEditor) {\n+        super(parent,\n+              nodeUUID,\n+              hasExpression,\n+              hasName,\n+              gridPanel,\n+              gridLayer,\n+              gridData,\n+              new BaseExpressionGridRenderer(gridData),\n+              definitionUtils,\n+              sessionManager,\n+              sessionCommandManager,\n+              canvasCommandFactory,\n+              editorSelectedEvent,\n+              refreshFormPropertiesEvent,\n+              domainObjectSelectionEvent,\n+              cellEditorControls,\n+              listSelector,\n+              translationService,\n+              isOnlyVisualChangeAllowed,\n+              nesting);\n+        this.expressionEditorDefinitionsSupplier = expressionEditorDefinitionsSupplier;\n+        this.headerEditor = headerEditor;\n+\n+        setEventPropagationMode(EventPropagationMode.NO_ANCESTORS);\n+\n+        super.doInitialisation();\n+    }\n+\n+    @Override\n+    protected void doInitialisation() {\n+        // Defer initialisation until after the constructor completes as\n+        // makeUiModelMapper needs expressionEditorDefinitionsSupplier to have been set\n+    }\n+\n+    @Override\n+    public ListUIModelMapper makeUiModelMapper() {\n+        return new ListUIModelMapper(this,\n+                                     this::getModel,/**/", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "19205611aeb71a020ddcc44bbecc4dcc7a7ee2c7"}, "originalPosition": 131}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NDkwNTA5MA==", "bodyText": "In getItems we create also ListSelectorHeaderItem is this cast safe?", "url": "https://github.com/kiegroup/kie-wb-common/pull/3220#discussion_r394905090", "createdAt": "2020-03-19T09:51:35Z", "author": {"login": "jomarko"}, "path": "kie-wb-common-dmn/kie-wb-common-dmn-client/src/main/java/org/kie/workbench/common/dmn/client/editors/expressions/types/list/ListGrid.java", "diffHunk": "@@ -0,0 +1,337 @@\n+/*\n+ * Copyright 2020 Red Hat, Inc. and/or its affiliates.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+package org.kie.workbench.common.dmn.client.editors.expressions.types.list;\n+\n+import java.util.ArrayList;\n+import java.util.Optional;\n+import java.util.function.Supplier;\n+\n+import javax.enterprise.event.Event;\n+\n+import com.ait.lienzo.shared.core.types.EventPropagationMode;\n+import org.jboss.errai.ui.client.local.spi.TranslationService;\n+import org.kie.workbench.common.dmn.api.definition.HasExpression;\n+import org.kie.workbench.common.dmn.api.definition.HasName;\n+import org.kie.workbench.common.dmn.api.definition.model.DMNModelInstrumentedBase;\n+import org.kie.workbench.common.dmn.api.definition.model.Expression;\n+import org.kie.workbench.common.dmn.api.definition.model.List;\n+import org.kie.workbench.common.dmn.api.definition.model.LiteralExpression;\n+import org.kie.workbench.common.dmn.api.property.dmn.Name;\n+import org.kie.workbench.common.dmn.client.commands.expressions.types.list.AddListRowCommand;\n+import org.kie.workbench.common.dmn.client.commands.expressions.types.list.ClearExpressionTypeCommand;\n+import org.kie.workbench.common.dmn.client.commands.expressions.types.list.DeleteListRowCommand;\n+import org.kie.workbench.common.dmn.client.commands.factory.DefaultCanvasCommandFactory;\n+import org.kie.workbench.common.dmn.client.editors.expressions.types.ExpressionEditorDefinitions;\n+import org.kie.workbench.common.dmn.client.editors.expressions.types.context.ContextGridRowNumberColumn;\n+import org.kie.workbench.common.dmn.client.editors.expressions.types.context.ExpressionCellValue;\n+import org.kie.workbench.common.dmn.client.editors.expressions.types.context.ExpressionEditorColumn;\n+import org.kie.workbench.common.dmn.client.editors.expressions.types.undefined.UndefinedExpressionGrid;\n+import org.kie.workbench.common.dmn.client.editors.expressions.util.SelectionUtils;\n+import org.kie.workbench.common.dmn.client.editors.types.ValueAndDataTypePopoverView;\n+import org.kie.workbench.common.dmn.client.resources.i18n.DMNEditorConstants;\n+import org.kie.workbench.common.dmn.client.widgets.grid.BaseExpressionGrid;\n+import org.kie.workbench.common.dmn.client.widgets.grid.BaseExpressionGridRenderer;\n+import org.kie.workbench.common.dmn.client.widgets.grid.controls.container.CellEditorControlsView;\n+import org.kie.workbench.common.dmn.client.widgets.grid.controls.list.HasListSelectorControl;\n+import org.kie.workbench.common.dmn.client.widgets.grid.controls.list.ListSelectorView;\n+import org.kie.workbench.common.dmn.client.widgets.grid.model.ExpressionEditorChanged;\n+import org.kie.workbench.common.dmn.client.widgets.grid.model.ExpressionEditorGridRow;\n+import org.kie.workbench.common.dmn.client.widgets.grid.model.GridCellTuple;\n+import org.kie.workbench.common.dmn.client.widgets.layer.DMNGridLayer;\n+import org.kie.workbench.common.dmn.client.widgets.panel.DMNGridPanel;\n+import org.kie.workbench.common.stunner.core.client.api.SessionManager;\n+import org.kie.workbench.common.stunner.core.client.canvas.AbstractCanvasHandler;\n+import org.kie.workbench.common.stunner.core.client.canvas.event.selection.DomainObjectSelectionEvent;\n+import org.kie.workbench.common.stunner.core.client.command.SessionCommandManager;\n+import org.kie.workbench.common.stunner.core.domainobject.DomainObject;\n+import org.kie.workbench.common.stunner.core.util.DefinitionUtils;\n+import org.kie.workbench.common.stunner.forms.client.event.RefreshFormPropertiesEvent;\n+import org.uberfire.ext.wires.core.grids.client.model.GridCell;\n+import org.uberfire.ext.wires.core.grids.client.model.GridColumn;\n+import org.uberfire.ext.wires.core.grids.client.model.GridRow;\n+import org.uberfire.ext.wires.core.grids.client.model.impl.BaseHeaderMetaData;\n+\n+public class ListGrid extends BaseExpressionGrid<List, ListGridData, ListUIModelMapper> implements HasListSelectorControl {\n+\n+    private final ValueAndDataTypePopoverView.Presenter headerEditor;\n+\n+    private final Supplier<ExpressionEditorDefinitions> expressionEditorDefinitionsSupplier;\n+\n+    public ListGrid(final GridCellTuple parent,\n+                    final Optional<String> nodeUUID,\n+                    final HasExpression hasExpression,\n+                    final Optional<HasName> hasName,\n+                    final DMNGridPanel gridPanel,\n+                    final DMNGridLayer gridLayer,\n+                    final ListGridData gridData,\n+                    final DefinitionUtils definitionUtils,\n+                    final SessionManager sessionManager,\n+                    final SessionCommandManager<AbstractCanvasHandler> sessionCommandManager,\n+                    final DefaultCanvasCommandFactory canvasCommandFactory,\n+                    final Event<ExpressionEditorChanged> editorSelectedEvent,\n+                    final Event<RefreshFormPropertiesEvent> refreshFormPropertiesEvent,\n+                    final Event<DomainObjectSelectionEvent> domainObjectSelectionEvent,\n+                    final CellEditorControlsView.Presenter cellEditorControls,\n+                    final ListSelectorView.Presenter listSelector,\n+                    final TranslationService translationService,\n+                    final boolean isOnlyVisualChangeAllowed,\n+                    final int nesting,\n+                    final Supplier<ExpressionEditorDefinitions> expressionEditorDefinitionsSupplier,\n+                    final ValueAndDataTypePopoverView.Presenter headerEditor) {\n+        super(parent,\n+              nodeUUID,\n+              hasExpression,\n+              hasName,\n+              gridPanel,\n+              gridLayer,\n+              gridData,\n+              new BaseExpressionGridRenderer(gridData),\n+              definitionUtils,\n+              sessionManager,\n+              sessionCommandManager,\n+              canvasCommandFactory,\n+              editorSelectedEvent,\n+              refreshFormPropertiesEvent,\n+              domainObjectSelectionEvent,\n+              cellEditorControls,\n+              listSelector,\n+              translationService,\n+              isOnlyVisualChangeAllowed,\n+              nesting);\n+        this.expressionEditorDefinitionsSupplier = expressionEditorDefinitionsSupplier;\n+        this.headerEditor = headerEditor;\n+\n+        setEventPropagationMode(EventPropagationMode.NO_ANCESTORS);\n+\n+        super.doInitialisation();\n+    }\n+\n+    @Override\n+    protected void doInitialisation() {\n+        // Defer initialisation until after the constructor completes as\n+        // makeUiModelMapper needs expressionEditorDefinitionsSupplier to have been set\n+    }\n+\n+    @Override\n+    public ListUIModelMapper makeUiModelMapper() {\n+        return new ListUIModelMapper(this,\n+                                     this::getModel,/**/\n+                                     getExpression(),\n+                                     () -> isOnlyVisualChangeAllowed,\n+                                     expressionEditorDefinitionsSupplier,\n+                                     listSelector,\n+                                     nesting);\n+    }\n+\n+    @Override\n+    public void initialiseUiColumns() {\n+        final java.util.List<GridColumn.HeaderMetaData> headerMetaData = new ArrayList<>();\n+        final ContextGridRowNumberColumn rowNumberColumn = new ContextGridRowNumberColumn(headerMetaData,\n+                                                                                          getAndSetInitialWidth(ListUIModelMapperHelper.ROW_COLUMN_INDEX,\n+                                                                                                                ContextGridRowNumberColumn.DEFAULT_WIDTH));\n+\n+        if (nesting == 0) {\n+            rowNumberColumn.getHeaderMetaData().add(new BaseHeaderMetaData(\"#\"));\n+            headerMetaData.add(new ListExpressionColumnHeaderMetaData(hasExpression,\n+                                                                      hasName,\n+                                                                      clearValueConsumer(true, new Name()),\n+                                                                      setValueConsumer(true),\n+                                                                      setTypeRefConsumer(),\n+                                                                      translationService,\n+                                                                      cellEditorControls,\n+                                                                      headerEditor));\n+        }\n+\n+        final GridColumn listColumn = new ListExpressionEditorColumn(gridLayer,\n+                                                                     headerMetaData,\n+                                                                     getAndSetInitialWidth(ListUIModelMapperHelper.EXPRESSION_COLUMN_INDEX,\n+                                                                                           ExpressionEditorColumn.DEFAULT_WIDTH),\n+                                                                     this);\n+        model.appendColumn(rowNumberColumn);\n+        model.appendColumn(listColumn);\n+\n+        getRenderer().setColumnRenderConstraint((isSelectionLayer, gridColumn) -> true);\n+    }\n+\n+    @Override\n+    public void initialiseUiRows() {\n+        getExpression().get().ifPresent(list -> {\n+            list.getExpression().forEach(e -> model.appendRow(new ExpressionEditorGridRow()));\n+        });\n+    }\n+\n+    @Override\n+    public void initialiseUiCells() {\n+        getExpression().get().ifPresent(list -> {\n+            for (int rowIndex = 0; rowIndex < list.getExpression().size(); rowIndex++) {\n+                uiModelMapper.fromDMNModel(rowIndex,\n+                                           0);\n+                uiModelMapper.fromDMNModel(rowIndex,\n+                                           1);\n+            }\n+        });\n+    }\n+\n+    @Override\n+    public java.util.List<ListSelectorItem> getItems(final int uiRowIndex,\n+                                                     final int uiColumnIndex) {\n+        final java.util.List<ListSelectorItem> items = new ArrayList<>();\n+        final boolean isMultiRow = SelectionUtils.isMultiRow(model);\n+        final boolean isMultiSelect = SelectionUtils.isMultiSelect(model);\n+\n+        items.add(ListSelectorHeaderItem.build(translationService.format(DMNEditorConstants.ListEditor_HeaderRows)));\n+        items.add(ListSelectorTextItem.build(translationService.format(DMNEditorConstants.ListEditor_InsertRowAbove),\n+                                             !isMultiRow,\n+                                             () -> {\n+                                                 cellEditorControls.hide();\n+                                                 getExpression().get().ifPresent(e -> addRow(uiRowIndex));\n+                                             }));\n+        items.add(ListSelectorTextItem.build(translationService.format(DMNEditorConstants.ListEditor_InsertRowBelow),\n+                                             !isMultiRow,\n+                                             () -> {\n+                                                 cellEditorControls.hide();\n+                                                 getExpression().get().ifPresent(e -> addRow(uiRowIndex + 1));\n+                                             }));\n+        items.add(ListSelectorTextItem.build(translationService.format(DMNEditorConstants.ListEditor_DeleteRow),\n+                                             !isMultiRow && model.getRowCount() > 1,\n+                                             () -> {\n+                                                 cellEditorControls.hide();\n+                                                 getExpression().get().ifPresent(e -> deleteRow(uiRowIndex));\n+                                             }));\n+\n+        //If not ExpressionEditor column don't add extra items\n+        if (ListUIModelMapperHelper.getSection(uiColumnIndex) != ListUIModelMapperHelper.ListSection.EXPRESSION) {\n+            return items;\n+        }\n+\n+        //If cell editor is UndefinedExpressionGrid don't add extra items\n+        final GridCell<?> cell = model.getCell(uiRowIndex, uiColumnIndex);\n+        final ExpressionCellValue ecv = (ExpressionCellValue) cell.getValue();\n+        if (!ecv.getValue().isPresent()) {\n+            return items;\n+        }\n+        final BaseExpressionGrid grid = ecv.getValue().get();\n+        if (grid instanceof UndefinedExpressionGrid) {\n+            return items;\n+        }\n+\n+        if (items.size() > 0) {\n+            items.add(new ListSelectorDividerItem());\n+        }\n+        items.add(ListSelectorTextItem.build(translationService.format(DMNEditorConstants.ExpressionEditor_Clear),\n+                                             !isMultiSelect,\n+                                             () -> {\n+                                                 cellEditorControls.hide();\n+                                                 clearExpressionType(uiRowIndex);\n+                                             }));\n+\n+        return items;\n+    }\n+\n+    @Override\n+    public void onItemSelected(final ListSelectorItem item) {\n+        final ListSelectorTextItem li = (ListSelectorTextItem) item;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "19205611aeb71a020ddcc44bbecc4dcc7a7ee2c7"}, "originalPosition": 246}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NDkyMjM4OQ==", "bodyText": "2020", "url": "https://github.com/kiegroup/kie-wb-common/pull/3220#discussion_r394922389", "createdAt": "2020-03-19T10:20:33Z", "author": {"login": "jomarko"}, "path": "kie-wb-common-dmn/kie-wb-common-dmn-client/src/test/java/org/kie/workbench/common/dmn/client/commands/expressions/types/list/MoveListRowsCommandTest.java", "diffHunk": "@@ -0,0 +1,373 @@\n+/*\n+ * Copyright 2017 Red Hat, Inc. and/or its affiliates.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "19205611aeb71a020ddcc44bbecc4dcc7a7ee2c7"}, "originalPosition": 2}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NDkyMjY4Ng==", "bodyText": "2020", "url": "https://github.com/kiegroup/kie-wb-common/pull/3220#discussion_r394922686", "createdAt": "2020-03-19T10:21:05Z", "author": {"login": "jomarko"}, "path": "kie-wb-common-dmn/kie-wb-common-dmn-client/src/test/java/org/kie/workbench/common/dmn/client/editors/expressions/types/list/ListExpressionColumnHeaderMetaDataTest.java", "diffHunk": "@@ -0,0 +1,68 @@\n+/*\n+ * Copyright 2019 Red Hat, Inc. and/or its affiliates.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "19205611aeb71a020ddcc44bbecc4dcc7a7ee2c7"}, "originalPosition": 2}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "65814304aff4403cceeb64fc63322837e67a7e29", "author": {"user": null}, "url": "https://github.com/kiegroup/kie-wb-common/commit/65814304aff4403cceeb64fc63322837e67a7e29", "committedDate": "2020-03-19T15:25:54Z", "message": "Updates following peer review."}, "afterCommit": {"oid": "0c0be69bbf2af2321b69be3ba1d936e8e6d81f02", "author": {"user": null}, "url": "https://github.com/kiegroup/kie-wb-common/commit/0c0be69bbf2af2321b69be3ba1d936e8e6d81f02", "committedDate": "2020-03-19T15:28:13Z", "message": "Updates following peer review. Integration test for List client-side marshalling added too."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "bd15b9a06f88d93dffe909ef84135f1f369cd80f", "author": {"user": null}, "url": "https://github.com/kiegroup/kie-wb-common/commit/bd15b9a06f88d93dffe909ef84135f1f369cd80f", "committedDate": "2020-03-19T15:35:39Z", "message": "Updates following peer review. Integration test for List client-side marshalling added too."}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "0c0be69bbf2af2321b69be3ba1d936e8e6d81f02", "author": {"user": null}, "url": "https://github.com/kiegroup/kie-wb-common/commit/0c0be69bbf2af2321b69be3ba1d936e8e6d81f02", "committedDate": "2020-03-19T15:28:13Z", "message": "Updates following peer review. Integration test for List client-side marshalling added too."}, "afterCommit": {"oid": "bd15b9a06f88d93dffe909ef84135f1f369cd80f", "author": {"user": null}, "url": "https://github.com/kiegroup/kie-wb-common/commit/bd15b9a06f88d93dffe909ef84135f1f369cd80f", "committedDate": "2020-03-19T15:35:39Z", "message": "Updates following peer review. Integration test for List client-side marshalling added too."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzc4MDQwODA0", "url": "https://github.com/kiegroup/kie-wb-common/pull/3220#pullrequestreview-378040804", "createdAt": "2020-03-19T19:45:43Z", "commit": {"oid": "bd15b9a06f88d93dffe909ef84135f1f369cd80f"}, "state": "APPROVED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xOVQxOTo0NTo0NFrOF493xw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xOVQxOTo0NTo0NFrOF493xw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NTI3ODI3OQ==", "bodyText": "don't we use the \"convention\" and name the file \"decision-expression-list.xml\"?", "url": "https://github.com/kiegroup/kie-wb-common/pull/3220#discussion_r395278279", "createdAt": "2020-03-19T19:45:44Z", "author": {"login": "jomarko"}, "path": "kie-wb-common-dmn/kie-wb-common-dmn-webapp-kogito-runtime/src/test/resources/org/kie/workbench/common/dmn/showcase/client/selenium/DROOLS-5131 (List expression).xml", "diffHunk": "@@ -0,0 +1,52 @@\n+<?xml version='1.0' ?>\n+<dmn:definitions xmlns:dmn='http://www.omg.org/spec/DMN/20180521/MODEL/'\n+                 xmlns='https://kiegroup.org/dmn/_A36E66A0-5CC4-494F-8E8C-47FE35520173'\n+                 xmlns:di='http://www.omg.org/spec/DMN/20180521/DI/'\n+                 xmlns:kie='http://www.drools.org/kie/dmn/1.2'\n+                 xmlns:dmndi='http://www.omg.org/spec/DMN/20180521/DMNDI/'\n+                 xmlns:dc='http://www.omg.org/spec/DMN/20180521/DC/'\n+                 id='_15712B07-1327-478A-A1A8-214878C1F307'\n+                 name='DROOLS-5131'", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "bd15b9a06f88d93dffe909ef84135f1f369cd80f"}, "originalPosition": 9}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzc4NTE1NzAx", "url": "https://github.com/kiegroup/kie-wb-common/pull/3220#pullrequestreview-378515701", "createdAt": "2020-03-20T14:11:02Z", "commit": {"oid": "bd15b9a06f88d93dffe909ef84135f1f369cd80f"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 531, "cost": 1, "resetAt": "2021-11-01T15:33:45Z"}}}