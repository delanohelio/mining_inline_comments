{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0MzgxNDIyNTM3", "number": 3199, "reviewThreads": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yOFQxNTowMzo1MlrODj197g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yOFQxNTowNjoxOVrODj2BMA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjM4OTEwOTU4OnYy", "diffSide": "RIGHT", "path": "kie-wb-common-dmn/kie-wb-common-dmn-webapp-kogito-common/src/test/java/org/kie/workbench/common/dmn/webapp/kogito/common/client/services/DMNClientDiagramServiceImplTest.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yOFQxNTowMzo1MlrOFv3-AA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yOFQxNTowMzo1MlrOFv3-AA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NTc0NDM4NA==", "bodyText": "Do we really have to mock the behaviour of this method!?!", "url": "https://github.com/kiegroup/kie-wb-common/pull/3199#discussion_r385744384", "createdAt": "2020-02-28T15:03:52Z", "author": {"login": "manstis"}, "path": "kie-wb-common-dmn/kie-wb-common-dmn-webapp-kogito-common/src/test/java/org/kie/workbench/common/dmn/webapp/kogito/common/client/services/DMNClientDiagramServiceImplTest.java", "diffHunk": "@@ -0,0 +1,103 @@\n+/*\n+ * Copyright 2020 Red Hat, Inc. and/or its affiliates.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package org.kie.workbench.common.dmn.webapp.kogito.common.client.services;\n+\n+import com.google.gwtmockito.GwtMockitoTestRunner;\n+import org.junit.Before;\n+import org.junit.Test;\n+import org.junit.runner.RunWith;\n+import org.kie.workbench.common.stunner.core.client.service.ServiceCallback;\n+import org.kie.workbench.common.stunner.core.diagram.Diagram;\n+\n+import static org.junit.Assert.assertEquals;\n+import static org.mockito.Mockito.doNothing;\n+import static org.mockito.Mockito.doReturn;\n+import static org.mockito.Mockito.mock;\n+import static org.mockito.Mockito.never;\n+import static org.mockito.Mockito.spy;\n+import static org.mockito.Mockito.verify;\n+\n+@RunWith(GwtMockitoTestRunner.class)\n+public class DMNClientDiagramServiceImplTest {\n+\n+    private DMNClientDiagramServiceImpl service;\n+\n+    @Before\n+    public void setup() {\n+        service = spy(new DMNClientDiagramServiceImpl());\n+    }\n+\n+    @Test\n+    public void testTransformWhenFileIsNew() {\n+        final String fileName = \"file.dmn\";\n+        final String xml = \"\";\n+        final ServiceCallback<Diagram> callback = mock(ServiceCallback.class);\n+        final String title = \"title\";\n+\n+        doReturn(title).when(service).getDiagramTitle(fileName);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "bce71ffb6b447e06066f62d83ba60c34ea896679"}, "originalPosition": 51}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjM4OTExMDAwOnYy", "diffSide": "RIGHT", "path": "kie-wb-common-dmn/kie-wb-common-dmn-webapp-kogito-common/src/test/java/org/kie/workbench/common/dmn/webapp/kogito/common/client/services/DMNClientDiagramServiceImplTest.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yOFQxNTowMzo1OVrOFv3-PQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yOFQxNTowMzo1OVrOFv3-PQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NTc0NDQ0NQ==", "bodyText": "Do we really have to mock the behaviour of this method!?!", "url": "https://github.com/kiegroup/kie-wb-common/pull/3199#discussion_r385744445", "createdAt": "2020-02-28T15:03:59Z", "author": {"login": "manstis"}, "path": "kie-wb-common-dmn/kie-wb-common-dmn-webapp-kogito-common/src/test/java/org/kie/workbench/common/dmn/webapp/kogito/common/client/services/DMNClientDiagramServiceImplTest.java", "diffHunk": "@@ -0,0 +1,103 @@\n+/*\n+ * Copyright 2020 Red Hat, Inc. and/or its affiliates.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package org.kie.workbench.common.dmn.webapp.kogito.common.client.services;\n+\n+import com.google.gwtmockito.GwtMockitoTestRunner;\n+import org.junit.Before;\n+import org.junit.Test;\n+import org.junit.runner.RunWith;\n+import org.kie.workbench.common.stunner.core.client.service.ServiceCallback;\n+import org.kie.workbench.common.stunner.core.diagram.Diagram;\n+\n+import static org.junit.Assert.assertEquals;\n+import static org.mockito.Mockito.doNothing;\n+import static org.mockito.Mockito.doReturn;\n+import static org.mockito.Mockito.mock;\n+import static org.mockito.Mockito.never;\n+import static org.mockito.Mockito.spy;\n+import static org.mockito.Mockito.verify;\n+\n+@RunWith(GwtMockitoTestRunner.class)\n+public class DMNClientDiagramServiceImplTest {\n+\n+    private DMNClientDiagramServiceImpl service;\n+\n+    @Before\n+    public void setup() {\n+        service = spy(new DMNClientDiagramServiceImpl());\n+    }\n+\n+    @Test\n+    public void testTransformWhenFileIsNew() {\n+        final String fileName = \"file.dmn\";\n+        final String xml = \"\";\n+        final ServiceCallback<Diagram> callback = mock(ServiceCallback.class);\n+        final String title = \"title\";\n+\n+        doReturn(title).when(service).getDiagramTitle(fileName);\n+        doNothing().when(service).doNewDiagram(title, callback);\n+\n+        service.transform(fileName, xml, callback);\n+\n+        verify(service).doNewDiagram(title, callback);\n+    }\n+\n+    @Test\n+    public void testTransformWhenFileIsNotNew() {\n+        final String fileName = \"file.dmn\";\n+        final String xml = \"xml\";\n+        final ServiceCallback<Diagram> callback = mock(ServiceCallback.class);\n+        final String title = \"title\";\n+\n+        doReturn(title).when(service).getDiagramTitle(fileName);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "bce71ffb6b447e06066f62d83ba60c34ea896679"}, "originalPosition": 66}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjM4OTExNzUzOnYy", "diffSide": "RIGHT", "path": "kie-wb-common-dmn/kie-wb-common-dmn-webapp-kogito-common/src/main/java/org/kie/workbench/common/dmn/webapp/kogito/common/client/services/DMNClientDiagramServiceImpl.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yOFQxNTowNjoxM1rOFv4C_w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yOFQxODo1MDo0MlrOFv_Nbw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NTc0NTY2Mw==", "bodyText": "I'm a stickler for parameters on new lines.. but it's just my opinion, so I state it but don't expect it to be fixed.", "url": "https://github.com/kiegroup/kie-wb-common/pull/3199#discussion_r385745663", "createdAt": "2020-02-28T15:06:13Z", "author": {"login": "manstis"}, "path": "kie-wb-common-dmn/kie-wb-common-dmn-webapp-kogito-common/src/main/java/org/kie/workbench/common/dmn/webapp/kogito/common/client/services/DMNClientDiagramServiceImpl.java", "diffHunk": "@@ -95,17 +95,39 @@ public DMNClientDiagramServiceImpl(final DMNMarshallerKogitoUnmarshaller dmnMars\n     //Kogito requirements\n \n     @Override\n-    public void transform(final String xml,\n-                          final ServiceCallback<Diagram> callback) {\n+    public void transform(final String fileName, final String xml, final ServiceCallback<Diagram> callback) {\n         if (Objects.isNull(xml) || xml.isEmpty()) {\n-            doNewDiagram(callback);\n+            doNewDiagram(getDiagramTitle(fileName), callback);\n         } else {\n             doTransformation(xml, callback);\n         }\n     }\n \n-    private void doNewDiagram(final ServiceCallback<Diagram> callback) {\n-        final String title = UUID.uuid();\n+    String getDiagramTitle(final String fileName) {\n+        final String diagramTitle;\n+        if (StringUtils.isEmpty(fileName)) {\n+            diagramTitle = generateDiagramTitle();\n+        } else {\n+            if (fileName.contains(\".\")) {\n+                diagramTitle = fileName.substring(0, fileName.lastIndexOf('.'));\n+            } else {\n+                diagramTitle = fileName;\n+            }\n+        }\n+        return diagramTitle;\n+    }\n+\n+    String generateDiagramTitle() {\n+        return UUID.uuid();\n+    }\n+\n+    @Override\n+    public void transform(final String xml,\n+                          final ServiceCallback<Diagram> callback) {\n+        transform(UUID.uuid(), xml, callback);\n+    }\n+\n+    void doNewDiagram(final String title, final ServiceCallback<Diagram> callback) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "bce71ffb6b447e06066f62d83ba60c34ea896679"}, "originalPosition": 41}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NTg2MzAyMw==", "bodyText": "Like you I also prefer parameters on new lines, but sometimes the reviewers don't, so it's hard to know what to do. I'm changing anyway.", "url": "https://github.com/kiegroup/kie-wb-common/pull/3199#discussion_r385863023", "createdAt": "2020-02-28T18:50:42Z", "author": {"login": "danielzhe"}, "path": "kie-wb-common-dmn/kie-wb-common-dmn-webapp-kogito-common/src/main/java/org/kie/workbench/common/dmn/webapp/kogito/common/client/services/DMNClientDiagramServiceImpl.java", "diffHunk": "@@ -95,17 +95,39 @@ public DMNClientDiagramServiceImpl(final DMNMarshallerKogitoUnmarshaller dmnMars\n     //Kogito requirements\n \n     @Override\n-    public void transform(final String xml,\n-                          final ServiceCallback<Diagram> callback) {\n+    public void transform(final String fileName, final String xml, final ServiceCallback<Diagram> callback) {\n         if (Objects.isNull(xml) || xml.isEmpty()) {\n-            doNewDiagram(callback);\n+            doNewDiagram(getDiagramTitle(fileName), callback);\n         } else {\n             doTransformation(xml, callback);\n         }\n     }\n \n-    private void doNewDiagram(final ServiceCallback<Diagram> callback) {\n-        final String title = UUID.uuid();\n+    String getDiagramTitle(final String fileName) {\n+        final String diagramTitle;\n+        if (StringUtils.isEmpty(fileName)) {\n+            diagramTitle = generateDiagramTitle();\n+        } else {\n+            if (fileName.contains(\".\")) {\n+                diagramTitle = fileName.substring(0, fileName.lastIndexOf('.'));\n+            } else {\n+                diagramTitle = fileName;\n+            }\n+        }\n+        return diagramTitle;\n+    }\n+\n+    String generateDiagramTitle() {\n+        return UUID.uuid();\n+    }\n+\n+    @Override\n+    public void transform(final String xml,\n+                          final ServiceCallback<Diagram> callback) {\n+        transform(UUID.uuid(), xml, callback);\n+    }\n+\n+    void doNewDiagram(final String title, final ServiceCallback<Diagram> callback) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NTc0NTY2Mw=="}, "originalCommit": {"oid": "bce71ffb6b447e06066f62d83ba60c34ea896679"}, "originalPosition": 41}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjM4OTExNzkyOnYy", "diffSide": "RIGHT", "path": "kie-wb-common-dmn/kie-wb-common-dmn-webapp-kogito-common/src/main/java/org/kie/workbench/common/dmn/webapp/kogito/common/client/services/DMNClientDiagramServiceImpl.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yOFQxNTowNjoxOVrOFv4DPQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yOFQxNTowNjoxOVrOFv4DPQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NTc0NTcyNQ==", "bodyText": "I'm a stickler for parameters on new lines.. but it's just my opinion, so I state it but don't expect it to be fixed.", "url": "https://github.com/kiegroup/kie-wb-common/pull/3199#discussion_r385745725", "createdAt": "2020-02-28T15:06:19Z", "author": {"login": "manstis"}, "path": "kie-wb-common-dmn/kie-wb-common-dmn-webapp-kogito-common/src/main/java/org/kie/workbench/common/dmn/webapp/kogito/common/client/services/DMNClientDiagramServiceImpl.java", "diffHunk": "@@ -95,17 +95,39 @@ public DMNClientDiagramServiceImpl(final DMNMarshallerKogitoUnmarshaller dmnMars\n     //Kogito requirements\n \n     @Override\n-    public void transform(final String xml,\n-                          final ServiceCallback<Diagram> callback) {\n+    public void transform(final String fileName, final String xml, final ServiceCallback<Diagram> callback) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "bce71ffb6b447e06066f62d83ba60c34ea896679"}, "originalPosition": 6}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1379, "cost": 1, "resetAt": "2021-11-12T20:28:25Z"}}}