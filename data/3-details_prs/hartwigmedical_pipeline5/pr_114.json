{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0MzY0NTU1NjQw", "number": 114, "title": "DEV-1108 Add archiver for bcl2fastq", "bodyText": "", "createdAt": "2020-01-19T17:03:52Z", "url": "https://github.com/hartwigmedical/pipeline5/pull/114", "merged": true, "mergeCommit": {"oid": "17e4f6d3108f31498cd27902f7af80a38f212080"}, "closed": true, "closedAt": "2020-01-22T21:18:10Z", "author": {"login": "nedleitch"}, "timelineItems": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABb76WxvAH2gAyMzY0NTU1NjQwOjQzODNkYjU5NDhjZDljZDdmMzY2MzM4Njk1MjE3Njg4ZWExYjhlNTE=", "endCursor": "Y3Vyc29yOnYyOpPPAAABb86KkCgH2gAyMzY0NTU1NjQwOjJhYmNmMTAwOTQ0NTVjMjM3YmFkNDhhMzQzMTgwY2ZjMDllYWE3ZmU=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "4383db5948cd9cd7f366338695217688ea1b8e51", "author": {"user": null}, "url": "https://github.com/hartwigmedical/pipeline5/commit/4383db5948cd9cd7f366338695217688ea1b8e51", "committedDate": "2020-01-19T16:15:50Z", "message": "DEV-1108 Add archiver for bcl2fastq"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d2543b669420bfc231994947d2ef3e7a10cf3549", "author": {"user": null}, "url": "https://github.com/hartwigmedical/pipeline5/commit/d2543b669420bfc231994947d2ef3e7a10cf3549", "committedDate": "2020-01-20T20:08:15Z", "message": "Merge branch 'master' into DEV-1108"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "27f26b09e862732ac325775ac1b548dd488a861d", "author": {"user": null}, "url": "https://github.com/hartwigmedical/pipeline5/commit/27f26b09e862732ac325775ac1b548dd488a861d", "committedDate": "2020-01-21T16:00:11Z", "message": "DEV-1108 Merge OutputCopy with OutputArchiver\n\nNew information made us decide to just push straight to the archive\nafter the completion of the `bcl2fastq` processing. This commit thus\nalso removes the output bucket argument.\n\nAlso remove the `Aligner` interface as there is a single implementation\nnow."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzQ2NTQxMjMy", "url": "https://github.com/hartwigmedical/pipeline5/pull/114#pullrequestreview-346541232", "createdAt": "2020-01-22T12:11:48Z", "commit": {"oid": "27f26b09e862732ac325775ac1b548dd488a861d"}, "state": "APPROVED", "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yMlQxMjoxMTo0OFrOFgZ_nQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yMlQxMjoyNDoxM1rOFgaS3w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2OTUyNDYzNw==", "bodyText": "Thinking we may want to name this \"output\" bucket instead as the use of it is no longer purely archival.", "url": "https://github.com/hartwigmedical/pipeline5/pull/114#discussion_r369524637", "createdAt": "2020-01-22T12:11:48Z", "author": {"login": "pauldwolfe"}, "path": "bcl2fastq/src/main/java/com/hartwig/bcl2fastq/Bcl2fastqArguments.java", "diffHunk": "@@ -1,29 +1,32 @@\n package com.hartwig.bcl2fastq;\n \n-import static java.lang.Boolean.parseBoolean;\n-\n-import java.util.Optional;\n-\n import com.hartwig.pipeline.CommonArguments;\n-\n import org.apache.commons.cli.CommandLine;\n import org.apache.commons.cli.DefaultParser;\n import org.apache.commons.cli.Option;\n import org.apache.commons.cli.Options;\n import org.apache.commons.cli.ParseException;\n import org.immutables.value.Value;\n \n+import static java.lang.Boolean.parseBoolean;\n+\n @Value.Immutable\n public interface Bcl2fastqArguments extends CommonArguments {\n \n-    String INPUT_BUCKET = \"input_bucket\";\n+    String ARCHIVE_BUCKET = \"archive_bucket\";\n+    String ARCHIVE_PRIVATE_KEY_PATH = \"archive_private_key_path\";\n+    String ARCHIVE_PROJECT = \"archive_project\";\n     String FLOWCELL = \"flowcell\";\n-    String OUTPUT_BUCKET = \"output_bucket\";\n+    String INPUT_BUCKET = \"input_bucket\";\n     String SBP_API_URL = \"sbp_api_url\";\n \n-    String inputBucket();\n+    String archiveBucket();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "27f26b09e862732ac325775ac1b548dd488a861d"}, "originalPosition": 31}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2OTUyOTMwNw==", "bodyText": "Feel like removing the Aligner interface probably should have been in another ticket, not really related to adding an archiver to bcl2fastq (but fine to keep it in this commit)", "url": "https://github.com/hartwigmedical/pipeline5/pull/114#discussion_r369529307", "createdAt": "2020-01-22T12:23:34Z", "author": {"login": "pauldwolfe"}, "path": "cluster/src/main/java/com/hartwig/pipeline/alignment/vm/VmAligner.java", "diffHunk": "@@ -42,7 +27,22 @@\n import com.hartwig.pipeline.storage.SampleUpload;\n import com.hartwig.pipeline.trace.StageTrace;\n \n-public class VmAligner implements Aligner {\n+import java.io.File;\n+import java.util.ArrayList;\n+import java.util.List;\n+import java.util.concurrent.ExecutionException;\n+import java.util.concurrent.ExecutorService;\n+import java.util.concurrent.Future;\n+import java.util.stream.Collectors;\n+\n+import static com.hartwig.pipeline.alignment.AlignmentOutputPaths.bai;\n+import static com.hartwig.pipeline.alignment.AlignmentOutputPaths.bam;\n+import static com.hartwig.pipeline.alignment.AlignmentOutputPaths.sorted;\n+import static java.lang.String.format;\n+\n+public class VmAligner {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "27f26b09e862732ac325775ac1b548dd488a861d"}, "originalPosition": 44}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2OTUyOTU2Nw==", "bodyText": "Can go?", "url": "https://github.com/hartwigmedical/pipeline5/pull/114#discussion_r369529567", "createdAt": "2020-01-22T12:24:13Z", "author": {"login": "pauldwolfe"}, "path": "cluster/src/main/java/com/hartwig/pipeline/storage/SampleDownload.java", "diffHunk": "@@ -0,0 +1,4 @@\n+package com.hartwig.pipeline.storage;\n+\n+public class SampleDownload {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "27f26b09e862732ac325775ac1b548dd488a861d"}, "originalPosition": 3}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "2abcf10094455c237bad48a343180cfc09eaa7fe", "author": {"user": null}, "url": "https://github.com/hartwigmedical/pipeline5/commit/2abcf10094455c237bad48a343180cfc09eaa7fe", "committedDate": "2020-01-22T18:36:25Z", "message": "DEV-1108 Rename archiver to OutputCopier"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3775, "cost": 1, "resetAt": "2021-11-01T14:51:55Z"}}}