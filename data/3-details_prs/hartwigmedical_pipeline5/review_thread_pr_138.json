{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0Mzg1NDU0MjIw", "number": 138, "reviewThreads": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wOVQxNzoyOTozOVrODmZMvA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wOVQxNzozNDo0NFrODmZUdw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjQxNTg1MzQwOnYy", "diffSide": "RIGHT", "path": "batch/src/main/java/com/hartwig/batch/BatchArguments.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wOVQxNzoyOTozOVrOFzyU7g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wOVQxNzoyOTozOVrOFzyU7g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4OTg0NjI1NA==", "bodyText": "better to pull these up into CommonArguments than to introduce a dependency on pipeline Arguments", "url": "https://github.com/hartwigmedical/pipeline5/pull/138#discussion_r389846254", "createdAt": "2020-03-09T17:29:39Z", "author": {"login": "pauldwolfe"}, "path": "batch/src/main/java/com/hartwig/batch/BatchArguments.java", "diffHunk": "@@ -41,8 +33,8 @@ static BatchArguments from(String[] args) {\n             CommandLine commandLine = new DefaultParser().parse(options(), args);\n             return ImmutableBatchArguments.builder()\n                     .command(args[0])\n-                    .project(commandLine.getOptionValue(PROJECT, \"hmf-pipeline-development\"))\n-                    .region(commandLine.getOptionValue(REGION, \"europe-west4\"))\n+                    .project(commandLine.getOptionValue(PROJECT, Arguments.DEFAULT_DEVELOPMENT_PROJECT))", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ad2697d3e9817b1f83a310445f9b9345b751c0da"}, "originalPosition": 45}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjQxNTg1OTE0OnYy", "diffSide": "RIGHT", "path": "cluster/src/main/java/com/hartwig/pipeline/Arguments.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wOVQxNzozMTowNlrOFzyYfw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wOVQxNzozMTowNlrOFzyYfw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4OTg0NzE2Nw==", "bodyText": "Normal the CMEK is actually just the name of the key used ie. projects/project/location/blah/blah. Does this actually work having it a json file? I don't see why running in Docker would need to impact CMEK (it's more like the prokect or location setttings).", "url": "https://github.com/hartwigmedical/pipeline5/pull/138#discussion_r389847167", "createdAt": "2020-03-09T17:31:06Z", "author": {"login": "pauldwolfe"}, "path": "cluster/src/main/java/com/hartwig/pipeline/Arguments.java", "diffHunk": "@@ -17,6 +17,120 @@\n \n     boolean cleanup();\n \n+    String DEFAULT_DOCKER_CMEK = \"/secrets/storage-cmek.json\";", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ad2697d3e9817b1f83a310445f9b9345b751c0da"}, "originalPosition": 4}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjQxNTg2MjQzOnYy", "diffSide": "RIGHT", "path": "cluster/src/main/java/com/hartwig/pipeline/Arguments.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wOVQxNzozMjowMlrOFzyang==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xNFQwNzowNDo1OVrOF2YL1A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4OTg0NzcxMA==", "bodyText": "Why are these all \"new lines\"?", "url": "https://github.com/hartwigmedical/pipeline5/pull/138#discussion_r389847710", "createdAt": "2020-03-09T17:32:02Z", "author": {"login": "pauldwolfe"}, "path": "cluster/src/main/java/com/hartwig/pipeline/Arguments.java", "diffHunk": "@@ -17,6 +17,120 @@\n \n     boolean cleanup();\n \n+    String DEFAULT_DOCKER_CMEK = \"/secrets/storage-cmek.json\";\n+\n+    boolean upload();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ad2697d3e9817b1f83a310445f9b9345b751c0da"}, "originalPosition": 6}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MjU2MzY2OA==", "bodyText": "Ah. I moved the builder method below the constants and interface methods.", "url": "https://github.com/hartwigmedical/pipeline5/pull/138#discussion_r392563668", "createdAt": "2020-03-14T07:04:59Z", "author": {"login": "nedleitch"}, "path": "cluster/src/main/java/com/hartwig/pipeline/Arguments.java", "diffHunk": "@@ -17,6 +17,120 @@\n \n     boolean cleanup();\n \n+    String DEFAULT_DOCKER_CMEK = \"/secrets/storage-cmek.json\";\n+\n+    boolean upload();", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4OTg0NzcxMA=="}, "originalCommit": {"oid": "ad2697d3e9817b1f83a310445f9b9345b751c0da"}, "originalPosition": 6}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjQxNTg2NDkwOnYy", "diffSide": "RIGHT", "path": "cluster/src/main/java/com/hartwig/pipeline/storage/RuntimeBucket.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wOVQxNzozMjozOVrOFzycOQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xMlQyMzowNTozOVrOF1yyQA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4OTg0ODEyMQ==", "bodyText": "use cmek().trim().isEmpty()", "url": "https://github.com/hartwigmedical/pipeline5/pull/138#discussion_r389848121", "createdAt": "2020-03-09T17:32:39Z", "author": {"login": "pauldwolfe"}, "path": "cluster/src/main/java/com/hartwig/pipeline/storage/RuntimeBucket.java", "diffHunk": "@@ -49,10 +48,11 @@ private synchronized static RuntimeBucket createBucketIfNeeded(final Storage sto\n             LOGGER.debug(\"Creating runtime bucket [{}] in Google Storage\", runId);\n             BucketInfo.Builder builder =\n                     BucketInfo.newBuilder(runId).setStorageClass(StorageClass.REGIONAL).setLocation(arguments.region());\n-            arguments.cmek().ifPresent(key -> {\n-                LOGGER.info(\"Using CMEK key [{}] to encrypt all buckets\", key);\n-                builder.setDefaultKmsKeyName(key);\n-            });\n+            if (\"\".equals(arguments.cmek().trim())) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ad2697d3e9817b1f83a310445f9b9345b751c0da"}, "originalPosition": 31}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MTk1MDkxMg==", "bodyText": "Yeah that's weak.", "url": "https://github.com/hartwigmedical/pipeline5/pull/138#discussion_r391950912", "createdAt": "2020-03-12T23:05:39Z", "author": {"login": "nedleitch"}, "path": "cluster/src/main/java/com/hartwig/pipeline/storage/RuntimeBucket.java", "diffHunk": "@@ -49,10 +48,11 @@ private synchronized static RuntimeBucket createBucketIfNeeded(final Storage sto\n             LOGGER.debug(\"Creating runtime bucket [{}] in Google Storage\", runId);\n             BucketInfo.Builder builder =\n                     BucketInfo.newBuilder(runId).setStorageClass(StorageClass.REGIONAL).setLocation(arguments.region());\n-            arguments.cmek().ifPresent(key -> {\n-                LOGGER.info(\"Using CMEK key [{}] to encrypt all buckets\", key);\n-                builder.setDefaultKmsKeyName(key);\n-            });\n+            if (\"\".equals(arguments.cmek().trim())) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4OTg0ODEyMQ=="}, "originalCommit": {"oid": "ad2697d3e9817b1f83a310445f9b9345b751c0da"}, "originalPosition": 31}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjQxNTg3MzE5OnYy", "diffSide": "LEFT", "path": "cluster/src/main/java/com/hartwig/pipeline/CommonArguments.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wOVQxNzozNDo0NFrOFzyhbw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wOVQxNzozNDo0NFrOFzyhbw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4OTg0OTQ1NQ==", "bodyText": "As you pointed out this doesn't make it very external friendly. But... I don't think that's the most important thing right now so we can decide later whether its worth the additional complexity of having a separate flag to disable cmek and make this an optional again.", "url": "https://github.com/hartwigmedical/pipeline5/pull/138#discussion_r389849455", "createdAt": "2020-03-09T17:34:44Z", "author": {"login": "pauldwolfe"}, "path": "cluster/src/main/java/com/hartwig/pipeline/CommonArguments.java", "diffHunk": "@@ -39,7 +39,7 @@\n \n     String serviceAccountEmail();\n \n-    Optional<String> cmek();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ad2697d3e9817b1f83a310445f9b9345b751c0da"}, "originalPosition": 16}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1649, "cost": 1, "resetAt": "2021-11-12T20:28:25Z"}}}