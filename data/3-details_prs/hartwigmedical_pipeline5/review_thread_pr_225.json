{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTE5NDA2ODk3", "number": 225, "reviewThreads": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xMVQyMToxOToyM1rOE34MYA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xMVQyMTozNToxNVrOE34fHQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzI3MDI3ODA4OnYy", "diffSide": "RIGHT", "path": "cluster/images/generate_imaging_script.sh", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xMVQyMToxOToyM1rOHxeq9g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xMVQyMToxOToyM1rOHxeq9g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMTY0NDc5MA==", "bodyText": "This can be written as all_cmds=\"$base_image_cmds $tools_image_cmds\"", "url": "https://github.com/hartwigmedical/pipeline5/pull/225#discussion_r521644790", "createdAt": "2020-11-11T21:19:23Z", "author": {"login": "nedleitch"}, "path": "cluster/images/generate_imaging_script.sh", "diffHunk": "@@ -4,29 +4,41 @@\n \n LOCATION=\"europe-west4\"\n ZONE=\"${LOCATION}-a\"\n-PROJECT=\"hmf-pipeline-development\" \n-TYPE=\"pipeline5\"\n+PROJECT=\"hmf-pipeline-development\"\n VERSION=5-17\n \n-if [ -n \"$1\" ]; then\n-    FLAVOUR=\"$1\"\n+TOOLS_ONLY=false\n+while getopts ':tf:' flag; do\n+    case \"${flag}\" in\n+        t) TOOLS_ONLY=true ;;\n+        f) FLAVOUR=${OPTARG} ;;\n+        *) ;;\n+    esac\n+done\n+sourceInstance=\"pipeline5-${VERSION}${FLAVOUR+\"-$FLAVOUR\"}\"\n+image_project=\"debian-cloud\"\n+image_family=\"debian-9\"\n+base_image_cmds=\"$(dirname \"$0\")/base.cmds\"\n+tools_image_cmds=\"$(dirname \"$0\")/tools.cmds\"\n+all_cmds=$(echo $base_image_cmds $tools_image_cmds)", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "51da400dfcce52b1f8d012556fa8185c874d68f7"}, "originalPosition": 24}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzI3MDMxMDM1OnYy", "diffSide": "RIGHT", "path": "cluster/upgrade_tool.sh", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xMVQyMToyOTo0NlrOHxe98w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xMVQyMToyOTo0NlrOHxe98w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMTY0OTY1MQ==", "bodyText": "Missing $", "url": "https://github.com/hartwigmedical/pipeline5/pull/225#discussion_r521649651", "createdAt": "2020-11-11T21:29:46Z", "author": {"login": "nedleitch"}, "path": "cluster/upgrade_tool.sh", "diffHunk": "@@ -0,0 +1,19 @@\n+tool=$1\n+version=$2\n+full=${tool}-${version}\n+local_jar=\"${full}.jar\"\n+if [ -n \"$3\" ]; then\n+  local_jar=\"$3\"\n+else\n+  wget \"https://github.com/hartwigmedical/hmftools/releases/download/${tool}-v${version}/${full}.jar\"\n+fi\n+gsutil cp $local_jar \"gs://common-tools/${tool}/${version}/${tool}.jar\"\n+if [ -z \"$3\" ]; then\n+  rm local_jar", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "51da400dfcce52b1f8d012556fa8185c874d68f7"}, "originalPosition": 12}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzI3MDMxNzE5OnYy", "diffSide": "RIGHT", "path": "cluster/upgrade_tool.sh", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xMVQyMTozMjowMFrOHxfCBw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xMVQyMTozMjowMFrOHxfCBw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMTY1MDY5NQ==", "bodyText": "Recommend starting with this preamble given how many things could potentially fail in this script:\n#!/usr/bin/env bash\n\nset -e\n\nThat way it will die straight away if say the wget fails.", "url": "https://github.com/hartwigmedical/pipeline5/pull/225#discussion_r521650695", "createdAt": "2020-11-11T21:32:00Z", "author": {"login": "nedleitch"}, "path": "cluster/upgrade_tool.sh", "diffHunk": "@@ -0,0 +1,19 @@\n+tool=$1", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "51da400dfcce52b1f8d012556fa8185c874d68f7"}, "originalPosition": 1}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzI3MDMyNjA1OnYy", "diffSide": "RIGHT", "path": "cluster/upgrade_tool.sh", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xMVQyMTozNToxNVrOHxfHcQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xM1QxOToyNDo1MVrOHy8GSA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMTY1MjA4MQ==", "bodyText": "Would prefer something a little more robust here, like \"$(dirname $0)/images/create_custom_image.sh -t\" so we've made a reasonable effort to allow it to be run from outside the directory it lives in.", "url": "https://github.com/hartwigmedical/pipeline5/pull/225#discussion_r521652081", "createdAt": "2020-11-11T21:35:15Z", "author": {"login": "nedleitch"}, "path": "cluster/upgrade_tool.sh", "diffHunk": "@@ -0,0 +1,19 @@\n+tool=$1\n+version=$2\n+full=${tool}-${version}\n+local_jar=\"${full}.jar\"\n+if [ -n \"$3\" ]; then\n+  local_jar=\"$3\"\n+else\n+  wget \"https://github.com/hartwigmedical/hmftools/releases/download/${tool}-v${version}/${full}.jar\"\n+fi\n+gsutil cp $local_jar \"gs://common-tools/${tool}/${version}/${tool}.jar\"\n+if [ -z \"$3\" ]; then\n+  rm local_jar\n+fi\n+\n+./images/create_custom_image.sh -t", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "51da400dfcce52b1f8d012556fa8185c874d68f7"}, "originalPosition": 15}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMzE3NTQ5Ng==", "bodyText": "it needs to run in the directory of the poms", "url": "https://github.com/hartwigmedical/pipeline5/pull/225#discussion_r523175496", "createdAt": "2020-11-13T19:24:51Z", "author": {"login": "pauldwolfe"}, "path": "cluster/upgrade_tool.sh", "diffHunk": "@@ -0,0 +1,19 @@\n+tool=$1\n+version=$2\n+full=${tool}-${version}\n+local_jar=\"${full}.jar\"\n+if [ -n \"$3\" ]; then\n+  local_jar=\"$3\"\n+else\n+  wget \"https://github.com/hartwigmedical/hmftools/releases/download/${tool}-v${version}/${full}.jar\"\n+fi\n+gsutil cp $local_jar \"gs://common-tools/${tool}/${version}/${tool}.jar\"\n+if [ -z \"$3\" ]; then\n+  rm local_jar\n+fi\n+\n+./images/create_custom_image.sh -t", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMTY1MjA4MQ=="}, "originalCommit": {"oid": "51da400dfcce52b1f8d012556fa8185c874d68f7"}, "originalPosition": 15}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1632, "cost": 1, "resetAt": "2021-11-12T20:28:25Z"}}}