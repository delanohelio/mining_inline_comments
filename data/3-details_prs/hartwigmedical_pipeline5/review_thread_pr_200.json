{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDkxMjAyNTkw", "number": 200, "reviewThreads": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yM1QxNTo1NDoyOFrOEmq0gw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yM1QxNTo1NDoyOFrOEmq0gw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzA4OTgyOTE1OnYy", "diffSide": "RIGHT", "path": "cluster/src/main/java/com/hartwig/pipeline/sbpapi/SbpRestApi.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yM1QxNTo1NDoyOFrOHW1ZPw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yM1QxNTo1NDoyOFrOHW1ZPw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MzcwNTUzNQ==", "bodyText": "This is an opportunity to loosen the allowable response codes so we can make the API return a more standard response.", "url": "https://github.com/hartwigmedical/pipeline5/pull/200#discussion_r493705535", "createdAt": "2020-09-23T15:54:28Z", "author": {"login": "nedleitch"}, "path": "cluster/src/main/java/com/hartwig/pipeline/sbpapi/SbpRestApi.java", "diffHunk": "@@ -113,10 +115,19 @@ public AddFileApiResponse postFile(final SbpFileMetadata metaData) {\n         }\n     }\n \n-    public void linkFileToSample(final int id, final int sampleId) {\n-        Map<String, Integer> request = new HashMap<>();\n-        request.put(\"sample_id\", sampleId);\n-        submitJson(POST, api().path(format(\"%s/%d/sample\", FILES, id)), request, Response.Status.CREATED);\n+    public void linkFileToSample(final int id, final String barcode) {\n+        try {\n+            SbpSample sample = ObjectMappers.get().<List<SbpSample>>readValue(returnOrThrow(api().path(SAMPLES)\n+                    .queryParam(\"barcode\", barcode)\n+                    .request()\n+                    .get()), new TypeReference<List<SbpSample>>() {\n+            }).stream().findFirst().orElseThrow();\n+            Map<String, Integer> request = new HashMap<>();\n+            request.put(\"sample_id\", sample.id());\n+            returnOrThrow(submitJson(POST, api().path(FILES).path(String.valueOf(id)).path(\"sample\"), request, Response.Status.CREATED));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "1c64233646f54d2ce9d98d29f4e9357700d298fd"}, "originalPosition": 42}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1691, "cost": 1, "resetAt": "2021-11-12T20:28:25Z"}}}