{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDM2NzUyNTE0", "number": 164, "title": "DEV-1342 Add turquoise event publishing", "bodyText": "Adds publishing of an event on pipeline start and pipeline completion with the following subjects:\n\nsample\nset\ntype (somatic, shallow, single)\nbarcodes\nrun id if present\nstatus for completion\n\nFor now made the choice to completely decouple from turquoise at compile time, and duplicate the\nclasses required to publish the events. Will probably revisit this later and perhaps create a simple\nturquoise client.\nThe publishing is hid behind a feature toggle which is for disabled.", "createdAt": "2020-06-18T20:42:31Z", "url": "https://github.com/hartwigmedical/pipeline5/pull/164", "merged": true, "mergeCommit": {"oid": "9611ad5fb3dd0c9d0cf0ee742f6e525cecb0a115"}, "closed": true, "closedAt": "2020-06-19T17:29:03Z", "author": {"login": "pauldwolfe"}, "timelineItems": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcskqONgH2gAyNDM2NzUyNTE0OmI1MDRmZWQ3OTUxNWNmZDQ1N2E4MDM2NTdhNjcxN2MzNzJhYzliMjQ=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcs2XhdgH2gAyNDM2NzUyNTE0OjYxOGZkODVlMmU5ODg1ZTFkZjEwOTc1YWRkNWM1MDI5NDY3YWE4ODU=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "b504fed79515cfd457a803657a6717c372ac9b24", "author": {"user": null}, "url": "https://github.com/hartwigmedical/pipeline5/commit/b504fed79515cfd457a803657a6717c372ac9b24", "committedDate": "2020-06-18T20:41:27Z", "message": "DEV-1342 Add turquoise event publishing\n\nAdds publishing of an event on pipeline start and pipeline completion with the following subjects:\n- sample\n- set\n- type (somatic, shallow, single)\n- barcodes\n- run id if present\n- status for completion\n\nFor now made the choice to completely decouple from turquoise at compile time, and duplicate the\nclasses required to publish the events. Will probably revisit this later and perhaps create a simple\nturquoise client.\n\nThe publishing is hid behind a feature toggle which is for disabled."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDM0MTc4MzQw", "url": "https://github.com/hartwigmedical/pipeline5/pull/164#pullrequestreview-434178340", "createdAt": "2020-06-19T15:47:10Z", "commit": {"oid": "b504fed79515cfd457a803657a6717c372ac9b24"}, "state": "APPROVED", "comments": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xOVQxNTo0NzoxMFrOGmZaDg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xOVQxNjowMjowNFrOGmZ4oA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MjkxNTM0Mg==", "bodyText": "What do you think about switching to the BOM in the pipeline too?", "url": "https://github.com/hartwigmedical/pipeline5/pull/164#discussion_r442915342", "createdAt": "2020-06-19T15:47:10Z", "author": {"login": "nedleitch"}, "path": "pom.xml", "diffHunk": "@@ -146,6 +151,11 @@\n                 <artifactId>google-cloud-monitoring</artifactId>\n                 <version>${google-cloud.version}</version>\n             </dependency>\n+            <dependency>\n+                <groupId>com.google.cloud</groupId>\n+                <artifactId>google-cloud-pubsub</artifactId>\n+                <version>${google-cloud.version}</version>", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b504fed79515cfd457a803657a6717c372ac9b24"}, "originalPosition": 19}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MjkyMDYzMA==", "bodyText": "This feels a bit over-abstracted to me, suspect it will continue to evolve.", "url": "https://github.com/hartwigmedical/pipeline5/pull/164#discussion_r442920630", "createdAt": "2020-06-19T15:57:12Z", "author": {"login": "nedleitch"}, "path": "cluster/src/main/java/com/hartwig/pipeline/turquoise/Event.java", "diffHunk": "@@ -0,0 +1,26 @@\n+package com.hartwig.pipeline.turquoise;\n+\n+import java.time.LocalDateTime;\n+import java.util.List;\n+\n+import com.fasterxml.jackson.databind.annotation.JsonSerialize;\n+\n+import org.immutables.value.Value;\n+\n+@Value.Immutable\n+@JsonSerialize(as = ImmutableEvent.class)\n+interface Event {\n+\n+    @Value.Parameter\n+    LocalDateTime timestamp();\n+\n+    @Value.Parameter\n+    EventType type();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b504fed79515cfd457a803657a6717c372ac9b24"}, "originalPosition": 18}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MjkyMjAyNg==", "bodyText": "See comment above, in BigQuery this is just a string at the top-level.", "url": "https://github.com/hartwigmedical/pipeline5/pull/164#discussion_r442922026", "createdAt": "2020-06-19T15:59:47Z", "author": {"login": "nedleitch"}, "path": "cluster/src/main/java/com/hartwig/pipeline/turquoise/EventType.java", "diffHunk": "@@ -0,0 +1,13 @@\n+package com.hartwig.pipeline.turquoise;\n+\n+import com.fasterxml.jackson.databind.annotation.JsonSerialize;\n+\n+import org.immutables.value.Value;\n+\n+@Value.Immutable\n+@JsonSerialize(as = ImmutableEventType.class)\n+interface EventType {\n+\n+    @Value.Parameter\n+    String name();\n+}", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b504fed79515cfd457a803657a6717c372ac9b24"}, "originalPosition": 13}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MjkyMzE2OA==", "bodyText": "Rarely seen in the wild.", "url": "https://github.com/hartwigmedical/pipeline5/pull/164#discussion_r442923168", "createdAt": "2020-06-19T16:02:04Z", "author": {"login": "nedleitch"}, "path": "cluster/src/main/java/com/hartwig/pipeline/turquoise/PipelineCompleted.java", "diffHunk": "@@ -0,0 +1,27 @@\n+package com.hartwig.pipeline.turquoise;\n+\n+import java.util.List;\n+\n+import org.immutables.value.Value;\n+\n+@Value.Immutable\n+public interface PipelineCompleted extends PipelineEvent {\n+\n+    String status();\n+\n+    @Override\n+    default String eventType() {\n+        return \"pipeline.completed\";\n+    }\n+\n+    @Override\n+    default List<Subject> subjects() {\n+        List<Subject> subjects = PipelineEvent.super.subjects();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b504fed79515cfd457a803657a6717c372ac9b24"}, "originalPosition": 19}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDM0MjAzNDkw", "url": "https://github.com/hartwigmedical/pipeline5/pull/164#pullrequestreview-434203490", "createdAt": "2020-06-19T16:25:40Z", "commit": {"oid": "b504fed79515cfd457a803657a6717c372ac9b24"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "618fd85e2e9885e1df10975add5c5029467aa885", "author": {"user": null}, "url": "https://github.com/hartwigmedical/pipeline5/commit/618fd85e2e9885e1df10975add5c5029467aa885", "committedDate": "2020-06-19T17:19:19Z", "message": "DEV-1342 Address review comments\n\nRemove the wrapper types from message.\n\nExternalize JSON in tests."}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3721, "cost": 1, "resetAt": "2021-11-01T14:51:55Z"}}}