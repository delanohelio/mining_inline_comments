{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDkxMjAyNTkw", "number": 200, "title": "DEV-1525 Publish datatypes for all files used in re-runs", "bodyText": "Generally follows the pattern laid out for crams, with a few changes.\nLinking to sample is combined with datatype linking, we always need a sample to look it up.\nPath construction done in the AddDatatypeToFile class to prevent mistakes and duplication.\nTest added, still WIP.", "createdAt": "2020-09-22T21:22:38Z", "url": "https://github.com/hartwigmedical/pipeline5/pull/200", "merged": true, "mergeCommit": {"oid": "f415e13539b3fc82cd54ff7787d8a3ba37f415af"}, "closed": true, "closedAt": "2020-09-23T15:58:06Z", "author": {"login": "pauldwolfe"}, "timelineItems": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdLeyA7gH2gAyNDkxMjAyNTkwOmZhMTNmMzE4MTBjNGJkMmUyOGM0ZTU0OGMzMjg4ZGUxYjRkOTM5YTI=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdLus90gFqTQ5NDgxMDEyNQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "fa13f31810c4bd2e28c4e548c3288de1b4d939a2", "author": {"user": null}, "url": "https://github.com/hartwigmedical/pipeline5/commit/fa13f31810c4bd2e28c4e548c3288de1b4d939a2", "committedDate": "2020-09-22T21:22:11Z", "message": "DEV-1525 Publish datatypes for all files used in re-runs\n\nGenerally follows the pattern laid out for crams, with a few changes.\n\nLinking to sample is combined with datatype linking, we always need a sample to look it up.\n\nPath construction done in the AddDatatypeToFile class to prevent mistakes and duplication.\n\nTest added, still WIP."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "1c64233646f54d2ce9d98d29f4e9357700d298fd", "author": {"user": null}, "url": "https://github.com/hartwigmedical/pipeline5/commit/1c64233646f54d2ce9d98d29f4e9357700d298fd", "committedDate": "2020-09-23T15:13:46Z", "message": "DEV-1525 Add tests for further operations\n\nAdds a simple check for whether a stages operations match the expected.\n\nStill not possible for stages with state (germline, structural, sage)."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDk0ODEwMTI1", "url": "https://github.com/hartwigmedical/pipeline5/pull/200#pullrequestreview-494810125", "createdAt": "2020-09-23T15:54:28Z", "commit": {"oid": "1c64233646f54d2ce9d98d29f4e9357700d298fd"}, "state": "APPROVED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yM1QxNTo1NDoyOFrOHW1ZPw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yM1QxNTo1NDoyOFrOHW1ZPw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MzcwNTUzNQ==", "bodyText": "This is an opportunity to loosen the allowable response codes so we can make the API return a more standard response.", "url": "https://github.com/hartwigmedical/pipeline5/pull/200#discussion_r493705535", "createdAt": "2020-09-23T15:54:28Z", "author": {"login": "nedleitch"}, "path": "cluster/src/main/java/com/hartwig/pipeline/sbpapi/SbpRestApi.java", "diffHunk": "@@ -113,10 +115,19 @@ public AddFileApiResponse postFile(final SbpFileMetadata metaData) {\n         }\n     }\n \n-    public void linkFileToSample(final int id, final int sampleId) {\n-        Map<String, Integer> request = new HashMap<>();\n-        request.put(\"sample_id\", sampleId);\n-        submitJson(POST, api().path(format(\"%s/%d/sample\", FILES, id)), request, Response.Status.CREATED);\n+    public void linkFileToSample(final int id, final String barcode) {\n+        try {\n+            SbpSample sample = ObjectMappers.get().<List<SbpSample>>readValue(returnOrThrow(api().path(SAMPLES)\n+                    .queryParam(\"barcode\", barcode)\n+                    .request()\n+                    .get()), new TypeReference<List<SbpSample>>() {\n+            }).stream().findFirst().orElseThrow();\n+            Map<String, Integer> request = new HashMap<>();\n+            request.put(\"sample_id\", sample.id());\n+            returnOrThrow(submitJson(POST, api().path(FILES).path(String.valueOf(id)).path(\"sample\"), request, Response.Status.CREATED));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "1c64233646f54d2ce9d98d29f4e9357700d298fd"}, "originalPosition": 42}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3754, "cost": 1, "resetAt": "2021-11-01T14:51:55Z"}}}