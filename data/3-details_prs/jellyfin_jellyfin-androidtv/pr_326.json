{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0MzcyODYwNzE5", "number": 326, "title": "Implementation of Similar Items row", "bodyText": "We probably need new Images as fallback though, the current ones I'm referencing here are super ugly :D", "createdAt": "2020-02-09T18:52:13Z", "url": "https://github.com/jellyfin/jellyfin-androidtv/pull/326", "merged": true, "mergeCommit": {"oid": "7ef84159f07a7a826f8463dd093cd8076466bc49"}, "closed": true, "closedAt": "2020-02-10T08:54:18Z", "author": {"login": "AndreasGB"}, "timelineItems": {"totalCount": 7, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcCtFsugH2gAyMzcyODYwNzE5OmQ0MTZlN2Q2YjY0OWI1NWUzMzY4OTgzNTk3N2ZmOThlNzM3YjJjMWQ=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcC5OVzgFqTM1NTc2NzY5OA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "d416e7d6b649b55e33689835977ff98e737b2c1d", "author": {"user": {"login": "AndreasGB", "name": "Andreas"}}, "url": "https://github.com/jellyfin/jellyfin-androidtv/commit/d416e7d6b649b55e33689835977ff98e737b2c1d", "committedDate": "2020-02-09T18:45:53Z", "message": "Fix wrong default image used for chapters"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "0c715a0d196c526a9db68f48f2dd37ad01fadb48", "author": {"user": {"login": "AndreasGB", "name": "Andreas"}}, "url": "https://github.com/jellyfin/jellyfin-androidtv/commit/0c715a0d196c526a9db68f48f2dd37ad01fadb48", "committedDate": "2020-02-09T18:47:08Z", "message": "Implement similar items row"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzU1NjI2NzUx", "url": "https://github.com/jellyfin/jellyfin-androidtv/pull/326#pullrequestreview-355626751", "createdAt": "2020-02-09T19:11:57Z", "commit": {"oid": "0c715a0d196c526a9db68f48f2dd37ad01fadb48"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0wOVQxOToxMTo1N1rOFnWg4g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0wOVQxOToxNjoyNlrOFnWh3Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NjgwNzY1MA==", "bodyText": "I'd hardcode this in the function that uses it", "url": "https://github.com/jellyfin/jellyfin-androidtv/pull/326#discussion_r376807650", "createdAt": "2020-02-09T19:11:57Z", "author": {"login": "nielsvanvelzen"}, "path": "app/src/main/java/org/jellyfin/androidtv/model/itemtypes/LiftedItems.kt", "diffHunk": "@@ -2,9 +2,12 @@ package org.jellyfin.androidtv.model.itemtypes\n \n import org.jellyfin.apiclient.model.dto.BaseItemDto\n import org.jellyfin.apiclient.model.dto.BaseItemType\n+import org.jellyfin.apiclient.model.querying.ItemFields\n import java.util.*\n import kotlin.properties.Delegates\n \n+val FieldsRequiredForLift = arrayOf(ItemFields.DateCreated, ItemFields.MediaSources, ItemFields.MediaStreams, ItemFields.People)", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "0c715a0d196c526a9db68f48f2dd37ad01fadb48"}, "originalPosition": 8}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NjgwNzc1MA==", "bodyText": "I'd add the limit as parameter with 10 as default value\nMaybe increase it to 25 or something too", "url": "https://github.com/jellyfin/jellyfin-androidtv/pull/326#discussion_r376807750", "createdAt": "2020-02-09T19:13:51Z", "author": {"login": "nielsvanvelzen"}, "path": "app/src/main/java/org/jellyfin/androidtv/util/apiclient/ApiClientExtensions.kt", "diffHunk": "@@ -45,10 +48,26 @@ suspend fun ApiClient.markUnplayed(itemId: String, userId: String) : UserItemDat\n \t})\n }\n \n-\n suspend fun ApiClient.updateFavoriteStatus(itemId: String, userId: String, isFavorite: Boolean) : UserItemDataDto? = suspendCoroutine { continuation ->\n \tUpdateFavoriteStatusAsync(itemId, userId, isFavorite, object : Response<UserItemDataDto>() {\n \t\toverride fun onResponse(response: UserItemDataDto?) { continuation.resume(response!!) }\n \t\toverride fun onError(exception: Exception?) { continuation.resume(null) }\n \t})\n }\n+\n+suspend fun ApiClient.getSimilarItems(item: BaseItem): List<BaseItem>? = suspendCoroutine {continuation ->\n+\tval query = SimilarItemsQuery()\n+\tquery.setUserId(TvApp.getApplication().currentUser.id)\n+\tquery.setId(item.id)\n+\tquery.setLimit(10)", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "0c715a0d196c526a9db68f48f2dd37ad01fadb48"}, "originalPosition": 32}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NjgwNzc3NA==", "bodyText": "You can use .apply or .also here", "url": "https://github.com/jellyfin/jellyfin-androidtv/pull/326#discussion_r376807774", "createdAt": "2020-02-09T19:14:19Z", "author": {"login": "nielsvanvelzen"}, "path": "app/src/main/java/org/jellyfin/androidtv/util/apiclient/ApiClientExtensions.kt", "diffHunk": "@@ -45,10 +48,26 @@ suspend fun ApiClient.markUnplayed(itemId: String, userId: String) : UserItemDat\n \t})\n }\n \n-\n suspend fun ApiClient.updateFavoriteStatus(itemId: String, userId: String, isFavorite: Boolean) : UserItemDataDto? = suspendCoroutine { continuation ->\n \tUpdateFavoriteStatusAsync(itemId, userId, isFavorite, object : Response<UserItemDataDto>() {\n \t\toverride fun onResponse(response: UserItemDataDto?) { continuation.resume(response!!) }\n \t\toverride fun onError(exception: Exception?) { continuation.resume(null) }\n \t})\n }\n+\n+suspend fun ApiClient.getSimilarItems(item: BaseItem): List<BaseItem>? = suspendCoroutine {continuation ->\n+\tval query = SimilarItemsQuery()", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "0c715a0d196c526a9db68f48f2dd37ad01fadb48"}, "originalPosition": 29}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NjgwNzgzMA==", "bodyText": "Maybe add an expected type to the getSimilarItems so it won't respond with data you don't need", "url": "https://github.com/jellyfin/jellyfin-androidtv/pull/326#discussion_r376807830", "createdAt": "2020-02-09T19:15:38Z", "author": {"login": "nielsvanvelzen"}, "path": "app/src/main/java/org/jellyfin/androidtv/details/MovieDetailsFragment.kt", "diffHunk": "@@ -66,6 +68,14 @@ class MovieDetailsFragment(item: Movie) : BaseDetailsFragment<Movie>(item) {\n \t\t\titem.cast.forEach(it::add)\n \t\t}\n \n+\t\tval similarItems = TvApp.getApplication().apiClient.getSimilarItems(item)\n+\t\tval similarMovies = similarItems?.filter { it is Movie }", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "0c715a0d196c526a9db68f48f2dd37ad01fadb48"}, "originalPosition": 35}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NjgwNzkwMQ==", "bodyText": "This doesn't do anything...", "url": "https://github.com/jellyfin/jellyfin-androidtv/pull/326#discussion_r376807901", "createdAt": "2020-02-09T19:16:26Z", "author": {"login": "nielsvanvelzen"}, "path": "app/src/main/java/org/jellyfin/androidtv/details/ItemPosterPresenter.kt", "diffHunk": "@@ -0,0 +1,59 @@\n+package org.jellyfin.androidtv.details\n+\n+import android.content.Context\n+import android.content.Intent\n+import android.graphics.drawable.BitmapDrawable\n+import android.view.ViewGroup\n+import androidx.appcompat.view.ContextThemeWrapper\n+import androidx.leanback.widget.ImageCardView\n+import androidx.leanback.widget.Presenter\n+import kotlinx.coroutines.Dispatchers\n+import kotlinx.coroutines.GlobalScope\n+import kotlinx.coroutines.launch\n+import org.jellyfin.androidtv.R\n+import org.jellyfin.androidtv.TvApp\n+import org.jellyfin.androidtv.base.IItemClickListener\n+import org.jellyfin.androidtv.model.itemtypes.BaseItem\n+\n+private const val LOG_TAG = \"ItemPosterPresenter\"\n+\n+class ItemPosterPresenter(private val context: Context) : Presenter(), IItemClickListener {\n+\n+\toverride suspend fun onItemClicked(item: Any?) {\n+\t\trequireNotNull(item)\n+\t\tval baseItem = item as BaseItem\n+\t\tval intent = Intent(context, DetailsActivity::class.java)\n+\t\tintent.putExtra(\"id\", baseItem.id)\n+\n+\t\tcontext.startActivity(intent)\n+\t}\n+\n+\toverride fun onCreateViewHolder(parent: ViewGroup?): ViewHolder {\n+\t\treturn ViewHolder(ImageCardView(ContextThemeWrapper(parent!!.context, R.style.MarqueeImageCardViewTheme)))\n+\t}\n+\n+\toverride fun onBindViewHolder(viewHolder: ViewHolder, item: Any) {\n+\t\tval baseItem = item as BaseItem\n+\t\tval cardView = viewHolder.view as ImageCardView\n+\n+\t\tcardView.titleText = baseItem.name\n+\t\tcardView.contentText = baseItem.description\n+\t\tcardView.isFocusable = true\n+\t\tcardView.isFocusableInTouchMode = true\n+\t\tcardView.setMainImageDimensions(200, 300)\n+\t\tcardView.mainImage = TvApp.getApplication().getDrawableCompat(R.drawable.tile_port_video)\n+\n+\t\tif (baseItem.images.primary != null) {\n+\t\t\tGlobalScope.launch(Dispatchers.Main) {\n+\t\t\t\tcardView.mainImage = BitmapDrawable(baseItem.images.primary.getBitmap(TvApp.getApplication()))\n+\t\t\t}\n+\t\t}\n+\n+\t}\n+\n+\toverride fun onUnbindViewHolder(viewHolder: ViewHolder?) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "0c715a0d196c526a9db68f48f2dd37ad01fadb48"}, "originalPosition": 54}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "1ce36161d22727246b80103495c85f3672b622ac", "author": {"user": {"login": "AndreasGB", "name": "Andreas"}}, "url": "https://github.com/jellyfin/jellyfin-androidtv/commit/1ce36161d22727246b80103495c85f3672b622ac", "committedDate": "2020-02-09T21:36:57Z", "message": "Refactoring + Add limit to similar items query"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzU1NjM1NzQz", "url": "https://github.com/jellyfin/jellyfin-androidtv/pull/326#pullrequestreview-355635743", "createdAt": "2020-02-09T21:41:34Z", "commit": {"oid": "1ce36161d22727246b80103495c85f3672b622ac"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0wOVQyMTo0MTozNFrOFnXJYg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0wOVQyMTo0MTozNFrOFnXJYg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NjgxODAxOA==", "bodyText": "I think this sets the value of query.limit to query.limit", "url": "https://github.com/jellyfin/jellyfin-androidtv/pull/326#discussion_r376818018", "createdAt": "2020-02-09T21:41:34Z", "author": {"login": "nielsvanvelzen"}, "path": "app/src/main/java/org/jellyfin/androidtv/util/apiclient/ApiClientExtensions.kt", "diffHunk": "@@ -55,12 +55,14 @@ suspend fun ApiClient.updateFavoriteStatus(itemId: String, userId: String, isFav\n \t})\n }\n \n-suspend fun ApiClient.getSimilarItems(item: BaseItem): List<BaseItem>? = suspendCoroutine {continuation ->\n-\tval query = SimilarItemsQuery()\n-\tquery.setUserId(TvApp.getApplication().currentUser.id)\n-\tquery.setId(item.id)\n-\tquery.setLimit(10)\n-\tquery.fields = FieldsRequiredForLift\n+suspend fun ApiClient.getSimilarItems(item: BaseItem, limit: Int = 25): List<BaseItem>? = suspendCoroutine { continuation ->\n+\tval query = SimilarItemsQuery().apply {\n+\t\tid = item.id\n+\t\tuserId = TvApp.getApplication().currentUser.id\n+\t\tthis.limit = limit", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "1ce36161d22727246b80103495c85f3672b622ac"}, "originalPosition": 23}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "5b75076e2b663806d9b55029695f3f29a4c8b979", "author": {"user": {"login": "AndreasGB", "name": "Andreas"}}, "url": "https://github.com/jellyfin/jellyfin-androidtv/commit/5b75076e2b663806d9b55029695f3f29a4c8b979", "committedDate": "2020-02-09T21:48:02Z", "message": "Tiny refactor"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzU1NzY3Njk4", "url": "https://github.com/jellyfin/jellyfin-androidtv/pull/326#pullrequestreview-355767698", "createdAt": "2020-02-10T08:54:12Z", "commit": {"oid": "5b75076e2b663806d9b55029695f3f29a4c8b979"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4252, "cost": 1, "resetAt": "2021-11-01T15:33:45Z"}}}