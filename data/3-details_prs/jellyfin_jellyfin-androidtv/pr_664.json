{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTQ1NDA3MzQ3", "number": 664, "title": "Convert ChannelManager to work manager", "bodyText": "The ChannelManager is an asynchronous background job to update information in the OS. The current implementation relied on the app running and calling the .update() function (in the home activity). This PR changes it to use the androidx work manager library so we can start updating the channels when the app is not running. This can hopefully be finished after the new auto-sign in code is merged so it actually works with the app in the background. Since we use Koin for dependency injection I used that as backend for the workers.\nReferences\n\nKoin release notes explaining workmanager in DI\nWorkManager class reference\nWork manager docs\nWork manager tutorial\n\nDraft state\nI want to test this change on my own television before marking it as ready.", "createdAt": "2020-12-24T15:31:02Z", "url": "https://github.com/jellyfin/jellyfin-androidtv/pull/664", "merged": true, "mergeCommit": {"oid": "791ac440e4393c3629429e5c185fe5d92ef67757"}, "closed": true, "closedAt": "2020-12-30T21:07:40Z", "author": {"login": "nielsvanvelzen"}, "timelineItems": {"totalCount": 6, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdpVrMdgBqjQxNDc2OTI2NjE=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdrMQfTgBqjQxNTY3OTEzMzA=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "fb428cdfd0ffc6f30fef5005ee00519457d9b6fe", "author": {"user": {"login": "nielsvanvelzen", "name": "Niels van Velzen"}}, "url": "https://github.com/jellyfin/jellyfin-androidtv/commit/fb428cdfd0ffc6f30fef5005ee00519457d9b6fe", "committedDate": "2020-12-24T15:24:12Z", "message": "Convert ChannelManager to a worker manager"}, "afterCommit": {"oid": "239b24175b58c2389fb983b6a0145e92bfe69e89", "author": {"user": {"login": "nielsvanvelzen", "name": "Niels van Velzen"}}, "url": "https://github.com/jellyfin/jellyfin-androidtv/commit/239b24175b58c2389fb983b6a0145e92bfe69e89", "committedDate": "2020-12-24T15:43:10Z", "message": "Convert ChannelManager to a worker manager"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTU5Mzg1MzIz", "url": "https://github.com/jellyfin/jellyfin-androidtv/pull/664#pullrequestreview-559385323", "createdAt": "2020-12-29T05:43:31Z", "commit": {"oid": "239b24175b58c2389fb983b6a0145e92bfe69e89"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0yOVQwNTo0MzozMVrOIMHcgQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0yOVQwNTo0MzozMVrOIMHcgQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0OTU3NTgwOQ==", "bodyText": "Why are these names the same?", "url": "https://github.com/jellyfin/jellyfin-androidtv/pull/664#discussion_r549575809", "createdAt": "2020-12-29T05:43:31Z", "author": {"login": "thornbill"}, "path": "app/src/main/java/org/jellyfin/androidtv/integration/LeanbackChannelWorker.kt", "diffHunk": "@@ -32,14 +32,19 @@ import org.jellyfin.apiclient.model.querying.NextUpQuery\n  *\n  * More info: https://developer.android.com/training/tv/discovery/recommendations-channel\n  */\n-class ChannelManager(\n+class LeanbackChannelWorker(\n+\tcontext: Context,\n+\tval workerParams: WorkerParameters,\n \tprivate val apiClient: ApiClient\n-) {\n-\tprivate companion object {\n+) : CoroutineWorker(context, workerParams) {\n+\tcompanion object {\n \t\t/**\n \t\t * Amount of ticks found in a millisecond, used for calculation\n \t\t */\n \t\tprivate const val TICKS_IN_MILLISECOND = 10000\n+\n+\t\tconst val SINGLE_UPDATE_REQUEST_NAME = \"channelUpdateRequest\"\n+\t\tconst val PERIODIC_UPDATE_REQUEST_NAME = \"channelUpdateRequest\"", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "239b24175b58c2389fb983b6a0145e92bfe69e89"}, "originalPosition": 31}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTU5NzIxOTEx", "url": "https://github.com/jellyfin/jellyfin-androidtv/pull/664#pullrequestreview-559721911", "createdAt": "2020-12-29T22:09:42Z", "commit": {"oid": "cec9b04427effe304771405194567a5ecaf76fd9"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "5e01dd4df5404dda6f7a344ff5cb9dc076220d42", "author": {"user": {"login": "nielsvanvelzen", "name": "Niels van Velzen"}}, "url": "https://github.com/jellyfin/jellyfin-androidtv/commit/5e01dd4df5404dda6f7a344ff5cb9dc076220d42", "committedDate": "2020-12-30T09:51:07Z", "message": "Convert ChannelManager to a worker manager"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "40960d8403041b194db5e6c3c237d98799a33b25", "author": {"user": {"login": "nielsvanvelzen", "name": "Niels van Velzen"}}, "url": "https://github.com/jellyfin/jellyfin-androidtv/commit/40960d8403041b194db5e6c3c237d98799a33b25", "committedDate": "2020-12-30T09:51:09Z", "message": "Update update request names\n\nNow uses unique names for both types"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "cec9b04427effe304771405194567a5ecaf76fd9", "author": {"user": {"login": "nielsvanvelzen", "name": "Niels van Velzen"}}, "url": "https://github.com/jellyfin/jellyfin-androidtv/commit/cec9b04427effe304771405194567a5ecaf76fd9", "committedDate": "2020-12-29T17:36:36Z", "message": "Update update request names\n\nNow uses unique names for both types"}, "afterCommit": {"oid": "40960d8403041b194db5e6c3c237d98799a33b25", "author": {"user": {"login": "nielsvanvelzen", "name": "Niels van Velzen"}}, "url": "https://github.com/jellyfin/jellyfin-androidtv/commit/40960d8403041b194db5e6c3c237d98799a33b25", "committedDate": "2020-12-30T09:51:09Z", "message": "Update update request names\n\nNow uses unique names for both types"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4247, "cost": 1, "resetAt": "2021-11-01T15:33:45Z"}}}