{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0Mzg4NTk0Mjg0", "number": 401, "title": "Add theme support", "bodyText": "", "createdAt": "2020-03-15T06:21:44Z", "url": "https://github.com/jellyfin/jellyfin-androidtv/pull/401", "merged": true, "mergeCommit": {"oid": "eb8e956be8cbab0bf2f5c7addebecafd32650791"}, "closed": true, "closedAt": "2020-03-17T09:20:10Z", "author": {"login": "thornbill"}, "timelineItems": {"totalCount": 10, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcNzOsFAH2gAyMzg4NTk0Mjg0OmUwNDZlMDhmMTNiMjE5NWM4ZThjY2ZjMDJhZTAyZjc3ZTQxMTI5NTM=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcOfK6gAFqTM3NTg1ODU4Nw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "e046e08f13b2195c8e8ccfc02ae02f77e4112953", "author": {"user": {"login": "thornbill", "name": "Bill Thornton"}}, "url": "https://github.com/jellyfin/jellyfin-androidtv/commit/e046e08f13b2195c8e8ccfc02ae02f77e4112953", "committedDate": "2020-03-15T06:08:18Z", "message": "Add user preference for app theme"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "8ca0ef3fd7bb914dc95abd088de988ee1a477d01", "author": {"user": {"login": "thornbill", "name": "Bill Thornton"}}, "url": "https://github.com/jellyfin/jellyfin-androidtv/commit/8ca0ef3fd7bb914dc95abd088de988ee1a477d01", "committedDate": "2020-03-15T06:08:18Z", "message": "Fix app theme preference position"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d226dc9feed7e8a962c800dfc486bd29f57dac5d", "author": {"user": {"login": "thornbill", "name": "Bill Thornton"}}, "url": "https://github.com/jellyfin/jellyfin-androidtv/commit/d226dc9feed7e8a962c800dfc486bd29f57dac5d", "committedDate": "2020-03-15T06:20:43Z", "message": "Add special theme"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzc0NzgxNzk5", "url": "https://github.com/jellyfin/jellyfin-androidtv/pull/401#pullrequestreview-374781799", "createdAt": "2020-03-15T08:59:21Z", "commit": {"oid": "d226dc9feed7e8a962c800dfc486bd29f57dac5d"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xNVQwODo1OToyMVrOF2dtsg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xNVQwOToxMDoxNVrOF2dwNQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MjY1NDI1OA==", "bodyText": "If you make ThemeManager itself an object you won't need to do the companion object thingy.\nhttps://kotlinlang.org/docs/tutorials/kotlin-for-py/objects-and-companion-objects.html", "url": "https://github.com/jellyfin/jellyfin-androidtv/pull/401#discussion_r392654258", "createdAt": "2020-03-15T08:59:21Z", "author": {"login": "nielsvanvelzen"}, "path": "app/src/main/java/org/jellyfin/androidtv/presentation/ThemeManager.kt", "diffHunk": "@@ -0,0 +1,28 @@\n+package org.jellyfin.androidtv.presentation\n+\n+import android.app.Activity\n+import org.jellyfin.androidtv.R\n+import org.jellyfin.androidtv.preferences.enums.AppTheme\n+import org.jellyfin.androidtv.preferences.ui.PreferencesActivity\n+\n+class ThemeManager {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d226dc9feed7e8a962c800dfc486bd29f57dac5d"}, "originalPosition": 8}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MjY1NDQ4NQ==", "bodyText": "Can we rename the themes (or the enums) to have consistent naming?\nIt doesn't make sense to me like this:\n\nDark, Theme_Jellyfin\nEmerald, Theme_Jellyfin_Legacy\nHotdog, Theme_Jellyfin_HotDogStand", "url": "https://github.com/jellyfin/jellyfin-androidtv/pull/401#discussion_r392654485", "createdAt": "2020-03-15T09:03:16Z", "author": {"login": "nielsvanvelzen"}, "path": "app/src/main/java/org/jellyfin/androidtv/preferences/enums/AppTheme.kt", "diffHunk": "@@ -0,0 +1,18 @@\n+package org.jellyfin.androidtv.preferences.enums\n+\n+enum class AppTheme {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d226dc9feed7e8a962c800dfc486bd29f57dac5d"}, "originalPosition": 3}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MjY1NDU5OQ==", "bodyText": "Missing @string", "url": "https://github.com/jellyfin/jellyfin-androidtv/pull/401#discussion_r392654599", "createdAt": "2020-03-15T09:05:43Z", "author": {"login": "nielsvanvelzen"}, "path": "app/src/main/res/xml/preferences.xml", "diffHunk": "@@ -26,6 +26,11 @@\n     </PreferenceCategory>\n \n     <PreferenceCategory android:title=\"@string/pref_general\">\n+        <ListPreference\n+            android:entries=\"@array/app_theme_entries\"\n+            android:entryValues=\"@array/app_theme_values\"\n+            android:key=\"app_theme\"\n+            android:title=\"App Theme\" />", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d226dc9feed7e8a962c800dfc486bd29f57dac5d"}, "originalPosition": 8}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MjY1NDkwMQ==", "bodyText": "Isn't it possible to use activity.setTheme() here?", "url": "https://github.com/jellyfin/jellyfin-androidtv/pull/401#discussion_r392654901", "createdAt": "2020-03-15T09:10:15Z", "author": {"login": "nielsvanvelzen"}, "path": "app/src/main/java/org/jellyfin/androidtv/base/AppThemeCallbacks.kt", "diffHunk": "@@ -0,0 +1,54 @@\n+package org.jellyfin.androidtv.base\n+\n+import android.app.Activity\n+import android.app.Application\n+import android.os.Bundle\n+import android.util.Log\n+import org.jellyfin.androidtv.R\n+import org.jellyfin.androidtv.TvApp\n+import org.jellyfin.androidtv.preferences.enums.AppTheme\n+import org.jellyfin.androidtv.preferences.ui.PreferencesActivity\n+import org.jellyfin.androidtv.presentation.ThemeManager\n+\n+private const val LOG_TAG = \"AppThemeCallbacks\"\n+\n+class AppThemeCallbacks : Application.ActivityLifecycleCallbacks {\n+\tprivate var lastTheme: AppTheme? = null\n+\tprivate var lastPreferencesTheme: AppTheme? = null\n+\n+\toverride fun onActivityPaused(activity: Activity) {\n+\t}\n+\n+\toverride fun onActivityStarted(activity: Activity) {\n+\t}\n+\n+\toverride fun onActivityDestroyed(activity: Activity) {\n+\t}\n+\n+\toverride fun onActivitySaveInstanceState(activity: Activity, outState: Bundle) {\n+\t}\n+\n+\toverride fun onActivityStopped(activity: Activity) {\n+\t}\n+\n+\toverride fun onActivityCreated(activity: Activity, savedInstanceState: Bundle?) {\n+\t\tTvApp.getApplication().userPreferences.appTheme.let {\n+\t\t\tLog.i(LOG_TAG, \"Applying theme: $it\")\n+\t\t\tactivity.setTheme(ThemeManager.getTheme(activity, it))\n+\t\t\twhen (activity) {\n+\t\t\t\tis PreferencesActivity -> lastPreferencesTheme = it\n+\t\t\t\telse -> lastTheme = it\n+\t\t\t}\n+\t\t}\n+\t}\n+\n+\toverride fun onActivityResumed(activity: Activity) {\n+\t\tval lastThemeForActivity = if (activity is PreferencesActivity) lastPreferencesTheme else lastTheme\n+\t\tTvApp.getApplication().userPreferences.appTheme.let {\n+\t\t\tif (lastThemeForActivity != null && lastThemeForActivity != it) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d226dc9feed7e8a962c800dfc486bd29f57dac5d"}, "originalPosition": 48}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e771cc32e5f2b9788d5f89548b08b4e4bf8bfb01", "author": {"user": {"login": "thornbill", "name": "Bill Thornton"}}, "url": "https://github.com/jellyfin/jellyfin-androidtv/commit/e771cc32e5f2b9788d5f89548b08b4e4bf8bfb01", "committedDate": "2020-03-16T19:48:37Z", "message": "Fix code review feedback"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzc1NTQ0MjA4", "url": "https://github.com/jellyfin/jellyfin-androidtv/pull/401#pullrequestreview-375544208", "createdAt": "2020-03-16T20:02:37Z", "commit": {"oid": "e771cc32e5f2b9788d5f89548b08b4e4bf8bfb01"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xNlQyMDowMjozOFrOF3D5cg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xNlQyMDowMjozOFrOF3D5cg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MzI3OTg1OA==", "bodyText": "You forgot to update these with the enum change. (They should be exactly the same as the enums)", "url": "https://github.com/jellyfin/jellyfin-androidtv/pull/401#discussion_r393279858", "createdAt": "2020-03-16T20:02:38Z", "author": {"login": "nielsvanvelzen"}, "path": "app/src/main/res/values/array.xml", "diffHunk": "@@ -3,6 +3,14 @@\n     xmlns:tools=\"http://schemas.android.com/tools\"\n     tools:ignore=\"MissingTranslation\">\n \n+    <string-array name=\"app_theme_entries\">\n+        <item>@string/pref_theme_dark</item>\n+        <item>@string/pref_theme_emerald</item>\n+    </string-array>\n+    <string-array name=\"app_theme_values\">", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e771cc32e5f2b9788d5f89548b08b4e4bf8bfb01"}, "originalPosition": 8}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "4cd69936becf826327ca052ae97a1f1e8c29b912", "author": {"user": {"login": "thornbill", "name": "Bill Thornton"}}, "url": "https://github.com/jellyfin/jellyfin-androidtv/commit/4cd69936becf826327ca052ae97a1f1e8c29b912", "committedDate": "2020-03-16T20:24:33Z", "message": "Fix array values and default value"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzc1NTYxMjk1", "url": "https://github.com/jellyfin/jellyfin-androidtv/pull/401#pullrequestreview-375561295", "createdAt": "2020-03-16T20:32:25Z", "commit": {"oid": "4cd69936becf826327ca052ae97a1f1e8c29b912"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xNlQyMDozMjoyNVrOF3Et5Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xNlQyMDozMjoyNVrOF3Et5Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MzI5MzI4NQ==", "bodyText": "Adding app:useSimpleSummaryProvider=\"true\" will show the currently selected theme as \"description\".", "url": "https://github.com/jellyfin/jellyfin-androidtv/pull/401#discussion_r393293285", "createdAt": "2020-03-16T20:32:25Z", "author": {"login": "nielsvanvelzen"}, "path": "app/src/main/res/xml/preferences.xml", "diffHunk": "@@ -26,6 +26,12 @@\n     </PreferenceCategory>\n \n     <PreferenceCategory android:title=\"@string/pref_general\">\n+        <ListPreference\n+            android:defaultValue=\"Theme_Jellyfin\"\n+            android:entries=\"@array/app_theme_entries\"\n+            android:entryValues=\"@array/app_theme_values\"\n+            android:key=\"app_theme\"\n+            android:title=\"@string/pref_app_theme\" />", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "4cd69936becf826327ca052ae97a1f1e8c29b912"}, "originalPosition": 9}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "79ae013efb96091bd2999b5a45df6ddb7be8684a", "author": {"user": {"login": "thornbill", "name": "Bill Thornton"}}, "url": "https://github.com/jellyfin/jellyfin-androidtv/commit/79ae013efb96091bd2999b5a45df6ddb7be8684a", "committedDate": "2020-03-17T03:54:32Z", "message": "Use simple summary provider for preferences"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzc1ODU4NTg3", "url": "https://github.com/jellyfin/jellyfin-androidtv/pull/401#pullrequestreview-375858587", "createdAt": "2020-03-17T09:20:00Z", "commit": {"oid": "79ae013efb96091bd2999b5a45df6ddb7be8684a"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4297, "cost": 1, "resetAt": "2021-11-01T15:33:45Z"}}}