{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDkxNDE4NDIy", "number": 569, "reviewThreads": {"totalCount": 8, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yNVQwNjo0MzowM1rOEnVADA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yOVQxNDoyNDoyM1rOEok51g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzA5NjczOTk2OnYy", "diffSide": "RIGHT", "path": "app/src/main/java/org/jellyfin/androidtv/ui/GuideChannelHeader.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yNVQwNjo0MzowM1rOHX28xw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yNVQxOTozOTo1MFrOHYQSZA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NDc3OTU5MQ==", "bodyText": "Either remove, uncomment or add a comment explaining why this line is commented to avoid confusion for other devs", "url": "https://github.com/jellyfin/jellyfin-androidtv/pull/569#discussion_r494779591", "createdAt": "2020-09-25T06:43:03Z", "author": {"login": "nielsvanvelzen"}, "path": "app/src/main/java/org/jellyfin/androidtv/ui/GuideChannelHeader.java", "diffHunk": "@@ -45,14 +48,39 @@ private void initComponent(Context context, ChannelInfoDto channel) {\n         ((TextView) findViewById(R.id.channelName)).setText(channel.getName());\n         ((TextView) findViewById(R.id.channelNumber)).setText(channel.getNumber());\n         mChannelImage = (ImageView) findViewById(R.id.channelImage);\n+\n+        if (fragment != null) {\n+            mActivity = fragment;\n+            this.setFocusable(focusable);\n+            setOnClickListener(new OnClickListener() {\n+                @Override\n+                public void onClick(View v) {\n+                    fragment.switchChannel(channel.getId(), false);\n+                }\n+            });\n+        }\n     }\n \n     public void loadImage() {\n-        Glide.with(mActivity)\n+        Glide.with(mContext)\n                 .load(ImageUtils.getPrimaryImageUrl(mChannel, get(ApiClient.class)))\n                 .override(IMAGE_WIDTH, IMAGE_HEIGHT)\n                 .centerInside()\n                 .into(mChannelImage);\n     }\n \n+    @Override\n+    protected void onFocusChanged(boolean gainFocus, int direction, Rect previouslyFocusedRect) {\n+        super.onFocusChanged(gainFocus, direction, previouslyFocusedRect);\n+\n+        if (gainFocus) {\n+            setBackgroundColor(Utils.getThemeColor(getContext(), android.R.attr.colorAccent));\n+\n+            mActivity.setSelectedProgram(this);\n+        } else {\n+            setBackground(getResources().getDrawable(R.drawable.light_border));\n+        }\n+//        TvApp.getApplication().getLogger().Debug(\"Focus on \" + mProgram.getName() + \" was \" + (gainFocus ? \"gained\" : \"lost\"));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "809262a4a7075b6a33e831751b08dc059f26afa4"}, "originalPosition": 75}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NTE5NDcyNA==", "bodyText": "I'll pull it. That line was already there. I didn't know why myself.", "url": "https://github.com/jellyfin/jellyfin-androidtv/pull/569#discussion_r495194724", "createdAt": "2020-09-25T19:39:50Z", "author": {"login": "MrChip53"}, "path": "app/src/main/java/org/jellyfin/androidtv/ui/GuideChannelHeader.java", "diffHunk": "@@ -45,14 +48,39 @@ private void initComponent(Context context, ChannelInfoDto channel) {\n         ((TextView) findViewById(R.id.channelName)).setText(channel.getName());\n         ((TextView) findViewById(R.id.channelNumber)).setText(channel.getNumber());\n         mChannelImage = (ImageView) findViewById(R.id.channelImage);\n+\n+        if (fragment != null) {\n+            mActivity = fragment;\n+            this.setFocusable(focusable);\n+            setOnClickListener(new OnClickListener() {\n+                @Override\n+                public void onClick(View v) {\n+                    fragment.switchChannel(channel.getId(), false);\n+                }\n+            });\n+        }\n     }\n \n     public void loadImage() {\n-        Glide.with(mActivity)\n+        Glide.with(mContext)\n                 .load(ImageUtils.getPrimaryImageUrl(mChannel, get(ApiClient.class)))\n                 .override(IMAGE_WIDTH, IMAGE_HEIGHT)\n                 .centerInside()\n                 .into(mChannelImage);\n     }\n \n+    @Override\n+    protected void onFocusChanged(boolean gainFocus, int direction, Rect previouslyFocusedRect) {\n+        super.onFocusChanged(gainFocus, direction, previouslyFocusedRect);\n+\n+        if (gainFocus) {\n+            setBackgroundColor(Utils.getThemeColor(getContext(), android.R.attr.colorAccent));\n+\n+            mActivity.setSelectedProgram(this);\n+        } else {\n+            setBackground(getResources().getDrawable(R.drawable.light_border));\n+        }\n+//        TvApp.getApplication().getLogger().Debug(\"Focus on \" + mProgram.getName() + \" was \" + (gainFocus ? \"gained\" : \"lost\"));", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NDc3OTU5MQ=="}, "originalCommit": {"oid": "809262a4a7075b6a33e831751b08dc059f26afa4"}, "originalPosition": 75}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzEwMTU4MDE1OnYy", "diffSide": "RIGHT", "path": "app/src/main/java/org/jellyfin/androidtv/ui/livetv/LiveTvGuideActivity.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yN1QwMTowMzowNlrOHYjqAg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yN1QwMjo1Njo1N1rOHYkJhA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NTUxMjA2Ng==", "bodyText": "Shouldn\u2019t this be 30*(slot+1)?", "url": "https://github.com/jellyfin/jellyfin-androidtv/pull/569#discussion_r495512066", "createdAt": "2020-09-27T01:03:06Z", "author": {"login": "thornbill"}, "path": "app/src/main/java/org/jellyfin/androidtv/ui/livetv/LiveTvGuideActivity.java", "diffHunk": "@@ -767,26 +797,36 @@ protected void onPostExecute(Void aVoid) {\n \n     private int currentCellId = 0;\n \n+    private GuideChannelHeader getChannelHeader(Context context, ChannelInfoDto channel, boolean focusable){\n+        return new GuideChannelHeader(context, null, channel, focusable);\n+    }\n+\n     private LinearLayout getProgramRow(List<BaseItemDto> programs, String channelId) {\n \n         LinearLayout programRow = new LinearLayout(this);\n \n         if (programs.size() == 0) {\n             if (mFilters.any()) return null; // don't show rows with no program data\n \n-            BaseItemDto empty = new BaseItemDto();\n-            int duration = ((Long)((mCurrentLocalGuideEnd - mCurrentLocalGuideStart) / 60000)).intValue();\n-            empty.setName(\"  <No Program Data Available>\");\n-            empty.setChannelId(channelId);\n-            empty.setStartDate(TimeUtils.convertToUtcDate(new Date(mCurrentLocalGuideStart)));\n-            empty.setEndDate(TimeUtils.convertToUtcDate(new Date(mCurrentLocalGuideStart+(duration*60000))));\n-            ProgramGridCell cell = new ProgramGridCell(this, this, empty);\n-            cell.setId(currentCellId++);\n-            cell.setLayoutParams(new ViewGroup.LayoutParams(duration * PIXELS_PER_MINUTE, ROW_HEIGHT));\n-            cell.setFocusable(true);\n-            programRow.addView(cell);\n-            cell.setLast();\n-            cell.setFirst();\n+            int minutes = ((Long)((mCurrentLocalGuideEnd - mCurrentLocalGuideStart) / 60000)).intValue();\n+            int slot = 0;\n+            do {\n+                BaseItemDto empty = new BaseItemDto();\n+                empty.setName(\"  \" + getString(R.string.no_program_data));\n+                empty.setChannelId(channelId);\n+                empty.setStartDate(TimeUtils.convertToUtcDate(new Date(mCurrentLocalGuideStart + ((30*slot) * 60000))));\n+                empty.setEndDate(TimeUtils.convertToUtcDate(new Date(mCurrentLocalGuideStart + ((30+(slot+1)) * 60000))));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f782cf1dcd3a24411c2f7eade87353d8ec85a785"}, "originalPosition": 95}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NTUyMDEzMg==", "bodyText": "Yes. Fixed.", "url": "https://github.com/jellyfin/jellyfin-androidtv/pull/569#discussion_r495520132", "createdAt": "2020-09-27T02:56:57Z", "author": {"login": "MrChip53"}, "path": "app/src/main/java/org/jellyfin/androidtv/ui/livetv/LiveTvGuideActivity.java", "diffHunk": "@@ -767,26 +797,36 @@ protected void onPostExecute(Void aVoid) {\n \n     private int currentCellId = 0;\n \n+    private GuideChannelHeader getChannelHeader(Context context, ChannelInfoDto channel, boolean focusable){\n+        return new GuideChannelHeader(context, null, channel, focusable);\n+    }\n+\n     private LinearLayout getProgramRow(List<BaseItemDto> programs, String channelId) {\n \n         LinearLayout programRow = new LinearLayout(this);\n \n         if (programs.size() == 0) {\n             if (mFilters.any()) return null; // don't show rows with no program data\n \n-            BaseItemDto empty = new BaseItemDto();\n-            int duration = ((Long)((mCurrentLocalGuideEnd - mCurrentLocalGuideStart) / 60000)).intValue();\n-            empty.setName(\"  <No Program Data Available>\");\n-            empty.setChannelId(channelId);\n-            empty.setStartDate(TimeUtils.convertToUtcDate(new Date(mCurrentLocalGuideStart)));\n-            empty.setEndDate(TimeUtils.convertToUtcDate(new Date(mCurrentLocalGuideStart+(duration*60000))));\n-            ProgramGridCell cell = new ProgramGridCell(this, this, empty);\n-            cell.setId(currentCellId++);\n-            cell.setLayoutParams(new ViewGroup.LayoutParams(duration * PIXELS_PER_MINUTE, ROW_HEIGHT));\n-            cell.setFocusable(true);\n-            programRow.addView(cell);\n-            cell.setLast();\n-            cell.setFirst();\n+            int minutes = ((Long)((mCurrentLocalGuideEnd - mCurrentLocalGuideStart) / 60000)).intValue();\n+            int slot = 0;\n+            do {\n+                BaseItemDto empty = new BaseItemDto();\n+                empty.setName(\"  \" + getString(R.string.no_program_data));\n+                empty.setChannelId(channelId);\n+                empty.setStartDate(TimeUtils.convertToUtcDate(new Date(mCurrentLocalGuideStart + ((30*slot) * 60000))));\n+                empty.setEndDate(TimeUtils.convertToUtcDate(new Date(mCurrentLocalGuideStart + ((30+(slot+1)) * 60000))));", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NTUxMjA2Ng=="}, "originalCommit": {"oid": "f782cf1dcd3a24411c2f7eade87353d8ec85a785"}, "originalPosition": 95}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzEwMTU4MTc5OnYy", "diffSide": "RIGHT", "path": "app/src/main/java/org/jellyfin/androidtv/ui/livetv/LiveTvGuideActivity.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yN1QwMTowNToyMlrOHYjqtw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yN1QwMjo1NzoyNVrOHYkJrg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NTUxMjI0Nw==", "bodyText": "It shouldn\u2019t be necessary to multiply both sides by 60000 here.", "url": "https://github.com/jellyfin/jellyfin-androidtv/pull/569#discussion_r495512247", "createdAt": "2020-09-27T01:05:22Z", "author": {"login": "thornbill"}, "path": "app/src/main/java/org/jellyfin/androidtv/ui/livetv/LiveTvGuideActivity.java", "diffHunk": "@@ -767,26 +797,36 @@ protected void onPostExecute(Void aVoid) {\n \n     private int currentCellId = 0;\n \n+    private GuideChannelHeader getChannelHeader(Context context, ChannelInfoDto channel, boolean focusable){\n+        return new GuideChannelHeader(context, null, channel, focusable);\n+    }\n+\n     private LinearLayout getProgramRow(List<BaseItemDto> programs, String channelId) {\n \n         LinearLayout programRow = new LinearLayout(this);\n \n         if (programs.size() == 0) {\n             if (mFilters.any()) return null; // don't show rows with no program data\n \n-            BaseItemDto empty = new BaseItemDto();\n-            int duration = ((Long)((mCurrentLocalGuideEnd - mCurrentLocalGuideStart) / 60000)).intValue();\n-            empty.setName(\"  <No Program Data Available>\");\n-            empty.setChannelId(channelId);\n-            empty.setStartDate(TimeUtils.convertToUtcDate(new Date(mCurrentLocalGuideStart)));\n-            empty.setEndDate(TimeUtils.convertToUtcDate(new Date(mCurrentLocalGuideStart+(duration*60000))));\n-            ProgramGridCell cell = new ProgramGridCell(this, this, empty);\n-            cell.setId(currentCellId++);\n-            cell.setLayoutParams(new ViewGroup.LayoutParams(duration * PIXELS_PER_MINUTE, ROW_HEIGHT));\n-            cell.setFocusable(true);\n-            programRow.addView(cell);\n-            cell.setLast();\n-            cell.setFirst();\n+            int minutes = ((Long)((mCurrentLocalGuideEnd - mCurrentLocalGuideStart) / 60000)).intValue();\n+            int slot = 0;\n+            do {\n+                BaseItemDto empty = new BaseItemDto();\n+                empty.setName(\"  \" + getString(R.string.no_program_data));\n+                empty.setChannelId(channelId);\n+                empty.setStartDate(TimeUtils.convertToUtcDate(new Date(mCurrentLocalGuideStart + ((30*slot) * 60000))));\n+                empty.setEndDate(TimeUtils.convertToUtcDate(new Date(mCurrentLocalGuideStart + ((30+(slot+1)) * 60000))));\n+                ProgramGridCell cell = new ProgramGridCell(this, this, empty, false);\n+                cell.setId(currentCellId++);\n+                cell.setLayoutParams(new ViewGroup.LayoutParams(30 * PIXELS_PER_MINUTE, ROW_HEIGHT));\n+                cell.setFocusable(true);\n+                programRow.addView(cell);\n+                if (slot == 0)\n+                    cell.setFirst();\n+                if (slot == (minutes / 30) - 1)\n+                    cell.setLast();\n+                slot++;\n+            } while((30*slot)*60000 < minutes*60000);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f782cf1dcd3a24411c2f7eade87353d8ec85a785"}, "originalPosition": 106}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NTUyMDE3NA==", "bodyText": "Agree. Didn't realize the redundancy. Fixed.", "url": "https://github.com/jellyfin/jellyfin-androidtv/pull/569#discussion_r495520174", "createdAt": "2020-09-27T02:57:25Z", "author": {"login": "MrChip53"}, "path": "app/src/main/java/org/jellyfin/androidtv/ui/livetv/LiveTvGuideActivity.java", "diffHunk": "@@ -767,26 +797,36 @@ protected void onPostExecute(Void aVoid) {\n \n     private int currentCellId = 0;\n \n+    private GuideChannelHeader getChannelHeader(Context context, ChannelInfoDto channel, boolean focusable){\n+        return new GuideChannelHeader(context, null, channel, focusable);\n+    }\n+\n     private LinearLayout getProgramRow(List<BaseItemDto> programs, String channelId) {\n \n         LinearLayout programRow = new LinearLayout(this);\n \n         if (programs.size() == 0) {\n             if (mFilters.any()) return null; // don't show rows with no program data\n \n-            BaseItemDto empty = new BaseItemDto();\n-            int duration = ((Long)((mCurrentLocalGuideEnd - mCurrentLocalGuideStart) / 60000)).intValue();\n-            empty.setName(\"  <No Program Data Available>\");\n-            empty.setChannelId(channelId);\n-            empty.setStartDate(TimeUtils.convertToUtcDate(new Date(mCurrentLocalGuideStart)));\n-            empty.setEndDate(TimeUtils.convertToUtcDate(new Date(mCurrentLocalGuideStart+(duration*60000))));\n-            ProgramGridCell cell = new ProgramGridCell(this, this, empty);\n-            cell.setId(currentCellId++);\n-            cell.setLayoutParams(new ViewGroup.LayoutParams(duration * PIXELS_PER_MINUTE, ROW_HEIGHT));\n-            cell.setFocusable(true);\n-            programRow.addView(cell);\n-            cell.setLast();\n-            cell.setFirst();\n+            int minutes = ((Long)((mCurrentLocalGuideEnd - mCurrentLocalGuideStart) / 60000)).intValue();\n+            int slot = 0;\n+            do {\n+                BaseItemDto empty = new BaseItemDto();\n+                empty.setName(\"  \" + getString(R.string.no_program_data));\n+                empty.setChannelId(channelId);\n+                empty.setStartDate(TimeUtils.convertToUtcDate(new Date(mCurrentLocalGuideStart + ((30*slot) * 60000))));\n+                empty.setEndDate(TimeUtils.convertToUtcDate(new Date(mCurrentLocalGuideStart + ((30+(slot+1)) * 60000))));\n+                ProgramGridCell cell = new ProgramGridCell(this, this, empty, false);\n+                cell.setId(currentCellId++);\n+                cell.setLayoutParams(new ViewGroup.LayoutParams(30 * PIXELS_PER_MINUTE, ROW_HEIGHT));\n+                cell.setFocusable(true);\n+                programRow.addView(cell);\n+                if (slot == 0)\n+                    cell.setFirst();\n+                if (slot == (minutes / 30) - 1)\n+                    cell.setLast();\n+                slot++;\n+            } while((30*slot)*60000 < minutes*60000);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NTUxMjI0Nw=="}, "originalCommit": {"oid": "f782cf1dcd3a24411c2f7eade87353d8ec85a785"}, "originalPosition": 106}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzEwMTU4NDA1OnYy", "diffSide": "RIGHT", "path": "app/src/main/java/org/jellyfin/androidtv/ui/playback/CustomPlaybackOverlayFragment.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yN1QwMTowOTo0MVrOHYjruw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yN1QwMTowOTo0MVrOHYjruw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NTUxMjUwNw==", "bodyText": "Same here", "url": "https://github.com/jellyfin/jellyfin-androidtv/pull/569#discussion_r495512507", "createdAt": "2020-09-27T01:09:41Z", "author": {"login": "thornbill"}, "path": "app/src/main/java/org/jellyfin/androidtv/ui/playback/CustomPlaybackOverlayFragment.java", "diffHunk": "@@ -842,19 +910,35 @@ protected void onPostExecute(Void aVoid) {\n \n     private int currentCellId = 0;\n \n+    private GuideChannelHeader getChannelHeader(Context context, ChannelInfoDto channel, boolean focusable){\n+        return new GuideChannelHeader(context, this, channel, focusable);\n+    }\n+\n     private LinearLayout getProgramRow(List<BaseItemDto> programs, String channelId) {\n         LinearLayout programRow = new LinearLayout(mActivity);\n         if (programs.size() == 0) {\n-            BaseItemDto empty = new BaseItemDto();\n-            empty.setName(mApplication.getString(R.string.no_program_data));\n-            empty.setChannelId(channelId);\n-            empty.setStartDate(TimeUtils.convertToUtcDate(new Date(mCurrentLocalGuideStart)));\n-            empty.setEndDate(TimeUtils.convertToUtcDate(new Date(mCurrentLocalGuideStart + (150 * 60000))));\n-            ProgramGridCell cell = new ProgramGridCell(mActivity, mFragment, empty);\n-            cell.setId(currentCellId++);\n-            cell.setLayoutParams(new ViewGroup.LayoutParams(150 * PIXELS_PER_MINUTE, LiveTvGuideActivity.ROW_HEIGHT));\n-            cell.setFocusable(true);\n-            programRow.addView(cell);\n+\n+            int minutes = ((Long)((mCurrentLocalGuideEnd - mCurrentLocalGuideStart) / 60000)).intValue();\n+            int slot = 0;\n+\n+            do {\n+                BaseItemDto empty = new BaseItemDto();\n+                empty.setName(\"  \" + getString(R.string.no_program_data));\n+                empty.setChannelId(channelId);\n+                empty.setStartDate(TimeUtils.convertToUtcDate(new Date(mCurrentLocalGuideStart + ((30*slot) * 60000))));\n+                empty.setEndDate(TimeUtils.convertToUtcDate(new Date(mCurrentLocalGuideStart + ((30+(slot+1)) * 60000))));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f782cf1dcd3a24411c2f7eade87353d8ec85a785"}, "originalPosition": 244}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzEwMTU4NDMxOnYy", "diffSide": "RIGHT", "path": "app/src/main/java/org/jellyfin/androidtv/ui/playback/CustomPlaybackOverlayFragment.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yN1QwMToxMDowMFrOHYjr2A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yN1QwMToxMDowMFrOHYjr2A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NTUxMjUzNg==", "bodyText": "Same here", "url": "https://github.com/jellyfin/jellyfin-androidtv/pull/569#discussion_r495512536", "createdAt": "2020-09-27T01:10:00Z", "author": {"login": "thornbill"}, "path": "app/src/main/java/org/jellyfin/androidtv/ui/playback/CustomPlaybackOverlayFragment.java", "diffHunk": "@@ -842,19 +910,35 @@ protected void onPostExecute(Void aVoid) {\n \n     private int currentCellId = 0;\n \n+    private GuideChannelHeader getChannelHeader(Context context, ChannelInfoDto channel, boolean focusable){\n+        return new GuideChannelHeader(context, this, channel, focusable);\n+    }\n+\n     private LinearLayout getProgramRow(List<BaseItemDto> programs, String channelId) {\n         LinearLayout programRow = new LinearLayout(mActivity);\n         if (programs.size() == 0) {\n-            BaseItemDto empty = new BaseItemDto();\n-            empty.setName(mApplication.getString(R.string.no_program_data));\n-            empty.setChannelId(channelId);\n-            empty.setStartDate(TimeUtils.convertToUtcDate(new Date(mCurrentLocalGuideStart)));\n-            empty.setEndDate(TimeUtils.convertToUtcDate(new Date(mCurrentLocalGuideStart + (150 * 60000))));\n-            ProgramGridCell cell = new ProgramGridCell(mActivity, mFragment, empty);\n-            cell.setId(currentCellId++);\n-            cell.setLayoutParams(new ViewGroup.LayoutParams(150 * PIXELS_PER_MINUTE, LiveTvGuideActivity.ROW_HEIGHT));\n-            cell.setFocusable(true);\n-            programRow.addView(cell);\n+\n+            int minutes = ((Long)((mCurrentLocalGuideEnd - mCurrentLocalGuideStart) / 60000)).intValue();\n+            int slot = 0;\n+\n+            do {\n+                BaseItemDto empty = new BaseItemDto();\n+                empty.setName(\"  \" + getString(R.string.no_program_data));\n+                empty.setChannelId(channelId);\n+                empty.setStartDate(TimeUtils.convertToUtcDate(new Date(mCurrentLocalGuideStart + ((30*slot) * 60000))));\n+                empty.setEndDate(TimeUtils.convertToUtcDate(new Date(mCurrentLocalGuideStart + ((30+(slot+1)) * 60000))));\n+                ProgramGridCell cell = new ProgramGridCell(mActivity, this, empty, false);\n+                cell.setId(currentCellId++);\n+                cell.setLayoutParams(new ViewGroup.LayoutParams(30 * PIXELS_PER_MINUTE, LiveTvGuideActivity.ROW_HEIGHT));\n+                cell.setFocusable(true);\n+                programRow.addView(cell);\n+                if (slot == 0)\n+                    cell.setFirst();\n+                if (slot == (minutes / 30) - 1)\n+                    cell.setLast();\n+                slot++;\n+            } while((30*slot)*60000 < minutes*60000);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f782cf1dcd3a24411c2f7eade87353d8ec85a785"}, "originalPosition": 255}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzEwOTUyNTM3OnYy", "diffSide": "RIGHT", "path": "app/src/main/java/org/jellyfin/androidtv/ui/livetv/TvManager.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yOVQxMzoyMzoyNVrOHZs6Xw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yOVQxMzoyMzoyNVrOHZs6Xw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NjcxMjI4Nw==", "bodyText": "It looks like getUserData() can return null, so we should add some checks here to handle that.", "url": "https://github.com/jellyfin/jellyfin-androidtv/pull/569#discussion_r496712287", "createdAt": "2020-09-29T13:23:25Z", "author": {"login": "thornbill"}, "path": "app/src/main/java/org/jellyfin/androidtv/ui/livetv/TvManager.java", "diffHunk": "@@ -248,6 +248,15 @@ public int compare(ChannelInfoDto lhs, ChannelInfoDto rhs) {\n                 }));\n             }\n \n+            if (prefs.favsAtTop) {\n+                Collections.sort(allChannels, new Comparator<ChannelInfoDto>() {\n+                    @Override\n+                    public int compare(ChannelInfoDto channelInfoDto, ChannelInfoDto t1) {\n+                        return -Boolean.compare(channelInfoDto.getUserData().getIsFavorite(), t1.getUserData().getIsFavorite());", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "8b0bacbc146cc3dd61b7e617dfe909319f7bfef7"}, "originalPosition": 8}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzEwOTUyODcwOnYy", "diffSide": "RIGHT", "path": "app/src/main/java/org/jellyfin/androidtv/ui/livetv/TvManager.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yOVQxMzoyNDowOVrOHZs8fg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yOVQxMzoyNDowOVrOHZs8fg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NjcxMjgzMA==", "bodyText": "Maybe just use channel1 and channel2 as the variable names here?", "url": "https://github.com/jellyfin/jellyfin-androidtv/pull/569#discussion_r496712830", "createdAt": "2020-09-29T13:24:09Z", "author": {"login": "thornbill"}, "path": "app/src/main/java/org/jellyfin/androidtv/ui/livetv/TvManager.java", "diffHunk": "@@ -248,6 +248,15 @@ public int compare(ChannelInfoDto lhs, ChannelInfoDto rhs) {\n                 }));\n             }\n \n+            if (prefs.favsAtTop) {\n+                Collections.sort(allChannels, new Comparator<ChannelInfoDto>() {\n+                    @Override\n+                    public int compare(ChannelInfoDto channelInfoDto, ChannelInfoDto t1) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "8b0bacbc146cc3dd61b7e617dfe909319f7bfef7"}, "originalPosition": 7}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzEwOTgzMTI2OnYy", "diffSide": "RIGHT", "path": "app/src/main/java/org/jellyfin/androidtv/ui/livetv/LiveTvGuideActivity.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yOVQxNDoyNDoyM1rOHZv4HQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yOVQxNzozMDoyMVrOHZ5WzQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5Njc2MDg2MQ==", "bodyText": "Why did you change this from using System.currentTimeMillis()?", "url": "https://github.com/jellyfin/jellyfin-androidtv/pull/569#discussion_r496760861", "createdAt": "2020-09-29T14:24:23Z", "author": {"login": "thornbill"}, "path": "app/src/main/java/org/jellyfin/androidtv/ui/livetv/LiveTvGuideActivity.java", "diffHunk": "@@ -260,7 +260,10 @@ protected void onResume() {\n     }\n \n     protected void doLoad() {\n-        if (TvManager.shouldForceReload() || System.currentTimeMillis() > mLastLoad + 3600000) {\n+        Calendar curTime = Calendar.getInstance();\n+        curTime.setTime(new Date());", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "8b0bacbc146cc3dd61b7e617dfe909319f7bfef7"}, "originalPosition": 24}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NjkxNjE3Mw==", "bodyText": "I changed a lot of these to use Calendar. For some reason, it appears that the calendar.getTimeMs fucntion adds some sort of zero padding and so Calendars current time would not ever equal Systems current time for me. I can look into this further and see if it was just my bad code or a real issue. The mCurrentGuide longs are set based off of Calendar variables.\nScratch all that I think I did this in another feature that's not ready yet. Also, don't know why I did this because they are the same after checking. Must of been losing my mind, it was late \ud83d\ude04", "url": "https://github.com/jellyfin/jellyfin-androidtv/pull/569#discussion_r496916173", "createdAt": "2020-09-29T17:30:21Z", "author": {"login": "MrChip53"}, "path": "app/src/main/java/org/jellyfin/androidtv/ui/livetv/LiveTvGuideActivity.java", "diffHunk": "@@ -260,7 +260,10 @@ protected void onResume() {\n     }\n \n     protected void doLoad() {\n-        if (TvManager.shouldForceReload() || System.currentTimeMillis() > mLastLoad + 3600000) {\n+        Calendar curTime = Calendar.getInstance();\n+        curTime.setTime(new Date());", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5Njc2MDg2MQ=="}, "originalCommit": {"oid": "8b0bacbc146cc3dd61b7e617dfe909319f7bfef7"}, "originalPosition": 24}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 945, "cost": 1, "resetAt": "2021-11-12T19:05:54Z"}}}