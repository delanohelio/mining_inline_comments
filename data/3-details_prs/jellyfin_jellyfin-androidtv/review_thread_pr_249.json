{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0MzU4NzQ3Mjg5", "number": 249, "reviewThreads": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0wMlQxODo1Njo0NlrODVhNFQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0wMlQxODo1ODozMlrODVhOeQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjIzODkwNzA5OnYy", "diffSide": "LEFT", "path": "app/src/main/res/values/strings.xml", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0wMlQxODo1Njo0NlrOFZyjjw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0wM1QxOTowNzoyNVrOFaHK7w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2MjU4NzAyMw==", "bodyText": "These will need to be removed for all locales.", "url": "https://github.com/jellyfin/jellyfin-androidtv/pull/249#discussion_r362587023", "createdAt": "2020-01-02T18:56:46Z", "author": {"login": "thornbill"}, "path": "app/src/main/res/values/strings.xml", "diffHunk": "@@ -305,11 +305,9 @@\n     <string name=\"lbl_next_episode\">Next Episode</string>\n     <string name=\"lbl_album_name\">Album name</string>\n     <string name=\"lbl_song_title\">Song Title</string>\n-    <string name=\"pref_use_external_player_title\">Use External Player for Videos</string>\n-    <string name=\"pref_use_external_player_summary\">Requires a capable app to play video types</string>", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "3897ebbb554bbf94c3333615710af6e41327473b"}, "originalPosition": 5}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2MjkyNDc4Mw==", "bodyText": "Fixed, first time working on an android app with multiple languages so I forgot to remove the strings from other files. I noticed the string editor in android studio helps with that fortunately", "url": "https://github.com/jellyfin/jellyfin-androidtv/pull/249#discussion_r362924783", "createdAt": "2020-01-03T19:07:25Z", "author": {"login": "nielsvanvelzen"}, "path": "app/src/main/res/values/strings.xml", "diffHunk": "@@ -305,11 +305,9 @@\n     <string name=\"lbl_next_episode\">Next Episode</string>\n     <string name=\"lbl_album_name\">Album name</string>\n     <string name=\"lbl_song_title\">Song Title</string>\n-    <string name=\"pref_use_external_player_title\">Use External Player for Videos</string>\n-    <string name=\"pref_use_external_player_summary\">Requires a capable app to play video types</string>", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2MjU4NzAyMw=="}, "originalCommit": {"oid": "3897ebbb554bbf94c3333615710af6e41327473b"}, "originalPosition": 5}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjIzODkxMDY1OnYy", "diffSide": "RIGHT", "path": "app/src/main/java/org/jellyfin/androidtv/startup/StartupActivity.java", "isResolved": true, "comments": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0wMlQxODo1ODozMlrOFZyl5g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0wMlQyMDo0MjozNlrOFZ0uPg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2MjU4NzYyMg==", "bodyText": "Does it make sense to maintain a config version? I have been thinking it may be less overhead to just check if a specific preference exists and set the default value if it does not.", "url": "https://github.com/jellyfin/jellyfin-androidtv/pull/249#discussion_r362587622", "createdAt": "2020-01-02T18:58:32Z", "author": {"login": "thornbill"}, "path": "app/src/main/java/org/jellyfin/androidtv/startup/StartupActivity.java", "diffHunk": "@@ -70,6 +70,12 @@ protected void onCreate(Bundle savedInstanceState) {\n             application.getPrefs().edit().putBoolean(\"pref_enable_info_panel\", false).apply();\n             application.getSystemPrefs().edit().putString(\"sys_pref_config_version\", \"4\").apply();\n         }\n+        if (Integer.parseInt(application.getConfigVersion()) < 5) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "3897ebbb554bbf94c3333615710af6e41327473b"}, "originalPosition": 4}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2MjU5MzAzOQ==", "bodyText": "I think it does make sense! Imagine a setting being renamed or (like in this case) a setting replacing another one. It would be annoying if the app auto-updates via the play store and suddenly your behavior changed because there is no migration. In this case external player users wouldn't use the external player anymore.\nI do however think that the way this is done is ugly, in the future we might want to separate the preferences to a custom class which brings type safety (using enums instead of strings etc.) and handles migration a bit better.\nThis class could have getters & setters that need to be called and could use shared preferences as storage or maybe even sqlite.", "url": "https://github.com/jellyfin/jellyfin-androidtv/pull/249#discussion_r362593039", "createdAt": "2020-01-02T19:14:21Z", "author": {"login": "nielsvanvelzen"}, "path": "app/src/main/java/org/jellyfin/androidtv/startup/StartupActivity.java", "diffHunk": "@@ -70,6 +70,12 @@ protected void onCreate(Bundle savedInstanceState) {\n             application.getPrefs().edit().putBoolean(\"pref_enable_info_panel\", false).apply();\n             application.getSystemPrefs().edit().putString(\"sys_pref_config_version\", \"4\").apply();\n         }\n+        if (Integer.parseInt(application.getConfigVersion()) < 5) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2MjU4NzYyMg=="}, "originalCommit": {"oid": "3897ebbb554bbf94c3333615710af6e41327473b"}, "originalPosition": 4}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2MjYxMTA5NA==", "bodyText": "I've created a simple class for usage in my apps with these simple getters and setters and I've used it a lot. Might save a little bit of work https://github.com/Florianisme/SharedPreferences", "url": "https://github.com/jellyfin/jellyfin-androidtv/pull/249#discussion_r362611094", "createdAt": "2020-01-02T20:05:22Z", "author": {"login": "Florianisme"}, "path": "app/src/main/java/org/jellyfin/androidtv/startup/StartupActivity.java", "diffHunk": "@@ -70,6 +70,12 @@ protected void onCreate(Bundle savedInstanceState) {\n             application.getPrefs().edit().putBoolean(\"pref_enable_info_panel\", false).apply();\n             application.getSystemPrefs().edit().putString(\"sys_pref_config_version\", \"4\").apply();\n         }\n+        if (Integer.parseInt(application.getConfigVersion()) < 5) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2MjU4NzYyMg=="}, "originalCommit": {"oid": "3897ebbb554bbf94c3333615710af6e41327473b"}, "originalPosition": 4}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2MjYxOTg0Mg==", "bodyText": "I would prefer the different settings being defined too, so no \"getBoolean\" or \"getString\" but \"getPreferredPlayer\" and \"getConfigVersion\".\nSomething like:\nenum class PlayerType {\n\tAUTO,\n\tVLC,\n\tEXOPLAYER,\n\tEXTERNAL\n}\n\nclass Preferences(\n\tprivate val context: Context\n) {\n\tprivate val sharedPreferences by lazy {\n\t\tPreferenceManager.getDefaultSharedPreferences(context)\n\t}\n\n\t/* Preferences */\n\tvar preferedPlayer by enumPreference(\"pref_video_player\", PlayerType.AUTO)\n\tvar configVersion by intPreference(\"sys_pref_config_version\", 1)\n\n\t/** Storage functions */\n\tprivate fun intPreference(key: String, default: Int) = object : ReadWriteProperty<Preferences, Int> {\n\t\toverride fun getValue(thisRef: Preferences, property: KProperty<*>): Int {\n\t\t\treturn sharedPreferences.getInt(key, default)\n\t\t}\n\n\t\toverride fun setValue(thisRef: Preferences, property: KProperty<*>, value: Int) {\n\t\t\tsharedPreferences.edit().putInt(key, value).apply()\n\t\t}\n\t}\n\n\tprivate inline fun <reified T: Enum<T>> enumPreference(key: String, default: T?) = object : ReadWriteProperty<Preferences, T?> {\n\t\toverride fun getValue(thisRef: Preferences, property: KProperty<*>): T? {\n\t\t\tval stringValue = sharedPreferences.getString(key, null)\n\n\t\t\treturn if (stringValue == null) default\n\t\t\telse T::class.java.enumConstants.find { it.name == stringValue }\n\t\t}\n\n\t\toverride fun setValue(thisRef: Preferences, property: KProperty<*>, value: T?) {\n\t\t\tif (value == null) sharedPreferences.edit().remove(key).apply()\n\t\t\telse sharedPreferences.edit().putString(key, value.toString()).apply()\n\t\t}\n\t}\n}\nI actually wanted to make a quick example but got carried away so this should probably work already lol", "url": "https://github.com/jellyfin/jellyfin-androidtv/pull/249#discussion_r362619842", "createdAt": "2020-01-02T20:33:46Z", "author": {"login": "nielsvanvelzen"}, "path": "app/src/main/java/org/jellyfin/androidtv/startup/StartupActivity.java", "diffHunk": "@@ -70,6 +70,12 @@ protected void onCreate(Bundle savedInstanceState) {\n             application.getPrefs().edit().putBoolean(\"pref_enable_info_panel\", false).apply();\n             application.getSystemPrefs().edit().putString(\"sys_pref_config_version\", \"4\").apply();\n         }\n+        if (Integer.parseInt(application.getConfigVersion()) < 5) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2MjU4NzYyMg=="}, "originalCommit": {"oid": "3897ebbb554bbf94c3333615710af6e41327473b"}, "originalPosition": 4}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2MjYyMjUyNg==", "bodyText": "Now that I spend some effort I made an issue for it #250", "url": "https://github.com/jellyfin/jellyfin-androidtv/pull/249#discussion_r362622526", "createdAt": "2020-01-02T20:42:36Z", "author": {"login": "nielsvanvelzen"}, "path": "app/src/main/java/org/jellyfin/androidtv/startup/StartupActivity.java", "diffHunk": "@@ -70,6 +70,12 @@ protected void onCreate(Bundle savedInstanceState) {\n             application.getPrefs().edit().putBoolean(\"pref_enable_info_panel\", false).apply();\n             application.getSystemPrefs().edit().putString(\"sys_pref_config_version\", \"4\").apply();\n         }\n+        if (Integer.parseInt(application.getConfigVersion()) < 5) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2MjU4NzYyMg=="}, "originalCommit": {"oid": "3897ebbb554bbf94c3333615710af6e41327473b"}, "originalPosition": 4}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1100, "cost": 1, "resetAt": "2021-11-12T19:05:54Z"}}}