{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDU0ODEwMjQ5", "number": 524, "title": "Fix VLC audio passthrough", "bodyText": "Noticed some issues with VLC audio passthrough on the nvidia shield which caused Atmos to not work correctly. Believe this was due to an overall slight misconfiguration of VLC audio passthrough.\nChanges\nThis slightly changes the way audio is configured for libvlc to be more in-line with the way https://github.com/videolan/vlc-android works.\nIssues\n#281", "createdAt": "2020-07-22T00:17:19Z", "url": "https://github.com/jellyfin/jellyfin-androidtv/pull/524", "merged": true, "mergeCommit": {"oid": "311fafe2e6621dff91c29f255109586dc8f02dc1"}, "closed": true, "closedAt": "2020-08-21T18:58:05Z", "author": {"login": "willtrking"}, "timelineItems": {"totalCount": 9, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABc3PeU2gH2gAyNDU0ODEwMjQ5OmVjYmIxODgwNjI4YTQyZGNlODAzMWVjMThkNzcyYzVlMzUxYzAyMDI=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdBJievAFqTQ3MjczMjM5Nw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "ecbb1880628a42dce8031ec18d772c5e351c0202", "author": {"user": {"login": "willtrking", "name": "William King"}}, "url": "https://github.com/jellyfin/jellyfin-androidtv/commit/ecbb1880628a42dce8031ec18d772c5e351c0202", "committedDate": "2020-07-22T00:13:37Z", "message": "Fix VLC atmos support"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c921fcdc2deb0adbfd9d9c6b3f88e40ab6cd8f93", "author": {"user": {"login": "willtrking", "name": "William King"}}, "url": "https://github.com/jellyfin/jellyfin-androidtv/commit/c921fcdc2deb0adbfd9d9c6b3f88e40ab6cd8f93", "committedDate": "2020-07-22T00:19:22Z", "message": "remove tabs"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "8c6050760ef62839ecaae4f85c5a8982575f4212", "author": {"user": {"login": "willtrking", "name": "William King"}}, "url": "https://github.com/jellyfin/jellyfin-androidtv/commit/8c6050760ef62839ecaae4f85c5a8982575f4212", "committedDate": "2020-07-22T00:20:56Z", "message": "fix tabs"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDUzMzg3NDI3", "url": "https://github.com/jellyfin/jellyfin-androidtv/pull/524#pullrequestreview-453387427", "createdAt": "2020-07-22T14:42:50Z", "commit": {"oid": "8c6050760ef62839ecaae4f85c5a8982575f4212"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yMlQxNDo0Mjo1MFrOG1luTQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yMlQxNDo0NTo1MFrOG1l3ug==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1ODg0NTc3Mw==", "bodyText": "It looks like this will returns a boolean indicating if it is successful or not, we should probably do something like:\nif (!Utils.downMixAudio() || !mVlcPlayer.setAudioDigitalOutputEnabled(true)) {\n    mVlcPlayer.setAudioOutput(\"opensles_android\");\n}\nSo it will fallback to downmixing if it fails.", "url": "https://github.com/jellyfin/jellyfin-androidtv/pull/524#discussion_r458845773", "createdAt": "2020-07-22T14:42:50Z", "author": {"login": "thornbill"}, "path": "app/src/main/java/org/jellyfin/androidtv/playback/MediaManager.java", "diffHunk": "@@ -227,8 +227,12 @@ public void onPlayerError(ExoPlaybackException error) {\n                 mLibVLC = new LibVLC(TvApp.getApplication(), options);\n \n                 mVlcPlayer = new org.videolan.libvlc.MediaPlayer(mLibVLC);\n-                mVlcPlayer.setAudioOutput(Utils.downMixAudio() ? \"opensles_android\" : \"android_audiotrack\");\n-                mVlcPlayer.setAudioOutputDevice(\"hdmi\");\n+                if(!Utils.downMixAudio()) {\n+                    mVlcPlayer.setAudioDigitalOutputEnabled(true);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "8c6050760ef62839ecaae4f85c5a8982575f4212"}, "originalPosition": 7}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1ODg0NzI0Ng==", "bodyText": "I'm not sure if it's necessary or not, but it seems to be inconsistent on whether mVlcPlayer.setAudioOutputDevice(\"hdmi\"); is called or not. Maybe it should be still be called here?", "url": "https://github.com/jellyfin/jellyfin-androidtv/pull/524#discussion_r458847246", "createdAt": "2020-07-22T14:44:44Z", "author": {"login": "thornbill"}, "path": "app/src/main/java/org/jellyfin/androidtv/playback/MediaManager.java", "diffHunk": "@@ -227,8 +227,12 @@ public void onPlayerError(ExoPlaybackException error) {\n                 mLibVLC = new LibVLC(TvApp.getApplication(), options);\n \n                 mVlcPlayer = new org.videolan.libvlc.MediaPlayer(mLibVLC);\n-                mVlcPlayer.setAudioOutput(Utils.downMixAudio() ? \"opensles_android\" : \"android_audiotrack\");\n-                mVlcPlayer.setAudioOutputDevice(\"hdmi\");\n+                if(!Utils.downMixAudio()) {\n+                    mVlcPlayer.setAudioDigitalOutputEnabled(true);\n+                } else {\n+                    mVlcPlayer.setAudioOutput(\"opensles_android\");", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "8c6050760ef62839ecaae4f85c5a8982575f4212"}, "originalPosition": 9}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1ODg0ODE4Ng==", "bodyText": "Same notes as above apply here.", "url": "https://github.com/jellyfin/jellyfin-androidtv/pull/524#discussion_r458848186", "createdAt": "2020-07-22T14:45:50Z", "author": {"login": "thornbill"}, "path": "app/src/main/java/org/jellyfin/androidtv/playback/VideoManager.java", "diffHunk": "@@ -442,16 +443,24 @@ public long getAudioDelay() {\n     }\n \n     public void setCompatibleAudio() {\n-         if (!nativeMode) {\n-             mVlcPlayer.setAudioOutput(\"opensles_android\");\n-             mVlcPlayer.setAudioOutputDevice(\"hdmi\");\n-         }\n+        if (!nativeMode) {\n+            mVlcPlayer.setAudioOutput(\"opensles_android\");\n+            mVlcPlayer.setAudioOutputDevice(\"hdmi\");\n+        }\n     }\n \n     public void setAudioMode() {\n         if (!nativeMode) {\n-            mVlcPlayer.setAudioOutput(Utils.downMixAudio() ? \"opensles_android\" : \"android_audiotrack\");\n-            mVlcPlayer.setAudioOutputDevice(\"hdmi\");\n+            setVlcAudioOptions();\n+        }\n+    }\n+\n+    private void setVlcAudioOptions() {\n+\n+        if(!Utils.downMixAudio()) {\n+            mVlcPlayer.setAudioDigitalOutputEnabled(true);\n+        } else {\n+            mVlcPlayer.setAudioOutput(\"opensles_android\");", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "8c6050760ef62839ecaae4f85c5a8982575f4212"}, "originalPosition": 35}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c57454b3661e9557e419601ed37726087c831b32", "author": {"user": {"login": "willtrking", "name": "William King"}}, "url": "https://github.com/jellyfin/jellyfin-androidtv/commit/c57454b3661e9557e419601ed37726087c831b32", "committedDate": "2020-07-23T02:20:01Z", "message": "address hdmi setting"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDU1MjU4NjMy", "url": "https://github.com/jellyfin/jellyfin-androidtv/pull/524#pullrequestreview-455258632", "createdAt": "2020-07-25T03:54:27Z", "commit": {"oid": "c57454b3661e9557e419601ed37726087c831b32"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yNVQwMzo1NDoyN1rOG3CK9Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yNVQwMzo1NDoyN1rOG3CK9Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MDM2MDQzNw==", "bodyText": "Ah I think I follow now. This seems fine.\nShould we be calling \u2018mVlcPlayer.setAudioOutput(\"android_audiotrack\");\u2018 here like you do below?", "url": "https://github.com/jellyfin/jellyfin-androidtv/pull/524#discussion_r460360437", "createdAt": "2020-07-25T03:54:27Z", "author": {"login": "thornbill"}, "path": "app/src/main/java/org/jellyfin/androidtv/playback/MediaManager.java", "diffHunk": "@@ -227,8 +227,12 @@ public void onPlayerError(ExoPlaybackException error) {\n                 mLibVLC = new LibVLC(TvApp.getApplication(), options);\n \n                 mVlcPlayer = new org.videolan.libvlc.MediaPlayer(mLibVLC);\n-                mVlcPlayer.setAudioOutput(Utils.downMixAudio() ? \"opensles_android\" : \"android_audiotrack\");\n-                mVlcPlayer.setAudioOutputDevice(\"hdmi\");\n+                if(!Utils.downMixAudio()) {\n+                    mVlcPlayer.setAudioDigitalOutputEnabled(true);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1ODg0NTc3Mw=="}, "originalCommit": {"oid": "8c6050760ef62839ecaae4f85c5a8982575f4212"}, "originalPosition": 7}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "66d03cb48a6360d05caf62c44ac974110256bda0", "author": {"user": {"login": "thornbill", "name": "Bill Thornton"}}, "url": "https://github.com/jellyfin/jellyfin-androidtv/commit/66d03cb48a6360d05caf62c44ac974110256bda0", "committedDate": "2020-08-21T18:38:32Z", "message": "Add missing setAudioOutput call"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDcyNzE5ODY0", "url": "https://github.com/jellyfin/jellyfin-androidtv/pull/524#pullrequestreview-472719864", "createdAt": "2020-08-21T18:51:44Z", "commit": {"oid": "66d03cb48a6360d05caf62c44ac974110256bda0"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDcyNzMyMzk3", "url": "https://github.com/jellyfin/jellyfin-androidtv/pull/524#pullrequestreview-472732397", "createdAt": "2020-08-21T18:57:58Z", "commit": {"oid": "66d03cb48a6360d05caf62c44ac974110256bda0"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4161, "cost": 1, "resetAt": "2021-11-01T15:33:45Z"}}}