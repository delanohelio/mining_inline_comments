{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0MzgzMTg2NDI5", "number": 374, "reviewThreads": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wNFQyMDoyMTo0MlrODlMJlg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wNFQyMDoyMTo0MlrODlMJlg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjQwMzIyOTY2OnYy", "diffSide": "RIGHT", "path": "app/src/main/java/org/jellyfin/androidtv/base/AuthenticatedUserCallbacks.kt", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wNFQyMDoyMTo0MlrOFx8URg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wNVQxODo0MTozOFrOFyfWfQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NzkxMjc3NA==", "bodyText": "Would be nice if we could send the activity + bundle to the startup activity so it will re-open it after signing in. Not really necessary though.", "url": "https://github.com/jellyfin/jellyfin-androidtv/pull/374#discussion_r387912774", "createdAt": "2020-03-04T20:21:42Z", "author": {"login": "nielsvanvelzen"}, "path": "app/src/main/java/org/jellyfin/androidtv/base/AuthenticatedUserCallbacks.kt", "diffHunk": "@@ -0,0 +1,59 @@\n+package org.jellyfin.androidtv.base\n+\n+import android.app.Activity\n+import android.app.Application\n+import android.content.Intent\n+import android.os.Bundle\n+import android.util.Log\n+\n+import org.jellyfin.androidtv.TvApp\n+import org.jellyfin.androidtv.startup.DpadPwActivity\n+import org.jellyfin.androidtv.startup.SelectServerActivity\n+import org.jellyfin.androidtv.startup.SelectUserActivity\n+import org.jellyfin.androidtv.startup.StartupActivity\n+\n+private const val LOG_TAG = \"AuthUserCallbacks\"\n+\n+/**\n+ * ActivityLifecycleCallback that bounces to the StartupActivity if an Activity is created and\n+ * the currentUser is null.\n+ */\n+class AuthenticatedUserCallbacks : Application.ActivityLifecycleCallbacks {\n+\toverride fun onActivityPaused(activity: Activity) {\n+\t}\n+\n+\toverride fun onActivityStarted(activity: Activity) {\n+\t}\n+\n+\toverride fun onActivityDestroyed(activity: Activity) {\n+\t}\n+\n+\toverride fun onActivitySaveInstanceState(activity: Activity, bundle: Bundle) {\n+\t}\n+\n+\toverride fun onActivityStopped(activity: Activity) {\n+\t}\n+\n+\toverride fun onActivityCreated(activity: Activity, bundle: Bundle?) {\n+\t\twhen (activity) {\n+\t\t\t// Ignore startup activities\n+\t\t\tis DpadPwActivity,\n+\t\t\tis SelectServerActivity,\n+\t\t\tis SelectUserActivity,\n+\t\t\tis StartupActivity -> return\n+\t\t\t// All other activities should have a current user\n+\t\t\telse -> {\n+\t\t\t\tTvApp.getApplication().apply {\n+\t\t\t\t\tif (currentUser == null) {\n+\t\t\t\t\t\tLog.w(LOG_TAG, \"Current user is null, bouncing to StartupActivity\")\n+\t\t\t\t\t\tactivity.startActivity(Intent(this, StartupActivity::class.java))", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "bf4d8b895d833009c88dc6f80f27c812d9ded2f6"}, "originalPosition": 49}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4ODQ4Njc4MQ==", "bodyText": "We decided to not do this right now", "url": "https://github.com/jellyfin/jellyfin-androidtv/pull/374#discussion_r388486781", "createdAt": "2020-03-05T18:41:38Z", "author": {"login": "nielsvanvelzen"}, "path": "app/src/main/java/org/jellyfin/androidtv/base/AuthenticatedUserCallbacks.kt", "diffHunk": "@@ -0,0 +1,59 @@\n+package org.jellyfin.androidtv.base\n+\n+import android.app.Activity\n+import android.app.Application\n+import android.content.Intent\n+import android.os.Bundle\n+import android.util.Log\n+\n+import org.jellyfin.androidtv.TvApp\n+import org.jellyfin.androidtv.startup.DpadPwActivity\n+import org.jellyfin.androidtv.startup.SelectServerActivity\n+import org.jellyfin.androidtv.startup.SelectUserActivity\n+import org.jellyfin.androidtv.startup.StartupActivity\n+\n+private const val LOG_TAG = \"AuthUserCallbacks\"\n+\n+/**\n+ * ActivityLifecycleCallback that bounces to the StartupActivity if an Activity is created and\n+ * the currentUser is null.\n+ */\n+class AuthenticatedUserCallbacks : Application.ActivityLifecycleCallbacks {\n+\toverride fun onActivityPaused(activity: Activity) {\n+\t}\n+\n+\toverride fun onActivityStarted(activity: Activity) {\n+\t}\n+\n+\toverride fun onActivityDestroyed(activity: Activity) {\n+\t}\n+\n+\toverride fun onActivitySaveInstanceState(activity: Activity, bundle: Bundle) {\n+\t}\n+\n+\toverride fun onActivityStopped(activity: Activity) {\n+\t}\n+\n+\toverride fun onActivityCreated(activity: Activity, bundle: Bundle?) {\n+\t\twhen (activity) {\n+\t\t\t// Ignore startup activities\n+\t\t\tis DpadPwActivity,\n+\t\t\tis SelectServerActivity,\n+\t\t\tis SelectUserActivity,\n+\t\t\tis StartupActivity -> return\n+\t\t\t// All other activities should have a current user\n+\t\t\telse -> {\n+\t\t\t\tTvApp.getApplication().apply {\n+\t\t\t\t\tif (currentUser == null) {\n+\t\t\t\t\t\tLog.w(LOG_TAG, \"Current user is null, bouncing to StartupActivity\")\n+\t\t\t\t\t\tactivity.startActivity(Intent(this, StartupActivity::class.java))", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NzkxMjc3NA=="}, "originalCommit": {"oid": "bf4d8b895d833009c88dc6f80f27c812d9ded2f6"}, "originalPosition": 49}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1035, "cost": 1, "resetAt": "2021-11-12T19:05:54Z"}}}