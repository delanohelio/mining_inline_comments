{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0Mzc2MzI3MzU4", "number": 347, "title": "Remaining actions for movie details", "bodyText": "", "createdAt": "2020-02-17T21:54:40Z", "url": "https://github.com/jellyfin/jellyfin-androidtv/pull/347", "merged": true, "mergeCommit": {"oid": "8b3e386cb7e22c32e4d62c80f3de2f83a9cf1477"}, "closed": true, "closedAt": "2020-02-19T08:10:38Z", "author": {"login": "AndreasGB"}, "timelineItems": {"totalCount": 9, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcFUFu6AH2gAyMzc2MzI3MzU4OjU3ZjlkYThlN2MxNmNjZDc5OGNhYjdkNTlkOTQ4YzM2ODUxNWJjNGE=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcFx_mNgFqTM2MDkwNzgyNQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "57f9da8e7c16ccd798cab7d59d948c368515bc4a", "author": {"user": {"login": "AndreasGB", "name": "Andreas"}}, "url": "https://github.com/jellyfin/jellyfin-androidtv/commit/57f9da8e7c16ccd798cab7d59d948c368515bc4a", "committedDate": "2020-02-17T21:20:04Z", "message": "Implement DeleteAction as well as SecondaryPopupAction"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e6dce196775e8497286458b470dbcd6b5ffd13d3", "author": {"user": {"login": "AndreasGB", "name": "Andreas"}}, "url": "https://github.com/jellyfin/jellyfin-androidtv/commit/e6dce196775e8497286458b470dbcd6b5ffd13d3", "committedDate": "2020-02-17T21:49:49Z", "message": "AddToQueue Action implemented + Refactoring"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzU5OTg3NzU0", "url": "https://github.com/jellyfin/jellyfin-androidtv/pull/347#pullrequestreview-359987754", "createdAt": "2020-02-17T22:23:54Z", "commit": {"oid": "e6dce196775e8497286458b470dbcd6b5ffd13d3"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 7, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xN1QyMjoyMzo1NFrOFqwzkg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xN1QyMjoyOToxOVrOFqw4Kg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MDM4NDE0Ng==", "bodyText": "I think you meant comment AddToQueueAction", "url": "https://github.com/jellyfin/jellyfin-androidtv/pull/347#discussion_r380384146", "createdAt": "2020-02-17T22:23:54Z", "author": {"login": "nielsvanvelzen"}, "path": "app/src/main/java/org/jellyfin/androidtv/details/MovieDetailsFragment.kt", "diffHunk": "@@ -49,12 +48,17 @@ class MovieDetailsFragment(item: Movie) : BaseDetailsFragment<Movie>(item) {\n \t\t(detailsRow.actionsAdapter as ActionAdapter).apply {\n \t\t\treset()\n \n-\t\t\tif (item.canResume) add(ResumeAction(context!!, item).apply { icon = context!!.getDrawable(R.drawable.ic_resume) })\n-\n-\t\t\tadd(PlayFromBeginningAction(context!!, item).apply { icon = context!!.getDrawable(R.drawable.ic_play) })\n-\t\t\tadd(ToggleWatchedAction(context!!, item).apply { icon = context!!.getDrawable(R.drawable.ic_watch) })\n-\t\t\tadd(ToggleFavoriteAction(context!!, item).apply { icon = context!!.getDrawable(R.drawable.ic_heart) })\n-\t\t\tadd(Action(0, \"More\").apply { icon = context!!.getDrawable(R.drawable.ic_more) }) // Show menu with more options\n+\t\t\tif (item.canResume) add(ResumeAction(context!!, item))\n+\t\t\tadd(PlayFromBeginningAction(context!!, item))\n+\t\t\t// TODO: Bring this back once we have a more understandable queue implementation for users\n+\t\t\t//add(ToggleWatchedAction(context!!, item))", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e6dce196775e8497286458b470dbcd6b5ffd13d3"}, "originalPosition": 21}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MDM4NDI0MA==", "bodyText": "This one depends on the permissions of the authenticated user", "url": "https://github.com/jellyfin/jellyfin-androidtv/pull/347#discussion_r380384240", "createdAt": "2020-02-17T22:24:22Z", "author": {"login": "nielsvanvelzen"}, "path": "app/src/main/java/org/jellyfin/androidtv/details/MovieDetailsFragment.kt", "diffHunk": "@@ -49,12 +48,17 @@ class MovieDetailsFragment(item: Movie) : BaseDetailsFragment<Movie>(item) {\n \t\t(detailsRow.actionsAdapter as ActionAdapter).apply {\n \t\t\treset()\n \n-\t\t\tif (item.canResume) add(ResumeAction(context!!, item).apply { icon = context!!.getDrawable(R.drawable.ic_resume) })\n-\n-\t\t\tadd(PlayFromBeginningAction(context!!, item).apply { icon = context!!.getDrawable(R.drawable.ic_play) })\n-\t\t\tadd(ToggleWatchedAction(context!!, item).apply { icon = context!!.getDrawable(R.drawable.ic_watch) })\n-\t\t\tadd(ToggleFavoriteAction(context!!, item).apply { icon = context!!.getDrawable(R.drawable.ic_heart) })\n-\t\t\tadd(Action(0, \"More\").apply { icon = context!!.getDrawable(R.drawable.ic_more) }) // Show menu with more options\n+\t\t\tif (item.canResume) add(ResumeAction(context!!, item))\n+\t\t\tadd(PlayFromBeginningAction(context!!, item))\n+\t\t\t// TODO: Bring this back once we have a more understandable queue implementation for users\n+\t\t\t//add(ToggleWatchedAction(context!!, item))\n+\t\t\tadd(ToggleFavoriteAction(context!!, item))\n+\t\t\tadd(AddToQueueAction(context!!, item))\n+\n+\t\t\t// Menu with more actions\n+\t\t\tadd(SecondariesPopupAction(context!!).apply {\n+\t\t\t\tadd(DeleteAction(context!!, item) { activity?.finish() })", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e6dce196775e8497286458b470dbcd6b5ffd13d3"}, "originalPosition": 27}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MDM4NDgxOA==", "bodyText": "Just use Toast.makeText(context, text, length).show() instead of a util function for a one-liner.", "url": "https://github.com/jellyfin/jellyfin-androidtv/pull/347#discussion_r380384818", "createdAt": "2020-02-17T22:27:08Z", "author": {"login": "nielsvanvelzen"}, "path": "app/src/main/java/org/jellyfin/androidtv/details/actions/DeleteAction.kt", "diffHunk": "@@ -0,0 +1,47 @@\n+package org.jellyfin.androidtv.details.actions\n+\n+import android.app.AlertDialog\n+import android.content.Context\n+import android.content.DialogInterface.BUTTON_NEGATIVE\n+import org.jellyfin.androidtv.R\n+import org.jellyfin.androidtv.TvApp\n+import org.jellyfin.androidtv.model.itemtypes.BaseItem\n+import org.jellyfin.androidtv.util.DelayedMessage\n+import org.jellyfin.androidtv.util.Utils\n+import org.jellyfin.apiclient.interaction.EmptyResponse\n+\n+class DeleteAction(context: Context, private val item: BaseItem, private val onItemDeleted: () -> Unit) : BaseAction(ActionID.DELETE.id, context) {\n+\n+\tinit {\n+\t\tlabel1 = context.getString(R.string.lbl_delete)\n+\t\ticon = context.getDrawable(R.drawable.ic_trash)\n+\t}\n+\n+\toverride fun onClick() {\n+\t\tAlertDialog.Builder(context).apply {\n+\t\t\tsetIcon(R.drawable.ic_trash)\n+\t\t\tsetTitle(R.string.lbl_really_delete_item_title)\n+\t\t\tsetMessage(context.getString(R.string.lbl_item_deletion_warning, item.title))\n+\t\t\tsetPositiveButton(R.string.lbl_delete) { _, _ ->\n+\t\t\t\tval msg = DelayedMessage(context, 150)\n+\t\t\t\tTvApp.getApplication().apiClient.DeleteItem(item.id, object : EmptyResponse() {\n+\t\t\t\t\toverride fun onResponse() {\n+\t\t\t\t\t\tmsg.Cancel()\n+\t\t\t\t\t\tUtils.showToast(context, context.getString(R.string.lbl_item_deleted, item.title))\n+\t\t\t\t\t\tTvApp.getApplication().lastDeletedItemId = item.id\n+\t\t\t\t\t\tonItemDeleted()\n+\t\t\t\t\t}\n+\n+\t\t\t\t\toverride fun onError(ex: Exception) {\n+\t\t\t\t\t\tmsg.Cancel()\n+\t\t\t\t\t\tTvApp.getApplication().logger.ErrorException(\"Failed to delete item %s\", ex, item.title)\n+\t\t\t\t\t\tUtils.showToast(context, ex.localizedMessage)\n+\t\t\t\t\t}\n+\t\t\t\t})\n+\t\t\t}\n+\t\t\tsetNegativeButton(context.getText(R.string.lbl_cancel)) { dialog, which -> Utils.showToast(context, R.string.lbl_item_not_deleted) }", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e6dce196775e8497286458b470dbcd6b5ffd13d3"}, "originalPosition": 42}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MDM4NDgzOQ==", "bodyText": "Just use Toast.makeText(context, text, length).show() instead of a util function for a one-liner.", "url": "https://github.com/jellyfin/jellyfin-androidtv/pull/347#discussion_r380384839", "createdAt": "2020-02-17T22:27:15Z", "author": {"login": "nielsvanvelzen"}, "path": "app/src/main/java/org/jellyfin/androidtv/details/actions/DeleteAction.kt", "diffHunk": "@@ -0,0 +1,47 @@\n+package org.jellyfin.androidtv.details.actions\n+\n+import android.app.AlertDialog\n+import android.content.Context\n+import android.content.DialogInterface.BUTTON_NEGATIVE\n+import org.jellyfin.androidtv.R\n+import org.jellyfin.androidtv.TvApp\n+import org.jellyfin.androidtv.model.itemtypes.BaseItem\n+import org.jellyfin.androidtv.util.DelayedMessage\n+import org.jellyfin.androidtv.util.Utils\n+import org.jellyfin.apiclient.interaction.EmptyResponse\n+\n+class DeleteAction(context: Context, private val item: BaseItem, private val onItemDeleted: () -> Unit) : BaseAction(ActionID.DELETE.id, context) {\n+\n+\tinit {\n+\t\tlabel1 = context.getString(R.string.lbl_delete)\n+\t\ticon = context.getDrawable(R.drawable.ic_trash)\n+\t}\n+\n+\toverride fun onClick() {\n+\t\tAlertDialog.Builder(context).apply {\n+\t\t\tsetIcon(R.drawable.ic_trash)\n+\t\t\tsetTitle(R.string.lbl_really_delete_item_title)\n+\t\t\tsetMessage(context.getString(R.string.lbl_item_deletion_warning, item.title))\n+\t\t\tsetPositiveButton(R.string.lbl_delete) { _, _ ->\n+\t\t\t\tval msg = DelayedMessage(context, 150)\n+\t\t\t\tTvApp.getApplication().apiClient.DeleteItem(item.id, object : EmptyResponse() {\n+\t\t\t\t\toverride fun onResponse() {\n+\t\t\t\t\t\tmsg.Cancel()\n+\t\t\t\t\t\tUtils.showToast(context, context.getString(R.string.lbl_item_deleted, item.title))", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e6dce196775e8497286458b470dbcd6b5ffd13d3"}, "originalPosition": 30}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MDM4NDkwOA==", "bodyText": "Just use Toast.makeText(context, text, length).show() instead of a util function for a one-liner.", "url": "https://github.com/jellyfin/jellyfin-androidtv/pull/347#discussion_r380384908", "createdAt": "2020-02-17T22:27:32Z", "author": {"login": "nielsvanvelzen"}, "path": "app/src/main/java/org/jellyfin/androidtv/details/actions/DeleteAction.kt", "diffHunk": "@@ -0,0 +1,47 @@\n+package org.jellyfin.androidtv.details.actions\n+\n+import android.app.AlertDialog\n+import android.content.Context\n+import android.content.DialogInterface.BUTTON_NEGATIVE\n+import org.jellyfin.androidtv.R\n+import org.jellyfin.androidtv.TvApp\n+import org.jellyfin.androidtv.model.itemtypes.BaseItem\n+import org.jellyfin.androidtv.util.DelayedMessage\n+import org.jellyfin.androidtv.util.Utils\n+import org.jellyfin.apiclient.interaction.EmptyResponse\n+\n+class DeleteAction(context: Context, private val item: BaseItem, private val onItemDeleted: () -> Unit) : BaseAction(ActionID.DELETE.id, context) {\n+\n+\tinit {\n+\t\tlabel1 = context.getString(R.string.lbl_delete)\n+\t\ticon = context.getDrawable(R.drawable.ic_trash)\n+\t}\n+\n+\toverride fun onClick() {\n+\t\tAlertDialog.Builder(context).apply {\n+\t\t\tsetIcon(R.drawable.ic_trash)\n+\t\t\tsetTitle(R.string.lbl_really_delete_item_title)\n+\t\t\tsetMessage(context.getString(R.string.lbl_item_deletion_warning, item.title))\n+\t\t\tsetPositiveButton(R.string.lbl_delete) { _, _ ->\n+\t\t\t\tval msg = DelayedMessage(context, 150)\n+\t\t\t\tTvApp.getApplication().apiClient.DeleteItem(item.id, object : EmptyResponse() {\n+\t\t\t\t\toverride fun onResponse() {\n+\t\t\t\t\t\tmsg.Cancel()\n+\t\t\t\t\t\tUtils.showToast(context, context.getString(R.string.lbl_item_deleted, item.title))\n+\t\t\t\t\t\tTvApp.getApplication().lastDeletedItemId = item.id\n+\t\t\t\t\t\tonItemDeleted()\n+\t\t\t\t\t}\n+\n+\t\t\t\t\toverride fun onError(ex: Exception) {\n+\t\t\t\t\t\tmsg.Cancel()\n+\t\t\t\t\t\tTvApp.getApplication().logger.ErrorException(\"Failed to delete item %s\", ex, item.title)\n+\t\t\t\t\t\tUtils.showToast(context, ex.localizedMessage)", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e6dce196775e8497286458b470dbcd6b5ffd13d3"}, "originalPosition": 38}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MDM4NDk0OA==", "bodyText": "It doesn't look like this is used?", "url": "https://github.com/jellyfin/jellyfin-androidtv/pull/347#discussion_r380384948", "createdAt": "2020-02-17T22:27:44Z", "author": {"login": "nielsvanvelzen"}, "path": "app/src/main/java/org/jellyfin/androidtv/details/actions/DeleteAction.kt", "diffHunk": "@@ -0,0 +1,47 @@\n+package org.jellyfin.androidtv.details.actions\n+\n+import android.app.AlertDialog\n+import android.content.Context\n+import android.content.DialogInterface.BUTTON_NEGATIVE\n+import org.jellyfin.androidtv.R\n+import org.jellyfin.androidtv.TvApp\n+import org.jellyfin.androidtv.model.itemtypes.BaseItem\n+import org.jellyfin.androidtv.util.DelayedMessage\n+import org.jellyfin.androidtv.util.Utils\n+import org.jellyfin.apiclient.interaction.EmptyResponse\n+\n+class DeleteAction(context: Context, private val item: BaseItem, private val onItemDeleted: () -> Unit) : BaseAction(ActionID.DELETE.id, context) {\n+\n+\tinit {\n+\t\tlabel1 = context.getString(R.string.lbl_delete)\n+\t\ticon = context.getDrawable(R.drawable.ic_trash)\n+\t}\n+\n+\toverride fun onClick() {\n+\t\tAlertDialog.Builder(context).apply {\n+\t\t\tsetIcon(R.drawable.ic_trash)\n+\t\t\tsetTitle(R.string.lbl_really_delete_item_title)\n+\t\t\tsetMessage(context.getString(R.string.lbl_item_deletion_warning, item.title))\n+\t\t\tsetPositiveButton(R.string.lbl_delete) { _, _ ->\n+\t\t\t\tval msg = DelayedMessage(context, 150)", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e6dce196775e8497286458b470dbcd6b5ffd13d3"}, "originalPosition": 26}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MDM4NTMyMg==", "bodyText": "Can we add icons to the menu too?", "url": "https://github.com/jellyfin/jellyfin-androidtv/pull/347#discussion_r380385322", "createdAt": "2020-02-17T22:29:19Z", "author": {"login": "nielsvanvelzen"}, "path": "app/src/main/java/org/jellyfin/androidtv/details/actions/SecondariesPopupAction.kt", "diffHunk": "@@ -0,0 +1,37 @@\n+package org.jellyfin.androidtv.details.actions\n+\n+import android.content.Context\n+import android.view.View\n+import android.widget.PopupMenu\n+import org.jellyfin.androidtv.R\n+\n+class SecondariesPopupAction(context: Context) : BaseAction(ActionID.SECONDARIES_ACTION_POPUP.id, context) {\n+\tprivate val containedActions = mutableListOf<BaseAction>()\n+\tvar anchor: View? = null\n+\n+\tinit {\n+\t\tlabel1 = context.getString(R.string.lbl_more_actions)\n+\t\ticon = context.getDrawable(R.drawable.ic_more)\n+\t}\n+\n+\tfun add(toAdd: BaseAction) {\n+\t\tcontainedActions.add(toAdd)\n+\t}\n+\n+\tfun remove(toRemove: BaseAction) {\n+\t\tcontainedActions.remove(toRemove)\n+\t}\n+\n+\toverride fun onClick() {\n+\t\tval menu = PopupMenu(context, anchor)\n+\t\tcontainedActions.forEach { action ->\n+\t\t\tval item = menu.menu.add(action.label1)", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e6dce196775e8497286458b470dbcd6b5ffd13d3"}, "originalPosition": 28}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f9729308e4d608690055f4b9ed87e2c592fe2ffa", "author": {"user": {"login": "AndreasGB", "name": "Andreas"}}, "url": "https://github.com/jellyfin/jellyfin-androidtv/commit/f9729308e4d608690055f4b9ed87e2c592fe2ffa", "committedDate": "2020-02-17T23:16:19Z", "message": "Address Code Review"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzYwMTQ2NDE0", "url": "https://github.com/jellyfin/jellyfin-androidtv/pull/347#pullrequestreview-360146414", "createdAt": "2020-02-18T08:32:42Z", "commit": {"oid": "f9729308e4d608690055f4b9ed87e2c592fe2ffa"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xOFQwODozMjo0MlrOFq5LSQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xOFQwODozMjo0MlrOFq5LSQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MDUyMTI4OQ==", "bodyText": "This if statement should be for the DeleteAction only. I imagine you did it this way to the popup button wouldn't show when there's no items but we need to fix that in another way.\n\nExtend action with a isvisible property or something similar\nimplement it for secondariespopupaction and check if the amount if children >= 1\nWhen showing the actions, look if it's visible\nthat's it", "url": "https://github.com/jellyfin/jellyfin-androidtv/pull/347#discussion_r380521289", "createdAt": "2020-02-18T08:32:42Z", "author": {"login": "nielsvanvelzen"}, "path": "app/src/main/java/org/jellyfin/androidtv/details/MovieDetailsFragment.kt", "diffHunk": "@@ -50,15 +50,17 @@ class MovieDetailsFragment(item: Movie) : BaseDetailsFragment<Movie>(item) {\n \n \t\t\tif (item.canResume) add(ResumeAction(context!!, item))\n \t\t\tadd(PlayFromBeginningAction(context!!, item))\n-\t\t\t// TODO: Bring this back once we have a more understandable queue implementation for users\n-\t\t\t//add(ToggleWatchedAction(context!!, item))\n+\t\t\tadd(ToggleWatchedAction(context!!, item))\n \t\t\tadd(ToggleFavoriteAction(context!!, item))\n-\t\t\tadd(AddToQueueAction(context!!, item))\n+\t\t\t// TODO: Bring this back once we have a more understandable queue implementation for users\n+\t\t\t//add(AddToQueueAction(context!!, item))\n \n \t\t\t// Menu with more actions\n-\t\t\tadd(SecondariesPopupAction(context!!).apply {\n-\t\t\t\tadd(DeleteAction(context!!, item) { activity?.finish() })\n-\t\t\t})\n+\t\t\tif (TvApp.getApplication().currentUser.policy.enableContentDeletion) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f9729308e4d608690055f4b9ed87e2c592fe2ffa"}, "originalPosition": 16}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "1346b3299b181c8a3cf823281b5430d44abe6ecc", "author": {"user": {"login": "AndreasGB", "name": "Andreas"}}, "url": "https://github.com/jellyfin/jellyfin-androidtv/commit/1346b3299b181c8a3cf823281b5430d44abe6ecc", "committedDate": "2020-02-18T12:49:08Z", "message": "Add isVisible property to actions"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzYwMzQwNDE4", "url": "https://github.com/jellyfin/jellyfin-androidtv/pull/347#pullrequestreview-360340418", "createdAt": "2020-02-18T13:35:52Z", "commit": {"oid": "1346b3299b181c8a3cf823281b5430d44abe6ecc"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xOFQxMzozNTo1MlrOFrCg4w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xOFQxMzozNTo1MlrOFrCg4w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MDY3NDI3NQ==", "bodyText": "containedActions.filter { it.isVisible }.forEach {", "url": "https://github.com/jellyfin/jellyfin-androidtv/pull/347#discussion_r380674275", "createdAt": "2020-02-18T13:35:52Z", "author": {"login": "nielsvanvelzen"}, "path": "app/src/main/java/org/jellyfin/androidtv/details/actions/SecondariesPopupAction.kt", "diffHunk": "@@ -9,26 +9,37 @@ class SecondariesPopupAction(context: Context) : BaseAction(ActionID.SECONDARIES\n \tprivate val containedActions = mutableListOf<BaseAction>()\n \tvar anchor: View? = null\n \n+\tprivate fun recomputeVisibility() {\n+\t\tisVisible = containedActions.any { action -> action.isVisible }\n+\t}\n+\n \tinit {\n \t\tlabel1 = context.getString(R.string.lbl_more_actions)\n \t\ticon = context.getDrawable(R.drawable.ic_more)\n \t}\n \n \tfun add(toAdd: BaseAction) {\n+\t\ttoAdd.onVisibilityChanged = ::recomputeVisibility\n \t\tcontainedActions.add(toAdd)\n+\t\trecomputeVisibility()\n \t}\n \n \tfun remove(toRemove: BaseAction) {\n+\t\tif (toRemove.onVisibilityChanged == ::recomputeVisibility) toRemove.onVisibilityChanged = null\n \t\tcontainedActions.remove(toRemove)\n+\t\trecomputeVisibility()\n \t}\n \n \toverride fun onClick() {\n \t\tval menu = PopupMenu(context, anchor)\n \t\tcontainedActions.forEach { action ->", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "1346b3299b181c8a3cf823281b5430d44abe6ecc"}, "originalPosition": 27}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "daf2127863a11e5a80fd805d15ac33ba9b377ddf", "author": {"user": {"login": "AndreasGB", "name": "Andreas"}}, "url": "https://github.com/jellyfin/jellyfin-androidtv/commit/daf2127863a11e5a80fd805d15ac33ba9b377ddf", "committedDate": "2020-02-18T22:57:00Z", "message": "Tiny beautification"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzYwOTA3ODI1", "url": "https://github.com/jellyfin/jellyfin-androidtv/pull/347#pullrequestreview-360907825", "createdAt": "2020-02-19T08:10:31Z", "commit": {"oid": "daf2127863a11e5a80fd805d15ac33ba9b377ddf"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4271, "cost": 1, "resetAt": "2021-11-01T15:33:45Z"}}}