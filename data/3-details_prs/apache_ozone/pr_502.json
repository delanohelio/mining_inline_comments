{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0MzY4NzA4Mjg2", "number": 502, "title": "HDDS-2955. Unnecessary log messages in DBStoreBuilder", "bodyText": "What changes were proposed in this pull request?\n\nReduce log level of \"using default/custom profile ...\" messages to debug.\nAvoid logging both \"default\" and \"custom\" for the same table by refactoring the code.\nAdd constant for String version of DEFAULT_COLUMN_FAMILY.\n\nhttps://issues.apache.org/jira/browse/HDDS-2955\nHow was this patch tested?\nVerified log in compose cluster.\nwith default info level:\nrecon_1     | 2020-01-29 17:14:39,085 [pool-8-thread-1] INFO impl.OzoneManagerServiceProviderImpl: Got new checkpoint from OM : /data/metadata/recon/om.snapshot.db_1580318078998\nrecon_1     | 2020-01-29 17:14:39,085 [pool-8-thread-1] INFO recovery.ReconOmMetadataManagerImpl: Cleaning up old OM snapshot db at /data/metadata/recon/om.snapshot.db_1580317479076.\nrecon_1     | 2020-01-29 17:14:39,231 [pool-8-thread-1] INFO recovery.ReconOmMetadataManagerImpl: Created OM DB handle from snapshot at /data/metadata/recon/om.snapshot.db_1580318078998.\n\nand with debug level:\nrecon_1     | 2020-01-29 17:00:12,434 [pool-8-thread-1] INFO impl.OzoneManagerServiceProviderImpl: Got new checkpoint from OM : /data/metadata/recon/om.snapshot.db_1580317212331\nrecon_1     | 2020-01-29 17:00:12,434 [pool-8-thread-1] INFO recovery.ReconOmMetadataManagerImpl: Cleaning up old OM snapshot db at /data/metadata/recon/om.snapshot.db_1580316612245.\nrecon_1     | 2020-01-29 17:00:12,438 [pool-8-thread-1] DEBUG db.DBStoreBuilder: default profile:DBProfile.DISK\nrecon_1     | 2020-01-29 17:00:12,438 [pool-8-thread-1] DEBUG db.DBStoreBuilder: using default profile for table:userTable\nrecon_1     | 2020-01-29 17:00:12,442 [pool-8-thread-1] DEBUG db.DBStoreBuilder: using default profile for table:volumeTable\nrecon_1     | 2020-01-29 17:00:12,442 [pool-8-thread-1] DEBUG db.DBStoreBuilder: using default profile for table:bucketTable\nrecon_1     | 2020-01-29 17:00:12,443 [pool-8-thread-1] DEBUG db.DBStoreBuilder: using default profile for table:keyTable\nrecon_1     | 2020-01-29 17:00:12,443 [pool-8-thread-1] DEBUG db.DBStoreBuilder: using default profile for table:deletedTable\nrecon_1     | 2020-01-29 17:00:12,443 [pool-8-thread-1] DEBUG db.DBStoreBuilder: using default profile for table:openKeyTable\nrecon_1     | 2020-01-29 17:00:12,444 [pool-8-thread-1] DEBUG db.DBStoreBuilder: using default profile for table:s3Table\nrecon_1     | 2020-01-29 17:00:12,444 [pool-8-thread-1] DEBUG db.DBStoreBuilder: using default profile for table:multipartInfoTable\nrecon_1     | 2020-01-29 17:00:12,444 [pool-8-thread-1] DEBUG db.DBStoreBuilder: using default profile for table:dTokenTable\nrecon_1     | 2020-01-29 17:00:12,445 [pool-8-thread-1] DEBUG db.DBStoreBuilder: using default profile for table:s3SecretTable\nrecon_1     | 2020-01-29 17:00:12,445 [pool-8-thread-1] DEBUG db.DBStoreBuilder: using default profile for table:prefixTable\nrecon_1     | 2020-01-29 17:00:12,447 [pool-8-thread-1] DEBUG db.DBStoreBuilder: using default profile for table:default\nrecon_1     | 2020-01-29 17:00:12,451 [pool-8-thread-1] DEBUG db.DBStoreBuilder: Using default options: DBProfile.DISK\nrecon_1     | 2020-01-29 17:00:12,561 [pool-8-thread-1] INFO recovery.ReconOmMetadataManagerImpl: Created OM DB handle from snapshot at /data/metadata/recon/om.snapshot.db_1580317212331.\n\nhttps://github.com/adoroszlai/hadoop-ozone/runs/415576820", "createdAt": "2020-01-29T18:42:42Z", "url": "https://github.com/apache/ozone/pull/502", "merged": true, "mergeCommit": {"oid": "f4fbc01e5fe7f74284eb64454b733501bb7ddf80"}, "closed": true, "closedAt": "2020-02-12T21:03:24Z", "author": {"login": "adoroszlai"}, "timelineItems": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABb_IghJgH2gAyMzY4NzA4Mjg2OmZjMDAwNDE4MjY5ODU3NDUyYzgyNDkzNWRkZjRiNjFlNjVmNTZhM2Q=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcDs2hlAFqTM1Nzc4NTAwMA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "fc000418269857452c824935ddf4b61e65f56a3d", "author": {"user": {"login": "adoroszlai", "name": "Doroszlai, Attila"}}, "url": "https://github.com/apache/ozone/commit/fc000418269857452c824935ddf4b61e65f56a3d", "committedDate": "2020-01-29T16:26:55Z", "message": "HDDS-2955. Unnecessary log messages in DBStoreBuilder"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzU0ODc0MjI5", "url": "https://github.com/apache/ozone/pull/502#pullrequestreview-354874229", "createdAt": "2020-02-07T00:57:18Z", "commit": {"oid": "fc000418269857452c824935ddf4b61e65f56a3d"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0wN1QwMDo1NzoxOFrOFmvSjg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0wN1QwMDo1NzoxOFrOFmvSjg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NjE2NTAwNg==", "bodyText": "Can we pass the dbProfile's name to addTable so that we can LOG the profile name inside addTable?", "url": "https://github.com/apache/ozone/pull/502#discussion_r376165006", "createdAt": "2020-02-07T00:57:18Z", "author": {"login": "xiaoyuyao"}, "path": "hadoop-hdds/common/src/main/java/org/apache/hadoop/hdds/utils/db/DBStoreBuilder.java", "diffHunk": "@@ -174,21 +184,16 @@ private void processDBProfile() {\n       dbProfile = this.configuration.getEnum(HDDS_DB_PROFILE,\n           HDDS_DEFAULT_DB_PROFILE);\n     }\n+    LOG.debug(\"default profile:{}\", dbProfile);\n   }\n \n   private void processTables() throws IOException {\n-    if (tableNames.size() > 0) {\n-      for (String name : tableNames) {\n-        addTable(name, dbProfile.getColumnFamilyOptions());\n-        LOG.info(\"Using default column profile:{} for Table:{}\",\n-            dbProfile.toString(), name);\n-      }\n+    List<String> list = new ArrayList<>(tableNames);\n+    list.add(DEFAULT_COLUMN_FAMILY_NAME);\n+    for (String name : list) {\n+      LOG.debug(\"using default profile for table:{}\", name);\n+      addTableDefinition(name, dbProfile.getColumnFamilyOptions());\n     }\n-    addTable(StringUtils.bytes2String(RocksDB.DEFAULT_COLUMN_FAMILY),", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "fc000418269857452c824935ddf4b61e65f56a3d"}, "originalPosition": 60}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzU0ODc0MzM0", "url": "https://github.com/apache/ozone/pull/502#pullrequestreview-354874334", "createdAt": "2020-02-07T00:57:40Z", "commit": {"oid": "fc000418269857452c824935ddf4b61e65f56a3d"}, "state": "COMMENTED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzU3Nzg1MDAw", "url": "https://github.com/apache/ozone/pull/502#pullrequestreview-357785000", "createdAt": "2020-02-12T21:03:14Z", "commit": {"oid": "fc000418269857452c824935ddf4b61e65f56a3d"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3779, "cost": 1, "resetAt": "2021-10-28T18:00:02Z"}}}