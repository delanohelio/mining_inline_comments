{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDQyMDA2Njg0", "number": 1149, "reviewThreads": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0wNlQyMDo0OTozOFrOEV_Okw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0wNlQyMToxMTo1MFrOEV_pBw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjkxNDkxNDc1OnYy", "diffSide": "LEFT", "path": "hadoop-ozone/dist/src/main/compose/ozone-om-ha/test_disabled.sh", "isResolved": false, "comments": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0wNlQyMDo0OTozOFrOG9DxxA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xMFQxNjoxNDoxMlrOG-Vurg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NjY3ODIxMg==", "bodyText": "These files are removed, I think this docker-compose is for testing for ratis log purge usecase.", "url": "https://github.com/apache/ozone/pull/1149#discussion_r466678212", "createdAt": "2020-08-06T20:49:38Z", "author": {"login": "bharatviswa504"}, "path": "hadoop-ozone/dist/src/main/compose/ozone-om-ha/test_disabled.sh", "diffHunk": "@@ -1,41 +0,0 @@\n-#!/usr/bin/env bash\n-# Licensed to the Apache Software Foundation (ASF) under one\n-# or more contributor license agreements.  See the NOTICE file\n-# distributed with this work for additional information\n-# regarding copyright ownership.  The ASF licenses this file\n-# to you under the Apache License, Version 2.0 (the\n-# \"License\"); you may not use this file except in compliance\n-# with the License.  You may obtain a copy of the License at\n-#", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "dfc07661a4b70a3159759b582b12ab72372404bf"}, "originalPosition": 9}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NzA1OTU5NA==", "bodyText": "Yes, and it's named as test_disabled.sh because it didn't work. As I wrote in the description, I suggested creating a simplified (but working) test and fix the purge use-case and restart use-case in a separated jira, following the pattern introduced by Attila for the upgrade test.\n\nozone-ha acceptance tests are turned off long time ago (it included some life-cycle test to start/stop services. In this patch I simplified the ha cluster and added simple smoketest.\n\n\nLater we can restore the lifecycle tests (start/stop) but I would prefer to use a generic approach for all the clusters.\n\nBut I am open to do anything with the tests (I can revert the changes, but in that case the change won't be covered), jut to commit this patch after 37 days and unblock the release.\nJust let me know what do you suggest.", "url": "https://github.com/apache/ozone/pull/1149#discussion_r467059594", "createdAt": "2020-08-07T14:01:00Z", "author": {"login": "elek"}, "path": "hadoop-ozone/dist/src/main/compose/ozone-om-ha/test_disabled.sh", "diffHunk": "@@ -1,41 +0,0 @@\n-#!/usr/bin/env bash\n-# Licensed to the Apache Software Foundation (ASF) under one\n-# or more contributor license agreements.  See the NOTICE file\n-# distributed with this work for additional information\n-# regarding copyright ownership.  The ASF licenses this file\n-# to you under the Apache License, Version 2.0 (the\n-# \"License\"); you may not use this file except in compliance\n-# with the License.  You may obtain a copy of the License at\n-#", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NjY3ODIxMg=="}, "originalCommit": {"oid": "dfc07661a4b70a3159759b582b12ab72372404bf"}, "originalPosition": 9}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NzE2MzgyNw==", "bodyText": "I am okay with it, if there is a cleaner approach to do and if it can be added in the new Jira.\ncc @hanishakoneru, any comments on removing this?", "url": "https://github.com/apache/ozone/pull/1149#discussion_r467163827", "createdAt": "2020-08-07T17:07:44Z", "author": {"login": "bharatviswa504"}, "path": "hadoop-ozone/dist/src/main/compose/ozone-om-ha/test_disabled.sh", "diffHunk": "@@ -1,41 +0,0 @@\n-#!/usr/bin/env bash\n-# Licensed to the Apache Software Foundation (ASF) under one\n-# or more contributor license agreements.  See the NOTICE file\n-# distributed with this work for additional information\n-# regarding copyright ownership.  The ASF licenses this file\n-# to you under the Apache License, Version 2.0 (the\n-# \"License\"); you may not use this file except in compliance\n-# with the License.  You may obtain a copy of the License at\n-#", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NjY3ODIxMg=="}, "originalCommit": {"oid": "dfc07661a4b70a3159759b582b12ab72372404bf"}, "originalPosition": 9}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NzQwNzY4MA==", "bodyText": "I think the tests which include restarts / failures can be separated and handled similar to the upgrade test. I think we can keep a simple om-ha (or ozone-ha) test which tests the functionality and collect all the lifecycle related tests (restart, kill dn/om services) in a separated place.\nWe need more tests there not only for HA but for normal servers, IMHO.", "url": "https://github.com/apache/ozone/pull/1149#discussion_r467407680", "createdAt": "2020-08-08T09:02:30Z", "author": {"login": "elek"}, "path": "hadoop-ozone/dist/src/main/compose/ozone-om-ha/test_disabled.sh", "diffHunk": "@@ -1,41 +0,0 @@\n-#!/usr/bin/env bash\n-# Licensed to the Apache Software Foundation (ASF) under one\n-# or more contributor license agreements.  See the NOTICE file\n-# distributed with this work for additional information\n-# regarding copyright ownership.  The ASF licenses this file\n-# to you under the Apache License, Version 2.0 (the\n-# \"License\"); you may not use this file except in compliance\n-# with the License.  You may obtain a copy of the License at\n-#", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NjY3ODIxMg=="}, "originalCommit": {"oid": "dfc07661a4b70a3159759b582b12ab72372404bf"}, "originalPosition": 9}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2ODAyMDkxMA==", "bodyText": "@elek sorry for jumping into the discussion late. I am working on fixing the robot tests for HA functionality (the old tests covering the restarts and failovers).\nInstead of removing those files altogether, can you create another dir for the new docker compose - ozone-ha-basic or something. Or rename the old compose dir to something else.\nAs for changing the life-cycle test to start/stop services, I am open to discuss a better approach. But I guess we can keep that for a different thread.\nThanks @bharatviswa504 for bringing it to my notice.", "url": "https://github.com/apache/ozone/pull/1149#discussion_r468020910", "createdAt": "2020-08-10T16:14:12Z", "author": {"login": "hanishakoneru"}, "path": "hadoop-ozone/dist/src/main/compose/ozone-om-ha/test_disabled.sh", "diffHunk": "@@ -1,41 +0,0 @@\n-#!/usr/bin/env bash\n-# Licensed to the Apache Software Foundation (ASF) under one\n-# or more contributor license agreements.  See the NOTICE file\n-# distributed with this work for additional information\n-# regarding copyright ownership.  The ASF licenses this file\n-# to you under the Apache License, Version 2.0 (the\n-# \"License\"); you may not use this file except in compliance\n-# with the License.  You may obtain a copy of the License at\n-#", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NjY3ODIxMg=="}, "originalCommit": {"oid": "dfc07661a4b70a3159759b582b12ab72372404bf"}, "originalPosition": 9}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjkxNDkxNjAyOnYy", "diffSide": "RIGHT", "path": "hadoop-hdds/test-utils/src/main/java/org/apache/hadoop/test/InMemoryConfiguration.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0wNlQyMDo0OTo1OVrOG9Dyig==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0wN1QxMzo1NDowNFrOG9aywA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NjY3ODQxMA==", "bodyText": "Is this change, related to this PR?", "url": "https://github.com/apache/ozone/pull/1149#discussion_r466678410", "createdAt": "2020-08-06T20:49:59Z", "author": {"login": "bharatviswa504"}, "path": "hadoop-hdds/test-utils/src/main/java/org/apache/hadoop/test/InMemoryConfiguration.java", "diffHunk": "@@ -0,0 +1,60 @@\n+/*\n+ * Licensed to the Apache Software Foundation (ASF) under one\n+ * or more contributor license agreements.  See the NOTICE file\n+ * distributed with this work for additional information\n+ * regarding copyright ownership.  The ASF licenses this file\n+ * to you under the Apache License, Version 2.0 (the\n+ * \"License\"); you may not use this file except in compliance\n+ * with the License.  You may obtain a copy of the License at\n+ * <p>\n+ * http://www.apache.org/licenses/LICENSE-2.0\n+ * <p>\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+package org.apache.hadoop.test;\n+\n+import java.io.IOException;\n+import java.util.Collection;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "dfc07661a4b70a3159759b582b12ab72372404bf"}, "originalPosition": 21}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NzA1NTI5Ng==", "bodyText": "Yes. It's introduced for the unit test which is mentioned before.\n\nUnfortunately it's harder to follow the logic here. I created a new unit test (TestOzoneAddressClientCreation). Which shows exactly this case.", "url": "https://github.com/apache/ozone/pull/1149#discussion_r467055296", "createdAt": "2020-08-07T13:54:04Z", "author": {"login": "elek"}, "path": "hadoop-hdds/test-utils/src/main/java/org/apache/hadoop/test/InMemoryConfiguration.java", "diffHunk": "@@ -0,0 +1,60 @@\n+/*\n+ * Licensed to the Apache Software Foundation (ASF) under one\n+ * or more contributor license agreements.  See the NOTICE file\n+ * distributed with this work for additional information\n+ * regarding copyright ownership.  The ASF licenses this file\n+ * to you under the Apache License, Version 2.0 (the\n+ * \"License\"); you may not use this file except in compliance\n+ * with the License.  You may obtain a copy of the License at\n+ * <p>\n+ * http://www.apache.org/licenses/LICENSE-2.0\n+ * <p>\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+package org.apache.hadoop.test;\n+\n+import java.io.IOException;\n+import java.util.Collection;", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NjY3ODQxMA=="}, "originalCommit": {"oid": "dfc07661a4b70a3159759b582b12ab72372404bf"}, "originalPosition": 21}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjkxNDkyNjc5OnYy", "diffSide": "RIGHT", "path": "hadoop-hdds/test-utils/src/main/java/org/apache/hadoop/test/InMemoryConfiguration.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0wNlQyMDo1MzoyNFrOG9D5Jg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0wNlQyMDo1MzoyNFrOG9D5Jg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NjY4MDEwMg==", "bodyText": "Minor. Extra \".\"", "url": "https://github.com/apache/ozone/pull/1149#discussion_r466680102", "createdAt": "2020-08-06T20:53:24Z", "author": {"login": "bharatviswa504"}, "path": "hadoop-hdds/test-utils/src/main/java/org/apache/hadoop/test/InMemoryConfiguration.java", "diffHunk": "@@ -0,0 +1,60 @@\n+/*\n+ * Licensed to the Apache Software Foundation (ASF) under one\n+ * or more contributor license agreements.  See the NOTICE file\n+ * distributed with this work for additional information\n+ * regarding copyright ownership.  The ASF licenses this file\n+ * to you under the Apache License, Version 2.0 (the\n+ * \"License\"); you may not use this file except in compliance\n+ * with the License.  You may obtain a copy of the License at\n+ * <p>\n+ * http://www.apache.org/licenses/LICENSE-2.0\n+ * <p>\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+package org.apache.hadoop.test;\n+\n+import java.io.IOException;\n+import java.util.Collection;\n+import java.util.HashMap;\n+import java.util.Map;\n+\n+import org.apache.hadoop.hdds.conf.MutableConfigurationSource;\n+\n+/**\n+ * In memory, mutable configuration source for testing..", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "dfc07661a4b70a3159759b582b12ab72372404bf"}, "originalPosition": 28}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjkxNDk4MjQ3OnYy", "diffSide": "RIGHT", "path": "hadoop-ozone/tools/src/main/java/org/apache/hadoop/ozone/shell/OzoneAddress.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0wNlQyMToxMTo1MFrOG9Ebag==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0wNlQyMToxMTo1MFrOG9Ebag==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NjY4ODg3NA==", "bodyText": "Minor: protected OzoneClient createRpcClient(ConfigurationSource conf) fits in a single line", "url": "https://github.com/apache/ozone/pull/1149#discussion_r466688874", "createdAt": "2020-08-06T21:11:50Z", "author": {"login": "bharatviswa504"}, "path": "hadoop-ozone/tools/src/main/java/org/apache/hadoop/ozone/shell/OzoneAddress.java", "diffHunk": "@@ -85,7 +89,34 @@ public OzoneAddress(String address)\n \n   }\n \n-  public OzoneClient createClient(OzoneConfiguration conf)\n+  @VisibleForTesting\n+  protected OzoneClient createRpcClient(", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "dfc07661a4b70a3159759b582b12ab72372404bf"}, "originalPosition": 37}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4150, "cost": 1, "resetAt": "2021-11-12T11:57:46Z"}}}