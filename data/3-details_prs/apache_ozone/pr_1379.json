{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDc4Mjg5MDE2", "number": 1379, "title": "HDDS-4199. Fix failed UT: TestOMAllocateBlockRequest#testValidateAndUpdateCache", "bodyText": "What changes were proposed in this pull request?\nWhat's the problem ?\n\nWhat's the reason ?\nwe can not make sure omKeyInfo.getCreationTime() different from  omKeyInfo.getModificationTime()\n\n\nthe creationTime was set in OmKeyInfo at TestOMRequestUtils.addKeyToTable -> OmKeyInfo#createOmKeyInfo\n\n\nthe modificationTime was set in KeyArgs at doPreExecute(createAllocateBlockRequest()) -> OMRequest#preExecute.\nAnd the KeyArgs.modificationTime was set in OmKeyInfo at omAllocateBlockRequest.validateAndUpdateCache -> openKeyInfo.setModificationTime.\n\n\nBetween doPreExecute(createAllocateBlockRequest()) and TestOMRequestUtils.addKeyToTable, there is no time consuming code, so we can not make sure the millisecond time is different.\n\n\nWhat is the link to the Apache JIRA\nhttps://issues.apache.org/jira/browse/HDDS-4199\nHow was this patch tested?\nno need new test.", "createdAt": "2020-09-03T01:49:46Z", "url": "https://github.com/apache/ozone/pull/1379", "merged": true, "mergeCommit": {"oid": "c8d533452e7765f63d48aa6a26621ec7d9d29b09"}, "closed": true, "closedAt": "2020-09-03T12:04:01Z", "author": {"login": "runzhiwang"}, "timelineItems": {"totalCount": 7, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdFGXcxAH2gAyNDc4Mjg5MDE2OmQwYTdkMGQyZGY2ZDRlZjY5YjRmZWRjNTc3YWMzMjY2MzEzN2U5NmE=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdFPJZnAFqTQ4MTc1NzIyOQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "d0a7d0d2df6d4ef69b4fedc577ac32663137e96a", "author": {"user": {"login": "runzhiwang", "name": null}}, "url": "https://github.com/apache/ozone/commit/d0a7d0d2df6d4ef69b4fedc577ac32663137e96a", "committedDate": "2020-09-03T01:31:54Z", "message": "HDDS-4199. Fix failed UT: TestOMAllocateBlockRequest#testValidateAndUpdateCache"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDgxNTEwMDg2", "url": "https://github.com/apache/ozone/pull/1379#pullrequestreview-481510086", "createdAt": "2020-09-03T05:50:18Z", "commit": {"oid": "0ab55674a19048bf0e08520ebcea4498cae8dadb"}, "state": "COMMENTED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "6812034f0571fd254eee881a96d23e46ec5d2450", "author": {"user": {"login": "runzhiwang", "name": null}}, "url": "https://github.com/apache/ozone/commit/6812034f0571fd254eee881a96d23e46ec5d2450", "committedDate": "2020-09-03T06:23:18Z", "message": "fix code review"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "0ab55674a19048bf0e08520ebcea4498cae8dadb", "author": {"user": {"login": "runzhiwang", "name": null}}, "url": "https://github.com/apache/ozone/commit/0ab55674a19048bf0e08520ebcea4498cae8dadb", "committedDate": "2020-09-03T02:33:05Z", "message": "triger ci"}, "afterCommit": {"oid": "6812034f0571fd254eee881a96d23e46ec5d2450", "author": {"user": {"login": "runzhiwang", "name": null}}, "url": "https://github.com/apache/ozone/commit/6812034f0571fd254eee881a96d23e46ec5d2450", "committedDate": "2020-09-03T06:23:18Z", "message": "fix code review"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDgxNTI2MDA5", "url": "https://github.com/apache/ozone/pull/1379#pullrequestreview-481526009", "createdAt": "2020-09-03T06:26:29Z", "commit": {"oid": "6812034f0571fd254eee881a96d23e46ec5d2450"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wM1QwNjoyNjozMFrOHMXn1A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wM1QwNjoyNjozMFrOHMXn1A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MjczMTk4OA==", "bodyText": "+1 LGTM!", "url": "https://github.com/apache/ozone/pull/1379#discussion_r482731988", "createdAt": "2020-09-03T06:26:30Z", "author": {"login": "amaliujia"}, "path": "hadoop-ozone/ozone-manager/src/test/java/org/apache/hadoop/ozone/om/request/key/TestOMAllocateBlockRequest.java", "diffHunk": "@@ -97,8 +95,11 @@ public void testValidateAndUpdateCache() throws Exception {\n     // Check modification time\n     Assert.assertEquals(modifiedOmRequest.getAllocateBlockRequest()\n         .getKeyArgs().getModificationTime(), omKeyInfo.getModificationTime());\n-    Assert.assertNotEquals(omKeyInfo.getCreationTime(),\n-        omKeyInfo.getModificationTime());\n+\n+    // creationTime was assigned at TestOMRequestUtils.addKeyToTable\n+    // modificationTime was assigned at doPreExecute(createAllocateBlockRequest())\n+    Assert.assertTrue(\n+        omKeyInfo.getCreationTime() <= omKeyInfo.getModificationTime());", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "6812034f0571fd254eee881a96d23e46ec5d2450"}, "originalPosition": 38}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "708023a1cec3be82e4a153bdf4c958729459203e", "author": {"user": {"login": "runzhiwang", "name": null}}, "url": "https://github.com/apache/ozone/commit/708023a1cec3be82e4a153bdf4c958729459203e", "committedDate": "2020-09-03T06:34:43Z", "message": "fix code style"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDgxNzU3MjI5", "url": "https://github.com/apache/ozone/pull/1379#pullrequestreview-481757229", "createdAt": "2020-09-03T11:45:42Z", "commit": {"oid": "708023a1cec3be82e4a153bdf4c958729459203e"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2426, "cost": 1, "resetAt": "2021-10-28T18:00:02Z"}}}