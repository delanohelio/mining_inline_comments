{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDMxODEzMzc5", "number": 1044, "title": "HDDS-3743. Avoid NetUtils#normalize when get DatanodeDetails from proto", "bodyText": "What changes were proposed in this pull request?\nNetUtils.normalize cost 0.17%, because it needs to do Matcher.replaceAll. It happen in the critical path, i.e. lookUpKey when read. we need not to do this when getFromProtoBuf, So we can avoid normalize by check the last character, if the last character is not /, we need not normalize.\n\nWhat is the link to the Apache JIRA\nhttps://issues.apache.org/jira/browse/HDDS-3743\nHow was this patch tested?\nExisted tests.", "createdAt": "2020-06-09T13:53:56Z", "url": "https://github.com/apache/ozone/pull/1044", "merged": true, "mergeCommit": {"oid": "d471e043d3baa85fb09a1f2c3f0f7d2f68478969"}, "closed": true, "closedAt": "2020-06-19T04:00:47Z", "author": {"login": "runzhiwang"}, "timelineItems": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcplZf9gH2gAyNDMxODEzMzc5OmZjMTUzMjY2ZmY5MmM3OTZkNGU3NWE3ZWY2MzIzYTJjMGU3MmY5MGM=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcrGPnpgH2gAyNDMxODEzMzc5OjE5YjAwZjVjYzdhNTcyZmM1ZjJiNDVkMmFmNzgxNGM3ZDFjZmRmMzU=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "fc153266ff92c796d4e75a7ef6323a2c0e72f90c", "author": {"user": {"login": "runzhiwang", "name": null}}, "url": "https://github.com/apache/ozone/commit/fc153266ff92c796d4e75a7ef6323a2c0e72f90c", "committedDate": "2020-06-09T13:51:19Z", "message": "HDDS-3743. Avoid NetUtils.normalize when get DatanodeDetails from proto"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "255453b98362b584620447ce16ff582b44f55a94", "author": {"user": {"login": "runzhiwang", "name": null}}, "url": "https://github.com/apache/ozone/commit/255453b98362b584620447ce16ff582b44f55a94", "committedDate": "2020-06-10T02:37:34Z", "message": "triger ci"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDI5MzkyNjEz", "url": "https://github.com/apache/ozone/pull/1044#pullrequestreview-429392613", "createdAt": "2020-06-12T00:44:46Z", "commit": {"oid": "255453b98362b584620447ce16ff582b44f55a94"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xMlQwMDo0NDo0NlrOGizh3w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xMlQwMDo0NDo0NlrOGizh3w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzOTE0OTAyMw==", "bodyText": "Can we simplified the logic without any matcher by using apache common StringUtils?\nreturn len == 1 ? path : StringUtils.removeEnd(path, \"/\");", "url": "https://github.com/apache/ozone/pull/1044#discussion_r439149023", "createdAt": "2020-06-12T00:44:46Z", "author": {"login": "xiaoyuyao"}, "path": "hadoop-hdds/common/src/main/java/org/apache/hadoop/hdds/scm/net/NetUtils.java", "diffHunk": "@@ -59,9 +64,12 @@ public static String normalize(String path) {\n               + NetConstants.PATH_SEPARATOR_STR + \": \" + path);\n     }\n \n+    if (len == 1 || path.charAt(len - 1) != NetConstants.PATH_SEPARATOR) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "255453b98362b584620447ce16ff582b44f55a94"}, "originalPosition": 18}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "ec020b2220f2dfe259c3fe70443139cf0e2f7cca", "author": {"user": {"login": "runzhiwang", "name": null}}, "url": "https://github.com/apache/ozone/commit/ec020b2220f2dfe259c3fe70443139cf0e2f7cca", "committedDate": "2020-06-14T06:32:55Z", "message": "fix code review"}, "afterCommit": {"oid": "19b00f5cc7a572fc5f2b45d2af7814c7d1cfdf35", "author": {"user": {"login": "runzhiwang", "name": null}}, "url": "https://github.com/apache/ozone/commit/19b00f5cc7a572fc5f2b45d2af7814c7d1cfdf35", "committedDate": "2020-06-14T06:41:19Z", "message": "fix code review"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "19b00f5cc7a572fc5f2b45d2af7814c7d1cfdf35", "author": {"user": {"login": "runzhiwang", "name": null}}, "url": "https://github.com/apache/ozone/commit/19b00f5cc7a572fc5f2b45d2af7814c7d1cfdf35", "committedDate": "2020-06-14T06:41:19Z", "message": "fix code review"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3164, "cost": 1, "resetAt": "2021-10-28T18:00:02Z"}}}