{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0Mzk3MTg3MzQ3", "number": 749, "reviewThreads": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wOFQwNDo0NjowMVrODv1KAQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wOFQwNDo0NjowMVrODv1KAQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjUxNDgwNTc3OnYy", "diffSide": "RIGHT", "path": "hadoop-hdds/server-scm/src/main/java/org/apache/hadoop/hdds/scm/pipeline/SimplePipelineProvider.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wOFQwNDo0NjowMVrOGCe1BQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xNlQxNjowMjoyN1rOGGsbSQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNTI1NTQyOQ==", "bodyText": "And also for Simple Pipeline Provider, we should not create pipeline with factor 3.\nThis is an existing issue, but when looking into this patch found it.", "url": "https://github.com/apache/ozone/pull/749#discussion_r405255429", "createdAt": "2020-04-08T04:46:01Z", "author": {"login": "bharatviswa504"}, "path": "hadoop-hdds/server-scm/src/main/java/org/apache/hadoop/hdds/scm/pipeline/SimplePipelineProvider.java", "diffHunk": "@@ -32,18 +31,18 @@\n /**\n  * Implements Api for creating stand alone pipelines.\n  */\n-public class SimplePipelineProvider implements PipelineProvider {\n+public class SimplePipelineProvider extends PipelineProvider {\n \n-  private final NodeManager nodeManager;\n-\n-  public SimplePipelineProvider(NodeManager nodeManager) {\n-    this.nodeManager = nodeManager;\n+  public SimplePipelineProvider(NodeManager nodeManager,\n+      PipelineStateManager stateManager) {\n+    super(nodeManager, stateManager);\n   }\n \n   @Override\n   public Pipeline create(ReplicationFactor factor) throws IOException {\n-    List<DatanodeDetails> dns =\n-        nodeManager.getNodes(NodeState.HEALTHY);\n+    List<DatanodeDetails> dns = pickNodesNeverUsed(ReplicationType.STAND_ALONE,", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d1ec432554f6050dd34d126133e76ee251a65422"}, "originalPosition": 28}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwOTY3MjUyMQ==", "bodyText": "Updated to create only factor ONE pipelines for StandAlone type.", "url": "https://github.com/apache/ozone/pull/749#discussion_r409672521", "createdAt": "2020-04-16T16:02:27Z", "author": {"login": "hanishakoneru"}, "path": "hadoop-hdds/server-scm/src/main/java/org/apache/hadoop/hdds/scm/pipeline/SimplePipelineProvider.java", "diffHunk": "@@ -32,18 +31,18 @@\n /**\n  * Implements Api for creating stand alone pipelines.\n  */\n-public class SimplePipelineProvider implements PipelineProvider {\n+public class SimplePipelineProvider extends PipelineProvider {\n \n-  private final NodeManager nodeManager;\n-\n-  public SimplePipelineProvider(NodeManager nodeManager) {\n-    this.nodeManager = nodeManager;\n+  public SimplePipelineProvider(NodeManager nodeManager,\n+      PipelineStateManager stateManager) {\n+    super(nodeManager, stateManager);\n   }\n \n   @Override\n   public Pipeline create(ReplicationFactor factor) throws IOException {\n-    List<DatanodeDetails> dns =\n-        nodeManager.getNodes(NodeState.HEALTHY);\n+    List<DatanodeDetails> dns = pickNodesNeverUsed(ReplicationType.STAND_ALONE,", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNTI1NTQyOQ=="}, "originalCommit": {"oid": "d1ec432554f6050dd34d126133e76ee251a65422"}, "originalPosition": 28}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4895, "cost": 1, "resetAt": "2021-11-12T11:57:46Z"}}}