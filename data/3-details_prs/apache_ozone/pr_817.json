{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDAyOTc2Mjgw", "number": 817, "title": "HDDS-3380. MiniOzoneHAClusterImpl#initOMRatisConf will reset the configs and causes for test failures\t", "bodyText": "\u2026igs and causes for test failures\nWhat changes were proposed in this pull request?\nMoved the configs settings only to required test class instead of silently resetting test modified configs. Also took liberty to change assertion from NOT_A_FILE to DIR_NOT_FOUND, which seems correct code.\nWhat is the link to the Apache JIRA\nhttps://issues.apache.org/jira/browse/HDDS-3380\nHow was this patch tested?\nRan the TestOzoneManagerHA tests. SnapShot test is passing after fixing resetting issue.", "createdAt": "2020-04-14T05:24:58Z", "url": "https://github.com/apache/ozone/pull/817", "merged": true, "mergeCommit": {"oid": "ce9488963f176262c642816d00e8a69f4c31afcd"}, "closed": true, "closedAt": "2020-04-21T06:45:29Z", "author": {"login": "umamaheswararao"}, "timelineItems": {"totalCount": 16, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcXcceVgH2gAyNDAyOTc2MjgwOjZjY2FlZWE1YjFjYmIxMmFmYWVhN2M1Y2U3ZGY5OGZiNjUxMGY5Nzc=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcZsuizgFqTM5Njk5NDA4OA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "6ccaeea5b1cbb12afaea7c5ce7df98fb6510f977", "author": {"user": {"login": "umamaheswararao", "name": "Uma Maheswara Rao G"}}, "url": "https://github.com/apache/ozone/commit/6ccaeea5b1cbb12afaea7c5ce7df98fb6510f977", "committedDate": "2020-04-14T05:14:47Z", "message": "HDDS-3380. MiniOzoneHAClusterImpl#initOMRatisConf will reset the configs and causes for test failures"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a081e9d9b1e707ba23f5f3721fa38d73a6be45cd", "author": {"user": {"login": "umamaheswararao", "name": "Uma Maheswara Rao G"}}, "url": "https://github.com/apache/ozone/commit/a081e9d9b1e707ba23f5f3721fa38d73a6be45cd", "committedDate": "2020-04-16T05:10:05Z", "message": "HDDS-3380. MiniOzoneHAClusterImpl#initOMRatisConf will reset the configs and causes for test failures"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "31e03b41c0b8fe1b5d183f84fd089a4e6db112f4", "author": {"user": {"login": "umamaheswararao", "name": "Uma Maheswara Rao G"}}, "url": "https://github.com/apache/ozone/commit/31e03b41c0b8fe1b5d183f84fd089a4e6db112f4", "committedDate": "2020-04-16T06:18:14Z", "message": "HDDS-3380. MiniOzoneHAClusterImpl#initOMRatisConf will reset the configs and causes for test failures"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f27adc51507d4d822e86cc29d524b844d8739665", "author": {"user": {"login": "umamaheswararao", "name": "Uma Maheswara Rao G"}}, "url": "https://github.com/apache/ozone/commit/f27adc51507d4d822e86cc29d524b844d8739665", "committedDate": "2020-04-20T23:40:11Z", "message": "HDDS-3380. MiniOzoneHAClusterImpl#initOMRatisConf will reset the configs and causes for test failures"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzk2OTI0ODgz", "url": "https://github.com/apache/ozone/pull/817#pullrequestreview-396924883", "createdAt": "2020-04-21T01:22:05Z", "commit": {"oid": "f27adc51507d4d822e86cc29d524b844d8739665"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yMVQwMToyMjowNVrOGIuRwA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yMVQwMToyMjowNVrOGIuRwA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMTgwMDAwMA==", "bodyText": "NIT: Remove    4qa  wq\"", "url": "https://github.com/apache/ozone/pull/817#discussion_r411800000", "createdAt": "2020-04-21T01:22:05Z", "author": {"login": "bharatviswa504"}, "path": "hadoop-ozone/integration-test/src/test/java/org/apache/hadoop/ozone/om/TestOzoneManagerHA.java", "diffHunk": "@@ -470,6 +468,7 @@ public void testCreateFile(OzoneBucket ozoneBucket, String keyName,\n     Assert.assertEquals(data, new String(fileContent));\n   }\n \n+  @Ignore(\"This test failing randomly and triggering HDDS-3465.     ` `4qa  wq\")", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f27adc51507d4d822e86cc29d524b844d8739665"}, "originalPosition": 31}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzk2OTI1Nzg3", "url": "https://github.com/apache/ozone/pull/817#pullrequestreview-396925787", "createdAt": "2020-04-21T01:24:54Z", "commit": {"oid": "f27adc51507d4d822e86cc29d524b844d8739665"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yMVQwMToyNDo1NFrOGIuVhQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yMVQwMToyNDo1NFrOGIuVhQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMTgwMDk2NQ==", "bodyText": "Minor NIT: Do not use *", "url": "https://github.com/apache/ozone/pull/817#discussion_r411800965", "createdAt": "2020-04-21T01:24:54Z", "author": {"login": "bharatviswa504"}, "path": "hadoop-ozone/integration-test/src/test/java/org/apache/hadoop/ozone/om/TestOzoneManagerHA.java", "diffHunk": "@@ -93,8 +93,7 @@\n     .OZONE_CLIENT_FAILOVER_SLEEP_BASE_MILLIS_DEFAULT;\n import static org.apache.hadoop.ozone.OzoneConfigKeys\n     .OZONE_OPEN_KEY_EXPIRE_THRESHOLD_SECONDS;\n-import static org.apache.hadoop.ozone.om.exceptions.OMException.ResultCodes.FILE_ALREADY_EXISTS;\n-import static org.apache.hadoop.ozone.om.exceptions.OMException.ResultCodes.NOT_A_FILE;\n+import static org.apache.hadoop.ozone.om.exceptions.OMException.ResultCodes.*;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f27adc51507d4d822e86cc29d524b844d8739665"}, "originalPosition": 6}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "7578258956a84b9a3a1b400b9580e23c9be72dbb", "author": {"user": {"login": "umamaheswararao", "name": "Uma Maheswara Rao G"}}, "url": "https://github.com/apache/ozone/commit/7578258956a84b9a3a1b400b9580e23c9be72dbb", "committedDate": "2020-04-21T01:25:45Z", "message": "HDDS-3380. MiniOzoneHAClusterImpl#initOMRatisConf will reset the configs and causes for test failures"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "64da62569e30e2d357bbec2f801277eb610f7aa8", "author": {"user": {"login": "umamaheswararao", "name": "Uma Maheswara Rao G"}}, "url": "https://github.com/apache/ozone/commit/64da62569e30e2d357bbec2f801277eb610f7aa8", "committedDate": "2020-04-21T01:42:13Z", "message": "HDDS-3380. MiniOzoneHAClusterImpl#initOMRatisConf will reset the configs and causes for test failures"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzk2OTczOTE5", "url": "https://github.com/apache/ozone/pull/817#pullrequestreview-396973919", "createdAt": "2020-04-21T04:12:44Z", "commit": {"oid": "64da62569e30e2d357bbec2f801277eb610f7aa8"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yMVQwNDoxMjo0NVrOGIxnbQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yMVQwNDoxMjo0NVrOGIxnbQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMTg1NDcwMQ==", "bodyText": "NIT: Only space change", "url": "https://github.com/apache/ozone/pull/817#discussion_r411854701", "createdAt": "2020-04-21T04:12:45Z", "author": {"login": "bharatviswa504"}, "path": "hadoop-ozone/fault-injection-test/mini-chaos-tests/src/test/java/org/apache/hadoop/ozone/MiniOzoneChaosCluster.java", "diffHunk": "@@ -383,6 +383,7 @@ public MiniOzoneChaosCluster build() throws IOException {\n \n       DefaultMetricsSystem.setMiniClusterMode(true);\n       initializeConfiguration();\n+", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "64da62569e30e2d357bbec2f801277eb610f7aa8"}, "originalPosition": 4}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzk2OTc0MDQ5", "url": "https://github.com/apache/ozone/pull/817#pullrequestreview-396974049", "createdAt": "2020-04-21T04:13:13Z", "commit": {"oid": "64da62569e30e2d357bbec2f801277eb610f7aa8"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yMVQwNDoxMzoxM1rOGIxoBA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yMVQwNDoxMzoxM1rOGIxoBA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMTg1NDg1Mg==", "bodyText": "NIT: Can we move this to single line", "url": "https://github.com/apache/ozone/pull/817#discussion_r411854852", "createdAt": "2020-04-21T04:13:13Z", "author": {"login": "bharatviswa504"}, "path": "hadoop-ozone/integration-test/src/test/java/org/apache/hadoop/fs/ozone/TestOzoneFsHAURLs.java", "diffHunk": "@@ -92,11 +89,8 @@ public void init() throws Exception {\n     final String path = GenericTestUtils.getTempPath(omId);\n     java.nio.file.Path metaDirPath = java.nio.file.Paths.get(path, \"om-meta\");\n     conf.set(HddsConfigKeys.OZONE_METADATA_DIRS, metaDirPath.toString());\n-    conf.set(ScmConfigKeys.OZONE_SCM_CLIENT_ADDRESS_KEY, \"127.0.0.1:0\");\n-    conf.setBoolean(OMConfigKeys.OZONE_OM_RATIS_ENABLE_KEY, true);\n-    conf.setTimeDuration(\n-        OMConfigKeys.OZONE_OM_LEADER_ELECTION_MINIMUM_TIMEOUT_DURATION_KEY,\n-        LEADER_ELECTION_TIMEOUT, TimeUnit.MILLISECONDS);\n+    conf.set(ScmConfigKeys.OZONE_SCM_CLIENT_ADDRESS_KEY, \"127.\" +", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "64da62569e30e2d357bbec2f801277eb610f7aa8"}, "originalPosition": 26}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzk2OTc1ODU4", "url": "https://github.com/apache/ozone/pull/817#pullrequestreview-396975858", "createdAt": "2020-04-21T04:19:52Z", "commit": {"oid": "64da62569e30e2d357bbec2f801277eb610f7aa8"}, "state": "COMMENTED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzk2OTc3NTI1", "url": "https://github.com/apache/ozone/pull/817#pullrequestreview-396977525", "createdAt": "2020-04-21T04:25:59Z", "commit": {"oid": "64da62569e30e2d357bbec2f801277eb610f7aa8"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yMVQwNDoyNTo1OVrOGIx3Gw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yMVQwNDoyNTo1OVrOGIx3Gw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMTg1ODcxNQ==", "bodyText": "Formatting is not proper here for these code lines, few of them can fit in a single line.", "url": "https://github.com/apache/ozone/pull/817#discussion_r411858715", "createdAt": "2020-04-21T04:25:59Z", "author": {"login": "bharatviswa504"}, "path": "hadoop-ozone/integration-test/src/test/java/org/apache/hadoop/ozone/MiniOzoneHAClusterImpl.java", "diffHunk": "@@ -314,16 +313,36 @@ public MiniOzoneCluster build() throws IOException {\n     protected void initOMRatisConf() {\n       conf.setBoolean(OMConfigKeys.OZONE_OM_RATIS_ENABLE_KEY, true);\n       conf.setInt(OMConfigKeys.OZONE_OM_HANDLER_COUNT_KEY, numOfOmHandlers);\n-      conf.setLong(\n-          OMConfigKeys.OZONE_OM_RATIS_SNAPSHOT_AUTO_TRIGGER_THRESHOLD_KEY,\n-          100L);\n-      conf.setLong(OMConfigKeys.OZONE_OM_RATIS_LOG_PURGE_GAP, 200L);\n-      conf.setTimeDuration(\n-          OMConfigKeys.OZONE_OM_LEADER_ELECTION_MINIMUM_TIMEOUT_DURATION_KEY,\n-          RATIS_LEADER_ELECTION_TIMEOUT, TimeUnit.MILLISECONDS);\n+      // If test change the following config values we will respect,\n+      // otherwise we will set lower timeout values.\n+      long defaultDuration = OMConfigKeys", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "64da62569e30e2d357bbec2f801277eb610f7aa8"}, "originalPosition": 23}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "1e60d39e0dacf976871064cf894a169e8ac1cc43", "author": {"user": {"login": "umamaheswararao", "name": "Uma Maheswara Rao G"}}, "url": "https://github.com/apache/ozone/commit/1e60d39e0dacf976871064cf894a169e8ac1cc43", "committedDate": "2020-04-21T04:50:41Z", "message": "HDDS-3380. MiniOzoneHAClusterImpl#initOMRatisConf will reset the configs and causes for test failures"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "65c5219bc6e9207ada9dc5e97f4b15d0cc9fbc43", "author": {"user": {"login": "bharatviswa504", "name": "Bharat Viswanadham"}}, "url": "https://github.com/apache/ozone/commit/65c5219bc6e9207ada9dc5e97f4b15d0cc9fbc43", "committedDate": "2020-04-21T04:57:56Z", "message": "formatting"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c18f3ebd000fee069284ad10f4b40a8fc4b2d1a7", "author": {"user": {"login": "umamaheswararao", "name": "Uma Maheswara Rao G"}}, "url": "https://github.com/apache/ozone/commit/c18f3ebd000fee069284ad10f4b40a8fc4b2d1a7", "committedDate": "2020-04-21T05:17:41Z", "message": "HDDS-3380. MiniOzoneHAClusterImpl#initOMRatisConf will reset the configs and causes for test failures"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzk2OTk0MDg4", "url": "https://github.com/apache/ozone/pull/817#pullrequestreview-396994088", "createdAt": "2020-04-21T05:20:51Z", "commit": {"oid": "c18f3ebd000fee069284ad10f4b40a8fc4b2d1a7"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3361, "cost": 1, "resetAt": "2021-10-28T18:00:02Z"}}}