{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTMzMDIwODg1", "number": 1662, "title": "HDDS-4507. Add SCM CA CLI to query certificate.", "bodyText": "What changes were proposed in this pull request?\nAdding scm admin CLI that allows list/info of certificates issued by SCM.\nWhat is the link to the Apache JIRA\nhttps://issues.apache.org/jira/browse/HDDS-4507\nHow was this patch tested?\nManual testing and added acceptance tests.\nSome sample output from the secure docker-compose tests:\nbash-4.2$ ozone admin cert list\n   Total 2 certificates: \n   SerialNumber    Valid From      Valid To        SubjectDN\n   162534446438373 Fri Dec 04 00:00:00 UTC 2020    Sat Dec 04 00:00:00 UTC 2021    O=CID-e66d4728-32bb-4282-9770-351a7e913f07, OU=9a7c4f86-c862-4067-b12c-e7bca51d3dfe, CN=root@98dba189d5f0\n   162539371895176 Fri Dec 04 00:00:00 UTC 2020    Sat Dec 04 00:00:00 UTC 2021    O=CID-e66d4728-32bb-4282-9770-351a7e913f07, OU=9a7c4f86-c862-4067-b12c-e7bca51d3dfe, CN=root@om\n\nbash-4.2$ ozone admin cert info 162534446438373\n   Certificate id: 162534446438373\n   [\n   [\n     Version: V3\n     Subject: O=CID-e66d4728-32bb-4282-9770-351a7e913f07, OU=9a7c4f86-c862-4067-b12c-e7bca51d3dfe, CN=root@98dba189d5f0\n     Signature Algorithm: SHA256withRSA, OID = 1.2.840.113549.1.1.11\n\n     Key:  Sun RSA public key, 2048 bits\n     params: null\n     modulus: 24806810118367241194658833827043803266877657186456658855596213136768102796770845408683173562136109706337504703762278823248064939126605922536706398494552519304046563760721405567561225347040817363478681331703066244115852219139469122223241709063757595312816247866140634820764064474476952921773834501990682283839739318837357655559721194886161431153233435981439604681713663793973302213334133049194782787272432327228295568609757685618877407821955619561565819371349614206516475628783276797817072763118799254983084703106079148861996087128871753598723315633255615570964183253537675150414328735894758347846430289465070670386317\n     public exponent: 65537\n     Validity: [From: Fri Dec 04 00:00:00 UTC 2020,\n                  To: Sat Dec 04 00:00:00 UTC 2021]\n     Issuer: O=CID-e66d4728-32bb-4282-9770-351a7e913f07, OU=9a7c4f86-c862-4067-b12c-e7bca51d3dfe, CN=scm@scm\n     SerialNumber: [    93d2fff1 97e5]\n\n   Certificate Extensions: 2\n   [1]: ObjectId: 2.5.29.15 Criticality=true\n   KeyUsage [\n     DigitalSignature\n     Key_Encipherment\n     Data_Encipherment\n     Key_Agreement\n   ]\n\n   [2]: ObjectId: 2.5.29.17 Criticality=false\n   SubjectAlternativeName [\n     IPAddress: 172.27.0.2\n   ]\n\n   ]\n     Algorithm: [SHA256withRSA]\n     Signature:\n   0000: 3D 29 84 1D 8D BA 53 F6   00 B7 21 85 E1 3F 0C C5  =)....S...!..?..\n   0010: B3 AA 27 DA 5D E9 C7 9E   46 01 71 10 E4 2D D1 25  ..'.]...F.q..-.%\n   0020: FC 93 49 0F 4F 97 37 18   E9 32 3E 2D 31 8F 59 17  ..I.O.7..2>-1.Y.\n   0030: 89 6D A3 2D FD 7E BC FD   C5 38 57 92 C1 ED 99 C6  .m.-.....8W.....\n   0040: 14 3B 9E CD 8E 90 26 3F   E7 D0 9B 33 E4 0A 37 03  .;....&?...3..7.\n   0050: DF 33 08 75 FC F1 F3 44   E6 85 CF DD 37 2A 47 47  .3.u...D....7*GG\n   0060: 28 CF E3 A2 19 92 2A C0   1A 93 2B B5 0D D1 7C 7F  (.....*...+.....\n   0070: 32 5D 02 61 0B A1 DF 2E   71 07 98 22 91 93 5D A5  2].a....q..\"..].\n   0080: BD 77 28 8A E8 45 90 9A   AE 9D 45 F0 BB 33 7A 32  .w(..E....E..3z2\n   0090: 6D 71 47 EB 0B 32 EA 76   8C 1D 92 AE 02 02 FB 73  mqG..2.v.......s\n   00A0: CB AE 86 B6 00 51 58 96   F3 2E 7A 85 CB 4B 19 FF  .....QX...z..K..\n   00B0: 49 AA ED F0 47 AA E8 1E   AD 80 92 BF 99 D4 C6 46  I...G..........F\n   00C0: 9F B9 9E CF 8D 45 40 D2   A0 2A 02 98 DC 41 11 D5  .....E@..*...A..\n   00D0: 90 CD 7E BC DE 95 AE 06   13 6C F4 C9 57 DA B2 80  .........l..W...\n   00E0: 63 69 55 6C 25 9F 0A BE   EE 46 EF 9F 19 EE 1A 7A  ciUl%....F.....z\n   00F0: 96 88 DD 48 5E CE E2 AE   D1 C6 5C C2 83 23 71 A9  ...H^.....\\..#q.\n\n   ]", "createdAt": "2020-12-05T13:54:21Z", "url": "https://github.com/apache/ozone/pull/1662", "merged": true, "mergeCommit": {"oid": "d044afb8eeaa13d3f6bf46090f9ada2d5403e014"}, "closed": true, "closedAt": "2021-01-04T17:21:33Z", "author": {"login": "xiaoyuyao"}, "timelineItems": {"totalCount": 11, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdjFJ2SAH2gAyNTMzMDIwODg1OmI2ZGJhOGM1YTliMmM5OTdhZTY4MzBiZTAwMWNmYjljMmU0N2RiYTU=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdoJOfpgH2gAyNTMzMDIwODg1OjI3YWEyY2FhZmM2ZTdiODJkYzZhZDNlNjNjMzc5N2UxMDg3YzQ0YTU=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "b6dba8c5a9b2c997ae6830be001cfb9c2e47dba5", "author": {"user": {"login": "xiaoyuyao", "name": "Xiaoyu Yao"}}, "url": "https://github.com/apache/ozone/commit/b6dba8c5a9b2c997ae6830be001cfb9c2e47dba5", "committedDate": "2020-12-05T05:04:52Z", "message": "HDDS-4507. Add SCM CA CLI to query certificate."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "5ea8c57467cc4b6f32a707b4ad7eae31e6f2c4e0", "author": {"user": {"login": "xiaoyuyao", "name": "Xiaoyu Yao"}}, "url": "https://github.com/apache/ozone/commit/5ea8c57467cc4b6f32a707b4ad7eae31e6f2c4e0", "committedDate": "2020-12-05T14:03:59Z", "message": "checkstyle"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "171250a2448bb8e3a01939250a5f6fef9caced01", "author": {"user": {"login": "xiaoyuyao", "name": "Xiaoyu Yao"}}, "url": "https://github.com/apache/ozone/commit/171250a2448bb8e3a01939250a5f6fef9caced01", "committedDate": "2020-12-05T14:17:49Z", "message": "checkstyle 2"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTQ1ODY2OTc3", "url": "https://github.com/apache/ozone/pull/1662#pullrequestreview-545866977", "createdAt": "2020-12-07T06:46:58Z", "commit": {"oid": "171250a2448bb8e3a01939250a5f6fef9caced01"}, "state": "COMMENTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0wN1QwNjo0Njo1OFrOIAYLYg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0wN1QwNjo1MDoyMFrOIAYQQg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNzI2NzA0Mg==", "bodyText": "Show we throw out the IOException here? The caller may not be aware of the exception happened here from the returned results.", "url": "https://github.com/apache/ozone/pull/1662#discussion_r537267042", "createdAt": "2020-12-07T06:46:58Z", "author": {"login": "GlenGeng"}, "path": "hadoop-hdds/server-scm/src/main/java/org/apache/hadoop/hdds/scm/server/SCMCertStore.java", "diffHunk": "@@ -112,4 +117,39 @@ public X509Certificate getCertificateByID(BigInteger serialID,\n       return scmMetadataStore.getRevokedCertsTable().get(serialID);\n     }\n   }\n+\n+  @Override\n+  public List<X509Certificate> listCertificate(HddsProtos.NodeType role,\n+      BigInteger startSerialID, int count, CertType certType)\n+      throws IOException {\n+    // TODO: Filter by role\n+    List<? extends Table.KeyValue<BigInteger, X509Certificate>> certs;\n+    if (startSerialID.longValue() == 0) {\n+      startSerialID = null;\n+    }\n+    if (certType == CertType.VALID_CERTS) {\n+      certs = scmMetadataStore.getValidCertsTable().getRangeKVs(\n+          startSerialID, count);\n+    } else {\n+      certs = scmMetadataStore.getRevokedCertsTable().getRangeKVs(\n+          startSerialID, count);\n+    }\n+    List<X509Certificate> results = new ArrayList<>(certs.size());\n+    for (Table.KeyValue<BigInteger, X509Certificate> kv : certs) {\n+      try {\n+        X509Certificate cert = kv.getValue();\n+        // TODO: filter certificate based on CN and specified role.\n+        // This requires change of the approved subject CN format:\n+        // Subject: O=CID-e66d4728-32bb-4282-9770-351a7e913f07,\n+        // OU=9a7c4f86-c862-4067-b12c-e7bca51d3dfe, CN=root@98dba189d5f0\n+\n+        // The new format will look like below that are easier to filter.\n+        // CN=FQDN/user=root/role=datanode/...\n+        results.add(cert);\n+      } catch (IOException e) {\n+        LOG.error(\"Fail to get certificate from SCM metadata store\", e);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "171250a2448bb8e3a01939250a5f6fef9caced01"}, "originalPosition": 52}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNzI2ODI5MA==", "bodyText": "ditto", "url": "https://github.com/apache/ozone/pull/1662#discussion_r537268290", "createdAt": "2020-12-07T06:50:20Z", "author": {"login": "GlenGeng"}, "path": "hadoop-hdds/server-scm/src/main/java/org/apache/hadoop/hdds/scm/server/SCMSecurityProtocolServer.java", "diffHunk": "@@ -192,6 +195,33 @@ public String getCACertificate() throws IOException {\n     }\n   }\n \n+  /**\n+   *\n+   * @param role            - node role: OM/SCM/DN.\n+   * @param startSerialId   - start certificate serial id.\n+   * @param count           - max number of certificates returned in a batch.\n+   * @param isRevoked       - whether list for revoked certs only.\n+   * @return\n+   * @throws IOException\n+   */\n+  @Override\n+  public List<String> listCertificate(HddsProtos.NodeType role,\n+      long startSerialId, int count, boolean isRevoked) throws IOException {\n+    List<X509Certificate> certificates =\n+        certificateServer.listCertificate(role, startSerialId, count,\n+            isRevoked);\n+    List<String> results = new ArrayList<>(certificates.size());\n+    for (X509Certificate cert : certificates) {\n+      try {\n+        String certStr = CertificateCodec.getPEMEncodedString(cert);\n+        results.add(certStr);\n+      } catch (SCMSecurityException e) {\n+        LOGGER.error(\"listCertificate fail to encode certificate.\", e);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "171250a2448bb8e3a01939250a5f6fef9caced01"}, "originalPosition": 56}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "351a85a10ffcc7bb6061cd189a250744aebd3f39", "author": {"user": {"login": "xiaoyuyao", "name": "Xiaoyu Yao"}}, "url": "https://github.com/apache/ozone/commit/351a85a10ffcc7bb6061cd189a250744aebd3f39", "committedDate": "2020-12-09T06:18:40Z", "message": "address code review comments"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTUxOTY2NjA5", "url": "https://github.com/apache/ozone/pull/1662#pullrequestreview-551966609", "createdAt": "2020-12-14T23:02:45Z", "commit": {"oid": "351a85a10ffcc7bb6061cd189a250744aebd3f39"}, "state": "COMMENTED", "comments": {"totalCount": 7, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xNFQyMzowMjo0NVrOIFwesg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xNFQyMzo1NjoyNFrOIFyA7A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MjkwODA4Mg==", "bodyText": "Nit: getCertificates may be a better name here\n\n  \n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n              List<String> listCertificate(HddsProtos.NodeType type, long startSerialId,\n          \n          \n            \n              List<String> getCertificates(HddsProtos.NodeType type, long startSerialId,", "url": "https://github.com/apache/ozone/pull/1662#discussion_r542908082", "createdAt": "2020-12-14T23:02:45Z", "author": {"login": "vivekratnavel"}, "path": "hadoop-hdds/framework/src/main/java/org/apache/hadoop/hdds/protocol/SCMSecurityProtocol.java", "diffHunk": "@@ -77,4 +80,16 @@ String getOMCertificate(OzoneManagerDetailsProto omDetails,\n    */\n   String getCACertificate() throws IOException;\n \n+  /**\n+   * Get list of certificates meet the query criteria.\n+   *\n+   * @param type            - node type: OM/SCM/DN.\n+   * @param startSerialId   - start certificate serial id.\n+   * @param count           - max number of certificates returned in a batch.\n+   * @param isRevoked       - whether list for revoked certs only.\n+   * @return list of PEM encoded certificate strings.\n+   */\n+  List<String> listCertificate(HddsProtos.NodeType type, long startSerialId,", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "351a85a10ffcc7bb6061cd189a250744aebd3f39"}, "originalPosition": 24}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MjkxMjAzNA==", "bodyText": "Nit: getCertificates may be a better name here\n\n  \n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n              List<X509Certificate> listCertificate(HddsProtos.NodeType type,\n          \n          \n            \n              List<X509Certificate> getCertificates(HddsProtos.NodeType type,", "url": "https://github.com/apache/ozone/pull/1662#discussion_r542912034", "createdAt": "2020-12-14T23:07:47Z", "author": {"login": "vivekratnavel"}, "path": "hadoop-hdds/framework/src/main/java/org/apache/hadoop/hdds/security/x509/certificate/authority/CertificateServer.java", "diffHunk": "@@ -112,6 +114,16 @@ X509Certificate getCertificate(String certSerialId)\n    * framework.\n    */\n \n+  /**\n+   * List certificates.\n+   * @param type            - node type: OM/SCM/DN\n+   * @param startSerialId   - start certificate serial id\n+   * @param count           - max number of certificates returned in a batch\n+   * @return\n+   * @throws IOException\n+   */\n+  List<X509Certificate> listCertificate(HddsProtos.NodeType type,", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "351a85a10ffcc7bb6061cd189a250744aebd3f39"}, "originalPosition": 28}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MjkzMDgzMQ==", "bodyText": "Nit\n\n  \n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                description = \"Show detail information of a specific certificate\",\n          \n          \n            \n                description = \"Show detailed information for a specific certificate\",", "url": "https://github.com/apache/ozone/pull/1662#discussion_r542930831", "createdAt": "2020-12-14T23:50:14Z", "author": {"login": "vivekratnavel"}, "path": "hadoop-hdds/tools/src/main/java/org/apache/hadoop/hdds/scm/cli/cert/InfoSubcommand.java", "diffHunk": "@@ -0,0 +1,76 @@\n+/*\n+ * Licensed to the Apache Software Foundation (ASF) under one\n+ * or more contributor license agreements.  See the NOTICE file\n+ * distributed with this work for additional information\n+ * regarding copyright ownership.  The ASF licenses this file\n+ * to you under the Apache License, Version 2.0 (the\n+ * \"License\"); you may not use this file except in compliance\n+ * with the License.  You may obtain a copy of the License at\n+ * <p>\n+ * http://www.apache.org/licenses/LICENSE-2.0\n+ * <p>\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+package org.apache.hadoop.hdds.scm.cli.cert;\n+\n+import java.io.IOException;\n+import java.security.cert.CertificateException;\n+import java.security.cert.X509Certificate;\n+\n+import com.google.common.base.Preconditions;\n+import org.apache.hadoop.hdds.cli.GenericParentCommand;\n+import org.apache.hadoop.hdds.cli.HddsVersionProvider;\n+import org.apache.hadoop.hdds.protocol.SCMSecurityProtocol;\n+\n+import org.apache.hadoop.hdds.security.x509.certificate.utils.CertificateCodec;\n+import org.slf4j.Logger;\n+import org.slf4j.LoggerFactory;\n+import picocli.CommandLine.Command;\n+import picocli.CommandLine.Model.CommandSpec;\n+import picocli.CommandLine.Parameters;\n+import picocli.CommandLine.Spec;\n+\n+/**\n+ * This is the handler that process certificate info command.\n+ */\n+@Command(\n+    name = \"info\",\n+    description = \"Show detail information of a specific certificate\",", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "351a85a10ffcc7bb6061cd189a250744aebd3f39"}, "originalPosition": 42}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MjkzMTM4MA==", "bodyText": "Nit\n\n  \n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                  LOG.error(\"Fail to get certificate id \" + serialId);\n          \n          \n            \n                  LOG.error(\"Failed to get certificate id \" + serialId);", "url": "https://github.com/apache/ozone/pull/1662#discussion_r542931380", "createdAt": "2020-12-14T23:51:36Z", "author": {"login": "vivekratnavel"}, "path": "hadoop-hdds/tools/src/main/java/org/apache/hadoop/hdds/scm/cli/cert/InfoSubcommand.java", "diffHunk": "@@ -0,0 +1,76 @@\n+/*\n+ * Licensed to the Apache Software Foundation (ASF) under one\n+ * or more contributor license agreements.  See the NOTICE file\n+ * distributed with this work for additional information\n+ * regarding copyright ownership.  The ASF licenses this file\n+ * to you under the Apache License, Version 2.0 (the\n+ * \"License\"); you may not use this file except in compliance\n+ * with the License.  You may obtain a copy of the License at\n+ * <p>\n+ * http://www.apache.org/licenses/LICENSE-2.0\n+ * <p>\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+package org.apache.hadoop.hdds.scm.cli.cert;\n+\n+import java.io.IOException;\n+import java.security.cert.CertificateException;\n+import java.security.cert.X509Certificate;\n+\n+import com.google.common.base.Preconditions;\n+import org.apache.hadoop.hdds.cli.GenericParentCommand;\n+import org.apache.hadoop.hdds.cli.HddsVersionProvider;\n+import org.apache.hadoop.hdds.protocol.SCMSecurityProtocol;\n+\n+import org.apache.hadoop.hdds.security.x509.certificate.utils.CertificateCodec;\n+import org.slf4j.Logger;\n+import org.slf4j.LoggerFactory;\n+import picocli.CommandLine.Command;\n+import picocli.CommandLine.Model.CommandSpec;\n+import picocli.CommandLine.Parameters;\n+import picocli.CommandLine.Spec;\n+\n+/**\n+ * This is the handler that process certificate info command.\n+ */\n+@Command(\n+    name = \"info\",\n+    description = \"Show detail information of a specific certificate\",\n+    mixinStandardHelpOptions = true,\n+    versionProvider = HddsVersionProvider.class)\n+\n+class InfoSubcommand extends ScmCertSubcommand {\n+\n+  private static final Logger LOG =\n+      LoggerFactory.getLogger(InfoSubcommand.class);\n+\n+  @Spec\n+  private CommandSpec spec;\n+\n+  @Parameters(description = \"Serial id of the certificate in decimal.\")\n+  private String serialId;\n+\n+  @Override\n+  public void execute(SCMSecurityProtocol client) throws IOException {\n+    final String certPemStr =\n+        client.getCertificate(serialId);\n+    Preconditions.checkNotNull(certPemStr,\n+        \"Certificate can't be found\");\n+\n+    // Print container report info.\n+    LOG.info(\"Certificate id: {}\", serialId);\n+    boolean verbose = spec.root().userObject() instanceof GenericParentCommand\n+        && ((GenericParentCommand) spec.root().userObject()).isVerbose();\n+    try {\n+      X509Certificate cert = CertificateCodec.getX509Cert(certPemStr);\n+      LOG.info(cert.toString());\n+    } catch (CertificateException ex) {\n+      LOG.error(\"Fail to get certificate id \" + serialId);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "351a85a10ffcc7bb6061cd189a250744aebd3f39"}, "originalPosition": 72}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MjkzMTUzMw==", "bodyText": "Nit\n\n  \n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                  throw new IOException(\"Fail to get certificate id \" + serialId, ex);\n          \n          \n            \n                  throw new IOException(\"Failed to get certificate id \" + serialId, ex);", "url": "https://github.com/apache/ozone/pull/1662#discussion_r542931533", "createdAt": "2020-12-14T23:51:58Z", "author": {"login": "vivekratnavel"}, "path": "hadoop-hdds/tools/src/main/java/org/apache/hadoop/hdds/scm/cli/cert/InfoSubcommand.java", "diffHunk": "@@ -0,0 +1,76 @@\n+/*\n+ * Licensed to the Apache Software Foundation (ASF) under one\n+ * or more contributor license agreements.  See the NOTICE file\n+ * distributed with this work for additional information\n+ * regarding copyright ownership.  The ASF licenses this file\n+ * to you under the Apache License, Version 2.0 (the\n+ * \"License\"); you may not use this file except in compliance\n+ * with the License.  You may obtain a copy of the License at\n+ * <p>\n+ * http://www.apache.org/licenses/LICENSE-2.0\n+ * <p>\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+package org.apache.hadoop.hdds.scm.cli.cert;\n+\n+import java.io.IOException;\n+import java.security.cert.CertificateException;\n+import java.security.cert.X509Certificate;\n+\n+import com.google.common.base.Preconditions;\n+import org.apache.hadoop.hdds.cli.GenericParentCommand;\n+import org.apache.hadoop.hdds.cli.HddsVersionProvider;\n+import org.apache.hadoop.hdds.protocol.SCMSecurityProtocol;\n+\n+import org.apache.hadoop.hdds.security.x509.certificate.utils.CertificateCodec;\n+import org.slf4j.Logger;\n+import org.slf4j.LoggerFactory;\n+import picocli.CommandLine.Command;\n+import picocli.CommandLine.Model.CommandSpec;\n+import picocli.CommandLine.Parameters;\n+import picocli.CommandLine.Spec;\n+\n+/**\n+ * This is the handler that process certificate info command.\n+ */\n+@Command(\n+    name = \"info\",\n+    description = \"Show detail information of a specific certificate\",\n+    mixinStandardHelpOptions = true,\n+    versionProvider = HddsVersionProvider.class)\n+\n+class InfoSubcommand extends ScmCertSubcommand {\n+\n+  private static final Logger LOG =\n+      LoggerFactory.getLogger(InfoSubcommand.class);\n+\n+  @Spec\n+  private CommandSpec spec;\n+\n+  @Parameters(description = \"Serial id of the certificate in decimal.\")\n+  private String serialId;\n+\n+  @Override\n+  public void execute(SCMSecurityProtocol client) throws IOException {\n+    final String certPemStr =\n+        client.getCertificate(serialId);\n+    Preconditions.checkNotNull(certPemStr,\n+        \"Certificate can't be found\");\n+\n+    // Print container report info.\n+    LOG.info(\"Certificate id: {}\", serialId);\n+    boolean verbose = spec.root().userObject() instanceof GenericParentCommand\n+        && ((GenericParentCommand) spec.root().userObject()).isVerbose();\n+    try {\n+      X509Certificate cert = CertificateCodec.getX509Cert(certPemStr);\n+      LOG.info(cert.toString());\n+    } catch (CertificateException ex) {\n+      LOG.error(\"Fail to get certificate id \" + serialId);\n+      throw new IOException(\"Fail to get certificate id \" + serialId, ex);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "351a85a10ffcc7bb6061cd189a250744aebd3f39"}, "originalPosition": 73}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MjkzMzA0OA==", "bodyText": "Nit: May be \"Valid Until\" or \"Expiry\" will suit better here. And instead of subjectDN, can we use subject?\n\n  \n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                LOG.info(\"SerialNumber\\t\\tValid From\\t\\tValid To\\t\\tSubjectDN\");\n          \n          \n            \n                LOG.info(\"SerialNumber\\t\\tValid From\\t\\tExpiry\\t\\tSubject\");", "url": "https://github.com/apache/ozone/pull/1662#discussion_r542933048", "createdAt": "2020-12-14T23:55:57Z", "author": {"login": "vivekratnavel"}, "path": "hadoop-hdds/tools/src/main/java/org/apache/hadoop/hdds/scm/cli/cert/ListSubcommand.java", "diffHunk": "@@ -0,0 +1,100 @@\n+/*\n+ * Licensed to the Apache Software Foundation (ASF) under one\n+ * or more contributor license agreements.  See the NOTICE file\n+ * distributed with this work for additional information\n+ * regarding copyright ownership.  The ASF licenses this file\n+ * to you under the Apache License, Version 2.0 (the\n+ * \"License\"); you may not use this file except in compliance\n+ * with the License.  You may obtain a copy of the License at\n+ * <p>\n+ * http://www.apache.org/licenses/LICENSE-2.0\n+ * <p>\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+package org.apache.hadoop.hdds.scm.cli.cert;\n+\n+import java.io.IOException;\n+import java.security.cert.CertificateException;\n+import java.security.cert.X509Certificate;\n+import java.util.List;\n+\n+import org.apache.hadoop.hdds.cli.HddsVersionProvider;\n+import org.apache.hadoop.hdds.protocol.SCMSecurityProtocol;\n+\n+import org.apache.hadoop.hdds.protocol.proto.HddsProtos;\n+import org.apache.hadoop.hdds.security.x509.certificate.utils.CertificateCodec;\n+import org.slf4j.Logger;\n+import org.slf4j.LoggerFactory;\n+import picocli.CommandLine.Command;\n+import picocli.CommandLine.Help.Visibility;\n+import picocli.CommandLine.Option;\n+\n+/**\n+ * This is the handler that process certificate list command.\n+ */\n+@Command(\n+    name = \"list\",\n+    description = \"List certificates\",\n+    mixinStandardHelpOptions = true,\n+    versionProvider = HddsVersionProvider.class)\n+public class ListSubcommand extends ScmCertSubcommand {\n+\n+  private static final Logger LOG =\n+      LoggerFactory.getLogger(ListSubcommand.class);\n+\n+  @Option(names = {\"-s\", \"--start\"},\n+      description = \"Certificate serial id to start the iteration\",\n+      defaultValue = \"0\", showDefaultValue = Visibility.ALWAYS)\n+  private long startSerialId;\n+\n+  @Option(names = {\"-c\", \"--count\"},\n+      description = \"Maximum number of certificates to list\",\n+      defaultValue = \"20\", showDefaultValue = Visibility.ALWAYS)\n+  private int count;\n+\n+  @Option(names = {\"-r\", \"--role\"},\n+      description = \"Filter certificate by the role: om/datanode\",\n+      defaultValue = \"datanode\", showDefaultValue = Visibility.ALWAYS)\n+  private String role;\n+\n+  @Option(names = {\"-t\", \"--type\"},\n+      description = \"Filter certificate by the type: valid or revoked\",\n+      defaultValue = \"valid\", showDefaultValue = Visibility.ALWAYS)\n+  private String type;\n+\n+  private HddsProtos.NodeType parseCertRole(String r) {\n+    if (r.equalsIgnoreCase(\"om\")) {\n+      return HddsProtos.NodeType.OM;\n+    } else if (r.equalsIgnoreCase(\"scm\")) {\n+      return HddsProtos.NodeType.SCM;\n+    } else {\n+      return HddsProtos.NodeType.DATANODE;\n+    }\n+  }\n+\n+  private void printCert(X509Certificate cert) {\n+    LOG.info(\"{}\\t{}\\t{}\\t{}\", cert.getSerialNumber(), cert.getNotBefore(),\n+        cert.getNotAfter(), cert.getSubjectDN());\n+  }\n+\n+  @Override\n+  protected void execute(SCMSecurityProtocol client) throws IOException {\n+    boolean isRevoked = type.equalsIgnoreCase(\"revoked\");\n+    List<String> certPemList = client.listCertificate(\n+        parseCertRole(role), startSerialId, count, isRevoked);\n+    LOG.info(\"Total {} {} certificates: \", certPemList.size(), type);\n+    LOG.info(\"SerialNumber\\t\\tValid From\\t\\tValid To\\t\\tSubjectDN\");", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "351a85a10ffcc7bb6061cd189a250744aebd3f39"}, "originalPosition": 90}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MjkzMzIyOA==", "bodyText": "Nit:\n\n  \n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                    LOG.error(\"Fail to parse certificate.\");\n          \n          \n            \n                    LOG.error(\"Failed to parse certificate.\");", "url": "https://github.com/apache/ozone/pull/1662#discussion_r542933228", "createdAt": "2020-12-14T23:56:24Z", "author": {"login": "vivekratnavel"}, "path": "hadoop-hdds/tools/src/main/java/org/apache/hadoop/hdds/scm/cli/cert/ListSubcommand.java", "diffHunk": "@@ -0,0 +1,100 @@\n+/*\n+ * Licensed to the Apache Software Foundation (ASF) under one\n+ * or more contributor license agreements.  See the NOTICE file\n+ * distributed with this work for additional information\n+ * regarding copyright ownership.  The ASF licenses this file\n+ * to you under the Apache License, Version 2.0 (the\n+ * \"License\"); you may not use this file except in compliance\n+ * with the License.  You may obtain a copy of the License at\n+ * <p>\n+ * http://www.apache.org/licenses/LICENSE-2.0\n+ * <p>\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+package org.apache.hadoop.hdds.scm.cli.cert;\n+\n+import java.io.IOException;\n+import java.security.cert.CertificateException;\n+import java.security.cert.X509Certificate;\n+import java.util.List;\n+\n+import org.apache.hadoop.hdds.cli.HddsVersionProvider;\n+import org.apache.hadoop.hdds.protocol.SCMSecurityProtocol;\n+\n+import org.apache.hadoop.hdds.protocol.proto.HddsProtos;\n+import org.apache.hadoop.hdds.security.x509.certificate.utils.CertificateCodec;\n+import org.slf4j.Logger;\n+import org.slf4j.LoggerFactory;\n+import picocli.CommandLine.Command;\n+import picocli.CommandLine.Help.Visibility;\n+import picocli.CommandLine.Option;\n+\n+/**\n+ * This is the handler that process certificate list command.\n+ */\n+@Command(\n+    name = \"list\",\n+    description = \"List certificates\",\n+    mixinStandardHelpOptions = true,\n+    versionProvider = HddsVersionProvider.class)\n+public class ListSubcommand extends ScmCertSubcommand {\n+\n+  private static final Logger LOG =\n+      LoggerFactory.getLogger(ListSubcommand.class);\n+\n+  @Option(names = {\"-s\", \"--start\"},\n+      description = \"Certificate serial id to start the iteration\",\n+      defaultValue = \"0\", showDefaultValue = Visibility.ALWAYS)\n+  private long startSerialId;\n+\n+  @Option(names = {\"-c\", \"--count\"},\n+      description = \"Maximum number of certificates to list\",\n+      defaultValue = \"20\", showDefaultValue = Visibility.ALWAYS)\n+  private int count;\n+\n+  @Option(names = {\"-r\", \"--role\"},\n+      description = \"Filter certificate by the role: om/datanode\",\n+      defaultValue = \"datanode\", showDefaultValue = Visibility.ALWAYS)\n+  private String role;\n+\n+  @Option(names = {\"-t\", \"--type\"},\n+      description = \"Filter certificate by the type: valid or revoked\",\n+      defaultValue = \"valid\", showDefaultValue = Visibility.ALWAYS)\n+  private String type;\n+\n+  private HddsProtos.NodeType parseCertRole(String r) {\n+    if (r.equalsIgnoreCase(\"om\")) {\n+      return HddsProtos.NodeType.OM;\n+    } else if (r.equalsIgnoreCase(\"scm\")) {\n+      return HddsProtos.NodeType.SCM;\n+    } else {\n+      return HddsProtos.NodeType.DATANODE;\n+    }\n+  }\n+\n+  private void printCert(X509Certificate cert) {\n+    LOG.info(\"{}\\t{}\\t{}\\t{}\", cert.getSerialNumber(), cert.getNotBefore(),\n+        cert.getNotAfter(), cert.getSubjectDN());\n+  }\n+\n+  @Override\n+  protected void execute(SCMSecurityProtocol client) throws IOException {\n+    boolean isRevoked = type.equalsIgnoreCase(\"revoked\");\n+    List<String> certPemList = client.listCertificate(\n+        parseCertRole(role), startSerialId, count, isRevoked);\n+    LOG.info(\"Total {} {} certificates: \", certPemList.size(), type);\n+    LOG.info(\"SerialNumber\\t\\tValid From\\t\\tValid To\\t\\tSubjectDN\");\n+    for (String certPemStr : certPemList) {\n+      try {\n+        X509Certificate cert = CertificateCodec.getX509Certificate(certPemStr);\n+        printCert(cert);\n+      } catch (CertificateException ex) {\n+        LOG.error(\"Fail to parse certificate.\");", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "351a85a10ffcc7bb6061cd189a250744aebd3f39"}, "originalPosition": 96}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d54471123b321e074778e9a28263bc8531bdec5b", "author": {"user": {"login": "xiaoyuyao", "name": "Xiaoyu Yao"}}, "url": "https://github.com/apache/ozone/commit/d54471123b321e074778e9a28263bc8531bdec5b", "committedDate": "2020-12-16T00:55:29Z", "message": "address code review comment"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTUzMzE0NjM2", "url": "https://github.com/apache/ozone/pull/1662#pullrequestreview-553314636", "createdAt": "2020-12-16T02:40:53Z", "commit": {"oid": "d54471123b321e074778e9a28263bc8531bdec5b"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTUzNzQ3NjE4", "url": "https://github.com/apache/ozone/pull/1662#pullrequestreview-553747618", "createdAt": "2020-12-16T14:37:32Z", "commit": {"oid": "d54471123b321e074778e9a28263bc8531bdec5b"}, "state": "COMMENTED", "comments": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xNlQxNDozNzozMlrOIHIZ2Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xNlQxNTowMTozMlrOIHJqAA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NDM0ODYzMw==", "bodyText": "verbose is unused.", "url": "https://github.com/apache/ozone/pull/1662#discussion_r544348633", "createdAt": "2020-12-16T14:37:32Z", "author": {"login": "adoroszlai"}, "path": "hadoop-hdds/tools/src/main/java/org/apache/hadoop/hdds/scm/cli/cert/InfoSubcommand.java", "diffHunk": "@@ -0,0 +1,76 @@\n+/*\n+ * Licensed to the Apache Software Foundation (ASF) under one\n+ * or more contributor license agreements.  See the NOTICE file\n+ * distributed with this work for additional information\n+ * regarding copyright ownership.  The ASF licenses this file\n+ * to you under the Apache License, Version 2.0 (the\n+ * \"License\"); you may not use this file except in compliance\n+ * with the License.  You may obtain a copy of the License at\n+ * <p>\n+ * http://www.apache.org/licenses/LICENSE-2.0\n+ * <p>\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+package org.apache.hadoop.hdds.scm.cli.cert;\n+\n+import java.io.IOException;\n+import java.security.cert.CertificateException;\n+import java.security.cert.X509Certificate;\n+\n+import com.google.common.base.Preconditions;\n+import org.apache.hadoop.hdds.cli.GenericParentCommand;\n+import org.apache.hadoop.hdds.cli.HddsVersionProvider;\n+import org.apache.hadoop.hdds.protocol.SCMSecurityProtocol;\n+\n+import org.apache.hadoop.hdds.security.x509.certificate.utils.CertificateCodec;\n+import org.slf4j.Logger;\n+import org.slf4j.LoggerFactory;\n+import picocli.CommandLine.Command;\n+import picocli.CommandLine.Model.CommandSpec;\n+import picocli.CommandLine.Parameters;\n+import picocli.CommandLine.Spec;\n+\n+/**\n+ * This is the handler that process certificate info command.\n+ */\n+@Command(\n+    name = \"info\",\n+    description = \"Show detailed information for a specific certificate\",\n+    mixinStandardHelpOptions = true,\n+    versionProvider = HddsVersionProvider.class)\n+\n+class InfoSubcommand extends ScmCertSubcommand {\n+\n+  private static final Logger LOG =\n+      LoggerFactory.getLogger(InfoSubcommand.class);\n+\n+  @Spec\n+  private CommandSpec spec;\n+\n+  @Parameters(description = \"Serial id of the certificate in decimal.\")\n+  private String serialId;\n+\n+  @Override\n+  public void execute(SCMSecurityProtocol client) throws IOException {\n+    final String certPemStr =\n+        client.getCertificate(serialId);\n+    Preconditions.checkNotNull(certPemStr,\n+        \"Certificate can't be found\");\n+\n+    // Print container report info.\n+    LOG.info(\"Certificate id: {}\", serialId);\n+    boolean verbose = spec.root().userObject() instanceof GenericParentCommand\n+        && ((GenericParentCommand) spec.root().userObject()).isVerbose();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d54471123b321e074778e9a28263bc8531bdec5b"}, "originalPosition": 67}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NDM1MTc4OQ==", "bodyText": "Should we return emptyList() instead?", "url": "https://github.com/apache/ozone/pull/1662#discussion_r544351789", "createdAt": "2020-12-16T14:41:30Z", "author": {"login": "adoroszlai"}, "path": "hadoop-hdds/framework/src/test/java/org/apache/hadoop/hdds/security/x509/certificate/authority/MockCAStore.java", "diffHunk": "@@ -51,4 +54,11 @@ public X509Certificate getCertificateByID(BigInteger serialID,\n       throws IOException {\n     return null;\n   }\n+\n+  @Override\n+  public List<X509Certificate> listCertificate(HddsProtos.NodeType role,\n+      BigInteger startSerialID, int count, CertType certType)\n+      throws IOException {\n+    return null;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d54471123b321e074778e9a28263bc8531bdec5b"}, "originalPosition": 22}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NDM1OTk4Mw==", "bodyText": "Headers and data don't really line up:\nSerialNumber\t\tValid From\t\tExpiry\t\tSubject\n2205019573485754\tWed Dec 16 00:00:00 UTC 2020\tThu Dec 16 00:00:00 UTC 2021\tO=CID-fe48b3e3-f808-4cbd-86a9-847465f6f617, OU=b4fb9f43-c2ad-454a-b204-ba13d05bff63, CN=root@55967653af5c\n\nshould be something like:\nSerialNumber\t\tValid From\t\t\tExpiry\t\t\t\tSubject\n2205019573485754\tWed Dec 16 00:00:00 UTC 2020\tThu Dec 16 00:00:00 UTC 2021\tO=CID-fe48b3e3-f808-4cbd-86a9-847465f6f617, OU=b4fb9f43-c2ad-454a-b204-ba13d05bff63, CN=root@55967653af5c", "url": "https://github.com/apache/ozone/pull/1662#discussion_r544359983", "createdAt": "2020-12-16T14:50:36Z", "author": {"login": "adoroszlai"}, "path": "hadoop-hdds/tools/src/main/java/org/apache/hadoop/hdds/scm/cli/cert/ListSubcommand.java", "diffHunk": "@@ -0,0 +1,100 @@\n+/*\n+ * Licensed to the Apache Software Foundation (ASF) under one\n+ * or more contributor license agreements.  See the NOTICE file\n+ * distributed with this work for additional information\n+ * regarding copyright ownership.  The ASF licenses this file\n+ * to you under the Apache License, Version 2.0 (the\n+ * \"License\"); you may not use this file except in compliance\n+ * with the License.  You may obtain a copy of the License at\n+ * <p>\n+ * http://www.apache.org/licenses/LICENSE-2.0\n+ * <p>\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+package org.apache.hadoop.hdds.scm.cli.cert;\n+\n+import java.io.IOException;\n+import java.security.cert.CertificateException;\n+import java.security.cert.X509Certificate;\n+import java.util.List;\n+\n+import org.apache.hadoop.hdds.cli.HddsVersionProvider;\n+import org.apache.hadoop.hdds.protocol.SCMSecurityProtocol;\n+\n+import org.apache.hadoop.hdds.protocol.proto.HddsProtos;\n+import org.apache.hadoop.hdds.security.x509.certificate.utils.CertificateCodec;\n+import org.slf4j.Logger;\n+import org.slf4j.LoggerFactory;\n+import picocli.CommandLine.Command;\n+import picocli.CommandLine.Help.Visibility;\n+import picocli.CommandLine.Option;\n+\n+/**\n+ * This is the handler that process certificate list command.\n+ */\n+@Command(\n+    name = \"list\",\n+    description = \"List certificates\",\n+    mixinStandardHelpOptions = true,\n+    versionProvider = HddsVersionProvider.class)\n+public class ListSubcommand extends ScmCertSubcommand {\n+\n+  private static final Logger LOG =\n+      LoggerFactory.getLogger(ListSubcommand.class);\n+\n+  @Option(names = {\"-s\", \"--start\"},\n+      description = \"Certificate serial id to start the iteration\",\n+      defaultValue = \"0\", showDefaultValue = Visibility.ALWAYS)\n+  private long startSerialId;\n+\n+  @Option(names = {\"-c\", \"--count\"},\n+      description = \"Maximum number of certificates to list\",\n+      defaultValue = \"20\", showDefaultValue = Visibility.ALWAYS)\n+  private int count;\n+\n+  @Option(names = {\"-r\", \"--role\"},\n+      description = \"Filter certificate by the role: om/datanode\",\n+      defaultValue = \"datanode\", showDefaultValue = Visibility.ALWAYS)\n+  private String role;\n+\n+  @Option(names = {\"-t\", \"--type\"},\n+      description = \"Filter certificate by the type: valid or revoked\",\n+      defaultValue = \"valid\", showDefaultValue = Visibility.ALWAYS)\n+  private String type;\n+\n+  private HddsProtos.NodeType parseCertRole(String r) {\n+    if (r.equalsIgnoreCase(\"om\")) {\n+      return HddsProtos.NodeType.OM;\n+    } else if (r.equalsIgnoreCase(\"scm\")) {\n+      return HddsProtos.NodeType.SCM;\n+    } else {\n+      return HddsProtos.NodeType.DATANODE;\n+    }\n+  }\n+\n+  private void printCert(X509Certificate cert) {\n+    LOG.info(\"{}\\t{}\\t{}\\t{}\", cert.getSerialNumber(), cert.getNotBefore(),\n+        cert.getNotAfter(), cert.getSubjectDN());\n+  }\n+\n+  @Override\n+  protected void execute(SCMSecurityProtocol client) throws IOException {\n+    boolean isRevoked = type.equalsIgnoreCase(\"revoked\");\n+    List<String> certPemList = client.listCertificate(\n+        parseCertRole(role), startSerialId, count, isRevoked);\n+    LOG.info(\"Total {} {} certificates: \", certPemList.size(), type);\n+    LOG.info(\"SerialNumber\\t\\tValid From\\t\\tExpiry\\t\\tSubject\");", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d54471123b321e074778e9a28263bc8531bdec5b"}, "originalPosition": 90}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NDM2OTE1Mg==", "bodyText": "Nit: would it be enough to check only the first certificate to save a few seconds?\nozone admin cert list |grep UTC|awk '{print $1}'| head -1 | xargs ozone admin cert info", "url": "https://github.com/apache/ozone/pull/1662#discussion_r544369152", "createdAt": "2020-12-16T15:01:32Z", "author": {"login": "adoroszlai"}, "path": "hadoop-ozone/dist/src/main/smoketest/security/admin-cert.robot", "diffHunk": "@@ -0,0 +1,44 @@\n+# Licensed to the Apache Software Foundation (ASF) under one or more\n+# contributor license agreements.  See the NOTICE file distributed with\n+# this work for additional information regarding copyright ownership.\n+# The ASF licenses this file to You under the Apache License, Version 2.0\n+# (the \"License\"); you may not use this file except in compliance with\n+# the License.  You may obtain a copy of the License at\n+#\n+#     http://www.apache.org/licenses/LICENSE-2.0\n+#\n+# Unless required by applicable law or agreed to in writing, software\n+# distributed under the License is distributed on an \"AS IS\" BASIS,\n+# WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+# See the License for the specific language governing permissions and\n+# limitations under the License.\n+\n+*** Settings ***\n+Documentation       Test for ozone admin cert command\n+Library             BuiltIn\n+Library             String\n+Resource            ../commonlib.robot\n+Resource            ../lib/os.robot\n+Resource            ../ozone-lib/shell.robot\n+Suite Setup         Setup Test\n+Test Timeout        5 minutes\n+\n+*** Variables ***\n+\n+*** Keywords ***\n+Setup Test\n+    Run Keyword     Kinit test user     testuser     testuser.keytab\n+\n+*** Test Cases ***\n+List valid certificates\n+    ${output} =      Execute    ozone admin cert list\n+                     Should Contain    ${output}    valid certificates\n+\n+List revoked certificates\n+    ${output} =      Execute    ozone admin cert list -t revoked\n+                     Should Contain    ${output}    Total 0 revoked certificates\n+\n+Info of the cert\n+    ${output} =      Execute   for id in $(ozone admin cert list |grep UTC|awk '{print $1}'); do ozone admin cert info $id; done", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d54471123b321e074778e9a28263bc8531bdec5b"}, "originalPosition": 42}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "9ba65d50a4c0ab9b5bd958ac7c664cd99c963d66", "author": {"user": {"login": "xiaoyuyao", "name": "Xiaoyu Yao"}}, "url": "https://github.com/apache/ozone/commit/9ba65d50a4c0ab9b5bd958ac7c664cd99c963d66", "committedDate": "2020-12-20T20:01:27Z", "message": "address additional code review comments."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "27aa2caafc6e7b82dc6ad3e63c3797e1087c44a5", "author": {"user": {"login": "xiaoyuyao", "name": "Xiaoyu Yao"}}, "url": "https://github.com/apache/ozone/commit/27aa2caafc6e7b82dc6ad3e63c3797e1087c44a5", "committedDate": "2020-12-20T22:39:11Z", "message": "remove unused import"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2032, "cost": 1, "resetAt": "2021-10-28T18:00:02Z"}}}