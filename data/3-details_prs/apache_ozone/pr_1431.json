{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDg4MzY1MTE2", "number": 1431, "title": "HDDS-4254. Bucket space: add usedBytes and update it when create and delete key.", "bodyText": "What changes were proposed in this pull request?\nIn addition, the current Quota setting does not take effect. HDDS-541 gives all the work needed to perfect Quota.\nThis PR is a subtask of HDDS-541.\nFirst, we increase usedBytes of Bucket. Later, we will judge whether the Bucket can be written based on this when we write the key.\nVolume has implemented increase usedBytes when write, and this is based on HDDS-4053.\nWhat is the link to the Apache JIRA\nhttps://issues.apache.org/jira/browse/HDDS-4254\nHow was this patch tested?\nadded UT", "createdAt": "2020-09-17T02:39:45Z", "url": "https://github.com/apache/ozone/pull/1431", "merged": true, "mergeCommit": {"oid": "a78a4b7891ca110b58172268290f43eeb5b9fd88"}, "closed": true, "closedAt": "2020-09-23T12:23:09Z", "author": {"login": "captainzmc"}, "timelineItems": {"totalCount": 6, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdJdgNfgH2gAyNDg4MzY1MTE2OmNjNTliNjcxNjc3Y2YwY2IyNDMwNjVmN2U2Y2E4MjQ1ODQ3MmY3NjQ=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdLkRUVAH2gAyNDg4MzY1MTE2OmU4OWFmNjk1NDFlY2I3ZGFjYmVmZWJhY2MzNmM4ODNiYjBhYjcxNzg=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "cc59b671677cf0cb243065f7e6ca82458472f764", "author": {"user": {"login": "captainzmc", "name": "micah zhao"}}, "url": "https://github.com/apache/ozone/commit/cc59b671677cf0cb243065f7e6ca82458472f764", "committedDate": "2020-09-16T14:44:59Z", "message": "add usedBytes to Bucket."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "99304b307551dc1e5aa418c4d83f3820416bb452", "author": {"user": {"login": "captainzmc", "name": "micah zhao"}}, "url": "https://github.com/apache/ozone/commit/99304b307551dc1e5aa418c4d83f3820416bb452", "committedDate": "2020-09-17T02:22:23Z", "message": "fix checkstyle"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDkzMzAyMzIx", "url": "https://github.com/apache/ozone/pull/1431#pullrequestreview-493302321", "createdAt": "2020-09-22T09:59:24Z", "commit": {"oid": "99304b307551dc1e5aa418c4d83f3820416bb452"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yMlQwOTo1OToyNFrOHVyzEA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yMlQwOTo1OToyNFrOHVyzEA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MjYxNDQxNg==", "bodyText": "the last two lines can be merged into one line.", "url": "https://github.com/apache/ozone/pull/1431#discussion_r492614416", "createdAt": "2020-09-22T09:59:24Z", "author": {"login": "ChenSammi"}, "path": "hadoop-ozone/ozone-manager/src/main/java/org/apache/hadoop/ozone/om/response/key/OMAllocateBlockResponse.java", "diffHunk": "@@ -72,5 +76,10 @@ public void addToDBBatch(OMMetadataManager omMetadataManager,\n     omMetadataManager.getVolumeTable().putWithBatch(batchOperation,\n         omMetadataManager.getVolumeKey(omVolumeArgs.getVolume()),\n         omVolumeArgs);\n+    // update bucket usedBytes.\n+    omMetadataManager.getBucketTable().putWithBatch(batchOperation,\n+        omMetadataManager.getBucketKey(omVolumeArgs.getVolume(),\n+            omBucketInfo.getBucketName()),\n+        omBucketInfo);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "99304b307551dc1e5aa418c4d83f3820416bb452"}, "originalPosition": 34}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDkzMzAyNTk5", "url": "https://github.com/apache/ozone/pull/1431#pullrequestreview-493302599", "createdAt": "2020-09-22T09:59:46Z", "commit": {"oid": "99304b307551dc1e5aa418c4d83f3820416bb452"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yMlQwOTo1OTo0NlrOHVyz5w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yMlQwOTo1OTo0NlrOHVyz5w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MjYxNDYzMQ==", "bodyText": "same as above.", "url": "https://github.com/apache/ozone/pull/1431#discussion_r492614631", "createdAt": "2020-09-22T09:59:46Z", "author": {"login": "ChenSammi"}, "path": "hadoop-ozone/ozone-manager/src/main/java/org/apache/hadoop/ozone/om/response/key/OMKeyCommitResponse.java", "diffHunk": "@@ -77,6 +80,11 @@ public void addToDBBatch(OMMetadataManager omMetadataManager,\n     omMetadataManager.getVolumeTable().putWithBatch(batchOperation,\n         omMetadataManager.getVolumeKey(omVolumeArgs.getVolume()),\n         omVolumeArgs);\n+    // update bucket usedBytes.\n+    omMetadataManager.getBucketTable().putWithBatch(batchOperation,\n+        omMetadataManager.getBucketKey(omVolumeArgs.getVolume(),\n+            omBucketInfo.getBucketName()),\n+        omBucketInfo);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "99304b307551dc1e5aa418c4d83f3820416bb452"}, "originalPosition": 35}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDkzMzAyODk2", "url": "https://github.com/apache/ozone/pull/1431#pullrequestreview-493302896", "createdAt": "2020-09-22T10:00:10Z", "commit": {"oid": "99304b307551dc1e5aa418c4d83f3820416bb452"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yMlQxMDowMDoxMFrOHVy04Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yMlQxMDowMDoxMFrOHVy04Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MjYxNDg4MQ==", "bodyText": "the same. please double check the rest files.", "url": "https://github.com/apache/ozone/pull/1431#discussion_r492614881", "createdAt": "2020-09-22T10:00:10Z", "author": {"login": "ChenSammi"}, "path": "hadoop-ozone/ozone-manager/src/main/java/org/apache/hadoop/ozone/om/response/key/OMKeyCreateResponse.java", "diffHunk": "@@ -99,6 +103,11 @@ protected void addToDBBatch(OMMetadataManager omMetadataManager,\n     omMetadataManager.getVolumeTable().putWithBatch(batchOperation,\n         omMetadataManager.getVolumeKey(omVolumeArgs.getVolume()),\n         omVolumeArgs);\n+    // update bucket usedBytes.\n+    omMetadataManager.getBucketTable().putWithBatch(batchOperation,\n+        omMetadataManager.getBucketKey(omVolumeArgs.getVolume(),\n+            omBucketInfo.getBucketName()),\n+        omBucketInfo);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "99304b307551dc1e5aa418c4d83f3820416bb452"}, "originalPosition": 36}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e89af69541ecb7dacbefebacc36c883bb0ab7178", "author": {"user": {"login": "captainzmc", "name": "micah zhao"}}, "url": "https://github.com/apache/ozone/commit/e89af69541ecb7dacbefebacc36c883bb0ab7178", "committedDate": "2020-09-23T03:45:54Z", "message": "fix code style"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2540, "cost": 1, "resetAt": "2021-10-28T18:00:02Z"}}}