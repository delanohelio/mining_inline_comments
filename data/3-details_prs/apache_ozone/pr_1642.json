{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTMwMTMxODI1", "number": 1642, "title": "HDDS-4519. Return forbidden instead of interval server error from s3g\u2026", "bodyText": "https://issues.apache.org/jira/browse/HDDS-4519\nCurrently s3g will return \"internal server error\" when user doesn't have the permission to access the resource.\nThis task is to return HTTP 403 FORBIDDEN in this case.", "createdAt": "2020-12-01T08:52:27Z", "url": "https://github.com/apache/ozone/pull/1642", "merged": true, "mergeCommit": {"oid": "09579756b0756fcaf1b22b860c1ee1eb927e82c2"}, "closed": true, "closedAt": "2020-12-15T07:41:27Z", "author": {"login": "ChenSammi"}, "timelineItems": {"totalCount": 9, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdh17VlgH2gAyNTMwMTMxODI1OmJiYTFhODQ3OTMyMzk4MjgyOWUxMDE4Mjg0MzBkOTY4MzE2ZDU4MDE=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdmOzA8gFqTU1MjAwMjE3NQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "bba1a8479323982829e101828430d968316d5801", "author": {"user": {"login": "ChenSammi", "name": "Sammi Chen"}}, "url": "https://github.com/apache/ozone/commit/bba1a8479323982829e101828430d968316d5801", "committedDate": "2020-12-01T08:46:31Z", "message": "HDDS-4519. Return forbidden instead of interval server error from s3g when user doesn't have the resouce permission."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTQxNzY4Nzc2", "url": "https://github.com/apache/ozone/pull/1642#pullrequestreview-541768776", "createdAt": "2020-12-01T10:40:45Z", "commit": {"oid": "bba1a8479323982829e101828430d968316d5801"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "748aab07b64d917237ebec8c912df054508d34db", "author": {"user": {"login": "ChenSammi", "name": "Sammi Chen"}}, "url": "https://github.com/apache/ozone/commit/748aab07b64d917237ebec8c912df054508d34db", "committedDate": "2020-12-03T12:28:19Z", "message": "Fix checkstyle; Add more test cases"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTQ0NjYzNzc3", "url": "https://github.com/apache/ozone/pull/1642#pullrequestreview-544663777", "createdAt": "2020-12-04T05:19:27Z", "commit": {"oid": "748aab07b64d917237ebec8c912df054508d34db"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0wNFQwNToxOToyN1rOH_BQ_A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0wNFQwNToxOToyN1rOH_BQ_A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNTg0MzA2OA==", "bodyText": "Any specific reason for throwing RuntimeException here?", "url": "https://github.com/apache/ozone/pull/1642#discussion_r535843068", "createdAt": "2020-12-04T05:19:27Z", "author": {"login": "bharatviswa504"}, "path": "hadoop-ozone/client/src/main/java/org/apache/hadoop/ozone/client/OzoneBucket.java", "diffHunk": "@@ -780,7 +780,12 @@ public OzoneMultipartUploadList listMultipartUploads(String prefix)\n     @Override\n     public boolean hasNext() {\n       if(!currentIterator.hasNext() && currentValue != null) {\n-        currentIterator = getNextListOfKeys(currentValue.getName()).iterator();\n+        try {\n+          currentIterator =\n+              getNextListOfKeys(currentValue.getName()).iterator();\n+        } catch (IOException e) {\n+          throw new RuntimeException(e);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "748aab07b64d917237ebec8c912df054508d34db"}, "originalPosition": 45}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTQ0Njc1MjMy", "url": "https://github.com/apache/ozone/pull/1642#pullrequestreview-544675232", "createdAt": "2020-12-04T05:55:30Z", "commit": {"oid": "748aab07b64d917237ebec8c912df054508d34db"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0wNFQwNTo1NTozMFrOH_B-Sw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0wNFQwNTo1NTozMFrOH_B-Sw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNTg1NDY2Nw==", "bodyText": "Do we think, we want to change it to AccessDenied, to be closer to S3\nhttps://docs.aws.amazon.com/AmazonS3/latest/API/ErrorResponses.html#RESTErrorResponses\nAccessDenied 403\nhttps://aws.amazon.com/premiumsupport/knowledge-center/s3-troubleshoot-403/ Even though we don't have S3 Acls, Ozone Acls causing this, but to be close to S3 I think error code having same might be better here IMHO.", "url": "https://github.com/apache/ozone/pull/1642#discussion_r535854667", "createdAt": "2020-12-04T05:55:30Z", "author": {"login": "bharatviswa504"}, "path": "hadoop-ozone/s3gateway/src/main/java/org/apache/hadoop/ozone/s3/exception/S3ErrorTable.java", "diffHunk": "@@ -105,6 +106,9 @@ private S3ErrorTable() {\n       \"InternalError\", \"We encountered an internal error. Please try again.\",\n       HTTP_SERVER_ERROR);\n \n+  public static final OS3Exception PERMISSION_DENIED = new OS3Exception(", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "748aab07b64d917237ebec8c912df054508d34db"}, "originalPosition": 12}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTQ0Njc1ODk4", "url": "https://github.com/apache/ozone/pull/1642#pullrequestreview-544675898", "createdAt": "2020-12-04T05:57:28Z", "commit": {"oid": "748aab07b64d917237ebec8c912df054508d34db"}, "state": "COMMENTED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTQ1NTkzNDAw", "url": "https://github.com/apache/ozone/pull/1642#pullrequestreview-545593400", "createdAt": "2020-12-05T15:02:02Z", "commit": {"oid": "748aab07b64d917237ebec8c912df054508d34db"}, "state": "COMMENTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0wNVQxNTowMjowMlrOH_79cg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0wNVQxNTowMjo1MFrOH_7-CQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNjgwNDcyMg==", "bodyText": "+1 for return 403", "url": "https://github.com/apache/ozone/pull/1642#discussion_r536804722", "createdAt": "2020-12-05T15:02:02Z", "author": {"login": "xiaoyuyao"}, "path": "hadoop-ozone/s3gateway/src/main/java/org/apache/hadoop/ozone/s3/exception/S3ErrorTable.java", "diffHunk": "@@ -105,6 +106,9 @@ private S3ErrorTable() {\n       \"InternalError\", \"We encountered an internal error. Please try again.\",\n       HTTP_SERVER_ERROR);\n \n+  public static final OS3Exception PERMISSION_DENIED = new OS3Exception(", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNTg1NDY2Nw=="}, "originalCommit": {"oid": "748aab07b64d917237ebec8c912df054508d34db"}, "originalPosition": 12}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNjgwNDg3Mw==", "bodyText": "Is it possible to have a common helper that does the OM result code => s3 error translation?", "url": "https://github.com/apache/ozone/pull/1642#discussion_r536804873", "createdAt": "2020-12-05T15:02:50Z", "author": {"login": "xiaoyuyao"}, "path": "hadoop-ozone/s3gateway/src/main/java/org/apache/hadoop/ozone/s3/endpoint/ObjectEndpoint.java", "diffHunk": "@@ -619,6 +631,9 @@ private Response createMultipartKey(String bucket, String key, long length,\n       if (ex.getResult() == ResultCodes.NO_SUCH_MULTIPART_UPLOAD_ERROR) {\n         throw S3ErrorTable.newError(NO_SUCH_UPLOAD,\n             uploadID);\n+      } else if (ex.getResult() == ResultCodes.PERMISSION_DENIED) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "748aab07b64d917237ebec8c912df054508d34db"}, "originalPosition": 55}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d4cd1f88a245a25643827628dd23f70298280fb5", "author": {"user": {"login": "ChenSammi", "name": "Sammi Chen"}}, "url": "https://github.com/apache/ozone/commit/d4cd1f88a245a25643827628dd23f70298280fb5", "committedDate": "2020-12-10T03:48:50Z", "message": "address comments"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTUyMDAyMTc1", "url": "https://github.com/apache/ozone/pull/1642#pullrequestreview-552002175", "createdAt": "2020-12-15T00:00:45Z", "commit": {"oid": "d4cd1f88a245a25643827628dd23f70298280fb5"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1997, "cost": 1, "resetAt": "2021-10-28T18:00:02Z"}}}