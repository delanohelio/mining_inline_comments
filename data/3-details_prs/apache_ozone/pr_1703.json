{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTQwMjEwMDI1", "number": 1703, "title": "HDDS-4591. BasicOzoneFileSystem reports StorageUnit class not found.", "bodyText": "https://issues.apache.org/jira/browse/HDDS-4591", "createdAt": "2020-12-15T12:21:55Z", "url": "https://github.com/apache/ozone/pull/1703", "merged": true, "mergeCommit": {"oid": "de20e8c1eaae37235fa1f2f91cc3e588eacfb354"}, "closed": true, "closedAt": "2020-12-16T09:37:26Z", "author": {"login": "ChenSammi"}, "timelineItems": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdmZXd6gH2gAyNTQwMjEwMDI1OjVkNTA3MDk0YTViYWEyNzg1OTE0ZmE5ZWQwMzZmMGQ5NjZkNDMxOWY=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdmrpCdAFqTU1MzUwNzM3NQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "5d507094a5baa2785914fa9ed036f0d966d4319f", "author": {"user": {"login": "ChenSammi", "name": "Sammi Chen"}}, "url": "https://github.com/apache/ozone/commit/5d507094a5baa2785914fa9ed036f0d966d4319f", "committedDate": "2020-12-15T12:19:37Z", "message": "HDDS-4591. BasicOzoneFileSystem reports StorageUnit class not found."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTUyNzgyMDIz", "url": "https://github.com/apache/ozone/pull/1703#pullrequestreview-552782023", "createdAt": "2020-12-15T19:08:13Z", "commit": {"oid": "5d507094a5baa2785914fa9ed036f0d966d4319f"}, "state": "COMMENTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xNVQxOTowODoxNFrOIGbhVA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xNVQxOTowODo1MFrOIGbi6g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MzYxMzI2OA==", "bodyText": "NIT: can we wrap this as a helper function as I can see the initialize() has similar logic.", "url": "https://github.com/apache/ozone/pull/1703#discussion_r543613268", "createdAt": "2020-12-15T19:08:14Z", "author": {"login": "xiaoyuyao"}, "path": "hadoop-ozone/ozonefs-common/src/main/java/org/apache/hadoop/fs/ozone/BasicOzoneFileSystem.java", "diffHunk": "@@ -703,7 +703,14 @@ public boolean mkdirs(Path f, FsPermission permission) throws IOException {\n \n   @Override\n   public long getDefaultBlockSize() {\n-    return (long) getConf().getStorageSize(\n+    Configuration conf = getConf();\n+    ConfigurationSource source;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "5d507094a5baa2785914fa9ed036f0d966d4319f"}, "originalPosition": 22}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MzYxMzY3NA==", "bodyText": "We need a fix for this in BasicRootedOzoneFileSystem#getDefaultBlockSize() as well.", "url": "https://github.com/apache/ozone/pull/1703#discussion_r543613674", "createdAt": "2020-12-15T19:08:50Z", "author": {"login": "xiaoyuyao"}, "path": "hadoop-ozone/ozonefs-common/src/main/java/org/apache/hadoop/fs/ozone/BasicOzoneFileSystem.java", "diffHunk": "@@ -703,7 +703,14 @@ public boolean mkdirs(Path f, FsPermission permission) throws IOException {\n \n   @Override\n   public long getDefaultBlockSize() {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "5d507094a5baa2785914fa9ed036f0d966d4319f"}, "originalPosition": 19}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTUyNzgyNTEx", "url": "https://github.com/apache/ozone/pull/1703#pullrequestreview-552782511", "createdAt": "2020-12-15T19:08:51Z", "commit": {"oid": "5d507094a5baa2785914fa9ed036f0d966d4319f"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xNVQxOTowODo1MVrOIGbi9Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xNVQxOTowODo1MVrOIGbi9Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MzYxMzY4NQ==", "bodyText": "Instead of duplicating this logic from initialize:\n\n  \n    \n      ozone/hadoop-ozone/ozonefs-common/src/main/java/org/apache/hadoop/fs/ozone/BasicOzoneFileSystem.java\n    \n    \n        Lines 161 to 166\n      in\n      0957975\n    \n    \n    \n    \n\n        \n          \n           ConfigurationSource source; \n        \n\n        \n          \n           if (conf instanceof OzoneConfiguration) { \n        \n\n        \n          \n             source = (ConfigurationSource) conf; \n        \n\n        \n          \n           } else { \n        \n\n        \n          \n             source = new LegacyHadoopConfigurationSource(conf); \n        \n\n        \n          \n           } \n        \n    \n  \n\n\nI think it would be cleaner to store this ConfigurationSource\n\neither in BasicOzoneFileSystem\nor in BasicOzoneClientAdapterImpl (and expose it via accessor method)\n\nand then use it here.", "url": "https://github.com/apache/ozone/pull/1703#discussion_r543613685", "createdAt": "2020-12-15T19:08:51Z", "author": {"login": "adoroszlai"}, "path": "hadoop-ozone/ozonefs-common/src/main/java/org/apache/hadoop/fs/ozone/BasicOzoneFileSystem.java", "diffHunk": "@@ -703,7 +703,14 @@ public boolean mkdirs(Path f, FsPermission permission) throws IOException {\n \n   @Override\n   public long getDefaultBlockSize() {\n-    return (long) getConf().getStorageSize(\n+    Configuration conf = getConf();\n+    ConfigurationSource source;\n+    if (conf instanceof OzoneConfiguration) {\n+      source = (ConfigurationSource) conf;\n+    } else {\n+      source = new LegacyHadoopConfigurationSource(conf);\n+    }", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "5d507094a5baa2785914fa9ed036f0d966d4319f"}, "originalPosition": 27}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "9ebf8317659876d9850d7d41a1258b2876871a28", "author": {"user": {"login": "ChenSammi", "name": "Sammi Chen"}}, "url": "https://github.com/apache/ozone/commit/9ebf8317659876d9850d7d41a1258b2876871a28", "committedDate": "2020-12-16T06:31:51Z", "message": "address comments"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTUzNTA3Mzc1", "url": "https://github.com/apache/ozone/pull/1703#pullrequestreview-553507375", "createdAt": "2020-12-16T09:37:06Z", "commit": {"oid": "9ebf8317659876d9850d7d41a1258b2876871a28"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2133, "cost": 1, "resetAt": "2021-10-28T18:00:02Z"}}}