{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDM0NzczMzQz", "number": 1078, "reviewThreads": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xNlQyMTozMjoxOFrOEGHbXg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xNlQyMTozMjoxOFrOEGHbXg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjc0ODQ4NjA2OnYy", "diffSide": "LEFT", "path": "hadoop-hdds/client/src/main/java/org/apache/hadoop/hdds/scm/XceiverClientGrpc.java", "isResolved": true, "comments": {"totalCount": 6, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xNlQyMTozMjoxOFrOGkt70Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xOVQyMDo0NjowMVrOGmg2gQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTE1NDUxMw==", "bodyText": "Good catch @sodonnel . The fix LGTM overall. I just have one question:\nHave you consider populating blockID properly for the first getBlock() call with additional else if on the top?\nelse if (request.getCmdType() == ContainerProtos.Type.GetBlock) {\nblockID = request.getGetBlock().getBlockID();\n}", "url": "https://github.com/apache/ozone/pull/1078#discussion_r441154513", "createdAt": "2020-06-16T21:32:18Z", "author": {"login": "xiaoyuyao"}, "path": "hadoop-hdds/client/src/main/java/org/apache/hadoop/hdds/scm/XceiverClientGrpc.java", "diffHunk": "@@ -314,15 +314,17 @@ private XceiverClientReply sendCommandWithRetry(\n           // Pull the Cached DN to the top of the DN list\n           Collections.swap(datanodeList, 0, getBlockDNCacheIndex);\n         }\n-      } else if (topologyAwareRead) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "99ef7a27975e0cc475c3b8caf7895054e0a60244"}, "originalPosition": 4}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTE2ODE2Nw==", "bodyText": "Yea, I did wonder why getBlock() is not part of that IF block. I guess it makes sense to add it in just in case, as it will do no harm.\nI am not really fully up-to-speed on the read path from the Ozone client - would it be normal for several getblock calls to be made against the same pipeline (XceiverClientGrpc instance)? Ie do we expect getBlock to benefit from the cached connection sometimes?", "url": "https://github.com/apache/ozone/pull/1078#discussion_r441168167", "createdAt": "2020-06-16T22:04:10Z", "author": {"login": "sodonnel"}, "path": "hadoop-hdds/client/src/main/java/org/apache/hadoop/hdds/scm/XceiverClientGrpc.java", "diffHunk": "@@ -314,15 +314,17 @@ private XceiverClientReply sendCommandWithRetry(\n           // Pull the Cached DN to the top of the DN list\n           Collections.swap(datanodeList, 0, getBlockDNCacheIndex);\n         }\n-      } else if (topologyAwareRead) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTE1NDUxMw=="}, "originalCommit": {"oid": "99ef7a27975e0cc475c3b8caf7895054e0a60244"}, "originalPosition": 4}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTMwMzE3Mg==", "bodyText": "Yea, I did wonder why getBlock() is not part of that IF block. I guess it makes sense to add it in just in case, as it will do no harm.\nI am not really fully up-to-speed on the read path from the Ozone client - would it be normal for several getblock calls to be made against the same pipeline (XceiverClientGrpc instance)? Ie do we expect getBlock to benefit from the cached connection sometimes?\n\nYes, it is quite possible to use the same XceiverClientGrpc instanvce to read for multiple blocks for multiple keys.", "url": "https://github.com/apache/ozone/pull/1078#discussion_r441303172", "createdAt": "2020-06-17T06:13:39Z", "author": {"login": "bshashikant"}, "path": "hadoop-hdds/client/src/main/java/org/apache/hadoop/hdds/scm/XceiverClientGrpc.java", "diffHunk": "@@ -314,15 +314,17 @@ private XceiverClientReply sendCommandWithRetry(\n           // Pull the Cached DN to the top of the DN list\n           Collections.swap(datanodeList, 0, getBlockDNCacheIndex);\n         }\n-      } else if (topologyAwareRead) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTE1NDUxMw=="}, "originalCommit": {"oid": "99ef7a27975e0cc475c3b8caf7895054e0a60244"}, "originalPosition": 4}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTQwOTcwNw==", "bodyText": "Thanks for the feedback. I have made this change, so pending a clean CI run please give it a check.", "url": "https://github.com/apache/ozone/pull/1078#discussion_r441409707", "createdAt": "2020-06-17T09:26:47Z", "author": {"login": "sodonnel"}, "path": "hadoop-hdds/client/src/main/java/org/apache/hadoop/hdds/scm/XceiverClientGrpc.java", "diffHunk": "@@ -314,15 +314,17 @@ private XceiverClientReply sendCommandWithRetry(\n           // Pull the Cached DN to the top of the DN list\n           Collections.swap(datanodeList, 0, getBlockDNCacheIndex);\n         }\n-      } else if (topologyAwareRead) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTE1NDUxMw=="}, "originalCommit": {"oid": "99ef7a27975e0cc475c3b8caf7895054e0a60244"}, "originalPosition": 4}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MjIwOTk4Mw==", "bodyText": "@xiaoyuyao @bshashikant Are you happy with the revision and for me to commit this one? Thanks.", "url": "https://github.com/apache/ozone/pull/1078#discussion_r442209983", "createdAt": "2020-06-18T13:05:00Z", "author": {"login": "sodonnel"}, "path": "hadoop-hdds/client/src/main/java/org/apache/hadoop/hdds/scm/XceiverClientGrpc.java", "diffHunk": "@@ -314,15 +314,17 @@ private XceiverClientReply sendCommandWithRetry(\n           // Pull the Cached DN to the top of the DN list\n           Collections.swap(datanodeList, 0, getBlockDNCacheIndex);\n         }\n-      } else if (topologyAwareRead) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTE1NDUxMw=="}, "originalCommit": {"oid": "99ef7a27975e0cc475c3b8caf7895054e0a60244"}, "originalPosition": 4}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MzAzNzMxMw==", "bodyText": "LGTM, +1.", "url": "https://github.com/apache/ozone/pull/1078#discussion_r443037313", "createdAt": "2020-06-19T20:46:01Z", "author": {"login": "xiaoyuyao"}, "path": "hadoop-hdds/client/src/main/java/org/apache/hadoop/hdds/scm/XceiverClientGrpc.java", "diffHunk": "@@ -314,15 +314,17 @@ private XceiverClientReply sendCommandWithRetry(\n           // Pull the Cached DN to the top of the DN list\n           Collections.swap(datanodeList, 0, getBlockDNCacheIndex);\n         }\n-      } else if (topologyAwareRead) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTE1NDUxMw=="}, "originalCommit": {"oid": "99ef7a27975e0cc475c3b8caf7895054e0a60244"}, "originalPosition": 4}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4063, "cost": 1, "resetAt": "2021-11-12T11:57:46Z"}}}