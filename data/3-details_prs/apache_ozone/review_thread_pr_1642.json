{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTMwMTMxODI1", "number": 1642, "reviewThreads": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0wNFQwNToxOToyN1rOFAoXGQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0wNVQxNTowMjo1MFrOFBQUaA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzM2MjA1NTkzOnYy", "diffSide": "RIGHT", "path": "hadoop-ozone/client/src/main/java/org/apache/hadoop/ozone/client/OzoneBucket.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0wNFQwNToxOToyN1rOH_BQ_A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0wNFQwNToyMzo1NFrOH_BWbA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNTg0MzA2OA==", "bodyText": "Any specific reason for throwing RuntimeException here?", "url": "https://github.com/apache/ozone/pull/1642#discussion_r535843068", "createdAt": "2020-12-04T05:19:27Z", "author": {"login": "bharatviswa504"}, "path": "hadoop-ozone/client/src/main/java/org/apache/hadoop/ozone/client/OzoneBucket.java", "diffHunk": "@@ -780,7 +780,12 @@ public OzoneMultipartUploadList listMultipartUploads(String prefix)\n     @Override\n     public boolean hasNext() {\n       if(!currentIterator.hasNext() && currentValue != null) {\n-        currentIterator = getNextListOfKeys(currentValue.getName()).iterator();\n+        try {\n+          currentIterator =\n+              getNextListOfKeys(currentValue.getName()).iterator();\n+        } catch (IOException e) {\n+          throw new RuntimeException(e);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "748aab07b64d917237ebec8c912df054508d34db"}, "originalPosition": 45}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNTg0NDQ2MA==", "bodyText": "I see the current code is doing the same. Do you think we need to change here to handle error? (Not related to this PR BTW). I see the reason as hasNext() does not throw any exception.", "url": "https://github.com/apache/ozone/pull/1642#discussion_r535844460", "createdAt": "2020-12-04T05:23:54Z", "author": {"login": "bharatviswa504"}, "path": "hadoop-ozone/client/src/main/java/org/apache/hadoop/ozone/client/OzoneBucket.java", "diffHunk": "@@ -780,7 +780,12 @@ public OzoneMultipartUploadList listMultipartUploads(String prefix)\n     @Override\n     public boolean hasNext() {\n       if(!currentIterator.hasNext() && currentValue != null) {\n-        currentIterator = getNextListOfKeys(currentValue.getName()).iterator();\n+        try {\n+          currentIterator =\n+              getNextListOfKeys(currentValue.getName()).iterator();\n+        } catch (IOException e) {\n+          throw new RuntimeException(e);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNTg0MzA2OA=="}, "originalCommit": {"oid": "748aab07b64d917237ebec8c912df054508d34db"}, "originalPosition": 45}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzM2MjE0MDM1OnYy", "diffSide": "RIGHT", "path": "hadoop-ozone/s3gateway/src/main/java/org/apache/hadoop/ozone/s3/exception/S3ErrorTable.java", "isResolved": false, "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0wNFQwNTo1NTozMFrOH_B-Sw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xMFQwMjo0MDoyOVrOICy1wA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNTg1NDY2Nw==", "bodyText": "Do we think, we want to change it to AccessDenied, to be closer to S3\nhttps://docs.aws.amazon.com/AmazonS3/latest/API/ErrorResponses.html#RESTErrorResponses\nAccessDenied 403\nhttps://aws.amazon.com/premiumsupport/knowledge-center/s3-troubleshoot-403/ Even though we don't have S3 Acls, Ozone Acls causing this, but to be close to S3 I think error code having same might be better here IMHO.", "url": "https://github.com/apache/ozone/pull/1642#discussion_r535854667", "createdAt": "2020-12-04T05:55:30Z", "author": {"login": "bharatviswa504"}, "path": "hadoop-ozone/s3gateway/src/main/java/org/apache/hadoop/ozone/s3/exception/S3ErrorTable.java", "diffHunk": "@@ -105,6 +106,9 @@ private S3ErrorTable() {\n       \"InternalError\", \"We encountered an internal error. Please try again.\",\n       HTTP_SERVER_ERROR);\n \n+  public static final OS3Exception PERMISSION_DENIED = new OS3Exception(", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "748aab07b64d917237ebec8c912df054508d34db"}, "originalPosition": 12}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNjgwNDcyMg==", "bodyText": "+1 for return 403", "url": "https://github.com/apache/ozone/pull/1642#discussion_r536804722", "createdAt": "2020-12-05T15:02:02Z", "author": {"login": "xiaoyuyao"}, "path": "hadoop-ozone/s3gateway/src/main/java/org/apache/hadoop/ozone/s3/exception/S3ErrorTable.java", "diffHunk": "@@ -105,6 +106,9 @@ private S3ErrorTable() {\n       \"InternalError\", \"We encountered an internal error. Please try again.\",\n       HTTP_SERVER_ERROR);\n \n+  public static final OS3Exception PERMISSION_DENIED = new OS3Exception(", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNTg1NDY2Nw=="}, "originalCommit": {"oid": "748aab07b64d917237ebec8c912df054508d34db"}, "originalPosition": 12}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzOTgwMTAyNA==", "bodyText": "Good catch, I will change the description to \"AccessDenied\".\nAlthough where are multiple Error Codes map to  \"HTTP 403 Forbidden\" ,  \"AccessDenied\" is the most appropriate description for this ACL case.\nhttps://docs.aws.amazon.com/AmazonS3/latest/API/ErrorResponses.html#RESTErrorResponses", "url": "https://github.com/apache/ozone/pull/1642#discussion_r539801024", "createdAt": "2020-12-10T02:40:29Z", "author": {"login": "ChenSammi"}, "path": "hadoop-ozone/s3gateway/src/main/java/org/apache/hadoop/ozone/s3/exception/S3ErrorTable.java", "diffHunk": "@@ -105,6 +106,9 @@ private S3ErrorTable() {\n       \"InternalError\", \"We encountered an internal error. Please try again.\",\n       HTTP_SERVER_ERROR);\n \n+  public static final OS3Exception PERMISSION_DENIED = new OS3Exception(", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNTg1NDY2Nw=="}, "originalCommit": {"oid": "748aab07b64d917237ebec8c912df054508d34db"}, "originalPosition": 12}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzM2ODYwMjY0OnYy", "diffSide": "RIGHT", "path": "hadoop-ozone/s3gateway/src/main/java/org/apache/hadoop/ozone/s3/endpoint/ObjectEndpoint.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0wNVQxNTowMjo1MFrOH_7-CQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xMFQwMzowMjo1NVrOICzT3w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNjgwNDg3Mw==", "bodyText": "Is it possible to have a common helper that does the OM result code => s3 error translation?", "url": "https://github.com/apache/ozone/pull/1642#discussion_r536804873", "createdAt": "2020-12-05T15:02:50Z", "author": {"login": "xiaoyuyao"}, "path": "hadoop-ozone/s3gateway/src/main/java/org/apache/hadoop/ozone/s3/endpoint/ObjectEndpoint.java", "diffHunk": "@@ -619,6 +631,9 @@ private Response createMultipartKey(String bucket, String key, long length,\n       if (ex.getResult() == ResultCodes.NO_SUCH_MULTIPART_UPLOAD_ERROR) {\n         throw S3ErrorTable.newError(NO_SUCH_UPLOAD,\n             uploadID);\n+      } else if (ex.getResult() == ResultCodes.PERMISSION_DENIED) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "748aab07b64d917237ebec8c912df054508d34db"}, "originalPosition": 55}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzOTgwODczNQ==", "bodyText": "In long term\uff0cit's good to have such a mapping table.\nBut there are many details need further discussion, for example, a error response has HTTP error code and s3 error code.  Multiple s3 error codse will map to the same HTTP error code.\nSome OM result codes, like QUOTA_EXCEEDED, I quickly go through all HTTP codes, didn't find a perfect match code.\nOther OM result codes, such as NOT_SUPPORTED_OPERATION, is just translated to \"interval error\" in s3g.", "url": "https://github.com/apache/ozone/pull/1642#discussion_r539808735", "createdAt": "2020-12-10T03:02:55Z", "author": {"login": "ChenSammi"}, "path": "hadoop-ozone/s3gateway/src/main/java/org/apache/hadoop/ozone/s3/endpoint/ObjectEndpoint.java", "diffHunk": "@@ -619,6 +631,9 @@ private Response createMultipartKey(String bucket, String key, long length,\n       if (ex.getResult() == ResultCodes.NO_SUCH_MULTIPART_UPLOAD_ERROR) {\n         throw S3ErrorTable.newError(NO_SUCH_UPLOAD,\n             uploadID);\n+      } else if (ex.getResult() == ResultCodes.PERMISSION_DENIED) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNjgwNDg3Mw=="}, "originalCommit": {"oid": "748aab07b64d917237ebec8c912df054508d34db"}, "originalPosition": 55}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4539, "cost": 1, "resetAt": "2021-11-12T11:57:46Z"}}}