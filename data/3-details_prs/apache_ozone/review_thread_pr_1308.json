{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDY1NDgwMzE2", "number": 1308, "reviewThreads": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xMFQxNToxMToyOVrOEW1edQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xMFQxNToxMToyOVrOEW1edQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjkyMzgwMjc3OnYy", "diffSide": "RIGHT", "path": "hadoop-hdds/common/src/test/java/org/apache/hadoop/ozone/audit/TestOzoneAuditLogger.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xMFQxNToxMToyOVrOG-S1lA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xMVQwNToxNzowN1rOG-orqA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2Nzk3MzUyNA==", "bodyText": "at ...TestOzoneAuditLogger.java:160\nThis is very fragile.  Any code change above line 160 (as benign as changing imports or whitespace) might break it.  Can you please omit the check for line number?", "url": "https://github.com/apache/ozone/pull/1308#discussion_r467973524", "createdAt": "2020-08-10T15:11:29Z", "author": {"login": "adoroszlai"}, "path": "hadoop-hdds/common/src/test/java/org/apache/hadoop/ozone/audit/TestOzoneAuditLogger.java", "diffHunk": "@@ -143,7 +150,35 @@ public void notLogReadEvents() throws IOException {\n     verifyNoLog();\n   }\n \n-  private void verifyLog(String expected) throws IOException {\n+  /**\n+   * Test to verify if multiline entries can be checked.\n+   */\n+\n+  @Test\n+  public void messageIncludesMultilineException() throws IOException {\n+    String exceptionMessage = \"Dummy exception message\";\n+    TestException testException = new TestException(exceptionMessage);\n+    AuditMessage exceptionAuditMessage =\n+        new AuditMessage.Builder()\n+            .setUser(USER)\n+            .atIp(IP_ADDRESS)\n+            .forOperation(DummyAction.CREATE_VOLUME)\n+            .withParams(PARAMS)\n+            .withResult(FAILURE)\n+            .withException(testException).build();\n+    AUDIT.logWriteFailure(exceptionAuditMessage);\n+    verifyLog(\n+        \"ERROR | OMAudit | user=john | \"\n+            + \"ip=192.168.0.1 | op=CREATE_VOLUME \"\n+            + \"{key1=value1, key2=value2} | ret=FAILURE\",\n+        \"org.apache.hadoop.ozone.audit.\"\n+            + \"TestOzoneAuditLogger$TestException: Dummy exception message\",\n+        \"at org.apache.hadoop.ozone.audit.TestOzoneAuditLogger\"\n+            + \".messageIncludesMultilineException\"\n+            + \"(TestOzoneAuditLogger.java:160) [test-classes/:?]\");", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "29efbc9e57bf4bbb67dccd930641cfa540dd4691"}, "originalPosition": 51}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2ODMzMTQzMg==", "bodyText": "@adoroszlai indeed, thank you for pointing that out. Fixed in latest commit.", "url": "https://github.com/apache/ozone/pull/1308#discussion_r468331432", "createdAt": "2020-08-11T05:17:07Z", "author": {"login": "llemec"}, "path": "hadoop-hdds/common/src/test/java/org/apache/hadoop/ozone/audit/TestOzoneAuditLogger.java", "diffHunk": "@@ -143,7 +150,35 @@ public void notLogReadEvents() throws IOException {\n     verifyNoLog();\n   }\n \n-  private void verifyLog(String expected) throws IOException {\n+  /**\n+   * Test to verify if multiline entries can be checked.\n+   */\n+\n+  @Test\n+  public void messageIncludesMultilineException() throws IOException {\n+    String exceptionMessage = \"Dummy exception message\";\n+    TestException testException = new TestException(exceptionMessage);\n+    AuditMessage exceptionAuditMessage =\n+        new AuditMessage.Builder()\n+            .setUser(USER)\n+            .atIp(IP_ADDRESS)\n+            .forOperation(DummyAction.CREATE_VOLUME)\n+            .withParams(PARAMS)\n+            .withResult(FAILURE)\n+            .withException(testException).build();\n+    AUDIT.logWriteFailure(exceptionAuditMessage);\n+    verifyLog(\n+        \"ERROR | OMAudit | user=john | \"\n+            + \"ip=192.168.0.1 | op=CREATE_VOLUME \"\n+            + \"{key1=value1, key2=value2} | ret=FAILURE\",\n+        \"org.apache.hadoop.ozone.audit.\"\n+            + \"TestOzoneAuditLogger$TestException: Dummy exception message\",\n+        \"at org.apache.hadoop.ozone.audit.TestOzoneAuditLogger\"\n+            + \".messageIncludesMultilineException\"\n+            + \"(TestOzoneAuditLogger.java:160) [test-classes/:?]\");", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2Nzk3MzUyNA=="}, "originalCommit": {"oid": "29efbc9e57bf4bbb67dccd930641cfa540dd4691"}, "originalPosition": 51}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3871, "cost": 1, "resetAt": "2021-11-12T11:57:46Z"}}}