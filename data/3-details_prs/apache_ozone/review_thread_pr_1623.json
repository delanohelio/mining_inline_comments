{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTI3MjIxOTc3", "number": 1623, "reviewThreads": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xMlQwOTo1NTozNFrOFEXxBw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xMlQxMDowMTo1MlrOFEX0sw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzQwMTI4MDA3OnYy", "diffSide": "RIGHT", "path": "hadoop-hdds/interface-client/src/main/proto/hdds.proto", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xMlQwOTo1NTozNFrOIEdQzg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xMlQwOTo1NTozNFrOIEdQzg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MTU0NDY1NA==", "bodyText": "Adding a fake state only for testing metrics collection does not seem right to me.\n\n  \n    \n  \n    \n\n  \n  This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters. Learn more about bidirectional Unicode characters\n\n\n  \n\n\n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                TOTAL = 7;", "url": "https://github.com/apache/ozone/pull/1623#discussion_r541544654", "createdAt": "2020-12-12T09:55:34Z", "author": {"login": "adoroszlai"}, "path": "hadoop-hdds/interface-client/src/main/proto/hdds.proto", "diffHunk": "@@ -169,6 +169,7 @@ enum LifeCycleState {\n     CLOSED = 4;\n     DELETING = 5;\n     DELETED = 6; // object is deleted.\n+    TOTAL = 7;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "0c2310c0f0cac052c72ee68bef1ac4a0d37ffc5c"}, "originalPosition": 4}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzQwMTI4MDUyOnYy", "diffSide": "RIGHT", "path": "hadoop-hdds/server-scm/src/test/java/org/apache/hadoop/hdds/scm/server/TestSCMContainerMetrics.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xMlQwOTo1NTo0N1rOIEdQ_A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xMlQwOTo1NTo0N1rOIEdQ_A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MTU0NDcwMA==", "bodyText": "This does not seem to be required, as total is a calculated value.\n\n  \n    \n  \n    \n\n  \n  This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters. Learn more about bidirectional Unicode characters\n\n\n  \n\n\n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                    put(HddsProtos.LifeCycleState.TOTAL.toString(), 27);", "url": "https://github.com/apache/ozone/pull/1623#discussion_r541544700", "createdAt": "2020-12-12T09:55:47Z", "author": {"login": "adoroszlai"}, "path": "hadoop-hdds/server-scm/src/test/java/org/apache/hadoop/hdds/scm/server/TestSCMContainerMetrics.java", "diffHunk": "@@ -50,6 +50,7 @@ public void testSCMContainerMetrics() {\n         put(HddsProtos.LifeCycleState.CLOSED.toString(), 5);\n         put(HddsProtos.LifeCycleState.DELETING.toString(), 6);\n         put(HddsProtos.LifeCycleState.DELETED.toString(), 7);\n+        put(HddsProtos.LifeCycleState.TOTAL.toString(), 27);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "0c2310c0f0cac052c72ee68bef1ac4a0d37ffc5c"}, "originalPosition": 4}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzQwMTI4OTQ3OnYy", "diffSide": "RIGHT", "path": "hadoop-hdds/server-scm/src/main/java/org/apache/hadoop/hdds/scm/server/SCMContainerMetrics.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xMlQxMDowMTo1MlrOIEdUyw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xNlQwNToyNzo0M1rOIGxsTA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MTU0NTY3NQ==", "bodyText": "Nit: Can this be converted to a loop over all states summing individual values?  That way if a new state is introduced, no further change in counting totals will be required.", "url": "https://github.com/apache/ozone/pull/1623#discussion_r541545675", "createdAt": "2020-12-12T10:01:52Z", "author": {"login": "adoroszlai"}, "path": "hadoop-hdds/server-scm/src/main/java/org/apache/hadoop/hdds/scm/server/SCMContainerMetrics.java", "diffHunk": "@@ -84,6 +84,14 @@ public void getMetrics(MetricsCollector collector, boolean all) {\n             stateCount.get(DELETING.toString()))\n         .addGauge(Interns.info(\"DeletedContainers\",\n             \"Number of containers in deleted state\"),\n+            stateCount.get(DELETED.toString()))\n+        .addGauge(Interns.info(\"TotalContainers\",\n+            \"Number of all containers\"),\n+          stateCount.get(OPEN.toString())+\n+            stateCount.get(CLOSING.toString())+\n+            stateCount.get(QUASI_CLOSED.toString())+\n+            stateCount.get(CLOSED.toString())+\n+            stateCount.get(DELETING.toString())+", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "0c2310c0f0cac052c72ee68bef1ac4a0d37ffc5c"}, "originalPosition": 11}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0Mzk3NjUyNA==", "bodyText": "Thanks @adoroszlai  for the suggestion,I tried to modify it.", "url": "https://github.com/apache/ozone/pull/1623#discussion_r543976524", "createdAt": "2020-12-16T05:27:43Z", "author": {"login": "sky76093016"}, "path": "hadoop-hdds/server-scm/src/main/java/org/apache/hadoop/hdds/scm/server/SCMContainerMetrics.java", "diffHunk": "@@ -84,6 +84,14 @@ public void getMetrics(MetricsCollector collector, boolean all) {\n             stateCount.get(DELETING.toString()))\n         .addGauge(Interns.info(\"DeletedContainers\",\n             \"Number of containers in deleted state\"),\n+            stateCount.get(DELETED.toString()))\n+        .addGauge(Interns.info(\"TotalContainers\",\n+            \"Number of all containers\"),\n+          stateCount.get(OPEN.toString())+\n+            stateCount.get(CLOSING.toString())+\n+            stateCount.get(QUASI_CLOSED.toString())+\n+            stateCount.get(CLOSED.toString())+\n+            stateCount.get(DELETING.toString())+", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MTU0NTY3NQ=="}, "originalCommit": {"oid": "0c2310c0f0cac052c72ee68bef1ac4a0d37ffc5c"}, "originalPosition": 11}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4519, "cost": 1, "resetAt": "2021-11-12T11:57:46Z"}}}