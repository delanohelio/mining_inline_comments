{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0MzY1NjAyNDAw", "number": 471, "title": "HDDS-2906. Added Unit Test Cases ofr CRLCodec", "bodyText": "What changes were proposed in this pull request?\nAdded more Unit Tests for CRLCodec\nWhat is the link to the Apache JIRA\nhttps://issues.apache.org/jira/browse/HDDS-2906\nHow was this patch tested?\nmvn build and unit tests.\n@anuengineer", "createdAt": "2020-01-22T00:24:30Z", "url": "https://github.com/apache/ozone/pull/471", "merged": true, "mergeCommit": {"oid": "15fb459c5d2c2e4639803b11969009c3391d3fe1"}, "closed": true, "closedAt": "2020-01-23T22:48:50Z", "author": {"login": "abhishekaypurohit"}, "timelineItems": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABb8qhJOAH2gAyMzY1NjAyNDAwOmIzZmJlNmY0MzM4ZDZiYjQxODRhMWQ5MjllMWU1ZjJmMTQyNDRhMDA=", "endCursor": "Y3Vyc29yOnYyOpPPAAABb9PabSgH2gAyMzY1NjAyNDAwOmYzZjFhYjUxYTEwNDgwOGQ2NTE5Yjc3M2Y5MzI0MmI4ODJhZDg5OTI=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "b3fbe6f4338d6bb4184a1d929e1e5f2f14244a00", "author": {"user": {"login": "abhishekaypurohit", "name": "Abhishek Purohit"}}, "url": "https://github.com/apache/ozone/commit/b3fbe6f4338d6bb4184a1d929e1e5f2f14244a00", "committedDate": "2020-01-22T00:22:36Z", "message": "HDDS-2906. Added Unit Test Cases ofr CRLCodec"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzQ3NTI3NTEx", "url": "https://github.com/apache/ozone/pull/471#pullrequestreview-347527511", "createdAt": "2020-01-23T18:49:48Z", "commit": {"oid": "b3fbe6f4338d6bb4184a1d929e1e5f2f14244a00"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yM1QxODo0OTo0OFrOFhI5bg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yM1QxODo0OTo0OFrOFhI5bg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MDI5MzEwMg==", "bodyText": "NIT: should we rename the method from get509CRL to getX509CRL?", "url": "https://github.com/apache/ozone/pull/471#discussion_r370293102", "createdAt": "2020-01-23T18:49:48Z", "author": {"login": "xiaoyuyao"}, "path": "hadoop-hdds/common/src/main/java/org/apache/hadoop/hdds/security/x509/certificate/utils/CRLCodec.java", "diffHunk": "@@ -78,7 +78,7 @@ public CRLCodec(SecurityConfig securityConfig) {\n    * Returns a X509 CRL from the CRL Holder.\n    *\n    * @param holder - Holder\n-   * @return X509Certificate.\n+   * @return X509CRL - X509 CRL.\n    * @throws CRLException - on Error.\n    */\n   public static X509CRL get509CRL(X509CRLHolder holder)", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b3fbe6f4338d6bb4184a1d929e1e5f2f14244a00"}, "originalPosition": 8}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzQ3NTMzMTE1", "url": "https://github.com/apache/ozone/pull/471#pullrequestreview-347533115", "createdAt": "2020-01-23T18:58:38Z", "commit": {"oid": "b3fbe6f4338d6bb4184a1d929e1e5f2f14244a00"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yM1QxODo1ODozOFrOFhJJxA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yM1QxODo1ODozOFrOFhJJxA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MDI5NzI4NA==", "bodyText": "NIT: the InputStream can be wrapped with try-with-resource.", "url": "https://github.com/apache/ozone/pull/471#discussion_r370297284", "createdAt": "2020-01-23T18:58:38Z", "author": {"login": "xiaoyuyao"}, "path": "hadoop-hdds/common/src/test/java/org/apache/hadoop/hdds/security/x509/certificate/utils/TestCRLCodec.java", "diffHunk": "@@ -101,11 +122,124 @@ public void testWriteCRL() throws IOException, OperatorCreationException {\n         builder.build(contentSignerBuilder.build(privateKey));\n \n     CRLCodec crlCodec = new CRLCodec(securityConfig);\n-    crlCodec.writeCRL(cRLHolder, CRL_FILE_NAME, true);\n+    crlCodec.writeCRL(cRLHolder, this.securityConfig.getCrlName(), true);\n \n     X509CRLEntryHolder entryHolder =\n         cRLHolder.getRevokedCertificate(BigInteger.ONE);\n     assertNotNull(entryHolder);\n+\n+    // verify file generation\n+    File crlFile =\n+        Paths.get(crlCodec.getLocation().toString(),\n+                  this.securityConfig.getCrlName()).toFile();\n+    assertTrue(crlFile.exists());\n+\n+    try (BufferedReader reader = new BufferedReader(new FileReader(crlFile))){\n+\n+      // Verify contents of the file\n+      String header = reader.readLine();\n+      assertEquals(\"-----BEGIN X509 CRL-----\", header);\n+\n+      String footer = null;\n+      String line = null;\n+      while ((line = reader.readLine()) != null) {\n+        footer = line;\n+      }\n+      assertEquals(\"-----END X509 CRL-----\", footer);\n+    }\n+  }\n+\n+  @Test\n+  public void testWriteCRLX509() throws IOException,\n+      OperatorCreationException, CertificateException, CRLException {\n+\n+    X500Name issuer = x509CertificateHolder.getIssuer();\n+    Date now = new Date();\n+    X509v2CRLBuilder builder = new X509v2CRLBuilder(issuer, now);\n+    builder.addCRLEntry(x509CertificateHolder.getSerialNumber(), now,\n+                        CRLReason.cACompromise);\n+\n+    InputStream inStream = null;\n+    byte[] crlBytes = TMP_CRL_ENTRY.getBytes();\n+    try {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b3fbe6f4338d6bb4184a1d929e1e5f2f14244a00"}, "originalPosition": 96}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzQ3NTM0NjQ2", "url": "https://github.com/apache/ozone/pull/471#pullrequestreview-347534646", "createdAt": "2020-01-23T19:01:01Z", "commit": {"oid": "b3fbe6f4338d6bb4184a1d929e1e5f2f14244a00"}, "state": "COMMENTED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f3f1ab51a104808d6519b773f93242b882ad8992", "author": {"user": {"login": "abhishekaypurohit", "name": "Abhishek Purohit"}}, "url": "https://github.com/apache/ozone/commit/f3f1ab51a104808d6519b773f93242b882ad8992", "committedDate": "2020-01-23T19:21:45Z", "message": "HDDS-2906. Updated name and try with resource"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3718, "cost": 1, "resetAt": "2021-10-28T18:00:02Z"}}}