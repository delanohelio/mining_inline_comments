{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDkxNzI2ODIx", "number": 1443, "title": "HDDS-4270. Add more reusable byteman scripts to debug ofs/o3fs performance", "bodyText": "I am using https://byteman.jboss.org to debug the performance of spark + teragen with different scripts. Some byteman scripts are already shared by HDDS-4095 or HDDS-342 but it seems to be a good practice to share the newer scripts to make it possible to reproduce performance problems.\nFor using byteman with Ozone, see this video:\nhttps://www.youtube.com/watch?v=_4eYsH8F50E&list=PLCaV-jpCBO8U_WqyySszmbmnL-dhlzF6o&index=5\nWhat is the link to the Apache JIRA\nhttps://issues.apache.org/jira/browse/HDDS-4270\nHow was this patch tested?\nI used them during real k8s deployments:\nhttps://github.com/elek/ozone-perf-env", "createdAt": "2020-09-23T12:04:28Z", "url": "https://github.com/apache/ozone/pull/1443", "merged": true, "mergeCommit": {"oid": "5f1900aae0b4d336090aec8c75404efd8634c672"}, "closed": true, "closedAt": "2020-09-24T14:36:02Z", "author": {"login": "elek"}, "timelineItems": {"totalCount": 6, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdLrYZVAH2gAyNDkxNzI2ODIxOjFjZGVlYWM3OWFjYTAzNDk2NGNlMTA5M2QyMTlmMzk0N2Y1ZTFlNDA=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdL_hzygH2gAyNDkxNzI2ODIxOjk4OTdlY2I0Njk2YjM2MmE1NWZiYWNhYmM0N2Q4YWIyMDIxYjdkYmE=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "1cdeeac79aca034964ce1093d219f3947f5e1e40", "author": {"user": {"login": "elek", "name": "Elek, M\u00e1rton"}}, "url": "https://github.com/apache/ozone/commit/1cdeeac79aca034964ce1093d219f3947f5e1e40", "committedDate": "2020-09-23T12:02:58Z", "message": "HDDS-4270. Add more reusable byteman scripts to debug ofs/o3fs performance"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDk0Nzk1Nzg5", "url": "https://github.com/apache/ozone/pull/1443#pullrequestreview-494795789", "createdAt": "2020-09-23T15:39:18Z", "commit": {"oid": "1cdeeac79aca034964ce1093d219f3947f5e1e40"}, "state": "APPROVED", "comments": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yM1QxNTozOToxOVrOHW0uaA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yM1QxNjoyMToxMVrOHW2hqA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MzY5NDU2OA==", "bodyText": "Seems to be leftover comment from ratis-no-flush.btm.", "url": "https://github.com/apache/ozone/pull/1443#discussion_r493694568", "createdAt": "2020-09-23T15:39:19Z", "author": {"login": "adoroszlai"}, "path": "dev-support/byteman/ratis-flush.btm", "diffHunk": "@@ -0,0 +1,35 @@\n+# Licensed to the Apache Software Foundation (ASF) under one or more\n+# contributor license agreements.  See the NOTICE file distributed with\n+# this work for additional information regarding copyright ownership.\n+# The ASF licenses this file to You under the Apache License, Version 2.0\n+# (the \"License\"); you may not use this file except in compliance with\n+# the License.  You may obtain a copy of the License at\n+#\n+#     http://www.apache.org/licenses/LICENSE-2.0\n+#\n+# Unless required by applicable law or agreed to in writing, software\n+# distributed under the License is distributed on an \"AS IS\" BASIS,\n+# WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+# See the License for the specific language governing permissions and\n+# limitations under the License.\n+\n+# Turn of flush for Raits log", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "1cdeeac79aca034964ce1093d219f3947f5e1e40"}, "originalPosition": 16}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MzcyMDgyOQ==", "bodyText": "To be able to use multiple scripts, we need to avoid conflict of rule name:\n\n  \n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            RULE FileSystem.close\n          \n          \n            \n            RULE hcfs-read-FileSystem.close", "url": "https://github.com/apache/ozone/pull/1443#discussion_r493720829", "createdAt": "2020-09-23T16:16:21Z", "author": {"login": "adoroszlai"}, "path": "dev-support/byteman/hcfs-read.btm", "diffHunk": "@@ -0,0 +1,67 @@\n+# Licensed to the Apache Software Foundation (ASF) under one or more\n+# contributor license agreements.  See the NOTICE file distributed with\n+# this work for additional information regarding copyright ownership.\n+# The ASF licenses this file to You under the Apache License, Version 2.0\n+# (the \"License\"); you may not use this file except in compliance with\n+# the License.  You may obtain a copy of the License at\n+#\n+#     http://www.apache.org/licenses/LICENSE-2.0\n+#\n+# Unless required by applicable law or agreed to in writing, software\n+# distributed under the License is distributed on an \"AS IS\" BASIS,\n+# WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+# See the License for the specific language governing permissions and\n+# limitations under the License.\n+\n+# Measure time spent in HCFS read implementations\n+\n+RULE FileSystem.close", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "1cdeeac79aca034964ce1093d219f3947f5e1e40"}, "originalPosition": 18}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MzcyMTAzMQ==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            RULE FileSystem.close\n          \n          \n            \n            RULE watchforcommit_all-FileSystem.close", "url": "https://github.com/apache/ozone/pull/1443#discussion_r493721031", "createdAt": "2020-09-23T16:16:39Z", "author": {"login": "adoroszlai"}, "path": "dev-support/byteman/watchforcommit_all.btm", "diffHunk": "@@ -0,0 +1,47 @@\n+# Licensed to the Apache Software Foundation (ASF) under one or more\n+# contributor license agreements.  See the NOTICE file distributed with\n+# this work for additional information regarding copyright ownership.\n+# The ASF licenses this file to You under the Apache License, Version 2.0\n+# (the \"License\"); you may not use this file except in compliance with\n+# the License.  You may obtain a copy of the License at\n+#\n+#     http://www.apache.org/licenses/LICENSE-2.0\n+#\n+# Unless required by applicable law or agreed to in writing, software\n+# distributed under the License is distributed on an \"AS IS\" BASIS,\n+# WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+# See the License for the specific language governing permissions and\n+# limitations under the License.\n+\n+# Measure overall time spent in Watch for commit calls\n+\n+RULE FileSystem.close", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "1cdeeac79aca034964ce1093d219f3947f5e1e40"}, "originalPosition": 18}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MzcyNDA3Mg==", "bodyText": "I assume one would not use both watchforcommit scripts at the same time.  If we did, rule name would need to be unique.", "url": "https://github.com/apache/ozone/pull/1443#discussion_r493724072", "createdAt": "2020-09-23T16:21:11Z", "author": {"login": "adoroszlai"}, "path": "dev-support/byteman/watchforcommit_all.btm", "diffHunk": "@@ -0,0 +1,47 @@\n+# Licensed to the Apache Software Foundation (ASF) under one or more\n+# contributor license agreements.  See the NOTICE file distributed with\n+# this work for additional information regarding copyright ownership.\n+# The ASF licenses this file to You under the Apache License, Version 2.0\n+# (the \"License\"); you may not use this file except in compliance with\n+# the License.  You may obtain a copy of the License at\n+#\n+#     http://www.apache.org/licenses/LICENSE-2.0\n+#\n+# Unless required by applicable law or agreed to in writing, software\n+# distributed under the License is distributed on an \"AS IS\" BASIS,\n+# WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+# See the License for the specific language governing permissions and\n+# limitations under the License.\n+\n+# Measure overall time spent in Watch for commit calls\n+\n+RULE FileSystem.close\n+CLASS org.apache.hadoop.fs.FileSystem\n+METHOD close\n+IF TRUE\n+DO\n+  System.out.println(\"Closing file system instance: \" + System.identityHashCode($0));\n+  System.out.println(\"   watchForCommit.call: \" + readCounter(\"watchForCommit.call\"));\n+  System.out.println(\"   watchForCommit.allTime: \" + readCounter(\"watchForCommit.allTime\"))\n+\n+ENDRULE\n+\n+RULE BlockOutputStream.watchForCommit.Entry", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "1cdeeac79aca034964ce1093d219f3947f5e1e40"}, "originalPosition": 29}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "cee5eee13396a36f770478d60107fc9d68d4400d", "author": {"user": {"login": "elek", "name": "Elek, M\u00e1rton"}}, "url": "https://github.com/apache/ozone/commit/cee5eee13396a36f770478d60107fc9d68d4400d", "committedDate": "2020-09-24T11:16:34Z", "message": "Apply suggestions from code review\n\nCo-authored-by: Doroszlai, Attila <6454655+adoroszlai@users.noreply.github.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "2eb0ef300750bfb8a38cca8d1c4216f6f22a5e4b", "author": {"user": {"login": "elek", "name": "Elek, M\u00e1rton"}}, "url": "https://github.com/apache/ozone/commit/2eb0ef300750bfb8a38cca8d1c4216f6f22a5e4b", "committedDate": "2020-09-24T11:29:10Z", "message": "Fix docs"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e8ee97b0bf98ac70d778e5e77975ebdcca587a94", "author": {"user": {"login": "elek", "name": "Elek, M\u00e1rton"}}, "url": "https://github.com/apache/ozone/commit/e8ee97b0bf98ac70d778e5e77975ebdcca587a94", "committedDate": "2020-09-24T11:29:17Z", "message": "Merge remote-tracking branch 'elek/HDDS-4270' into HDDS-4270"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "9897ecb4696b362a55fbacabc47d8ab2021b7dba", "author": {"user": {"login": "elek", "name": "Elek, M\u00e1rton"}}, "url": "https://github.com/apache/ozone/commit/9897ecb4696b362a55fbacabc47d8ab2021b7dba", "committedDate": "2020-09-24T11:31:21Z", "message": "prefix BOS.watchForCommit"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2558, "cost": 1, "resetAt": "2021-10-28T18:00:02Z"}}}