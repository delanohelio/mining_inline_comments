{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTIxNzk1OTM2", "number": 1595, "reviewThreads": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xNlQyMzo1Nzo0NlrOE5yLGg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0yMVQwMTowNzoxMVrOE7wnjg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzI5MDI2MzMwOnYy", "diffSide": "RIGHT", "path": "hadoop-ozone/s3gateway/src/main/java/org/apache/hadoop/ozone/s3/endpoint/BucketEndpoint.java", "isResolved": true, "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xNlQyMzo1Nzo0NlrOH0d4ew==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xOFQwMTowMjowOVrOH1RtPQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNDc3NzU5NQ==", "bodyText": "We need some comments here.", "url": "https://github.com/apache/ozone/pull/1595#discussion_r524777595", "createdAt": "2020-11-16T23:57:46Z", "author": {"login": "runzhiwang"}, "path": "hadoop-ozone/s3gateway/src/main/java/org/apache/hadoop/ozone/s3/endpoint/BucketEndpoint.java", "diffHunk": "@@ -112,6 +112,9 @@ public Response list(\n     ContinueToken decodedToken =\n         ContinueToken.decodeFromString(continueToken);\n \n+    if (startAfter == null) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b48ed3c05cd81018643ab8832b98b0cbdeb68fb0"}, "originalPosition": 4}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNDk3NTM1MQ==", "bodyText": "Done.", "url": "https://github.com/apache/ozone/pull/1595#discussion_r524975351", "createdAt": "2020-11-17T08:41:32Z", "author": {"login": "maobaolong"}, "path": "hadoop-ozone/s3gateway/src/main/java/org/apache/hadoop/ozone/s3/endpoint/BucketEndpoint.java", "diffHunk": "@@ -112,6 +112,9 @@ public Response list(\n     ContinueToken decodedToken =\n         ContinueToken.decodeFromString(continueToken);\n \n+    if (startAfter == null) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNDc3NzU5NQ=="}, "originalCommit": {"oid": "b48ed3c05cd81018643ab8832b98b0cbdeb68fb0"}, "originalPosition": 4}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNTYyNjY4NQ==", "bodyText": "What do you mean \"stand for startAfter\" ? I think we can comment why we need set startAfter with marker.", "url": "https://github.com/apache/ozone/pull/1595#discussion_r525626685", "createdAt": "2020-11-18T01:02:09Z", "author": {"login": "runzhiwang"}, "path": "hadoop-ozone/s3gateway/src/main/java/org/apache/hadoop/ozone/s3/endpoint/BucketEndpoint.java", "diffHunk": "@@ -112,6 +112,9 @@ public Response list(\n     ContinueToken decodedToken =\n         ContinueToken.decodeFromString(continueToken);\n \n+    if (startAfter == null) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNDc3NzU5NQ=="}, "originalCommit": {"oid": "b48ed3c05cd81018643ab8832b98b0cbdeb68fb0"}, "originalPosition": 4}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzI5NTk1NDM5OnYy", "diffSide": "RIGHT", "path": "hadoop-ozone/s3gateway/src/main/java/org/apache/hadoop/ozone/s3/endpoint/BucketEndpoint.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xOFQwMjo0MDowOFrOH1Uogw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xOFQwODozNToyNVrOH1ierA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNTY3NDYyNw==", "bodyText": "LGTM\n// Set nextMarker to be lastKey. for the compatibility  of aws api v1,", "url": "https://github.com/apache/ozone/pull/1595#discussion_r525674627", "createdAt": "2020-11-18T02:40:08Z", "author": {"login": "GlenGeng"}, "path": "hadoop-ozone/s3gateway/src/main/java/org/apache/hadoop/ozone/s3/endpoint/BucketEndpoint.java", "diffHunk": "@@ -187,6 +191,8 @@ public Response list(\n       response.setTruncated(true);\n       ContinueToken nextToken = new ContinueToken(lastKey, prevDir);\n       response.setNextToken(nextToken.encodeToString());\n+      // For aws api v1 compatibility purpose, set nextMarker with lastKey", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "2fa1b3a63e05949e464e6605902fe1de0d18e320"}, "originalPosition": 15}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNTkwMTQ4NA==", "bodyText": "Done.", "url": "https://github.com/apache/ozone/pull/1595#discussion_r525901484", "createdAt": "2020-11-18T08:35:25Z", "author": {"login": "maobaolong"}, "path": "hadoop-ozone/s3gateway/src/main/java/org/apache/hadoop/ozone/s3/endpoint/BucketEndpoint.java", "diffHunk": "@@ -187,6 +191,8 @@ public Response list(\n       response.setTruncated(true);\n       ContinueToken nextToken = new ContinueToken(lastKey, prevDir);\n       response.setNextToken(nextToken.encodeToString());\n+      // For aws api v1 compatibility purpose, set nextMarker with lastKey", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNTY3NDYyNw=="}, "originalCommit": {"oid": "2fa1b3a63e05949e464e6605902fe1de0d18e320"}, "originalPosition": 15}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzMwMjE0MTU4OnYy", "diffSide": "RIGHT", "path": "hadoop-ozone/s3gateway/src/main/java/org/apache/hadoop/ozone/s3/endpoint/BucketEndpoint.java", "isResolved": true, "comments": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xOVQwNzo1NTozM1rOH2QpCA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xOVQxMTowNjowNlrOH2X4OQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNjY1NzgwMA==", "bodyText": "After startAfter = marker, could startAfter be null?\nWe may remove duplicated check for startAfter after this null checker.", "url": "https://github.com/apache/ozone/pull/1595#discussion_r526657800", "createdAt": "2020-11-19T07:55:33Z", "author": {"login": "timmylicheng"}, "path": "hadoop-ozone/s3gateway/src/main/java/org/apache/hadoop/ozone/s3/endpoint/BucketEndpoint.java", "diffHunk": "@@ -112,6 +112,10 @@ public Response list(\n     ContinueToken decodedToken =\n         ContinueToken.decodeFromString(continueToken);\n \n+    // stand for startAfter\n+    if (startAfter == null) {\n+      startAfter = marker;\n+    }", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "5c77886134e2bd039703fb4c8bbfd62edb636e58"}, "originalPosition": 7}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNjY2MzQzOQ==", "bodyText": "@timmylicheng Thanks for your review.\nthe marker can be null, so the startAfter can be null, although we assigned the marker value to startAfter.", "url": "https://github.com/apache/ozone/pull/1595#discussion_r526663439", "createdAt": "2020-11-19T08:07:15Z", "author": {"login": "maobaolong"}, "path": "hadoop-ozone/s3gateway/src/main/java/org/apache/hadoop/ozone/s3/endpoint/BucketEndpoint.java", "diffHunk": "@@ -112,6 +112,10 @@ public Response list(\n     ContinueToken decodedToken =\n         ContinueToken.decodeFromString(continueToken);\n \n+    // stand for startAfter\n+    if (startAfter == null) {\n+      startAfter = marker;\n+    }", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNjY1NzgwMA=="}, "originalCommit": {"oid": "5c77886134e2bd039703fb4c8bbfd62edb636e58"}, "originalPosition": 7}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNjcwOTQxNA==", "bodyText": "So why do we put marker to startAfter when it's null? Maybe it would be great to have comments to explain this. :)", "url": "https://github.com/apache/ozone/pull/1595#discussion_r526709414", "createdAt": "2020-11-19T09:23:33Z", "author": {"login": "timmylicheng"}, "path": "hadoop-ozone/s3gateway/src/main/java/org/apache/hadoop/ozone/s3/endpoint/BucketEndpoint.java", "diffHunk": "@@ -112,6 +112,10 @@ public Response list(\n     ContinueToken decodedToken =\n         ContinueToken.decodeFromString(continueToken);\n \n+    // stand for startAfter\n+    if (startAfter == null) {\n+      startAfter = marker;\n+    }", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNjY1NzgwMA=="}, "originalCommit": {"oid": "5c77886134e2bd039703fb4c8bbfd62edb636e58"}, "originalPosition": 7}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNjc3NjM3Nw==", "bodyText": "@timmylicheng\nOK, I add a null checker, assign marker to startAfter only when marker != null.\nPTAL.", "url": "https://github.com/apache/ozone/pull/1595#discussion_r526776377", "createdAt": "2020-11-19T11:06:06Z", "author": {"login": "maobaolong"}, "path": "hadoop-ozone/s3gateway/src/main/java/org/apache/hadoop/ozone/s3/endpoint/BucketEndpoint.java", "diffHunk": "@@ -112,6 +112,10 @@ public Response list(\n     ContinueToken decodedToken =\n         ContinueToken.decodeFromString(continueToken);\n \n+    // stand for startAfter\n+    if (startAfter == null) {\n+      startAfter = marker;\n+    }", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNjY1NzgwMA=="}, "originalCommit": {"oid": "5c77886134e2bd039703fb4c8bbfd62edb636e58"}, "originalPosition": 7}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzMxMDk3OTk4OnYy", "diffSide": "RIGHT", "path": "hadoop-ozone/s3gateway/src/main/java/org/apache/hadoop/ozone/s3/endpoint/BucketEndpoint.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0yMVQwMTowNzoxMVrOH3lTlQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0yM1QwMjowMTowOFrOH39inA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyODA0NDk0OQ==", "bodyText": "Below we are not setting marker should we also set that also, if the marker is not null?\nL136: response.setMarker(\"\");", "url": "https://github.com/apache/ozone/pull/1595#discussion_r528044949", "createdAt": "2020-11-21T01:07:11Z", "author": {"login": "bharatviswa504"}, "path": "hadoop-ozone/s3gateway/src/main/java/org/apache/hadoop/ozone/s3/endpoint/BucketEndpoint.java", "diffHunk": "@@ -112,6 +112,10 @@ public Response list(\n     ContinueToken decodedToken =\n         ContinueToken.decodeFromString(continueToken);\n \n+    // Assign marker to startAfter. for the compatibility of aws api v1\n+    if (startAfter == null && marker != null) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "0e57920f605206effc29e9025209e68c2bb9f344"}, "originalPosition": 5}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyODQ0MjAxMg==", "bodyText": "Done.", "url": "https://github.com/apache/ozone/pull/1595#discussion_r528442012", "createdAt": "2020-11-23T02:01:08Z", "author": {"login": "maobaolong"}, "path": "hadoop-ozone/s3gateway/src/main/java/org/apache/hadoop/ozone/s3/endpoint/BucketEndpoint.java", "diffHunk": "@@ -112,6 +112,10 @@ public Response list(\n     ContinueToken decodedToken =\n         ContinueToken.decodeFromString(continueToken);\n \n+    // Assign marker to startAfter. for the compatibility of aws api v1\n+    if (startAfter == null && marker != null) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyODA0NDk0OQ=="}, "originalCommit": {"oid": "0e57920f605206effc29e9025209e68c2bb9f344"}, "originalPosition": 5}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4733, "cost": 1, "resetAt": "2021-11-12T11:57:46Z"}}}