{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDYyMDkyNzMz", "number": 1285, "title": "HDDS-4056. Convert OzoneAdmin to pluggable model", "bodyText": "What changes were proposed in this pull request?\n\nOzoneAdmin is a collection of loosely coupled admin tools.  This change converts it to the pluggable model introduced in HDDS-4046, where subcommands register themselves declaratively, instead of the parent command listing each subcommand.\nMove --scm parameter from ozone admin command to the subcommands that actually need it.  Currently all except OMAdmin do, but this is likely to change by adding more om and other non-scm subcommands in the future.  This is made easier by:\n\nextracting --scm-related logic to the new ScmOption mixin,\nextracting abstract parent class for ScmClient-based subcommands (similar to Handler for ozone shell subcommands).\n\n\nUpgrade picocli to 4.4.0.  (Needed for MIXEE, but useful anyway.)\n\nNote that moving the --scm parameter is backwards incompatible.  Previously the following command was valid:\nozone admin --scm scm:9860 pipeline list\n\nand this one was not:\nozone admin pipeline list --scm scm:9860\n\nbut now it's the other way around.  The same applies to all SCM-related admin commands.  If necessary, we could provide backwards compatibility, but I don't think it's worth the effort and extra code complexity.  By default SCM address is read from config, so command-line override should be rare.\nhttps://issues.apache.org/jira/browse/HDDS-4056\nHow was this patch tested?\nExisting acceptance tests cover some of the commands.  Also added new test cases for several ozone admin subcommands.\nCI pending", "createdAt": "2020-08-03T10:27:28Z", "url": "https://github.com/apache/ozone/pull/1285", "merged": true, "mergeCommit": {"oid": "bc7786a2fafb2d36923506f8de6c25fcfd26d55b"}, "closed": true, "closedAt": "2020-08-27T08:43:40Z", "author": {"login": "adoroszlai"}, "timelineItems": {"totalCount": 13, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABc7DqbGAH2gAyNDYyMDkyNzMzOmI5ZTBjY2I2Y2U1OGRiYzg2OWMxMjM3NzM0Yjg5ZGU0MTJlMjVmMzk=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdC8WB5gFqTQ3NjUwOTIyOQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "b9e0ccb6ce58dbc869c1237734b89de412e25f39", "author": {"user": {"login": "adoroszlai", "name": "Doroszlai, Attila"}}, "url": "https://github.com/apache/ozone/commit/b9e0ccb6ce58dbc869c1237734b89de412e25f39", "committedDate": "2020-08-02T20:43:40Z", "message": "HDDS-4056. Refactor WithScmClient to mixin"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "fab61e37d0629376bbacc68b5417644511e36435", "author": {"user": {"login": "adoroszlai", "name": "Doroszlai, Attila"}}, "url": "https://github.com/apache/ozone/commit/fab61e37d0629376bbacc68b5417644511e36435", "committedDate": "2020-08-02T20:43:40Z", "message": "HDDS-4056. Improve admin pipeline test"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "1d4d1b65c469637c2e52e26aabb5e67ba7f1f260", "author": {"user": {"login": "adoroszlai", "name": "Doroszlai, Attila"}}, "url": "https://github.com/apache/ozone/commit/1d4d1b65c469637c2e52e26aabb5e67ba7f1f260", "committedDate": "2020-08-03T04:31:04Z", "message": "HDDS-4056. TopologySubcommand extends ScmSubcommand"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "62e639ed6e003dccf55d6291335687f9b54db637", "author": {"user": {"login": "adoroszlai", "name": "Doroszlai, Attila"}}, "url": "https://github.com/apache/ozone/commit/62e639ed6e003dccf55d6291335687f9b54db637", "committedDate": "2020-08-03T04:32:26Z", "message": "Fix leftover javadoc"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "6933fcd66d45efc427be5ec2d7c5916416ac2a01", "author": {"user": {"login": "adoroszlai", "name": "Doroszlai, Attila"}}, "url": "https://github.com/apache/ozone/commit/6933fcd66d45efc427be5ec2d7c5916416ac2a01", "committedDate": "2020-08-11T07:35:35Z", "message": "Merge remote-tracking branch 'origin/master' into HDDS-4056"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "3b598a4e9880cc3b4a8afcfb6ad075135abc9d50", "author": {"user": {"login": "adoroszlai", "name": "Doroszlai, Attila"}}, "url": "https://github.com/apache/ozone/commit/3b598a4e9880cc3b4a8afcfb6ad075135abc9d50", "committedDate": "2020-08-11T09:58:52Z", "message": "HDDS-4056. Convert OzoneAdmin subcommands to META-INF-based"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "5abb2e0eefcbb05c98b6116af487c49dc74a44a8", "author": {"user": {"login": "adoroszlai", "name": "Doroszlai, Attila"}}, "url": "https://github.com/apache/ozone/commit/5abb2e0eefcbb05c98b6116af487c49dc74a44a8", "committedDate": "2020-08-11T11:03:49Z", "message": "HDDS-4056. Add more smoketests"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "5493dbce3c0035f7910873a53d6db3ab2162f53d", "author": {"user": {"login": "adoroszlai", "name": "Doroszlai, Attila"}}, "url": "https://github.com/apache/ozone/commit/5493dbce3c0035f7910873a53d6db3ab2162f53d", "committedDate": "2020-08-11T11:04:44Z", "message": "Merge commit '43471f76a' into HDDS-4056"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "7c06f168802ffea7c547a8ba71d53d90900e9e4c", "author": {"user": {"login": "adoroszlai", "name": "Doroszlai, Attila"}}, "url": "https://github.com/apache/ozone/commit/7c06f168802ffea7c547a8ba71d53d90900e9e4c", "committedDate": "2020-08-11T11:09:47Z", "message": "HDDS-4056. Fix checkstyle"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "df186da10c9e2e968169bd8488e395fd1a969382", "author": {"user": {"login": "adoroszlai", "name": "Doroszlai, Attila"}}, "url": "https://github.com/apache/ozone/commit/df186da10c9e2e968169bd8488e395fd1a969382", "committedDate": "2020-08-11T13:01:42Z", "message": "HDDS-4056. Kinit before freon"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "1afe288f614350a6fd88f455315a0b9a1c720e25", "author": {"user": {"login": "adoroszlai", "name": "Doroszlai, Attila"}}, "url": "https://github.com/apache/ozone/commit/1afe288f614350a6fd88f455315a0b9a1c720e25", "committedDate": "2020-08-11T14:49:38Z", "message": "HDDS-4056. ReplicationManager may or may not be running at the start of the test"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDc2NTA1OTM2", "url": "https://github.com/apache/ozone/pull/1285#pullrequestreview-476505936", "createdAt": "2020-08-27T08:39:13Z", "commit": {"oid": "1afe288f614350a6fd88f455315a0b9a1c720e25"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yN1QwODozOToxM1rOHIGQOA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yN1QwODozOToxM1rOHIGQOA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3ODI1MzExMg==", "bodyText": "Today I learned it. Nice. Thanks.", "url": "https://github.com/apache/ozone/pull/1285#discussion_r478253112", "createdAt": "2020-08-27T08:39:13Z", "author": {"login": "elek"}, "path": "hadoop-hdds/tools/src/main/java/org/apache/hadoop/hdds/scm/cli/ScmOption.java", "diffHunk": "@@ -0,0 +1,72 @@\n+/*\n+ * Licensed to the Apache Software Foundation (ASF) under one\n+ * or more contributor license agreements.  See the NOTICE file\n+ * distributed with this work for additional information\n+ * regarding copyright ownership.  The ASF licenses this file\n+ * to you under the Apache License, Version 2.0 (the\n+ * \"License\"); you may not use this file except in compliance\n+ * with the License.  You may obtain a copy of the License at\n+ * <p>\n+ * http://www.apache.org/licenses/LICENSE-2.0\n+ * <p>\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+package org.apache.hadoop.hdds.scm.cli;\n+\n+import org.apache.commons.lang3.StringUtils;\n+import org.apache.hadoop.hdds.HddsUtils;\n+import org.apache.hadoop.hdds.cli.GenericParentCommand;\n+import org.apache.hadoop.hdds.conf.MutableConfigurationSource;\n+import org.apache.hadoop.hdds.conf.OzoneConfiguration;\n+import org.apache.hadoop.hdds.scm.ScmConfigKeys;\n+import org.apache.hadoop.hdds.scm.client.ScmClient;\n+import picocli.CommandLine;\n+\n+import java.io.IOException;\n+\n+import static org.apache.hadoop.hdds.scm.ScmConfigKeys.OZONE_SCM_CLIENT_ADDRESS_KEY;\n+import static picocli.CommandLine.Spec.Target.MIXEE;\n+\n+/**\n+ * Defines command-line option for SCM address.\n+ */\n+public class ScmOption {\n+\n+  @CommandLine.Spec(MIXEE)\n+  private CommandLine.Model.CommandSpec spec;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "1afe288f614350a6fd88f455315a0b9a1c720e25"}, "originalPosition": 40}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDc2NTA5MjI5", "url": "https://github.com/apache/ozone/pull/1285#pullrequestreview-476509229", "createdAt": "2020-08-27T08:43:27Z", "commit": {"oid": "1afe288f614350a6fd88f455315a0b9a1c720e25"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2626, "cost": 1, "resetAt": "2021-10-28T18:00:02Z"}}}