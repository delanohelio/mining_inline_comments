{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDUxMzgwMTE1", "number": 1215, "reviewThreads": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xOFQwMToxMjowMFrOEPtngw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yMFQyMDoyNzowNVrOEQW_gA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjg0OTExNDkxOnYy", "diffSide": "RIGHT", "path": "hadoop-ozone/ozonefs-common/src/main/java/org/apache/hadoop/fs/ozone/BasicOzoneFileSystem.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xOFQwMToxMjowMFrOGzkoRQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yMFQxODowMzo1MlrOG0ZZcA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NjczMDY5Mw==", "bodyText": "Please check my above comment.", "url": "https://github.com/apache/ozone/pull/1215#discussion_r456730693", "createdAt": "2020-07-18T01:12:00Z", "author": {"login": "umamaheswararao"}, "path": "hadoop-ozone/ozonefs-common/src/main/java/org/apache/hadoop/fs/ozone/BasicOzoneFileSystem.java", "diffHunk": "@@ -397,6 +398,32 @@ public boolean rename(Path src, Path dst) throws IOException {\n     return result;\n   }\n \n+  /**\n+   * Intercept rename to trash calls from TrashPolicyDefault,\n+   * convert them to delete calls instead.\n+   */\n+  @Deprecated\n+  protected void rename(final Path src, final Path dst,\n+      final Rename... options) throws IOException {\n+    boolean hasMoveToTrash = false;\n+    if (options != null) {\n+      for (Rename option : options) {\n+        if (option == Rename.TO_TRASH) {\n+          hasMoveToTrash = true;\n+          break;\n+        }\n+      }\n+    }\n+    if (!hasMoveToTrash) {\n+      // if doesn't have TO_TRASH option, just pass the call to super\n+      super.rename(src, dst, options);\n+    } else {\n+      // intercept when TO_TRASH is found", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "6f4ead520d5b979f43b7635e80887945e56df87e"}, "originalPosition": 32}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NzU5NTI0OA==", "bodyText": "done in a929357", "url": "https://github.com/apache/ozone/pull/1215#discussion_r457595248", "createdAt": "2020-07-20T18:03:52Z", "author": {"login": "smengcl"}, "path": "hadoop-ozone/ozonefs-common/src/main/java/org/apache/hadoop/fs/ozone/BasicOzoneFileSystem.java", "diffHunk": "@@ -397,6 +398,32 @@ public boolean rename(Path src, Path dst) throws IOException {\n     return result;\n   }\n \n+  /**\n+   * Intercept rename to trash calls from TrashPolicyDefault,\n+   * convert them to delete calls instead.\n+   */\n+  @Deprecated\n+  protected void rename(final Path src, final Path dst,\n+      final Rename... options) throws IOException {\n+    boolean hasMoveToTrash = false;\n+    if (options != null) {\n+      for (Rename option : options) {\n+        if (option == Rename.TO_TRASH) {\n+          hasMoveToTrash = true;\n+          break;\n+        }\n+      }\n+    }\n+    if (!hasMoveToTrash) {\n+      // if doesn't have TO_TRASH option, just pass the call to super\n+      super.rename(src, dst, options);\n+    } else {\n+      // intercept when TO_TRASH is found", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NjczMDY5Mw=="}, "originalCommit": {"oid": "6f4ead520d5b979f43b7635e80887945e56df87e"}, "originalPosition": 32}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjg1NTg5Mzc2OnYy", "diffSide": "RIGHT", "path": "hadoop-ozone/ozonefs-common/src/main/java/org/apache/hadoop/fs/ozone/BasicRootedOzoneFileSystem.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yMFQyMDoyNzowNVrOG0eEfQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yMFQyMDoyNzowNVrOG0eEfQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NzY3MTgwNQ==", "bodyText": "One last thing: Currently we are straight a way deleting files. Since users coming from Hadoop shell, there could be assumptions that files may move to trash if no -skipTrash flag. But we will be deleting instead of trashing them.\nUser may realize after looking at this log message, but by this time already things happened.\nThere should be a way to shout out this behavior to users. One way is documenting and any other better way?", "url": "https://github.com/apache/ozone/pull/1215#discussion_r457671805", "createdAt": "2020-07-20T20:27:05Z", "author": {"login": "umamaheswararao"}, "path": "hadoop-ozone/ozonefs-common/src/main/java/org/apache/hadoop/fs/ozone/BasicRootedOzoneFileSystem.java", "diffHunk": "@@ -372,6 +373,34 @@ public boolean rename(Path src, Path dst) throws IOException {\n     return result;\n   }\n \n+  /**\n+   * Intercept rename to trash calls from TrashPolicyDefault,\n+   * convert them to delete calls instead.\n+   */\n+  @Deprecated\n+  protected void rename(final Path src, final Path dst,\n+      final Options.Rename... options) throws IOException {\n+    boolean hasMoveToTrash = false;\n+    if (options != null) {\n+      for (Options.Rename option : options) {\n+        if (option == Options.Rename.TO_TRASH) {\n+          hasMoveToTrash = true;\n+          break;\n+        }\n+      }\n+    }\n+    if (!hasMoveToTrash) {\n+      // if doesn't have TO_TRASH option, just pass the call to super\n+      super.rename(src, dst, options);\n+    } else {\n+      // intercept when TO_TRASH is found\n+      LOG.info(\"Move to trash is disabled for ofs, deleting instead: {}. \"\n+          + \"Files or directories will NOT be retained in trash. \"\n+          + \"Ignore the following TrashPolicyDefault message, if any.\", src);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "7c625dfb30cd9e706bd1e51920d7de9372236b21"}, "originalPosition": 35}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3998, "cost": 1, "resetAt": "2021-11-12T11:57:46Z"}}}