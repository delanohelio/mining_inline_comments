{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDc5MjIzOTQ5", "number": 1392, "reviewThreads": {"totalCount": 14, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wNFQwMzoyOToxNVrOEgOfeA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wOFQxODoyNjo0N1rOEhXX6A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzAyMjI3MzIwOnYy", "diffSide": "RIGHT", "path": "hadoop-hdds/server-scm/pom.xml", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wNFQwMzoyOToxNVrOHM-QLA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wOFQwNzoyNzowM1rOHOQJvg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MzM2NDkwOA==", "bodyText": "Let's hold off on introducing Aspectj in HDDS layer, since we have not fully understood the impact of bringing it in. Moreover, it suits a 'client facing' component like OzoneManager better since the point cut that we have is used for disallowing 'pre-finalize state unsupported client APIs'. Once there are concrete API use cases for SCM, we can bring it here by moving the OM Aspect to a common maven module.", "url": "https://github.com/apache/ozone/pull/1392#discussion_r483364908", "createdAt": "2020-09-04T03:29:15Z", "author": {"login": "avijayanhwx"}, "path": "hadoop-hdds/server-scm/pom.xml", "diffHunk": "@@ -29,6 +29,19 @@ https://maven.apache.org/xsd/maven-4.0.0.xsd\">\n   <packaging>jar</packaging>\n \n   <dependencies>\n+\n+    <dependency>", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "432ee6a7447140620a7861341a5b01bc2759e639"}, "originalPosition": 5}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NDcwNjc1MA==", "bodyText": "done", "url": "https://github.com/apache/ozone/pull/1392#discussion_r484706750", "createdAt": "2020-09-08T07:27:03Z", "author": {"login": "prashantpogde"}, "path": "hadoop-hdds/server-scm/pom.xml", "diffHunk": "@@ -29,6 +29,19 @@ https://maven.apache.org/xsd/maven-4.0.0.xsd\">\n   <packaging>jar</packaging>\n \n   <dependencies>\n+\n+    <dependency>", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MzM2NDkwOA=="}, "originalCommit": {"oid": "432ee6a7447140620a7861341a5b01bc2759e639"}, "originalPosition": 5}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzAyMjI3NTUzOnYy", "diffSide": "RIGHT", "path": "hadoop-hdds/server-scm/src/main/java/org/apache/hadoop/hdds/scm/upgrade/SCMLayoutFeatureAPI.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wNFQwMzozMDozN1rOHM-RbQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wNFQwMzozMDozN1rOHM-RbQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MzM2NTIyOQ==", "bodyText": "Can be removed.", "url": "https://github.com/apache/ozone/pull/1392#discussion_r483365229", "createdAt": "2020-09-04T03:30:37Z", "author": {"login": "avijayanhwx"}, "path": "hadoop-hdds/server-scm/src/main/java/org/apache/hadoop/hdds/scm/upgrade/SCMLayoutFeatureAPI.java", "diffHunk": "@@ -0,0 +1,35 @@\n+/**\n+ * Licensed to the Apache Software Foundation (ASF) under one\n+ * or more contributor license agreements.  See the NOTICE file\n+ * distributed with this work for additional information\n+ * regarding copyright ownership.  The ASF licenses this file\n+ * to you under the Apache License, Version 2.0 (the\n+ * \"License\"); you may not use this file except in compliance\n+ * with the License.  You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package org.apache.hadoop.hdds.scm.upgrade;\n+\n+import java.lang.annotation.ElementType;\n+import java.lang.annotation.Retention;\n+import java.lang.annotation.RetentionPolicy;\n+import java.lang.annotation.Target;\n+\n+import org.apache.hadoop.hdds.scm.upgrade.SCMLayoutFeatureCatalog.SCMLayoutFeature;\n+\n+/**\n+ * Annotation to specify if an API is backed up by a Layout Feature.\n+ */\n+@Target(ElementType.METHOD)\n+@Retention(RetentionPolicy.RUNTIME)\n+public @interface SCMLayoutFeatureAPI {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "432ee6a7447140620a7861341a5b01bc2759e639"}, "originalPosition": 33}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzAyMjI3NTczOnYy", "diffSide": "RIGHT", "path": "hadoop-hdds/server-scm/src/main/java/org/apache/hadoop/hdds/scm/upgrade/SCMLayoutFeatureAspect.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wNFQwMzozMDo0NVrOHM-Rig==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wOFQwNzoyNzowOVrOHOQJ-Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MzM2NTI1OA==", "bodyText": "Can be removed.", "url": "https://github.com/apache/ozone/pull/1392#discussion_r483365258", "createdAt": "2020-09-04T03:30:45Z", "author": {"login": "avijayanhwx"}, "path": "hadoop-hdds/server-scm/src/main/java/org/apache/hadoop/hdds/scm/upgrade/SCMLayoutFeatureAspect.java", "diffHunk": "@@ -0,0 +1,54 @@\n+/**\n+ * Licensed to the Apache Software Foundation (ASF) under one\n+ * or more contributor license agreements.  See the NOTICE file\n+ * distributed with this work for additional information\n+ * regarding copyright ownership.  The ASF licenses this file\n+ * to you under the Apache License, Version 2.0 (the\n+ * \"License\"); you may not use this file except in compliance\n+ * with the License.  You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package org.apache.hadoop.hdds.scm.upgrade;\n+\n+import static org.apache.hadoop.hdds.scm.exceptions.SCMException.ResultCodes.NOT_SUPPORTED_OPERATION;\n+\n+import org.apache.hadoop.hdds.scm.exceptions.SCMException;\n+import org.apache.hadoop.ozone.upgrade.LayoutFeature;\n+import org.apache.hadoop.ozone.upgrade.LayoutVersionManager;\n+import org.aspectj.lang.JoinPoint;\n+import org.aspectj.lang.annotation.Aspect;\n+import org.aspectj.lang.annotation.Before;\n+import org.aspectj.lang.reflect.MethodSignature;\n+\n+/**\n+ * 'Aspect' for SCM Layout Feature API. All methods annotated with the\n+ * specific annotation will have pre-processing done here to check layout\n+ * version compatibility.\n+ */\n+@Aspect\n+public class SCMLayoutFeatureAspect {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "432ee6a7447140620a7861341a5b01bc2759e639"}, "originalPosition": 37}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NDcwNjgwOQ==", "bodyText": "done", "url": "https://github.com/apache/ozone/pull/1392#discussion_r484706809", "createdAt": "2020-09-08T07:27:09Z", "author": {"login": "prashantpogde"}, "path": "hadoop-hdds/server-scm/src/main/java/org/apache/hadoop/hdds/scm/upgrade/SCMLayoutFeatureAspect.java", "diffHunk": "@@ -0,0 +1,54 @@\n+/**\n+ * Licensed to the Apache Software Foundation (ASF) under one\n+ * or more contributor license agreements.  See the NOTICE file\n+ * distributed with this work for additional information\n+ * regarding copyright ownership.  The ASF licenses this file\n+ * to you under the Apache License, Version 2.0 (the\n+ * \"License\"); you may not use this file except in compliance\n+ * with the License.  You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package org.apache.hadoop.hdds.scm.upgrade;\n+\n+import static org.apache.hadoop.hdds.scm.exceptions.SCMException.ResultCodes.NOT_SUPPORTED_OPERATION;\n+\n+import org.apache.hadoop.hdds.scm.exceptions.SCMException;\n+import org.apache.hadoop.ozone.upgrade.LayoutFeature;\n+import org.apache.hadoop.ozone.upgrade.LayoutVersionManager;\n+import org.aspectj.lang.JoinPoint;\n+import org.aspectj.lang.annotation.Aspect;\n+import org.aspectj.lang.annotation.Before;\n+import org.aspectj.lang.reflect.MethodSignature;\n+\n+/**\n+ * 'Aspect' for SCM Layout Feature API. All methods annotated with the\n+ * specific annotation will have pre-processing done here to check layout\n+ * version compatibility.\n+ */\n+@Aspect\n+public class SCMLayoutFeatureAspect {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MzM2NTI1OA=="}, "originalCommit": {"oid": "432ee6a7447140620a7861341a5b01bc2759e639"}, "originalPosition": 37}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzAyMjI3NzY0OnYy", "diffSide": "RIGHT", "path": "hadoop-hdds/server-scm/src/main/java/org/apache/hadoop/hdds/scm/upgrade/SCMLayoutFeatureCatalog.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wNFQwMzozMTozMlrOHM-Scw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wOFQwNzoyNzoxNVrOHOQKLQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MzM2NTQ5MQ==", "bodyText": "Should be \"HDDSLayoutFeature\" since it is common across SCM and DN.", "url": "https://github.com/apache/ozone/pull/1392#discussion_r483365491", "createdAt": "2020-09-04T03:31:32Z", "author": {"login": "avijayanhwx"}, "path": "hadoop-hdds/server-scm/src/main/java/org/apache/hadoop/hdds/scm/upgrade/SCMLayoutFeatureCatalog.java", "diffHunk": "@@ -0,0 +1,93 @@\n+/**\n+ * Licensed to the Apache Software Foundation (ASF) under one\n+ * or more contributor license agreements.  See the NOTICE file\n+ * distributed with this work for additional information\n+ * regarding copyright ownership.  The ASF licenses this file\n+ * to you under the Apache License, Version 2.0 (the\n+ * \"License\"); you may not use this file except in compliance\n+ * with the License.  You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package org.apache.hadoop.hdds.scm.upgrade;\n+\n+import java.util.Optional;\n+\n+import org.apache.hadoop.ozone.upgrade.LayoutFeature;\n+\n+/**\n+ * Catalog of SCM features.\n+ */\n+public class SCMLayoutFeatureCatalog {\n+\n+  /**\n+   * List of SCM Features.\n+   */\n+  public enum SCMLayoutFeature implements LayoutFeature {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "432ee6a7447140620a7861341a5b01bc2759e639"}, "originalPosition": 33}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NDcwNjg2MQ==", "bodyText": "done", "url": "https://github.com/apache/ozone/pull/1392#discussion_r484706861", "createdAt": "2020-09-08T07:27:15Z", "author": {"login": "prashantpogde"}, "path": "hadoop-hdds/server-scm/src/main/java/org/apache/hadoop/hdds/scm/upgrade/SCMLayoutFeatureCatalog.java", "diffHunk": "@@ -0,0 +1,93 @@\n+/**\n+ * Licensed to the Apache Software Foundation (ASF) under one\n+ * or more contributor license agreements.  See the NOTICE file\n+ * distributed with this work for additional information\n+ * regarding copyright ownership.  The ASF licenses this file\n+ * to you under the Apache License, Version 2.0 (the\n+ * \"License\"); you may not use this file except in compliance\n+ * with the License.  You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package org.apache.hadoop.hdds.scm.upgrade;\n+\n+import java.util.Optional;\n+\n+import org.apache.hadoop.ozone.upgrade.LayoutFeature;\n+\n+/**\n+ * Catalog of SCM features.\n+ */\n+public class SCMLayoutFeatureCatalog {\n+\n+  /**\n+   * List of SCM Features.\n+   */\n+  public enum SCMLayoutFeature implements LayoutFeature {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MzM2NTQ5MQ=="}, "originalCommit": {"oid": "432ee6a7447140620a7861341a5b01bc2759e639"}, "originalPosition": 33}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzAyMjI3OTIzOnYy", "diffSide": "RIGHT", "path": "hadoop-hdds/server-scm/src/main/java/org/apache/hadoop/hdds/scm/upgrade/SCMLayoutFeatureCatalog.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wNFQwMzozMjozNVrOHM-TXQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wNFQwMzozMjozNVrOHM-TXQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MzM2NTcyNQ==", "bodyText": "We already have \"test\" features in OM Catalog to support testing. HDDS can be left with just 'INITIAL_VERSION'.", "url": "https://github.com/apache/ozone/pull/1392#discussion_r483365725", "createdAt": "2020-09-04T03:32:35Z", "author": {"login": "avijayanhwx"}, "path": "hadoop-hdds/server-scm/src/main/java/org/apache/hadoop/hdds/scm/upgrade/SCMLayoutFeatureCatalog.java", "diffHunk": "@@ -0,0 +1,93 @@\n+/**\n+ * Licensed to the Apache Software Foundation (ASF) under one\n+ * or more contributor license agreements.  See the NOTICE file\n+ * distributed with this work for additional information\n+ * regarding copyright ownership.  The ASF licenses this file\n+ * to you under the Apache License, Version 2.0 (the\n+ * \"License\"); you may not use this file except in compliance\n+ * with the License.  You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package org.apache.hadoop.hdds.scm.upgrade;\n+\n+import java.util.Optional;\n+\n+import org.apache.hadoop.ozone.upgrade.LayoutFeature;\n+\n+/**\n+ * Catalog of SCM features.\n+ */\n+public class SCMLayoutFeatureCatalog {\n+\n+  /**\n+   * List of SCM Features.\n+   */\n+  public enum SCMLayoutFeature implements LayoutFeature {\n+    INITIAL_VERSION(0, \"Initial Layout Version\"),\n+    CREATE_EC(1, \"\"),", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "432ee6a7447140620a7861341a5b01bc2759e639"}, "originalPosition": 35}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzAyMjI3OTY1OnYy", "diffSide": "RIGHT", "path": "hadoop-hdds/server-scm/src/main/java/org/apache/hadoop/hdds/scm/upgrade/SCMLayoutFeatureCatalog.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wNFQwMzozMjo1MlrOHM-Tmg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wOFQwNzoyNzoyM1rOHOQKgg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MzM2NTc4Ng==", "bodyText": "Can be removed.", "url": "https://github.com/apache/ozone/pull/1392#discussion_r483365786", "createdAt": "2020-09-04T03:32:52Z", "author": {"login": "avijayanhwx"}, "path": "hadoop-hdds/server-scm/src/main/java/org/apache/hadoop/hdds/scm/upgrade/SCMLayoutFeatureCatalog.java", "diffHunk": "@@ -0,0 +1,93 @@\n+/**\n+ * Licensed to the Apache Software Foundation (ASF) under one\n+ * or more contributor license agreements.  See the NOTICE file\n+ * distributed with this work for additional information\n+ * regarding copyright ownership.  The ASF licenses this file\n+ * to you under the Apache License, Version 2.0 (the\n+ * \"License\"); you may not use this file except in compliance\n+ * with the License.  You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package org.apache.hadoop.hdds.scm.upgrade;\n+\n+import java.util.Optional;\n+\n+import org.apache.hadoop.ozone.upgrade.LayoutFeature;\n+\n+/**\n+ * Catalog of SCM features.\n+ */\n+public class SCMLayoutFeatureCatalog {\n+\n+  /**\n+   * List of SCM Features.\n+   */\n+  public enum SCMLayoutFeature implements LayoutFeature {\n+    INITIAL_VERSION(0, \"Initial Layout Version\"),\n+    CREATE_EC(1, \"\"),\n+    NEW_FEATURE(2, \"new feature\", new NewSCMFeatureUpgradeAction());\n+\n+\n+    private int layoutVersion;\n+    private String description;\n+    private Optional<SCMUpgradeAction> scmUpgradeAction = Optional.empty();\n+\n+    SCMLayoutFeature(final int layoutVersion, String description) {\n+      this.layoutVersion = layoutVersion;\n+      this.description = description;\n+    }\n+\n+    SCMLayoutFeature(final int layoutVersion, String description,\n+                    SCMUpgradeAction upgradeAction) {\n+      this.layoutVersion = layoutVersion;\n+      this.description = description;\n+      scmUpgradeAction = Optional.of(upgradeAction);\n+    }\n+\n+    @Override\n+    public int layoutVersion() {\n+      return layoutVersion;\n+    }\n+\n+    @Override\n+    public String description() {\n+      return description;\n+    }\n+\n+    @Override\n+    public Optional<SCMUpgradeAction> onFinalizeAction() {\n+      return scmUpgradeAction;\n+    }\n+  }\n+\n+  /**\n+   * This is an example of an \"API\" that uses a new Layout feature (EC) that is\n+   * not yet supported by the current layout version. The following can be\n+   * \"guarded\" by just adding the following annotation, thereby keeping the\n+   * method logic and upgrade logic separate.\n+   */\n+  @SCMLayoutFeatureAPI(SCMLayoutFeature.CREATE_EC)", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "432ee6a7447140620a7861341a5b01bc2759e639"}, "originalPosition": 77}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NDcwNjk0Ng==", "bodyText": "done", "url": "https://github.com/apache/ozone/pull/1392#discussion_r484706946", "createdAt": "2020-09-08T07:27:23Z", "author": {"login": "prashantpogde"}, "path": "hadoop-hdds/server-scm/src/main/java/org/apache/hadoop/hdds/scm/upgrade/SCMLayoutFeatureCatalog.java", "diffHunk": "@@ -0,0 +1,93 @@\n+/**\n+ * Licensed to the Apache Software Foundation (ASF) under one\n+ * or more contributor license agreements.  See the NOTICE file\n+ * distributed with this work for additional information\n+ * regarding copyright ownership.  The ASF licenses this file\n+ * to you under the Apache License, Version 2.0 (the\n+ * \"License\"); you may not use this file except in compliance\n+ * with the License.  You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package org.apache.hadoop.hdds.scm.upgrade;\n+\n+import java.util.Optional;\n+\n+import org.apache.hadoop.ozone.upgrade.LayoutFeature;\n+\n+/**\n+ * Catalog of SCM features.\n+ */\n+public class SCMLayoutFeatureCatalog {\n+\n+  /**\n+   * List of SCM Features.\n+   */\n+  public enum SCMLayoutFeature implements LayoutFeature {\n+    INITIAL_VERSION(0, \"Initial Layout Version\"),\n+    CREATE_EC(1, \"\"),\n+    NEW_FEATURE(2, \"new feature\", new NewSCMFeatureUpgradeAction());\n+\n+\n+    private int layoutVersion;\n+    private String description;\n+    private Optional<SCMUpgradeAction> scmUpgradeAction = Optional.empty();\n+\n+    SCMLayoutFeature(final int layoutVersion, String description) {\n+      this.layoutVersion = layoutVersion;\n+      this.description = description;\n+    }\n+\n+    SCMLayoutFeature(final int layoutVersion, String description,\n+                    SCMUpgradeAction upgradeAction) {\n+      this.layoutVersion = layoutVersion;\n+      this.description = description;\n+      scmUpgradeAction = Optional.of(upgradeAction);\n+    }\n+\n+    @Override\n+    public int layoutVersion() {\n+      return layoutVersion;\n+    }\n+\n+    @Override\n+    public String description() {\n+      return description;\n+    }\n+\n+    @Override\n+    public Optional<SCMUpgradeAction> onFinalizeAction() {\n+      return scmUpgradeAction;\n+    }\n+  }\n+\n+  /**\n+   * This is an example of an \"API\" that uses a new Layout feature (EC) that is\n+   * not yet supported by the current layout version. The following can be\n+   * \"guarded\" by just adding the following annotation, thereby keeping the\n+   * method logic and upgrade logic separate.\n+   */\n+  @SCMLayoutFeatureAPI(SCMLayoutFeature.CREATE_EC)", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MzM2NTc4Ng=="}, "originalCommit": {"oid": "432ee6a7447140620a7861341a5b01bc2759e639"}, "originalPosition": 77}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzAyMjI4OTE1OnYy", "diffSide": "RIGHT", "path": "hadoop-hdds/server-scm/src/main/java/org/apache/hadoop/hdds/scm/upgrade/SCMLayoutVersionManager.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wNFQwMzozOTozM1rOHM-ZFg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wNFQwMzozOTozM1rOHM-ZFg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MzM2NzE5MA==", "bodyText": "Can we rename to HDDSLayoutVersionManager to reuse between SCM and DN?", "url": "https://github.com/apache/ozone/pull/1392#discussion_r483367190", "createdAt": "2020-09-04T03:39:33Z", "author": {"login": "avijayanhwx"}, "path": "hadoop-hdds/server-scm/src/main/java/org/apache/hadoop/hdds/scm/upgrade/SCMLayoutVersionManager.java", "diffHunk": "@@ -0,0 +1,91 @@\n+/**\n+ * Licensed to the Apache Software Foundation (ASF) under one\n+ * or more contributor license agreements.  See the NOTICE file\n+ * distributed with this work for additional information\n+ * regarding copyright ownership.  The ASF licenses this file\n+ * to you under the Apache License, Version 2.0 (the\n+ * \"License\"); you may not use this file except in compliance\n+ * with the License.  You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package org.apache.hadoop.hdds.scm.upgrade;\n+\n+import static org.apache.hadoop.hdds.scm.exceptions.SCMException.ResultCodes.NOT_SUPPORTED_OPERATION;\n+import org.apache.hadoop.ozone.common.Storage;\n+import org.apache.hadoop.hdds.scm.server.SCMStorageConfig;\n+import org.apache.hadoop.hdds.scm.exceptions.SCMException;\n+import org.apache.hadoop.hdds.scm.upgrade.SCMLayoutFeatureCatalog.SCMLayoutFeature;\n+import org.apache.hadoop.ozone.upgrade.AbstractLayoutVersionManager;\n+import org.apache.hadoop.ozone.upgrade.LayoutVersionManager;\n+\n+import com.google.common.annotations.VisibleForTesting;\n+\n+/**\n+ * Class to manage layout versions and features for Storage Container Manager.\n+ */\n+public final class SCMLayoutVersionManager extends AbstractLayoutVersionManager {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "432ee6a7447140620a7861341a5b01bc2759e639"}, "originalPosition": 34}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzAyMjI5Mjg0OnYy", "diffSide": "RIGHT", "path": "hadoop-hdds/server-scm/src/main/java/org/apache/hadoop/hdds/scm/upgrade/SCMLayoutFeatureCatalog.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wNFQwMzo0MTo1NlrOHM-bJA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wOFQwNzoyNzoyOVrOHOQKwA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MzM2NzcxNg==", "bodyText": "We may need an 'HDDSUpgradeAction' from which SCMUpgradeAction is extended. Then, in this class we can have something like  Optional<? extends HDDSUpgradeAction>.", "url": "https://github.com/apache/ozone/pull/1392#discussion_r483367716", "createdAt": "2020-09-04T03:41:56Z", "author": {"login": "avijayanhwx"}, "path": "hadoop-hdds/server-scm/src/main/java/org/apache/hadoop/hdds/scm/upgrade/SCMLayoutFeatureCatalog.java", "diffHunk": "@@ -0,0 +1,93 @@\n+/**\n+ * Licensed to the Apache Software Foundation (ASF) under one\n+ * or more contributor license agreements.  See the NOTICE file\n+ * distributed with this work for additional information\n+ * regarding copyright ownership.  The ASF licenses this file\n+ * to you under the Apache License, Version 2.0 (the\n+ * \"License\"); you may not use this file except in compliance\n+ * with the License.  You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package org.apache.hadoop.hdds.scm.upgrade;\n+\n+import java.util.Optional;\n+\n+import org.apache.hadoop.ozone.upgrade.LayoutFeature;\n+\n+/**\n+ * Catalog of SCM features.\n+ */\n+public class SCMLayoutFeatureCatalog {\n+\n+  /**\n+   * List of SCM Features.\n+   */\n+  public enum SCMLayoutFeature implements LayoutFeature {\n+    INITIAL_VERSION(0, \"Initial Layout Version\"),\n+    CREATE_EC(1, \"\"),\n+    NEW_FEATURE(2, \"new feature\", new NewSCMFeatureUpgradeAction());\n+\n+\n+    private int layoutVersion;\n+    private String description;\n+    private Optional<SCMUpgradeAction> scmUpgradeAction = Optional.empty();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "432ee6a7447140620a7861341a5b01bc2759e639"}, "originalPosition": 41}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NDcwNzAwOA==", "bodyText": "done", "url": "https://github.com/apache/ozone/pull/1392#discussion_r484707008", "createdAt": "2020-09-08T07:27:29Z", "author": {"login": "prashantpogde"}, "path": "hadoop-hdds/server-scm/src/main/java/org/apache/hadoop/hdds/scm/upgrade/SCMLayoutFeatureCatalog.java", "diffHunk": "@@ -0,0 +1,93 @@\n+/**\n+ * Licensed to the Apache Software Foundation (ASF) under one\n+ * or more contributor license agreements.  See the NOTICE file\n+ * distributed with this work for additional information\n+ * regarding copyright ownership.  The ASF licenses this file\n+ * to you under the Apache License, Version 2.0 (the\n+ * \"License\"); you may not use this file except in compliance\n+ * with the License.  You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package org.apache.hadoop.hdds.scm.upgrade;\n+\n+import java.util.Optional;\n+\n+import org.apache.hadoop.ozone.upgrade.LayoutFeature;\n+\n+/**\n+ * Catalog of SCM features.\n+ */\n+public class SCMLayoutFeatureCatalog {\n+\n+  /**\n+   * List of SCM Features.\n+   */\n+  public enum SCMLayoutFeature implements LayoutFeature {\n+    INITIAL_VERSION(0, \"Initial Layout Version\"),\n+    CREATE_EC(1, \"\"),\n+    NEW_FEATURE(2, \"new feature\", new NewSCMFeatureUpgradeAction());\n+\n+\n+    private int layoutVersion;\n+    private String description;\n+    private Optional<SCMUpgradeAction> scmUpgradeAction = Optional.empty();", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MzM2NzcxNg=="}, "originalCommit": {"oid": "432ee6a7447140620a7861341a5b01bc2759e639"}, "originalPosition": 41}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzAyNjgwNjY2OnYy", "diffSide": "RIGHT", "path": "hadoop-hdds/common/src/main/java/org/apache/hadoop/hdds/scm/storage/ContainerProtocolCalls.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wNlQwNDoyNzoyMlrOHNmNyA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wOFQwNzoyOToyOVrOHOQPog==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NDAxOTY1Ng==", "bodyText": "This new introduced method is not used here, what's this method intended used for?", "url": "https://github.com/apache/ozone/pull/1392#discussion_r484019656", "createdAt": "2020-09-06T04:27:22Z", "author": {"login": "linyiqun"}, "path": "hadoop-hdds/common/src/main/java/org/apache/hadoop/hdds/scm/storage/ContainerProtocolCalls.java", "diffHunk": "@@ -578,4 +581,35 @@ private static Text getService(DatanodeBlockID blockId) {\n     validators.add(validator);\n     return validators;\n   }\n+\n+  public static HashMap<DatanodeDetails, GetBlockResponseProto>\n+      getBlockFromAllNodes(", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "432ee6a7447140620a7861341a5b01bc2759e639"}, "originalPosition": 24}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NDcwODI1OA==", "bodyText": "not sure, why these changes are showed up in this PR. These changes were not made as part of this PR.\nI have re-uploaded the changes and it should go away.", "url": "https://github.com/apache/ozone/pull/1392#discussion_r484708258", "createdAt": "2020-09-08T07:29:29Z", "author": {"login": "prashantpogde"}, "path": "hadoop-hdds/common/src/main/java/org/apache/hadoop/hdds/scm/storage/ContainerProtocolCalls.java", "diffHunk": "@@ -578,4 +581,35 @@ private static Text getService(DatanodeBlockID blockId) {\n     validators.add(validator);\n     return validators;\n   }\n+\n+  public static HashMap<DatanodeDetails, GetBlockResponseProto>\n+      getBlockFromAllNodes(", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NDAxOTY1Ng=="}, "originalCommit": {"oid": "432ee6a7447140620a7861341a5b01bc2759e639"}, "originalPosition": 24}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzAyNjgwOTg4OnYy", "diffSide": "RIGHT", "path": "hadoop-hdds/tools/src/main/java/org/apache/hadoop/hdds/scm/cli/ScmSubcommand.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wNlQwNDozMzozNlrOHNmPNA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wOFQwNzoyOTo1NVrOHOQQsA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NDAyMDAyMA==", "bodyText": "I see lots of code update focus on ScmSubcommand refactoring, is this related with this JIRA? I don't see there we do some common rolling upgrade logic but seems just a code refactoring.", "url": "https://github.com/apache/ozone/pull/1392#discussion_r484020020", "createdAt": "2020-09-06T04:33:36Z", "author": {"login": "linyiqun"}, "path": "hadoop-hdds/tools/src/main/java/org/apache/hadoop/hdds/scm/cli/ScmSubcommand.java", "diffHunk": "@@ -0,0 +1,43 @@\n+/*\n+ * Licensed to the Apache Software Foundation (ASF) under one\n+ * or more contributor license agreements.  See the NOTICE file\n+ * distributed with this work for additional information\n+ * regarding copyright ownership.  The ASF licenses this file\n+ * to you under the Apache License, Version 2.0 (the\n+ * \"License\"); you may not use this file except in compliance\n+ * with the License.  You may obtain a copy of the License at\n+ * <p>\n+ * http://www.apache.org/licenses/LICENSE-2.0\n+ * <p>\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+package org.apache.hadoop.hdds.scm.cli;\n+\n+import org.apache.hadoop.hdds.scm.client.ScmClient;\n+import picocli.CommandLine;\n+\n+import java.io.IOException;\n+import java.util.concurrent.Callable;\n+\n+/**\n+ * Base class for admin commands that connect via SCM client.\n+ */\n+public abstract class ScmSubcommand implements Callable<Void> {\n+\n+  @CommandLine.Mixin\n+  private ScmOption scmOption;\n+\n+  protected abstract void execute(ScmClient client) throws IOException;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "432ee6a7447140620a7861341a5b01bc2759e639"}, "originalPosition": 34}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NDcwODUyOA==", "bodyText": "NA. Please see the comment above.", "url": "https://github.com/apache/ozone/pull/1392#discussion_r484708528", "createdAt": "2020-09-08T07:29:55Z", "author": {"login": "prashantpogde"}, "path": "hadoop-hdds/tools/src/main/java/org/apache/hadoop/hdds/scm/cli/ScmSubcommand.java", "diffHunk": "@@ -0,0 +1,43 @@\n+/*\n+ * Licensed to the Apache Software Foundation (ASF) under one\n+ * or more contributor license agreements.  See the NOTICE file\n+ * distributed with this work for additional information\n+ * regarding copyright ownership.  The ASF licenses this file\n+ * to you under the Apache License, Version 2.0 (the\n+ * \"License\"); you may not use this file except in compliance\n+ * with the License.  You may obtain a copy of the License at\n+ * <p>\n+ * http://www.apache.org/licenses/LICENSE-2.0\n+ * <p>\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+package org.apache.hadoop.hdds.scm.cli;\n+\n+import org.apache.hadoop.hdds.scm.client.ScmClient;\n+import picocli.CommandLine;\n+\n+import java.io.IOException;\n+import java.util.concurrent.Callable;\n+\n+/**\n+ * Base class for admin commands that connect via SCM client.\n+ */\n+public abstract class ScmSubcommand implements Callable<Void> {\n+\n+  @CommandLine.Mixin\n+  private ScmOption scmOption;\n+\n+  protected abstract void execute(ScmClient client) throws IOException;", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NDAyMDAyMA=="}, "originalCommit": {"oid": "432ee6a7447140620a7861341a5b01bc2759e639"}, "originalPosition": 34}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzAyNjgxMTgzOnYy", "diffSide": "RIGHT", "path": "hadoop-ozone/ozone-manager/src/main/java/org/apache/hadoop/ozone/om/OzoneManager.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wNlQwNDozNjo0MFrOHNmQCw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wOFQwNzozMDowNlrOHOQRGg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NDAyMDIzNQ==", "bodyText": "RenameKey on Bucket seems also not related with this JIRA if I understand this PR correctly.", "url": "https://github.com/apache/ozone/pull/1392#discussion_r484020235", "createdAt": "2020-09-06T04:36:40Z", "author": {"login": "linyiqun"}, "path": "hadoop-ozone/ozone-manager/src/main/java/org/apache/hadoop/ozone/om/OzoneManager.java", "diffHunk": "@@ -2244,6 +2248,14 @@ public OmKeyInfo lookupKey(OmKeyArgs args) throws IOException {\n     }\n   }\n \n+\n+  @Override\n+  public void renameKeys(OmRenameKeys omRenameKeys)", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "432ee6a7447140620a7861341a5b01bc2759e639"}, "originalPosition": 49}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NDcwODYzNA==", "bodyText": "NA, like above.", "url": "https://github.com/apache/ozone/pull/1392#discussion_r484708634", "createdAt": "2020-09-08T07:30:06Z", "author": {"login": "prashantpogde"}, "path": "hadoop-ozone/ozone-manager/src/main/java/org/apache/hadoop/ozone/om/OzoneManager.java", "diffHunk": "@@ -2244,6 +2248,14 @@ public OmKeyInfo lookupKey(OmKeyArgs args) throws IOException {\n     }\n   }\n \n+\n+  @Override\n+  public void renameKeys(OmRenameKeys omRenameKeys)", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NDAyMDIzNQ=="}, "originalCommit": {"oid": "432ee6a7447140620a7861341a5b01bc2759e639"}, "originalPosition": 49}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzAzMjU3Njk0OnYy", "diffSide": "RIGHT", "path": "hadoop-hdds/common/src/main/java/org/apache/hadoop/hdds/scm/exceptions/SCMException.java", "isResolved": true, "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wOFQxMTo1NTo0MFrOHOZbtw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wOFQyMToxOTo0M1rOHOuZTA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NDg1ODgwNw==", "bodyText": "New SCMException introduced here that broken the unit test:\n[ERROR] Tests run: 1, Failures: 1, Errors: 0, Skipped: 0, Time elapsed: 0.077 s <<< FAILURE! - in org.apache.hadoop.hdds.scm.exceptions.TestSCMExceptionResultCodes\n[ERROR] codeMapping(org.apache.hadoop.hdds.scm.exceptions.TestSCMExceptionResultCodes)  Time elapsed: 0.023 s  <<< FAILURE!\njava.lang.AssertionError: expected:<30> but was:<29>\nat org.junit.Assert.fail(Assert.java:88)\nat org.junit.Assert.failNotEquals(Assert.java:743)\nat org.junit.Assert.assertEquals(Assert.java:118)\nat org.junit.Assert.assertEquals(Assert.java:555)\nat org.junit.Assert.assertEquals(Assert.java:542)\nat org.apache.hadoop.hdds.scm.exceptions.TestSCMExceptionResultCodes.codeMapping(TestSCMExceptionResultCodes.java:35)", "url": "https://github.com/apache/ozone/pull/1392#discussion_r484858807", "createdAt": "2020-09-08T11:55:40Z", "author": {"login": "linyiqun"}, "path": "hadoop-hdds/common/src/main/java/org/apache/hadoop/hdds/scm/exceptions/SCMException.java", "diffHunk": "@@ -123,6 +123,7 @@ public ResultCodes getResult() {\n     FAILED_TO_INIT_CONTAINER_PLACEMENT_POLICY,\n     FAILED_TO_ALLOCATE_ENOUGH_BLOCKS,\n     INTERNAL_ERROR,\n-    FAILED_TO_INIT_PIPELINE_CHOOSE_POLICY\n+    FAILED_TO_INIT_PIPELINE_CHOOSE_POLICY,\n+    NOT_SUPPORTED_OPERATION,", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "188b94f6734a20ef9459c7b100bab8b9113117b0"}, "originalPosition": 6}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NTExNTM5Nw==", "bodyText": "I don't see usages for 'NOT_SUPPORTED_OPERATION' now. Can it be removed?", "url": "https://github.com/apache/ozone/pull/1392#discussion_r485115397", "createdAt": "2020-09-08T18:27:50Z", "author": {"login": "avijayanhwx"}, "path": "hadoop-hdds/common/src/main/java/org/apache/hadoop/hdds/scm/exceptions/SCMException.java", "diffHunk": "@@ -123,6 +123,7 @@ public ResultCodes getResult() {\n     FAILED_TO_INIT_CONTAINER_PLACEMENT_POLICY,\n     FAILED_TO_ALLOCATE_ENOUGH_BLOCKS,\n     INTERNAL_ERROR,\n-    FAILED_TO_INIT_PIPELINE_CHOOSE_POLICY\n+    FAILED_TO_INIT_PIPELINE_CHOOSE_POLICY,\n+    NOT_SUPPORTED_OPERATION,", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NDg1ODgwNw=="}, "originalCommit": {"oid": "188b94f6734a20ef9459c7b100bab8b9113117b0"}, "originalPosition": 6}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NTIwMjI1Mg==", "bodyText": "yup", "url": "https://github.com/apache/ozone/pull/1392#discussion_r485202252", "createdAt": "2020-09-08T21:19:43Z", "author": {"login": "prashantpogde"}, "path": "hadoop-hdds/common/src/main/java/org/apache/hadoop/hdds/scm/exceptions/SCMException.java", "diffHunk": "@@ -123,6 +123,7 @@ public ResultCodes getResult() {\n     FAILED_TO_INIT_CONTAINER_PLACEMENT_POLICY,\n     FAILED_TO_ALLOCATE_ENOUGH_BLOCKS,\n     INTERNAL_ERROR,\n-    FAILED_TO_INIT_PIPELINE_CHOOSE_POLICY\n+    FAILED_TO_INIT_PIPELINE_CHOOSE_POLICY,\n+    NOT_SUPPORTED_OPERATION,", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NDg1ODgwNw=="}, "originalCommit": {"oid": "188b94f6734a20ef9459c7b100bab8b9113117b0"}, "originalPosition": 6}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzAzMjU4ODE3OnYy", "diffSide": "RIGHT", "path": "hadoop-hdds/common/src/main/java/org/apache/hadoop/hdds/upgrade/HDDSLayoutVersionManager.java", "isResolved": true, "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wOFQxMTo1ODo1NlrOHOZifA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wOVQwMzoyMzoxN1rOHO1NsQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NDg2MDU0MA==", "bodyText": "Can we add the unit test for HDDSLayoutVersionManager like TestOMVersionManager does?", "url": "https://github.com/apache/ozone/pull/1392#discussion_r484860540", "createdAt": "2020-09-08T11:58:56Z", "author": {"login": "linyiqun"}, "path": "hadoop-hdds/common/src/main/java/org/apache/hadoop/hdds/upgrade/HDDSLayoutVersionManager.java", "diffHunk": "@@ -0,0 +1,92 @@\n+/**\n+ * Licensed to the Apache Software Foundation (ASF) under one\n+ * or more contributor license agreements.  See the NOTICE file\n+ * distributed with this work for additional information\n+ * regarding copyright ownership.  The ASF licenses this file\n+ * to you under the Apache License, Version 2.0 (the\n+ * \"License\"); you may not use this file except in compliance\n+ * with the License.  You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package org.apache.hadoop.hdds.upgrade;\n+\n+\n+import java.io.IOException;\n+\n+import org.apache.hadoop.ozone.common.Storage;\n+import org.apache.hadoop.hdds.upgrade.HDDSLayoutFeatureCatalog.HDDSLayoutFeature;\n+import org.apache.hadoop.ozone.upgrade.AbstractLayoutVersionManager;\n+import org.apache.hadoop.ozone.upgrade.LayoutVersionManager;\n+\n+import com.google.common.annotations.VisibleForTesting;\n+\n+/**\n+ * Class to manage layout versions and features for Storage Container Manager\n+ * and DataNodes.\n+ */\n+public final class HDDSLayoutVersionManager extends", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "188b94f6734a20ef9459c7b100bab8b9113117b0"}, "originalPosition": 35}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NTIwMjU2Mg==", "bodyText": "yup", "url": "https://github.com/apache/ozone/pull/1392#discussion_r485202562", "createdAt": "2020-09-08T21:20:23Z", "author": {"login": "prashantpogde"}, "path": "hadoop-hdds/common/src/main/java/org/apache/hadoop/hdds/upgrade/HDDSLayoutVersionManager.java", "diffHunk": "@@ -0,0 +1,92 @@\n+/**\n+ * Licensed to the Apache Software Foundation (ASF) under one\n+ * or more contributor license agreements.  See the NOTICE file\n+ * distributed with this work for additional information\n+ * regarding copyright ownership.  The ASF licenses this file\n+ * to you under the Apache License, Version 2.0 (the\n+ * \"License\"); you may not use this file except in compliance\n+ * with the License.  You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package org.apache.hadoop.hdds.upgrade;\n+\n+\n+import java.io.IOException;\n+\n+import org.apache.hadoop.ozone.common.Storage;\n+import org.apache.hadoop.hdds.upgrade.HDDSLayoutFeatureCatalog.HDDSLayoutFeature;\n+import org.apache.hadoop.ozone.upgrade.AbstractLayoutVersionManager;\n+import org.apache.hadoop.ozone.upgrade.LayoutVersionManager;\n+\n+import com.google.common.annotations.VisibleForTesting;\n+\n+/**\n+ * Class to manage layout versions and features for Storage Container Manager\n+ * and DataNodes.\n+ */\n+public final class HDDSLayoutVersionManager extends", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NDg2MDU0MA=="}, "originalCommit": {"oid": "188b94f6734a20ef9459c7b100bab8b9113117b0"}, "originalPosition": 35}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NTMxMzk2OQ==", "bodyText": "I will add the test in another PR.", "url": "https://github.com/apache/ozone/pull/1392#discussion_r485313969", "createdAt": "2020-09-09T03:23:17Z", "author": {"login": "prashantpogde"}, "path": "hadoop-hdds/common/src/main/java/org/apache/hadoop/hdds/upgrade/HDDSLayoutVersionManager.java", "diffHunk": "@@ -0,0 +1,92 @@\n+/**\n+ * Licensed to the Apache Software Foundation (ASF) under one\n+ * or more contributor license agreements.  See the NOTICE file\n+ * distributed with this work for additional information\n+ * regarding copyright ownership.  The ASF licenses this file\n+ * to you under the Apache License, Version 2.0 (the\n+ * \"License\"); you may not use this file except in compliance\n+ * with the License.  You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package org.apache.hadoop.hdds.upgrade;\n+\n+\n+import java.io.IOException;\n+\n+import org.apache.hadoop.ozone.common.Storage;\n+import org.apache.hadoop.hdds.upgrade.HDDSLayoutFeatureCatalog.HDDSLayoutFeature;\n+import org.apache.hadoop.ozone.upgrade.AbstractLayoutVersionManager;\n+import org.apache.hadoop.ozone.upgrade.LayoutVersionManager;\n+\n+import com.google.common.annotations.VisibleForTesting;\n+\n+/**\n+ * Class to manage layout versions and features for Storage Container Manager\n+ * and DataNodes.\n+ */\n+public final class HDDSLayoutVersionManager extends", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NDg2MDU0MA=="}, "originalCommit": {"oid": "188b94f6734a20ef9459c7b100bab8b9113117b0"}, "originalPosition": 35}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzAzNDIxNDE2OnYy", "diffSide": "RIGHT", "path": "hadoop-hdds/server-scm/src/main/java/org/apache/hadoop/hdds/scm/server/upgrade/NewSCMFeatureUpgradeAction.java", "isResolved": true, "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wOFQxODoyNjo0N1rOHOpD3Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wOVQxNjo0NTowNlrOHPQxng==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NTExNDg0NQ==", "bodyText": "Unused class?  Can be removed.", "url": "https://github.com/apache/ozone/pull/1392#discussion_r485114845", "createdAt": "2020-09-08T18:26:47Z", "author": {"login": "avijayanhwx"}, "path": "hadoop-hdds/server-scm/src/main/java/org/apache/hadoop/hdds/scm/server/upgrade/NewSCMFeatureUpgradeAction.java", "diffHunk": "@@ -0,0 +1,34 @@\n+/**\n+ * Licensed to the Apache Software Foundation (ASF) under one\n+ * or more contributor license agreements.  See the NOTICE file\n+ * distributed with this work for additional information\n+ * regarding copyright ownership.  The ASF licenses this file\n+ * to you under the Apache License, Version 2.0 (the\n+ * \"License\"); you may not use this file except in compliance\n+ * with the License.  You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package org.apache.hadoop.hdds.scm.server.upgrade;\n+\n+import org.apache.hadoop.hdds.scm.server.StorageContainerManager;\n+import org.apache.hadoop.hdds.upgrade.HDDSUpgradeAction;\n+\n+/**\n+ * Example SCM Action class to help with understanding.\n+ */\n+public class NewSCMFeatureUpgradeAction implements", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "188b94f6734a20ef9459c7b100bab8b9113117b0"}, "originalPosition": 27}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NTIwMzI3Ng==", "bodyText": "Yes, left it as an example.  Can we remove it after we are done with other upgrade changes too ?", "url": "https://github.com/apache/ozone/pull/1392#discussion_r485203276", "createdAt": "2020-09-08T21:21:57Z", "author": {"login": "prashantpogde"}, "path": "hadoop-hdds/server-scm/src/main/java/org/apache/hadoop/hdds/scm/server/upgrade/NewSCMFeatureUpgradeAction.java", "diffHunk": "@@ -0,0 +1,34 @@\n+/**\n+ * Licensed to the Apache Software Foundation (ASF) under one\n+ * or more contributor license agreements.  See the NOTICE file\n+ * distributed with this work for additional information\n+ * regarding copyright ownership.  The ASF licenses this file\n+ * to you under the Apache License, Version 2.0 (the\n+ * \"License\"); you may not use this file except in compliance\n+ * with the License.  You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package org.apache.hadoop.hdds.scm.server.upgrade;\n+\n+import org.apache.hadoop.hdds.scm.server.StorageContainerManager;\n+import org.apache.hadoop.hdds.upgrade.HDDSUpgradeAction;\n+\n+/**\n+ * Example SCM Action class to help with understanding.\n+ */\n+public class NewSCMFeatureUpgradeAction implements", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NTExNDg0NQ=="}, "originalCommit": {"oid": "188b94f6734a20ef9459c7b100bab8b9113117b0"}, "originalPosition": 27}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NTc2NTUzNA==", "bodyText": "Yes, sure.", "url": "https://github.com/apache/ozone/pull/1392#discussion_r485765534", "createdAt": "2020-09-09T16:45:06Z", "author": {"login": "avijayanhwx"}, "path": "hadoop-hdds/server-scm/src/main/java/org/apache/hadoop/hdds/scm/server/upgrade/NewSCMFeatureUpgradeAction.java", "diffHunk": "@@ -0,0 +1,34 @@\n+/**\n+ * Licensed to the Apache Software Foundation (ASF) under one\n+ * or more contributor license agreements.  See the NOTICE file\n+ * distributed with this work for additional information\n+ * regarding copyright ownership.  The ASF licenses this file\n+ * to you under the Apache License, Version 2.0 (the\n+ * \"License\"); you may not use this file except in compliance\n+ * with the License.  You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package org.apache.hadoop.hdds.scm.server.upgrade;\n+\n+import org.apache.hadoop.hdds.scm.server.StorageContainerManager;\n+import org.apache.hadoop.hdds.upgrade.HDDSUpgradeAction;\n+\n+/**\n+ * Example SCM Action class to help with understanding.\n+ */\n+public class NewSCMFeatureUpgradeAction implements", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NTExNDg0NQ=="}, "originalCommit": {"oid": "188b94f6734a20ef9459c7b100bab8b9113117b0"}, "originalPosition": 27}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4850, "cost": 1, "resetAt": "2021-11-11T21:28:48Z"}}}