{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDY1NDgwMzE2", "number": 1308, "title": "HDDS-1889. Add support for verifying multiline log entry", "bodyText": "What changes were proposed in this pull request?\nAdded multi line support for Audit messages in TestOzoneAuditLogger\nAdded hamcrest in testing scope to allow for more legible testing\nThis PR is a re-submit of the now cancelled #1293, as the git branch got tangled up.\nWhat is the link to the Apache JIRA\nhttps://issues.apache.org/jira/browse/HDDS-1889\nHow was this patch tested?\nadded messageIncludesMultilineException in TestOzoneAuditLogger", "createdAt": "2020-08-10T12:51:15Z", "url": "https://github.com/apache/ozone/pull/1308", "merged": true, "mergeCommit": {"oid": "dc5a997601ad7f3fdf04e6c43f1c49f54fd70195"}, "closed": true, "closedAt": "2020-09-03T03:42:52Z", "author": {"login": "llemec"}, "timelineItems": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABc9hlQ_AH2gAyNDY1NDgwMzE2OjI5ZWZiYzllNTdiZjRiYmI2N2RjY2Q5MzA2NDFjZmE1NDBkZDQ2OTE=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdFIPK4AFqTQ4MTQ3MDUzOA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "29efbc9e57bf4bbb67dccd930641cfa540dd4691", "author": {"user": {"login": "llemec", "name": null}}, "url": "https://github.com/apache/ozone/commit/29efbc9e57bf4bbb67dccd930641cfa540dd4691", "committedDate": "2020-08-10T12:43:02Z", "message": "checkstyle fix"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDY0MzE5NDI4", "url": "https://github.com/apache/ozone/pull/1308#pullrequestreview-464319428", "createdAt": "2020-08-10T15:11:29Z", "commit": {"oid": "29efbc9e57bf4bbb67dccd930641cfa540dd4691"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xMFQxNToxMToyOVrOG-S1lA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xMFQxNToxMToyOVrOG-S1lA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2Nzk3MzUyNA==", "bodyText": "at ...TestOzoneAuditLogger.java:160\nThis is very fragile.  Any code change above line 160 (as benign as changing imports or whitespace) might break it.  Can you please omit the check for line number?", "url": "https://github.com/apache/ozone/pull/1308#discussion_r467973524", "createdAt": "2020-08-10T15:11:29Z", "author": {"login": "adoroszlai"}, "path": "hadoop-hdds/common/src/test/java/org/apache/hadoop/ozone/audit/TestOzoneAuditLogger.java", "diffHunk": "@@ -143,7 +150,35 @@ public void notLogReadEvents() throws IOException {\n     verifyNoLog();\n   }\n \n-  private void verifyLog(String expected) throws IOException {\n+  /**\n+   * Test to verify if multiline entries can be checked.\n+   */\n+\n+  @Test\n+  public void messageIncludesMultilineException() throws IOException {\n+    String exceptionMessage = \"Dummy exception message\";\n+    TestException testException = new TestException(exceptionMessage);\n+    AuditMessage exceptionAuditMessage =\n+        new AuditMessage.Builder()\n+            .setUser(USER)\n+            .atIp(IP_ADDRESS)\n+            .forOperation(DummyAction.CREATE_VOLUME)\n+            .withParams(PARAMS)\n+            .withResult(FAILURE)\n+            .withException(testException).build();\n+    AUDIT.logWriteFailure(exceptionAuditMessage);\n+    verifyLog(\n+        \"ERROR | OMAudit | user=john | \"\n+            + \"ip=192.168.0.1 | op=CREATE_VOLUME \"\n+            + \"{key1=value1, key2=value2} | ret=FAILURE\",\n+        \"org.apache.hadoop.ozone.audit.\"\n+            + \"TestOzoneAuditLogger$TestException: Dummy exception message\",\n+        \"at org.apache.hadoop.ozone.audit.TestOzoneAuditLogger\"\n+            + \".messageIncludesMultilineException\"\n+            + \"(TestOzoneAuditLogger.java:160) [test-classes/:?]\");", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "29efbc9e57bf4bbb67dccd930641cfa540dd4691"}, "originalPosition": 51}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "4f32464052a55416140758f138c6e9d9e6e1a98b", "author": {"user": {"login": "llemec", "name": null}}, "url": "https://github.com/apache/ozone/commit/4f32464052a55416140758f138c6e9d9e6e1a98b", "committedDate": "2020-08-11T05:15:14Z", "message": "removed line number from test as suggested in review"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDY0ODExMjk1", "url": "https://github.com/apache/ozone/pull/1308#pullrequestreview-464811295", "createdAt": "2020-08-11T07:24:37Z", "commit": {"oid": "4f32464052a55416140758f138c6e9d9e6e1a98b"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDgxNDcwNTM4", "url": "https://github.com/apache/ozone/pull/1308#pullrequestreview-481470538", "createdAt": "2020-09-03T03:42:40Z", "commit": {"oid": "4f32464052a55416140758f138c6e9d9e6e1a98b"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2704, "cost": 1, "resetAt": "2021-10-28T18:00:02Z"}}}