{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDczOTQwMzk4", "number": 1355, "title": "HDDS-4152. Archive container logs for kubernetes check", "bodyText": "What changes were proposed in this pull request?\nIn the last few days kubernetes check has been failing very frequently.  This change let's it save logs from all containers to make it easier to find any problems.  (docker-compose-based acceptance check also saves container logs.)\nhttps://issues.apache.org/jira/browse/HDDS-4152\nHow was this patch tested?\n$ unzip -t kubernetes.zip\nArchive:  kubernetes.zip\n    testing: getting-started.xml      OK\n    testing: getting-started/         OK\n    testing: log.html                 OK\n    testing: minikube.xml             OK\n    testing: minikube/                OK\n    testing: ozone-dev.xml            OK\n    testing: ozone-dev/               OK\n    testing: ozone.xml                OK\n    testing: ozone/                   OK\n    testing: report.html              OK\n    testing: summary.html             OK\n    testing: getting-started/pod-datanode-0.log   OK\n    testing: getting-started/pod-datanode-1.log   OK\n    testing: getting-started/pod-datanode-2.log   OK\n    testing: getting-started/pod-om-0.log   OK\n    testing: getting-started/pod-s3g-0.log   OK\n    testing: getting-started/pod-scm-0.log   OK\n    testing: minikube/pod-datanode-0.log   OK\n    testing: minikube/pod-datanode-1.log   OK\n    testing: minikube/pod-datanode-2.log   OK\n    testing: minikube/pod-om-0.log    OK\n    testing: minikube/pod-s3g-0.log   OK\n    testing: minikube/pod-scm-0.log   OK\n    testing: ozone-dev/pod-datanode-0.log   OK\n    testing: ozone-dev/pod-datanode-1.log   OK\n    testing: ozone-dev/pod-datanode-2.log   OK\n    testing: ozone-dev/pod-jaeger-0.log   OK\n    testing: ozone-dev/pod-om-0.log   OK\n    testing: ozone-dev/pod-prometheus-584b7948d9-8fcb6.log   OK\n    testing: ozone-dev/pod-s3g-0.log   OK\n    testing: ozone-dev/pod-scm-0.log   OK\n    testing: ozone/pod-datanode-0.log   OK\n    testing: ozone/pod-datanode-1.log   OK\n    testing: ozone/pod-datanode-2.log   OK\n    testing: ozone/pod-om-0.log       OK\n    testing: ozone/pod-s3g-0.log      OK\n    testing: ozone/pod-scm-0.log      OK\n\nhttps://github.com/adoroszlai/hadoop-ozone/runs/1031423764", "createdAt": "2020-08-26T14:18:50Z", "url": "https://github.com/apache/ozone/pull/1355", "merged": true, "mergeCommit": {"oid": "5fab8343c8e798b71b17d918efbddb41e7cc05fb"}, "closed": true, "closedAt": "2020-08-27T08:56:57Z", "author": {"login": "adoroszlai"}, "timelineItems": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdCq7OPgH2gAyNDczOTQwMzk4OjQ1MmY0YzkxMWY4OWI2OTdiYzc3NjQyNTYzZTQwZDIwZDlhYzRjYTk=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdC8ei0gFqTQ3NjUxNjM1MA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "452f4c911f89b697bc77642563e40d20d9ac4ca9", "author": {"user": {"login": "adoroszlai", "name": "Doroszlai, Attila"}}, "url": "https://github.com/apache/ozone/commit/452f4c911f89b697bc77642563e40d20d9ac4ca9", "committedDate": "2020-08-26T12:25:47Z", "message": "HDDS-4152. Archive container logs for kubernetes check"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "5dc6805a5cd152bc8ec5988de42f7cf8581be63e", "author": {"user": {"login": "adoroszlai", "name": "Doroszlai, Attila"}}, "url": "https://github.com/apache/ozone/commit/5dc6805a5cd152bc8ec5988de42f7cf8581be63e", "committedDate": "2020-08-26T15:34:54Z", "message": "trigger new CI check"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDc2NTE0MTI2", "url": "https://github.com/apache/ozone/pull/1355#pullrequestreview-476514126", "createdAt": "2020-08-27T08:49:43Z", "commit": {"oid": "5dc6805a5cd152bc8ec5988de42f7cf8581be63e"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yN1QwODo0OTo0M1rOHIGplg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yN1QwODo0OTo0M1rOHIGplg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3ODI1OTYwNg==", "bodyText": "It's a shame that we have no better solution. We can do kubectl logs -l app=ozone but it will fail when we add setup with more apps (like ozone + spark).\nFTR: locally I use https://github.com/wercker/stern and it works well (but this loop is easier.)", "url": "https://github.com/apache/ozone/pull/1355#discussion_r478259606", "createdAt": "2020-08-27T08:49:43Z", "author": {"login": "elek"}, "path": "hadoop-ozone/dist/src/main/k8s/examples/testlib.sh", "diffHunk": "@@ -77,6 +77,13 @@ start_k8s_env() {\n    wait_for_startup\n }\n \n+get_logs() {\n+  mkdir -p logs\n+  for pod in $(kubectl get pods -o custom-columns=NAME:.metadata.name | tail -n +2); do", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "5dc6805a5cd152bc8ec5988de42f7cf8581be63e"}, "originalPosition": 6}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDc2NTE2MzUw", "url": "https://github.com/apache/ozone/pull/1355#pullrequestreview-476516350", "createdAt": "2020-08-27T08:52:45Z", "commit": {"oid": "5dc6805a5cd152bc8ec5988de42f7cf8581be63e"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2783, "cost": 1, "resetAt": "2021-10-28T18:00:02Z"}}}