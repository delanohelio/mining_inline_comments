{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDQwNjU2NTE4", "number": 1133, "title": "HDDS-3875. Package classpath files to the jar files instead of uploading them as artifacts", "bodyText": "What changes were proposed in this pull request?\nDuring the earlier release we realized that Apache Nexus couldn't handle the classpath files well.\nClasspath files are generated during the build and copied to the final distribution to use separated classpath definition for each of the services.\nIt turned out that the Apache Nexus couldn't handle it well (INFRA-18344) and HDDS-1510 was an attempt to fix this problem. But during 0.5.0 release we have seen the same problem.\nTo make the 0.6.0 release more seamless I propose to update the logic and instead of copy the classpath file via an artifact I would pack/unpack them to/from the final artifact jar.\nWhat is the link to the Apache JIRA\nhttps://issues.apache.org/jira/browse/HDDS-3875\nHow was this patch tested?\nIt's a dist packaging change. CI test is failed which means it works as before:\nhttps://github.com/elek/hadoop-ozone/actions/runs/148630517", "createdAt": "2020-06-26T15:43:48Z", "url": "https://github.com/apache/ozone/pull/1133", "merged": true, "mergeCommit": {"oid": "bfb9a1517210ac737781e3dddaed2f3e5ff738c6"}, "closed": true, "closedAt": "2020-07-02T07:54:37Z", "author": {"login": "elek"}, "timelineItems": {"totalCount": 6, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcvBKcTAH2gAyNDQwNjU2NTE4Ojg0MDY0MDkxY2I2Mjg4NjJjNzM4NWY0NDMwZGFhMDBlYjU5ZmY5ZjA=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcwUGxsgFqTQzOTkyOTQ1Mw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "84064091cb628862c7385f4430daa00eb59ff9f0", "author": {"user": {"login": "elek", "name": "Elek, M\u00e1rton"}}, "url": "https://github.com/apache/ozone/commit/84064091cb628862c7385f4430daa00eb59ff9f0", "committedDate": "2020-06-26T11:01:50Z", "message": "HDDS-3875. Package classpath files to the jar files instead of uploading them as artifacts"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "332773c421d73e503cb727ce801f394af15249c3", "author": {"user": {"login": "elek", "name": "Elek, M\u00e1rton"}}, "url": "https://github.com/apache/ozone/commit/332773c421d73e503cb727ce801f394af15249c3", "committedDate": "2020-06-26T11:55:12Z", "message": "fix recon assembly"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDM5ODUxOTc0", "url": "https://github.com/apache/ozone/pull/1133#pullrequestreview-439851974", "createdAt": "2020-06-30T09:46:46Z", "commit": {"oid": "332773c421d73e503cb727ce801f394af15249c3"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0zMFQwOTo0Njo0NlrOGq0p2Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0zMFQwOTo1MTozNFrOGq01kg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NzU1NjA1Nw==", "bodyText": "Maven outputs a warning for each submodule:\nThe expression ${pom.artifactId} is deprecated. Please use ${project.artifactId} instead.\n\n\n  \n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                          <outputFile>${project.build.outputDirectory}/${pom.artifactId}.classpath</outputFile>\n          \n          \n            \n                          <outputFile>${project.build.outputDirectory}/${project.artifactId}.classpath</outputFile>", "url": "https://github.com/apache/ozone/pull/1133#discussion_r447556057", "createdAt": "2020-06-30T09:46:46Z", "author": {"login": "adoroszlai"}, "path": "hadoop-hdds/pom.xml", "diffHunk": "@@ -279,41 +279,19 @@ https://maven.apache.org/xsd/maven-4.0.0.xsd\">\n         <executions>\n           <execution>\n             <id>add-classpath-descriptor</id>\n-            <phase>package</phase>\n+            <phase>prepare-package</phase>\n             <goals>\n               <goal>build-classpath</goal>\n             </goals>\n             <configuration>\n-              <outputFile>${project.build.directory}/classpath</outputFile>\n+              <outputFile>${project.build.outputDirectory}/${pom.artifactId}.classpath</outputFile>", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "332773c421d73e503cb727ce801f394af15249c3"}, "originalPosition": 11}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NzU1OTA1OA==", "bodyText": "Fix me if I'm wrong, but ozone classpath now lists several modules that were previously omitted.\nPreviously:\n$ ozone classpath\nUsage: ozone classpath <ARTIFACTNAME>\nWhere the artifact name is one of:\n\nhadoop-hdds-server-scm\nhadoop-hdds-tools\nhadoop-ozone-common\nhadoop-ozone-csi\nhadoop-ozone-datanode\nhadoop-ozone-filesystem\nhadoop-ozone-insight\nhadoop-ozone-ozone-manager\nhadoop-ozone-recon\nhadoop-ozone-s3gateway\nhadoop-ozone-tools\nhadoop-ozone-upgrade\n\nWith patch:\n$ ozone classpath\nUsage: ozone classpath <ARTIFACTNAME>\nWhere the artifact name is one of:\n\nhadoop-hdds-client\nhadoop-hdds-common\nhadoop-hdds-config\nhadoop-hdds-container-service\nhadoop-hdds-docs\nhadoop-hdds-hadoop-dependency-client\nhadoop-hdds-hadoop-dependency-server\nhadoop-hdds-interface-admin\nhadoop-hdds-interface-client\nhadoop-hdds-interface-server\nhadoop-hdds-server-framework\nhadoop-hdds-server-scm\nhadoop-hdds-tools\nhadoop-ozone-client\nhadoop-ozone-common\nhadoop-ozone-csi\nhadoop-ozone-datanode\nhadoop-ozone-filesystem-common\nhadoop-ozone-filesystem\nhadoop-ozone-insight\nhadoop-ozone-interface-client\nhadoop-ozone-ozone-manager\nhadoop-ozone-recon\nhadoop-ozone-reconcodegen\nhadoop-ozone-s3gateway\nhadoop-ozone-tools\nhadoop-ozone-upgrade\n\nInvoking ozone classpath for the extra modules results in an error (which is the same on master):\n$ ozone classpath hadoop-hdds-config\nError: Could not find or load main class org.apache.hadoop.util.Classpath\nCaused by: java.lang.ClassNotFoundException: org.apache.hadoop.util.Classpath", "url": "https://github.com/apache/ozone/pull/1133#discussion_r447559058", "createdAt": "2020-06-30T09:51:34Z", "author": {"login": "adoroszlai"}, "path": "hadoop-ozone/dist/pom.xml", "diffHunk": "@@ -41,103 +41,13 @@\n             <id>copy-classpath-files</id>\n             <phase>prepare-package</phase>\n             <goals>\n-              <goal>copy</goal>\n+              <goal>unpack-dependencies</goal>\n             </goals>\n             <configuration>\n               <outputDirectory>\n                 target/ozone-${ozone.version}/share/ozone/classpath\n               </outputDirectory>\n-              <artifactItems>\n-                <artifactItem>\n-                  <groupId>org.apache.hadoop</groupId>\n-                  <artifactId>hadoop-hdds-server-scm</artifactId>\n-                  <version>${hdds.version}</version>\n-                  <classifier>classpath</classifier>\n-                  <type>cp</type>\n-                  <destFileName>hadoop-hdds-server-scm.classpath</destFileName>\n-                </artifactItem>\n-                <artifactItem>\n-                  <groupId>org.apache.hadoop</groupId>\n-                  <artifactId>hadoop-hdds-tools</artifactId>\n-                  <version>${hdds.version}</version>\n-                  <classifier>classpath</classifier>\n-                  <type>cp</type>\n-                  <destFileName>hadoop-hdds-tools.classpath</destFileName>\n-                </artifactItem>\n-                <artifactItem>\n-                  <groupId>org.apache.hadoop</groupId>\n-                  <artifactId>hadoop-ozone-s3gateway</artifactId>\n-                  <version>${ozone.version}</version>\n-                  <classifier>classpath</classifier>\n-                  <type>cp</type>\n-                  <destFileName>hadoop-ozone-s3gateway.classpath</destFileName>\n-                </artifactItem>\n-                <artifactItem>\n-                  <groupId>org.apache.hadoop</groupId>\n-                  <artifactId>hadoop-ozone-csi</artifactId>\n-                  <version>${ozone.version}</version>\n-                  <classifier>classpath</classifier>\n-                  <type>cp</type>\n-                  <destFileName>hadoop-ozone-csi.classpath</destFileName>\n-                </artifactItem>\n-                <artifactItem>\n-                  <groupId>org.apache.hadoop</groupId>\n-                  <artifactId>hadoop-ozone-ozone-manager</artifactId>\n-                  <version>${ozone.version}</version>\n-                  <classifier>classpath</classifier>\n-                  <type>cp</type>\n-                  <destFileName>hadoop-ozone-ozone-manager.classpath\n-                  </destFileName>\n-                </artifactItem>\n-                <artifactItem>\n-                  <groupId>org.apache.hadoop</groupId>\n-                  <artifactId>hadoop-ozone-tools</artifactId>\n-                  <version>${ozone.version}</version>\n-                  <classifier>classpath</classifier>\n-                  <type>cp</type>\n-                  <destFileName>hadoop-ozone-tools.classpath</destFileName>\n-                </artifactItem>\n-                <artifactItem>\n-                  <groupId>org.apache.hadoop</groupId>\n-                  <artifactId>hadoop-ozone-filesystem</artifactId>\n-                  <version>${ozone.version}</version>\n-                  <classifier>classpath</classifier>\n-                  <type>cp</type>\n-                  <destFileName>hadoop-ozone-filesystem.classpath</destFileName>\n-                </artifactItem>\n-                <artifactItem>\n-                  <groupId>org.apache.hadoop</groupId>\n-                  <artifactId>hadoop-ozone-common</artifactId>\n-                  <version>${ozone.version}</version>\n-                  <classifier>classpath</classifier>\n-                  <type>cp</type>\n-                  <destFileName>hadoop-ozone-common.classpath</destFileName>\n-                </artifactItem>\n-                <artifactItem>\n-                  <groupId>org.apache.hadoop</groupId>\n-                  <artifactId>hadoop-ozone-datanode</artifactId>\n-                  <version>${ozone.version}</version>\n-                  <classifier>classpath</classifier>\n-                  <type>cp</type>\n-                  <destFileName>hadoop-ozone-datanode.classpath</destFileName>\n-                </artifactItem>\n-                <artifactItem>\n-                  <groupId>org.apache.hadoop</groupId>\n-                  <artifactId>hadoop-ozone-upgrade</artifactId>\n-                  <version>${ozone.version}</version>\n-                  <classifier>classpath</classifier>\n-                  <type>cp</type>\n-                  <destFileName>hadoop-ozone-upgrade.classpath</destFileName>\n-                </artifactItem>\n-                <artifactItem>\n-                  <groupId>org.apache.hadoop</groupId>\n-                  <artifactId>hadoop-ozone-insight</artifactId>\n-                  <version>${ozone.version}</version>\n-                  <classifier>classpath</classifier>\n-                  <type>cp</type>\n-                  <destFileName>hadoop-ozone-insight.classpath</destFileName>\n-                </artifactItem>\n-              </artifactItems>\n+              <includes>*.classpath</includes>", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "332773c421d73e503cb727ce801f394af15249c3"}, "originalPosition": 102}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "3f74d8b598150b7ff4faaa0afcdaf72177bd1d64", "author": {"user": {"login": "elek", "name": "Elek, M\u00e1rton"}}, "url": "https://github.com/apache/ozone/commit/3f74d8b598150b7ff4faaa0afcdaf72177bd1d64", "committedDate": "2020-06-30T10:34:00Z", "message": "Use project.artifactId instead of pom.artifactId\n\nCo-authored-by: Doroszlai, Attila <6454655+adoroszlai@users.noreply.github.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "2be9bf38b2dd958e643dd37f6bec47ad6dce3cf6", "author": {"user": {"login": "elek", "name": "Elek, M\u00e1rton"}}, "url": "https://github.com/apache/ozone/commit/2be9bf38b2dd958e643dd37f6bec47ad6dce3cf6", "committedDate": "2020-06-30T11:04:28Z", "message": "extract classpath files only from the selected list of artifacts"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDM5OTI5NDUz", "url": "https://github.com/apache/ozone/pull/1133#pullrequestreview-439929453", "createdAt": "2020-06-30T11:39:57Z", "commit": {"oid": "2be9bf38b2dd958e643dd37f6bec47ad6dce3cf6"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3030, "cost": 1, "resetAt": "2021-10-28T18:00:02Z"}}}