{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTEyOTg0MTMz", "number": 1535, "title": "HDDS-4346.Ozone specific Trash Policy", "bodyText": "What changes were proposed in this pull request?\nThis defines an ozone specific TrashPolicy implementation. This current patch is almost a copy of TrashPolicyDefault but will be modified in further jira's to support a multithreaded Trash emptier.\nWhat is the link to the Apache JIRA\nhttps://issues.apache.org/jira/browse/HDDS-4346\nHow was this patch tested?\nUnit Test", "createdAt": "2020-10-30T13:12:00Z", "url": "https://github.com/apache/ozone/pull/1535", "merged": true, "mergeCommit": {"oid": "0aca5c7058252a60db91ac06a5ded931e1e08296"}, "closed": true, "closedAt": "2020-11-18T11:21:46Z", "author": {"login": "sadanand48"}, "timelineItems": {"totalCount": 15, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdY6PyEgFqTUyMjU2NTYwNA==", "endCursor": "Y3Vyc29yOnYyOpPPAAABddpekQAH2gAyNTEyOTg0MTMzOjU2MGI2NDQ4Nzk3M2U0NTBhNTVjMGI3ZjVhMmUyZWZlZGM5YTU1ODg=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTIyNTY1NjA0", "url": "https://github.com/apache/ozone/pull/1535#pullrequestreview-522565604", "createdAt": "2020-11-03T14:43:09Z", "commit": {"oid": "3710a044c295edd6b0396eece8235e923eb229ef"}, "state": "COMMENTED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTMwMTg2NzY2", "url": "https://github.com/apache/ozone/pull/1535#pullrequestreview-530186766", "createdAt": "2020-11-13T16:02:12Z", "commit": {"oid": "68c49b8ddf550585aa0d131030829d9ff5f36107"}, "state": "COMMENTED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e52ba2155a86b1df02ab54448b7a71d64ef0a19f", "author": {"user": {"login": "sadanand48", "name": "Sadanand Shenoy"}}, "url": "https://github.com/apache/ozone/commit/e52ba2155a86b1df02ab54448b7a71d64ef0a19f", "committedDate": "2020-11-13T16:19:58Z", "message": "HDDS-4346.Ozone specific Trash Policy"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "fbad42e5de5504a687081e61ab2b7cf0cfbe6b39", "author": {"user": {"login": "sadanand48", "name": "Sadanand Shenoy"}}, "url": "https://github.com/apache/ozone/commit/fbad42e5de5504a687081e61ab2b7cf0cfbe6b39", "committedDate": "2020-11-13T16:19:58Z", "message": "fix failing test"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "89bea7623f5ad95dc139a31d2229ea7ca99c3bef", "author": {"user": {"login": "sadanand48", "name": "Sadanand Shenoy"}}, "url": "https://github.com/apache/ozone/commit/89bea7623f5ad95dc139a31d2229ea7ca99c3bef", "committedDate": "2020-11-13T16:19:58Z", "message": "Addressed review comment"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b27a06322e820a8767cb04ff098a0c2e3a28eead", "author": {"user": {"login": "sadanand48", "name": "Sadanand Shenoy"}}, "url": "https://github.com/apache/ozone/commit/b27a06322e820a8767cb04ff098a0c2e3a28eead", "committedDate": "2020-11-13T16:19:58Z", "message": "remove initialise method as it uses the parent implementation"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a39e1a6667388a1d0650c46159fb1bcfaf907c63", "author": {"user": {"login": "sadanand48", "name": "Sadanand Shenoy"}}, "url": "https://github.com/apache/ozone/commit/a39e1a6667388a1d0650c46159fb1bcfaf907c63", "committedDate": "2020-11-13T16:31:23Z", "message": "call ozone trash emptier from OM"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "68c49b8ddf550585aa0d131030829d9ff5f36107", "author": {"user": {"login": "sadanand48", "name": "Sadanand Shenoy"}}, "url": "https://github.com/apache/ozone/commit/68c49b8ddf550585aa0d131030829d9ff5f36107", "committedDate": "2020-11-11T11:04:11Z", "message": "remove initialise method as it uses the parent implementation"}, "afterCommit": {"oid": "a39e1a6667388a1d0650c46159fb1bcfaf907c63", "author": {"user": {"login": "sadanand48", "name": "Sadanand Shenoy"}}, "url": "https://github.com/apache/ozone/commit/a39e1a6667388a1d0650c46159fb1bcfaf907c63", "committedDate": "2020-11-13T16:31:23Z", "message": "call ozone trash emptier from OM"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d7c30ee900bd0b0a7ed78effd4f494d4a607f8bc", "author": {"user": {"login": "sadanand48", "name": "Sadanand Shenoy"}}, "url": "https://github.com/apache/ozone/commit/d7c30ee900bd0b0a7ed78effd4f494d4a607f8bc", "committedDate": "2020-11-16T10:57:11Z", "message": "trigger new CI check"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTMyNTEzNjA1", "url": "https://github.com/apache/ozone/pull/1535#pullrequestreview-532513605", "createdAt": "2020-11-17T15:50:36Z", "commit": {"oid": "d7c30ee900bd0b0a7ed78effd4f494d4a607f8bc"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xN1QxNTo1MDozNlrOH079fQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xN1QxNTo1MzozNlrOH08GlQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNTI3MDM5Nw==", "bodyText": "This should be\ntrash.getConf().getClass(\n\"fs.trash.classname\", TrashPolicyOzone.class, TrashPolicy.class) ?", "url": "https://github.com/apache/ozone/pull/1535#discussion_r525270397", "createdAt": "2020-11-17T15:50:36Z", "author": {"login": "mukul1987"}, "path": "hadoop-ozone/integration-test/src/test/java/org/apache/hadoop/fs/ozone/TestRootedOzoneFileSystem.java", "diffHunk": "@@ -1184,6 +1189,10 @@ public void testTrash() throws Exception {\n     try (FSDataOutputStream stream = fs.create(path)) {\n       stream.write(1);\n     }\n+    Assert.assertTrue(trash.getConf().getClass(\n+        \"fs.trash.classname\", TrashPolicyDefault.class).", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d7c30ee900bd0b0a7ed78effd4f494d4a607f8bc"}, "originalPosition": 31}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNTI3MTM3Ng==", "bodyText": "Referring to the following lines of code\nhttps://github.com/apache/hadoop/blob/6f5a36c13c4d2eb24e207aa99a9781c0be11660b/hadoop-common-project/hadoop-common/src/test/java/org/apache/hadoop/fs/TestTrash.java#L643-L642", "url": "https://github.com/apache/ozone/pull/1535#discussion_r525271376", "createdAt": "2020-11-17T15:51:50Z", "author": {"login": "mukul1987"}, "path": "hadoop-ozone/integration-test/src/test/java/org/apache/hadoop/fs/ozone/TestRootedOzoneFileSystem.java", "diffHunk": "@@ -1184,6 +1189,10 @@ public void testTrash() throws Exception {\n     try (FSDataOutputStream stream = fs.create(path)) {\n       stream.write(1);\n     }\n+    Assert.assertTrue(trash.getConf().getClass(\n+        \"fs.trash.classname\", TrashPolicyDefault.class).", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNTI3MDM5Nw=="}, "originalCommit": {"oid": "d7c30ee900bd0b0a7ed78effd4f494d4a607f8bc"}, "originalPosition": 31}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNTI3MTkxNQ==", "bodyText": "The first word should start from the next line.", "url": "https://github.com/apache/ozone/pull/1535#discussion_r525271915", "createdAt": "2020-11-17T15:52:30Z", "author": {"login": "mukul1987"}, "path": "hadoop-ozone/ozone-manager/src/main/java/org/apache/hadoop/ozone/om/TrashPolicyOzone.java", "diffHunk": "@@ -0,0 +1,234 @@\n+/*\n+ * Licensed to the Apache Software Foundation (ASF) under one\n+ * or more contributor license agreements.  See the NOTICE file\n+ * distributed with this work for additional information\n+ * regarding copyright ownership.  The ASF licenses this file\n+ * to you under the Apache License, Version 2.0 (the\n+ * \"License\"); you may not use this file except in compliance\n+ * with the License.  You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+package org.apache.hadoop.ozone.om;\n+\n+import java.io.FileNotFoundException;\n+import java.io.IOException;\n+import java.text.DateFormat;\n+import java.text.ParseException;\n+import java.text.SimpleDateFormat;\n+import java.util.Collection;\n+import java.util.Date;\n+\n+import org.apache.hadoop.conf.Configuration;\n+import org.apache.hadoop.fs.FileStatus;\n+import org.apache.hadoop.fs.FileSystem;\n+import org.apache.hadoop.fs.Path;\n+import org.apache.hadoop.fs.TrashPolicyDefault;\n+import org.apache.hadoop.fs.permission.FsAction;\n+import org.apache.hadoop.fs.permission.FsPermission;\n+import org.apache.hadoop.fs.FileAlreadyExistsException;\n+import org.apache.hadoop.util.Time;\n+import org.slf4j.Logger;\n+import org.slf4j.LoggerFactory;\n+\n+/** TrashPolicy for Ozone Specific Trash Operations.Through this implementation", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d7c30ee900bd0b0a7ed78effd4f494d4a607f8bc"}, "originalPosition": 40}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNTI3MjcyNQ==", "bodyText": "Is this import needed ?", "url": "https://github.com/apache/ozone/pull/1535#discussion_r525272725", "createdAt": "2020-11-17T15:53:36Z", "author": {"login": "mukul1987"}, "path": "hadoop-ozone/integration-test/src/test/java/org/apache/hadoop/fs/ozone/TestRootedOzoneFileSystem.java", "diffHunk": "@@ -27,6 +27,8 @@\n import org.apache.hadoop.fs.Path;\n import org.apache.hadoop.fs.PathIsNotEmptyDirectoryException;\n import org.apache.hadoop.fs.Trash;\n+import org.apache.hadoop.fs.TrashPolicy;\n+import org.apache.hadoop.fs.TrashPolicyDefault;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d7c30ee900bd0b0a7ed78effd4f494d4a607f8bc"}, "originalPosition": 5}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTMyOTg4Mzg3", "url": "https://github.com/apache/ozone/pull/1535#pullrequestreview-532988387", "createdAt": "2020-11-18T02:07:04Z", "commit": {"oid": "d7c30ee900bd0b0a7ed78effd4f494d4a607f8bc"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "080eed0407ccea949e1e683bcc0c4cbf1b733d4d", "author": {"user": {"login": "sadanand48", "name": "Sadanand Shenoy"}}, "url": "https://github.com/apache/ozone/commit/080eed0407ccea949e1e683bcc0c4cbf1b733d4d", "committedDate": "2020-11-18T05:00:05Z", "message": "addressed review comments"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTMzMTA5MDAy", "url": "https://github.com/apache/ozone/pull/1535#pullrequestreview-533109002", "createdAt": "2020-11-18T05:12:25Z", "commit": {"oid": "080eed0407ccea949e1e683bcc0c4cbf1b733d4d"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b2297c20cfef9a094bb82ec17f006ad3204bedbf", "author": {"user": {"login": "sadanand48", "name": "Sadanand Shenoy"}}, "url": "https://github.com/apache/ozone/commit/b2297c20cfef9a094bb82ec17f006ad3204bedbf", "committedDate": "2020-11-18T06:40:49Z", "message": "trigger new CI check"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "560b64487973e450a55c0b7f5a2e2efedc9a5588", "author": {"user": {"login": "sadanand48", "name": "Sadanand Shenoy"}}, "url": "https://github.com/apache/ozone/commit/560b64487973e450a55c0b7f5a2e2efedc9a5588", "committedDate": "2020-11-18T08:00:32Z", "message": "trigger new CI check"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2196, "cost": 1, "resetAt": "2021-10-28T18:00:02Z"}}}