{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTQ1MjI4MTIz", "number": 1734, "title": "HDDS-4621. Set, add and remove ACL have no audit logs", "bodyText": "https://issues.apache.org/jira/browse/HDDS-4621", "createdAt": "2020-12-24T09:19:17Z", "url": "https://github.com/apache/ozone/pull/1734", "merged": true, "mergeCommit": {"oid": "a7e24fd62abdb030658d627b5a7c24e096fa040a"}, "closed": true, "closedAt": "2021-01-13T13:04:07Z", "author": {"login": "ChenSammi"}, "timelineItems": {"totalCount": 7, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdpQJPJAH2gAyNTQ1MjI4MTIzOjBhNmE5ODRkNWU5MmRhZDA4OTkzZGNkMWZkNGExOWNhNDk4ZmQ1ZDM=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdtt155AH2gAyNTQ1MjI4MTIzOmI0OGM5NDJlNTAxYTc1NzZkMTk1MjdhYzAxMTYxOWQwMzA3OGEzMjY=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "0a6a984d5e92dad08993dcd1fd4a19ca498fd5d3", "author": {"user": {"login": "ChenSammi", "name": "Sammi Chen"}}, "url": "https://github.com/apache/ozone/commit/0a6a984d5e92dad08993dcd1fd4a19ca498fd5d3", "committedDate": "2020-12-24T09:16:42Z", "message": "HDDS-4621. Set, add and remove ACL have no audit logs"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTYwNTcxMjU1", "url": "https://github.com/apache/ozone/pull/1734#pullrequestreview-560571255", "createdAt": "2021-01-01T05:29:30Z", "commit": {"oid": "0a6a984d5e92dad08993dcd1fd4a19ca498fd5d3"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTYxNDM5Nzc2", "url": "https://github.com/apache/ozone/pull/1734#pullrequestreview-561439776", "createdAt": "2021-01-05T00:26:58Z", "commit": {"oid": "0a6a984d5e92dad08993dcd1fd4a19ca498fd5d3"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMS0wNVQwMDoyNjo1OFrOIOF6sg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMS0wNVQwMDoyNjo1OFrOIOF6sg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1MTY0NzkyMg==", "bodyText": "NIT: this can be put into the constructor with a member variable so that the protobuf conversion is done only once and the getter() simply return the member variable. Same apply to other places.", "url": "https://github.com/apache/ozone/pull/1734#discussion_r551647922", "createdAt": "2021-01-05T00:26:58Z", "author": {"login": "xiaoyuyao"}, "path": "hadoop-ozone/ozone-manager/src/main/java/org/apache/hadoop/ozone/om/request/volume/acl/OMVolumeSetAclRequest.java", "diffHunk": "@@ -88,6 +92,12 @@ public String getVolumeName() {\n     return volumeName;\n   }\n \n+  @Override\n+  OzoneObjInfo getObjectInfo() {\n+    return OzoneObjInfo.fromProtobuf(\n+        getOmRequest().getSetAclRequest().getObj());", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "0a6a984d5e92dad08993dcd1fd4a19ca498fd5d3"}, "originalPosition": 32}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTYxNDM5OTUw", "url": "https://github.com/apache/ozone/pull/1734#pullrequestreview-561439950", "createdAt": "2021-01-05T00:27:31Z", "commit": {"oid": "0a6a984d5e92dad08993dcd1fd4a19ca498fd5d3"}, "state": "COMMENTED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTYxNjAzNjEy", "url": "https://github.com/apache/ozone/pull/1734#pullrequestreview-561603612", "createdAt": "2021-01-05T08:43:41Z", "commit": {"oid": "0a6a984d5e92dad08993dcd1fd4a19ca498fd5d3"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMS0wNVQwODo0Mzo0MVrOIOOj9Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMS0wNVQwODo0Mzo0MVrOIOOj9Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1MTc4OTU1Nw==", "bodyText": "buildAuditMessage determines success/failure based on whether exception is null.  But here we can also have failure without exception, indicated by operationResult = false.  I think audit log should indicate failure in this case.\n\n  \n    \n      ozone/hadoop-ozone/ozone-manager/src/main/java/org/apache/hadoop/ozone/om/request/bucket/acl/OMBucketAddAclRequest.java\n    \n    \n        Lines 124 to 126\n      in\n      c3f6b4b\n    \n    \n    \n    \n\n        \n          \n           if (exception == null) { \n        \n\n        \n          \n             LOG.error(\"Add acl {} to path {} failed, because acl already exist\", \n        \n\n        \n          \n                 getAcls(), getPath());", "url": "https://github.com/apache/ozone/pull/1734#discussion_r551789557", "createdAt": "2021-01-05T08:43:41Z", "author": {"login": "adoroszlai"}, "path": "hadoop-ozone/ozone-manager/src/main/java/org/apache/hadoop/ozone/om/request/bucket/acl/OMBucketAddAclRequest.java", "diffHunk": "@@ -116,7 +126,11 @@ OMClientResponse onFailure(OMResponse.Builder omResponse,\n \n   @Override\n   void onComplete(boolean operationResult, IOException exception,\n-      OMMetrics omMetrics) {\n+      OMMetrics omMetrics, AuditLogger auditLogger,\n+      Map<String, String> auditMap) {\n+    auditLog(auditLogger, buildAuditMessage(OMAction.ADD_ACL, auditMap,\n+        exception, getOmRequest().getUserInfo()));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "0a6a984d5e92dad08993dcd1fd4a19ca498fd5d3"}, "originalPosition": 38}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "2312d0a0183ed381efc0a54c8a8385f69fbdf9ac", "author": {"user": {"login": "ChenSammi", "name": "Sammi Chen"}}, "url": "https://github.com/apache/ozone/commit/2312d0a0183ed381efc0a54c8a8385f69fbdf9ac", "committedDate": "2021-01-07T03:54:35Z", "message": "address comments"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b48c942e501a7576d19527ac011619d03078a326", "author": {"user": {"login": "ChenSammi", "name": "Sammi Chen"}}, "url": "https://github.com/apache/ozone/commit/b48c942e501a7576d19527ac011619d03078a326", "committedDate": "2021-01-07T06:08:26Z", "message": "remove unused imports"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1904, "cost": 1, "resetAt": "2021-10-28T18:00:02Z"}}}