{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDgwNTYzNjk0", "number": 1401, "title": "HDDS-3927. Rename Ozone OM,DN,SCM runtime options to conform to naming conventions", "bodyText": "What changes were proposed in this pull request?\nRename the environment variables to be in accordance with the convention, and keep the compatibility by deprecating the old variable names.\n\nHDFS_OM_OPTS -> OZONE_OM_OPTS\nHDDS_DN_OPTS -> OZONE_DATANODE_OPTS\nHDFS_STORAGECONTAINERMANAGER_OPTS -> OZONE_SCM_OPTS\n\nWhat is the link to the Apache JIRA\nhttps://issues.apache.org/jira/browse/HDDS-3927\nHow was this patch tested?\nNo new tests added. Tested manually:\n\nHADOOP_SHELL_SCRIPT_DEBUG=1 OZONE_OM_OPTS=-Dtest123 ./ozone om\n\nDEBUG: Appending OZONE_OM_OPTS onto HADOOP_OPTS\n...\nDEBUG: Final HADOOP_OPTS: -Djava.net.preferIPv4Stack=true -XX:ParallelGCThreads=8 -XX:+UseConcMarkSweepGC -XX:CMSInitiatingOccupancyFraction=70 -XX:+CMSParallelRemarkEnabled -Dtest123 -Dlog4j.configurationFile=/Users/smeng/repo/ozone/hadoop-ozone/dist/target/ozone-1.1.0-SNAPSHOT/etc/hadoop/om-audit-log4j2.properties -Dhadoop.log.dir=/Users/smeng/repo/ozone/hadoop-ozone/dist/target/ozone-1.1.0-SNAPSHOT/logs -Dhadoop.log.file=hadoop.log -Dhadoop.home.dir=/Users/smeng/repo/ozone/hadoop-ozone/dist/target/ozone-1.1.0-SNAPSHOT -Dhadoop.id.str=smeng -Dhadoop.root.logger=INFO,console -Dhadoop.policy.file=hadoop-policy.xml -Dhadoop.security.logger=INFO,NullAppender\n\n\nHADOOP_SHELL_SCRIPT_DEBUG=1 OZONE_DATANODE_OPTS=-Dtest123 ./ozone datanode\n\nDEBUG: Appending OZONE_DATANODE_OPTS onto HADOOP_OPTS\n...\nDEBUG: Final HADOOP_OPTS: -Djava.net.preferIPv4Stack=true -XX:ParallelGCThreads=8 -XX:+UseConcMarkSweepGC -XX:CMSInitiatingOccupancyFraction=70 -XX:+CMSParallelRemarkEnabled -Dorg.apache.ratis.thirdparty.io.netty.allocator.useCacheForAllThreads=false -Dorg.apache.ratis.thirdparty.io.netty.leakDetection.level=disabled -Dlog4j.configurationFile=/Users/smeng/repo/ozone/hadoop-ozone/dist/target/ozone-1.1.0-SNAPSHOT/etc/hadoop/dn-audit-log4j2.properties -Dtest123 -Dhadoop.log.dir=/Users/smeng/repo/ozone/hadoop-ozone/dist/target/ozone-1.1.0-SNAPSHOT/logs -Dhadoop.log.file=hadoop.log -Dhadoop.home.dir=/Users/smeng/repo/ozone/hadoop-ozone/dist/target/ozone-1.1.0-SNAPSHOT -Dhadoop.id.str=smeng -Dhadoop.root.logger=INFO,console -Dhadoop.policy.file=hadoop-policy.xml -Dhadoop.security.logger=INFO,NullAppender\n\n\nHADOOP_SHELL_SCRIPT_DEBUG=1 OZONE_SCM_OPTS=-Dtest123 ./ozone scm\n\nDEBUG: Appending OZONE_SCM_OPTS onto HADOOP_OPTS\n...\nDEBUG: Final HADOOP_OPTS: -Djava.net.preferIPv4Stack=true -XX:ParallelGCThreads=8 -XX:+UseConcMarkSweepGC -XX:CMSInitiatingOccupancyFraction=70 -XX:+CMSParallelRemarkEnabled -Dtest123 -Dlog4j.configurationFile=/Users/smeng/repo/ozone/hadoop-ozone/dist/target/ozone-1.1.0-SNAPSHOT/etc/hadoop/scm-audit-log4j2.properties -Dhadoop.log.dir=/Users/smeng/repo/ozone/hadoop-ozone/dist/target/ozone-1.1.0-SNAPSHOT/logs -Dhadoop.log.file=hadoop.log -Dhadoop.home.dir=/Users/smeng/repo/ozone/hadoop-ozone/dist/target/ozone-1.1.0-SNAPSHOT -Dhadoop.id.str=smeng -Dhadoop.root.logger=INFO,console -Dhadoop.policy.file=hadoop-policy.xml -Dhadoop.security.logger=INFO,NullAppender\n\n\nDeprecation warning: HADOOP_SHELL_SCRIPT_DEBUG=1 HDFS_OM_OPTS=-Dtest123 ./ozone om\n\nWARNING: HDFS_OM_OPTS has been replaced by OZONE_OM_OPTS. Using value of HDFS_OM_OPTS.\n\nCaveat: when both deprecated and new variables names are present, the new variable will be ignored. So admins should refrain from using both at the same time. e.g. for HDFS_OM_OPTS=-Dtest123 OZONE_OM_OPTS=-Dtest456 ./ozone om, OZONE_OM_OPTS=-Dtest456 will be completely ignored, only HDFS_OM_OPTS=-Dtest123 will be respected.\nNote\nhadoop_deprecate_envvar takes care of the copying the values from the old variable name to the new one, and prints the deprecation warning.", "createdAt": "2020-09-05T18:33:15Z", "url": "https://github.com/apache/ozone/pull/1401", "merged": true, "mergeCommit": {"oid": "48e8e5047bc5a0075904e9142666b67a32b0da91"}, "closed": true, "closedAt": "2020-09-13T20:09:51Z", "author": {"login": "smengcl"}, "timelineItems": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdF-Ju0AH2gAyNDgwNTYzNjk0OjhlNWJmYzI0ZTZlM2FiZmM5ZjdkN2IzYjE4OTk4ZjAxNGI5YjBmZGQ=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdIkWJSAFqTQ4NzMzNjE4OA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "8e5bfc24e6e3abfc9f7d7b3b18998f014b9b0fdd", "author": {"user": {"login": "smengcl", "name": "Siyao Meng"}}, "url": "https://github.com/apache/ozone/commit/8e5bfc24e6e3abfc9f7d7b3b18998f014b9b0fdd", "committedDate": "2020-09-05T18:31:36Z", "message": "HDDS-3927. Rename HDFS_OM_OPTS/HDDS_DN_OPTS to OZONE_MANAGER_OPTS/OZONE_DATANODE_OPTS\n\nChange-Id: I629f87486b62b6a3b7f108addf89ce1ec2bc9e18"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDgzNTExMDQz", "url": "https://github.com/apache/ozone/pull/1401#pullrequestreview-483511043", "createdAt": "2020-09-07T12:18:04Z", "commit": {"oid": "8e5bfc24e6e3abfc9f7d7b3b18998f014b9b0fdd"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wN1QxMjoxODowNVrOHN9Nkw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wN1QxMjoxOTowMFrOHN9Pbw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NDM5NjQzNQ==", "bodyText": "I think OZONE_OM_OPTS is aligned with the naming conventions. Especially as it's already working thanks to the\nhadoop_subcommand_opts \"${HADOOP_SHELL_EXECNAME}\" \"${HADOOP_SUBCMD}\"\n\nline.", "url": "https://github.com/apache/ozone/pull/1401#discussion_r484396435", "createdAt": "2020-09-07T12:18:05Z", "author": {"login": "elek"}, "path": "hadoop-hdds/common/src/main/conf/hadoop-env.sh", "diffHunk": "@@ -400,7 +400,16 @@ export HADOOP_OS_TYPE=${HADOOP_OS_TYPE:-$(uname -s)}\n # These options will be appended to the options specified as HADOOP_OPTS\n # and therefore may override any similar flags set in HADOOP_OPTS\n #\n-# export HDFS_OM_OPTS=\"\"\n+# export OZONE_MANAGER_OPTS=\"\"", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "8e5bfc24e6e3abfc9f7d7b3b18998f014b9b0fdd"}, "originalPosition": 5}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NDM5NjcxNQ==", "bodyText": "I think this line is not necessary, because it will be added by\nhadoop_subcommand_opts \"${HADOOP_SHELL_EXECNAME}\" \"${HADOOP_SUBCMD}\"\n\nBut please check it.", "url": "https://github.com/apache/ozone/pull/1401#discussion_r484396715", "createdAt": "2020-09-07T12:18:39Z", "author": {"login": "elek"}, "path": "hadoop-ozone/dist/src/shell/ozone/ozone", "diffHunk": "@@ -105,8 +105,9 @@ function ozonecmd_case\n       # Corresponding Ratis issue https://issues.apache.org/jira/browse/RATIS-534.\n       # TODO: Fix the problem related to netty resource leak detector throwing\n       # exception as mentioned in HDDS-3812\n-      HDDS_DN_OPTS=\"-Dorg.apache.ratis.thirdparty.io.netty.allocator.useCacheForAllThreads=false -Dorg.apache.ratis.thirdparty.io.netty.leakDetection.level=disabled -Dlog4j.configurationFile=${HADOOP_CONF_DIR}/dn-audit-log4j2.properties ${HDDS_DN_OPTS}\"\n-      HADOOP_OPTS=\"${HADOOP_OPTS} ${HDDS_DN_OPTS}\"\n+      hadoop_deprecate_envvar HDDS_DN_OPTS OZONE_DATANODE_OPTS\n+      OZONE_DATANODE_OPTS=\"-Dorg.apache.ratis.thirdparty.io.netty.allocator.useCacheForAllThreads=false -Dorg.apache.ratis.thirdparty.io.netty.leakDetection.level=disabled -Dlog4j.configurationFile=${HADOOP_CONF_DIR}/dn-audit-log4j2.properties ${OZONE_DATANODE_OPTS}\"\n+      HADOOP_OPTS=\"${HADOOP_OPTS} ${OZONE_DATANODE_OPTS}\"", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "8e5bfc24e6e3abfc9f7d7b3b18998f014b9b0fdd"}, "originalPosition": 8}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NDM5NjkxMQ==", "bodyText": "Same as before.", "url": "https://github.com/apache/ozone/pull/1401#discussion_r484396911", "createdAt": "2020-09-07T12:19:00Z", "author": {"login": "elek"}, "path": "hadoop-ozone/dist/src/shell/ozone/ozone", "diffHunk": "@@ -154,8 +155,9 @@ function ozonecmd_case\n     om)\n       HADOOP_SUBCMD_SUPPORTDAEMONIZATION=\"true\"\n       HADOOP_CLASSNAME=org.apache.hadoop.ozone.om.OzoneManagerStarter\n-      HDFS_OM_OPTS=\"${HDFS_OM_OPTS} -Dlog4j.configurationFile=${HADOOP_CONF_DIR}/om-audit-log4j2.properties\"\n-      HADOOP_OPTS=\"${HADOOP_OPTS} ${HDFS_OM_OPTS}\"\n+      hadoop_deprecate_envvar HDFS_OM_OPTS OZONE_MANAGER_OPTS\n+      OZONE_MANAGER_OPTS=\"${OZONE_MANAGER_OPTS} -Dlog4j.configurationFile=${HADOOP_CONF_DIR}/om-audit-log4j2.properties\"\n+      HADOOP_OPTS=\"${HADOOP_OPTS} ${OZONE_MANAGER_OPTS}\"", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "8e5bfc24e6e3abfc9f7d7b3b18998f014b9b0fdd"}, "originalPosition": 20}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "350b98b5f8c4400e19cd481e8681da101b4e7674", "author": {"user": {"login": "smengcl", "name": "Siyao Meng"}}, "url": "https://github.com/apache/ozone/commit/350b98b5f8c4400e19cd481e8681da101b4e7674", "committedDate": "2020-09-07T23:35:37Z", "message": "Conform to hadoop_subcommand_opts's OPTS naming conventions.\n\nChange-Id: I67259db97eabf04a55b9b5bbc582a6e5732cdb58"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDg3MzM2MTg4", "url": "https://github.com/apache/ozone/pull/1401#pullrequestreview-487336188", "createdAt": "2020-09-13T20:09:24Z", "commit": {"oid": "350b98b5f8c4400e19cd481e8681da101b4e7674"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2472, "cost": 1, "resetAt": "2021-10-28T18:00:02Z"}}}