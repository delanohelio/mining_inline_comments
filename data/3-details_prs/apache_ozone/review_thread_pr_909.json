{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDE1NzMzMzc2", "number": 909, "reviewThreads": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xM1QwMDoyNDozOFrOD73nmg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xM1QwMDoyNDozOFrOD73nmg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjY0MTAzODM0OnYy", "diffSide": "RIGHT", "path": "hadoop-hdds/server-scm/src/test/java/org/apache/hadoop/hdds/scm/node/TestSCMNodeManager.java", "isResolved": false, "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xM1QwMDoyNDozOFrOGUdZkw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yM1QxODo1OToxN1rOGZq34w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNDEwNjM4Nw==", "bodyText": "Shouldn't we find out why the existing NodeReportHandler that is part of the created SCM not getting triggered?", "url": "https://github.com/apache/ozone/pull/909#discussion_r424106387", "createdAt": "2020-05-13T00:24:38Z", "author": {"login": "avijayanhwx"}, "path": "hadoop-hdds/server-scm/src/test/java/org/apache/hadoop/hdds/scm/node/TestSCMNodeManager.java", "diffHunk": "@@ -855,6 +860,10 @@ public void testScmStatsFromNodeReport()\n         String storagePath = testDir.getAbsolutePath() + \"/\" + dnId;\n         StorageReportProto report = TestUtils\n             .createStorageReport(dnId, storagePath, capacity, used, free, null);\n+        NodeReportProto nodeReportProto = TestUtils.createNodeReport(report);\n+        nodeReportHandler.onMessage(", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "5a3fcc80a3acdd7555997c3bb5312b02d8446e90"}, "originalPosition": 55}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNTMwOTMyMQ==", "bodyText": "@cku328 Thanks for the refactoring. I looked at the description of the test, and the what we are trying to validate. The test is meant to validate the logic to process a NodeReport correctly. It is not meant to validate whether a Node report is processed IF a heartbeat is got. Hence, I am OK with either of your patches - Using nodeReportHandler.onMessage or using nodeManager.processNodeReport. Maybe it is better to use the onMessage to keep it consistent with the other test you recently fixed. what do you think?", "url": "https://github.com/apache/ozone/pull/909#discussion_r425309321", "createdAt": "2020-05-14T17:27:13Z", "author": {"login": "avijayanhwx"}, "path": "hadoop-hdds/server-scm/src/test/java/org/apache/hadoop/hdds/scm/node/TestSCMNodeManager.java", "diffHunk": "@@ -855,6 +860,10 @@ public void testScmStatsFromNodeReport()\n         String storagePath = testDir.getAbsolutePath() + \"/\" + dnId;\n         StorageReportProto report = TestUtils\n             .createStorageReport(dnId, storagePath, capacity, used, free, null);\n+        NodeReportProto nodeReportProto = TestUtils.createNodeReport(report);\n+        nodeReportHandler.onMessage(", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNDEwNjM4Nw=="}, "originalCommit": {"oid": "5a3fcc80a3acdd7555997c3bb5312b02d8446e90"}, "originalPosition": 55}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTU3MDAxOQ==", "bodyText": "Thanks @avijayanhwx for the comment, I changed some code so that NodeReport can be sent out with the initial heartbeat. I confirmed the NodeReportHandler in SCM is working properly and it can be triggered to process node reports from multiple nodes.", "url": "https://github.com/apache/ozone/pull/909#discussion_r429570019", "createdAt": "2020-05-23T18:59:17Z", "author": {"login": "cku328"}, "path": "hadoop-hdds/server-scm/src/test/java/org/apache/hadoop/hdds/scm/node/TestSCMNodeManager.java", "diffHunk": "@@ -855,6 +860,10 @@ public void testScmStatsFromNodeReport()\n         String storagePath = testDir.getAbsolutePath() + \"/\" + dnId;\n         StorageReportProto report = TestUtils\n             .createStorageReport(dnId, storagePath, capacity, used, free, null);\n+        NodeReportProto nodeReportProto = TestUtils.createNodeReport(report);\n+        nodeReportHandler.onMessage(", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNDEwNjM4Nw=="}, "originalCommit": {"oid": "5a3fcc80a3acdd7555997c3bb5312b02d8446e90"}, "originalPosition": 55}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4300, "cost": 1, "resetAt": "2021-11-12T11:57:46Z"}}}