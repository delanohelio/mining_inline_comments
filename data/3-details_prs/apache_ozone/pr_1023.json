{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDI3OTU5ODM5", "number": 1023, "title": "HDDS-3718: Improve OmKeyLocationInfoGroup internal data structure", "bodyText": "What changes were proposed in this pull request?\nOmKeyLocationInfoGroup changed to store a Map between versions and list of OmKeyLocationInfos\ninstead of storing all locationInfos in a list, by this change, the performance of getting the list of the latest version improved.\nWhat is the link to the Apache JIRA\nhttps://issues.apache.org/jira/browse/HDDS-3718\nHow was this patch tested?\nozone common module tests", "createdAt": "2020-06-04T16:40:00Z", "url": "https://github.com/apache/ozone/pull/1023", "merged": true, "mergeCommit": {"oid": "40b3f133ea43dcbfb1b5a842a410cdb49e1c2ce2"}, "closed": true, "closedAt": "2020-07-22T15:33:37Z", "author": {"login": "esahekmat"}, "timelineItems": {"totalCount": 7, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcoAxgyAH2gAyNDI3OTU5ODM5OmJlYThhMzMzZjNkNzVkYjQ4ODFkNGUwNjk3YTkzYzdmYmFjZjE1ZGQ=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcxomgbAH2gAyNDI3OTU5ODM5OmM3ZGQxNzhmMDNjOTJiNDIyZTZmOTEyZWRjZDY1NWNkNWMxMDEyOTU=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "bea8a333f3d75db4881d4e0697a93c7fbacf15dd", "author": {"user": {"login": "esahekmat", "name": "Isa Hekmatizadeh"}}, "url": "https://github.com/apache/ozone/commit/bea8a333f3d75db4881d4e0697a93c7fbacf15dd", "committedDate": "2020-06-04T16:37:08Z", "message": "HDDS-3718: imporve OmKeyLocationInfoGroup internal data structure to improve its performance in trivial cases"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "686dcfb858e8432d69b90010b03d7b5410896024", "author": {"user": {"login": "esahekmat", "name": "Isa Hekmatizadeh"}}, "url": "https://github.com/apache/ozone/commit/686dcfb858e8432d69b90010b03d7b5410896024", "committedDate": "2020-06-12T05:47:06Z", "message": "Merge branch 'master' into HDDS-3718-2\n\n# Conflicts:\n#\thadoop-ozone/common/src/main/java/org/apache/hadoop/ozone/om/helpers/OmKeyLocationInfoGroup.java"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDM5ODIyNDU0", "url": "https://github.com/apache/ozone/pull/1023#pullrequestreview-439822454", "createdAt": "2020-06-30T09:10:23Z", "commit": {"oid": "686dcfb858e8432d69b90010b03d7b5410896024"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDQwNDI0NDQx", "url": "https://github.com/apache/ozone/pull/1023#pullrequestreview-440424441", "createdAt": "2020-06-30T22:16:52Z", "commit": {"oid": "686dcfb858e8432d69b90010b03d7b5410896024"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0zMFQyMjoxNjo1MlrOGrQYTA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0zMFQyMjoxNjo1MlrOGrQYTA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0ODAxMDMxNg==", "bodyText": "should we change the order of 47/49 so that there is always an ArrayList for the version and the locations is added to that arraylist.", "url": "https://github.com/apache/ozone/pull/1023#discussion_r448010316", "createdAt": "2020-06-30T22:16:52Z", "author": {"login": "xiaoyuyao"}, "path": "hadoop-ozone/common/src/main/java/org/apache/hadoop/ozone/om/helpers/OmKeyLocationInfoGroup.java", "diffHunk": "@@ -30,12 +30,23 @@\n  */\n public class OmKeyLocationInfoGroup {\n   private final long version;\n-  private final List<OmKeyLocationInfo> locationList;\n+  private final Map<Long, List<OmKeyLocationInfo>> locationVersionList;\n \n   public OmKeyLocationInfoGroup(long version,\n                                 List<OmKeyLocationInfo> locations) {\n     this.version = version;\n-    this.locationList = locations;\n+    this.locationVersionList = locations.stream()\n+        .collect(Collectors.groupingBy(OmKeyLocationInfo::getCreateVersion));\n+    //prevent NPE\n+    this.locationVersionList.putIfAbsent(version, new ArrayList<>());\n+  }\n+\n+  public OmKeyLocationInfoGroup(long version,\n+                                Map<Long, List<OmKeyLocationInfo>> locations) {\n+    this.version = version;\n+    this.locationVersionList = locations;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "686dcfb858e8432d69b90010b03d7b5410896024"}, "originalPosition": 35}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDQwNDI1NzI4", "url": "https://github.com/apache/ozone/pull/1023#pullrequestreview-440425728", "createdAt": "2020-06-30T22:19:42Z", "commit": {"oid": "686dcfb858e8432d69b90010b03d7b5410896024"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0zMFQyMjoxOTo0MlrOGrQcXw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0zMFQyMjoxOTo0MlrOGrQcXw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0ODAxMTM1OQ==", "bodyText": "NIT: should we rename to locationVersionMap to avoid confusion?", "url": "https://github.com/apache/ozone/pull/1023#discussion_r448011359", "createdAt": "2020-06-30T22:19:42Z", "author": {"login": "xiaoyuyao"}, "path": "hadoop-ozone/common/src/main/java/org/apache/hadoop/ozone/om/helpers/OmKeyLocationInfoGroup.java", "diffHunk": "@@ -30,12 +30,23 @@\n  */\n public class OmKeyLocationInfoGroup {\n   private final long version;\n-  private final List<OmKeyLocationInfo> locationList;\n+  private final Map<Long, List<OmKeyLocationInfo>> locationVersionList;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "686dcfb858e8432d69b90010b03d7b5410896024"}, "originalPosition": 20}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDQwNDMwOTA0", "url": "https://github.com/apache/ozone/pull/1023#pullrequestreview-440430904", "createdAt": "2020-06-30T22:32:07Z", "commit": {"oid": "686dcfb858e8432d69b90010b03d7b5410896024"}, "state": "COMMENTED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c7dd178f03c92b422e6f912edcd655cd5c101295", "author": {"user": {"login": "esahekmat", "name": "Isa Hekmatizadeh"}}, "url": "https://github.com/apache/ozone/commit/c7dd178f03c92b422e6f912edcd655cd5c101295", "committedDate": "2020-07-04T14:06:38Z", "message": "HDDS-3718: rename locationVersionList to locationVersionMap"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3143, "cost": 1, "resetAt": "2021-10-28T18:00:02Z"}}}