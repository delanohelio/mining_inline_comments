{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDUxMjcxMDgx", "number": 1214, "title": "HDDS-3981. Add more debug level log to XceiverClientGrpc for debug purpose", "bodyText": "What changes were proposed in this pull request?\nWhen I profile the s3g performance, i find in some log of XceiverClientGrpc, I cannot find the related datanode ip, so i use datanode instead of the UUID and networkFullPath.\nAlso, i add a debug level log to show the request has been executed and output the try counts.\nWhat is the link to the Apache JIRA\nHDDS-3981\nHow was this patch tested?\nNo need, all changes only related to log.", "createdAt": "2020-07-17T16:56:03Z", "url": "https://github.com/apache/ozone/pull/1214", "merged": true, "mergeCommit": {"oid": "68d1ab0c20b622409f8dbeb051476c3cac27c5ae"}, "closed": true, "closedAt": "2020-09-17T22:21:48Z", "author": {"login": "maobaolong"}, "timelineItems": {"totalCount": 14, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABc12s8dAH2gAyNDUxMjcxMDgxOjA3Mjk2MzEyNmViYjY1Mjc3NTBkMGI5NmQ5NzNjZDg5ZTQ4ZDg0OWI=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdI9hcVAH2gAyNDUxMjcxMDgxOjBmMDI3ZDg1NGMyZDk0ZjE0ZGU4YjQ1MDRjNjhmYTIxYTY5MzcyNDA=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "072963126ebb6527750d0b96d973cd89e48d849b", "author": {"user": {"login": "maobaolong", "name": "maobaolong"}}, "url": "https://github.com/apache/ozone/commit/072963126ebb6527750d0b96d973cd89e48d849b", "committedDate": "2020-07-17T16:48:02Z", "message": "HDDS-3981. Add more debug level log to XceiverClientGrpc for debug purpose"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "39a4825267a7618b956e349c93baf2a6e5e94a4a", "author": {"user": {"login": "maobaolong", "name": "maobaolong"}}, "url": "https://github.com/apache/ozone/commit/39a4825267a7618b956e349c93baf2a6e5e94a4a", "committedDate": "2020-07-18T01:26:12Z", "message": "trigger new ci check"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a49773e38c8a02d8dd59e90c54b41f307160887a", "author": {"user": {"login": "maobaolong", "name": "maobaolong"}}, "url": "https://github.com/apache/ozone/commit/a49773e38c8a02d8dd59e90c54b41f307160887a", "committedDate": "2020-07-18T07:53:28Z", "message": "trigger new ci check"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e1d7e9a9b6d078007495797ba01eb7d853c1fc84", "author": {"user": {"login": "maobaolong", "name": "maobaolong"}}, "url": "https://github.com/apache/ozone/commit/e1d7e9a9b6d078007495797ba01eb7d853c1fc84", "committedDate": "2020-07-18T11:46:35Z", "message": "trigger new ci check"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "9e1317686b3eebcdb5eb48b0af5f4b9140be8761", "author": {"user": {"login": "maobaolong", "name": "maobaolong"}}, "url": "https://github.com/apache/ozone/commit/9e1317686b3eebcdb5eb48b0af5f4b9140be8761", "committedDate": "2020-07-22T07:18:47Z", "message": "trigger new ci check"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "6a3d7b3fb72011bb512eccfb4f216f239f3f6001", "author": {"user": {"login": "maobaolong", "name": "maobaolong"}}, "url": "https://github.com/apache/ozone/commit/6a3d7b3fb72011bb512eccfb4f216f239f3f6001", "committedDate": "2020-07-22T13:50:40Z", "message": "trigger new ci check"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDU2OTA3Mjg4", "url": "https://github.com/apache/ozone/pull/1214#pullrequestreview-456907288", "createdAt": "2020-07-28T18:40:22Z", "commit": {"oid": "6a3d7b3fb72011bb512eccfb4f216f239f3f6001"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yOFQxODo0MDoyMlrOG4Zm7w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yOFQxODo0MDoyMlrOG4Zm7w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MTc5MzAwNw==", "bodyText": "Full DatanodeDetails.toString() include a lot of information and can hurt the perf on critical path. Consider using either ip or uuid instead.", "url": "https://github.com/apache/ozone/pull/1214#discussion_r461793007", "createdAt": "2020-07-28T18:40:22Z", "author": {"login": "xiaoyuyao"}, "path": "hadoop-hdds/client/src/main/java/org/apache/hadoop/hdds/scm/XceiverClientGrpc.java", "diffHunk": "@@ -354,7 +363,7 @@ private XceiverClientReply sendCommandWithRetry(\n         responseProto = null;\n       } catch (ExecutionException e) {\n         LOG.debug(\"Failed to execute command {} on datanode {}\",\n-            request, dn.getUuid(), e);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "6a3d7b3fb72011bb512eccfb4f216f239f3f6001"}, "originalPosition": 36}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDU2OTA3NTY0", "url": "https://github.com/apache/ozone/pull/1214#pullrequestreview-456907564", "createdAt": "2020-07-28T18:40:48Z", "commit": {"oid": "6a3d7b3fb72011bb512eccfb4f216f239f3f6001"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yOFQxODo0MDo0OFrOG4Znxw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yOFQxODo0MDo0OFrOG4Znxw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MTc5MzIyMw==", "bodyText": "This needs to be guarded by if (LOG.isDebugEnabled())", "url": "https://github.com/apache/ozone/pull/1214#discussion_r461793223", "createdAt": "2020-07-28T18:40:48Z", "author": {"login": "xiaoyuyao"}, "path": "hadoop-hdds/client/src/main/java/org/apache/hadoop/hdds/scm/XceiverClientGrpc.java", "diffHunk": "@@ -354,7 +363,7 @@ private XceiverClientReply sendCommandWithRetry(\n         responseProto = null;\n       } catch (ExecutionException e) {\n         LOG.debug(\"Failed to execute command {} on datanode {}\",", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "6a3d7b3fb72011bb512eccfb4f216f239f3f6001"}, "originalPosition": 35}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDU2OTA4ODI1", "url": "https://github.com/apache/ozone/pull/1214#pullrequestreview-456908825", "createdAt": "2020-07-28T18:42:42Z", "commit": {"oid": "6a3d7b3fb72011bb512eccfb4f216f239f3f6001"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yOFQxODo0Mjo0MlrOG4Zrow==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yOFQxODo0Mjo0MlrOG4Zrow==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MTc5NDIxMQ==", "bodyText": "In sendCommandAsync() below we already have a LOG.debug(cmdType, Dn). Can you move this there to avoid duplicate debug log?", "url": "https://github.com/apache/ozone/pull/1214#discussion_r461794211", "createdAt": "2020-07-28T18:42:42Z", "author": {"login": "xiaoyuyao"}, "path": "hadoop-hdds/client/src/main/java/org/apache/hadoop/hdds/scm/XceiverClientGrpc.java", "diffHunk": "@@ -339,6 +343,11 @@ private XceiverClientReply sendCommandWithRetry(\n         // in case these don't exist for the specific datanode.\n         reply.addDatanode(dn);\n         responseProto = sendCommandAsync(request, dn).getResponse().get();\n+        if (LOG.isDebugEnabled()) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "6a3d7b3fb72011bb512eccfb4f216f239f3f6001"}, "originalPosition": 24}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDU2OTA5MDA2", "url": "https://github.com/apache/ozone/pull/1214#pullrequestreview-456909006", "createdAt": "2020-07-28T18:42:58Z", "commit": {"oid": "6a3d7b3fb72011bb512eccfb4f216f239f3f6001"}, "state": "COMMENTED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDYwNDQwNjQy", "url": "https://github.com/apache/ozone/pull/1214#pullrequestreview-460440642", "createdAt": "2020-08-04T01:41:11Z", "commit": {"oid": "6a3d7b3fb72011bb512eccfb4f216f239f3f6001"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0wNFQwMTo0MToxMlrOG7OEsw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0wNFQwMTo0MToxMlrOG7OEsw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NDc0OTc0Nw==", "bodyText": "Correct me if I'm wrong, I think we have already print the same debug message on Line 338-340 from the caller. Print just the IP address should be sufficient.", "url": "https://github.com/apache/ozone/pull/1214#discussion_r464749747", "createdAt": "2020-08-04T01:41:12Z", "author": {"login": "xiaoyuyao"}, "path": "hadoop-hdds/client/src/main/java/org/apache/hadoop/hdds/scm/XceiverClientGrpc.java", "diffHunk": "@@ -433,7 +442,7 @@ public XceiverClientReply sendCommandAsync(\n     UUID dnId = dn.getUuid();\n     if (LOG.isDebugEnabled()) {\n       LOG.debug(\"Send command {} to datanode {}\",\n-          request.getCmdType(), dn.getNetworkFullPath());\n+          request.getCmdType(), dn);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "6a3d7b3fb72011bb512eccfb4f216f239f3f6001"}, "originalPosition": 46}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "6a7a413f2d42e7ddda9e3695175c76145ed9d211", "author": {"user": {"login": "maobaolong", "name": "maobaolong"}}, "url": "https://github.com/apache/ozone/commit/6a7a413f2d42e7ddda9e3695175c76145ed9d211", "committedDate": "2020-08-10T02:14:39Z", "message": "Address comments, log the ip address o dn only."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDg2MzM0NjM0", "url": "https://github.com/apache/ozone/pull/1214#pullrequestreview-486334634", "createdAt": "2020-09-10T21:49:16Z", "commit": {"oid": "6a7a413f2d42e7ddda9e3695175c76145ed9d211"}, "state": "COMMENTED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "0f027d854c2d94f14de8b4504c68fa21a6937240", "author": {"user": {"login": "maobaolong", "name": "maobaolong"}}, "url": "https://github.com/apache/ozone/commit/0f027d854c2d94f14de8b4504c68fa21a6937240", "committedDate": "2020-09-15T01:29:22Z", "message": "Address comment, move the debug log into sendCommandAsync"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2870, "cost": 1, "resetAt": "2021-10-28T18:00:02Z"}}}