{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDczODY2OTQ5", "number": 1354, "title": "HDDS-4151. Skip the inputstream while offset larger than zero in s3g", "bodyText": "What changes were proposed in this pull request?\nSkip the inputstream while offset larger than zero in s3g.\nWhat is the link to the Apache JIRA\nHDDS-4151\nHow was this patch tested?\nDownload a big file like 10GB, and get the cost time, compare it than without this PR, this PR can get good performance back.", "createdAt": "2020-08-26T12:18:10Z", "url": "https://github.com/apache/ozone/pull/1354", "merged": true, "mergeCommit": {"oid": "8e98977bd1d88f74e9e74e9d74d28bcb4a0d60c2"}, "closed": true, "closedAt": "2020-08-28T19:31:10Z", "author": {"login": "maobaolong"}, "timelineItems": {"totalCount": 7, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdCsBiPgH2gAyNDczODY2OTQ5OmQxYTcyOTc4NWFmZWYxMjdhNjA1ZTY3MTk1ZmMwOWU2MjJiM2I4ZTU=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdDaNOTgFqTQ3Nzk3NzE5NA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "d1a729785afef127a605e67195fc09e622b3b8e5", "author": {"user": {"login": "maobaolong", "name": "maobaolong"}}, "url": "https://github.com/apache/ozone/commit/d1a729785afef127a605e67195fc09e622b3b8e5", "committedDate": "2020-08-26T13:42:35Z", "message": "HDDS-4151. Skip the inputstream while offset larger than zero in s3g"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "32b472418198f301c2ccb69a5cd21a5c12674aa9", "author": {"user": {"login": "maobaolong", "name": "maobaolong"}}, "url": "https://github.com/apache/ozone/commit/32b472418198f301c2ccb69a5cd21a5c12674aa9", "committedDate": "2020-08-26T12:12:17Z", "message": "HDDS-4151. Skip the inputstream while offset larger than zero in s3g"}, "afterCommit": {"oid": "d1a729785afef127a605e67195fc09e622b3b8e5", "author": {"user": {"login": "maobaolong", "name": "maobaolong"}}, "url": "https://github.com/apache/ozone/commit/d1a729785afef127a605e67195fc09e622b3b8e5", "committedDate": "2020-08-26T13:42:35Z", "message": "HDDS-4151. Skip the inputstream while offset larger than zero in s3g"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDc2MTM5NzUz", "url": "https://github.com/apache/ozone/pull/1354#pullrequestreview-476139753", "createdAt": "2020-08-26T23:46:26Z", "commit": {"oid": "d1a729785afef127a605e67195fc09e622b3b8e5"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yNlQyMzo0NjoyNlrOHHkaLg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yNlQyMzo0NjoyNlrOHHkaLg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NzY5ODYwNg==", "bodyText": "I understand that we do seek, because we don't do actual read just change the position at client. but using IOUtils.copyLarge we read and skip.\nNot sure if my understanding is right? If not, can you explain if I am missing anything here?", "url": "https://github.com/apache/ozone/pull/1354#discussion_r477698606", "createdAt": "2020-08-26T23:46:26Z", "author": {"login": "bharatviswa504"}, "path": "hadoop-ozone/s3gateway/src/main/java/org/apache/hadoop/ozone/s3/endpoint/ObjectEndpoint.java", "diffHunk": "@@ -277,7 +278,8 @@ public Response get(\n           try (S3WrapperInputStream s3WrapperInputStream =\n               new S3WrapperInputStream(\n                   key.getInputStream())) {\n-            IOUtils.copyLarge(s3WrapperInputStream, dest, startOffset,\n+            s3WrapperInputStream.seek(startOffset);\n+            IOUtils.copyLarge(s3WrapperInputStream, dest, 0,", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d1a729785afef127a605e67195fc09e622b3b8e5"}, "originalPosition": 14}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDc2MTQxMTU5", "url": "https://github.com/apache/ozone/pull/1354#pullrequestreview-476141159", "createdAt": "2020-08-26T23:47:07Z", "commit": {"oid": "d1a729785afef127a605e67195fc09e622b3b8e5"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yNlQyMzo0NzowN1rOHHkeTw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yNlQyMzo0NzowN1rOHHkeTw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NzY5OTY2Mw==", "bodyText": "skip again uses read and moves the position, why not use like above seek and call copylarge?", "url": "https://github.com/apache/ozone/pull/1354#discussion_r477699663", "createdAt": "2020-08-26T23:47:07Z", "author": {"login": "bharatviswa504"}, "path": "hadoop-ozone/s3gateway/src/main/java/org/apache/hadoop/ozone/s3/endpoint/ObjectEndpoint.java", "diffHunk": "@@ -557,8 +559,14 @@ private Response createMultipartKey(String bucket, String key, long length,\n             if (range != null) {\n               RangeHeader rangeHeader =\n                   RangeHeaderParserUtil.parseRangeHeader(range, 0);\n-              IOUtils.copyLarge(sourceObject, ozoneOutputStream,\n-                  rangeHeader.getStartOffset(),\n+              final long skipped =\n+                  sourceObject.skip(rangeHeader.getStartOffset());", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d1a729785afef127a605e67195fc09e622b3b8e5"}, "originalPosition": 25}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDc2MTQzMDc2", "url": "https://github.com/apache/ozone/pull/1354#pullrequestreview-476143076", "createdAt": "2020-08-26T23:48:03Z", "commit": {"oid": "d1a729785afef127a605e67195fc09e622b3b8e5"}, "state": "COMMENTED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "7d62336fc1ceea80061a1f4b36ad516d3d589d32", "author": {"user": {"login": "maobaolong", "name": "maobaolong"}}, "url": "https://github.com/apache/ozone/commit/7d62336fc1ceea80061a1f4b36ad516d3d589d32", "committedDate": "2020-08-28T01:13:55Z", "message": "Override the skip method, using underlying skip inputstream."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDc3OTc3MTk0", "url": "https://github.com/apache/ozone/pull/1354#pullrequestreview-477977194", "createdAt": "2020-08-28T19:30:59Z", "commit": {"oid": "7d62336fc1ceea80061a1f4b36ad516d3d589d32"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2779, "cost": 1, "resetAt": "2021-10-28T18:00:02Z"}}}