{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0MzY5MzQzNjE0", "number": 512, "title": "HDDS-2959. Handle replay of OM Key ACL requests", "bodyText": "What changes were proposed in this pull request?\nTo ensure that Key acl operations are idempotent, compare the transactionID with the objectID and updateID to make sure that the transaction is not a replay. If the transactionID <= updateID, then it implies that the transaction is a replay and hence it should be skipped.\nOMKeyAclRequests (Add, Remove and Set ACL requests) are made idempotent in this Jira.\nWhat is the link to the Apache JIRA\nhttps://issues.apache.org/jira/browse/HDDS-2959\nHow was this patch tested?\nUnit tests are added", "createdAt": "2020-01-30T23:44:37Z", "url": "https://github.com/apache/ozone/pull/512", "merged": true, "mergeCommit": {"oid": "d3f8d51f0f743c12768fb0f49605e3d6fd13d136"}, "closed": true, "closedAt": "2020-02-10T23:08:09Z", "author": {"login": "hanishakoneru"}, "timelineItems": {"totalCount": 11, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcAxhqeAFqTM1MjQ3ODcwOA==", "endCursor": "Y3Vyc29yOnYyOpPPAAABcDD3rRgH2gAyMzY5MzQzNjE0OmMyZjQ4OWQ3ZDkwYTkzMWFiMTkxMWU2MzJiZWIwMjU4NDRhNTRmZjA=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzUyNDc4NzA4", "url": "https://github.com/apache/ozone/pull/512#pullrequestreview-352478708", "createdAt": "2020-02-03T18:48:12Z", "commit": {"oid": "cb2bfeb89019796d24d815d246b2d9df02da0f4e"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0wM1QxODo0ODoxMlrOFk78Jw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0wM1QxODo0ODoxMlrOFk78Jw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NDI3NTExMQ==", "bodyText": "Was this check moved somewhere else?", "url": "https://github.com/apache/ozone/pull/512#discussion_r374275111", "createdAt": "2020-02-03T18:48:12Z", "author": {"login": "arp7"}, "path": "hadoop-ozone/ozone-manager/src/main/java/org/apache/hadoop/ozone/om/response/key/acl/OMKeyAclResponse.java", "diffHunk": "@@ -36,27 +34,30 @@\n  */\n public class OMKeyAclResponse extends OMClientResponse {\n \n-  private final OmKeyInfo omKeyInfo;\n+  private OmKeyInfo omKeyInfo;\n \n-  public OMKeyAclResponse(@Nullable OmKeyInfo omKeyInfo,\n-      @Nonnull OMResponse omResponse) {\n+  public OMKeyAclResponse(@Nonnull OMResponse omResponse,\n+      @Nonnull OmKeyInfo omKeyInfo) {\n     super(omResponse);\n     this.omKeyInfo = omKeyInfo;\n   }\n \n+  /**\n+   * For when the request is not successful or it is a replay transaction.\n+   * For a successful request, the other constructor should be used.\n+   */\n+  public OMKeyAclResponse(@Nonnull OMResponse omResponse) {\n+    super(omResponse);\n+  }\n+\n   @Override\n   public void addToDBBatch(OMMetadataManager omMetadataManager,\n       BatchOperation batchOperation) throws IOException {\n \n-    // If response status is OK and success is true, add to DB batch.\n-    if (getOMResponse().getStatus() == OzoneManagerProtocolProtos.Status.OK &&", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "cb2bfeb89019796d24d815d246b2d9df02da0f4e"}, "originalPosition": 41}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzUyNDgyMzEz", "url": "https://github.com/apache/ozone/pull/512#pullrequestreview-352482313", "createdAt": "2020-02-03T18:54:10Z", "commit": {"oid": "cb2bfeb89019796d24d815d246b2d9df02da0f4e"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "cb2bfeb89019796d24d815d246b2d9df02da0f4e", "author": {"user": {"login": "hanishakoneru", "name": "Hanisha Koneru"}}, "url": "https://github.com/apache/ozone/commit/cb2bfeb89019796d24d815d246b2d9df02da0f4e", "committedDate": "2020-01-31T18:07:37Z", "message": "Add debug enabled check"}, "afterCommit": {"oid": "4fc5e80961bb8514f3d504b75715b56e52a95ed5", "author": {"user": {"login": "hanishakoneru", "name": "Hanisha Koneru"}}, "url": "https://github.com/apache/ozone/commit/4fc5e80961bb8514f3d504b75715b56e52a95ed5", "committedDate": "2020-02-04T23:36:58Z", "message": "UpdateDB even if applyAcl is false"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzUzMzk1NjI0", "url": "https://github.com/apache/ozone/pull/512#pullrequestreview-353395624", "createdAt": "2020-02-05T00:22:54Z", "commit": {"oid": "4fc5e80961bb8514f3d504b75715b56e52a95ed5"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "096d1210cfb1bf2b683389828120925f58ceb37b", "author": {"user": {"login": "hanishakoneru", "name": "Hanisha Koneru"}}, "url": "https://github.com/apache/ozone/commit/096d1210cfb1bf2b683389828120925f58ceb37b", "committedDate": "2020-02-10T21:15:01Z", "message": "HDDS-2959. Handle replay of OM Key ACL requests"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "6a6cbc3f1176bca892bb3f0aebbcd0ea59831cdf", "author": {"user": {"login": "hanishakoneru", "name": "Hanisha Koneru"}}, "url": "https://github.com/apache/ozone/commit/6a6cbc3f1176bca892bb3f0aebbcd0ea59831cdf", "committedDate": "2020-02-10T21:15:01Z", "message": "HDDS-2959. Unit test"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "6769d73baa88adbc2169ada1ab2eb29c709f9784", "author": {"user": {"login": "hanishakoneru", "name": "Hanisha Koneru"}}, "url": "https://github.com/apache/ozone/commit/6769d73baa88adbc2169ada1ab2eb29c709f9784", "committedDate": "2020-02-10T21:15:01Z", "message": "Add debug enabled check"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "da2d30df20287c14c0f1a9ea785fb14a55da779d", "author": {"user": {"login": "hanishakoneru", "name": "Hanisha Koneru"}}, "url": "https://github.com/apache/ozone/commit/da2d30df20287c14c0f1a9ea785fb14a55da779d", "committedDate": "2020-02-10T21:15:01Z", "message": "UpdateDB even if applyAcl is false"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "2e4ff77baf25577b9658475b8423f0bddb33cad4", "author": {"user": {"login": "hanishakoneru", "name": "Hanisha Koneru"}}, "url": "https://github.com/apache/ozone/commit/2e4ff77baf25577b9658475b8423f0bddb33cad4", "committedDate": "2020-02-10T21:16:42Z", "message": "Unit test fix"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "b5ae421f9795e45d215c8c84296cb3824ee5d7a9", "author": {"user": {"login": "hanishakoneru", "name": "Hanisha Koneru"}}, "url": "https://github.com/apache/ozone/commit/b5ae421f9795e45d215c8c84296cb3824ee5d7a9", "committedDate": "2020-02-06T17:43:15Z", "message": "Unit test fix"}, "afterCommit": {"oid": "2e4ff77baf25577b9658475b8423f0bddb33cad4", "author": {"user": {"login": "hanishakoneru", "name": "Hanisha Koneru"}}, "url": "https://github.com/apache/ozone/commit/2e4ff77baf25577b9658475b8423f0bddb33cad4", "committedDate": "2020-02-10T21:16:42Z", "message": "Unit test fix"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c2f489d7d90a931ab1911e632beb025844a54ff0", "author": {"user": {"login": "hanishakoneru", "name": "Hanisha Koneru"}}, "url": "https://github.com/apache/ozone/commit/c2f489d7d90a931ab1911e632beb025844a54ff0", "committedDate": "2020-02-10T21:18:23Z", "message": "rebase"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3803, "cost": 1, "resetAt": "2021-10-28T18:00:02Z"}}}