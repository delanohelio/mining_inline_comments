{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0MzkyMjQ0NDQ5", "number": 704, "reviewThreads": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yNFQxNToxNDowNFrODq1mcw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yNFQxNToxNDoxMVrODq1mvg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjQ2MjQ0OTc5OnYy", "diffSide": "RIGHT", "path": "hadoop-hdds/container-service/src/test/java/org/apache/hadoop/ozone/container/common/impl/TestHddsDispatcher.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yNFQxNToxNDowNFrOF61Eqw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yNFQxNTozOTo1MVrOF62UiA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NzIzMTI3NQ==", "bodyText": "Should we call shutdownDispatcher() here as well instead of just ContainerMetrics.remove()?", "url": "https://github.com/apache/ozone/pull/704#discussion_r397231275", "createdAt": "2020-03-24T15:14:04Z", "author": {"login": "fapifta"}, "path": "hadoop-hdds/container-service/src/test/java/org/apache/hadoop/ozone/container/common/impl/TestHddsDispatcher.java", "diffHunk": "@@ -132,6 +132,7 @@ public void testContainerCloseActionWhenFull() throws IOException {\n \n     } finally {\n       volumeSet.shutdown();\n+      ContainerMetrics.remove();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c58011521bcbf63f25519cbd40b665d4f532e95e"}, "originalPosition": 4}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NzI1MTcyMA==", "bodyText": "I removed that method and unify all the calls to ContainerMetrics.remove()", "url": "https://github.com/apache/ozone/pull/704#discussion_r397251720", "createdAt": "2020-03-24T15:39:51Z", "author": {"login": "esahekmat"}, "path": "hadoop-hdds/container-service/src/test/java/org/apache/hadoop/ozone/container/common/impl/TestHddsDispatcher.java", "diffHunk": "@@ -132,6 +132,7 @@ public void testContainerCloseActionWhenFull() throws IOException {\n \n     } finally {\n       volumeSet.shutdown();\n+      ContainerMetrics.remove();", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NzIzMTI3NQ=="}, "originalCommit": {"oid": "c58011521bcbf63f25519cbd40b665d4f532e95e"}, "originalPosition": 4}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjQ2MjQ1MDEzOnYy", "diffSide": "RIGHT", "path": "hadoop-hdds/container-service/src/test/java/org/apache/hadoop/ozone/container/common/impl/TestHddsDispatcher.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yNFQxNToxNDowN1rOF61E2A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yNFQxNTozMjoyM1rOF619Tw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NzIzMTMyMA==", "bodyText": "I am not convinced whether this step to remove the ContainerMetrics belongs to a method called shutdownDispatcher, at least from the name it is not clear it will do so besides shutting down the dispatcher. Shouldn't we separate this two?", "url": "https://github.com/apache/ozone/pull/704#discussion_r397231320", "createdAt": "2020-03-24T15:14:07Z", "author": {"login": "fapifta"}, "path": "hadoop-hdds/container-service/src/test/java/org/apache/hadoop/ozone/container/common/impl/TestHddsDispatcher.java", "diffHunk": "@@ -276,6 +283,13 @@ private HddsDispatcher createDispatcher(DatanodeDetails dd, UUID scmId,\n     return hddsDispatcher;\n   }\n \n+  private void shutdownDispatcher(HddsDispatcher dispatcher){\n+    if(dispatcher != null) {\n+      dispatcher.shutdown();\n+    }\n+    ContainerMetrics.remove();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c58011521bcbf63f25519cbd40b665d4f532e95e"}, "originalPosition": 85}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NzI0NTc3NQ==", "bodyText": "actually dispatcher.shutdown() method do nothing, and I put it here to follow the principle of shutdown used objects.\nI will edit this part to just call ContainerMetrics.remove()", "url": "https://github.com/apache/ozone/pull/704#discussion_r397245775", "createdAt": "2020-03-24T15:32:23Z", "author": {"login": "esahekmat"}, "path": "hadoop-hdds/container-service/src/test/java/org/apache/hadoop/ozone/container/common/impl/TestHddsDispatcher.java", "diffHunk": "@@ -276,6 +283,13 @@ private HddsDispatcher createDispatcher(DatanodeDetails dd, UUID scmId,\n     return hddsDispatcher;\n   }\n \n+  private void shutdownDispatcher(HddsDispatcher dispatcher){\n+    if(dispatcher != null) {\n+      dispatcher.shutdown();\n+    }\n+    ContainerMetrics.remove();", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NzIzMTMyMA=="}, "originalCommit": {"oid": "c58011521bcbf63f25519cbd40b665d4f532e95e"}, "originalPosition": 85}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjQ2MjQ1MDM1OnYy", "diffSide": "RIGHT", "path": "hadoop-hdds/container-service/src/test/java/org/apache/hadoop/ozone/container/common/interfaces/TestHandler.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yNFQxNToxNDoxMFrOF61FAA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yNFQxNToyNTo1NVrOF61pgQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NzIzMTM2MA==", "bodyText": "Do we still need this one after the added cleanup in TestHddsDispatcher?", "url": "https://github.com/apache/ozone/pull/704#discussion_r397231360", "createdAt": "2020-03-24T15:14:10Z", "author": {"login": "fapifta"}, "path": "hadoop-hdds/container-service/src/test/java/org/apache/hadoop/ozone/container/common/interfaces/TestHandler.java", "diffHunk": "@@ -58,6 +60,7 @@\n \n   @Before\n   public void setup() throws Exception {\n+    DefaultMetricsSystem.instance().shutdown();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c58011521bcbf63f25519cbd40b665d4f532e95e"}, "originalPosition": 20}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NzI0MDcwNQ==", "bodyText": "My mistake, I will remove this", "url": "https://github.com/apache/ozone/pull/704#discussion_r397240705", "createdAt": "2020-03-24T15:25:55Z", "author": {"login": "esahekmat"}, "path": "hadoop-hdds/container-service/src/test/java/org/apache/hadoop/ozone/container/common/interfaces/TestHandler.java", "diffHunk": "@@ -58,6 +60,7 @@\n \n   @Before\n   public void setup() throws Exception {\n+    DefaultMetricsSystem.instance().shutdown();", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NzIzMTM2MA=="}, "originalCommit": {"oid": "c58011521bcbf63f25519cbd40b665d4f532e95e"}, "originalPosition": 20}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjQ2MjQ1MDU0OnYy", "diffSide": "RIGHT", "path": "hadoop-hdds/container-service/src/test/java/org/apache/hadoop/ozone/container/common/volume/TestHddsVolumeChecker.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yNFQxNToxNDoxMVrOF61FFw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yNFQxNToyNjoxMlrOF61qZg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NzIzMTM4Mw==", "bodyText": "Do we still need this one after the added cleanup in TestHddsDispatcher?", "url": "https://github.com/apache/ozone/pull/704#discussion_r397231383", "createdAt": "2020-03-24T15:14:11Z", "author": {"login": "fapifta"}, "path": "hadoop-hdds/container-service/src/test/java/org/apache/hadoop/ozone/container/common/volume/TestHddsVolumeChecker.java", "diffHunk": "@@ -91,6 +92,7 @@\n \n   @Before\n   public void setup() throws IOException {\n+    DefaultMetricsSystem.instance().shutdown();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c58011521bcbf63f25519cbd40b665d4f532e95e"}, "originalPosition": 12}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NzI0MDkzNA==", "bodyText": "My mistake, I will remove this", "url": "https://github.com/apache/ozone/pull/704#discussion_r397240934", "createdAt": "2020-03-24T15:26:12Z", "author": {"login": "esahekmat"}, "path": "hadoop-hdds/container-service/src/test/java/org/apache/hadoop/ozone/container/common/volume/TestHddsVolumeChecker.java", "diffHunk": "@@ -91,6 +92,7 @@\n \n   @Before\n   public void setup() throws IOException {\n+    DefaultMetricsSystem.instance().shutdown();", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NzIzMTM4Mw=="}, "originalCommit": {"oid": "c58011521bcbf63f25519cbd40b665d4f532e95e"}, "originalPosition": 12}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4862, "cost": 1, "resetAt": "2021-11-12T11:57:46Z"}}}