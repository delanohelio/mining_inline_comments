{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTExNDczNjY4", "number": 1526, "title": "HDDS-4399. Safe mode rule for piplelines should only consider open pipelines.", "bodyText": "What changes were proposed in this pull request?\nCurrently, for safe mode we consider all pipelines existing in DB for safe mode exit criteria. It ma happen that, SCM has the pipelines craeted , but none of the participants datanodes ever created these datanodes. In such cases, SCM fails to come out of safemode as these pipelines are never reported back to SCM.\nThe idea here is to consider pipelines which are marked open during SCM startup.\nWhat is the link to the Apache JIRA\nhttps://issues.apache.org/jira/browse/HDDS-4399\nHow was this patch tested?\nAdded unit tests", "createdAt": "2020-10-28T11:24:17Z", "url": "https://github.com/apache/ozone/pull/1526", "merged": true, "mergeCommit": {"oid": "8b2c2eb9aab582887421745c874bb9dd50c381da"}, "closed": true, "closedAt": "2020-11-17T17:31:39Z", "author": {"login": "bshashikant"}, "timelineItems": {"totalCount": 7, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdXk48-gBqjM5NDA3MjM0Nzk=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdc91cfAFqTUzMDkyMTY4MA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "806de8b75cdccab73f0ccb0e568c0fa500fa2043", "author": {"user": {"login": "bshashikant", "name": null}}, "url": "https://github.com/apache/ozone/commit/806de8b75cdccab73f0ccb0e568c0fa500fa2043", "committedDate": "2020-10-30T11:15:01Z", "message": "Addressed review comments."}, "afterCommit": {"oid": "acaf77754569d23c01637aa6bc0f5e6b2e8f3a97", "author": {"user": {"login": "bshashikant", "name": null}}, "url": "https://github.com/apache/ozone/commit/acaf77754569d23c01637aa6bc0f5e6b2e8f3a97", "committedDate": "2020-10-30T11:15:43Z", "message": "Addressed unit test failures."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTIyMTg4NjEx", "url": "https://github.com/apache/ozone/pull/1526#pullrequestreview-522188611", "createdAt": "2020-11-03T04:51:11Z", "commit": {"oid": "acaf77754569d23c01637aa6bc0f5e6b2e8f3a97"}, "state": "COMMENTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wM1QwNDo1MToxMVrOHsgNMQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wM1QwNDo1NDoyN1rOHsgQBw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNjQyNzA1Nw==", "bodyText": "do we want to remove this?", "url": "https://github.com/apache/ozone/pull/1526#discussion_r516427057", "createdAt": "2020-11-03T04:51:11Z", "author": {"login": "bharatviswa504"}, "path": "hadoop-hdds/server-scm/src/main/java/org/apache/hadoop/hdds/scm/safemode/HealthyPipelineSafeModeRule.java", "diffHunk": "@@ -118,7 +118,7 @@ protected void process(Pipeline pipeline) {\n     Preconditions.checkNotNull(pipeline);\n     if (pipeline.getType() == HddsProtos.ReplicationType.RATIS &&\n         pipeline.getFactor() == HddsProtos.ReplicationFactor.THREE &&\n-        pipeline.isHealthy() &&\n+      //  pipeline.isHealthy() &&", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "acaf77754569d23c01637aa6bc0f5e6b2e8f3a97"}, "originalPosition": 14}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNjQyNzc4Mw==", "bodyText": "I understand now why we can remove this, we trigger open Pipeline event when healthy only. Can we remove the code comment completely.", "url": "https://github.com/apache/ozone/pull/1526#discussion_r516427783", "createdAt": "2020-11-03T04:54:27Z", "author": {"login": "bharatviswa504"}, "path": "hadoop-hdds/server-scm/src/main/java/org/apache/hadoop/hdds/scm/safemode/HealthyPipelineSafeModeRule.java", "diffHunk": "@@ -118,7 +118,7 @@ protected void process(Pipeline pipeline) {\n     Preconditions.checkNotNull(pipeline);\n     if (pipeline.getType() == HddsProtos.ReplicationType.RATIS &&\n         pipeline.getFactor() == HddsProtos.ReplicationFactor.THREE &&\n-        pipeline.isHealthy() &&\n+      //  pipeline.isHealthy() &&", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNjQyNzA1Nw=="}, "originalCommit": {"oid": "acaf77754569d23c01637aa6bc0f5e6b2e8f3a97"}, "originalPosition": 14}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "acd74894a45bc601ff7a780cb463243b608f7215", "author": {"user": {"login": "bshashikant", "name": null}}, "url": "https://github.com/apache/ozone/commit/acd74894a45bc601ff7a780cb463243b608f7215", "committedDate": "2020-11-03T09:44:24Z", "message": "Addressed test failures."}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "acaf77754569d23c01637aa6bc0f5e6b2e8f3a97", "author": {"user": {"login": "bshashikant", "name": null}}, "url": "https://github.com/apache/ozone/commit/acaf77754569d23c01637aa6bc0f5e6b2e8f3a97", "committedDate": "2020-10-30T11:15:43Z", "message": "Addressed unit test failures."}, "afterCommit": {"oid": "acd74894a45bc601ff7a780cb463243b608f7215", "author": {"user": {"login": "bshashikant", "name": null}}, "url": "https://github.com/apache/ozone/commit/acd74894a45bc601ff7a780cb463243b608f7215", "committedDate": "2020-11-03T09:44:24Z", "message": "Addressed test failures."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f38371aa8906d56010b4c3dee2819040f3d6a896", "author": {"user": {"login": "bshashikant", "name": null}}, "url": "https://github.com/apache/ozone/commit/f38371aa8906d56010b4c3dee2819040f3d6a896", "committedDate": "2020-11-03T14:00:58Z", "message": "Addressed unit test failures by synchronising pipeline store close with db update."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "beba1e465c2c8663976cf8ce65c7ac1e0f60c51a", "author": {"user": {"login": "bshashikant", "name": null}}, "url": "https://github.com/apache/ozone/commit/beba1e465c2c8663976cf8ce65c7ac1e0f60c51a", "committedDate": "2020-11-03T14:47:24Z", "message": "Addressed checkstyle issues."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTMwOTIxNjgw", "url": "https://github.com/apache/ozone/pull/1526#pullrequestreview-530921680", "createdAt": "2020-11-16T05:09:42Z", "commit": {"oid": "beba1e465c2c8663976cf8ce65c7ac1e0f60c51a"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2183, "cost": 1, "resetAt": "2021-10-28T18:00:02Z"}}}