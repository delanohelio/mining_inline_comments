{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDI2OTI2MTYw", "number": 1012, "title": "HDDS-3658. Stop to persist container related pipeline info of each ke\u2026", "bodyText": "https://issues.apache.org/jira/browse/HDDS-3658", "createdAt": "2020-06-03T02:33:26Z", "url": "https://github.com/apache/ozone/pull/1012", "merged": true, "mergeCommit": {"oid": "71cc33da2747b0e68bc4157b45d23933b047950a"}, "closed": true, "closedAt": "2020-07-24T02:17:45Z", "author": {"login": "ChenSammi"}, "timelineItems": {"totalCount": 8, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcn1FMNABqjM0MDQ4MjMyNzc=", "endCursor": "Y3Vyc29yOnYyOpPPAAABc3uYYjgH2gAyNDI2OTI2MTYwOjk5MjcyYjY4OWU2YThjMGExZTk2YjJlMmRjY2MxYWFkM2ViMTFjYTM=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "8a3cbf1c2301c2de1094d70b2806d8516fabe679", "author": {"user": {"login": "ChenSammi", "name": "Sammi Chen"}}, "url": "https://github.com/apache/ozone/commit/8a3cbf1c2301c2de1094d70b2806d8516fabe679", "committedDate": "2020-06-03T02:32:11Z", "message": "HDDS-3658. Stop to persist container related pipeline info of each key into OM DB to reduce DB size."}, "afterCommit": {"oid": "6ce2a9170711e1b46acd839d7c7a68ad66494573", "author": {"user": {"login": "ChenSammi", "name": "Sammi Chen"}}, "url": "https://github.com/apache/ozone/commit/6ce2a9170711e1b46acd839d7c7a68ad66494573", "committedDate": "2020-06-04T02:58:39Z", "message": "fix checktyle issues"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDM0ODA5NTEx", "url": "https://github.com/apache/ozone/pull/1012#pullrequestreview-434809511", "createdAt": "2020-06-22T10:47:43Z", "commit": {"oid": "2e5c18ae6d37ee0d859a53e0d6b4d2e520d7caf6"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDQ2Nzk2OTk0", "url": "https://github.com/apache/ozone/pull/1012#pullrequestreview-446796994", "createdAt": "2020-07-11T11:33:07Z", "commit": {"oid": "c9c72dae5c72053e85cc81f085876585b38f71d8"}, "state": "DISMISSED", "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xMVQxMTozMzowN1rOGwMR1w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xMVQxMTozODoxMFrOGwMTNg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MzE4NjAwNw==", "bodyText": "OmKeyInfo was changed in #1034 to avoid streams.  keyLocationVersions is now converted in a loop:\nhttps://github.com/apache/hadoop-ozone/blob/2af6198686d81daa3ad0513f723118637d2945cf/hadoop-ozone/common/src/main/java/org/apache/hadoop/ozone/om/helpers/OmKeyInfo.java#L388-L391\nThat's where normal/compact protobuf conversion should happen depending on ignorePipeline parameter.", "url": "https://github.com/apache/ozone/pull/1012#discussion_r453186007", "createdAt": "2020-07-11T11:33:07Z", "author": {"login": "adoroszlai"}, "path": "hadoop-ozone/common/src/main/java/org/apache/hadoop/ozone/om/helpers/OmKeyInfo.java", "diffHunk": "@@ -408,6 +421,15 @@ public KeyInfo getProtobuf() {\n     if (encInfo != null) {\n       kb.setFileEncryptionInfo(OMPBHelper.convert(encInfo));\n     }\n+    if (ignorePipeline) {\n+      kb.addAllKeyLocationList(keyLocationVersions.stream()\n+          .map(OmKeyLocationInfoGroup::getCompactProtobuf)\n+          .collect(Collectors.toList()));\n+    } else {\n+      kb.addAllKeyLocationList(keyLocationVersions.stream()\n+          .map(OmKeyLocationInfoGroup::getProtobuf)\n+          .collect(Collectors.toList()));\n+    }", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c9c72dae5c72053e85cc81f085876585b38f71d8"}, "originalPosition": 33}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MzE4NjA4Mw==", "bodyText": "This dockerfile seems to be unrelated to the change in this PR.", "url": "https://github.com/apache/ozone/pull/1012#discussion_r453186083", "createdAt": "2020-07-11T11:34:10Z", "author": {"login": "adoroszlai"}, "path": "Dockerfile", "diffHunk": "@@ -0,0 +1,20 @@\n+ARG BASE=latest\n+FROM flokkr/base:35", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c9c72dae5c72053e85cc81f085876585b38f71d8"}, "originalPosition": 2}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MzE4NjM1OA==", "bodyText": "Can we avoid duplication by extracting to a helper method that takes OmKeyLocationInfo conversion function (OmKeyLocationInfo::getCompactProtobuf or OmKeyLocationInfo::getProtobuf)?", "url": "https://github.com/apache/ozone/pull/1012#discussion_r453186358", "createdAt": "2020-07-11T11:38:10Z", "author": {"login": "adoroszlai"}, "path": "hadoop-ozone/common/src/main/java/org/apache/hadoop/ozone/om/helpers/OmKeyLocationInfoGroup.java", "diffHunk": "@@ -58,11 +58,22 @@ public long getVersion() {\n     return locationList;\n   }\n \n+  public KeyLocationList getCompactProtobuf() {\n+    return KeyLocationList.newBuilder()\n+        .setVersion(version)\n+        .addAllKeyLocations(\n+            locationList.stream().map(\n+                OmKeyLocationInfo::getCompactProtobuf)\n+                .collect(Collectors.toList()))\n+        .build();\n+  }\n+", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c9c72dae5c72053e85cc81f085876585b38f71d8"}, "originalPosition": 13}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "c9c72dae5c72053e85cc81f085876585b38f71d8", "author": {"user": {"login": "elek", "name": "Elek, M\u00e1rton"}}, "url": "https://github.com/apache/ozone/commit/c9c72dae5c72053e85cc81f085876585b38f71d8", "committedDate": "2020-06-30T07:30:41Z", "message": "Merge remote-tracking branch 'origin/master' into HEAD"}, "afterCommit": {"oid": "047c124965cfe1cd41ddab89282aee650db881af", "author": {"user": {"login": "ChenSammi", "name": "Sammi Chen"}}, "url": "https://github.com/apache/ozone/commit/047c124965cfe1cd41ddab89282aee650db881af", "committedDate": "2020-07-20T12:11:17Z", "message": "fix checktyle issues"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "047c124965cfe1cd41ddab89282aee650db881af", "author": {"user": {"login": "ChenSammi", "name": "Sammi Chen"}}, "url": "https://github.com/apache/ozone/commit/047c124965cfe1cd41ddab89282aee650db881af", "committedDate": "2020-07-20T12:11:17Z", "message": "fix checktyle issues"}, "afterCommit": {"oid": "0295a16825836bb8b8c41c43fa9ba4ec6f2a0411", "author": {"user": {"login": "ChenSammi", "name": "Sammi Chen"}}, "url": "https://github.com/apache/ozone/commit/0295a16825836bb8b8c41c43fa9ba4ec6f2a0411", "committedDate": "2020-07-20T12:32:31Z", "message": "HDDS-3658. Stop to persist container related pipeline info of each key into OM DB to reduce DB size."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a0c3b5259bbf6fd7fbb1b71e8cce29fa2e8b8f09", "author": {"user": {"login": "ChenSammi", "name": "Sammi Chen"}}, "url": "https://github.com/apache/ozone/commit/a0c3b5259bbf6fd7fbb1b71e8cce29fa2e8b8f09", "committedDate": "2020-07-23T07:28:18Z", "message": "HDDS-3658. Stop to persist container related pipeline info of each key into OM DB to reduce DB size."}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "bf5a0caf2494c48221a877f8451e6b72c201adfe", "author": {"user": {"login": "ChenSammi", "name": "Sammi Chen"}}, "url": "https://github.com/apache/ozone/commit/bf5a0caf2494c48221a877f8451e6b72c201adfe", "committedDate": "2020-07-21T06:32:51Z", "message": "checkstyle"}, "afterCommit": {"oid": "a0c3b5259bbf6fd7fbb1b71e8cce29fa2e8b8f09", "author": {"user": {"login": "ChenSammi", "name": "Sammi Chen"}}, "url": "https://github.com/apache/ozone/commit/a0c3b5259bbf6fd7fbb1b71e8cce29fa2e8b8f09", "committedDate": "2020-07-23T07:28:18Z", "message": "HDDS-3658. Stop to persist container related pipeline info of each key into OM DB to reduce DB size."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "99272b689e6a8c0a1e96b2e2dccc1aad3eb11ca3", "author": {"user": {"login": "ChenSammi", "name": "Sammi Chen"}}, "url": "https://github.com/apache/ozone/commit/99272b689e6a8c0a1e96b2e2dccc1aad3eb11ca3", "committedDate": "2020-07-23T12:14:11Z", "message": "trigger new CI chck"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3133, "cost": 1, "resetAt": "2021-10-28T18:00:02Z"}}}