{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0Mzk3NzU5NTkw", "number": 760, "title": "HDDS-3334. OM Client failover to next OM on NotLeaderException", "bodyText": "What changes were proposed in this pull request?\nOn receiving NotLeaderException from OM server, we should failover to the next OM in the list instead of the suggested Leader. This will ensure that all the OMs are contacted in a round robin way. Failing always to the suggested leader is not robust.\nWhat is the link to the Apache JIRA\nhttps://issues.apache.org/jira/browse/HDDS-3334\nHow was this patch tested?\nTestOzoneManagerHA#testOMProxyProviderFailoverToCurrentLeader already covers this test.", "createdAt": "2020-04-02T18:57:24Z", "url": "https://github.com/apache/ozone/pull/760", "merged": true, "mergeCommit": {"oid": "0189f8dfd61781d8727a42feed6c8c0936953d9f"}, "closed": true, "closedAt": "2020-04-02T23:20:50Z", "author": {"login": "hanishakoneru"}, "timelineItems": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcTxEqWgFqTM4NjcxMjc2Mg==", "endCursor": "Y3Vyc29yOnYyOpPPAAABcTxONrgBqjMxOTM2NDg4NTY=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzg2NzEyNzYy", "url": "https://github.com/apache/ozone/pull/760#pullrequestreview-386712762", "createdAt": "2020-04-02T19:01:05Z", "commit": {"oid": "e45546d6f885dd633a1705d422618045697810b1"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzg2NzE1NTQy", "url": "https://github.com/apache/ozone/pull/760#pullrequestreview-386715542", "createdAt": "2020-04-02T19:05:05Z", "commit": {"oid": "e45546d6f885dd633a1705d422618045697810b1"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wMlQxOTowNTowNVrOF_5djQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wMlQxOTowNTowNVrOF_5djQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMjU0NjA2MQ==", "bodyText": "Can we use lambdaTestUtils instead of sleep?\n\n  \n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                Thread.sleep(5000);\n          \n          \n            \n                LambdaTestUtils.await(6000, 2000, () -> (omFailoverProxyProvider.getCurrentProxyOMNodeId().equals(leaderOMNodeId)));", "url": "https://github.com/apache/ozone/pull/760#discussion_r402546061", "createdAt": "2020-04-02T19:05:05Z", "author": {"login": "vivekratnavel"}, "path": "hadoop-ozone/integration-test/src/test/java/org/apache/hadoop/ozone/om/TestOzoneManagerHA.java", "diffHunk": "@@ -726,7 +726,7 @@ public void testOMProxyProviderFailoverToCurrentLeader() throws Exception {\n     // information must be returned via the response and a failover must\n     // happen to the leader proxy node.\n     createVolumeTest(true);\n-    Thread.sleep(2000);\n+    Thread.sleep(5000);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e45546d6f885dd633a1705d422618045697810b1"}, "originalPosition": 5}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "2575052dac2e4880c839d2b1bbf2c514090ca97d", "author": {"user": {"login": "hanishakoneru", "name": "Hanisha Koneru"}}, "url": "https://github.com/apache/ozone/commit/2575052dac2e4880c839d2b1bbf2c514090ca97d", "committedDate": "2020-04-02T19:07:15Z", "message": "HDDS-3334. OM Client failover to next OM on NotLeaderException"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "e45546d6f885dd633a1705d422618045697810b1", "author": {"user": {"login": "hanishakoneru", "name": "Hanisha Koneru"}}, "url": "https://github.com/apache/ozone/commit/e45546d6f885dd633a1705d422618045697810b1", "committedDate": "2020-04-02T18:55:56Z", "message": "HDDS-3334. OM Client failover to next OM on NotLeaderException"}, "afterCommit": {"oid": "2575052dac2e4880c839d2b1bbf2c514090ca97d", "author": {"user": {"login": "hanishakoneru", "name": "Hanisha Koneru"}}, "url": "https://github.com/apache/ozone/commit/2575052dac2e4880c839d2b1bbf2c514090ca97d", "committedDate": "2020-04-02T19:07:15Z", "message": "HDDS-3334. OM Client failover to next OM on NotLeaderException"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3430, "cost": 1, "resetAt": "2021-10-28T18:00:02Z"}}}