{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTI2NDU0MjM5", "number": 1619, "title": "HDDS-4503. Provide info on block size via FileSystem", "bodyText": "What changes were proposed in this pull request?\nProvide information about Ozone's configured block size via Hadoop-compatible file system implementations by overriding getDefaultBlockSize() from FileSystem.\nOzone does not make new files visible until they are closed.  This change allows Impala to query the actual configured block size and use this info during file write, instead of relying on the default block size, which can be overridden in config.\nhttps://issues.apache.org/jira/browse/HDDS-4503\nHow was this patch tested?\nAdded unit test.", "createdAt": "2020-11-24T12:46:12Z", "url": "https://github.com/apache/ozone/pull/1619", "merged": true, "mergeCommit": {"oid": "f30aba704e4b2929764e04db845d8e0cf54e261b"}, "closed": true, "closedAt": "2020-12-12T16:24:09Z", "author": {"login": "adoroszlai"}, "timelineItems": {"totalCount": 7, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdfmRmLAH2gAyNTI2NDU0MjM5Ojk4YTAyMjZjZmVjZTNkNWFiYTI5MGEwZjkyMmMyNzBjNTkzNzExMTk=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdlfEBagFqTU1MDg0MjQ4OA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "98a0226cfece3d5aba290a0f922c270c59371119", "author": {"user": {"login": "adoroszlai", "name": "Doroszlai, Attila"}}, "url": "https://github.com/apache/ozone/commit/98a0226cfece3d5aba290a0f922c270c59371119", "committedDate": "2020-11-24T09:24:30Z", "message": "HDDS-4503. Provide info on block size via FileSystem"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "4f3bc3400be51a84d176a6802706b8affb575381", "author": {"user": {"login": "adoroszlai", "name": "Doroszlai, Attila"}}, "url": "https://github.com/apache/ozone/commit/4f3bc3400be51a84d176a6802706b8affb575381", "committedDate": "2020-11-24T10:43:16Z", "message": "trigger new CI check"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "2d5a3715fce203de51621d2d2588daf4e6584e04", "author": {"user": {"login": "adoroszlai", "name": "Doroszlai, Attila"}}, "url": "https://github.com/apache/ozone/commit/2d5a3715fce203de51621d2d2588daf4e6584e04", "committedDate": "2020-11-24T11:41:39Z", "message": "trigger new CI check"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTM3NTk2MzU3", "url": "https://github.com/apache/ozone/pull/1619#pullrequestreview-537596357", "createdAt": "2020-11-24T15:12:03Z", "commit": {"oid": "2d5a3715fce203de51621d2d2588daf4e6584e04"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0yNFQxNToxMjowM1rOH5FdHA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0yNFQxNToxMjowM1rOH5FdHA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyOTYyMDI1Mg==", "bodyText": "Is this block size used by client while writing? In create and createNonRecursive it tends to ignore the specified block size.\nSo, if it isn't correct, Isn't it same as not implementing it? FileSystem will anyway return some value, that can be tweaked as well by fs.local.block.size", "url": "https://github.com/apache/ozone/pull/1619#discussion_r529620252", "createdAt": "2020-11-24T15:12:03Z", "author": {"login": "ayushtkn"}, "path": "hadoop-ozone/ozonefs-common/src/main/java/org/apache/hadoop/fs/ozone/BasicRootedOzoneFileSystem.java", "diffHunk": "@@ -723,6 +726,12 @@ public boolean mkdirs(Path f, FsPermission permission) throws IOException {\n     return mkdir(f);\n   }\n \n+  @Override\n+  public long getDefaultBlockSize() {\n+    return (long) getConf().getStorageSize(\n+        OZONE_SCM_BLOCK_SIZE, OZONE_SCM_BLOCK_SIZE_DEFAULT, StorageUnit.BYTES);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "2d5a3715fce203de51621d2d2588daf4e6584e04"}, "originalPosition": 24}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f1d723b85adee356d7175edb78fdf9e0ce8a3f0f", "author": {"user": {"login": "adoroszlai", "name": "Doroszlai, Attila"}}, "url": "https://github.com/apache/ozone/commit/f1d723b85adee356d7175edb78fdf9e0ce8a3f0f", "committedDate": "2020-11-24T17:40:14Z", "message": "trigger new CI check"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTM3OTI5MjAx", "url": "https://github.com/apache/ozone/pull/1619#pullrequestreview-537929201", "createdAt": "2020-11-24T21:10:18Z", "commit": {"oid": "f1d723b85adee356d7175edb78fdf9e0ce8a3f0f"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0yNFQyMToxMDoxOFrOH5VSQg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0yNFQyMToxMDoxOFrOH5VSQg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyOTg3OTYxOA==", "bodyText": "What if the client who wrote the block and the client who is querying have a different configuration?", "url": "https://github.com/apache/ozone/pull/1619#discussion_r529879618", "createdAt": "2020-11-24T21:10:18Z", "author": {"login": "arp7"}, "path": "hadoop-ozone/ozonefs-common/src/main/java/org/apache/hadoop/fs/ozone/BasicOzoneFileSystem.java", "diffHunk": "@@ -698,6 +701,12 @@ public boolean mkdirs(Path f, FsPermission permission) throws IOException {\n     return mkdir(f);\n   }\n \n+  @Override\n+  public long getDefaultBlockSize() {\n+    return (long) getConf().getStorageSize(\n+        OZONE_SCM_BLOCK_SIZE, OZONE_SCM_BLOCK_SIZE_DEFAULT, StorageUnit.BYTES);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f1d723b85adee356d7175edb78fdf9e0ce8a3f0f"}, "originalPosition": 24}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTUwODQyNDg4", "url": "https://github.com/apache/ozone/pull/1619#pullrequestreview-550842488", "createdAt": "2020-12-12T16:23:53Z", "commit": {"oid": "f1d723b85adee356d7175edb78fdf9e0ce8a3f0f"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1961, "cost": 1, "resetAt": "2021-10-28T18:00:02Z"}}}