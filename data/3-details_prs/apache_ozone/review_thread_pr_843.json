{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDA1Nzg1OTAw", "number": 843, "reviewThreads": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yMVQwNTozOTo1MVrOD0DaFg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yMVQwNTozOTo1MVrOD0DaFg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjU1OTA4Mzc0OnYy", "diffSide": "RIGHT", "path": "hadoop-ozone/s3gateway/src/main/java/org/apache/hadoop/ozone/s3/io/S3WrapperInputStream.java", "isResolved": true, "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yMVQwNTozOTo1MVrOGIzZQQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yMVQxOTozNjo0MlrOGJVK4w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMTg4Mzg0MQ==", "bodyText": "-ve means all, so if I say -1/-2, read entire file till end?.\nBut I don't see that handled in the code.", "url": "https://github.com/apache/ozone/pull/843#discussion_r411883841", "createdAt": "2020-04-21T05:39:51Z", "author": {"login": "bharatviswa504"}, "path": "hadoop-ozone/s3gateway/src/main/java/org/apache/hadoop/ozone/s3/io/S3WrapperInputStream.java", "diffHunk": "@@ -76,4 +79,87 @@ public long getPos() throws IOException {\n   public boolean seekToNewSource(long targetPos) throws IOException {\n     return false;\n   }\n+\n+  /**\n+   * Copies some or all bytes from a large (over 2GB) <code>InputStream</code>\n+   * to an <code>OutputStream</code>, optionally skipping input bytes.\n+   * <p>\n+   * Copy the method from IOUtils of commons-io to reimplement skip by seek\n+   * rather than read. The reason why IOUtils of commons-io implement skip\n+   * by read can be found at\n+   * <a href=\"https://issues.apache.org/jira/browse/IO-203\">IO-203</a>.\n+   * </p>\n+   * <p>\n+   * This method buffers the input internally, so there is no need to use a\n+   * <code>BufferedInputStream</code>.\n+   * </p>\n+   * The buffer size is given by {@link #DEFAULT_BUFFER_SIZE}.\n+   *\n+   * @param output the <code>OutputStream</code> to write to\n+   * @param inputOffset : number of bytes to skip from input before copying\n+   * -ve values are ignored\n+   * @param length : number of bytes to copy. -ve means all\n+   * @return the number of bytes copied\n+   * @throws NullPointerException if the input or output is null\n+   * @throws IOException          if an I/O error occurs\n+   */\n+  public long copyLarge(final OutputStream output, final long inputOffset,\n+      final long length) throws IOException {\n+    return copyLarge(output, inputOffset, length,\n+        new byte[DEFAULT_BUFFER_SIZE]);\n+  }\n+\n+  /**\n+   * Copies some or all bytes from a large (over 2GB) <code>InputStream</code>\n+   * to an <code>OutputStream</code>, optionally skipping input bytes.\n+   * <p>\n+   * Copy the method from IOUtils of commons-io to reimplement skip by seek\n+   * rather than read. The reason why IOUtils of commons-io implement skip\n+   * by read can be found at\n+   * <a href=\"https://issues.apache.org/jira/browse/IO-203\">IO-203</a>.\n+   * </p>\n+   * <p>\n+   * This method uses the provided buffer, so there is no need to use a\n+   * <code>BufferedInputStream</code>.\n+   * </p>\n+   *\n+   * @param output the <code>OutputStream</code> to write to\n+   * @param inputOffset : number of bytes to skip from input before copying\n+   * -ve values are ignored\n+   * @param length : number of bytes to copy. -ve means all", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "2388d620511404c4de8f99ce8a37e0c411294c8d"}, "originalPosition": 72}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMTkwNTY2NA==", "bodyText": "@bharatviswa504 Hi, thanks for your comments.  If length < 0, then bytesToRead equals to bufferLength and never change. So while loop will not break until read == IOUtils.EOF. So it call read entire file till end.", "url": "https://github.com/apache/ozone/pull/843#discussion_r411905664", "createdAt": "2020-04-21T06:29:11Z", "author": {"login": "runzhiwang"}, "path": "hadoop-ozone/s3gateway/src/main/java/org/apache/hadoop/ozone/s3/io/S3WrapperInputStream.java", "diffHunk": "@@ -76,4 +79,87 @@ public long getPos() throws IOException {\n   public boolean seekToNewSource(long targetPos) throws IOException {\n     return false;\n   }\n+\n+  /**\n+   * Copies some or all bytes from a large (over 2GB) <code>InputStream</code>\n+   * to an <code>OutputStream</code>, optionally skipping input bytes.\n+   * <p>\n+   * Copy the method from IOUtils of commons-io to reimplement skip by seek\n+   * rather than read. The reason why IOUtils of commons-io implement skip\n+   * by read can be found at\n+   * <a href=\"https://issues.apache.org/jira/browse/IO-203\">IO-203</a>.\n+   * </p>\n+   * <p>\n+   * This method buffers the input internally, so there is no need to use a\n+   * <code>BufferedInputStream</code>.\n+   * </p>\n+   * The buffer size is given by {@link #DEFAULT_BUFFER_SIZE}.\n+   *\n+   * @param output the <code>OutputStream</code> to write to\n+   * @param inputOffset : number of bytes to skip from input before copying\n+   * -ve values are ignored\n+   * @param length : number of bytes to copy. -ve means all\n+   * @return the number of bytes copied\n+   * @throws NullPointerException if the input or output is null\n+   * @throws IOException          if an I/O error occurs\n+   */\n+  public long copyLarge(final OutputStream output, final long inputOffset,\n+      final long length) throws IOException {\n+    return copyLarge(output, inputOffset, length,\n+        new byte[DEFAULT_BUFFER_SIZE]);\n+  }\n+\n+  /**\n+   * Copies some or all bytes from a large (over 2GB) <code>InputStream</code>\n+   * to an <code>OutputStream</code>, optionally skipping input bytes.\n+   * <p>\n+   * Copy the method from IOUtils of commons-io to reimplement skip by seek\n+   * rather than read. The reason why IOUtils of commons-io implement skip\n+   * by read can be found at\n+   * <a href=\"https://issues.apache.org/jira/browse/IO-203\">IO-203</a>.\n+   * </p>\n+   * <p>\n+   * This method uses the provided buffer, so there is no need to use a\n+   * <code>BufferedInputStream</code>.\n+   * </p>\n+   *\n+   * @param output the <code>OutputStream</code> to write to\n+   * @param inputOffset : number of bytes to skip from input before copying\n+   * -ve values are ignored\n+   * @param length : number of bytes to copy. -ve means all", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMTg4Mzg0MQ=="}, "originalCommit": {"oid": "2388d620511404c4de8f99ce8a37e0c411294c8d"}, "originalPosition": 72}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMjQzNzIxOQ==", "bodyText": "Got it.", "url": "https://github.com/apache/ozone/pull/843#discussion_r412437219", "createdAt": "2020-04-21T19:36:42Z", "author": {"login": "bharatviswa504"}, "path": "hadoop-ozone/s3gateway/src/main/java/org/apache/hadoop/ozone/s3/io/S3WrapperInputStream.java", "diffHunk": "@@ -76,4 +79,87 @@ public long getPos() throws IOException {\n   public boolean seekToNewSource(long targetPos) throws IOException {\n     return false;\n   }\n+\n+  /**\n+   * Copies some or all bytes from a large (over 2GB) <code>InputStream</code>\n+   * to an <code>OutputStream</code>, optionally skipping input bytes.\n+   * <p>\n+   * Copy the method from IOUtils of commons-io to reimplement skip by seek\n+   * rather than read. The reason why IOUtils of commons-io implement skip\n+   * by read can be found at\n+   * <a href=\"https://issues.apache.org/jira/browse/IO-203\">IO-203</a>.\n+   * </p>\n+   * <p>\n+   * This method buffers the input internally, so there is no need to use a\n+   * <code>BufferedInputStream</code>.\n+   * </p>\n+   * The buffer size is given by {@link #DEFAULT_BUFFER_SIZE}.\n+   *\n+   * @param output the <code>OutputStream</code> to write to\n+   * @param inputOffset : number of bytes to skip from input before copying\n+   * -ve values are ignored\n+   * @param length : number of bytes to copy. -ve means all\n+   * @return the number of bytes copied\n+   * @throws NullPointerException if the input or output is null\n+   * @throws IOException          if an I/O error occurs\n+   */\n+  public long copyLarge(final OutputStream output, final long inputOffset,\n+      final long length) throws IOException {\n+    return copyLarge(output, inputOffset, length,\n+        new byte[DEFAULT_BUFFER_SIZE]);\n+  }\n+\n+  /**\n+   * Copies some or all bytes from a large (over 2GB) <code>InputStream</code>\n+   * to an <code>OutputStream</code>, optionally skipping input bytes.\n+   * <p>\n+   * Copy the method from IOUtils of commons-io to reimplement skip by seek\n+   * rather than read. The reason why IOUtils of commons-io implement skip\n+   * by read can be found at\n+   * <a href=\"https://issues.apache.org/jira/browse/IO-203\">IO-203</a>.\n+   * </p>\n+   * <p>\n+   * This method uses the provided buffer, so there is no need to use a\n+   * <code>BufferedInputStream</code>.\n+   * </p>\n+   *\n+   * @param output the <code>OutputStream</code> to write to\n+   * @param inputOffset : number of bytes to skip from input before copying\n+   * -ve values are ignored\n+   * @param length : number of bytes to copy. -ve means all", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMTg4Mzg0MQ=="}, "originalCommit": {"oid": "2388d620511404c4de8f99ce8a37e0c411294c8d"}, "originalPosition": 72}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4414, "cost": 1, "resetAt": "2021-11-12T11:57:46Z"}}}