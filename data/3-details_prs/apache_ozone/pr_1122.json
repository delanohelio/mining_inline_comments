{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDM5MTQxNzQ5", "number": 1122, "title": "HDDS-3861. Fix handlePipelineFailure throw exception if role is follower", "bodyText": "What changes were proposed in this pull request?\n\nif role is follower, ozone will throw exception.\n\n\nWhat is the link to the Apache JIRA\nhttps://issues.apache.org/jira/browse/HDDS-3861\nHow was this patch tested?\nExisted tests", "createdAt": "2020-06-24T11:22:28Z", "url": "https://github.com/apache/ozone/pull/1122", "merged": true, "mergeCommit": {"oid": "537172ee2cdb343359082dfc0c23c01068d4f24e"}, "closed": true, "closedAt": "2020-07-14T03:59:03Z", "author": {"login": "runzhiwang"}, "timelineItems": {"totalCount": 7, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcuWTXqAH2gAyNDM5MTQxNzQ5OjgyMjhiYzY0NzlhM2NlYjFhYmFjNGNhYzJjNGVjNjUwOWEwZGY1OTk=", "endCursor": "Y3Vyc29yOnYyOpPPAAABc0t5sEgFqTQ0Nzc2ODE1NA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "8228bc6479a3ceb1abac4cac2c4ec6509a0df599", "author": {"user": {"login": "runzhiwang", "name": null}}, "url": "https://github.com/apache/ozone/commit/8228bc6479a3ceb1abac4cac2c4ec6509a0df599", "committedDate": "2020-06-24T09:05:40Z", "message": "HDDS-3861. Fix handlePipelineFailure throw exception if role is follower"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDM2NzkzOTI4", "url": "https://github.com/apache/ozone/pull/1122#pullrequestreview-436793928", "createdAt": "2020-06-24T16:04:47Z", "commit": {"oid": "8228bc6479a3ceb1abac4cac2c4ec6509a0df599"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDM3NjY3MTk1", "url": "https://github.com/apache/ozone/pull/1122#pullrequestreview-437667195", "createdAt": "2020-06-25T16:34:36Z", "commit": {"oid": "8228bc6479a3ceb1abac4cac2c4ec6509a0df599"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yNVQxNjozNDozNlrOGpCvkg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yNVQxNjozNDozNlrOGpCvkg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NTY4OTc0Ng==", "bodyText": "Can we update the msg accordingly with the reason. The reason precisely was when installSnapshotFromLeader gets invoked on follower, as leader snapshot doesn't contain any data to replay. All the log entries prior to the snapshot might have been purged. So , follower should not try to install snapshot from leader but can close the pipeline here.", "url": "https://github.com/apache/ozone/pull/1122#discussion_r445689746", "createdAt": "2020-06-25T16:34:36Z", "author": {"login": "bshashikant"}, "path": "hadoop-hdds/container-service/src/main/java/org/apache/hadoop/ozone/container/common/transport/server/ratis/XceiverServerRatis.java", "diffHunk": "@@ -552,6 +552,10 @@ private void handlePipelineFailure(RaftGroupId groupId,\n       msg = datanode + \" is in candidate state for \" +\n           roleInfoProto.getCandidateInfo().getLastLeaderElapsedTimeMs() + \"ms\";\n       break;\n+    case FOLLOWER:\n+      msg = datanode + \" is in follower state for \" +", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "8228bc6479a3ceb1abac4cac2c4ec6509a0df599"}, "originalPosition": 5}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "2ea1fa691ce5b8caa79cb01357bd9d3c1e10e59b", "author": {"user": {"login": "runzhiwang", "name": null}}, "url": "https://github.com/apache/ozone/commit/2ea1fa691ce5b8caa79cb01357bd9d3c1e10e59b", "committedDate": "2020-06-26T02:24:20Z", "message": "fix code review"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "6d46a07df2a6ecb3c2874d8ff5ea662e9444fc74", "author": {"user": {"login": "runzhiwang", "name": null}}, "url": "https://github.com/apache/ozone/commit/6d46a07df2a6ecb3c2874d8ff5ea662e9444fc74", "committedDate": "2020-06-26T03:38:10Z", "message": "triger ci"}, "afterCommit": {"oid": "2ea1fa691ce5b8caa79cb01357bd9d3c1e10e59b", "author": {"user": {"login": "runzhiwang", "name": null}}, "url": "https://github.com/apache/ozone/commit/2ea1fa691ce5b8caa79cb01357bd9d3c1e10e59b", "committedDate": "2020-06-26T02:24:20Z", "message": "fix code review"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b4765d2b7770443eb8096d2adb11c2081d4187eb", "author": {"user": {"login": "runzhiwang", "name": null}}, "url": "https://github.com/apache/ozone/commit/b4765d2b7770443eb8096d2adb11c2081d4187eb", "committedDate": "2020-06-26T07:36:02Z", "message": "triger ci"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDQ3NzY4MTU0", "url": "https://github.com/apache/ozone/pull/1122#pullrequestreview-447768154", "createdAt": "2020-07-14T03:58:53Z", "commit": {"oid": "b4765d2b7770443eb8096d2adb11c2081d4187eb"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3017, "cost": 1, "resetAt": "2021-10-28T18:00:02Z"}}}