{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDc2NzU2OTQ0", "number": 1370, "reviewThreads": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wMVQwNDo0NDowM1rOEesqpg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wMVQyMDo1Njo1M1rOEfE7jQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzAwNjI0NTUwOnYy", "diffSide": "RIGHT", "path": "hadoop-ozone/integration-test/src/test/java/org/apache/hadoop/ozone/client/rpc/TestWatchForCommit.java", "isResolved": false, "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wMVQwNDo0NDowM1rOHKhY5g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wMVQwNjo0MTo0MVrOHKmqJg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MDc5NDg1NA==", "bodyText": "This logic looks right to me.\nCan you bump up the number of DN to make tests run against higher number DN: https://github.com/apache/hadoop-ozone/blob/34ee8311b0d0a37878fe1fd2e5d8c1b91aa8cc8f/hadoop-ozone/integration-test/src/test/java/org/apache/hadoop/ozone/client/rpc/Test2WayCommitInRatis.java#L109\nWhich seems will cover your change?", "url": "https://github.com/apache/ozone/pull/1370#discussion_r480794854", "createdAt": "2020-09-01T04:44:03Z", "author": {"login": "amaliujia"}, "path": "hadoop-ozone/integration-test/src/test/java/org/apache/hadoop/ozone/client/rpc/TestWatchForCommit.java", "diffHunk": "@@ -297,9 +298,11 @@ public void test2WayCommitForTimeoutException() throws Exception {\n             xceiverClient.getPipeline()));\n     reply.getResponse().get();\n     Assert.assertEquals(3, ratisClient.getCommitInfoMap().size());\n+    List<DatanodeDetails> datanodeDetails = pipeline.getNodes();\n     for (HddsDatanodeService dn : cluster.getHddsDatanodes()) {\n       // shutdown the ratis follower\n-      if (ContainerTestHelper.isRatisFollower(dn, pipeline)) {\n+      if (datanodeDetails.contains(dn.getDatanodeDetails())\n+          && ContainerTestHelper.isRatisFollower(dn, pipeline)) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e9d0ddc89ae1f4c1f8088cade45d7a7705b272a8"}, "originalPosition": 17}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MDgzMTE4Ng==", "bodyText": "@amaliujia Thanks for your review. TestWatchForCommit already startCluster with 9 nodes, maybe it is enough.\nhttps://github.com/apache/hadoop-ozone/blob/master/hadoop-ozone/integration-test/src/test/java/org/apache/hadoop/ozone/client/rpc/TestWatchForCommit.java#L124", "url": "https://github.com/apache/ozone/pull/1370#discussion_r480831186", "createdAt": "2020-09-01T05:27:22Z", "author": {"login": "runzhiwang"}, "path": "hadoop-ozone/integration-test/src/test/java/org/apache/hadoop/ozone/client/rpc/TestWatchForCommit.java", "diffHunk": "@@ -297,9 +298,11 @@ public void test2WayCommitForTimeoutException() throws Exception {\n             xceiverClient.getPipeline()));\n     reply.getResponse().get();\n     Assert.assertEquals(3, ratisClient.getCommitInfoMap().size());\n+    List<DatanodeDetails> datanodeDetails = pipeline.getNodes();\n     for (HddsDatanodeService dn : cluster.getHddsDatanodes()) {\n       // shutdown the ratis follower\n-      if (ContainerTestHelper.isRatisFollower(dn, pipeline)) {\n+      if (datanodeDetails.contains(dn.getDatanodeDetails())\n+          && ContainerTestHelper.isRatisFollower(dn, pipeline)) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MDc5NDg1NA=="}, "originalCommit": {"oid": "e9d0ddc89ae1f4c1f8088cade45d7a7705b272a8"}, "originalPosition": 17}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MDg4MTE5MA==", "bodyText": "Oops. You are right. I was looking at a wrong file.", "url": "https://github.com/apache/ozone/pull/1370#discussion_r480881190", "createdAt": "2020-09-01T06:41:41Z", "author": {"login": "amaliujia"}, "path": "hadoop-ozone/integration-test/src/test/java/org/apache/hadoop/ozone/client/rpc/TestWatchForCommit.java", "diffHunk": "@@ -297,9 +298,11 @@ public void test2WayCommitForTimeoutException() throws Exception {\n             xceiverClient.getPipeline()));\n     reply.getResponse().get();\n     Assert.assertEquals(3, ratisClient.getCommitInfoMap().size());\n+    List<DatanodeDetails> datanodeDetails = pipeline.getNodes();\n     for (HddsDatanodeService dn : cluster.getHddsDatanodes()) {\n       // shutdown the ratis follower\n-      if (ContainerTestHelper.isRatisFollower(dn, pipeline)) {\n+      if (datanodeDetails.contains(dn.getDatanodeDetails())\n+          && ContainerTestHelper.isRatisFollower(dn, pipeline)) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MDc5NDg1NA=="}, "originalCommit": {"oid": "e9d0ddc89ae1f4c1f8088cade45d7a7705b272a8"}, "originalPosition": 17}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzAxMDIyMDkzOnYy", "diffSide": "RIGHT", "path": "hadoop-ozone/integration-test/src/test/java/org/apache/hadoop/ozone/client/rpc/TestWatchForCommit.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wMVQyMDo1Njo1M1rOHLH8Sg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wMVQyMzo0Nzo1M1rOHLMAoA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MTQyNjUwNg==", "bodyText": "Nit: nodesInPipeline may be a better name.", "url": "https://github.com/apache/ozone/pull/1370#discussion_r481426506", "createdAt": "2020-09-01T20:56:53Z", "author": {"login": "adoroszlai"}, "path": "hadoop-ozone/integration-test/src/test/java/org/apache/hadoop/ozone/client/rpc/TestWatchForCommit.java", "diffHunk": "@@ -297,9 +298,11 @@ public void test2WayCommitForTimeoutException() throws Exception {\n             xceiverClient.getPipeline()));\n     reply.getResponse().get();\n     Assert.assertEquals(3, ratisClient.getCommitInfoMap().size());\n+    List<DatanodeDetails> datanodeDetails = pipeline.getNodes();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e9d0ddc89ae1f4c1f8088cade45d7a7705b272a8"}, "originalPosition": 12}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MTQ5MzE1Mg==", "bodyText": "@adoroszlai Thanks for review. I have updated the patch.", "url": "https://github.com/apache/ozone/pull/1370#discussion_r481493152", "createdAt": "2020-09-01T23:47:53Z", "author": {"login": "runzhiwang"}, "path": "hadoop-ozone/integration-test/src/test/java/org/apache/hadoop/ozone/client/rpc/TestWatchForCommit.java", "diffHunk": "@@ -297,9 +298,11 @@ public void test2WayCommitForTimeoutException() throws Exception {\n             xceiverClient.getPipeline()));\n     reply.getResponse().get();\n     Assert.assertEquals(3, ratisClient.getCommitInfoMap().size());\n+    List<DatanodeDetails> datanodeDetails = pipeline.getNodes();", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MTQyNjUwNg=="}, "originalCommit": {"oid": "e9d0ddc89ae1f4c1f8088cade45d7a7705b272a8"}, "originalPosition": 12}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4812, "cost": 1, "resetAt": "2021-11-11T21:28:48Z"}}}