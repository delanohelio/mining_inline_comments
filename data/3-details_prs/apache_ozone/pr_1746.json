{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTQ2ODMyMDU5", "number": 1746, "title": "HDDS-4631. Fix client set quota with 0.", "bodyText": "What changes were proposed in this pull request?\nCurrently setting Quota is invalid if set to 0. It's actually going to be set to -1.\nstore.getVolume(volumeName).getBucket(bucketName).setQuota(\n       OzoneQuota.parseQuota(\"0GB\", 0));\n  Assert.assertEquals(-1, bucket.getQuotaInBytes());\n  Assert.assertEquals(-1, bucket.getQuotaInNamespace());\nThis behavior is actually incorrect, and In general setting quota to 0 isn't a valid entry even in HDFS.  we can be consistent with HDFS on this part.\njava.lang.IllegalArgumentException: Invalid values for quota : 0 \nBecause the original client quota type is long. If the user does not specify quota, the default value for this field is 0.\nWe cannot verify that the user did not specify quota or set quoat to 0, since both actions are passed to the backend to be 0.\nSo it would be more appropriate to change the long to a string. If the user does not specify quota, it is null. It's easier to judge.\nWhat is the link to the Apache JIRA\nhttps://issues.apache.org/jira/browse/HDDS-4631\nHow was this patch tested?\nut added", "createdAt": "2020-12-30T07:28:23Z", "url": "https://github.com/apache/ozone/pull/1746", "merged": true, "mergeCommit": {"oid": "60bf99216ee13d08130d48ec3a92689ca81ef1fa"}, "closed": true, "closedAt": "2021-01-18T03:01:11Z", "author": {"login": "captainzmc"}, "timelineItems": {"totalCount": 31, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdrLP1nAFqTU1OTk1NjAwMA==", "endCursor": "Y3Vyc29yOnYyOpPPAAABdwUJ3wgH2gAyNTQ2ODMyMDU5OjIyMzI2Yjk5MmQzN2Y0ZDZkOThlYjBkZjZiNzliOWU5ZDgyYmViMTI=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTU5OTU2MDAw", "url": "https://github.com/apache/ozone/pull/1746#pullrequestreview-559956000", "createdAt": "2020-12-30T08:42:14Z", "commit": {"oid": "e9113e6bf5bffdf7fb0020ebafb169f9ac2a92be"}, "state": "COMMENTED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTYwMDk4Mjcw", "url": "https://github.com/apache/ozone/pull/1746#pullrequestreview-560098270", "createdAt": "2020-12-30T15:41:40Z", "commit": {"oid": "bdaed0c5504ed04174ec5d6494eb180327e8f9b9"}, "state": "COMMENTED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTYwMjY3NjY2", "url": "https://github.com/apache/ozone/pull/1746#pullrequestreview-560267666", "createdAt": "2020-12-31T05:45:18Z", "commit": {"oid": "bdaed0c5504ed04174ec5d6494eb180327e8f9b9"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0zMVQwNTo0NToxOFrOIM555w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0zMVQwNTo0NToxOFrOIM555w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1MDQwMjUzNQ==", "bodyText": "Question: how to set QUOTA.RESET? (basically how to disable quota by set the quota). In the past I guess we can set -2 but now it seems disallowed.\nFor example, is there a case that a bucket is enabled quota, later users decide to disable the quota by setting a quota value?", "url": "https://github.com/apache/ozone/pull/1746#discussion_r550402535", "createdAt": "2020-12-31T05:45:18Z", "author": {"login": "amaliujia"}, "path": "hadoop-hdds/common/src/main/java/org/apache/hadoop/hdds/client/OzoneQuota.java", "diffHunk": "@@ -190,14 +201,44 @@ public static OzoneQuota parseQuota(String quotaInBytes,\n           \" value cannot be greater than Long.MAX_VALUE BYTES\");\n     }\n \n-    if (nSize < 0) {\n-      throw new IllegalArgumentException(\"Quota cannot be negative.\");\n+    if (nSize <= 0) {\n+      throw new IllegalArgumentException(\"Invalid values for quota: \" + nSize);\n     }\n \n-    return new OzoneQuota(quotaInNamespace,\n-        new RawQuotaInBytes(currUnit, nSize));\n+    return new OzoneQuota(new RawQuotaInBytes(currUnit, nSize));\n   }\n \n+  /**\n+   * Parses a user provided string Namespace quota and returns the\n+   * Quota Object.\n+   *\n+   * @param quotaInNamespace Volume quota in counts\n+   *\n+   * @return OzoneQuota object\n+   */\n+  public static OzoneQuota parseNameSpaceQuota(String quotaInNamespace) {\n+    long nameSpaceQuota = Long.parseLong(quotaInNamespace);\n+    if (nameSpaceQuota <= 0) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "bdaed0c5504ed04174ec5d6494eb180327e8f9b9"}, "originalPosition": 83}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTY1NDY4OTg0", "url": "https://github.com/apache/ozone/pull/1746#pullrequestreview-565468984", "createdAt": "2021-01-11T15:36:11Z", "commit": {"oid": "e5c28c8d87cc63c87865e3ec880be81a89d68b08"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMS0xMVQxNTozNjoxMVrOIRalvg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMS0xMVQxNTozNjoxMVrOIRalvg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1NTEzMjM1MA==", "bodyText": "@captainzmc \uff0c can we rollback long to string convert for namspace quota now? As default quota 0 will all be converted to Quota.RESET based on above approach that we discussed. Or we can create a new PR for this.", "url": "https://github.com/apache/ozone/pull/1746#discussion_r555132350", "createdAt": "2021-01-11T15:36:11Z", "author": {"login": "linyiqun"}, "path": "hadoop-hdds/common/src/main/java/org/apache/hadoop/hdds/client/OzoneQuota.java", "diffHunk": "@@ -190,14 +201,44 @@ public static OzoneQuota parseQuota(String quotaInBytes,\n           \" value cannot be greater than Long.MAX_VALUE BYTES\");\n     }\n \n-    if (nSize < 0) {\n-      throw new IllegalArgumentException(\"Quota cannot be negative.\");\n+    if (nSize <= 0) {\n+      throw new IllegalArgumentException(\"Invalid values for quota: \" + nSize);\n     }\n \n-    return new OzoneQuota(quotaInNamespace,\n-        new RawQuotaInBytes(currUnit, nSize));\n+    return new OzoneQuota(new RawQuotaInBytes(currUnit, nSize));\n   }\n \n+  /**\n+   * Parses a user provided string Namespace quota and returns the\n+   * Quota Object.\n+   *\n+   * @param quotaInNamespace Volume quota in counts\n+   *\n+   * @return OzoneQuota object\n+   */\n+  public static OzoneQuota parseNameSpaceQuota(String quotaInNamespace) {\n+    long nameSpaceQuota = Long.parseLong(quotaInNamespace);\n+    if (nameSpaceQuota <= 0) {\n+      throw new IllegalArgumentException(\n+          \"Invalid values for quota: \" + nameSpaceQuota);\n+    }\n+    return new OzoneQuota(nameSpaceQuota, new RawQuotaInBytes(Units.BYTES, -1));\n+  }\n+\n+  /**\n+   * Parses a user provided string and returns the\n+   * Quota Object.\n+   *\n+   * @param quotaInBytes Volume quota in bytes\n+   * @param quotaInNamespace Volume quota in counts\n+   *\n+   * @return OzoneQuota object\n+   */\n+  public static OzoneQuota parseQuota(String quotaInBytes,\n+      String quotaInNamespace) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e5c28c8d87cc63c87865e3ec880be81a89d68b08"}, "originalPosition": 100}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "6a5745803da095ac808c2acb1edd1a59e26b4826", "author": {"user": {"login": "captainzmc", "name": "micah zhao"}}, "url": "https://github.com/apache/ozone/commit/6a5745803da095ac808c2acb1edd1a59e26b4826", "committedDate": "2021-01-12T04:09:30Z", "message": "Add more comprehensive UT"}, "afterCommit": {"oid": "87fecf929f0dbf444ff98bb24f0f2c52bdc8a7b6", "author": {"user": {"login": "captainzmc", "name": "micah zhao"}}, "url": "https://github.com/apache/ozone/commit/87fecf929f0dbf444ff98bb24f0f2c52bdc8a7b6", "committedDate": "2021-01-12T05:02:07Z", "message": "Add more comprehensive UT"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "87fecf929f0dbf444ff98bb24f0f2c52bdc8a7b6", "author": {"user": {"login": "captainzmc", "name": "micah zhao"}}, "url": "https://github.com/apache/ozone/commit/87fecf929f0dbf444ff98bb24f0f2c52bdc8a7b6", "committedDate": "2021-01-12T05:02:07Z", "message": "Add more comprehensive UT"}, "afterCommit": {"oid": "363f3923a91067bd7f1875bdf99b32f5db4cbcbb", "author": {"user": {"login": "captainzmc", "name": "micah zhao"}}, "url": "https://github.com/apache/ozone/commit/363f3923a91067bd7f1875bdf99b32f5db4cbcbb", "committedDate": "2021-01-12T08:31:24Z", "message": "rabase master and add more comprehensive UT"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTY4MjEyMzI1", "url": "https://github.com/apache/ozone/pull/1746#pullrequestreview-568212325", "createdAt": "2021-01-14T13:04:40Z", "commit": {"oid": "363f3923a91067bd7f1875bdf99b32f5db4cbcbb"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMS0xNFQxMzowNDo0MFrOITjwsg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMS0xNFQxMzowNDo0MFrOITjwsg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1NzM3OTc2Mg==", "bodyText": "Shall we keep this null check or add new Precondition check that quotaInBytes cannot be null or empty.\nThis suggestion also applies to parseNameSpaceQuota.\nBecause these two functions are public static, we need to do some kind of parameter check.", "url": "https://github.com/apache/ozone/pull/1746#discussion_r557379762", "createdAt": "2021-01-14T13:04:40Z", "author": {"login": "ChenSammi"}, "path": "hadoop-hdds/common/src/main/java/org/apache/hadoop/hdds/client/OzoneQuota.java", "diffHunk": "@@ -145,21 +163,14 @@ public static String formatQuota(OzoneQuota quota) {\n   }\n \n   /**\n-   * Parses a user provided string and returns the\n+   * Parses a user provided string space quota and returns the\n    * Quota Object.\n    *\n    * @param quotaInBytes Volume quota in bytes\n-   * @param quotaInNamespace Volume quota in counts\n    *\n    * @return OzoneQuota object\n    */\n-  public static OzoneQuota parseQuota(String quotaInBytes,\n-      long quotaInNamespace) {\n-\n-    if (Strings.isNullOrEmpty(quotaInBytes)) {\n-      throw new IllegalArgumentException(\n-          \"Quota string cannot be null or empty.\");\n-    }", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "363f3923a91067bd7f1875bdf99b32f5db4cbcbb"}, "originalPosition": 53}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTY4MjI5NjY1", "url": "https://github.com/apache/ozone/pull/1746#pullrequestreview-568229665", "createdAt": "2021-01-14T13:26:53Z", "commit": {"oid": "363f3923a91067bd7f1875bdf99b32f5db4cbcbb"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMS0xNFQxMzoyNjo1M1rOITkkCA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMS0xNFQxMzoyNjo1M1rOITkkCA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1NzM5MjkwNA==", "bodyText": "With default quotaInBytes and quotaInNamespace value, do we still need this and below else statement?", "url": "https://github.com/apache/ozone/pull/1746#discussion_r557392904", "createdAt": "2021-01-14T13:26:53Z", "author": {"login": "ChenSammi"}, "path": "hadoop-ozone/tools/src/main/java/org/apache/hadoop/ozone/shell/volume/CreateVolumeHandler.java", "diffHunk": "@@ -59,13 +61,19 @@ protected void execute(OzoneClient client, OzoneAddress address)\n     VolumeArgs.Builder volumeArgsBuilder = VolumeArgs.newBuilder()\n         .setAdmin(adminName)\n         .setOwner(ownerName);\n-    if (quotaOptions.getQuotaInBytes() != null) {\n-      volumeArgsBuilder.setQuotaInBytes(OzoneQuota.parseQuota(\n-          quotaOptions.getQuotaInBytes(),\n-          quotaOptions.getQuotaInNamespace()).getQuotaInBytes());\n+    if (!Strings.isNullOrEmpty(quotaOptions.getQuotaInBytes())) {\n+      volumeArgsBuilder.setQuotaInBytes(OzoneQuota.parseSpaceQuota(\n+          quotaOptions.getQuotaInBytes()).getQuotaInBytes());\n+    } else {\n+      volumeArgsBuilder.setQuotaInBytes(OzoneConsts.QUOTA_RESET);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "363f3923a91067bd7f1875bdf99b32f5db4cbcbb"}, "originalPosition": 22}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTY4MjMwMTE3", "url": "https://github.com/apache/ozone/pull/1746#pullrequestreview-568230117", "createdAt": "2021-01-14T13:27:28Z", "commit": {"oid": "363f3923a91067bd7f1875bdf99b32f5db4cbcbb"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMS0xNFQxMzoyNzoyOFrOITklZg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMS0xNFQxMzoyNzoyOFrOITklZg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1NzM5MzI1NA==", "bodyText": "Same as below comment.", "url": "https://github.com/apache/ozone/pull/1746#discussion_r557393254", "createdAt": "2021-01-14T13:27:28Z", "author": {"login": "ChenSammi"}, "path": "hadoop-ozone/tools/src/main/java/org/apache/hadoop/ozone/shell/bucket/CreateBucketHandler.java", "diffHunk": "@@ -80,12 +81,19 @@ public void execute(OzoneClient client, OzoneAddress address)\n       }\n     }\n \n-    if (quotaOptions.getQuotaInBytes() != null) {\n-      bb.setQuotaInBytes(OzoneQuota.parseQuota(quotaOptions.getQuotaInBytes(),\n-          quotaOptions.getQuotaInNamespace()).getQuotaInBytes());\n+    if (!Strings.isNullOrEmpty(quotaOptions.getQuotaInBytes())) {\n+      bb.setQuotaInBytes(OzoneQuota.parseSpaceQuota(\n+          quotaOptions.getQuotaInBytes()).getQuotaInBytes());\n+    } else {\n+      bb.setQuotaInBytes(OzoneConsts.QUOTA_RESET);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "363f3923a91067bd7f1875bdf99b32f5db4cbcbb"}, "originalPosition": 19}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTY4MjM2OTgw", "url": "https://github.com/apache/ozone/pull/1746#pullrequestreview-568236980", "createdAt": "2021-01-14T13:36:07Z", "commit": {"oid": "363f3923a91067bd7f1875bdf99b32f5db4cbcbb"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMS0xNFQxMzozNjowN1rOITk7Ig==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMS0xNFQxMzozNjowN1rOITk7Ig==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1NzM5ODgxOA==", "bodyText": "(volumeQuotaInBytes < OzoneConsts.QUOTA_RESET || volumeQuotaInBytes == 0) ?", "url": "https://github.com/apache/ozone/pull/1746#discussion_r557398818", "createdAt": "2021-01-14T13:36:07Z", "author": {"login": "ChenSammi"}, "path": "hadoop-ozone/ozone-manager/src/main/java/org/apache/hadoop/ozone/om/request/volume/OMVolumeSetQuotaRequest.java", "diffHunk": "@@ -189,7 +189,7 @@ public boolean checkQuotaBytesValid(OMMetadataManager metadataManager,\n       long volumeQuotaInBytes, String volumeName) throws IOException {\n     long totalBucketQuota = 0;\n \n-    if (volumeQuotaInBytes == 0) {\n+    if (volumeQuotaInBytes < OzoneConsts.QUOTA_RESET) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "363f3923a91067bd7f1875bdf99b32f5db4cbcbb"}, "originalPosition": 5}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTY4MjM3MjQ2", "url": "https://github.com/apache/ozone/pull/1746#pullrequestreview-568237246", "createdAt": "2021-01-14T13:36:27Z", "commit": {"oid": "363f3923a91067bd7f1875bdf99b32f5db4cbcbb"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMS0xNFQxMzozNjoyN1rOITk76g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMS0xNFQxMzozNjoyN1rOITk76g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1NzM5OTAxOA==", "bodyText": "Same question as as above comment.", "url": "https://github.com/apache/ozone/pull/1746#discussion_r557399018", "createdAt": "2021-01-14T13:36:27Z", "author": {"login": "ChenSammi"}, "path": "hadoop-ozone/ozone-manager/src/main/java/org/apache/hadoop/ozone/om/request/volume/OMVolumeSetQuotaRequest.java", "diffHunk": "@@ -213,8 +213,7 @@ public boolean checkQuotaBytesValid(OMMetadataManager metadataManager,\n \n   public boolean checkQuotaNamespaceValid(long quotaInNamespace) {\n \n-    if ((quotaInNamespace <= 0\n-         && quotaInNamespace != OzoneConsts.QUOTA_RESET)) {\n+    if (quotaInNamespace < OzoneConsts.QUOTA_RESET) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "363f3923a91067bd7f1875bdf99b32f5db4cbcbb"}, "originalPosition": 15}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "2165b9b20bb761b404456651d713e08f009fb910", "author": {"user": {"login": "captainzmc", "name": "micah zhao"}}, "url": "https://github.com/apache/ozone/commit/2165b9b20bb761b404456651d713e08f009fb910", "committedDate": "2021-01-14T14:15:40Z", "message": "fix review issues"}, "afterCommit": {"oid": "dfb3d14a8ae65a7a14999b1626222f715aa8df76", "author": {"user": {"login": "captainzmc", "name": "micah zhao"}}, "url": "https://github.com/apache/ozone/commit/dfb3d14a8ae65a7a14999b1626222f715aa8df76", "committedDate": "2021-01-14T14:46:29Z", "message": "fix review issues"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTY4MzM1NjQ3", "url": "https://github.com/apache/ozone/pull/1746#pullrequestreview-568335647", "createdAt": "2021-01-14T15:18:46Z", "commit": {"oid": "dfb3d14a8ae65a7a14999b1626222f715aa8df76"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMS0xNFQxNToxODo0NlrOITpbFw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMS0xNFQxNToxODo0NlrOITpbFw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1NzQ3MjUzNQ==", "bodyText": "Can you update quota to 'space quota' that will be more accurate for this exception?", "url": "https://github.com/apache/ozone/pull/1746#discussion_r557472535", "createdAt": "2021-01-14T15:18:46Z", "author": {"login": "linyiqun"}, "path": "hadoop-hdds/common/src/main/java/org/apache/hadoop/hdds/client/OzoneQuota.java", "diffHunk": "@@ -190,14 +207,48 @@ public static OzoneQuota parseQuota(String quotaInBytes,\n           \" value cannot be greater than Long.MAX_VALUE BYTES\");\n     }\n \n-    if (nSize < 0) {\n-      throw new IllegalArgumentException(\"Quota cannot be negative.\");\n+    if (nSize <= 0) {\n+      throw new IllegalArgumentException(\"Invalid values for quota: \" + nSize);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "dfb3d14a8ae65a7a14999b1626222f715aa8df76"}, "originalPosition": 52}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTY4MzM2ODQy", "url": "https://github.com/apache/ozone/pull/1746#pullrequestreview-568336842", "createdAt": "2021-01-14T15:19:54Z", "commit": {"oid": "dfb3d14a8ae65a7a14999b1626222f715aa8df76"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMS0xNFQxNToxOTo1NFrOITpelQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMS0xNFQxNToxOTo1NFrOITpelQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1NzQ3MzQyOQ==", "bodyText": "Similar comment: quota to namespace quota.", "url": "https://github.com/apache/ozone/pull/1746#discussion_r557473429", "createdAt": "2021-01-14T15:19:54Z", "author": {"login": "linyiqun"}, "path": "hadoop-hdds/common/src/main/java/org/apache/hadoop/hdds/client/OzoneQuota.java", "diffHunk": "@@ -190,14 +207,48 @@ public static OzoneQuota parseQuota(String quotaInBytes,\n           \" value cannot be greater than Long.MAX_VALUE BYTES\");\n     }\n \n-    if (nSize < 0) {\n-      throw new IllegalArgumentException(\"Quota cannot be negative.\");\n+    if (nSize <= 0) {\n+      throw new IllegalArgumentException(\"Invalid values for quota: \" + nSize);\n     }\n \n-    return new OzoneQuota(quotaInNamespace,\n-        new RawQuotaInBytes(currUnit, nSize));\n+    return new OzoneQuota(new RawQuotaInBytes(currUnit, nSize));\n   }\n \n+  /**\n+   * Parses a user provided string Namespace quota and returns the\n+   * Quota Object.\n+   *\n+   * @param quotaInNamespace Volume quota in counts\n+   *\n+   * @return OzoneQuota object\n+   */\n+  public static OzoneQuota parseNameSpaceQuota(String quotaInNamespace) {\n+    if (Strings.isNullOrEmpty(quotaInNamespace)) {\n+      throw new IllegalArgumentException(\n+          \"Quota string cannot be null or empty.\");\n+    }\n+    long nameSpaceQuota = Long.parseLong(quotaInNamespace);\n+    if (nameSpaceQuota <= 0) {\n+      throw new IllegalArgumentException(\n+          \"Invalid values for quota: \" + nameSpaceQuota);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "dfb3d14a8ae65a7a14999b1626222f715aa8df76"}, "originalPosition": 76}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTY4MzM5MDYy", "url": "https://github.com/apache/ozone/pull/1746#pullrequestreview-568339062", "createdAt": "2021-01-14T15:22:02Z", "commit": {"oid": "dfb3d14a8ae65a7a14999b1626222f715aa8df76"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMS0xNFQxNToyMjowMlrOITpkrA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMS0xNFQxNToyMjowMlrOITpkrA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1NzQ3NDk4OA==", "bodyText": "Seems this should be updated to quotaInBytes < OzoneConsts.QUOTA_RESET || quotaInBytes == 0 as well.", "url": "https://github.com/apache/ozone/pull/1746#discussion_r557474988", "createdAt": "2021-01-14T15:22:02Z", "author": {"login": "linyiqun"}, "path": "hadoop-ozone/ozone-manager/src/main/java/org/apache/hadoop/ozone/om/request/bucket/OMBucketSetPropertyRequest.java", "diffHunk": "@@ -239,7 +239,7 @@ public boolean checkQuotaBytesValid(OMMetadataManager metadataManager,\n           OMException.ResultCodes.QUOTA_ERROR);\n     }\n \n-    if (quotaInBytes == 0) {\n+    if (quotaInBytes < OzoneConsts.QUOTA_RESET) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "dfb3d14a8ae65a7a14999b1626222f715aa8df76"}, "originalPosition": 5}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTY4MzM5NDk5", "url": "https://github.com/apache/ozone/pull/1746#pullrequestreview-568339499", "createdAt": "2021-01-14T15:22:27Z", "commit": {"oid": "dfb3d14a8ae65a7a14999b1626222f715aa8df76"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMS0xNFQxNToyMjoyN1rOITpl-w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMS0xNFQxNToyMjoyN1rOITpl-w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1NzQ3NTMyMw==", "bodyText": "Same comment for this.", "url": "https://github.com/apache/ozone/pull/1746#discussion_r557475323", "createdAt": "2021-01-14T15:22:27Z", "author": {"login": "linyiqun"}, "path": "hadoop-ozone/ozone-manager/src/main/java/org/apache/hadoop/ozone/om/request/bucket/OMBucketSetPropertyRequest.java", "diffHunk": "@@ -273,8 +273,7 @@ public boolean checkQuotaNamespaceValid(OmVolumeArgs omVolumeArgs,\n       OmBucketArgs omBucketArgs) {\n     long quotaInNamespace = omBucketArgs.getQuotaInNamespace();\n \n-    if ((quotaInNamespace <= 0\n-         && quotaInNamespace != OzoneConsts.QUOTA_RESET)) {\n+    if (quotaInNamespace < OzoneConsts.QUOTA_RESET) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "dfb3d14a8ae65a7a14999b1626222f715aa8df76"}, "originalPosition": 15}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "628e81233c411180f884db57b1d60ec6670a2afa", "author": {"user": {"login": "captainzmc", "name": "micah zhao"}}, "url": "https://github.com/apache/ozone/commit/628e81233c411180f884db57b1d60ec6670a2afa", "committedDate": "2021-01-15T02:41:33Z", "message": "Fixed client set quota with 0."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "32ce8345f0a0366a3517e002bfa419e4f650c8a5", "author": {"user": {"login": "captainzmc", "name": "micah zhao"}}, "url": "https://github.com/apache/ozone/commit/32ce8345f0a0366a3517e002bfa419e4f650c8a5", "committedDate": "2021-01-15T02:41:33Z", "message": "fix style"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "03d7c7cb75113689838a15270da3c428d20e8053", "author": {"user": {"login": "captainzmc", "name": "micah zhao"}}, "url": "https://github.com/apache/ozone/commit/03d7c7cb75113689838a15270da3c428d20e8053", "committedDate": "2021-01-15T02:41:33Z", "message": "quota 0 should be invalid value."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "830bcaec66cf283d700d4043601ac74e59ddcb04", "author": {"user": {"login": "captainzmc", "name": "micah zhao"}}, "url": "https://github.com/apache/ozone/commit/830bcaec66cf283d700d4043601ac74e59ddcb04", "committedDate": "2021-01-15T02:41:33Z", "message": "fix style."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "66251e1a952c849a54560188727c888fa9ac1dd8", "author": {"user": {"login": "captainzmc", "name": "micah zhao"}}, "url": "https://github.com/apache/ozone/commit/66251e1a952c849a54560188727c888fa9ac1dd8", "committedDate": "2021-01-15T02:41:33Z", "message": "Fix review issues and fix bugs when create volume and bucket."}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "31f5b7e11d956371d1646d9cb53039881f35fc72", "author": {"user": {"login": "captainzmc", "name": "micah zhao"}}, "url": "https://github.com/apache/ozone/commit/31f5b7e11d956371d1646d9cb53039881f35fc72", "committedDate": "2021-01-15T02:25:45Z", "message": "fix review issues"}, "afterCommit": {"oid": "876e01a53912fa69405188a66ec99fb73c5164ad", "author": {"user": {"login": "captainzmc", "name": "micah zhao"}}, "url": "https://github.com/apache/ozone/commit/876e01a53912fa69405188a66ec99fb73c5164ad", "committedDate": "2021-01-15T02:42:00Z", "message": "fix review issues"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "6904fd0cd2c3d322c6a4303250e401d2c10f71c4", "author": {"user": {"login": "captainzmc", "name": "micah zhao"}}, "url": "https://github.com/apache/ozone/commit/6904fd0cd2c3d322c6a4303250e401d2c10f71c4", "committedDate": "2021-01-15T02:42:00Z", "message": "rabase master and add more comprehensive UT"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "fe322608be45fc91fc5fcdb00b06e725d49eb1d3", "author": {"user": {"login": "captainzmc", "name": "micah zhao"}}, "url": "https://github.com/apache/ozone/commit/fe322608be45fc91fc5fcdb00b06e725d49eb1d3", "committedDate": "2021-01-15T02:42:00Z", "message": "fix review issues"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "876e01a53912fa69405188a66ec99fb73c5164ad", "author": {"user": {"login": "captainzmc", "name": "micah zhao"}}, "url": "https://github.com/apache/ozone/commit/876e01a53912fa69405188a66ec99fb73c5164ad", "committedDate": "2021-01-15T02:42:00Z", "message": "fix review issues"}, "afterCommit": {"oid": "20c54b21641ab85a2f792bab12c2279668f8bf6c", "author": {"user": {"login": "captainzmc", "name": "micah zhao"}}, "url": "https://github.com/apache/ozone/commit/20c54b21641ab85a2f792bab12c2279668f8bf6c", "committedDate": "2021-01-15T02:49:36Z", "message": "fix review issues"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "20c54b21641ab85a2f792bab12c2279668f8bf6c", "author": {"user": {"login": "captainzmc", "name": "micah zhao"}}, "url": "https://github.com/apache/ozone/commit/20c54b21641ab85a2f792bab12c2279668f8bf6c", "committedDate": "2021-01-15T02:49:36Z", "message": "fix review issues"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTY4Nzg2NzM2", "url": "https://github.com/apache/ozone/pull/1746#pullrequestreview-568786736", "createdAt": "2021-01-15T03:07:37Z", "commit": {"oid": "20c54b21641ab85a2f792bab12c2279668f8bf6c"}, "state": "COMMENTED", "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMS0xNVQwMzowNzozN1rOIT_hCA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMS0xNVQwMzowODoxNFrOIT_h-Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1NzgzNDUwNA==", "bodyText": "volume quota should be ozone quota since this quota can also the bucket quota", "url": "https://github.com/apache/ozone/pull/1746#discussion_r557834504", "createdAt": "2021-01-15T03:07:37Z", "author": {"login": "linyiqun"}, "path": "hadoop-hdds/common/src/main/java/org/apache/hadoop/hdds/client/OzoneQuota.java", "diffHunk": "@@ -145,16 +164,14 @@ public static String formatQuota(OzoneQuota quota) {\n   }\n \n   /**\n-   * Parses a user provided string and returns the\n+   * Parses a user provided string space quota and returns the\n    * Quota Object.\n    *\n    * @param quotaInBytes Volume quota in bytes", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "20c54b21641ab85a2f792bab12c2279668f8bf6c"}, "originalPosition": 34}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1NzgzNDYxNA==", "bodyText": "Same comment as above.", "url": "https://github.com/apache/ozone/pull/1746#discussion_r557834614", "createdAt": "2021-01-15T03:07:56Z", "author": {"login": "linyiqun"}, "path": "hadoop-hdds/common/src/main/java/org/apache/hadoop/hdds/client/OzoneQuota.java", "diffHunk": "@@ -190,14 +207,49 @@ public static OzoneQuota parseQuota(String quotaInBytes,\n           \" value cannot be greater than Long.MAX_VALUE BYTES\");\n     }\n \n-    if (nSize < 0) {\n-      throw new IllegalArgumentException(\"Quota cannot be negative.\");\n+    if (nSize <= 0) {\n+      throw new IllegalArgumentException(\"Invalid values for space quota: \"\n+          + nSize);\n     }\n \n-    return new OzoneQuota(quotaInNamespace,\n-        new RawQuotaInBytes(currUnit, nSize));\n+    return new OzoneQuota(new RawQuotaInBytes(currUnit, nSize));\n   }\n \n+  /**\n+   * Parses a user provided string Namespace quota and returns the\n+   * Quota Object.\n+   *\n+   * @param quotaInNamespace Volume quota in counts", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "20c54b21641ab85a2f792bab12c2279668f8bf6c"}, "originalPosition": 65}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1NzgzNDc0NQ==", "bodyText": "Same comment as above.", "url": "https://github.com/apache/ozone/pull/1746#discussion_r557834745", "createdAt": "2021-01-15T03:08:14Z", "author": {"login": "linyiqun"}, "path": "hadoop-hdds/common/src/main/java/org/apache/hadoop/hdds/client/OzoneQuota.java", "diffHunk": "@@ -190,14 +207,49 @@ public static OzoneQuota parseQuota(String quotaInBytes,\n           \" value cannot be greater than Long.MAX_VALUE BYTES\");\n     }\n \n-    if (nSize < 0) {\n-      throw new IllegalArgumentException(\"Quota cannot be negative.\");\n+    if (nSize <= 0) {\n+      throw new IllegalArgumentException(\"Invalid values for space quota: \"\n+          + nSize);\n     }\n \n-    return new OzoneQuota(quotaInNamespace,\n-        new RawQuotaInBytes(currUnit, nSize));\n+    return new OzoneQuota(new RawQuotaInBytes(currUnit, nSize));\n   }\n \n+  /**\n+   * Parses a user provided string Namespace quota and returns the\n+   * Quota Object.\n+   *\n+   * @param quotaInNamespace Volume quota in counts\n+   *\n+   * @return OzoneQuota object\n+   */\n+  public static OzoneQuota parseNameSpaceQuota(String quotaInNamespace) {\n+    if (Strings.isNullOrEmpty(quotaInNamespace)) {\n+      throw new IllegalArgumentException(\n+          \"Quota string cannot be null or empty.\");\n+    }\n+    long nameSpaceQuota = Long.parseLong(quotaInNamespace);\n+    if (nameSpaceQuota <= 0) {\n+      throw new IllegalArgumentException(\n+          \"Invalid values for namespace quota: \" + nameSpaceQuota);\n+    }\n+    return new OzoneQuota(nameSpaceQuota, new RawQuotaInBytes(Units.BYTES, -1));\n+  }\n+\n+  /**\n+   * Parses a user provided string and returns the\n+   * Quota Object.\n+   *\n+   * @param quotaInBytes Volume quota in bytes\n+   * @param quotaInNamespace Volume quota in counts", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "20c54b21641ab85a2f792bab12c2279668f8bf6c"}, "originalPosition": 87}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTY4ODIxMzM4", "url": "https://github.com/apache/ozone/pull/1746#pullrequestreview-568821338", "createdAt": "2021-01-15T05:13:11Z", "commit": {"oid": "81f43da7785740ff6f9ed05c06984999cb981b10"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "81f43da7785740ff6f9ed05c06984999cb981b10", "author": {"user": {"login": "captainzmc", "name": "micah zhao"}}, "url": "https://github.com/apache/ozone/commit/81f43da7785740ff6f9ed05c06984999cb981b10", "committedDate": "2021-01-15T03:19:45Z", "message": "fix review issues"}, "afterCommit": {"oid": "1e9775a293a490e1931263a27a6efe477d80ff52", "author": {"user": {"login": "captainzmc", "name": "micah zhao"}}, "url": "https://github.com/apache/ozone/commit/1e9775a293a490e1931263a27a6efe477d80ff52", "committedDate": "2021-01-15T05:34:34Z", "message": "fix review issues"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "bb1b62bc6fb0b49346d45407afcadbf4dd33640c", "author": {"user": {"login": "captainzmc", "name": "micah zhao"}}, "url": "https://github.com/apache/ozone/commit/bb1b62bc6fb0b49346d45407afcadbf4dd33640c", "committedDate": "2021-01-15T07:36:51Z", "message": "trigger new CI"}, "afterCommit": {"oid": "22326b992d37f4d6d98eb0df6b79b9e9d82beb12", "author": {"user": {"login": "captainzmc", "name": "micah zhao"}}, "url": "https://github.com/apache/ozone/commit/22326b992d37f4d6d98eb0df6b79b9e9d82beb12", "committedDate": "2021-01-15T07:54:29Z", "message": "fix review issues"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "22326b992d37f4d6d98eb0df6b79b9e9d82beb12", "author": {"user": {"login": "captainzmc", "name": "micah zhao"}}, "url": "https://github.com/apache/ozone/commit/22326b992d37f4d6d98eb0df6b79b9e9d82beb12", "committedDate": "2021-01-15T07:54:29Z", "message": "fix review issues"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1927, "cost": 1, "resetAt": "2021-10-28T18:00:02Z"}}}