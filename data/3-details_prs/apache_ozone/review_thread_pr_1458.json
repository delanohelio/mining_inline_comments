{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDk1MzA1MDY4", "number": 1458, "reviewThreads": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wOVQwNzoxMjoxMlrOEr7bcQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wOVQwNzoxNDozNFrOEr7d4Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzE0NDk3OTA1OnYy", "diffSide": "RIGHT", "path": "hadoop-ozone/ozone-manager/src/main/java/org/apache/hadoop/ozone/om/request/key/OMAllocateBlockRequest.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wOVQwNzoxMjoxMlrOHe9wSg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wOVQwODo0NToxNFrOHfAvPw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMjIzMTExNA==", "bodyText": "Are these two used somewhere?", "url": "https://github.com/apache/ozone/pull/1458#discussion_r502231114", "createdAt": "2020-10-09T07:12:12Z", "author": {"login": "ChenSammi"}, "path": "hadoop-ozone/ozone-manager/src/main/java/org/apache/hadoop/ozone/om/request/key/OMAllocateBlockRequest.java", "diffHunk": "@@ -218,6 +219,8 @@ public OMClientResponse validateAndUpdateCache(OzoneManager ozoneManager,\n       // update usedBytes atomically.\n       omVolumeArgs.getUsedBytes().add(preAllocatedSpace);\n       omBucketInfo.getUsedBytes().add(preAllocatedSpace);\n+      long vol = omVolumeArgs.getUsedBytes().sum();\n+      long buk = omBucketInfo.getUsedBytes().sum();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "2b53f6922e264dfee085dc2499c94078a09d4f0a"}, "originalPosition": 19}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMjI3OTk5OQ==", "bodyText": "Redundancy code,  will delete this.", "url": "https://github.com/apache/ozone/pull/1458#discussion_r502279999", "createdAt": "2020-10-09T08:45:14Z", "author": {"login": "captainzmc"}, "path": "hadoop-ozone/ozone-manager/src/main/java/org/apache/hadoop/ozone/om/request/key/OMAllocateBlockRequest.java", "diffHunk": "@@ -218,6 +219,8 @@ public OMClientResponse validateAndUpdateCache(OzoneManager ozoneManager,\n       // update usedBytes atomically.\n       omVolumeArgs.getUsedBytes().add(preAllocatedSpace);\n       omBucketInfo.getUsedBytes().add(preAllocatedSpace);\n+      long vol = omVolumeArgs.getUsedBytes().sum();\n+      long buk = omBucketInfo.getUsedBytes().sum();", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMjIzMTExNA=="}, "originalCommit": {"oid": "2b53f6922e264dfee085dc2499c94078a09d4f0a"}, "originalPosition": 19}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzE0NDk4NTI5OnYy", "diffSide": "RIGHT", "path": "hadoop-ozone/ozone-manager/src/main/java/org/apache/hadoop/ozone/om/request/file/OMFileCreateRequest.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wOVQwNzoxNDozNFrOHe90Hg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wOVQwNzoxNDozNFrOHe90Hg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMjIzMjA5NA==", "bodyText": "Better check bucket quota before volume quota check.", "url": "https://github.com/apache/ozone/pull/1458#discussion_r502232094", "createdAt": "2020-10-09T07:14:34Z", "author": {"login": "ChenSammi"}, "path": "hadoop-ozone/ozone-manager/src/main/java/org/apache/hadoop/ozone/om/request/file/OMFileCreateRequest.java", "diffHunk": "@@ -279,11 +279,12 @@ public OMClientResponse validateAndUpdateCache(OzoneManager ozoneManager,\n \n       omVolumeArgs = getVolumeInfo(omMetadataManager, volumeName);\n       omBucketInfo = getBucketInfo(omMetadataManager, volumeName, bucketName);\n-      // check volume quota\n+      // check volume and bucket quota\n       long preAllocatedSpace = newLocationList.size()\n           * ozoneManager.getScmBlockSize()\n           * omKeyInfo.getFactor().getNumber();\n       checkVolumeQuotaInBytes(omVolumeArgs, preAllocatedSpace);\n+      checkBucketQuotaInBytes(omBucketInfo, preAllocatedSpace);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "2b53f6922e264dfee085dc2499c94078a09d4f0a"}, "originalPosition": 10}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4951, "cost": 1, "resetAt": "2021-11-11T21:28:48Z"}}}