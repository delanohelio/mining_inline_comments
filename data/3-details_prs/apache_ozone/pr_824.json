{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDAzNTc4Nzk0", "number": 824, "title": "HDDS-2682: OM File create request does not check for existing directory with the same name", "bodyText": "What changes were proposed in this pull request?\nVerified the behavior in the latest code. This issue has been already taken care as part of some of the Ozone FS namespace optimisation changes.\nWhat is the link to the Apache JIRA\nhttps://issues.apache.org/jira/browse/HDDS-2682\nHow was this patch tested?\nAdded unit test case to validate this.", "createdAt": "2020-04-15T07:02:39Z", "url": "https://github.com/apache/ozone/pull/824", "merged": true, "mergeCommit": {"oid": "e9a466d9b5f59369528952e6c1e006340aee5751"}, "closed": true, "closedAt": "2020-04-16T06:23:15Z", "author": {"login": "rakeshadr"}, "timelineItems": {"totalCount": 6, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcXybq4gH2gAyNDAzNTc4Nzk0OjgyZTU4M2I4ZWViMzFlZWQxNDBlN2EwNzQ0OWU2ZmJjOGRlODU3NWQ=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcX3-8MAFqTM5Mzc2NDg1Mw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "82e583b8eeb31eed140e7a07449e6fbc8de8575d", "author": {"user": null}, "url": "https://github.com/apache/ozone/commit/82e583b8eeb31eed140e7a07449e6fbc8de8575d", "committedDate": "2020-04-15T06:51:49Z", "message": "HDDS-2682: OM File create request does not check for existing directory with the same name"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzkzNTQ5NjEw", "url": "https://github.com/apache/ozone/pull/824#pullrequestreview-393549610", "createdAt": "2020-04-15T08:12:39Z", "commit": {"oid": "82e583b8eeb31eed140e7a07449e6fbc8de8575d"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzkzNTUyMDk2", "url": "https://github.com/apache/ozone/pull/824#pullrequestreview-393552096", "createdAt": "2020-04-15T08:16:05Z", "commit": {"oid": "82e583b8eeb31eed140e7a07449e6fbc8de8575d"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xNVQwODoxNjowNVrOGFuwJg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xNVQwODoxNjowNVrOGFuwJg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwODY2MjA1NA==", "bodyText": "Nit: can you please extract this logic into a helper method, to avoid duplication?", "url": "https://github.com/apache/ozone/pull/824#discussion_r408662054", "createdAt": "2020-04-15T08:16:05Z", "author": {"login": "adoroszlai"}, "path": "hadoop-ozone/integration-test/src/test/java/org/apache/hadoop/fs/ozone/TestOzoneFileSystem.java", "diffHunk": "@@ -65,6 +68,110 @@\n   private int rootItemCount;\n \n   @Test(timeout = 300_000)\n+  public void testCreateFileShouldCheckTheExistenceOfDirWithSameName() throws Exception {\n+    /*\n+     * Op 1. create file -> /d1/d2/d3/d4/key2\n+     * Op 2. create dir -> /d1/d2/d3/d4/key2\n+     *\n+     * Reverse of the above steps\n+     * Op 2. create dir -> /d1/d2/d3/d4/key3\n+     * Op 1. create file -> /d1/d2/d3/d4/key3\n+     *\n+     * Op 3. create file -> /d1/d2/d3 (d3 as a file inside /d1/d2)\n+     */\n+    OzoneConfiguration conf = new OzoneConfiguration();\n+    cluster = MiniOzoneCluster.newBuilder(conf)\n+            .setNumDatanodes(3)\n+            .build();\n+    cluster.waitForClusterToBeReady();\n+    // create a volume and a bucket to be used by OzoneFileSystem\n+    OzoneBucket bucket = TestDataUtil.createVolumeAndBucket(cluster);\n+    volumeName = bucket.getVolumeName();\n+    bucketName = bucket.getName();\n+\n+    String rootPath = String.format(\"%s://%s.%s/\",\n+            OzoneConsts.OZONE_URI_SCHEME, bucket.getName(), bucket.getVolumeName());\n+\n+    // Set the fs.defaultFS and start the filesystem\n+    conf.set(CommonConfigurationKeysPublic.FS_DEFAULT_NAME_KEY, rootPath);\n+    fs = FileSystem.get(conf);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "82e583b8eeb31eed140e7a07449e6fbc8de8575d"}, "originalPosition": 47}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "8e1e72434fb1bb76c952be2e75b2f910244d6423", "author": {"user": null}, "url": "https://github.com/apache/ozone/commit/8e1e72434fb1bb76c952be2e75b2f910244d6423", "committedDate": "2020-04-15T09:07:31Z", "message": "trigger new CI check"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "7a296a99fe798dba1113c0854aab70ea0563732e", "author": {"user": null}, "url": "https://github.com/apache/ozone/commit/7a296a99fe798dba1113c0854aab70ea0563732e", "committedDate": "2020-04-15T12:18:41Z", "message": "Fixed checkstyle and review comment"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzkzNzY0ODUz", "url": "https://github.com/apache/ozone/pull/824#pullrequestreview-393764853", "createdAt": "2020-04-15T13:19:52Z", "commit": {"oid": "7a296a99fe798dba1113c0854aab70ea0563732e"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3377, "cost": 1, "resetAt": "2021-10-28T18:00:02Z"}}}