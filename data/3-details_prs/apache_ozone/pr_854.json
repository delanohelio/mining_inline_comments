{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDA2ODE5MTU4", "number": 854, "title": "HDDS-3393. Recon throws NPE in clusterState endpoint", "bodyText": "What changes were proposed in this pull request?\n\nPerform a null check on tables before calling getEstimatedKeyCount() on them.\nUpdate mock api response to match the expected json structure.\n\nWhat is the link to the Apache JIRA\nhttps://issues.apache.org/jira/browse/HDDS-3393\nHow was this patch tested?\nPatch was tested with docker-compose and verified that there is no NPE thrown in Recon logs after hitting the clusterState endpoint before first snapshot from OM.", "createdAt": "2020-04-21T18:00:08Z", "url": "https://github.com/apache/ozone/pull/854", "merged": true, "mergeCommit": {"oid": "00799c2b0e8917bb32c4a9e9ac6768c1f30e30f2"}, "closed": true, "closedAt": "2020-04-22T02:14:44Z", "author": {"login": "vivekratnavel"}, "timelineItems": {"totalCount": 6, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcZ3hyEAH2gAyNDA2ODE5MTU4Ojc3YWQxNzU4MzdmMzM2Yzg0NDI0MTM1NDcxMWFmNzBmNTEwNDQ3NjM=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcZ71HKAFqTM5NzczMjI2OQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "77ad175837f336c844241354711af70f51044763", "author": {"user": {"login": "vivekratnavel", "name": "Vivek Ratnavel Subramanian"}}, "url": "https://github.com/apache/ozone/commit/77ad175837f336c844241354711af70f51044763", "committedDate": "2020-04-21T17:55:52Z", "message": "HDDS-3393. Recon throws NPE in clusterState endpoint"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzk3NTY5NzA0", "url": "https://github.com/apache/ozone/pull/854#pullrequestreview-397569704", "createdAt": "2020-04-21T18:32:11Z", "commit": {"oid": "77ad175837f336c844241354711af70f51044763"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yMVQxODozMjoxMlrOGJSnjg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yMVQxODozMjoxMlrOGJSnjg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMjM5NTQwNg==", "bodyText": "Instead of not null checks, can we have a state in MetadataManager like INITIALIZED, STOPPED? This will help be future proof, and if anywhere this check is required it will be generic to use state, instead of not null check", "url": "https://github.com/apache/ozone/pull/854#discussion_r412395406", "createdAt": "2020-04-21T18:32:12Z", "author": {"login": "bharatviswa504"}, "path": "hadoop-ozone/recon/src/main/java/org/apache/hadoop/ozone/recon/api/ClusterStateEndpoint.java", "diffHunk": "@@ -81,20 +82,26 @@ public Response getClusterState() {\n             stats.getScmUsed().get(), stats.getRemaining().get());\n     ClusterStateResponse.Builder builder = ClusterStateResponse.newBuilder();\n     try {\n-      builder.setVolumes(\n-          omMetadataManager.getVolumeTable().getEstimatedKeyCount());\n+      Table volumeTable = omMetadataManager.getVolumeTable();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "77ad175837f336c844241354711af70f51044763"}, "originalPosition": 14}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "8aa1ea9a7bc90013ee3496f09690b048c2e61e8e", "author": {"user": {"login": "vivekratnavel", "name": "Vivek Ratnavel Subramanian"}}, "url": "https://github.com/apache/ozone/commit/8aa1ea9a7bc90013ee3496f09690b048c2e61e8e", "committedDate": "2020-04-21T18:56:34Z", "message": "Fix review comments."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzk3NzIzMjcz", "url": "https://github.com/apache/ozone/pull/854#pullrequestreview-397723273", "createdAt": "2020-04-21T22:34:54Z", "commit": {"oid": "8aa1ea9a7bc90013ee3496f09690b048c2e61e8e"}, "state": "COMMENTED", "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yMVQyMjozNDo1NFrOGJbTSw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yMVQyMjozODowOVrOGJbZFQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMjUzNzY3NQ==", "bodyText": "Minor NIT: return true if OM Tables are initialized, otherwise false.", "url": "https://github.com/apache/ozone/pull/854#discussion_r412537675", "createdAt": "2020-04-21T22:34:54Z", "author": {"login": "bharatviswa504"}, "path": "hadoop-ozone/recon/src/main/java/org/apache/hadoop/ozone/recon/recovery/ReconOMMetadataManager.java", "diffHunk": "@@ -41,4 +41,10 @@\n    * Database.\n    */\n   long getLastSequenceNumberFromDB();\n+\n+  /**\n+   * Check if OM tables are initialized.\n+   * @return if OM Tables are initialized", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "8aa1ea9a7bc90013ee3496f09690b048c2e61e8e"}, "originalPosition": 7}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMjUzNzkwNA==", "bodyText": "Missed @override notion, and same comment as above related to Javadoc or it can be completely removed.", "url": "https://github.com/apache/ozone/pull/854#discussion_r412537904", "createdAt": "2020-04-21T22:35:29Z", "author": {"login": "bharatviswa504"}, "path": "hadoop-ozone/recon/src/main/java/org/apache/hadoop/ozone/recon/recovery/ReconOmMetadataManagerImpl.java", "diffHunk": "@@ -120,4 +122,11 @@ public long getLastSequenceNumberFromDB() {\n     }\n   }\n \n+  /**\n+   * Check if OM tables are initialized.\n+   * @return if OM Tables are initialized\n+   */\n+  public boolean isOmTablesInitialized() {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "8aa1ea9a7bc90013ee3496f09690b048c2e61e8e"}, "originalPosition": 24}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMjUzOTE1Nw==", "bodyText": "Not understood why these are changed, and how it is related to this change.", "url": "https://github.com/apache/ozone/pull/854#discussion_r412539157", "createdAt": "2020-04-21T22:38:09Z", "author": {"login": "bharatviswa504"}, "path": "hadoop-ozone/recon/src/main/resources/webapps/recon/ozone-recon-web/api/db.json", "diffHunk": "@@ -378,11 +378,11 @@\n           }\n         ],\n         \"missingSince\": 1578491371528,\n-        \"pipelineId\": \"05e3d908-ff01-4ce6-ad75-f3ec79bcc7982\"\n+        \"pipelineID\": \"05e3d908-ff01-4ce6-ad75-f3ec79bcc7982\"\n       },\n       {\n-        \"id\": 2,\n-        \"keys\": 5943,\n+        \"containerID\": 2,", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "8aa1ea9a7bc90013ee3496f09690b048c2e61e8e"}, "originalPosition": 46}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b3a3c2cfdb17d763372ca9e62d248ba7c2902206", "author": {"user": {"login": "vivekratnavel", "name": "Vivek Ratnavel Subramanian"}}, "url": "https://github.com/apache/ozone/commit/b3a3c2cfdb17d763372ca9e62d248ba7c2902206", "committedDate": "2020-04-21T22:46:52Z", "message": "Fix review comments."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzk3NzMyMjY5", "url": "https://github.com/apache/ozone/pull/854#pullrequestreview-397732269", "createdAt": "2020-04-21T22:56:36Z", "commit": {"oid": "b3a3c2cfdb17d763372ca9e62d248ba7c2902206"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3406, "cost": 1, "resetAt": "2021-10-28T18:00:02Z"}}}