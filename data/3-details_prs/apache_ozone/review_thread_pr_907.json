{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDE1NTQyMjgw", "number": 907, "reviewThreads": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xMlQyMjo1MTo1MFrOD72iLA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xMlQyMzowMjo0OFrOD72rzg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjY0MDg2MDYwOnYy", "diffSide": "RIGHT", "path": "hadoop-hdds/server-scm/src/main/java/org/apache/hadoop/hdds/scm/server/StorageContainerManager.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xMlQyMjo1MTo1MFrOGUbsXQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xM1QwODo0NTo1NlrOGUnozw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNDA3ODQyOQ==", "bodyText": "Passing half created object (this) to SCMRatisServer constructor could cause subtle bugs that are tricky to get right. We should avoid it if possible.", "url": "https://github.com/apache/ozone/pull/907#discussion_r424078429", "createdAt": "2020-05-12T22:51:50Z", "author": {"login": "xiaoyuyao"}, "path": "hadoop-hdds/server-scm/src/main/java/org/apache/hadoop/hdds/scm/server/StorageContainerManager.java", "diffHunk": "@@ -1141,9 +1142,11 @@ private void initializeRatisServer() throws IOException {\n     if (scmRatisServer == null) {\n       SCMNodeDetails scmNodeDetails = SCMNodeDetails\n           .initStandAlone(configuration);\n-      //TODO enable Ratis ring\n-      scmRatisServer = SCMRatisServer.newSCMRatisServer(configuration, this,\n-          scmNodeDetails, Collections.EMPTY_LIST);\n+      //TODO enable Ratis group\n+      scmRatisServer = SCMRatisServer.newSCMRatisServer(configuration\n+              .getObject(SCMRatisServer.SCMRatisServerConfiguration.class),\n+          this, scmNodeDetails, Collections.EMPTY_LIST,", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a7773929bb90da4c8c29e3557a67fa854ab90570"}, "originalPosition": 18}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNDI3NDEyNw==", "bodyText": "I have made updates to have SCM use static method for createSCM and make constructor private. SCMRatisServer will be constructed after SCM is constructed.", "url": "https://github.com/apache/ozone/pull/907#discussion_r424274127", "createdAt": "2020-05-13T08:45:56Z", "author": {"login": "timmylicheng"}, "path": "hadoop-hdds/server-scm/src/main/java/org/apache/hadoop/hdds/scm/server/StorageContainerManager.java", "diffHunk": "@@ -1141,9 +1142,11 @@ private void initializeRatisServer() throws IOException {\n     if (scmRatisServer == null) {\n       SCMNodeDetails scmNodeDetails = SCMNodeDetails\n           .initStandAlone(configuration);\n-      //TODO enable Ratis ring\n-      scmRatisServer = SCMRatisServer.newSCMRatisServer(configuration, this,\n-          scmNodeDetails, Collections.EMPTY_LIST);\n+      //TODO enable Ratis group\n+      scmRatisServer = SCMRatisServer.newSCMRatisServer(configuration\n+              .getObject(SCMRatisServer.SCMRatisServerConfiguration.class),\n+          this, scmNodeDetails, Collections.EMPTY_LIST,", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNDA3ODQyOQ=="}, "originalCommit": {"oid": "a7773929bb90da4c8c29e3557a67fa854ab90570"}, "originalPosition": 18}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjY0MDg4NTI2OnYy", "diffSide": "RIGHT", "path": "hadoop-hdds/server-scm/src/main/java/org/apache/hadoop/hdds/scm/server/ratis/SCMRatisServer.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xMlQyMzowMjo0OFrOGUb7Vg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xM1QwMjozMzo1N1rOGUfa9g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNDA4MjI2Mg==", "bodyText": "Is it possible to make these RATIS related configuration reusable among DN,SCM and OM?\nJust different prefix like, ozone.om.ratis, ozone.scm.ratis, ozone.dn.ratis as prefix?", "url": "https://github.com/apache/ozone/pull/907#discussion_r424082262", "createdAt": "2020-05-12T23:02:48Z", "author": {"login": "xiaoyuyao"}, "path": "hadoop-hdds/server-scm/src/main/java/org/apache/hadoop/hdds/scm/server/ratis/SCMRatisServer.java", "diffHunk": "@@ -479,4 +425,166 @@ private void setServerRole(RaftPeerRole currentRole,\n       this.roleCheckLock.writeLock().unlock();\n     }\n   }\n+\n+  /**\n+   * Configuration used by SCM Ratis Server.\n+   */\n+  @ConfigGroup(prefix = \"ozone.scm.ratis\")", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a7773929bb90da4c8c29e3557a67fa854ab90570"}, "originalPosition": 239}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNDEzOTUxMA==", "bodyText": "Yea it looks like we currently have ozone.om.ratis, ozone.scm.ratis, hdds.datanode.ratis, dfs.container.ratis and even dfs.ratis.\nIf we decide to refactor all config into Java-based configuration, we shall consider refactoring all config to be like ozone.ratis.*\nThen we can take a look at reusable configuration among OM, SCM and container. I create Jira to track: https://issues.apache.org/jira/browse/HDDS-3577", "url": "https://github.com/apache/ozone/pull/907#discussion_r424139510", "createdAt": "2020-05-13T02:33:57Z", "author": {"login": "timmylicheng"}, "path": "hadoop-hdds/server-scm/src/main/java/org/apache/hadoop/hdds/scm/server/ratis/SCMRatisServer.java", "diffHunk": "@@ -479,4 +425,166 @@ private void setServerRole(RaftPeerRole currentRole,\n       this.roleCheckLock.writeLock().unlock();\n     }\n   }\n+\n+  /**\n+   * Configuration used by SCM Ratis Server.\n+   */\n+  @ConfigGroup(prefix = \"ozone.scm.ratis\")", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNDA4MjI2Mg=="}, "originalCommit": {"oid": "a7773929bb90da4c8c29e3557a67fa854ab90570"}, "originalPosition": 239}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4299, "cost": 1, "resetAt": "2021-11-12T11:57:46Z"}}}