{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDU1MzY5MDA5", "number": 1243, "reviewThreads": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yM1QwMTowNjoyM1rOERRUjw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yM1QwMToxMDo0NlrOERRXow==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjg2NTQ1MDM5OnYy", "diffSide": "RIGHT", "path": "hadoop-ozone/common/src/main/java/org/apache/hadoop/ozone/OmUtils.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yM1QwMTowNjoyM1rOG15QKg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yM1QxNzo0NjoyN1rOG2VHdw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1OTE2NTczOA==", "bodyText": "I think we also need to check if localServiceID value is one of the ozone.om.service.ids value.\nTo find if there is a mistake in the config.", "url": "https://github.com/apache/ozone/pull/1243#discussion_r459165738", "createdAt": "2020-07-23T01:06:23Z", "author": {"login": "bharatviswa504"}, "path": "hadoop-ozone/common/src/main/java/org/apache/hadoop/ozone/OmUtils.java", "diffHunk": "@@ -527,4 +529,45 @@ public static void validateKeyName(String keyName)\n               OMException.ResultCodes.INVALID_KEY_NAME);\n     }\n   }\n+\n+  /**\n+   * Return configured OzoneManager service id based on the following logic.\n+   * Look at 'ozone.om.internal.service.id' first. If configured, return that.\n+   * If the above is not configured, look at 'ozone.om.service.ids'.\n+   * If count(ozone.om.service.ids) == 1, return that id.\n+   * If count(ozone.om.service.ids) > 1 throw exception\n+   * If 'ozone.om.service.ids' is not configured, return null. (Non HA)\n+   * @param conf configuration\n+   * @return OM service ID.\n+   * @throws IOException on error.\n+   */\n+  public static String getOzoneManagerServiceId(OzoneConfiguration conf)\n+      throws IOException {\n+    Collection<String> omServiceIds;\n+    String localOMServiceId = conf.get(OZONE_OM_INTERNAL_SERVICE_ID);\n+    if (localOMServiceId == null) {\n+      LOG.info(\"{} is not defined, falling back to {} to find serviceID for \"\n+              + \"OzoneManager if it is HA enabled cluster\",\n+          OZONE_OM_INTERNAL_SERVICE_ID, OZONE_OM_SERVICE_IDS_KEY);\n+      omServiceIds = conf.getTrimmedStringCollection(\n+          OZONE_OM_SERVICE_IDS_KEY);\n+      if (omServiceIds.size() > 1) {\n+        throw new IOException(String.format(\n+            \"More than 1 OzoneManager ServiceID (ozone.om.service.ids) \" +\n+                \"configured : %s, but ozone.om.internal.service.id is not \" +\n+                \"configured.\", omServiceIds.toString()));\n+      }\n+    } else {\n+      omServiceIds = Collections.singletonList(localOMServiceId);\n+    }\n+", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "2a2b5c8801f32ed6e22c612aa38827eaffcb2fe1"}, "originalPosition": 51}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1OTYyMjI2Mw==", "bodyText": "Thanks @bharatviswa504. Will fix this.", "url": "https://github.com/apache/ozone/pull/1243#discussion_r459622263", "createdAt": "2020-07-23T17:46:27Z", "author": {"login": "avijayanhwx"}, "path": "hadoop-ozone/common/src/main/java/org/apache/hadoop/ozone/OmUtils.java", "diffHunk": "@@ -527,4 +529,45 @@ public static void validateKeyName(String keyName)\n               OMException.ResultCodes.INVALID_KEY_NAME);\n     }\n   }\n+\n+  /**\n+   * Return configured OzoneManager service id based on the following logic.\n+   * Look at 'ozone.om.internal.service.id' first. If configured, return that.\n+   * If the above is not configured, look at 'ozone.om.service.ids'.\n+   * If count(ozone.om.service.ids) == 1, return that id.\n+   * If count(ozone.om.service.ids) > 1 throw exception\n+   * If 'ozone.om.service.ids' is not configured, return null. (Non HA)\n+   * @param conf configuration\n+   * @return OM service ID.\n+   * @throws IOException on error.\n+   */\n+  public static String getOzoneManagerServiceId(OzoneConfiguration conf)\n+      throws IOException {\n+    Collection<String> omServiceIds;\n+    String localOMServiceId = conf.get(OZONE_OM_INTERNAL_SERVICE_ID);\n+    if (localOMServiceId == null) {\n+      LOG.info(\"{} is not defined, falling back to {} to find serviceID for \"\n+              + \"OzoneManager if it is HA enabled cluster\",\n+          OZONE_OM_INTERNAL_SERVICE_ID, OZONE_OM_SERVICE_IDS_KEY);\n+      omServiceIds = conf.getTrimmedStringCollection(\n+          OZONE_OM_SERVICE_IDS_KEY);\n+      if (omServiceIds.size() > 1) {\n+        throw new IOException(String.format(\n+            \"More than 1 OzoneManager ServiceID (ozone.om.service.ids) \" +\n+                \"configured : %s, but ozone.om.internal.service.id is not \" +\n+                \"configured.\", omServiceIds.toString()));\n+      }\n+    } else {\n+      omServiceIds = Collections.singletonList(localOMServiceId);\n+    }\n+", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1OTE2NTczOA=="}, "originalCommit": {"oid": "2a2b5c8801f32ed6e22c612aa38827eaffcb2fe1"}, "originalPosition": 51}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjg2NTQ1ODI3OnYy", "diffSide": "RIGHT", "path": "hadoop-ozone/recon/src/main/resources/webapps/recon/ozone-recon-web/src/views/overview/overview.tsx", "isResolved": true, "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yM1QwMToxMDo0NlrOG15UqQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yM1QxODo1Mzo1MlrOG2XbkQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1OTE2Njg4OQ==", "bodyText": "Not related to this change??", "url": "https://github.com/apache/ozone/pull/1243#discussion_r459166889", "createdAt": "2020-07-23T01:10:46Z", "author": {"login": "bharatviswa504"}, "path": "hadoop-ozone/recon/src/main/resources/webapps/recon/ozone-recon-web/src/views/overview/overview.tsx", "diffHunk": "@@ -180,7 +180,7 @@ export class Overview extends React.Component<Record<string, object>, IOverviewS\n             <OverviewCard loading={loading} title='Buckets' data={buckets.toString()} icon='folder-open'/>\n           </Col>\n           <Col xs={24} sm={18} md={12} lg={12} xl={6}>\n-            <OverviewCard loading={loading} title='Keys' data={keys.toString()} icon='file-text'/>\n+            <OverviewCard loading={loading} title='Keys (Estimated)' data={keys.toString()} icon='file-text'/>", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "2a2b5c8801f32ed6e22c612aa38827eaffcb2fe1"}, "originalPosition": 5}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1OTU5MTMwMw==", "bodyText": "I made this trivial change to cover for HDDS-4009 until that is fixed.", "url": "https://github.com/apache/ozone/pull/1243#discussion_r459591303", "createdAt": "2020-07-23T16:53:34Z", "author": {"login": "avijayanhwx"}, "path": "hadoop-ozone/recon/src/main/resources/webapps/recon/ozone-recon-web/src/views/overview/overview.tsx", "diffHunk": "@@ -180,7 +180,7 @@ export class Overview extends React.Component<Record<string, object>, IOverviewS\n             <OverviewCard loading={loading} title='Buckets' data={buckets.toString()} icon='folder-open'/>\n           </Col>\n           <Col xs={24} sm={18} md={12} lg={12} xl={6}>\n-            <OverviewCard loading={loading} title='Keys' data={keys.toString()} icon='file-text'/>\n+            <OverviewCard loading={loading} title='Keys (Estimated)' data={keys.toString()} icon='file-text'/>", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1OTE2Njg4OQ=="}, "originalCommit": {"oid": "2a2b5c8801f32ed6e22c612aa38827eaffcb2fe1"}, "originalPosition": 5}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1OTY2MDE3Nw==", "bodyText": "That is fine. But a new Jira should be nicer here.\nI am fine with it.", "url": "https://github.com/apache/ozone/pull/1243#discussion_r459660177", "createdAt": "2020-07-23T18:53:52Z", "author": {"login": "bharatviswa504"}, "path": "hadoop-ozone/recon/src/main/resources/webapps/recon/ozone-recon-web/src/views/overview/overview.tsx", "diffHunk": "@@ -180,7 +180,7 @@ export class Overview extends React.Component<Record<string, object>, IOverviewS\n             <OverviewCard loading={loading} title='Buckets' data={buckets.toString()} icon='folder-open'/>\n           </Col>\n           <Col xs={24} sm={18} md={12} lg={12} xl={6}>\n-            <OverviewCard loading={loading} title='Keys' data={keys.toString()} icon='file-text'/>\n+            <OverviewCard loading={loading} title='Keys (Estimated)' data={keys.toString()} icon='file-text'/>", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1OTE2Njg4OQ=="}, "originalCommit": {"oid": "2a2b5c8801f32ed6e22c612aa38827eaffcb2fe1"}, "originalPosition": 5}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4021, "cost": 1, "resetAt": "2021-11-12T11:57:46Z"}}}