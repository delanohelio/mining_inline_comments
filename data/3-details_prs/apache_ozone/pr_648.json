{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0Mzg0OTkwMzc0", "number": 648, "title": "HDDS-3117. Recon throws InterruptedException while getting new snapshot from OM.", "bodyText": "What changes were proposed in this pull request?\nOn a cluster where an ozone client is continuously pushing data into OM, we can have cases where the OM Delta updates request timing out or failing due to some unexpected error. In that case, the expected behavior of Recon is to request the whole snapshot from OM. The bug was that we were interrupting the thread on exception from delta updates query which caused the sync process to stop. Removed the interrupt call.\nWhat is the link to the Apache JIRA\nhttps://issues.apache.org/jira/browse/HDDS-3117\nHow was this patch tested?\nAdded acceptance tests for Recon's OM related APIs.\nManually tested by creating 50 million keys on OM, and verified that Recon OM DB sync works as expected.", "createdAt": "2020-03-06T19:41:32Z", "url": "https://github.com/apache/ozone/pull/648", "merged": true, "mergeCommit": {"oid": "062752007c98b968491fc34a24bc275009c68e20"}, "closed": true, "closedAt": "2020-03-11T20:18:32Z", "author": {"login": "avijayanhwx"}, "timelineItems": {"totalCount": 11, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcLFYZEgH2gAyMzg0OTkwMzc0OjYzZjQwYTI2MmI0MGM1ODY5ZTUzMTliZGI5ODg1M2RkODMyY2ZiMjA=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcMrOOrAH2gAyMzg0OTkwMzc0OjYyMjBkYWY1YzA0OTM1YjNlZDZiMTdlMTA1ZjgwNWVlYjAyNjRjOWY=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "63f40a262b40c5869e5319bdb98853dd832cfb20", "author": {"user": {"login": "avijayanhwx", "name": null}}, "url": "https://github.com/apache/ozone/commit/63f40a262b40c5869e5319bdb98853dd832cfb20", "committedDate": "2020-03-06T19:35:25Z", "message": "HDDS-3117. Recon throws InterruptedException while getting new snapshot from OM."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e61d80078c81884a3ab74e304a024c4b182fcffe", "author": {"user": {"login": "avijayanhwx", "name": null}}, "url": "https://github.com/apache/ozone/commit/e61d80078c81884a3ab74e304a024c4b182fcffe", "committedDate": "2020-03-06T23:46:09Z", "message": "HDDS-3117. Fix test failures."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "565508a0ae86cf4a9ff461c41c212b7bef38c63b", "author": {"user": {"login": "avijayanhwx", "name": null}}, "url": "https://github.com/apache/ozone/commit/565508a0ae86cf4a9ff461c41c212b7bef38c63b", "committedDate": "2020-03-06T23:51:17Z", "message": "Merge remote-tracking branch 'upstream/master' into HDDS-3117-master"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzcwNzA1MzI5", "url": "https://github.com/apache/ozone/pull/648#pullrequestreview-370705329", "createdAt": "2020-03-07T00:58:49Z", "commit": {"oid": "565508a0ae86cf4a9ff461c41c212b7bef38c63b"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzcxNTUwMzcw", "url": "https://github.com/apache/ozone/pull/648#pullrequestreview-371550370", "createdAt": "2020-03-09T21:44:23Z", "commit": {"oid": "565508a0ae86cf4a9ff461c41c212b7bef38c63b"}, "state": "COMMENTED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzcxNTY1NjEy", "url": "https://github.com/apache/ozone/pull/648#pullrequestreview-371565612", "createdAt": "2020-03-09T22:15:50Z", "commit": {"oid": "565508a0ae86cf4a9ff461c41c212b7bef38c63b"}, "state": "COMMENTED", "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wOVQyMjoxNTo1MFrOFz7NuA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wOVQyMjoyMDo1OFrOFz7UgA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4OTk5MTg2NA==", "bodyText": "I'd rather avoid adding 2x1.5 minutes sleep to acceptance tests (one for secure, one for unsecure).", "url": "https://github.com/apache/ozone/pull/648#discussion_r389991864", "createdAt": "2020-03-09T22:15:50Z", "author": {"login": "adoroszlai"}, "path": "hadoop-ozone/dist/src/main/smoketest/recon/recon-api.robot", "diffHunk": "@@ -25,16 +25,26 @@ ${ENDPOINT_URL}       http://recon:9888\n ${API_ENDPOINT_URL}   http://recon:9888/api/v1\n \n *** Test Cases ***\n-Recon REST API\n+Recon OM APIs\n+    Run Keyword if      '${SECURITY_ENABLED}' == 'true'     Kinit test user     testuser     testuser.keytab\n+                        Execute                             ozone freon rk --numOfVolumes 1 --numOfBuckets 1 --numOfKeys 10 --keySize 1025\n+                        Sleep               90s", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "565508a0ae86cf4a9ff461c41c212b7bef38c63b"}, "originalPosition": 8}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4OTk5MzQwMA==", "bodyText": "Shouldn't interrupt() be kept for InterruptedException and avoided only for the rest?", "url": "https://github.com/apache/ozone/pull/648#discussion_r389993400", "createdAt": "2020-03-09T22:20:26Z", "author": {"login": "adoroszlai"}, "path": "hadoop-ozone/recon/src/main/java/org/apache/hadoop/ozone/recon/spi/impl/OzoneManagerServiceProviderImpl.java", "diffHunk": "@@ -350,8 +357,7 @@ public void syncDataFromOM() {\n         // Pass on DB update events to tasks that are listening.\n         reconTaskController.consumeOMEvents(new OMUpdateEventBatch(\n             omdbUpdatesHandler.getEvents()), omMetadataManager);\n-      } catch (IOException | InterruptedException | RocksDBException e) {\n-        Thread.currentThread().interrupt();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "565508a0ae86cf4a9ff461c41c212b7bef38c63b"}, "originalPosition": 28}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4OTk5MzYwMA==", "bodyText": "I think this can be kept for the InterruptedException case.", "url": "https://github.com/apache/ozone/pull/648#discussion_r389993600", "createdAt": "2020-03-09T22:20:58Z", "author": {"login": "adoroszlai"}, "path": "hadoop-ozone/recon/src/main/java/org/apache/hadoop/ozone/recon/spi/impl/OzoneManagerServiceProviderImpl.java", "diffHunk": "@@ -374,9 +380,8 @@ public void syncDataFromOM() {\n           LOG.info(\"Calling reprocess on Recon tasks.\");\n           reconTaskController.reInitializeTasks(omMetadataManager);\n         }\n-      } catch (IOException | InterruptedException e) {\n-        Thread.currentThread().interrupt();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "565508a0ae86cf4a9ff461c41c212b7bef38c63b"}, "originalPosition": 38}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "9a77d5dfb8bd241e01b672e4347f4f0b6ca0baa9", "author": {"user": {"login": "avijayanhwx", "name": null}}, "url": "https://github.com/apache/ozone/commit/9a77d5dfb8bd241e01b672e4347f4f0b6ca0baa9", "committedDate": "2020-03-10T18:32:12Z", "message": "HDDS-3117. Fix review comments."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b4aba2fa107fe1a5a853c9904a30859806e8060f", "author": {"user": {"login": "avijayanhwx", "name": null}}, "url": "https://github.com/apache/ozone/commit/b4aba2fa107fe1a5a853c9904a30859806e8060f", "committedDate": "2020-03-10T19:58:56Z", "message": "Test fix for acceptance test failure."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "266020db89085a21735ab2a94e2eeb93d9c61ed7", "author": {"user": {"login": "avijayanhwx", "name": null}}, "url": "https://github.com/apache/ozone/commit/266020db89085a21735ab2a94e2eeb93d9c61ed7", "committedDate": "2020-03-11T04:56:51Z", "message": "Acceptance test fix."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e12d4ae23b334a54f6b8b7a0248a74e2951f7cbc", "author": {"user": {"login": "adoroszlai", "name": "Doroszlai, Attila"}}, "url": "https://github.com/apache/ozone/commit/e12d4ae23b334a54f6b8b7a0248a74e2951f7cbc", "committedDate": "2020-03-11T12:52:55Z", "message": "trigger new CI check"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "6220daf5c04935b3ed6b17e105f805eeb0264c9f", "author": {"user": {"login": "avijayanhwx", "name": null}}, "url": "https://github.com/apache/ozone/commit/6220daf5c04935b3ed6b17e105f805eeb0264c9f", "committedDate": "2020-03-11T18:14:38Z", "message": "Merge remote-tracking branch 'upstream/master' into HDDS-3117-master"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3685, "cost": 1, "resetAt": "2021-10-28T18:00:02Z"}}}