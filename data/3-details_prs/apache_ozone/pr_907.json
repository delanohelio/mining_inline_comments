{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDE1NTQyMjgw", "number": 907, "title": "HDDS-3556 Refactor conf in SCMRatisServer to Java-based conf.", "bodyText": "What changes were proposed in this pull request?\nRefactor SCMRatisServer conf to java based.\n(Please fill in changes proposed in this fix)\nWhat is the link to the Apache JIRA\nhttps://issues.apache.org/jira/browse/HDDS-3556\n(Please create an issue in ASF JIRA before opening a pull request,\nand you need to set the title of the pull request which starts with\nthe corresponding JIRA issue number. (e.g. HDDS-XXXX. Fix a typo in YYY.)\nPlease replace this section with the link to the Apache JIRA)\nHow was this patch tested?\nUT\n(Please explain how this patch was tested. Ex: unit tests, manual tests)\n(If this patch involves UI changes, please attach a screen-shot; otherwise, remove this)", "createdAt": "2020-05-09T08:54:51Z", "url": "https://github.com/apache/ozone/pull/907", "merged": true, "mergeCommit": {"oid": "169a324ae33b08cf16ad49a8ecb7d99d1ee6cdbf"}, "closed": true, "closedAt": "2020-05-20T02:05:58Z", "author": {"login": "timmylicheng"}, "timelineItems": {"totalCount": 9, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcgHOwrgBqjMzMjExMjk1OTU=", "endCursor": "Y3Vyc29yOnYyOpPPAAABciwUvIAH2gAyNDE1NTQyMjgwOmFmZmU1OGNmYTZhZDkxMTNmYjk1NWQxZDU1ODljOWE4YzI3ZGRmODA=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "49e30f0396e3265a3184c3b0c8c9f52f84143452", "author": {"user": {"login": "timmylicheng", "name": "Li Cheng"}}, "url": "https://github.com/apache/ozone/commit/49e30f0396e3265a3184c3b0c8c9f52f84143452", "committedDate": "2020-05-09T08:51:50Z", "message": "HDDS-3556 Refactor configuration in SCMRatisServer to Java-based configuration."}, "afterCommit": {"oid": "bd44c3d3cf528f2ce813ce8cd4d4ca70723f20c6", "author": {"user": {"login": "timmylicheng", "name": "Li Cheng"}}, "url": "https://github.com/apache/ozone/commit/bd44c3d3cf528f2ce813ce8cd4d4ca70723f20c6", "committedDate": "2020-05-11T03:36:53Z", "message": "HDDS-3556 Refactor configuration in SCMRatisServer to Java-based configuration."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a7773929bb90da4c8c29e3557a67fa854ab90570", "author": {"user": {"login": "timmylicheng", "name": "Li Cheng"}}, "url": "https://github.com/apache/ozone/commit/a7773929bb90da4c8c29e3557a67fa854ab90570", "committedDate": "2020-05-11T09:40:47Z", "message": "HDDS-3556 Refactor configuration in SCMRatisServer to Java-based configuration."}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "bd44c3d3cf528f2ce813ce8cd4d4ca70723f20c6", "author": {"user": {"login": "timmylicheng", "name": "Li Cheng"}}, "url": "https://github.com/apache/ozone/commit/bd44c3d3cf528f2ce813ce8cd4d4ca70723f20c6", "committedDate": "2020-05-11T03:36:53Z", "message": "HDDS-3556 Refactor configuration in SCMRatisServer to Java-based configuration."}, "afterCommit": {"oid": "a7773929bb90da4c8c29e3557a67fa854ab90570", "author": {"user": {"login": "timmylicheng", "name": "Li Cheng"}}, "url": "https://github.com/apache/ozone/commit/a7773929bb90da4c8c29e3557a67fa854ab90570", "committedDate": "2020-05-11T09:40:47Z", "message": "HDDS-3556 Refactor configuration in SCMRatisServer to Java-based configuration."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDEwNDc3NTIz", "url": "https://github.com/apache/ozone/pull/907#pullrequestreview-410477523", "createdAt": "2020-05-12T22:51:50Z", "commit": {"oid": "a7773929bb90da4c8c29e3557a67fa854ab90570"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xMlQyMjo1MTo1MFrOGUbsXQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xMlQyMjo1MTo1MFrOGUbsXQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNDA3ODQyOQ==", "bodyText": "Passing half created object (this) to SCMRatisServer constructor could cause subtle bugs that are tricky to get right. We should avoid it if possible.", "url": "https://github.com/apache/ozone/pull/907#discussion_r424078429", "createdAt": "2020-05-12T22:51:50Z", "author": {"login": "xiaoyuyao"}, "path": "hadoop-hdds/server-scm/src/main/java/org/apache/hadoop/hdds/scm/server/StorageContainerManager.java", "diffHunk": "@@ -1141,9 +1142,11 @@ private void initializeRatisServer() throws IOException {\n     if (scmRatisServer == null) {\n       SCMNodeDetails scmNodeDetails = SCMNodeDetails\n           .initStandAlone(configuration);\n-      //TODO enable Ratis ring\n-      scmRatisServer = SCMRatisServer.newSCMRatisServer(configuration, this,\n-          scmNodeDetails, Collections.EMPTY_LIST);\n+      //TODO enable Ratis group\n+      scmRatisServer = SCMRatisServer.newSCMRatisServer(configuration\n+              .getObject(SCMRatisServer.SCMRatisServerConfiguration.class),\n+          this, scmNodeDetails, Collections.EMPTY_LIST,", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a7773929bb90da4c8c29e3557a67fa854ab90570"}, "originalPosition": 18}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDEwNDgxOTQw", "url": "https://github.com/apache/ozone/pull/907#pullrequestreview-410481940", "createdAt": "2020-05-12T23:02:48Z", "commit": {"oid": "a7773929bb90da4c8c29e3557a67fa854ab90570"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xMlQyMzowMjo0OFrOGUb7Vg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xMlQyMzowMjo0OFrOGUb7Vg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNDA4MjI2Mg==", "bodyText": "Is it possible to make these RATIS related configuration reusable among DN,SCM and OM?\nJust different prefix like, ozone.om.ratis, ozone.scm.ratis, ozone.dn.ratis as prefix?", "url": "https://github.com/apache/ozone/pull/907#discussion_r424082262", "createdAt": "2020-05-12T23:02:48Z", "author": {"login": "xiaoyuyao"}, "path": "hadoop-hdds/server-scm/src/main/java/org/apache/hadoop/hdds/scm/server/ratis/SCMRatisServer.java", "diffHunk": "@@ -479,4 +425,166 @@ private void setServerRole(RaftPeerRole currentRole,\n       this.roleCheckLock.writeLock().unlock();\n     }\n   }\n+\n+  /**\n+   * Configuration used by SCM Ratis Server.\n+   */\n+  @ConfigGroup(prefix = \"ozone.scm.ratis\")", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a7773929bb90da4c8c29e3557a67fa854ab90570"}, "originalPosition": 239}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDEwNDgyMDMz", "url": "https://github.com/apache/ozone/pull/907#pullrequestreview-410482033", "createdAt": "2020-05-12T23:03:03Z", "commit": {"oid": "a7773929bb90da4c8c29e3557a67fa854ab90570"}, "state": "COMMENTED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ba67c7610eb4b027a053bc3ea2584727ee51655d", "author": {"user": {"login": "timmylicheng", "name": "Li Cheng"}}, "url": "https://github.com/apache/ozone/commit/ba67c7610eb4b027a053bc3ea2584727ee51655d", "committedDate": "2020-05-13T08:16:21Z", "message": "Make SCM constructor private and have SCMRatisServer constructed in static method."}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "05b2724ff1990190f5b20150c0aef30e35f0a9ee", "author": {"user": {"login": "timmylicheng", "name": "Li Cheng"}}, "url": "https://github.com/apache/ozone/commit/05b2724ff1990190f5b20150c0aef30e35f0a9ee", "committedDate": "2020-05-13T08:07:41Z", "message": "Make SCM constructor private and have SCMRatisServer constructed in static method."}, "afterCommit": {"oid": "ba67c7610eb4b027a053bc3ea2584727ee51655d", "author": {"user": {"login": "timmylicheng", "name": "Li Cheng"}}, "url": "https://github.com/apache/ozone/commit/ba67c7610eb4b027a053bc3ea2584727ee51655d", "committedDate": "2020-05-13T08:16:21Z", "message": "Make SCM constructor private and have SCMRatisServer constructed in static method."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "affe58cfa6ad9113fb955d1d5589c9a8c27ddf80", "author": {"user": {"login": "timmylicheng", "name": "Li Cheng"}}, "url": "https://github.com/apache/ozone/commit/affe58cfa6ad9113fb955d1d5589c9a8c27ddf80", "committedDate": "2020-05-19T08:37:36Z", "message": "Update java doc for createSCM."}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3236, "cost": 1, "resetAt": "2021-10-28T18:00:02Z"}}}