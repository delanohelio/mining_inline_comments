{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0MzgzMTYzOTg5", "number": 629, "reviewThreads": {"totalCount": 11, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wNFQxOTo0MDo1OVrODlLXFg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wNFQyMDoyOToxMVrODlMSGw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjQwMzEwMDM4OnYy", "diffSide": "RIGHT", "path": "hadoop-hdds/common/src/main/java/org/apache/hadoop/hdds/recon/ReconConfig.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wNFQxOTo0MDo1OVrOFx7CHA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wNFQxOTo0MDo1OVrOFx7CHA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4Nzg5MTc0MA==", "bodyText": "Can you add a description?", "url": "https://github.com/apache/ozone/pull/629#discussion_r387891740", "createdAt": "2020-03-04T19:40:59Z", "author": {"login": "vivekratnavel"}, "path": "hadoop-hdds/common/src/main/java/org/apache/hadoop/hdds/recon/ReconConfig.java", "diffHunk": "@@ -0,0 +1,84 @@\n+/**\n+ * Licensed to the Apache Software Foundation (ASF) under one\n+ * or more contributor license agreements.  See the NOTICE file\n+ * distributed with this work for additional information\n+ * regarding copyright ownership.  The ASF licenses this file\n+ * to you under the Apache License, Version 2.0 (the\n+ * \"License\"); you may not use this file except in compliance\n+ * with the License.  You may obtain a copy of the License at\n+ * <p>\n+ * http://www.apache.org/licenses/LICENSE-2.0\n+ * <p>\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+package org.apache.hadoop.hdds.recon;\n+\n+import org.apache.hadoop.hdds.conf.Config;\n+import org.apache.hadoop.hdds.conf.ConfigGroup;\n+import org.apache.hadoop.hdds.conf.ConfigTag;\n+import org.apache.hadoop.hdds.conf.ConfigType;\n+\n+/**\n+ * The configuration class for the Recon service.\n+ */\n+@ConfigGroup(prefix = \"ozone.recon\")\n+public class ReconConfig {\n+\n+  @Config(key = \"kerberos.principal\",\n+      type = ConfigType.STRING,\n+      defaultValue = \"\",\n+      tags = { ConfigTag.SECURITY, ConfigTag.OZONE },\n+      description = \"This Kerberos principal is used by the Recon service.\"\n+  )\n+  private String principal;\n+\n+  @Config(key = \"kerberos.keytab.file\",\n+      type = ConfigType.STRING,\n+      defaultValue = \"\",\n+      tags = { ConfigTag.SECURITY, ConfigTag.OZONE },\n+      description = \"The keytab file used by Recon daemon to login as \"+\n+          \"its service principal.\"\n+  )\n+  private String keytab;\n+\n+  @Config(key = \"security.client.datanode.container.protocol.acl\",\n+      type = ConfigType.STRING,\n+      defaultValue = \"\",\n+      tags = { ConfigTag.SECURITY, ConfigTag.OZONE },\n+      description = \"\"", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "6a5481f2cb7bcd2d44e025bc13449eb5380e74ed"}, "originalPosition": 52}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjQwMzEwNDQ4OnYy", "diffSide": "RIGHT", "path": "hadoop-hdds/container-service/src/main/java/org/apache/hadoop/ozone/protocol/ReconDatanodeProtocol.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wNFQxOTo0MjoxNVrOFx7Ewg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wNFQxOTo0MjoxNVrOFx7Ewg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4Nzg5MjQxOA==", "bodyText": "nit: fix typo", "url": "https://github.com/apache/ozone/pull/629#discussion_r387892418", "createdAt": "2020-03-04T19:42:15Z", "author": {"login": "vivekratnavel"}, "path": "hadoop-hdds/container-service/src/main/java/org/apache/hadoop/ozone/protocol/ReconDatanodeProtocol.java", "diffHunk": "@@ -0,0 +1,33 @@\n+/**\n+ * Licensed to the Apache Software Foundation (ASF) under one or more\n+ * contributor license agreements.  See the NOTICE file distributed with this\n+ * work for additional information regarding copyright ownership.  The ASF\n+ * licenses this file to you under the Apache License, Version 2.0 (the\n+ * \"License\"); you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ * <p>\n+ * http://www.apache.org/licenses/LICENSE-2.0\n+ * <p>\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS, WITHOUT\n+ * WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. See the\n+ * License for the specific language governing permissions and limitations under\n+ * the License.\n+ */\n+\n+package org.apache.hadoop.ozone.protocol;\n+\n+import org.apache.hadoop.hdds.annotation.InterfaceAudience;\n+import org.apache.hadoop.hdds.recon.ReconConfig;\n+import org.apache.hadoop.security.KerberosInfo;\n+\n+/**\n+ * The protocol spoken between datanodes and Recon. For specifics please the", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "6a5481f2cb7bcd2d44e025bc13449eb5380e74ed"}, "originalPosition": 25}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjQwMzExNjA3OnYy", "diffSide": "RIGHT", "path": "hadoop-ozone/recon/src/main/java/org/apache/hadoop/ozone/recon/ReconServer.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wNFQxOTo0NTo1MFrOFx7MWQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wNFQxOTo0NTo1MFrOFx7MWQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4Nzg5NDM2MQ==", "bodyText": "nit: supported?", "url": "https://github.com/apache/ozone/pull/629#discussion_r387894361", "createdAt": "2020-03-04T19:45:50Z", "author": {"login": "vivekratnavel"}, "path": "hadoop-ozone/recon/src/main/java/org/apache/hadoop/ozone/recon/ReconServer.java", "diffHunk": "@@ -179,21 +179,21 @@ private static void loginReconUser(OzoneConfiguration conf)\n \n     if (SecurityUtil.getAuthenticationMethod(conf).equals(\n         UserGroupInformation.AuthenticationMethod.KERBEROS)) {\n-\n+      ReconConfig reconConfig = conf.getObject(ReconConfig.class);\n       LOG.info(\"Ozone security is enabled. Attempting login for Recon user. \"\n-              + \"Principal: {}, keytab: {}\", conf.get(\n-          OZONE_RECON_KERBEROS_PRINCIPAL_KEY),\n-          conf.get(OZONE_RECON_KERBEROS_KEYTAB_FILE_KEY));\n-      \n+              + \"Principal: {}, keytab: {}\",\n+          reconConfig.getKerberosPrincipal(),\n+          reconConfig.getKerberosKeytab());\n       UserGroupInformation.setConfiguration(conf);\n-\n       InetSocketAddress socAddr = HddsUtils.getReconAddresses(conf);\n-      SecurityUtil.login(conf, OZONE_RECON_KERBEROS_KEYTAB_FILE_KEY,\n-          OZONE_RECON_KERBEROS_PRINCIPAL_KEY, socAddr.getHostName());\n+      SecurityUtil.login(conf,\n+          OZONE_RECON_KERBEROS_KEYTAB_FILE_KEY,\n+          OZONE_RECON_KERBEROS_PRINCIPAL_KEY,\n+          socAddr.getHostName());\n     } else {\n       throw new AuthenticationException(SecurityUtil.getAuthenticationMethod(\n-          conf) + \" authentication method not supported. Recon user login \"\n-          + \"failed.\");\n+          conf) + \" authentication method not support. \"", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "6a5481f2cb7bcd2d44e025bc13449eb5380e74ed"}, "originalPosition": 52}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjQwMzE3NzE1OnYy", "diffSide": "RIGHT", "path": "hadoop-hdds/common/src/main/java/org/apache/hadoop/hdds/recon/ReconConfig.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wNFQyMDowMzo0OFrOFx7y7A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wNFQyMDoxMTowM1rOFx8AwQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NzkwNDIzNg==", "bodyText": "Can we add the newly introduced tag ConfigTag.RECON here for these keys?", "url": "https://github.com/apache/ozone/pull/629#discussion_r387904236", "createdAt": "2020-03-04T20:03:48Z", "author": {"login": "xiaoyuyao"}, "path": "hadoop-hdds/common/src/main/java/org/apache/hadoop/hdds/recon/ReconConfig.java", "diffHunk": "@@ -0,0 +1,84 @@\n+/**\n+ * Licensed to the Apache Software Foundation (ASF) under one\n+ * or more contributor license agreements.  See the NOTICE file\n+ * distributed with this work for additional information\n+ * regarding copyright ownership.  The ASF licenses this file\n+ * to you under the Apache License, Version 2.0 (the\n+ * \"License\"); you may not use this file except in compliance\n+ * with the License.  You may obtain a copy of the License at\n+ * <p>\n+ * http://www.apache.org/licenses/LICENSE-2.0\n+ * <p>\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+package org.apache.hadoop.hdds.recon;\n+\n+import org.apache.hadoop.hdds.conf.Config;\n+import org.apache.hadoop.hdds.conf.ConfigGroup;\n+import org.apache.hadoop.hdds.conf.ConfigTag;\n+import org.apache.hadoop.hdds.conf.ConfigType;\n+\n+/**\n+ * The configuration class for the Recon service.\n+ */\n+@ConfigGroup(prefix = \"ozone.recon\")\n+public class ReconConfig {\n+\n+  @Config(key = \"kerberos.principal\",\n+      type = ConfigType.STRING,\n+      defaultValue = \"\",\n+      tags = { ConfigTag.SECURITY, ConfigTag.OZONE },", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "6a5481f2cb7bcd2d44e025bc13449eb5380e74ed"}, "originalPosition": 34}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NzkwNzc3Nw==", "bodyText": "Yes, I can use it. I could not get a general idea of when to use \"RECON\" config tag. Why do we have an \"OZONE\" config tag? :)", "url": "https://github.com/apache/ozone/pull/629#discussion_r387907777", "createdAt": "2020-03-04T20:11:03Z", "author": {"login": "avijayanhwx"}, "path": "hadoop-hdds/common/src/main/java/org/apache/hadoop/hdds/recon/ReconConfig.java", "diffHunk": "@@ -0,0 +1,84 @@\n+/**\n+ * Licensed to the Apache Software Foundation (ASF) under one\n+ * or more contributor license agreements.  See the NOTICE file\n+ * distributed with this work for additional information\n+ * regarding copyright ownership.  The ASF licenses this file\n+ * to you under the Apache License, Version 2.0 (the\n+ * \"License\"); you may not use this file except in compliance\n+ * with the License.  You may obtain a copy of the License at\n+ * <p>\n+ * http://www.apache.org/licenses/LICENSE-2.0\n+ * <p>\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+package org.apache.hadoop.hdds.recon;\n+\n+import org.apache.hadoop.hdds.conf.Config;\n+import org.apache.hadoop.hdds.conf.ConfigGroup;\n+import org.apache.hadoop.hdds.conf.ConfigTag;\n+import org.apache.hadoop.hdds.conf.ConfigType;\n+\n+/**\n+ * The configuration class for the Recon service.\n+ */\n+@ConfigGroup(prefix = \"ozone.recon\")\n+public class ReconConfig {\n+\n+  @Config(key = \"kerberos.principal\",\n+      type = ConfigType.STRING,\n+      defaultValue = \"\",\n+      tags = { ConfigTag.SECURITY, ConfigTag.OZONE },", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NzkwNDIzNg=="}, "originalCommit": {"oid": "6a5481f2cb7bcd2d44e025bc13449eb5380e74ed"}, "originalPosition": 34}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjQwMzE3OTk4OnYy", "diffSide": "RIGHT", "path": "hadoop-hdds/common/src/main/java/org/apache/hadoop/hdds/recon/ReconConfig.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wNFQyMDowNDo0N1rOFx70zA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wNFQyMDozMDo0NVrOFx8klA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NzkwNDcxNg==", "bodyText": "The default value here should be * instead of empty.", "url": "https://github.com/apache/ozone/pull/629#discussion_r387904716", "createdAt": "2020-03-04T20:04:47Z", "author": {"login": "xiaoyuyao"}, "path": "hadoop-hdds/common/src/main/java/org/apache/hadoop/hdds/recon/ReconConfig.java", "diffHunk": "@@ -0,0 +1,84 @@\n+/**\n+ * Licensed to the Apache Software Foundation (ASF) under one\n+ * or more contributor license agreements.  See the NOTICE file\n+ * distributed with this work for additional information\n+ * regarding copyright ownership.  The ASF licenses this file\n+ * to you under the Apache License, Version 2.0 (the\n+ * \"License\"); you may not use this file except in compliance\n+ * with the License.  You may obtain a copy of the License at\n+ * <p>\n+ * http://www.apache.org/licenses/LICENSE-2.0\n+ * <p>\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+package org.apache.hadoop.hdds.recon;\n+\n+import org.apache.hadoop.hdds.conf.Config;\n+import org.apache.hadoop.hdds.conf.ConfigGroup;\n+import org.apache.hadoop.hdds.conf.ConfigTag;\n+import org.apache.hadoop.hdds.conf.ConfigType;\n+\n+/**\n+ * The configuration class for the Recon service.\n+ */\n+@ConfigGroup(prefix = \"ozone.recon\")\n+public class ReconConfig {\n+\n+  @Config(key = \"kerberos.principal\",\n+      type = ConfigType.STRING,\n+      defaultValue = \"\",\n+      tags = { ConfigTag.SECURITY, ConfigTag.OZONE },\n+      description = \"This Kerberos principal is used by the Recon service.\"\n+  )\n+  private String principal;\n+\n+  @Config(key = \"kerberos.keytab.file\",\n+      type = ConfigType.STRING,\n+      defaultValue = \"\",\n+      tags = { ConfigTag.SECURITY, ConfigTag.OZONE },\n+      description = \"The keytab file used by Recon daemon to login as \"+\n+          \"its service principal.\"\n+  )\n+  private String keytab;\n+\n+  @Config(key = \"security.client.datanode.container.protocol.acl\",\n+      type = ConfigType.STRING,\n+      defaultValue = \"\",", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "6a5481f2cb7bcd2d44e025bc13449eb5380e74ed"}, "originalPosition": 50}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NzkxNjk0OA==", "bodyText": "Good catch, will fix it.", "url": "https://github.com/apache/ozone/pull/629#discussion_r387916948", "createdAt": "2020-03-04T20:30:45Z", "author": {"login": "avijayanhwx"}, "path": "hadoop-hdds/common/src/main/java/org/apache/hadoop/hdds/recon/ReconConfig.java", "diffHunk": "@@ -0,0 +1,84 @@\n+/**\n+ * Licensed to the Apache Software Foundation (ASF) under one\n+ * or more contributor license agreements.  See the NOTICE file\n+ * distributed with this work for additional information\n+ * regarding copyright ownership.  The ASF licenses this file\n+ * to you under the Apache License, Version 2.0 (the\n+ * \"License\"); you may not use this file except in compliance\n+ * with the License.  You may obtain a copy of the License at\n+ * <p>\n+ * http://www.apache.org/licenses/LICENSE-2.0\n+ * <p>\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+package org.apache.hadoop.hdds.recon;\n+\n+import org.apache.hadoop.hdds.conf.Config;\n+import org.apache.hadoop.hdds.conf.ConfigGroup;\n+import org.apache.hadoop.hdds.conf.ConfigTag;\n+import org.apache.hadoop.hdds.conf.ConfigType;\n+\n+/**\n+ * The configuration class for the Recon service.\n+ */\n+@ConfigGroup(prefix = \"ozone.recon\")\n+public class ReconConfig {\n+\n+  @Config(key = \"kerberos.principal\",\n+      type = ConfigType.STRING,\n+      defaultValue = \"\",\n+      tags = { ConfigTag.SECURITY, ConfigTag.OZONE },\n+      description = \"This Kerberos principal is used by the Recon service.\"\n+  )\n+  private String principal;\n+\n+  @Config(key = \"kerberos.keytab.file\",\n+      type = ConfigType.STRING,\n+      defaultValue = \"\",\n+      tags = { ConfigTag.SECURITY, ConfigTag.OZONE },\n+      description = \"The keytab file used by Recon daemon to login as \"+\n+          \"its service principal.\"\n+  )\n+  private String keytab;\n+\n+  @Config(key = \"security.client.datanode.container.protocol.acl\",\n+      type = ConfigType.STRING,\n+      defaultValue = \"\",", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NzkwNDcxNg=="}, "originalCommit": {"oid": "6a5481f2cb7bcd2d44e025bc13449eb5380e74ed"}, "originalPosition": 50}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjQwMzE4MjI2OnYy", "diffSide": "RIGHT", "path": "hadoop-hdds/common/src/main/java/org/apache/hadoop/hdds/recon/ReconConfig.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wNFQyMDowNTo0MVrOFx72XA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wNFQyMDowNTo0MVrOFx72XA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NzkwNTExNg==", "bodyText": "Do we miss the getter and setter for the acl?", "url": "https://github.com/apache/ozone/pull/629#discussion_r387905116", "createdAt": "2020-03-04T20:05:41Z", "author": {"login": "xiaoyuyao"}, "path": "hadoop-hdds/common/src/main/java/org/apache/hadoop/hdds/recon/ReconConfig.java", "diffHunk": "@@ -0,0 +1,84 @@\n+/**\n+ * Licensed to the Apache Software Foundation (ASF) under one\n+ * or more contributor license agreements.  See the NOTICE file\n+ * distributed with this work for additional information\n+ * regarding copyright ownership.  The ASF licenses this file\n+ * to you under the Apache License, Version 2.0 (the\n+ * \"License\"); you may not use this file except in compliance\n+ * with the License.  You may obtain a copy of the License at\n+ * <p>\n+ * http://www.apache.org/licenses/LICENSE-2.0\n+ * <p>\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+package org.apache.hadoop.hdds.recon;\n+\n+import org.apache.hadoop.hdds.conf.Config;\n+import org.apache.hadoop.hdds.conf.ConfigGroup;\n+import org.apache.hadoop.hdds.conf.ConfigTag;\n+import org.apache.hadoop.hdds.conf.ConfigType;\n+\n+/**\n+ * The configuration class for the Recon service.\n+ */\n+@ConfigGroup(prefix = \"ozone.recon\")\n+public class ReconConfig {\n+\n+  @Config(key = \"kerberos.principal\",\n+      type = ConfigType.STRING,\n+      defaultValue = \"\",\n+      tags = { ConfigTag.SECURITY, ConfigTag.OZONE },\n+      description = \"This Kerberos principal is used by the Recon service.\"\n+  )\n+  private String principal;\n+\n+  @Config(key = \"kerberos.keytab.file\",\n+      type = ConfigType.STRING,\n+      defaultValue = \"\",\n+      tags = { ConfigTag.SECURITY, ConfigTag.OZONE },\n+      description = \"The keytab file used by Recon daemon to login as \"+\n+          \"its service principal.\"\n+  )\n+  private String keytab;\n+\n+  @Config(key = \"security.client.datanode.container.protocol.acl\",\n+      type = ConfigType.STRING,\n+      defaultValue = \"\",\n+      tags = { ConfigTag.SECURITY, ConfigTag.OZONE },\n+      description = \"\"\n+  )\n+  private String acl;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "6a5481f2cb7bcd2d44e025bc13449eb5380e74ed"}, "originalPosition": 54}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjQwMzE5Mzk5OnYy", "diffSide": "RIGHT", "path": "hadoop-hdds/container-service/src/main/java/org/apache/hadoop/ozone/container/common/statemachine/SCMConnectionManager.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wNFQyMDowOTozMlrOFx794Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wNFQyMDoxMTo0MFrOFx8CCw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NzkwNzA0MQ==", "bodyText": "Given the reuse part is limited, it is better to move the new logic directly into addReconServer without introducing passiveSCM?", "url": "https://github.com/apache/ozone/pull/629#discussion_r387907041", "createdAt": "2020-03-04T20:09:32Z", "author": {"login": "xiaoyuyao"}, "path": "hadoop-hdds/container-service/src/main/java/org/apache/hadoop/ozone/container/common/statemachine/SCMConnectionManager.java", "diffHunk": "@@ -160,22 +161,45 @@ private void addSCMServer(InetSocketAddress address, long sleepTime,\n             \"Ignoring the request.\");\n         return;\n       }\n-      RPC.setProtocolEngine(conf, StorageContainerDatanodeProtocolPB.class,\n-          ProtobufRpcEngine.class);\n-      long version =\n-          RPC.getProtocolVersion(StorageContainerDatanodeProtocolPB.class);\n-\n-      RetryPolicy retryPolicy =\n-          RetryPolicies.retryForeverWithFixedSleep(\n-              sleepTime, TimeUnit.MILLISECONDS);\n-      StorageContainerDatanodeProtocolPB rpcProxy = RPC.getProtocolProxy(\n-          StorageContainerDatanodeProtocolPB.class, version,\n-          address, UserGroupInformation.getCurrentUser(), conf,\n-          NetUtils.getDefaultSocketFactory(conf), getRpcTimeout(),\n-          retryPolicy).getProxy();\n-\n-      StorageContainerDatanodeProtocolClientSideTranslatorPB rpcClient =\n-          new StorageContainerDatanodeProtocolClientSideTranslatorPB(rpcProxy);\n+\n+      StorageContainerDatanodeProtocolClientSideTranslatorPB rpcClient;\n+      if (!passiveScm) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "6a5481f2cb7bcd2d44e025bc13449eb5380e74ed"}, "originalPosition": 30}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NzkwODEwNw==", "bodyText": "Yes, I agree. Will refactor this part.", "url": "https://github.com/apache/ozone/pull/629#discussion_r387908107", "createdAt": "2020-03-04T20:11:40Z", "author": {"login": "avijayanhwx"}, "path": "hadoop-hdds/container-service/src/main/java/org/apache/hadoop/ozone/container/common/statemachine/SCMConnectionManager.java", "diffHunk": "@@ -160,22 +161,45 @@ private void addSCMServer(InetSocketAddress address, long sleepTime,\n             \"Ignoring the request.\");\n         return;\n       }\n-      RPC.setProtocolEngine(conf, StorageContainerDatanodeProtocolPB.class,\n-          ProtobufRpcEngine.class);\n-      long version =\n-          RPC.getProtocolVersion(StorageContainerDatanodeProtocolPB.class);\n-\n-      RetryPolicy retryPolicy =\n-          RetryPolicies.retryForeverWithFixedSleep(\n-              sleepTime, TimeUnit.MILLISECONDS);\n-      StorageContainerDatanodeProtocolPB rpcProxy = RPC.getProtocolProxy(\n-          StorageContainerDatanodeProtocolPB.class, version,\n-          address, UserGroupInformation.getCurrentUser(), conf,\n-          NetUtils.getDefaultSocketFactory(conf), getRpcTimeout(),\n-          retryPolicy).getProxy();\n-\n-      StorageContainerDatanodeProtocolClientSideTranslatorPB rpcClient =\n-          new StorageContainerDatanodeProtocolClientSideTranslatorPB(rpcProxy);\n+\n+      StorageContainerDatanodeProtocolClientSideTranslatorPB rpcClient;\n+      if (!passiveScm) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NzkwNzA0MQ=="}, "originalCommit": {"oid": "6a5481f2cb7bcd2d44e025bc13449eb5380e74ed"}, "originalPosition": 30}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjQwMzIxMTIzOnYy", "diffSide": "LEFT", "path": "hadoop-hdds/server-scm/src/main/java/org/apache/hadoop/hdds/scm/server/SCMDatanodeProtocolServer.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wNFQyMDoxNToxNFrOFx8Iog==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wNFQyMDoxNToxNFrOFx8Iog==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NzkwOTc5NA==", "bodyText": "NIT: can you highlight the changes relate to the issue? Or the change in this file is a refactor?", "url": "https://github.com/apache/ozone/pull/629#discussion_r387909794", "createdAt": "2020-03-04T20:15:14Z", "author": {"login": "xiaoyuyao"}, "path": "hadoop-hdds/server-scm/src/main/java/org/apache/hadoop/hdds/scm/server/SCMDatanodeProtocolServer.java", "diffHunk": "@@ -131,46 +133,24 @@ public SCMDatanodeProtocolServer(final OzoneConfiguration conf,\n \n     this.scm = scm;\n     this.eventPublisher = eventPublisher;\n-    final int handlerCount =\n-        conf.getInt(OZONE_SCM_HANDLER_COUNT_KEY,\n-            OZONE_SCM_HANDLER_COUNT_DEFAULT);\n \n     heartbeatDispatcher = new SCMDatanodeHeartbeatDispatcher(\n         scm.getScmNodeManager(), eventPublisher);\n \n-    RPC.setProtocolEngine(conf, StorageContainerDatanodeProtocolPB.class,", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "6a5481f2cb7bcd2d44e025bc13449eb5380e74ed"}, "originalPosition": 36}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjQwMzIxNjQ4OnYy", "diffSide": "RIGHT", "path": "hadoop-ozone/recon/src/main/java/org/apache/hadoop/ozone/recon/ReconServer.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wNFQyMDoxNzowNlrOFx8L_w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wNFQyMDoxNzowNlrOFx8L_w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NzkxMDY1NQ==", "bodyText": "NIT: \"Recon user\" => \"Recon service\"", "url": "https://github.com/apache/ozone/pull/629#discussion_r387910655", "createdAt": "2020-03-04T20:17:06Z", "author": {"login": "xiaoyuyao"}, "path": "hadoop-ozone/recon/src/main/java/org/apache/hadoop/ozone/recon/ReconServer.java", "diffHunk": "@@ -179,21 +179,21 @@ private static void loginReconUser(OzoneConfiguration conf)\n \n     if (SecurityUtil.getAuthenticationMethod(conf).equals(\n         UserGroupInformation.AuthenticationMethod.KERBEROS)) {\n-\n+      ReconConfig reconConfig = conf.getObject(ReconConfig.class);\n       LOG.info(\"Ozone security is enabled. Attempting login for Recon user. \"", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "6a5481f2cb7bcd2d44e025bc13449eb5380e74ed"}, "originalPosition": 31}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjQwMzIyMDcwOnYy", "diffSide": "RIGHT", "path": "hadoop-ozone/recon/src/main/java/org/apache/hadoop/ozone/recon/scm/ReconContainerManager.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wNFQyMDoxODozOVrOFx8OzA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wNFQyMDoxODozOVrOFx8OzA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NzkxMTM3Mg==", "bodyText": "datanodeDetails toString is very verbose. You may choose to just log the hostname/ip here.", "url": "https://github.com/apache/ozone/pull/629#discussion_r387911372", "createdAt": "2020-03-04T20:18:39Z", "author": {"login": "xiaoyuyao"}, "path": "hadoop-ozone/recon/src/main/java/org/apache/hadoop/ozone/recon/scm/ReconContainerManager.java", "diffHunk": "@@ -64,6 +69,22 @@ protected File getContainerDBPath(Configuration conf) {\n     return new File(metaDir, RECON_SCM_CONTAINER_DB);\n   }\n \n+  public void checkAndAddNewContainer(ContainerID containerID,\n+                                      DatanodeDetails datanodeDetails)\n+      throws IOException {\n+    if (!exists(containerID)) {\n+      LOG.info(\"New container {} got from {}.\", containerID, datanodeDetails);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "6a5481f2cb7bcd2d44e025bc13449eb5380e74ed"}, "originalPosition": 43}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjQwMzI1MTQ3OnYy", "diffSide": "RIGHT", "path": "hadoop-hdds/server-scm/src/main/java/org/apache/hadoop/hdds/scm/server/SCMDatanodeProtocolServer.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wNFQyMDoyOToxMVrOFx8hiA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wNFQyMTozNzoyNVrOFx-h9Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NzkxNjE2OA==", "bodyText": "NIT: If we add a parameter Class<?> protocol for protocol? we don't need to overwrite getRpcServer in ReconDatanodeProtocolServer class.", "url": "https://github.com/apache/ozone/pull/629#discussion_r387916168", "createdAt": "2020-03-04T20:29:11Z", "author": {"login": "xiaoyuyao"}, "path": "hadoop-hdds/server-scm/src/main/java/org/apache/hadoop/hdds/scm/server/SCMDatanodeProtocolServer.java", "diffHunk": "@@ -407,14 +387,48 @@ private static String flatten(String input) {\n         .replaceAll(\" +\", \" \");\n   }\n \n-  protected String getScmDatanodeAddressKey() {\n+  protected RPC.Server getRpcServer(OzoneConfiguration conf,\n+      InetSocketAddress datanodeRpcAddr,", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "6a5481f2cb7bcd2d44e025bc13449eb5380e74ed"}, "originalPosition": 85}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4Nzk0OTA0NQ==", "bodyText": "@xiaoyuyao I have refactored this a little bit differently. Please let me know if this is OK.", "url": "https://github.com/apache/ozone/pull/629#discussion_r387949045", "createdAt": "2020-03-04T21:37:25Z", "author": {"login": "avijayanhwx"}, "path": "hadoop-hdds/server-scm/src/main/java/org/apache/hadoop/hdds/scm/server/SCMDatanodeProtocolServer.java", "diffHunk": "@@ -407,14 +387,48 @@ private static String flatten(String input) {\n         .replaceAll(\" +\", \" \");\n   }\n \n-  protected String getScmDatanodeAddressKey() {\n+  protected RPC.Server getRpcServer(OzoneConfiguration conf,\n+      InetSocketAddress datanodeRpcAddr,", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NzkxNjE2OA=="}, "originalCommit": {"oid": "6a5481f2cb7bcd2d44e025bc13449eb5380e74ed"}, "originalPosition": 85}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4951, "cost": 1, "resetAt": "2021-11-12T11:57:46Z"}}}