{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDMyNzYwNDAz", "number": 1053, "title": "HDDS-3737. Avoid serialization between UUID and String", "bodyText": "What changes were proposed in this pull request?\nWhat's the problem ?\nSerialization between UUID and String: UUID.toString and UUID.fromString, not only cost cpu, because encode/decode String and UUID.fromString/UUID.toString both cost cpu, but also make the proto bigger, because uuid is just a number which is 16Byte, covet it to string need 32Byte.\nHow to fix ?\nConvert UUID to 2 long number in proto, which make serialization and deserialization UUID  faster, and make proto smaller. As the image shows, JDK implement UUID with two long number: mostSigBits and leastSigBits, when UUID.fromString, JDK get mostSigBits and leastSigBits from String, and new a object of UUID, so we can covert UUID to 2 long number directly.\nI only change 3 places of UUID which is  hot spot.\n\n\nWhat is the link to the Apache JIRA\nhttps://issues.apache.org/jira/browse/HDDS-3763\nHow was this patch tested?\nExisted tests.", "createdAt": "2020-06-10T23:55:51Z", "url": "https://github.com/apache/ozone/pull/1053", "merged": true, "mergeCommit": {"oid": "b4798cd58a1a52a117ef606956f0cc4a9efa4370"}, "closed": true, "closedAt": "2020-07-02T16:56:57Z", "author": {"login": "runzhiwang"}, "timelineItems": {"totalCount": 11, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcqCvWlABqjM0MzE4ODM3NTk=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcxB1hOAFqTQ0MTg3MTE3OA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "6aa2c1490d47638ca898d09467096512e818b476", "author": {"user": {"login": "runzhiwang", "name": null}}, "url": "https://github.com/apache/ozone/commit/6aa2c1490d47638ca898d09467096512e818b476", "committedDate": "2020-06-10T23:46:16Z", "message": "HDDS-3737. Avoid serialization between UUID and String"}, "afterCommit": {"oid": "aab5dc910a1bbe66a379da44bf3b521d0b44711c", "author": {"user": {"login": "runzhiwang", "name": null}}, "url": "https://github.com/apache/ozone/commit/aab5dc910a1bbe66a379da44bf3b521d0b44711c", "committedDate": "2020-06-11T00:03:00Z", "message": "HDDS-3737. Avoid serialization between UUID and String"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "aab5dc910a1bbe66a379da44bf3b521d0b44711c", "author": {"user": {"login": "runzhiwang", "name": null}}, "url": "https://github.com/apache/ozone/commit/aab5dc910a1bbe66a379da44bf3b521d0b44711c", "committedDate": "2020-06-11T00:03:00Z", "message": "HDDS-3737. Avoid serialization between UUID and String"}, "afterCommit": {"oid": "a378929b4e731407f9939464e27c30a387124451", "author": {"user": {"login": "runzhiwang", "name": null}}, "url": "https://github.com/apache/ozone/commit/a378929b4e731407f9939464e27c30a387124451", "committedDate": "2020-06-11T00:24:34Z", "message": "HDDS-3737. Avoid serialization between UUID and String"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "a378929b4e731407f9939464e27c30a387124451", "author": {"user": {"login": "runzhiwang", "name": null}}, "url": "https://github.com/apache/ozone/commit/a378929b4e731407f9939464e27c30a387124451", "committedDate": "2020-06-11T00:24:34Z", "message": "HDDS-3737. Avoid serialization between UUID and String"}, "afterCommit": {"oid": "5652ea1160b646a8e48bf142dac1166d809ea7cc", "author": {"user": {"login": "runzhiwang", "name": null}}, "url": "https://github.com/apache/ozone/commit/5652ea1160b646a8e48bf142dac1166d809ea7cc", "committedDate": "2020-06-11T11:47:03Z", "message": "HDDS-3737. Avoid serialization between UUID and String"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "86f966375b7767c3b7adf7db1c86c7c3eaea9e33", "author": {"user": {"login": "runzhiwang", "name": null}}, "url": "https://github.com/apache/ozone/commit/86f966375b7767c3b7adf7db1c86c7c3eaea9e33", "committedDate": "2020-06-11T13:21:22Z", "message": "triger ci"}, "afterCommit": {"oid": "c9d2cb3031bff71b00d4378a065fcf734f0f7444", "author": {"user": {"login": "runzhiwang", "name": null}}, "url": "https://github.com/apache/ozone/commit/c9d2cb3031bff71b00d4378a065fcf734f0f7444", "committedDate": "2020-06-11T23:55:07Z", "message": "triger ci"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDMxNzY3MzAx", "url": "https://github.com/apache/ozone/pull/1053#pullrequestreview-431767301", "createdAt": "2020-06-16T18:10:31Z", "commit": {"oid": "c9d2cb3031bff71b00d4378a065fcf734f0f7444"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xNlQxODoxMDozMVrOGknUKg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xNlQxODoxMDozMVrOGknUKg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTA0NjA1OA==", "bodyText": "Correct me if I'm wrong, with current approach, the improvement will be limited as fromProtoBuf to String will prefer process UUID before ID128. And to protoBuf will need to add both String version of UUID and the long/long version of uuid 128.", "url": "https://github.com/apache/ozone/pull/1053#discussion_r441046058", "createdAt": "2020-06-16T18:10:31Z", "author": {"login": "xiaoyuyao"}, "path": "hadoop-hdds/common/src/main/java/org/apache/hadoop/hdds/scm/pipeline/Pipeline.java", "diffHunk": "@@ -301,14 +306,21 @@ public static Pipeline getFromProtobuf(HddsProtos.Pipeline pipeline)\n     for (DatanodeDetailsProto member : pipeline.getMembersList()) {\n       nodes.add(DatanodeDetails.getFromProtoBuf(member));\n     }\n+    UUID leaderId = null;\n+    if (pipeline.hasLeaderID() &&\n+        StringUtils.isNotEmpty(pipeline.getLeaderID())) {\n+      leaderId = UUID.fromString(pipeline.getLeaderID());", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c9d2cb3031bff71b00d4378a065fcf734f0f7444"}, "originalPosition": 45}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDM5ODI2MDkw", "url": "https://github.com/apache/ozone/pull/1053#pullrequestreview-439826090", "createdAt": "2020-06-30T09:14:38Z", "commit": {"oid": "c9d2cb3031bff71b00d4378a065fcf734f0f7444"}, "state": "DISMISSED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "0800726ab023371b87cbba15bc38ee966a27344c", "author": {"user": {"login": "runzhiwang", "name": null}}, "url": "https://github.com/apache/ozone/commit/0800726ab023371b87cbba15bc38ee966a27344c", "committedDate": "2020-06-30T09:49:15Z", "message": "HDDS-3737. Avoid serialization between UUID and String"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "469285404325e3bcf7c6f1f9594ea4e502917b47", "author": {"user": {"login": "runzhiwang", "name": null}}, "url": "https://github.com/apache/ozone/commit/469285404325e3bcf7c6f1f9594ea4e502917b47", "committedDate": "2020-06-30T09:49:15Z", "message": "fix code review"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "9330e4c3cbb7f15784fe9eb71552ffa88919d27f", "author": {"user": {"login": "runzhiwang", "name": null}}, "url": "https://github.com/apache/ozone/commit/9330e4c3cbb7f15784fe9eb71552ffa88919d27f", "committedDate": "2020-06-30T09:43:23Z", "message": "fix code review"}, "afterCommit": {"oid": "469285404325e3bcf7c6f1f9594ea4e502917b47", "author": {"user": {"login": "runzhiwang", "name": null}}, "url": "https://github.com/apache/ozone/commit/469285404325e3bcf7c6f1f9594ea4e502917b47", "committedDate": "2020-06-30T09:49:15Z", "message": "fix code review"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "15310ad56061c08fb6eb1630d68dc06813bfaa07", "author": {"user": {"login": "runzhiwang", "name": null}}, "url": "https://github.com/apache/ozone/commit/15310ad56061c08fb6eb1630d68dc06813bfaa07", "committedDate": "2020-06-30T10:52:02Z", "message": "triger ci"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDQxODcxMTc4", "url": "https://github.com/apache/ozone/pull/1053#pullrequestreview-441871178", "createdAt": "2020-07-02T16:56:44Z", "commit": {"oid": "15310ad56061c08fb6eb1630d68dc06813bfaa07"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3176, "cost": 1, "resetAt": "2021-10-28T18:00:02Z"}}}