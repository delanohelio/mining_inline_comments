{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDI3OTU5ODM5", "number": 1023, "reviewThreads": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0zMFQyMjoxNjo1MlrOEKS7Eg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0zMFQyMjoxOTo0MlrOEKS9qw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjc5MjMxMjUwOnYy", "diffSide": "RIGHT", "path": "hadoop-ozone/common/src/main/java/org/apache/hadoop/ozone/om/helpers/OmKeyLocationInfoGroup.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0zMFQyMjoxNjo1MlrOGrQYTA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wNFQxNDowNjowOVrOGs8KBQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0ODAxMDMxNg==", "bodyText": "should we change the order of 47/49 so that there is always an ArrayList for the version and the locations is added to that arraylist.", "url": "https://github.com/apache/ozone/pull/1023#discussion_r448010316", "createdAt": "2020-06-30T22:16:52Z", "author": {"login": "xiaoyuyao"}, "path": "hadoop-ozone/common/src/main/java/org/apache/hadoop/ozone/om/helpers/OmKeyLocationInfoGroup.java", "diffHunk": "@@ -30,12 +30,23 @@\n  */\n public class OmKeyLocationInfoGroup {\n   private final long version;\n-  private final List<OmKeyLocationInfo> locationList;\n+  private final Map<Long, List<OmKeyLocationInfo>> locationVersionList;\n \n   public OmKeyLocationInfoGroup(long version,\n                                 List<OmKeyLocationInfo> locations) {\n     this.version = version;\n-    this.locationList = locations;\n+    this.locationVersionList = locations.stream()\n+        .collect(Collectors.groupingBy(OmKeyLocationInfo::getCreateVersion));\n+    //prevent NPE\n+    this.locationVersionList.putIfAbsent(version, new ArrayList<>());\n+  }\n+\n+  public OmKeyLocationInfoGroup(long version,\n+                                Map<Long, List<OmKeyLocationInfo>> locations) {\n+    this.version = version;\n+    this.locationVersionList = locations;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "686dcfb858e8432d69b90010b03d7b5410896024"}, "originalPosition": 35}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0OTc3NjEzMw==", "bodyText": "It will cause a redundant instantiation of the map and provides no benefit because the map reassigned by the constructor parameter.", "url": "https://github.com/apache/ozone/pull/1023#discussion_r449776133", "createdAt": "2020-07-04T14:06:09Z", "author": {"login": "esahekmat"}, "path": "hadoop-ozone/common/src/main/java/org/apache/hadoop/ozone/om/helpers/OmKeyLocationInfoGroup.java", "diffHunk": "@@ -30,12 +30,23 @@\n  */\n public class OmKeyLocationInfoGroup {\n   private final long version;\n-  private final List<OmKeyLocationInfo> locationList;\n+  private final Map<Long, List<OmKeyLocationInfo>> locationVersionList;\n \n   public OmKeyLocationInfoGroup(long version,\n                                 List<OmKeyLocationInfo> locations) {\n     this.version = version;\n-    this.locationList = locations;\n+    this.locationVersionList = locations.stream()\n+        .collect(Collectors.groupingBy(OmKeyLocationInfo::getCreateVersion));\n+    //prevent NPE\n+    this.locationVersionList.putIfAbsent(version, new ArrayList<>());\n+  }\n+\n+  public OmKeyLocationInfoGroup(long version,\n+                                Map<Long, List<OmKeyLocationInfo>> locations) {\n+    this.version = version;\n+    this.locationVersionList = locations;", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0ODAxMDMxNg=="}, "originalCommit": {"oid": "686dcfb858e8432d69b90010b03d7b5410896024"}, "originalPosition": 35}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjc5MjMxOTE1OnYy", "diffSide": "RIGHT", "path": "hadoop-ozone/common/src/main/java/org/apache/hadoop/ozone/om/helpers/OmKeyLocationInfoGroup.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0zMFQyMjoxOTo0MlrOGrQcXw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wNFQxNDowNzoxN1rOGs8KVQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0ODAxMTM1OQ==", "bodyText": "NIT: should we rename to locationVersionMap to avoid confusion?", "url": "https://github.com/apache/ozone/pull/1023#discussion_r448011359", "createdAt": "2020-06-30T22:19:42Z", "author": {"login": "xiaoyuyao"}, "path": "hadoop-ozone/common/src/main/java/org/apache/hadoop/ozone/om/helpers/OmKeyLocationInfoGroup.java", "diffHunk": "@@ -30,12 +30,23 @@\n  */\n public class OmKeyLocationInfoGroup {\n   private final long version;\n-  private final List<OmKeyLocationInfo> locationList;\n+  private final Map<Long, List<OmKeyLocationInfo>> locationVersionList;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "686dcfb858e8432d69b90010b03d7b5410896024"}, "originalPosition": 20}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0OTc3NjIxMw==", "bodyText": "Sure, I will change it", "url": "https://github.com/apache/ozone/pull/1023#discussion_r449776213", "createdAt": "2020-07-04T14:07:17Z", "author": {"login": "esahekmat"}, "path": "hadoop-ozone/common/src/main/java/org/apache/hadoop/ozone/om/helpers/OmKeyLocationInfoGroup.java", "diffHunk": "@@ -30,12 +30,23 @@\n  */\n public class OmKeyLocationInfoGroup {\n   private final long version;\n-  private final List<OmKeyLocationInfo> locationList;\n+  private final Map<Long, List<OmKeyLocationInfo>> locationVersionList;", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0ODAxMTM1OQ=="}, "originalCommit": {"oid": "686dcfb858e8432d69b90010b03d7b5410896024"}, "originalPosition": 20}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4225, "cost": 1, "resetAt": "2021-11-12T11:57:46Z"}}}