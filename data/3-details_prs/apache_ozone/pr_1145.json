{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDQxMjA2ODY2", "number": 1145, "title": "HDDS-3895. Implement container related operations in ContainerManagerImpl", "bodyText": "What changes were proposed in this pull request?\nSCM HA uses the new ContainerManagerImpl. This change introduces container related operations in ContainerManagerImpl.\nWhat is the link to the Apache JIRA\nHDDS-3895\nHow was this patch tested?\nUnit test will be added as part of HDDS-3896", "createdAt": "2020-06-29T05:36:15Z", "url": "https://github.com/apache/ozone/pull/1145", "merged": true, "mergeCommit": {"oid": "0f64aabd355f28e67976df8ef54de63719ce329a"}, "closed": true, "closedAt": "2020-08-24T06:10:32Z", "author": {"login": "nandakumar131"}, "timelineItems": {"totalCount": 15, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcwIDvBAFqTQzOTUxODkxMw==", "endCursor": "Y3Vyc29yOnYyOpPPAAABdAqm2cgFqTQ3MTI5NDQ4OQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDM5NTE4OTEz", "url": "https://github.com/apache/ozone/pull/1145#pullrequestreview-439518913", "createdAt": "2020-06-29T21:37:46Z", "commit": {"oid": "5c96c3bba3241e9756621245e171f8f87053a746"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yOVQyMTozNzo0NlrOGqjIXg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yOVQyMTozNzo0NlrOGqjIXg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NzI2ODk1OA==", "bodyText": "Need to hold the writeLock?", "url": "https://github.com/apache/ozone/pull/1145#discussion_r447268958", "createdAt": "2020-06-29T21:37:46Z", "author": {"login": "xiaoyuyao"}, "path": "hadoop-hdds/server-scm/src/main/java/org/apache/hadoop/hdds/scm/container/ContainerManagerImpl.java", "diffHunk": "@@ -279,6 +257,24 @@ public void notifyContainerReportProcessing(final boolean isFullReport,\n     throw new UnsupportedOperationException(\"Not yet implemented!\");\n   }\n \n+  @Override\n+  public void deleteContainer(final ContainerID containerID)\n+      throws IOException {\n+    final HddsProtos.ContainerID id = containerID.getProtobuf();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "5c96c3bba3241e9756621245e171f8f87053a746"}, "originalPosition": 249}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDM5NTE5MDU2", "url": "https://github.com/apache/ozone/pull/1145#pullrequestreview-439519056", "createdAt": "2020-06-29T21:38:01Z", "commit": {"oid": "5c96c3bba3241e9756621245e171f8f87053a746"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yOVQyMTozODowMVrOGqjI3g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yOVQyMTozODowMVrOGqjI3g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NzI2OTA4Ng==", "bodyText": "Can we use checkIfContainerExist()?", "url": "https://github.com/apache/ozone/pull/1145#discussion_r447269086", "createdAt": "2020-06-29T21:38:01Z", "author": {"login": "xiaoyuyao"}, "path": "hadoop-hdds/server-scm/src/main/java/org/apache/hadoop/hdds/scm/container/ContainerManagerImpl.java", "diffHunk": "@@ -279,6 +257,24 @@ public void notifyContainerReportProcessing(final boolean isFullReport,\n     throw new UnsupportedOperationException(\"Not yet implemented!\");\n   }\n \n+  @Override\n+  public void deleteContainer(final ContainerID containerID)\n+      throws IOException {\n+    final HddsProtos.ContainerID id = containerID.getProtobuf();\n+    if (!containerStateManager.contains(id)) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "5c96c3bba3241e9756621245e171f8f87053a746"}, "originalPosition": 250}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "5c96c3bba3241e9756621245e171f8f87053a746", "author": {"user": {"login": "nandakumar131", "name": "Nandakumar"}}, "url": "https://github.com/apache/ozone/commit/5c96c3bba3241e9756621245e171f8f87053a746", "committedDate": "2020-06-29T05:31:46Z", "message": "HDDS-3895. Implement container related operations in ContainerManagerImpl."}, "afterCommit": {"oid": "4ad25999f3946d342f75d177298928ec008afd76", "author": {"user": {"login": "nandakumar131", "name": "Nandakumar"}}, "url": "https://github.com/apache/ozone/commit/4ad25999f3946d342f75d177298928ec008afd76", "committedDate": "2020-06-30T18:33:26Z", "message": "HDDS-3895. Implement container related operations in ContainerManagerImpl."}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "4ad25999f3946d342f75d177298928ec008afd76", "author": {"user": {"login": "nandakumar131", "name": "Nandakumar"}}, "url": "https://github.com/apache/ozone/commit/4ad25999f3946d342f75d177298928ec008afd76", "committedDate": "2020-06-30T18:33:26Z", "message": "HDDS-3895. Implement container related operations in ContainerManagerImpl."}, "afterCommit": {"oid": "3b961ec50164e34d88657d4dfcf8a46965773479", "author": {"user": {"login": "nandakumar131", "name": "Nandakumar"}}, "url": "https://github.com/apache/ozone/commit/3b961ec50164e34d88657d4dfcf8a46965773479", "committedDate": "2020-06-30T18:39:09Z", "message": "HDDS-3895. Implement container related operations in ContainerManagerImpl."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDQxOTIyMzMy", "url": "https://github.com/apache/ozone/pull/1145#pullrequestreview-441922332", "createdAt": "2020-07-02T18:13:43Z", "commit": {"oid": "3b961ec50164e34d88657d4dfcf8a46965773479"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wMlQxODoxMzo0NFrOGsYbjg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wMlQxODoxMzo0NFrOGsYbjg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0OTE5MDc5OA==", "bodyText": "NIT: can we use a different name startId and startID is confusing.", "url": "https://github.com/apache/ozone/pull/1145#discussion_r449190798", "createdAt": "2020-07-02T18:13:44Z", "author": {"login": "xiaoyuyao"}, "path": "hadoop-hdds/server-scm/src/main/java/org/apache/hadoop/hdds/scm/container/ContainerManagerImpl.java", "diffHunk": "@@ -93,94 +98,45 @@ public ContainerManagerImpl(\n   }\n \n   @Override\n-  public Set<ContainerID> getContainerIDs() {\n-    lock.readLock().lock();\n-    try {\n-      return containerStateManager.getContainerIDs();\n-    } finally {\n-      lock.readLock().unlock();\n-    }\n-  }\n-\n-  @Override\n-  public Set<ContainerInfo> getContainers() {\n-    lock.readLock().lock();\n-    try {\n-      return containerStateManager.getContainerIDs().stream().map(id -> {\n-        try {\n-          return containerStateManager.getContainer(id);\n-        } catch (ContainerNotFoundException e) {\n-          // How can this happen? o_O\n-          return null;\n-        }\n-      }).filter(Objects::nonNull).collect(Collectors.toSet());\n-    } finally {\n-      lock.readLock().unlock();\n-    }\n-  }\n-\n-  @Override\n-  public ContainerInfo getContainer(final ContainerID containerID)\n+  public ContainerInfo getContainer(final ContainerID id)\n       throws ContainerNotFoundException {\n     lock.readLock().lock();\n     try {\n-      return containerStateManager.getContainer(containerID);\n+      return Optional.ofNullable(containerStateManager\n+          .getContainer(id.getProtobuf()))\n+          .orElseThrow(() -> new ContainerNotFoundException(\"ID \" + id));\n     } finally {\n       lock.readLock().unlock();\n     }\n   }\n \n   @Override\n-  public Set<ContainerInfo> getContainers(final LifeCycleState state) {\n-    lock.readLock().lock();\n-    try {\n-      return containerStateManager.getContainerIDs(state).stream().map(id -> {\n-        try {\n-          return containerStateManager.getContainer(id);\n-        } catch (ContainerNotFoundException e) {\n-          // How can this happen? o_O\n-          return null;\n-        }\n-      }).filter(Objects::nonNull).collect(Collectors.toSet());\n-    } finally {\n-      lock.readLock().unlock();\n-    }\n-  }\n-\n-  @Override\n-  public boolean exists(final ContainerID containerID) {\n+  public List<ContainerInfo> listContainers(final ContainerID startID,\n+                                            final int count) {\n     lock.readLock().lock();\n     try {\n-      return (containerStateManager.getContainer(containerID) != null);\n-    } catch (ContainerNotFoundException ex) {\n-      return false;\n+      final long startId = startID == null ? 0 : startID.getId();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "3b961ec50164e34d88657d4dfcf8a46965773479"}, "originalPosition": 104}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDQyMDUxNTM1", "url": "https://github.com/apache/ozone/pull/1145#pullrequestreview-442051535", "createdAt": "2020-07-02T22:26:34Z", "commit": {"oid": "3b961ec50164e34d88657d4dfcf8a46965773479"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wMlQyMjoyNjozNFrOGseoeQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wMlQyMjoyNjozNFrOGseoeQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0OTI5MjQwOQ==", "bodyText": "NIT: javadoc update @throws", "url": "https://github.com/apache/ozone/pull/1145#discussion_r449292409", "createdAt": "2020-07-02T22:26:34Z", "author": {"login": "xiaoyuyao"}, "path": "hadoop-hdds/server-scm/src/main/java/org/apache/hadoop/hdds/scm/container/ContainerManagerV2.java", "diffHunk": "@@ -113,7 +90,7 @@ void deleteContainer(ContainerID containerID)\n    */\n   void updateContainerState(ContainerID containerID,\n                             LifeCycleEvent event)\n-      throws ContainerNotFoundException;\n+      throws IOException, InvalidStateTransitionException;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "3b961ec50164e34d88657d4dfcf8a46965773479"}, "originalPosition": 88}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDQyMDY1MTUy", "url": "https://github.com/apache/ozone/pull/1145#pullrequestreview-442065152", "createdAt": "2020-07-02T23:12:18Z", "commit": {"oid": "3b961ec50164e34d88657d4dfcf8a46965773479"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wMlQyMzoxMjoxOVrOGsfXow==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wMlQyMzoxMjoxOVrOGsfXow==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0OTMwNDQ4Mw==", "bodyText": "Same question here. I see we have a RWLock in ContainerMangerImpl and one RWLock in ContainerStateManager. Can we rely only on the lock in ContainerStateManager?", "url": "https://github.com/apache/ozone/pull/1145#discussion_r449304483", "createdAt": "2020-07-02T23:12:19Z", "author": {"login": "xiaoyuyao"}, "path": "hadoop-hdds/server-scm/src/main/java/org/apache/hadoop/hdds/scm/container/ContainerManagerImpl.java", "diffHunk": "@@ -60,6 +64,7 @@\n   /**\n    *\n    */\n+  //Can we move this lock to ContainerStateManager?", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "3b961ec50164e34d88657d4dfcf8a46965773479"}, "originalPosition": 29}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDQyMDcwNzA0", "url": "https://github.com/apache/ozone/pull/1145#pullrequestreview-442070704", "createdAt": "2020-07-02T23:33:08Z", "commit": {"oid": "3b961ec50164e34d88657d4dfcf8a46965773479"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wMlQyMzozMzowOFrOGsfqsg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wMlQyMzozMzowOFrOGsfqsg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0OTMwOTM2Mg==", "bodyText": "Can we add unit test if any the updateContainerState with @replicate?", "url": "https://github.com/apache/ozone/pull/1145#discussion_r449309362", "createdAt": "2020-07-02T23:33:08Z", "author": {"login": "xiaoyuyao"}, "path": "hadoop-hdds/server-scm/src/main/java/org/apache/hadoop/hdds/scm/container/ContainerStateManagerV2.java", "diffHunk": "@@ -130,6 +141,21 @@ ContainerInfo getContainer(ContainerID containerID)\n   void addContainer(ContainerInfoProto containerInfo)\n       throws IOException;\n \n+  /**\n+   *\n+   */\n+  @Replicate\n+  void updateContainerState(HddsProtos.ContainerID id,", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "3b961ec50164e34d88657d4dfcf8a46965773479"}, "originalPosition": 62}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDQyMDcwODMz", "url": "https://github.com/apache/ozone/pull/1145#pullrequestreview-442070833", "createdAt": "2020-07-02T23:33:42Z", "commit": {"oid": "3b961ec50164e34d88657d4dfcf8a46965773479"}, "state": "COMMENTED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "3b961ec50164e34d88657d4dfcf8a46965773479", "author": {"user": {"login": "nandakumar131", "name": "Nandakumar"}}, "url": "https://github.com/apache/ozone/commit/3b961ec50164e34d88657d4dfcf8a46965773479", "committedDate": "2020-06-30T18:39:09Z", "message": "HDDS-3895. Implement container related operations in ContainerManagerImpl."}, "afterCommit": {"oid": "2e6e5758ce701bbc17b30d03383838aa9dd82a7e", "author": {"user": {"login": "nandakumar131", "name": "Nandakumar"}}, "url": "https://github.com/apache/ozone/commit/2e6e5758ce701bbc17b30d03383838aa9dd82a7e", "committedDate": "2020-07-22T16:28:13Z", "message": "HDDS-3895. Implement container related operations in ContainerManagerImpl."}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "2e6e5758ce701bbc17b30d03383838aa9dd82a7e", "author": {"user": {"login": "nandakumar131", "name": "Nandakumar"}}, "url": "https://github.com/apache/ozone/commit/2e6e5758ce701bbc17b30d03383838aa9dd82a7e", "committedDate": "2020-07-22T16:28:13Z", "message": "HDDS-3895. Implement container related operations in ContainerManagerImpl."}, "afterCommit": {"oid": "88da682be1997106f2f0c637f53480fa588ba886", "author": {"user": {"login": "nandakumar131", "name": "Nandakumar"}}, "url": "https://github.com/apache/ozone/commit/88da682be1997106f2f0c637f53480fa588ba886", "committedDate": "2020-08-11T15:22:33Z", "message": "HDDS-3895. Implement container related operations in ContainerManagerImpl."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "bc5f64834f7be8d4e74105b1561475b8ad902759", "author": {"user": {"login": "nandakumar131", "name": "Nandakumar"}}, "url": "https://github.com/apache/ozone/commit/bc5f64834f7be8d4e74105b1561475b8ad902759", "committedDate": "2020-08-19T09:32:36Z", "message": "HDDS-3895. Implement container related operations in ContainerManagerImpl."}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "86c3a9f5263c645506ad8ca82b13c73c9439ba9b", "author": {"user": {"login": "nandakumar131", "name": "Nandakumar"}}, "url": "https://github.com/apache/ozone/commit/86c3a9f5263c645506ad8ca82b13c73c9439ba9b", "committedDate": "2020-08-12T14:16:24Z", "message": "HDDS-3895. Fixed unit test failures."}, "afterCommit": {"oid": "bc5f64834f7be8d4e74105b1561475b8ad902759", "author": {"user": {"login": "nandakumar131", "name": "Nandakumar"}}, "url": "https://github.com/apache/ozone/commit/bc5f64834f7be8d4e74105b1561475b8ad902759", "committedDate": "2020-08-19T09:32:36Z", "message": "HDDS-3895. Implement container related operations in ContainerManagerImpl."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDcxMjkzNjE1", "url": "https://github.com/apache/ozone/pull/1145#pullrequestreview-471293615", "createdAt": "2020-08-20T06:53:59Z", "commit": {"oid": "bc5f64834f7be8d4e74105b1561475b8ad902759"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yMFQwNjo1Mzo1OVrOHDuNsg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yMFQwNjo1Mzo1OVrOHDuNsg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MzY2NDk0Ng==", "bodyText": "Show we update containerStore as well ?", "url": "https://github.com/apache/ozone/pull/1145#discussion_r473664946", "createdAt": "2020-08-20T06:53:59Z", "author": {"login": "GlenGeng"}, "path": "hadoop-hdds/server-scm/src/main/java/org/apache/hadoop/hdds/scm/container/ContainerStateManagerImpl.java", "diffHunk": "@@ -291,23 +328,14 @@ ContainerInfo getMatchingContainer(final long size, String owner,\n     throw new UnsupportedOperationException(\"Not yet implemented!\");\n   }\n \n-\n   NavigableSet<ContainerID> getMatchingContainerIDs(final String owner,\n       final ReplicationType type, final ReplicationFactor factor,\n       final LifeCycleState state) {\n     throw new UnsupportedOperationException(\"Not yet implemented!\");\n   }\n \n-  void removeContainerReplica(final ContainerID containerID,\n-                              final ContainerReplica replica)\n-      throws ContainerNotFoundException, ContainerReplicaNotFoundException {\n-    throw new UnsupportedOperationException(\"Not yet implemented!\");\n-  }\n-\n-\n-  void removeContainer(final ContainerID containerID)\n-      throws ContainerNotFoundException {\n-    throw new UnsupportedOperationException(\"Not yet implemented!\");\n+  public void removeContainer(final HddsProtos.ContainerID id) {\n+    containers.removeContainer(ContainerID.getFromProtobuf(id));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "bc5f64834f7be8d4e74105b1561475b8ad902759"}, "originalPosition": 301}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDcxMjk0NDg5", "url": "https://github.com/apache/ozone/pull/1145#pullrequestreview-471294489", "createdAt": "2020-08-20T06:55:41Z", "commit": {"oid": "bc5f64834f7be8d4e74105b1561475b8ad902759"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yMFQwNjo1NTo0MVrOHDuSmA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yMFQwNjo1NTo0MVrOHDuSmA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MzY2NjIwMA==", "bodyText": "Show we update containerStore as well ?", "url": "https://github.com/apache/ozone/pull/1145#discussion_r473666200", "createdAt": "2020-08-20T06:55:41Z", "author": {"login": "GlenGeng"}, "path": "hadoop-hdds/server-scm/src/main/java/org/apache/hadoop/hdds/scm/container/ContainerStateManagerImpl.java", "diffHunk": "@@ -254,32 +260,63 @@ public void addContainer(final ContainerInfoProto containerInfo)\n     final ContainerID containerID = container.containerID();\n     final PipelineID pipelineID = container.getPipelineID();\n \n-    /*\n-     * TODO:\n-     *  Check if the container already exist in in ContainerStateManager.\n-     *  This optimization can be done after moving ContainerNotFoundException\n-     *  from ContainerStateMap to ContainerManagerImpl.\n-     */\n+    if (!containers.contains(containerID)) {\n+      containerStore.put(containerID, container);\n+      try {\n+        containers.addContainer(container);\n+        pipelineManager.addContainerToPipeline(pipelineID, containerID);\n+      } catch (Exception ex) {\n+        containers.removeContainer(containerID);\n+        containerStore.delete(containerID);\n+        throw ex;\n+      }\n+    }\n+  }\n \n-    containerStore.put(containerID, container);\n-    containers.addContainer(container);\n-    pipelineManager.addContainerToPipeline(pipelineID, containerID);\n-    nextContainerID.incrementAndGet();\n+  @Override\n+  public boolean contains(final HddsProtos.ContainerID id) {\n+    // TODO: Remove the protobuf conversion after fixing ContainerStateMap.\n+    return containers.contains(ContainerID.getFromProtobuf(id));\n   }\n \n-  void updateContainerState(final ContainerID containerID,\n-                            final LifeCycleEvent event)\n-      throws IOException {\n-    throw new UnsupportedOperationException(\"Not yet implemented!\");\n+  public void updateContainerState(final HddsProtos.ContainerID containerID,\n+                                   final LifeCycleEvent event)\n+      throws IOException, InvalidStateTransitionException {\n+    // TODO: Remove the protobuf conversion after fixing ContainerStateMap.\n+    final ContainerID id = ContainerID.getFromProtobuf(containerID);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "bc5f64834f7be8d4e74105b1561475b8ad902759"}, "originalPosition": 238}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3046, "cost": 1, "resetAt": "2021-10-28T18:00:02Z"}}}