{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTQwMjEwMDI1", "number": 1703, "reviewThreads": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xNVQxOTowODoxNFrOFFwnBw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xNVQxOTowODo1MVrOFFwoGA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzQxNTgzNjIzOnYy", "diffSide": "RIGHT", "path": "hadoop-ozone/ozonefs-common/src/main/java/org/apache/hadoop/fs/ozone/BasicOzoneFileSystem.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xNVQxOTowODoxNFrOIGbhVA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xNVQxOTowODoxNFrOIGbhVA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MzYxMzI2OA==", "bodyText": "NIT: can we wrap this as a helper function as I can see the initialize() has similar logic.", "url": "https://github.com/apache/ozone/pull/1703#discussion_r543613268", "createdAt": "2020-12-15T19:08:14Z", "author": {"login": "xiaoyuyao"}, "path": "hadoop-ozone/ozonefs-common/src/main/java/org/apache/hadoop/fs/ozone/BasicOzoneFileSystem.java", "diffHunk": "@@ -703,7 +703,14 @@ public boolean mkdirs(Path f, FsPermission permission) throws IOException {\n \n   @Override\n   public long getDefaultBlockSize() {\n-    return (long) getConf().getStorageSize(\n+    Configuration conf = getConf();\n+    ConfigurationSource source;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "5d507094a5baa2785914fa9ed036f0d966d4319f"}, "originalPosition": 22}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzQxNTgzODg4OnYy", "diffSide": "RIGHT", "path": "hadoop-ozone/ozonefs-common/src/main/java/org/apache/hadoop/fs/ozone/BasicOzoneFileSystem.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xNVQxOTowODo1MFrOIGbi6g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xNVQxOTowODo1MFrOIGbi6g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MzYxMzY3NA==", "bodyText": "We need a fix for this in BasicRootedOzoneFileSystem#getDefaultBlockSize() as well.", "url": "https://github.com/apache/ozone/pull/1703#discussion_r543613674", "createdAt": "2020-12-15T19:08:50Z", "author": {"login": "xiaoyuyao"}, "path": "hadoop-ozone/ozonefs-common/src/main/java/org/apache/hadoop/fs/ozone/BasicOzoneFileSystem.java", "diffHunk": "@@ -703,7 +703,14 @@ public boolean mkdirs(Path f, FsPermission permission) throws IOException {\n \n   @Override\n   public long getDefaultBlockSize() {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "5d507094a5baa2785914fa9ed036f0d966d4319f"}, "originalPosition": 19}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzQxNTgzODk2OnYy", "diffSide": "RIGHT", "path": "hadoop-ozone/ozonefs-common/src/main/java/org/apache/hadoop/fs/ozone/BasicOzoneFileSystem.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xNVQxOTowODo1MVrOIGbi9Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xNVQxOTowODo1MVrOIGbi9Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MzYxMzY4NQ==", "bodyText": "Instead of duplicating this logic from initialize:\n\n  \n    \n      ozone/hadoop-ozone/ozonefs-common/src/main/java/org/apache/hadoop/fs/ozone/BasicOzoneFileSystem.java\n    \n    \n        Lines 161 to 166\n      in\n      0957975\n    \n    \n    \n    \n\n        \n          \n           ConfigurationSource source; \n        \n\n        \n          \n           if (conf instanceof OzoneConfiguration) { \n        \n\n        \n          \n             source = (ConfigurationSource) conf; \n        \n\n        \n          \n           } else { \n        \n\n        \n          \n             source = new LegacyHadoopConfigurationSource(conf); \n        \n\n        \n          \n           } \n        \n    \n  \n\n\nI think it would be cleaner to store this ConfigurationSource\n\neither in BasicOzoneFileSystem\nor in BasicOzoneClientAdapterImpl (and expose it via accessor method)\n\nand then use it here.", "url": "https://github.com/apache/ozone/pull/1703#discussion_r543613685", "createdAt": "2020-12-15T19:08:51Z", "author": {"login": "adoroszlai"}, "path": "hadoop-ozone/ozonefs-common/src/main/java/org/apache/hadoop/fs/ozone/BasicOzoneFileSystem.java", "diffHunk": "@@ -703,7 +703,14 @@ public boolean mkdirs(Path f, FsPermission permission) throws IOException {\n \n   @Override\n   public long getDefaultBlockSize() {\n-    return (long) getConf().getStorageSize(\n+    Configuration conf = getConf();\n+    ConfigurationSource source;\n+    if (conf instanceof OzoneConfiguration) {\n+      source = (ConfigurationSource) conf;\n+    } else {\n+      source = new LegacyHadoopConfigurationSource(conf);\n+    }", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "5d507094a5baa2785914fa9ed036f0d966d4319f"}, "originalPosition": 27}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4633, "cost": 1, "resetAt": "2021-11-12T11:57:46Z"}}}