{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDQxMjQxOTU1", "number": 1146, "title": "HDDS-2978. Intermittent failure in TestResourceLimitCache", "bodyText": "What changes were proposed in this pull request?\nCalling CompletableFuture.cancel() will mark the future as cancelled,but does not interrupt the running task.\nThe Javadoc for the method CompletableFuture#cancel() states:\nParameters:\nmayInterruptIfRunning - this value has no effect in this implementation because interrupts are not used to control processing.\n\nIn this PR, I'm trying to make asynchronous tasks run in a specified thread pool by given the executor when using the supplyAsync(...) method.\nFinally, use Executor.shutdownNow() to interrupt the operation of putting key (put<4,a>).\nWhat is the link to the Apache JIRA\nhttps://issues.apache.org/jira/browse/HDDS-2978\nHow was this patch tested?\nManual unit test 17000+ times -> Tests passed.", "createdAt": "2020-06-29T07:00:35Z", "url": "https://github.com/apache/ozone/pull/1146", "merged": true, "mergeCommit": {"oid": "2fb4a402fb97acb0b0294bc7a2ae17c6f5397edd"}, "closed": true, "closedAt": "2020-06-30T11:57:30Z", "author": {"login": "cku328"}, "timelineItems": {"totalCount": 9, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcv7VgqgH2gAyNDQxMjQxOTU1OjdjNmI4NTIxNGFkNGMxNDI0NWFiNjhhODFhOTUxNDc4Y2ZkMzY4YTg=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcwS9yzAH2gAyNDQxMjQxOTU1OjUzMmFiMTliNjNhNjQ2MDYxZGMxNjU2MzJiNjI4M2NiNWFjNWMyNjk=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "7c6b85214ad4c14245ab68a81a951478cfd368a8", "author": {"user": {"login": "cku328", "name": "Neo Yang"}}, "url": "https://github.com/apache/ozone/commit/7c6b85214ad4c14245ab68a81a951478cfd368a8", "committedDate": "2020-06-29T06:48:25Z", "message": "HDDS-2978. Intermittent failure in TestResourceLimitCache"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "8a8ac88f73a4f72819b889e2e327afe58efb5f05", "author": {"user": {"login": "cku328", "name": "Neo Yang"}}, "url": "https://github.com/apache/ozone/commit/8a8ac88f73a4f72819b889e2e327afe58efb5f05", "committedDate": "2020-06-29T07:21:53Z", "message": "trigger CI check"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDM4OTQ2NDEy", "url": "https://github.com/apache/ozone/pull/1146#pullrequestreview-438946412", "createdAt": "2020-06-29T07:25:18Z", "commit": {"oid": "8a8ac88f73a4f72819b889e2e327afe58efb5f05"}, "state": "COMMENTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yOVQwNzoyNToxOFrOGqH6qA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yOVQwNzoyNjoxMlrOGqH8wQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NjgyMzA4MA==", "bodyText": "pool is currently unused, I think you intended to pass it to supplyAsync:\n\n  \n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                });\n          \n          \n            \n                }, pool);", "url": "https://github.com/apache/ozone/pull/1146#discussion_r446823080", "createdAt": "2020-06-29T07:25:18Z", "author": {"login": "adoroszlai"}, "path": "hadoop-hdds/common/src/test/java/org/apache/hadoop/hdds/utils/TestResourceLimitCache.java", "diffHunk": "@@ -60,25 +58,27 @@ public void testResourceLimitCache()\n     resourceCache.remove(4);\n \n     GenericTestUtils.waitFor(future::isDone, 100, 1000);\n-    // map has the ket 1\n+    // map has the key 1\n     Assert.assertTrue(future.isDone() && !future.isCompletedExceptionally());\n     Assert.assertNotNull(resourceCache.get(1));\n \n     // Create a future which blocks to put 4. Currently map has acquired 7\n     // permits out of 10\n+    ExecutorService pool = Executors.newCachedThreadPool();\n     future = CompletableFuture.supplyAsync(() -> {\n       try {\n         return resourceCache.put(4, \"a\");\n       } catch (InterruptedException e) {\n-        e.printStackTrace();\n+        return null;\n       }\n-      return null;\n     });", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "8a8ac88f73a4f72819b889e2e327afe58efb5f05"}, "originalPosition": 31}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NjgyMzYxNw==", "bodyText": "Nit: please avoid * import.", "url": "https://github.com/apache/ozone/pull/1146#discussion_r446823617", "createdAt": "2020-06-29T07:26:12Z", "author": {"login": "adoroszlai"}, "path": "hadoop-hdds/common/src/test/java/org/apache/hadoop/hdds/utils/TestResourceLimitCache.java", "diffHunk": "@@ -20,9 +20,7 @@\n import org.junit.Assert;\n import org.junit.Test;\n \n-import java.util.concurrent.CompletableFuture;\n-import java.util.concurrent.ConcurrentHashMap;\n-import java.util.concurrent.TimeoutException;\n+import java.util.concurrent.*;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "8a8ac88f73a4f72819b889e2e327afe58efb5f05"}, "originalPosition": 7}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "6b7e893dd4eb71a055ec5e6048a6fea91805edd8", "author": {"user": {"login": "cku328", "name": "Neo Yang"}}, "url": "https://github.com/apache/ozone/commit/6b7e893dd4eb71a055ec5e6048a6fea91805edd8", "committedDate": "2020-06-29T07:52:37Z", "message": "commit suggestion"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e035870d84012942520752201bafb3867f7e411c", "author": {"user": {"login": "cku328", "name": "Neo Yang"}}, "url": "https://github.com/apache/ozone/commit/e035870d84012942520752201bafb3867f7e411c", "committedDate": "2020-06-29T08:07:39Z", "message": "fix checkstyle"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDM5Njg1NTI2", "url": "https://github.com/apache/ozone/pull/1146#pullrequestreview-439685526", "createdAt": "2020-06-30T05:44:02Z", "commit": {"oid": "e035870d84012942520752201bafb3867f7e411c"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "3c83edba1bdeb38d6cd711c68b5f1b617e6f3d3b", "author": {"user": {"login": "adoroszlai", "name": "Doroszlai, Attila"}}, "url": "https://github.com/apache/ozone/commit/3c83edba1bdeb38d6cd711c68b5f1b617e6f3d3b", "committedDate": "2020-06-30T09:12:35Z", "message": "trigger new CI check"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDM5ODI1MDAw", "url": "https://github.com/apache/ozone/pull/1146#pullrequestreview-439825000", "createdAt": "2020-06-30T09:13:18Z", "commit": {"oid": "3c83edba1bdeb38d6cd711c68b5f1b617e6f3d3b"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "532ab19b63a646061dc165632b6283cb5ac5c269", "author": {"user": {"login": "adoroszlai", "name": "Doroszlai, Attila"}}, "url": "https://github.com/apache/ozone/commit/532ab19b63a646061dc165632b6283cb5ac5c269", "committedDate": "2020-06-30T10:20:14Z", "message": "trigger new CI check"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3051, "cost": 1, "resetAt": "2021-10-28T18:00:02Z"}}}