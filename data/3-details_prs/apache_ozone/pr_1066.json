{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDMzNDE5NTc0", "number": 1066, "title": "HDDS-3770. Improve getPipelines performance", "bodyText": "What changes were proposed in this pull request?\n\ngetPipelines is in the critical path of allocateBlock, and discardPipeline is the hot spot in getPipelines.\nChange List to Set to make add  and contains faster.\nRemove stream().filter().collect() and parallelStream().anyMatch in discardPipeline because Set::contains is fast enough.\n\n\nWhat is the link to the Apache JIRA\nhttps://issues.apache.org/jira/browse/HDDS-3770?filter=-2\nHow was this patch tested?\nExisted tests.", "createdAt": "2020-06-12T01:51:03Z", "url": "https://github.com/apache/ozone/pull/1066", "merged": true, "mergeCommit": {"oid": "574763b1cca814a90182a5b820e53dbd0c7de1b8"}, "closed": true, "closedAt": "2020-06-30T09:23:30Z", "author": {"login": "runzhiwang"}, "timelineItems": {"totalCount": 15, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcqZAjeABqjM0MzY2MDY3MjA=", "endCursor": "Y3Vyc29yOnYyOpPPAAABctoBTZAFqTQzNDU3ODQ3Mg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "a31a85d43ed515bd8140f8f4be79bc10b4267d82", "author": {"user": {"login": "runzhiwang", "name": null}}, "url": "https://github.com/apache/ozone/commit/a31a85d43ed515bd8140f8f4be79bc10b4267d82", "committedDate": "2020-06-12T01:44:29Z", "message": "HDDS-3770. Improve getPipelines performance"}, "afterCommit": {"oid": "7d05a2cc5731238bc95153fbc71a9bda5f2658d7", "author": {"user": {"login": "runzhiwang", "name": null}}, "url": "https://github.com/apache/ozone/commit/7d05a2cc5731238bc95153fbc71a9bda5f2658d7", "committedDate": "2020-06-12T01:58:54Z", "message": "HDDS-3770. Improve getPipelines performance"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDMwMDk3MzM0", "url": "https://github.com/apache/ozone/pull/1066#pullrequestreview-430097334", "createdAt": "2020-06-13T00:42:43Z", "commit": {"oid": "1efdc23a245662847c823f3e18c5f3bc013fdb28"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xM1QwMDo0Mjo0NFrOGjUqYg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xM1QwMDo0Mjo0NFrOGjUqYg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzOTY5MTg3NA==", "bodyText": "Collections.emptySet() to avoid unnecessary allocation", "url": "https://github.com/apache/ozone/pull/1066#discussion_r439691874", "createdAt": "2020-06-13T00:42:44Z", "author": {"login": "xiaoyuyao"}, "path": "hadoop-hdds/server-scm/src/main/java/org/apache/hadoop/hdds/scm/container/SCMContainerManager.java", "diffHunk": "@@ -416,13 +417,12 @@ public void updateDeleteTransactionId(Map<Long, Long> deleteTransactionMap)\n    */\n   public ContainerInfo getMatchingContainer(final long sizeRequired,\n       String owner, Pipeline pipeline) {\n-    return getMatchingContainer(sizeRequired, owner, pipeline, Collections\n-        .emptyList());\n+    return getMatchingContainer(sizeRequired, owner, pipeline, new HashSet<>());", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "1efdc23a245662847c823f3e18c5f3bc013fdb28"}, "originalPosition": 14}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "1c7cd6a19408567720ae1323bb8459659c55f3f1", "author": {"user": {"login": "runzhiwang", "name": null}}, "url": "https://github.com/apache/ozone/commit/1c7cd6a19408567720ae1323bb8459659c55f3f1", "committedDate": "2020-06-14T06:20:23Z", "message": "HDDS-3770. Improve getPipelines performance"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "1efdc23a245662847c823f3e18c5f3bc013fdb28", "author": {"user": {"login": "runzhiwang", "name": null}}, "url": "https://github.com/apache/ozone/commit/1efdc23a245662847c823f3e18c5f3bc013fdb28", "committedDate": "2020-06-12T03:09:17Z", "message": "triger ci"}, "afterCommit": {"oid": "212a7899df964616c0f3c92a1fa69326f4f31fea", "author": {"user": {"login": "runzhiwang", "name": null}}, "url": "https://github.com/apache/ozone/commit/212a7899df964616c0f3c92a1fa69326f4f31fea", "committedDate": "2020-06-14T06:22:30Z", "message": "fix code review"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "6c52f636a66840f8d34545a750fea76c37d7807a", "author": {"user": {"login": "runzhiwang", "name": null}}, "url": "https://github.com/apache/ozone/commit/6c52f636a66840f8d34545a750fea76c37d7807a", "committedDate": "2020-06-14T10:09:58Z", "message": "triger ci"}, "afterCommit": {"oid": "212a7899df964616c0f3c92a1fa69326f4f31fea", "author": {"user": {"login": "runzhiwang", "name": null}}, "url": "https://github.com/apache/ozone/commit/212a7899df964616c0f3c92a1fa69326f4f31fea", "committedDate": "2020-06-14T06:22:30Z", "message": "fix code review"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "212a7899df964616c0f3c92a1fa69326f4f31fea", "author": {"user": {"login": "runzhiwang", "name": null}}, "url": "https://github.com/apache/ozone/commit/212a7899df964616c0f3c92a1fa69326f4f31fea", "committedDate": "2020-06-14T06:22:30Z", "message": "fix code review"}, "afterCommit": {"oid": "32627906002f0f76510bf7afc83af7fc739ea254", "author": {"user": {"login": "runzhiwang", "name": null}}, "url": "https://github.com/apache/ozone/commit/32627906002f0f76510bf7afc83af7fc739ea254", "committedDate": "2020-06-19T00:30:37Z", "message": "fix code review"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "32627906002f0f76510bf7afc83af7fc739ea254", "author": {"user": {"login": "runzhiwang", "name": null}}, "url": "https://github.com/apache/ozone/commit/32627906002f0f76510bf7afc83af7fc739ea254", "committedDate": "2020-06-19T00:30:37Z", "message": "fix code review"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDM0NDYxNTgx", "url": "https://github.com/apache/ozone/pull/1066#pullrequestreview-434461581", "createdAt": "2020-06-21T00:34:57Z", "commit": {"oid": "32627906002f0f76510bf7afc83af7fc739ea254"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yMVQwMDozNDo1N1rOGmo90A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yMVQwMDozNDo1N1rOGmo90A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MzE3MDI1Ng==", "bodyText": "Can we change here to Collection to make the interface neutral to implementation? The underlying can be List or Set.", "url": "https://github.com/apache/ozone/pull/1066#discussion_r443170256", "createdAt": "2020-06-21T00:34:57Z", "author": {"login": "xiaoyuyao"}, "path": "hadoop-hdds/server-scm/src/main/java/org/apache/hadoop/hdds/scm/container/ContainerManager.java", "diffHunk": "@@ -180,7 +180,7 @@ ContainerInfo getMatchingContainer(long size, String owner,\n    * @return ContainerInfo for the matching container.\n    */\n   ContainerInfo getMatchingContainer(long size, String owner,\n-      Pipeline pipeline, List<ContainerID> excludedContainerIDS);\n+      Pipeline pipeline, Set<ContainerID> excludedContainerIDS);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "32627906002f0f76510bf7afc83af7fc739ea254"}, "originalPosition": 5}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDM0NDYxNjIx", "url": "https://github.com/apache/ozone/pull/1066#pullrequestreview-434461621", "createdAt": "2020-06-21T00:36:14Z", "commit": {"oid": "32627906002f0f76510bf7afc83af7fc739ea254"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yMVQwMDozNjoxNFrOGmo-EQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yMVQwMDozNjoxNFrOGmo-EQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MzE3MDMyMQ==", "bodyText": "Can we keep the existing one parameter as Collection which allows passing Set here?", "url": "https://github.com/apache/ozone/pull/1066#discussion_r443170321", "createdAt": "2020-06-21T00:36:14Z", "author": {"login": "xiaoyuyao"}, "path": "hadoop-hdds/server-scm/src/main/java/org/apache/hadoop/hdds/scm/pipeline/PipelineManager.java", "diffHunk": "@@ -61,8 +61,8 @@ Pipeline createPipeline(ReplicationType type, ReplicationFactor factor,\n       ReplicationFactor factor, Pipeline.PipelineState state);\n \n   List<Pipeline> getPipelines(ReplicationType type, ReplicationFactor factor,\n-      Pipeline.PipelineState state, Collection<DatanodeDetails> excludeDns,\n-      Collection<PipelineID> excludePipelines);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "32627906002f0f76510bf7afc83af7fc739ea254"}, "originalPosition": 16}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDM0NDYxNjM3", "url": "https://github.com/apache/ozone/pull/1066#pullrequestreview-434461637", "createdAt": "2020-06-21T00:36:33Z", "commit": {"oid": "32627906002f0f76510bf7afc83af7fc739ea254"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yMVQwMDozNjozM1rOGmo-KA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yMVQwMDozNjozM1rOGmo-KA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MzE3MDM0NA==", "bodyText": "Same as above.", "url": "https://github.com/apache/ozone/pull/1066#discussion_r443170344", "createdAt": "2020-06-21T00:36:33Z", "author": {"login": "xiaoyuyao"}, "path": "hadoop-hdds/server-scm/src/main/java/org/apache/hadoop/hdds/scm/pipeline/PipelineStateManager.java", "diffHunk": "@@ -81,8 +81,8 @@ Pipeline getPipeline(PipelineID pipelineID) throws PipelineNotFoundException {\n   }\n \n   List<Pipeline> getPipelines(ReplicationType type, ReplicationFactor factor,\n-      PipelineState state, Collection<DatanodeDetails> excludeDns,\n-      Collection<PipelineID> excludePipelines) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "32627906002f0f76510bf7afc83af7fc739ea254"}, "originalPosition": 16}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDM0NDYxNjQ2", "url": "https://github.com/apache/ozone/pull/1066#pullrequestreview-434461646", "createdAt": "2020-06-21T00:37:09Z", "commit": {"oid": "32627906002f0f76510bf7afc83af7fc739ea254"}, "state": "COMMENTED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "efbfbc9400de5f97a6819de5618be991594bd1dc", "author": {"user": {"login": "runzhiwang", "name": null}}, "url": "https://github.com/apache/ozone/commit/efbfbc9400de5f97a6819de5618be991594bd1dc", "committedDate": "2020-06-21T01:46:01Z", "message": "fix code review"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "8310bc974bfd935d053349500cf0dced1a6bb3ce", "author": {"user": {"login": "runzhiwang", "name": null}}, "url": "https://github.com/apache/ozone/commit/8310bc974bfd935d053349500cf0dced1a6bb3ce", "committedDate": "2020-06-21T01:33:29Z", "message": "fix code review"}, "afterCommit": {"oid": "efbfbc9400de5f97a6819de5618be991594bd1dc", "author": {"user": {"login": "runzhiwang", "name": null}}, "url": "https://github.com/apache/ozone/commit/efbfbc9400de5f97a6819de5618be991594bd1dc", "committedDate": "2020-06-21T01:46:01Z", "message": "fix code review"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ffaf425f172f85fb838320235780d079230f0102", "author": {"user": {"login": "runzhiwang", "name": null}}, "url": "https://github.com/apache/ozone/commit/ffaf425f172f85fb838320235780d079230f0102", "committedDate": "2020-06-21T03:10:37Z", "message": "triger ci"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDM0NTc4NDcy", "url": "https://github.com/apache/ozone/pull/1066#pullrequestreview-434578472", "createdAt": "2020-06-22T03:10:18Z", "commit": {"oid": "ffaf425f172f85fb838320235780d079230f0102"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3188, "cost": 1, "resetAt": "2021-10-28T18:00:02Z"}}}