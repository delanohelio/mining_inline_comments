{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0MzgwMzg1MjEw", "number": 608, "reviewThreads": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yN1QxMjozNzo1N1rODjcorA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yOFQxNDoyNzoyMVrODj1LRg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjM4NDk1OTE2OnYy", "diffSide": "RIGHT", "path": "hadoop-ozone/dist/src/main/smoketest/topology/readdata.robot", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yN1QxMjozNzo1N1rOFvQoIQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yN1QxNzoxMDo0NVrOFvZt1g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NTA5OTgwOQ==", "bodyText": "This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters. Learn more about bidirectional Unicode characters\n\n\n  \n\n\n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                ${output} =         Execute          ozone sh key get /topvol1/bucket1/key1\n          \n          \n            \n                ${output} =         Execute          ozone sh key get /topvol1/bucket1/key1 /tmp/key1\n          \n      \n    \n    \n  \n\nThe key get command requires local filename as second argument, so currently it produces this output (trimmed) and does not really verify ability to read data:\nMissing required parameter: <fileName>\n\nNote that on the second run (for the other rack) it will refuse to overwrite /tmp/key1, so\n\ndelete local file after key get OR\nrun test case in different container (eg. om) OR\nuse random local filename (example for random string generation)", "url": "https://github.com/apache/ozone/pull/608#discussion_r385099809", "createdAt": "2020-02-27T12:37:57Z", "author": {"login": "adoroszlai"}, "path": "hadoop-ozone/dist/src/main/smoketest/topology/readdata.robot", "diffHunk": "@@ -0,0 +1,28 @@\n+# Licensed to the Apache Software Foundation (ASF) under one or more\n+# contributor license agreements.  See the NOTICE file distributed with\n+# this work for additional information regarding copyright ownership.\n+# The ASF licenses this file to You under the Apache License, Version 2.0\n+# (the \"License\"); you may not use this file except in compliance with\n+# the License.  You may obtain a copy of the License at\n+#\n+#     http://www.apache.org/licenses/LICENSE-2.0\n+#\n+# Unless required by applicable law or agreed to in writing, software\n+# distributed under the License is distributed on an \"AS IS\" BASIS,\n+# WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+# See the License for the specific language governing permissions and\n+# limitations under the License.\n+\n+*** Settings ***\n+Documentation       Smoketest ozone cluster startup\n+Library             OperatingSystem\n+Library             BuiltIn\n+Resource            ../commonlib.robot\n+\n+*** Variables ***\n+\n+\n+*** Test Cases ***\n+Read data from previously created key\n+    ${output} =         Execute          ozone sh key get /topvol1/bucket1/key1", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "3e4648d9deec2baab778d04fa2148e0dea0765fe"}, "originalPosition": 27}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NTI0ODcyNg==", "bodyText": "Well spotted. I will add a random filename using the example you gave.", "url": "https://github.com/apache/ozone/pull/608#discussion_r385248726", "createdAt": "2020-02-27T17:10:45Z", "author": {"login": "sodonnel"}, "path": "hadoop-ozone/dist/src/main/smoketest/topology/readdata.robot", "diffHunk": "@@ -0,0 +1,28 @@\n+# Licensed to the Apache Software Foundation (ASF) under one or more\n+# contributor license agreements.  See the NOTICE file distributed with\n+# this work for additional information regarding copyright ownership.\n+# The ASF licenses this file to You under the Apache License, Version 2.0\n+# (the \"License\"); you may not use this file except in compliance with\n+# the License.  You may obtain a copy of the License at\n+#\n+#     http://www.apache.org/licenses/LICENSE-2.0\n+#\n+# Unless required by applicable law or agreed to in writing, software\n+# distributed under the License is distributed on an \"AS IS\" BASIS,\n+# WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+# See the License for the specific language governing permissions and\n+# limitations under the License.\n+\n+*** Settings ***\n+Documentation       Smoketest ozone cluster startup\n+Library             OperatingSystem\n+Library             BuiltIn\n+Resource            ../commonlib.robot\n+\n+*** Variables ***\n+\n+\n+*** Test Cases ***\n+Read data from previously created key\n+    ${output} =         Execute          ozone sh key get /topvol1/bucket1/key1", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NTA5OTgwOQ=="}, "originalCommit": {"oid": "3e4648d9deec2baab778d04fa2148e0dea0765fe"}, "originalPosition": 27}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjM4NDk3MDU5OnYy", "diffSide": "RIGHT", "path": "hadoop-ozone/dist/src/main/compose/testlib.sh", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yN1QxMjo0MTozOFrOFvQu0w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yN1QxMjo0MTozOFrOFvQu0w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NTEwMTUyMw==", "bodyText": "This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters. Learn more about bidirectional Unicode characters\n\n\n  \n\n\n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n              docker-compose -f \"$COMPOSE_FILE\" stop $@\n          \n          \n            \n              docker-compose -f \"$COMPOSE_FILE\" --no-ansi stop $@\n          \n      \n    \n    \n  \n\nPlease add --no-ansi to avoid funky characters in the output:\n2020-02-26T17:01:00.9125703Z \ufffd[3BStarting datanode_1 ... \n2020-02-26T17:01:00.9127089Z Starting datanode_2 ... \n2020-02-26T17:01:00.9128127Z Starting datanode_3 ... \n2020-02-26T17:01:01.4869851Z \ufffd[1A\ufffd[2K\n2020-02-26T17:01:01.4870604Z Starting datanode_3 ... \ufffd[32mdone\ufffd[0m\n2020-02-26T17:01:01.5357903Z \ufffd[1B\ufffd[3A\ufffd[2K\n2020-02-26T17:01:01.5359166Z Starting datanode_1 ... \ufffd[32mdone\ufffd[0m\n2020-02-26T17:01:01.6387370Z \ufffd[3B\ufffd[2A\ufffd[2K", "url": "https://github.com/apache/ozone/pull/608#discussion_r385101523", "createdAt": "2020-02-27T12:41:38Z", "author": {"login": "adoroszlai"}, "path": "hadoop-ozone/dist/src/main/compose/testlib.sh", "diffHunk": "@@ -124,6 +124,23 @@ execute_command_in_container(){\n   set +e\n }\n \n+## @description Stop a list of named containers\n+## @param       List of container names, eg datanode_1 datanode_2\n+stop_containers() {\n+  set -e\n+  docker-compose -f \"$COMPOSE_FILE\" stop $@", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "3e4648d9deec2baab778d04fa2148e0dea0765fe"}, "originalPosition": 8}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjM4NDk3MTI1OnYy", "diffSide": "RIGHT", "path": "hadoop-ozone/dist/src/main/compose/testlib.sh", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yN1QxMjo0MTo1MlrOFvQvRA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yN1QxNzoxMTozMVrOFvZwjg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NTEwMTYzNg==", "bodyText": "This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters. Learn more about bidirectional Unicode characters\n\n\n  \n\n\n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n              docker-compose -f \"$COMPOSE_FILE\" start $@\n          \n          \n            \n              docker-compose -f \"$COMPOSE_FILE\" --no-ansi start $@", "url": "https://github.com/apache/ozone/pull/608#discussion_r385101636", "createdAt": "2020-02-27T12:41:52Z", "author": {"login": "adoroszlai"}, "path": "hadoop-ozone/dist/src/main/compose/testlib.sh", "diffHunk": "@@ -124,6 +124,23 @@ execute_command_in_container(){\n   set +e\n }\n \n+## @description Stop a list of named containers\n+## @param       List of container names, eg datanode_1 datanode_2\n+stop_containers() {\n+  set -e\n+  docker-compose -f \"$COMPOSE_FILE\" stop $@\n+  set +e\n+}\n+\n+\n+## @description Start a list of named containers\n+## @param       List of container names, eg datanode_1 datanode_2\n+start_containers() {\n+  set -e\n+  docker-compose -f \"$COMPOSE_FILE\" start $@", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "3e4648d9deec2baab778d04fa2148e0dea0765fe"}, "originalPosition": 17}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NTI0OTQyMg==", "bodyText": "Of course, I had noticed this in other commands but forgot to add the switch to my new ones. I will add it in.", "url": "https://github.com/apache/ozone/pull/608#discussion_r385249422", "createdAt": "2020-02-27T17:11:31Z", "author": {"login": "sodonnel"}, "path": "hadoop-ozone/dist/src/main/compose/testlib.sh", "diffHunk": "@@ -124,6 +124,23 @@ execute_command_in_container(){\n   set +e\n }\n \n+## @description Stop a list of named containers\n+## @param       List of container names, eg datanode_1 datanode_2\n+stop_containers() {\n+  set -e\n+  docker-compose -f \"$COMPOSE_FILE\" stop $@\n+  set +e\n+}\n+\n+\n+## @description Start a list of named containers\n+## @param       List of container names, eg datanode_1 datanode_2\n+start_containers() {\n+  set -e\n+  docker-compose -f \"$COMPOSE_FILE\" start $@", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NTEwMTYzNg=="}, "originalCommit": {"oid": "3e4648d9deec2baab778d04fa2148e0dea0765fe"}, "originalPosition": 17}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjM4ODk3OTkwOnYy", "diffSide": "RIGHT", "path": "hadoop-ozone/dist/src/main/compose/ozone-topology/test.sh", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yOFQxNDoyNzoyMVrOFv2uNg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wMlQxMDoxMjowOVrOFwZ_2A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NTcyMzk1OA==", "bodyText": "what about if datanode_1, datanode_2 and datnaode_3 are not yet started / registered but 4-6 are stopped. Do we need some safety check here?\nIn the testlib.sh/start_docker_env we have a wait_for_safemode_exit part. We might need it here.", "url": "https://github.com/apache/ozone/pull/608#discussion_r385723958", "createdAt": "2020-02-28T14:27:21Z", "author": {"login": "elek"}, "path": "hadoop-ozone/dist/src/main/compose/ozone-topology/test.sh", "diffHunk": "@@ -33,6 +33,20 @@ execute_robot_test scm basic/basic.robot\n \n execute_robot_test scm topology/scmcli.robot\n \n+# Ensure data can be read even when a full rack\n+# is stopped.\n+execute_robot_test scm topology/loaddata.robot\n+\n+stop_containers datanode_1 datanode_2 datanode_3\n+\n+execute_robot_test scm topology/readdata.robot\n+\n+start_containers datanode_1 datanode_2 datanode_3\n+\n+stop_containers datanode_4 datanode_5 datanode_6\n+", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "4860931cc6bf968c06851d12b0303199a3665aa3"}, "originalPosition": 15}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NjMwMTkxMg==", "bodyText": "Looking at some of the intermittent failures, I think we do need a safety check, but the safemode check will not do it. I believe we need to wait for the xceiver  port on the DNs to come up. I have a plan for this which I will post shortly.\nHowever we will still need HDDS-3107 as that is another reason this test can fail.", "url": "https://github.com/apache/ozone/pull/608#discussion_r386301912", "createdAt": "2020-03-02T10:12:09Z", "author": {"login": "sodonnel"}, "path": "hadoop-ozone/dist/src/main/compose/ozone-topology/test.sh", "diffHunk": "@@ -33,6 +33,20 @@ execute_robot_test scm basic/basic.robot\n \n execute_robot_test scm topology/scmcli.robot\n \n+# Ensure data can be read even when a full rack\n+# is stopped.\n+execute_robot_test scm topology/loaddata.robot\n+\n+stop_containers datanode_1 datanode_2 datanode_3\n+\n+execute_robot_test scm topology/readdata.robot\n+\n+start_containers datanode_1 datanode_2 datanode_3\n+\n+stop_containers datanode_4 datanode_5 datanode_6\n+", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NTcyMzk1OA=="}, "originalCommit": {"oid": "4860931cc6bf968c06851d12b0303199a3665aa3"}, "originalPosition": 15}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4927, "cost": 1, "resetAt": "2021-11-12T11:57:46Z"}}}