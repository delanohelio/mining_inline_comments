{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0MzgxMTA2ODIy", "number": 615, "title": "HDDS-3085. OM Delta updates request in Recon should work with secure Ozone Manager.", "bodyText": "What changes were proposed in this pull request?\n\nIntroduced kerberos principal and keytab file configs for Recon\nLogin Recon user with KDC while Recon starts up\n\nWhat is the link to the Apache JIRA\nhttps://issues.apache.org/jira/browse/HDDS-3085\nHow was this patch tested?\nThis patch was tested using ozonesecure docker-compose setup.\ncd hadoop-ozone/dist/target/ozone-0.5.0-SNAPSHOT/compose/ozonesecure\ndocker-compose up -d\ndocker-compose exec om bash\nozone freon rk --replicationType=RATIS --numOfVolumes=10 --numOfBuckets=10 --numOfKeys=10 --factor=ONE --numOfThreads=20\n# wait for a couple minutes for recon to get full snapshot from OM for the first time\nozone freon rk --replicationType=RATIS --numOfVolumes=10 --numOfBuckets=10 --numOfKeys=10 --factor=ONE --numOfThreads=20\n\nNow, recon correctly picks up the delta from OM using RPC call. This call was failing before with a Kerberos Authentication Exception.", "createdAt": "2020-02-27T22:32:10Z", "url": "https://github.com/apache/ozone/pull/615", "merged": true, "mergeCommit": {"oid": "5bb2a96c6ebb035e278f0c3e59a03b4ced95cbba"}, "closed": true, "closedAt": "2020-02-28T22:08:45Z", "author": {"login": "vivekratnavel"}, "timelineItems": {"totalCount": 7, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcIi_uNgH2gAyMzgxMTA2ODIyOjQ4NDAyZGM4N2ExOGQ4NmMwY2I4MTlhYjdhMWMzYjgwZDBkYTRjMWI=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcI2xi6AFqTM2NjY5NTI3Mw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "48402dc87a18d86c0cb819ab7a1c3b80d0da4c1b", "author": {"user": {"login": "vivekratnavel", "name": "Vivek Ratnavel Subramanian"}}, "url": "https://github.com/apache/ozone/commit/48402dc87a18d86c0cb819ab7a1c3b80d0da4c1b", "committedDate": "2020-02-27T22:23:51Z", "message": "OM Delta updates request in Recon should work with secure Ozone Manager."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzY2MDY2NTUx", "url": "https://github.com/apache/ozone/pull/615#pullrequestreview-366066551", "createdAt": "2020-02-27T23:15:46Z", "commit": {"oid": "48402dc87a18d86c0cb819ab7a1c3b80d0da4c1b"}, "state": "COMMENTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yN1QyMzoxNTo0NlrOFvkhAg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yN1QyMzoxNjoyMFrOFvkhwQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NTQyNTY2Ng==", "bodyText": "Move this to org.apache.hadoop.hdds.recon.ReconConfigKeys#ReconConfigKeys since it will be needed by Datanodes as well.", "url": "https://github.com/apache/ozone/pull/615#discussion_r385425666", "createdAt": "2020-02-27T23:15:46Z", "author": {"login": "avijayanhwx"}, "path": "hadoop-ozone/recon/src/main/java/org/apache/hadoop/ozone/recon/ReconServerConfigKeys.java", "diffHunk": "@@ -39,8 +39,12 @@\n       \"ozone.recon.http-address\";\n   public static final String OZONE_RECON_HTTPS_ADDRESS_KEY =\n       \"ozone.recon.https-address\";\n-  public static final String OZONE_RECON_KEYTAB_FILE =\n-      \"ozone.recon.keytab.file\";\n+  public static final String OZONE_RECON_HTTP_KEYTAB_FILE =\n+      \"ozone.recon.http.kerberos.keytab.file\";\n+  public static final String OZONE_RECON_KERBEROS_KEYTAB_FILE_KEY =\n+      \"ozone.recon.kerberos.keytab.file\";\n+  public static final String OZONE_RECON_KERBEROS_PRINCIPAL_KEY =", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "48402dc87a18d86c0cb819ab7a1c3b80d0da4c1b"}, "originalPosition": 10}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NTQyNTg1Nw==", "bodyText": "Do we need a securityEnabled field in the class?", "url": "https://github.com/apache/ozone/pull/615#discussion_r385425857", "createdAt": "2020-02-27T23:16:20Z", "author": {"login": "avijayanhwx"}, "path": "hadoop-ozone/recon/src/main/java/org/apache/hadoop/ozone/recon/ReconServer.java", "diffHunk": "@@ -144,6 +156,51 @@ public void join() {\n     }\n   }\n \n+  /**\n+   * Logs in the Recon user if security is enabled in the configuration.\n+   *\n+   * @param conf OzoneConfiguration\n+   * @throws IOException, AuthenticationException in case login fails.\n+   */\n+  private static void loginReconUserIfSecurityEnabled(OzoneConfiguration  conf)\n+      throws IOException, AuthenticationException {\n+    securityEnabled = OzoneSecurityUtil.isSecurityEnabled(conf);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "48402dc87a18d86c0cb819ab7a1c3b80d0da4c1b"}, "originalPosition": 60}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "39fc1fd205e385a91a8f74eebf7c01ca35051930", "author": {"user": {"login": "vivekratnavel", "name": "Vivek Ratnavel Subramanian"}}, "url": "https://github.com/apache/ozone/commit/39fc1fd205e385a91a8f74eebf7c01ca35051930", "committedDate": "2020-02-28T18:16:34Z", "message": "Fix integration test failure and address review comments."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzY2NjE3NzYw", "url": "https://github.com/apache/ozone/pull/615#pullrequestreview-366617760", "createdAt": "2020-02-28T19:02:10Z", "commit": {"oid": "39fc1fd205e385a91a8f74eebf7c01ca35051930"}, "state": "COMMENTED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "5b151f6a5a1f9372ad097023ef0908a1c2cb8566", "author": {"user": {"login": "vivekratnavel", "name": "Vivek Ratnavel Subramanian"}}, "url": "https://github.com/apache/ozone/commit/5b151f6a5a1f9372ad097023ef0908a1c2cb8566", "committedDate": "2020-02-28T19:23:49Z", "message": "Merge remote-tracking branch 'apache/master' into HDDS-3085"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "85bbb2a54da6ad38c4d65fb0bafb75e796dd836f", "author": {"user": {"login": "vivekratnavel", "name": "Vivek Ratnavel Subramanian"}}, "url": "https://github.com/apache/ozone/commit/85bbb2a54da6ad38c4d65fb0bafb75e796dd836f", "committedDate": "2020-02-28T20:01:00Z", "message": "Fix review comments."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzY2Njk1Mjcz", "url": "https://github.com/apache/ozone/pull/615#pullrequestreview-366695273", "createdAt": "2020-02-28T21:26:28Z", "commit": {"oid": "85bbb2a54da6ad38c4d65fb0bafb75e796dd836f"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3646, "cost": 1, "resetAt": "2021-10-28T18:00:02Z"}}}