{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDI0Mjk0NTgw", "number": 976, "title": "HDDS-3672. Ozone fs failed to list intermediate directory.", "bodyText": "What changes were proposed in this pull request?\nThe root cause is replication factor and replication type are required fieldsin KeyInfo proto.\nWhile the way to create the OMKeyInfo object for intermediate directory doesn't provide all required fields.\nWhat is the link to the Apache JIRA\nhttps://issues.apache.org/jira/browse/HDDS-3672\nHow was this patch tested?\nUnit test is updated + manual confirmation:\nbin/ozone sh volume create /hadoop\nbin/ozone sh bucket create /hadoop/ozone\nbin/ozone sh key put /hadoop/ozone/benchmarks/TestDFSIO/dir1/test README.md\nbin/ozone fs -ls o3fs://ozone.hadoop/", "createdAt": "2020-05-28T07:12:54Z", "url": "https://github.com/apache/ozone/pull/976", "merged": true, "mergeCommit": {"oid": "e1ef54d8fb51dab66e537e68eeccd39d2241db02"}, "closed": true, "closedAt": "2020-06-02T14:20:10Z", "author": {"login": "ChenSammi"}, "timelineItems": {"totalCount": 6, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABclpqFGgFqTQxOTg4OTY0OA==", "endCursor": "Y3Vyc29yOnYyOpPPAAABcnVmVCAFqTQyMjcyNzQwNw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDE5ODg5NjQ4", "url": "https://github.com/apache/ozone/pull/976#pullrequestreview-419889648", "createdAt": "2020-05-28T08:30:59Z", "commit": {"oid": "7c0c60632c03b2fa6ef971402b6cca4efadfd98f"}, "state": "COMMENTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yOFQwODozMDo1OVrOGbq_9g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yOFQwODozMzowM1rOGbrEuA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMTY2OTIzOA==", "bodyText": "Thanks @ChenSammi for the analysis and the changes.\nIt looks like the \"current time\" change is not related to this, please let me know your thoughts.", "url": "https://github.com/apache/ozone/pull/976#discussion_r431669238", "createdAt": "2020-05-28T08:30:59Z", "author": {"login": "rakeshadr"}, "path": "hadoop-hdds/common/src/main/java/org/apache/hadoop/hdds/HddsUtils.java", "diffHunk": "@@ -465,11 +464,11 @@ public static ObjectName registerWithJmxProperties(\n   }\n \n   /**\n-   * Get the current UTC time in milliseconds.\n-   * @return the current UTC time in milliseconds.\n+   * Get the current time in milliseconds.\n+   * @return the current time in milliseconds.\n    */\n-  public static long getUtcTime() {\n-    return Calendar.getInstance(UTC_ZONE).getTimeInMillis();\n+  public static long getTime() {\n+    return System.currentTimeMillis();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "7c0c60632c03b2fa6ef971402b6cca4efadfd98f"}, "originalPosition": 20}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMTY3MDQ1Ng==", "bodyText": "It looks to me an opportunity to add a unit test, can we? Thanks!", "url": "https://github.com/apache/ozone/pull/976#discussion_r431670456", "createdAt": "2020-05-28T08:33:03Z", "author": {"login": "rakeshadr"}, "path": "hadoop-ozone/ozone-manager/src/main/java/org/apache/hadoop/ozone/om/KeyManagerImpl.java", "diffHunk": "@@ -2037,11 +2037,11 @@ private void listStatusFindKeyInTableCache(\n                 // if entry is a directory\n                 if (!deletedKeySet.contains(entryInDb)) {\n                   if (!entryKeyName.equals(immediateChild)) {\n-                    OmKeyInfo fakeDirEntry = new OmKeyInfo.Builder()\n-                        .setVolumeName(omKeyInfo.getVolumeName())\n-                        .setBucketName(omKeyInfo.getBucketName())\n-                        .setKeyName(immediateChild)\n-                        .build();\n+                    OmKeyInfo fakeDirEntry = createDirectoryKey(", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "7c0c60632c03b2fa6ef971402b6cca4efadfd98f"}, "originalPosition": 9}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "7c0c60632c03b2fa6ef971402b6cca4efadfd98f", "author": {"user": {"login": "ChenSammi", "name": "Sammi Chen"}}, "url": "https://github.com/apache/ozone/commit/7c0c60632c03b2fa6ef971402b6cca4efadfd98f", "committedDate": "2020-05-28T07:09:02Z", "message": "HDDS-3672. Ozone fs failed to list intermiedate directory."}, "afterCommit": {"oid": "873a7eb0aaf6f0259b71592a10720ebd4a140a25", "author": {"user": {"login": "ChenSammi", "name": "Sammi Chen"}}, "url": "https://github.com/apache/ozone/commit/873a7eb0aaf6f0259b71592a10720ebd4a140a25", "committedDate": "2020-05-29T07:32:14Z", "message": "HDDS-3672. Ozone fs failed to list intermiedate directory."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "790cd71cd7d7ed0ea1d76b4b03d93896f44e40dd", "author": {"user": {"login": "ChenSammi", "name": "Sammi Chen"}}, "url": "https://github.com/apache/ozone/commit/790cd71cd7d7ed0ea1d76b4b03d93896f44e40dd", "committedDate": "2020-05-29T12:48:05Z", "message": "HDDS-3672. Ozone fs failed to list intermediate directory."}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "873a7eb0aaf6f0259b71592a10720ebd4a140a25", "author": {"user": {"login": "ChenSammi", "name": "Sammi Chen"}}, "url": "https://github.com/apache/ozone/commit/873a7eb0aaf6f0259b71592a10720ebd4a140a25", "committedDate": "2020-05-29T07:32:14Z", "message": "HDDS-3672. Ozone fs failed to list intermiedate directory."}, "afterCommit": {"oid": "790cd71cd7d7ed0ea1d76b4b03d93896f44e40dd", "author": {"user": {"login": "ChenSammi", "name": "Sammi Chen"}}, "url": "https://github.com/apache/ozone/commit/790cd71cd7d7ed0ea1d76b4b03d93896f44e40dd", "committedDate": "2020-05-29T12:48:05Z", "message": "HDDS-3672. Ozone fs failed to list intermediate directory."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "608dff5fc6f46aa76447d66168d15a2911cca657", "author": {"user": {"login": "ChenSammi", "name": "Sammi Chen"}}, "url": "https://github.com/apache/ozone/commit/608dff5fc6f46aa76447d66168d15a2911cca657", "committedDate": "2020-06-01T06:31:37Z", "message": "Improve UT"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDIyNzI3NDA3", "url": "https://github.com/apache/ozone/pull/976#pullrequestreview-422727407", "createdAt": "2020-06-02T14:19:00Z", "commit": {"oid": "608dff5fc6f46aa76447d66168d15a2911cca657"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3089, "cost": 1, "resetAt": "2021-10-28T18:00:02Z"}}}