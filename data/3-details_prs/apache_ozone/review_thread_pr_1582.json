{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTE5OTkzNDIz", "number": 1582, "reviewThreads": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xM1QxMTozMDo0N1rOE4oWxQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xM1QxMTo0MDoyNFrOE4oh6w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzI3ODE2OTAxOnYy", "diffSide": "RIGHT", "path": "hadoop-ozone/ozonefs-common/src/main/java/org/apache/hadoop/fs/ozone/BasicRootedOzoneFileSystem.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xM1QxMTozMDo0N1rOHyq5Dg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xM1QxMTozMDo0N1rOHyq5Dg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMjg5MzU4Mg==", "bodyText": "Avoid unnecessary duplicate conversion:\n\n  \n    \n  \n    \n\n  \n  This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters. Learn more about bidirectional Unicode characters\n\n\n  \n\n\n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                if (!OzoneFSUtils.isValidName(path.toUri().getPath())) {\n          \n          \n            \n                if (!OzoneFSUtils.isValidName(key)) {", "url": "https://github.com/apache/ozone/pull/1582#discussion_r522893582", "createdAt": "2020-11-13T11:30:47Z", "author": {"login": "adoroszlai"}, "path": "hadoop-ozone/ozonefs-common/src/main/java/org/apache/hadoop/fs/ozone/BasicRootedOzoneFileSystem.java", "diffHunk": "@@ -840,8 +842,12 @@ public String pathToKey(Path path) {\n     if (!path.isAbsolute()) {\n       path = new Path(workingDir, path);\n     }\n+    String key = path.toUri().getPath();\n+    if (!OzoneFSUtils.isValidName(path.toUri().getPath())) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "32f8159fadf4ffcae34c4e2471f47cfbb8c636e2"}, "originalPosition": 21}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzI3ODE3NzQxOnYy", "diffSide": "RIGHT", "path": "hadoop-ozone/ozonefs-common/src/main/java/org/apache/hadoop/fs/ozone/BasicOzoneFileSystem.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xM1QxMTozMzo0N1rOHyq-HQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xM1QxMTozMzo0N1rOHyq-HQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMjg5NDg3Nw==", "bodyText": "Not introduced in this patch, but would be nice to remove duplicate conversion:\n\n  \n    \n  \n    \n\n  \n  This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters. Learn more about bidirectional Unicode characters\n\n\n  \n\n\n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                if (OzoneFSUtils.isValidName(key)) {\n          \n          \n            \n                  key = path.toUri().getPath();\n          \n          \n            \n                } else {\n          \n          \n            \n                if (!OzoneFSUtils.isValidName(key)) {", "url": "https://github.com/apache/ozone/pull/1582#discussion_r522894877", "createdAt": "2020-11-13T11:33:47Z", "author": {"login": "adoroszlai"}, "path": "hadoop-ozone/ozonefs-common/src/main/java/org/apache/hadoop/fs/ozone/BasicOzoneFileSystem.java", "diffHunk": "@@ -817,7 +817,7 @@ public String pathToKey(Path path) {\n     if (OzoneFSUtils.isValidName(key)) {\n       key = path.toUri().getPath();\n     } else {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "32f8159fadf4ffcae34c4e2471f47cfbb8c636e2"}, "originalPosition": 3}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzI3ODE5NzU1OnYy", "diffSide": "RIGHT", "path": "hadoop-ozone/integration-test/src/test/java/org/apache/hadoop/fs/ozone/TestRootedOzoneFileSystem.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xM1QxMTo0MDoyNFrOHyrKDw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xM1QxMTo0MDoyNFrOHyrKDw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMjg5NzkzNQ==", "bodyText": "Seems like outputStream is never updated to non-null value, hence unnecessary.", "url": "https://github.com/apache/ozone/pull/1582#discussion_r522897935", "createdAt": "2020-11-13T11:40:24Z", "author": {"login": "adoroszlai"}, "path": "hadoop-ozone/integration-test/src/test/java/org/apache/hadoop/fs/ozone/TestRootedOzoneFileSystem.java", "diffHunk": "@@ -1210,4 +1212,33 @@ public void testTrash() throws Exception {\n     ofs.delete(trashRoot, true);\n \n   }\n+\n+  @Test\n+  public void testCreateWithInvalidPaths() throws Exception {\n+    // Test for path with ..\n+    Path parent = new Path(\"../../../../../d1/d2/\");\n+    Path file1 = new Path(parent, \"key1\");\n+    checkInvalidPath(file1);\n+\n+    // Test for path with :\n+    file1 = new Path(\"/:/:\");\n+    checkInvalidPath(file1);\n+\n+    // Test for path with scheme and authority.\n+    file1 = new Path(fs.getUri() + \"/:/:\");\n+    checkInvalidPath(file1);\n+  }\n+\n+  private void checkInvalidPath(Path path) throws Exception {\n+    FSDataOutputStream outputStream = null;\n+    try {\n+      LambdaTestUtils.intercept(InvalidPathException.class, \"Invalid path Name\",\n+          () -> fs.create(path, false));\n+    } finally {\n+      if (outputStream != null) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "32f8159fadf4ffcae34c4e2471f47cfbb8c636e2"}, "originalPosition": 43}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4722, "cost": 1, "resetAt": "2021-11-12T11:57:46Z"}}}