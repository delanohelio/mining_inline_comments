{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDE3NjgxMzIw", "number": 919, "title": "HDDS-3571. Recon: Display leader count in Datanodes page", "bodyText": "What changes were proposed in this pull request?\n\nUpdate Node endpoint to include leader count and pipelines object to include leader node\nMake changes in the frontend to add a new column \"leader count\" in Datanodes page\nUpdate pipeline icon to show if the datanode is the leader of pipeline or not in Datanodes page\nUpdate unit tests to test leader count\n\nWhat is the link to the Apache JIRA\nhttps://issues.apache.org/jira/browse/HDDS-3571\nHow was this patch tested?\nThis patch was tested in docker-compose env with multi-raft enabled.\nAdd the following configs to docker-config to enable multi-raft.\nOZONE-SITE.XML_ozone.datanode.pipeline.limit=5\nOZONE-SITE.XML_ozone.scm.ratis.pipeline.limit=0", "createdAt": "2020-05-14T00:23:55Z", "url": "https://github.com/apache/ozone/pull/919", "merged": true, "mergeCommit": {"oid": "34debd34e6ed5eda1c4e337b9b7c04716c2ddabe"}, "closed": true, "closedAt": "2020-05-14T21:17:21Z", "author": {"login": "vivekratnavel"}, "timelineItems": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABchCIdbAH2gAyNDE3NjgxMzIwOmY4MmM4YWVjNWMwMjlkNTI2NzM2MDVhZDJhNGQxNzk5ZWM1NzlhN2E=", "endCursor": "Y3Vyc29yOnYyOpPPAAABchROpXAH2gAyNDE3NjgxMzIwOjAwNWVkZWU4NjQ0NzRhZDE5MTJjNmYwOWRjYjQ5YmJlOWQ5ZTE4ZDc=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "f82c8aec5c029d52673605ad2a4d1799ec579a7a", "author": {"user": {"login": "vivekratnavel", "name": "Vivek Ratnavel Subramanian"}}, "url": "https://github.com/apache/ozone/commit/f82c8aec5c029d52673605ad2a4d1799ec579a7a", "committedDate": "2020-05-14T00:14:38Z", "message": "HDDS-3571. Recon: Display leader count in Datanodes page"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDExMzkxMzU3", "url": "https://github.com/apache/ozone/pull/919#pullrequestreview-411391357", "createdAt": "2020-05-14T00:41:45Z", "commit": {"oid": "f82c8aec5c029d52673605ad2a4d1799ec579a7a"}, "state": "COMMENTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xNFQwMDo0MTo0NVrOGVIQkQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xNFQwMDo0Mzo1M1rOGVISpQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNDgwODU5Mw==", "bodyText": "Can be regular 'int' instead of 'AtomicInteger'.", "url": "https://github.com/apache/ozone/pull/919#discussion_r424808593", "createdAt": "2020-05-14T00:41:45Z", "author": {"login": "avijayanhwx"}, "path": "hadoop-ozone/recon/src/main/java/org/apache/hadoop/ozone/recon/api/NodeEndpoint.java", "diffHunk": "@@ -81,31 +83,44 @@ public Response getDatanodes() {\n       String hostname = datanode.getHostName();\n       Set<PipelineID> pipelineIDs = nodeManager.getPipelines(datanode);\n       List<DatanodePipeline> pipelines = new ArrayList<>();\n+      AtomicInteger leaderCount = new AtomicInteger();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f82c8aec5c029d52673605ad2a4d1799ec579a7a"}, "originalPosition": 16}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNDgwOTEyNQ==", "bodyText": "UUID equality check is better here.\npipeline.getLeaderId().equals(datanode.getUuid())", "url": "https://github.com/apache/ozone/pull/919#discussion_r424809125", "createdAt": "2020-05-14T00:43:53Z", "author": {"login": "avijayanhwx"}, "path": "hadoop-ozone/recon/src/main/java/org/apache/hadoop/ozone/recon/api/NodeEndpoint.java", "diffHunk": "@@ -81,31 +83,44 @@ public Response getDatanodes() {\n       String hostname = datanode.getHostName();\n       Set<PipelineID> pipelineIDs = nodeManager.getPipelines(datanode);\n       List<DatanodePipeline> pipelines = new ArrayList<>();\n+      AtomicInteger leaderCount = new AtomicInteger();\n+      DatanodeMetadata.Builder builder = DatanodeMetadata.newBuilder();\n       pipelineIDs.forEach(pipelineID -> {\n         try {\n           Pipeline pipeline = pipelineManager.getPipeline(pipelineID);\n+          String leaderNode = pipeline.getLeaderNode().getHostName();\n           DatanodePipeline datanodePipeline = new DatanodePipeline(\n               pipelineID.getId(),\n               pipeline.getType().toString(),\n-              pipeline.getFactor().getNumber()\n+              pipeline.getFactor().getNumber(),\n+              leaderNode\n           );\n           pipelines.add(datanodePipeline);\n+          if (leaderNode.equals(hostname)) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f82c8aec5c029d52673605ad2a4d1799ec579a7a"}, "originalPosition": 30}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDEyMDI3Nzgy", "url": "https://github.com/apache/ozone/pull/919#pullrequestreview-412027782", "createdAt": "2020-05-14T17:23:42Z", "commit": {"oid": "f82c8aec5c029d52673605ad2a4d1799ec579a7a"}, "state": "COMMENTED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "005edee864474ad1912c6f09dcb49bbe9d9e18d7", "author": {"user": {"login": "vivekratnavel", "name": "Vivek Ratnavel Subramanian"}}, "url": "https://github.com/apache/ozone/commit/005edee864474ad1912c6f09dcb49bbe9d9e18d7", "committedDate": "2020-05-14T17:49:58Z", "message": "Fix review comments."}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3251, "cost": 1, "resetAt": "2021-10-28T18:00:02Z"}}}