{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0MzkyOTE0NTAy", "number": 4641, "title": "Issue 4639: Table store helper to retry only on unknownhost and auth failure for update requests", "bodyText": "Signed-off-by: Shivesh Ranjan shivesh.ranjan@gmail.com\nChange log description\nFor table update calls, retry should be done only for WrongHost and auth failed but not for other store connection failure exceptions.\nPurpose of the change\nFixes #4639\nWhat the code does\nWhile interacting with segment store for table queries, we retry on store exceptions for all requests.\nThis can have undesired effect for conditional updates because they can now fail with write conflict exception.\nHow to verify it\nUnit test added.", "createdAt": "2020-03-24T10:47:40Z", "url": "https://github.com/pravega/pravega/pull/4641", "merged": true, "mergeCommit": {"oid": "9fbbe28b23e8f9fde05aab03911fcc82bbcae5f8"}, "closed": true, "closedAt": "2020-04-01T03:33:49Z", "author": {"login": "shiveshr"}, "timelineItems": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcQwlpXAH2gAyMzkyOTE0NTAyOjc4NGQ3YTNkZTllNjA3YzgyMjVmNjNmYTM5YmVjNzExZDZkMTZkMWU=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcS8zqRgFqTM4NDQyMzA2NA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "784d7a3de9e607c8225f63fa39bec711d6d16d1e", "author": {"user": {"login": "shiveshr", "name": "shivesh ranjan"}}, "url": "https://github.com/pravega/pravega/commit/784d7a3de9e607c8225f63fa39bec711d6d16d1e", "committedDate": "2020-03-24T10:45:26Z", "message": "retry on unknownhost and auth failure\n\nSigned-off-by: Shivesh Ranjan <shivesh.ranjan@gmail.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "0a070d693bbe326d2fd1936909b7b9630cc99cd9", "author": {"user": {"login": "shiveshr", "name": "shivesh ranjan"}}, "url": "https://github.com/pravega/pravega/commit/0a070d693bbe326d2fd1936909b7b9630cc99cd9", "committedDate": "2020-03-30T03:39:40Z", "message": "Merge branch 'master' into issue4639"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzg0NDIzMDY0", "url": "https://github.com/pravega/pravega/pull/4641#pullrequestreview-384423064", "createdAt": "2020-03-31T06:02:37Z", "commit": {"oid": "0a070d693bbe326d2fd1936909b7b9630cc99cd9"}, "state": "APPROVED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0zMVQwNjowMjozN1rOF-GeYA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0zMVQwNjowMjozN1rOF-GeYA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMDY2MjExMg==", "bodyText": "This change causes a slight change in the behavior of the controller wrt to createScope().\nThis change prevents retries in the case of `ConnectionDropped` or `ConnectionFailed`. In the case of `createScope()` \nworkflow, this will prevent retries by the controller. And in this scenario the retries of the client would be used.", "url": "https://github.com/pravega/pravega/pull/4641#discussion_r400662112", "createdAt": "2020-03-31T06:02:37Z", "author": {"login": "shrids"}, "path": "controller/src/main/java/io/pravega/controller/store/stream/PravegaTablesStoreHelper.java", "diffHunk": "@@ -176,7 +178,7 @@ public void invalidateCache(String table, String key) {\n                 new TableEntryImpl<>(new TableKeyImpl<>(key.getBytes(Charsets.UTF_8), KeyVersion.NOT_EXISTS), value));\n         Supplier<String> errorMessage = () -> String.format(\"addNewEntry: key: %s table: %s\", key, tableName);\n         return withRetries(() -> segmentHelper.updateTableEntries(tableName, entries, authToken.get(), RequestTag.NON_EXISTENT_ID),\n-                errorMessage)\n+                errorMessage, true)", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "0a070d693bbe326d2fd1936909b7b9630cc99cd9"}, "originalPosition": 14}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3638, "cost": 1, "resetAt": "2021-11-01T16:37:27Z"}}}