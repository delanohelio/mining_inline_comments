{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDg4NjI5Mjg5", "number": 5198, "title": "Issue 5197: Limit number of transactions in a commit batch", "bodyText": "Signed-off-by: Shivesh Ranjan shivesh.ranjan@gmail.com\nChange log description\nLimit number of transactions in a commit batch.\nPurpose of the change\nFixes #5197\nWhat the code does\nWe add a new \"limit\" paramter to store.startCommitTransaction method which only starts a batch equal to the size of commitBatch.\nHow to verify it\nUnit test added", "createdAt": "2020-09-17T12:22:00Z", "url": "https://github.com/pravega/pravega/pull/5198", "merged": true, "mergeCommit": {"oid": "ac2e977ce5663af56b2aa89e836a74ff025d215d"}, "closed": true, "closedAt": "2020-09-18T15:36:59Z", "author": {"login": "shiveshr"}, "timelineItems": {"totalCount": 8, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdJvFrxAH2gAyNDg4NjI5Mjg5OmFiNjYwNDI1ZTE0ZDhjMGEzYjZiOGM0NTNhZmZiYzVhOTZlZGFlOGU=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdJ9y0MAH2gAyNDg4NjI5Mjg5OmU2NTAwYjliMDE2OTZlYjA5YzYxNTcwMjJkZjg2YmNmYWIzOTRlYmY=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "ab660425e14d8c0a3b6b8c453affbc5a96edae8e", "author": {"user": {"login": "shiveshr", "name": "shivesh ranjan"}}, "url": "https://github.com/pravega/pravega/commit/ab660425e14d8c0a3b6b8c453affbc5a96edae8e", "committedDate": "2020-09-17T11:14:18Z", "message": "Issue 5197: Limit number of transactions in a commit batch\n\nSigned-off-by: Shivesh Ranjan <shivesh.ranjan@gmail.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "abb38b3a76a8a0a5148d700690a345895daeb469", "author": {"user": {"login": "shiveshr", "name": "shivesh ranjan"}}, "url": "https://github.com/pravega/pravega/commit/abb38b3a76a8a0a5148d700690a345895daeb469", "committedDate": "2020-09-17T11:50:42Z", "message": "expose the limit as a param on the store interface\n\nSigned-off-by: Shivesh Ranjan <shivesh.ranjan@gmail.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b2e0efb39e1e3badf27d0a6ad02782bf0bfb41a8", "author": {"user": {"login": "shrids", "name": "Sandeep"}}, "url": "https://github.com/pravega/pravega/commit/b2e0efb39e1e3badf27d0a6ad02782bf0bfb41a8", "committedDate": "2020-09-17T13:16:03Z", "message": "Merge branch 'master' into issue-5197"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDkwNjAzOTI2", "url": "https://github.com/pravega/pravega/pull/5198#pullrequestreview-490603926", "createdAt": "2020-09-17T13:38:19Z", "commit": {"oid": "b2e0efb39e1e3badf27d0a6ad02782bf0bfb41a8"}, "state": "COMMENTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xN1QxMzozODoxOVrOHTirFQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xN1QxMzo1NDowNVrOHTjYLg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MDI1MzA3Nw==", "bodyText": "Math.min () can be used here ?", "url": "https://github.com/pravega/pravega/pull/5198#discussion_r490253077", "createdAt": "2020-09-17T13:38:19Z", "author": {"login": "shrids"}, "path": "controller/src/main/java/io/pravega/controller/store/stream/PersistentStreamBase.java", "diffHunk": "@@ -1673,7 +1677,11 @@ boolean compareWriterPositions(Map<Long, Long> position1, Map<Long, Long> positi\n             txnIds.add(x.getValue());\n         });\n \n-        return getTransactionRecords(epoch, txnIds).thenAccept(txns -> {\n+        AtomicInteger from = new AtomicInteger(0);\n+        Function<Integer, Integer> tillFunc = f -> f + limit < txnIds.size() ? f + limit : txnIds.size();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b2e0efb39e1e3badf27d0a6ad02782bf0bfb41a8"}, "originalPosition": 62}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MDI2NDYyMg==", "bodyText": "do we require this check given that the txnIds are not greater than the passed limit ?", "url": "https://github.com/pravega/pravega/pull/5198#discussion_r490264622", "createdAt": "2020-09-17T13:54:05Z", "author": {"login": "shrids"}, "path": "controller/src/main/java/io/pravega/controller/store/stream/PersistentStreamBase.java", "diffHunk": "@@ -1683,6 +1691,9 @@ boolean compareWriterPositions(Map<Long, Long> position1, Map<Long, Long> positi\n                         if (txnRecord.getCommitOrder() == order) {\n                             // if entry matches record's position then include it\n                             transactionsMap.put(txnId, txnRecord);\n+                            if (transactionsMap.size() >= limit) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b2e0efb39e1e3badf27d0a6ad02782bf0bfb41a8"}, "originalPosition": 73}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "30cdb970177b6332c2aeb17070c103a3bc3e253e", "author": {"user": {"login": "shiveshr", "name": "shivesh ranjan"}}, "url": "https://github.com/pravega/pravega/commit/30cdb970177b6332c2aeb17070c103a3bc3e253e", "committedDate": "2020-09-17T14:55:27Z", "message": "PR comment\n\nSigned-off-by: Shivesh Ranjan <shivesh.ranjan@gmail.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f87f606f2107885ff610f9767307c5b6d1b4ba51", "author": {"user": {"login": "shiveshr", "name": "shivesh ranjan"}}, "url": "https://github.com/pravega/pravega/commit/f87f606f2107885ff610f9767307c5b6d1b4ba51", "committedDate": "2020-09-17T14:55:47Z", "message": "Merge branch 'issue-5197' of https://github.com/shiveshr/pravega-1 into issue-5197"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDkwNzE3NzEx", "url": "https://github.com/pravega/pravega/pull/5198#pullrequestreview-490717711", "createdAt": "2020-09-17T15:24:50Z", "commit": {"oid": "f87f606f2107885ff610f9767307c5b6d1b4ba51"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e6500b9b01696eb09c6157022df86bcfab394ebf", "author": {"user": {"login": "shiveshr", "name": "shivesh ranjan"}}, "url": "https://github.com/pravega/pravega/commit/e6500b9b01696eb09c6157022df86bcfab394ebf", "committedDate": "2020-09-18T04:22:16Z", "message": "Merge branch 'master' into issue-5197"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3875, "cost": 1, "resetAt": "2021-11-01T16:37:27Z"}}}