{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDg0MDI3MzIz", "number": 5167, "title": "Issue 4162: add missing systemproperty parameter in build script", "bodyText": "Signed-off-by: Ravi Rajamani ravi.rajamani@emc.com\nChange log description\nAn automated build script found that tlsEnabled parameter was not being propagated. This change allows the parameter to be passed to the system tests.\n[2020-09-02T11:08:37.669Z]                 args: [-c, java -DexecType=KUBERNETES -DsecurityEnabled=true -Dlog.level=INFO -DtlsEnabled=false -cp /data/test-collection.jar io.pravega.test.system.SingleJUnitTestRunner \n\nInitially, this is looked like an oversight from the previous PR but detailed logs showed an underlying age-old bug in the system tests that it does not accept new parameters:\n[2020-09-10T22:56:24.163Z] Starting process 'Gradle Test Executor 1'. Working directory: /var/jenkins_home/workspace/test-pravega-continuous-1/pravega/test/system Command: /usr/lib64/jvm/java-1.8.0-oracle-1.8.0.231/bin/java -DbookkeeperImageName=bookkeeper -DdockerRegistryUrl=devops-repo.isus.emc.com:8116/ -DexecType=KUBERNETES -DimagePrefix=nautilus -DimageVersion=0.9.0-2646.7449afc63-issue-4162-propagate-parameters-2 -Djava.security.manager=worker.org.gradle.process.internal.worker.child.BootstrapSecurityManager -DlogLevel=INFO -Dlogback.configurationFile=/var/jenkins_home/workspace/test-pravega-continuous-1/pravega/test/system/build/resources/test/logback.xml -Dorg.gradle.native=false -DpravegaBookkeeperVersion=0.9.0-2646.7449afc63-issue-4162-propagate-parameters-2 -DpravegaImageName=pravega -DpravegaOperatorImage=pravega/pravega-operator:0.4.5 -DsecurityEnabled=true -DtestPodImage=openjdk:8u181-jre-alpine -Dtier2Config -Dtier2Type=nfs -DtlsEnabled=true -DzookeeperImageName=zookeeper -DzookeeperImageVersion=0.2.5-rc0 -DzookeeperOperatorImage=devops-repo.isus.emc.com:8116/nautilus/zookeeper-operator:0.2.5-rc0 -XX:MaxDirectMemorySize=4g -javaagent:build/tmp/expandedArchives/org.jacoco.agent-0.8.5.jar_68440dd6a8b4bc83189a456fbd91b241/jacocoagent.jar=destfile=build/jacoco/startK8SystemTests.exec,append=true,inclnolocationclasses=false,dumponexit=true,output=file,jmx=false -Xms128m -Xmx512m -Dfile.encoding=US-ASCII -Duser.country=US -Duser.language=en -Duser.variant -ea -cp /root/.gradle/caches/4.10.2/workerMain/gradle-worker.jar worker.org.gradle.process.internal.worker.GradleWorkerMain 'Gradle Test Executor 1'\n[2020-09-10T22:56:24.163Z] Successfully started process 'Gradle Test Executor 1'\n[2020-09-10T22:56:25.531Z] \n[2020-09-10T22:56:25.531Z] Gradle Test Executor 1 started executing tests.\n[2020-09-10T22:56:26.095Z] \n[2020-09-10T22:56:26.095Z] > Task :test:system:startK8SystemTests\n[2020-09-10T22:56:26.095Z] \n[2020-09-10T22:56:26.095Z] io.pravega.test.system.MultiControllerTest STANDARD_OUT\n[2020-09-10T22:56:26.095Z]     2020-09-10 22:56:25,745 325  [Test worker] DEBUG i.p.test.system.framework.Utils - execType=false\n[2020-09-10T22:56:26.095Z]     2020-09-10 22:56:25,774 354  [Test worker] DEBUG i.p.test.system.framework.Utils - securityEnabled=true\n[2020-09-10T22:56:26.095Z]     2020-09-10 22:56:25,777 357  [Test worker] DEBUG i.p.test.system.framework.Utils - tlsEnabled=false\n\nThe above snippet shows that the tlsEnabled parameter (tls) has the same source support as the securityEnabled parameter(auth) but the value toggles back when passed from gradle task to task.\nPurpose of the change\nFixes: #4162\nWhat the code does\nIt allows the build script to propagate the parameter to the running tests.\nThis works for both released and upcoming versions of pravega-operator without requiring any changes from them.\nHow to verify it\nthe testing for the changes to tls was done manually\nhttps://github.com/ravibeta/pravega/wiki/TLS-Troubleshooting-guide", "createdAt": "2020-09-10T15:48:25Z", "url": "https://github.com/pravega/pravega/pull/5167", "merged": true, "mergeCommit": {"oid": "d63f43f8621f54f0fd244d32df8c6435e4ea404c"}, "closed": true, "closedAt": "2020-09-15T01:47:15Z", "author": {"login": "ravibeta"}, "timelineItems": {"totalCount": 12, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdHiwDjAH2gAyNDg0MDI3MzIzOjdiZjBmZTlhN2ExZGM1YTY1MWY0MGNjMTI5ZDgyYTNhZjQ5OWY5ODM=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdI8j18gH2gAyNDg0MDI3MzIzOjQ1ZjY4NWI4Nzg3NGExZjM1MDQ5ZTNlMTViOTQ4NWU1MzZjY2Y2NjM=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "7bf0fe9a7a1dc5a651f40cc129d82a3af499f983", "author": {"user": {"login": "ravibeta", "name": "Ravi Rajamani"}}, "url": "https://github.com/pravega/pravega/commit/7bf0fe9a7a1dc5a651f40cc129d82a3af499f983", "committedDate": "2020-09-10T15:43:58Z", "message": "add missing parameter\n\nSigned-off-by: Ravi Rajamani <ravi.rajamani@emc.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "41f3120da1060b68ae172148e035c937ce336b46", "author": {"user": {"login": "ravibeta", "name": "Ravi Rajamani"}}, "url": "https://github.com/pravega/pravega/commit/41f3120da1060b68ae172148e035c937ce336b46", "committedDate": "2020-09-10T18:08:27Z", "message": "add logging\n\nSigned-off-by: Ravi Rajamani <ravi.rajamani@emc.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "fadcb47dc1bb1a2cb55f20662e251cbc24085447", "author": {"user": {"login": "ravibeta", "name": "Ravi Rajamani"}}, "url": "https://github.com/pravega/pravega/commit/fadcb47dc1bb1a2cb55f20662e251cbc24085447", "committedDate": "2020-09-11T01:22:30Z", "message": "pass parameters between gradle tasks to fix a very old bug\ncheck the new parameter tlsEnabled in the log snippet below:\n```\n[2020-09-10T22:56:24.163Z] Starting process 'Gradle Test Executor 1'. Working directory: /var/jenkins_home/workspace/test-pravega-continuous-1/pravega/test/system Command: /usr/lib64/jvm/java-1.8.0-oracle-1.8.0.231/bin/java -DbookkeeperImageName=bookkeeper -DdockerRegistryUrl=devops-repo.isus.emc.com:8116/ -DexecType=KUBERNETES -DimagePrefix=nautilus -DimageVersion=0.9.0-2646.7449afc63-issue-4162-propagate-parameters-2 -Djava.security.manager=worker.org.gradle.process.internal.worker.child.BootstrapSecurityManager -DlogLevel=INFO -Dlogback.configurationFile=/var/jenkins_home/workspace/test-pravega-continuous-1/pravega/test/system/build/resources/test/logback.xml -Dorg.gradle.native=false -DpravegaBookkeeperVersion=0.9.0-2646.7449afc63-issue-4162-propagate-parameters-2 -DpravegaImageName=pravega -DpravegaOperatorImage=pravega/pravega-operator:0.4.5 -DsecurityEnabled=true -DtestPodImage=openjdk:8u181-jre-alpine -Dtier2Config -Dtier2Type=nfs -DtlsEnabled=true -DzookeeperImageName=zookeeper -DzookeeperImageVersion=0.2.5-rc0 -DzookeeperOperatorImage=devops-repo.isus.emc.com:8116/nautilus/zookeeper-operator:0.2.5-rc0 -XX:MaxDirectMemorySize=4g -javaagent:build/tmp/expandedArchives/org.jacoco.agent-0.8.5.jar_68440dd6a8b4bc83189a456fbd91b241/jacocoagent.jar=destfile=build/jacoco/startK8SystemTests.exec,append=true,inclnolocationclasses=false,dumponexit=true,output=file,jmx=false -Xms128m -Xmx512m -Dfile.encoding=US-ASCII -Duser.country=US -Duser.language=en -Duser.variant -ea -cp /root/.gradle/caches/4.10.2/workerMain/gradle-worker.jar worker.org.gradle.process.internal.worker.GradleWorkerMain 'Gradle Test Executor 1'\n[2020-09-10T22:56:24.163Z] Successfully started process 'Gradle Test Executor 1'\n[2020-09-10T22:56:25.531Z]\n[2020-09-10T22:56:25.531Z] Gradle Test Executor 1 started executing tests.\n[2020-09-10T22:56:26.095Z]\n[2020-09-10T22:56:26.095Z] > Task :test:system:startK8SystemTests\n[2020-09-10T22:56:26.095Z]\n[2020-09-10T22:56:26.095Z] io.pravega.test.system.MultiControllerTest STANDARD_OUT\n[2020-09-10T22:56:26.095Z]     2020-09-10 22:56:25,745 325  [Test worker] DEBUG i.p.test.system.framework.Utils - execType=false\n[2020-09-10T22:56:26.095Z]     2020-09-10 22:56:25,774 354  [Test worker] DEBUG i.p.test.system.framework.Utils - securityEnabled=true\n[2020-09-10T22:56:26.095Z]     2020-09-10 22:56:25,777 357  [Test worker] DEBUG i.p.test.system.framework.Utils - tlsEnabled=false\n```\n\nSigned-off-by: Ravi Rajamani <ravi.rajamani@emc.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "dae9c6dff97c22703c9beabde0f50c3bb4f811f1", "author": {"user": {"login": "ravibeta", "name": "Ravi Rajamani"}}, "url": "https://github.com/pravega/pravega/commit/dae9c6dff97c22703c9beabde0f50c3bb4f811f1", "committedDate": "2020-09-11T16:01:45Z", "message": "set properties\n\nSigned-off-by: Ravi Rajamani <ravi.rajamani@emc.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "5d8d620f9c33f7fafd5f786ec97d6faf62a6b412", "author": {"user": {"login": "ravibeta", "name": "Ravi Rajamani"}}, "url": "https://github.com/pravega/pravega/commit/5d8d620f9c33f7fafd5f786ec97d6faf62a6b412", "committedDate": "2020-09-11T16:04:07Z", "message": "Merge branch 'master' into issue-4162-propagate-parameters"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDg2OTczODky", "url": "https://github.com/pravega/pravega/pull/5167#pullrequestreview-486973892", "createdAt": "2020-09-11T17:00:27Z", "commit": {"oid": "5d8d620f9c33f7fafd5f786ec97d6faf62a6b412"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "2d0f7717de0129175092acf283c62bcbf7d99430", "author": {"user": {"login": "ravibeta", "name": "Ravi Rajamani"}}, "url": "https://github.com/pravega/pravega/commit/2d0f7717de0129175092acf283c62bcbf7d99430", "committedDate": "2020-09-11T22:20:45Z", "message": "pass option between tests\n\nSigned-off-by: Ravi Rajamani <ravi.rajamani@emc.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "aa0cb7a1b52a6e21aafd51dcb29d61d71032d310", "author": {"user": {"login": "ravibeta", "name": "Ravi Rajamani"}}, "url": "https://github.com/pravega/pravega/commit/aa0cb7a1b52a6e21aafd51dcb29d61d71032d310", "committedDate": "2020-09-13T11:02:23Z", "message": "add test\n\nSigned-off-by: Ravi Rajamani <ravi.rajamani@emc.com>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDg3NDYzMTU1", "url": "https://github.com/pravega/pravega/pull/5167#pullrequestreview-487463155", "createdAt": "2020-09-14T06:57:44Z", "commit": {"oid": "aa0cb7a1b52a6e21aafd51dcb29d61d71032d310"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xNFQwNjo1Nzo0NFrOHRGOjw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xNFQwNjo1Nzo0NFrOHRGOjw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NzY4OTg3MQ==", "bodyText": "In the case of tls enabled, http is used. It looks incorrect.", "url": "https://github.com/pravega/pravega/pull/5167#discussion_r487689871", "createdAt": "2020-09-14T06:57:44Z", "author": {"login": "anishakj"}, "path": "test/system/src/test/java/io/pravega/test/system/ControllerRestApiTest.java", "diffHunk": "@@ -121,8 +121,8 @@ public void restApiTests() {\n         URI controllerRESTUri = ctlURIs.get(1);\n         Invocation.Builder builder;\n         Response response;\n-\n-        restServerURI = \"http://\" + controllerRESTUri.getHost() + \":\" + controllerRESTUri.getPort();\n+        String protocol = Utils.TLS_AND_AUTH_ENABLED ? \"http://\" : \"https://\";", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "aa0cb7a1b52a6e21aafd51dcb29d61d71032d310"}, "originalPosition": 6}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "04f3952629d4247352b22811a9995c8796242910", "author": {"user": {"login": "ravibeta", "name": "Ravi Rajamani"}}, "url": "https://github.com/pravega/pravega/commit/04f3952629d4247352b22811a9995c8796242910", "committedDate": "2020-09-14T14:12:59Z", "message": "fix test\n\nSigned-off-by: Ravi Rajamani <ravi.rajamani@emc.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "3b2d1b43e5b9529a2c1684cede09d5b85e785578", "author": {"user": {"login": "ravibeta", "name": "Ravi Rajamani"}}, "url": "https://github.com/pravega/pravega/commit/3b2d1b43e5b9529a2c1684cede09d5b85e785578", "committedDate": "2020-09-14T14:17:45Z", "message": "Merge branch 'master' into issue-4162-propagate-parameters"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "45f685b87874a1f35049e3e15b9485e536ccf663", "author": {"user": {"login": "andreipaduroiu", "name": "Andrei Paduroiu"}}, "url": "https://github.com/pravega/pravega/commit/45f685b87874a1f35049e3e15b9485e536ccf663", "committedDate": "2020-09-15T00:22:05Z", "message": "Merge branch 'master' into issue-4162-propagate-parameters"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3859, "cost": 1, "resetAt": "2021-11-01T16:37:27Z"}}}