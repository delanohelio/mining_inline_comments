{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDY3NTI3MjYw", "number": 5065, "title": "Issue 4803: Move Pravega CLI back into Pravega Core repository", "bodyText": "Change log description\nBring back Pravega CLI tools into the core repository. Separate user (based on former Interactive Demo Tool) and admin CLI (based on Pravega Tools repo) functionality into different tools.\nPurpose of the change\nFixes #4803\nWhat the code does\nThis PR adds a new module to the Pravega core repository: the cli module. In turn, this module has the CLI functionality split into 2 different submodules:\n\nAdmin CLI: This is based on the former Pravega CLI in Pravega Tools repo. It contains admin functionality to inspect and operate different parts of the system (e.g., Bookkeeper, Controller REST API, etc.). The main goal is that it will be a building block to easily incorporate other administration functionality, like data recovery.\nUser CLI: This submodule, based on the former Interactive Demo Tool, includes the basic IO operations that anyone would like to have to check if a Pravega cluster is working correctly (create scopes and streams, write and read events, operate against KVS).\n\nBoth tools are built separately.\nApart from that, this PR includes a good number of tests to bring the new modules up to the coverage requirements of the rest of the project.\nHow to verify it\nAdded a bunch of unit tests to make the CLIs to meet the code coverage requirements. Tested in standalone and real clusters.\nWorks for JDK 11.", "createdAt": "2020-08-13T17:14:31Z", "url": "https://github.com/pravega/pravega/pull/5065", "merged": true, "mergeCommit": {"oid": "2e70f876c5eaeaf0ed51504174c5e6b13f0645a1"}, "closed": true, "closedAt": "2020-10-06T19:14:09Z", "author": {"login": "RaulGracia"}, "timelineItems": {"totalCount": 67, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABc6V7msAH2gAyNDY3NTI3MjYwOjM0OTIwNmIyMWY3ZmE5N2RiMjA3MjAxOTg4MWRhODk4NTIyYTZlM2I=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdP8X5HAFqTUwMzIyOTAxOA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "349206b21f7fa97db2072019881da898522a6e3b", "author": {"user": {"login": "RaulGracia", "name": "Ra\u00fal Gracia"}}, "url": "https://github.com/pravega/pravega/commit/349206b21f7fa97db2072019881da898522a6e3b", "committedDate": "2020-07-31T15:26:48Z", "message": "Initial structure of CLI back to Pravega core.\n\nSigned-off-by: Ra\u00fal Gracia <raul.gracia@emc.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "8682aeab92ac876a9ba26da2587597013bf31161", "author": {"user": {"login": "RaulGracia", "name": "Ra\u00fal Gracia"}}, "url": "https://github.com/pravega/pravega/commit/8682aeab92ac876a9ba26da2587597013bf31161", "committedDate": "2020-08-11T00:38:26Z", "message": "Migrate tests from pravega tools.\n\nSigned-off-by: Ra\u00fal Gracia <raul.gracia@emc.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d8dd7df0d645d713e87d8ba7c8180a7ad0e6bf1e", "author": {"user": {"login": "RaulGracia", "name": "Ra\u00fal Gracia"}}, "url": "https://github.com/pravega/pravega/commit/d8dd7df0d645d713e87d8ba7c8180a7ad0e6bf1e", "committedDate": "2020-08-11T09:50:54Z", "message": "Organized user commands.\n\nSigned-off-by: Ra\u00fal Gracia <raul.gracia@emc.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "4a2c3e806ed36c8bc5973596594869bcd3f3c968", "author": {"user": {"login": "RaulGracia", "name": "Ra\u00fal Gracia"}}, "url": "https://github.com/pravega/pravega/commit/4a2c3e806ed36c8bc5973596594869bcd3f3c968", "committedDate": "2020-08-11T10:18:35Z", "message": "Added REDME for admin CLI.\n\nSigned-off-by: Ra\u00fal Gracia <raul.gracia@emc.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "15b352e100a7eb31018a62a8c90ef846171ee7b2", "author": {"user": {"login": "RaulGracia", "name": "Ra\u00fal Gracia"}}, "url": "https://github.com/pravega/pravega/commit/15b352e100a7eb31018a62a8c90ef846171ee7b2", "committedDate": "2020-08-11T11:03:29Z", "message": "Restructure directory names.\n\nSigned-off-by: Ra\u00fal Gracia <raul.gracia@emc.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a7dd062ce8f4cebe38bb47e7e7f42297f035957e", "author": {"user": {"login": "RaulGracia", "name": "Ra\u00fal Gracia"}}, "url": "https://github.com/pravega/pravega/commit/a7dd062ce8f4cebe38bb47e7e7f42297f035957e", "committedDate": "2020-08-12T23:29:31Z", "message": "Checkstyle fixes.\n\nSigned-off-by: Ra\u00fal Gracia <raul.gracia@emc.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "67907e915dfd8c1af9b4baac6909bb78a63f5fe0", "author": {"user": {"login": "RaulGracia", "name": "Ra\u00fal Gracia"}}, "url": "https://github.com/pravega/pravega/commit/67907e915dfd8c1af9b4baac6909bb78a63f5fe0", "committedDate": "2020-08-13T15:02:42Z", "message": "Added tests.\n\nSigned-off-by: Ra\u00fal Gracia <raul.gracia@emc.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c3d431e617a6450b049a955be6d78e4b47fd42e7", "author": {"user": {"login": "RaulGracia", "name": "Ra\u00fal Gracia"}}, "url": "https://github.com/pravega/pravega/commit/c3d431e617a6450b049a955be6d78e4b47fd42e7", "committedDate": "2020-08-13T17:14:41Z", "message": "Merge branch 'master' into new-cli-poc"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDY2OTc3MDc0", "url": "https://github.com/pravega/pravega/pull/5065#pullrequestreview-466977074", "createdAt": "2020-08-13T17:19:53Z", "commit": {"oid": "c3d431e617a6450b049a955be6d78e4b47fd42e7"}, "state": "COMMENTED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "bbe25e2d5c0f56327a88af198bd992084058ec0a", "author": {"user": {"login": "RaulGracia", "name": "Ra\u00fal Gracia"}}, "url": "https://github.com/pravega/pravega/commit/bbe25e2d5c0f56327a88af198bd992084058ec0a", "committedDate": "2020-08-18T16:12:37Z", "message": "Added cluster command base test.\n\nSigned-off-by: Ra\u00fal Gracia <raul.gracia@emc.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "7e096e2ee8e7221940a69b732fd48cd83aaf18ed", "author": {"user": {"login": "RaulGracia", "name": "Ra\u00fal Gracia"}}, "url": "https://github.com/pravega/pravega/commit/7e096e2ee8e7221940a69b732fd48cd83aaf18ed", "committedDate": "2020-08-18T16:25:25Z", "message": "Remove warning.\n\nSigned-off-by: Ra\u00fal Gracia <raul.gracia@emc.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "413ac8c49a63022dc895b9e82f8788ae4ed3641a", "author": {"user": {"login": "RaulGracia", "name": "Ra\u00fal Gracia"}}, "url": "https://github.com/pravega/pravega/commit/413ac8c49a63022dc895b9e82f8788ae4ed3641a", "committedDate": "2020-08-18T16:25:46Z", "message": "Merge branch 'master' into new-cli-poc"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "9b879583980e20bc110b832e89bd9b0485eccfad", "author": {"user": {"login": "RaulGracia", "name": "Ra\u00fal Gracia"}}, "url": "https://github.com/pravega/pravega/commit/9b879583980e20bc110b832e89bd9b0485eccfad", "committedDate": "2020-08-18T17:31:32Z", "message": "Revert change.\n\nSigned-off-by: Ra\u00fal Gracia <raul.gracia@emc.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a520d836d94bd631bc32ad4ef9c709184f1662ce", "author": {"user": {"login": "RaulGracia", "name": "Ra\u00fal Gracia"}}, "url": "https://github.com/pravega/pravega/commit/a520d836d94bd631bc32ad4ef9c709184f1662ce", "committedDate": "2020-08-18T18:59:54Z", "message": "Use same gson version as storage bindings module.\n\nSigned-off-by: Ra\u00fal Gracia <raul.gracia@emc.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "fcd2c5fa7f44429984dc02943de1a1e79c85c7b1", "author": {"user": {"login": "RaulGracia", "name": "Ra\u00fal Gracia"}}, "url": "https://github.com/pravega/pravega/commit/fcd2c5fa7f44429984dc02943de1a1e79c85c7b1", "committedDate": "2020-08-20T17:14:49Z", "message": "Use existing gson version in Stoage bindings package to avoid conflicts.\n\nSigned-off-by: Ra\u00fal Gracia <raul.gracia@emc.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "74abf15e19b1d95ba4e5ffc588a92e6ca388ca09", "author": {"user": {"login": "RaulGracia", "name": "Ra\u00fal Gracia"}}, "url": "https://github.com/pravega/pravega/commit/74abf15e19b1d95ba4e5ffc588a92e6ca388ca09", "committedDate": "2020-09-16T10:08:45Z", "message": "Merge branch 'master' into new-cli-poc"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "8d8292d9751345cd1677aed415eca161b7b7263c", "author": {"user": {"login": "RaulGracia", "name": "Ra\u00fal Gracia"}}, "url": "https://github.com/pravega/pravega/commit/8d8292d9751345cd1677aed415eca161b7b7263c", "committedDate": "2020-09-16T10:13:57Z", "message": "Minor change in gradle and add user test package\n\nSigned-off-by: Ra\u00fal Gracia <raul.gracia@emc.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "8bc211bcc7ea53803ca9ca4f734c724884ceff4d", "author": {"user": {"login": "RaulGracia", "name": "Ra\u00fal Gracia"}}, "url": "https://github.com/pravega/pravega/commit/8bc211bcc7ea53803ca9ca4f734c724884ceff4d", "committedDate": "2020-09-16T10:14:05Z", "message": "Merge branch 'new-cli-poc' of https://github.com/RaulGracia/pravega into new-cli-poc"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a1edf00383d5a8536aebe05258d578d48b3b49ec", "author": {"user": {"login": "RaulGracia", "name": "Ra\u00fal Gracia"}}, "url": "https://github.com/pravega/pravega/commit/a1edf00383d5a8536aebe05258d578d48b3b49ec", "committedDate": "2020-09-16T11:19:00Z", "message": "Fix spotbugs.\n\nSigned-off-by: Ra\u00fal Gracia <raul.gracia@emc.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "7926a917494c87e037efa17029567391746fb91b", "author": {"user": {"login": "RaulGracia", "name": "Ra\u00fal Gracia"}}, "url": "https://github.com/pravega/pravega/commit/7926a917494c87e037efa17029567391746fb91b", "committedDate": "2020-09-16T14:03:54Z", "message": "Comment out ongoing code to attempt getting a green build.\n\nSigned-off-by: Ra\u00fal Gracia <raul.gracia@emc.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c8f231eac0351de677235751ce6c50de13fbd5e2", "author": {"user": {"login": "RaulGracia", "name": "Ra\u00fal Gracia"}}, "url": "https://github.com/pravega/pravega/commit/c8f231eac0351de677235751ce6c50de13fbd5e2", "committedDate": "2020-09-16T14:42:35Z", "message": "Merge branch 'master' into new-cli-poc"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "7d092f4feda457623ebef4360f68012c193d12f3", "author": {"user": {"login": "RaulGracia", "name": "Ra\u00fal Gracia"}}, "url": "https://github.com/pravega/pravega/commit/7d092f4feda457623ebef4360f68012c193d12f3", "committedDate": "2020-09-16T15:18:11Z", "message": "Resolve conflict from last commit.\n\nSigned-off-by: Ra\u00fal Gracia <raul.gracia@emc.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "7fdcddac9dd516b4e9f664ba7d0f66ae513d66bc", "author": {"user": {"login": "RaulGracia", "name": "Ra\u00fal Gracia"}}, "url": "https://github.com/pravega/pravega/commit/7fdcddac9dd516b4e9f664ba7d0f66ae513d66bc", "committedDate": "2020-09-17T07:38:04Z", "message": "Start with user cli tests.\n\nSigned-off-by: Ra\u00fal Gracia <raul.gracia@emc.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "8d5804422cef6655b4703fb21fc9b0e57de48b0a", "author": {"user": {"login": "RaulGracia", "name": "Ra\u00fal Gracia"}}, "url": "https://github.com/pravega/pravega/commit/8d5804422cef6655b4703fb21fc9b0e57de48b0a", "committedDate": "2020-09-17T09:21:16Z", "message": "Adding tests to user cli.\n\nSigned-off-by: Ra\u00fal Gracia <raul.gracia@emc.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "97d3356c454e88a184770c6b193c44356d814369", "author": {"user": {"login": "RaulGracia", "name": "Ra\u00fal Gracia"}}, "url": "https://github.com/pravega/pravega/commit/97d3356c454e88a184770c6b193c44356d814369", "committedDate": "2020-09-17T10:07:34Z", "message": "Adding tests to user cli.\n\nSigned-off-by: Ra\u00fal Gracia <raul.gracia@emc.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "cebef3ee5502f9e5ba992cad87bdfb09dee7f506", "author": {"user": {"login": "RaulGracia", "name": "Ra\u00fal Gracia"}}, "url": "https://github.com/pravega/pravega/commit/cebef3ee5502f9e5ba992cad87bdfb09dee7f506", "committedDate": "2020-09-17T13:53:42Z", "message": "KVT tests to user cli.\n\nSigned-off-by: Ra\u00fal Gracia <raul.gracia@emc.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "df4fb054b83ea977e357532959f11f183b4b3d94", "author": {"user": {"login": "RaulGracia", "name": "Ra\u00fal Gracia"}}, "url": "https://github.com/pravega/pravega/commit/df4fb054b83ea977e357532959f11f183b4b3d94", "committedDate": "2020-09-18T15:56:01Z", "message": "Store current changes.\n\nSigned-off-by: Ra\u00fal Gracia <raul.gracia@emc.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "22e51d71c2474834061bbe886c3aee04d1e41370", "author": {"user": {"login": "anirudhkovuru", "name": null}}, "url": "https://github.com/pravega/pravega/commit/22e51d71c2474834061bbe886c3aee04d1e41370", "committedDate": "2020-09-21T11:27:52Z", "message": "Making name changes to config according to guidelines\n\nSigned-off-by: anirudhkovuru <anirudhkovuru@gmail.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "207ba45576516ddf22e8ed713723800ffa96388d", "author": {"user": {"login": "RaulGracia", "name": "Ra\u00fal Gracia"}}, "url": "https://github.com/pravega/pravega/commit/207ba45576516ddf22e8ed713723800ffa96388d", "committedDate": "2020-09-22T08:33:50Z", "message": "Making config parameters according to guidelines\n\nMaking config parameters according to guidelines."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "5a92a21bdbd9516cfa4275653542dcd33efc845a", "author": {"user": {"login": "RaulGracia", "name": "Ra\u00fal Gracia"}}, "url": "https://github.com/pravega/pravega/commit/5a92a21bdbd9516cfa4275653542dcd33efc845a", "committedDate": "2020-09-22T08:34:11Z", "message": "Merge branch 'master' into new-cli-poc"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "9e4c38e3ce635e2000232e23f625e624b12ef2ce", "author": {"user": {"login": "RaulGracia", "name": "Ra\u00fal Gracia"}}, "url": "https://github.com/pravega/pravega/commit/9e4c38e3ce635e2000232e23f625e624b12ef2ce", "committedDate": "2020-09-22T10:19:15Z", "message": "Completed Bookkeeper commands tests.\n\nSigned-off-by: Ra\u00fal Gracia <raul.gracia@emc.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d4839ccc32d9cecf6978aeaedc482f550bc1452b", "author": {"user": {"login": "RaulGracia", "name": "Ra\u00fal Gracia"}}, "url": "https://github.com/pravega/pravega/commit/d4839ccc32d9cecf6978aeaedc482f550bc1452b", "committedDate": "2020-09-22T10:30:40Z", "message": "Fix license.\n\nSigned-off-by: Ra\u00fal Gracia <raul.gracia@emc.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "25b2438317fad52f4e3570d7433920ee7fe5a4f9", "author": {"user": {"login": "RaulGracia", "name": "Ra\u00fal Gracia"}}, "url": "https://github.com/pravega/pravega/commit/25b2438317fad52f4e3570d7433920ee7fe5a4f9", "committedDate": "2020-09-22T14:57:24Z", "message": "Add container recovery command test.\n\nSigned-off-by: Ra\u00fal Gracia <raul.gracia@emc.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "19b51ab1f4bbb0c49a7092360dea8b86d6bdf848", "author": {"user": {"login": "RaulGracia", "name": "Ra\u00fal Gracia"}}, "url": "https://github.com/pravega/pravega/commit/19b51ab1f4bbb0c49a7092360dea8b86d6bdf848", "committedDate": "2020-09-22T15:37:04Z", "message": "Add cluster commands tests.\n\nSigned-off-by: Ra\u00fal Gracia <raul.gracia@emc.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "aade0b2017a3a052fccfb52557ebed8bcc77b881", "author": {"user": {"login": "RaulGracia", "name": "Ra\u00fal Gracia"}}, "url": "https://github.com/pravega/pravega/commit/aade0b2017a3a052fccfb52557ebed8bcc77b881", "committedDate": "2020-09-22T16:00:05Z", "message": "Add admin config commands tests.\n\nSigned-off-by: Ra\u00fal Gracia <raul.gracia@emc.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "1480685da5266ae3312cc3d9e0cff62e83dfd5fa", "author": {"user": {"login": "RaulGracia", "name": "Ra\u00fal Gracia"}}, "url": "https://github.com/pravega/pravega/commit/1480685da5266ae3312cc3d9e0cff62e83dfd5fa", "committedDate": "2020-09-22T16:31:33Z", "message": "Add password command test.\n\nSigned-off-by: Ra\u00fal Gracia <raul.gracia@emc.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a0d98d2d08552585ac3b4628eb29b1594f622e17", "author": {"user": {"login": "RaulGracia", "name": "Ra\u00fal Gracia"}}, "url": "https://github.com/pravega/pravega/commit/a0d98d2d08552585ac3b4628eb29b1594f622e17", "committedDate": "2020-09-22T17:51:09Z", "message": "Merge branch 'master' into new-cli-poc"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "9952d93ae03d8ddf3b8f2db8249d73f0352ed34a", "author": {"user": {"login": "RaulGracia", "name": "Ra\u00fal Gracia"}}, "url": "https://github.com/pravega/pravega/commit/9952d93ae03d8ddf3b8f2db8249d73f0352ed34a", "committedDate": "2020-09-23T07:53:09Z", "message": "Add interactive config test.\n\nSigned-off-by: Ra\u00fal Gracia <raul.gracia@emc.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "27c8fd8764634c0ad22238c09c6d525bbed8ce3c", "author": {"user": {"login": "RaulGracia", "name": "Ra\u00fal Gracia"}}, "url": "https://github.com/pravega/pravega/commit/27c8fd8764634c0ad22238c09c6d525bbed8ce3c", "committedDate": "2020-09-24T08:09:57Z", "message": "Added describe stream command test.\n\nSigned-off-by: Ra\u00fal Gracia <raul.gracia@emc.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f725148d5cc032b045c98f69d63e6fb97146d668", "author": {"user": {"login": "RaulGracia", "name": "Ra\u00fal Gracia"}}, "url": "https://github.com/pravega/pravega/commit/f725148d5cc032b045c98f69d63e6fb97146d668", "committedDate": "2020-09-24T10:43:28Z", "message": "Intercept output of user commands tests to verify correctness.\n\nSigned-off-by: Ra\u00fal Gracia <raul.gracia@emc.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e43670e3c7452218ac543c0fac22a3317365d783", "author": {"user": {"login": "RaulGracia", "name": "Ra\u00fal Gracia"}}, "url": "https://github.com/pravega/pravega/commit/e43670e3c7452218ac543c0fac22a3317365d783", "committedDate": "2020-09-24T11:39:07Z", "message": "Added coverage to CLI runners.\n\nSigned-off-by: Ra\u00fal Gracia <raul.gracia@emc.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "41ea767b5d2cee23532af834e1b5d4fbf29cdd8d", "author": {"user": {"login": "RaulGracia", "name": "Ra\u00fal Gracia"}}, "url": "https://github.com/pravega/pravega/commit/41ea767b5d2cee23532af834e1b5d4fbf29cdd8d", "committedDate": "2020-09-24T14:49:10Z", "message": "Added tests to User CLI utils.\n\nSigned-off-by: Ra\u00fal Gracia <raul.gracia@emc.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d5568240fc2e745c7fd73d00e83e0d5ed70e7c15", "author": {"user": {"login": "RaulGracia", "name": "Ra\u00fal Gracia"}}, "url": "https://github.com/pravega/pravega/commit/d5568240fc2e745c7fd73d00e83e0d5ed70e7c15", "committedDate": "2020-09-24T15:11:58Z", "message": "Added KVT Get command test.\n\nSigned-off-by: Ra\u00fal Gracia <raul.gracia@emc.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "8282c2a18decdc168cbd5d798aef9d2d56f5c638", "author": {"user": {"login": "RaulGracia", "name": "Ra\u00fal Gracia"}}, "url": "https://github.com/pravega/pravega/commit/8282c2a18decdc168cbd5d798aef9d2d56f5c638", "committedDate": "2020-09-24T16:47:01Z", "message": "Completed User CLI README.\n\nSigned-off-by: Ra\u00fal Gracia <raul.gracia@emc.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "3eb603b8225f0e74da44d1099bfba7e3d57172fa", "author": {"user": {"login": "RaulGracia", "name": "Ra\u00fal Gracia"}}, "url": "https://github.com/pravega/pravega/commit/3eb603b8225f0e74da44d1099bfba7e3d57172fa", "committedDate": "2020-09-25T08:42:24Z", "message": "Added code coverage.\n\nSigned-off-by: Ra\u00fal Gracia <raul.gracia@emc.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "cc75774c2f3e4ea332f7ac92cad8fb2c1914aca2", "author": {"user": {"login": "RaulGracia", "name": "Ra\u00fal Gracia"}}, "url": "https://github.com/pravega/pravega/commit/cc75774c2f3e4ea332f7ac92cad8fb2c1914aca2", "committedDate": "2020-09-25T08:54:56Z", "message": "Added code coverage to describe stream command.\n\nSigned-off-by: Ra\u00fal Gracia <raul.gracia@emc.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "153f66784601bcda0f3168d3164c5575ac9cd8ec", "author": {"user": {"login": "RaulGracia", "name": "Ra\u00fal Gracia"}}, "url": "https://github.com/pravega/pravega/commit/153f66784601bcda0f3168d3164c5575ac9cd8ec", "committedDate": "2020-09-25T08:56:56Z", "message": "Merge branch 'master' into new-cli-poc"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "6f16971d0eb115cab10329e28bada9b79ca4552e", "author": {"user": {"login": "RaulGracia", "name": "Ra\u00fal Gracia"}}, "url": "https://github.com/pravega/pravega/commit/6f16971d0eb115cab10329e28bada9b79ca4552e", "committedDate": "2020-09-25T10:10:35Z", "message": "Improvements in initial configuration upon build.\n\nSigned-off-by: Ra\u00fal Gracia <raul.gracia@emc.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "2fdc9d54d5b10694a8b2f2e5c4283d04221e2a1a", "author": {"user": {"login": "RaulGracia", "name": "Ra\u00fal Gracia"}}, "url": "https://github.com/pravega/pravega/commit/2fdc9d54d5b10694a8b2f2e5c4283d04221e2a1a", "committedDate": "2020-09-25T16:30:07Z", "message": "Merge branch 'master' into new-cli-poc"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "1b1338a58bc265ea670bfa8e01ac5abb049a8446", "author": {"user": {"login": "RaulGracia", "name": "Ra\u00fal Gracia"}}, "url": "https://github.com/pravega/pravega/commit/1b1338a58bc265ea670bfa8e01ac5abb049a8446", "committedDate": "2020-09-28T10:46:35Z", "message": "Increasing code coverage.\n\nSigned-off-by: Ra\u00fal Gracia <raul.gracia@emc.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "0ec12c2cc6982fa8aee3e2a8e905931af6368d54", "author": {"user": {"login": "RaulGracia", "name": "Ra\u00fal Gracia"}}, "url": "https://github.com/pravega/pravega/commit/0ec12c2cc6982fa8aee3e2a8e905931af6368d54", "committedDate": "2020-09-29T09:39:48Z", "message": "Merge branch 'master' into new-cli-poc"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "841a5db1b6a4986068bf0e9ddec734452eb997a0", "author": {"user": {"login": "RaulGracia", "name": "Ra\u00fal Gracia"}}, "url": "https://github.com/pravega/pravega/commit/841a5db1b6a4986068bf0e9ddec734452eb997a0", "committedDate": "2020-09-29T10:11:58Z", "message": "Increasing code coverage.\n\nSigned-off-by: Ra\u00fal Gracia <raul.gracia@emc.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "6bd1e0ad3b349d48779179c3deb46a4c397920b3", "author": {"user": {"login": "RaulGracia", "name": "Ra\u00fal Gracia"}}, "url": "https://github.com/pravega/pravega/commit/6bd1e0ad3b349d48779179c3deb46a4c397920b3", "committedDate": "2020-09-29T10:52:32Z", "message": "Increasing code coverage.\n\nSigned-off-by: Ra\u00fal Gracia <raul.gracia@emc.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "2b6355fdadf493f375da06974251a7b7160cf050", "author": {"user": {"login": "RaulGracia", "name": "Ra\u00fal Gracia"}}, "url": "https://github.com/pravega/pravega/commit/2b6355fdadf493f375da06974251a7b7160cf050", "committedDate": "2020-09-29T15:13:27Z", "message": "Increasing code coverage.\n\nSigned-off-by: Ra\u00fal Gracia <raul.gracia@emc.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c337a391ed0be2e61cdd8b394998afc8851b2679", "author": {"user": {"login": "RaulGracia", "name": "Ra\u00fal Gracia"}}, "url": "https://github.com/pravega/pravega/commit/c337a391ed0be2e61cdd8b394998afc8851b2679", "committedDate": "2020-09-29T18:08:46Z", "message": "Increasing code coverage.\n\nSigned-off-by: Ra\u00fal Gracia <raul.gracia@emc.com>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDk5NTgwMDcy", "url": "https://github.com/pravega/pravega/pull/5065#pullrequestreview-499580072", "createdAt": "2020-09-30T15:54:32Z", "commit": {"oid": "c337a391ed0be2e61cdd8b394998afc8851b2679"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0zMFQxNTo1NDozMlrOHakX9g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0zMFQxNTo1NDozMlrOHakX9g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NzYyMDk4Mg==", "bodyText": "+1 this change ensures cli is part of the docker image.", "url": "https://github.com/pravega/pravega/pull/5065#discussion_r497620982", "createdAt": "2020-09-30T15:54:32Z", "author": {"login": "shrids"}, "path": "build.gradle", "diffHunk": "@@ -1115,6 +1183,8 @@ distributions {\n             from (project(\":segmentstore:server:host\").installDist) {\n                 exclude \"logback.xml\"\n             }\n+            from (project(\":cli:admin\").installDist)", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c337a391ed0be2e61cdd8b394998afc8851b2679"}, "originalPosition": 107}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "cef1eb3dbc01a8153ea308132c7d1bcc5a049b69", "author": {"user": {"login": "RaulGracia", "name": "Ra\u00fal Gracia"}}, "url": "https://github.com/pravega/pravega/commit/cef1eb3dbc01a8153ea308132c7d1bcc5a049b69", "committedDate": "2020-10-05T09:46:20Z", "message": "Merge branch 'master' into new-cli-poc"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTAyMTU5OTI0", "url": "https://github.com/pravega/pravega/pull/5065#pullrequestreview-502159924", "createdAt": "2020-10-05T15:14:08Z", "commit": {"oid": "cef1eb3dbc01a8153ea308132c7d1bcc5a049b69"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 7, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wNVQxNToxNDowOFrOHchvNQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wNVQxNTozNjowN1rOHcisJw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5OTY3NDkzMw==", "bodyText": "This should be 11 now. Pretty soon we'll begin using JDK11 APIs so we can't really claim Java8 compatibility.", "url": "https://github.com/pravega/pravega/pull/5065#discussion_r499674933", "createdAt": "2020-10-05T15:14:08Z", "author": {"login": "andreipaduroiu"}, "path": "cli/admin/README.md", "diffHunk": "@@ -0,0 +1,130 @@\n+<!--\n+Copyright (c) Dell Inc., or its subsidiaries. All Rights Reserved.\n+\n+Licensed under the Apache License, Version 2.0 (the \"License\");\n+you may not use this file except in compliance with the License.\n+You may obtain a copy of the License at\n+\n+    http://www.apache.org/licenses/LICENSE-2.0\n+-->\n+# Pravega Admin CLI\n+\n+Pravega Admin CLI is a tool for inspecting and exploring Pravega deployments.\n+\n+## Prerequisites\n+\n+- Java 8+", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "cef1eb3dbc01a8153ea308132c7d1bcc5a049b69"}, "originalPosition": 16}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5OTY4MTY1Ng==", "bodyText": "I don't remember when I wrote this originally. Wasn't there supposed to be some code here to wait for user input to proceed? Giving this warning and immediately proceeding with disabling it may render the warning useless.", "url": "https://github.com/pravega/pravega/pull/5065#discussion_r499681656", "createdAt": "2020-10-05T15:23:45Z", "author": {"login": "andreipaduroiu"}, "path": "cli/admin/src/main/java/io/pravega/cli/admin/bookkeeper/BookKeeperDisableCommand.java", "diffHunk": "@@ -0,0 +1,91 @@\n+/**\n+ * Copyright (c) Dell Inc., or its subsidiaries. All Rights Reserved.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ */\n+package io.pravega.cli.admin.bookkeeper;\n+\n+import io.pravega.cli.admin.CommandArgs;\n+import io.pravega.common.util.RetriesExhaustedException;\n+import io.pravega.common.util.Retry;\n+import io.pravega.segmentstore.storage.DataLogWriterNotPrimaryException;\n+import java.util.concurrent.atomic.AtomicInteger;\n+import lombok.Cleanup;\n+import lombok.val;\n+\n+/**\n+ * Disables a BookKeeperLog.\n+ */\n+public class BookKeeperDisableCommand extends BookKeeperCommand {\n+    private static final int MAX_RETRIES = 10;\n+    private static final Retry.RetryAndThrowBase<? extends Exception> DISABLE_RETRY = Retry\n+            .withExpBackoff(100, 2, MAX_RETRIES, 1000)\n+            .retryWhen(ex -> ex instanceof DataLogWriterNotPrimaryException);\n+\n+    /**\n+     * Creates a new instance of the BookKeeperDisableCommand.\n+     *\n+     * @param args The arguments for the command.\n+     */\n+    public BookKeeperDisableCommand(CommandArgs args) {\n+        super(args);\n+    }\n+\n+    @Override\n+    public void execute() throws Exception {\n+        ensureArgCount(1);\n+        int logId = getIntArg(0);\n+\n+        @Cleanup\n+        val context = createContext();\n+        @Cleanup\n+        val log = context.logFactory.createDebugLogWrapper(logId);\n+\n+        // Display a summary of the BookKeeperLog.\n+        val m = log.fetchMetadata();\n+        outputLogSummary(logId, m);\n+        if (m == null) {\n+            // Nothing else to do.\n+            return;\n+        } else if (!m.isEnabled()) {\n+            output(\"BookKeeperLog '%s' is already disabled.\", logId);\n+            return;\n+        }\n+\n+        output(\"BookKeeperLog '%s' is about to be DISABLED.\", logId);\n+        output(\"\\tIts SegmentContainer will shut down and it will not be able to restart until re-enabled.\");\n+        output(\"\\tNo request on this SegmentContainer can be processed until that time (OUTAGE ALERT).\");", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "cef1eb3dbc01a8153ea308132c7d1bcc5a049b69"}, "originalPosition": 61}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5OTY4NTU2OQ==", "bodyText": "Java 11", "url": "https://github.com/pravega/pravega/pull/5065#discussion_r499685569", "createdAt": "2020-10-05T15:29:14Z", "author": {"login": "andreipaduroiu"}, "path": "cli/user/README.md", "diffHunk": "@@ -0,0 +1,101 @@\n+<!--\n+Copyright (c) Dell Inc., or its subsidiaries. All Rights Reserved.\n+\n+Licensed under the Apache License, Version 2.0 (the \"License\");\n+you may not use this file except in compliance with the License.\n+You may obtain a copy of the License at\n+\n+    http://www.apache.org/licenses/LICENSE-2.0\n+-->\n+# Pravega User CLI\n+\n+Pravega User CLI is a tool for testing Pravega deployments (it is based on the \n+former [Interactive Demo Tool](https://github.com/pravega/pravega/wiki/Interactive-Demo-Tool)).\n+\n+## Prerequisites\n+\n+- Java 8+", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "cef1eb3dbc01a8153ea308132c7d1bcc5a049b69"}, "originalPosition": 17}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5OTY4NjQ0NQ==", "bodyText": "Since this page is empty, let's rename it to something more appropriate and update code references to it.\nNow would be the best time, before we start advertising and filling it.", "url": "https://github.com/pravega/pravega/pull/5065#discussion_r499686445", "createdAt": "2020-10-05T15:30:23Z", "author": {"login": "andreipaduroiu"}, "path": "cli/user/README.md", "diffHunk": "@@ -0,0 +1,101 @@\n+<!--\n+Copyright (c) Dell Inc., or its subsidiaries. All Rights Reserved.\n+\n+Licensed under the Apache License, Version 2.0 (the \"License\");\n+you may not use this file except in compliance with the License.\n+You may obtain a copy of the License at\n+\n+    http://www.apache.org/licenses/LICENSE-2.0\n+-->\n+# Pravega User CLI\n+\n+Pravega User CLI is a tool for testing Pravega deployments (it is based on the \n+former [Interactive Demo Tool](https://github.com/pravega/pravega/wiki/Interactive-Demo-Tool)).\n+\n+## Prerequisites\n+\n+- Java 8+\n+\n+## Building Pravega User CLI\n+\n+Checkout the source code:\n+\n+```\n+git clone https://github.com/pravega/pravega\n+cd pravega\n+```\n+\n+Build the Pravega User CLI tool:\n+\n+```\n+./gradlew distTar\n+```\n+\n+Unzip the result distribution artifact:\n+\n+```\n+cd build/distributions/\n+tar -xzvf pravega-xxx-SNAPSHOT.tar\n+```\n+\n+You will find the executable file (`pravega-cli`) as well as the default configuration under the\n+`bin` directory.\n+\n+# Executing the Pravega User CLI\n+\n+Next, we show how to use the Pravega User CLI tool.\n+\n+> Before using the Pravega User CLI, we first need a Pravega cluster up and running. While the simplest way is the \n+[standalone deployment](http://pravega.io/docs/latest/deployment/run-local/), you can explore other ways \n+of deploying Pravega in the project's [documentation](http://pravega.io/docs/latest/deployment/deployment/). \n+\n+You can run the Pravega User CLI as follows:\n+```\n+./bin/pravega-cli\n+```\n+You will se an output related to the default configuration parameters:\n+```\n+Pravega User CLI Tool.\n+\tUsage instructions: https://github.com/pravega/pravega/wiki/Interactive-Demo-Tool", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "cef1eb3dbc01a8153ea308132c7d1bcc5a049b69"}, "originalPosition": 59}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5OTY4ODYyNQ==", "bodyText": "Let's fix this reference too once we rename that page.", "url": "https://github.com/pravega/pravega/pull/5065#discussion_r499688625", "createdAt": "2020-10-05T15:33:26Z", "author": {"login": "andreipaduroiu"}, "path": "cli/user/src/main/java/io/pravega/cli/user/UserCLIRunner.java", "diffHunk": "@@ -7,33 +7,43 @@\n  *\n  *     http://www.apache.org/licenses/LICENSE-2.0\n  */\n-package io.pravega.test.integration.demo.interactive;\n+package io.pravega.cli.user;\n \n import ch.qos.logback.classic.Level;\n import ch.qos.logback.classic.LoggerContext;\n+import com.google.common.annotations.VisibleForTesting;\n import com.google.common.base.Strings;\n+import io.pravega.cli.user.config.ConfigCommand;\n+import io.pravega.cli.user.config.InteractiveConfig;\n+import lombok.Cleanup;\n+import lombok.val;\n+import org.slf4j.LoggerFactory;\n+\n import java.util.Arrays;\n import java.util.Collection;\n import java.util.Collections;\n import java.util.Comparator;\n import java.util.Scanner;\n import java.util.stream.Collectors;\n-import lombok.Cleanup;\n-import lombok.val;\n-import org.slf4j.LoggerFactory;\n \n /**\n  * Interactive CLI Demo Tool for Pravega.\n  */\n-public class InteractiveDemo {\n+public class UserCLIRunner {\n     private static final String CMD_HELP = \"help\";\n     private static final String CMD_EXIT = \"exit\";\n \n-    public static void main(String[] args) throws Exception {\n+    public static void main(String[] args) {\n+        doMain(args);\n+        System.exit(0);\n+    }\n+\n+    @VisibleForTesting\n+    public static void doMain(String[] args) {\n         LoggerContext context = (LoggerContext) LoggerFactory.getILoggerFactory();\n         context.getLoggerList().get(0).setLevel(Level.ERROR);\n \n-        System.out.println(\"Pravega Interactive Demo Tool.\");\n+        System.out.println(\"Pravega User CLI Tool.\");\n         System.out.println(\"\\tUsage instructions: https://github.com/pravega/pravega/wiki/Interactive-Demo-Tool\\n\");", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "cef1eb3dbc01a8153ea308132c7d1bcc5a049b69"}, "originalPosition": 48}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5OTY4OTIwNA==", "bodyText": "Why did you make all of these public? If just for testing, shouldn't the tests be in the same package?", "url": "https://github.com/pravega/pravega/pull/5065#discussion_r499689204", "createdAt": "2020-10-05T15:34:14Z", "author": {"login": "andreipaduroiu"}, "path": "cli/user/src/main/java/io/pravega/cli/user/kvs/KeyValueTableCommand.java", "diffHunk": "@@ -35,12 +44,8 @@\n import java.util.concurrent.TimeUnit;\n import java.util.stream.Collectors;\n import java.util.stream.IntStream;\n-import lombok.Cleanup;\n-import lombok.Data;\n-import lombok.NonNull;\n-import lombok.val;\n \n-abstract class KeyValueTableCommand extends Command {\n+public abstract class KeyValueTableCommand extends Command {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "cef1eb3dbc01a8153ea308132c7d1bcc5a049b69"}, "originalPosition": 38}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5OTY5MDUzNQ==", "bodyText": "Indentation.", "url": "https://github.com/pravega/pravega/pull/5065#discussion_r499690535", "createdAt": "2020-10-05T15:36:07Z", "author": {"login": "andreipaduroiu"}, "path": "settings.gradle", "diffHunk": "@@ -25,6 +25,8 @@ include 'common',\n         'segmentstore:server:host',\n         'controller',\n         'standalone',\n+\t\t'cli:admin',", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "cef1eb3dbc01a8153ea308132c7d1bcc5a049b69"}, "originalPosition": 4}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTAyNTkxMzA5", "url": "https://github.com/pravega/pravega/pull/5065#pullrequestreview-502591309", "createdAt": "2020-10-06T05:23:42Z", "commit": {"oid": "cef1eb3dbc01a8153ea308132c7d1bcc5a049b69"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wNlQwNToyMzo0MlrOHc2VGA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wNlQwNToyNDo1OVrOHc2WcQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMDAxMjMxMg==", "bodyText": "Is it required?", "url": "https://github.com/pravega/pravega/pull/5065#discussion_r500012312", "createdAt": "2020-10-06T05:23:42Z", "author": {"login": "ManishKumarKeshri"}, "path": "cli/admin/src/test/java/io/pravega/cli/admin/bookkeeper/BookkeeperCommandsTest.java", "diffHunk": "@@ -0,0 +1,191 @@\n+/**\n+ * Copyright (c) Dell Inc., or its subsidiaries. All Rights Reserved.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ */\n+package io.pravega.cli.admin.bookkeeper;\n+\n+import io.pravega.cli.admin.AdminCommandState;\n+import io.pravega.cli.admin.CommandArgs;\n+import io.pravega.cli.admin.utils.TestUtils;\n+import io.pravega.segmentstore.server.DataCorruptionException;\n+import io.pravega.segmentstore.server.logs.DataFrameRecord;\n+import io.pravega.segmentstore.server.logs.operations.Operation;\n+import io.pravega.segmentstore.storage.DataLogNotAvailableException;\n+import io.pravega.segmentstore.storage.DurableDataLog;\n+import io.pravega.segmentstore.storage.impl.bookkeeper.BookKeeperConfig;\n+import io.pravega.segmentstore.storage.impl.bookkeeper.BookKeeperLogFactory;\n+import io.pravega.test.common.AssertExtensions;\n+import lombok.Cleanup;\n+import org.apache.bookkeeper.test.BookKeeperClusterTestCase;\n+import org.apache.curator.framework.CuratorFramework;\n+import org.apache.curator.framework.CuratorFrameworkFactory;\n+import org.apache.curator.retry.RetryOneTime;\n+import org.junit.After;\n+import org.junit.Assert;\n+import org.junit.Before;\n+import org.junit.Test;\n+\n+import java.io.ByteArrayOutputStream;\n+import java.io.PrintStream;\n+import java.time.Duration;\n+import java.util.ArrayList;\n+import java.util.Arrays;\n+import java.util.Collections;\n+import java.util.List;\n+import java.util.Properties;\n+import java.util.concurrent.Executors;\n+import java.util.concurrent.atomic.AtomicReference;\n+\n+/**\n+ * Test basic functionality of Bookkeeper commands.\n+ */\n+public class BookkeeperCommandsTest extends BookKeeperClusterTestCase {\n+\n+    private static final AtomicReference<AdminCommandState> STATE = new AtomicReference<>();\n+    private final ByteArrayOutputStream outContent = new ByteArrayOutputStream();\n+    private final PrintStream originalOut = System.out;\n+\n+    public BookkeeperCommandsTest() {\n+        super(3);\n+    }\n+\n+    @Before\n+    public void setUp() throws Exception {\n+        baseConf.setLedgerManagerFactoryClassName(\"org.apache.bookkeeper.meta.FlatLedgerManagerFactory\");\n+        baseClientConf.setLedgerManagerFactoryClassName(\"org.apache.bookkeeper.meta.FlatLedgerManagerFactory\");\n+        super.setUp();\n+\n+        STATE.set(new AdminCommandState());\n+        Properties bkProperties = new Properties();\n+        bkProperties.setProperty(\"pravegaservice.container.count\", \"4\");\n+        bkProperties.setProperty(\"pravegaservice.zk.connect.uri\", zkUtil.getZooKeeperConnectString());\n+        bkProperties.setProperty(\"bookkeeper.ledger.path\", \"/ledgers\");\n+        bkProperties.setProperty(\"bookkeeper.zk.metadata.path\", \"ledgers\");\n+        bkProperties.setProperty(\"pravegaservice.clusterName\", \"\");\n+        STATE.get().getConfigBuilder().include(bkProperties);\n+\n+        System.setOut(new PrintStream(outContent));\n+    }\n+\n+    @After\n+    public void tierDown() {\n+        System.setOut(originalOut);\n+        STATE.get().close();\n+    }\n+\n+    @Test\n+    public void testBookKeeperListCommand() throws Exception {\n+        createLedgerInBookkeeperTestCluster(0);\n+        String commandResult = TestUtils.executeCommand(\"bk list\", STATE.get());\n+        Assert.assertTrue(commandResult.contains(\"log_summary\") && commandResult.contains(\"logId\\\": 0\"));\n+    }\n+\n+    @Test\n+    public void testBookKeeperDetailsCommand() throws Exception {\n+        createLedgerInBookkeeperTestCluster(0);\n+        String commandResult = TestUtils.executeCommand(\"bk details 0\", STATE.get());\n+        Assert.assertTrue(commandResult.contains(\"log_summary\") && commandResult.contains(\"logId\\\": 0\"));\n+        commandResult = TestUtils.executeCommand(\"bk details 100\", STATE.get());\n+        Assert.assertTrue(commandResult.contains(\"log_no_metadata\"));\n+    }\n+\n+    @Test\n+    public void testBookKeeperDisableAndEnableCommands() throws Exception {\n+        createLedgerInBookkeeperTestCluster(0);\n+        String commandResult = TestUtils.executeCommand(\"bk disable 0\", STATE.get());\n+        Assert.assertTrue(commandResult.contains(\"enabled\\\": false\"));\n+        commandResult = TestUtils.executeCommand(\"bk enable 0\", STATE.get());\n+        Assert.assertTrue(commandResult.contains(\"enabled\\\": true\"));\n+        // Enable an already enabled log.\n+        commandResult = TestUtils.executeCommand(\"bk enable 0\", STATE.get());\n+        Assert.assertTrue(commandResult.contains(\"enabled\\\": true\"));\n+        commandResult = TestUtils.executeCommand(\"bk enable 100\", STATE.get());\n+        Assert.assertTrue(commandResult.contains(\"log_no_metadata\"));\n+        // Execute closing Zookeeper server.\n+        this.zkUtil.killCluster();\n+        AssertExtensions.assertThrows(DataLogNotAvailableException.class, () -> TestUtils.executeCommand(\"bk enable 0\", STATE.get()));\n+    }\n+\n+    @Test\n+    public void testBookKeeperCleanupCommand() throws Exception {\n+        createLedgerInBookkeeperTestCluster(0);\n+        String commandResult = TestUtils.executeCommand(\"bk cleanup\", STATE.get());\n+        Assert.assertTrue(commandResult.contains(\"no Ledgers eligible for deletion\"));\n+\n+        CommandArgs args = new CommandArgs(Collections.singletonList(\"\"), STATE.get());\n+        BookKeeperCleanupCommand command = new BookKeeperCleanupCommand(args);\n+        BookKeeperCommand.Context context = command.createContext();\n+\n+        // List one existing and one\n+        command.listCandidates(Collections.singletonList(0L), context);\n+        Assert.assertFalse(outContent.toString().contains(\"No such ledger exists\"));\n+        command.listCandidates(Collections.singletonList(1L), context);\n+        Assert.assertTrue(outContent.toString().contains(\"No such ledger exists\"));\n+\n+        // Try to exercise deletion standalone.\n+        command.deleteCandidates(Collections.singletonList(0L), Collections.singletonList(0L), context);\n+        command.deleteCandidates(Collections.singletonList(0L), Collections.singletonList(1L), context);\n+        Assert.assertTrue(outContent.toString().contains(\"Deleted Ledger 0\"));\n+        command.deleteCandidates(Collections.singletonList(-1L), Collections.singletonList(0L), context);\n+        command.deleteCandidates(Collections.singletonList(0L), Collections.singletonList(1L), null);\n+    }\n+\n+    @Test\n+    public void testBookKeeperRecoveryCommand() throws Exception {\n+        createLedgerInBookkeeperTestCluster(0);\n+        String commandResult = TestUtils.executeCommand(\"container recover 0\", STATE.get());\n+        Assert.assertTrue(commandResult.contains(\"Recovery complete\"));\n+        CommandArgs args = new CommandArgs(Collections.singletonList(\"0\"), STATE.get());\n+        ContainerRecoverCommand command = new ContainerRecoverCommand(args);\n+        // Test unwrap exception options.\n+        command.unwrapDataCorruptionException(new DataCorruptionException(\"test\"));\n+        command.unwrapDataCorruptionException(new DataCorruptionException(\"test\", \"test\"));\n+        command.unwrapDataCorruptionException(new DataCorruptionException(\"test\", Arrays.asList(\"test\", \"test\")));\n+        // Check that exception is thrown if ZK is not available.\n+        this.zkUtil.stopCluster();\n+        AssertExtensions.assertThrows(DataLogNotAvailableException.class, () -> TestUtils.executeCommand(\"container recover 0\", STATE.get()));\n+    }\n+\n+    @Test\n+    public void testRecoveryState() {\n+        CommandArgs args = new CommandArgs(Collections.singletonList(\"0\"), STATE.get());\n+        ContainerRecoverCommand.RecoveryState state = new ContainerRecoverCommand(args).new RecoveryState();\n+        Operation op = new TestOperation();\n+        List<DataFrameRecord.EntryInfo> entries = new ArrayList<>();\n+        entries.add(new TestEntryInfo());\n+        // Exercise RecoveryState logic.\n+        state.operationComplete(op, new DataCorruptionException(\"Test exception\"));\n+        state.newOperation(op, entries);\n+        state.operationComplete(op, null);\n+    }\n+\n+    private void createLedgerInBookkeeperTestCluster(int logId) throws Exception {\n+        BookKeeperConfig bookKeeperConfig = BookKeeperConfig.builder().with(BookKeeperConfig.ZK_METADATA_PATH, \"ledgers\")\n+                .with(BookKeeperConfig.BK_LEDGER_PATH, \"/ledgers\")\n+                .with(BookKeeperConfig.ZK_ADDRESS, zkUtil.getZooKeeperConnectString()).build();\n+        @Cleanup\n+        CuratorFramework curatorFramework = CuratorFrameworkFactory.newClient(zkUtil.getZooKeeperConnectString(), new RetryOneTime(5000));\n+        curatorFramework.start();\n+        @Cleanup\n+        BookKeeperLogFactory bookKeeperLogFactory = new BookKeeperLogFactory(bookKeeperConfig, curatorFramework, Executors.newSingleThreadScheduledExecutor());\n+        bookKeeperLogFactory.initialize();\n+        @Cleanup\n+        DurableDataLog log = bookKeeperLogFactory.createDurableDataLog(logId);\n+        log.initialize(Duration.ofSeconds(5));\n+    }\n+\n+    private static class TestOperation extends Operation {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "cef1eb3dbc01a8153ea308132c7d1bcc5a049b69"}, "originalPosition": 182}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMDAxMjY1Nw==", "bodyText": "Should it be tearDown?", "url": "https://github.com/pravega/pravega/pull/5065#discussion_r500012657", "createdAt": "2020-10-06T05:24:59Z", "author": {"login": "ManishKumarKeshri"}, "path": "cli/admin/src/test/java/io/pravega/cli/admin/bookkeeper/BookkeeperCommandsTest.java", "diffHunk": "@@ -0,0 +1,191 @@\n+/**\n+ * Copyright (c) Dell Inc., or its subsidiaries. All Rights Reserved.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ */\n+package io.pravega.cli.admin.bookkeeper;\n+\n+import io.pravega.cli.admin.AdminCommandState;\n+import io.pravega.cli.admin.CommandArgs;\n+import io.pravega.cli.admin.utils.TestUtils;\n+import io.pravega.segmentstore.server.DataCorruptionException;\n+import io.pravega.segmentstore.server.logs.DataFrameRecord;\n+import io.pravega.segmentstore.server.logs.operations.Operation;\n+import io.pravega.segmentstore.storage.DataLogNotAvailableException;\n+import io.pravega.segmentstore.storage.DurableDataLog;\n+import io.pravega.segmentstore.storage.impl.bookkeeper.BookKeeperConfig;\n+import io.pravega.segmentstore.storage.impl.bookkeeper.BookKeeperLogFactory;\n+import io.pravega.test.common.AssertExtensions;\n+import lombok.Cleanup;\n+import org.apache.bookkeeper.test.BookKeeperClusterTestCase;\n+import org.apache.curator.framework.CuratorFramework;\n+import org.apache.curator.framework.CuratorFrameworkFactory;\n+import org.apache.curator.retry.RetryOneTime;\n+import org.junit.After;\n+import org.junit.Assert;\n+import org.junit.Before;\n+import org.junit.Test;\n+\n+import java.io.ByteArrayOutputStream;\n+import java.io.PrintStream;\n+import java.time.Duration;\n+import java.util.ArrayList;\n+import java.util.Arrays;\n+import java.util.Collections;\n+import java.util.List;\n+import java.util.Properties;\n+import java.util.concurrent.Executors;\n+import java.util.concurrent.atomic.AtomicReference;\n+\n+/**\n+ * Test basic functionality of Bookkeeper commands.\n+ */\n+public class BookkeeperCommandsTest extends BookKeeperClusterTestCase {\n+\n+    private static final AtomicReference<AdminCommandState> STATE = new AtomicReference<>();\n+    private final ByteArrayOutputStream outContent = new ByteArrayOutputStream();\n+    private final PrintStream originalOut = System.out;\n+\n+    public BookkeeperCommandsTest() {\n+        super(3);\n+    }\n+\n+    @Before\n+    public void setUp() throws Exception {\n+        baseConf.setLedgerManagerFactoryClassName(\"org.apache.bookkeeper.meta.FlatLedgerManagerFactory\");\n+        baseClientConf.setLedgerManagerFactoryClassName(\"org.apache.bookkeeper.meta.FlatLedgerManagerFactory\");\n+        super.setUp();\n+\n+        STATE.set(new AdminCommandState());\n+        Properties bkProperties = new Properties();\n+        bkProperties.setProperty(\"pravegaservice.container.count\", \"4\");\n+        bkProperties.setProperty(\"pravegaservice.zk.connect.uri\", zkUtil.getZooKeeperConnectString());\n+        bkProperties.setProperty(\"bookkeeper.ledger.path\", \"/ledgers\");\n+        bkProperties.setProperty(\"bookkeeper.zk.metadata.path\", \"ledgers\");\n+        bkProperties.setProperty(\"pravegaservice.clusterName\", \"\");\n+        STATE.get().getConfigBuilder().include(bkProperties);\n+\n+        System.setOut(new PrintStream(outContent));\n+    }\n+\n+    @After\n+    public void tierDown() {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "cef1eb3dbc01a8153ea308132c7d1bcc5a049b69"}, "originalPosition": 76}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTAyNjQ0NDcx", "url": "https://github.com/pravega/pravega/pull/5065#pullrequestreview-502644471", "createdAt": "2020-10-06T07:15:06Z", "commit": {"oid": "cef1eb3dbc01a8153ea308132c7d1bcc5a049b69"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "26a90192097d941d74aed2e58d2120d55eca5a18", "author": {"user": {"login": "RaulGracia", "name": "Ra\u00fal Gracia"}}, "url": "https://github.com/pravega/pravega/commit/26a90192097d941d74aed2e58d2120d55eca5a18", "committedDate": "2020-10-06T07:34:48Z", "message": "Merge branch 'master' into new-cli-poc"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "82c285f93fa1484b5875243873363d2efd82e2ec", "author": {"user": {"login": "RaulGracia", "name": "Ra\u00fal Gracia"}}, "url": "https://github.com/pravega/pravega/commit/82c285f93fa1484b5875243873363d2efd82e2ec", "committedDate": "2020-10-06T10:09:13Z", "message": "PR feedback.\n\nSigned-off-by: Ra\u00fal Gracia <raul.gracia@emc.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "be989d236334ea844875252a52a84102baafd7d1", "author": {"user": {"login": "RaulGracia", "name": "Ra\u00fal Gracia"}}, "url": "https://github.com/pravega/pravega/commit/be989d236334ea844875252a52a84102baafd7d1", "committedDate": "2020-10-06T13:15:06Z", "message": "Added test coverage.\n\nSigned-off-by: Ra\u00fal Gracia <raul.gracia@emc.com>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTAzMTU2NTY4", "url": "https://github.com/pravega/pravega/pull/5065#pullrequestreview-503156568", "createdAt": "2020-10-06T16:36:49Z", "commit": {"oid": "be989d236334ea844875252a52a84102baafd7d1"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTAzMTg2MzM0", "url": "https://github.com/pravega/pravega/pull/5065#pullrequestreview-503186334", "createdAt": "2020-10-06T17:12:30Z", "commit": {"oid": "be989d236334ea844875252a52a84102baafd7d1"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTAzMjE0OTM1", "url": "https://github.com/pravega/pravega/pull/5065#pullrequestreview-503214935", "createdAt": "2020-10-06T17:48:44Z", "commit": {"oid": "be989d236334ea844875252a52a84102baafd7d1"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTAzMjI5MDE4", "url": "https://github.com/pravega/pravega/pull/5065#pullrequestreview-503229018", "createdAt": "2020-10-06T18:06:30Z", "commit": {"oid": "be989d236334ea844875252a52a84102baafd7d1"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4034, "cost": 1, "resetAt": "2021-11-01T16:37:27Z"}}}