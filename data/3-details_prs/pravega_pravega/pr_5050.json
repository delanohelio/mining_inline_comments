{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDY1MzUyNTg1", "number": 5050, "title": "Issue 5025: Modifying System Test Framework to implement deployment based on 0.5.x pravega operator", "bodyText": "Change log description\nModified existing System Test Framework to deploy Pravega with 0.5.x Pravega operator\nPurpose of the change\nFixes #5025\nWhat the code does\nAfter these new changes Zk-operator, BK-Operator, Pravega-Operator deployment will be done through helm for and this is implemented inside setupTestPod.sh\nNow Pravega deployment API doesn't implement bookkeeper deployment, API for bookkeeper deployment has been added now along with config map deployment inside AbstractService.java\nCorresponding new API for Config Map has been added inside K8sClient.java\nBookkeeperK8sService.java, PravegaControllerK8sService.java, PravegaSegmentStoreK8sService.java have been taken care wrt Scale Service API as per new deployment procedure.\nZookeeperK8sService.java has been modified to add reclaim policy as Delete.\nHow to verify it\nPravega Deployment with should be successful and all system test cases should be passed.", "createdAt": "2020-08-10T08:24:10Z", "url": "https://github.com/pravega/pravega/pull/5050", "merged": true, "mergeCommit": {"oid": "d09f01bea68d4c7a797809a0836a64b96a0109b1"}, "closed": true, "closedAt": "2020-09-25T11:44:02Z", "author": {"login": "Richa-Srivastava"}, "timelineItems": {"totalCount": 57, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABc9d6rUAH2gAyNDY1MzUyNTg1OmM0M2E4MmNkN2I2NzA0MWIwN2VmODhlNTNhMzJkMTc2NTY2OWE4ODk=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdMTO9qAH2gAyNDY1MzUyNTg1OmNhNGMyZDgzNjY3NmM2ZDRkMWNjMjA2MTA2YjIxY2UxZTE3NzFlMjI=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "c43a82cd7b67041b07ef88e53a32d1765669a889", "author": {"user": null}, "url": "https://github.com/pravega/pravega/commit/c43a82cd7b67041b07ef88e53a32d1765669a889", "committedDate": "2020-08-10T08:26:48Z", "message": "STF changes for 0.5.x p-op\n\nSigned-off-by: Richa-Srivastava <richa.srivastava@dell.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ebd753c2973a3dd8b5b6acabad19f5772fb8c736", "author": {"user": null}, "url": "https://github.com/pravega/pravega/commit/ebd753c2973a3dd8b5b6acabad19f5772fb8c736", "committedDate": "2020-08-10T08:26:49Z", "message": "STF changes for 05x opeartor deployment\n\nSigned-off-by: Richa-Srivastava <richa.srivastava@dell.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "0ec2b41008c0dafa081b7dbbb518f178d3ecbc6f", "author": {"user": null}, "url": "https://github.com/pravega/pravega/commit/0ec2b41008c0dafa081b7dbbb518f178d3ecbc6f", "committedDate": "2020-08-10T08:26:49Z", "message": "modified build.gradle\n\nSigned-off-by: Richa-Srivastava <richa.srivastava@dell.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "9f5a43595097319ef06f69a972a2746aea4c56e6", "author": {"user": null}, "url": "https://github.com/pravega/pravega/commit/9f5a43595097319ef06f69a972a2746aea4c56e6", "committedDate": "2020-08-10T08:26:49Z", "message": "modified setupTestPod.sh\n\nSigned-off-by: Richa-Srivastava <richa.srivastava@dell.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "6f9f1f3027193b3785080a25f1a207639893c05b", "author": {"user": null}, "url": "https://github.com/pravega/pravega/commit/6f9f1f3027193b3785080a25f1a207639893c05b", "committedDate": "2020-08-10T08:26:49Z", "message": "modified build.gradle\n\nSigned-off-by: Richa-Srivastava <richa.srivastava@dell.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "7c3f040167d5d53d02de94f7c2abaf88c1423f4c", "author": {"user": null}, "url": "https://github.com/pravega/pravega/commit/7c3f040167d5d53d02de94f7c2abaf88c1423f4c", "committedDate": "2020-08-10T08:26:49Z", "message": "Removal of comments\n\nSigned-off-by: Richa-Srivastava <richa.srivastava@dell.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "52bb524a1cf3e74549be102a3d14313750292b1f", "author": {"user": null}, "url": "https://github.com/pravega/pravega/commit/52bb524a1cf3e74549be102a3d14313750292b1f", "committedDate": "2020-08-10T08:26:49Z", "message": "Style check\n\nSigned-off-by: Srivastava <Richa.Srivastava@emc.com>\nSigned-off-by: Richa-Srivastava <richa.srivastava@dell.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "1ed9343b3feb7f884193fc0d2a57d3e47489c660", "author": {"user": {"login": "Richa-Srivastava", "name": null}}, "url": "https://github.com/pravega/pravega/commit/1ed9343b3feb7f884193fc0d2a57d3e47489c660", "committedDate": "2020-08-10T08:26:50Z", "message": "Style check\n\nSigned-off-by: Richa-Srivastava <richa.srivastava@dell.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "4be770de0680bb9022eedd2726ad0f5e542b14d9", "author": {"user": {"login": "Richa-Srivastava", "name": null}}, "url": "https://github.com/pravega/pravega/commit/4be770de0680bb9022eedd2726ad0f5e542b14d9", "committedDate": "2020-08-10T08:26:50Z", "message": "Style check\n\nSigned-off-by: Richa-Srivastava <richa.srivastava@dell.com>"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": null, "afterCommit": {"oid": "4be770de0680bb9022eedd2726ad0f5e542b14d9", "author": {"user": {"login": "Richa-Srivastava", "name": null}}, "url": "https://github.com/pravega/pravega/commit/4be770de0680bb9022eedd2726ad0f5e542b14d9", "committedDate": "2020-08-10T08:26:50Z", "message": "Style check\n\nSigned-off-by: Richa-Srivastava <richa.srivastava@dell.com>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDY1MTk5MjMz", "url": "https://github.com/pravega/pravega/pull/5050#pullrequestreview-465199233", "createdAt": "2020-08-11T15:47:51Z", "commit": {"oid": "4be770de0680bb9022eedd2726ad0f5e542b14d9"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 10, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xMVQxNTo0Nzo1MVrOG--KDg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xMVQxNTo1MjoxOFrOG--Vhg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2ODY4MzI3OA==", "bodyText": "Remove all commented out code. Here and everywhere else you used it.", "url": "https://github.com/pravega/pravega/pull/5050#discussion_r468683278", "createdAt": "2020-08-11T15:47:51Z", "author": {"login": "andreipaduroiu"}, "path": "test/system/src/main/java/io/pravega/test/system/framework/kubernetes/K8sClient.java", "diffHunk": "@@ -498,6 +500,22 @@ public void deletePVC(String namespace, String name) {\n         return exceptionallyExpecting(callback.getFuture(), isConflict, null);\n     }\n \n+    /**\n+     * Create ConfigMap.\n+     * @param namespace The namespace where the ConfigMap should be created.\n+     * @param binding The cluster ConfigMap.\n+     * @return A future indicating the status of the ConfigMap operation.\n+     */\n+    @SneakyThrows(ApiException.class)\n+    public CompletableFuture<V1ConfigMap> createConfigMap(String namespace, V1ConfigMap binding) {\n+        CoreV1Api api = new CoreV1Api();\n+        //V1ConfigMap api = new V1ConfigMap ();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "4be770de0680bb9022eedd2726ad0f5e542b14d9"}, "originalPosition": 81}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2ODY4MzQ1Mg==", "bodyText": "Please revert all formatting changes done in this file.", "url": "https://github.com/pravega/pravega/pull/5050#discussion_r468683452", "createdAt": "2020-08-11T15:48:06Z", "author": {"login": "andreipaduroiu"}, "path": "build.gradle", "diffHunk": "@@ -118,7 +118,7 @@ allprojects {\n             force \"org.apache.curator:curator-framework:\" + apacheCuratorVersion\n             force \"org.glassfish.jersey.core:jersey-common:\" + jerseyVersion\n             force \"org.glassfish.jersey.core:jersey-server:\" + jerseyVersion\n-            force \"com.fasterxml.jackson.core:jackson-databind:\" + jacksonVersion ", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "4be770de0680bb9022eedd2726ad0f5e542b14d9"}, "originalPosition": 4}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2ODY4MzcyOQ==", "bodyText": "Remove", "url": "https://github.com/pravega/pravega/pull/5050#discussion_r468683729", "createdAt": "2020-08-11T15:48:35Z", "author": {"login": "andreipaduroiu"}, "path": "build.gradle", "diffHunk": "@@ -856,8 +861,8 @@ project('test:system') {\n \n         ext.repoUrl = project.hasProperty(\"repoUrl\") ? project.repoUrl : \"\"\n         systemProperty \"execType\", \"KUBERNETES\"\n-        systemProperty \"pravegaOperatorImage\", System.getProperty(\"pravegaOperatorImage\", \"pravega/pravega-operator:latest\")\n-        systemProperty \"zookeeperOperatorImage\", System.getProperty(\"zookeeperOperatorImage\", \"pravega/zookeeper-operator:latest\")\n+        //systemProperty \"pravegaOperatorImage\", System.getProperty(\"pravegaOperatorImage\", \"pravega/pravega-operator:latest\")", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "4be770de0680bb9022eedd2726ad0f5e542b14d9"}, "originalPosition": 58}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2ODY4NDAxOQ==", "bodyText": "Why did you do this twice (here and a few lines above)?", "url": "https://github.com/pravega/pravega/pull/5050#discussion_r468684019", "createdAt": "2020-08-11T15:49:00Z", "author": {"login": "andreipaduroiu"}, "path": "build.gradle", "diffHunk": "@@ -871,22 +876,30 @@ project('test:system') {\n         systemProperty \"imageVersion\", System.getProperty(\"imageVersion\") // pravega version.\n         // bookkeeper version defaults to pravega version.\n         systemProperty \"pravegaBookkeeperVersion\", System.getProperty(\"pravegaBookkeeperVersion\", System.getProperty(\"imageVersion\"))\n-\n+        systemProperty \"bookkeeperImageVersion\", System.getProperty(\"bookkeeperImageVersion\", \"latest\") // // bookkeeper image version\n         // tier2Type , default is NFS.\n         systemProperty \"tier2Type\", System.getProperty(\"tier2Type\", \"nfs\")\n         // tier2 Configuration, specified as comma seperated key values k1=v1,k2=v2\n         systemProperty \"tier2Config\", System.getProperty(\"tier2Config\")\n-\n+        systemProperty \"imageVersionPrOp\",System.getProperty(\"imageVersionPrOp\", \"latest\")\n+        systemProperty \"imageVersionBkOp\",System.getProperty(\"imageVersionBkOp\", \"latest\")\n+        systemProperty \"imageVersionZkOp\",System.getProperty(\"imageVersionZkOp\", \"latest\")\n+        systemProperty \"chartName\",System.getProperty(\"chartName\", \"pravega\")\n+        systemProperty \"repository\",System.getProperty(\"repository\", \"pravega\")\n+\n+        systemProperty \"imageVersionPrOp\", System.getProperty(\"imageVersionPrOp\")", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "4be770de0680bb9022eedd2726ad0f5e542b14d9"}, "originalPosition": 80}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2ODY4NDA4Mw==", "bodyText": "Revert", "url": "https://github.com/pravega/pravega/pull/5050#discussion_r468684083", "createdAt": "2020-08-11T15:49:08Z", "author": {"login": "andreipaduroiu"}, "path": "gradle/wrapper/gradle-wrapper.properties", "diffHunk": "@@ -1,5 +1,6 @@\n+#Wed Jul 15 17:15:38 IST 2020\n distributionBase=GRADLE_USER_HOME\n distributionPath=wrapper/dists\n zipStoreBase=GRADLE_USER_HOME\n zipStorePath=wrapper/dists\n-distributionUrl=https\\://services.gradle.org/distributions/gradle-4.10.2-bin.zip\n+distributionUrl=https\\://services.gradle.org/distributions/gradle-4.10.2-all.zip", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "4be770de0680bb9022eedd2726ad0f5e542b14d9"}, "originalPosition": 7}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2ODY4NDI3NA==", "bodyText": "Revert.\nDoesn't this break the Rat check?", "url": "https://github.com/pravega/pravega/pull/5050#discussion_r468684274", "createdAt": "2020-08-11T15:49:25Z", "author": {"login": "andreipaduroiu"}, "path": "test/system/kubernetes/setupTestPod.sh", "diffHunk": "@@ -1,6 +1,6 @@\n #!/usr/bin/env bash\n #\n-# Copyright (c) Dell Inc., or its subsidiaries. All Rights Reserved.\n+# Copyright (c) 2017 Dell Inc., or its subsidiaries. All Rights Reserved.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "4be770de0680bb9022eedd2726ad0f5e542b14d9"}, "originalPosition": 4}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2ODY4NDk0MQ==", "bodyText": "you say alpha here but you changed it to beta above.", "url": "https://github.com/pravega/pravega/pull/5050#discussion_r468684941", "createdAt": "2020-08-11T15:50:24Z", "author": {"login": "andreipaduroiu"}, "path": "test/system/src/main/java/io/pravega/test/system/framework/services/kubernetes/AbstractService.java", "diffHunk": "@@ -83,15 +56,23 @@\n     static final String PRAVEGA_ID = \"pravega\";\n     static final String ZOOKEEPER_OPERATOR_IMAGE = System.getProperty(\"zookeeperOperatorImage\", \"pravega/zookeeper-operator:latest\");\n     static final String IMAGE_PULL_POLICY = System.getProperty(\"imagePullPolicy\", \"Always\");\n+    static final String BOOKKEEPER_ID = \"pravega-bk\";\n+    static final String CUSTOM_RESOURCE_GROUP_BOOKKEEPER = \"bookkeeper.pravega.io\";\n+    static final String CUSTOM_RESOURCE_VERSION_BOOKKEEPER = \"v1alpha1\";", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "4be770de0680bb9022eedd2726ad0f5e542b14d9"}, "originalPosition": 63}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2ODY4NTU3Ng==", "bodyText": "commented out code", "url": "https://github.com/pravega/pravega/pull/5050#discussion_r468685576", "createdAt": "2020-08-11T15:51:18Z", "author": {"login": "andreipaduroiu"}, "path": "test/system/src/main/java/io/pravega/test/system/framework/services/kubernetes/AbstractService.java", "diffHunk": "@@ -163,66 +111,32 @@ public String getID() {\n                 .put(\"segmentStoreResources\", getResources(\"2000m\", \"5Gi\", \"1000m\", \"3Gi\"))\n                 .put(\"options\", props)\n                 .put(\"image\", pravegaImgSpec)\n-                .put(\"tier2\", tier2Spec())\n+                .put(\"longtermStorage\", tier2Spec())\n                 .build();\n \n         return ImmutableMap.<String, Object>builder()\n                 .put(\"apiVersion\", CUSTOM_RESOURCE_API_VERSION)\n                 .put(\"kind\", CUSTOM_RESOURCE_KIND_PRAVEGA)\n                 .put(\"metadata\", ImmutableMap.of(\"name\", PRAVEGA_ID, \"namespace\", NAMESPACE))\n-                .put(\"spec\", buildPravegaClusterSpec(zkLocation, bookkeeperSpec, pravegaSpec))\n+                //.put(\"spec\", buildPravegaClusterSpec(zkLocation, bookkeeperSpec, pravegaSpec))", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "4be770de0680bb9022eedd2726ad0f5e542b14d9"}, "originalPosition": 163}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2ODY4NjA3Mw==", "bodyText": "extra line", "url": "https://github.com/pravega/pravega/pull/5050#discussion_r468686073", "createdAt": "2020-08-11T15:52:07Z", "author": {"login": "andreipaduroiu"}, "path": "test/system/src/main/java/io/pravega/test/system/framework/services/kubernetes/BookkeeperK8sService.java", "diffHunk": "@@ -36,73 +36,73 @@ public BookkeeperK8sService(final String id, final URI zkUri, final ImmutableMap\n \n     @Override\n     public void start(boolean wait) {\n-        Futures.getAndHandleExceptions(deployPravegaUsingOperator(zkUri, DEFAULT_CONTROLLER_COUNT, DEFAULT_SEGMENTSTORE_COUNT, DEFAULT_BOOKIE_COUNT, properties),\n-                                       t -> new TestFrameworkException(RequestFailed, \"Failed to deploy pravega operator/pravega services\", t));\n+        Futures.getAndHandleExceptions(deployBookkeeperCluster(zkUri, DEFAULT_BOOKIE_COUNT, properties),\n+                t -> new TestFrameworkException(RequestFailed, \"Failed to deploy bookkeeper operator/pravega services\", t));\n         if (wait) {\n             Futures.getAndHandleExceptions(k8sClient.waitUntilPodIsRunning(NAMESPACE, \"component\", BOOKKEEPER_LABEL, DEFAULT_BOOKIE_COUNT),\n-                                           t -> new TestFrameworkException(RequestFailed, \"Failed to deploy bookkeeper service, check the operator logs\", t));\n+                    t -> new TestFrameworkException(RequestFailed, \"Failed to deploy bookkeeper service, check the operator logs\", t));\n         }\n     }\n \n     @Override\n     public void stop() {\n-        Futures.getAndHandleExceptions(k8sClient.deleteCustomObject(CUSTOM_RESOURCE_GROUP_PRAVEGA,\n-                                                                    CUSTOM_RESOURCE_VERSION_PRAVEGA,\n-                                                                    NAMESPACE,\n-                                                                    CUSTOM_RESOURCE_PLURAL_PRAVEGA,\n-                                                                    PRAVEGA_ID),\n-                                       t -> new TestFrameworkException(RequestFailed, \"Failed to stop pravega\", t));\n+        Futures.getAndHandleExceptions(k8sClient.deleteCustomObject(CUSTOM_RESOURCE_GROUP_BOOKKEEPER,\n+                CUSTOM_RESOURCE_VERSION_BOOKKEEPER,\n+                NAMESPACE,\n+                CUSTOM_RESOURCE_PLURAL_BOOKKEEPER,\n+                BOOKKEEPER_ID),\n+                t -> new TestFrameworkException(RequestFailed, \"Failed to stop bookkeeper\", t));\n \n     }\n \n     @Override\n     public boolean isRunning() {\n         return k8sClient.getStatusOfPodWithLabel(NAMESPACE, \"component\", BOOKKEEPER_LABEL)\n-                        .thenApply(statuses -> statuses.stream()\n-                                                       .filter(podStatus -> podStatus.getContainerStatuses()\n-                                                                                     .stream()\n-                                                                                     .allMatch(st -> st.getState().getRunning() != null))\n-                                                       .count())\n-                        .thenApply(runCount -> runCount >= DEFAULT_BOOKIE_COUNT)\n-                        .exceptionally(t -> {\n-                            log.warn(\"Exception observed while checking status of pods {}. Details: {}\", BOOKKEEPER_LABEL, t.getMessage());\n-                            return false;\n-                        }).join();\n+                .thenApply(statuses -> statuses.stream()\n+                        .filter(podStatus -> podStatus.getContainerStatuses()\n+                                .stream()\n+                                .allMatch(st -> st.getState().getRunning() != null))\n+                        .count())\n+                .thenApply(runCount -> runCount >= DEFAULT_BOOKIE_COUNT)\n+                .exceptionally(t -> {\n+                    log.warn(\"Exception observed while checking status of pods {}. Details: {}\", BOOKKEEPER_LABEL, t.getMessage());\n+                    return false;\n+                }).join();\n     }\n \n     @Override\n     public List<URI> getServiceDetails() {\n         //fetch the URI.\n         return Futures.getAndHandleExceptions(k8sClient.getStatusOfPodWithLabel(NAMESPACE, \"component\", BOOKKEEPER_LABEL)\n-                                                       .thenApply(statuses -> statuses.stream()\n-                                                                                     .map(s -> URI.create(TCP + s.getPodIP() + \":\" + BOOKKEEPER_PORT))\n-                                                                                     .collect(Collectors.toList())),\n-                                              t -> new TestFrameworkException(RequestFailed, \"Failed to fetch ServiceDetails for bookkeeper\", t));\n+                        .thenApply(statuses -> statuses.stream()\n+                                .map(s -> URI.create(TCP + s.getPodIP() + \":\" + BOOKKEEPER_PORT))\n+                                .collect(Collectors.toList())),\n+                t -> new TestFrameworkException(RequestFailed, \"Failed to fetch ServiceDetails for bookkeeper\", t));\n     }\n \n     @Override\n     @SuppressWarnings(\"unchecked\")\n     public CompletableFuture<Void> scaleService(int newInstanceCount) {\n-        log.info(\"Scaling Bookkeeper service to {} instances.\", newInstanceCount);\n-        return k8sClient.getCustomObject(CUSTOM_RESOURCE_GROUP_PRAVEGA, CUSTOM_RESOURCE_VERSION_PRAVEGA, NAMESPACE, CUSTOM_RESOURCE_PLURAL_PRAVEGA, PRAVEGA_ID)\n-                        .thenCompose(o -> {\n-                            Map<String, Object> spec = (Map<String, Object>) (((Map<String, Object>) o).get(\"spec\"));\n-                            Map<String, Object> pravegaSpec = (Map<String, Object>) spec.get(\"pravega\");\n-                            Map<String, Object> bookkeeperSpec = (Map<String, Object>) spec.get(\"bookkeeper\");\n-\n-                            int currentControllerCount = ((Double) pravegaSpec.get(\"controllerReplicas\")).intValue();\n-                            int currentSegmentStoreCount = ((Double) pravegaSpec.get(\"segmentStoreReplicas\")).intValue();\n-                            int currentBookkeeperCount = ((Double) bookkeeperSpec.get(\"replicas\")).intValue();\n-                            log.debug(\"Current instance counts : Bookkeeper {} Controller {} SegmentStore {}.\", currentBookkeeperCount,\n-                                      currentControllerCount, currentSegmentStoreCount);\n-                            if (currentBookkeeperCount != newInstanceCount) {\n-                                final Map<String, Object> patchedSpec = buildPatchedPravegaClusterSpec(\"replicas\", newInstanceCount, \"bookkeeper\");\n-                                return k8sClient.createAndUpdateCustomObject(CUSTOM_RESOURCE_GROUP_PRAVEGA, CUSTOM_RESOURCE_VERSION_PRAVEGA, NAMESPACE, CUSTOM_RESOURCE_PLURAL_PRAVEGA, patchedSpec)\n-                                        .thenCompose(v -> k8sClient.waitUntilPodIsRunning(NAMESPACE, \"component\", BOOKKEEPER_LABEL, newInstanceCount));\n-                            } else {\n-                                return CompletableFuture.completedFuture(null);\n-                            }\n-                        });\n+        return k8sClient.getCustomObject(CUSTOM_RESOURCE_GROUP_BOOKKEEPER, CUSTOM_RESOURCE_VERSION_BOOKKEEPER, NAMESPACE, CUSTOM_RESOURCE_PLURAL_BOOKKEEPER, BOOKKEEPER_ID)\n+                .thenCompose(o -> {\n+                    Map<String, Object> spec = (Map<String, Object>) (((Map<String, Object>) o).get(\"spec\"));\n+                    int currentBookkeeperCount = ((Double) spec.get(\"replicas\")).intValue();\n+                    log.debug(\"Current instance counts : Bookkeeper {} .\", currentBookkeeperCount);\n+\n+                    if (currentBookkeeperCount != newInstanceCount) {\n+", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "4be770de0680bb9022eedd2726ad0f5e542b14d9"}, "originalPosition": 101}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2ODY4NjIxNA==", "bodyText": "remove these 2 extra lines", "url": "https://github.com/pravega/pravega/pull/5050#discussion_r468686214", "createdAt": "2020-08-11T15:52:18Z", "author": {"login": "andreipaduroiu"}, "path": "test/system/src/main/java/io/pravega/test/system/framework/services/kubernetes/BookkeeperK8sService.java", "diffHunk": "@@ -36,73 +36,73 @@ public BookkeeperK8sService(final String id, final URI zkUri, final ImmutableMap\n \n     @Override\n     public void start(boolean wait) {\n-        Futures.getAndHandleExceptions(deployPravegaUsingOperator(zkUri, DEFAULT_CONTROLLER_COUNT, DEFAULT_SEGMENTSTORE_COUNT, DEFAULT_BOOKIE_COUNT, properties),\n-                                       t -> new TestFrameworkException(RequestFailed, \"Failed to deploy pravega operator/pravega services\", t));\n+        Futures.getAndHandleExceptions(deployBookkeeperCluster(zkUri, DEFAULT_BOOKIE_COUNT, properties),\n+                t -> new TestFrameworkException(RequestFailed, \"Failed to deploy bookkeeper operator/pravega services\", t));\n         if (wait) {\n             Futures.getAndHandleExceptions(k8sClient.waitUntilPodIsRunning(NAMESPACE, \"component\", BOOKKEEPER_LABEL, DEFAULT_BOOKIE_COUNT),\n-                                           t -> new TestFrameworkException(RequestFailed, \"Failed to deploy bookkeeper service, check the operator logs\", t));\n+                    t -> new TestFrameworkException(RequestFailed, \"Failed to deploy bookkeeper service, check the operator logs\", t));\n         }\n     }\n \n     @Override\n     public void stop() {\n-        Futures.getAndHandleExceptions(k8sClient.deleteCustomObject(CUSTOM_RESOURCE_GROUP_PRAVEGA,\n-                                                                    CUSTOM_RESOURCE_VERSION_PRAVEGA,\n-                                                                    NAMESPACE,\n-                                                                    CUSTOM_RESOURCE_PLURAL_PRAVEGA,\n-                                                                    PRAVEGA_ID),\n-                                       t -> new TestFrameworkException(RequestFailed, \"Failed to stop pravega\", t));\n+        Futures.getAndHandleExceptions(k8sClient.deleteCustomObject(CUSTOM_RESOURCE_GROUP_BOOKKEEPER,\n+                CUSTOM_RESOURCE_VERSION_BOOKKEEPER,\n+                NAMESPACE,\n+                CUSTOM_RESOURCE_PLURAL_BOOKKEEPER,\n+                BOOKKEEPER_ID),\n+                t -> new TestFrameworkException(RequestFailed, \"Failed to stop bookkeeper\", t));\n \n     }\n \n     @Override\n     public boolean isRunning() {\n         return k8sClient.getStatusOfPodWithLabel(NAMESPACE, \"component\", BOOKKEEPER_LABEL)\n-                        .thenApply(statuses -> statuses.stream()\n-                                                       .filter(podStatus -> podStatus.getContainerStatuses()\n-                                                                                     .stream()\n-                                                                                     .allMatch(st -> st.getState().getRunning() != null))\n-                                                       .count())\n-                        .thenApply(runCount -> runCount >= DEFAULT_BOOKIE_COUNT)\n-                        .exceptionally(t -> {\n-                            log.warn(\"Exception observed while checking status of pods {}. Details: {}\", BOOKKEEPER_LABEL, t.getMessage());\n-                            return false;\n-                        }).join();\n+                .thenApply(statuses -> statuses.stream()\n+                        .filter(podStatus -> podStatus.getContainerStatuses()\n+                                .stream()\n+                                .allMatch(st -> st.getState().getRunning() != null))\n+                        .count())\n+                .thenApply(runCount -> runCount >= DEFAULT_BOOKIE_COUNT)\n+                .exceptionally(t -> {\n+                    log.warn(\"Exception observed while checking status of pods {}. Details: {}\", BOOKKEEPER_LABEL, t.getMessage());\n+                    return false;\n+                }).join();\n     }\n \n     @Override\n     public List<URI> getServiceDetails() {\n         //fetch the URI.\n         return Futures.getAndHandleExceptions(k8sClient.getStatusOfPodWithLabel(NAMESPACE, \"component\", BOOKKEEPER_LABEL)\n-                                                       .thenApply(statuses -> statuses.stream()\n-                                                                                     .map(s -> URI.create(TCP + s.getPodIP() + \":\" + BOOKKEEPER_PORT))\n-                                                                                     .collect(Collectors.toList())),\n-                                              t -> new TestFrameworkException(RequestFailed, \"Failed to fetch ServiceDetails for bookkeeper\", t));\n+                        .thenApply(statuses -> statuses.stream()\n+                                .map(s -> URI.create(TCP + s.getPodIP() + \":\" + BOOKKEEPER_PORT))\n+                                .collect(Collectors.toList())),\n+                t -> new TestFrameworkException(RequestFailed, \"Failed to fetch ServiceDetails for bookkeeper\", t));\n     }\n \n     @Override\n     @SuppressWarnings(\"unchecked\")\n     public CompletableFuture<Void> scaleService(int newInstanceCount) {\n-        log.info(\"Scaling Bookkeeper service to {} instances.\", newInstanceCount);\n-        return k8sClient.getCustomObject(CUSTOM_RESOURCE_GROUP_PRAVEGA, CUSTOM_RESOURCE_VERSION_PRAVEGA, NAMESPACE, CUSTOM_RESOURCE_PLURAL_PRAVEGA, PRAVEGA_ID)\n-                        .thenCompose(o -> {\n-                            Map<String, Object> spec = (Map<String, Object>) (((Map<String, Object>) o).get(\"spec\"));\n-                            Map<String, Object> pravegaSpec = (Map<String, Object>) spec.get(\"pravega\");\n-                            Map<String, Object> bookkeeperSpec = (Map<String, Object>) spec.get(\"bookkeeper\");\n-\n-                            int currentControllerCount = ((Double) pravegaSpec.get(\"controllerReplicas\")).intValue();\n-                            int currentSegmentStoreCount = ((Double) pravegaSpec.get(\"segmentStoreReplicas\")).intValue();\n-                            int currentBookkeeperCount = ((Double) bookkeeperSpec.get(\"replicas\")).intValue();\n-                            log.debug(\"Current instance counts : Bookkeeper {} Controller {} SegmentStore {}.\", currentBookkeeperCount,\n-                                      currentControllerCount, currentSegmentStoreCount);\n-                            if (currentBookkeeperCount != newInstanceCount) {\n-                                final Map<String, Object> patchedSpec = buildPatchedPravegaClusterSpec(\"replicas\", newInstanceCount, \"bookkeeper\");\n-                                return k8sClient.createAndUpdateCustomObject(CUSTOM_RESOURCE_GROUP_PRAVEGA, CUSTOM_RESOURCE_VERSION_PRAVEGA, NAMESPACE, CUSTOM_RESOURCE_PLURAL_PRAVEGA, patchedSpec)\n-                                        .thenCompose(v -> k8sClient.waitUntilPodIsRunning(NAMESPACE, \"component\", BOOKKEEPER_LABEL, newInstanceCount));\n-                            } else {\n-                                return CompletableFuture.completedFuture(null);\n-                            }\n-                        });\n+        return k8sClient.getCustomObject(CUSTOM_RESOURCE_GROUP_BOOKKEEPER, CUSTOM_RESOURCE_VERSION_BOOKKEEPER, NAMESPACE, CUSTOM_RESOURCE_PLURAL_BOOKKEEPER, BOOKKEEPER_ID)\n+                .thenCompose(o -> {\n+                    Map<String, Object> spec = (Map<String, Object>) (((Map<String, Object>) o).get(\"spec\"));\n+                    int currentBookkeeperCount = ((Double) spec.get(\"replicas\")).intValue();\n+                    log.debug(\"Current instance counts : Bookkeeper {} .\", currentBookkeeperCount);\n+\n+                    if (currentBookkeeperCount != newInstanceCount) {\n+\n+                        final Map<String, Object> patchedSpec = buildPatchedBookkeeperClusterSpec(\"replicas\", newInstanceCount);\n+\n+                        return k8sClient.createAndUpdateCustomObject(CUSTOM_RESOURCE_GROUP_BOOKKEEPER, CUSTOM_RESOURCE_VERSION_BOOKKEEPER, NAMESPACE, CUSTOM_RESOURCE_PLURAL_BOOKKEEPER, patchedSpec)\n+                                .thenCompose(v -> k8sClient.waitUntilPodIsRunning(NAMESPACE, \"component\", BOOKKEEPER_LABEL, newInstanceCount));\n+\n+                    } else {\n+", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "4be770de0680bb9022eedd2726ad0f5e542b14d9"}, "originalPosition": 108}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDY1NTc2MjE3", "url": "https://github.com/pravega/pravega/pull/5050#pullrequestreview-465576217", "createdAt": "2020-08-12T04:03:48Z", "commit": {"oid": "4be770de0680bb9022eedd2726ad0f5e542b14d9"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xMlQwNDowMzo0OFrOG_RA3A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xMlQwNDowOTozNlrOG_RF4w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2ODk5MjIyMA==", "bodyText": "Can we have a better naming here? As I understand this is the Pravega operator version.\nPerhaps pravegaOperatorVersion or something still better.\nLet's follow the same naming convention across all the properties.", "url": "https://github.com/pravega/pravega/pull/5050#discussion_r468992220", "createdAt": "2020-08-12T04:03:48Z", "author": {"login": "shrids"}, "path": "build.gradle", "diffHunk": "@@ -848,6 +848,11 @@ project('test:system') {\n \n     task startK8SystemTests(type: Test) {\n         tasks.withType(Exec) { environment \"tier2Type\", System.getProperty(\"tier2Type\", \"nfs\") }\n+        tasks.withType(Exec) { environment \"imageVersionPrOp\",System.getProperty(\"imageVersionPrOp\", \"latest\") }", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "4be770de0680bb9022eedd2726ad0f5e542b14d9"}, "originalPosition": 44}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2ODk5MjU4Ng==", "bodyText": "Could you please provide more details about this property? Also, could we rename it so that it indicates to the user that it is only used by a helm command?", "url": "https://github.com/pravega/pravega/pull/5050#discussion_r468992586", "createdAt": "2020-08-12T04:05:15Z", "author": {"login": "shrids"}, "path": "build.gradle", "diffHunk": "@@ -848,6 +848,11 @@ project('test:system') {\n \n     task startK8SystemTests(type: Test) {\n         tasks.withType(Exec) { environment \"tier2Type\", System.getProperty(\"tier2Type\", \"nfs\") }\n+        tasks.withType(Exec) { environment \"imageVersionPrOp\",System.getProperty(\"imageVersionPrOp\", \"latest\") }\n+        tasks.withType(Exec) { environment \"imageVersionBkOp\",System.getProperty(\"imageVersionBkOp\", \"latest\") }\n+        tasks.withType(Exec) { environment \"imageVersionZkOp\",System.getProperty(\"imageVersionZkOp\", \"latest\") }\n+        tasks.withType(Exec) { environment \"chartName\",System.getProperty(\"chartName\", \"pravega\") }\n+        tasks.withType(Exec) { environment \"repository\",System.getProperty(\"repository\", \"pravega\") }", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "4be770de0680bb9022eedd2726ad0f5e542b14d9"}, "originalPosition": 48}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2ODk5Mjk4Mw==", "bodyText": "How is this different from pravegaBookkeeperVersion?", "url": "https://github.com/pravega/pravega/pull/5050#discussion_r468992983", "createdAt": "2020-08-12T04:07:09Z", "author": {"login": "shrids"}, "path": "build.gradle", "diffHunk": "@@ -871,22 +876,30 @@ project('test:system') {\n         systemProperty \"imageVersion\", System.getProperty(\"imageVersion\") // pravega version.\n         // bookkeeper version defaults to pravega version.\n         systemProperty \"pravegaBookkeeperVersion\", System.getProperty(\"pravegaBookkeeperVersion\", System.getProperty(\"imageVersion\"))\n-\n+        systemProperty \"bookkeeperImageVersion\", System.getProperty(\"bookkeeperImageVersion\", \"latest\") // // bookkeeper image version", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "4be770de0680bb9022eedd2726ad0f5e542b14d9"}, "originalPosition": 68}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2ODk5MzUwNw==", "bodyText": "Is this the repository used by the helm command? could we update the property name here ?", "url": "https://github.com/pravega/pravega/pull/5050#discussion_r468993507", "createdAt": "2020-08-12T04:09:36Z", "author": {"login": "shrids"}, "path": "build.gradle", "diffHunk": "@@ -871,22 +876,30 @@ project('test:system') {\n         systemProperty \"imageVersion\", System.getProperty(\"imageVersion\") // pravega version.\n         // bookkeeper version defaults to pravega version.\n         systemProperty \"pravegaBookkeeperVersion\", System.getProperty(\"pravegaBookkeeperVersion\", System.getProperty(\"imageVersion\"))\n-\n+        systemProperty \"bookkeeperImageVersion\", System.getProperty(\"bookkeeperImageVersion\", \"latest\") // // bookkeeper image version\n         // tier2Type , default is NFS.\n         systemProperty \"tier2Type\", System.getProperty(\"tier2Type\", \"nfs\")\n         // tier2 Configuration, specified as comma seperated key values k1=v1,k2=v2\n         systemProperty \"tier2Config\", System.getProperty(\"tier2Config\")\n-\n+        systemProperty \"imageVersionPrOp\",System.getProperty(\"imageVersionPrOp\", \"latest\")\n+        systemProperty \"imageVersionBkOp\",System.getProperty(\"imageVersionBkOp\", \"latest\")\n+        systemProperty \"imageVersionZkOp\",System.getProperty(\"imageVersionZkOp\", \"latest\")\n+        systemProperty \"chartName\",System.getProperty(\"chartName\", \"pravega\")\n+        systemProperty \"repository\",System.getProperty(\"repository\", \"pravega\")", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "4be770de0680bb9022eedd2726ad0f5e542b14d9"}, "originalPosition": 78}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "500d69c7005f49fb0ef3474be57d639ec26bc056", "author": {"user": {"login": "Richa-Srivastava", "name": null}}, "url": "https://github.com/pravega/pravega/commit/500d69c7005f49fb0ef3474be57d639ec26bc056", "committedDate": "2020-09-01T07:45:21Z", "message": "Applying review comments\n\nSigned-off-by: Richa-Srivastava <richa.srivastava@dell.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "316578d135002bdc20d5345867fffabfffb66655", "author": {"user": {"login": "Richa-Srivastava", "name": null}}, "url": "https://github.com/pravega/pravega/commit/316578d135002bdc20d5345867fffabfffb66655", "committedDate": "2020-09-01T07:45:31Z", "message": "Merge remote-tracking branch 'upstream/master' into stf-changes"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "68bde7d67456197c1d4519a5904084d5c74d4696", "author": {"user": {"login": "Richa-Srivastava", "name": null}}, "url": "https://github.com/pravega/pravega/commit/68bde7d67456197c1d4519a5904084d5c74d4696", "committedDate": "2020-09-02T06:23:47Z", "message": "Merge branch 'master' into stf-changes"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "db4d2215b583688ea01fc18833b3aabafef63011", "author": {"user": {"login": "Richa-Srivastava", "name": null}}, "url": "https://github.com/pravega/pravega/commit/db4d2215b583688ea01fc18833b3aabafef63011", "committedDate": "2020-09-02T11:23:59Z", "message": "modifying testmode\n\nSigned-off-by: Richa-Srivastava <richa.srivastava@dell.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ad34378a8be03b6b6e5d9ceab443159a217cff39", "author": {"user": {"login": "Richa-Srivastava", "name": null}}, "url": "https://github.com/pravega/pravega/commit/ad34378a8be03b6b6e5d9ceab443159a217cff39", "committedDate": "2020-09-02T14:26:20Z", "message": "Added CERT support for p-op deployment\n\nSigned-off-by: Richa-Srivastava <richa.srivastava@dell.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "81b472e0275f1ef44e694dac297be64ce09d5ce5", "author": {"user": {"login": "Richa-Srivastava", "name": null}}, "url": "https://github.com/pravega/pravega/commit/81b472e0275f1ef44e694dac297be64ce09d5ce5", "committedDate": "2020-09-03T05:30:09Z", "message": "modified setupTestPod script\n\nSigned-off-by: Richa-Srivastava <richa.srivastava@dell.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "69a918f912df652688a4e11160b80527175cf9f3", "author": {"user": {"login": "Richa-Srivastava", "name": null}}, "url": "https://github.com/pravega/pravega/commit/69a918f912df652688a4e11160b80527175cf9f3", "committedDate": "2020-09-03T06:14:19Z", "message": "Modified setupTestpod\n\nSigned-off-by: Richa-Srivastava <richa.srivastava@dell.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "edcb4e85a9f29f689fdeff794f9087d5141ce749", "author": {"user": {"login": "Richa-Srivastava", "name": null}}, "url": "https://github.com/pravega/pravega/commit/edcb4e85a9f29f689fdeff794f9087d5141ce749", "committedDate": "2020-09-03T13:55:18Z", "message": "Adding new parameter\n\nSigned-off-by: Richa-Srivastava <richa.srivastava@dell.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "0e99f15bfdf150a8466c377ad90c994e56442f7d", "author": {"user": {"login": "shrids", "name": "Sandeep"}}, "url": "https://github.com/pravega/pravega/commit/0e99f15bfdf150a8466c377ad90c994e56442f7d", "committedDate": "2020-09-04T11:01:09Z", "message": "Merge branch 'master' into stf-changes"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "46ede0ee31c304f23c268d3da6426410040ec804", "author": {"user": {"login": "Richa-Srivastava", "name": null}}, "url": "https://github.com/pravega/pravega/commit/46ede0ee31c304f23c268d3da6426410040ec804", "committedDate": "2020-09-09T12:02:53Z", "message": "Applying TLS changes\n\nSigned-off-by: root <richa.srivastava@dell.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "29615c9dcb6c37483689dfed50a70479cb0c2139", "author": {"user": {"login": "Richa-Srivastava", "name": null}}, "url": "https://github.com/pravega/pravega/commit/29615c9dcb6c37483689dfed50a70479cb0c2139", "committedDate": "2020-09-09T12:28:11Z", "message": "Resolving style check\n\nSigned-off-by: root <richa.srivastava@dell.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "8952c60395a41d1b944ca241b6aa961d1158c157", "author": {"user": {"login": "Richa-Srivastava", "name": null}}, "url": "https://github.com/pravega/pravega/commit/8952c60395a41d1b944ca241b6aa961d1158c157", "committedDate": "2020-09-09T14:13:18Z", "message": "Fixing K8sClient\n\nSigned-off-by: root <richa.srivastava@dell.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "1f5689250d6ba2fedeea3415a72c7aa3dac88542", "author": {"user": {"login": "Richa-Srivastava", "name": null}}, "url": "https://github.com/pravega/pravega/commit/1f5689250d6ba2fedeea3415a72c7aa3dac88542", "committedDate": "2020-09-10T04:47:30Z", "message": "Adding additional files for TLS support\n\nSigned-off-by: root <richa.srivastava@dell.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "8b6f7ceece6c7eafa727bffadb668cb7436bb46f", "author": {"user": {"login": "Richa-Srivastava", "name": null}}, "url": "https://github.com/pravega/pravega/commit/8b6f7ceece6c7eafa727bffadb668cb7436bb46f", "committedDate": "2020-09-10T07:45:21Z", "message": "Merge branch 'master' into stf-changes"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a4c2faa9b2d49a9e4ec7540f860994a6f8e68d92", "author": {"user": {"login": "Richa-Srivastava", "name": null}}, "url": "https://github.com/pravega/pravega/commit/a4c2faa9b2d49a9e4ec7540f860994a6f8e68d92", "committedDate": "2020-09-10T08:11:52Z", "message": "modifying AbstractService.java\n\nSigned-off-by: root <richa.srivastava@dell.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "7bcad0a546f6c067d2c1219559dc6547d6dfd13d", "author": {"user": {"login": "Richa-Srivastava", "name": null}}, "url": "https://github.com/pravega/pravega/commit/7bcad0a546f6c067d2c1219559dc6547d6dfd13d", "committedDate": "2020-09-22T06:50:30Z", "message": "Merge branch 'master' into stf-changes"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "57156219188703afe8b447d063f9343b3b0426f9", "author": {"user": {"login": "Richa-Srivastava", "name": null}}, "url": "https://github.com/pravega/pravega/commit/57156219188703afe8b447d063f9343b3b0426f9", "committedDate": "2020-09-22T08:36:22Z", "message": "modified file build.gradle\n\nSigned-off-by: root <richa.srivastava@dell.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "4ce3ed58cb63d95be183df503d0e4332f31a65d0", "author": {"user": {"login": "Richa-Srivastava", "name": null}}, "url": "https://github.com/pravega/pravega/commit/4ce3ed58cb63d95be183df503d0e4332f31a65d0", "committedDate": "2020-09-23T06:22:59Z", "message": "Merge branch 'master' into stf-changes"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "0416c55d3698c69031eefc7c59839d98897be833", "author": {"user": {"login": "Richa-Srivastava", "name": null}}, "url": "https://github.com/pravega/pravega/commit/0416c55d3698c69031eefc7c59839d98897be833", "committedDate": "2020-09-23T13:02:51Z", "message": "Modifying for auth\n\nSigned-off-by: Richa-Srivastava <richa.srivastava@dell.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "18b4d12db5fd31064bc3b4898c17eeb15460a00a", "author": {"user": {"login": "Richa-Srivastava", "name": null}}, "url": "https://github.com/pravega/pravega/commit/18b4d12db5fd31064bc3b4898c17eeb15460a00a", "committedDate": "2020-09-23T14:13:48Z", "message": "Modifying for auth\n\nSigned-off-by: Richa-Srivastava <richa.srivastava@dell.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "3acbbe6d742833d2e32b6c296da88a7b3f52c2c5", "author": {"user": {"login": "Richa-Srivastava", "name": null}}, "url": "https://github.com/pravega/pravega/commit/3acbbe6d742833d2e32b6c296da88a7b3f52c2c5", "committedDate": "2020-09-23T14:17:15Z", "message": "Modifying for auth\n\nSigned-off-by: Richa-Srivastava <richa.srivastava@dell.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "2dd53616d17abe21b76d63f87e9d8a053b6206ff", "author": {"user": {"login": "Richa-Srivastava", "name": null}}, "url": "https://github.com/pravega/pravega/commit/2dd53616d17abe21b76d63f87e9d8a053b6206ff", "committedDate": "2020-09-23T14:27:50Z", "message": "Modifying for auth\n\nSigned-off-by: Richa-Srivastava <richa.srivastava@dell.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "6702a4856c2b061ca1988d63bdeed6d3789490d3", "author": {"user": {"login": "Richa-Srivastava", "name": null}}, "url": "https://github.com/pravega/pravega/commit/6702a4856c2b061ca1988d63bdeed6d3789490d3", "committedDate": "2020-09-23T14:59:05Z", "message": "Modifying for auth\n\nSigned-off-by: Richa-Srivastava <richa.srivastava@dell.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f2c3d79500c30b682518df198a6e227ce4667577", "author": {"user": {"login": "Richa-Srivastava", "name": null}}, "url": "https://github.com/pravega/pravega/commit/f2c3d79500c30b682518df198a6e227ce4667577", "committedDate": "2020-09-24T06:37:45Z", "message": "Cleaned up code\n\nSigned-off-by: Richa-Srivastava <richa.srivastava@dell.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "4f7f86ed9c0b40968459d09637fd31c89077214f", "author": {"user": {"login": "Richa-Srivastava", "name": null}}, "url": "https://github.com/pravega/pravega/commit/4f7f86ed9c0b40968459d09637fd31c89077214f", "committedDate": "2020-09-24T06:47:17Z", "message": "Modified after style check\n\nSigned-off-by: Richa-Srivastava <richa.srivastava@dell.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a823627a9d6b1073349af5cc97aa6a972227acc8", "author": {"user": {"login": "Richa-Srivastava", "name": null}}, "url": "https://github.com/pravega/pravega/commit/a823627a9d6b1073349af5cc97aa6a972227acc8", "committedDate": "2020-09-24T06:59:07Z", "message": "Adding new parameters required for Upgrade testcases\n\nSigned-off-by: Richa-Srivastava <richa.srivastava@dell.com>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDk1Mjc5NDU3", "url": "https://github.com/pravega/pravega/pull/5050#pullrequestreview-495279457", "createdAt": "2020-09-24T07:13:05Z", "commit": {"oid": "a823627a9d6b1073349af5cc97aa6a972227acc8"}, "state": "COMMENTED", "comments": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yNFQwNzoxMzowNVrOHXMv7w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yNFQwNzoxOTo0M1rOHXM89A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NDA4ODE3NQ==", "bodyText": "Can we move this code directly into exec task?, i.e directly into copyTestsToK8sCluster.\nPerhaps with that approach we can simply this part of the code.", "url": "https://github.com/pravega/pravega/pull/5050#discussion_r494088175", "createdAt": "2020-09-24T07:13:05Z", "author": {"login": "shrids"}, "path": "build.gradle", "diffHunk": "@@ -849,18 +849,22 @@ project('test:system') {\n \n     task startK8SystemTests(type: Test) {\n         tasks.withType(Exec) { environment \"tier2Type\", System.getProperty(\"tier2Type\", \"nfs\") }\n+        tasks.withType(Exec) { environment \"pravegaOperatorVersion\",System.getProperty(\"pravegaOperatorVersion\", \"latest\") }", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a823627a9d6b1073349af5cc97aa6a972227acc8"}, "originalPosition": 44}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NDA4ODcyOQ==", "bodyText": "should it default to the pravega version?", "url": "https://github.com/pravega/pravega/pull/5050#discussion_r494088729", "createdAt": "2020-09-24T07:14:13Z", "author": {"login": "shrids"}, "path": "build.gradle", "diffHunk": "@@ -871,22 +876,30 @@ project('test:system') {\n         systemProperty \"imageVersion\", System.getProperty(\"imageVersion\") // pravega version.\n         // bookkeeper version defaults to pravega version.\n         systemProperty \"pravegaBookkeeperVersion\", System.getProperty(\"pravegaBookkeeperVersion\", System.getProperty(\"imageVersion\"))\n-\n+        systemProperty \"bookkeeperImageVersion\", System.getProperty(\"bookkeeperImageVersion\", \"latest\") // // bookkeeper image version", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2ODk5Mjk4Mw=="}, "originalCommit": {"oid": "4be770de0680bb9022eedd2726ad0f5e542b14d9"}, "originalPosition": 68}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NDA4OTM4MA==", "bodyText": "I did not understand what does CM stand for?", "url": "https://github.com/pravega/pravega/pull/5050#discussion_r494089380", "createdAt": "2020-09-24T07:15:27Z", "author": {"login": "shrids"}, "path": "build.gradle", "diffHunk": "@@ -872,25 +876,38 @@ project('test:system') {\n         systemProperty \"zookeeperImageName\", System.getProperty(\"zookeeperImageName\", \"zookeeper\") // zookkeeper image name\n         systemProperty \"zookeeperImageVersion\", System.getProperty(\"zookeeperImageVersion\", \"latest\") // zookeeper image version\n         systemProperty \"imageVersion\", System.getProperty(\"imageVersion\") // pravega version.\n-        // bookkeeper version defaults to pravega version.\n-        systemProperty \"pravegaBookkeeperVersion\", System.getProperty(\"pravegaBookkeeperVersion\", System.getProperty(\"imageVersion\"))\n-\n+        // bookkeeper version can be different from pravega version.\n+        systemProperty \"bookkeeperImageVersion\", System.getProperty(\"bookkeeperImageVersion\", \"latest\") // // bookkeeper image version\n         // tier2Type , default is NFS.\n         systemProperty \"tier2Type\", System.getProperty(\"tier2Type\", \"nfs\")\n         // tier2 Configuration, specified as comma seperated key values k1=v1,k2=v2\n         systemProperty \"tier2Config\", System.getProperty(\"tier2Config\")\n+        systemProperty \"pravegaOperatorVersion\",System.getProperty(\"pravegaOperatorVersion\", \"latest\")\n+        systemProperty \"bookkeeperOperatorVersion\",System.getProperty(\"bookkeeperOperatorVersion\", \"latest\")\n+        systemProperty \"zookeeperOperatorVersion\",System.getProperty(\"zookeeperOperatorVersion\", \"latest\")\n+        systemProperty \"desiredPravegaCMVersion\",System.getProperty(\"desiredPravegaCMVersion\", \"0.9.0\")", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a823627a9d6b1073349af5cc97aa6a972227acc8"}, "originalPosition": 84}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NDA4OTkwMQ==", "bodyText": "please remove the redundant change.", "url": "https://github.com/pravega/pravega/pull/5050#discussion_r494089901", "createdAt": "2020-09-24T07:16:32Z", "author": {"login": "shrids"}, "path": "gradle/wrapper/gradle-wrapper.properties", "diffHunk": "@@ -1,3 +1,4 @@\n+#Wed Jul 15 17:15:38 IST 2020", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a823627a9d6b1073349af5cc97aa6a972227acc8"}, "originalPosition": 1}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NDA5MTUwOA==", "bodyText": "this seems like formatting only change and below. Could you undo this?", "url": "https://github.com/pravega/pravega/pull/5050#discussion_r494091508", "createdAt": "2020-09-24T07:19:43Z", "author": {"login": "shrids"}, "path": "test/system/src/main/java/io/pravega/test/system/framework/kubernetes/K8sClient.java", "diffHunk": "@@ -664,25 +664,25 @@ public void deletePVC(String namespace, String name) {\n         AtomicBoolean shouldRetry = new AtomicBoolean(true);\n \n         return Futures.loop(shouldRetry::get,\n-                            () -> Futures.delayedFuture(Duration.ofSeconds(5), executor) // wait for 5 seconds before checking for status.\n-                                    .thenCompose(v -> getStatusOfPodWithLabel(namespace, labelName, labelValue)) // fetch status of pods with the given label.\n-                                    .thenApply(podStatuses -> podStatuses.stream()\n-                                            // check for pods where all containers are running.\n-                                            .filter(podStatus -> {\n-                                                if (podStatus.getContainerStatuses() == null) {\n-                                                    return false;\n-                                                } else {\n-                                                    return podStatus.getContainerStatuses()\n-                                                            .stream()\n-                                                            .allMatch(st -> st.getState().getRunning() != null);\n-                                                }\n-                                            }).count()),\n-                            runCount -> { // Number of pods which are running\n-                                log.debug(\"Expected running pod count : {}, actual running pod count :{}.\", expectedPodCount, runCount);\n-                                if (runCount == expectedPodCount) {\n-                                    shouldRetry.set(false);\n-                                }\n-                            }, executor);\n+                () -> Futures.delayedFuture(Duration.ofSeconds(5), executor) // wait for 5 seconds before checking for status.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a823627a9d6b1073349af5cc97aa6a972227acc8"}, "originalPosition": 146}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "0f7ddab201252623592833f2c6436bb475933c9a", "author": {"user": {"login": "Richa-Srivastava", "name": null}}, "url": "https://github.com/pravega/pravega/commit/0f7ddab201252623592833f2c6436bb475933c9a", "committedDate": "2020-09-24T08:41:34Z", "message": "Applying review comment\n\nSigned-off-by: Richa-Srivastava <richa.srivastava@dell.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "48ea194cd6d3379de28660f25347493f35871a44", "author": {"user": {"login": "Richa-Srivastava", "name": null}}, "url": "https://github.com/pravega/pravega/commit/48ea194cd6d3379de28660f25347493f35871a44", "committedDate": "2020-09-24T08:42:09Z", "message": "Applying review comment\n\nSigned-off-by: Richa-Srivastava <richa.srivastava@dell.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "cd178bcccdc1bad1ce850e7f190274da4375ff74", "author": {"user": {"login": "Richa-Srivastava", "name": null}}, "url": "https://github.com/pravega/pravega/commit/cd178bcccdc1bad1ce850e7f190274da4375ff74", "committedDate": "2020-09-24T08:59:01Z", "message": "Applying review comment\n\nSigned-off-by: Richa-Srivastava <richa.srivastava@dell.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "2ed3445eee32d5eb654065ec894fc102faebdf5c", "author": {"user": {"login": "Richa-Srivastava", "name": null}}, "url": "https://github.com/pravega/pravega/commit/2ed3445eee32d5eb654065ec894fc102faebdf5c", "committedDate": "2020-09-24T09:38:50Z", "message": "Applying review comment\n\nSigned-off-by: Richa-Srivastava <richa.srivastava@dell.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f3fefb0e17fa88ab55f87672311deac3e3eb55ed", "author": {"user": {"login": "Richa-Srivastava", "name": null}}, "url": "https://github.com/pravega/pravega/commit/f3fefb0e17fa88ab55f87672311deac3e3eb55ed", "committedDate": "2020-09-24T09:40:01Z", "message": "Applying review comment\n\nSigned-off-by: Richa-Srivastava <richa.srivastava@dell.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a47cfb591322dad597be710c7ee5a44e5515ffbd", "author": {"user": {"login": "Richa-Srivastava", "name": null}}, "url": "https://github.com/pravega/pravega/commit/a47cfb591322dad597be710c7ee5a44e5515ffbd", "committedDate": "2020-09-24T09:43:53Z", "message": "Applying review comment\n\nSigned-off-by: Richa-Srivastava <richa.srivastava@dell.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "26f10c3819c1b7e02e24c4f2c1f7ebb0b7b8345d", "author": {"user": {"login": "Richa-Srivastava", "name": null}}, "url": "https://github.com/pravega/pravega/commit/26f10c3819c1b7e02e24c4f2c1f7ebb0b7b8345d", "committedDate": "2020-09-24T09:53:55Z", "message": "Applying review comment\n\nSigned-off-by: Richa-Srivastava <richa.srivastava@dell.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e242e71662ddfb94044c26925b9fe7a605c3448a", "author": {"user": {"login": "Richa-Srivastava", "name": null}}, "url": "https://github.com/pravega/pravega/commit/e242e71662ddfb94044c26925b9fe7a605c3448a", "committedDate": "2020-09-24T10:02:22Z", "message": "Applying review comment\n\nSigned-off-by: Richa-Srivastava <richa.srivastava@dell.com>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDk1NzE5NzY0", "url": "https://github.com/pravega/pravega/pull/5050#pullrequestreview-495719764", "createdAt": "2020-09-24T15:55:09Z", "commit": {"oid": "e242e71662ddfb94044c26925b9fe7a605c3448a"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDk1NzYxMjI4", "url": "https://github.com/pravega/pravega/pull/5050#pullrequestreview-495761228", "createdAt": "2020-09-24T16:44:01Z", "commit": {"oid": "e242e71662ddfb94044c26925b9fe7a605c3448a"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDk2MTA2Mjkw", "url": "https://github.com/pravega/pravega/pull/5050#pullrequestreview-496106290", "createdAt": "2020-09-25T04:42:22Z", "commit": {"oid": "e242e71662ddfb94044c26925b9fe7a605c3448a"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "6b457bdbe6af0dea7b3df001a1f49d208b85d6aa", "author": {"user": {"login": "Richa-Srivastava", "name": null}}, "url": "https://github.com/pravega/pravega/commit/6b457bdbe6af0dea7b3df001a1f49d208b85d6aa", "committedDate": "2020-09-25T06:00:14Z", "message": "Merge branch 'master' into stf-changes"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "8202942892071bda3c222e20b63a0794885b00cb", "author": {"user": {"login": "Richa-Srivastava", "name": null}}, "url": "https://github.com/pravega/pravega/commit/8202942892071bda3c222e20b63a0794885b00cb", "committedDate": "2020-09-25T06:22:21Z", "message": "modified build.gradle\n\nSigned-off-by: Richa-Srivastava <richa.srivastava@dell.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "4deada4c67552a1231b98a862beefa36f0a0f0ee", "author": {"user": {"login": "Richa-Srivastava", "name": null}}, "url": "https://github.com/pravega/pravega/commit/4deada4c67552a1231b98a862beefa36f0a0f0ee", "committedDate": "2020-09-25T06:41:59Z", "message": "formatting changes\n\nSigned-off-by: Richa-Srivastava <richa.srivastava@dell.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "009002c32610c0db59e535718a0a545967328697", "author": {"user": {"login": "Richa-Srivastava", "name": null}}, "url": "https://github.com/pravega/pravega/commit/009002c32610c0db59e535718a0a545967328697", "committedDate": "2020-09-25T06:46:46Z", "message": "formatting changes\n\nSigned-off-by: Richa-Srivastava <richa.srivastava@dell.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "35170c6ab8678ec285ca55f03dc086a7c23a58f9", "author": {"user": {"login": "Richa-Srivastava", "name": null}}, "url": "https://github.com/pravega/pravega/commit/35170c6ab8678ec285ca55f03dc086a7c23a58f9", "committedDate": "2020-09-25T06:51:08Z", "message": "formatting changes\n\nSigned-off-by: root <richa.srivastava@dell.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "67b2bdbe027e46c8d8bac9418f78d9c95eb017d5", "author": {"user": {"login": "Richa-Srivastava", "name": null}}, "url": "https://github.com/pravega/pravega/commit/67b2bdbe027e46c8d8bac9418f78d9c95eb017d5", "committedDate": "2020-09-25T07:02:10Z", "message": "formatting changes\n\nSigned-off-by: root <richa.srivastava@dell.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ca4c2d836676c6d4d1cc206106b21ce1e1771e22", "author": {"user": {"login": "Richa-Srivastava", "name": null}}, "url": "https://github.com/pravega/pravega/commit/ca4c2d836676c6d4d1cc206106b21ce1e1771e22", "committedDate": "2020-09-25T10:28:52Z", "message": "removed style check error\n\nSigned-off-by: root <richa.srivastava@dell.com>"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4022, "cost": 1, "resetAt": "2021-11-01T16:37:27Z"}}}