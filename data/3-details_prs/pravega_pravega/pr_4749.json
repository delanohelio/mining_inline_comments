{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDEwMTk0NDc1", "number": 4749, "title": "Issue 4737: Controller's Stream Workflows can throw StartException if the input is not found, leading to wasteful compute cycles ", "bodyText": "Signed-off-by: Shivesh Ranjan shivesh.ranjan@gmail.com\nChange log description\nRemove StartException as it is unnecessary as we always update metadata and then write the event.\nSo not finding metadata should not throw StartException which leads to wasted compute retries.\nPurpose of the change\nFixes #4737\nWhat the code does\nController event processing tasks throw StartException if they do not find the corresponding input for the task in metadata table. This leads to workflows being retried for sometime before failing.\nThis is unnecessary because we always write metadata and then post the event. So if event is picked for processing and metadata does not match the expected state, it is because the processing is already complete. So we do not need to unnecessarily retry in such situations.\nChanges:\n\nRemoved StartException class. Removed Postpone logic based on StartException from stream request handler.\nRemoved its usage in UpdateStreamTask: if StreamConfigurationRecord.isUpdating = false, complete the task treating it as idempotent case\nRemoved its usage in TruncateStreamTask: if StreamTrunctionRecord.isUpdating = false, complete the task treating it as idempotent case\nRemoved its usage in ScaleOperationTask: if Epoch Transition is empty for manual scale, scale is already complete and this is idempotent case\nRemoved its usage in SealStreamTask: if stream.state != SEALING/SEALED, throw illegal state exception.\n\nHow to verify it\nUnit tests updated", "createdAt": "2020-04-28T15:30:37Z", "url": "https://github.com/pravega/pravega/pull/4749", "merged": true, "mergeCommit": {"oid": "d84a68cc5bcdd4edc03f0d165d01f8b5d79b77d2"}, "closed": true, "closedAt": "2020-05-04T12:56:50Z", "author": {"login": "shiveshr"}, "timelineItems": {"totalCount": 6, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABccFb2BAH2gAyNDEwMTk0NDc1OjNiODRhZTNkZWNjOTU0MzJkOWMzZWMwNTgwMzQwOWU0MTZkYTVjODc=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcd-_UvAFqTQwNDkxNDA3OQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "3b84ae3decc95432d9c3ec05803409e416da5c87", "author": {"user": {"login": "shiveshr", "name": "shivesh ranjan"}}, "url": "https://github.com/pravega/pravega/commit/3b84ae3decc95432d9c3ec05803409e416da5c87", "committedDate": "2020-04-28T15:15:54Z", "message": "Issue 4737\n\nSigned-off-by: Shivesh Ranjan <shivesh.ranjan@gmail.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "3cf5018dc1b57c5917bb58577f4d563d06868ef1", "author": {"user": {"login": "shiveshr", "name": "shivesh ranjan"}}, "url": "https://github.com/pravega/pravega/commit/3cf5018dc1b57c5917bb58577f4d563d06868ef1", "committedDate": "2020-04-28T15:30:50Z", "message": "unit test for seal stream\n\nSigned-off-by: Shivesh Ranjan <shivesh.ranjan@gmail.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "5dc4c983f2162ad03643d96fc299f955f80b944a", "author": {"user": {"login": "RaulGracia", "name": "Ra\u00fal Gracia"}}, "url": "https://github.com/pravega/pravega/commit/5dc4c983f2162ad03643d96fc299f955f80b944a", "committedDate": "2020-04-28T16:24:41Z", "message": "Merge branch 'master' into issue4737"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "543d9fac80875a2bd69c1afda2136f1b2d9c626d", "author": {"user": {"login": "RaulGracia", "name": "Ra\u00fal Gracia"}}, "url": "https://github.com/pravega/pravega/commit/543d9fac80875a2bd69c1afda2136f1b2d9c626d", "committedDate": "2020-04-29T08:12:15Z", "message": "Merge branch 'master' into issue4737"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c85838c46e0af83941bd9f64aed67dc52d38f69f", "author": {"user": {"login": "shrids", "name": "Sandeep"}}, "url": "https://github.com/pravega/pravega/commit/c85838c46e0af83941bd9f64aed67dc52d38f69f", "committedDate": "2020-05-04T11:38:44Z", "message": "Merge branch 'master' into issue4737"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDA0OTE0MDc5", "url": "https://github.com/pravega/pravega/pull/4749#pullrequestreview-404914079", "createdAt": "2020-05-04T11:47:55Z", "commit": {"oid": "c85838c46e0af83941bd9f64aed67dc52d38f69f"}, "state": "APPROVED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wNFQxMTo0Nzo1NVrOGP81ig==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wNFQxMTo0Nzo1NVrOGP81ig==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxOTM3ODU3MA==", "bodyText": "would logging help prevent coding errors in the future ?", "url": "https://github.com/pravega/pravega/pull/4749#discussion_r419378570", "createdAt": "2020-05-04T11:47:55Z", "author": {"login": "shrids"}, "path": "controller/src/main/java/io/pravega/controller/server/eventProcessor/requesthandlers/SealStreamTask.java", "diffHunk": "@@ -67,7 +67,7 @@ public SealStreamTask(final StreamMetadataTasks streamMetadataTasks,\n         return streamMetadataStore.getState(scope, stream, true, context, executor)\n                 .thenAccept(state -> {\n                     if (!state.equals(State.SEALING) && !state.equals(State.SEALED)) {\n-                        throw new TaskExceptions.StartException(\"Seal stream task not started yet.\");\n+                        throw new IllegalStateException(\"Seal stream not started.\");", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c85838c46e0af83941bd9f64aed67dc52d38f69f"}, "originalPosition": 5}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3444, "cost": 1, "resetAt": "2021-11-01T16:37:27Z"}}}