{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTQyMzg4NjYw", "number": 5441, "title": "Issue 5442: Ensure the test case that is running is logged.", "bodyText": "Change log description\nEnsure the test case that is running is logged. And log the last 300 lines of the test that failed.\nPurpose of the change\nFixes #5442\nWhat the code does\nNo changes to functionality. The test running is logged.\nIn case of a failure of the test, the last 300 lines of the test output is logged to facilitate faster triaging.\ne.g:\n> Task :test:integration:test\n\nRunning test: io.pravega.test.integration.StreamSeekTest > testStreamSeek\n\nIn case of a failure, the output will have the pattern\nRunning test: io.pravega.test.integration.StreamSeekTest > testStreamSeek\n\nRunning test: io.pravega.test.integration.StreamMetricsTest > testStreamsAndScopesBasicMetricsTests \n\nOutput of io.pravega.test.integration.StreamMetricsTest.testStreamsAndScopesBasicMetricsTests (Last 300 lines):\n > 2021-01-06 10:22:03,797 132540 [core-25] INFO  i.p.s.s.writer.SegmentAggregator - StorageWriter[0-286]: State changed from Writing to Closed.\n > 2021-01-06 10:22:03,797 132540 [core-25] INFO  i.p.s.s.writer.SegmentAggregator - StorageWriter[0-671]: State changed from Writing to Closed.\n > 2021-01-06 10:22:03,797 132540 [core-25] WARN  i.p.shared.metrics.MetricProxy - This MetricProxy (pravega.segmentstore.cache.delete_bytes) has already been closed. Further updates to this Metric will not be seen by a MeterRegistry.\n(===snipped === )\nio.pravega.test.integration.StreamMetricsTest > testStreamsAndScopesBasicMetricsTests FAILED\n    java.lang.AssertionError: expected:<1> but was:<0>\n        at org.junit.Assert.fail(Assert.java:88)\n        at org.junit.Assert.failNotEquals(Assert.java:834)\n        at org.junit.Assert.assertEquals(Assert.java:645)\n        at org.junit.Assert.assertEquals(Assert.java:631)\n        at io.pravega.test.integration.StreamMetricsTest.testStreamsAndScopesBasicMetricsTests(StreamMetricsTest.java:203)\n\nRunning test: io.pravega.test.integration.StreamMetricsTest > testSegmentSplitMerge\n\nio.pravega.test.integration.StreamMetricsTest > testSegmentSplitMerge PASSED\n\n\nHow to verify it\nAll the existing tests should continue to pass.", "createdAt": "2020-12-18T08:19:30Z", "url": "https://github.com/pravega/pravega/pull/5441", "merged": true, "mergeCommit": {"oid": "6add9aa65dcb96337f5cb0c578f92f1d5eec2318"}, "closed": true, "closedAt": "2021-01-25T01:51:38Z", "author": {"login": "shrids"}, "timelineItems": {"totalCount": 19, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdnTt-tAH2gAyNTQyMzg4NjYwOjY3OWM5ZDNkZjAyNDdlNzRiYWQ2OWIzNjRjNDgwOTJkMjFhMWM2NWU=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdzc83oAFqTU3NTAyMjY5Nw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "679c9d3df0247e74bad69b364c48092d21a1c65e", "author": {"user": {"login": "shrids", "name": "Sandeep"}}, "url": "https://github.com/pravega/pravega/commit/679c9d3df0247e74bad69b364c48092d21a1c65e", "committedDate": "2020-12-18T08:18:42Z", "message": "Ensure the test case that is running is logged.\n\nSigned-off-by: Sandeep <sandeep.shridhar@emc.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "9efbe1e1fcd8d074ceafda91ff67f918c245cb60", "author": {"user": {"login": "shrids", "name": "Sandeep"}}, "url": "https://github.com/pravega/pravega/commit/9efbe1e1fcd8d074ceafda91ff67f918c245cb60", "committedDate": "2020-12-18T11:36:45Z", "message": "Ensure the last 300 lines of logs for the failed test printed on the console.\n\nSigned-off-by: Sandeep <sandeep.shridhar@emc.com>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTU1NDI5MzEz", "url": "https://github.com/pravega/pravega/pull/5441#pullrequestreview-555429313", "createdAt": "2020-12-18T12:00:19Z", "commit": {"oid": "9efbe1e1fcd8d074ceafda91ff67f918c245cb60"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTU2MTE3OTQ1", "url": "https://github.com/pravega/pravega/pull/5441#pullrequestreview-556117945", "createdAt": "2020-12-21T04:04:17Z", "commit": {"oid": "9efbe1e1fcd8d074ceafda91ff67f918c245cb60"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0yMVQwNDowNDoxOFrOIJLn6g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0yMVQwNDoxMDozMVrOIJLsdg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NjQ5ODUzOA==", "bodyText": "Shouldn't this be using the logger too?", "url": "https://github.com/pravega/pravega/pull/5441#discussion_r546498538", "createdAt": "2020-12-21T04:04:18Z", "author": {"login": "ravisharda"}, "path": "gradle/java.gradle", "diffHunk": "@@ -96,6 +96,25 @@ plugins.withId('java') {\n         def jvmArgsCopy = jvmArgs\n         jvmArgsCopy.add(\"-XX:MaxDirectMemorySize=4g\")\n         jvmArgs = jvmArgsCopy\n+        def outputCache = new LinkedList<String>()\n+\n+        beforeTest { descriptor ->\n+            logger.lifecycle(\"\\nRunning test: \" + descriptor.getClassName() + \" > \" + descriptor.getDisplayName());\n+            outputCache.clear()\n+        }\n+\n+        onOutput { descriptor, event ->\n+            outputCache.add(event.getMessage())\n+            while (outputCache.size() > 300) outputCache.remove()\n+        }\n+\n+        afterTest { descriptor, result ->\n+            if (result.resultType == TestResult.ResultType.FAILURE && outputCache.size() > 0) {\n+                println()\n+                println(\" Output of ${descriptor.getClassName()}.${descriptor.getDisplayName()}:\")", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "9efbe1e1fcd8d074ceafda91ff67f918c245cb60"}, "originalPosition": 19}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NjQ5OTcwMg==", "bodyText": "Also, my understanding is that the following lines will already ensure that any exceptions for failed tests are logged. Curious, do we still need these explicit statements here?\n\n  \n    \n      pravega/gradle/java.gradle\n    \n    \n        Lines 89 to 92\n      in\n      9efbe1e\n    \n    \n    \n    \n\n        \n          \n           testLogging.showCauses = true \n        \n\n        \n          \n           testLogging.showExceptions = true \n        \n\n        \n          \n           testLogging.showStackTraces = true \n        \n\n        \n          \n           testLogging.events = [\"PASSED\", \"FAILED\"]", "url": "https://github.com/pravega/pravega/pull/5441#discussion_r546499702", "createdAt": "2020-12-21T04:10:31Z", "author": {"login": "ravisharda"}, "path": "gradle/java.gradle", "diffHunk": "@@ -96,6 +96,25 @@ plugins.withId('java') {\n         def jvmArgsCopy = jvmArgs\n         jvmArgsCopy.add(\"-XX:MaxDirectMemorySize=4g\")\n         jvmArgs = jvmArgsCopy\n+        def outputCache = new LinkedList<String>()\n+\n+        beforeTest { descriptor ->\n+            logger.lifecycle(\"\\nRunning test: \" + descriptor.getClassName() + \" > \" + descriptor.getDisplayName());\n+            outputCache.clear()\n+        }\n+\n+        onOutput { descriptor, event ->\n+            outputCache.add(event.getMessage())\n+            while (outputCache.size() > 300) outputCache.remove()\n+        }\n+\n+        afterTest { descriptor, result ->\n+            if (result.resultType == TestResult.ResultType.FAILURE && outputCache.size() > 0) {\n+                println()\n+                println(\" Output of ${descriptor.getClassName()}.${descriptor.getDisplayName()}:\")", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NjQ5ODUzOA=="}, "originalCommit": {"oid": "9efbe1e1fcd8d074ceafda91ff67f918c245cb60"}, "originalPosition": 19}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a20667a6582e5e5c982f29d6d3f2277f7a76bff8", "author": {"user": {"login": "ravisharda", "name": "Ravi Sharda"}}, "url": "https://github.com/pravega/pravega/commit/a20667a6582e5e5c982f29d6d3f2277f7a76bff8", "committedDate": "2020-12-21T04:11:01Z", "message": "Merge branch 'master' into debug-flakytest"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "2774f10fba05a0e51fd792e1c855d4bc25ba05c0", "author": {"user": {"login": "shrids", "name": "Sandeep"}}, "url": "https://github.com/pravega/pravega/commit/2774f10fba05a0e51fd792e1c855d4bc25ba05c0", "committedDate": "2021-01-04T06:44:29Z", "message": "Merge branch 'master' into debug-flakytest"}, "afterCommit": {"oid": "2815dc33946b7cfbcee2310fb13a54a3c74d3af9", "author": {"user": {"login": "shrids", "name": "Sandeep"}}, "url": "https://github.com/pravega/pravega/commit/2815dc33946b7cfbcee2310fb13a54a3c74d3af9", "committedDate": "2021-01-04T06:51:17Z", "message": "Merge branch 'master' into debug-flakytest\n\nSigned-off-by: Sandeep <sandeep.shridhar@emc.com>"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "2815dc33946b7cfbcee2310fb13a54a3c74d3af9", "author": {"user": {"login": "shrids", "name": "Sandeep"}}, "url": "https://github.com/pravega/pravega/commit/2815dc33946b7cfbcee2310fb13a54a3c74d3af9", "committedDate": "2021-01-04T06:51:17Z", "message": "Merge branch 'master' into debug-flakytest\n\nSigned-off-by: Sandeep <sandeep.shridhar@emc.com>"}, "afterCommit": {"oid": "3990f19bed14b133f4cdfe18b8e42f32deed78e8", "author": {"user": {"login": "pbelgundi", "name": "Prajakta Belgundi"}}, "url": "https://github.com/pravega/pravega/commit/3990f19bed14b133f4cdfe18b8e42f32deed78e8", "committedDate": "2021-01-04T06:44:02Z", "message": "Issue 5384: Add Controller APIs to Create, Update and Delete Reader Groups (#5400)\n\n* Adds apis to manage readergroup's lifecycle on controller with CRUD apis on readergroup and generation management of readergroup config. \r\n\r\nSigned-off-by: pbelgundi <prajakta.belgundi@emc.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "3d3007c1e80d22c552d796c762aa6137bb8a1d0b", "author": {"user": {"login": "shrids", "name": "Sandeep"}}, "url": "https://github.com/pravega/pravega/commit/3d3007c1e80d22c552d796c762aa6137bb8a1d0b", "committedDate": "2021-01-04T06:57:00Z", "message": "Merge branch 'master' into debug-flakytest"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "3990f19bed14b133f4cdfe18b8e42f32deed78e8", "author": {"user": {"login": "pbelgundi", "name": "Prajakta Belgundi"}}, "url": "https://github.com/pravega/pravega/commit/3990f19bed14b133f4cdfe18b8e42f32deed78e8", "committedDate": "2021-01-04T06:44:02Z", "message": "Issue 5384: Add Controller APIs to Create, Update and Delete Reader Groups (#5400)\n\n* Adds apis to manage readergroup's lifecycle on controller with CRUD apis on readergroup and generation management of readergroup config. \r\n\r\nSigned-off-by: pbelgundi <prajakta.belgundi@emc.com>"}, "afterCommit": {"oid": "3d3007c1e80d22c552d796c762aa6137bb8a1d0b", "author": {"user": {"login": "shrids", "name": "Sandeep"}}, "url": "https://github.com/pravega/pravega/commit/3d3007c1e80d22c552d796c762aa6137bb8a1d0b", "committedDate": "2021-01-04T06:57:00Z", "message": "Merge branch 'master' into debug-flakytest"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "31c66b32dd18f5bad01e6a1d67aeae208294da21", "author": {"user": {"login": "shrids", "name": "Sandeep"}}, "url": "https://github.com/pravega/pravega/commit/31c66b32dd18f5bad01e6a1d67aeae208294da21", "committedDate": "2021-01-06T03:55:48Z", "message": "Merge branch 'master' into debug-flakytest"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "151c85b988e0d6208f218def8aaaaeaf782879a4", "author": {"user": {"login": "shrids", "name": "Sandeep"}}, "url": "https://github.com/pravega/pravega/commit/151c85b988e0d6208f218def8aaaaeaf782879a4", "committedDate": "2021-01-06T04:56:02Z", "message": "Review changes: Improve output.\n\nSigned-off-by: Sandeep <sandeep.shridhar@emc.com>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTYyMzI2Njc2", "url": "https://github.com/pravega/pravega/pull/5441#pullrequestreview-562326676", "createdAt": "2021-01-06T05:02:20Z", "commit": {"oid": "151c85b988e0d6208f218def8aaaaeaf782879a4"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTYzMDUxMDc2", "url": "https://github.com/pravega/pravega/pull/5441#pullrequestreview-563051076", "createdAt": "2021-01-06T21:34:42Z", "commit": {"oid": "151c85b988e0d6208f218def8aaaaeaf782879a4"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b64e4a4256114cb3f76038a5c0634423acee329a", "author": {"user": {"login": "shrids", "name": "Sandeep"}}, "url": "https://github.com/pravega/pravega/commit/b64e4a4256114cb3f76038a5c0634423acee329a", "committedDate": "2021-01-07T04:17:16Z", "message": "CR Changes: Remove PASSED output.\n\nSigned-off-by: Sandeep <sandeep.shridhar@emc.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "1c3a21301b58077bb5be8b95b843006699ad0bda", "author": {"user": {"login": "shrids", "name": "Sandeep"}}, "url": "https://github.com/pravega/pravega/commit/1c3a21301b58077bb5be8b95b843006699ad0bda", "committedDate": "2021-01-15T04:54:17Z", "message": "Merge branch 'master' into debug-flakytest"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "3c7843fb0da9d21b0b95bbfece2e64b2e5b3882f", "author": {"user": {"login": "shrids", "name": "Sandeep"}}, "url": "https://github.com/pravega/pravega/commit/3c7843fb0da9d21b0b95bbfece2e64b2e5b3882f", "committedDate": "2021-01-19T06:41:29Z", "message": "Merge branch 'master' into debug-flakytest"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "64a2c3fddee83d3fe01ecdb289b0c234d0a5505e", "author": {"user": {"login": "shrids", "name": "Sandeep"}}, "url": "https://github.com/pravega/pravega/commit/64a2c3fddee83d3fe01ecdb289b0c234d0a5505e", "committedDate": "2021-01-22T08:20:39Z", "message": "Merge branch 'master' into debug-flakytest"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "45ad391ac24ddc220987d410609a666970614895", "author": {"user": {"login": "andreipaduroiu", "name": "Andrei Paduroiu"}}, "url": "https://github.com/pravega/pravega/commit/45ad391ac24ddc220987d410609a666970614895", "committedDate": "2021-01-25T00:15:03Z", "message": "Merge branch 'master' into debug-flakytest"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTc1MDIyNjk3", "url": "https://github.com/pravega/pravega/pull/5441#pullrequestreview-575022697", "createdAt": "2021-01-25T01:51:12Z", "commit": {"oid": "45ad391ac24ddc220987d410609a666970614895"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3813, "cost": 1, "resetAt": "2021-11-01T16:37:27Z"}}}