{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDU4Nzg1OTYx", "number": 4999, "reviewThreads": {"totalCount": 37, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0zMFQwNToxNzowNlrOEThgfQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wNC0wOFQxNzo0NDoxNFrOFv4vaw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjg4OTA3Mzg5OnYy", "diffSide": "RIGHT", "path": "bindings/src/test/java/io/pravega/storage/hdfs/HDFSStorageTest.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0zMFQwNToxNzowNlrOG5Tc2Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0wM1QyMjo1NjowNFrOG7LR4w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2Mjc0MDY5Nw==", "bodyText": "Why aren't we using junit TemporaryFolder rule?", "url": "https://github.com/pravega/pravega/pull/4999#discussion_r462740697", "createdAt": "2020-07-30T05:17:06Z", "author": {"login": "eolivelli"}, "path": "bindings/src/test/java/io/pravega/storage/hdfs/HDFSStorageTest.java", "diffHunk": "@@ -64,7 +65,7 @@\n \n     @Before\n     public void setUp() throws Exception {\n-        this.baseDir = Files.createTempDirectory(\"test_hdfs\").toFile().getAbsoluteFile();\n+        this.baseDir = Files.createTempDirectory(\"test_hdfs_\" + UUID.randomUUID().toString()).toFile().getAbsoluteFile();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "8bf1a5e5742effe816c17d73b365311bf7ac181a"}, "originalPosition": 13}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NDcwMzk3MQ==", "bodyText": "Done", "url": "https://github.com/pravega/pravega/pull/4999#discussion_r464703971", "createdAt": "2020-08-03T22:56:04Z", "author": {"login": "tkaitchuck"}, "path": "bindings/src/test/java/io/pravega/storage/hdfs/HDFSStorageTest.java", "diffHunk": "@@ -64,7 +65,7 @@\n \n     @Before\n     public void setUp() throws Exception {\n-        this.baseDir = Files.createTempDirectory(\"test_hdfs\").toFile().getAbsoluteFile();\n+        this.baseDir = Files.createTempDirectory(\"test_hdfs_\" + UUID.randomUUID().toString()).toFile().getAbsoluteFile();", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2Mjc0MDY5Nw=="}, "originalCommit": {"oid": "8bf1a5e5742effe816c17d73b365311bf7ac181a"}, "originalPosition": 13}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzE0NDA3NDY1OnYy", "diffSide": "RIGHT", "path": "shared/metrics/src/test/java/io/pravega/shared/metrics/MeterRegisterTest.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wOVQwMDozNTo0NlrOHe1c5A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wOVQwMDozNTo0NlrOHe1c5A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMjA5NTA3Ng==", "bodyText": "Meter operations are NOOP'd until there is a SimpleMeterRegistry belonging to the composite.\nCompositeMeterRegistry composite = Metrics.globalRegistry;\nSimpleMeterRegistry simple = new SimpleMeterRegistry();\ncomposite.add(simple);\n\nWould fix the issue.\nhttps://micrometer.io/docs/concepts#_composite_registries", "url": "https://github.com/pravega/pravega/pull/4999#discussion_r502095076", "createdAt": "2020-10-09T00:35:46Z", "author": {"login": "co-jo"}, "path": "shared/metrics/src/test/java/io/pravega/shared/metrics/MeterRegisterTest.java", "diffHunk": "@@ -0,0 +1,67 @@\n+/**\n+ * Copyright (c) Dell Inc., or its subsidiaries. All Rights Reserved.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ */\n+package io.pravega.shared.metrics;\n+\n+import io.micrometer.core.instrument.Metrics;\n+import io.micrometer.core.instrument.Timer;\n+import io.micrometer.core.instrument.composite.CompositeMeterRegistry;\n+import java.time.Duration;\n+import java.util.concurrent.TimeUnit;\n+import org.junit.Assert;\n+import org.junit.Test;\n+\n+public class MeterRegisterTest {\n+\n+    private void initMetrics() {\n+        MetricsConfig metricsConfig = MetricsConfig.builder().with(MetricsConfig.ENABLE_STATSD_REPORTER, false).build();\n+        metricsConfig.setDynamicCacheEvictionDuration(Duration.ofMinutes(5));\n+        MetricsProvider.initialize(metricsConfig);\n+        StatsProvider statsProvider = MetricsProvider.getMetricsProvider();\n+        statsProvider.startWithoutExporting();\n+    }\n+    \n+    @Test\n+    public void testMeterRegister() {\n+        initMetrics();\n+        CompositeMeterRegistry registry = Metrics.globalRegistry;\n+        Timer success = Timer.builder(\"name\").tags().publishPercentiles(OpStatsData.PERCENTILE_ARRAY).register(registry);\n+        success.record(100, TimeUnit.MILLISECONDS);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "cd12d5ec5e8f4a2708ec15dc2d59704a2c13bd78"}, "originalPosition": 35}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzc1Nzk0MzQ1OnYy", "diffSide": "RIGHT", "path": ".github/workflows/gradle.yml", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMy0xNlQwOTo0MjoyN1rOI3cQJg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMy0xNlQxOTowMTo0OFrOI34FGw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU5NTAwNTQ3OA==", "bodyText": "bindings:test is being invoked at line 161 too ...", "url": "https://github.com/pravega/pravega/pull/4999#discussion_r595005478", "createdAt": "2021-03-16T09:42:27Z", "author": {"login": "shrids"}, "path": ".github/workflows/gradle.yml", "diffHunk": "@@ -157,14 +157,39 @@ jobs:\n         run: >\n           ./gradlew\n           segmentstore:server:test\n-          segmentstore:storage:test\n-          segmentstore:storage:impl:test\n+          segmentstore:server:host:test\n           bindings:test\n           --parallel ${{env.GRADLE_OPTS}}\n-      - name: Segment Store Host Tests      # Run this separately since it conflicts with segmentstore:storage:impl:test.\n+      - name: Codecov\n+        uses: codecov/codecov-action@v1.0.15\n+\n+  unit_storeage:\n+    name: Storage Unit Tests\n+    needs: build\n+    runs-on: ubuntu-20.04\n+    steps:\n+      - name: Gradle & Maven Cache\n+        uses: actions/cache@v2.1.0\n+        with:\n+          path: ${{env.GLOBAL_CACHE_PATH}}\n+          key: ${{env.GLOBAL_CACHE_KEY}}\n+          restore-keys: ${{env.GLOBAL_CACHE_RESTORE_KEYS}}\n+      - name: Build Output Cache\n+        uses: actions/cache@v2.1.0\n+        with:\n+          path: ${{env.BUILD_CACHE_PATH}}\n+          key: ${{github.run_id}}\n+      - name: Test Output Cache\n+        uses: actions/cache@v2.1.0\n+        with:\n+          path: ${{env.TEST_OUTPUT_CACHE_PATH}}\n+          key: ${{github.run_id}}-${{github.job}}\n+      - name: Segment Store Unit tests\n         run: >\n           ./gradlew\n-          segmentstore:server:host:test\n+          segmentstore:storage:test\n+          segmentstore:storage:impl:test\n+          bindings:test", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "46e3cb7d7eaa664a2e836d5578cd06b8c8ca32f9"}, "originalPosition": 67}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU5NTQ2MTQwMw==", "bodyText": "Removed", "url": "https://github.com/pravega/pravega/pull/4999#discussion_r595461403", "createdAt": "2021-03-16T19:01:48Z", "author": {"login": "tkaitchuck"}, "path": ".github/workflows/gradle.yml", "diffHunk": "@@ -157,14 +157,39 @@ jobs:\n         run: >\n           ./gradlew\n           segmentstore:server:test\n-          segmentstore:storage:test\n-          segmentstore:storage:impl:test\n+          segmentstore:server:host:test\n           bindings:test\n           --parallel ${{env.GRADLE_OPTS}}\n-      - name: Segment Store Host Tests      # Run this separately since it conflicts with segmentstore:storage:impl:test.\n+      - name: Codecov\n+        uses: codecov/codecov-action@v1.0.15\n+\n+  unit_storeage:\n+    name: Storage Unit Tests\n+    needs: build\n+    runs-on: ubuntu-20.04\n+    steps:\n+      - name: Gradle & Maven Cache\n+        uses: actions/cache@v2.1.0\n+        with:\n+          path: ${{env.GLOBAL_CACHE_PATH}}\n+          key: ${{env.GLOBAL_CACHE_KEY}}\n+          restore-keys: ${{env.GLOBAL_CACHE_RESTORE_KEYS}}\n+      - name: Build Output Cache\n+        uses: actions/cache@v2.1.0\n+        with:\n+          path: ${{env.BUILD_CACHE_PATH}}\n+          key: ${{github.run_id}}\n+      - name: Test Output Cache\n+        uses: actions/cache@v2.1.0\n+        with:\n+          path: ${{env.TEST_OUTPUT_CACHE_PATH}}\n+          key: ${{github.run_id}}-${{github.job}}\n+      - name: Segment Store Unit tests\n         run: >\n           ./gradlew\n-          segmentstore:server:host:test\n+          segmentstore:storage:test\n+          segmentstore:storage:impl:test\n+          bindings:test", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU5NTAwNTQ3OA=="}, "originalCommit": {"oid": "46e3cb7d7eaa664a2e836d5578cd06b8c8ca32f9"}, "originalPosition": 67}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzc1Nzk0NzYwOnYy", "diffSide": "RIGHT", "path": ".github/workflows/gradle.yml", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMy0xNlQwOTo0MzoyNFrOI3cSvQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMy0xNlQxOTowMTozOVrOI34Exg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU5NTAwNjE0MQ==", "bodyText": "nit: typo in storage.", "url": "https://github.com/pravega/pravega/pull/4999#discussion_r595006141", "createdAt": "2021-03-16T09:43:24Z", "author": {"login": "shrids"}, "path": ".github/workflows/gradle.yml", "diffHunk": "@@ -157,14 +157,39 @@ jobs:\n         run: >\n           ./gradlew\n           segmentstore:server:test\n-          segmentstore:storage:test\n-          segmentstore:storage:impl:test\n+          segmentstore:server:host:test\n           bindings:test\n           --parallel ${{env.GRADLE_OPTS}}\n-      - name: Segment Store Host Tests      # Run this separately since it conflicts with segmentstore:storage:impl:test.\n+      - name: Codecov\n+        uses: codecov/codecov-action@v1.0.15\n+\n+  unit_storeage:", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "46e3cb7d7eaa664a2e836d5578cd06b8c8ca32f9"}, "originalPosition": 40}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU5NTQ2MTMxOA==", "bodyText": "Fixed", "url": "https://github.com/pravega/pravega/pull/4999#discussion_r595461318", "createdAt": "2021-03-16T19:01:39Z", "author": {"login": "tkaitchuck"}, "path": ".github/workflows/gradle.yml", "diffHunk": "@@ -157,14 +157,39 @@ jobs:\n         run: >\n           ./gradlew\n           segmentstore:server:test\n-          segmentstore:storage:test\n-          segmentstore:storage:impl:test\n+          segmentstore:server:host:test\n           bindings:test\n           --parallel ${{env.GRADLE_OPTS}}\n-      - name: Segment Store Host Tests      # Run this separately since it conflicts with segmentstore:storage:impl:test.\n+      - name: Codecov\n+        uses: codecov/codecov-action@v1.0.15\n+\n+  unit_storeage:", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU5NTAwNjE0MQ=="}, "originalCommit": {"oid": "46e3cb7d7eaa664a2e836d5578cd06b8c8ca32f9"}, "originalPosition": 40}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzc1ODAxODI1OnYy", "diffSide": "RIGHT", "path": "build.gradle", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMy0xNlQwOTo1NzozM1rOI3c81g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMy0xNlQxOTowMTozMVrOI34EeQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU5NTAxNjkxOA==", "bodyText": "How is this different from the below snippet which is added subprojects for java 8 specific compilation?\ntasks.withType(JavaCompile) {\n        options.compilerArgs.remove(getDefaultJavaVersion())\n        options.compilerArgs.add(clientJavaVersion)\n    }", "url": "https://github.com/pravega/pravega/pull/4999#discussion_r595016918", "createdAt": "2021-03-16T09:57:33Z", "author": {"login": "shrids"}, "path": "build.gradle", "diffHunk": "@@ -88,6 +88,13 @@ allprojects {\n         mavenLocal()\n     }\n \n+    gradle.projectsEvaluated {\n+        tasks.withType(JavaCompile) {\n+            sourceCompatibility = JavaVersion.VERSION_1_8", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "46e3cb7d7eaa664a2e836d5578cd06b8c8ca32f9"}, "originalPosition": 6}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU5NTQ2MTI0MQ==", "bodyText": "Removed", "url": "https://github.com/pravega/pravega/pull/4999#discussion_r595461241", "createdAt": "2021-03-16T19:01:31Z", "author": {"login": "tkaitchuck"}, "path": "build.gradle", "diffHunk": "@@ -88,6 +88,13 @@ allprojects {\n         mavenLocal()\n     }\n \n+    gradle.projectsEvaluated {\n+        tasks.withType(JavaCompile) {\n+            sourceCompatibility = JavaVersion.VERSION_1_8", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU5NTAxNjkxOA=="}, "originalCommit": {"oid": "46e3cb7d7eaa664a2e836d5578cd06b8c8ca32f9"}, "originalPosition": 6}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzc1ODA0Mjc0OnYy", "diffSide": "RIGHT", "path": "client/src/main/java/io/pravega/client/connection/impl/ConnectionPoolImpl.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMy0xNlQxMDowMjo1OFrOI3dMLg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMy0xNlQxOTowMToyNFrOI34ELQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU5NTAyMDg0Ng==", "bodyText": "Did not understand the reason for this change here.", "url": "https://github.com/pravega/pravega/pull/4999#discussion_r595020846", "createdAt": "2021-03-16T10:02:58Z", "author": {"login": "shrids"}, "path": "client/src/main/java/io/pravega/client/connection/impl/ConnectionPoolImpl.java", "diffHunk": "@@ -194,6 +195,7 @@ public void pruneUnusedConnections() {\n     }\n \n     @Override\n+    @Synchronized", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "46e3cb7d7eaa664a2e836d5578cd06b8c8ca32f9"}, "originalPosition": 12}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU5NTQ2MTE2NQ==", "bodyText": "Removed", "url": "https://github.com/pravega/pravega/pull/4999#discussion_r595461165", "createdAt": "2021-03-16T19:01:24Z", "author": {"login": "tkaitchuck"}, "path": "client/src/main/java/io/pravega/client/connection/impl/ConnectionPoolImpl.java", "diffHunk": "@@ -194,6 +195,7 @@ public void pruneUnusedConnections() {\n     }\n \n     @Override\n+    @Synchronized", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU5NTAyMDg0Ng=="}, "originalCommit": {"oid": "46e3cb7d7eaa664a2e836d5578cd06b8c8ca32f9"}, "originalPosition": 12}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzc1ODA1OTY2OnYy", "diffSide": "RIGHT", "path": "controller/src/main/java/io/pravega/controller/server/eventProcessor/LocalController.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMy0xNlQxMDowNjozNVrOI3dWlA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMy0xNlQxMDowNjozNVrOI3dWlA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU5NTAyMzUwOA==", "bodyText": "we could log the stream name here too...", "url": "https://github.com/pravega/pravega/pull/4999#discussion_r595023508", "createdAt": "2021-03-16T10:06:35Z", "author": {"login": "shrids"}, "path": "controller/src/main/java/io/pravega/controller/server/eventProcessor/LocalController.java", "diffHunk": "@@ -159,7 +158,7 @@ public LocalController(ControllerService controller, boolean authorizationEnable\n             case INVALID_STREAM_NAME:\n                 throw new IllegalArgumentException(\"Illegal stream name: \" + streamConfig);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "46e3cb7d7eaa664a2e836d5578cd06b8c8ca32f9"}, "originalPosition": 61}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzc1ODA5NjExOnYy", "diffSide": "RIGHT", "path": "controller/src/main/java/io/pravega/controller/server/rpc/grpc/GRPCServer.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMy0xNlQxMDoxNDo0MlrOI3dtAA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMy0xNlQxMDoxNDo0MlrOI3dtAA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU5NTAyOTI0OA==", "bodyText": "\ud83d\udc4d  This should prevent port already in use on the GRPC server side.", "url": "https://github.com/pravega/pravega/pull/4999#discussion_r595029248", "createdAt": "2021-03-16T10:14:42Z", "author": {"login": "shrids"}, "path": "controller/src/main/java/io/pravega/controller/server/rpc/grpc/GRPCServer.java", "diffHunk": "@@ -50,8 +52,9 @@ public GRPCServer(ControllerService controllerService, GRPCServerConfig serverCo\n         this.config = serverConfig;\n         GrpcAuthHelper authHelper = new GrpcAuthHelper(serverConfig.isAuthorizationEnabled(),\n                 serverConfig.getTokenSigningKey(), serverConfig.getAccessTokenTTLInSeconds());\n-        ServerBuilder<?> builder = ServerBuilder\n+        ServerBuilder<?> builder = NettyServerBuilder\n                 .forPort(serverConfig.getPort())\n+                .withChildOption(ChannelOption.SO_REUSEADDR, true)", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "46e3cb7d7eaa664a2e836d5578cd06b8c8ca32f9"}, "originalPosition": 16}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzc2MTY1ODI2OnYy", "diffSide": "RIGHT", "path": ".github/workflows/gradle.yml", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMy0xNlQyMjo0NDo1MFrOI3__Gg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMy0xNlQyMzo1ODo0MlrOI4BuDg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU5NTU5MDkzOA==", "bodyText": "Is there a reason this is run here (in All Other Unit Tests). This will perform these tests for every project.", "url": "https://github.com/pravega/pravega/pull/4999#discussion_r595590938", "createdAt": "2021-03-16T22:44:50Z", "author": {"login": "andreipaduroiu"}, "path": ".github/workflows/gradle.yml", "diffHunk": "@@ -190,10 +214,15 @@ jobs:\n         with:\n           path: ${{env.TEST_OUTPUT_CACHE_PATH}}\n           key: ${{github.run_id}}-${{github.job}}\n+      - name: Static analysis tests", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "4d632399ae0503f43583529c4eca3fce614f92d3"}, "originalPosition": 74}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU5NTYxOTM0Mg==", "bodyText": "Yes. We want to run spotbugs on all of our code. It's here as opposed the the build step so that it can run in parallel to the unit tests.", "url": "https://github.com/pravega/pravega/pull/4999#discussion_r595619342", "createdAt": "2021-03-16T23:58:42Z", "author": {"login": "tkaitchuck"}, "path": ".github/workflows/gradle.yml", "diffHunk": "@@ -190,10 +214,15 @@ jobs:\n         with:\n           path: ${{env.TEST_OUTPUT_CACHE_PATH}}\n           key: ${{github.run_id}}-${{github.job}}\n+      - name: Static analysis tests", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU5NTU5MDkzOA=="}, "originalCommit": {"oid": "4d632399ae0503f43583529c4eca3fce614f92d3"}, "originalPosition": 74}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzc2MTY2NDc4OnYy", "diffSide": "RIGHT", "path": ".travis.yml", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMy0xNlQyMjo0Njo1NFrOI4ACwA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMy0xN1QwMDowNTo1NFrOI4B3ew==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU5NTU5MTg3Mg==", "bodyText": "We don't use travis anymore. I am pretty sure it's safe to delete this file.", "url": "https://github.com/pravega/pravega/pull/4999#discussion_r595591872", "createdAt": "2021-03-16T22:46:54Z", "author": {"login": "andreipaduroiu"}, "path": ".travis.yml", "diffHunk": "@@ -22,6 +22,7 @@ jobs:\n   include:\n     # Travis CI build has been deprecated in favor of GitHub Actions.\n     - stage: build\n+      name: check", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "4d632399ae0503f43583529c4eca3fce614f92d3"}, "originalPosition": 4}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU5NTYyMTc1NQ==", "bodyText": "Perhaps. We can do that in another PR.", "url": "https://github.com/pravega/pravega/pull/4999#discussion_r595621755", "createdAt": "2021-03-17T00:05:54Z", "author": {"login": "tkaitchuck"}, "path": ".travis.yml", "diffHunk": "@@ -22,6 +22,7 @@ jobs:\n   include:\n     # Travis CI build has been deprecated in favor of GitHub Actions.\n     - stage: build\n+      name: check", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU5NTU5MTg3Mg=="}, "originalCommit": {"oid": "4d632399ae0503f43583529c4eca3fce614f92d3"}, "originalPosition": 4}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzc2MTY4MDM0OnYy", "diffSide": "RIGHT", "path": "gradle/java.gradle", "isResolved": true, "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMy0xNlQyMjo1MjowMlrOI4ALjg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMy0xN1QwOTozMTowN1rOI4Ptww==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU5NTU5NDEyNg==", "bodyText": "Should this be set to the number of available processors? In Github Actions, we only have 2 cores per VM.", "url": "https://github.com/pravega/pravega/pull/4999#discussion_r595594126", "createdAt": "2021-03-16T22:52:02Z", "author": {"login": "andreipaduroiu"}, "path": "gradle/java.gradle", "diffHunk": "@@ -90,11 +90,12 @@ plugins.withId('java') {\n         testLogging.showExceptions = true\n         testLogging.showStackTraces = true\n         testLogging.events = [\"FAILED\"]\n-        maxParallelForks = System.properties['maxParallelForks'] ? System.properties['maxParallelForks'].toInteger() : 1\n+        maxParallelForks = System.properties['maxParallelForks'] ? System.properties['maxParallelForks'].toInteger() : 4", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "4d632399ae0503f43583529c4eca3fce614f92d3"}, "originalPosition": 5}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU5NTYxOTY4Ng==", "bodyText": "Is there a way to obtain the number of cores?", "url": "https://github.com/pravega/pravega/pull/4999#discussion_r595619686", "createdAt": "2021-03-16T23:59:45Z", "author": {"login": "tkaitchuck"}, "path": "gradle/java.gradle", "diffHunk": "@@ -90,11 +90,12 @@ plugins.withId('java') {\n         testLogging.showExceptions = true\n         testLogging.showStackTraces = true\n         testLogging.events = [\"FAILED\"]\n-        maxParallelForks = System.properties['maxParallelForks'] ? System.properties['maxParallelForks'].toInteger() : 1\n+        maxParallelForks = System.properties['maxParallelForks'] ? System.properties['maxParallelForks'].toInteger() : 4", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU5NTU5NDEyNg=="}, "originalCommit": {"oid": "4d632399ae0503f43583529c4eca3fce614f92d3"}, "originalPosition": 5}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU5NTg0ODY0Mw==", "bodyText": "According to this reference:\nhttps://discuss.gradle.org/t/set-maxparallelforks-to-number-of-cores-on-the-current-machine/4505\nwe can use: Runtime.runtime.availableProcessors.", "url": "https://github.com/pravega/pravega/pull/4999#discussion_r595848643", "createdAt": "2021-03-17T09:31:07Z", "author": {"login": "fpj"}, "path": "gradle/java.gradle", "diffHunk": "@@ -90,11 +90,12 @@ plugins.withId('java') {\n         testLogging.showExceptions = true\n         testLogging.showStackTraces = true\n         testLogging.events = [\"FAILED\"]\n-        maxParallelForks = System.properties['maxParallelForks'] ? System.properties['maxParallelForks'].toInteger() : 1\n+        maxParallelForks = System.properties['maxParallelForks'] ? System.properties['maxParallelForks'].toInteger() : 4", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU5NTU5NDEyNg=="}, "originalCommit": {"oid": "4d632399ae0503f43583529c4eca3fce614f92d3"}, "originalPosition": 5}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzc2MTY4MjY3OnYy", "diffSide": "RIGHT", "path": "gradle/wrapper/gradle-wrapper.properties", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMy0xNlQyMjo1Mjo1N1rOI4AM4A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMy0xN1QwMDowNjo0MFrOI4B4cA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU5NTU5NDQ2NA==", "bodyText": "I can't comment on the above binary file, but why did gradle-wrapper.jar change?", "url": "https://github.com/pravega/pravega/pull/4999#discussion_r595594464", "createdAt": "2021-03-16T22:52:57Z", "author": {"login": "andreipaduroiu"}, "path": "gradle/wrapper/gradle-wrapper.properties", "diffHunk": "@@ -1,5 +1,5 @@\n distributionBase=GRADLE_USER_HOME\n distributionPath=wrapper/dists\n+distributionUrl=https\\://services.gradle.org/distributions/gradle-6.5.1-bin.zip", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "4d632399ae0503f43583529c4eca3fce614f92d3"}, "originalPosition": 3}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU5NTYyMjAwMA==", "bodyText": "I upgraded gradle. However since I started this PR gradle was upgraded by someone else. So it now shouldn't make any difference. I will revert.", "url": "https://github.com/pravega/pravega/pull/4999#discussion_r595622000", "createdAt": "2021-03-17T00:06:40Z", "author": {"login": "tkaitchuck"}, "path": "gradle/wrapper/gradle-wrapper.properties", "diffHunk": "@@ -1,5 +1,5 @@\n distributionBase=GRADLE_USER_HOME\n distributionPath=wrapper/dists\n+distributionUrl=https\\://services.gradle.org/distributions/gradle-6.5.1-bin.zip", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU5NTU5NDQ2NA=="}, "originalCommit": {"oid": "4d632399ae0503f43583529c4eca3fce614f92d3"}, "originalPosition": 3}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzc2MTY4MzcxOnYy", "diffSide": "RIGHT", "path": "gradlew", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMy0xNlQyMjo1MzoyNFrOI4ANjA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMy0xNlQyMjo1MzoyNFrOI4ANjA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU5NTU5NDYzNg==", "bodyText": "Are these really necessary?", "url": "https://github.com/pravega/pravega/pull/4999#discussion_r595594636", "createdAt": "2021-03-16T22:53:24Z", "author": {"login": "andreipaduroiu"}, "path": "gradlew", "diffHunk": "@@ -43,11 +43,11 @@ DEFAULT_JVM_OPTS=\"\"\n # Use the maximum available, or set MAX_FD != -1 to use that value.\n MAX_FD=\"maximum\"\n \n-warn ( ) {\n+warn () {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "4d632399ae0503f43583529c4eca3fce614f92d3"}, "originalPosition": 5}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzc2MTY4NzEwOnYy", "diffSide": "LEFT", "path": "segmentstore/server/src/main/java/io/pravega/segmentstore/server/containers/StreamSegmentContainer.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMy0xNlQyMjo1NDo0NVrOI4APqw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMy0xN1QwMDowMzo1N1rOI4B00g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU5NTU5NTE3OQ==", "bodyText": "Was this the source of that cyclical reference we saw every now and then in logs?", "url": "https://github.com/pravega/pravega/pull/4999#discussion_r595595179", "createdAt": "2021-03-16T22:54:45Z", "author": {"login": "andreipaduroiu"}, "path": "segmentstore/server/src/main/java/io/pravega/segmentstore/server/containers/StreamSegmentContainer.java", "diffHunk": "@@ -339,8 +339,6 @@ private void doStop(Throwable cause) {\n                     Throwable failureCause = getFailureCause(this.durableLog, this.writer, this.metadataCleaner);\n                     if (failureCause == null) {\n                         failureCause = cause;\n-                    } else if (cause != null && failureCause != cause) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "4d632399ae0503f43583529c4eca3fce614f92d3"}, "originalPosition": 4}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU5NTYyMTA3NA==", "bodyText": "When I was debugging some of the tests this error path caused a ref cycle which would in a different part of the code caused a OutOfStackSpace error because it sent error message processing into an infinite loop.\nI am not aware of this having been encountered anywhere else.", "url": "https://github.com/pravega/pravega/pull/4999#discussion_r595621074", "createdAt": "2021-03-17T00:03:57Z", "author": {"login": "tkaitchuck"}, "path": "segmentstore/server/src/main/java/io/pravega/segmentstore/server/containers/StreamSegmentContainer.java", "diffHunk": "@@ -339,8 +339,6 @@ private void doStop(Throwable cause) {\n                     Throwable failureCause = getFailureCause(this.durableLog, this.writer, this.metadataCleaner);\n                     if (failureCause == null) {\n                         failureCause = cause;\n-                    } else if (cause != null && failureCause != cause) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU5NTU5NTE3OQ=="}, "originalCommit": {"oid": "4d632399ae0503f43583529c4eca3fce614f92d3"}, "originalPosition": 4}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzc2MTcwMDU1OnYy", "diffSide": "RIGHT", "path": "segmentstore/storage/impl/src/main/java/io/pravega/segmentstore/storage/impl/bookkeeper/Ledgers.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMy0xNlQyMjo1OTowN1rOI4AXRw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMy0xN1QwMDoxODo1MVrOI4CIig==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU5NTU5NzEyNw==", "bodyText": "Let's use config.getWriteTimeout().seconds() for this. At least we'll have a way to configure it in case we need to.", "url": "https://github.com/pravega/pravega/pull/4999#discussion_r595597127", "createdAt": "2021-03-16T22:59:07Z", "author": {"login": "andreipaduroiu"}, "path": "segmentstore/storage/impl/src/main/java/io/pravega/segmentstore/storage/impl/bookkeeper/Ledgers.java", "diffHunk": "@@ -78,20 +83,21 @@\n      */\n     static WriteHandle create(BookKeeper bookKeeper, BookKeeperConfig config, int logId) throws DurableDataLogException {\n         try {\n-\n-            return Exceptions.handleInterruptedCall(() ->\n-                    FutureUtils.result(bookKeeper.newCreateLedgerOp()\n-                            .withEnsembleSize(config.getBkEnsembleSize())\n-                            .withWriteQuorumSize(config.getBkWriteQuorumSize())\n-                            .withAckQuorumSize(config.getBkAckQuorumSize())\n-                            .withDigestType(config.getDigestType())\n-                            .withPassword(config.getBKPassword())\n-                            .withCustomMetadata(createLedgerCustomMetadata(logId))\n-                            .execute(), BK_EXCEPTION_HANDLER) );\n+            CompletableFuture<WriteHandle> future = bookKeeper.newCreateLedgerOp()\n+                .withEnsembleSize(config.getBkEnsembleSize())\n+                .withWriteQuorumSize(config.getBkWriteQuorumSize())\n+                .withAckQuorumSize(config.getBkAckQuorumSize())\n+                .withDigestType(config.getDigestType())\n+                .withPassword(config.getBKPassword())\n+                .withCustomMetadata(createLedgerCustomMetadata(logId))\n+                .execute();\n+            return Futures.getAndHandleExceptions(future, BK_EXCEPTION_HANDLER, 20, TimeUnit.SECONDS);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "4d632399ae0503f43583529c4eca3fce614f92d3"}, "originalPosition": 47}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU5NTYyNjEyMg==", "bodyText": "Done", "url": "https://github.com/pravega/pravega/pull/4999#discussion_r595626122", "createdAt": "2021-03-17T00:18:51Z", "author": {"login": "tkaitchuck"}, "path": "segmentstore/storage/impl/src/main/java/io/pravega/segmentstore/storage/impl/bookkeeper/Ledgers.java", "diffHunk": "@@ -78,20 +83,21 @@\n      */\n     static WriteHandle create(BookKeeper bookKeeper, BookKeeperConfig config, int logId) throws DurableDataLogException {\n         try {\n-\n-            return Exceptions.handleInterruptedCall(() ->\n-                    FutureUtils.result(bookKeeper.newCreateLedgerOp()\n-                            .withEnsembleSize(config.getBkEnsembleSize())\n-                            .withWriteQuorumSize(config.getBkWriteQuorumSize())\n-                            .withAckQuorumSize(config.getBkAckQuorumSize())\n-                            .withDigestType(config.getDigestType())\n-                            .withPassword(config.getBKPassword())\n-                            .withCustomMetadata(createLedgerCustomMetadata(logId))\n-                            .execute(), BK_EXCEPTION_HANDLER) );\n+            CompletableFuture<WriteHandle> future = bookKeeper.newCreateLedgerOp()\n+                .withEnsembleSize(config.getBkEnsembleSize())\n+                .withWriteQuorumSize(config.getBkWriteQuorumSize())\n+                .withAckQuorumSize(config.getBkAckQuorumSize())\n+                .withDigestType(config.getDigestType())\n+                .withPassword(config.getBKPassword())\n+                .withCustomMetadata(createLedgerCustomMetadata(logId))\n+                .execute();\n+            return Futures.getAndHandleExceptions(future, BK_EXCEPTION_HANDLER, 20, TimeUnit.SECONDS);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU5NTU5NzEyNw=="}, "originalCommit": {"oid": "4d632399ae0503f43583529c4eca3fce614f92d3"}, "originalPosition": 47}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzc2MzM5MzA0OnYy", "diffSide": "RIGHT", "path": "segmentstore/server/host/src/test/java/io/pravega/segmentstore/server/host/BookKeeperIntegrationTestBase.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMy0xN1QwOTozMjoxNlrOI4PxAg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMy0xN1QyMToxODowMVrOI4wuMQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU5NTg0OTQ3NA==", "bodyText": "Are we using rack awareness in the tests?", "url": "https://github.com/pravega/pravega/pull/4999#discussion_r595849474", "createdAt": "2021-03-17T09:32:16Z", "author": {"login": "fpj"}, "path": "segmentstore/server/host/src/test/java/io/pravega/segmentstore/server/host/BookKeeperIntegrationTestBase.java", "diffHunk": "@@ -67,6 +68,8 @@ protected ServiceBuilderConfig getBuilderConfig(ServiceBuilderConfig.Builder con\n         String id = Integer.toString(instanceId);\n         return configBuilder\n                 .makeCopy()\n+                .include(BookKeeperConfig.builder().with(BookKeeperConfig.BK_ENFORCE_MIN_NUM_RACKS_PER_WRITE, false)", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "48ef263b64da8e874dffb5608cae69f8f8ecc88a"}, "originalPosition": 12}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU5NjM4OTQyNQ==", "bodyText": "This is forcing it off.", "url": "https://github.com/pravega/pravega/pull/4999#discussion_r596389425", "createdAt": "2021-03-17T21:18:01Z", "author": {"login": "tkaitchuck"}, "path": "segmentstore/server/host/src/test/java/io/pravega/segmentstore/server/host/BookKeeperIntegrationTestBase.java", "diffHunk": "@@ -67,6 +68,8 @@ protected ServiceBuilderConfig getBuilderConfig(ServiceBuilderConfig.Builder con\n         String id = Integer.toString(instanceId);\n         return configBuilder\n                 .makeCopy()\n+                .include(BookKeeperConfig.builder().with(BookKeeperConfig.BK_ENFORCE_MIN_NUM_RACKS_PER_WRITE, false)", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU5NTg0OTQ3NA=="}, "originalCommit": {"oid": "48ef263b64da8e874dffb5608cae69f8f8ecc88a"}, "originalPosition": 12}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzc2MzQwNzQxOnYy", "diffSide": "RIGHT", "path": "segmentstore/server/src/test/java/io/pravega/segmentstore/server/reading/ContainerReadIndexTests.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMy0xN1QwOTozNToyMlrOI4P5uQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMy0xN1QxODo1NjozN1rOI4rTkg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU5NTg1MTcwNQ==", "bodyText": "This is setting a global timeout of two minutes, that's a lot, no?", "url": "https://github.com/pravega/pravega/pull/4999#discussion_r595851705", "createdAt": "2021-03-17T09:35:22Z", "author": {"login": "fpj"}, "path": "segmentstore/server/src/test/java/io/pravega/segmentstore/server/reading/ContainerReadIndexTests.java", "diffHunk": "@@ -95,7 +95,7 @@\n     private static final Duration SHORT_TIMEOUT = Duration.ofMillis(20);\n \n     @Rule\n-    public Timeout globalTimeout = Timeout.seconds(TIMEOUT.getSeconds());\n+    public Timeout globalTimeout = Timeout.seconds(2 * TIMEOUT.getSeconds());", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "48ef263b64da8e874dffb5608cae69f8f8ecc88a"}, "originalPosition": 5}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU5NjMwMDY5MA==", "bodyText": "Yes", "url": "https://github.com/pravega/pravega/pull/4999#discussion_r596300690", "createdAt": "2021-03-17T18:56:37Z", "author": {"login": "tkaitchuck"}, "path": "segmentstore/server/src/test/java/io/pravega/segmentstore/server/reading/ContainerReadIndexTests.java", "diffHunk": "@@ -95,7 +95,7 @@\n     private static final Duration SHORT_TIMEOUT = Duration.ofMillis(20);\n \n     @Rule\n-    public Timeout globalTimeout = Timeout.seconds(TIMEOUT.getSeconds());\n+    public Timeout globalTimeout = Timeout.seconds(2 * TIMEOUT.getSeconds());", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU5NTg1MTcwNQ=="}, "originalCommit": {"oid": "48ef263b64da8e874dffb5608cae69f8f8ecc88a"}, "originalPosition": 5}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzc2MzQzNDQzOnYy", "diffSide": "RIGHT", "path": "segmentstore/server/src/test/java/io/pravega/segmentstore/server/store/StreamSegmentStoreTestBase.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMy0xN1QwOTo0MDo0MVrOI4QJ9A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMy0xN1QxODo1NjoyNlrOI4rTFw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU5NTg1NTg2MA==", "bodyText": "This is also setting to two minutes, is it necessary to make it that long?", "url": "https://github.com/pravega/pravega/pull/4999#discussion_r595855860", "createdAt": "2021-03-17T09:40:41Z", "author": {"login": "fpj"}, "path": "segmentstore/server/src/test/java/io/pravega/segmentstore/server/store/StreamSegmentStoreTestBase.java", "diffHunk": "@@ -262,7 +263,7 @@ public void testSegmentRestoration() throws Exception {\n      *\n      * @throws Exception If an exception occurred.\n      */\n-    @Test\n+    @Test(timeout = 120000)", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "48ef263b64da8e874dffb5608cae69f8f8ecc88a"}, "originalPosition": 13}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU5NjMwMDU2Nw==", "bodyText": "It sometimes failed before.", "url": "https://github.com/pravega/pravega/pull/4999#discussion_r596300567", "createdAt": "2021-03-17T18:56:26Z", "author": {"login": "tkaitchuck"}, "path": "segmentstore/server/src/test/java/io/pravega/segmentstore/server/store/StreamSegmentStoreTestBase.java", "diffHunk": "@@ -262,7 +263,7 @@ public void testSegmentRestoration() throws Exception {\n      *\n      * @throws Exception If an exception occurred.\n      */\n-    @Test\n+    @Test(timeout = 120000)", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU5NTg1NTg2MA=="}, "originalCommit": {"oid": "48ef263b64da8e874dffb5608cae69f8f8ecc88a"}, "originalPosition": 13}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzc2MzQ0MDYzOnYy", "diffSide": "RIGHT", "path": "segmentstore/storage/impl/src/main/java/io/pravega/segmentstore/storage/impl/bookkeeper/BookKeeperServiceRunner.java", "isResolved": true, "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMy0xN1QwOTo0MTo1OVrOI4QNsQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMy0xOFQwODozMzo1NVrOI5AY_w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU5NTg1NjgxNw==", "bodyText": "This change seems unnecessary, what's the reason for this change?", "url": "https://github.com/pravega/pravega/pull/4999#discussion_r595856817", "createdAt": "2021-03-17T09:41:59Z", "author": {"login": "fpj"}, "path": "segmentstore/storage/impl/src/main/java/io/pravega/segmentstore/storage/impl/bookkeeper/BookKeeperServiceRunner.java", "diffHunk": "@@ -52,7 +51,7 @@\n     public static final String TLS_KEY_STORE = \"tlsKeyStore\";\n     public static final String PROPERTY_LEDGERS_DIR = \"ledgersDir\"; // File System path to store ledger data.\n \n-    private static final InetAddress LOOPBACK_ADDRESS = InetAddress.getLoopbackAddress();\n+    private static final String LOOPBACK_ADDRESS = \"127.0.0.1\";", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "48ef263b64da8e874dffb5608cae69f8f8ecc88a"}, "originalPosition": 23}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU5NjE5NDYxNQ==", "bodyText": "InetAddress.getLoopbackAddress() can return the IPv6 address, and appears to do so at random. When it does and the binding is on IPv4, this results in connection failures. I observe this locally but have never seen it on Travis or Github Actions.", "url": "https://github.com/pravega/pravega/pull/4999#discussion_r596194615", "createdAt": "2021-03-17T16:38:16Z", "author": {"login": "tkaitchuck"}, "path": "segmentstore/storage/impl/src/main/java/io/pravega/segmentstore/storage/impl/bookkeeper/BookKeeperServiceRunner.java", "diffHunk": "@@ -52,7 +51,7 @@\n     public static final String TLS_KEY_STORE = \"tlsKeyStore\";\n     public static final String PROPERTY_LEDGERS_DIR = \"ledgersDir\"; // File System path to store ledger data.\n \n-    private static final InetAddress LOOPBACK_ADDRESS = InetAddress.getLoopbackAddress();\n+    private static final String LOOPBACK_ADDRESS = \"127.0.0.1\";", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU5NTg1NjgxNw=="}, "originalCommit": {"oid": "48ef263b64da8e874dffb5608cae69f8f8ecc88a"}, "originalPosition": 23}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU5NjY0NjE0Mw==", "bodyText": "Instead of hardwiring 127.0.0.1, could we instead say use java.net.preferIPv4Stack for tests?", "url": "https://github.com/pravega/pravega/pull/4999#discussion_r596646143", "createdAt": "2021-03-18T08:33:55Z", "author": {"login": "fpj"}, "path": "segmentstore/storage/impl/src/main/java/io/pravega/segmentstore/storage/impl/bookkeeper/BookKeeperServiceRunner.java", "diffHunk": "@@ -52,7 +51,7 @@\n     public static final String TLS_KEY_STORE = \"tlsKeyStore\";\n     public static final String PROPERTY_LEDGERS_DIR = \"ledgersDir\"; // File System path to store ledger data.\n \n-    private static final InetAddress LOOPBACK_ADDRESS = InetAddress.getLoopbackAddress();\n+    private static final String LOOPBACK_ADDRESS = \"127.0.0.1\";", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU5NTg1NjgxNw=="}, "originalCommit": {"oid": "48ef263b64da8e874dffb5608cae69f8f8ecc88a"}, "originalPosition": 23}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzc2MzQ4NzA4OnYy", "diffSide": "RIGHT", "path": "shared/metrics/src/main/java/io/pravega/shared/metrics/MetricProxy.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMy0xN1QwOTo1MToyOVrOI4QqIA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMy0xN1QxNjo0MDowMlrOI4k7KA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU5NTg2NDA5Ng==", "bodyText": "Minor: remove leading white spaces. Shouldn't our checkstyle be complaining about these things?", "url": "https://github.com/pravega/pravega/pull/4999#discussion_r595864096", "createdAt": "2021-03-17T09:51:29Z", "author": {"login": "fpj"}, "path": "shared/metrics/src/main/java/io/pravega/shared/metrics/MetricProxy.java", "diffHunk": "@@ -12,26 +12,23 @@\n import com.google.common.base.Preconditions;\n import io.micrometer.core.instrument.Meter;\n import io.pravega.common.Exceptions;\n-\n import java.util.concurrent.atomic.AtomicBoolean;\n import java.util.concurrent.atomic.AtomicReference;\n import java.util.function.Consumer;\n import lombok.Getter;\n-import lombok.extern.slf4j.Slf4j;\n \n /**\n  * Base class for a Metric Proxy.\n  *\n- * @param <T> Type of Metric.\n+ * @param <MetricT> Type of Metric.\n  */\n-@Slf4j\n-abstract class MetricProxy<T extends Metric> implements AutoCloseable {\n-    private final AtomicReference<T> instance = new AtomicReference<>();\n+abstract class MetricProxy<MetricT extends Metric, SelfT extends MetricProxy<MetricT, SelfT>> implements AutoCloseable {\n+    private final AtomicReference<MetricT> instance = new AtomicReference<>();\n     private final AtomicBoolean closed = new AtomicBoolean();\n-\n+    ", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "48ef263b64da8e874dffb5608cae69f8f8ecc88a"}, "originalPosition": 24}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU5NjE5NjEzNg==", "bodyText": "Checkstyle only considers trailing whitespace a problem on lines with stuff on them. Lines that are all whitespace are permitted.", "url": "https://github.com/pravega/pravega/pull/4999#discussion_r596196136", "createdAt": "2021-03-17T16:40:02Z", "author": {"login": "tkaitchuck"}, "path": "shared/metrics/src/main/java/io/pravega/shared/metrics/MetricProxy.java", "diffHunk": "@@ -12,26 +12,23 @@\n import com.google.common.base.Preconditions;\n import io.micrometer.core.instrument.Meter;\n import io.pravega.common.Exceptions;\n-\n import java.util.concurrent.atomic.AtomicBoolean;\n import java.util.concurrent.atomic.AtomicReference;\n import java.util.function.Consumer;\n import lombok.Getter;\n-import lombok.extern.slf4j.Slf4j;\n \n /**\n  * Base class for a Metric Proxy.\n  *\n- * @param <T> Type of Metric.\n+ * @param <MetricT> Type of Metric.\n  */\n-@Slf4j\n-abstract class MetricProxy<T extends Metric> implements AutoCloseable {\n-    private final AtomicReference<T> instance = new AtomicReference<>();\n+abstract class MetricProxy<MetricT extends Metric, SelfT extends MetricProxy<MetricT, SelfT>> implements AutoCloseable {\n+    private final AtomicReference<MetricT> instance = new AtomicReference<>();\n     private final AtomicBoolean closed = new AtomicBoolean();\n-\n+    ", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU5NTg2NDA5Ng=="}, "originalCommit": {"oid": "48ef263b64da8e874dffb5608cae69f8f8ecc88a"}, "originalPosition": 24}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzc2MzQ5MjA4OnYy", "diffSide": "RIGHT", "path": "shared/metrics/src/main/java/io/pravega/shared/metrics/OpStatsLoggerImpl.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMy0xN1QwOTo1MjozM1rOI4QtFQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMy0xN1QwOTo1MjozM1rOI4QtFQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU5NTg2NDg1Mw==", "bodyText": "It sounds like checkstyle is missing this rule.", "url": "https://github.com/pravega/pravega/pull/4999#discussion_r595864853", "createdAt": "2021-03-17T09:52:33Z", "author": {"login": "fpj"}, "path": "shared/metrics/src/main/java/io/pravega/shared/metrics/OpStatsLoggerImpl.java", "diffHunk": "@@ -14,16 +14,17 @@\n import io.micrometer.core.instrument.MeterRegistry;\n import io.micrometer.core.instrument.Timer;\n import io.micrometer.core.instrument.distribution.HistogramSnapshot;\n-\n import java.time.Duration;\n import java.util.EnumMap;\n import java.util.concurrent.TimeUnit;\n+import lombok.EqualsAndHashCode;\n \n import static io.pravega.shared.MetricsNames.failMetricName;\n \n+@EqualsAndHashCode\n class OpStatsLoggerImpl implements OpStatsLogger {\n     //region Members\n-\n+    ", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "48ef263b64da8e874dffb5608cae69f8f8ecc88a"}, "originalPosition": 16}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzc2MzUxOTQyOnYy", "diffSide": "RIGHT", "path": "test/integration/src/test/java/io/pravega/test/integration/SingleThreadEndToEndTest.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMy0xN1QwOTo1ODowNlrOI4Q91w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMy0xN1QxNjo0MDo1MVrOI4k94A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU5NTg2OTE0Mw==", "bodyText": "Are you following any guidelines for test timeouts or are you determining it based on test failure observations?", "url": "https://github.com/pravega/pravega/pull/4999#discussion_r595869143", "createdAt": "2021-03-17T09:58:06Z", "author": {"login": "fpj"}, "path": "test/integration/src/test/java/io/pravega/test/integration/SingleThreadEndToEndTest.java", "diffHunk": "@@ -24,7 +24,7 @@\n  */\n public class SingleThreadEndToEndTest {\n \n-    @Test(timeout = 30000)\n+    @Test(timeout = 60000)", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "48ef263b64da8e874dffb5608cae69f8f8ecc88a"}, "originalPosition": 5}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU5NjE5NjgzMg==", "bodyText": "Just observed timeouts.", "url": "https://github.com/pravega/pravega/pull/4999#discussion_r596196832", "createdAt": "2021-03-17T16:40:51Z", "author": {"login": "tkaitchuck"}, "path": "test/integration/src/test/java/io/pravega/test/integration/SingleThreadEndToEndTest.java", "diffHunk": "@@ -24,7 +24,7 @@\n  */\n public class SingleThreadEndToEndTest {\n \n-    @Test(timeout = 30000)\n+    @Test(timeout = 60000)", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU5NTg2OTE0Mw=="}, "originalCommit": {"oid": "48ef263b64da8e874dffb5608cae69f8f8ecc88a"}, "originalPosition": 5}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzc2MzU0MjI0OnYy", "diffSide": "RIGHT", "path": "test/testcommon/src/main/java/io/pravega/test/common/SerializedClassRunner.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMy0xN1QxMDowMzowMFrOI4RMGA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMy0xN1QxNjo0NDowM1rOI4lIiQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU5NTg3Mjc5Mg==", "bodyText": "For completeness, why did you have to write this class and what's that RunNotifier?", "url": "https://github.com/pravega/pravega/pull/4999#discussion_r595872792", "createdAt": "2021-03-17T10:03:00Z", "author": {"login": "fpj"}, "path": "test/testcommon/src/main/java/io/pravega/test/common/SerializedClassRunner.java", "diffHunk": "@@ -0,0 +1,31 @@\n+/**\n+ * Copyright (c) Dell Inc., or its subsidiaries. All Rights Reserved.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ */\n+package io.pravega.test.common;\n+\n+import org.junit.runner.notification.RunNotifier;\n+import org.junit.runners.BlockJUnit4ClassRunner;\n+import org.junit.runners.model.InitializationError;\n+\n+public class SerializedClassRunner extends BlockJUnit4ClassRunner {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "48ef263b64da8e874dffb5608cae69f8f8ecc88a"}, "originalPosition": 16}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU5NjE5OTU2MQ==", "bodyText": "Added a Javadoc.\nIt's needed for some metrics tests which cannot be run in parallel.\nRunNotifier is a Junit class. It's not really being used here except as a pass-through to the parent implementation.", "url": "https://github.com/pravega/pravega/pull/4999#discussion_r596199561", "createdAt": "2021-03-17T16:44:03Z", "author": {"login": "tkaitchuck"}, "path": "test/testcommon/src/main/java/io/pravega/test/common/SerializedClassRunner.java", "diffHunk": "@@ -0,0 +1,31 @@\n+/**\n+ * Copyright (c) Dell Inc., or its subsidiaries. All Rights Reserved.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ */\n+package io.pravega.test.common;\n+\n+import org.junit.runner.notification.RunNotifier;\n+import org.junit.runners.BlockJUnit4ClassRunner;\n+import org.junit.runners.model.InitializationError;\n+\n+public class SerializedClassRunner extends BlockJUnit4ClassRunner {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU5NTg3Mjc5Mg=="}, "originalCommit": {"oid": "48ef263b64da8e874dffb5608cae69f8f8ecc88a"}, "originalPosition": 16}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzc2MzU2OTAzOnYy", "diffSide": "RIGHT", "path": ".github/workflows/gradle.yml", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMy0xN1QxMDowODo0MFrOI4RcjQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMy0xN1QxMDowODo0MFrOI4RcjQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU5NTg3NzAwNQ==", "bodyText": "Since we are moving static analysis to unit_other, this should be changed to just Compile.", "url": "https://github.com/pravega/pravega/pull/4999#discussion_r595877005", "createdAt": "2021-03-17T10:08:40Z", "author": {"login": "fpj"}, "path": ".github/workflows/gradle.yml", "diffHunk": "@@ -78,7 +78,7 @@ jobs:\n           path: ${{env.BUILD_CACHE_PATH}}\n           key: ${{github.run_id}}\n       - name: Compile & Static Analysis", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "48ef263b64da8e874dffb5608cae69f8f8ecc88a"}, "originalPosition": 3}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzc2MzgxNTYxOnYy", "diffSide": "RIGHT", "path": "controller/src/main/java/io/pravega/controller/server/eventProcessor/LocalController.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMy0xN1QxMTowNDozMFrOI4Tz8A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMy0xN1QxMTowNDozMFrOI4Tz8A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU5NTkxNTc2MA==", "bodyText": "nit: typo.", "url": "https://github.com/pravega/pravega/pull/4999#discussion_r595915760", "createdAt": "2021-03-17T11:04:30Z", "author": {"login": "shrids"}, "path": "controller/src/main/java/io/pravega/controller/server/eventProcessor/LocalController.java", "diffHunk": "@@ -157,9 +156,9 @@ public LocalController(ControllerService controller, boolean authorizationEnable\n             case FAILURE:\n                 throw new ControllerFailureException(\"Failed to createing stream: \" + streamConfig);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "48ef263b64da8e874dffb5608cae69f8f8ecc88a"}, "originalPosition": 61}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzg0NDkzNjEwOnYy", "diffSide": "RIGHT", "path": "common/src/main/java/io/pravega/common/concurrent/Futures.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wNC0wNlQxNzo0NjowOVrOJD48Jg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wNC0wNlQyMjowODoyNVrOJECS-w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDYwODA1ODQwNg==", "bodyText": "Minor: executionException -> ExecutionException. We don't necessarily need to address in this PR, but I'm wondering if we should be using @link for such references.", "url": "https://github.com/pravega/pravega/pull/4999#discussion_r608058406", "createdAt": "2021-04-06T17:46:09Z", "author": {"login": "fpj"}, "path": "common/src/main/java/io/pravega/common/concurrent/Futures.java", "diffHunk": "@@ -217,6 +238,43 @@\n             }\n         }\n     }\n+    \n+    /**\n+     * Calls get on the provided future, passing a timeout, handling interrupted, and transforming\n+     * the executionException into an exception of the type whose constructor is provided.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "22a66c03630cd10c48120f9b9eb7f6e30035da75"}, "originalPosition": 35}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDYwODIxMTcwNw==", "bodyText": "Done", "url": "https://github.com/pravega/pravega/pull/4999#discussion_r608211707", "createdAt": "2021-04-06T22:08:25Z", "author": {"login": "tkaitchuck"}, "path": "common/src/main/java/io/pravega/common/concurrent/Futures.java", "diffHunk": "@@ -217,6 +238,43 @@\n             }\n         }\n     }\n+    \n+    /**\n+     * Calls get on the provided future, passing a timeout, handling interrupted, and transforming\n+     * the executionException into an exception of the type whose constructor is provided.", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDYwODA1ODQwNg=="}, "originalCommit": {"oid": "22a66c03630cd10c48120f9b9eb7f6e30035da75"}, "originalPosition": 35}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzg0NDk5ODM5OnYy", "diffSide": "RIGHT", "path": "segmentstore/storage/impl/src/test/java/io/pravega/segmentstore/storage/impl/bookkeeper/BookKeeperLogTests.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wNC0wNlQxODowMDoyNlrOJD5idg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wNC0wNlQyMjowNTozNlrOJECNww==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDYwODA2ODIxNA==", "bodyText": "Haven't you used ledgers path + zkPort before? Should we use the same here? This is what I'm thinking about:\nhttps://github.com/pravega/pravega/pull/4999/files#diff-7cb38ef4f69c054db7f40fc17995e399cfbc2c96cc35ec1e5d40a969e3bb3aedR62", "url": "https://github.com/pravega/pravega/pull/4999#discussion_r608068214", "createdAt": "2021-04-06T18:00:26Z", "author": {"login": "fpj"}, "path": "segmentstore/storage/impl/src/test/java/io/pravega/segmentstore/storage/impl/bookkeeper/BookKeeperLogTests.java", "diffHunk": "@@ -82,41 +80,40 @@\n public abstract class BookKeeperLogTests extends DurableDataLogTestBase {\n     //region Setup, Config and Cleanup\n \n-    private static final AtomicBoolean SECURE_BK = new AtomicBoolean();\n-\n     private static final int CONTAINER_ID = 9999;\n     private static final int WRITE_COUNT = 500;\n     private static final int BOOKIE_COUNT = 1;\n     private static final int THREAD_POOL_SIZE = 3;\n     private static final int MAX_WRITE_ATTEMPTS = 5;\n     private static final int MAX_LEDGER_SIZE = WRITE_MAX_LENGTH * Math.max(10, WRITE_COUNT / 20);\n \n-    private static final AtomicReference<BookKeeperServiceRunner> BK_SERVICE = new AtomicReference<>();\n-    private static final AtomicInteger BK_PORT = new AtomicInteger();\n-\n     @Rule\n-    public Timeout globalTimeout = Timeout.seconds(100 * TIMEOUT.getSeconds());\n+    public Timeout globalTimeout = Timeout.seconds(100);\n     private final AtomicReference<BookKeeperConfig> config = new AtomicReference<>();\n     private final AtomicReference<CuratorFramework> zkClient = new AtomicReference<>();\n     private final AtomicReference<BookKeeperLogFactory> factory = new AtomicReference<>();\n+    private final AtomicBoolean secureBk = new AtomicBoolean();\n+    private final AtomicReference<BookKeeperServiceRunner> bkService = new AtomicReference<>();\n \n     /**\n      * Start BookKeeper once for the duration of this class. This is pretty strenuous, so in the interest of running time\n      * we only do it once.\n      */\n-    public static void setUpBookKeeper(boolean secure) throws Exception {\n+    public void setUpBookKeeper(boolean secure) throws Exception {\n         // Pick a random port to reduce chances of collisions during concurrent test executions.\n-        SECURE_BK.set(secure);\n-        BK_PORT.set(TestUtils.getAvailableListenPort());\n+        secureBk.set(secure);\n+        String testId = Long.toHexString(System.nanoTime());\n+        int zkPort = TestUtils.getAvailableListenPort();\n         val bookiePorts = new ArrayList<Integer>();\n         for (int i = 0; i < BOOKIE_COUNT; i++) {\n             bookiePorts.add(TestUtils.getAvailableListenPort());\n         }\n \n+        String ledgersPath = \"/pravega/bookkeeper/ledgers/\" + testId;\n         val runner = BookKeeperServiceRunner.builder()\n                                             .startZk(true)\n-                                            .zkPort(BK_PORT.get())\n-                                            .ledgersPath(\"/pravega/bookkeeper/ledgers\")\n+                                            .zkPort(zkPort)\n+                                            .ledgersPath(ledgersPath)", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "22a66c03630cd10c48120f9b9eb7f6e30035da75"}, "originalPosition": 71}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDYwODIxMDM3MQ==", "bodyText": "From the above:\n String ledgersPath = \"/pravega/bookkeeper/ledgers/\" + testId;\n\nWhere testId is:\nString testId = Long.toHexString(System.nanoTime());\n\nThis serves much the same function. Either way it ensures that parallel tests won't collide in their directories.", "url": "https://github.com/pravega/pravega/pull/4999#discussion_r608210371", "createdAt": "2021-04-06T22:05:36Z", "author": {"login": "tkaitchuck"}, "path": "segmentstore/storage/impl/src/test/java/io/pravega/segmentstore/storage/impl/bookkeeper/BookKeeperLogTests.java", "diffHunk": "@@ -82,41 +80,40 @@\n public abstract class BookKeeperLogTests extends DurableDataLogTestBase {\n     //region Setup, Config and Cleanup\n \n-    private static final AtomicBoolean SECURE_BK = new AtomicBoolean();\n-\n     private static final int CONTAINER_ID = 9999;\n     private static final int WRITE_COUNT = 500;\n     private static final int BOOKIE_COUNT = 1;\n     private static final int THREAD_POOL_SIZE = 3;\n     private static final int MAX_WRITE_ATTEMPTS = 5;\n     private static final int MAX_LEDGER_SIZE = WRITE_MAX_LENGTH * Math.max(10, WRITE_COUNT / 20);\n \n-    private static final AtomicReference<BookKeeperServiceRunner> BK_SERVICE = new AtomicReference<>();\n-    private static final AtomicInteger BK_PORT = new AtomicInteger();\n-\n     @Rule\n-    public Timeout globalTimeout = Timeout.seconds(100 * TIMEOUT.getSeconds());\n+    public Timeout globalTimeout = Timeout.seconds(100);\n     private final AtomicReference<BookKeeperConfig> config = new AtomicReference<>();\n     private final AtomicReference<CuratorFramework> zkClient = new AtomicReference<>();\n     private final AtomicReference<BookKeeperLogFactory> factory = new AtomicReference<>();\n+    private final AtomicBoolean secureBk = new AtomicBoolean();\n+    private final AtomicReference<BookKeeperServiceRunner> bkService = new AtomicReference<>();\n \n     /**\n      * Start BookKeeper once for the duration of this class. This is pretty strenuous, so in the interest of running time\n      * we only do it once.\n      */\n-    public static void setUpBookKeeper(boolean secure) throws Exception {\n+    public void setUpBookKeeper(boolean secure) throws Exception {\n         // Pick a random port to reduce chances of collisions during concurrent test executions.\n-        SECURE_BK.set(secure);\n-        BK_PORT.set(TestUtils.getAvailableListenPort());\n+        secureBk.set(secure);\n+        String testId = Long.toHexString(System.nanoTime());\n+        int zkPort = TestUtils.getAvailableListenPort();\n         val bookiePorts = new ArrayList<Integer>();\n         for (int i = 0; i < BOOKIE_COUNT; i++) {\n             bookiePorts.add(TestUtils.getAvailableListenPort());\n         }\n \n+        String ledgersPath = \"/pravega/bookkeeper/ledgers/\" + testId;\n         val runner = BookKeeperServiceRunner.builder()\n                                             .startZk(true)\n-                                            .zkPort(BK_PORT.get())\n-                                            .ledgersPath(\"/pravega/bookkeeper/ledgers\")\n+                                            .zkPort(zkPort)\n+                                            .ledgersPath(ledgersPath)", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDYwODA2ODIxNA=="}, "originalCommit": {"oid": "22a66c03630cd10c48120f9b9eb7f6e30035da75"}, "originalPosition": 71}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzg0NTA5NTI3OnYy", "diffSide": "RIGHT", "path": "shared/metrics/src/main/java/io/pravega/shared/metrics/StatsLoggerProxy.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wNC0wNlQxODoyNDoxNFrOJD6eMA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wNC0wNlQxODoyNDoxNFrOJD6eMA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDYwODA4MzUwNA==", "bodyText": "Minor: extra spaces", "url": "https://github.com/pravega/pravega/pull/4999#discussion_r608083504", "createdAt": "2021-04-06T18:24:14Z", "author": {"login": "fpj"}, "path": "shared/metrics/src/main/java/io/pravega/shared/metrics/StatsLoggerProxy.java", "diffHunk": "@@ -99,17 +99,21 @@ public StatsLogger createScopeLogger(String scope) {\n      * @param <V>          Type of MetricProxy.\n      * @return Either the existing MetricProxy (if it is already registered) or the newly created one.\n      */\n-    private <T extends Metric, V extends MetricProxy<T>> V getOrSet(ConcurrentHashMap<String, V> cache, String name,\n-                                                                    Function<String, T> createMetric,\n-                                                                    ProxyCreator<T, V> createProxy, String... tags) {\n+    private static <T extends Metric, V extends MetricProxy<T, V>> V getOrSet(ConcurrentHashMap<String, V> cache, String name,\n+                                                                              Function<String, T> createMetric,\n+                                                                              ProxyCreator<T, V> createProxy, String... tags) {\n+        // We have to create the metric inside computeIfAbsent even though it is under lock, because micrometer is optimized\n+        // such that the call to create will return the original metric if it has already been created. So when close is called\n+        // on one of the metrics it will close both of them. \n         MetricsNames.MetricKey keys = metricKey(name, tags);\n-        return cache.computeIfAbsent(keys.getCacheKey(), key -> {\n-            T metric = createMetric.apply(keys.getRegistryKey());\n-            return createProxy.apply(metric, keys.getCacheKey(), cache::remove);\n+        Consumer<V> closeCallback = m -> cache.remove(m.getProxyName(), m);\n+        return cache.computeIfAbsent(keys.getCacheKey(), k -> {            \n+            T newMetric = createMetric.apply(keys.getRegistryKey());\n+            return createProxy.apply(newMetric, keys.getCacheKey(), closeCallback);\n         });\n     }\n-\n+    ", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "22a66c03630cd10c48120f9b9eb7f6e30035da75"}, "originalPosition": 24}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzg0NTEwMjA0OnYy", "diffSide": "RIGHT", "path": "shared/metrics/src/test/java/io/pravega/shared/metrics/BasicMetricTest.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wNC0wNlQxODoyNTo1MFrOJD6iSg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wNC0wNlQyMjowODoxNFrOJECSnw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDYwODA4NDU1NA==", "bodyText": "It is odd that it is not recognizing this file as Java, is this just a UI bug?", "url": "https://github.com/pravega/pravega/pull/4999#discussion_r608084554", "createdAt": "2021-04-06T18:25:50Z", "author": {"login": "fpj"}, "path": "shared/metrics/src/test/java/io/pravega/shared/metrics/BasicMetricTest.java", "diffHunk": "@@ -16,21 +16,23 @@\n package io.pravega.shared.metrics;\n \n import io.pravega.shared.MetricsTags;\n+import io.pravega.test.common.SerializedClassRunner;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "22a66c03630cd10c48120f9b9eb7f6e30035da75"}, "originalPosition": 4}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDYwODIxMTYxNQ==", "bodyText": "No idea. It's working for me.", "url": "https://github.com/pravega/pravega/pull/4999#discussion_r608211615", "createdAt": "2021-04-06T22:08:14Z", "author": {"login": "tkaitchuck"}, "path": "shared/metrics/src/test/java/io/pravega/shared/metrics/BasicMetricTest.java", "diffHunk": "@@ -16,21 +16,23 @@\n package io.pravega.shared.metrics;\n \n import io.pravega.shared.MetricsTags;\n+import io.pravega.test.common.SerializedClassRunner;", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDYwODA4NDU1NA=="}, "originalCommit": {"oid": "22a66c03630cd10c48120f9b9eb7f6e30035da75"}, "originalPosition": 4}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzg0NTE0ODQ4OnYy", "diffSide": "RIGHT", "path": "test/integration/src/test/java/io/pravega/test/integration/endtoendtest/EndToEndCBRTest.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wNC0wNlQxODozNzoyNFrOJD6_DQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wNC0wNlQxODozNzoyNFrOJD6_DQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDYwODA5MTkxNw==", "bodyText": "Minor: extra spaces.", "url": "https://github.com/pravega/pravega/pull/4999#discussion_r608091917", "createdAt": "2021-04-06T18:37:24Z", "author": {"login": "fpj"}, "path": "test/integration/src/test/java/io/pravega/test/integration/endtoendtest/EndToEndCBRTest.java", "diffHunk": "@@ -59,23 +57,23 @@\n public class EndToEndCBRTest extends AbstractEndToEndTest {\n \n     private static final long CLOCK_ADVANCE_INTERVAL = 60 * 1000000000L;\n-\n-    @Test\n+    ", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "fab235c96f81b998a0ff37fc75960eb0d08fcfd4"}, "originalPosition": 24}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzg0OTM5MDg0OnYy", "diffSide": "LEFT", "path": "controller/src/main/java/io/pravega/controller/eventProcessor/impl/EventProcessorCell.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wNC0wN1QxNTowODo0N1rOJEiydA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wNC0wN1QxNjoyNjo1N1rOJEm0Uw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDYwODc0NDA1Mg==", "bodyText": "why are we removing this.. this is a zookeeper node which needs to be cleaned up.", "url": "https://github.com/pravega/pravega/pull/4999#discussion_r608744052", "createdAt": "2021-04-07T15:08:47Z", "author": {"login": "shiveshr"}, "path": "controller/src/main/java/io/pravega/controller/eventProcessor/impl/EventProcessorCell.java", "diffHunk": "@@ -142,14 +143,6 @@ protected final void shutDown() throws Exception {\n                 } catch (Exception e) {\n                     log.info(\"Exception while closing EventProcessorCell reader from checkpointStore: {}.\", e.getMessage());\n                 }\n-\n-                // Next, clean up the reader and its position from checkpoint store\n-                log.info(\"Cleaning up checkpoint store for {}\", objectId);\n-                try {\n-                    checkpointStore.removeReader(process, readerGroupName, readerId);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "1e626eb61d358f7cde95b23b94de1aa436e54631"}, "originalPosition": 16}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDYwODgxMDA2Nw==", "bodyText": "I moved it into checkpointStore:\nhttps://github.com/pravega/pravega/pull/4999/files#diff-36211c36a9b83866c7fae956d50dce693373d12d9d9e29bf550bd4d52b52851bR161-R164", "url": "https://github.com/pravega/pravega/pull/4999#discussion_r608810067", "createdAt": "2021-04-07T16:26:57Z", "author": {"login": "tkaitchuck"}, "path": "controller/src/main/java/io/pravega/controller/eventProcessor/impl/EventProcessorCell.java", "diffHunk": "@@ -142,14 +143,6 @@ protected final void shutDown() throws Exception {\n                 } catch (Exception e) {\n                     log.info(\"Exception while closing EventProcessorCell reader from checkpointStore: {}.\", e.getMessage());\n                 }\n-\n-                // Next, clean up the reader and its position from checkpoint store\n-                log.info(\"Cleaning up checkpoint store for {}\", objectId);\n-                try {\n-                    checkpointStore.removeReader(process, readerGroupName, readerId);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDYwODc0NDA1Mg=="}, "originalCommit": {"oid": "1e626eb61d358f7cde95b23b94de1aa436e54631"}, "originalPosition": 16}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzg0OTQwNjYzOnYy", "diffSide": "RIGHT", "path": "controller/src/main/java/io/pravega/controller/eventProcessor/impl/EventProcessorGroupImpl.java", "isResolved": false, "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wNC0wN1QxNToxMToxOFrOJEi7lg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wNC0wN1QxNjo1MzoyNVrOJEoAiQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDYwODc0NjM5MA==", "bodyText": "why not remove the reader from inside cell.stop which terminates the reader and only after that we remove it. here we could be removing it prematurely.", "url": "https://github.com/pravega/pravega/pull/4999#discussion_r608746390", "createdAt": "2021-04-07T15:11:18Z", "author": {"login": "shiveshr"}, "path": "controller/src/main/java/io/pravega/controller/eventProcessor/impl/EventProcessorGroupImpl.java", "diffHunk": "@@ -369,6 +364,7 @@ private void replaceCell(String readerId) {\n             log.info(\"Stopping event processor cell: {}\", cell);\n             try {\n                 cell.stopAsync();\n+                checkpointStore.removeReader(cell.getProcess(), readerGroup.getGroupName(), readerId);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "1e626eb61d358f7cde95b23b94de1aa436e54631"}, "originalPosition": 108}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDYwODc2NDgzMg==", "bodyText": "it would make a difference if we are unable to do a clean shutdown (where we use the last reader position and report it offline at that position..\nsay all of that failed but we removed the reader postion from zookeeper, then another controller will not be able to correctly failover this reader.", "url": "https://github.com/pravega/pravega/pull/4999#discussion_r608764832", "createdAt": "2021-04-07T15:32:10Z", "author": {"login": "shiveshr"}, "path": "controller/src/main/java/io/pravega/controller/eventProcessor/impl/EventProcessorGroupImpl.java", "diffHunk": "@@ -369,6 +364,7 @@ private void replaceCell(String readerId) {\n             log.info(\"Stopping event processor cell: {}\", cell);\n             try {\n                 cell.stopAsync();\n+                checkpointStore.removeReader(cell.getProcess(), readerGroup.getGroupName(), readerId);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDYwODc0NjM5MA=="}, "originalCommit": {"oid": "1e626eb61d358f7cde95b23b94de1aa436e54631"}, "originalPosition": 108}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDYwODgyOTU3Nw==", "bodyText": "While I agree it would be cleaner, my motivation for not doing it inside the cell, is because it causes problems on shutdown.\nSpecifically if the checkpointStore needs to be written to, then every cell will need to timeout writing to it. As there are many cells this results in very long delays in the tests. In fact it is the largest single contributor of integration test time.\nI have addressed the concern raised here about this being too soon by moving it after the await.", "url": "https://github.com/pravega/pravega/pull/4999#discussion_r608829577", "createdAt": "2021-04-07T16:53:25Z", "author": {"login": "tkaitchuck"}, "path": "controller/src/main/java/io/pravega/controller/eventProcessor/impl/EventProcessorGroupImpl.java", "diffHunk": "@@ -369,6 +364,7 @@ private void replaceCell(String readerId) {\n             log.info(\"Stopping event processor cell: {}\", cell);\n             try {\n                 cell.stopAsync();\n+                checkpointStore.removeReader(cell.getProcess(), readerGroup.getGroupName(), readerId);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDYwODc0NjM5MA=="}, "originalCommit": {"oid": "1e626eb61d358f7cde95b23b94de1aa436e54631"}, "originalPosition": 108}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzg0OTQwODkwOnYy", "diffSide": "RIGHT", "path": "controller/src/main/java/io/pravega/controller/server/eventProcessor/LocalController.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wNC0wN1QxNToxMTo0MVrOJEi86g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wNC0wN1QxNToxMTo0MVrOJEi86g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDYwODc0NjczMA==", "bodyText": "thank you :)", "url": "https://github.com/pravega/pravega/pull/4999#discussion_r608746730", "createdAt": "2021-04-07T15:11:41Z", "author": {"login": "shiveshr"}, "path": "controller/src/main/java/io/pravega/controller/server/eventProcessor/LocalController.java", "diffHunk": "@@ -161,11 +160,11 @@ public LocalController(ControllerService controller, boolean authorizationEnable\n         return this.controller.createStream(scope, streamName, streamConfig, System.currentTimeMillis()).thenApply(x -> {\n             switch (x.getStatus()) {\n             case FAILURE:\n-                throw new ControllerFailureException(\"Failed to createing stream: \" + streamConfig);\n+                throw new ControllerFailureException(\"Failed to create stream: \" + streamConfig);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "1e626eb61d358f7cde95b23b94de1aa436e54631"}, "originalPosition": 64}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzg0OTQ0NTQ4OnYy", "diffSide": "RIGHT", "path": "gradle/java.gradle", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wNC0wN1QxNToxODoyM1rOJEjTfA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wNC0wN1QxNjo1MjozNlrOJEn-cw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDYwODc1MjUwOA==", "bodyText": "the reason why only FAILED event was present ref: #5441 (review)", "url": "https://github.com/pravega/pravega/pull/4999#discussion_r608752508", "createdAt": "2021-04-07T15:18:23Z", "author": {"login": "shrids"}, "path": "gradle/java.gradle", "diffHunk": "@@ -94,12 +94,13 @@ plugins.withId('java') {\n         testLogging.showCauses = true\n         testLogging.showExceptions = true\n         testLogging.showStackTraces = true\n-        testLogging.events = [\"FAILED\"]\n-        maxParallelForks = System.properties['maxParallelForks'] ? System.properties['maxParallelForks'].toInteger() : 1\n+        testLogging.events = [\"STARTED\", \"PASSED\", \"SKIPPED\", \"FAILED\"]", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "1e626eb61d358f7cde95b23b94de1aa436e54631"}, "originalPosition": 6}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDYwODgyOTA0Mw==", "bodyText": "I removed the duplicate on start.\nGiven that there is parallelization I don't consider 'passed' and 'started' redundant anymore, because it allows you to infer which are running at the same time.", "url": "https://github.com/pravega/pravega/pull/4999#discussion_r608829043", "createdAt": "2021-04-07T16:52:36Z", "author": {"login": "tkaitchuck"}, "path": "gradle/java.gradle", "diffHunk": "@@ -94,12 +94,13 @@ plugins.withId('java') {\n         testLogging.showCauses = true\n         testLogging.showExceptions = true\n         testLogging.showStackTraces = true\n-        testLogging.events = [\"FAILED\"]\n-        maxParallelForks = System.properties['maxParallelForks'] ? System.properties['maxParallelForks'].toInteger() : 1\n+        testLogging.events = [\"STARTED\", \"PASSED\", \"SKIPPED\", \"FAILED\"]", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDYwODc1MjUwOA=="}, "originalCommit": {"oid": "1e626eb61d358f7cde95b23b94de1aa436e54631"}, "originalPosition": 6}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzg0OTQ3OTkwOnYy", "diffSide": "RIGHT", "path": "segmentstore/storage/impl/src/main/java/io/pravega/segmentstore/storage/impl/bookkeeper/BookKeeperLogFactory.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wNC0wN1QxNToyNDozM1rOJEjodg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wNC0wN1QxNjo1MzowM1rOJEn_mQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDYwODc1Nzg3OA==", "bodyText": "Is the reason for this change related to the below WARN message observed on Segment store ?\n2021-02-26 05:38:20,547 13644 [core-1] WARN  o.a.b.client.BookieWatcherImpl - New ensemble: [nautilus-bookie-2.nautilus-bookie-headless.nautilus-pravega.svc.cluster.local:3181, nautilus-bookie-0.nautilus-bookie-headless.nautilus-pravega.svc.cluster.local:3181, nautilus-bookie-1.nautilus-bookie-headless.nautilus-pravega.svc.cluster.local:3181] is not adhering to Placement Policy. quarantinedBookies: []", "url": "https://github.com/pravega/pravega/pull/4999#discussion_r608757878", "createdAt": "2021-04-07T15:24:33Z", "author": {"login": "shrids"}, "path": "segmentstore/storage/impl/src/main/java/io/pravega/segmentstore/storage/impl/bookkeeper/BookKeeperLogFactory.java", "diffHunk": "@@ -189,6 +190,8 @@ private BookKeeper startBookKeeperClient() throws Exception {\n             config.setEnforceMinNumRacksPerWriteQuorum(this.config.isEnforceMinNumRacksPerWriteQuorum());\n             config.setMinNumRacksPerWriteQuorum(this.config.getMinNumRacksPerWriteQuorum());\n             config.setProperty(CommonConfigurationKeys.NET_TOPOLOGY_SCRIPT_FILE_NAME_KEY, this.config.getNetworkTopologyFileName());\n+        } else {\n+            config = config.setEnsemblePlacementPolicy(DefaultEnsemblePlacementPolicy.class);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "1e626eb61d358f7cde95b23b94de1aa436e54631"}, "originalPosition": 13}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDYwODgyOTMzNw==", "bodyText": "Yes.", "url": "https://github.com/pravega/pravega/pull/4999#discussion_r608829337", "createdAt": "2021-04-07T16:53:03Z", "author": {"login": "tkaitchuck"}, "path": "segmentstore/storage/impl/src/main/java/io/pravega/segmentstore/storage/impl/bookkeeper/BookKeeperLogFactory.java", "diffHunk": "@@ -189,6 +190,8 @@ private BookKeeper startBookKeeperClient() throws Exception {\n             config.setEnforceMinNumRacksPerWriteQuorum(this.config.isEnforceMinNumRacksPerWriteQuorum());\n             config.setMinNumRacksPerWriteQuorum(this.config.getMinNumRacksPerWriteQuorum());\n             config.setProperty(CommonConfigurationKeys.NET_TOPOLOGY_SCRIPT_FILE_NAME_KEY, this.config.getNetworkTopologyFileName());\n+        } else {\n+            config = config.setEnsemblePlacementPolicy(DefaultEnsemblePlacementPolicy.class);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDYwODc1Nzg3OA=="}, "originalCommit": {"oid": "1e626eb61d358f7cde95b23b94de1aa436e54631"}, "originalPosition": 13}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzg1NzU2NDI5OnYy", "diffSide": "RIGHT", "path": ".github/workflows/gradle.yml", "isResolved": false, "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wNC0wOFQxNzo0MzoxMlrOJFsMCg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wNC0wOFQyMTowMjo0MVrOJF1v4Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDYwOTk0NjYzNA==", "bodyText": "Can you verify that this change won't impact workflow re-runs?\nThe point of all these caches is to have a particular job finish right away if it previously completed successfully and we re-run the whole workflow.", "url": "https://github.com/pravega/pravega/pull/4999#discussion_r609946634", "createdAt": "2021-04-08T17:43:12Z", "author": {"login": "andreipaduroiu"}, "path": ".github/workflows/gradle.yml", "diffHunk": "@@ -29,18 +29,24 @@ on:\n # Define a few constants that are shared across all the jobs.\n env:\n   GLOBAL_CACHE_PATH: |\n-    .gradle\n     ~/.gradle\n     ~/.m2\n   GLOBAL_CACHE_KEY: gradle-m2-java-11\n   GLOBAL_CACHE_RESTORE_KEYS: |\n     gradle-m2-java-\n     gradle-m2\n-  # We cache the source code, resources and build output. This is generated on the build job and reused in dependent jobs.\n-  BUILD_CACHE_PATH: ./*\n+  # We cache the class files, resources and build output. This is generated on the build job and reused in dependent jobs.\n+  BUILD_CACHE_PATH: |\n+    .gradle", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d62a0a1f6e3d8522a91926cadcaba1b34837e46a"}, "originalPosition": 15}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDYxMDAxMjYxMg==", "bodyText": "I am checking", "url": "https://github.com/pravega/pravega/pull/4999#discussion_r610012612", "createdAt": "2021-04-08T19:04:14Z", "author": {"login": "tkaitchuck"}, "path": ".github/workflows/gradle.yml", "diffHunk": "@@ -29,18 +29,24 @@ on:\n # Define a few constants that are shared across all the jobs.\n env:\n   GLOBAL_CACHE_PATH: |\n-    .gradle\n     ~/.gradle\n     ~/.m2\n   GLOBAL_CACHE_KEY: gradle-m2-java-11\n   GLOBAL_CACHE_RESTORE_KEYS: |\n     gradle-m2-java-\n     gradle-m2\n-  # We cache the source code, resources and build output. This is generated on the build job and reused in dependent jobs.\n-  BUILD_CACHE_PATH: ./*\n+  # We cache the class files, resources and build output. This is generated on the build job and reused in dependent jobs.\n+  BUILD_CACHE_PATH: |\n+    .gradle", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDYwOTk0NjYzNA=="}, "originalCommit": {"oid": "d62a0a1f6e3d8522a91926cadcaba1b34837e46a"}, "originalPosition": 15}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDYxMDEwMzI2NQ==", "bodyText": "Confirmed", "url": "https://github.com/pravega/pravega/pull/4999#discussion_r610103265", "createdAt": "2021-04-08T21:02:41Z", "author": {"login": "tkaitchuck"}, "path": ".github/workflows/gradle.yml", "diffHunk": "@@ -29,18 +29,24 @@ on:\n # Define a few constants that are shared across all the jobs.\n env:\n   GLOBAL_CACHE_PATH: |\n-    .gradle\n     ~/.gradle\n     ~/.m2\n   GLOBAL_CACHE_KEY: gradle-m2-java-11\n   GLOBAL_CACHE_RESTORE_KEYS: |\n     gradle-m2-java-\n     gradle-m2\n-  # We cache the source code, resources and build output. This is generated on the build job and reused in dependent jobs.\n-  BUILD_CACHE_PATH: ./*\n+  # We cache the class files, resources and build output. This is generated on the build job and reused in dependent jobs.\n+  BUILD_CACHE_PATH: |\n+    .gradle", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDYwOTk0NjYzNA=="}, "originalCommit": {"oid": "d62a0a1f6e3d8522a91926cadcaba1b34837e46a"}, "originalPosition": 15}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzg1NzU3MDM1OnYy", "diffSide": "RIGHT", "path": ".github/workflows/gradle.yml", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wNC0wOFQxNzo0NDoxNFrOJFsPoA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wNC0wOFQxOTowMjowOFrOJFwG-g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDYwOTk0NzU1Mg==", "bodyText": "What is the effect of this change? run_id would cache the output for re-runs of the same workflow.", "url": "https://github.com/pravega/pravega/pull/4999#discussion_r609947552", "createdAt": "2021-04-08T17:44:14Z", "author": {"login": "andreipaduroiu"}, "path": ".github/workflows/gradle.yml", "diffHunk": "@@ -101,14 +112,14 @@ jobs:\n         uses: actions/cache@v2.1.0\n         with:\n           path: ${{env.BUILD_CACHE_PATH}}\n-          key: ${{github.run_id}}\n+          key: ${{github.ref}}", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d62a0a1f6e3d8522a91926cadcaba1b34837e46a"}, "originalPosition": 67}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDYxMDAxMDg3NA==", "bodyText": "Now instead of being tied to a github actions run, it's tied to the source. (PR or Branch). This means that multiple pushes to the same branch can avoid re-executing if the tests for that target passed and no related code was changed just like the do locally.", "url": "https://github.com/pravega/pravega/pull/4999#discussion_r610010874", "createdAt": "2021-04-08T19:02:08Z", "author": {"login": "tkaitchuck"}, "path": ".github/workflows/gradle.yml", "diffHunk": "@@ -101,14 +112,14 @@ jobs:\n         uses: actions/cache@v2.1.0\n         with:\n           path: ${{env.BUILD_CACHE_PATH}}\n-          key: ${{github.run_id}}\n+          key: ${{github.ref}}", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDYwOTk0NzU1Mg=="}, "originalCommit": {"oid": "d62a0a1f6e3d8522a91926cadcaba1b34837e46a"}, "originalPosition": 67}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4832, "cost": 1, "resetAt": "2021-11-13T12:26:42Z"}}}