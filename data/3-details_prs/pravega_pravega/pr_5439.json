{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTQxODY2NjU3", "number": 5439, "title": "Issue 5112: Client API to Create Subscriber reader groups", "bodyText": "Change log description\nThe ReaderGroup operations createReaderGroup, deleteReaderGroup and resetReaderGroup have been modified such that, in the case of the ReaderGroup being a subscriber the controller calls are made to ensure consistent subscription/unsubscription to all the necessary streams.\nNote: Requires #5400 to build.\nPurpose of the change\nFixes #5112, #5543\nWhat the code does\n\nReaderGroupState now has an updatingConfig field that indicates if the ReaderGroupConfig is being updated or not.\n\nAdded a new state update in ReaderGroupState to change the above field.\n\n\nChanged the methods: createReaderGroup, deleteReaderGroup and resetReaderGroup to make controller calls so that group is consistent with its version on the controller.\nAdded a new timer to the ReaderGroupStateManager that will help periodically update the config to the one present on the controller to maintain consistency between the client and controller versions of the config.\nAdded fix for flaky test StreamMetricsTest.testStreamsAndScopesBasicMetricsTests\n\nHow to verify it\nBuild should succeed and all tests must pass.", "createdAt": "2020-12-17T13:30:14Z", "url": "https://github.com/pravega/pravega/pull/5439", "merged": true, "mergeCommit": {"oid": "773ad76d7face2e034972e6b47c6fac65fb09256"}, "closed": true, "closedAt": "2021-01-19T15:10:03Z", "author": {"login": "anirudhkovuru"}, "timelineItems": {"totalCount": 76, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdnDV2oAH2gAyNTQxODY2NjU3OjNiM2MxZTIxMzQwNmFlNjJmOGI1Nzc5NWRjNzNiOTFlMDRkZmU1ZGE=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdxqMMDgH2gAyNTQxODY2NjU3OjJjNDg0NGYxZWQ1ZGRjYjZlZjY5ODdiN2RhZTFlZjQ1MTk0MDUyMTg=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "3b3c1e213406ae62f8b57795dc73b91e04dfe5da", "author": {"user": {"login": "anirudhkovuru", "name": null}}, "url": "https://github.com/pravega/pravega/commit/3b3c1e213406ae62f8b57795dc73b91e04dfe5da", "committedDate": "2020-12-17T13:13:52Z", "message": "Added client changes for subscriber RG crud\n\nSigned-off-by: anirudhkovuru <anirudhkovuru@gmail.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "3497a1129e78ecbea223ed579f631d116036eabd", "author": {"user": {"login": "anirudhkovuru", "name": null}}, "url": "https://github.com/pravega/pravega/commit/3497a1129e78ecbea223ed579f631d116036eabd", "committedDate": "2020-12-17T13:17:16Z", "message": "Merge branch 'master' of https://github.com/pravega/pravega into issue-5112-client-changes"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTU0OTk3OTE5", "url": "https://github.com/pravega/pravega/pull/5439#pullrequestreview-554997919", "createdAt": "2020-12-17T21:22:34Z", "commit": {"oid": "3497a1129e78ecbea223ed579f631d116036eabd"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 7, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xN1QyMToyMjozNFrOIIJTUg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xN1QyMjo0ODoxN1rOIIL3lg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NTQxMTkyMg==", "bodyText": "This is a public interface. If possible either add these to the impl and omit them here, or find an alternative way to obtain the information.\nIf they must be added here and made public:\n\nMake sure the names match our other public analogous apis. (IE I'm fairly sure the word \"synchronizer\" shouldn't be in there)\nThey will also need javadocs and tests.\nAdd fpj and sandeep as reviewers on the PR and tag it as an API change.", "url": "https://github.com/pravega/pravega/pull/5439#discussion_r545411922", "createdAt": "2020-12-17T21:22:34Z", "author": {"login": "tkaitchuck"}, "path": "client/src/main/java/io/pravega/client/state/StateSynchronizer.java", "diffHunk": "@@ -45,6 +45,10 @@\n      */\n     StateT getState();\n \n+    String getSynchronizerScopeName();\n+\n+    String getSynchronizerStreamName();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "3497a1129e78ecbea223ed579f631d116036eabd"}, "originalPosition": 6}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NTQ0NzY5OA==", "bodyText": "This needs to be conditional.\nWe don't want to perform this update if:\na) It's already been completed.\nb) Another even newer config update has been completed.", "url": "https://github.com/pravega/pravega/pull/5439#discussion_r545447698", "createdAt": "2020-12-17T22:34:34Z", "author": {"login": "tkaitchuck"}, "path": "client/src/main/java/io/pravega/client/stream/impl/ReaderGroupImpl.java", "diffHunk": "@@ -200,8 +201,12 @@ private Checkpoint completeCheckpoint(String checkpointName) {\n \n     @Override\n     public void resetReaderGroup(ReaderGroupConfig config) {\n+        synchronizer.updateState((state, updates) -> {\n+            updates.add(new UpdatingConfig(true));\n+        });\n+        getThrowingException(controller.updateReaderGroup(scope, groupName, config));\n         Map<SegmentWithRange, Long> segments = getSegmentsForStreams(controller, config);\n-        synchronizer.updateStateUnconditionally(new ReaderGroupStateInit(config, segments, getEndSegmentsForStreams(config)));\n+        synchronizer.updateStateUnconditionally(new ReaderGroupStateInit(config, segments, getEndSegmentsForStreams(config), false));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "3497a1129e78ecbea223ed579f631d116036eabd"}, "originalPosition": 18}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NTQ0Nzc1MQ==", "bodyText": "What if updatingConfig is already set to true?\nWhat happens in the following race:\nresetReadeGroup(a) - start\nresetReadeGroup(b) - start\nresetReadeGroup(b) - complete\nresetReadeGroup(a) - ???\nThere is no lock between here and the controller. So an order needs to be defined.", "url": "https://github.com/pravega/pravega/pull/5439#discussion_r545447751", "createdAt": "2020-12-17T22:34:40Z", "author": {"login": "tkaitchuck"}, "path": "client/src/main/java/io/pravega/client/stream/impl/ReaderGroupImpl.java", "diffHunk": "@@ -200,8 +201,12 @@ private Checkpoint completeCheckpoint(String checkpointName) {\n \n     @Override\n     public void resetReaderGroup(ReaderGroupConfig config) {\n+        synchronizer.updateState((state, updates) -> {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "3497a1129e78ecbea223ed579f631d116036eabd"}, "originalPosition": 12}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NTQ1MDMwNw==", "bodyText": "Shouldn't this be fetchUpdatesIfNeeded()?", "url": "https://github.com/pravega/pravega/pull/5439#discussion_r545450307", "createdAt": "2020-12-17T22:40:16Z", "author": {"login": "tkaitchuck"}, "path": "client/src/main/java/io/pravega/client/stream/impl/ReaderGroupStateManager.java", "diffHunk": "@@ -330,6 +337,21 @@ private void fetchUpdatesIfNeeded() {\n             compactIfNeeded();\n         }\n     }\n+\n+    void updateConfigIfNeeded() {\n+        sync.fetchUpdates();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "3497a1129e78ecbea223ed579f631d116036eabd"}, "originalPosition": 42}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NTQ1MTcwMw==", "bodyText": "Be more specific this won't actually help anyone debug a problem if there is one.\nWhich reader group? What config? Is an update actually being performed?", "url": "https://github.com/pravega/pravega/pull/5439#discussion_r545451703", "createdAt": "2020-12-17T22:43:13Z", "author": {"login": "tkaitchuck"}, "path": "client/src/main/java/io/pravega/client/stream/impl/ReaderGroupStateManager.java", "diffHunk": "@@ -330,6 +337,21 @@ private void fetchUpdatesIfNeeded() {\n             compactIfNeeded();\n         }\n     }\n+\n+    void updateConfigIfNeeded() {\n+        sync.fetchUpdates();\n+        ReaderGroupState state = sync.getState();\n+        if (!updateConfigTimer.hasRemaining() && state.isUpdatingConfig()) {\n+            log.debug(\"Update the group config\");", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "3497a1129e78ecbea223ed579f631d116036eabd"}, "originalPosition": 45}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NTQ1MjU3Ng==", "bodyText": "This precludes cross scope reading, which is an important feature.\nDon't make assumptions about the scope and stream name here. Explicitly obtain them from the state. (Or add them as member variables to this class)", "url": "https://github.com/pravega/pravega/pull/5439#discussion_r545452576", "createdAt": "2020-12-17T22:45:03Z", "author": {"login": "tkaitchuck"}, "path": "client/src/main/java/io/pravega/client/stream/impl/ReaderGroupStateManager.java", "diffHunk": "@@ -330,6 +337,21 @@ private void fetchUpdatesIfNeeded() {\n             compactIfNeeded();\n         }\n     }\n+\n+    void updateConfigIfNeeded() {\n+        sync.fetchUpdates();\n+        ReaderGroupState state = sync.getState();\n+        if (!updateConfigTimer.hasRemaining() && state.isUpdatingConfig()) {\n+            log.debug(\"Update the group config\");\n+            ReaderGroupConfig controllerConfig = getThrowingException(controller.getReaderGroupConfig(sync.getSynchronizerScopeName(),\n+                    sync.getSynchronizerStreamName().replace(READER_GROUP_STREAM_PREFIX, \"\")));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "3497a1129e78ecbea223ed579f631d116036eabd"}, "originalPosition": 47}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NTQ1Mzk3NA==", "bodyText": "This only resets the timer if a config update was actually performed. However the goal of the timer was to minimise work on a per-event bais. This prevents that because the timer will almost never be not expired if the config updates rarely.", "url": "https://github.com/pravega/pravega/pull/5439#discussion_r545453974", "createdAt": "2020-12-17T22:48:17Z", "author": {"login": "tkaitchuck"}, "path": "client/src/main/java/io/pravega/client/stream/impl/ReaderGroupStateManager.java", "diffHunk": "@@ -330,6 +337,21 @@ private void fetchUpdatesIfNeeded() {\n             compactIfNeeded();\n         }\n     }\n+\n+    void updateConfigIfNeeded() {\n+        sync.fetchUpdates();\n+        ReaderGroupState state = sync.getState();\n+        if (!updateConfigTimer.hasRemaining() && state.isUpdatingConfig()) {\n+            log.debug(\"Update the group config\");\n+            ReaderGroupConfig controllerConfig = getThrowingException(controller.getReaderGroupConfig(sync.getSynchronizerScopeName(),\n+                    sync.getSynchronizerStreamName().replace(READER_GROUP_STREAM_PREFIX, \"\")));\n+            if (state.getConfig().getGeneration() < controllerConfig.getGeneration()) {\n+                Map<SegmentWithRange, Long> segments = getSegmentsForStreams(controller, controllerConfig);\n+                sync.updateStateUnconditionally(new ReaderGroupState.ReaderGroupStateInit(controllerConfig, segments, getEndSegmentsForStreams(controllerConfig), false));\n+            }\n+            updateConfigTimer.reset(UPDATE_CONFIG_WINDOW);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "3497a1129e78ecbea223ed579f631d116036eabd"}, "originalPosition": 52}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c8898826ccf48f61eaa560c266e262d0a659f233", "author": {"user": {"login": "anirudhkovuru", "name": null}}, "url": "https://github.com/pravega/pravega/commit/c8898826ccf48f61eaa560c266e262d0a659f233", "committedDate": "2020-12-18T06:26:31Z", "message": "Merge branch 'master' of https://github.com/pravega/pravega into issue-5112-client-changes"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "0b6fb5ec8d2550e19b451f920f48116eea80a1a0", "author": {"user": {"login": "anirudhkovuru", "name": null}}, "url": "https://github.com/pravega/pravega/commit/0b6fb5ec8d2550e19b451f920f48116eea80a1a0", "committedDate": "2020-12-18T06:28:39Z", "message": "Addressing review comments\n\nSigned-off-by: anirudhkovuru <anirudhkovuru@gmail.com>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTU1MjEyNjcw", "url": "https://github.com/pravega/pravega/pull/5439#pullrequestreview-555212670", "createdAt": "2020-12-18T07:04:51Z", "commit": {"oid": "0b6fb5ec8d2550e19b451f920f48116eea80a1a0"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xOFQwNzowNDo1MVrOIIVb6Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xOFQwNzowNDo1MVrOIIVb6Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NTYxMDcyOQ==", "bodyText": "the problem really is \"after\" the call to controller when this code is calling synchronizer.updateState(RGStateInit).\nif RG(b) has already successfully reset, then (a) should not be repeating it, rather exit.\nso instead of blindly resetting here, we should actually check if a reset with our desired generation has already completed or not.. and if not, then we should reset, else exit.", "url": "https://github.com/pravega/pravega/pull/5439#discussion_r545610729", "createdAt": "2020-12-18T07:04:51Z", "author": {"login": "shiveshr"}, "path": "client/src/main/java/io/pravega/client/stream/impl/ReaderGroupImpl.java", "diffHunk": "@@ -200,8 +201,14 @@ private Checkpoint completeCheckpoint(String checkpointName) {\n \n     @Override\n     public void resetReaderGroup(ReaderGroupConfig config) {\n+        synchronizer.updateState((state, updates) -> {\n+            updates.add(new UpdatingConfig(true));\n+        });\n+        getThrowingException(controller.updateReaderGroup(scope, groupName, config));\n         Map<SegmentWithRange, Long> segments = getSegmentsForStreams(controller, config);\n-        synchronizer.updateStateUnconditionally(new ReaderGroupStateInit(config, segments, getEndSegmentsForStreams(config)));\n+        synchronizer.updateState((state, updates) -> {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "0b6fb5ec8d2550e19b451f920f48116eea80a1a0"}, "originalPosition": 18}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ffc367c371844236fd7758f1a017180c57c8d4e9", "author": {"user": {"login": "anirudhkovuru", "name": null}}, "url": "https://github.com/pravega/pravega/commit/ffc367c371844236fd7758f1a017180c57c8d4e9", "committedDate": "2020-12-18T10:36:03Z", "message": "Merge branch 'master' of https://github.com/pravega/pravega into issue-5112-client-changes"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "22a0e9f2f4938f303bcdb3e5fb1d922b72689ce8", "author": {"user": {"login": "anirudhkovuru", "name": null}}, "url": "https://github.com/pravega/pravega/commit/22a0e9f2f4938f303bcdb3e5fb1d922b72689ce8", "committedDate": "2020-12-18T10:37:39Z", "message": "Changes to ReaderGroupImpl\n\nSigned-off-by: anirudhkovuru <anirudhkovuru@gmail.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "dfd9c48a16fead4eb76daa1f402908fc8e13e5bb", "author": {"user": {"login": "anirudhkovuru", "name": null}}, "url": "https://github.com/pravega/pravega/commit/dfd9c48a16fead4eb76daa1f402908fc8e13e5bb", "committedDate": "2020-12-18T13:19:19Z", "message": "Changed tests according to new deleteRG api\n\nSigned-off-by: anirudhkovuru <anirudhkovuru@gmail.com>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTU1ODM3OTU4", "url": "https://github.com/pravega/pravega/pull/5439#pullrequestreview-555837958", "createdAt": "2020-12-18T21:57:34Z", "commit": {"oid": "dfd9c48a16fead4eb76daa1f402908fc8e13e5bb"}, "state": "COMMENTED", "comments": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xOFQyMTo1NzozNVrOIIz6KQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xOFQyMjoxMzowNVrOII0PiA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NjEwOTk5Mw==", "bodyText": "This is a new public facing API and more importantly a whole new concept. How is this different from the group name? Why would a user need to call this method?\nIf it only exists because we need it, it shouldn't go here, but instead on the impl or an internal interface.", "url": "https://github.com/pravega/pravega/pull/5439#discussion_r546109993", "createdAt": "2020-12-18T21:57:35Z", "author": {"login": "tkaitchuck"}, "path": "client/src/main/java/io/pravega/client/stream/ReaderGroup.java", "diffHunk": "@@ -47,7 +48,14 @@\n      * @return Reader group name\n      */\n     String getGroupName();\n-    \n+\n+    /**\n+     * Returns the UUID of the group.\n+     *\n+     * @return Reader group UUID.\n+     */\n+    UUID getGroupId();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "dfd9c48a16fead4eb76daa1f402908fc8e13e5bb"}, "originalPosition": 19}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NjExMTE5Nw==", "bodyText": "Why is this call needed? Can it be combined with the previous one? (IE have it return this value)", "url": "https://github.com/pravega/pravega/pull/5439#discussion_r546111197", "createdAt": "2020-12-18T22:01:02Z", "author": {"login": "tkaitchuck"}, "path": "client/src/main/java/io/pravega/client/stream/impl/ReaderGroupImpl.java", "diffHunk": "@@ -200,8 +208,17 @@ private Checkpoint completeCheckpoint(String checkpointName) {\n \n     @Override\n     public void resetReaderGroup(ReaderGroupConfig config) {\n+        synchronizer.updateState((state, updates) -> {\n+            updates.add(new UpdatingConfig(true));\n+        });\n+        getThrowingException(controller.updateReaderGroup(scope, groupName, config));\n+        ReaderGroupConfig controllerConfig = getThrowingException(controller.getReaderGroupConfig(scope, groupName));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "dfd9c48a16fead4eb76daa1f402908fc8e13e5bb"}, "originalPosition": 37}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NjExMzQzNQ==", "bodyText": "shouldn't it be using controllerConfig here?\nAlso, if so, then a unit test is missing.", "url": "https://github.com/pravega/pravega/pull/5439#discussion_r546113435", "createdAt": "2020-12-18T22:06:45Z", "author": {"login": "tkaitchuck"}, "path": "client/src/main/java/io/pravega/client/stream/impl/ReaderGroupImpl.java", "diffHunk": "@@ -200,8 +208,17 @@ private Checkpoint completeCheckpoint(String checkpointName) {\n \n     @Override\n     public void resetReaderGroup(ReaderGroupConfig config) {\n+        synchronizer.updateState((state, updates) -> {\n+            updates.add(new UpdatingConfig(true));\n+        });\n+        getThrowingException(controller.updateReaderGroup(scope, groupName, config));\n+        ReaderGroupConfig controllerConfig = getThrowingException(controller.getReaderGroupConfig(scope, groupName));\n         Map<SegmentWithRange, Long> segments = getSegmentsForStreams(controller, config);\n-        synchronizer.updateStateUnconditionally(new ReaderGroupStateInit(config, segments, getEndSegmentsForStreams(config)));\n+        synchronizer.updateState((state, updates) -> {\n+            if (state.getConfig().getGeneration() < controllerConfig.getGeneration()) {\n+                new ReaderGroupStateInit(config, segments, getEndSegmentsForStreams(config), false);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "dfd9c48a16fead4eb76daa1f402908fc8e13e5bb"}, "originalPosition": 42}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NjExNTI2MQ==", "bodyText": "Initial config is version 0\nresetReadeGroup(a) - Sets flag to 'true'\na is assigned version 1 by the controller.\nresetReadeGroup(b)\nb is assigned version 2 by the controller.\na unsets the flag and updates the readergroupstate.\nb crashes.\nNow the controller thinks the version is 2 and the config is b. But the group says A and nobody considers the update ongoing.", "url": "https://github.com/pravega/pravega/pull/5439#discussion_r546115261", "createdAt": "2020-12-18T22:12:23Z", "author": {"login": "tkaitchuck"}, "path": "client/src/main/java/io/pravega/client/stream/impl/ReaderGroupImpl.java", "diffHunk": "@@ -200,8 +201,12 @@ private Checkpoint completeCheckpoint(String checkpointName) {\n \n     @Override\n     public void resetReaderGroup(ReaderGroupConfig config) {\n+        synchronizer.updateState((state, updates) -> {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NTQ0Nzc1MQ=="}, "originalCommit": {"oid": "3497a1129e78ecbea223ed579f631d116036eabd"}, "originalPosition": 12}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NjExNTQ2NA==", "bodyText": "If the config generation is older it should still disable the flag.", "url": "https://github.com/pravega/pravega/pull/5439#discussion_r546115464", "createdAt": "2020-12-18T22:13:05Z", "author": {"login": "tkaitchuck"}, "path": "client/src/main/java/io/pravega/client/stream/impl/ReaderGroupImpl.java", "diffHunk": "@@ -200,8 +208,17 @@ private Checkpoint completeCheckpoint(String checkpointName) {\n \n     @Override\n     public void resetReaderGroup(ReaderGroupConfig config) {\n+        synchronizer.updateState((state, updates) -> {\n+            updates.add(new UpdatingConfig(true));\n+        });\n+        getThrowingException(controller.updateReaderGroup(scope, groupName, config));\n+        ReaderGroupConfig controllerConfig = getThrowingException(controller.getReaderGroupConfig(scope, groupName));\n         Map<SegmentWithRange, Long> segments = getSegmentsForStreams(controller, config);\n-        synchronizer.updateStateUnconditionally(new ReaderGroupStateInit(config, segments, getEndSegmentsForStreams(config)));\n+        synchronizer.updateState((state, updates) -> {\n+            if (state.getConfig().getGeneration() < controllerConfig.getGeneration()) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "dfd9c48a16fead4eb76daa1f402908fc8e13e5bb"}, "originalPosition": 41}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "5f7b01ed99dab341df4d8b193cd8234b6637bd04", "author": {"user": {"login": "anirudhkovuru", "name": null}}, "url": "https://github.com/pravega/pravega/commit/5f7b01ed99dab341df4d8b193cd8234b6637bd04", "committedDate": "2020-12-21T11:26:41Z", "message": "Merge branch 'master' of https://github.com/pravega/pravega into issue-5112-client-changes"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "532d8adb23030f1cfbeebdfa344d6ceded12cdd4", "author": {"user": {"login": "anirudhkovuru", "name": null}}, "url": "https://github.com/pravega/pravega/commit/532d8adb23030f1cfbeebdfa344d6ceded12cdd4", "committedDate": "2020-12-21T11:28:35Z", "message": "Changed resetRG logic, updated tests\n\nSigned-off-by: anirudhkovuru <anirudhkovuru@gmail.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e2616bb70ada068ed51162b4179e404080b274a0", "author": {"user": {"login": "anirudhkovuru", "name": null}}, "url": "https://github.com/pravega/pravega/commit/e2616bb70ada068ed51162b4179e404080b274a0", "committedDate": "2020-12-21T12:55:34Z", "message": "Tweaks to ReaderGroupImplTest\n\nSigned-off-by: anirudhkovuru <anirudhkovuru@gmail.com>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTU2ODYzNTgz", "url": "https://github.com/pravega/pravega/pull/5439#pullrequestreview-556863583", "createdAt": "2020-12-22T07:11:03Z", "commit": {"oid": "e2616bb70ada068ed51162b4179e404080b274a0"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "1220ea8cf59f6d3077711ba4c0f658d8e9b07393", "author": {"user": {"login": "anirudhkovuru", "name": null}}, "url": "https://github.com/pravega/pravega/commit/1220ea8cf59f6d3077711ba4c0f658d8e9b07393", "committedDate": "2020-12-22T07:34:28Z", "message": "Merge branch 'master' of https://github.com/pravega/pravega into issue-5112-client-changes"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "50cc856212b3aebed41879a344ec861ce949ace5", "author": {"user": {"login": "anirudhkovuru", "name": null}}, "url": "https://github.com/pravega/pravega/commit/50cc856212b3aebed41879a344ec861ce949ace5", "committedDate": "2020-12-22T07:36:42Z", "message": "Tweaks to ReaderGroupStateManager\n\nSigned-off-by: anirudhkovuru <anirudhkovuru@gmail.com>"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "0b7d8212b8ca2c42291674583981d750b1fcc497", "author": {"user": {"login": "shiveshr", "name": "shivesh ranjan"}}, "url": "https://github.com/pravega/pravega/commit/0b7d8212b8ca2c42291674583981d750b1fcc497", "committedDate": "2020-12-22T07:11:12Z", "message": "Merge branch 'master' into issue-5112-client-changes"}, "afterCommit": {"oid": "50cc856212b3aebed41879a344ec861ce949ace5", "author": {"user": {"login": "anirudhkovuru", "name": null}}, "url": "https://github.com/pravega/pravega/commit/50cc856212b3aebed41879a344ec861ce949ace5", "committedDate": "2020-12-22T07:36:42Z", "message": "Tweaks to ReaderGroupStateManager\n\nSigned-off-by: anirudhkovuru <anirudhkovuru@gmail.com>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTYxNDIzMTkw", "url": "https://github.com/pravega/pravega/pull/5439#pullrequestreview-561423190", "createdAt": "2021-01-04T23:36:24Z", "commit": {"oid": "50cc856212b3aebed41879a344ec861ce949ace5"}, "state": "COMMENTED", "comments": {"totalCount": 7, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMS0wNFQyMzozNjoyNFrOIOE7aw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMS0wNFQyMzo0OTo1MlrOIOFQZA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1MTYzMTcyMw==", "bodyText": "This is a public facing object and is immutable. I see no reason to change that.\nhttps://github.com/pravega/pravega/wiki/Contributing#threading", "url": "https://github.com/pravega/pravega/pull/5439#discussion_r551631723", "createdAt": "2021-01-04T23:36:24Z", "author": {"login": "tkaitchuck"}, "path": "client/src/main/java/io/pravega/client/stream/ReaderGroupConfig.java", "diffHunk": "@@ -53,9 +54,11 @@\n \n     private final StreamDataRetention retentionType;\n \n-    private final long generation;\n+    @Setter\n+    private long generation;\n \n-    private final UUID readerGroupId;\n+    @Setter\n+    private UUID readerGroupId;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "50cc856212b3aebed41879a344ec861ce949ace5"}, "originalPosition": 18}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1MTYzNDAxNQ==", "bodyText": "It's strange that this calls fetchUpdates. This is a blocking remote call. This is a getter so it's confusing. It is also not clear when the readerGroupId would change and what consistency is attempting to be enforced by updating first.", "url": "https://github.com/pravega/pravega/pull/5439#discussion_r551634015", "createdAt": "2021-01-04T23:39:51Z", "author": {"login": "tkaitchuck"}, "path": "client/src/main/java/io/pravega/client/stream/impl/ReaderGroupImpl.java", "diffHunk": "@@ -117,6 +119,16 @@ public void updateRetentionStreamCut(Map<Stream, StreamCut> streamCuts) {\n                synchronizer.getState().getConfig().getRetentionType().toString());\n     }\n \n+    public UUID getGroupId() {\n+        synchronizer.fetchUpdates();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "50cc856212b3aebed41879a344ec861ce949ace5"}, "originalPosition": 21}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1MTYzNDA3NQ==", "bodyText": "Same here.", "url": "https://github.com/pravega/pravega/pull/5439#discussion_r551634075", "createdAt": "2021-01-04T23:39:59Z", "author": {"login": "tkaitchuck"}, "path": "client/src/main/java/io/pravega/client/stream/impl/ReaderGroupImpl.java", "diffHunk": "@@ -117,6 +119,16 @@ public void updateRetentionStreamCut(Map<Stream, StreamCut> streamCuts) {\n                synchronizer.getState().getConfig().getRetentionType().toString());\n     }\n \n+    public UUID getGroupId() {\n+        synchronizer.fetchUpdates();\n+        return synchronizer.getState().getConfig().getReaderGroupId();\n+    }\n+\n+    public long getGeneration() {\n+        synchronizer.fetchUpdates();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "50cc856212b3aebed41879a344ec861ce949ace5"}, "originalPosition": 26}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1MTYzNTM1MA==", "bodyText": "You can use a local", "url": "https://github.com/pravega/pravega/pull/5439#discussion_r551635350", "createdAt": "2021-01-04T23:44:15Z", "author": {"login": "tkaitchuck"}, "path": "client/src/main/java/io/pravega/client/stream/impl/ReaderGroupImpl.java", "diffHunk": "@@ -203,8 +215,39 @@ private Checkpoint completeCheckpoint(String checkpointName) {\n \n     @Override\n     public void resetReaderGroup(ReaderGroupConfig config) {\n-        Map<SegmentWithRange, Long> segments = getSegmentsForStreams(controller, config);\n-        synchronizer.updateStateUnconditionally(new ReaderGroupStateInit(config, segments, getEndSegmentsForStreams(config)));\n+        while (true) {\n+            synchronizer.fetchUpdates();\n+            val state = synchronizer.getState();\n+            // We only move into the block if the state transition has happened successfully.\n+            if (stateTransition(state, new UpdatingConfig(true))) {\n+                // Use the latest generation and reader group Id.\n+                config.setGeneration(state.getConfig().getGeneration());\n+                config.setReaderGroupId(state.getConfig().getReaderGroupId());\n+                boolean success = Futures.getThrowingException(controller.updateReaderGroup(scope, groupName, config));\n+                if (success) {\n+                    synchronizer.updateState((s, updates) -> {\n+                        Map<SegmentWithRange, Long> segments = getSegmentsForStreams(controller, config);\n+                        updates.add(new ReaderGroupStateInit(config, segments, getEndSegmentsForStreams(config), false));\n+                    });\n+                    return;\n+                }\n+            }\n+        }\n+    }\n+\n+    private boolean stateTransition(ReaderGroupState state, ReaderGroupState.ReaderGroupStateUpdate update) {\n+        // This boolean will help know if the update actually succeeds or not.\n+        AtomicBoolean successfullyUpdated = new AtomicBoolean(true);\n+        synchronizer.updateState((s, updates) -> {\n+            // If successfullyUpdated is false then that means the current state where this update should\n+            // take place (i.e. state with updatingConfig as false) is not the state we are in so we do not\n+            // make the update.\n+            successfullyUpdated.set(s.getConfig().equals(state.getConfig()));\n+            if (successfullyUpdated.get()) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "50cc856212b3aebed41879a344ec861ce949ace5"}, "originalPosition": 67}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1MTYzNTYyNw==", "bodyText": "I think what you want here is a way to create a builder from an existing config.", "url": "https://github.com/pravega/pravega/pull/5439#discussion_r551635627", "createdAt": "2021-01-04T23:45:14Z", "author": {"login": "tkaitchuck"}, "path": "client/src/main/java/io/pravega/client/stream/impl/ReaderGroupImpl.java", "diffHunk": "@@ -203,8 +215,39 @@ private Checkpoint completeCheckpoint(String checkpointName) {\n \n     @Override\n     public void resetReaderGroup(ReaderGroupConfig config) {\n-        Map<SegmentWithRange, Long> segments = getSegmentsForStreams(controller, config);\n-        synchronizer.updateStateUnconditionally(new ReaderGroupStateInit(config, segments, getEndSegmentsForStreams(config)));\n+        while (true) {\n+            synchronizer.fetchUpdates();\n+            val state = synchronizer.getState();\n+            // We only move into the block if the state transition has happened successfully.\n+            if (stateTransition(state, new UpdatingConfig(true))) {\n+                // Use the latest generation and reader group Id.\n+                config.setGeneration(state.getConfig().getGeneration());\n+                config.setReaderGroupId(state.getConfig().getReaderGroupId());", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "50cc856212b3aebed41879a344ec861ce949ace5"}, "originalPosition": 46}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1MTYzNzAzMA==", "bodyText": "This is making multiple calls to the controller inside of the updateState function. This doesn't work well for optimistic concurrency. Perhaps most this outside of the update state, and just rely on the if to make the update conditional on the config not having changed.", "url": "https://github.com/pravega/pravega/pull/5439#discussion_r551637030", "createdAt": "2021-01-04T23:49:39Z", "author": {"login": "tkaitchuck"}, "path": "client/src/main/java/io/pravega/client/stream/impl/ReaderGroupStateManager.java", "diffHunk": "@@ -330,6 +342,24 @@ private void fetchUpdatesIfNeeded() {\n             compactIfNeeded();\n         }\n     }\n+\n+    void updateConfigIfNeeded() {\n+        if (!updateConfigTimer.hasRemaining()) {\n+            fetchUpdatesIfNeeded();\n+            ReaderGroupState state = sync.getState();\n+            if (state.isUpdatingConfig()) {\n+                sync.updateState((s, updates) -> {\n+                    ReaderGroupConfig controllerConfig = getThrowingException(controller.getReaderGroupConfig(scope, groupName));\n+                    log.debug(\"Updating the readergroup {} with the new config {} obtained from the controller\", groupName, controllerConfig);\n+                    if (s.getConfig().getGeneration() < controllerConfig.getGeneration()) {\n+                        Map<SegmentWithRange, Long> segments = getSegmentsForStreams(controller, controllerConfig);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "50cc856212b3aebed41879a344ec861ce949ace5"}, "originalPosition": 68}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1MTYzNzA5Mg==", "bodyText": "Same here. (see below)", "url": "https://github.com/pravega/pravega/pull/5439#discussion_r551637092", "createdAt": "2021-01-04T23:49:52Z", "author": {"login": "tkaitchuck"}, "path": "client/src/main/java/io/pravega/client/stream/impl/ReaderGroupStateManager.java", "diffHunk": "@@ -330,6 +342,24 @@ private void fetchUpdatesIfNeeded() {\n             compactIfNeeded();\n         }\n     }\n+\n+    void updateConfigIfNeeded() {\n+        if (!updateConfigTimer.hasRemaining()) {\n+            fetchUpdatesIfNeeded();\n+            ReaderGroupState state = sync.getState();\n+            if (state.isUpdatingConfig()) {\n+                sync.updateState((s, updates) -> {\n+                    ReaderGroupConfig controllerConfig = getThrowingException(controller.getReaderGroupConfig(scope, groupName));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "50cc856212b3aebed41879a344ec861ce949ace5"}, "originalPosition": 65}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "7648619ce03d0e5c23c56aca77514f3ec7bf7c25", "author": {"user": {"login": "anirudhkovuru", "name": null}}, "url": "https://github.com/pravega/pravega/commit/7648619ce03d0e5c23c56aca77514f3ec7bf7c25", "committedDate": "2021-01-05T09:41:30Z", "message": "Added MockController calls, addressed a few comments\n\nSigned-off-by: anirudhkovuru <anirudhkovuru@gmail.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "46349ae822822ec180c3994a8d30ba6efba04836", "author": {"user": {"login": "anirudhkovuru", "name": null}}, "url": "https://github.com/pravega/pravega/commit/46349ae822822ec180c3994a8d30ba6efba04836", "committedDate": "2021-01-06T05:14:21Z", "message": "Addressing comments\n\nSigned-off-by: anirudhkovuru <anirudhkovuru@gmail.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e6f26b4c15f0a47482ae815222734bc06f5cf0ff", "author": {"user": {"login": "anirudhkovuru", "name": null}}, "url": "https://github.com/pravega/pravega/commit/e6f26b4c15f0a47482ae815222734bc06f5cf0ff", "committedDate": "2021-01-06T05:56:45Z", "message": "Merge branch 'master' of https://github.com/pravega/pravega into issue-5112-client-changes"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c4c85c732154321d1e598018f6ba4c5de1ee727b", "author": {"user": {"login": "anirudhkovuru", "name": null}}, "url": "https://github.com/pravega/pravega/commit/c4c85c732154321d1e598018f6ba4c5de1ee727b", "committedDate": "2021-01-06T09:42:37Z", "message": "Tweaked getGroupId\n\nSigned-off-by: anirudhkovuru <anirudhkovuru@gmail.com>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTYzMDg1NTA3", "url": "https://github.com/pravega/pravega/pull/5439#pullrequestreview-563085507", "createdAt": "2021-01-06T22:38:39Z", "commit": {"oid": "c4c85c732154321d1e598018f6ba4c5de1ee727b"}, "state": "COMMENTED", "comments": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMS0wNlQyMjozODo0MFrOIPYclw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMS0wNlQyMjo1MDo0NlrOIPYsTA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1MzAwMDA4Nw==", "bodyText": "State is only used for config. So make the parameter 'config' instead. This would also minorly simplify the caller.", "url": "https://github.com/pravega/pravega/pull/5439#discussion_r553000087", "createdAt": "2021-01-06T22:38:40Z", "author": {"login": "tkaitchuck"}, "path": "client/src/main/java/io/pravega/client/stream/impl/ReaderGroupImpl.java", "diffHunk": "@@ -203,8 +214,41 @@ private Checkpoint completeCheckpoint(String checkpointName) {\n \n     @Override\n     public void resetReaderGroup(ReaderGroupConfig config) {\n-        Map<SegmentWithRange, Long> segments = getSegmentsForStreams(controller, config);\n-        synchronizer.updateStateUnconditionally(new ReaderGroupStateInit(config, segments, getEndSegmentsForStreams(config)));\n+        while (true) {\n+            synchronizer.fetchUpdates();\n+            val state = synchronizer.getState();\n+            // We only move into the block if the state transition has happened successfully.\n+            if (stateTransition(state, new UpdatingConfig(true))) {\n+                // Use the latest generation and reader group Id.\n+                ReaderGroupConfig newConfig = config.toBuilder()\n+                        .readerGroupId(state.getConfig().getReaderGroupId())\n+                        .generation(state.getConfig().getGeneration()).build();\n+                boolean success = Futures.getThrowingException(controller.updateReaderGroup(scope, groupName, newConfig));\n+                if (success) {\n+                    synchronizer.updateState((s, updates) -> {\n+                        Map<SegmentWithRange, Long> segments = getSegmentsForStreams(controller, newConfig);\n+                        updates.add(new ReaderGroupStateInit(config, segments, getEndSegmentsForStreams(newConfig), false));\n+                    });\n+                    return;\n+                }\n+            }\n+        }\n+    }\n+\n+    private boolean stateTransition(ReaderGroupState state, ReaderGroupState.ReaderGroupStateUpdate update) {\n+        // This boolean will help know if the update actually succeeds or not.\n+        AtomicBoolean successfullyUpdated = new AtomicBoolean(true);\n+        synchronizer.updateState((s, updates) -> {\n+            // If successfullyUpdated is false then that means the current state where this update should\n+            // take place (i.e. state with updatingConfig as false) is not the state we are in so we do not\n+            // make the update.\n+            boolean updated = s.getConfig().equals(state.getConfig());", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c4c85c732154321d1e598018f6ba4c5de1ee727b"}, "originalPosition": 66}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1MzAwMDc0Nw==", "bodyText": "The update function in stateTransition will do this.", "url": "https://github.com/pravega/pravega/pull/5439#discussion_r553000747", "createdAt": "2021-01-06T22:40:41Z", "author": {"login": "tkaitchuck"}, "path": "client/src/main/java/io/pravega/client/stream/impl/ReaderGroupImpl.java", "diffHunk": "@@ -203,8 +214,41 @@ private Checkpoint completeCheckpoint(String checkpointName) {\n \n     @Override\n     public void resetReaderGroup(ReaderGroupConfig config) {\n-        Map<SegmentWithRange, Long> segments = getSegmentsForStreams(controller, config);\n-        synchronizer.updateStateUnconditionally(new ReaderGroupStateInit(config, segments, getEndSegmentsForStreams(config)));\n+        while (true) {\n+            synchronizer.fetchUpdates();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c4c85c732154321d1e598018f6ba4c5de1ee727b"}, "originalPosition": 39}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1MzAwMTc1OQ==", "bodyText": "getSegmentsForStreams is making an RPC to the controller. Please move this out of the updateState block.", "url": "https://github.com/pravega/pravega/pull/5439#discussion_r553001759", "createdAt": "2021-01-06T22:43:44Z", "author": {"login": "tkaitchuck"}, "path": "client/src/main/java/io/pravega/client/stream/impl/ReaderGroupImpl.java", "diffHunk": "@@ -203,8 +214,41 @@ private Checkpoint completeCheckpoint(String checkpointName) {\n \n     @Override\n     public void resetReaderGroup(ReaderGroupConfig config) {\n-        Map<SegmentWithRange, Long> segments = getSegmentsForStreams(controller, config);\n-        synchronizer.updateStateUnconditionally(new ReaderGroupStateInit(config, segments, getEndSegmentsForStreams(config)));\n+        while (true) {\n+            synchronizer.fetchUpdates();\n+            val state = synchronizer.getState();\n+            // We only move into the block if the state transition has happened successfully.\n+            if (stateTransition(state, new UpdatingConfig(true))) {\n+                // Use the latest generation and reader group Id.\n+                ReaderGroupConfig newConfig = config.toBuilder()\n+                        .readerGroupId(state.getConfig().getReaderGroupId())\n+                        .generation(state.getConfig().getGeneration()).build();\n+                boolean success = Futures.getThrowingException(controller.updateReaderGroup(scope, groupName, newConfig));\n+                if (success) {\n+                    synchronizer.updateState((s, updates) -> {\n+                        Map<SegmentWithRange, Long> segments = getSegmentsForStreams(controller, newConfig);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c4c85c732154321d1e598018f6ba4c5de1ee727b"}, "originalPosition": 50}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1MzAwMTkxMQ==", "bodyText": "Doesn't the generation need to change somewhere?", "url": "https://github.com/pravega/pravega/pull/5439#discussion_r553001911", "createdAt": "2021-01-06T22:44:09Z", "author": {"login": "tkaitchuck"}, "path": "client/src/main/java/io/pravega/client/stream/impl/ReaderGroupImpl.java", "diffHunk": "@@ -203,8 +214,41 @@ private Checkpoint completeCheckpoint(String checkpointName) {\n \n     @Override\n     public void resetReaderGroup(ReaderGroupConfig config) {\n-        Map<SegmentWithRange, Long> segments = getSegmentsForStreams(controller, config);\n-        synchronizer.updateStateUnconditionally(new ReaderGroupStateInit(config, segments, getEndSegmentsForStreams(config)));\n+        while (true) {\n+            synchronizer.fetchUpdates();\n+            val state = synchronizer.getState();\n+            // We only move into the block if the state transition has happened successfully.\n+            if (stateTransition(state, new UpdatingConfig(true))) {\n+                // Use the latest generation and reader group Id.\n+                ReaderGroupConfig newConfig = config.toBuilder()\n+                        .readerGroupId(state.getConfig().getReaderGroupId())\n+                        .generation(state.getConfig().getGeneration()).build();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c4c85c732154321d1e598018f6ba4c5de1ee727b"}, "originalPosition": 46}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1MzAwNDEwOA==", "bodyText": "For these tests, can we also add an assertion that advancing the reader group will correctly result in data being truncated?", "url": "https://github.com/pravega/pravega/pull/5439#discussion_r553004108", "createdAt": "2021-01-06T22:50:46Z", "author": {"login": "tkaitchuck"}, "path": "test/integration/src/test/java/io/pravega/test/integration/endtoendtest/EndToEndReaderGroupTest.java", "diffHunk": "@@ -153,6 +156,92 @@ public void testDeleteReaderGroup() throws Exception {\n         assertEquals(\"data1\", eventRead.getEvent());\n     }\n \n+    @Test", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c4c85c732154321d1e598018f6ba4c5de1ee727b"}, "originalPosition": 23}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "6d1df2d67b294499e21d6ad2090b985bc0418034", "author": {"user": {"login": "anirudhkovuru", "name": null}}, "url": "https://github.com/pravega/pravega/commit/6d1df2d67b294499e21d6ad2090b985bc0418034", "committedDate": "2021-01-07T06:55:51Z", "message": "Addressing more comments\n\nSigned-off-by: anirudhkovuru <anirudhkovuru@gmail.com>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTYzNDAxMzYx", "url": "https://github.com/pravega/pravega/pull/5439#pullrequestreview-563401361", "createdAt": "2021-01-07T11:08:31Z", "commit": {"oid": "6d1df2d67b294499e21d6ad2090b985bc0418034"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMS0wN1QxMTowODozMlrOIPobwQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMS0wN1QxMToxNzowMFrOIPorGA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1MzI2MjAxNw==", "bodyText": "getSegmentsForStreams  should be inside the if (success) block since it is not needed if controller.updateReaderGroup() has failed.", "url": "https://github.com/pravega/pravega/pull/5439#discussion_r553262017", "createdAt": "2021-01-07T11:08:32Z", "author": {"login": "pbelgundi"}, "path": "client/src/main/java/io/pravega/client/stream/impl/ReaderGroupImpl.java", "diffHunk": "@@ -203,8 +214,41 @@ private Checkpoint completeCheckpoint(String checkpointName) {\n \n     @Override\n     public void resetReaderGroup(ReaderGroupConfig config) {\n-        Map<SegmentWithRange, Long> segments = getSegmentsForStreams(controller, config);\n-        synchronizer.updateStateUnconditionally(new ReaderGroupStateInit(config, segments, getEndSegmentsForStreams(config)));\n+        while (true) {\n+            synchronizer.fetchUpdates();\n+            val currentConfig = synchronizer.getState().getConfig();\n+            // We only move into the block if the state transition has happened successfully.\n+            if (stateTransition(currentConfig, new UpdatingConfig(true))) {\n+                // Use the latest generation and reader group Id.\n+                ReaderGroupConfig newConfig = config.toBuilder()\n+                        .readerGroupId(currentConfig.getReaderGroupId())\n+                        .generation(currentConfig.getGeneration()).build();\n+                boolean success = Futures.getThrowingException(controller.updateReaderGroup(scope, groupName, newConfig));\n+                Map<SegmentWithRange, Long> segments = getSegmentsForStreams(controller, newConfig);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "6d1df2d67b294499e21d6ad2090b985bc0418034"}, "originalPosition": 48}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1MzI2NTk0NA==", "bodyText": "I don't see equals() and hashcode() overridden in ReaderGroupConfig, so this would do a reference comparison. That does not look right to me.", "url": "https://github.com/pravega/pravega/pull/5439#discussion_r553265944", "createdAt": "2021-01-07T11:17:00Z", "author": {"login": "pbelgundi"}, "path": "client/src/main/java/io/pravega/client/stream/impl/ReaderGroupImpl.java", "diffHunk": "@@ -203,8 +214,41 @@ private Checkpoint completeCheckpoint(String checkpointName) {\n \n     @Override\n     public void resetReaderGroup(ReaderGroupConfig config) {\n-        Map<SegmentWithRange, Long> segments = getSegmentsForStreams(controller, config);\n-        synchronizer.updateStateUnconditionally(new ReaderGroupStateInit(config, segments, getEndSegmentsForStreams(config)));\n+        while (true) {\n+            synchronizer.fetchUpdates();\n+            val currentConfig = synchronizer.getState().getConfig();\n+            // We only move into the block if the state transition has happened successfully.\n+            if (stateTransition(currentConfig, new UpdatingConfig(true))) {\n+                // Use the latest generation and reader group Id.\n+                ReaderGroupConfig newConfig = config.toBuilder()\n+                        .readerGroupId(currentConfig.getReaderGroupId())\n+                        .generation(currentConfig.getGeneration()).build();\n+                boolean success = Futures.getThrowingException(controller.updateReaderGroup(scope, groupName, newConfig));\n+                Map<SegmentWithRange, Long> segments = getSegmentsForStreams(controller, newConfig);\n+                if (success) {\n+                    synchronizer.updateState((s, updates) -> {\n+                        updates.add(new ReaderGroupStateInit(config, segments, getEndSegmentsForStreams(newConfig), false));\n+                    });\n+                    return;\n+                }\n+            }\n+        }\n+    }\n+\n+    private boolean stateTransition(ReaderGroupConfig config, ReaderGroupState.ReaderGroupStateUpdate update) {\n+        // This boolean will help know if the update actually succeeds or not.\n+        AtomicBoolean successfullyUpdated = new AtomicBoolean(true);\n+        synchronizer.updateState((state, updates) -> {\n+            // If successfullyUpdated is false then that means the current state where this update should\n+            // take place (i.e. state with updatingConfig as false) is not the state we are in so we do not\n+            // make the update.\n+            boolean updated = state.getConfig().equals(config);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "6d1df2d67b294499e21d6ad2090b985bc0418034"}, "originalPosition": 66}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "3bfb7b5c09a4bc8db223b4df481350235e493218", "author": {"user": {"login": "anirudhkovuru", "name": null}}, "url": "https://github.com/pravega/pravega/commit/3bfb7b5c09a4bc8db223b4df481350235e493218", "committedDate": "2021-01-07T13:13:21Z", "message": "Tweaked getters in ReaderGroup, addressing comments\n\nSigned-off-by: anirudhkovuru <anirudhkovuru@gmail.com>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTYzODE0NDgw", "url": "https://github.com/pravega/pravega/pull/5439#pullrequestreview-563814480", "createdAt": "2021-01-07T20:47:10Z", "commit": {"oid": "3bfb7b5c09a4bc8db223b4df481350235e493218"}, "state": "COMMENTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMS0wN1QyMDo0NzoxMFrOIP7xnA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMS0wOFQwMDozMzoxOVrOIQBdfA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1MzU3ODkwOA==", "bodyText": "This should not be public. The fact that there is a state synchronizer internal to this class should not be known to the caller. Otherwise it violates encapsulation.", "url": "https://github.com/pravega/pravega/pull/5439#discussion_r553578908", "createdAt": "2021-01-07T20:47:10Z", "author": {"login": "tkaitchuck"}, "path": "client/src/main/java/io/pravega/client/stream/impl/ReaderGroupImpl.java", "diffHunk": "@@ -117,6 +119,18 @@ public void updateRetentionStreamCut(Map<Stream, StreamCut> streamCuts) {\n                synchronizer.getState().getConfig().getRetentionType().toString());\n     }\n \n+    public void fetchUpdates() {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "3bfb7b5c09a4bc8db223b4df481350235e493218"}, "originalPosition": 20}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1MzY3MjA2MA==", "bodyText": "This is storing config which was passed as a parameter. It does not appear to have a generation set on it.\nWhat I see happening now is that resetReaderGroup is called with a config provided by the user. Presumably they don't set the generation. (Should that method be private?) So the default value of -1 is passed. The call ends up here and it passes the config into the state init. But in updateConfigIfNeeded it pulls from the controller which updates the generation id every time. So it will always return a new config. Thus we end up reinitializing the group state twice.", "url": "https://github.com/pravega/pravega/pull/5439#discussion_r553672060", "createdAt": "2021-01-08T00:33:19Z", "author": {"login": "tkaitchuck"}, "path": "client/src/main/java/io/pravega/client/stream/impl/ReaderGroupImpl.java", "diffHunk": "@@ -203,8 +217,41 @@ private Checkpoint completeCheckpoint(String checkpointName) {\n \n     @Override\n     public void resetReaderGroup(ReaderGroupConfig config) {\n-        Map<SegmentWithRange, Long> segments = getSegmentsForStreams(controller, config);\n-        synchronizer.updateStateUnconditionally(new ReaderGroupStateInit(config, segments, getEndSegmentsForStreams(config)));\n+        while (true) {\n+            synchronizer.fetchUpdates();\n+            val currentConfig = synchronizer.getState().getConfig();\n+            // We only move into the block if the state transition has happened successfully.\n+            if (stateTransition(currentConfig, new UpdatingConfig(true))) {\n+                // Use the latest generation and reader group Id.\n+                ReaderGroupConfig newConfig = config.toBuilder()\n+                        .readerGroupId(currentConfig.getReaderGroupId())\n+                        .generation(currentConfig.getGeneration()).build();\n+                boolean success = Futures.getThrowingException(controller.updateReaderGroup(scope, groupName, newConfig));\n+                if (success) {\n+                    Map<SegmentWithRange, Long> segments = getSegmentsForStreams(controller, newConfig);\n+                    synchronizer.updateState((s, updates) -> {\n+                        updates.add(new ReaderGroupStateInit(config, segments, getEndSegmentsForStreams(newConfig), false));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "3bfb7b5c09a4bc8db223b4df481350235e493218"}, "originalPosition": 54}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ccd92d91779ffa2c8f3c688ba3e3048bdf19000f", "author": {"user": {"login": "anirudhkovuru", "name": null}}, "url": "https://github.com/pravega/pravega/commit/ccd92d91779ffa2c8f3c688ba3e3048bdf19000f", "committedDate": "2021-01-08T06:57:49Z", "message": "Merging master, addressing comments\n\nSigned-off-by: anirudhkovuru <anirudhkovuru@gmail.com>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTY0Mzg5NDE5", "url": "https://github.com/pravega/pravega/pull/5439#pullrequestreview-564389419", "createdAt": "2021-01-08T16:17:28Z", "commit": {"oid": "ccd92d91779ffa2c8f3c688ba3e3048bdf19000f"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTY0NjgzMTk4", "url": "https://github.com/pravega/pravega/pull/5439#pullrequestreview-564683198", "createdAt": "2021-01-09T04:25:27Z", "commit": {"oid": "ccd92d91779ffa2c8f3c688ba3e3048bdf19000f"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMS0wOVQwNDoyNToyOFrOIQnHhA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMS0wOVQwNDoyNToyOFrOIQnHhA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1NDI4OTAyOA==", "bodyText": "controller.updateReaderGroup now returns the updated generation( See PR: #5462), which should be written to StateSynchronizer, but I don't see that happening here.", "url": "https://github.com/pravega/pravega/pull/5439#discussion_r554289028", "createdAt": "2021-01-09T04:25:28Z", "author": {"login": "pbelgundi"}, "path": "client/src/main/java/io/pravega/client/stream/impl/ReaderGroupImpl.java", "diffHunk": "@@ -203,8 +217,41 @@ private Checkpoint completeCheckpoint(String checkpointName) {\n \n     @Override\n     public void resetReaderGroup(ReaderGroupConfig config) {\n-        Map<SegmentWithRange, Long> segments = getSegmentsForStreams(controller, config);\n-        synchronizer.updateStateUnconditionally(new ReaderGroupStateInit(config, segments, getEndSegmentsForStreams(config)));\n+        while (true) {\n+            synchronizer.fetchUpdates();\n+            val currentConfig = synchronizer.getState().getConfig();\n+            // We only move into the block if the state transition has happened successfully.\n+            if (stateTransition(currentConfig, new UpdatingConfig(true))) {\n+                // Use the latest generation and reader group Id.\n+                ReaderGroupConfig newConfig = config.toBuilder()\n+                        .readerGroupId(currentConfig.getReaderGroupId())\n+                        .generation(currentConfig.getGeneration()).build();\n+                boolean success = Futures.getThrowingException(controller.updateReaderGroup(scope, groupName, newConfig));\n+                if (success) {\n+                    Map<SegmentWithRange, Long> segments = getSegmentsForStreams(controller, newConfig);\n+                    synchronizer.updateState((s, updates) -> {\n+                        updates.add(new ReaderGroupStateInit(config, segments, getEndSegmentsForStreams(newConfig), false));", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1MzY3MjA2MA=="}, "originalCommit": {"oid": "3bfb7b5c09a4bc8db223b4df481350235e493218"}, "originalPosition": 54}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "7a24e92e8b366483cb24051ab7a3514e15278b21", "author": {"user": {"login": "anirudhkovuru", "name": null}}, "url": "https://github.com/pravega/pravega/commit/7a24e92e8b366483cb24051ab7a3514e15278b21", "committedDate": "2021-01-09T07:18:52Z", "message": "Tweaked a few tests\n\nSigned-off-by: anirudhkovuru <anirudhkovuru@gmail.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e17d2bc6cc404b0e05e16270d6e3cd8ebb060392", "author": {"user": {"login": "anirudhkovuru", "name": null}}, "url": "https://github.com/pravega/pravega/commit/e17d2bc6cc404b0e05e16270d6e3cd8ebb060392", "committedDate": "2021-01-09T07:19:43Z", "message": "Merge branch 'master' of https://github.com/pravega/pravega into issue-5112-client-changes"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "cc8fdd75dd68b8cb7894df1fbb2f707c9d6e8788", "author": {"user": {"login": "anirudhkovuru", "name": null}}, "url": "https://github.com/pravega/pravega/commit/cc8fdd75dd68b8cb7894df1fbb2f707c9d6e8788", "committedDate": "2021-01-09T17:33:33Z", "message": "made updateReaderGroup return generation\n\nSigned-off-by: anirudhkovuru <anirudhkovuru@gmail.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "483bb69aa7b4712b742539d95cb81eeade423e41", "author": {"user": {"login": "anirudhkovuru", "name": null}}, "url": "https://github.com/pravega/pravega/commit/483bb69aa7b4712b742539d95cb81eeade423e41", "committedDate": "2021-01-09T17:53:55Z", "message": "Fixed ControllerServiceTest\n\nSigned-off-by: anirudhkovuru <anirudhkovuru@gmail.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "9101165429b062d8d8fbaf6bf8ab121ed2a3eb24", "author": {"user": {"login": "anirudhkovuru", "name": null}}, "url": "https://github.com/pravega/pravega/commit/9101165429b062d8d8fbaf6bf8ab121ed2a3eb24", "committedDate": "2021-01-09T17:54:47Z", "message": "Merge branch 'master' of https://github.com/pravega/pravega into issue-5112-client-changes"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b080e116e66b2cc5c5a6e01802af0f7e56457ff8", "author": {"user": {"login": "anirudhkovuru", "name": null}}, "url": "https://github.com/pravega/pravega/commit/b080e116e66b2cc5c5a6e01802af0f7e56457ff8", "committedDate": "2021-01-10T07:23:10Z", "message": "Merge branch 'master' of https://github.com/pravega/pravega into issue-5112-client-changes"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTY0ODU5NTc4", "url": "https://github.com/pravega/pravega/pull/5439#pullrequestreview-564859578", "createdAt": "2021-01-10T12:34:50Z", "commit": {"oid": "b080e116e66b2cc5c5a6e01802af0f7e56457ff8"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "00a655d3dab31bd219c2e117c7f0e36b5b11f0b5", "author": {"user": {"login": "anirudhkovuru", "name": null}}, "url": "https://github.com/pravega/pravega/commit/00a655d3dab31bd219c2e117c7f0e36b5b11f0b5", "committedDate": "2021-01-10T14:45:26Z", "message": "Tweaked deleteReaderGroup\n\nSigned-off-by: anirudhkovuru <anirudhkovuru@gmail.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "7cf326a15e459236d5c0db0313c0b84e757cf640", "author": {"user": {"login": "anirudhkovuru", "name": null}}, "url": "https://github.com/pravega/pravega/commit/7cf326a15e459236d5c0db0313c0b84e757cf640", "committedDate": "2021-01-11T13:00:31Z", "message": "Merge branch 'master' of https://github.com/pravega/pravega into issue-5112-client-changes"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTY1NjA3MjU2", "url": "https://github.com/pravega/pravega/pull/5439#pullrequestreview-565607256", "createdAt": "2021-01-11T18:00:36Z", "commit": {"oid": "7cf326a15e459236d5c0db0313c0b84e757cf640"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMS0xMVQxODowMDozNlrOIRhCRw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMS0xMVQxODowMDozNlrOIRhCRw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1NTIzNzk1OQ==", "bodyText": "Javadoc needs to be updated.", "url": "https://github.com/pravega/pravega/pull/5439#discussion_r555237959", "createdAt": "2021-01-11T18:00:36Z", "author": {"login": "tkaitchuck"}, "path": "client/src/main/java/io/pravega/client/control/impl/Controller.java", "diffHunk": "@@ -141,7 +141,7 @@\n      * @return A future which will throw if the operation fails, otherwise returning a boolean to\n      *         indicate that the subscriber was updated in Stream Metadata.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "7cf326a15e459236d5c0db0313c0b84e757cf640"}, "originalPosition": 2}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "50df6c1e6972ced87a909a341c8a08d3eae9da83", "author": {"user": {"login": "anirudhkovuru", "name": null}}, "url": "https://github.com/pravega/pravega/commit/50df6c1e6972ced87a909a341c8a08d3eae9da83", "committedDate": "2021-01-13T04:22:29Z", "message": "Added javadoc\n\nSigned-off-by: anirudhkovuru <anirudhkovuru@gmail.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "14832702c639564181476ed855ebb8817078667a", "author": {"user": {"login": "anirudhkovuru", "name": null}}, "url": "https://github.com/pravega/pravega/commit/14832702c639564181476ed855ebb8817078667a", "committedDate": "2021-01-13T04:23:50Z", "message": "Merge branch 'master' of https://github.com/pravega/pravega into issue-5112-client-changes"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "79fac3c59772df130b2a6c9030abe1e92f27fe69", "author": {"user": {"login": "tkaitchuck", "name": "Tom Kaitchuck"}}, "url": "https://github.com/pravega/pravega/commit/79fac3c59772df130b2a6c9030abe1e92f27fe69", "committedDate": "2021-01-12T00:45:47Z", "message": "Merge branch 'master' into issue-5112-client-changes"}, "afterCommit": {"oid": "14832702c639564181476ed855ebb8817078667a", "author": {"user": {"login": "anirudhkovuru", "name": null}}, "url": "https://github.com/pravega/pravega/commit/14832702c639564181476ed855ebb8817078667a", "committedDate": "2021-01-13T04:23:50Z", "message": "Merge branch 'master' of https://github.com/pravega/pravega into issue-5112-client-changes"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ea1e2d5f5074f62d593023b6637b4affd5ef3e9b", "author": {"user": {"login": "anirudhkovuru", "name": null}}, "url": "https://github.com/pravega/pravega/commit/ea1e2d5f5074f62d593023b6637b4affd5ef3e9b", "committedDate": "2021-01-13T11:58:31Z", "message": "Adding tests\n\nSigned-off-by: anirudhkovuru <anirudhkovuru@gmail.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b0e650fe0d64472252bb2151adf0220477352c34", "author": {"user": {"login": "anirudhkovuru", "name": null}}, "url": "https://github.com/pravega/pravega/commit/b0e650fe0d64472252bb2151adf0220477352c34", "committedDate": "2021-01-13T14:40:52Z", "message": "Cleaned up tests\n\nSigned-off-by: anirudhkovuru <anirudhkovuru@gmail.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "3129127dce69ea15abeed06aba015dd3fe3088cb", "author": {"user": {"login": "anirudhkovuru", "name": null}}, "url": "https://github.com/pravega/pravega/commit/3129127dce69ea15abeed06aba015dd3fe3088cb", "committedDate": "2021-01-13T16:26:11Z", "message": "Added tests\n\nSigned-off-by: anirudhkovuru <anirudhkovuru@gmail.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "2a27b131b71db24f898bc259493e4f486a94e859", "author": {"user": {"login": "anirudhkovuru", "name": null}}, "url": "https://github.com/pravega/pravega/commit/2a27b131b71db24f898bc259493e4f486a94e859", "committedDate": "2021-01-13T16:27:11Z", "message": "checkstyle\n\nSigned-off-by: anirudhkovuru <anirudhkovuru@gmail.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "1790322900289a75fff3adf7529e60a8ffee225f", "author": {"user": {"login": "anirudhkovuru", "name": null}}, "url": "https://github.com/pravega/pravega/commit/1790322900289a75fff3adf7529e60a8ffee225f", "committedDate": "2021-01-13T16:29:13Z", "message": "cleaning up test\n\nSigned-off-by: anirudhkovuru <anirudhkovuru@gmail.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d91ce38561b7094189e0d6a01af4847d4caf7874", "author": {"user": {"login": "anirudhkovuru", "name": null}}, "url": "https://github.com/pravega/pravega/commit/d91ce38561b7094189e0d6a01af4847d4caf7874", "committedDate": "2021-01-13T17:12:43Z", "message": "Fixed client test\n\nSigned-off-by: anirudhkovuru <anirudhkovuru@gmail.com>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTY3NjAwOTg0", "url": "https://github.com/pravega/pravega/pull/5439#pullrequestreview-567600984", "createdAt": "2021-01-13T20:41:25Z", "commit": {"oid": "1790322900289a75fff3adf7529e60a8ffee225f"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ff8455ada61bc59a26f3a49d0117719318b5a84d", "author": {"user": {"login": "anirudhkovuru", "name": null}}, "url": "https://github.com/pravega/pravega/commit/ff8455ada61bc59a26f3a49d0117719318b5a84d", "committedDate": "2021-01-14T09:57:20Z", "message": "Merge branch 'master' of https://github.com/pravega/pravega into issue-5112-client-changes"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ad89a80056a09d3a01e4d56c322603137dc5dbd8", "author": {"user": {"login": "anirudhkovuru", "name": null}}, "url": "https://github.com/pravega/pravega/commit/ad89a80056a09d3a01e4d56c322603137dc5dbd8", "committedDate": "2021-01-14T10:44:40Z", "message": "Fixing unreliable test\n\nSigned-off-by: anirudhkovuru <anirudhkovuru@gmail.com>"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "d336cae29770ca88a9c6ca08c956889d9af82ab1", "author": {"user": {"login": "tkaitchuck", "name": "Tom Kaitchuck"}}, "url": "https://github.com/pravega/pravega/commit/d336cae29770ca88a9c6ca08c956889d9af82ab1", "committedDate": "2021-01-13T20:41:35Z", "message": "Merge branch 'master' into issue-5112-client-changes"}, "afterCommit": {"oid": "ad89a80056a09d3a01e4d56c322603137dc5dbd8", "author": {"user": {"login": "anirudhkovuru", "name": null}}, "url": "https://github.com/pravega/pravega/commit/ad89a80056a09d3a01e4d56c322603137dc5dbd8", "committedDate": "2021-01-14T10:44:40Z", "message": "Fixing unreliable test\n\nSigned-off-by: anirudhkovuru <anirudhkovuru@gmail.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "51ea8824e360b655d88d72712754ce26d2b4b409", "author": {"user": {"login": "anirudhkovuru", "name": null}}, "url": "https://github.com/pravega/pravega/commit/51ea8824e360b655d88d72712754ce26d2b4b409", "committedDate": "2021-01-14T13:13:56Z", "message": "Finding test coverage\n\nSigned-off-by: anirudhkovuru <anirudhkovuru@gmail.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "805152550379059c62b1a10cac7a4ece794f867e", "author": {"user": {"login": "anirudhkovuru", "name": null}}, "url": "https://github.com/pravega/pravega/commit/805152550379059c62b1a10cac7a4ece794f867e", "committedDate": "2021-01-14T13:14:47Z", "message": "Merge branch 'master' of https://github.com/pravega/pravega into issue-5112-client-changes"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "589dab7676bd351eaf647d603a8e7013bce39e3e", "author": {"user": {"login": "anirudhkovuru", "name": null}}, "url": "https://github.com/pravega/pravega/commit/589dab7676bd351eaf647d603a8e7013bce39e3e", "committedDate": "2021-01-14T15:05:27Z", "message": "Green build for coverage info\n\nSigned-off-by: anirudhkovuru <anirudhkovuru@gmail.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "1b23651515fe85dd0294ec7c90122713b56d2cb8", "author": {"user": {"login": "anirudhkovuru", "name": null}}, "url": "https://github.com/pravega/pravega/commit/1b23651515fe85dd0294ec7c90122713b56d2cb8", "committedDate": "2021-01-15T06:32:59Z", "message": "Adding tests for coverage\n\nSigned-off-by: anirudhkovuru <anirudhkovuru@gmail.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "6837766cbaacd64b648c4540b28db101715ea6eb", "author": {"user": {"login": "anirudhkovuru", "name": null}}, "url": "https://github.com/pravega/pravega/commit/6837766cbaacd64b648c4540b28db101715ea6eb", "committedDate": "2021-01-15T06:37:10Z", "message": "Resolving merge conflict\n\nSigned-off-by: anirudhkovuru <anirudhkovuru@gmail.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "fb2a28ec45e5519cc4fbf1d440103b3465482ad5", "author": {"user": {"login": "anirudhkovuru", "name": null}}, "url": "https://github.com/pravega/pravega/commit/fb2a28ec45e5519cc4fbf1d440103b3465482ad5", "committedDate": "2021-01-15T06:55:27Z", "message": "Fixed checkstyle\n\nSigned-off-by: anirudhkovuru <anirudhkovuru@gmail.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "7c5f153b31b495fd529cb4d61b5d567de30d2993", "author": {"user": {"login": "anirudhkovuru", "name": null}}, "url": "https://github.com/pravega/pravega/commit/7c5f153b31b495fd529cb4d61b5d567de30d2993", "committedDate": "2021-01-15T12:28:31Z", "message": "Removing ignore annotation\n\nSigned-off-by: anirudhkovuru <anirudhkovuru@gmail.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e580bf5a66386532be0bb5a6baeb0bd4c09b31f2", "author": {"user": {"login": "anirudhkovuru", "name": null}}, "url": "https://github.com/pravega/pravega/commit/e580bf5a66386532be0bb5a6baeb0bd4c09b31f2", "committedDate": "2021-01-15T12:28:39Z", "message": "Merge branch 'master' of https://github.com/pravega/pravega into issue-5112-client-changes"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ea227f4011d4ae41e079529e872f2d553f3fb517", "author": {"user": {"login": "anirudhkovuru", "name": null}}, "url": "https://github.com/pravega/pravega/commit/ea227f4011d4ae41e079529e872f2d553f3fb517", "committedDate": "2021-01-15T13:39:52Z", "message": "Merge branch 'master' of https://github.com/pravega/pravega into issue-5112-client-changes"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d317a8695f8275e7fed5a268169bdea6f0bd1d88", "author": {"user": {"login": "anirudhkovuru", "name": null}}, "url": "https://github.com/pravega/pravega/commit/d317a8695f8275e7fed5a268169bdea6f0bd1d88", "committedDate": "2021-01-15T13:54:05Z", "message": "Fix checkstyle\n\nSigned-off-by: anirudhkovuru <anirudhkovuru@gmail.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e3c2303c55eb96d75a36af00f47e8272c621cb9f", "author": {"user": {"login": "anirudhkovuru", "name": null}}, "url": "https://github.com/pravega/pravega/commit/e3c2303c55eb96d75a36af00f47e8272c621cb9f", "committedDate": "2021-01-17T14:34:14Z", "message": "Merge branch 'master' of https://github.com/pravega/pravega into issue-5112-client-changes"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "319cb19ed2280f68f1bc4c161d7245f70a59c3c0", "author": {"user": {"login": "anirudhkovuru", "name": null}}, "url": "https://github.com/pravega/pravega/commit/319cb19ed2280f68f1bc4c161d7245f70a59c3c0", "committedDate": "2021-01-18T12:21:44Z", "message": "Merge branch 'master' of https://github.com/pravega/pravega into issue-5112-client-changes"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "4ecd6d4805c500bce435d1d03caf15249a585e20", "author": {"user": {"login": "pbelgundi", "name": "Prajakta Belgundi"}}, "url": "https://github.com/pravega/pravega/commit/4ecd6d4805c500bce435d1d03caf15249a585e20", "committedDate": "2021-01-18T16:43:15Z", "message": "test fix\n\nSigned-off-by: pbelgundi <prajakta.belgundi@emc.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "85371e290c3a8341f4298de6ad366f494256d260", "author": {"user": {"login": "pbelgundi", "name": "Prajakta Belgundi"}}, "url": "https://github.com/pravega/pravega/commit/85371e290c3a8341f4298de6ad366f494256d260", "committedDate": "2021-01-19T04:36:49Z", "message": "fix for issue\n\nSigned-off-by: pbelgundi <prajakta.belgundi@emc.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "56f0f97dc31e8ce95758042e4f62aab648c9f508", "author": {"user": {"login": "pbelgundi", "name": "Prajakta Belgundi"}}, "url": "https://github.com/pravega/pravega/commit/56f0f97dc31e8ce95758042e4f62aab648c9f508", "committedDate": "2021-01-19T04:37:22Z", "message": "Merge remote-tracking branch 'upstream/master' into issue-5543-flaky-metrics"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "05d7751d45fab6780d8cf45fb813f9f8b176def4", "author": {"user": {"login": "pbelgundi", "name": "Prajakta Belgundi"}}, "url": "https://github.com/pravega/pravega/commit/05d7751d45fab6780d8cf45fb813f9f8b176def4", "committedDate": "2021-01-19T05:04:54Z", "message": "fixed issue with updateSubscriberStreamCut metrics\n\nSigned-off-by: pbelgundi <prajakta.belgundi@emc.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b92cec394a51a556d5fa2f04673db53c1f341481", "author": {"user": {"login": "pbelgundi", "name": "Prajakta Belgundi"}}, "url": "https://github.com/pravega/pravega/commit/b92cec394a51a556d5fa2f04673db53c1f341481", "committedDate": "2021-01-19T05:19:18Z", "message": "fixed code comments\n\nSigned-off-by: pbelgundi <prajakta.belgundi@emc.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c081b2b257ac106bf14aaa241d5341e5d815e86a", "author": {"user": {"login": "pbelgundi", "name": "Prajakta Belgundi"}}, "url": "https://github.com/pravega/pravega/commit/c081b2b257ac106bf14aaa241d5341e5d815e86a", "committedDate": "2021-01-19T05:28:03Z", "message": "checkstyle fixes\n\nSigned-off-by: pbelgundi <prajakta.belgundi@emc.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "40a340ced4f55ca3b84e52551c9a95a01a6c69a3", "author": {"user": {"login": "anirudhkovuru", "name": null}}, "url": "https://github.com/pravega/pravega/commit/40a340ced4f55ca3b84e52551c9a95a01a6c69a3", "committedDate": "2021-01-19T07:12:09Z", "message": "Merge branch 'issue-5543-flaky-metrics' of https://github.com/pbelgundi/pravega into issue-5112-client-changes"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "7e12a4685d56bd98c7146db80e1ff47326c6a4f8", "author": {"user": {"login": "shiveshr", "name": "shivesh ranjan"}}, "url": "https://github.com/pravega/pravega/commit/7e12a4685d56bd98c7146db80e1ff47326c6a4f8", "committedDate": "2021-01-19T01:25:46Z", "message": "Merge branch 'master' into issue-5112-client-changes"}, "afterCommit": {"oid": "40a340ced4f55ca3b84e52551c9a95a01a6c69a3", "author": {"user": {"login": "anirudhkovuru", "name": null}}, "url": "https://github.com/pravega/pravega/commit/40a340ced4f55ca3b84e52551c9a95a01a6c69a3", "committedDate": "2021-01-19T07:12:09Z", "message": "Merge branch 'issue-5543-flaky-metrics' of https://github.com/pbelgundi/pravega into issue-5112-client-changes"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "dcf512eee31209e8a294f412aec083b09be77051", "author": {"user": {"login": "anirudhkovuru", "name": null}}, "url": "https://github.com/pravega/pravega/commit/dcf512eee31209e8a294f412aec083b09be77051", "committedDate": "2021-01-19T07:19:54Z", "message": "Adding metrics coverage\n\nSigned-off-by: anirudhkovuru <anirudhkovuru@gmail.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "2240ae5ce354bcbbd82f111e12799f67267109c5", "author": {"user": {"login": "anirudhkovuru", "name": null}}, "url": "https://github.com/pravega/pravega/commit/2240ae5ce354bcbbd82f111e12799f67267109c5", "committedDate": "2021-01-19T10:27:37Z", "message": "Merge branch 'master' into issue-5112-client-changes"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "2c4844f1ed5ddcb6ef6987b7dae1ef4519405218", "author": {"user": {"login": "pbelgundi", "name": "Prajakta Belgundi"}}, "url": "https://github.com/pravega/pravega/commit/2c4844f1ed5ddcb6ef6987b7dae1ef4519405218", "committedDate": "2021-01-19T12:08:51Z", "message": "Merge branch 'master' into issue-5112-client-changes"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3808, "cost": 1, "resetAt": "2021-11-01T16:37:27Z"}}}