{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTIyMTkwNzMw", "number": 5339, "reviewThreads": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xOVQwNzoxMzo0N1rOE656Fw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0yMFQxNDoyOTowOVrOE7kJEg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzMwMjAxNjIzOnYy", "diffSide": "RIGHT", "path": "settings.gradle", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xOVQwNzoxMzo0N1rOH2PfrA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xOVQwNzo0MToyMFrOH2QN9A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNjYzOTAyMA==", "bodyText": "what is password-authplugin?\nalso since its shared:basic-authplugin, what is this include for basic-authplugin?", "url": "https://github.com/pravega/pravega/pull/5339#discussion_r526639020", "createdAt": "2020-11-19T07:13:47Z", "author": {"login": "shiveshr"}, "path": "settings.gradle", "diffHunk": "@@ -31,4 +32,7 @@ include 'common',\n         'test:testcommon',\n         'test:integration',\n         'test:system',\n-        'bindings'\n\\ No newline at end of file\n+        'bindings'\n+include 'password-authplugin'", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "1588f8275858695b70b9c2f65c3b6063f1ed1267"}, "originalPosition": 15}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNjY1MDg2OA==", "bodyText": "Thanks for catching those leftover lines. The IDE had added them when I was experimenting with adding Gradle modules and I forgot to remove them. I've now removed them in the latest commit that I just pushed.", "url": "https://github.com/pravega/pravega/pull/5339#discussion_r526650868", "createdAt": "2020-11-19T07:41:20Z", "author": {"login": "ravisharda"}, "path": "settings.gradle", "diffHunk": "@@ -31,4 +32,7 @@ include 'common',\n         'test:testcommon',\n         'test:integration',\n         'test:system',\n-        'bindings'\n\\ No newline at end of file\n+        'bindings'\n+include 'password-authplugin'", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNjYzOTAyMA=="}, "originalCommit": {"oid": "1588f8275858695b70b9c2f65c3b6063f1ed1267"}, "originalPosition": 15}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzMwNjg0NjE4OnYy", "diffSide": "RIGHT", "path": "controller/src/main/java/io/pravega/controller/server/security/auth/handler/AuthHandlerManager.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0yMFQwNDo1OTowMVrOH290yA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0yMFQxMjowNDowNlrOH3NCyQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNzM5ODA4OA==", "bodyText": "as discussed, we should keep the interface for auth handler unchanged so that dependents do not have to update.\nwe can add a new method in the serverconfig to get properties.", "url": "https://github.com/pravega/pravega/pull/5339#discussion_r527398088", "createdAt": "2020-11-20T04:59:01Z", "author": {"login": "shiveshr"}, "path": "controller/src/main/java/io/pravega/controller/server/security/auth/handler/AuthHandlerManager.java", "diffHunk": "@@ -157,7 +157,7 @@ public void registerInterceptors(ServerBuilder<?> builder) {\n                 ServiceLoader<AuthHandler> loader = ServiceLoader.load(AuthHandler.class);\n                 for (AuthHandler handler : loader) {\n                     try {\n-                        handler.initialize(serverConfig);\n+                        handler.initialize(serverConfig.toAuthHandlerProperties());", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "1c9b527b55c8ca85e8d239c34c9cb1d77656b176"}, "originalPosition": 5}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNzY0NzQzMw==", "bodyText": "Sure, I've now modified the implementation, as suggested, to avoid the change in the interface here - handler.initialize() continues to take ServerConfig as input.", "url": "https://github.com/pravega/pravega/pull/5339#discussion_r527647433", "createdAt": "2020-11-20T12:04:06Z", "author": {"login": "ravisharda"}, "path": "controller/src/main/java/io/pravega/controller/server/security/auth/handler/AuthHandlerManager.java", "diffHunk": "@@ -157,7 +157,7 @@ public void registerInterceptors(ServerBuilder<?> builder) {\n                 ServiceLoader<AuthHandler> loader = ServiceLoader.load(AuthHandler.class);\n                 for (AuthHandler handler : loader) {\n                     try {\n-                        handler.initialize(serverConfig);\n+                        handler.initialize(serverConfig.toAuthHandlerProperties());", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNzM5ODA4OA=="}, "originalCommit": {"oid": "1c9b527b55c8ca85e8d239c34c9cb1d77656b176"}, "originalPosition": 5}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzMwNjg0ODM2OnYy", "diffSide": "RIGHT", "path": "shared/authplugin/src/main/java/io/pravega/auth/AuthHandler.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0yMFQwNTowMDowOVrOH2919A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0yMFQxMjowNDozMVrOH3NDhA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNzM5ODM4OA==", "bodyText": "lets keep the interface signature same. lets change ServerConfig to add a new API for getting properties.", "url": "https://github.com/pravega/pravega/pull/5339#discussion_r527398388", "createdAt": "2020-11-20T05:00:09Z", "author": {"login": "shiveshr"}, "path": "shared/authplugin/src/main/java/io/pravega/auth/AuthHandler.java", "diffHunk": "@@ -69,7 +70,9 @@\n     /**\n      * Sets the configuration. If the auth handler needs to access the server configuration, it can be accessed though this var.\n      *\n-     * @param serverConfig The server configuration.\n+     * @param properties The auth handler configuration.\n      */\n-    void initialize(ServerConfig serverConfig);\n+    default void initialize(Properties properties) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "1c9b527b55c8ca85e8d239c34c9cb1d77656b176"}, "originalPosition": 16}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNzY0NzYyMA==", "bodyText": "Sure, I've now modified the implementation, as suggested, to avoid the change in the interface here - handler.initialize() continues to take ServerConfig as input.", "url": "https://github.com/pravega/pravega/pull/5339#discussion_r527647620", "createdAt": "2020-11-20T12:04:31Z", "author": {"login": "ravisharda"}, "path": "shared/authplugin/src/main/java/io/pravega/auth/AuthHandler.java", "diffHunk": "@@ -69,7 +70,9 @@\n     /**\n      * Sets the configuration. If the auth handler needs to access the server configuration, it can be accessed though this var.\n      *\n-     * @param serverConfig The server configuration.\n+     * @param properties The auth handler configuration.\n      */\n-    void initialize(ServerConfig serverConfig);\n+    default void initialize(Properties properties) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNzM5ODM4OA=="}, "originalCommit": {"oid": "1c9b527b55c8ca85e8d239c34c9cb1d77656b176"}, "originalPosition": 16}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzMwODkzNTg2OnYy", "diffSide": "RIGHT", "path": "build.gradle", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0yMFQxNDoyOTowOVrOH3SAoQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0yMlQwMzoyNzozM1rOH3zZog==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNzcyODgwMQ==", "bodyText": "Just to confirm my understanding of the dependency changes by taking a concrete example of an existing implementation:\nhttps://github.com/pravega/pravega-keycloak/blob/master/build.gradle\nIs it correct to say that in the above's:\n dependencies {\n        compileOnly \"org.slf4j:slf4j-api:${slf4jVersion}\"\n        compileOnly \"io.pravega:pravega-shared-authplugin:${pravegaVersion}\"\n        compileOnly \"io.pravega:pravega-client:${pravegaVersion}\"\n        implementation 'org.keycloak:keycloak-authz-client'\n...\n\nit would now become:\n dependencies {\n        compileOnly \"org.slf4j:slf4j-api:${slf4jVersion}\"\n        compileOnly \"io.pravega:pravega-shared-security:${pravegaVersion}\"\n        implementation 'org.keycloak:keycloak-authz-client'\n...\n\n?\nThe fact we needed the client and authplugin before was because of this and this respectively:\nhttps://github.com/pravega/pravega-keycloak/blob/master/client/src/main/java/io/pravega/keycloak/client/PravegaKeycloakCredentials.java#L13\nhttps://github.com/pravega/pravega-keycloak/blob/master/client/src/main/java/io/pravega/keycloak/client/PravegaKeycloakCredentials.java#L17\nBut now both would come from the single shared-security module, is that correct?", "url": "https://github.com/pravega/pravega/pull/5339#discussion_r527728801", "createdAt": "2020-11-20T14:29:09Z", "author": {"login": "sarlaccpit"}, "path": "build.gradle", "diffHunk": "@@ -193,10 +193,26 @@ project('shared:authplugin') {\n     }\n }\n \n+project('shared:basic-authplugin') {\n+    dependencies {\n+        compile project(':common')\n+        compile project(':shared:authplugin')\n+        compile project(':shared:security')\n+    }\n+\n+    javadoc {\n+        title = \"AuthHandler supporting HTTP Basic Authentication\"\n+        dependsOn delombok\n+        source = delombok.outputDir\n+        failOnError = true\n+    }\n+}\n+\n project('shared:security') {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "4aeed21127cd650084e3329831b9343db13f1fad"}, "originalPosition": 19}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyODI3NTg3NA==", "bodyText": "Yes, that is correct, except that AuthConstants which contains constants applicable to auth plugins is still under \"io.pravega:pravega-shared-authplugin, so you'll need to have a dependency on that module. To remove the dependency, the implementation may choose to use their own String constants instead of the ones in io.pravega.auth.AuthConstants. Hope that clarifies.", "url": "https://github.com/pravega/pravega/pull/5339#discussion_r528275874", "createdAt": "2020-11-22T03:27:33Z", "author": {"login": "ravisharda"}, "path": "build.gradle", "diffHunk": "@@ -193,10 +193,26 @@ project('shared:authplugin') {\n     }\n }\n \n+project('shared:basic-authplugin') {\n+    dependencies {\n+        compile project(':common')\n+        compile project(':shared:authplugin')\n+        compile project(':shared:security')\n+    }\n+\n+    javadoc {\n+        title = \"AuthHandler supporting HTTP Basic Authentication\"\n+        dependsOn delombok\n+        source = delombok.outputDir\n+        failOnError = true\n+    }\n+}\n+\n project('shared:security') {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNzcyODgwMQ=="}, "originalCommit": {"oid": "4aeed21127cd650084e3329831b9343db13f1fad"}, "originalPosition": 19}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4531, "cost": 1, "resetAt": "2021-11-13T12:26:42Z"}}}