{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0MzY1MDg2NDk3", "number": 4499, "title": "Issue 4456: Consolidate get active txn calls during commit transactions for multiple transactions", "bodyText": "Change log description\nContains first set of improvements to transaction commit where we consolidate multiple (parallel) requests into pravega tables into a single request.\nPurpose of the change\nPartially Fixes #4456\nWhat the code does\nDuring commit workflow execution we find all transactions in committing state and batch them and perform commit on this batch of transactions one after another.\nThis has one minor optimization where we earlier retrieve transaction metadata from the store by making multiple calls into the store for each transaction in lowest epoch. With this change we make a single readTableKeys call where we read multiple keys in a single request instead.\nThe gains will not be too significant as we made those calls in parallel earlier, but it reduces the number of store requests we make to segment store.\nAs follow up, we will add some more improvements to transaction commits to consolidate merge segment requests as well.\nHow to verify it\nUnit tests added.", "createdAt": "2020-01-21T04:15:29Z", "url": "https://github.com/pravega/pravega/pull/4499", "merged": true, "mergeCommit": {"oid": "8b9c69d765f9676b11969bb8e9d37c0f07c0edf3"}, "closed": true, "closedAt": "2020-02-03T14:58:43Z", "author": {"login": "shiveshr"}, "timelineItems": {"totalCount": 8, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABb8QZd6gH2gAyMzY1MDg2NDk3OjllYmYyYzM4YTZkMDY5YmRlNDgyOTk4MjA1NGVmMjRmNGFmYzc5MjM=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcApCSGgH2gAyMzY1MDg2NDk3OjUxZDAwNTFhNjg5MmI0YTE2YzgxYmY4ZGM3OTUzNTEwOGIyZmMwYjQ=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "9ebf2c38a6d069bde4829982054ef24f4afc7923", "author": {"user": {"login": "shiveshr", "name": "shivesh ranjan"}}, "url": "https://github.com/pravega/pravega/commit/9ebf2c38a6d069bde4829982054ef24f4afc7923", "committedDate": "2020-01-20T17:56:41Z", "message": "Issue 4456\n\nSigned-off-by: Shivesh Ranjan <shivesh.ranjan@gmail.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ea789f23c784a09756f8f712762c58b21994317a", "author": {"user": {"login": "shiveshr", "name": "shivesh ranjan"}}, "url": "https://github.com/pravega/pravega/commit/ea789f23c784a09756f8f712762c58b21994317a", "committedDate": "2020-01-21T04:06:03Z", "message": "unit tests\n\nSigned-off-by: Shivesh Ranjan <shivesh.ranjan@gmail.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "7d855340e4935f835d50a7d6260a7c46e9562367", "author": {"user": {"login": "shiveshr", "name": "shivesh ranjan"}}, "url": "https://github.com/pravega/pravega/commit/7d855340e4935f835d50a7d6260a7c46e9562367", "committedDate": "2020-01-24T04:33:36Z", "message": "Merge branch 'master' into issue4456"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e2d8b1fe36edfa254751de40c497496e78be379c", "author": {"user": {"login": "RaulGracia", "name": "Ra\u00fal Gracia"}}, "url": "https://github.com/pravega/pravega/commit/e2d8b1fe36edfa254751de40c497496e78be379c", "committedDate": "2020-01-24T17:37:53Z", "message": "Merge branch 'master' into issue4456"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "11ad48a3812e49d596908049f62f66b70b4dde22", "author": {"user": {"login": "shiveshr", "name": "shivesh ranjan"}}, "url": "https://github.com/pravega/pravega/commit/11ad48a3812e49d596908049f62f66b70b4dde22", "committedDate": "2020-01-27T05:44:34Z", "message": "Merge branch 'master' into issue4456"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a36dbd69df338b92b1a9db3b2e607088d744d491", "author": {"user": {"login": "RaulGracia", "name": "Ra\u00fal Gracia"}}, "url": "https://github.com/pravega/pravega/commit/a36dbd69df338b92b1a9db3b2e607088d744d491", "committedDate": "2020-01-27T11:22:49Z", "message": "Merge branch 'master' into issue4456"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzUyMDMzOTIz", "url": "https://github.com/pravega/pravega/pull/4499#pullrequestreview-352033923", "createdAt": "2020-02-03T06:01:44Z", "commit": {"oid": "a36dbd69df338b92b1a9db3b2e607088d744d491"}, "state": "APPROVED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0wM1QwNjowMTo0NFrOFknDOg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0wM1QwNjowMTo0NFrOFknDOg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MzkzMjg1OA==", "bodyText": "getEntriesOrDefault() Could we change the name of the function which indicates the default value if the key doesnot exist?", "url": "https://github.com/pravega/pravega/pull/4499#discussion_r373932858", "createdAt": "2020-02-03T06:01:44Z", "author": {"login": "shrids"}, "path": "controller/src/main/java/io/pravega/controller/store/stream/PravegaTablesStoreHelper.java", "diffHunk": "@@ -304,6 +304,45 @@ public void invalidateCache(String table, String key) {\n         return result;\n     }\n \n+    /**\n+     * Method to retrieve the value for a given key from a table. This method takes a deserialization function and deserializes\n+     * the received byte[] using the supplied function.\n+     * @param tableName tableName\n+     * @param keys keys to read\n+     * @param fromBytes deserialization function\n+     * @param nonExistent entry to populate for non existent keys\n+     * @param <T> Type of deserialized object\n+     * @return CompletableFuture which when completed will have the versionedMetadata retrieved from the store.\n+     */\n+    public <T> CompletableFuture<List<VersionedMetadata<T>>> getEntries(String tableName, List<String> keys, ", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a36dbd69df338b92b1a9db3b2e607088d744d491"}, "originalPosition": 14}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "51d0051a6892b4a16c81bf8dc79535108b2fc0b4", "author": {"user": {"login": "shrids", "name": "Sandeep"}}, "url": "https://github.com/pravega/pravega/commit/51d0051a6892b4a16c81bf8dc79535108b2fc0b4", "committedDate": "2020-02-03T08:54:41Z", "message": "Merge branch 'master' into issue4456"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3557, "cost": 1, "resetAt": "2021-11-01T16:37:27Z"}}}