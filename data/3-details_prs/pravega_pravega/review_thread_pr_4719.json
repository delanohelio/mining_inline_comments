{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDA2OTg1MTM4", "number": 4719, "reviewThreads": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yMlQxMDo0NDoxMVrOD0sGgA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yMlQxNzoxNjoyNVrOD03x6Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjU2NTc1MTA0OnYy", "diffSide": "RIGHT", "path": "docker/pravega/scripts/common.sh", "isResolved": true, "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yMlQxMDo0NDoxMVrOGJvywg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yMlQxNTo0MjoxNlrOGJ9ULg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMjg3MzQxMA==", "bodyText": "Curious, what is this ca-bundle directory under /etc/secret-volume? It's not clear to me from the PR description. Is it the certificate of the CA that was used to sign the ECS server certificates?\nCould we use a more specific name? Not sure what the ca-bundle represents exactly.", "url": "https://github.com/pravega/pravega/pull/4719#discussion_r412873410", "createdAt": "2020-04-22T10:44:11Z", "author": {"login": "ravisharda"}, "path": "docker/pravega/scripts/common.sh", "diffHunk": "@@ -36,7 +36,7 @@ add_system_property_ecs_config_uri() {\n \n # Add ECS certificates into Java truststore\n add_certs_into_truststore() {\n-    CERTS=/etc/ssl/certs/java/ecs-certs/*\n+    CERTS=/etc/secret-volume/ca-bundle/*", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "4f7423c36b4ed8af5ac7e0cf00f5c8af5e08272a"}, "originalPosition": 5}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMjg3NTUxNQ==", "bodyText": "Ok, I found the context in the corresponding issue: #4642. I'd suggest you add a bit of context to the PR description too, for future reference.", "url": "https://github.com/pravega/pravega/pull/4719#discussion_r412875515", "createdAt": "2020-04-22T10:47:41Z", "author": {"login": "ravisharda"}, "path": "docker/pravega/scripts/common.sh", "diffHunk": "@@ -36,7 +36,7 @@ add_system_property_ecs_config_uri() {\n \n # Add ECS certificates into Java truststore\n add_certs_into_truststore() {\n-    CERTS=/etc/ssl/certs/java/ecs-certs/*\n+    CERTS=/etc/secret-volume/ca-bundle/*", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMjg3MzQxMA=="}, "originalCommit": {"oid": "4f7423c36b4ed8af5ac7e0cf00f5c8af5e08272a"}, "originalPosition": 5}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMzA5NDk1OA==", "bodyText": "PR description updated.", "url": "https://github.com/pravega/pravega/pull/4719#discussion_r413094958", "createdAt": "2020-04-22T15:42:16Z", "author": {"login": "kevinhan88"}, "path": "docker/pravega/scripts/common.sh", "diffHunk": "@@ -36,7 +36,7 @@ add_system_property_ecs_config_uri() {\n \n # Add ECS certificates into Java truststore\n add_certs_into_truststore() {\n-    CERTS=/etc/ssl/certs/java/ecs-certs/*\n+    CERTS=/etc/secret-volume/ca-bundle/*", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMjg3MzQxMA=="}, "originalCommit": {"oid": "4f7423c36b4ed8af5ac7e0cf00f5c8af5e08272a"}, "originalPosition": 5}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjU2NTc3MzY1OnYy", "diffSide": "RIGHT", "path": "docker/pravega/scripts/common.sh", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yMlQxMDo0OTo1OVrOGJwAMA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yMlQxNTozOToyM1rOGJ9KzA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMjg3Njg0OA==", "bodyText": "Should we delete the certificate after successful import into the keystone?", "url": "https://github.com/pravega/pravega/pull/4719#discussion_r412876848", "createdAt": "2020-04-22T10:49:59Z", "author": {"login": "ravisharda"}, "path": "docker/pravega/scripts/common.sh", "diffHunk": "@@ -36,7 +36,7 @@ add_system_property_ecs_config_uri() {\n \n # Add ECS certificates into Java truststore\n add_certs_into_truststore() {\n-    CERTS=/etc/ssl/certs/java/ecs-certs/*\n+    CERTS=/etc/secret-volume/ca-bundle/*\n     for cert in $CERTS\n     do\n       yes | keytool -importcert -storepass changeit -file \"${cert}\" -keystore /etc/ssl/certs/java/cacerts || true", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "4f7423c36b4ed8af5ac7e0cf00f5c8af5e08272a"}, "originalPosition": 8}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMzA5MjU1Ng==", "bodyText": "added line to delete certs afterwards.", "url": "https://github.com/pravega/pravega/pull/4719#discussion_r413092556", "createdAt": "2020-04-22T15:39:23Z", "author": {"login": "kevinhan88"}, "path": "docker/pravega/scripts/common.sh", "diffHunk": "@@ -36,7 +36,7 @@ add_system_property_ecs_config_uri() {\n \n # Add ECS certificates into Java truststore\n add_certs_into_truststore() {\n-    CERTS=/etc/ssl/certs/java/ecs-certs/*\n+    CERTS=/etc/secret-volume/ca-bundle/*\n     for cert in $CERTS\n     do\n       yes | keytool -importcert -storepass changeit -file \"${cert}\" -keystore /etc/ssl/certs/java/cacerts || true", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMjg3Njg0OA=="}, "originalCommit": {"oid": "4f7423c36b4ed8af5ac7e0cf00f5c8af5e08272a"}, "originalPosition": 8}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjU2NzY1NzQ1OnYy", "diffSide": "RIGHT", "path": "docker/pravega/scripts/common.sh", "isResolved": true, "comments": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yMlQxNzoxNToxMFrOGKBrQw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yM1QwNDoxNjoxNFrOGKVzoA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMzE2NjQwMw==", "bodyText": "This is unrequired and potentially dangerous.  If Pravega is running bare metal then this will delete any certificates that were placed in /etc/secret-volume/ca-bundle.  If this is running in Kubernetes then it would be a secret and you can't delete the certificates from the secret.\nIs there a reason this was added?", "url": "https://github.com/pravega/pravega/pull/4719#discussion_r413166403", "createdAt": "2020-04-22T17:15:10Z", "author": {"login": "maddisondavid"}, "path": "docker/pravega/scripts/common.sh", "diffHunk": "@@ -36,9 +36,10 @@ add_system_property_ecs_config_uri() {\n \n # Add ECS certificates into Java truststore\n add_certs_into_truststore() {\n-    CERTS=/etc/ssl/certs/java/ecs-certs/*\n+    CERTS=/etc/secret-volume/ca-bundle/*\n     for cert in $CERTS\n     do\n       yes | keytool -importcert -storepass changeit -file \"${cert}\" -keystore /etc/ssl/certs/java/cacerts || true\n     done\n+    rm -rf /etc/secret-volume/ca-bundle/* || true", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e0e4981a24b2ccd4535d793b9da0f49135e4ebcc"}, "originalPosition": 10}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMzMwOTQ3MA==", "bodyText": "This is per our security specialist Ravi's comment.\nFunctional-wise, it's tested okay to delete certificates after adding them into truststore. Those certificates have been mounted into the pod already so it wont affect k8s secrets.", "url": "https://github.com/pravega/pravega/pull/4719#discussion_r413309470", "createdAt": "2020-04-22T20:33:18Z", "author": {"login": "kevinhan88"}, "path": "docker/pravega/scripts/common.sh", "diffHunk": "@@ -36,9 +36,10 @@ add_system_property_ecs_config_uri() {\n \n # Add ECS certificates into Java truststore\n add_certs_into_truststore() {\n-    CERTS=/etc/ssl/certs/java/ecs-certs/*\n+    CERTS=/etc/secret-volume/ca-bundle/*\n     for cert in $CERTS\n     do\n       yes | keytool -importcert -storepass changeit -file \"${cert}\" -keystore /etc/ssl/certs/java/cacerts || true\n     done\n+    rm -rf /etc/secret-volume/ca-bundle/* || true", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMzE2NjQwMw=="}, "originalCommit": {"oid": "e0e4981a24b2ccd4535d793b9da0f49135e4ebcc"}, "originalPosition": 10}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMzQ5MzQ0NA==", "bodyText": "Actually, @maddisondavid is right. You shouldn't delete a file-mounted K8s secret using an OS command. If you manage to do it, it'll probably automatically be recreated (I am not 100% sure). Maybe we should leave it as is as @maddisondavid suggests.", "url": "https://github.com/pravega/pravega/pull/4719#discussion_r413493444", "createdAt": "2020-04-23T04:06:52Z", "author": {"login": "ravisharda"}, "path": "docker/pravega/scripts/common.sh", "diffHunk": "@@ -36,9 +36,10 @@ add_system_property_ecs_config_uri() {\n \n # Add ECS certificates into Java truststore\n add_certs_into_truststore() {\n-    CERTS=/etc/ssl/certs/java/ecs-certs/*\n+    CERTS=/etc/secret-volume/ca-bundle/*\n     for cert in $CERTS\n     do\n       yes | keytool -importcert -storepass changeit -file \"${cert}\" -keystore /etc/ssl/certs/java/cacerts || true\n     done\n+    rm -rf /etc/secret-volume/ca-bundle/* || true", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMzE2NjQwMw=="}, "originalCommit": {"oid": "e0e4981a24b2ccd4535d793b9da0f49135e4ebcc"}, "originalPosition": 10}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMzQ5NjIyNA==", "bodyText": "fixed", "url": "https://github.com/pravega/pravega/pull/4719#discussion_r413496224", "createdAt": "2020-04-23T04:16:14Z", "author": {"login": "kevinhan88"}, "path": "docker/pravega/scripts/common.sh", "diffHunk": "@@ -36,9 +36,10 @@ add_system_property_ecs_config_uri() {\n \n # Add ECS certificates into Java truststore\n add_certs_into_truststore() {\n-    CERTS=/etc/ssl/certs/java/ecs-certs/*\n+    CERTS=/etc/secret-volume/ca-bundle/*\n     for cert in $CERTS\n     do\n       yes | keytool -importcert -storepass changeit -file \"${cert}\" -keystore /etc/ssl/certs/java/cacerts || true\n     done\n+    rm -rf /etc/secret-volume/ca-bundle/* || true", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMzE2NjQwMw=="}, "originalCommit": {"oid": "e0e4981a24b2ccd4535d793b9da0f49135e4ebcc"}, "originalPosition": 10}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjU2NzY2NDQxOnYy", "diffSide": "RIGHT", "path": "docker/pravega/scripts/common.sh", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yMlQxNzoxNjoyNVrOGKBvMw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yMlQyMDozNDowNVrOGKKcBA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMzE2NzQxMQ==", "bodyText": "Does this work with multiple certificates?  I was under the impression from other tests I've done with keytool that you need to specify an alias otherwise the certificate gets added as <mykey> which isn't a trusted entry.", "url": "https://github.com/pravega/pravega/pull/4719#discussion_r413167411", "createdAt": "2020-04-22T17:16:25Z", "author": {"login": "maddisondavid"}, "path": "docker/pravega/scripts/common.sh", "diffHunk": "@@ -36,9 +36,10 @@ add_system_property_ecs_config_uri() {\n \n # Add ECS certificates into Java truststore\n add_certs_into_truststore() {\n-    CERTS=/etc/ssl/certs/java/ecs-certs/*\n+    CERTS=/etc/secret-volume/ca-bundle/*\n     for cert in $CERTS\n     do\n       yes | keytool -importcert -storepass changeit -file \"${cert}\" -keystore /etc/ssl/certs/java/cacerts || true", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e0e4981a24b2ccd4535d793b9da0f49135e4ebcc"}, "originalPosition": 8}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMzMwOTk1Ng==", "bodyText": "Good point. Added file name as alias to avoid the potential conflict.\n(OpenJDK's default truststore also uses filename as alias)", "url": "https://github.com/pravega/pravega/pull/4719#discussion_r413309956", "createdAt": "2020-04-22T20:34:05Z", "author": {"login": "kevinhan88"}, "path": "docker/pravega/scripts/common.sh", "diffHunk": "@@ -36,9 +36,10 @@ add_system_property_ecs_config_uri() {\n \n # Add ECS certificates into Java truststore\n add_certs_into_truststore() {\n-    CERTS=/etc/ssl/certs/java/ecs-certs/*\n+    CERTS=/etc/secret-volume/ca-bundle/*\n     for cert in $CERTS\n     do\n       yes | keytool -importcert -storepass changeit -file \"${cert}\" -keystore /etc/ssl/certs/java/cacerts || true", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMzE2NzQxMQ=="}, "originalCommit": {"oid": "e0e4981a24b2ccd4535d793b9da0f49135e4ebcc"}, "originalPosition": 8}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4292, "cost": 1, "resetAt": "2021-11-13T12:26:42Z"}}}