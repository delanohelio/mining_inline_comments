{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTE0NDQxNzY2", "number": 5292, "title": "Reducing time in DR integration tests", "bodyText": "Change log description\nThe PR speeds up the data recovery integration tests.\nPurpose of the change\nTime reduction in running tests.\nWhat the code does\n\nWrites lesser number of events to verify recovery.\nCreates just one stream to write events and read back.\nRemoved redundant immediate read after writing the events, as the final read is enough to verify the successfulness of the test.\nMakes flushing of Tier1 to the long term storage faster using updated writer config.\n\nHow to verify it\nBuild shall pass.", "createdAt": "2020-11-03T02:29:34Z", "url": "https://github.com/pravega/pravega/pull/5292", "merged": true, "mergeCommit": {"oid": "fc71d34df6bbd92599113e4ab23c3dbb67102fb6"}, "closed": true, "closedAt": "2020-11-19T16:22:58Z", "author": {"login": "ManishKumarKeshri"}, "timelineItems": {"totalCount": 8, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdYvjQgAH2gAyNTE0NDQxNzY2OjgyMzczMTg1NDRiYWY0MTVkNWY1ZGY2NjFlNzE2MjAwM2U5ZTNjMzg=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdeFQqGgFqTUzNDYxOTgzMA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "8237318544baf415d5f5df661e7162003e9e3c38", "author": {"user": null}, "url": "https://github.com/pravega/pravega/commit/8237318544baf415d5f5df661e7162003e9e3c38", "committedDate": "2020-11-03T02:15:28Z", "message": "Reducing time.\n\nSigned-off-by: ManishKumarKeshri <manish.keshri562@gmail.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "84a7785e9e295386f9e61bb2fa9ce5d99c17a8e3", "author": {"user": null}, "url": "https://github.com/pravega/pravega/commit/84a7785e9e295386f9e61bb2fa9ce5d99c17a8e3", "committedDate": "2020-11-03T02:34:16Z", "message": "Minor change.\n\nSigned-off-by: ManishKumarKeshri <manish.keshri562@gmail.com>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTI1MjI4NTA4", "url": "https://github.com/pravega/pravega/pull/5292#pullrequestreview-525228508", "createdAt": "2020-11-06T14:57:05Z", "commit": {"oid": "84a7785e9e295386f9e61bb2fa9ce5d99c17a8e3"}, "state": "COMMENTED", "comments": {"totalCount": 8, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wNlQxNDo1NzowNVrOHuxS3Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wNlQxNToxMToxN1rOHux3bg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxODgwNDE4OQ==", "bodyText": "Are you sure that 10 events is sufficient for an integration test? I would feel more comfortable knowing that we test a \"larger\" number of events.\nIs this really a driving factor for the time it takes to do this test? Pravega should have no issue, even in a unit/integration test, to handle 300 events.", "url": "https://github.com/pravega/pravega/pull/5292#discussion_r518804189", "createdAt": "2020-11-06T14:57:05Z", "author": {"login": "andreipaduroiu"}, "path": "test/integration/src/test/java/io/pravega/test/integration/RestoreBackUpDataRecoveryTest.java", "diffHunk": "@@ -123,9 +124,9 @@\n     private static final Duration TRANSACTION_TIMEOUT = Duration.ofMillis(10000);\n \n     /**\n-     * Write 300 events to different segments.\n+     * Write 10 events to verify recovery.\n      */\n-    private static final int TOTAL_NUM_EVENTS = 300;\n+    private static final int TOTAL_NUM_EVENTS = 10;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "84a7785e9e295386f9e61bb2fa9ce5d99c17a8e3"}, "originalPosition": 16}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxODgwNDc3Mw==", "bodyText": "To avoid having this comment becoming disconnected from the actual value (if it changes), consider replacing the number with {@link #TOTAL_NUM_EVENTS}.", "url": "https://github.com/pravega/pravega/pull/5292#discussion_r518804773", "createdAt": "2020-11-06T14:57:59Z", "author": {"login": "andreipaduroiu"}, "path": "test/integration/src/test/java/io/pravega/test/integration/RestoreBackUpDataRecoveryTest.java", "diffHunk": "@@ -375,17 +377,18 @@ public void close() throws Exception {\n      * debug segment container.\n      *  What test does, step by step:\n      *  1. Starts Pravega locally with just one segment container.\n-     *  2. Writes 300 events to two different segments.\n-     *  3. Waits for all segments created to be flushed to the long term storage.\n+     *  2. Writes 10 events.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "84a7785e9e295386f9e61bb2fa9ce5d99c17a8e3"}, "originalPosition": 45}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxODgwNTAzNQ==", "bodyText": "There is no such thing as \"Tier1\" in the code. It's called DurableLog or DurableDataLog", "url": "https://github.com/pravega/pravega/pull/5292#discussion_r518805035", "createdAt": "2020-11-06T14:58:23Z", "author": {"login": "andreipaduroiu"}, "path": "test/integration/src/test/java/io/pravega/test/integration/RestoreBackUpDataRecoveryTest.java", "diffHunk": "@@ -375,17 +377,18 @@ public void close() throws Exception {\n      * debug segment container.\n      *  What test does, step by step:\n      *  1. Starts Pravega locally with just one segment container.\n-     *  2. Writes 300 events to two different segments.\n-     *  3. Waits for all segments created to be flushed to the long term storage.\n+     *  2. Writes 10 events.\n+     *  3. Waits for Tier1 to be entirely flushed to the long term storage.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "84a7785e9e295386f9e61bb2fa9ce5d99c17a8e3"}, "originalPosition": 46}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxODgwNTUwOA==", "bodyText": "Similarly, there is no LTS in the code either (LTS == Long Term Storage). The term in the code is Storage.", "url": "https://github.com/pravega/pravega/pull/5292#discussion_r518805508", "createdAt": "2020-11-06T14:59:06Z", "author": {"login": "andreipaduroiu"}, "path": "test/integration/src/test/java/io/pravega/test/integration/RestoreBackUpDataRecoveryTest.java", "diffHunk": "@@ -375,17 +377,18 @@ public void close() throws Exception {\n      * debug segment container.\n      *  What test does, step by step:\n      *  1. Starts Pravega locally with just one segment container.\n-     *  2. Writes 300 events to two different segments.\n-     *  3. Waits for all segments created to be flushed to the long term storage.\n+     *  2. Writes 10 events.\n+     *  3. Waits for Tier1 to be entirely flushed to the long term storage.\n      *  4. Shuts down the controller, segment store and bookeeper/zookeeper.\n-     *  5. Deletes container metadata segment and its attribute segment from the old LTS.\n-     *  5. Starts just one debug segment container using a new bookeeper/zookeeper and the old LTS.\n-     *  6. Re-creates the container metadata segment in Tier1 and let's it flushed to the LTS.\n-     *  7. Starts segment store and controller.\n-     *  8. Reads all 600 events again.\n+     *  5. Creates back up of container metadata segment and its attribute segment from the old LTS before deleting them.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "84a7785e9e295386f9e61bb2fa9ce5d99c17a8e3"}, "originalPosition": 53}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxODgwNTc3MQ==", "bodyText": "at line 385 too", "url": "https://github.com/pravega/pravega/pull/5292#discussion_r518805771", "createdAt": "2020-11-06T14:59:29Z", "author": {"login": "andreipaduroiu"}, "path": "test/integration/src/test/java/io/pravega/test/integration/RestoreBackUpDataRecoveryTest.java", "diffHunk": "@@ -375,17 +377,18 @@ public void close() throws Exception {\n      * debug segment container.\n      *  What test does, step by step:\n      *  1. Starts Pravega locally with just one segment container.\n-     *  2. Writes 300 events to two different segments.\n-     *  3. Waits for all segments created to be flushed to the long term storage.\n+     *  2. Writes 10 events.\n+     *  3. Waits for Tier1 to be entirely flushed to the long term storage.", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxODgwNTAzNQ=="}, "originalCommit": {"oid": "84a7785e9e295386f9e61bb2fa9ce5d99c17a8e3"}, "originalPosition": 46}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxODgwNTg5NA==", "bodyText": "spacing", "url": "https://github.com/pravega/pravega/pull/5292#discussion_r518805894", "createdAt": "2020-11-06T14:59:41Z", "author": {"login": "andreipaduroiu"}, "path": "test/integration/src/test/java/io/pravega/test/integration/RestoreBackUpDataRecoveryTest.java", "diffHunk": "@@ -375,17 +377,18 @@ public void close() throws Exception {\n      * debug segment container.\n      *  What test does, step by step:\n      *  1. Starts Pravega locally with just one segment container.\n-     *  2. Writes 300 events to two different segments.\n-     *  3. Waits for all segments created to be flushed to the long term storage.\n+     *  2. Writes 10 events.\n+     *  3. Waits for Tier1 to be entirely flushed to the long term storage.\n      *  4. Shuts down the controller, segment store and bookeeper/zookeeper.\n-     *  5. Deletes container metadata segment and its attribute segment from the old LTS.\n-     *  5. Starts just one debug segment container using a new bookeeper/zookeeper and the old LTS.\n-     *  6. Re-creates the container metadata segment in Tier1 and let's it flushed to the LTS.\n-     *  7. Starts segment store and controller.\n-     *  8. Reads all 600 events again.\n+     *  5. Creates back up of container metadata segment and its attribute segment from the old LTS before deleting them.\n+     *  6. Starts just one debug segment container using a new bookeeper/zookeeper and the old LTS.\n+     *  7. Re-creates the container metadata segment in Tier1 and let's it flushed to the LTS.\n+     *  8. Updates core attributes of segments in the new container metadata segment by using details from the back up of old container metadata segment.\n+     *  9. Starts segment store and controller.\n+     *  10.Reads all events.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "84a7785e9e295386f9e61bb2fa9ce5d99c17a8e3"}, "originalPosition": 58}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxODgwNjI0MA==", "bodyText": "\"Just don't say just\". :)", "url": "https://github.com/pravega/pravega/pull/5292#discussion_r518806240", "createdAt": "2020-11-06T15:00:12Z", "author": {"login": "andreipaduroiu"}, "path": "test/integration/src/test/java/io/pravega/test/integration/RestoreBackUpDataRecoveryTest.java", "diffHunk": "@@ -375,17 +377,18 @@ public void close() throws Exception {\n      * debug segment container.\n      *  What test does, step by step:\n      *  1. Starts Pravega locally with just one segment container.\n-     *  2. Writes 300 events to two different segments.\n-     *  3. Waits for all segments created to be flushed to the long term storage.\n+     *  2. Writes 10 events.\n+     *  3. Waits for Tier1 to be entirely flushed to the long term storage.\n      *  4. Shuts down the controller, segment store and bookeeper/zookeeper.\n-     *  5. Deletes container metadata segment and its attribute segment from the old LTS.\n-     *  5. Starts just one debug segment container using a new bookeeper/zookeeper and the old LTS.\n-     *  6. Re-creates the container metadata segment in Tier1 and let's it flushed to the LTS.\n-     *  7. Starts segment store and controller.\n-     *  8. Reads all 600 events again.\n+     *  5. Creates back up of container metadata segment and its attribute segment from the old LTS before deleting them.\n+     *  6. Starts just one debug segment container using a new bookeeper/zookeeper and the old LTS.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "84a7785e9e295386f9e61bb2fa9ce5d99c17a8e3"}, "originalPosition": 54}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxODgxMzU1MA==", "bodyText": "and in the other tests javadoc as well.", "url": "https://github.com/pravega/pravega/pull/5292#discussion_r518813550", "createdAt": "2020-11-06T15:11:17Z", "author": {"login": "andreipaduroiu"}, "path": "test/integration/src/test/java/io/pravega/test/integration/RestoreBackUpDataRecoveryTest.java", "diffHunk": "@@ -375,17 +377,18 @@ public void close() throws Exception {\n      * debug segment container.\n      *  What test does, step by step:\n      *  1. Starts Pravega locally with just one segment container.\n-     *  2. Writes 300 events to two different segments.\n-     *  3. Waits for all segments created to be flushed to the long term storage.\n+     *  2. Writes 10 events.\n+     *  3. Waits for Tier1 to be entirely flushed to the long term storage.", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxODgwNTAzNQ=="}, "originalCommit": {"oid": "84a7785e9e295386f9e61bb2fa9ce5d99c17a8e3"}, "originalPosition": 46}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f1babea4dc22cc6d800ac2f9341e59c0e9039740", "author": {"user": null}, "url": "https://github.com/pravega/pravega/commit/f1babea4dc22cc6d800ac2f9341e59c0e9039740", "committedDate": "2020-11-13T05:54:03Z", "message": "Fixing comments.\n\nSigned-off-by: ManishKumarKeshri <manish.keshri562@gmail.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "0d0a966f39548daf9bb5918621c2593f22a53cf3", "author": {"user": null}, "url": "https://github.com/pravega/pravega/commit/0d0a966f39548daf9bb5918621c2593f22a53cf3", "committedDate": "2020-11-13T06:04:38Z", "message": "Fixing comments.\n\nSigned-off-by: ManishKumarKeshri <manish.keshri562@gmail.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "add04b9f1431ce17fdd4bfa554521b36feca7bef", "author": {"user": null}, "url": "https://github.com/pravega/pravega/commit/add04b9f1431ce17fdd4bfa554521b36feca7bef", "committedDate": "2020-11-13T22:02:16Z", "message": "Minor changes.\n\nSigned-off-by: ManishKumarKeshri <manish.keshri562@gmail.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f09f8e62b1ecbfac10146f30067cbcd0aa9cd60c", "author": {"user": null}, "url": "https://github.com/pravega/pravega/commit/f09f8e62b1ecbfac10146f30067cbcd0aa9cd60c", "committedDate": "2020-11-13T22:04:28Z", "message": "Minor changes.\n\nSigned-off-by: ManishKumarKeshri <manish.keshri562@gmail.com>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTM0NjE5ODMw", "url": "https://github.com/pravega/pravega/pull/5292#pullrequestreview-534619830", "createdAt": "2020-11-19T16:22:41Z", "commit": {"oid": "f09f8e62b1ecbfac10146f30067cbcd0aa9cd60c"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3698, "cost": 1, "resetAt": "2021-11-01T16:37:27Z"}}}