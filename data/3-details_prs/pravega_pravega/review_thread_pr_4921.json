{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDQ0NTYyOTA5", "number": 4921, "reviewThreads": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wNlQwNjozODozNFrOELjqwA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wOFQwODo1MTowN1rOEMZNXQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjgwNTU0MTc2OnYy", "diffSide": "LEFT", "path": "controller/src/test/java/io/pravega/controller/server/v1/InMemoryControllerServiceImplTest.java", "isResolved": false, "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wNlQwNjozODozNFrOGtKhgg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wOFQwOToxNDowMFrOGufReQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MDAxMTUyMg==", "bodyText": "Why can't you spy directly this controllerService variable?", "url": "https://github.com/pravega/pravega/pull/4921#discussion_r450011522", "createdAt": "2020-07-06T06:38:34Z", "author": {"login": "eolivelli"}, "path": "controller/src/test/java/io/pravega/controller/server/v1/InMemoryControllerServiceImplTest.java", "diffHunk": "@@ -85,9 +86,10 @@ public void setup() throws Exception {\n \n         Cluster mockCluster = mock(Cluster.class);\n         when(mockCluster.getClusterMembers()).thenReturn(Collections.singleton(new Host(\"localhost\", 9090, null)));\n-        controllerService = new ControllerServiceImpl(", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d5b4a15f1948a3f39cb6ba418e642b4706bd7784"}, "originalPosition": 12}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MDAxOTMwOA==", "bodyText": "controllerService which is an instance of ControllerServiceImpl is what we are verifying in this test.", "url": "https://github.com/pravega/pravega/pull/4921#discussion_r450019308", "createdAt": "2020-07-06T06:58:06Z", "author": {"login": "shiveshr"}, "path": "controller/src/test/java/io/pravega/controller/server/v1/InMemoryControllerServiceImplTest.java", "diffHunk": "@@ -85,9 +86,10 @@ public void setup() throws Exception {\n \n         Cluster mockCluster = mock(Cluster.class);\n         when(mockCluster.getClusterMembers()).thenReturn(Collections.singleton(new Host(\"localhost\", 9090, null)));\n-        controllerService = new ControllerServiceImpl(", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MDAxMTUyMg=="}, "originalCommit": {"oid": "d5b4a15f1948a3f39cb6ba418e642b4706bd7784"}, "originalPosition": 12}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MTQwMDA1Nw==", "bodyText": "I am not sure this is the right way. But unfortunately I don't have much time to suggest another approach.\nSo I am fine with keeping it.\nMaybe one day we could introduce PowerMock, that allows you to rewrite entire methods and constructors without introducing this intermediate objects.\nNow we are introducing this layer between the streamStore and the ControllerService, I don't have enough context, so I don't know if it may introduce some sort of difference from the behavior of the tests  and the execution at runtime in production (the risk is to not test the right thing).", "url": "https://github.com/pravega/pravega/pull/4921#discussion_r451400057", "createdAt": "2020-07-08T09:14:00Z", "author": {"login": "eolivelli"}, "path": "controller/src/test/java/io/pravega/controller/server/v1/InMemoryControllerServiceImplTest.java", "diffHunk": "@@ -85,9 +86,10 @@ public void setup() throws Exception {\n \n         Cluster mockCluster = mock(Cluster.class);\n         when(mockCluster.getClusterMembers()).thenReturn(Collections.singleton(new Host(\"localhost\", 9090, null)));\n-        controllerService = new ControllerServiceImpl(", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MDAxMTUyMg=="}, "originalCommit": {"oid": "d5b4a15f1948a3f39cb6ba418e642b4706bd7784"}, "originalPosition": 12}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjgxNDMxMzg5OnYy", "diffSide": "LEFT", "path": "controller/src/test/java/io/pravega/controller/server/v1/InMemoryControllerServiceImplTest.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wOFQwODo1MTowN1rOGuecPw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wOVQwMzozMDowOFrOGvAclQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MTM4NjQzMQ==", "bodyText": "Override should be fine here since io.pravega.controller.server.v1.ControllerServiceImplTest#tearDown method already has @after annotation right ? \n  \n    \n      pravega/controller/src/test/java/io/pravega/controller/server/v1/ControllerServiceImplTest.java\n    \n    \n        Lines 86 to 87\n      in\n      b81cf9e\n    \n    \n    \n    \n\n        \n          \n           @After \n        \n\n        \n          \n           public abstract void tearDown() throws Exception;", "url": "https://github.com/pravega/pravega/pull/4921#discussion_r451386431", "createdAt": "2020-07-08T08:51:07Z", "author": {"login": "shrids"}, "path": "controller/src/test/java/io/pravega/controller/server/v1/InMemoryControllerServiceImplTest.java", "diffHunk": "@@ -85,12 +83,11 @@ public void setup() throws Exception {\n \n         Cluster mockCluster = mock(Cluster.class);\n         when(mockCluster.getClusterMembers()).thenReturn(Collections.singleton(new Host(\"localhost\", 9090, null)));\n-        controllerService = new ControllerServiceImpl(\n-                new ControllerService(streamStore, StreamStoreFactory.createInMemoryBucketStore(), streamMetadataTasks, streamTransactionMetadataTasks,\n-                                      SegmentHelperMock.getSegmentHelperMock(), executorService, mockCluster), GrpcAuthHelper.getDisabledAuthHelper(), requestTracker, true, 2);\n+        return new ControllerService(streamStore, StreamStoreFactory.createInMemoryBucketStore(), streamMetadataTasks, streamTransactionMetadataTasks,\n+                SegmentHelperMock.getSegmentHelperMock(), executorService, mockCluster);\n     }\n \n-    @Override", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "02c5457596ec0cd12117688a950bc96f6516cd49"}, "originalPosition": 53}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MTk0MzU3Mw==", "bodyText": "its not overridden because its not defined in the base class.", "url": "https://github.com/pravega/pravega/pull/4921#discussion_r451943573", "createdAt": "2020-07-09T03:30:08Z", "author": {"login": "shiveshr"}, "path": "controller/src/test/java/io/pravega/controller/server/v1/InMemoryControllerServiceImplTest.java", "diffHunk": "@@ -85,12 +83,11 @@ public void setup() throws Exception {\n \n         Cluster mockCluster = mock(Cluster.class);\n         when(mockCluster.getClusterMembers()).thenReturn(Collections.singleton(new Host(\"localhost\", 9090, null)));\n-        controllerService = new ControllerServiceImpl(\n-                new ControllerService(streamStore, StreamStoreFactory.createInMemoryBucketStore(), streamMetadataTasks, streamTransactionMetadataTasks,\n-                                      SegmentHelperMock.getSegmentHelperMock(), executorService, mockCluster), GrpcAuthHelper.getDisabledAuthHelper(), requestTracker, true, 2);\n+        return new ControllerService(streamStore, StreamStoreFactory.createInMemoryBucketStore(), streamMetadataTasks, streamTransactionMetadataTasks,\n+                SegmentHelperMock.getSegmentHelperMock(), executorService, mockCluster);\n     }\n \n-    @Override", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MTM4NjQzMQ=="}, "originalCommit": {"oid": "02c5457596ec0cd12117688a950bc96f6516cd49"}, "originalPosition": 53}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4782, "cost": 1, "resetAt": "2021-11-13T12:26:42Z"}}}