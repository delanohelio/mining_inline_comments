{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDU4Mzk1OTg1", "number": 4991, "title": "Issue 4985: Additional Logs for tracking controller periodic retention ", "bodyText": "Change log description\nAdded info logs to track execution of controller's periodic retention.\nPurpose of the change\nFixes #4985\nWhat the code does\nNew log messages added\nHow to verify it\nLogs should be noticed when periodic retention is invoked or cannot be invoked because truncation record is not found.", "createdAt": "2020-07-29T12:07:45Z", "url": "https://github.com/pravega/pravega/pull/4991", "merged": true, "mergeCommit": {"oid": "8bd2bf4e16e2130ed6ea4d23c27bcada4f96de0c"}, "closed": true, "closedAt": "2020-07-29T15:25:09Z", "author": {"login": "pbelgundi"}, "timelineItems": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABc5piS8AH2gAyNDU4Mzk1OTg1OjI5ZTYxNmQwMTNmMTI2MDNkMTRlMDhhNmQ1ZjgzNzMwZTIzMGFjN2M=", "endCursor": "Y3Vyc29yOnYyOpPPAAABc5qPO6gH2gAyNDU4Mzk1OTg1OjQwZWZhN2JiM2RhN2E1NTBhODc0NTM3NjQ4YzlmZTc2NzJhM2JmZTE=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "29e616d013f12603d14e08a6d5f83730e230ac7c", "author": {"user": {"login": "pbelgundi", "name": "Prajakta Belgundi"}}, "url": "https://github.com/pravega/pravega/commit/29e616d013f12603d14e08a6d5f83730e230ac7c", "committedDate": "2020-07-29T11:43:20Z", "message": "added logs\n\nSigned-off-by: pbelgundi <prajakta.belgundi@emc.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "9fdc6300668e8b86dadf4b5f3732114360827231", "author": {"user": {"login": "pbelgundi", "name": "Prajakta Belgundi"}}, "url": "https://github.com/pravega/pravega/commit/9fdc6300668e8b86dadf4b5f3732114360827231", "committedDate": "2020-07-29T11:59:32Z", "message": "added logs 1\n\nSigned-off-by: pbelgundi <prajakta.belgundi@emc.com>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDU3NDU4MjQ0", "url": "https://github.com/pravega/pravega/pull/4991#pullrequestreview-457458244", "createdAt": "2020-07-29T12:10:15Z", "commit": {"oid": "9fdc6300668e8b86dadf4b5f3732114360827231"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yOVQxMjoxMDoxNVrOG41gOw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yOVQxMjoxMDoxNVrOG41gOw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MjI1MDA0Mw==", "bodyText": "nit: Could not find truncation record seems negative.\nI would reword it to something along the lines of - No suitable truncation record was found that satisfied retention policy.", "url": "https://github.com/pravega/pravega/pull/4991#discussion_r462250043", "createdAt": "2020-07-29T12:10:15Z", "author": {"login": "shiveshr"}, "path": "controller/src/main/java/io/pravega/controller/task/Stream/StreamMetadataTasks.java", "diffHunk": "@@ -321,27 +321,32 @@ public void initializeStreamWriters(final EventStreamClientFactory clientFactory\n \n     private CompletableFuture<Void> truncate(String scope, String stream, RetentionPolicy policy, OperationContext context,\n                                              RetentionSet retentionSet, StreamCutRecord newRecord, long recordingTime, long requestId) {\n-        return findTruncationRecord(policy, retentionSet, newRecord, recordingTime)\n-                .map(record -> streamMetadataStore.getStreamCutRecord(scope, stream, record, context, executor)\n-                        .thenCompose(streamCutRecord -> startTruncation(scope, stream, streamCutRecord.getStreamCut(), context, requestId))\n-                        .thenCompose(started -> {\n-                            if (started) {\n-                                return streamMetadataStore.deleteStreamCutBefore(scope, stream, record, context, executor);\n+        Optional<StreamCutReferenceRecord> truncationRecord = findTruncationRecord(policy, retentionSet, newRecord, recordingTime);\n+        if (!truncationRecord.isPresent()) {\n+            log.info(\"Could not find truncation record for stream {}/{}\", scope, stream);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "9fdc6300668e8b86dadf4b5f3732114360827231"}, "originalPosition": 12}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDU3NDU4ODIz", "url": "https://github.com/pravega/pravega/pull/4991#pullrequestreview-457458823", "createdAt": "2020-07-29T12:11:10Z", "commit": {"oid": "9fdc6300668e8b86dadf4b5f3732114360827231"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "40efa7bb3da7a550a874537648c9fe7672a3bfe1", "author": {"user": {"login": "pbelgundi", "name": "Prajakta Belgundi"}}, "url": "https://github.com/pravega/pravega/commit/40efa7bb3da7a550a874537648c9fe7672a3bfe1", "committedDate": "2020-07-29T12:32:25Z", "message": "code review\n\nSigned-off-by: pbelgundi <prajakta.belgundi@emc.com>"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3994, "cost": 1, "resetAt": "2021-11-01T16:37:27Z"}}}