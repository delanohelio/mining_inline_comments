{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDI0NTg4MDEz", "number": 4829, "title": "Issue 4791: Add a new controller API to fetch segments for a given epoch.", "bodyText": "Change log description\n\nAdd a new controller API to fetch segments for a given epoch.\nEnsure io.pravega.client.stream.impl.TransactionalEventStreamWriterImpl#getTxn API uses this API.\n\nPurpose of the change\nFixes #4791\nWhat the code does\nThe code enables a new GRPC controller API to fetch segments for a given epoch. It also ensures the TransactionalEventStreamWriter uses this API to fetch segments for a given Txn to fetch the segments.\nHow to verify it\nAll the existing and newly added tests should continue to pass.\nNote: Junit tests are being added here.", "createdAt": "2020-05-28T16:07:27Z", "url": "https://github.com/pravega/pravega/pull/4829", "merged": true, "mergeCommit": {"oid": "ea31e677300d1100a3628a3a1b66f844d96cd01e"}, "closed": true, "closedAt": "2020-06-03T02:20:40Z", "author": {"login": "shrids"}, "timelineItems": {"totalCount": 12, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABclrWiggH2gAyNDI0NTg4MDEzOjJhZGRlMDAyYjA3ZDFiMmY4OGEyM2UwYzFkOWVjMzNiZmE2NDBjMzk=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcnWaMXgH2gAyNDI0NTg4MDEzOmUyOTk4YWRlNDMyNDVlOWExYmEzOTczMTQ0MTcwYTk1NjY4ZWQ3MmQ=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "2adde002b07d1b2f88a23e0c1d9ec33bfa640c39", "author": {"user": {"login": "shrids", "name": "Sandeep"}}, "url": "https://github.com/pravega/pravega/commit/2adde002b07d1b2f88a23e0c1d9ec33bfa640c39", "committedDate": "2020-05-28T10:31:49Z", "message": "First Version.\n\nSigned-off-by: Sandeep <sandeep.shridhar@emc.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "9a3df2a87c0fc959afc6cd4764435ac8618ee926", "author": {"user": {"login": "shrids", "name": "Sandeep"}}, "url": "https://github.com/pravega/pravega/commit/9a3df2a87c0fc959afc6cd4764435ac8618ee926", "committedDate": "2020-05-28T16:01:36Z", "message": "Add integration test.\n\nSigned-off-by: Sandeep <sandeep.shridhar@emc.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "4d9a8e832d54a1e2285a05b6942c1e3fce83e779", "author": {"user": {"login": "shrids", "name": "Sandeep"}}, "url": "https://github.com/pravega/pravega/commit/4d9a8e832d54a1e2285a05b6942c1e3fce83e779", "committedDate": "2020-05-28T16:14:02Z", "message": "Merge branch 'master' into issue-4791"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f4b38fa5fb9eaeadcb1ed6273f80bf3730c67f30", "author": {"user": {"login": "shrids", "name": "Sandeep"}}, "url": "https://github.com/pravega/pravega/commit/f4b38fa5fb9eaeadcb1ed6273f80bf3730c67f30", "committedDate": "2020-05-29T03:56:39Z", "message": "Fix checkstyle.\n\nSigned-off-by: Sandeep <sandeep.shridhar@emc.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c651430eb055b76e99f37a2350f77442e0db4e7c", "author": {"user": {"login": "shrids", "name": "Sandeep"}}, "url": "https://github.com/pravega/pravega/commit/c651430eb055b76e99f37a2350f77442e0db4e7c", "committedDate": "2020-05-29T06:48:49Z", "message": "Merge branch 'master' into issue-4791"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "1e0f6c2e3478ed797565069d468b63c1e653f58d", "author": {"user": {"login": "shrids", "name": "Sandeep"}}, "url": "https://github.com/pravega/pravega/commit/1e0f6c2e3478ed797565069d468b63c1e653f58d", "committedDate": "2020-05-29T08:52:16Z", "message": "client junits.\n\nSigned-off-by: Sandeep <sandeep.shridhar@emc.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "aac4cfd233d734a20c4e940305d45b86ebf4085a", "author": {"user": {"login": "shrids", "name": "Sandeep"}}, "url": "https://github.com/pravega/pravega/commit/aac4cfd233d734a20c4e940305d45b86ebf4085a", "committedDate": "2020-05-29T09:10:00Z", "message": "Controller client junits.\n\nSigned-off-by: Sandeep <sandeep.shridhar@emc.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "56d97104fdd871e56f30e9f1b785ae8fc567512e", "author": {"user": {"login": "shrids", "name": "Sandeep"}}, "url": "https://github.com/pravega/pravega/commit/56d97104fdd871e56f30e9f1b785ae8fc567512e", "committedDate": "2020-05-29T09:34:50Z", "message": "Controller junit tests.\n\nSigned-off-by: Sandeep <sandeep.shridhar@emc.com>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDIxMTQyNDA3", "url": "https://github.com/pravega/pravega/pull/4829#pullrequestreview-421142407", "createdAt": "2020-05-29T17:17:26Z", "commit": {"oid": "56d97104fdd871e56f30e9f1b785ae8fc567512e"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d3c8d8dbaab60fae196afb0f05fd508903ce937e", "author": {"user": {"login": "shrids", "name": "Sandeep"}}, "url": "https://github.com/pravega/pravega/commit/d3c8d8dbaab60fae196afb0f05fd508903ce937e", "committedDate": "2020-06-01T02:11:47Z", "message": "Merge branch 'master' into issue-4791"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDIyNzc5MjU2", "url": "https://github.com/pravega/pravega/pull/4829#pullrequestreview-422779256", "createdAt": "2020-06-02T15:12:11Z", "commit": {"oid": "d3c8d8dbaab60fae196afb0f05fd508903ce937e"}, "state": "APPROVED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wMlQxNToxMjoxMlrOGd2YRQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wMlQxNToxMjoxMlrOGd2YRQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMzk1MjgzNw==", "bodyText": "question: why do we need to get the segments for a txn again? when you create a txn, controller returns the txn segments, right?\nso when is this getTxn api useful?", "url": "https://github.com/pravega/pravega/pull/4829#discussion_r433952837", "createdAt": "2020-06-02T15:12:12Z", "author": {"login": "shiveshr"}, "path": "client/src/main/java/io/pravega/client/stream/impl/TransactionalEventStreamWriterImpl.java", "diffHunk": "@@ -198,13 +199,19 @@ private void throwIfClosed() throws TxnFailedException {\n \n     @Override\n     public Transaction<Type> getTxn(UUID txId) {\n-        StreamSegments segments = getAndHandleExceptions(\n-                controller.getCurrentSegments(stream.getScope(), stream.getStreamName()), RuntimeException::new);\n+        // check if the transaction is open.\n         Status status = getAndHandleExceptions(controller.checkTransactionStatus(stream, txId), RuntimeException::new);\n         if (status != Status.OPEN) {\n             return new TransactionImpl<>(writerId, txId, controller, stream);\n         }\n-        \n+", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d3c8d8dbaab60fae196afb0f05fd508903ce937e"}, "originalPosition": 29}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e2998ade43245e9a1ba3973144170a95668ed72d", "author": {"user": {"login": "shiveshr", "name": "shivesh ranjan"}}, "url": "https://github.com/pravega/pravega/commit/e2998ade43245e9a1ba3973144170a95668ed72d", "committedDate": "2020-06-02T15:15:39Z", "message": "Merge branch 'master' into issue-4791"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3506, "cost": 1, "resetAt": "2021-11-01T16:37:27Z"}}}