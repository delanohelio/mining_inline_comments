{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDg4NjI5Mjg5", "number": 5198, "reviewThreads": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xN1QxMzozODoxOVrOEkiqdg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xN1QxMzo1NDowNVrOEkjG8w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzA2NzUyMTE4OnYy", "diffSide": "RIGHT", "path": "controller/src/main/java/io/pravega/controller/store/stream/PersistentStreamBase.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xN1QxMzozODoxOVrOHTirFQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xN1QxMzozODoxOVrOHTirFQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MDI1MzA3Nw==", "bodyText": "Math.min () can be used here ?", "url": "https://github.com/pravega/pravega/pull/5198#discussion_r490253077", "createdAt": "2020-09-17T13:38:19Z", "author": {"login": "shrids"}, "path": "controller/src/main/java/io/pravega/controller/store/stream/PersistentStreamBase.java", "diffHunk": "@@ -1673,7 +1677,11 @@ boolean compareWriterPositions(Map<Long, Long> position1, Map<Long, Long> positi\n             txnIds.add(x.getValue());\n         });\n \n-        return getTransactionRecords(epoch, txnIds).thenAccept(txns -> {\n+        AtomicInteger from = new AtomicInteger(0);\n+        Function<Integer, Integer> tillFunc = f -> f + limit < txnIds.size() ? f + limit : txnIds.size();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b2e0efb39e1e3badf27d0a6ad02782bf0bfb41a8"}, "originalPosition": 62}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzA2NzU5NDExOnYy", "diffSide": "RIGHT", "path": "controller/src/main/java/io/pravega/controller/store/stream/PersistentStreamBase.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xN1QxMzo1NDowNVrOHTjYLg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xN1QxNDo1MToyMFrOHTmY_A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MDI2NDYyMg==", "bodyText": "do we require this check given that the txnIds are not greater than the passed limit ?", "url": "https://github.com/pravega/pravega/pull/5198#discussion_r490264622", "createdAt": "2020-09-17T13:54:05Z", "author": {"login": "shrids"}, "path": "controller/src/main/java/io/pravega/controller/store/stream/PersistentStreamBase.java", "diffHunk": "@@ -1683,6 +1691,9 @@ boolean compareWriterPositions(Map<Long, Long> position1, Map<Long, Long> positi\n                         if (txnRecord.getCommitOrder() == order) {\n                             // if entry matches record's position then include it\n                             transactionsMap.put(txnId, txnRecord);\n+                            if (transactionsMap.size() >= limit) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b2e0efb39e1e3badf27d0a6ad02782bf0bfb41a8"}, "originalPosition": 73}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MDMxMzk4MA==", "bodyText": "transactionsMap is actually accumulating filtered txns from the txnIds across all iterations and the limit s really to be imposed on the number of entries we put in this map as that will be sent back to the caller to use as the batch of transactions", "url": "https://github.com/pravega/pravega/pull/5198#discussion_r490313980", "createdAt": "2020-09-17T14:51:20Z", "author": {"login": "shiveshr"}, "path": "controller/src/main/java/io/pravega/controller/store/stream/PersistentStreamBase.java", "diffHunk": "@@ -1683,6 +1691,9 @@ boolean compareWriterPositions(Map<Long, Long> position1, Map<Long, Long> positi\n                         if (txnRecord.getCommitOrder() == order) {\n                             // if entry matches record's position then include it\n                             transactionsMap.put(txnId, txnRecord);\n+                            if (transactionsMap.size() >= limit) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MDI2NDYyMg=="}, "originalCommit": {"oid": "b2e0efb39e1e3badf27d0a6ad02782bf0bfb41a8"}, "originalPosition": 73}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4701, "cost": 1, "resetAt": "2021-11-13T12:26:42Z"}}}