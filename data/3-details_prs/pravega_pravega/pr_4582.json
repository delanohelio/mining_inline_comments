{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0MzgxMTI4MTQ5", "number": 4582, "title": "Issue-4581: replaced the unsafe while loop with iterator looping", "bodyText": "Signed-off-by: kevinhan88 kevinhan88@gmail.com\nChange log description\nReplaced the unsafe while loop in cleaning up testing registries with iterator, otherwise it may sometimes got concurrentmodificationexception.\nPurpose of the change\nFixes #4581\nWhat the code does\nInside StatsProviderImpl, started using iterator to loop registries inside, and then delete them one by one. However iterator.remove() is not supported.\nHow to verify it\nNo functional changes, all tests should pass.", "createdAt": "2020-02-27T23:41:53Z", "url": "https://github.com/pravega/pravega/pull/4582", "merged": true, "mergeCommit": {"oid": "a3e03c69e0580597a338996046ea010bfc164900"}, "closed": true, "closedAt": "2020-02-28T20:37:52Z", "author": {"login": "kevinhan88"}, "timelineItems": {"totalCount": 10, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcIkDl9gH2gAyMzgxMTI4MTQ5OjI5NWE4OTIyYjg5YzNjZmQ4MGIyOTkyYzhhMzljYTZmOTdhNmQ5ZTE=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcI2EIqAFqTM2NjY3MDI1NA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "295a8922b89c3cfd80b2992c8a39ca6f97a6d9e1", "author": {"user": {"login": "kevinhan88", "name": "Kevin Han"}}, "url": "https://github.com/pravega/pravega/commit/295a8922b89c3cfd80b2992c8a39ca6f97a6d9e1", "committedDate": "2020-02-27T23:37:59Z", "message": "Issue-4581: replaced the unsafe while loop with iterator looping\n\nSigned-off-by: kevinhan88 <kevinhan88@gmail.com>"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": null, "afterCommit": {"oid": "295a8922b89c3cfd80b2992c8a39ca6f97a6d9e1", "author": {"user": {"login": "kevinhan88", "name": "Kevin Han"}}, "url": "https://github.com/pravega/pravega/commit/295a8922b89c3cfd80b2992c8a39ca6f97a6d9e1", "committedDate": "2020-02-27T23:37:59Z", "message": "Issue-4581: replaced the unsafe while loop with iterator looping\n\nSigned-off-by: kevinhan88 <kevinhan88@gmail.com>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzY2MDg4NTA5", "url": "https://github.com/pravega/pravega/pull/4582#pullrequestreview-366088509", "createdAt": "2020-02-28T00:16:13Z", "commit": {"oid": "295a8922b89c3cfd80b2992c8a39ca6f97a6d9e1"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "cd07934ae65721ffa9f60f1182486a4261ae8729", "author": {"user": {"login": "RaulGracia", "name": "Ra\u00fal Gracia"}}, "url": "https://github.com/pravega/pravega/commit/cd07934ae65721ffa9f60f1182486a4261ae8729", "committedDate": "2020-02-28T08:27:26Z", "message": "Merge branch 'master' into issue-4581"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "8b2eb855b62124446410b0b09927b0f0f000620b", "author": {"user": {"login": "andreipaduroiu", "name": "Andrei Paduroiu"}}, "url": "https://github.com/pravega/pravega/commit/8b2eb855b62124446410b0b09927b0f0f000620b", "committedDate": "2020-02-28T15:21:38Z", "message": "Merge branch 'master' into issue-4581"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzY2NDc1NjI2", "url": "https://github.com/pravega/pravega/pull/4582#pullrequestreview-366475626", "createdAt": "2020-02-28T15:22:46Z", "commit": {"oid": "cd07934ae65721ffa9f60f1182486a4261ae8729"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yOFQxNToyMzowMFrOFv4oug==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yOFQxNToyMzowMFrOFv4oug==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NTc1NTMyMg==", "bodyText": "I don't understand how this is any different from the code before. for(X : Y) is invoking Y.iterator() and looping through it.\nWhat am I missing?", "url": "https://github.com/pravega/pravega/pull/4582#discussion_r385755322", "createdAt": "2020-02-28T15:23:00Z", "author": {"login": "andreipaduroiu"}, "path": "shared/metrics/src/main/java/io/pravega/shared/metrics/StatsProviderImpl.java", "diffHunk": "@@ -75,9 +77,12 @@ public void start() {\n     @Synchronized\n     @Override\n     public void startWithoutExporting() {\n-        for (MeterRegistry registry : metrics.getRegistries()) {\n-            metrics.remove(registry);\n+\n+        Iterator<MeterRegistry> iterator = metrics.getRegistries().iterator();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "8b2eb855b62124446410b0b09927b0f0f000620b"}, "originalPosition": 16}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "630c88bf30ae672d1e3dd13eedcf5f5aef3c660c", "author": {"user": {"login": "kevinhan88", "name": "Kevin Han"}}, "url": "https://github.com/pravega/pravega/commit/630c88bf30ae672d1e3dd13eedcf5f5aef3c660c", "committedDate": "2020-02-28T19:13:13Z", "message": "Issue 4581: kept improving the handling of registry deletion\n\nSigned-off-by: kevinhan88 <kevinhan88@gmail.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "44ea37bc51ada25c06722c9e6082afcb4c63f330", "author": {"user": {"login": "kevinhan88", "name": "Kevin Han"}}, "url": "https://github.com/pravega/pravega/commit/44ea37bc51ada25c06722c9e6082afcb4c63f330", "committedDate": "2020-02-28T19:14:32Z", "message": "Merge branch 'issue-4581' of https://github.com/kevinhan88/pravega into issue-4581"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzY2NjM4MzA4", "url": "https://github.com/pravega/pravega/pull/4582#pullrequestreview-366638308", "createdAt": "2020-02-28T19:37:59Z", "commit": {"oid": "44ea37bc51ada25c06722c9e6082afcb4c63f330"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzY2NjcwMjU0", "url": "https://github.com/pravega/pravega/pull/4582#pullrequestreview-366670254", "createdAt": "2020-02-28T20:36:52Z", "commit": {"oid": "44ea37bc51ada25c06722c9e6082afcb4c63f330"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3604, "cost": 1, "resetAt": "2021-11-01T16:37:27Z"}}}