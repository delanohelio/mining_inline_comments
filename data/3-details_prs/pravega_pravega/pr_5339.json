{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTIyMTkwNzMw", "number": 5339, "title": "Issue 5257 and 5118: Improve organization of security code for reuse in related projects like Schema Registry", "bodyText": "Change log description\nReorganizes security code for easier reuse in related projects like Schema Registry.\nPurpose of the change\nResolves #5257 and #5118.\nWhat the code does\nHere's what it does:\n\nMoves out the password-based auth handler that supports HTTP Basic Authentication into its own Gradle module shared:basic-authplugin. This enables other projects to use the auth handler if needed.\nMoves reusable classes from controller and client into shared:security. That makes it possible to use them across projects, without needing to have a dependency on the Controller.\nModifies the Auth Handler plugin interface to inject configurations to plugins via properties, thereby removing their dependency to Controller / GRPCServerConfig class. Projects that want to use the handler no more need to have a dependency on the Controller for this. (This implies that other projects with Auth handler implementations will need to change their code too.)\n\nHow to verify it\nAll unit, integration and system tests must pass.", "createdAt": "2020-11-17T07:02:01Z", "url": "https://github.com/pravega/pravega/pull/5339", "merged": true, "mergeCommit": {"oid": "0e77c81a09a2f6019499259de7fa002398a3dc90"}, "closed": true, "closedAt": "2020-11-23T11:06:09Z", "author": {"login": "ravisharda"}, "timelineItems": {"totalCount": 28, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdc_i1dgH2gAyNTIyMTkwNzMwOjRjYWZiN2VkZjQzMzdmZjYyZmFhNWVmYjA4ZjZlYmVjYWQ4M2M3M2I=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdfQoNIgH2gAyNTIyMTkwNzMwOjYwMGQwMDIyYWEyYjI3M2Y0NjYzMmE2MjdiY2ZlNjE3NmM2MjE2ZGI=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "4cafb7edf4337ff62faa5efb08f6ebecad83c73b", "author": {"user": {"login": "ravisharda", "name": "Ravi Sharda"}}, "url": "https://github.com/pravega/pravega/commit/4cafb7edf4337ff62faa5efb08f6ebecad83c73b", "committedDate": "2020-11-16T07:09:11Z", "message": "Initial changes for moving authplugin into its own separate module\n\nSigned-off-by: rsharda <ravi.sharda@emc.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "4670c8d330df92d7f4fb1dd3ceecf36bfe962de6", "author": {"user": {"login": "ravisharda", "name": "Ravi Sharda"}}, "url": "https://github.com/pravega/pravega/commit/4670c8d330df92d7f4fb1dd3ceecf36bfe962de6", "committedDate": "2020-11-17T02:04:43Z", "message": "Provide config to auth handler properties\n\nSigned-off-by: rsharda <ravi.sharda@emc.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "454a41ce73ea2a16f806137e966fe0236d8d9310", "author": {"user": {"login": "ravisharda", "name": "Ravi Sharda"}}, "url": "https://github.com/pravega/pravega/commit/454a41ce73ea2a16f806137e966fe0236d8d9310", "committedDate": "2020-11-17T06:02:09Z", "message": "Moce `Credentials` interface to `:shared:security` and `StrongPasswordProcessor` to appropriate package.\n\nSigned-off-by: rsharda <ravi.sharda@emc.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "bd38e7bc886382c8bbc876374618a40c894c1346", "author": {"user": {"login": "ravisharda", "name": "Ravi Sharda"}}, "url": "https://github.com/pravega/pravega/commit/bd38e7bc886382c8bbc876374618a40c894c1346", "committedDate": "2020-11-17T07:05:01Z", "message": "Merge branch 'master' into issue-5257"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b26cb74ec70fcfb3454000c811d6258a279e82dc", "author": {"user": {"login": "ravisharda", "name": "Ravi Sharda"}}, "url": "https://github.com/pravega/pravega/commit/b26cb74ec70fcfb3454000c811d6258a279e82dc", "committedDate": "2020-11-17T07:56:21Z", "message": "Move authorization resource to `:shared:security` module.\n\nSigned-off-by: rsharda <ravi.sharda@emc.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "1588f8275858695b70b9c2f65c3b6063f1ed1267", "author": {"user": {"login": "ravisharda", "name": "Ravi Sharda"}}, "url": "https://github.com/pravega/pravega/commit/1588f8275858695b70b9c2f65c3b6063f1ed1267", "committedDate": "2020-11-18T05:47:33Z", "message": "Extract auth handler properties into a constants file and add tests.\n\nSigned-off-by: rsharda <ravi.sharda@emc.com>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTM0MTM0MTM1", "url": "https://github.com/pravega/pravega/pull/5339#pullrequestreview-534134135", "createdAt": "2020-11-19T07:13:46Z", "commit": {"oid": "1588f8275858695b70b9c2f65c3b6063f1ed1267"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xOVQwNzoxMzo0N1rOH2PfrA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xOVQwNzoxMzo0N1rOH2PfrA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNjYzOTAyMA==", "bodyText": "what is password-authplugin?\nalso since its shared:basic-authplugin, what is this include for basic-authplugin?", "url": "https://github.com/pravega/pravega/pull/5339#discussion_r526639020", "createdAt": "2020-11-19T07:13:47Z", "author": {"login": "shiveshr"}, "path": "settings.gradle", "diffHunk": "@@ -31,4 +32,7 @@ include 'common',\n         'test:testcommon',\n         'test:integration',\n         'test:system',\n-        'bindings'\n\\ No newline at end of file\n+        'bindings'\n+include 'password-authplugin'", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "1588f8275858695b70b9c2f65c3b6063f1ed1267"}, "originalPosition": 15}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTM0MTM2NzU3", "url": "https://github.com/pravega/pravega/pull/5339#pullrequestreview-534136757", "createdAt": "2020-11-19T07:19:05Z", "commit": {"oid": "1588f8275858695b70b9c2f65c3b6063f1ed1267"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "7db6b99e79cabace917486e5a89e603aa14e04d2", "author": {"user": {"login": "shiveshr", "name": "shivesh ranjan"}}, "url": "https://github.com/pravega/pravega/commit/7db6b99e79cabace917486e5a89e603aa14e04d2", "committedDate": "2020-11-19T07:19:36Z", "message": "Merge branch 'master' into issue-5257"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d64a9f63d43622c74c77908e2ab46f331c8b2882", "author": {"user": {"login": "ravisharda", "name": "Ravi Sharda"}}, "url": "https://github.com/pravega/pravega/commit/d64a9f63d43622c74c77908e2ab46f331c8b2882", "committedDate": "2020-11-19T07:39:24Z", "message": "Remove leftover lines added by IDE\n\nSigned-off-by: rsharda <ravi.sharda@emc.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ebcacdd0e8ab74cf14fb09a97b8380909662cf40", "author": {"user": {"login": "ravisharda", "name": "Ravi Sharda"}}, "url": "https://github.com/pravega/pravega/commit/ebcacdd0e8ab74cf14fb09a97b8380909662cf40", "committedDate": "2020-11-19T07:39:38Z", "message": "Merge remote-tracking branch 'origin/issue-5257' into issue-5257"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b67e781bade5de613b48e445a4261a31ed70b76f", "author": {"user": {"login": "ravisharda", "name": "Ravi Sharda"}}, "url": "https://github.com/pravega/pravega/commit/b67e781bade5de613b48e445a4261a31ed70b76f", "committedDate": "2020-11-19T10:58:28Z", "message": "Merge branch 'master' into issue-5257"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "1c9b527b55c8ca85e8d239c34c9cb1d77656b176", "author": {"user": {"login": "ravisharda", "name": "Ravi Sharda"}}, "url": "https://github.com/pravega/pravega/commit/1c9b527b55c8ca85e8d239c34c9cb1d77656b176", "committedDate": "2020-11-20T03:28:25Z", "message": "Merge branch 'master' into issue-5257"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTM1MDg0MDIy", "url": "https://github.com/pravega/pravega/pull/5339#pullrequestreview-535084022", "createdAt": "2020-11-20T04:59:00Z", "commit": {"oid": "1c9b527b55c8ca85e8d239c34c9cb1d77656b176"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0yMFQwNDo1OTowMVrOH290yA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0yMFQwNDo1OTowMVrOH290yA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNzM5ODA4OA==", "bodyText": "as discussed, we should keep the interface for auth handler unchanged so that dependents do not have to update.\nwe can add a new method in the serverconfig to get properties.", "url": "https://github.com/pravega/pravega/pull/5339#discussion_r527398088", "createdAt": "2020-11-20T04:59:01Z", "author": {"login": "shiveshr"}, "path": "controller/src/main/java/io/pravega/controller/server/security/auth/handler/AuthHandlerManager.java", "diffHunk": "@@ -157,7 +157,7 @@ public void registerInterceptors(ServerBuilder<?> builder) {\n                 ServiceLoader<AuthHandler> loader = ServiceLoader.load(AuthHandler.class);\n                 for (AuthHandler handler : loader) {\n                     try {\n-                        handler.initialize(serverConfig);\n+                        handler.initialize(serverConfig.toAuthHandlerProperties());", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "1c9b527b55c8ca85e8d239c34c9cb1d77656b176"}, "originalPosition": 5}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTM1MDg2MDU1", "url": "https://github.com/pravega/pravega/pull/5339#pullrequestreview-535086055", "createdAt": "2020-11-20T05:00:09Z", "commit": {"oid": "1c9b527b55c8ca85e8d239c34c9cb1d77656b176"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0yMFQwNTowMDowOVrOH2919A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0yMFQwNTowMDowOVrOH2919A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNzM5ODM4OA==", "bodyText": "lets keep the interface signature same. lets change ServerConfig to add a new API for getting properties.", "url": "https://github.com/pravega/pravega/pull/5339#discussion_r527398388", "createdAt": "2020-11-20T05:00:09Z", "author": {"login": "shiveshr"}, "path": "shared/authplugin/src/main/java/io/pravega/auth/AuthHandler.java", "diffHunk": "@@ -69,7 +70,9 @@\n     /**\n      * Sets the configuration. If the auth handler needs to access the server configuration, it can be accessed though this var.\n      *\n-     * @param serverConfig The server configuration.\n+     * @param properties The auth handler configuration.\n      */\n-    void initialize(ServerConfig serverConfig);\n+    default void initialize(Properties properties) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "1c9b527b55c8ca85e8d239c34c9cb1d77656b176"}, "originalPosition": 16}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTM1MDg2NjE5", "url": "https://github.com/pravega/pravega/pull/5339#pullrequestreview-535086619", "createdAt": "2020-11-20T05:00:29Z", "commit": {"oid": "1c9b527b55c8ca85e8d239c34c9cb1d77656b176"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f58f8821e9686cfd4695cce9d478c74c99d695c8", "author": {"user": {"login": "shiveshr", "name": "shivesh ranjan"}}, "url": "https://github.com/pravega/pravega/commit/f58f8821e9686cfd4695cce9d478c74c99d695c8", "committedDate": "2020-11-20T05:02:13Z", "message": "Merge branch 'master' into issue-5257"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "4aeed21127cd650084e3329831b9343db13f1fad", "author": {"user": {"login": "ravisharda", "name": "Ravi Sharda"}}, "url": "https://github.com/pravega/pravega/commit/4aeed21127cd650084e3329831b9343db13f1fad", "committedDate": "2020-11-20T12:02:09Z", "message": "Modify the changes avoid change in Auth Handler interface\n\nSigned-off-by: rsharda <ravi.sharda@emc.com>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTM1Mzc2NTEz", "url": "https://github.com/pravega/pravega/pull/5339#pullrequestreview-535376513", "createdAt": "2020-11-20T12:12:41Z", "commit": {"oid": "4aeed21127cd650084e3329831b9343db13f1fad"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTM1NDc0NTc5", "url": "https://github.com/pravega/pravega/pull/5339#pullrequestreview-535474579", "createdAt": "2020-11-20T14:29:09Z", "commit": {"oid": "4aeed21127cd650084e3329831b9343db13f1fad"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0yMFQxNDoyOTowOVrOH3SAoQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0yMFQxNDoyOTowOVrOH3SAoQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNzcyODgwMQ==", "bodyText": "Just to confirm my understanding of the dependency changes by taking a concrete example of an existing implementation:\nhttps://github.com/pravega/pravega-keycloak/blob/master/build.gradle\nIs it correct to say that in the above's:\n dependencies {\n        compileOnly \"org.slf4j:slf4j-api:${slf4jVersion}\"\n        compileOnly \"io.pravega:pravega-shared-authplugin:${pravegaVersion}\"\n        compileOnly \"io.pravega:pravega-client:${pravegaVersion}\"\n        implementation 'org.keycloak:keycloak-authz-client'\n...\n\nit would now become:\n dependencies {\n        compileOnly \"org.slf4j:slf4j-api:${slf4jVersion}\"\n        compileOnly \"io.pravega:pravega-shared-security:${pravegaVersion}\"\n        implementation 'org.keycloak:keycloak-authz-client'\n...\n\n?\nThe fact we needed the client and authplugin before was because of this and this respectively:\nhttps://github.com/pravega/pravega-keycloak/blob/master/client/src/main/java/io/pravega/keycloak/client/PravegaKeycloakCredentials.java#L13\nhttps://github.com/pravega/pravega-keycloak/blob/master/client/src/main/java/io/pravega/keycloak/client/PravegaKeycloakCredentials.java#L17\nBut now both would come from the single shared-security module, is that correct?", "url": "https://github.com/pravega/pravega/pull/5339#discussion_r527728801", "createdAt": "2020-11-20T14:29:09Z", "author": {"login": "sarlaccpit"}, "path": "build.gradle", "diffHunk": "@@ -193,10 +193,26 @@ project('shared:authplugin') {\n     }\n }\n \n+project('shared:basic-authplugin') {\n+    dependencies {\n+        compile project(':common')\n+        compile project(':shared:authplugin')\n+        compile project(':shared:security')\n+    }\n+\n+    javadoc {\n+        title = \"AuthHandler supporting HTTP Basic Authentication\"\n+        dependsOn delombok\n+        source = delombok.outputDir\n+        failOnError = true\n+    }\n+}\n+\n project('shared:security') {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "4aeed21127cd650084e3329831b9343db13f1fad"}, "originalPosition": 19}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTM1Njk3MTMw", "url": "https://github.com/pravega/pravega/pull/5339#pullrequestreview-535697130", "createdAt": "2020-11-20T18:55:46Z", "commit": {"oid": "4aeed21127cd650084e3329831b9343db13f1fad"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "183426c0707bedc1cd31991fcaf441ee51d1d272", "author": {"user": {"login": "ravisharda", "name": "Ravi Sharda"}}, "url": "https://github.com/pravega/pravega/commit/183426c0707bedc1cd31991fcaf441ee51d1d272", "committedDate": "2020-11-21T01:46:22Z", "message": "Merge branch 'master' into issue-5257"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "1018aab39f94beda6c3e7593cf883e70212d85bf", "author": {"user": {"login": "ravisharda", "name": "Ravi Sharda"}}, "url": "https://github.com/pravega/pravega/commit/1018aab39f94beda6c3e7593cf883e70212d85bf", "committedDate": "2020-11-22T05:40:49Z", "message": "Add tests\n\nSigned-off-by: rsharda <ravi.sharda@emc.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "8600ae70124d694811c01a8841ecad373a107609", "author": {"user": {"login": "ravisharda", "name": "Ravi Sharda"}}, "url": "https://github.com/pravega/pravega/commit/8600ae70124d694811c01a8841ecad373a107609", "committedDate": "2020-11-22T05:41:21Z", "message": "Merge remote-tracking branch 'origin/issue-5257' into issue-5257"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "838aa67894ea8b6191e604c7466c53d1b0a99fe6", "author": {"user": {"login": "ravisharda", "name": "Ravi Sharda"}}, "url": "https://github.com/pravega/pravega/commit/838aa67894ea8b6191e604c7466c53d1b0a99fe6", "committedDate": "2020-11-23T04:23:22Z", "message": "Add tests and relocate a test utility\n\nSigned-off-by: rsharda <ravi.sharda@emc.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b65f79b7421a8a1ae383dffef1379ab7129c3478", "author": {"user": {"login": "ravisharda", "name": "Ravi Sharda"}}, "url": "https://github.com/pravega/pravega/commit/b65f79b7421a8a1ae383dffef1379ab7129c3478", "committedDate": "2020-11-23T04:23:38Z", "message": "Merge branch 'master' into issue-5257"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "0a3a81013abebb9f41eff5e3c1670a31fe1dc7d0", "author": {"user": {"login": "ravisharda", "name": "Ravi Sharda"}}, "url": "https://github.com/pravega/pravega/commit/0a3a81013abebb9f41eff5e3c1670a31fe1dc7d0", "committedDate": "2020-11-23T08:11:08Z", "message": "Add tests\n\nSigned-off-by: rsharda <ravi.sharda@emc.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "600d0022aa2b273f46632a627bcfe6176c6216db", "author": {"user": {"login": "ravisharda", "name": "Ravi Sharda"}}, "url": "https://github.com/pravega/pravega/commit/600d0022aa2b273f46632a627bcfe6176c6216db", "committedDate": "2020-11-23T08:11:17Z", "message": "Merge remote-tracking branch 'origin/issue-5257' into issue-5257"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3737, "cost": 1, "resetAt": "2021-11-01T16:37:27Z"}}}