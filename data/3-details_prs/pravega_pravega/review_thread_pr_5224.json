{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDk1MDA1MDcz", "number": 5224, "reviewThreads": {"totalCount": 16, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0zMFQxNTowOTozMVrOEpE8Ig==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yNlQxOTozNjoxOVrOEyDqVQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzExNTA4MDAyOnYy", "diffSide": "RIGHT", "path": "test/system/src/main/java/io/pravega/test/system/framework/services/marathon/PravegaControllerService.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0zMFQxNTowOTozMVrOHaiXNg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0zMFQxOTo1Mzo0M1rOHatBeA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NzU4ODAyMg==", "bodyText": "This is not consistent with the PR description.\nIn the description you say \"remove Controller dependencies\".\nHere, you are removing references from the System test package to the Controller.\nA few issues that I'd like resolved:\n\nMake the PR description consistent with the contents of the PR.\nRemove the dependency on the controller project from this project's build.gradle section.\nI am concerned that this change in particular (swapping Config.* with hardcoded strings) will break if we make a change to those properties at one point.", "url": "https://github.com/pravega/pravega/pull/5224#discussion_r497588022", "createdAt": "2020-09-30T15:09:31Z", "author": {"login": "andreipaduroiu"}, "path": "test/system/src/main/java/io/pravega/test/system/framework/services/marathon/PravegaControllerService.java", "diffHunk": "@@ -122,18 +121,18 @@ private App createPravegaControllerApp() {\n \n         String componentCode = \"controller\";\n \n-        //set env\n+        // These properties are defined in \"io.pravega.controller.util.Config\".", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "adf617b7ede2d9b7cbeee3d01c418e3727e1ab96"}, "originalPosition": 13}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5Nzc2MjY4MA==", "bodyText": "In response to 3: Certainly a possibility. I took inspiration from PravegaSegmentStoreService.java which also uses hard-coded values to set config options. Can certainly refactor the controller's Config class into a shared package if that's a better approach.", "url": "https://github.com/pravega/pravega/pull/5224#discussion_r497762680", "createdAt": "2020-09-30T19:53:43Z", "author": {"login": "co-jo"}, "path": "test/system/src/main/java/io/pravega/test/system/framework/services/marathon/PravegaControllerService.java", "diffHunk": "@@ -122,18 +121,18 @@ private App createPravegaControllerApp() {\n \n         String componentCode = \"controller\";\n \n-        //set env\n+        // These properties are defined in \"io.pravega.controller.util.Config\".", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NzU4ODAyMg=="}, "originalCommit": {"oid": "adf617b7ede2d9b7cbeee3d01c418e3727e1ab96"}, "originalPosition": 13}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzEyNjQ3MjUyOnYy", "diffSide": "RIGHT", "path": "test/system/src/main/java/io/pravega/test/system/framework/services/marathon/PravegaControllerService.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wNVQwNToxNDoyNFrOHcN3SA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wNVQwNToxNDoyNFrOHcN3SA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5OTM0OTMyMA==", "bodyText": "nit: This comment is unnecessary and slightly problematic:\n\nThe target class may be refactored with a change in name and namespace, and this comment will then go stale. Ideally, classes should be referenced using a @link annotation (when used in JavaDocs) or the like.\nA simple text search will easily locate the class where these properties are located, so it shouldn't be necessary to tell the source of these properties.", "url": "https://github.com/pravega/pravega/pull/5224#discussion_r499349320", "createdAt": "2020-10-05T05:14:24Z", "author": {"login": "ravisharda"}, "path": "test/system/src/main/java/io/pravega/test/system/framework/services/marathon/PravegaControllerService.java", "diffHunk": "@@ -122,18 +121,18 @@ private App createPravegaControllerApp() {\n \n         String componentCode = \"controller\";\n \n-        //set env\n+        // These properties are defined in \"io.pravega.controller.util.Config\".", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "7517e565643e7690504daa7a88b2af916a0211eb"}, "originalPosition": 13}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzEyNjQ4MzM4OnYy", "diffSide": "RIGHT", "path": "test/system/src/main/java/io/pravega/test/system/framework/services/marathon/PravegaControllerService.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wNVQwNToyMToyN1rOHcN9LQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wNVQwNToyMToyN1rOHcN9LQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5OTM1MDgyOQ==", "bodyText": "There is a lot of code repetition here. Extracting this out to a method that takes only the config name and the value and assumes the component code can simplify this:\njavaSysPropertyEntryAsString(\"zk.connect.uri\", zk)\n\np.s.: The name of the method setSystemProperty() is also misleading. It doesn't really \"set the system property\", but rather returns a newly created string representing the system property (-Dprop=value). But, that's preexisting code, and you may or may not want to  change that too.", "url": "https://github.com/pravega/pravega/pull/5224#discussion_r499350829", "createdAt": "2020-10-05T05:21:27Z", "author": {"login": "ravisharda"}, "path": "test/system/src/main/java/io/pravega/test/system/framework/services/marathon/PravegaControllerService.java", "diffHunk": "@@ -122,18 +121,18 @@ private App createPravegaControllerApp() {\n \n         String componentCode = \"controller\";\n \n-        //set env\n+        // These properties are defined in \"io.pravega.controller.util.Config\".\n         String controllerSystemProperties = \"-Xmx512m\" +\n-                setSystemProperty(Config.PROPERTY_ZK_URL.getFullName(componentCode), zk) +\n-                setSystemProperty(Config.PROPERTY_RPC_HOST.getFullName(componentCode), this.id + \".marathon.mesos\") +\n-                setSystemProperty(Config.PROPERTY_RPC_PORT.getFullName(componentCode), String.valueOf(CONTROLLER_PORT)) +\n-                setSystemProperty(Config.PROPERTY_SERVICE_PORT.getFullName(componentCode), String.valueOf(CONTROLLER_PORT)) +\n-                setSystemProperty(Config.PROPERTY_REST_PORT.getFullName(componentCode), String.valueOf(REST_PORT)) +\n+                setSystemProperty(String.format(\"%s.%s\", componentCode, \"zk.connect.uri\"), zk) +\n+                setSystemProperty(String.format(\"%s.%s\", componentCode, \"service.rpc.published.host.nameOrIp\"), this.id + \".marathon.mesos\") +", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "7517e565643e7690504daa7a88b2af916a0211eb"}, "originalPosition": 21}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzEyNjQ4NDM0OnYy", "diffSide": "LEFT", "path": "test/system/src/test/java/io/pravega/test/system/WatermarkingTest.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wNVQwNToyMjowNFrOHcN9rg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wNVQxODoxMjoyNFrOHcoSHg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5OTM1MDk1OA==", "bodyText": "This PR removes statements in lines 157-161. What is the impact on the test? Given the lines below, it looks like the test is excepted to function without these lines now. But then the question is why were they needed in the first place.\nAm I missing something?", "url": "https://github.com/pravega/pravega/pull/5224#discussion_r499350958", "createdAt": "2020-10-05T05:22:04Z", "author": {"login": "ravisharda"}, "path": "test/system/src/test/java/io/pravega/test/system/WatermarkingTest.java", "diffHunk": "@@ -153,13 +151,6 @@ public void watermarkingTests() throws Exception {\n         Stream streamObj = Stream.of(SCOPE, STREAM);\n         scale(controller, streamObj);\n \n-        // wait until mark stream is created", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "7517e565643e7690504daa7a88b2af916a0211eb"}, "originalPosition": 15}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5OTc4MjE3NA==", "bodyText": "@shiveshr Would be able to explain better, but he mentioned two points to me about this test:\n\nThe WatermarkingStream was originally created lazily so the test had to wait for it to be created, but this is not the case anymore.\nA store exception is never thrown back to the client, so the exception being compared to has no meaning.", "url": "https://github.com/pravega/pravega/pull/5224#discussion_r499782174", "createdAt": "2020-10-05T18:12:24Z", "author": {"login": "co-jo"}, "path": "test/system/src/test/java/io/pravega/test/system/WatermarkingTest.java", "diffHunk": "@@ -153,13 +151,6 @@ public void watermarkingTests() throws Exception {\n         Stream streamObj = Stream.of(SCOPE, STREAM);\n         scale(controller, streamObj);\n \n-        // wait until mark stream is created", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5OTM1MDk1OA=="}, "originalCommit": {"oid": "7517e565643e7690504daa7a88b2af916a0211eb"}, "originalPosition": 15}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzE2NDM5NzgxOnYy", "diffSide": "RIGHT", "path": "test/system/src/test/java/io/pravega/test/system/DynamicRestApiTest.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xNVQwNToyMjo1NVrOHhxLrA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xNVQxODoyNDoyOFrOHiUr_Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNTE3MDg2MA==", "bodyText": "The credentials should be coming from a properties file instead of being hard-coded. As far as I remember, there is a properties file used in system tests that contain properties such as these.", "url": "https://github.com/pravega/pravega/pull/5224#discussion_r505170860", "createdAt": "2020-10-15T05:22:55Z", "author": {"login": "ravisharda"}, "path": "test/system/src/test/java/io/pravega/test/system/DynamicRestApiTest.java", "diffHunk": "@@ -0,0 +1,139 @@\n+/**\n+ * Copyright (c) Dell Inc., or its subsidiaries. All Rights Reserved.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ */\n+package io.pravega.test.system;\n+\n+import com.fasterxml.jackson.jaxrs.json.JacksonJsonProvider;\n+import io.pravega.client.ClientConfig;\n+import io.pravega.client.admin.StreamManager;\n+import io.pravega.client.stream.ScalingPolicy;\n+import io.pravega.client.stream.StreamConfiguration;\n+import io.pravega.client.stream.impl.DefaultCredentials;\n+import lombok.Cleanup;\n+import lombok.extern.slf4j.Slf4j;\n+\n+import io.pravega.test.system.framework.Environment;\n+import io.pravega.test.system.framework.SystemTestRunner;\n+import io.pravega.test.system.framework.Utils;\n+import io.pravega.test.system.framework.services.Service;\n+\n+import java.net.URI;\n+import java.net.URISyntaxException;\n+import java.util.List;\n+import javax.ws.rs.client.Client;\n+import javax.ws.rs.client.ClientBuilder;\n+import javax.ws.rs.client.Invocation;\n+import javax.ws.rs.client.WebTarget;\n+import javax.ws.rs.core.Response;\n+\n+import org.apache.commons.lang3.RandomStringUtils;\n+import org.glassfish.jersey.client.authentication.HttpAuthenticationFeature;\n+import org.junit.Rule;\n+import org.junit.Test;\n+import org.junit.rules.Timeout;\n+import org.junit.runner.RunWith;\n+import mesosphere.marathon.client.MarathonException;\n+\n+import static org.junit.Assert.assertEquals;\n+import static javax.ws.rs.core.Response.Status.OK;\n+import static org.junit.Assert.assertFalse;\n+import static org.junit.Assert.assertNotNull;\n+import static org.junit.Assert.assertTrue;\n+\n+@Slf4j\n+@RunWith(SystemTestRunner.class)\n+public class DynamicRestApiTest extends AbstractSystemTest {\n+\n+    @Rule\n+    public Timeout globalTimeout = Timeout.seconds(5 * 60);\n+\n+    private final Client client;\n+    private WebTarget webTarget;\n+    private String restServerURI;\n+    private String resourceURl;\n+\n+    public DynamicRestApiTest() {\n+\n+        org.glassfish.jersey.client.ClientConfig clientConfig = new org.glassfish.jersey.client.ClientConfig();\n+        clientConfig.register(JacksonJsonProvider.class);\n+        clientConfig.property(\"sun.net.http.allowRestrictedHeaders\", \"true\");\n+\n+        if (Utils.AUTH_ENABLED) {\n+            HttpAuthenticationFeature feature = HttpAuthenticationFeature.basic(\"admin\", \"1111_aaaa\");", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "7a8acb6961e31272b77d863c5f1a88cc3c87d6e9"}, "originalPosition": 68}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNTc1MjU3Mw==", "bodyText": "The properties file suggest that there is token based authentication used with io.pravega.client.ClientConfig, but not this glassfish ClientConfig.", "url": "https://github.com/pravega/pravega/pull/5224#discussion_r505752573", "createdAt": "2020-10-15T18:24:28Z", "author": {"login": "co-jo"}, "path": "test/system/src/test/java/io/pravega/test/system/DynamicRestApiTest.java", "diffHunk": "@@ -0,0 +1,139 @@\n+/**\n+ * Copyright (c) Dell Inc., or its subsidiaries. All Rights Reserved.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ */\n+package io.pravega.test.system;\n+\n+import com.fasterxml.jackson.jaxrs.json.JacksonJsonProvider;\n+import io.pravega.client.ClientConfig;\n+import io.pravega.client.admin.StreamManager;\n+import io.pravega.client.stream.ScalingPolicy;\n+import io.pravega.client.stream.StreamConfiguration;\n+import io.pravega.client.stream.impl.DefaultCredentials;\n+import lombok.Cleanup;\n+import lombok.extern.slf4j.Slf4j;\n+\n+import io.pravega.test.system.framework.Environment;\n+import io.pravega.test.system.framework.SystemTestRunner;\n+import io.pravega.test.system.framework.Utils;\n+import io.pravega.test.system.framework.services.Service;\n+\n+import java.net.URI;\n+import java.net.URISyntaxException;\n+import java.util.List;\n+import javax.ws.rs.client.Client;\n+import javax.ws.rs.client.ClientBuilder;\n+import javax.ws.rs.client.Invocation;\n+import javax.ws.rs.client.WebTarget;\n+import javax.ws.rs.core.Response;\n+\n+import org.apache.commons.lang3.RandomStringUtils;\n+import org.glassfish.jersey.client.authentication.HttpAuthenticationFeature;\n+import org.junit.Rule;\n+import org.junit.Test;\n+import org.junit.rules.Timeout;\n+import org.junit.runner.RunWith;\n+import mesosphere.marathon.client.MarathonException;\n+\n+import static org.junit.Assert.assertEquals;\n+import static javax.ws.rs.core.Response.Status.OK;\n+import static org.junit.Assert.assertFalse;\n+import static org.junit.Assert.assertNotNull;\n+import static org.junit.Assert.assertTrue;\n+\n+@Slf4j\n+@RunWith(SystemTestRunner.class)\n+public class DynamicRestApiTest extends AbstractSystemTest {\n+\n+    @Rule\n+    public Timeout globalTimeout = Timeout.seconds(5 * 60);\n+\n+    private final Client client;\n+    private WebTarget webTarget;\n+    private String restServerURI;\n+    private String resourceURl;\n+\n+    public DynamicRestApiTest() {\n+\n+        org.glassfish.jersey.client.ClientConfig clientConfig = new org.glassfish.jersey.client.ClientConfig();\n+        clientConfig.register(JacksonJsonProvider.class);\n+        clientConfig.property(\"sun.net.http.allowRestrictedHeaders\", \"true\");\n+\n+        if (Utils.AUTH_ENABLED) {\n+            HttpAuthenticationFeature feature = HttpAuthenticationFeature.basic(\"admin\", \"1111_aaaa\");", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNTE3MDg2MA=="}, "originalCommit": {"oid": "7a8acb6961e31272b77d863c5f1a88cc3c87d6e9"}, "originalPosition": 68}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzE2NDM5ODgxOnYy", "diffSide": "RIGHT", "path": "test/system/src/test/java/io/pravega/test/system/DynamicRestApiTest.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xNVQwNToyMzozNFrOHhxMTg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xNVQxODowNjoyNVrOHiT3tw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNTE3MTAyMg==", "bodyText": "The reason why these lines are needed is not immediately apparent. Could you please add some comments that explain them.", "url": "https://github.com/pravega/pravega/pull/5224#discussion_r505171022", "createdAt": "2020-10-15T05:23:34Z", "author": {"login": "ravisharda"}, "path": "test/system/src/test/java/io/pravega/test/system/DynamicRestApiTest.java", "diffHunk": "@@ -0,0 +1,139 @@\n+/**\n+ * Copyright (c) Dell Inc., or its subsidiaries. All Rights Reserved.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ */\n+package io.pravega.test.system;\n+\n+import com.fasterxml.jackson.jaxrs.json.JacksonJsonProvider;\n+import io.pravega.client.ClientConfig;\n+import io.pravega.client.admin.StreamManager;\n+import io.pravega.client.stream.ScalingPolicy;\n+import io.pravega.client.stream.StreamConfiguration;\n+import io.pravega.client.stream.impl.DefaultCredentials;\n+import lombok.Cleanup;\n+import lombok.extern.slf4j.Slf4j;\n+\n+import io.pravega.test.system.framework.Environment;\n+import io.pravega.test.system.framework.SystemTestRunner;\n+import io.pravega.test.system.framework.Utils;\n+import io.pravega.test.system.framework.services.Service;\n+\n+import java.net.URI;\n+import java.net.URISyntaxException;\n+import java.util.List;\n+import javax.ws.rs.client.Client;\n+import javax.ws.rs.client.ClientBuilder;\n+import javax.ws.rs.client.Invocation;\n+import javax.ws.rs.client.WebTarget;\n+import javax.ws.rs.core.Response;\n+\n+import org.apache.commons.lang3.RandomStringUtils;\n+import org.glassfish.jersey.client.authentication.HttpAuthenticationFeature;\n+import org.junit.Rule;\n+import org.junit.Test;\n+import org.junit.rules.Timeout;\n+import org.junit.runner.RunWith;\n+import mesosphere.marathon.client.MarathonException;\n+\n+import static org.junit.Assert.assertEquals;\n+import static javax.ws.rs.core.Response.Status.OK;\n+import static org.junit.Assert.assertFalse;\n+import static org.junit.Assert.assertNotNull;\n+import static org.junit.Assert.assertTrue;\n+\n+@Slf4j\n+@RunWith(SystemTestRunner.class)\n+public class DynamicRestApiTest extends AbstractSystemTest {\n+\n+    @Rule\n+    public Timeout globalTimeout = Timeout.seconds(5 * 60);\n+\n+    private final Client client;\n+    private WebTarget webTarget;\n+    private String restServerURI;\n+    private String resourceURl;\n+\n+    public DynamicRestApiTest() {\n+\n+        org.glassfish.jersey.client.ClientConfig clientConfig = new org.glassfish.jersey.client.ClientConfig();\n+        clientConfig.register(JacksonJsonProvider.class);\n+        clientConfig.property(\"sun.net.http.allowRestrictedHeaders\", \"true\");", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "7a8acb6961e31272b77d863c5f1a88cc3c87d6e9"}, "originalPosition": 65}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNTczOTE5MQ==", "bodyText": "Most of the lines commented on are inherited strictly from the now removed ControllerApiRestTest file, so the original author would need to comment. I'll remove it and see if its still functional.", "url": "https://github.com/pravega/pravega/pull/5224#discussion_r505739191", "createdAt": "2020-10-15T18:06:25Z", "author": {"login": "co-jo"}, "path": "test/system/src/test/java/io/pravega/test/system/DynamicRestApiTest.java", "diffHunk": "@@ -0,0 +1,139 @@\n+/**\n+ * Copyright (c) Dell Inc., or its subsidiaries. All Rights Reserved.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ */\n+package io.pravega.test.system;\n+\n+import com.fasterxml.jackson.jaxrs.json.JacksonJsonProvider;\n+import io.pravega.client.ClientConfig;\n+import io.pravega.client.admin.StreamManager;\n+import io.pravega.client.stream.ScalingPolicy;\n+import io.pravega.client.stream.StreamConfiguration;\n+import io.pravega.client.stream.impl.DefaultCredentials;\n+import lombok.Cleanup;\n+import lombok.extern.slf4j.Slf4j;\n+\n+import io.pravega.test.system.framework.Environment;\n+import io.pravega.test.system.framework.SystemTestRunner;\n+import io.pravega.test.system.framework.Utils;\n+import io.pravega.test.system.framework.services.Service;\n+\n+import java.net.URI;\n+import java.net.URISyntaxException;\n+import java.util.List;\n+import javax.ws.rs.client.Client;\n+import javax.ws.rs.client.ClientBuilder;\n+import javax.ws.rs.client.Invocation;\n+import javax.ws.rs.client.WebTarget;\n+import javax.ws.rs.core.Response;\n+\n+import org.apache.commons.lang3.RandomStringUtils;\n+import org.glassfish.jersey.client.authentication.HttpAuthenticationFeature;\n+import org.junit.Rule;\n+import org.junit.Test;\n+import org.junit.rules.Timeout;\n+import org.junit.runner.RunWith;\n+import mesosphere.marathon.client.MarathonException;\n+\n+import static org.junit.Assert.assertEquals;\n+import static javax.ws.rs.core.Response.Status.OK;\n+import static org.junit.Assert.assertFalse;\n+import static org.junit.Assert.assertNotNull;\n+import static org.junit.Assert.assertTrue;\n+\n+@Slf4j\n+@RunWith(SystemTestRunner.class)\n+public class DynamicRestApiTest extends AbstractSystemTest {\n+\n+    @Rule\n+    public Timeout globalTimeout = Timeout.seconds(5 * 60);\n+\n+    private final Client client;\n+    private WebTarget webTarget;\n+    private String restServerURI;\n+    private String resourceURl;\n+\n+    public DynamicRestApiTest() {\n+\n+        org.glassfish.jersey.client.ClientConfig clientConfig = new org.glassfish.jersey.client.ClientConfig();\n+        clientConfig.register(JacksonJsonProvider.class);\n+        clientConfig.property(\"sun.net.http.allowRestrictedHeaders\", \"true\");", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNTE3MTAyMg=="}, "originalCommit": {"oid": "7a8acb6961e31272b77d863c5f1a88cc3c87d6e9"}, "originalPosition": 65}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzE2NDQwNTg5OnYy", "diffSide": "RIGHT", "path": "test/system/src/test/java/io/pravega/test/system/DynamicRestApiTest.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xNVQwNToyNjo0OFrOHhxQXg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xNVQwNToyNjo0OFrOHhxQXg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNTE3MjA2Mg==", "bodyText": "Why don't we just call this controllerService? That'd reduce the work needed by readers of the code where this variable is used.", "url": "https://github.com/pravega/pravega/pull/5224#discussion_r505172062", "createdAt": "2020-10-15T05:26:48Z", "author": {"login": "ravisharda"}, "path": "test/system/src/test/java/io/pravega/test/system/DynamicRestApiTest.java", "diffHunk": "@@ -0,0 +1,139 @@\n+/**\n+ * Copyright (c) Dell Inc., or its subsidiaries. All Rights Reserved.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ */\n+package io.pravega.test.system;\n+\n+import com.fasterxml.jackson.jaxrs.json.JacksonJsonProvider;\n+import io.pravega.client.ClientConfig;\n+import io.pravega.client.admin.StreamManager;\n+import io.pravega.client.stream.ScalingPolicy;\n+import io.pravega.client.stream.StreamConfiguration;\n+import io.pravega.client.stream.impl.DefaultCredentials;\n+import lombok.Cleanup;\n+import lombok.extern.slf4j.Slf4j;\n+\n+import io.pravega.test.system.framework.Environment;\n+import io.pravega.test.system.framework.SystemTestRunner;\n+import io.pravega.test.system.framework.Utils;\n+import io.pravega.test.system.framework.services.Service;\n+\n+import java.net.URI;\n+import java.net.URISyntaxException;\n+import java.util.List;\n+import javax.ws.rs.client.Client;\n+import javax.ws.rs.client.ClientBuilder;\n+import javax.ws.rs.client.Invocation;\n+import javax.ws.rs.client.WebTarget;\n+import javax.ws.rs.core.Response;\n+\n+import org.apache.commons.lang3.RandomStringUtils;\n+import org.glassfish.jersey.client.authentication.HttpAuthenticationFeature;\n+import org.junit.Rule;\n+import org.junit.Test;\n+import org.junit.rules.Timeout;\n+import org.junit.runner.RunWith;\n+import mesosphere.marathon.client.MarathonException;\n+\n+import static org.junit.Assert.assertEquals;\n+import static javax.ws.rs.core.Response.Status.OK;\n+import static org.junit.Assert.assertFalse;\n+import static org.junit.Assert.assertNotNull;\n+import static org.junit.Assert.assertTrue;\n+\n+@Slf4j\n+@RunWith(SystemTestRunner.class)\n+public class DynamicRestApiTest extends AbstractSystemTest {\n+\n+    @Rule\n+    public Timeout globalTimeout = Timeout.seconds(5 * 60);\n+\n+    private final Client client;\n+    private WebTarget webTarget;\n+    private String restServerURI;\n+    private String resourceURl;\n+\n+    public DynamicRestApiTest() {\n+\n+        org.glassfish.jersey.client.ClientConfig clientConfig = new org.glassfish.jersey.client.ClientConfig();\n+        clientConfig.register(JacksonJsonProvider.class);\n+        clientConfig.property(\"sun.net.http.allowRestrictedHeaders\", \"true\");\n+\n+        if (Utils.AUTH_ENABLED) {\n+            HttpAuthenticationFeature feature = HttpAuthenticationFeature.basic(\"admin\", \"1111_aaaa\");\n+            clientConfig.register(feature);\n+        }\n+\n+        client = ClientBuilder.newClient(clientConfig);\n+    }\n+\n+    /**\n+     * This is used to setup the various services required by the system test framework.\n+     *\n+     * @throws InterruptedException If interrupted\n+     * @throws MarathonException    when error in setup\n+     * @throws URISyntaxException   If URI is invalid\n+     */\n+    @Environment\n+    public static void initialize() throws MarathonException {\n+        URI zkUri = startZookeeperInstance();\n+        startBookkeeperInstances(zkUri);\n+        URI controllerUri = ensureControllerRunning(zkUri);\n+        ensureSegmentStoreRunning(zkUri, controllerUri);\n+    }\n+\n+    @Test\n+    public void listScopes() {\n+        Service conService = Utils.createPravegaControllerService(null);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "7a8acb6961e31272b77d863c5f1a88cc3c87d6e9"}, "originalPosition": 92}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzE2NDQwNzQyOnYy", "diffSide": "RIGHT", "path": "test/system/src/test/java/io/pravega/test/system/DynamicRestApiTest.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xNVQwNToyNzoyNVrOHhxRMw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xNVQwNToyNzoyNVrOHhxRMw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNTE3MjI3NQ==", "bodyText": "controllerURIs'd work better here.", "url": "https://github.com/pravega/pravega/pull/5224#discussion_r505172275", "createdAt": "2020-10-15T05:27:25Z", "author": {"login": "ravisharda"}, "path": "test/system/src/test/java/io/pravega/test/system/DynamicRestApiTest.java", "diffHunk": "@@ -0,0 +1,139 @@\n+/**\n+ * Copyright (c) Dell Inc., or its subsidiaries. All Rights Reserved.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ */\n+package io.pravega.test.system;\n+\n+import com.fasterxml.jackson.jaxrs.json.JacksonJsonProvider;\n+import io.pravega.client.ClientConfig;\n+import io.pravega.client.admin.StreamManager;\n+import io.pravega.client.stream.ScalingPolicy;\n+import io.pravega.client.stream.StreamConfiguration;\n+import io.pravega.client.stream.impl.DefaultCredentials;\n+import lombok.Cleanup;\n+import lombok.extern.slf4j.Slf4j;\n+\n+import io.pravega.test.system.framework.Environment;\n+import io.pravega.test.system.framework.SystemTestRunner;\n+import io.pravega.test.system.framework.Utils;\n+import io.pravega.test.system.framework.services.Service;\n+\n+import java.net.URI;\n+import java.net.URISyntaxException;\n+import java.util.List;\n+import javax.ws.rs.client.Client;\n+import javax.ws.rs.client.ClientBuilder;\n+import javax.ws.rs.client.Invocation;\n+import javax.ws.rs.client.WebTarget;\n+import javax.ws.rs.core.Response;\n+\n+import org.apache.commons.lang3.RandomStringUtils;\n+import org.glassfish.jersey.client.authentication.HttpAuthenticationFeature;\n+import org.junit.Rule;\n+import org.junit.Test;\n+import org.junit.rules.Timeout;\n+import org.junit.runner.RunWith;\n+import mesosphere.marathon.client.MarathonException;\n+\n+import static org.junit.Assert.assertEquals;\n+import static javax.ws.rs.core.Response.Status.OK;\n+import static org.junit.Assert.assertFalse;\n+import static org.junit.Assert.assertNotNull;\n+import static org.junit.Assert.assertTrue;\n+\n+@Slf4j\n+@RunWith(SystemTestRunner.class)\n+public class DynamicRestApiTest extends AbstractSystemTest {\n+\n+    @Rule\n+    public Timeout globalTimeout = Timeout.seconds(5 * 60);\n+\n+    private final Client client;\n+    private WebTarget webTarget;\n+    private String restServerURI;\n+    private String resourceURl;\n+\n+    public DynamicRestApiTest() {\n+\n+        org.glassfish.jersey.client.ClientConfig clientConfig = new org.glassfish.jersey.client.ClientConfig();\n+        clientConfig.register(JacksonJsonProvider.class);\n+        clientConfig.property(\"sun.net.http.allowRestrictedHeaders\", \"true\");\n+\n+        if (Utils.AUTH_ENABLED) {\n+            HttpAuthenticationFeature feature = HttpAuthenticationFeature.basic(\"admin\", \"1111_aaaa\");\n+            clientConfig.register(feature);\n+        }\n+\n+        client = ClientBuilder.newClient(clientConfig);\n+    }\n+\n+    /**\n+     * This is used to setup the various services required by the system test framework.\n+     *\n+     * @throws InterruptedException If interrupted\n+     * @throws MarathonException    when error in setup\n+     * @throws URISyntaxException   If URI is invalid\n+     */\n+    @Environment\n+    public static void initialize() throws MarathonException {\n+        URI zkUri = startZookeeperInstance();\n+        startBookkeeperInstances(zkUri);\n+        URI controllerUri = ensureControllerRunning(zkUri);\n+        ensureSegmentStoreRunning(zkUri, controllerUri);\n+    }\n+\n+    @Test\n+    public void listScopes() {\n+        Service conService = Utils.createPravegaControllerService(null);\n+        List<URI> ctlURIs = conService.getServiceDetails();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "7a8acb6961e31272b77d863c5f1a88cc3c87d6e9"}, "originalPosition": 93}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzE2NDQwODc4OnYy", "diffSide": "RIGHT", "path": "test/system/src/test/java/io/pravega/test/system/DynamicRestApiTest.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xNVQwNToyODoxOVrOHhxSHA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xNVQxODowODoxMFrOHiT7Zg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNTE3MjUwOA==", "bodyText": "What do you intend to do here? It looks like a faulty statement to me.", "url": "https://github.com/pravega/pravega/pull/5224#discussion_r505172508", "createdAt": "2020-10-15T05:28:19Z", "author": {"login": "ravisharda"}, "path": "test/system/src/test/java/io/pravega/test/system/DynamicRestApiTest.java", "diffHunk": "@@ -0,0 +1,139 @@\n+/**\n+ * Copyright (c) Dell Inc., or its subsidiaries. All Rights Reserved.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ */\n+package io.pravega.test.system;\n+\n+import com.fasterxml.jackson.jaxrs.json.JacksonJsonProvider;\n+import io.pravega.client.ClientConfig;\n+import io.pravega.client.admin.StreamManager;\n+import io.pravega.client.stream.ScalingPolicy;\n+import io.pravega.client.stream.StreamConfiguration;\n+import io.pravega.client.stream.impl.DefaultCredentials;\n+import lombok.Cleanup;\n+import lombok.extern.slf4j.Slf4j;\n+\n+import io.pravega.test.system.framework.Environment;\n+import io.pravega.test.system.framework.SystemTestRunner;\n+import io.pravega.test.system.framework.Utils;\n+import io.pravega.test.system.framework.services.Service;\n+\n+import java.net.URI;\n+import java.net.URISyntaxException;\n+import java.util.List;\n+import javax.ws.rs.client.Client;\n+import javax.ws.rs.client.ClientBuilder;\n+import javax.ws.rs.client.Invocation;\n+import javax.ws.rs.client.WebTarget;\n+import javax.ws.rs.core.Response;\n+\n+import org.apache.commons.lang3.RandomStringUtils;\n+import org.glassfish.jersey.client.authentication.HttpAuthenticationFeature;\n+import org.junit.Rule;\n+import org.junit.Test;\n+import org.junit.rules.Timeout;\n+import org.junit.runner.RunWith;\n+import mesosphere.marathon.client.MarathonException;\n+\n+import static org.junit.Assert.assertEquals;\n+import static javax.ws.rs.core.Response.Status.OK;\n+import static org.junit.Assert.assertFalse;\n+import static org.junit.Assert.assertNotNull;\n+import static org.junit.Assert.assertTrue;\n+\n+@Slf4j\n+@RunWith(SystemTestRunner.class)\n+public class DynamicRestApiTest extends AbstractSystemTest {\n+\n+    @Rule\n+    public Timeout globalTimeout = Timeout.seconds(5 * 60);\n+\n+    private final Client client;\n+    private WebTarget webTarget;\n+    private String restServerURI;\n+    private String resourceURl;\n+\n+    public DynamicRestApiTest() {\n+\n+        org.glassfish.jersey.client.ClientConfig clientConfig = new org.glassfish.jersey.client.ClientConfig();\n+        clientConfig.register(JacksonJsonProvider.class);\n+        clientConfig.property(\"sun.net.http.allowRestrictedHeaders\", \"true\");\n+\n+        if (Utils.AUTH_ENABLED) {\n+            HttpAuthenticationFeature feature = HttpAuthenticationFeature.basic(\"admin\", \"1111_aaaa\");\n+            clientConfig.register(feature);\n+        }\n+\n+        client = ClientBuilder.newClient(clientConfig);\n+    }\n+\n+    /**\n+     * This is used to setup the various services required by the system test framework.\n+     *\n+     * @throws InterruptedException If interrupted\n+     * @throws MarathonException    when error in setup\n+     * @throws URISyntaxException   If URI is invalid\n+     */\n+    @Environment\n+    public static void initialize() throws MarathonException {\n+        URI zkUri = startZookeeperInstance();\n+        startBookkeeperInstances(zkUri);\n+        URI controllerUri = ensureControllerRunning(zkUri);\n+        ensureSegmentStoreRunning(zkUri, controllerUri);\n+    }\n+\n+    @Test\n+    public void listScopes() {\n+        Service conService = Utils.createPravegaControllerService(null);\n+        List<URI> ctlURIs = conService.getServiceDetails();\n+        URI controllerRESTUri = ctlURIs.get(1);\n+        Invocation.Builder builder;\n+        Response response;\n+        String protocol = Utils.TLS_AND_AUTH_ENABLED ? \"https://\" : \"http://\";\n+        restServerURI = protocol + controllerRESTUri.getHost() + \":\" + controllerRESTUri.getPort();\n+        log.info(\"REST Server URI: {}\", restServerURI);\n+\n+        assertFalse(true);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "7a8acb6961e31272b77d863c5f1a88cc3c87d6e9"}, "originalPosition": 101}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNTc0MDEzNA==", "bodyText": "This was a mistake, did not mean to commit this.", "url": "https://github.com/pravega/pravega/pull/5224#discussion_r505740134", "createdAt": "2020-10-15T18:08:10Z", "author": {"login": "co-jo"}, "path": "test/system/src/test/java/io/pravega/test/system/DynamicRestApiTest.java", "diffHunk": "@@ -0,0 +1,139 @@\n+/**\n+ * Copyright (c) Dell Inc., or its subsidiaries. All Rights Reserved.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ */\n+package io.pravega.test.system;\n+\n+import com.fasterxml.jackson.jaxrs.json.JacksonJsonProvider;\n+import io.pravega.client.ClientConfig;\n+import io.pravega.client.admin.StreamManager;\n+import io.pravega.client.stream.ScalingPolicy;\n+import io.pravega.client.stream.StreamConfiguration;\n+import io.pravega.client.stream.impl.DefaultCredentials;\n+import lombok.Cleanup;\n+import lombok.extern.slf4j.Slf4j;\n+\n+import io.pravega.test.system.framework.Environment;\n+import io.pravega.test.system.framework.SystemTestRunner;\n+import io.pravega.test.system.framework.Utils;\n+import io.pravega.test.system.framework.services.Service;\n+\n+import java.net.URI;\n+import java.net.URISyntaxException;\n+import java.util.List;\n+import javax.ws.rs.client.Client;\n+import javax.ws.rs.client.ClientBuilder;\n+import javax.ws.rs.client.Invocation;\n+import javax.ws.rs.client.WebTarget;\n+import javax.ws.rs.core.Response;\n+\n+import org.apache.commons.lang3.RandomStringUtils;\n+import org.glassfish.jersey.client.authentication.HttpAuthenticationFeature;\n+import org.junit.Rule;\n+import org.junit.Test;\n+import org.junit.rules.Timeout;\n+import org.junit.runner.RunWith;\n+import mesosphere.marathon.client.MarathonException;\n+\n+import static org.junit.Assert.assertEquals;\n+import static javax.ws.rs.core.Response.Status.OK;\n+import static org.junit.Assert.assertFalse;\n+import static org.junit.Assert.assertNotNull;\n+import static org.junit.Assert.assertTrue;\n+\n+@Slf4j\n+@RunWith(SystemTestRunner.class)\n+public class DynamicRestApiTest extends AbstractSystemTest {\n+\n+    @Rule\n+    public Timeout globalTimeout = Timeout.seconds(5 * 60);\n+\n+    private final Client client;\n+    private WebTarget webTarget;\n+    private String restServerURI;\n+    private String resourceURl;\n+\n+    public DynamicRestApiTest() {\n+\n+        org.glassfish.jersey.client.ClientConfig clientConfig = new org.glassfish.jersey.client.ClientConfig();\n+        clientConfig.register(JacksonJsonProvider.class);\n+        clientConfig.property(\"sun.net.http.allowRestrictedHeaders\", \"true\");\n+\n+        if (Utils.AUTH_ENABLED) {\n+            HttpAuthenticationFeature feature = HttpAuthenticationFeature.basic(\"admin\", \"1111_aaaa\");\n+            clientConfig.register(feature);\n+        }\n+\n+        client = ClientBuilder.newClient(clientConfig);\n+    }\n+\n+    /**\n+     * This is used to setup the various services required by the system test framework.\n+     *\n+     * @throws InterruptedException If interrupted\n+     * @throws MarathonException    when error in setup\n+     * @throws URISyntaxException   If URI is invalid\n+     */\n+    @Environment\n+    public static void initialize() throws MarathonException {\n+        URI zkUri = startZookeeperInstance();\n+        startBookkeeperInstances(zkUri);\n+        URI controllerUri = ensureControllerRunning(zkUri);\n+        ensureSegmentStoreRunning(zkUri, controllerUri);\n+    }\n+\n+    @Test\n+    public void listScopes() {\n+        Service conService = Utils.createPravegaControllerService(null);\n+        List<URI> ctlURIs = conService.getServiceDetails();\n+        URI controllerRESTUri = ctlURIs.get(1);\n+        Invocation.Builder builder;\n+        Response response;\n+        String protocol = Utils.TLS_AND_AUTH_ENABLED ? \"https://\" : \"http://\";\n+        restServerURI = protocol + controllerRESTUri.getHost() + \":\" + controllerRESTUri.getPort();\n+        log.info(\"REST Server URI: {}\", restServerURI);\n+\n+        assertFalse(true);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNTE3MjUwOA=="}, "originalCommit": {"oid": "7a8acb6961e31272b77d863c5f1a88cc3c87d6e9"}, "originalPosition": 101}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzE2NDQwOTgxOnYy", "diffSide": "RIGHT", "path": "test/system/src/test/java/io/pravega/test/system/DynamicRestApiTest.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xNVQwNToyODo0OVrOHhxStw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xNVQwNToyODo0OVrOHhxStw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNTE3MjY2Mw==", "bodyText": "This comment can be better phrased.", "url": "https://github.com/pravega/pravega/pull/5224#discussion_r505172663", "createdAt": "2020-10-15T05:28:49Z", "author": {"login": "ravisharda"}, "path": "test/system/src/test/java/io/pravega/test/system/DynamicRestApiTest.java", "diffHunk": "@@ -0,0 +1,139 @@\n+/**\n+ * Copyright (c) Dell Inc., or its subsidiaries. All Rights Reserved.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ */\n+package io.pravega.test.system;\n+\n+import com.fasterxml.jackson.jaxrs.json.JacksonJsonProvider;\n+import io.pravega.client.ClientConfig;\n+import io.pravega.client.admin.StreamManager;\n+import io.pravega.client.stream.ScalingPolicy;\n+import io.pravega.client.stream.StreamConfiguration;\n+import io.pravega.client.stream.impl.DefaultCredentials;\n+import lombok.Cleanup;\n+import lombok.extern.slf4j.Slf4j;\n+\n+import io.pravega.test.system.framework.Environment;\n+import io.pravega.test.system.framework.SystemTestRunner;\n+import io.pravega.test.system.framework.Utils;\n+import io.pravega.test.system.framework.services.Service;\n+\n+import java.net.URI;\n+import java.net.URISyntaxException;\n+import java.util.List;\n+import javax.ws.rs.client.Client;\n+import javax.ws.rs.client.ClientBuilder;\n+import javax.ws.rs.client.Invocation;\n+import javax.ws.rs.client.WebTarget;\n+import javax.ws.rs.core.Response;\n+\n+import org.apache.commons.lang3.RandomStringUtils;\n+import org.glassfish.jersey.client.authentication.HttpAuthenticationFeature;\n+import org.junit.Rule;\n+import org.junit.Test;\n+import org.junit.rules.Timeout;\n+import org.junit.runner.RunWith;\n+import mesosphere.marathon.client.MarathonException;\n+\n+import static org.junit.Assert.assertEquals;\n+import static javax.ws.rs.core.Response.Status.OK;\n+import static org.junit.Assert.assertFalse;\n+import static org.junit.Assert.assertNotNull;\n+import static org.junit.Assert.assertTrue;\n+\n+@Slf4j\n+@RunWith(SystemTestRunner.class)\n+public class DynamicRestApiTest extends AbstractSystemTest {\n+\n+    @Rule\n+    public Timeout globalTimeout = Timeout.seconds(5 * 60);\n+\n+    private final Client client;\n+    private WebTarget webTarget;\n+    private String restServerURI;\n+    private String resourceURl;\n+\n+    public DynamicRestApiTest() {\n+\n+        org.glassfish.jersey.client.ClientConfig clientConfig = new org.glassfish.jersey.client.ClientConfig();\n+        clientConfig.register(JacksonJsonProvider.class);\n+        clientConfig.property(\"sun.net.http.allowRestrictedHeaders\", \"true\");\n+\n+        if (Utils.AUTH_ENABLED) {\n+            HttpAuthenticationFeature feature = HttpAuthenticationFeature.basic(\"admin\", \"1111_aaaa\");\n+            clientConfig.register(feature);\n+        }\n+\n+        client = ClientBuilder.newClient(clientConfig);\n+    }\n+\n+    /**\n+     * This is used to setup the various services required by the system test framework.\n+     *\n+     * @throws InterruptedException If interrupted\n+     * @throws MarathonException    when error in setup\n+     * @throws URISyntaxException   If URI is invalid\n+     */\n+    @Environment\n+    public static void initialize() throws MarathonException {\n+        URI zkUri = startZookeeperInstance();\n+        startBookkeeperInstances(zkUri);\n+        URI controllerUri = ensureControllerRunning(zkUri);\n+        ensureSegmentStoreRunning(zkUri, controllerUri);\n+    }\n+\n+    @Test\n+    public void listScopes() {\n+        Service conService = Utils.createPravegaControllerService(null);\n+        List<URI> ctlURIs = conService.getServiceDetails();\n+        URI controllerRESTUri = ctlURIs.get(1);\n+        Invocation.Builder builder;\n+        Response response;\n+        String protocol = Utils.TLS_AND_AUTH_ENABLED ? \"https://\" : \"http://\";\n+        restServerURI = protocol + controllerRESTUri.getHost() + \":\" + controllerRESTUri.getPort();\n+        log.info(\"REST Server URI: {}\", restServerURI);\n+\n+        assertFalse(true);\n+\n+        // TEST REST server status, ping test", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "7a8acb6961e31272b77d863c5f1a88cc3c87d6e9"}, "originalPosition": 103}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzE2NDQxNzU3OnYy", "diffSide": "RIGHT", "path": "test/system/src/test/java/io/pravega/test/system/DynamicRestApiTest.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xNVQwNTozMjowM1rOHhxW-Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xNVQwNTozMjowM1rOHhxW-Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNTE3Mzc1Mw==", "bodyText": "The response should be closed too so that the underlying message entity input stream (if available and open) is closed and other resources associated with the response are released. You could perhaps use @Cleanup Lombok annotation for that.", "url": "https://github.com/pravega/pravega/pull/5224#discussion_r505173753", "createdAt": "2020-10-15T05:32:03Z", "author": {"login": "ravisharda"}, "path": "test/system/src/test/java/io/pravega/test/system/DynamicRestApiTest.java", "diffHunk": "@@ -0,0 +1,139 @@\n+/**\n+ * Copyright (c) Dell Inc., or its subsidiaries. All Rights Reserved.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ */\n+package io.pravega.test.system;\n+\n+import com.fasterxml.jackson.jaxrs.json.JacksonJsonProvider;\n+import io.pravega.client.ClientConfig;\n+import io.pravega.client.admin.StreamManager;\n+import io.pravega.client.stream.ScalingPolicy;\n+import io.pravega.client.stream.StreamConfiguration;\n+import io.pravega.client.stream.impl.DefaultCredentials;\n+import lombok.Cleanup;\n+import lombok.extern.slf4j.Slf4j;\n+\n+import io.pravega.test.system.framework.Environment;\n+import io.pravega.test.system.framework.SystemTestRunner;\n+import io.pravega.test.system.framework.Utils;\n+import io.pravega.test.system.framework.services.Service;\n+\n+import java.net.URI;\n+import java.net.URISyntaxException;\n+import java.util.List;\n+import javax.ws.rs.client.Client;\n+import javax.ws.rs.client.ClientBuilder;\n+import javax.ws.rs.client.Invocation;\n+import javax.ws.rs.client.WebTarget;\n+import javax.ws.rs.core.Response;\n+\n+import org.apache.commons.lang3.RandomStringUtils;\n+import org.glassfish.jersey.client.authentication.HttpAuthenticationFeature;\n+import org.junit.Rule;\n+import org.junit.Test;\n+import org.junit.rules.Timeout;\n+import org.junit.runner.RunWith;\n+import mesosphere.marathon.client.MarathonException;\n+\n+import static org.junit.Assert.assertEquals;\n+import static javax.ws.rs.core.Response.Status.OK;\n+import static org.junit.Assert.assertFalse;\n+import static org.junit.Assert.assertNotNull;\n+import static org.junit.Assert.assertTrue;\n+\n+@Slf4j\n+@RunWith(SystemTestRunner.class)\n+public class DynamicRestApiTest extends AbstractSystemTest {\n+\n+    @Rule\n+    public Timeout globalTimeout = Timeout.seconds(5 * 60);\n+\n+    private final Client client;\n+    private WebTarget webTarget;\n+    private String restServerURI;\n+    private String resourceURl;\n+\n+    public DynamicRestApiTest() {\n+\n+        org.glassfish.jersey.client.ClientConfig clientConfig = new org.glassfish.jersey.client.ClientConfig();\n+        clientConfig.register(JacksonJsonProvider.class);\n+        clientConfig.property(\"sun.net.http.allowRestrictedHeaders\", \"true\");\n+\n+        if (Utils.AUTH_ENABLED) {\n+            HttpAuthenticationFeature feature = HttpAuthenticationFeature.basic(\"admin\", \"1111_aaaa\");\n+            clientConfig.register(feature);\n+        }\n+\n+        client = ClientBuilder.newClient(clientConfig);\n+    }\n+\n+    /**\n+     * This is used to setup the various services required by the system test framework.\n+     *\n+     * @throws InterruptedException If interrupted\n+     * @throws MarathonException    when error in setup\n+     * @throws URISyntaxException   If URI is invalid\n+     */\n+    @Environment\n+    public static void initialize() throws MarathonException {\n+        URI zkUri = startZookeeperInstance();\n+        startBookkeeperInstances(zkUri);\n+        URI controllerUri = ensureControllerRunning(zkUri);\n+        ensureSegmentStoreRunning(zkUri, controllerUri);\n+    }\n+\n+    @Test\n+    public void listScopes() {\n+        Service conService = Utils.createPravegaControllerService(null);\n+        List<URI> ctlURIs = conService.getServiceDetails();\n+        URI controllerRESTUri = ctlURIs.get(1);\n+        Invocation.Builder builder;\n+        Response response;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "7a8acb6961e31272b77d863c5f1a88cc3c87d6e9"}, "originalPosition": 96}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzE2NDQzNDMyOnYy", "diffSide": "RIGHT", "path": "test/system/src/test/java/io/pravega/test/system/DynamicRestApiTest.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xNVQwNTozOTo1NlrOHhxgPg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xNVQwNTozOTo1NlrOHhxgPg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNTE3NjEyNg==", "bodyText": "The message won't add much value as it does not tell what is wrong. Ideally, the problem should be immediately apparent when someone looks at the test failure.\nCould you please change the message (for example: \"Received unexpected status code \" + response.getStatus + \" in response to ping request\"", "url": "https://github.com/pravega/pravega/pull/5224#discussion_r505176126", "createdAt": "2020-10-15T05:39:56Z", "author": {"login": "ravisharda"}, "path": "test/system/src/test/java/io/pravega/test/system/DynamicRestApiTest.java", "diffHunk": "@@ -0,0 +1,139 @@\n+/**\n+ * Copyright (c) Dell Inc., or its subsidiaries. All Rights Reserved.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ */\n+package io.pravega.test.system;\n+\n+import com.fasterxml.jackson.jaxrs.json.JacksonJsonProvider;\n+import io.pravega.client.ClientConfig;\n+import io.pravega.client.admin.StreamManager;\n+import io.pravega.client.stream.ScalingPolicy;\n+import io.pravega.client.stream.StreamConfiguration;\n+import io.pravega.client.stream.impl.DefaultCredentials;\n+import lombok.Cleanup;\n+import lombok.extern.slf4j.Slf4j;\n+\n+import io.pravega.test.system.framework.Environment;\n+import io.pravega.test.system.framework.SystemTestRunner;\n+import io.pravega.test.system.framework.Utils;\n+import io.pravega.test.system.framework.services.Service;\n+\n+import java.net.URI;\n+import java.net.URISyntaxException;\n+import java.util.List;\n+import javax.ws.rs.client.Client;\n+import javax.ws.rs.client.ClientBuilder;\n+import javax.ws.rs.client.Invocation;\n+import javax.ws.rs.client.WebTarget;\n+import javax.ws.rs.core.Response;\n+\n+import org.apache.commons.lang3.RandomStringUtils;\n+import org.glassfish.jersey.client.authentication.HttpAuthenticationFeature;\n+import org.junit.Rule;\n+import org.junit.Test;\n+import org.junit.rules.Timeout;\n+import org.junit.runner.RunWith;\n+import mesosphere.marathon.client.MarathonException;\n+\n+import static org.junit.Assert.assertEquals;\n+import static javax.ws.rs.core.Response.Status.OK;\n+import static org.junit.Assert.assertFalse;\n+import static org.junit.Assert.assertNotNull;\n+import static org.junit.Assert.assertTrue;\n+\n+@Slf4j\n+@RunWith(SystemTestRunner.class)\n+public class DynamicRestApiTest extends AbstractSystemTest {\n+\n+    @Rule\n+    public Timeout globalTimeout = Timeout.seconds(5 * 60);\n+\n+    private final Client client;\n+    private WebTarget webTarget;\n+    private String restServerURI;\n+    private String resourceURl;\n+\n+    public DynamicRestApiTest() {\n+\n+        org.glassfish.jersey.client.ClientConfig clientConfig = new org.glassfish.jersey.client.ClientConfig();\n+        clientConfig.register(JacksonJsonProvider.class);\n+        clientConfig.property(\"sun.net.http.allowRestrictedHeaders\", \"true\");\n+\n+        if (Utils.AUTH_ENABLED) {\n+            HttpAuthenticationFeature feature = HttpAuthenticationFeature.basic(\"admin\", \"1111_aaaa\");\n+            clientConfig.register(feature);\n+        }\n+\n+        client = ClientBuilder.newClient(clientConfig);\n+    }\n+\n+    /**\n+     * This is used to setup the various services required by the system test framework.\n+     *\n+     * @throws InterruptedException If interrupted\n+     * @throws MarathonException    when error in setup\n+     * @throws URISyntaxException   If URI is invalid\n+     */\n+    @Environment\n+    public static void initialize() throws MarathonException {\n+        URI zkUri = startZookeeperInstance();\n+        startBookkeeperInstances(zkUri);\n+        URI controllerUri = ensureControllerRunning(zkUri);\n+        ensureSegmentStoreRunning(zkUri, controllerUri);\n+    }\n+\n+    @Test\n+    public void listScopes() {\n+        Service conService = Utils.createPravegaControllerService(null);\n+        List<URI> ctlURIs = conService.getServiceDetails();\n+        URI controllerRESTUri = ctlURIs.get(1);\n+        Invocation.Builder builder;\n+        Response response;\n+        String protocol = Utils.TLS_AND_AUTH_ENABLED ? \"https://\" : \"http://\";\n+        restServerURI = protocol + controllerRESTUri.getHost() + \":\" + controllerRESTUri.getPort();\n+        log.info(\"REST Server URI: {}\", restServerURI);\n+\n+        assertFalse(true);\n+\n+        // TEST REST server status, ping test\n+        resourceURl = new StringBuilder(restServerURI).append(\"/ping\").toString();\n+        webTarget = client.target(resourceURl);\n+        builder = webTarget.request();\n+        response = builder.get();\n+        assertEquals(\"Ping test\", OK.getStatusCode(), response.getStatus());", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "7a8acb6961e31272b77d863c5f1a88cc3c87d6e9"}, "originalPosition": 108}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzE2NDQzOTEwOnYy", "diffSide": "RIGHT", "path": "test/system/src/test/java/io/pravega/test/system/DynamicRestApiTest.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xNVQwNTo0MTo1OVrOHhxi_A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xNVQwNTo0MTo1OVrOHhxi_A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNTE3NjgyOA==", "bodyText": "This log statement is redundant, the control'd only move forward if the previous assertion passes. Regardless of whether the next assertion succeeds or fails, one'd know that the ping was successful.\nHaving said that, it's alright if you want to keep it anyway.", "url": "https://github.com/pravega/pravega/pull/5224#discussion_r505176828", "createdAt": "2020-10-15T05:41:59Z", "author": {"login": "ravisharda"}, "path": "test/system/src/test/java/io/pravega/test/system/DynamicRestApiTest.java", "diffHunk": "@@ -0,0 +1,139 @@\n+/**\n+ * Copyright (c) Dell Inc., or its subsidiaries. All Rights Reserved.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ */\n+package io.pravega.test.system;\n+\n+import com.fasterxml.jackson.jaxrs.json.JacksonJsonProvider;\n+import io.pravega.client.ClientConfig;\n+import io.pravega.client.admin.StreamManager;\n+import io.pravega.client.stream.ScalingPolicy;\n+import io.pravega.client.stream.StreamConfiguration;\n+import io.pravega.client.stream.impl.DefaultCredentials;\n+import lombok.Cleanup;\n+import lombok.extern.slf4j.Slf4j;\n+\n+import io.pravega.test.system.framework.Environment;\n+import io.pravega.test.system.framework.SystemTestRunner;\n+import io.pravega.test.system.framework.Utils;\n+import io.pravega.test.system.framework.services.Service;\n+\n+import java.net.URI;\n+import java.net.URISyntaxException;\n+import java.util.List;\n+import javax.ws.rs.client.Client;\n+import javax.ws.rs.client.ClientBuilder;\n+import javax.ws.rs.client.Invocation;\n+import javax.ws.rs.client.WebTarget;\n+import javax.ws.rs.core.Response;\n+\n+import org.apache.commons.lang3.RandomStringUtils;\n+import org.glassfish.jersey.client.authentication.HttpAuthenticationFeature;\n+import org.junit.Rule;\n+import org.junit.Test;\n+import org.junit.rules.Timeout;\n+import org.junit.runner.RunWith;\n+import mesosphere.marathon.client.MarathonException;\n+\n+import static org.junit.Assert.assertEquals;\n+import static javax.ws.rs.core.Response.Status.OK;\n+import static org.junit.Assert.assertFalse;\n+import static org.junit.Assert.assertNotNull;\n+import static org.junit.Assert.assertTrue;\n+\n+@Slf4j\n+@RunWith(SystemTestRunner.class)\n+public class DynamicRestApiTest extends AbstractSystemTest {\n+\n+    @Rule\n+    public Timeout globalTimeout = Timeout.seconds(5 * 60);\n+\n+    private final Client client;\n+    private WebTarget webTarget;\n+    private String restServerURI;\n+    private String resourceURl;\n+\n+    public DynamicRestApiTest() {\n+\n+        org.glassfish.jersey.client.ClientConfig clientConfig = new org.glassfish.jersey.client.ClientConfig();\n+        clientConfig.register(JacksonJsonProvider.class);\n+        clientConfig.property(\"sun.net.http.allowRestrictedHeaders\", \"true\");\n+\n+        if (Utils.AUTH_ENABLED) {\n+            HttpAuthenticationFeature feature = HttpAuthenticationFeature.basic(\"admin\", \"1111_aaaa\");\n+            clientConfig.register(feature);\n+        }\n+\n+        client = ClientBuilder.newClient(clientConfig);\n+    }\n+\n+    /**\n+     * This is used to setup the various services required by the system test framework.\n+     *\n+     * @throws InterruptedException If interrupted\n+     * @throws MarathonException    when error in setup\n+     * @throws URISyntaxException   If URI is invalid\n+     */\n+    @Environment\n+    public static void initialize() throws MarathonException {\n+        URI zkUri = startZookeeperInstance();\n+        startBookkeeperInstances(zkUri);\n+        URI controllerUri = ensureControllerRunning(zkUri);\n+        ensureSegmentStoreRunning(zkUri, controllerUri);\n+    }\n+\n+    @Test\n+    public void listScopes() {\n+        Service conService = Utils.createPravegaControllerService(null);\n+        List<URI> ctlURIs = conService.getServiceDetails();\n+        URI controllerRESTUri = ctlURIs.get(1);\n+        Invocation.Builder builder;\n+        Response response;\n+        String protocol = Utils.TLS_AND_AUTH_ENABLED ? \"https://\" : \"http://\";\n+        restServerURI = protocol + controllerRESTUri.getHost() + \":\" + controllerRESTUri.getPort();\n+        log.info(\"REST Server URI: {}\", restServerURI);\n+\n+        assertFalse(true);\n+\n+        // TEST REST server status, ping test\n+        resourceURl = new StringBuilder(restServerURI).append(\"/ping\").toString();\n+        webTarget = client.target(resourceURl);\n+        builder = webTarget.request();\n+        response = builder.get();\n+        assertEquals(\"Ping test\", OK.getStatusCode(), response.getStatus());\n+        log.info(\"REST Server is running. Ping successful.\");", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "7a8acb6961e31272b77d863c5f1a88cc3c87d6e9"}, "originalPosition": 109}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzE2NDQ0MzA2OnYy", "diffSide": "RIGHT", "path": "test/system/src/test/java/io/pravega/test/system/DynamicRestApiTest.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xNVQwNTo0Mzo1NlrOHhxlPQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xNVQxODowNDo1NVrOHiT0Kw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNTE3NzQwNQ==", "bodyText": "Since you create a scope and stream earlier, you should also check if that shows up in the response too? Otherwise creating the scope/stream previously adds no value in this particular test.", "url": "https://github.com/pravega/pravega/pull/5224#discussion_r505177405", "createdAt": "2020-10-15T05:43:56Z", "author": {"login": "ravisharda"}, "path": "test/system/src/test/java/io/pravega/test/system/DynamicRestApiTest.java", "diffHunk": "@@ -0,0 +1,139 @@\n+/**\n+ * Copyright (c) Dell Inc., or its subsidiaries. All Rights Reserved.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ */\n+package io.pravega.test.system;\n+\n+import com.fasterxml.jackson.jaxrs.json.JacksonJsonProvider;\n+import io.pravega.client.ClientConfig;\n+import io.pravega.client.admin.StreamManager;\n+import io.pravega.client.stream.ScalingPolicy;\n+import io.pravega.client.stream.StreamConfiguration;\n+import io.pravega.client.stream.impl.DefaultCredentials;\n+import lombok.Cleanup;\n+import lombok.extern.slf4j.Slf4j;\n+\n+import io.pravega.test.system.framework.Environment;\n+import io.pravega.test.system.framework.SystemTestRunner;\n+import io.pravega.test.system.framework.Utils;\n+import io.pravega.test.system.framework.services.Service;\n+\n+import java.net.URI;\n+import java.net.URISyntaxException;\n+import java.util.List;\n+import javax.ws.rs.client.Client;\n+import javax.ws.rs.client.ClientBuilder;\n+import javax.ws.rs.client.Invocation;\n+import javax.ws.rs.client.WebTarget;\n+import javax.ws.rs.core.Response;\n+\n+import org.apache.commons.lang3.RandomStringUtils;\n+import org.glassfish.jersey.client.authentication.HttpAuthenticationFeature;\n+import org.junit.Rule;\n+import org.junit.Test;\n+import org.junit.rules.Timeout;\n+import org.junit.runner.RunWith;\n+import mesosphere.marathon.client.MarathonException;\n+\n+import static org.junit.Assert.assertEquals;\n+import static javax.ws.rs.core.Response.Status.OK;\n+import static org.junit.Assert.assertFalse;\n+import static org.junit.Assert.assertNotNull;\n+import static org.junit.Assert.assertTrue;\n+\n+@Slf4j\n+@RunWith(SystemTestRunner.class)\n+public class DynamicRestApiTest extends AbstractSystemTest {\n+\n+    @Rule\n+    public Timeout globalTimeout = Timeout.seconds(5 * 60);\n+\n+    private final Client client;\n+    private WebTarget webTarget;\n+    private String restServerURI;\n+    private String resourceURl;\n+\n+    public DynamicRestApiTest() {\n+\n+        org.glassfish.jersey.client.ClientConfig clientConfig = new org.glassfish.jersey.client.ClientConfig();\n+        clientConfig.register(JacksonJsonProvider.class);\n+        clientConfig.property(\"sun.net.http.allowRestrictedHeaders\", \"true\");\n+\n+        if (Utils.AUTH_ENABLED) {\n+            HttpAuthenticationFeature feature = HttpAuthenticationFeature.basic(\"admin\", \"1111_aaaa\");\n+            clientConfig.register(feature);\n+        }\n+\n+        client = ClientBuilder.newClient(clientConfig);\n+    }\n+\n+    /**\n+     * This is used to setup the various services required by the system test framework.\n+     *\n+     * @throws InterruptedException If interrupted\n+     * @throws MarathonException    when error in setup\n+     * @throws URISyntaxException   If URI is invalid\n+     */\n+    @Environment\n+    public static void initialize() throws MarathonException {\n+        URI zkUri = startZookeeperInstance();\n+        startBookkeeperInstances(zkUri);\n+        URI controllerUri = ensureControllerRunning(zkUri);\n+        ensureSegmentStoreRunning(zkUri, controllerUri);\n+    }\n+\n+    @Test\n+    public void listScopes() {\n+        Service conService = Utils.createPravegaControllerService(null);\n+        List<URI> ctlURIs = conService.getServiceDetails();\n+        URI controllerRESTUri = ctlURIs.get(1);\n+        Invocation.Builder builder;\n+        Response response;\n+        String protocol = Utils.TLS_AND_AUTH_ENABLED ? \"https://\" : \"http://\";\n+        restServerURI = protocol + controllerRESTUri.getHost() + \":\" + controllerRESTUri.getPort();\n+        log.info(\"REST Server URI: {}\", restServerURI);\n+\n+        assertFalse(true);\n+\n+        // TEST REST server status, ping test\n+        resourceURl = new StringBuilder(restServerURI).append(\"/ping\").toString();\n+        webTarget = client.target(resourceURl);\n+        builder = webTarget.request();\n+        response = builder.get();\n+        assertEquals(\"Ping test\", OK.getStatusCode(), response.getStatus());\n+        log.info(\"REST Server is running. Ping successful.\");\n+\n+        final String scope1 = RandomStringUtils.randomAlphanumeric(10);\n+        final String stream1 = RandomStringUtils.randomAlphanumeric(10);\n+\n+        Client client = ClientBuilder.newClient();\n+        String responseAsString = null;\n+\n+        ClientConfig clientConfig = ClientConfig.builder()\n+                        .controllerURI(controllerRESTUri)\n+                        .credentials(new DefaultCredentials(\"1111_aaaa\", \"admin\"))\n+                        .build();\n+        // Create a scope.\n+        @Cleanup\n+        StreamManager streamManager = StreamManager.create(clientConfig);\n+        assertNotNull(streamManager);\n+        boolean isScopeCreated = streamManager.createScope(scope1);\n+        assertTrue(\"Failed to create scope\", isScopeCreated);\n+        // Create a stream.\n+        boolean isStreamCreated = streamManager.createStream(scope1, stream1, StreamConfiguration.builder().scalingPolicy(ScalingPolicy.fixed(1)).build());\n+        assertTrue(\"Failed to create stream\", isScopeCreated);\n+\n+        // Query for an existing scope.\n+        webTarget = client.target(restServerURI).path(\"v1\").path(\"scopes\");\n+        builder = webTarget.request();\n+        response = builder.get();\n+        assertEquals(\"Get scopes failed.\", OK.getStatusCode(), response.getStatus());\n+        responseAsString = response.readEntity(String.class);\n+        assertTrue(responseAsString.contains(\"\\\"scopeName\\\":\\\"_system\\\"\"));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "7a8acb6961e31272b77d863c5f1a88cc3c87d6e9"}, "originalPosition": 137}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNTczODI4Mw==", "bodyText": "Sure.", "url": "https://github.com/pravega/pravega/pull/5224#discussion_r505738283", "createdAt": "2020-10-15T18:04:55Z", "author": {"login": "co-jo"}, "path": "test/system/src/test/java/io/pravega/test/system/DynamicRestApiTest.java", "diffHunk": "@@ -0,0 +1,139 @@\n+/**\n+ * Copyright (c) Dell Inc., or its subsidiaries. All Rights Reserved.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ */\n+package io.pravega.test.system;\n+\n+import com.fasterxml.jackson.jaxrs.json.JacksonJsonProvider;\n+import io.pravega.client.ClientConfig;\n+import io.pravega.client.admin.StreamManager;\n+import io.pravega.client.stream.ScalingPolicy;\n+import io.pravega.client.stream.StreamConfiguration;\n+import io.pravega.client.stream.impl.DefaultCredentials;\n+import lombok.Cleanup;\n+import lombok.extern.slf4j.Slf4j;\n+\n+import io.pravega.test.system.framework.Environment;\n+import io.pravega.test.system.framework.SystemTestRunner;\n+import io.pravega.test.system.framework.Utils;\n+import io.pravega.test.system.framework.services.Service;\n+\n+import java.net.URI;\n+import java.net.URISyntaxException;\n+import java.util.List;\n+import javax.ws.rs.client.Client;\n+import javax.ws.rs.client.ClientBuilder;\n+import javax.ws.rs.client.Invocation;\n+import javax.ws.rs.client.WebTarget;\n+import javax.ws.rs.core.Response;\n+\n+import org.apache.commons.lang3.RandomStringUtils;\n+import org.glassfish.jersey.client.authentication.HttpAuthenticationFeature;\n+import org.junit.Rule;\n+import org.junit.Test;\n+import org.junit.rules.Timeout;\n+import org.junit.runner.RunWith;\n+import mesosphere.marathon.client.MarathonException;\n+\n+import static org.junit.Assert.assertEquals;\n+import static javax.ws.rs.core.Response.Status.OK;\n+import static org.junit.Assert.assertFalse;\n+import static org.junit.Assert.assertNotNull;\n+import static org.junit.Assert.assertTrue;\n+\n+@Slf4j\n+@RunWith(SystemTestRunner.class)\n+public class DynamicRestApiTest extends AbstractSystemTest {\n+\n+    @Rule\n+    public Timeout globalTimeout = Timeout.seconds(5 * 60);\n+\n+    private final Client client;\n+    private WebTarget webTarget;\n+    private String restServerURI;\n+    private String resourceURl;\n+\n+    public DynamicRestApiTest() {\n+\n+        org.glassfish.jersey.client.ClientConfig clientConfig = new org.glassfish.jersey.client.ClientConfig();\n+        clientConfig.register(JacksonJsonProvider.class);\n+        clientConfig.property(\"sun.net.http.allowRestrictedHeaders\", \"true\");\n+\n+        if (Utils.AUTH_ENABLED) {\n+            HttpAuthenticationFeature feature = HttpAuthenticationFeature.basic(\"admin\", \"1111_aaaa\");\n+            clientConfig.register(feature);\n+        }\n+\n+        client = ClientBuilder.newClient(clientConfig);\n+    }\n+\n+    /**\n+     * This is used to setup the various services required by the system test framework.\n+     *\n+     * @throws InterruptedException If interrupted\n+     * @throws MarathonException    when error in setup\n+     * @throws URISyntaxException   If URI is invalid\n+     */\n+    @Environment\n+    public static void initialize() throws MarathonException {\n+        URI zkUri = startZookeeperInstance();\n+        startBookkeeperInstances(zkUri);\n+        URI controllerUri = ensureControllerRunning(zkUri);\n+        ensureSegmentStoreRunning(zkUri, controllerUri);\n+    }\n+\n+    @Test\n+    public void listScopes() {\n+        Service conService = Utils.createPravegaControllerService(null);\n+        List<URI> ctlURIs = conService.getServiceDetails();\n+        URI controllerRESTUri = ctlURIs.get(1);\n+        Invocation.Builder builder;\n+        Response response;\n+        String protocol = Utils.TLS_AND_AUTH_ENABLED ? \"https://\" : \"http://\";\n+        restServerURI = protocol + controllerRESTUri.getHost() + \":\" + controllerRESTUri.getPort();\n+        log.info(\"REST Server URI: {}\", restServerURI);\n+\n+        assertFalse(true);\n+\n+        // TEST REST server status, ping test\n+        resourceURl = new StringBuilder(restServerURI).append(\"/ping\").toString();\n+        webTarget = client.target(resourceURl);\n+        builder = webTarget.request();\n+        response = builder.get();\n+        assertEquals(\"Ping test\", OK.getStatusCode(), response.getStatus());\n+        log.info(\"REST Server is running. Ping successful.\");\n+\n+        final String scope1 = RandomStringUtils.randomAlphanumeric(10);\n+        final String stream1 = RandomStringUtils.randomAlphanumeric(10);\n+\n+        Client client = ClientBuilder.newClient();\n+        String responseAsString = null;\n+\n+        ClientConfig clientConfig = ClientConfig.builder()\n+                        .controllerURI(controllerRESTUri)\n+                        .credentials(new DefaultCredentials(\"1111_aaaa\", \"admin\"))\n+                        .build();\n+        // Create a scope.\n+        @Cleanup\n+        StreamManager streamManager = StreamManager.create(clientConfig);\n+        assertNotNull(streamManager);\n+        boolean isScopeCreated = streamManager.createScope(scope1);\n+        assertTrue(\"Failed to create scope\", isScopeCreated);\n+        // Create a stream.\n+        boolean isStreamCreated = streamManager.createStream(scope1, stream1, StreamConfiguration.builder().scalingPolicy(ScalingPolicy.fixed(1)).build());\n+        assertTrue(\"Failed to create stream\", isScopeCreated);\n+\n+        // Query for an existing scope.\n+        webTarget = client.target(restServerURI).path(\"v1\").path(\"scopes\");\n+        builder = webTarget.request();\n+        response = builder.get();\n+        assertEquals(\"Get scopes failed.\", OK.getStatusCode(), response.getStatus());\n+        responseAsString = response.readEntity(String.class);\n+        assertTrue(responseAsString.contains(\"\\\"scopeName\\\":\\\"_system\\\"\"));", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNTE3NzQwNQ=="}, "originalCommit": {"oid": "7a8acb6961e31272b77d863c5f1a88cc3c87d6e9"}, "originalPosition": 137}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzE5ODM5MDY3OnYy", "diffSide": "RIGHT", "path": "test/system/src/test/java/io/pravega/test/system/DynamicRestApiTest.java", "isResolved": true, "comments": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yM1QwMzo1NDoxMVrOHm7SBg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yNlQxOTo1MDozNlrOHof3HQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMDU3OTIwNg==", "bodyText": "Credentials are hard-coded. Can we obtain these from the properties file instead?", "url": "https://github.com/pravega/pravega/pull/5224#discussion_r510579206", "createdAt": "2020-10-23T03:54:11Z", "author": {"login": "ravisharda"}, "path": "test/system/src/test/java/io/pravega/test/system/DynamicRestApiTest.java", "diffHunk": "@@ -0,0 +1,146 @@\n+/**\n+ * Copyright (c) Dell Inc., or its subsidiaries. All Rights Reserved.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ */\n+package io.pravega.test.system;\n+\n+import org.glassfish.jersey.jackson.internal.jackson.jaxrs.json.JacksonJsonProvider;\n+import io.pravega.client.ClientConfig;\n+import io.pravega.client.admin.StreamManager;\n+import io.pravega.client.stream.ScalingPolicy;\n+import io.pravega.client.stream.StreamConfiguration;\n+import io.pravega.client.stream.impl.DefaultCredentials;\n+import lombok.Cleanup;\n+import lombok.extern.slf4j.Slf4j;\n+\n+import io.pravega.test.system.framework.Environment;\n+import io.pravega.test.system.framework.SystemTestRunner;\n+import io.pravega.test.system.framework.Utils;\n+import io.pravega.test.system.framework.services.Service;\n+\n+import java.net.URI;\n+import java.net.URISyntaxException;\n+import java.util.List;\n+import javax.ws.rs.client.Client;\n+import javax.ws.rs.client.ClientBuilder;\n+import javax.ws.rs.client.Invocation;\n+import javax.ws.rs.client.WebTarget;\n+import javax.ws.rs.core.Response;\n+\n+import org.apache.commons.lang3.RandomStringUtils;\n+import org.glassfish.jersey.client.authentication.HttpAuthenticationFeature;\n+import org.junit.Rule;\n+import org.junit.Test;\n+import org.junit.rules.Timeout;\n+import org.junit.runner.RunWith;\n+import mesosphere.marathon.client.MarathonException;\n+\n+import static org.junit.Assert.assertEquals;\n+import static javax.ws.rs.core.Response.Status.OK;\n+import static org.junit.Assert.assertNotNull;\n+import static org.junit.Assert.assertTrue;\n+\n+@Slf4j\n+@RunWith(SystemTestRunner.class)\n+public class DynamicRestApiTest extends AbstractSystemTest {\n+\n+    @Rule\n+    public Timeout globalTimeout = Timeout.seconds(5 * 60);\n+\n+    private final Client client;\n+    private WebTarget webTarget;\n+    private String restServerURI;\n+    private String resourceURl;\n+\n+    public DynamicRestApiTest() {\n+\n+        org.glassfish.jersey.client.ClientConfig clientConfig = new org.glassfish.jersey.client.ClientConfig();\n+        clientConfig.register(JacksonJsonProvider.class);\n+\n+        if (Utils.AUTH_ENABLED) {\n+            HttpAuthenticationFeature feature = HttpAuthenticationFeature.basic(\"admin\", \"1111_aaaa\");\n+            clientConfig.register(feature);\n+        }\n+\n+        client = ClientBuilder.newClient(clientConfig);\n+    }\n+\n+    /**\n+     * This is used to setup the various services required by the system test framework.\n+     *\n+     * @throws InterruptedException If interrupted\n+     * @throws MarathonException    when error in setup\n+     * @throws URISyntaxException   If URI is invalid\n+     */\n+    @Environment\n+    public static void initialize() throws MarathonException {\n+        URI zkUri = startZookeeperInstance();\n+        startBookkeeperInstances(zkUri);\n+        URI controllerUri = ensureControllerRunning(zkUri);\n+        ensureSegmentStoreRunning(zkUri, controllerUri);\n+    }\n+\n+    @Test\n+    public void listScopes() {\n+        Service controllerService = Utils.createPravegaControllerService(null);\n+        List<URI> controllerURIs = controllerService.getServiceDetails();\n+        URI controllerGRPCUri = controllerURIs.get(0);\n+        URI controllerRESTUri = controllerURIs.get(1);\n+        Invocation.Builder builder;\n+        @Cleanup\n+        Response response = null;\n+        String protocol = Utils.TLS_AND_AUTH_ENABLED ? \"https://\" : \"http://\";\n+        restServerURI = protocol + controllerRESTUri.getHost() + \":\" + controllerRESTUri.getPort();\n+        log.info(\"REST Server URI: {}\", restServerURI);\n+\n+        // Validate the liveliness of the server through a 'ping' request.\n+        resourceURl = new StringBuilder(restServerURI).append(\"/ping\").toString();\n+        webTarget = client.target(resourceURl);\n+        builder = webTarget.request();\n+        response = builder.get();\n+        assertEquals(String.format(\"Received unexpected status code: %s in response to 'ping' request.\", response.getStatus()),\n+                OK.getStatusCode(),\n+                response.getStatus());\n+\n+        final String scope1 = RandomStringUtils.randomAlphanumeric(10);\n+        final String stream1 = RandomStringUtils.randomAlphanumeric(10);\n+\n+        Client client = ClientBuilder.newClient();\n+        String responseAsString = null;\n+\n+        ClientConfig clientConfig = ClientConfig.builder()\n+                .controllerURI(controllerGRPCUri)\n+                .credentials(new DefaultCredentials(\"1111_aaaa\", \"admin\"))", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "38a7ab0884ee47ef62398d05abb3fcf2b35187cd"}, "originalPosition": 118}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMTA1MjI2MQ==", "bodyText": "Fixed.", "url": "https://github.com/pravega/pravega/pull/5224#discussion_r511052261", "createdAt": "2020-10-23T18:03:49Z", "author": {"login": "co-jo"}, "path": "test/system/src/test/java/io/pravega/test/system/DynamicRestApiTest.java", "diffHunk": "@@ -0,0 +1,146 @@\n+/**\n+ * Copyright (c) Dell Inc., or its subsidiaries. All Rights Reserved.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ */\n+package io.pravega.test.system;\n+\n+import org.glassfish.jersey.jackson.internal.jackson.jaxrs.json.JacksonJsonProvider;\n+import io.pravega.client.ClientConfig;\n+import io.pravega.client.admin.StreamManager;\n+import io.pravega.client.stream.ScalingPolicy;\n+import io.pravega.client.stream.StreamConfiguration;\n+import io.pravega.client.stream.impl.DefaultCredentials;\n+import lombok.Cleanup;\n+import lombok.extern.slf4j.Slf4j;\n+\n+import io.pravega.test.system.framework.Environment;\n+import io.pravega.test.system.framework.SystemTestRunner;\n+import io.pravega.test.system.framework.Utils;\n+import io.pravega.test.system.framework.services.Service;\n+\n+import java.net.URI;\n+import java.net.URISyntaxException;\n+import java.util.List;\n+import javax.ws.rs.client.Client;\n+import javax.ws.rs.client.ClientBuilder;\n+import javax.ws.rs.client.Invocation;\n+import javax.ws.rs.client.WebTarget;\n+import javax.ws.rs.core.Response;\n+\n+import org.apache.commons.lang3.RandomStringUtils;\n+import org.glassfish.jersey.client.authentication.HttpAuthenticationFeature;\n+import org.junit.Rule;\n+import org.junit.Test;\n+import org.junit.rules.Timeout;\n+import org.junit.runner.RunWith;\n+import mesosphere.marathon.client.MarathonException;\n+\n+import static org.junit.Assert.assertEquals;\n+import static javax.ws.rs.core.Response.Status.OK;\n+import static org.junit.Assert.assertNotNull;\n+import static org.junit.Assert.assertTrue;\n+\n+@Slf4j\n+@RunWith(SystemTestRunner.class)\n+public class DynamicRestApiTest extends AbstractSystemTest {\n+\n+    @Rule\n+    public Timeout globalTimeout = Timeout.seconds(5 * 60);\n+\n+    private final Client client;\n+    private WebTarget webTarget;\n+    private String restServerURI;\n+    private String resourceURl;\n+\n+    public DynamicRestApiTest() {\n+\n+        org.glassfish.jersey.client.ClientConfig clientConfig = new org.glassfish.jersey.client.ClientConfig();\n+        clientConfig.register(JacksonJsonProvider.class);\n+\n+        if (Utils.AUTH_ENABLED) {\n+            HttpAuthenticationFeature feature = HttpAuthenticationFeature.basic(\"admin\", \"1111_aaaa\");\n+            clientConfig.register(feature);\n+        }\n+\n+        client = ClientBuilder.newClient(clientConfig);\n+    }\n+\n+    /**\n+     * This is used to setup the various services required by the system test framework.\n+     *\n+     * @throws InterruptedException If interrupted\n+     * @throws MarathonException    when error in setup\n+     * @throws URISyntaxException   If URI is invalid\n+     */\n+    @Environment\n+    public static void initialize() throws MarathonException {\n+        URI zkUri = startZookeeperInstance();\n+        startBookkeeperInstances(zkUri);\n+        URI controllerUri = ensureControllerRunning(zkUri);\n+        ensureSegmentStoreRunning(zkUri, controllerUri);\n+    }\n+\n+    @Test\n+    public void listScopes() {\n+        Service controllerService = Utils.createPravegaControllerService(null);\n+        List<URI> controllerURIs = controllerService.getServiceDetails();\n+        URI controllerGRPCUri = controllerURIs.get(0);\n+        URI controllerRESTUri = controllerURIs.get(1);\n+        Invocation.Builder builder;\n+        @Cleanup\n+        Response response = null;\n+        String protocol = Utils.TLS_AND_AUTH_ENABLED ? \"https://\" : \"http://\";\n+        restServerURI = protocol + controllerRESTUri.getHost() + \":\" + controllerRESTUri.getPort();\n+        log.info(\"REST Server URI: {}\", restServerURI);\n+\n+        // Validate the liveliness of the server through a 'ping' request.\n+        resourceURl = new StringBuilder(restServerURI).append(\"/ping\").toString();\n+        webTarget = client.target(resourceURl);\n+        builder = webTarget.request();\n+        response = builder.get();\n+        assertEquals(String.format(\"Received unexpected status code: %s in response to 'ping' request.\", response.getStatus()),\n+                OK.getStatusCode(),\n+                response.getStatus());\n+\n+        final String scope1 = RandomStringUtils.randomAlphanumeric(10);\n+        final String stream1 = RandomStringUtils.randomAlphanumeric(10);\n+\n+        Client client = ClientBuilder.newClient();\n+        String responseAsString = null;\n+\n+        ClientConfig clientConfig = ClientConfig.builder()\n+                .controllerURI(controllerGRPCUri)\n+                .credentials(new DefaultCredentials(\"1111_aaaa\", \"admin\"))", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMDU3OTIwNg=="}, "originalCommit": {"oid": "38a7ab0884ee47ef62398d05abb3fcf2b35187cd"}, "originalPosition": 118}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMjIxOTc2Mg==", "bodyText": "Unless I'm missing something, these are still hardcoded.", "url": "https://github.com/pravega/pravega/pull/5224#discussion_r512219762", "createdAt": "2020-10-26T19:37:37Z", "author": {"login": "andreipaduroiu"}, "path": "test/system/src/test/java/io/pravega/test/system/DynamicRestApiTest.java", "diffHunk": "@@ -0,0 +1,146 @@\n+/**\n+ * Copyright (c) Dell Inc., or its subsidiaries. All Rights Reserved.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ */\n+package io.pravega.test.system;\n+\n+import org.glassfish.jersey.jackson.internal.jackson.jaxrs.json.JacksonJsonProvider;\n+import io.pravega.client.ClientConfig;\n+import io.pravega.client.admin.StreamManager;\n+import io.pravega.client.stream.ScalingPolicy;\n+import io.pravega.client.stream.StreamConfiguration;\n+import io.pravega.client.stream.impl.DefaultCredentials;\n+import lombok.Cleanup;\n+import lombok.extern.slf4j.Slf4j;\n+\n+import io.pravega.test.system.framework.Environment;\n+import io.pravega.test.system.framework.SystemTestRunner;\n+import io.pravega.test.system.framework.Utils;\n+import io.pravega.test.system.framework.services.Service;\n+\n+import java.net.URI;\n+import java.net.URISyntaxException;\n+import java.util.List;\n+import javax.ws.rs.client.Client;\n+import javax.ws.rs.client.ClientBuilder;\n+import javax.ws.rs.client.Invocation;\n+import javax.ws.rs.client.WebTarget;\n+import javax.ws.rs.core.Response;\n+\n+import org.apache.commons.lang3.RandomStringUtils;\n+import org.glassfish.jersey.client.authentication.HttpAuthenticationFeature;\n+import org.junit.Rule;\n+import org.junit.Test;\n+import org.junit.rules.Timeout;\n+import org.junit.runner.RunWith;\n+import mesosphere.marathon.client.MarathonException;\n+\n+import static org.junit.Assert.assertEquals;\n+import static javax.ws.rs.core.Response.Status.OK;\n+import static org.junit.Assert.assertNotNull;\n+import static org.junit.Assert.assertTrue;\n+\n+@Slf4j\n+@RunWith(SystemTestRunner.class)\n+public class DynamicRestApiTest extends AbstractSystemTest {\n+\n+    @Rule\n+    public Timeout globalTimeout = Timeout.seconds(5 * 60);\n+\n+    private final Client client;\n+    private WebTarget webTarget;\n+    private String restServerURI;\n+    private String resourceURl;\n+\n+    public DynamicRestApiTest() {\n+\n+        org.glassfish.jersey.client.ClientConfig clientConfig = new org.glassfish.jersey.client.ClientConfig();\n+        clientConfig.register(JacksonJsonProvider.class);\n+\n+        if (Utils.AUTH_ENABLED) {\n+            HttpAuthenticationFeature feature = HttpAuthenticationFeature.basic(\"admin\", \"1111_aaaa\");\n+            clientConfig.register(feature);\n+        }\n+\n+        client = ClientBuilder.newClient(clientConfig);\n+    }\n+\n+    /**\n+     * This is used to setup the various services required by the system test framework.\n+     *\n+     * @throws InterruptedException If interrupted\n+     * @throws MarathonException    when error in setup\n+     * @throws URISyntaxException   If URI is invalid\n+     */\n+    @Environment\n+    public static void initialize() throws MarathonException {\n+        URI zkUri = startZookeeperInstance();\n+        startBookkeeperInstances(zkUri);\n+        URI controllerUri = ensureControllerRunning(zkUri);\n+        ensureSegmentStoreRunning(zkUri, controllerUri);\n+    }\n+\n+    @Test\n+    public void listScopes() {\n+        Service controllerService = Utils.createPravegaControllerService(null);\n+        List<URI> controllerURIs = controllerService.getServiceDetails();\n+        URI controllerGRPCUri = controllerURIs.get(0);\n+        URI controllerRESTUri = controllerURIs.get(1);\n+        Invocation.Builder builder;\n+        @Cleanup\n+        Response response = null;\n+        String protocol = Utils.TLS_AND_AUTH_ENABLED ? \"https://\" : \"http://\";\n+        restServerURI = protocol + controllerRESTUri.getHost() + \":\" + controllerRESTUri.getPort();\n+        log.info(\"REST Server URI: {}\", restServerURI);\n+\n+        // Validate the liveliness of the server through a 'ping' request.\n+        resourceURl = new StringBuilder(restServerURI).append(\"/ping\").toString();\n+        webTarget = client.target(resourceURl);\n+        builder = webTarget.request();\n+        response = builder.get();\n+        assertEquals(String.format(\"Received unexpected status code: %s in response to 'ping' request.\", response.getStatus()),\n+                OK.getStatusCode(),\n+                response.getStatus());\n+\n+        final String scope1 = RandomStringUtils.randomAlphanumeric(10);\n+        final String stream1 = RandomStringUtils.randomAlphanumeric(10);\n+\n+        Client client = ClientBuilder.newClient();\n+        String responseAsString = null;\n+\n+        ClientConfig clientConfig = ClientConfig.builder()\n+                .controllerURI(controllerGRPCUri)\n+                .credentials(new DefaultCredentials(\"1111_aaaa\", \"admin\"))", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMDU3OTIwNg=="}, "originalCommit": {"oid": "38a7ab0884ee47ef62398d05abb3fcf2b35187cd"}, "originalPosition": 118}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMjIyNzEwMQ==", "bodyText": "Oops, forgot to push local changes.", "url": "https://github.com/pravega/pravega/pull/5224#discussion_r512227101", "createdAt": "2020-10-26T19:50:36Z", "author": {"login": "co-jo"}, "path": "test/system/src/test/java/io/pravega/test/system/DynamicRestApiTest.java", "diffHunk": "@@ -0,0 +1,146 @@\n+/**\n+ * Copyright (c) Dell Inc., or its subsidiaries. All Rights Reserved.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ */\n+package io.pravega.test.system;\n+\n+import org.glassfish.jersey.jackson.internal.jackson.jaxrs.json.JacksonJsonProvider;\n+import io.pravega.client.ClientConfig;\n+import io.pravega.client.admin.StreamManager;\n+import io.pravega.client.stream.ScalingPolicy;\n+import io.pravega.client.stream.StreamConfiguration;\n+import io.pravega.client.stream.impl.DefaultCredentials;\n+import lombok.Cleanup;\n+import lombok.extern.slf4j.Slf4j;\n+\n+import io.pravega.test.system.framework.Environment;\n+import io.pravega.test.system.framework.SystemTestRunner;\n+import io.pravega.test.system.framework.Utils;\n+import io.pravega.test.system.framework.services.Service;\n+\n+import java.net.URI;\n+import java.net.URISyntaxException;\n+import java.util.List;\n+import javax.ws.rs.client.Client;\n+import javax.ws.rs.client.ClientBuilder;\n+import javax.ws.rs.client.Invocation;\n+import javax.ws.rs.client.WebTarget;\n+import javax.ws.rs.core.Response;\n+\n+import org.apache.commons.lang3.RandomStringUtils;\n+import org.glassfish.jersey.client.authentication.HttpAuthenticationFeature;\n+import org.junit.Rule;\n+import org.junit.Test;\n+import org.junit.rules.Timeout;\n+import org.junit.runner.RunWith;\n+import mesosphere.marathon.client.MarathonException;\n+\n+import static org.junit.Assert.assertEquals;\n+import static javax.ws.rs.core.Response.Status.OK;\n+import static org.junit.Assert.assertNotNull;\n+import static org.junit.Assert.assertTrue;\n+\n+@Slf4j\n+@RunWith(SystemTestRunner.class)\n+public class DynamicRestApiTest extends AbstractSystemTest {\n+\n+    @Rule\n+    public Timeout globalTimeout = Timeout.seconds(5 * 60);\n+\n+    private final Client client;\n+    private WebTarget webTarget;\n+    private String restServerURI;\n+    private String resourceURl;\n+\n+    public DynamicRestApiTest() {\n+\n+        org.glassfish.jersey.client.ClientConfig clientConfig = new org.glassfish.jersey.client.ClientConfig();\n+        clientConfig.register(JacksonJsonProvider.class);\n+\n+        if (Utils.AUTH_ENABLED) {\n+            HttpAuthenticationFeature feature = HttpAuthenticationFeature.basic(\"admin\", \"1111_aaaa\");\n+            clientConfig.register(feature);\n+        }\n+\n+        client = ClientBuilder.newClient(clientConfig);\n+    }\n+\n+    /**\n+     * This is used to setup the various services required by the system test framework.\n+     *\n+     * @throws InterruptedException If interrupted\n+     * @throws MarathonException    when error in setup\n+     * @throws URISyntaxException   If URI is invalid\n+     */\n+    @Environment\n+    public static void initialize() throws MarathonException {\n+        URI zkUri = startZookeeperInstance();\n+        startBookkeeperInstances(zkUri);\n+        URI controllerUri = ensureControllerRunning(zkUri);\n+        ensureSegmentStoreRunning(zkUri, controllerUri);\n+    }\n+\n+    @Test\n+    public void listScopes() {\n+        Service controllerService = Utils.createPravegaControllerService(null);\n+        List<URI> controllerURIs = controllerService.getServiceDetails();\n+        URI controllerGRPCUri = controllerURIs.get(0);\n+        URI controllerRESTUri = controllerURIs.get(1);\n+        Invocation.Builder builder;\n+        @Cleanup\n+        Response response = null;\n+        String protocol = Utils.TLS_AND_AUTH_ENABLED ? \"https://\" : \"http://\";\n+        restServerURI = protocol + controllerRESTUri.getHost() + \":\" + controllerRESTUri.getPort();\n+        log.info(\"REST Server URI: {}\", restServerURI);\n+\n+        // Validate the liveliness of the server through a 'ping' request.\n+        resourceURl = new StringBuilder(restServerURI).append(\"/ping\").toString();\n+        webTarget = client.target(resourceURl);\n+        builder = webTarget.request();\n+        response = builder.get();\n+        assertEquals(String.format(\"Received unexpected status code: %s in response to 'ping' request.\", response.getStatus()),\n+                OK.getStatusCode(),\n+                response.getStatus());\n+\n+        final String scope1 = RandomStringUtils.randomAlphanumeric(10);\n+        final String stream1 = RandomStringUtils.randomAlphanumeric(10);\n+\n+        Client client = ClientBuilder.newClient();\n+        String responseAsString = null;\n+\n+        ClientConfig clientConfig = ClientConfig.builder()\n+                .controllerURI(controllerGRPCUri)\n+                .credentials(new DefaultCredentials(\"1111_aaaa\", \"admin\"))", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMDU3OTIwNg=="}, "originalCommit": {"oid": "38a7ab0884ee47ef62398d05abb3fcf2b35187cd"}, "originalPosition": 118}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzIwOTI0MjQ1OnYy", "diffSide": "RIGHT", "path": "build.gradle", "isResolved": true, "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yNlQxOTozNjoxOVrOHofXpw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yN1QwNDoyNjo0NFrOHoq_VA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMjIxOTA0Nw==", "bodyText": "Why do we need this both for runtime and testCompile? Shouldn't compile be enough?", "url": "https://github.com/pravega/pravega/pull/5224#discussion_r512219047", "createdAt": "2020-10-26T19:36:19Z", "author": {"login": "andreipaduroiu"}, "path": "build.gradle", "diffHunk": "@@ -854,6 +855,9 @@ project('test:system') {\n         compile group: 'org.glassfish.jersey.connectors', name:'jersey-apache-connector', version:jerseyVersion\n         compile group: 'com.spotify', name: 'docker-client', version: dockerClientVersion\n         compile group: 'io.kubernetes', name: 'client-java', version: k8ClientVersion\n+        runtime group: 'org.glassfish.jersey.inject', name: 'jersey-hk2', version: jerseyVersion\n+        runtime group: 'org.apache.curator', name: 'curator-framework', version: apacheCuratorVersion\n+        testCompile group: 'org.apache.curator', name: 'curator-framework', version: apacheCuratorVersion", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "6f1572fbc521158e88ce54fe665e8bdc30dfbd04"}, "originalPosition": 25}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMjI0MDM0Mw==", "bodyText": "The runtime configuration is required to pull in the dependency into the test-collection.jar (below). It is however sufficient just to use compile instead of testCompile.", "url": "https://github.com/pravega/pravega/pull/5224#discussion_r512240343", "createdAt": "2020-10-26T20:15:18Z", "author": {"login": "co-jo"}, "path": "build.gradle", "diffHunk": "@@ -854,6 +855,9 @@ project('test:system') {\n         compile group: 'org.glassfish.jersey.connectors', name:'jersey-apache-connector', version:jerseyVersion\n         compile group: 'com.spotify', name: 'docker-client', version: dockerClientVersion\n         compile group: 'io.kubernetes', name: 'client-java', version: k8ClientVersion\n+        runtime group: 'org.glassfish.jersey.inject', name: 'jersey-hk2', version: jerseyVersion\n+        runtime group: 'org.apache.curator', name: 'curator-framework', version: apacheCuratorVersion\n+        testCompile group: 'org.apache.curator', name: 'curator-framework', version: apacheCuratorVersion", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMjIxOTA0Nw=="}, "originalCommit": {"oid": "6f1572fbc521158e88ce54fe665e8bdc30dfbd04"}, "originalPosition": 25}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMjQwOTQyOA==", "bodyText": "If you use compile dependency config, the dependency is available for both runtime and testCompile (as well as testRuntime). However, since compile is more permissive than what you may need here, IMO it'd be better to specify runtime and testCompile (or better still testRuntime if that's what you need) to limit the scope of these dependencies. That being said, it's not a big deal using just compile too. Just a thought.", "url": "https://github.com/pravega/pravega/pull/5224#discussion_r512409428", "createdAt": "2020-10-27T04:26:44Z", "author": {"login": "ravisharda"}, "path": "build.gradle", "diffHunk": "@@ -854,6 +855,9 @@ project('test:system') {\n         compile group: 'org.glassfish.jersey.connectors', name:'jersey-apache-connector', version:jerseyVersion\n         compile group: 'com.spotify', name: 'docker-client', version: dockerClientVersion\n         compile group: 'io.kubernetes', name: 'client-java', version: k8ClientVersion\n+        runtime group: 'org.glassfish.jersey.inject', name: 'jersey-hk2', version: jerseyVersion\n+        runtime group: 'org.apache.curator', name: 'curator-framework', version: apacheCuratorVersion\n+        testCompile group: 'org.apache.curator', name: 'curator-framework', version: apacheCuratorVersion", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMjIxOTA0Nw=="}, "originalCommit": {"oid": "6f1572fbc521158e88ce54fe665e8bdc30dfbd04"}, "originalPosition": 25}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4717, "cost": 1, "resetAt": "2021-11-13T12:26:42Z"}}}