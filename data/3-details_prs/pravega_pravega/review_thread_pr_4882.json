{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDM2OTQzMjUy", "number": 4882, "reviewThreads": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xOVQxNzoxNjozN1rOEHL6PQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xOVQxNzozMToxMlrOEHMJ0g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjc1OTcwNjIxOnYy", "diffSide": "RIGHT", "path": "common/src/main/java/io/pravega/common/util/TypedProperties.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xOVQxNzoxNjozN1rOGmcA9Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yMFQxMjoxNDoxNlrOGmmS4A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0Mjk1ODA2OQ==", "bodyText": "Let's add a log.warn to this code and notify users that they are using a deprecated property name.\nmaybe something like\nDeprecated property name '{}' used. Please use '{}' instead. Support for the old property name will be removed in a future version of Pravega.", "url": "https://github.com/pravega/pravega/pull/4882#discussion_r442958069", "createdAt": "2020-06-19T17:16:37Z", "author": {"login": "andreipaduroiu"}, "path": "common/src/main/java/io/pravega/common/util/TypedProperties.java", "diffHunk": "@@ -125,27 +125,35 @@ public boolean getBoolean(Property<Boolean> property) throws ConfigurationExcept\n     }\n \n     private <T> T tryGet(Property<T> property, Function<String, T> converter) {\n-        String fullKeyName = this.keyPrefix + property.getName();\n+        String propNewName = this.keyPrefix + property.getName();\n+        String propOldName = this.keyPrefix + property.getLegacyName();\n+        String propValue = null;\n \n-        // Get value from config.\n-        String value = this.properties.getProperty(fullKeyName, null);\n+        if (property.hasLegacyName()) {\n+            // Value of property with old name\n+            propValue = this.properties.getProperty(propOldName, null);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "786aaac886de3ce808bb3594f2c28ef5c9b81be3"}, "originalPosition": 13}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MzEyNjQ5Ng==", "bodyText": "Yes, that makes sense. I've added this comment now.", "url": "https://github.com/pravega/pravega/pull/4882#discussion_r443126496", "createdAt": "2020-06-20T12:14:16Z", "author": {"login": "ravisharda"}, "path": "common/src/main/java/io/pravega/common/util/TypedProperties.java", "diffHunk": "@@ -125,27 +125,35 @@ public boolean getBoolean(Property<Boolean> property) throws ConfigurationExcept\n     }\n \n     private <T> T tryGet(Property<T> property, Function<String, T> converter) {\n-        String fullKeyName = this.keyPrefix + property.getName();\n+        String propNewName = this.keyPrefix + property.getName();\n+        String propOldName = this.keyPrefix + property.getLegacyName();\n+        String propValue = null;\n \n-        // Get value from config.\n-        String value = this.properties.getProperty(fullKeyName, null);\n+        if (property.hasLegacyName()) {\n+            // Value of property with old name\n+            propValue = this.properties.getProperty(propOldName, null);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0Mjk1ODA2OQ=="}, "originalCommit": {"oid": "786aaac886de3ce808bb3594f2c28ef5c9b81be3"}, "originalPosition": 13}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjc1OTc0NDIyOnYy", "diffSide": "RIGHT", "path": "common/src/main/java/io/pravega/common/util/TypedProperties.java", "isResolved": true, "comments": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xOVQxNzozMDozNVrOGmcY6g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yMFQxMjoxNTowM1rOGmmTBg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0Mjk2NDIwMg==", "bodyText": "Same here, please call out the exact property name being used.", "url": "https://github.com/pravega/pravega/pull/4882#discussion_r442964202", "createdAt": "2020-06-19T17:30:35Z", "author": {"login": "kevinhan88"}, "path": "common/src/main/java/io/pravega/common/util/TypedProperties.java", "diffHunk": "@@ -125,27 +125,35 @@ public boolean getBoolean(Property<Boolean> property) throws ConfigurationExcept\n     }\n \n     private <T> T tryGet(Property<T> property, Function<String, T> converter) {\n-        String fullKeyName = this.keyPrefix + property.getName();\n+        String propNewName = this.keyPrefix + property.getName();\n+        String propOldName = this.keyPrefix + property.getLegacyName();\n+        String propValue = null;\n \n-        // Get value from config.\n-        String value = this.properties.getProperty(fullKeyName, null);\n+        if (property.hasLegacyName()) {\n+            // Value of property with old name\n+            propValue = this.properties.getProperty(propOldName, null);\n+        }\n \n-        if (value == null && property.hasLegacyName()) {\n-            value = this.properties.getProperty(this.keyPrefix + property.getLegacyName(), null);\n+        if (propValue == null) {\n+            // Value of property with new name\n+            propValue = this.properties.getProperty(propNewName, null);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "786aaac886de3ce808bb3594f2c28ef5c9b81be3"}, "originalPosition": 20}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0Mjk2NzMxMw==", "bodyText": "Consider adding code to handle the scenario that both legacy and current properties are being defined.\nThis is the most confusing scenario, so please log it in details, e.g. \"both legacy and current properties defined as blah blah, and legacy properties is used.\"", "url": "https://github.com/pravega/pravega/pull/4882#discussion_r442967313", "createdAt": "2020-06-19T17:38:05Z", "author": {"login": "kevinhan88"}, "path": "common/src/main/java/io/pravega/common/util/TypedProperties.java", "diffHunk": "@@ -125,27 +125,35 @@ public boolean getBoolean(Property<Boolean> property) throws ConfigurationExcept\n     }\n \n     private <T> T tryGet(Property<T> property, Function<String, T> converter) {\n-        String fullKeyName = this.keyPrefix + property.getName();\n+        String propNewName = this.keyPrefix + property.getName();\n+        String propOldName = this.keyPrefix + property.getLegacyName();\n+        String propValue = null;\n \n-        // Get value from config.\n-        String value = this.properties.getProperty(fullKeyName, null);\n+        if (property.hasLegacyName()) {\n+            // Value of property with old name\n+            propValue = this.properties.getProperty(propOldName, null);\n+        }\n \n-        if (value == null && property.hasLegacyName()) {\n-            value = this.properties.getProperty(this.keyPrefix + property.getLegacyName(), null);\n+        if (propValue == null) {\n+            // Value of property with new name\n+            propValue = this.properties.getProperty(propNewName, null);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0Mjk2NDIwMg=="}, "originalCommit": {"oid": "786aaac886de3ce808bb3594f2c28ef5c9b81be3"}, "originalPosition": 20}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0Mjk2NzM3NQ==", "bodyText": "I disagree. See below.\nJust log the most important thing, which is when you are still using something that will not be supported in the future.", "url": "https://github.com/pravega/pravega/pull/4882#discussion_r442967375", "createdAt": "2020-06-19T17:38:15Z", "author": {"login": "andreipaduroiu"}, "path": "common/src/main/java/io/pravega/common/util/TypedProperties.java", "diffHunk": "@@ -125,27 +125,35 @@ public boolean getBoolean(Property<Boolean> property) throws ConfigurationExcept\n     }\n \n     private <T> T tryGet(Property<T> property, Function<String, T> converter) {\n-        String fullKeyName = this.keyPrefix + property.getName();\n+        String propNewName = this.keyPrefix + property.getName();\n+        String propOldName = this.keyPrefix + property.getLegacyName();\n+        String propValue = null;\n \n-        // Get value from config.\n-        String value = this.properties.getProperty(fullKeyName, null);\n+        if (property.hasLegacyName()) {\n+            // Value of property with old name\n+            propValue = this.properties.getProperty(propOldName, null);\n+        }\n \n-        if (value == null && property.hasLegacyName()) {\n-            value = this.properties.getProperty(this.keyPrefix + property.getLegacyName(), null);\n+        if (propValue == null) {\n+            // Value of property with new name\n+            propValue = this.properties.getProperty(propNewName, null);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0Mjk2NDIwMg=="}, "originalCommit": {"oid": "786aaac886de3ce808bb3594f2c28ef5c9b81be3"}, "originalPosition": 20}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MzEyNjUzNA==", "bodyText": "I agree with @andreipaduroiu here.", "url": "https://github.com/pravega/pravega/pull/4882#discussion_r443126534", "createdAt": "2020-06-20T12:15:03Z", "author": {"login": "ravisharda"}, "path": "common/src/main/java/io/pravega/common/util/TypedProperties.java", "diffHunk": "@@ -125,27 +125,35 @@ public boolean getBoolean(Property<Boolean> property) throws ConfigurationExcept\n     }\n \n     private <T> T tryGet(Property<T> property, Function<String, T> converter) {\n-        String fullKeyName = this.keyPrefix + property.getName();\n+        String propNewName = this.keyPrefix + property.getName();\n+        String propOldName = this.keyPrefix + property.getLegacyName();\n+        String propValue = null;\n \n-        // Get value from config.\n-        String value = this.properties.getProperty(fullKeyName, null);\n+        if (property.hasLegacyName()) {\n+            // Value of property with old name\n+            propValue = this.properties.getProperty(propOldName, null);\n+        }\n \n-        if (value == null && property.hasLegacyName()) {\n-            value = this.properties.getProperty(this.keyPrefix + property.getLegacyName(), null);\n+        if (propValue == null) {\n+            // Value of property with new name\n+            propValue = this.properties.getProperty(propNewName, null);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0Mjk2NDIwMg=="}, "originalCommit": {"oid": "786aaac886de3ce808bb3594f2c28ef5c9b81be3"}, "originalPosition": 20}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjc1OTc0NjEwOnYy", "diffSide": "RIGHT", "path": "common/src/main/java/io/pravega/common/util/TypedProperties.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xOVQxNzozMToxMlrOGmcaCQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xOVQxNzozNzoyN1rOGmckBw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0Mjk2NDQ4OQ==", "bodyText": "Also call out in log that default value is being used.", "url": "https://github.com/pravega/pravega/pull/4882#discussion_r442964489", "createdAt": "2020-06-19T17:31:12Z", "author": {"login": "kevinhan88"}, "path": "common/src/main/java/io/pravega/common/util/TypedProperties.java", "diffHunk": "@@ -125,27 +125,35 @@ public boolean getBoolean(Property<Boolean> property) throws ConfigurationExcept\n     }\n \n     private <T> T tryGet(Property<T> property, Function<String, T> converter) {\n-        String fullKeyName = this.keyPrefix + property.getName();\n+        String propNewName = this.keyPrefix + property.getName();\n+        String propOldName = this.keyPrefix + property.getLegacyName();\n+        String propValue = null;\n \n-        // Get value from config.\n-        String value = this.properties.getProperty(fullKeyName, null);\n+        if (property.hasLegacyName()) {\n+            // Value of property with old name\n+            propValue = this.properties.getProperty(propOldName, null);\n+        }\n \n-        if (value == null && property.hasLegacyName()) {\n-            value = this.properties.getProperty(this.keyPrefix + property.getLegacyName(), null);\n+        if (propValue == null) {\n+            // Value of property with new name\n+            propValue = this.properties.getProperty(propNewName, null);\n         }\n-        if (value == null) {\n-            // 2. Nothing in the configuration for this Property.\n+\n+        // A property with neither old not new name was defined, so the property value is still null\n+        if (propValue == null) {\n             if (property.hasDefaultValue()) {\n                 return property.getDefaultValue();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "786aaac886de3ce808bb3594f2c28ef5c9b81be3"}, "originalPosition": 28}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0Mjk2NzA0Nw==", "bodyText": "No, there is no need to pollute the logs with this information. Both the Segment store and controller log the values so you should be able to see them if you parse the logs.\nNo point in adding noise to the logs.", "url": "https://github.com/pravega/pravega/pull/4882#discussion_r442967047", "createdAt": "2020-06-19T17:37:27Z", "author": {"login": "andreipaduroiu"}, "path": "common/src/main/java/io/pravega/common/util/TypedProperties.java", "diffHunk": "@@ -125,27 +125,35 @@ public boolean getBoolean(Property<Boolean> property) throws ConfigurationExcept\n     }\n \n     private <T> T tryGet(Property<T> property, Function<String, T> converter) {\n-        String fullKeyName = this.keyPrefix + property.getName();\n+        String propNewName = this.keyPrefix + property.getName();\n+        String propOldName = this.keyPrefix + property.getLegacyName();\n+        String propValue = null;\n \n-        // Get value from config.\n-        String value = this.properties.getProperty(fullKeyName, null);\n+        if (property.hasLegacyName()) {\n+            // Value of property with old name\n+            propValue = this.properties.getProperty(propOldName, null);\n+        }\n \n-        if (value == null && property.hasLegacyName()) {\n-            value = this.properties.getProperty(this.keyPrefix + property.getLegacyName(), null);\n+        if (propValue == null) {\n+            // Value of property with new name\n+            propValue = this.properties.getProperty(propNewName, null);\n         }\n-        if (value == null) {\n-            // 2. Nothing in the configuration for this Property.\n+\n+        // A property with neither old not new name was defined, so the property value is still null\n+        if (propValue == null) {\n             if (property.hasDefaultValue()) {\n                 return property.getDefaultValue();", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0Mjk2NDQ4OQ=="}, "originalCommit": {"oid": "786aaac886de3ce808bb3594f2c28ef5c9b81be3"}, "originalPosition": 28}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4771, "cost": 1, "resetAt": "2021-11-13T12:26:42Z"}}}