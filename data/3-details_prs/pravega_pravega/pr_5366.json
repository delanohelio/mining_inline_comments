{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTI2MDg1NjU1", "number": 5366, "title": "Issue 5360: Require permissions on the scope for creating Key-Value Tables", "bodyText": "Change log description\nModify resource string used for authorizing Key-Value table creation operation from the resource to its parent resource.\nPurpose of the change\nFixes #5360.\nWhat the code does\nModifies the resource string used for creating Key-Value Tables from the resource itself (e.g., prn::/scope:scope1/key-value-table:table1) to its parent resource - the Scope (prn::/scope:scope1).\nHow to verify it\nAll unit, integration and system tests must pass.", "createdAt": "2020-11-24T00:56:33Z", "url": "https://github.com/pravega/pravega/pull/5366", "merged": true, "mergeCommit": {"oid": "09f82ebbbc24b7c2c785f67e4429ed5d94bc32bf"}, "closed": true, "closedAt": "2020-12-07T04:46:00Z", "author": {"login": "ravisharda"}, "timelineItems": {"totalCount": 18, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdfe7eSAH2gAyNTI2MDg1NjU1OjllZjFmNzFmZDQ3MmY2Mzg5YzkwNzI2YWIwOWViNTQ0ZWViNGMzYWE=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdjj9GcAH2gAyNTI2MDg1NjU1OmY0YjZlNWQ1YTRhMzkxYzJkYTY1MDBjNGI4MzUzNTM4YTI5YTAwYTQ=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "9ef1f71fd472f6389c90726ab09eb544eeb4c3aa", "author": {"user": {"login": "ravisharda", "name": "Ravi Sharda"}}, "url": "https://github.com/pravega/pravega/commit/9ef1f71fd472f6389c90726ab09eb544eeb4c3aa", "committedDate": "2020-11-24T00:51:00Z", "message": "Modify resource string used for Key-Value Tables creation\n\nSigned-off-by: rsharda <ravi.sharda@emc.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "9023f0dfd956529d563072d6379a4189eaaf0d7e", "author": {"user": {"login": "ravisharda", "name": "Ravi Sharda"}}, "url": "https://github.com/pravega/pravega/commit/9023f0dfd956529d563072d6379a4189eaaf0d7e", "committedDate": "2020-11-24T04:52:48Z", "message": "Merge branch 'master' into issue-5360-key-value-tables-create-permissions"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ddebef2624063e3bf91afb4297e56e12583bf196", "author": {"user": {"login": "ravisharda", "name": "Ravi Sharda"}}, "url": "https://github.com/pravega/pravega/commit/ddebef2624063e3bf91afb4297e56e12583bf196", "committedDate": "2020-11-25T01:11:50Z", "message": "Merge branch 'master' into issue-5360-key-value-tables-create-permissions"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "2f91abfae2a9bba8441d9f699c87e4dde39d2a15", "author": {"user": {"login": "ravisharda", "name": "Ravi Sharda"}}, "url": "https://github.com/pravega/pravega/commit/2f91abfae2a9bba8441d9f699c87e4dde39d2a15", "committedDate": "2020-11-30T02:04:10Z", "message": "Merge branch 'master' into issue-5360-key-value-tables-create-permissions"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a3f702764b90e3069352fc9a9ec12a562aa634f2", "author": {"user": {"login": "ravisharda", "name": "Ravi Sharda"}}, "url": "https://github.com/pravega/pravega/commit/a3f702764b90e3069352fc9a9ec12a562aa634f2", "committedDate": "2020-11-30T09:03:13Z", "message": "Move test class to appropriate module so that tests are accounted for in test coverage\n\nSigned-off-by: rsharda <ravi.sharda@emc.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "608c821797be74565175046d388d210305f911df", "author": {"user": {"login": "ravisharda", "name": "Ravi Sharda"}}, "url": "https://github.com/pravega/pravega/commit/608c821797be74565175046d388d210305f911df", "committedDate": "2020-11-30T09:03:26Z", "message": "Merge remote-tracking branch 'origin/issue-5360-key-value-tables-create-permissions' into issue-5360-key-value-tables-create-permissions"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "475da6ba0e7c67ed00c5f168d8e135d5cb7c7bd3", "author": {"user": {"login": "ravisharda", "name": "Ravi Sharda"}}, "url": "https://github.com/pravega/pravega/commit/475da6ba0e7c67ed00c5f168d8e135d5cb7c7bd3", "committedDate": "2020-11-30T10:39:55Z", "message": "Merge branch 'master' into issue-5360-key-value-tables-create-permissions"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTQxMDIzNTkx", "url": "https://github.com/pravega/pravega/pull/5366#pullrequestreview-541023591", "createdAt": "2020-11-30T15:33:55Z", "commit": {"oid": "475da6ba0e7c67ed00c5f168d8e135d5cb7c7bd3"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "358181278ace58b434d732249d5fa67e761d4746", "author": {"user": {"login": "ravisharda", "name": "Ravi Sharda"}}, "url": "https://github.com/pravega/pravega/commit/358181278ace58b434d732249d5fa67e761d4746", "committedDate": "2020-12-01T00:58:01Z", "message": "Merge branch 'master' into issue-5360-key-value-tables-create-permissions"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "2484c4184543f064d6109915dcc3dd07277bd0af", "author": {"user": {"login": "ravisharda", "name": "Ravi Sharda"}}, "url": "https://github.com/pravega/pravega/commit/2484c4184543f064d6109915dcc3dd07277bd0af", "committedDate": "2020-12-01T09:00:52Z", "message": "Merge branch 'master' into issue-5360-key-value-tables-create-permissions"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTQyNTQ0MTI5", "url": "https://github.com/pravega/pravega/pull/5366#pullrequestreview-542544129", "createdAt": "2020-12-02T06:59:30Z", "commit": {"oid": "2484c4184543f064d6109915dcc3dd07277bd0af"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0wMlQwNjo1OTozMFrOH9M42Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0wMlQwNzowNzo1N1rOH9NFpg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMzkzNjM0NQ==", "bodyText": "Since only 'scope' is taken as arg to this method, please remove 'kvtname' from javadoc", "url": "https://github.com/pravega/pravega/pull/5366#discussion_r533936345", "createdAt": "2020-12-02T06:59:30Z", "author": {"login": "pbelgundi"}, "path": "shared/security/src/main/java/io/pravega/shared/security/auth/AuthorizationResource.java", "diffHunk": "@@ -90,6 +90,16 @@\n      */\n     String ofReaderGroupInScope(String scopeName, String readerGroupName);\n \n+    /**\n+     * Creates a resource representation for use in authorization of actions pertaining to the collection of Key-Value\n+     * tables within the specified scope.\n+     *\n+     * @param scopeName the name of the scope\n+     * @throws NullPointerException if {@code scopeName} or {@code kvtName} are null", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "2484c4184543f064d6109915dcc3dd07277bd0af"}, "originalPosition": 9}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMzkzOTYyMg==", "bodyText": "Not just create but listKeyValueTablesInScope also needs to look at \"scope\" permissions instead of \"scope + kvt\" permissions", "url": "https://github.com/pravega/pravega/pull/5366#discussion_r533939622", "createdAt": "2020-12-02T07:07:57Z", "author": {"login": "pbelgundi"}, "path": "controller/src/main/java/io/pravega/controller/server/rpc/grpc/v1/ControllerServiceImpl.java", "diffHunk": "@@ -146,7 +146,7 @@ public void createKeyValueTable(KeyValueTableConfig request, StreamObserver<Crea\n                 scope, kvt);\n         log.info(requestTag.getRequestId(), \"createKeyValueTable called for KVTable {}/{}.\", scope, kvt);\n         authenticateExecuteAndProcessResults(() -> this.grpcAuthHelper.checkAuthorizationAndCreateToken(\n-                authorizationResource.ofKeyValueTableInScope(scope, kvt), AuthHandler.Permissions.READ_UPDATE),\n+                authorizationResource.ofKeyValueTablesInScope(scope), AuthHandler.Permissions.READ_UPDATE),", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "2484c4184543f064d6109915dcc3dd07277bd0af"}, "originalPosition": 5}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f24786de5a732e3996f266df194a60b958192c3b", "author": {"user": {"login": "ravisharda", "name": "Ravi Sharda"}}, "url": "https://github.com/pravega/pravega/commit/f24786de5a732e3996f266df194a60b958192c3b", "committedDate": "2020-12-02T09:07:55Z", "message": "Merge branch 'master' into issue-5360-key-value-tables-create-permissions"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "71d1fbb5c5d8c4975c6efa4a4f1bfc24c33ed5d8", "author": {"user": {"login": "ravisharda", "name": "Ravi Sharda"}}, "url": "https://github.com/pravega/pravega/commit/71d1fbb5c5d8c4975c6efa4a4f1bfc24c33ed5d8", "committedDate": "2020-12-02T09:55:32Z", "message": "Address review comment\n\nSigned-off-by: rsharda <ravi.sharda@emc.com>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTQyNjk3NTg4", "url": "https://github.com/pravega/pravega/pull/5366#pullrequestreview-542697588", "createdAt": "2020-12-02T10:29:53Z", "commit": {"oid": "71d1fbb5c5d8c4975c6efa4a4f1bfc24c33ed5d8"}, "state": "APPROVED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0wMlQxMDoyOTo1M1rOH9UaJQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0wMlQxMDoyOTo1M1rOH9UaJQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNDA1OTU1Nw==", "bodyText": "Thanks for explaining. It looks fine to me.", "url": "https://github.com/pravega/pravega/pull/5366#discussion_r534059557", "createdAt": "2020-12-02T10:29:53Z", "author": {"login": "pbelgundi"}, "path": "controller/src/main/java/io/pravega/controller/server/rpc/grpc/v1/ControllerServiceImpl.java", "diffHunk": "@@ -146,7 +146,7 @@ public void createKeyValueTable(KeyValueTableConfig request, StreamObserver<Crea\n                 scope, kvt);\n         log.info(requestTag.getRequestId(), \"createKeyValueTable called for KVTable {}/{}.\", scope, kvt);\n         authenticateExecuteAndProcessResults(() -> this.grpcAuthHelper.checkAuthorizationAndCreateToken(\n-                authorizationResource.ofKeyValueTableInScope(scope, kvt), AuthHandler.Permissions.READ_UPDATE),\n+                authorizationResource.ofKeyValueTablesInScope(scope), AuthHandler.Permissions.READ_UPDATE),", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMzkzOTYyMg=="}, "originalCommit": {"oid": "2484c4184543f064d6109915dcc3dd07277bd0af"}, "originalPosition": 5}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "12bc16dd4862e90b0940a9d4b64fa4fb1959b9d0", "author": {"user": {"login": "ravisharda", "name": "Ravi Sharda"}}, "url": "https://github.com/pravega/pravega/commit/12bc16dd4862e90b0940a9d4b64fa4fb1959b9d0", "committedDate": "2020-12-03T02:09:23Z", "message": "Merge branch 'master' into issue-5360-key-value-tables-create-permissions"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "903437221792eb5cddff6adc9d8ecf1488404809", "author": {"user": {"login": "ravisharda", "name": "Ravi Sharda"}}, "url": "https://github.com/pravega/pravega/commit/903437221792eb5cddff6adc9d8ecf1488404809", "committedDate": "2020-12-04T01:01:29Z", "message": "Merge branch 'master' into issue-5360-key-value-tables-create-permissions"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "035a40fc241f7bbad8bd80fd399cf0a115602335", "author": {"user": {"login": "ravisharda", "name": "Ravi Sharda"}}, "url": "https://github.com/pravega/pravega/commit/035a40fc241f7bbad8bd80fd399cf0a115602335", "committedDate": "2020-12-04T08:52:29Z", "message": "Merge branch 'master' into issue-5360-key-value-tables-create-permissions"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f4b6e5d5a4a391c2da6500c4b8353538a29a00a4", "author": {"user": {"login": "ravisharda", "name": "Ravi Sharda"}}, "url": "https://github.com/pravega/pravega/commit/f4b6e5d5a4a391c2da6500c4b8353538a29a00a4", "committedDate": "2020-12-06T16:58:00Z", "message": "Merge branch 'master' into issue-5360-key-value-tables-create-permissions"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3753, "cost": 1, "resetAt": "2021-11-01T16:37:27Z"}}}