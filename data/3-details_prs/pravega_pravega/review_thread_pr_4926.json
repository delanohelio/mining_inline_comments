{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDQ1MzY3MDU3", "number": 4926, "reviewThreads": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wN1QxNjoyNTo0MVrOEMJvUw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wN1QxNjoyODozNVrOEMJzmA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjgxMTc3OTM5OnYy", "diffSide": "LEFT", "path": "controller/src/main/java/io/pravega/controller/task/KeyValueTable/TableMetadataTasks.java", "isResolved": true, "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wN1QxNjoyNTo0MVrOGuGSig==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wOFQwNTozOToxNFrOGuY1pw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MDk5MDczMA==", "bodyText": "why is this changed?", "url": "https://github.com/pravega/pravega/pull/4926#discussion_r450990730", "createdAt": "2020-07-07T16:25:41Z", "author": {"login": "shiveshr"}, "path": "controller/src/main/java/io/pravega/controller/task/KeyValueTable/TableMetadataTasks.java", "diffHunk": "@@ -143,15 +143,7 @@ public void initializeStreamWriters(final EventStreamClientFactory clientFactory\n                                        return isCreateProcessed(scope, kvtName, kvtConfig, createTimestamp, executor);\n                                  });\n                             });\n-               }, e -> Exceptions.unwrap(e) instanceof RetryableException, NUM_RETRIES, executor)", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f3c3ca2e3c923ef4c1048fcb485892c2a5374e1a"}, "originalPosition": 4}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MTAxODMyMA==", "bodyText": "Changed this so both delete and create have consistent behavior on timeout, earlier one returned FAILURE status on timeout and the other threw TimeoutException.", "url": "https://github.com/pravega/pravega/pull/4926#discussion_r451018320", "createdAt": "2020-07-07T17:11:30Z", "author": {"login": "pbelgundi"}, "path": "controller/src/main/java/io/pravega/controller/task/KeyValueTable/TableMetadataTasks.java", "diffHunk": "@@ -143,15 +143,7 @@ public void initializeStreamWriters(final EventStreamClientFactory clientFactory\n                                        return isCreateProcessed(scope, kvtName, kvtConfig, createTimestamp, executor);\n                                  });\n                             });\n-               }, e -> Exceptions.unwrap(e) instanceof RetryableException, NUM_RETRIES, executor)", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MDk5MDczMA=="}, "originalCommit": {"oid": "f3c3ca2e3c923ef4c1048fcb485892c2a5374e1a"}, "originalPosition": 4}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MTI5NDYzMQ==", "bodyText": "As discussed with Shivesh, changed both APIs to throw timeout exception when event timesout.", "url": "https://github.com/pravega/pravega/pull/4926#discussion_r451294631", "createdAt": "2020-07-08T05:39:14Z", "author": {"login": "pbelgundi"}, "path": "controller/src/main/java/io/pravega/controller/task/KeyValueTable/TableMetadataTasks.java", "diffHunk": "@@ -143,15 +143,7 @@ public void initializeStreamWriters(final EventStreamClientFactory clientFactory\n                                        return isCreateProcessed(scope, kvtName, kvtConfig, createTimestamp, executor);\n                                  });\n                             });\n-               }, e -> Exceptions.unwrap(e) instanceof RetryableException, NUM_RETRIES, executor)", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MDk5MDczMA=="}, "originalCommit": {"oid": "f3c3ca2e3c923ef4c1048fcb485892c2a5374e1a"}, "originalPosition": 4}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjgxMTc4MTQyOnYy", "diffSide": "LEFT", "path": "controller/src/main/java/io/pravega/controller/task/KeyValueTable/TableMetadataTasks.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wN1QxNjoyNjoxNFrOGuGT3Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wN1QxNzoxNToxOVrOGuIHuQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MDk5MTA2OQ==", "bodyText": "why not pass the operation context? that will avoid fetching the table names etc again from segment store", "url": "https://github.com/pravega/pravega/pull/4926#discussion_r450991069", "createdAt": "2020-07-07T16:26:14Z", "author": {"login": "shiveshr"}, "path": "controller/src/main/java/io/pravega/controller/task/KeyValueTable/TableMetadataTasks.java", "diffHunk": "@@ -180,10 +172,18 @@ public void initializeStreamWriters(final EventStreamClientFactory clientFactory\n                             DeleteTableEvent deleteEvent = new DeleteTableEvent(scope, kvtName, requestId, UUID.fromString(id));\n                             return eventHelper.addIndexAndSubmitTask(deleteEvent,\n                                     () -> kvtMetadataStore.setState(scope, kvtName, KVTableState.DELETING, context, executor))\n-                                    .thenCompose(x -> eventHelper.checkDone(() -> isDeleted(scope, kvtName, context)))", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f3c3ca2e3c923ef4c1048fcb485892c2a5374e1a"}, "originalPosition": 21}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MTAyMDcyOQ==", "bodyText": "When context is not present it fetches from cache.", "url": "https://github.com/pravega/pravega/pull/4926#discussion_r451020729", "createdAt": "2020-07-07T17:15:19Z", "author": {"login": "pbelgundi"}, "path": "controller/src/main/java/io/pravega/controller/task/KeyValueTable/TableMetadataTasks.java", "diffHunk": "@@ -180,10 +172,18 @@ public void initializeStreamWriters(final EventStreamClientFactory clientFactory\n                             DeleteTableEvent deleteEvent = new DeleteTableEvent(scope, kvtName, requestId, UUID.fromString(id));\n                             return eventHelper.addIndexAndSubmitTask(deleteEvent,\n                                     () -> kvtMetadataStore.setState(scope, kvtName, KVTableState.DELETING, context, executor))\n-                                    .thenCompose(x -> eventHelper.checkDone(() -> isDeleted(scope, kvtName, context)))", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MDk5MTA2OQ=="}, "originalCommit": {"oid": "f3c3ca2e3c923ef4c1048fcb485892c2a5374e1a"}, "originalPosition": 21}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjgxMTc4NTkwOnYy", "diffSide": "LEFT", "path": "controller/src/main/java/io/pravega/controller/task/KeyValueTable/TableMetadataTasks.java", "isResolved": true, "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wN1QxNjoyNzoyM1rOGuGWzA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wOFQwNTozOTozNFrOGuY2AQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MDk5MTgyMA==", "bodyText": "do we want to return a failure status from here? the request may have been submitted and still ongoing in the background. right?", "url": "https://github.com/pravega/pravega/pull/4926#discussion_r450991820", "createdAt": "2020-07-07T16:27:23Z", "author": {"login": "shiveshr"}, "path": "controller/src/main/java/io/pravega/controller/task/KeyValueTable/TableMetadataTasks.java", "diffHunk": "@@ -180,10 +172,18 @@ public void initializeStreamWriters(final EventStreamClientFactory clientFactory\n                             DeleteTableEvent deleteEvent = new DeleteTableEvent(scope, kvtName, requestId, UUID.fromString(id));\n                             return eventHelper.addIndexAndSubmitTask(deleteEvent,\n                                     () -> kvtMetadataStore.setState(scope, kvtName, KVTableState.DELETING, context, executor))\n-                                    .thenCompose(x -> eventHelper.checkDone(() -> isDeleted(scope, kvtName, context)))\n+                                    .thenCompose(x -> eventHelper.checkDone(() -> isDeleted(scope, kvtName)))\n                                     .thenApply(y -> DeleteKVTableStatus.Status.SUCCESS);\n                         });\n-            }), e -> Exceptions.unwrap(e) instanceof RetryableException, NUM_RETRIES, executor);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f3c3ca2e3c923ef4c1048fcb485892c2a5374e1a"}, "originalPosition": 25}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MTAyMjU2Nw==", "bodyText": "Changed this to return failure status", "url": "https://github.com/pravega/pravega/pull/4926#discussion_r451022567", "createdAt": "2020-07-07T17:18:36Z", "author": {"login": "pbelgundi"}, "path": "controller/src/main/java/io/pravega/controller/task/KeyValueTable/TableMetadataTasks.java", "diffHunk": "@@ -180,10 +172,18 @@ public void initializeStreamWriters(final EventStreamClientFactory clientFactory\n                             DeleteTableEvent deleteEvent = new DeleteTableEvent(scope, kvtName, requestId, UUID.fromString(id));\n                             return eventHelper.addIndexAndSubmitTask(deleteEvent,\n                                     () -> kvtMetadataStore.setState(scope, kvtName, KVTableState.DELETING, context, executor))\n-                                    .thenCompose(x -> eventHelper.checkDone(() -> isDeleted(scope, kvtName, context)))\n+                                    .thenCompose(x -> eventHelper.checkDone(() -> isDeleted(scope, kvtName)))\n                                     .thenApply(y -> DeleteKVTableStatus.Status.SUCCESS);\n                         });\n-            }), e -> Exceptions.unwrap(e) instanceof RetryableException, NUM_RETRIES, executor);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MDk5MTgyMA=="}, "originalCommit": {"oid": "f3c3ca2e3c923ef4c1048fcb485892c2a5374e1a"}, "originalPosition": 25}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MTI5NDcyMQ==", "bodyText": "Changed this as discussed.", "url": "https://github.com/pravega/pravega/pull/4926#discussion_r451294721", "createdAt": "2020-07-08T05:39:34Z", "author": {"login": "pbelgundi"}, "path": "controller/src/main/java/io/pravega/controller/task/KeyValueTable/TableMetadataTasks.java", "diffHunk": "@@ -180,10 +172,18 @@ public void initializeStreamWriters(final EventStreamClientFactory clientFactory\n                             DeleteTableEvent deleteEvent = new DeleteTableEvent(scope, kvtName, requestId, UUID.fromString(id));\n                             return eventHelper.addIndexAndSubmitTask(deleteEvent,\n                                     () -> kvtMetadataStore.setState(scope, kvtName, KVTableState.DELETING, context, executor))\n-                                    .thenCompose(x -> eventHelper.checkDone(() -> isDeleted(scope, kvtName, context)))\n+                                    .thenCompose(x -> eventHelper.checkDone(() -> isDeleted(scope, kvtName)))\n                                     .thenApply(y -> DeleteKVTableStatus.Status.SUCCESS);\n                         });\n-            }), e -> Exceptions.unwrap(e) instanceof RetryableException, NUM_RETRIES, executor);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MDk5MTgyMA=="}, "originalCommit": {"oid": "f3c3ca2e3c923ef4c1048fcb485892c2a5374e1a"}, "originalPosition": 25}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjgxMTc4NzAwOnYy", "diffSide": "LEFT", "path": "controller/src/main/java/io/pravega/controller/task/KeyValueTable/TableMetadataTasks.java", "isResolved": true, "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wN1QxNjoyNzo0MFrOGuGXgg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wOFQwOToxNjo0OFrOGufYOw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MDk5MjAwMg==", "bodyText": "why is this being removed?", "url": "https://github.com/pravega/pravega/pull/4926#discussion_r450992002", "createdAt": "2020-07-07T16:27:40Z", "author": {"login": "shiveshr"}, "path": "controller/src/main/java/io/pravega/controller/task/KeyValueTable/TableMetadataTasks.java", "diffHunk": "@@ -204,7 +204,7 @@ public void initializeStreamWriters(final EventStreamClientFactory clientFactory\n                                                 false, delegationToken, requestId), executor));\n     }\n \n-    private CompletableFuture<Boolean> isDeleted(String scope, String kvtName, KVTOperationContext context) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f3c3ca2e3c923ef4c1048fcb485892c2a5374e1a"}, "originalPosition": 42}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MTA0NzY3Mw==", "bodyText": "It was passed but not used.", "url": "https://github.com/pravega/pravega/pull/4926#discussion_r451047673", "createdAt": "2020-07-07T18:01:46Z", "author": {"login": "pbelgundi"}, "path": "controller/src/main/java/io/pravega/controller/task/KeyValueTable/TableMetadataTasks.java", "diffHunk": "@@ -204,7 +204,7 @@ public void initializeStreamWriters(final EventStreamClientFactory clientFactory\n                                                 false, delegationToken, requestId), executor));\n     }\n \n-    private CompletableFuture<Boolean> isDeleted(String scope, String kvtName, KVTOperationContext context) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MDk5MjAwMg=="}, "originalCommit": {"oid": "f3c3ca2e3c923ef4c1048fcb485892c2a5374e1a"}, "originalPosition": 42}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MTQwMTc4Nw==", "bodyText": "Filed this for the delete test failure: #4927", "url": "https://github.com/pravega/pravega/pull/4926#discussion_r451401787", "createdAt": "2020-07-08T09:16:48Z", "author": {"login": "pbelgundi"}, "path": "controller/src/main/java/io/pravega/controller/task/KeyValueTable/TableMetadataTasks.java", "diffHunk": "@@ -204,7 +204,7 @@ public void initializeStreamWriters(final EventStreamClientFactory clientFactory\n                                                 false, delegationToken, requestId), executor));\n     }\n \n-    private CompletableFuture<Boolean> isDeleted(String scope, String kvtName, KVTOperationContext context) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MDk5MjAwMg=="}, "originalCommit": {"oid": "f3c3ca2e3c923ef4c1048fcb485892c2a5374e1a"}, "originalPosition": 42}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjgxMTc5MDMyOnYy", "diffSide": "LEFT", "path": "controller/src/main/java/io/pravega/controller/task/KeyValueTable/TableMetadataTasks.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wN1QxNjoyODozNlrOGuGZoQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wN1QxNzoyMzoxNFrOGuIZUQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MDk5MjU0NQ==", "bodyText": "same here -- comparing the kvt config will determine if the create was actually performed with the supplied config or a different one from a concurrent request that got executed first.", "url": "https://github.com/pravega/pravega/pull/4926#discussion_r450992545", "createdAt": "2020-07-07T16:28:36Z", "author": {"login": "shiveshr"}, "path": "controller/src/main/java/io/pravega/controller/task/KeyValueTable/TableMetadataTasks.java", "diffHunk": "@@ -220,7 +220,7 @@ public void initializeStreamWriters(final EventStreamClientFactory clientFactory\n                                                                                   KeyValueTableConfiguration kvtConfig,\n                                                                                   final long createTimestamp,\n                                                                                   Executor executor) {\n-        return eventHelper.checkDone(() -> isCreated(scope, kvtName, kvtConfig, executor))", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f3c3ca2e3c923ef4c1048fcb485892c2a5374e1a"}, "originalPosition": 51}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MTAyNTIzMw==", "bodyText": "Configuration is being checked in isCreateProcessed() method. It is not required in isCreated() method and was passed but not used.", "url": "https://github.com/pravega/pravega/pull/4926#discussion_r451025233", "createdAt": "2020-07-07T17:23:14Z", "author": {"login": "pbelgundi"}, "path": "controller/src/main/java/io/pravega/controller/task/KeyValueTable/TableMetadataTasks.java", "diffHunk": "@@ -220,7 +220,7 @@ public void initializeStreamWriters(final EventStreamClientFactory clientFactory\n                                                                                   KeyValueTableConfiguration kvtConfig,\n                                                                                   final long createTimestamp,\n                                                                                   Executor executor) {\n-        return eventHelper.checkDone(() -> isCreated(scope, kvtName, kvtConfig, executor))", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MDk5MjU0NQ=="}, "originalCommit": {"oid": "f3c3ca2e3c923ef4c1048fcb485892c2a5374e1a"}, "originalPosition": 51}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4784, "cost": 1, "resetAt": "2021-11-13T12:26:42Z"}}}