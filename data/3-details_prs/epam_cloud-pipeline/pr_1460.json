{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDk3NzE5ODM4", "number": 1460, "title": "Issue 1404 implemented test for acl layer region package", "bodyText": "Implement tests for ACL layer (for region package) - #1404\nImplemented tests for CloudRegionApiService.\nSigned-off-by: Iurii_Kofanov youkofan@gmail.com", "createdAt": "2020-10-05T09:29:35Z", "url": "https://github.com/epam/cloud-pipeline/pull/1460", "merged": true, "mergeCommit": {"oid": "0af721cd79696879c2cbeccadc764782af0153ac"}, "closed": true, "closedAt": "2020-10-09T12:23:11Z", "author": {"login": "YouKofan"}, "timelineItems": {"totalCount": 20, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdP2GhnAFqTUwMjc3MzU1OQ==", "endCursor": "Y3Vyc29yOnYyOpPPAAABdQl7ZHgH2gAyNDk3NzE5ODM4OjQxNTBkOGQ3MGZjN2ZmYWE1ZmRmMDNiYjUzOWE4Mzc1YTI3NDNiN2Q=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTAyNzczNTU5", "url": "https://github.com/epam/cloud-pipeline/pull/1460#pullrequestreview-502773559", "createdAt": "2020-10-06T09:56:28Z", "commit": {"oid": "4029e38d56e3b7b553477a1cc9dae3fb049e49c7"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wNlQwOTo1NjoyOFrOHc-0yA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wNlQxMDoxMjozMVrOHc_YEg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMDE1MTQ5Ng==", "bodyText": "Why should we add changes to this class? Does this configuration affect new tests?", "url": "https://github.com/epam/cloud-pipeline/pull/1460#discussion_r500151496", "createdAt": "2020-10-06T09:56:28Z", "author": {"login": "ekazachkova"}, "path": "api/src/test/java/com/epam/pipeline/app/AclTestConfiguration.java", "diffHunk": "@@ -45,6 +45,7 @@\n import com.epam.pipeline.manager.pipeline.ToolManager;\n import com.epam.pipeline.manager.pipeline.runner.ConfigurationProviderManager;\n import com.epam.pipeline.manager.pipeline.runner.ConfigurationRunner;\n+import com.epam.pipeline.manager.region.CloudRegionManager;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "4029e38d56e3b7b553477a1cc9dae3fb049e49c7"}, "originalPosition": 4}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMDE1MzI0Mg==", "bodyText": "To avoid confusion, let's give the fields actual names, depending on their current mock state", "url": "https://github.com/epam/cloud-pipeline/pull/1460#discussion_r500153242", "createdAt": "2020-10-06T09:59:26Z", "author": {"login": "ekazachkova"}, "path": "api/src/test/java/com/epam/pipeline/test/acl/AclTestBeans.java", "diffHunk": "@@ -179,24 +210,15 @@\n     @MockBean\n     protected ToolApiService mockToolApiService;\n \n-    @MockBean\n-    protected PermissionsService mockPermissionsService;\n-\n-    @MockBean\n-    protected PermissionEvaluator mockPermissionEvaluator;\n-\n     @MockBean\n     protected MessageHelper mockMessageHelper;\n \n-    @MockBean\n+    @Autowired\n     protected CheckPermissionHelper mockPermissionHelper;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "4029e38d56e3b7b553477a1cc9dae3fb049e49c7"}, "originalPosition": 142}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMDE2MDUzMA==", "bodyText": "Lets make a new expected object that will not be mutated during the test execution", "url": "https://github.com/epam/cloud-pipeline/pull/1460#discussion_r500160530", "createdAt": "2020-10-06T10:12:31Z", "author": {"login": "ekazachkova"}, "path": "api/src/test/java/com/epam/pipeline/acl/region/CloudRegionApiServiceTest.java", "diffHunk": "@@ -0,0 +1,231 @@\n+/*\n+ * Copyright 2017-2020 EPAM Systems, Inc. (https://www.epam.com/)\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package com.epam.pipeline.acl.region;\n+\n+import com.epam.pipeline.controller.vo.region.AWSRegionDTO;\n+import com.epam.pipeline.controller.vo.region.AbstractCloudRegionDTO;\n+import com.epam.pipeline.entity.info.CloudRegionInfo;\n+import com.epam.pipeline.entity.region.AbstractCloudRegion;\n+import com.epam.pipeline.entity.region.AwsRegion;\n+import com.epam.pipeline.entity.region.CloudProvider;\n+import com.epam.pipeline.manager.region.CloudRegionManager;\n+import com.epam.pipeline.security.acl.AclPermission;\n+import com.epam.pipeline.test.acl.AbstractAclTest;\n+import org.junit.Before;\n+import org.junit.Test;\n+import org.springframework.beans.factory.annotation.Autowired;\n+import org.springframework.security.access.AccessDeniedException;\n+import org.springframework.security.test.context.support.WithMockUser;\n+\n+import java.util.ArrayList;\n+import java.util.Arrays;\n+import java.util.Collections;\n+import java.util.List;\n+\n+import static org.assertj.core.api.Assertions.assertThat;\n+import static org.mockito.Matchers.eq;\n+import static org.mockito.Mockito.doReturn;\n+import static org.mockito.Mockito.when;\n+\n+public class CloudRegionApiServiceTest extends AbstractAclTest {\n+\n+    @Autowired\n+    private CloudRegionApiService cloudRegionApiService;\n+\n+    @Autowired\n+    private CloudRegionManager mockCloudRegionManager;\n+\n+    private final AbstractCloudRegionDTO cloudRegionDTO = new AWSRegionDTO();\n+\n+    private final List<String> availableCloudsList = Arrays.asList(\"AWS\", \"AZURE\", \"GCP\");\n+\n+    private AwsRegion region;\n+\n+    private List<AbstractCloudRegion> clouds;\n+\n+    private List<CloudRegionInfo> cloudRegionInfoList;\n+\n+    @Before\n+    public void setUp() throws Exception {\n+        region = new AwsRegion();\n+        region.setId(1L);\n+        region.setName(\"OWNER\");\n+        region.setOwner(OWNER_USER);\n+\n+        clouds = new ArrayList<>();\n+        clouds.add(region);\n+\n+        cloudRegionInfoList = new ArrayList<>();\n+        cloudRegionInfoList.add(new CloudRegionInfo(region));\n+    }\n+\n+    @Test\n+    @WithMockUser(roles = ADMIN_ROLE)\n+    public void shouldAllowLoadRegionsInfoForAdmin() {\n+        doReturn(cloudRegionInfoList).when(mockCloudRegionManager).loadAllRegionsInfo();\n+\n+        assertThat(cloudRegionApiService.loadAllRegionsInfo()).isEqualTo(cloudRegionInfoList);\n+    }\n+\n+    @Test\n+    @WithMockUser(roles = GENERAL_USER_ROLE)\n+    public void shouldAllowLoadRegionsInfoForGeneralUser() {\n+        doReturn(cloudRegionInfoList).when(mockCloudRegionManager).loadAllRegionsInfo();\n+\n+        assertThat(cloudRegionApiService.loadAllRegionsInfo()).isEqualTo(cloudRegionInfoList);\n+    }\n+\n+    @Test(expected = AccessDeniedException.class)\n+    @WithMockUser(roles = SIMPLE_USER_ROLE)\n+    public void shouldDenyLoadRegionsInfoForNotAdminOrGeneralUser() {\n+        doReturn(cloudRegionInfoList).when(mockCloudRegionManager).loadAllRegionsInfo();\n+\n+        cloudRegionApiService.loadAllRegionsInfo();\n+    }\n+\n+    @Test\n+    @WithMockUser(roles = ADMIN_ROLE)\n+    public void shouldCreateAbstractCloudRegionForAdmin() {\n+        doReturn(region).when(mockCloudRegionManager).create(cloudRegionDTO);\n+\n+        assertThat(cloudRegionApiService.create(cloudRegionDTO)).isEqualTo(region);\n+    }\n+\n+    @Test(expected = AccessDeniedException.class)\n+    @WithMockUser(roles = SIMPLE_USER_ROLE)\n+    public void shouldNotCreateAbstractCloudRegionForNotAdmin() {\n+        doReturn(region).when(mockCloudRegionManager).create(cloudRegionDTO);\n+\n+        cloudRegionApiService.create(cloudRegionDTO);\n+    }\n+\n+    @Test\n+    @WithMockUser(roles = ADMIN_ROLE)\n+    public void shouldUpdateAbstractCloudRegionForAdmin() {\n+        doReturn(region).when(mockCloudRegionManager).update(region.getId(), cloudRegionDTO);\n+\n+        assertThat(cloudRegionApiService.update(region.getId(), cloudRegionDTO)).isEqualTo(region);\n+    }\n+\n+    @Test(expected = AccessDeniedException.class)\n+    @WithMockUser(roles = SIMPLE_USER_ROLE)\n+    public void shouldNotUpdateAbstractCloudRegionForNotAdmin() {\n+        doReturn(region).when(mockCloudRegionManager).update(region.getId(), cloudRegionDTO);\n+\n+        cloudRegionApiService.update(region.getId(), cloudRegionDTO);\n+    }\n+\n+    @Test\n+    @WithMockUser(roles = ADMIN_ROLE)\n+    public void shouldDeleteAbstractCloudRegionForAdmin() {\n+        doReturn(region).when(mockCloudRegionManager).delete(region.getId());\n+\n+        assertThat(cloudRegionApiService.delete(region.getId())).isEqualTo(region);\n+    }\n+\n+    @Test(expected = AccessDeniedException.class)\n+    @WithMockUser(roles = SIMPLE_USER_ROLE)\n+    public void shouldDeleteAbstractCloudRegionForNotAdmin() {\n+        doReturn(region).when(mockCloudRegionManager).delete(region.getId());\n+\n+        cloudRegionApiService.delete(region.getId());\n+    }\n+\n+    @Test\n+    @WithMockUser(roles = ADMIN_ROLE)\n+    public void shouldLoadAllAvailableCloudsForAdmin() {\n+        doReturn(availableCloudsList).when(mockCloudRegionManager).loadAllAvailable(CloudProvider.AWS);\n+\n+        assertThat(cloudRegionApiService.loadAllAvailable(CloudProvider.AWS)).isEqualTo(availableCloudsList);\n+    }\n+\n+    @Test(expected = AccessDeniedException.class)\n+    @WithMockUser(roles = SIMPLE_USER_ROLE)\n+    public void shouldNotLoadAllAvailableCloudsForNotAdmin() {\n+        doReturn(availableCloudsList).when(mockCloudRegionManager).loadAllAvailable(CloudProvider.AWS);\n+\n+        cloudRegionApiService.loadAllAvailable(CloudProvider.AWS);\n+    }\n+\n+    @Test\n+    @WithMockUser(roles = ADMIN_ROLE)\n+    public void shouldReturnAllCloudRegionsForAdmin() {\n+        doReturn(clouds).when(mockCloudRegionManager).loadAll();\n+\n+        final List<? extends AbstractCloudRegion> abstractCloudRegions = cloudRegionApiService.loadAll();\n+\n+        assertThat(abstractCloudRegions).isEqualTo(clouds);\n+        assertThat(abstractCloudRegions.get(0).getId()).isEqualTo(clouds.get(0).getId());\n+    }\n+\n+    @Test\n+    @WithMockUser(username = SIMPLE_USER_ROLE)\n+    public void shouldReturnAllCloudRegionsWhenPermissionIsGranted() {\n+        initAclEntity(region,\n+                Collections.singletonList(new UserPermission(SIMPLE_USER_ROLE, AclPermission.READ.getMask())));\n+        doReturn(clouds).when(mockCloudRegionManager).loadAll();\n+\n+        final List<? extends AbstractCloudRegion> abstractCloudRegions = cloudRegionApiService.loadAll();\n+\n+        assertThat(abstractCloudRegions).isEqualTo(clouds);\n+        assertThat(abstractCloudRegions.get(0).getId()).isEqualTo(clouds.get(0).getId());", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "4029e38d56e3b7b553477a1cc9dae3fb049e49c7"}, "originalPosition": 185}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTAyODM5NDE0", "url": "https://github.com/epam/cloud-pipeline/pull/1460#pullrequestreview-502839414", "createdAt": "2020-10-06T11:27:55Z", "commit": {"oid": "4029e38d56e3b7b553477a1cc9dae3fb049e49c7"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wNlQxMToyNzo1NVrOHdBzsg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wNlQxMToyNzo1NVrOHdBzsg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMDIwMDM3MA==", "bodyText": "Lets add test to the following case:\n\ncreate two regions: region1, region2\ngrant permissions for user only for region1\nmock mockCloudRegionManager to return two regions\ncheck that user gets only region1", "url": "https://github.com/epam/cloud-pipeline/pull/1460#discussion_r500200370", "createdAt": "2020-10-06T11:27:55Z", "author": {"login": "ekazachkova"}, "path": "api/src/test/java/com/epam/pipeline/acl/region/CloudRegionApiServiceTest.java", "diffHunk": "@@ -0,0 +1,231 @@\n+/*\n+ * Copyright 2017-2020 EPAM Systems, Inc. (https://www.epam.com/)\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package com.epam.pipeline.acl.region;\n+\n+import com.epam.pipeline.controller.vo.region.AWSRegionDTO;\n+import com.epam.pipeline.controller.vo.region.AbstractCloudRegionDTO;\n+import com.epam.pipeline.entity.info.CloudRegionInfo;\n+import com.epam.pipeline.entity.region.AbstractCloudRegion;\n+import com.epam.pipeline.entity.region.AwsRegion;\n+import com.epam.pipeline.entity.region.CloudProvider;\n+import com.epam.pipeline.manager.region.CloudRegionManager;\n+import com.epam.pipeline.security.acl.AclPermission;\n+import com.epam.pipeline.test.acl.AbstractAclTest;\n+import org.junit.Before;\n+import org.junit.Test;\n+import org.springframework.beans.factory.annotation.Autowired;\n+import org.springframework.security.access.AccessDeniedException;\n+import org.springframework.security.test.context.support.WithMockUser;\n+\n+import java.util.ArrayList;\n+import java.util.Arrays;\n+import java.util.Collections;\n+import java.util.List;\n+\n+import static org.assertj.core.api.Assertions.assertThat;\n+import static org.mockito.Matchers.eq;\n+import static org.mockito.Mockito.doReturn;\n+import static org.mockito.Mockito.when;\n+\n+public class CloudRegionApiServiceTest extends AbstractAclTest {\n+\n+    @Autowired\n+    private CloudRegionApiService cloudRegionApiService;\n+\n+    @Autowired\n+    private CloudRegionManager mockCloudRegionManager;\n+\n+    private final AbstractCloudRegionDTO cloudRegionDTO = new AWSRegionDTO();\n+\n+    private final List<String> availableCloudsList = Arrays.asList(\"AWS\", \"AZURE\", \"GCP\");\n+\n+    private AwsRegion region;\n+\n+    private List<AbstractCloudRegion> clouds;\n+\n+    private List<CloudRegionInfo> cloudRegionInfoList;\n+\n+    @Before\n+    public void setUp() throws Exception {\n+        region = new AwsRegion();\n+        region.setId(1L);\n+        region.setName(\"OWNER\");\n+        region.setOwner(OWNER_USER);\n+\n+        clouds = new ArrayList<>();\n+        clouds.add(region);\n+\n+        cloudRegionInfoList = new ArrayList<>();\n+        cloudRegionInfoList.add(new CloudRegionInfo(region));\n+    }\n+\n+    @Test\n+    @WithMockUser(roles = ADMIN_ROLE)\n+    public void shouldAllowLoadRegionsInfoForAdmin() {\n+        doReturn(cloudRegionInfoList).when(mockCloudRegionManager).loadAllRegionsInfo();\n+\n+        assertThat(cloudRegionApiService.loadAllRegionsInfo()).isEqualTo(cloudRegionInfoList);\n+    }\n+\n+    @Test\n+    @WithMockUser(roles = GENERAL_USER_ROLE)\n+    public void shouldAllowLoadRegionsInfoForGeneralUser() {\n+        doReturn(cloudRegionInfoList).when(mockCloudRegionManager).loadAllRegionsInfo();\n+\n+        assertThat(cloudRegionApiService.loadAllRegionsInfo()).isEqualTo(cloudRegionInfoList);\n+    }\n+\n+    @Test(expected = AccessDeniedException.class)\n+    @WithMockUser(roles = SIMPLE_USER_ROLE)\n+    public void shouldDenyLoadRegionsInfoForNotAdminOrGeneralUser() {\n+        doReturn(cloudRegionInfoList).when(mockCloudRegionManager).loadAllRegionsInfo();\n+\n+        cloudRegionApiService.loadAllRegionsInfo();\n+    }\n+\n+    @Test\n+    @WithMockUser(roles = ADMIN_ROLE)\n+    public void shouldCreateAbstractCloudRegionForAdmin() {\n+        doReturn(region).when(mockCloudRegionManager).create(cloudRegionDTO);\n+\n+        assertThat(cloudRegionApiService.create(cloudRegionDTO)).isEqualTo(region);\n+    }\n+\n+    @Test(expected = AccessDeniedException.class)\n+    @WithMockUser(roles = SIMPLE_USER_ROLE)\n+    public void shouldNotCreateAbstractCloudRegionForNotAdmin() {\n+        doReturn(region).when(mockCloudRegionManager).create(cloudRegionDTO);\n+\n+        cloudRegionApiService.create(cloudRegionDTO);\n+    }\n+\n+    @Test\n+    @WithMockUser(roles = ADMIN_ROLE)\n+    public void shouldUpdateAbstractCloudRegionForAdmin() {\n+        doReturn(region).when(mockCloudRegionManager).update(region.getId(), cloudRegionDTO);\n+\n+        assertThat(cloudRegionApiService.update(region.getId(), cloudRegionDTO)).isEqualTo(region);\n+    }\n+\n+    @Test(expected = AccessDeniedException.class)\n+    @WithMockUser(roles = SIMPLE_USER_ROLE)\n+    public void shouldNotUpdateAbstractCloudRegionForNotAdmin() {\n+        doReturn(region).when(mockCloudRegionManager).update(region.getId(), cloudRegionDTO);\n+\n+        cloudRegionApiService.update(region.getId(), cloudRegionDTO);\n+    }\n+\n+    @Test\n+    @WithMockUser(roles = ADMIN_ROLE)\n+    public void shouldDeleteAbstractCloudRegionForAdmin() {\n+        doReturn(region).when(mockCloudRegionManager).delete(region.getId());\n+\n+        assertThat(cloudRegionApiService.delete(region.getId())).isEqualTo(region);\n+    }\n+\n+    @Test(expected = AccessDeniedException.class)\n+    @WithMockUser(roles = SIMPLE_USER_ROLE)\n+    public void shouldDeleteAbstractCloudRegionForNotAdmin() {\n+        doReturn(region).when(mockCloudRegionManager).delete(region.getId());\n+\n+        cloudRegionApiService.delete(region.getId());\n+    }\n+\n+    @Test\n+    @WithMockUser(roles = ADMIN_ROLE)\n+    public void shouldLoadAllAvailableCloudsForAdmin() {\n+        doReturn(availableCloudsList).when(mockCloudRegionManager).loadAllAvailable(CloudProvider.AWS);\n+\n+        assertThat(cloudRegionApiService.loadAllAvailable(CloudProvider.AWS)).isEqualTo(availableCloudsList);\n+    }\n+\n+    @Test(expected = AccessDeniedException.class)\n+    @WithMockUser(roles = SIMPLE_USER_ROLE)\n+    public void shouldNotLoadAllAvailableCloudsForNotAdmin() {\n+        doReturn(availableCloudsList).when(mockCloudRegionManager).loadAllAvailable(CloudProvider.AWS);\n+\n+        cloudRegionApiService.loadAllAvailable(CloudProvider.AWS);\n+    }\n+\n+    @Test\n+    @WithMockUser(roles = ADMIN_ROLE)\n+    public void shouldReturnAllCloudRegionsForAdmin() {\n+        doReturn(clouds).when(mockCloudRegionManager).loadAll();\n+\n+        final List<? extends AbstractCloudRegion> abstractCloudRegions = cloudRegionApiService.loadAll();\n+\n+        assertThat(abstractCloudRegions).isEqualTo(clouds);\n+        assertThat(abstractCloudRegions.get(0).getId()).isEqualTo(clouds.get(0).getId());\n+    }\n+\n+    @Test\n+    @WithMockUser(username = SIMPLE_USER_ROLE)\n+    public void shouldReturnAllCloudRegionsWhenPermissionIsGranted() {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "4029e38d56e3b7b553477a1cc9dae3fb049e49c7"}, "originalPosition": 177}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTAyOTYzODI5", "url": "https://github.com/epam/cloud-pipeline/pull/1460#pullrequestreview-502963829", "createdAt": "2020-10-06T13:31:25Z", "commit": {"oid": "e171e37bc99ab82b052ca7926f00309a92066e06"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 7, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wNlQxMzozMToyNVrOHdGjUw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wNlQxNDoyMTowOVrOHdJd6g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMDI3ODA5OQ==", "bodyText": "To my mind it would be cleaner to create this object directly in test since twoRegionList used in one test only. No need to create this object for each test.", "url": "https://github.com/epam/cloud-pipeline/pull/1460#discussion_r500278099", "createdAt": "2020-10-06T13:31:25Z", "author": {"login": "ekazachkova"}, "path": "api/src/test/java/com/epam/pipeline/acl/region/CloudRegionApiServiceTest.java", "diffHunk": "@@ -0,0 +1,261 @@\n+/*\n+ * Copyright 2017-2020 EPAM Systems, Inc. (https://www.epam.com/)\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package com.epam.pipeline.acl.region;\n+\n+import com.epam.pipeline.controller.vo.region.AWSRegionDTO;\n+import com.epam.pipeline.controller.vo.region.AbstractCloudRegionDTO;\n+import com.epam.pipeline.entity.info.CloudRegionInfo;\n+import com.epam.pipeline.entity.region.AbstractCloudRegion;\n+import com.epam.pipeline.entity.region.AwsRegion;\n+import com.epam.pipeline.entity.region.CloudProvider;\n+import com.epam.pipeline.manager.region.CloudRegionManager;\n+import com.epam.pipeline.security.acl.AclPermission;\n+import com.epam.pipeline.test.acl.AbstractAclTest;\n+import org.junit.Before;\n+import org.junit.Test;\n+import org.springframework.beans.factory.annotation.Autowired;\n+import org.springframework.security.access.AccessDeniedException;\n+import org.springframework.security.test.context.support.WithMockUser;\n+\n+import java.util.ArrayList;\n+import java.util.Arrays;\n+import java.util.Collections;\n+import java.util.List;\n+\n+import static org.assertj.core.api.Assertions.assertThat;\n+import static org.mockito.Matchers.eq;\n+import static org.mockito.Mockito.doReturn;\n+import static org.mockito.Mockito.when;\n+\n+public class CloudRegionApiServiceTest extends AbstractAclTest {\n+\n+    @Autowired\n+    private CloudRegionApiService cloudRegionApiService;\n+\n+    @Autowired\n+    private CloudRegionManager mockCloudRegionManager;\n+\n+    private final AbstractCloudRegionDTO cloudRegionDTO = new AWSRegionDTO();\n+\n+    private final List<String> availableCloudsList = Arrays.asList(\"AWS\", \"AZURE\", \"GCP\");\n+\n+    private AwsRegion region;\n+\n+    private AwsRegion regionWithoutPermission;\n+\n+    private List<AbstractCloudRegion> singleRegionList;\n+\n+    private List<AbstractCloudRegion> twoRegionsList;\n+\n+    private List<CloudRegionInfo> cloudRegionInfoList;\n+\n+    @Before\n+    public void setUp() throws Exception {\n+        region = new AwsRegion();\n+        region.setId(1L);\n+        region.setName(\"OWNER\");\n+        region.setOwner(OWNER_USER);\n+\n+        regionWithoutPermission = new AwsRegion();\n+        regionWithoutPermission.setId(2L);\n+        regionWithoutPermission.setName(\"SIMPLE_USER\");\n+        regionWithoutPermission.setOwner(OWNER_USER);\n+\n+        singleRegionList = new ArrayList<>();\n+        singleRegionList.add(region);\n+\n+        twoRegionsList = new ArrayList<>();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e171e37bc99ab82b052ca7926f00309a92066e06"}, "originalPosition": 81}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMDI3OTM1Mw==", "bodyText": "Could we use Collections.singletonList here?", "url": "https://github.com/epam/cloud-pipeline/pull/1460#discussion_r500279353", "createdAt": "2020-10-06T13:32:50Z", "author": {"login": "ekazachkova"}, "path": "api/src/test/java/com/epam/pipeline/acl/region/CloudRegionApiServiceTest.java", "diffHunk": "@@ -0,0 +1,261 @@\n+/*\n+ * Copyright 2017-2020 EPAM Systems, Inc. (https://www.epam.com/)\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package com.epam.pipeline.acl.region;\n+\n+import com.epam.pipeline.controller.vo.region.AWSRegionDTO;\n+import com.epam.pipeline.controller.vo.region.AbstractCloudRegionDTO;\n+import com.epam.pipeline.entity.info.CloudRegionInfo;\n+import com.epam.pipeline.entity.region.AbstractCloudRegion;\n+import com.epam.pipeline.entity.region.AwsRegion;\n+import com.epam.pipeline.entity.region.CloudProvider;\n+import com.epam.pipeline.manager.region.CloudRegionManager;\n+import com.epam.pipeline.security.acl.AclPermission;\n+import com.epam.pipeline.test.acl.AbstractAclTest;\n+import org.junit.Before;\n+import org.junit.Test;\n+import org.springframework.beans.factory.annotation.Autowired;\n+import org.springframework.security.access.AccessDeniedException;\n+import org.springframework.security.test.context.support.WithMockUser;\n+\n+import java.util.ArrayList;\n+import java.util.Arrays;\n+import java.util.Collections;\n+import java.util.List;\n+\n+import static org.assertj.core.api.Assertions.assertThat;\n+import static org.mockito.Matchers.eq;\n+import static org.mockito.Mockito.doReturn;\n+import static org.mockito.Mockito.when;\n+\n+public class CloudRegionApiServiceTest extends AbstractAclTest {\n+\n+    @Autowired\n+    private CloudRegionApiService cloudRegionApiService;\n+\n+    @Autowired\n+    private CloudRegionManager mockCloudRegionManager;\n+\n+    private final AbstractCloudRegionDTO cloudRegionDTO = new AWSRegionDTO();\n+\n+    private final List<String> availableCloudsList = Arrays.asList(\"AWS\", \"AZURE\", \"GCP\");\n+\n+    private AwsRegion region;\n+\n+    private AwsRegion regionWithoutPermission;\n+\n+    private List<AbstractCloudRegion> singleRegionList;\n+\n+    private List<AbstractCloudRegion> twoRegionsList;\n+\n+    private List<CloudRegionInfo> cloudRegionInfoList;\n+\n+    @Before\n+    public void setUp() throws Exception {\n+        region = new AwsRegion();\n+        region.setId(1L);\n+        region.setName(\"OWNER\");\n+        region.setOwner(OWNER_USER);\n+\n+        regionWithoutPermission = new AwsRegion();\n+        regionWithoutPermission.setId(2L);\n+        regionWithoutPermission.setName(\"SIMPLE_USER\");\n+        regionWithoutPermission.setOwner(OWNER_USER);\n+\n+        singleRegionList = new ArrayList<>();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e171e37bc99ab82b052ca7926f00309a92066e06"}, "originalPosition": 78}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMDI3OTU4NA==", "bodyText": "Could we use Collections.singletonList here?", "url": "https://github.com/epam/cloud-pipeline/pull/1460#discussion_r500279584", "createdAt": "2020-10-06T13:33:07Z", "author": {"login": "ekazachkova"}, "path": "api/src/test/java/com/epam/pipeline/acl/region/CloudRegionApiServiceTest.java", "diffHunk": "@@ -0,0 +1,261 @@\n+/*\n+ * Copyright 2017-2020 EPAM Systems, Inc. (https://www.epam.com/)\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package com.epam.pipeline.acl.region;\n+\n+import com.epam.pipeline.controller.vo.region.AWSRegionDTO;\n+import com.epam.pipeline.controller.vo.region.AbstractCloudRegionDTO;\n+import com.epam.pipeline.entity.info.CloudRegionInfo;\n+import com.epam.pipeline.entity.region.AbstractCloudRegion;\n+import com.epam.pipeline.entity.region.AwsRegion;\n+import com.epam.pipeline.entity.region.CloudProvider;\n+import com.epam.pipeline.manager.region.CloudRegionManager;\n+import com.epam.pipeline.security.acl.AclPermission;\n+import com.epam.pipeline.test.acl.AbstractAclTest;\n+import org.junit.Before;\n+import org.junit.Test;\n+import org.springframework.beans.factory.annotation.Autowired;\n+import org.springframework.security.access.AccessDeniedException;\n+import org.springframework.security.test.context.support.WithMockUser;\n+\n+import java.util.ArrayList;\n+import java.util.Arrays;\n+import java.util.Collections;\n+import java.util.List;\n+\n+import static org.assertj.core.api.Assertions.assertThat;\n+import static org.mockito.Matchers.eq;\n+import static org.mockito.Mockito.doReturn;\n+import static org.mockito.Mockito.when;\n+\n+public class CloudRegionApiServiceTest extends AbstractAclTest {\n+\n+    @Autowired\n+    private CloudRegionApiService cloudRegionApiService;\n+\n+    @Autowired\n+    private CloudRegionManager mockCloudRegionManager;\n+\n+    private final AbstractCloudRegionDTO cloudRegionDTO = new AWSRegionDTO();\n+\n+    private final List<String> availableCloudsList = Arrays.asList(\"AWS\", \"AZURE\", \"GCP\");\n+\n+    private AwsRegion region;\n+\n+    private AwsRegion regionWithoutPermission;\n+\n+    private List<AbstractCloudRegion> singleRegionList;\n+\n+    private List<AbstractCloudRegion> twoRegionsList;\n+\n+    private List<CloudRegionInfo> cloudRegionInfoList;\n+\n+    @Before\n+    public void setUp() throws Exception {\n+        region = new AwsRegion();\n+        region.setId(1L);\n+        region.setName(\"OWNER\");\n+        region.setOwner(OWNER_USER);\n+\n+        regionWithoutPermission = new AwsRegion();\n+        regionWithoutPermission.setId(2L);\n+        regionWithoutPermission.setName(\"SIMPLE_USER\");\n+        regionWithoutPermission.setOwner(OWNER_USER);\n+\n+        singleRegionList = new ArrayList<>();\n+        singleRegionList.add(region);\n+\n+        twoRegionsList = new ArrayList<>();\n+        twoRegionsList.add(region);\n+        twoRegionsList.add(regionWithoutPermission);\n+\n+        cloudRegionInfoList = new ArrayList<>();\n+        cloudRegionInfoList.add(new CloudRegionInfo(region));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e171e37bc99ab82b052ca7926f00309a92066e06"}, "originalPosition": 86}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMDI4MDAyNA==", "bodyText": "Cleanup please", "url": "https://github.com/epam/cloud-pipeline/pull/1460#discussion_r500280024", "createdAt": "2020-10-06T13:33:34Z", "author": {"login": "ekazachkova"}, "path": "api/src/test/java/com/epam/pipeline/acl/region/CloudRegionApiServiceTest.java", "diffHunk": "@@ -0,0 +1,261 @@\n+/*\n+ * Copyright 2017-2020 EPAM Systems, Inc. (https://www.epam.com/)\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package com.epam.pipeline.acl.region;\n+\n+import com.epam.pipeline.controller.vo.region.AWSRegionDTO;\n+import com.epam.pipeline.controller.vo.region.AbstractCloudRegionDTO;\n+import com.epam.pipeline.entity.info.CloudRegionInfo;\n+import com.epam.pipeline.entity.region.AbstractCloudRegion;\n+import com.epam.pipeline.entity.region.AwsRegion;\n+import com.epam.pipeline.entity.region.CloudProvider;\n+import com.epam.pipeline.manager.region.CloudRegionManager;\n+import com.epam.pipeline.security.acl.AclPermission;\n+import com.epam.pipeline.test.acl.AbstractAclTest;\n+import org.junit.Before;\n+import org.junit.Test;\n+import org.springframework.beans.factory.annotation.Autowired;\n+import org.springframework.security.access.AccessDeniedException;\n+import org.springframework.security.test.context.support.WithMockUser;\n+\n+import java.util.ArrayList;\n+import java.util.Arrays;\n+import java.util.Collections;\n+import java.util.List;\n+\n+import static org.assertj.core.api.Assertions.assertThat;\n+import static org.mockito.Matchers.eq;\n+import static org.mockito.Mockito.doReturn;\n+import static org.mockito.Mockito.when;\n+\n+public class CloudRegionApiServiceTest extends AbstractAclTest {\n+\n+    @Autowired\n+    private CloudRegionApiService cloudRegionApiService;\n+\n+    @Autowired\n+    private CloudRegionManager mockCloudRegionManager;\n+\n+    private final AbstractCloudRegionDTO cloudRegionDTO = new AWSRegionDTO();\n+\n+    private final List<String> availableCloudsList = Arrays.asList(\"AWS\", \"AZURE\", \"GCP\");\n+\n+    private AwsRegion region;\n+\n+    private AwsRegion regionWithoutPermission;\n+\n+    private List<AbstractCloudRegion> singleRegionList;\n+\n+    private List<AbstractCloudRegion> twoRegionsList;\n+\n+    private List<CloudRegionInfo> cloudRegionInfoList;\n+\n+    @Before\n+    public void setUp() throws Exception {\n+        region = new AwsRegion();\n+        region.setId(1L);\n+        region.setName(\"OWNER\");\n+        region.setOwner(OWNER_USER);\n+\n+        regionWithoutPermission = new AwsRegion();\n+        regionWithoutPermission.setId(2L);\n+        regionWithoutPermission.setName(\"SIMPLE_USER\");\n+        regionWithoutPermission.setOwner(OWNER_USER);\n+\n+        singleRegionList = new ArrayList<>();\n+        singleRegionList.add(region);\n+\n+        twoRegionsList = new ArrayList<>();\n+        twoRegionsList.add(region);\n+        twoRegionsList.add(regionWithoutPermission);\n+\n+        cloudRegionInfoList = new ArrayList<>();\n+        cloudRegionInfoList.add(new CloudRegionInfo(region));\n+    }\n+\n+    @Test\n+    @WithMockUser(roles = ADMIN_ROLE)\n+    public void shouldAllowLoadRegionsInfoForAdmin() {\n+        doReturn(cloudRegionInfoList).when(mockCloudRegionManager).loadAllRegionsInfo();\n+\n+        assertThat(cloudRegionApiService.loadAllRegionsInfo()).isEqualTo(cloudRegionInfoList);\n+    }\n+\n+    @Test\n+    @WithMockUser(roles = GENERAL_USER_ROLE)\n+    public void shouldAllowLoadRegionsInfoForGeneralUser() {\n+        doReturn(cloudRegionInfoList).when(mockCloudRegionManager).loadAllRegionsInfo();\n+\n+        assertThat(cloudRegionApiService.loadAllRegionsInfo()).isEqualTo(cloudRegionInfoList);\n+    }\n+\n+    @Test(expected = AccessDeniedException.class)\n+    @WithMockUser(roles = SIMPLE_USER_ROLE)\n+    public void shouldDenyLoadRegionsInfoForNotAdminOrGeneralUser() {\n+        doReturn(cloudRegionInfoList).when(mockCloudRegionManager).loadAllRegionsInfo();\n+\n+        cloudRegionApiService.loadAllRegionsInfo();\n+    }\n+\n+    @Test\n+    @WithMockUser(roles = ADMIN_ROLE)\n+    public void shouldCreateAbstractCloudRegionForAdmin() {\n+        doReturn(region).when(mockCloudRegionManager).create(cloudRegionDTO);\n+\n+        assertThat(cloudRegionApiService.create(cloudRegionDTO)).isEqualTo(region);\n+    }\n+\n+    @Test(expected = AccessDeniedException.class)\n+    @WithMockUser(roles = SIMPLE_USER_ROLE)\n+    public void shouldNotCreateAbstractCloudRegionForNotAdmin() {\n+        doReturn(region).when(mockCloudRegionManager).create(cloudRegionDTO);\n+\n+        cloudRegionApiService.create(cloudRegionDTO);\n+    }\n+\n+    @Test\n+    @WithMockUser(roles = ADMIN_ROLE)\n+    public void shouldUpdateAbstractCloudRegionForAdmin() {\n+        doReturn(region).when(mockCloudRegionManager).update(region.getId(), cloudRegionDTO);\n+\n+        assertThat(cloudRegionApiService.update(region.getId(), cloudRegionDTO)).isEqualTo(region);\n+    }\n+\n+    @Test(expected = AccessDeniedException.class)\n+    @WithMockUser(roles = SIMPLE_USER_ROLE)\n+    public void shouldNotUpdateAbstractCloudRegionForNotAdmin() {\n+        doReturn(region).when(mockCloudRegionManager).update(region.getId(), cloudRegionDTO);\n+\n+        cloudRegionApiService.update(region.getId(), cloudRegionDTO);\n+    }\n+\n+    @Test\n+    @WithMockUser(roles = ADMIN_ROLE)\n+    public void shouldDeleteAbstractCloudRegionForAdmin() {\n+        doReturn(region).when(mockCloudRegionManager).delete(region.getId());\n+\n+        assertThat(cloudRegionApiService.delete(region.getId())).isEqualTo(region);\n+    }\n+\n+    @Test(expected = AccessDeniedException.class)\n+    @WithMockUser(roles = SIMPLE_USER_ROLE)\n+    public void shouldDeleteAbstractCloudRegionForNotAdmin() {\n+        doReturn(region).when(mockCloudRegionManager).delete(region.getId());\n+\n+        cloudRegionApiService.delete(region.getId());\n+    }\n+\n+    @Test\n+    @WithMockUser(roles = ADMIN_ROLE)\n+    public void shouldLoadAllAvailableCloudsForAdmin() {\n+        doReturn(availableCloudsList).when(mockCloudRegionManager).loadAllAvailable(CloudProvider.AWS);\n+\n+        assertThat(cloudRegionApiService.loadAllAvailable(CloudProvider.AWS)).isEqualTo(availableCloudsList);\n+    }\n+\n+    @Test(expected = AccessDeniedException.class)\n+    @WithMockUser(roles = SIMPLE_USER_ROLE)\n+    public void shouldNotLoadAllAvailableCloudsForNotAdmin() {\n+        doReturn(availableCloudsList).when(mockCloudRegionManager).loadAllAvailable(CloudProvider.AWS);\n+\n+        cloudRegionApiService.loadAllAvailable(CloudProvider.AWS);\n+    }\n+\n+    @Test\n+    @WithMockUser(roles = ADMIN_ROLE)\n+    public void shouldReturnAllCloudRegionsForAdmin() {\n+        doReturn(singleRegionList).when(mockCloudRegionManager).loadAll();\n+\n+        final List<? extends AbstractCloudRegion> abstractCloudRegions = cloudRegionApiService.loadAll();\n+        final AbstractCloudRegion resultRegion = abstractCloudRegions.get(0);\n+\n+        assertThat(abstractCloudRegions).isEqualTo(singleRegionList);\n+        assertThat(resultRegion.getId()).isEqualTo(region.getId());\n+    }\n+\n+    @Test\n+    @WithMockUser(username = SIMPLE_USER_ROLE)\n+    public void shouldReturnAllCloudRegionsWhenPermissionIsGranted() {\n+        initAclEntity(region,\n+                Collections.singletonList(new UserPermission(SIMPLE_USER_ROLE, AclPermission.READ.getMask())));\n+        doReturn(singleRegionList).when(mockCloudRegionManager).loadAll();\n+\n+        final List<? extends AbstractCloudRegion> abstractCloudRegions = cloudRegionApiService.loadAll();\n+        System.out.println(abstractCloudRegions);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e171e37bc99ab82b052ca7926f00309a92066e06"}, "originalPosition": 197}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMDMxNDQwMg==", "bodyText": "The singleRegionList object was mutated during @PostFilter operation. This way this assertion is useless and we need another one. For example, let's check elements count (in this case we shall move abstractCloudRegions.get(0) after checking size).", "url": "https://github.com/epam/cloud-pipeline/pull/1460#discussion_r500314402", "createdAt": "2020-10-06T14:09:20Z", "author": {"login": "ekazachkova"}, "path": "api/src/test/java/com/epam/pipeline/acl/region/CloudRegionApiServiceTest.java", "diffHunk": "@@ -0,0 +1,261 @@\n+/*\n+ * Copyright 2017-2020 EPAM Systems, Inc. (https://www.epam.com/)\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package com.epam.pipeline.acl.region;\n+\n+import com.epam.pipeline.controller.vo.region.AWSRegionDTO;\n+import com.epam.pipeline.controller.vo.region.AbstractCloudRegionDTO;\n+import com.epam.pipeline.entity.info.CloudRegionInfo;\n+import com.epam.pipeline.entity.region.AbstractCloudRegion;\n+import com.epam.pipeline.entity.region.AwsRegion;\n+import com.epam.pipeline.entity.region.CloudProvider;\n+import com.epam.pipeline.manager.region.CloudRegionManager;\n+import com.epam.pipeline.security.acl.AclPermission;\n+import com.epam.pipeline.test.acl.AbstractAclTest;\n+import org.junit.Before;\n+import org.junit.Test;\n+import org.springframework.beans.factory.annotation.Autowired;\n+import org.springframework.security.access.AccessDeniedException;\n+import org.springframework.security.test.context.support.WithMockUser;\n+\n+import java.util.ArrayList;\n+import java.util.Arrays;\n+import java.util.Collections;\n+import java.util.List;\n+\n+import static org.assertj.core.api.Assertions.assertThat;\n+import static org.mockito.Matchers.eq;\n+import static org.mockito.Mockito.doReturn;\n+import static org.mockito.Mockito.when;\n+\n+public class CloudRegionApiServiceTest extends AbstractAclTest {\n+\n+    @Autowired\n+    private CloudRegionApiService cloudRegionApiService;\n+\n+    @Autowired\n+    private CloudRegionManager mockCloudRegionManager;\n+\n+    private final AbstractCloudRegionDTO cloudRegionDTO = new AWSRegionDTO();\n+\n+    private final List<String> availableCloudsList = Arrays.asList(\"AWS\", \"AZURE\", \"GCP\");\n+\n+    private AwsRegion region;\n+\n+    private AwsRegion regionWithoutPermission;\n+\n+    private List<AbstractCloudRegion> singleRegionList;\n+\n+    private List<AbstractCloudRegion> twoRegionsList;\n+\n+    private List<CloudRegionInfo> cloudRegionInfoList;\n+\n+    @Before\n+    public void setUp() throws Exception {\n+        region = new AwsRegion();\n+        region.setId(1L);\n+        region.setName(\"OWNER\");\n+        region.setOwner(OWNER_USER);\n+\n+        regionWithoutPermission = new AwsRegion();\n+        regionWithoutPermission.setId(2L);\n+        regionWithoutPermission.setName(\"SIMPLE_USER\");\n+        regionWithoutPermission.setOwner(OWNER_USER);\n+\n+        singleRegionList = new ArrayList<>();\n+        singleRegionList.add(region);\n+\n+        twoRegionsList = new ArrayList<>();\n+        twoRegionsList.add(region);\n+        twoRegionsList.add(regionWithoutPermission);\n+\n+        cloudRegionInfoList = new ArrayList<>();\n+        cloudRegionInfoList.add(new CloudRegionInfo(region));\n+    }\n+\n+    @Test\n+    @WithMockUser(roles = ADMIN_ROLE)\n+    public void shouldAllowLoadRegionsInfoForAdmin() {\n+        doReturn(cloudRegionInfoList).when(mockCloudRegionManager).loadAllRegionsInfo();\n+\n+        assertThat(cloudRegionApiService.loadAllRegionsInfo()).isEqualTo(cloudRegionInfoList);\n+    }\n+\n+    @Test\n+    @WithMockUser(roles = GENERAL_USER_ROLE)\n+    public void shouldAllowLoadRegionsInfoForGeneralUser() {\n+        doReturn(cloudRegionInfoList).when(mockCloudRegionManager).loadAllRegionsInfo();\n+\n+        assertThat(cloudRegionApiService.loadAllRegionsInfo()).isEqualTo(cloudRegionInfoList);\n+    }\n+\n+    @Test(expected = AccessDeniedException.class)\n+    @WithMockUser(roles = SIMPLE_USER_ROLE)\n+    public void shouldDenyLoadRegionsInfoForNotAdminOrGeneralUser() {\n+        doReturn(cloudRegionInfoList).when(mockCloudRegionManager).loadAllRegionsInfo();\n+\n+        cloudRegionApiService.loadAllRegionsInfo();\n+    }\n+\n+    @Test\n+    @WithMockUser(roles = ADMIN_ROLE)\n+    public void shouldCreateAbstractCloudRegionForAdmin() {\n+        doReturn(region).when(mockCloudRegionManager).create(cloudRegionDTO);\n+\n+        assertThat(cloudRegionApiService.create(cloudRegionDTO)).isEqualTo(region);\n+    }\n+\n+    @Test(expected = AccessDeniedException.class)\n+    @WithMockUser(roles = SIMPLE_USER_ROLE)\n+    public void shouldNotCreateAbstractCloudRegionForNotAdmin() {\n+        doReturn(region).when(mockCloudRegionManager).create(cloudRegionDTO);\n+\n+        cloudRegionApiService.create(cloudRegionDTO);\n+    }\n+\n+    @Test\n+    @WithMockUser(roles = ADMIN_ROLE)\n+    public void shouldUpdateAbstractCloudRegionForAdmin() {\n+        doReturn(region).when(mockCloudRegionManager).update(region.getId(), cloudRegionDTO);\n+\n+        assertThat(cloudRegionApiService.update(region.getId(), cloudRegionDTO)).isEqualTo(region);\n+    }\n+\n+    @Test(expected = AccessDeniedException.class)\n+    @WithMockUser(roles = SIMPLE_USER_ROLE)\n+    public void shouldNotUpdateAbstractCloudRegionForNotAdmin() {\n+        doReturn(region).when(mockCloudRegionManager).update(region.getId(), cloudRegionDTO);\n+\n+        cloudRegionApiService.update(region.getId(), cloudRegionDTO);\n+    }\n+\n+    @Test\n+    @WithMockUser(roles = ADMIN_ROLE)\n+    public void shouldDeleteAbstractCloudRegionForAdmin() {\n+        doReturn(region).when(mockCloudRegionManager).delete(region.getId());\n+\n+        assertThat(cloudRegionApiService.delete(region.getId())).isEqualTo(region);\n+    }\n+\n+    @Test(expected = AccessDeniedException.class)\n+    @WithMockUser(roles = SIMPLE_USER_ROLE)\n+    public void shouldDeleteAbstractCloudRegionForNotAdmin() {\n+        doReturn(region).when(mockCloudRegionManager).delete(region.getId());\n+\n+        cloudRegionApiService.delete(region.getId());\n+    }\n+\n+    @Test\n+    @WithMockUser(roles = ADMIN_ROLE)\n+    public void shouldLoadAllAvailableCloudsForAdmin() {\n+        doReturn(availableCloudsList).when(mockCloudRegionManager).loadAllAvailable(CloudProvider.AWS);\n+\n+        assertThat(cloudRegionApiService.loadAllAvailable(CloudProvider.AWS)).isEqualTo(availableCloudsList);\n+    }\n+\n+    @Test(expected = AccessDeniedException.class)\n+    @WithMockUser(roles = SIMPLE_USER_ROLE)\n+    public void shouldNotLoadAllAvailableCloudsForNotAdmin() {\n+        doReturn(availableCloudsList).when(mockCloudRegionManager).loadAllAvailable(CloudProvider.AWS);\n+\n+        cloudRegionApiService.loadAllAvailable(CloudProvider.AWS);\n+    }\n+\n+    @Test\n+    @WithMockUser(roles = ADMIN_ROLE)\n+    public void shouldReturnAllCloudRegionsForAdmin() {\n+        doReturn(singleRegionList).when(mockCloudRegionManager).loadAll();\n+\n+        final List<? extends AbstractCloudRegion> abstractCloudRegions = cloudRegionApiService.loadAll();\n+        final AbstractCloudRegion resultRegion = abstractCloudRegions.get(0);\n+\n+        assertThat(abstractCloudRegions).isEqualTo(singleRegionList);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e171e37bc99ab82b052ca7926f00309a92066e06"}, "originalPosition": 185}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMDMxOTUyMw==", "bodyText": "Let's add check chat returned region id as expected.", "url": "https://github.com/epam/cloud-pipeline/pull/1460#discussion_r500319523", "createdAt": "2020-10-06T14:14:37Z", "author": {"login": "ekazachkova"}, "path": "api/src/test/java/com/epam/pipeline/acl/region/CloudRegionApiServiceTest.java", "diffHunk": "@@ -0,0 +1,261 @@\n+/*\n+ * Copyright 2017-2020 EPAM Systems, Inc. (https://www.epam.com/)\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package com.epam.pipeline.acl.region;\n+\n+import com.epam.pipeline.controller.vo.region.AWSRegionDTO;\n+import com.epam.pipeline.controller.vo.region.AbstractCloudRegionDTO;\n+import com.epam.pipeline.entity.info.CloudRegionInfo;\n+import com.epam.pipeline.entity.region.AbstractCloudRegion;\n+import com.epam.pipeline.entity.region.AwsRegion;\n+import com.epam.pipeline.entity.region.CloudProvider;\n+import com.epam.pipeline.manager.region.CloudRegionManager;\n+import com.epam.pipeline.security.acl.AclPermission;\n+import com.epam.pipeline.test.acl.AbstractAclTest;\n+import org.junit.Before;\n+import org.junit.Test;\n+import org.springframework.beans.factory.annotation.Autowired;\n+import org.springframework.security.access.AccessDeniedException;\n+import org.springframework.security.test.context.support.WithMockUser;\n+\n+import java.util.ArrayList;\n+import java.util.Arrays;\n+import java.util.Collections;\n+import java.util.List;\n+\n+import static org.assertj.core.api.Assertions.assertThat;\n+import static org.mockito.Matchers.eq;\n+import static org.mockito.Mockito.doReturn;\n+import static org.mockito.Mockito.when;\n+\n+public class CloudRegionApiServiceTest extends AbstractAclTest {\n+\n+    @Autowired\n+    private CloudRegionApiService cloudRegionApiService;\n+\n+    @Autowired\n+    private CloudRegionManager mockCloudRegionManager;\n+\n+    private final AbstractCloudRegionDTO cloudRegionDTO = new AWSRegionDTO();\n+\n+    private final List<String> availableCloudsList = Arrays.asList(\"AWS\", \"AZURE\", \"GCP\");\n+\n+    private AwsRegion region;\n+\n+    private AwsRegion regionWithoutPermission;\n+\n+    private List<AbstractCloudRegion> singleRegionList;\n+\n+    private List<AbstractCloudRegion> twoRegionsList;\n+\n+    private List<CloudRegionInfo> cloudRegionInfoList;\n+\n+    @Before\n+    public void setUp() throws Exception {\n+        region = new AwsRegion();\n+        region.setId(1L);\n+        region.setName(\"OWNER\");\n+        region.setOwner(OWNER_USER);\n+\n+        regionWithoutPermission = new AwsRegion();\n+        regionWithoutPermission.setId(2L);\n+        regionWithoutPermission.setName(\"SIMPLE_USER\");\n+        regionWithoutPermission.setOwner(OWNER_USER);\n+\n+        singleRegionList = new ArrayList<>();\n+        singleRegionList.add(region);\n+\n+        twoRegionsList = new ArrayList<>();\n+        twoRegionsList.add(region);\n+        twoRegionsList.add(regionWithoutPermission);\n+\n+        cloudRegionInfoList = new ArrayList<>();\n+        cloudRegionInfoList.add(new CloudRegionInfo(region));\n+    }\n+\n+    @Test\n+    @WithMockUser(roles = ADMIN_ROLE)\n+    public void shouldAllowLoadRegionsInfoForAdmin() {\n+        doReturn(cloudRegionInfoList).when(mockCloudRegionManager).loadAllRegionsInfo();\n+\n+        assertThat(cloudRegionApiService.loadAllRegionsInfo()).isEqualTo(cloudRegionInfoList);\n+    }\n+\n+    @Test\n+    @WithMockUser(roles = GENERAL_USER_ROLE)\n+    public void shouldAllowLoadRegionsInfoForGeneralUser() {\n+        doReturn(cloudRegionInfoList).when(mockCloudRegionManager).loadAllRegionsInfo();\n+\n+        assertThat(cloudRegionApiService.loadAllRegionsInfo()).isEqualTo(cloudRegionInfoList);\n+    }\n+\n+    @Test(expected = AccessDeniedException.class)\n+    @WithMockUser(roles = SIMPLE_USER_ROLE)\n+    public void shouldDenyLoadRegionsInfoForNotAdminOrGeneralUser() {\n+        doReturn(cloudRegionInfoList).when(mockCloudRegionManager).loadAllRegionsInfo();\n+\n+        cloudRegionApiService.loadAllRegionsInfo();\n+    }\n+\n+    @Test\n+    @WithMockUser(roles = ADMIN_ROLE)\n+    public void shouldCreateAbstractCloudRegionForAdmin() {\n+        doReturn(region).when(mockCloudRegionManager).create(cloudRegionDTO);\n+\n+        assertThat(cloudRegionApiService.create(cloudRegionDTO)).isEqualTo(region);\n+    }\n+\n+    @Test(expected = AccessDeniedException.class)\n+    @WithMockUser(roles = SIMPLE_USER_ROLE)\n+    public void shouldNotCreateAbstractCloudRegionForNotAdmin() {\n+        doReturn(region).when(mockCloudRegionManager).create(cloudRegionDTO);\n+\n+        cloudRegionApiService.create(cloudRegionDTO);\n+    }\n+\n+    @Test\n+    @WithMockUser(roles = ADMIN_ROLE)\n+    public void shouldUpdateAbstractCloudRegionForAdmin() {\n+        doReturn(region).when(mockCloudRegionManager).update(region.getId(), cloudRegionDTO);\n+\n+        assertThat(cloudRegionApiService.update(region.getId(), cloudRegionDTO)).isEqualTo(region);\n+    }\n+\n+    @Test(expected = AccessDeniedException.class)\n+    @WithMockUser(roles = SIMPLE_USER_ROLE)\n+    public void shouldNotUpdateAbstractCloudRegionForNotAdmin() {\n+        doReturn(region).when(mockCloudRegionManager).update(region.getId(), cloudRegionDTO);\n+\n+        cloudRegionApiService.update(region.getId(), cloudRegionDTO);\n+    }\n+\n+    @Test\n+    @WithMockUser(roles = ADMIN_ROLE)\n+    public void shouldDeleteAbstractCloudRegionForAdmin() {\n+        doReturn(region).when(mockCloudRegionManager).delete(region.getId());\n+\n+        assertThat(cloudRegionApiService.delete(region.getId())).isEqualTo(region);\n+    }\n+\n+    @Test(expected = AccessDeniedException.class)\n+    @WithMockUser(roles = SIMPLE_USER_ROLE)\n+    public void shouldDeleteAbstractCloudRegionForNotAdmin() {\n+        doReturn(region).when(mockCloudRegionManager).delete(region.getId());\n+\n+        cloudRegionApiService.delete(region.getId());\n+    }\n+\n+    @Test\n+    @WithMockUser(roles = ADMIN_ROLE)\n+    public void shouldLoadAllAvailableCloudsForAdmin() {\n+        doReturn(availableCloudsList).when(mockCloudRegionManager).loadAllAvailable(CloudProvider.AWS);\n+\n+        assertThat(cloudRegionApiService.loadAllAvailable(CloudProvider.AWS)).isEqualTo(availableCloudsList);\n+    }\n+\n+    @Test(expected = AccessDeniedException.class)\n+    @WithMockUser(roles = SIMPLE_USER_ROLE)\n+    public void shouldNotLoadAllAvailableCloudsForNotAdmin() {\n+        doReturn(availableCloudsList).when(mockCloudRegionManager).loadAllAvailable(CloudProvider.AWS);\n+\n+        cloudRegionApiService.loadAllAvailable(CloudProvider.AWS);\n+    }\n+\n+    @Test\n+    @WithMockUser(roles = ADMIN_ROLE)\n+    public void shouldReturnAllCloudRegionsForAdmin() {\n+        doReturn(singleRegionList).when(mockCloudRegionManager).loadAll();\n+\n+        final List<? extends AbstractCloudRegion> abstractCloudRegions = cloudRegionApiService.loadAll();\n+        final AbstractCloudRegion resultRegion = abstractCloudRegions.get(0);\n+\n+        assertThat(abstractCloudRegions).isEqualTo(singleRegionList);\n+        assertThat(resultRegion.getId()).isEqualTo(region.getId());\n+    }\n+\n+    @Test\n+    @WithMockUser(username = SIMPLE_USER_ROLE)\n+    public void shouldReturnAllCloudRegionsWhenPermissionIsGranted() {\n+        initAclEntity(region,\n+                Collections.singletonList(new UserPermission(SIMPLE_USER_ROLE, AclPermission.READ.getMask())));\n+        doReturn(singleRegionList).when(mockCloudRegionManager).loadAll();\n+\n+        final List<? extends AbstractCloudRegion> abstractCloudRegions = cloudRegionApiService.loadAll();\n+        System.out.println(abstractCloudRegions);\n+        final AbstractCloudRegion resultRegion = abstractCloudRegions.get(0);\n+\n+        assertThat(abstractCloudRegions).isEqualTo(singleRegionList);\n+        assertThat(resultRegion.getId()).isEqualTo(region.getId());\n+    }\n+\n+    @Test\n+    @WithMockUser(username = SIMPLE_USER_ROLE)\n+    public void shouldReturnListWithRegionsPermissionsForWhichIsGranted() {\n+        initAclEntity(region,\n+                Collections.singletonList(new UserPermission(SIMPLE_USER_ROLE, AclPermission.READ.getMask())));\n+        initAclEntity(regionWithoutPermission,\n+                Collections.singletonList(new UserPermission(SIMPLE_USER_ROLE, AclPermission.NO_READ.getMask())));\n+        doReturn(twoRegionsList).when(mockCloudRegionManager).loadAll();\n+        \n+        final List<? extends AbstractCloudRegion> abstractCloudRegions = cloudRegionApiService.loadAll();\n+\n+        assertThat(abstractCloudRegions.size()).isEqualTo(1);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e171e37bc99ab82b052ca7926f00309a92066e06"}, "originalPosition": 215}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMDMyNTg2Ng==", "bodyText": "Also, we can use Arrays.asList here", "url": "https://github.com/epam/cloud-pipeline/pull/1460#discussion_r500325866", "createdAt": "2020-10-06T14:21:09Z", "author": {"login": "ekazachkova"}, "path": "api/src/test/java/com/epam/pipeline/acl/region/CloudRegionApiServiceTest.java", "diffHunk": "@@ -0,0 +1,261 @@\n+/*\n+ * Copyright 2017-2020 EPAM Systems, Inc. (https://www.epam.com/)\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package com.epam.pipeline.acl.region;\n+\n+import com.epam.pipeline.controller.vo.region.AWSRegionDTO;\n+import com.epam.pipeline.controller.vo.region.AbstractCloudRegionDTO;\n+import com.epam.pipeline.entity.info.CloudRegionInfo;\n+import com.epam.pipeline.entity.region.AbstractCloudRegion;\n+import com.epam.pipeline.entity.region.AwsRegion;\n+import com.epam.pipeline.entity.region.CloudProvider;\n+import com.epam.pipeline.manager.region.CloudRegionManager;\n+import com.epam.pipeline.security.acl.AclPermission;\n+import com.epam.pipeline.test.acl.AbstractAclTest;\n+import org.junit.Before;\n+import org.junit.Test;\n+import org.springframework.beans.factory.annotation.Autowired;\n+import org.springframework.security.access.AccessDeniedException;\n+import org.springframework.security.test.context.support.WithMockUser;\n+\n+import java.util.ArrayList;\n+import java.util.Arrays;\n+import java.util.Collections;\n+import java.util.List;\n+\n+import static org.assertj.core.api.Assertions.assertThat;\n+import static org.mockito.Matchers.eq;\n+import static org.mockito.Mockito.doReturn;\n+import static org.mockito.Mockito.when;\n+\n+public class CloudRegionApiServiceTest extends AbstractAclTest {\n+\n+    @Autowired\n+    private CloudRegionApiService cloudRegionApiService;\n+\n+    @Autowired\n+    private CloudRegionManager mockCloudRegionManager;\n+\n+    private final AbstractCloudRegionDTO cloudRegionDTO = new AWSRegionDTO();\n+\n+    private final List<String> availableCloudsList = Arrays.asList(\"AWS\", \"AZURE\", \"GCP\");\n+\n+    private AwsRegion region;\n+\n+    private AwsRegion regionWithoutPermission;\n+\n+    private List<AbstractCloudRegion> singleRegionList;\n+\n+    private List<AbstractCloudRegion> twoRegionsList;\n+\n+    private List<CloudRegionInfo> cloudRegionInfoList;\n+\n+    @Before\n+    public void setUp() throws Exception {\n+        region = new AwsRegion();\n+        region.setId(1L);\n+        region.setName(\"OWNER\");\n+        region.setOwner(OWNER_USER);\n+\n+        regionWithoutPermission = new AwsRegion();\n+        regionWithoutPermission.setId(2L);\n+        regionWithoutPermission.setName(\"SIMPLE_USER\");\n+        regionWithoutPermission.setOwner(OWNER_USER);\n+\n+        singleRegionList = new ArrayList<>();\n+        singleRegionList.add(region);\n+\n+        twoRegionsList = new ArrayList<>();", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMDI3ODA5OQ=="}, "originalCommit": {"oid": "e171e37bc99ab82b052ca7926f00309a92066e06"}, "originalPosition": 81}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTA0NjA0NjQ3", "url": "https://github.com/epam/cloud-pipeline/pull/1460#pullrequestreview-504604647", "createdAt": "2020-10-08T09:40:41Z", "commit": {"oid": "614e4ac3de3170ca83c37f28074c2f9ce499ad01"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wOFQwOTo0MDo0MVrOHeWTqg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wOFQwOTo0NDoyOFrOHeWczw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMTU4NDgxMA==", "bodyText": "Could you please change object casting to something like:\nfinal List<? extends AbstractCloudRegion> resultList = cloudRegionApiService.loadAll();\n\nassertThat(resultList).hasSize(1);\nassertThat(resultList.get(0)).isEqualTo(region);", "url": "https://github.com/epam/cloud-pipeline/pull/1460#discussion_r501584810", "createdAt": "2020-10-08T09:40:41Z", "author": {"login": "ekazachkova"}, "path": "api/src/test/java/com/epam/pipeline/acl/region/CloudRegionApiServiceTest.java", "diffHunk": "@@ -0,0 +1,251 @@\n+/*\n+ * Copyright 2017-2020 EPAM Systems, Inc. (https://www.epam.com/)\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package com.epam.pipeline.acl.region;\n+\n+import com.epam.pipeline.controller.vo.region.AWSRegionDTO;\n+import com.epam.pipeline.controller.vo.region.AbstractCloudRegionDTO;\n+import com.epam.pipeline.entity.info.CloudRegionInfo;\n+import com.epam.pipeline.entity.region.AbstractCloudRegion;\n+import com.epam.pipeline.entity.region.AwsRegion;\n+import com.epam.pipeline.entity.region.CloudProvider;\n+import com.epam.pipeline.manager.region.CloudRegionManager;\n+import com.epam.pipeline.security.acl.AclPermission;\n+import com.epam.pipeline.test.acl.AbstractAclTest;\n+import org.junit.Before;\n+import org.junit.Test;\n+import org.springframework.beans.factory.annotation.Autowired;\n+import org.springframework.security.access.AccessDeniedException;\n+import org.springframework.security.test.context.support.WithMockUser;\n+\n+import java.util.ArrayList;\n+import java.util.Arrays;\n+import java.util.Collections;\n+import java.util.List;\n+\n+import static org.assertj.core.api.Assertions.assertThat;\n+import static org.mockito.Matchers.eq;\n+import static org.mockito.Mockito.doReturn;\n+import static org.mockito.Mockito.when;\n+\n+public class CloudRegionApiServiceTest extends AbstractAclTest {\n+\n+    @Autowired\n+    private CloudRegionApiService cloudRegionApiService;\n+\n+    @Autowired\n+    private CloudRegionManager mockCloudRegionManager;\n+\n+    private final AbstractCloudRegionDTO cloudRegionDTO = new AWSRegionDTO();\n+\n+    private final List<String> availableCloudsList = Arrays.asList(\"AWS\", \"AZURE\", \"GCP\");\n+\n+    private AwsRegion region;\n+\n+    private List<AbstractCloudRegion> singleRegionList;\n+\n+    private List<CloudRegionInfo> cloudRegionInfoList;\n+\n+    @Before\n+    public void setUp() throws Exception {\n+        region = new AwsRegion();\n+        region.setId(1L);\n+        region.setName(\"OWNER\");\n+        region.setOwner(OWNER_USER);\n+\n+        singleRegionList = new ArrayList<>();\n+        singleRegionList.add(region);\n+\n+        cloudRegionInfoList = Collections.singletonList(new CloudRegionInfo(region));\n+    }\n+\n+    @Test\n+    @WithMockUser(roles = ADMIN_ROLE)\n+    public void shouldAllowLoadRegionsInfoForAdmin() {\n+        doReturn(cloudRegionInfoList).when(mockCloudRegionManager).loadAllRegionsInfo();\n+\n+        assertThat(cloudRegionApiService.loadAllRegionsInfo()).isEqualTo(cloudRegionInfoList);\n+    }\n+\n+    @Test\n+    @WithMockUser(roles = GENERAL_USER_ROLE)\n+    public void shouldAllowLoadRegionsInfoForGeneralUser() {\n+        doReturn(cloudRegionInfoList).when(mockCloudRegionManager).loadAllRegionsInfo();\n+\n+        assertThat(cloudRegionApiService.loadAllRegionsInfo()).isEqualTo(cloudRegionInfoList);\n+    }\n+\n+    @Test(expected = AccessDeniedException.class)\n+    @WithMockUser(roles = SIMPLE_USER_ROLE)\n+    public void shouldDenyLoadRegionsInfoForNotAdminOrGeneralUser() {\n+        doReturn(cloudRegionInfoList).when(mockCloudRegionManager).loadAllRegionsInfo();\n+\n+        cloudRegionApiService.loadAllRegionsInfo();\n+    }\n+\n+    @Test\n+    @WithMockUser(roles = ADMIN_ROLE)\n+    public void shouldCreateAbstractCloudRegionForAdmin() {\n+        doReturn(region).when(mockCloudRegionManager).create(cloudRegionDTO);\n+\n+        assertThat(cloudRegionApiService.create(cloudRegionDTO)).isEqualTo(region);\n+    }\n+\n+    @Test(expected = AccessDeniedException.class)\n+    @WithMockUser(roles = SIMPLE_USER_ROLE)\n+    public void shouldNotCreateAbstractCloudRegionForNotAdmin() {\n+        doReturn(region).when(mockCloudRegionManager).create(cloudRegionDTO);\n+\n+        cloudRegionApiService.create(cloudRegionDTO);\n+    }\n+\n+    @Test\n+    @WithMockUser(roles = ADMIN_ROLE)\n+    public void shouldUpdateAbstractCloudRegionForAdmin() {\n+        doReturn(region).when(mockCloudRegionManager).update(region.getId(), cloudRegionDTO);\n+\n+        assertThat(cloudRegionApiService.update(region.getId(), cloudRegionDTO)).isEqualTo(region);\n+    }\n+\n+    @Test(expected = AccessDeniedException.class)\n+    @WithMockUser(roles = SIMPLE_USER_ROLE)\n+    public void shouldNotUpdateAbstractCloudRegionForNotAdmin() {\n+        doReturn(region).when(mockCloudRegionManager).update(region.getId(), cloudRegionDTO);\n+\n+        cloudRegionApiService.update(region.getId(), cloudRegionDTO);\n+    }\n+\n+    @Test\n+    @WithMockUser(roles = ADMIN_ROLE)\n+    public void shouldDeleteAbstractCloudRegionForAdmin() {\n+        doReturn(region).when(mockCloudRegionManager).delete(region.getId());\n+\n+        assertThat(cloudRegionApiService.delete(region.getId())).isEqualTo(region);\n+    }\n+\n+    @Test(expected = AccessDeniedException.class)\n+    @WithMockUser(roles = SIMPLE_USER_ROLE)\n+    public void shouldDeleteAbstractCloudRegionForNotAdmin() {\n+        doReturn(region).when(mockCloudRegionManager).delete(region.getId());\n+\n+        cloudRegionApiService.delete(region.getId());\n+    }\n+\n+    @Test\n+    @WithMockUser(roles = ADMIN_ROLE)\n+    public void shouldLoadAllAvailableCloudsForAdmin() {\n+        doReturn(availableCloudsList).when(mockCloudRegionManager).loadAllAvailable(CloudProvider.AWS);\n+\n+        assertThat(cloudRegionApiService.loadAllAvailable(CloudProvider.AWS)).isEqualTo(availableCloudsList);\n+    }\n+\n+    @Test(expected = AccessDeniedException.class)\n+    @WithMockUser(roles = SIMPLE_USER_ROLE)\n+    public void shouldNotLoadAllAvailableCloudsForNotAdmin() {\n+        doReturn(availableCloudsList).when(mockCloudRegionManager).loadAllAvailable(CloudProvider.AWS);\n+\n+        cloudRegionApiService.loadAllAvailable(CloudProvider.AWS);\n+    }\n+\n+    @Test\n+    @WithMockUser(roles = ADMIN_ROLE)\n+    public void shouldReturnAllCloudRegionsForAdmin() {\n+        doReturn(singleRegionList).when(mockCloudRegionManager).loadAll();\n+\n+        final List<AwsRegion> resultList = (List<AwsRegion>) cloudRegionApiService.loadAll();\n+\n+        assertThat(resultList).hasSize(1).contains(region);\n+    }\n+\n+    @Test\n+    @WithMockUser(username = SIMPLE_USER_ROLE)\n+    public void shouldReturnAllCloudRegionsWhenPermissionIsGranted() {\n+        initAclEntity(region,\n+                Collections.singletonList(new UserPermission(SIMPLE_USER_ROLE, AclPermission.READ.getMask())));\n+        doReturn(singleRegionList).when(mockCloudRegionManager).loadAll();\n+\n+        final List<AwsRegion> resultList = (List<AwsRegion>) cloudRegionApiService.loadAll();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "614e4ac3de3170ca83c37f28074c2f9ce499ad01"}, "originalPosition": 180}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMTU4NzE1MQ==", "bodyText": "Will this code ever get executed?", "url": "https://github.com/epam/cloud-pipeline/pull/1460#discussion_r501587151", "createdAt": "2020-10-08T09:44:28Z", "author": {"login": "ekazachkova"}, "path": "api/src/test/java/com/epam/pipeline/acl/region/CloudRegionApiServiceTest.java", "diffHunk": "@@ -0,0 +1,251 @@\n+/*\n+ * Copyright 2017-2020 EPAM Systems, Inc. (https://www.epam.com/)\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package com.epam.pipeline.acl.region;\n+\n+import com.epam.pipeline.controller.vo.region.AWSRegionDTO;\n+import com.epam.pipeline.controller.vo.region.AbstractCloudRegionDTO;\n+import com.epam.pipeline.entity.info.CloudRegionInfo;\n+import com.epam.pipeline.entity.region.AbstractCloudRegion;\n+import com.epam.pipeline.entity.region.AwsRegion;\n+import com.epam.pipeline.entity.region.CloudProvider;\n+import com.epam.pipeline.manager.region.CloudRegionManager;\n+import com.epam.pipeline.security.acl.AclPermission;\n+import com.epam.pipeline.test.acl.AbstractAclTest;\n+import org.junit.Before;\n+import org.junit.Test;\n+import org.springframework.beans.factory.annotation.Autowired;\n+import org.springframework.security.access.AccessDeniedException;\n+import org.springframework.security.test.context.support.WithMockUser;\n+\n+import java.util.ArrayList;\n+import java.util.Arrays;\n+import java.util.Collections;\n+import java.util.List;\n+\n+import static org.assertj.core.api.Assertions.assertThat;\n+import static org.mockito.Matchers.eq;\n+import static org.mockito.Mockito.doReturn;\n+import static org.mockito.Mockito.when;\n+\n+public class CloudRegionApiServiceTest extends AbstractAclTest {\n+\n+    @Autowired\n+    private CloudRegionApiService cloudRegionApiService;\n+\n+    @Autowired\n+    private CloudRegionManager mockCloudRegionManager;\n+\n+    private final AbstractCloudRegionDTO cloudRegionDTO = new AWSRegionDTO();\n+\n+    private final List<String> availableCloudsList = Arrays.asList(\"AWS\", \"AZURE\", \"GCP\");\n+\n+    private AwsRegion region;\n+\n+    private List<AbstractCloudRegion> singleRegionList;\n+\n+    private List<CloudRegionInfo> cloudRegionInfoList;\n+\n+    @Before\n+    public void setUp() throws Exception {\n+        region = new AwsRegion();\n+        region.setId(1L);\n+        region.setName(\"OWNER\");\n+        region.setOwner(OWNER_USER);\n+\n+        singleRegionList = new ArrayList<>();\n+        singleRegionList.add(region);\n+\n+        cloudRegionInfoList = Collections.singletonList(new CloudRegionInfo(region));\n+    }\n+\n+    @Test\n+    @WithMockUser(roles = ADMIN_ROLE)\n+    public void shouldAllowLoadRegionsInfoForAdmin() {\n+        doReturn(cloudRegionInfoList).when(mockCloudRegionManager).loadAllRegionsInfo();\n+\n+        assertThat(cloudRegionApiService.loadAllRegionsInfo()).isEqualTo(cloudRegionInfoList);\n+    }\n+\n+    @Test\n+    @WithMockUser(roles = GENERAL_USER_ROLE)\n+    public void shouldAllowLoadRegionsInfoForGeneralUser() {\n+        doReturn(cloudRegionInfoList).when(mockCloudRegionManager).loadAllRegionsInfo();\n+\n+        assertThat(cloudRegionApiService.loadAllRegionsInfo()).isEqualTo(cloudRegionInfoList);\n+    }\n+\n+    @Test(expected = AccessDeniedException.class)\n+    @WithMockUser(roles = SIMPLE_USER_ROLE)\n+    public void shouldDenyLoadRegionsInfoForNotAdminOrGeneralUser() {\n+        doReturn(cloudRegionInfoList).when(mockCloudRegionManager).loadAllRegionsInfo();\n+\n+        cloudRegionApiService.loadAllRegionsInfo();\n+    }\n+\n+    @Test\n+    @WithMockUser(roles = ADMIN_ROLE)\n+    public void shouldCreateAbstractCloudRegionForAdmin() {\n+        doReturn(region).when(mockCloudRegionManager).create(cloudRegionDTO);\n+\n+        assertThat(cloudRegionApiService.create(cloudRegionDTO)).isEqualTo(region);\n+    }\n+\n+    @Test(expected = AccessDeniedException.class)\n+    @WithMockUser(roles = SIMPLE_USER_ROLE)\n+    public void shouldNotCreateAbstractCloudRegionForNotAdmin() {\n+        doReturn(region).when(mockCloudRegionManager).create(cloudRegionDTO);\n+\n+        cloudRegionApiService.create(cloudRegionDTO);\n+    }\n+\n+    @Test\n+    @WithMockUser(roles = ADMIN_ROLE)\n+    public void shouldUpdateAbstractCloudRegionForAdmin() {\n+        doReturn(region).when(mockCloudRegionManager).update(region.getId(), cloudRegionDTO);\n+\n+        assertThat(cloudRegionApiService.update(region.getId(), cloudRegionDTO)).isEqualTo(region);\n+    }\n+\n+    @Test(expected = AccessDeniedException.class)\n+    @WithMockUser(roles = SIMPLE_USER_ROLE)\n+    public void shouldNotUpdateAbstractCloudRegionForNotAdmin() {\n+        doReturn(region).when(mockCloudRegionManager).update(region.getId(), cloudRegionDTO);\n+\n+        cloudRegionApiService.update(region.getId(), cloudRegionDTO);\n+    }\n+\n+    @Test\n+    @WithMockUser(roles = ADMIN_ROLE)\n+    public void shouldDeleteAbstractCloudRegionForAdmin() {\n+        doReturn(region).when(mockCloudRegionManager).delete(region.getId());\n+\n+        assertThat(cloudRegionApiService.delete(region.getId())).isEqualTo(region);\n+    }\n+\n+    @Test(expected = AccessDeniedException.class)\n+    @WithMockUser(roles = SIMPLE_USER_ROLE)\n+    public void shouldDeleteAbstractCloudRegionForNotAdmin() {\n+        doReturn(region).when(mockCloudRegionManager).delete(region.getId());\n+\n+        cloudRegionApiService.delete(region.getId());\n+    }\n+\n+    @Test\n+    @WithMockUser(roles = ADMIN_ROLE)\n+    public void shouldLoadAllAvailableCloudsForAdmin() {\n+        doReturn(availableCloudsList).when(mockCloudRegionManager).loadAllAvailable(CloudProvider.AWS);\n+\n+        assertThat(cloudRegionApiService.loadAllAvailable(CloudProvider.AWS)).isEqualTo(availableCloudsList);\n+    }\n+\n+    @Test(expected = AccessDeniedException.class)\n+    @WithMockUser(roles = SIMPLE_USER_ROLE)\n+    public void shouldNotLoadAllAvailableCloudsForNotAdmin() {\n+        doReturn(availableCloudsList).when(mockCloudRegionManager).loadAllAvailable(CloudProvider.AWS);\n+\n+        cloudRegionApiService.loadAllAvailable(CloudProvider.AWS);\n+    }\n+\n+    @Test\n+    @WithMockUser(roles = ADMIN_ROLE)\n+    public void shouldReturnAllCloudRegionsForAdmin() {\n+        doReturn(singleRegionList).when(mockCloudRegionManager).loadAll();\n+\n+        final List<AwsRegion> resultList = (List<AwsRegion>) cloudRegionApiService.loadAll();\n+\n+        assertThat(resultList).hasSize(1).contains(region);\n+    }\n+\n+    @Test\n+    @WithMockUser(username = SIMPLE_USER_ROLE)\n+    public void shouldReturnAllCloudRegionsWhenPermissionIsGranted() {\n+        initAclEntity(region,\n+                Collections.singletonList(new UserPermission(SIMPLE_USER_ROLE, AclPermission.READ.getMask())));\n+        doReturn(singleRegionList).when(mockCloudRegionManager).loadAll();\n+\n+        final List<AwsRegion> resultList = (List<AwsRegion>) cloudRegionApiService.loadAll();\n+\n+        assertThat(resultList).hasSize(1).contains(region);\n+    }\n+\n+    @Test\n+    @WithMockUser(username = SIMPLE_USER_ROLE)\n+    public void shouldReturnListWithRegionsPermissionsForWhichIsGranted() {\n+        final AwsRegion regionWithoutPermission = new AwsRegion();\n+        regionWithoutPermission.setId(2L);\n+        regionWithoutPermission.setName(\"SIMPLE_USER\");\n+        regionWithoutPermission.setOwner(OWNER_USER);\n+\n+        final ArrayList<AbstractCloudRegion> twoRegionsList = new ArrayList<>();\n+        twoRegionsList.add(region);\n+        twoRegionsList.add(regionWithoutPermission);\n+\n+        initAclEntity(region,\n+                Collections.singletonList(new UserPermission(SIMPLE_USER_ROLE, AclPermission.READ.getMask())));\n+        initAclEntity(regionWithoutPermission,\n+                Collections.singletonList(new UserPermission(SIMPLE_USER_ROLE, AclPermission.NO_READ.getMask())));\n+        doReturn(twoRegionsList).when(mockCloudRegionManager).loadAll();\n+\n+        final List<AwsRegion> resultList = (List<AwsRegion>) cloudRegionApiService.loadAll();\n+\n+        assertThat(resultList).hasSize(1).contains(region);\n+    }\n+\n+    @Test\n+    @WithMockUser(username = SIMPLE_USER_ROLE)\n+    public void shouldReturnEmptyListOfCloudRegionsWithoutPermission() {\n+        initAclEntity(region);\n+        doReturn(singleRegionList).when(mockCloudRegionManager).loadAll();\n+\n+        final List<AwsRegion> resultList = (List<AwsRegion>) cloudRegionApiService.loadAll();\n+\n+        assertThat(resultList).isEmpty();\n+    }\n+\n+    @Test\n+    @WithMockUser(roles = ADMIN_ROLE)\n+    public void shouldReturnCloudRegionForAdmin() {\n+        doReturn(region).when(mockCloudRegionManager).load(region.getId());\n+\n+        final AbstractCloudRegion load = cloudRegionApiService.load(region.getId());\n+\n+        assertThat(load).isEqualTo(region);\n+    }\n+\n+    @Test\n+    @WithMockUser(username = SIMPLE_USER_ROLE)\n+    public void shouldReturnCloudRegionWhenPermissionIsGranted() {\n+        initAclEntity(region,\n+                Collections.singletonList(new UserPermission(SIMPLE_USER_ROLE, AclPermission.READ.getMask())));\n+        when(mockCloudRegionManager.load(eq(region.getId()))).thenReturn(region);\n+\n+        final AbstractCloudRegion result = cloudRegionApiService.load(region.getId());\n+\n+        assertThat(result).isEqualTo(region);\n+    }\n+\n+    @Test(expected = AccessDeniedException.class)\n+    @WithMockUser(username = SIMPLE_USER_ROLE)\n+    public void shouldFailReturningCloudRegionWithoutPermission() {\n+        initAclEntity(region);\n+        doReturn(region).when(mockCloudRegionManager).load(region.getId());\n+\n+        cloudRegionApiService.load(region.getId());\n+\n+        assertThat(region).isNull();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "614e4ac3de3170ca83c37f28074c2f9ce499ad01"}, "originalPosition": 249}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTA0NjkyMDY3", "url": "https://github.com/epam/cloud-pipeline/pull/1460#pullrequestreview-504692067", "createdAt": "2020-10-08T11:39:10Z", "commit": {"oid": "23b77bf7eb7b5f4faa77b35f457238f82a452b1e"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "6417a1f923969260f071a9dfde99e673ce661b8d", "author": {"user": {"login": "YouKofan", "name": "Iurii Kofanov"}}, "url": "https://github.com/epam/cloud-pipeline/commit/6417a1f923969260f071a9dfde99e673ce661b8d", "committedDate": "2020-10-08T14:48:57Z", "message": "Issue #1404: Unfinished tests for CloudRegionApiService\n\nSigned-off-by: Iurii_Kofanov <youkofan@gmail.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b096a5c6cceb49139cbef36a173554d791b95866", "author": {"user": {"login": "YouKofan", "name": "Iurii Kofanov"}}, "url": "https://github.com/epam/cloud-pipeline/commit/b096a5c6cceb49139cbef36a173554d791b95866", "committedDate": "2020-10-08T14:49:23Z", "message": "Issue #1404: Implemented tests for CloudRegionApiService\n\nSigned-off-by: Iurii_Kofanov <youkofan@gmail.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "939ead638e26aa63c28bad2406e566c5d79b8ccd", "author": {"user": {"login": "YouKofan", "name": "Iurii Kofanov"}}, "url": "https://github.com/epam/cloud-pipeline/commit/939ead638e26aa63c28bad2406e566c5d79b8ccd", "committedDate": "2020-10-08T14:49:23Z", "message": "Issue #1404: Refactoring and improvement tests for CloudRegionApiService\n\nSigned-off-by: Iurii_Kofanov <youkofan@gmail.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "22fbd594618eed03a57e31b54bcc81e909fabc21", "author": {"user": {"login": "YouKofan", "name": "Iurii Kofanov"}}, "url": "https://github.com/epam/cloud-pipeline/commit/22fbd594618eed03a57e31b54bcc81e909fabc21", "committedDate": "2020-10-08T14:49:23Z", "message": "Issue #1404: Fixed issues with permissions in CloudRegionApiService tests\n\nSigned-off-by: Iurii_Kofanov <youkofan@gmail.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "40ddedce464ce3f8fadc5cb0db92045cc91a13a0", "author": {"user": {"login": "YouKofan", "name": "Iurii Kofanov"}}, "url": "https://github.com/epam/cloud-pipeline/commit/40ddedce464ce3f8fadc5cb0db92045cc91a13a0", "committedDate": "2020-10-08T14:49:24Z", "message": "Issue #1404: implemented tests for CloudRegionApiService.class\n\nSigned-off-by: Iurii_Kofanov <youkofan@gmail.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "15b9dbc8e47b0af3a4201362fb629e014da560a9", "author": {"user": {"login": "YouKofan", "name": "Iurii Kofanov"}}, "url": "https://github.com/epam/cloud-pipeline/commit/15b9dbc8e47b0af3a4201362fb629e014da560a9", "committedDate": "2020-10-08T14:49:24Z", "message": "Issue #1404: Fixes in accordance with comments\n\nSigned-off-by: Iurii_Kofanov <youkofan@gmail.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "8852333ca0c50905a5c68a6a993ec6caf305f100", "author": {"user": {"login": "YouKofan", "name": "Iurii Kofanov"}}, "url": "https://github.com/epam/cloud-pipeline/commit/8852333ca0c50905a5c68a6a993ec6caf305f100", "committedDate": "2020-10-08T14:49:24Z", "message": "Issue #1404: Removed unused imports\n\nSigned-off-by: Iurii_Kofanov <youkofan@gmail.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a64d13003b3b93021398adbcd24f4ee612189809", "author": {"user": {"login": "YouKofan", "name": "Iurii Kofanov"}}, "url": "https://github.com/epam/cloud-pipeline/commit/a64d13003b3b93021398adbcd24f4ee612189809", "committedDate": "2020-10-08T14:49:24Z", "message": "Issue #1404: Minor fixes in tests\n\nSigned-off-by: Iurii_Kofanov <youkofan@gmail.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ecacb841b97bfdeeb7c2eeb64d87c74ca3151430", "author": {"user": {"login": "YouKofan", "name": "Iurii Kofanov"}}, "url": "https://github.com/epam/cloud-pipeline/commit/ecacb841b97bfdeeb7c2eeb64d87c74ca3151430", "committedDate": "2020-10-08T14:49:24Z", "message": "Issue #1404: corrections according to comments\n\nSigned-off-by: Iurii_Kofanov <youkofan@gmail.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "3ff88f26289aa046135c2f65224f532cbc1f180a", "author": {"user": {"login": "YouKofan", "name": "Iurii Kofanov"}}, "url": "https://github.com/epam/cloud-pipeline/commit/3ff88f26289aa046135c2f65224f532cbc1f180a", "committedDate": "2020-10-08T14:49:25Z", "message": "Issue #1404: tests corrections\n\nSigned-off-by: Iurii_Kofanov <youkofan@gmail.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f789b8913c04c72bf4dc9542545c5bd06e327fde", "author": {"user": {"login": "YouKofan", "name": "Iurii Kofanov"}}, "url": "https://github.com/epam/cloud-pipeline/commit/f789b8913c04c72bf4dc9542545c5bd06e327fde", "committedDate": "2020-10-08T14:49:25Z", "message": "Issue #1404: improvements of asserts in PostFilter tests\n\nSigned-off-by: Iurii_Kofanov <youkofan@gmail.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "465dbf0e4dd6570bededce2198bda7e0348b5458", "author": {"user": {"login": "YouKofan", "name": "Iurii Kofanov"}}, "url": "https://github.com/epam/cloud-pipeline/commit/465dbf0e4dd6570bededce2198bda7e0348b5458", "committedDate": "2020-10-08T14:49:25Z", "message": "Issue #1404: assertions refactoring + removed one redundant assertion\n\nSigned-off-by: Iurii_Kofanov <youkofan@gmail.com>"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "23b77bf7eb7b5f4faa77b35f457238f82a452b1e", "author": {"user": {"login": "YouKofan", "name": "Iurii Kofanov"}}, "url": "https://github.com/epam/cloud-pipeline/commit/23b77bf7eb7b5f4faa77b35f457238f82a452b1e", "committedDate": "2020-10-08T10:54:38Z", "message": "Issue #1404: assertions refactoring + removed one redundant assertion\n\nSigned-off-by: Iurii_Kofanov <youkofan@gmail.com>"}, "afterCommit": {"oid": "465dbf0e4dd6570bededce2198bda7e0348b5458", "author": {"user": {"login": "YouKofan", "name": "Iurii Kofanov"}}, "url": "https://github.com/epam/cloud-pipeline/commit/465dbf0e4dd6570bededce2198bda7e0348b5458", "committedDate": "2020-10-08T14:49:25Z", "message": "Issue #1404: assertions refactoring + removed one redundant assertion\n\nSigned-off-by: Iurii_Kofanov <youkofan@gmail.com>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTA0OTEwNDU1", "url": "https://github.com/epam/cloud-pipeline/pull/1460#pullrequestreview-504910455", "createdAt": "2020-10-08T15:32:55Z", "commit": {"oid": "465dbf0e4dd6570bededce2198bda7e0348b5458"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wOFQxNTozMjo1NVrOHekaNQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wOFQxNTo0MDowMlrOHektsQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMTgxNTg2MQ==", "bodyText": "Can't we use here SIMPLE_USER_ROLE? I think it is better to stuck to one role if both have equal meaning", "url": "https://github.com/epam/cloud-pipeline/pull/1460#discussion_r501815861", "createdAt": "2020-10-08T15:32:55Z", "author": {"login": "mzueva"}, "path": "api/src/test/java/com/epam/pipeline/acl/region/CloudRegionApiServiceTest.java", "diffHunk": "@@ -0,0 +1,252 @@\n+/*\n+ * Copyright 2017-2020 EPAM Systems, Inc. (https://www.epam.com/)\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package com.epam.pipeline.acl.region;\n+\n+import com.epam.pipeline.controller.vo.region.AWSRegionDTO;\n+import com.epam.pipeline.controller.vo.region.AbstractCloudRegionDTO;\n+import com.epam.pipeline.entity.info.CloudRegionInfo;\n+import com.epam.pipeline.entity.region.AbstractCloudRegion;\n+import com.epam.pipeline.entity.region.AwsRegion;\n+import com.epam.pipeline.entity.region.CloudProvider;\n+import com.epam.pipeline.manager.region.CloudRegionManager;\n+import com.epam.pipeline.security.acl.AclPermission;\n+import com.epam.pipeline.test.acl.AbstractAclTest;\n+import org.junit.Before;\n+import org.junit.Test;\n+import org.springframework.beans.factory.annotation.Autowired;\n+import org.springframework.security.access.AccessDeniedException;\n+import org.springframework.security.test.context.support.WithMockUser;\n+\n+import java.util.ArrayList;\n+import java.util.Arrays;\n+import java.util.Collections;\n+import java.util.List;\n+\n+import static org.assertj.core.api.Assertions.assertThat;\n+import static org.mockito.Matchers.eq;\n+import static org.mockito.Mockito.doReturn;\n+import static org.mockito.Mockito.when;\n+\n+public class CloudRegionApiServiceTest extends AbstractAclTest {\n+\n+    @Autowired\n+    private CloudRegionApiService cloudRegionApiService;\n+\n+    @Autowired\n+    private CloudRegionManager mockCloudRegionManager;\n+\n+    private final AbstractCloudRegionDTO cloudRegionDTO = new AWSRegionDTO();\n+\n+    private final List<String> availableCloudsList = Arrays.asList(\"AWS\", \"AZURE\", \"GCP\");\n+\n+    private AwsRegion region;\n+\n+    private List<AbstractCloudRegion> singleRegionList;\n+\n+    private List<CloudRegionInfo> cloudRegionInfoList;\n+\n+    @Before\n+    public void setUp() throws Exception {\n+        region = new AwsRegion();\n+        region.setId(1L);\n+        region.setName(\"OWNER\");\n+        region.setOwner(OWNER_USER);\n+\n+        singleRegionList = new ArrayList<>();\n+        singleRegionList.add(region);\n+\n+        cloudRegionInfoList = Collections.singletonList(new CloudRegionInfo(region));\n+    }\n+\n+    @Test\n+    @WithMockUser(roles = ADMIN_ROLE)\n+    public void shouldAllowLoadRegionsInfoForAdmin() {\n+        doReturn(cloudRegionInfoList).when(mockCloudRegionManager).loadAllRegionsInfo();\n+\n+        assertThat(cloudRegionApiService.loadAllRegionsInfo()).isEqualTo(cloudRegionInfoList);\n+    }\n+\n+    @Test\n+    @WithMockUser(roles = GENERAL_USER_ROLE)", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "465dbf0e4dd6570bededce2198bda7e0348b5458"}, "originalPosition": 84}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMTgxNzQxMA==", "bodyText": "Please, do not mix role and username, let's introduce a separate constant for username", "url": "https://github.com/epam/cloud-pipeline/pull/1460#discussion_r501817410", "createdAt": "2020-10-08T15:35:08Z", "author": {"login": "mzueva"}, "path": "api/src/test/java/com/epam/pipeline/acl/region/CloudRegionApiServiceTest.java", "diffHunk": "@@ -0,0 +1,252 @@\n+/*\n+ * Copyright 2017-2020 EPAM Systems, Inc. (https://www.epam.com/)\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package com.epam.pipeline.acl.region;\n+\n+import com.epam.pipeline.controller.vo.region.AWSRegionDTO;\n+import com.epam.pipeline.controller.vo.region.AbstractCloudRegionDTO;\n+import com.epam.pipeline.entity.info.CloudRegionInfo;\n+import com.epam.pipeline.entity.region.AbstractCloudRegion;\n+import com.epam.pipeline.entity.region.AwsRegion;\n+import com.epam.pipeline.entity.region.CloudProvider;\n+import com.epam.pipeline.manager.region.CloudRegionManager;\n+import com.epam.pipeline.security.acl.AclPermission;\n+import com.epam.pipeline.test.acl.AbstractAclTest;\n+import org.junit.Before;\n+import org.junit.Test;\n+import org.springframework.beans.factory.annotation.Autowired;\n+import org.springframework.security.access.AccessDeniedException;\n+import org.springframework.security.test.context.support.WithMockUser;\n+\n+import java.util.ArrayList;\n+import java.util.Arrays;\n+import java.util.Collections;\n+import java.util.List;\n+\n+import static org.assertj.core.api.Assertions.assertThat;\n+import static org.mockito.Matchers.eq;\n+import static org.mockito.Mockito.doReturn;\n+import static org.mockito.Mockito.when;\n+\n+public class CloudRegionApiServiceTest extends AbstractAclTest {\n+\n+    @Autowired\n+    private CloudRegionApiService cloudRegionApiService;\n+\n+    @Autowired\n+    private CloudRegionManager mockCloudRegionManager;\n+\n+    private final AbstractCloudRegionDTO cloudRegionDTO = new AWSRegionDTO();\n+\n+    private final List<String> availableCloudsList = Arrays.asList(\"AWS\", \"AZURE\", \"GCP\");\n+\n+    private AwsRegion region;\n+\n+    private List<AbstractCloudRegion> singleRegionList;\n+\n+    private List<CloudRegionInfo> cloudRegionInfoList;\n+\n+    @Before\n+    public void setUp() throws Exception {\n+        region = new AwsRegion();\n+        region.setId(1L);\n+        region.setName(\"OWNER\");\n+        region.setOwner(OWNER_USER);\n+\n+        singleRegionList = new ArrayList<>();\n+        singleRegionList.add(region);\n+\n+        cloudRegionInfoList = Collections.singletonList(new CloudRegionInfo(region));\n+    }\n+\n+    @Test\n+    @WithMockUser(roles = ADMIN_ROLE)\n+    public void shouldAllowLoadRegionsInfoForAdmin() {\n+        doReturn(cloudRegionInfoList).when(mockCloudRegionManager).loadAllRegionsInfo();\n+\n+        assertThat(cloudRegionApiService.loadAllRegionsInfo()).isEqualTo(cloudRegionInfoList);\n+    }\n+\n+    @Test\n+    @WithMockUser(roles = GENERAL_USER_ROLE)\n+    public void shouldAllowLoadRegionsInfoForGeneralUser() {\n+        doReturn(cloudRegionInfoList).when(mockCloudRegionManager).loadAllRegionsInfo();\n+\n+        assertThat(cloudRegionApiService.loadAllRegionsInfo()).isEqualTo(cloudRegionInfoList);\n+    }\n+\n+    @Test(expected = AccessDeniedException.class)\n+    @WithMockUser(roles = SIMPLE_USER_ROLE)\n+    public void shouldDenyLoadRegionsInfoForNotAdminOrGeneralUser() {\n+        doReturn(cloudRegionInfoList).when(mockCloudRegionManager).loadAllRegionsInfo();\n+\n+        cloudRegionApiService.loadAllRegionsInfo();\n+    }\n+\n+    @Test\n+    @WithMockUser(roles = ADMIN_ROLE)\n+    public void shouldCreateAbstractCloudRegionForAdmin() {\n+        doReturn(region).when(mockCloudRegionManager).create(cloudRegionDTO);\n+\n+        assertThat(cloudRegionApiService.create(cloudRegionDTO)).isEqualTo(region);\n+    }\n+\n+    @Test(expected = AccessDeniedException.class)\n+    @WithMockUser(roles = SIMPLE_USER_ROLE)\n+    public void shouldNotCreateAbstractCloudRegionForNotAdmin() {\n+        doReturn(region).when(mockCloudRegionManager).create(cloudRegionDTO);\n+\n+        cloudRegionApiService.create(cloudRegionDTO);\n+    }\n+\n+    @Test\n+    @WithMockUser(roles = ADMIN_ROLE)\n+    public void shouldUpdateAbstractCloudRegionForAdmin() {\n+        doReturn(region).when(mockCloudRegionManager).update(region.getId(), cloudRegionDTO);\n+\n+        assertThat(cloudRegionApiService.update(region.getId(), cloudRegionDTO)).isEqualTo(region);\n+    }\n+\n+    @Test(expected = AccessDeniedException.class)\n+    @WithMockUser(roles = SIMPLE_USER_ROLE)\n+    public void shouldNotUpdateAbstractCloudRegionForNotAdmin() {\n+        doReturn(region).when(mockCloudRegionManager).update(region.getId(), cloudRegionDTO);\n+\n+        cloudRegionApiService.update(region.getId(), cloudRegionDTO);\n+    }\n+\n+    @Test\n+    @WithMockUser(roles = ADMIN_ROLE)\n+    public void shouldDeleteAbstractCloudRegionForAdmin() {\n+        doReturn(region).when(mockCloudRegionManager).delete(region.getId());\n+\n+        assertThat(cloudRegionApiService.delete(region.getId())).isEqualTo(region);\n+    }\n+\n+    @Test(expected = AccessDeniedException.class)\n+    @WithMockUser(roles = SIMPLE_USER_ROLE)\n+    public void shouldDeleteAbstractCloudRegionForNotAdmin() {\n+        doReturn(region).when(mockCloudRegionManager).delete(region.getId());\n+\n+        cloudRegionApiService.delete(region.getId());\n+    }\n+\n+    @Test\n+    @WithMockUser(roles = ADMIN_ROLE)\n+    public void shouldLoadAllAvailableCloudsForAdmin() {\n+        doReturn(availableCloudsList).when(mockCloudRegionManager).loadAllAvailable(CloudProvider.AWS);\n+\n+        assertThat(cloudRegionApiService.loadAllAvailable(CloudProvider.AWS)).isEqualTo(availableCloudsList);\n+    }\n+\n+    @Test(expected = AccessDeniedException.class)\n+    @WithMockUser(roles = SIMPLE_USER_ROLE)\n+    public void shouldNotLoadAllAvailableCloudsForNotAdmin() {\n+        doReturn(availableCloudsList).when(mockCloudRegionManager).loadAllAvailable(CloudProvider.AWS);\n+\n+        cloudRegionApiService.loadAllAvailable(CloudProvider.AWS);\n+    }\n+\n+    @Test\n+    @WithMockUser(roles = ADMIN_ROLE)\n+    public void shouldReturnAllCloudRegionsForAdmin() {\n+        doReturn(singleRegionList).when(mockCloudRegionManager).loadAll();\n+\n+        final List<? extends AbstractCloudRegion> resultList = cloudRegionApiService.loadAll();\n+\n+        assertThat(resultList).hasSize(1);\n+        assertThat(resultList.get(0)).isEqualTo(region);\n+    }\n+\n+    @Test\n+    @WithMockUser(username = SIMPLE_USER_ROLE)", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "465dbf0e4dd6570bededce2198bda7e0348b5458"}, "originalPosition": 175}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMTgyMDg0OQ==", "bodyText": "It seems that you can just use basePackages = {\"com.epam.pipeline.security.acl\", \"com.epam.pipeline.manager.security\"} without excludes", "url": "https://github.com/epam/cloud-pipeline/pull/1460#discussion_r501820849", "createdAt": "2020-10-08T15:40:02Z", "author": {"login": "mzueva"}, "path": "api/src/test/java/com/epam/pipeline/test/acl/AclTestConfiguration.java", "diffHunk": "@@ -37,10 +39,18 @@\n  */\n @Target(ElementType.TYPE)\n @Retention(RetentionPolicy.RUNTIME)\n+@ContextConfiguration(classes = {AclTestBeans.class, AclSecurityConfiguration.class})\n+@ComponentScan(", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "465dbf0e4dd6570bededce2198bda7e0348b5458"}, "originalPosition": 15}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "4150d8d70fc7ffaa5fdf03bb539a8375a2743b7d", "author": {"user": {"login": "YouKofan", "name": "Iurii Kofanov"}}, "url": "https://github.com/epam/cloud-pipeline/commit/4150d8d70fc7ffaa5fdf03bb539a8375a2743b7d", "committedDate": "2020-10-08T18:31:23Z", "message": "Issue #1404: variable names improvements, remove redundant configs\n\nSigned-off-by: Iurii_Kofanov <youkofan@gmail.com>"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3653, "cost": 1, "resetAt": "2021-11-01T14:20:25Z"}}}