{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDIyNjQ1NTQ5", "number": 1136, "title": "Issue 1124 Sensitive runs", "bodyText": "this RP related to #1124 and brings new feature to run pipelines as sensitive if it has sensitive storages.", "createdAt": "2020-05-25T09:26:43Z", "url": "https://github.com/epam/cloud-pipeline/pull/1136", "merged": true, "mergeCommit": {"oid": "7f25217c8556fec11f51ef069dda1acdba347df8"}, "closed": true, "closedAt": "2020-05-27T11:22:30Z", "author": {"login": "SilinPavel"}, "timelineItems": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABckskIxgH2gAyNDIyNjQ1NTQ5OjM1MjFhODMyNmJiNzk1YTE0YzI2ZjVjNmI4NzhlZmUwYTdmY2ZlMzc=", "endCursor": "Y3Vyc29yOnYyOpPPAAABclHemFAH2gAyNDIyNjQ1NTQ5OjdlZTIxZTc0N2QxYzNmMWI3M2RmNmJjODI4OTM4M2MwYmNhODQyNzg=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "3521a8326bb795a14c26f5c6b878efe0a7fcfe37", "author": {"user": {"login": "SilinPavel", "name": "Pavel Silin"}}, "url": "https://github.com/epam/cloud-pipeline/commit/3521a8326bb795a14c26f5c6b878efe0a7fcfe37", "committedDate": "2020-05-25T09:22:39Z", "message": "(issue #1124) introduce new PipelineRun field sensitive"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "12625146e95314518e33a3b3f4d1f0ac0b34cd16", "author": {"user": {"login": "SilinPavel", "name": "Pavel Silin"}}, "url": "https://github.com/epam/cloud-pipeline/commit/12625146e95314518e33a3b3f4d1f0ac0b34cd16", "committedDate": "2020-05-25T09:22:39Z", "message": "(issue #1124) FSBrowser installation check"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c73e42f7cfd1790ae4a4dbd7e68005fd88ce6f0a", "author": {"user": {"login": "SilinPavel", "name": "Pavel Silin"}}, "url": "https://github.com/epam/cloud-pipeline/commit/c73e42f7cfd1790ae4a4dbd7e68005fd88ce6f0a", "committedDate": "2020-05-25T09:24:49Z", "message": "(issue #1124) mount storages with ro permission if run is sensitive"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDE4MzQ1MjI5", "url": "https://github.com/epam/cloud-pipeline/pull/1136#pullrequestreview-418345229", "createdAt": "2020-05-26T14:18:22Z", "commit": {"oid": "c73e42f7cfd1790ae4a4dbd7e68005fd88ce6f0a"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yNlQxNDoxODoyMlrOGageAw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yNlQxNDoyMzoxMVrOGagsOA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMDQ0ODEzMQ==", "bodyText": "It would be helpful to add a method to load  a list of storages by id, to reduce number of db requests.", "url": "https://github.com/epam/cloud-pipeline/pull/1136#discussion_r430448131", "createdAt": "2020-05-26T14:18:22Z", "author": {"login": "mzueva"}, "path": "api/src/main/java/com/epam/pipeline/manager/pipeline/PipelineRunManager.java", "diffHunk": "@@ -825,6 +827,17 @@ public PipelineRun createPipelineRun(String version, PipelineConfiguration confi\n         return run;\n     }\n \n+    private boolean checkRunForSensitivity(Map<String, PipeConfValueVO> parameters) {\n+        return parameters.entrySet().stream()\n+                .filter(v->v.getKey().equals(CP_CAP_LIMIT_MOUNTS))\n+                .map(Map.Entry::getValue)\n+                .flatMap(pipeConfValueVO -> Arrays.stream(\n+                        StringUtils.commaDelimitedListToStringArray(pipeConfValueVO.getValue()))\n+                )\n+                .map(Long::valueOf)\n+                .anyMatch(id -> dataStorageManager.load(id).isSensitive());", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c73e42f7cfd1790ae4a4dbd7e68005fd88ce6f0a"}, "originalPosition": 28}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMDQ0ODMzOA==", "bodyText": "Missing final", "url": "https://github.com/epam/cloud-pipeline/pull/1136#discussion_r430448338", "createdAt": "2020-05-26T14:18:38Z", "author": {"login": "mzueva"}, "path": "api/src/main/java/com/epam/pipeline/manager/pipeline/PipelineRunManager.java", "diffHunk": "@@ -825,6 +827,17 @@ public PipelineRun createPipelineRun(String version, PipelineConfiguration confi\n         return run;\n     }\n \n+    private boolean checkRunForSensitivity(Map<String, PipeConfValueVO> parameters) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c73e42f7cfd1790ae4a4dbd7e68005fd88ce6f0a"}, "originalPosition": 20}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMDQ0ODY3OA==", "bodyText": "Wrap into MapUtils.emptyIfNull", "url": "https://github.com/epam/cloud-pipeline/pull/1136#discussion_r430448678", "createdAt": "2020-05-26T14:19:04Z", "author": {"login": "mzueva"}, "path": "api/src/main/java/com/epam/pipeline/manager/pipeline/PipelineRunManager.java", "diffHunk": "@@ -825,6 +827,17 @@ public PipelineRun createPipelineRun(String version, PipelineConfiguration confi\n         return run;\n     }\n \n+    private boolean checkRunForSensitivity(Map<String, PipeConfValueVO> parameters) {\n+        return parameters.entrySet().stream()", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c73e42f7cfd1790ae4a4dbd7e68005fd88ce6f0a"}, "originalPosition": 21}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMDQ1MDMwMg==", "bodyText": "Missing final", "url": "https://github.com/epam/cloud-pipeline/pull/1136#discussion_r430450302", "createdAt": "2020-05-26T14:21:14Z", "author": {"login": "mzueva"}, "path": "api/src/main/java/com/epam/pipeline/manager/utils/UtilsManager.java", "diffHunk": "@@ -49,13 +54,17 @@ public String buildSshUrl(Long runId) {\n     }\n \n     public String buildFSBrowserUrl(Long runId) {\n-        if (isFSBrowserEnabled()) {\n+        if (isFSBrowserEnabled() && runIsNotSensitive(runId)) {\n             return buildUrl(FSBROWSER_URL_TEMPLATE, runId);\n         } else {\n             throw new IllegalArgumentException(\"Storage fsbrowser is not enabled.\");\n         }\n     }\n \n+    private boolean runIsNotSensitive(Long runId) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c73e42f7cfd1790ae4a4dbd7e68005fd88ce6f0a"}, "originalPosition": 33}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMDQ1MTc2OA==", "bodyText": "We also need to filter out sensitive storages for non-sensitive runs", "url": "https://github.com/epam/cloud-pipeline/pull/1136#discussion_r430451768", "createdAt": "2020-05-26T14:23:11Z", "author": {"login": "mzueva"}, "path": "workflows/pipe-common/scripts/mount_storage.py", "diffHunk": "@@ -61,6 +61,11 @@ def is_storage_writable(cls, storage):\n     def is_permission_set(cls, storage, mask):\n         return storage.mask & mask == mask\n \n+    @classmethod\n+    def is_run_sensitive(cls):", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c73e42f7cfd1790ae4a4dbd7e68005fd88ce6f0a"}, "originalPosition": 5}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "7ee21e747d1c3f1b73df6bc8289383c0bca84278", "author": {"user": {"login": "SilinPavel", "name": "Pavel Silin"}}, "url": "https://github.com/epam/cloud-pipeline/commit/7ee21e747d1c3f1b73df6bc8289383c0bca84278", "committedDate": "2020-05-26T16:44:02Z", "message": "(issue #1124) changes for review"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3843, "cost": 1, "resetAt": "2021-11-01T14:20:25Z"}}}