{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDk4NjExNzM5", "number": 1470, "reviewThreads": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xNFQwODoxNDoyNlrOEtXkgw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xOVQwNjo1NjoyMFrOEvK29w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzE2MDA3NTU1OnYy", "diffSide": "RIGHT", "path": "api/src/test/java/com/epam/pipeline/controller/contextual/ContextualPreferenceControllerTest.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xNFQwODoxNDoyNlrOHhHadw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xNFQwODoxNDoyNlrOHhHadw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNDQ4NjUxOQ==", "bodyText": "It seems cleaner to inline test class field initiliazations and get rid of setUp method.", "url": "https://github.com/epam/cloud-pipeline/pull/1470#discussion_r504486519", "createdAt": "2020-10-14T08:14:26Z", "author": {"login": "tcibinan"}, "path": "api/src/test/java/com/epam/pipeline/controller/contextual/ContextualPreferenceControllerTest.java", "diffHunk": "@@ -0,0 +1,219 @@\n+/*\n+ * Copyright 2017-2020 EPAM Systems, Inc. (https://www.epam.com/)\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package com.epam.pipeline.controller.contextual;\n+\n+import com.epam.pipeline.controller.ResponseResult;\n+import com.epam.pipeline.controller.Result;\n+import com.epam.pipeline.controller.vo.ContextualPreferenceVO;\n+import com.epam.pipeline.entity.contextual.ContextualPreference;\n+import com.epam.pipeline.entity.contextual.ContextualPreferenceExternalResource;\n+import com.epam.pipeline.entity.contextual.ContextualPreferenceLevel;\n+import com.epam.pipeline.entity.contextual.ContextualPreferenceSearchRequest;\n+import com.epam.pipeline.manager.contextual.ContextualPreferenceApiService;\n+import com.epam.pipeline.test.creator.contextual.ContextualPreferenceCreatorUtils;\n+import com.epam.pipeline.test.web.AbstractControllerTest;\n+import com.epam.pipeline.util.ControllerTestUtils;\n+import com.fasterxml.jackson.core.type.TypeReference;\n+import org.junit.Before;\n+import org.junit.Test;\n+import org.mockito.Mockito;\n+import org.springframework.beans.factory.annotation.Autowired;\n+import org.springframework.boot.test.autoconfigure.web.servlet.WebMvcTest;\n+import org.springframework.security.test.context.support.WithMockUser;\n+import org.springframework.test.web.servlet.MvcResult;\n+import org.springframework.test.web.servlet.request.MockMvcRequestBuilders;\n+\n+import java.util.Collections;\n+import java.util.List;\n+\n+import static org.springframework.test.web.servlet.request.MockMvcRequestBuilders.get;\n+import static org.springframework.test.web.servlet.request.MockMvcRequestBuilders.post;\n+import static org.springframework.test.web.servlet.request.MockMvcRequestBuilders.put;\n+import static org.springframework.test.web.servlet.result.MockMvcResultMatchers.content;\n+import static org.springframework.test.web.servlet.result.MockMvcResultMatchers.status;\n+\n+@WebMvcTest(controllers = ContextualPreferenceController.class)\n+public class ContextualPreferenceControllerTest extends AbstractControllerTest {\n+\n+    private static final String TEST_STRING = \"TEST\";\n+    private static final String CONTEXTUAL_URL = SERVLET_PATH + \"/contextual/preference\";\n+    private static final String LOAD_URL = CONTEXTUAL_URL + \"/load\";\n+    private static final String LOAD_ALL_URL = LOAD_URL + \"/all\";\n+    private static final ContextualPreferenceLevel PREFERENCE_LEVEL = ContextualPreferenceLevel.ROLE;\n+    private ContextualPreference contextualPreference;\n+    private ResponseResult<ContextualPreference> expectedResult;\n+    private ContextualPreferenceExternalResource contextualPreferenceExternalResource;\n+\n+    @Autowired\n+    private ContextualPreferenceApiService mockContextualPreferenceApiService;\n+\n+    @Before\n+    public void setUp() {\n+        contextualPreference = ContextualPreferenceCreatorUtils.getContextualPreference();\n+        expectedResult = ControllerTestUtils.buildExpectedResult(contextualPreference);\n+\n+        contextualPreferenceExternalResource\n+                = ContextualPreferenceCreatorUtils.getCPExternalResource();\n+    }", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "78e861cfeaa237b9549f48914b133dc89a23946e"}, "originalPosition": 71}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzE2MDE0NDE2OnYy", "diffSide": "RIGHT", "path": "api/src/test/java/com/epam/pipeline/controller/contextual/ContextualPreferenceControllerTest.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xNFQwODozMTozMFrOHhIFXQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xNFQwODozMTozMFrOHhIFXQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNDQ5NzUwMQ==", "bodyText": "Probably we can move this verbose type reference instantiation to some other place like ContextualPreferenceCreatorUtils. It can be pretty handy to use it later on like the following\nControllerTestUtils.assertResponse(mvcResult, getObjectMapper(), expectedResult, \n        ContextualPreferenceCreatorUtils.contextualPreferencesListType);\n// or\nControllerTestUtils.assertResponse(mvcResult, getObjectMapper(), expectedResult, \n        ContextualPreferenceCreatorUtils.listOfContextualPreferencesType);", "url": "https://github.com/epam/cloud-pipeline/pull/1470#discussion_r504497501", "createdAt": "2020-10-14T08:31:30Z", "author": {"login": "tcibinan"}, "path": "api/src/test/java/com/epam/pipeline/controller/contextual/ContextualPreferenceControllerTest.java", "diffHunk": "@@ -0,0 +1,219 @@\n+/*\n+ * Copyright 2017-2020 EPAM Systems, Inc. (https://www.epam.com/)\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package com.epam.pipeline.controller.contextual;\n+\n+import com.epam.pipeline.controller.ResponseResult;\n+import com.epam.pipeline.controller.Result;\n+import com.epam.pipeline.controller.vo.ContextualPreferenceVO;\n+import com.epam.pipeline.entity.contextual.ContextualPreference;\n+import com.epam.pipeline.entity.contextual.ContextualPreferenceExternalResource;\n+import com.epam.pipeline.entity.contextual.ContextualPreferenceLevel;\n+import com.epam.pipeline.entity.contextual.ContextualPreferenceSearchRequest;\n+import com.epam.pipeline.manager.contextual.ContextualPreferenceApiService;\n+import com.epam.pipeline.test.creator.contextual.ContextualPreferenceCreatorUtils;\n+import com.epam.pipeline.test.web.AbstractControllerTest;\n+import com.epam.pipeline.util.ControllerTestUtils;\n+import com.fasterxml.jackson.core.type.TypeReference;\n+import org.junit.Before;\n+import org.junit.Test;\n+import org.mockito.Mockito;\n+import org.springframework.beans.factory.annotation.Autowired;\n+import org.springframework.boot.test.autoconfigure.web.servlet.WebMvcTest;\n+import org.springframework.security.test.context.support.WithMockUser;\n+import org.springframework.test.web.servlet.MvcResult;\n+import org.springframework.test.web.servlet.request.MockMvcRequestBuilders;\n+\n+import java.util.Collections;\n+import java.util.List;\n+\n+import static org.springframework.test.web.servlet.request.MockMvcRequestBuilders.get;\n+import static org.springframework.test.web.servlet.request.MockMvcRequestBuilders.post;\n+import static org.springframework.test.web.servlet.request.MockMvcRequestBuilders.put;\n+import static org.springframework.test.web.servlet.result.MockMvcResultMatchers.content;\n+import static org.springframework.test.web.servlet.result.MockMvcResultMatchers.status;\n+\n+@WebMvcTest(controllers = ContextualPreferenceController.class)\n+public class ContextualPreferenceControllerTest extends AbstractControllerTest {\n+\n+    private static final String TEST_STRING = \"TEST\";\n+    private static final String CONTEXTUAL_URL = SERVLET_PATH + \"/contextual/preference\";\n+    private static final String LOAD_URL = CONTEXTUAL_URL + \"/load\";\n+    private static final String LOAD_ALL_URL = LOAD_URL + \"/all\";\n+    private static final ContextualPreferenceLevel PREFERENCE_LEVEL = ContextualPreferenceLevel.ROLE;\n+    private ContextualPreference contextualPreference;\n+    private ResponseResult<ContextualPreference> expectedResult;\n+    private ContextualPreferenceExternalResource contextualPreferenceExternalResource;\n+\n+    @Autowired\n+    private ContextualPreferenceApiService mockContextualPreferenceApiService;\n+\n+    @Before\n+    public void setUp() {\n+        contextualPreference = ContextualPreferenceCreatorUtils.getContextualPreference();\n+        expectedResult = ControllerTestUtils.buildExpectedResult(contextualPreference);\n+\n+        contextualPreferenceExternalResource\n+                = ContextualPreferenceCreatorUtils.getCPExternalResource();\n+    }\n+\n+    @Test\n+    public void shouldFailLoadAllForUnauthorizedUser() throws Exception {\n+        mvc().perform(get(LOAD_ALL_URL)\n+                .servletPath(SERVLET_PATH))\n+                .andExpect(status().isUnauthorized());\n+    }\n+\n+    @Test\n+    @WithMockUser\n+    public void shouldLoadAll() throws Exception {\n+        final List<ContextualPreference> contextualPreferences = Collections.singletonList(contextualPreference);\n+\n+        Mockito.doReturn(contextualPreferences).when(mockContextualPreferenceApiService).loadAll();\n+\n+        final MvcResult mvcResult = mvc().perform(get(LOAD_ALL_URL)\n+                .servletPath(SERVLET_PATH)\n+                .contentType(EXPECTED_CONTENT_TYPE))\n+                .andExpect(status().isOk())\n+                .andExpect(content().contentType(EXPECTED_CONTENT_TYPE))\n+                .andReturn();\n+\n+        Mockito.verify(mockContextualPreferenceApiService).loadAll();\n+\n+        final ResponseResult<List<ContextualPreference>> expectedResult =\n+                ControllerTestUtils.buildExpectedResult(contextualPreferences);\n+\n+        ControllerTestUtils.assertResponse(mvcResult, getObjectMapper(), expectedResult,\n+                new TypeReference<Result<List<ContextualPreference>>>() { });", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "78e861cfeaa237b9549f48914b133dc89a23946e"}, "originalPosition": 100}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzE3ODk2NDM5OnYy", "diffSide": "RIGHT", "path": "api/src/test/java/com/epam/pipeline/controller/contextual/ContextualPreferenceControllerTest.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xOVQwNjo1NjoyMFrOHkAIrg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xOVQwNjo1NjoyMFrOHkAIrg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNzUxMzAwNg==", "bodyText": "I wonder if it is a good idea to group test code lines logically. For instance we could split lines to three parts:\n\nsetup (building resources, configuring mocks)\ntest (performing test target operation)\nassert (verifying calls, asserting output)\n\nIn this test case it seems to increase readability if the code is organised like this:\n    @Test\n    @WithMockUser\n    public void shouldLoadAll() throws Exception {\n        final List<ContextualPreference> contextualPreferences = Collections.singletonList(contextualPreference);\n        Mockito.doReturn(contextualPreferences).when(mockContextualPreferenceApiService).loadAll();\n\n        final MvcResult mvcResult = performRequest(get(LOAD_ALL_URL));\n\n        Mockito.verify(mockContextualPreferenceApiService).loadAll();\n        assertResponse(mvcResult, contextualPreferences,\n                ContextualPreferenceCreatorUtils.CONTEXTUAL_PREFERENCE_LIST_TYPE);\n    }", "url": "https://github.com/epam/cloud-pipeline/pull/1470#discussion_r507513006", "createdAt": "2020-10-19T06:56:20Z", "author": {"login": "tcibinan"}, "path": "api/src/test/java/com/epam/pipeline/controller/contextual/ContextualPreferenceControllerTest.java", "diffHunk": "@@ -0,0 +1,163 @@\n+/*\n+ * Copyright 2017-2020 EPAM Systems, Inc. (https://www.epam.com/)\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package com.epam.pipeline.controller.contextual;\n+\n+import com.epam.pipeline.controller.vo.ContextualPreferenceVO;\n+import com.epam.pipeline.entity.contextual.ContextualPreference;\n+import com.epam.pipeline.entity.contextual.ContextualPreferenceExternalResource;\n+import com.epam.pipeline.entity.contextual.ContextualPreferenceLevel;\n+import com.epam.pipeline.entity.contextual.ContextualPreferenceSearchRequest;\n+import com.epam.pipeline.manager.contextual.ContextualPreferenceApiService;\n+import com.epam.pipeline.test.creator.contextual.ContextualPreferenceCreatorUtils;\n+import com.epam.pipeline.test.web.AbstractControllerTest;\n+import org.junit.Test;\n+import org.mockito.Mockito;\n+import org.springframework.beans.factory.annotation.Autowired;\n+import org.springframework.boot.test.autoconfigure.web.servlet.WebMvcTest;\n+import org.springframework.security.test.context.support.WithMockUser;\n+import org.springframework.test.web.servlet.MvcResult;\n+import org.springframework.util.LinkedMultiValueMap;\n+import org.springframework.util.MultiValueMap;\n+\n+import java.util.Collections;\n+import java.util.List;\n+\n+import static org.springframework.test.web.servlet.request.MockMvcRequestBuilders.delete;\n+import static org.springframework.test.web.servlet.request.MockMvcRequestBuilders.get;\n+import static org.springframework.test.web.servlet.request.MockMvcRequestBuilders.post;\n+import static org.springframework.test.web.servlet.request.MockMvcRequestBuilders.put;\n+\n+@WebMvcTest(controllers = ContextualPreferenceController.class)\n+public class ContextualPreferenceControllerTest extends AbstractControllerTest {\n+\n+    private static final String TEST_STRING = \"TEST\";\n+    private static final String CONTEXTUAL_URL = SERVLET_PATH + \"/contextual/preference\";\n+    private static final String LOAD_URL = CONTEXTUAL_URL + \"/load\";\n+    private static final String LOAD_ALL_URL = LOAD_URL + \"/all\";\n+    private static final ContextualPreferenceLevel PREFERENCE_LEVEL = ContextualPreferenceLevel.ROLE;\n+    private final ContextualPreference contextualPreference =\n+            ContextualPreferenceCreatorUtils.getContextualPreference();\n+    private final ContextualPreferenceExternalResource contextualPreferenceExternalResource =\n+            ContextualPreferenceCreatorUtils.getCPExternalResource();\n+\n+    @Autowired\n+    private ContextualPreferenceApiService mockContextualPreferenceApiService;\n+\n+    @Test\n+    public void shouldFailLoadAllForUnauthorizedUser() throws Exception {\n+        performUnauthorizedRequest(get(LOAD_ALL_URL));\n+    }\n+\n+    @Test\n+    @WithMockUser\n+    public void shouldLoadAll() throws Exception {\n+        final List<ContextualPreference> contextualPreferences = Collections.singletonList(contextualPreference);\n+\n+        Mockito.doReturn(contextualPreferences).when(mockContextualPreferenceApiService).loadAll();\n+\n+        final MvcResult mvcResult = performRequest(get(LOAD_ALL_URL));\n+\n+        Mockito.verify(mockContextualPreferenceApiService).loadAll();\n+\n+        assertResponse(mvcResult, contextualPreferences,\n+                ContextualPreferenceCreatorUtils.CONTEXTUAL_PREFERENCE_LIST_TYPE);\n+    }", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "8da1fc81fb34ca3b98ea1dbf9908387538313563"}, "originalPosition": 78}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 268, "cost": 1, "resetAt": "2021-11-12T13:16:51Z"}}}