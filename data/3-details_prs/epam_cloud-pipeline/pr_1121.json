{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDIwNzkxNTI2", "number": 1121, "title": "Issue 1117 systemd for centos based images", "bodyText": "Is related to #1117\nConfigure systemd to work on centos OS systems if CP_CAP_SYSTEMD_CONTAINER parameter is specified", "createdAt": "2020-05-20T14:33:13Z", "url": "https://github.com/epam/cloud-pipeline/pull/1121", "merged": true, "mergeCommit": {"oid": "a9bc273034effe5dd1120242602f07ea1e57abb6"}, "closed": true, "closedAt": "2020-05-21T11:32:22Z", "author": {"login": "SilinPavel"}, "timelineItems": {"totalCount": 6, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABci0GBggH2gAyNDIwNzkxNTI2Ojk4MDAwOTMzODc4Yjk3MGQ3NjNjNTk3ZDg4ZTdjMmIyMGYwMDdhN2Q=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcjcBBCgFqTQxNjA3MzkxMw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "98000933878b970d763c597d88e7c2b20f007a7d", "author": {"user": {"login": "SilinPavel", "name": "Pavel Silin"}}, "url": "https://github.com/epam/cloud-pipeline/commit/98000933878b970d763c597d88e7c2b20f007a7d", "committedDate": "2020-05-19T13:01:09Z", "message": "issue #1117 include cgroup mount for run if user enabled systemd integration"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "19b5a56632160b3f2033cecbe880ffffd6d39d60", "author": {"user": {"login": "SilinPavel", "name": "Pavel Silin"}}, "url": "https://github.com/epam/cloud-pipeline/commit/19b5a56632160b3f2033cecbe880ffffd6d39d60", "committedDate": "2020-05-20T11:06:53Z", "message": "issue #1117 launch systemd for centos on startup if requested"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDE1NTM0NjMz", "url": "https://github.com/epam/cloud-pipeline/pull/1121#pullrequestreview-415534633", "createdAt": "2020-05-20T16:55:18Z", "commit": {"oid": "19b5a56632160b3f2033cecbe880ffffd6d39d60"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yMFQxNjo1NToxOVrOGYVJYw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yMFQxNjo1NTo1OFrOGYVK-w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyODE2NTQ3NQ==", "bodyText": "Maybe we should extract method isParameterEnabled and use it here and for lines 163-166?", "url": "https://github.com/epam/cloud-pipeline/pull/1121#discussion_r428165475", "createdAt": "2020-05-20T16:55:19Z", "author": {"login": "mzueva"}, "path": "api/src/main/java/com/epam/pipeline/manager/execution/PipelineExecutor.java", "diffHunk": "@@ -160,14 +164,18 @@ private PodSpec getPodSpec(PipelineRun run, List<EnvVar> envVars, String secretN\n                 .stream()\n                 .anyMatch(env -> KubernetesConstants.CP_CAP_DIND_NATIVE.equals(env.getName()) &&\n                         TRUE.equals(env.getValue()));\n-        spec.setVolumes(getVolumes(isDockerInDockerEnabled));\n+        boolean isSystemdEnabled = ListUtils.emptyIfNull(envVars)", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "19b5a56632160b3f2033cecbe880ffffd6d39d60"}, "originalPosition": 16}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyODE2NTgwOA==", "bodyText": "missing final", "url": "https://github.com/epam/cloud-pipeline/pull/1121#discussion_r428165808", "createdAt": "2020-05-20T16:55:50Z", "author": {"login": "mzueva"}, "path": "api/src/main/java/com/epam/pipeline/manager/execution/PipelineExecutor.java", "diffHunk": "@@ -235,7 +243,7 @@ private ContainerResources buildCpuRequests(List<EnvVar> envVars) {\n                 .orElse(ContainerResources.empty());\n     }\n \n-    private List<Volume> getVolumes(final boolean isDockerInDockerEnabled) {\n+    private List<Volume> getVolumes(final boolean isDockerInDockerEnabled, boolean isSystemdEnabled) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "19b5a56632160b3f2033cecbe880ffffd6d39d60"}, "originalPosition": 55}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyODE2NTg4Mw==", "bodyText": "missing final", "url": "https://github.com/epam/cloud-pipeline/pull/1121#discussion_r428165883", "createdAt": "2020-05-20T16:55:58Z", "author": {"login": "mzueva"}, "path": "api/src/main/java/com/epam/pipeline/manager/execution/PipelineExecutor.java", "diffHunk": "@@ -246,10 +254,13 @@ private ContainerResources buildCpuRequests(List<EnvVar> envVars) {\n                 CollectionUtils.isNotEmpty(dockerMounts)) {\n             dockerMounts.forEach(mount -> volumes.add(createVolume(mount.getName(), mount.getHostPath())));\n         }\n+        if (isSystemdEnabled) {\n+            volumes.add(createVolume(HOST_CGROUP_MOUNT.getName(), HOST_CGROUP_MOUNT.getHostPath()));\n+        }\n         return volumes;\n     }\n \n-    private List<VolumeMount> getMounts(final boolean isDockerInDockerEnabled) {\n+    private List<VolumeMount> getMounts(final boolean isDockerInDockerEnabled, boolean isSystemdEnabled) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "19b5a56632160b3f2033cecbe880ffffd6d39d60"}, "originalPosition": 70}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "3e27cef3978e34268058aeb7a7fd8e5116317ceb", "author": {"user": {"login": "SilinPavel", "name": "Pavel Silin"}}, "url": "https://github.com/epam/cloud-pipeline/commit/3e27cef3978e34268058aeb7a7fd8e5116317ceb", "committedDate": "2020-05-20T17:34:25Z", "message": "changes according to review"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c124dc7b383161a8f6260e333043e212091fc465", "author": {"user": {"login": "SilinPavel", "name": "Pavel Silin"}}, "url": "https://github.com/epam/cloud-pipeline/commit/c124dc7b383161a8f6260e333043e212091fc465", "committedDate": "2020-05-21T11:10:30Z", "message": "add passToWorker param"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDE2MDczOTEz", "url": "https://github.com/epam/cloud-pipeline/pull/1121#pullrequestreview-416073913", "createdAt": "2020-05-21T11:31:53Z", "commit": {"oid": "c124dc7b383161a8f6260e333043e212091fc465"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3837, "cost": 1, "resetAt": "2021-11-01T14:20:25Z"}}}