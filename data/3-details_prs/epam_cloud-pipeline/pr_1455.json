{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDk2MjYzMTU5", "number": 1455, "title": "Issue #1445 system dictionaries links", "bodyText": "This PR is related to issue #1445\nIt allows linking values from different system dictionaries.", "createdAt": "2020-10-01T13:32:19Z", "url": "https://github.com/epam/cloud-pipeline/pull/1455", "merged": true, "mergeCommit": {"oid": "56e0a5c46e4ae8feb6238e5c473c72b4a9ad90ad"}, "closed": true, "closedAt": "2020-10-05T16:27:16Z", "author": {"login": "Wedds"}, "timelineItems": {"totalCount": 11, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdOPd88AH2gAyNDk2MjYzMTU5OmMwNjIyZWI4YTdjZjYwYmEzY2ZjOGZiZDA1MTQyNmZkYjM5YjFmNTQ=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdPjn2NAH2gAyNDk2MjYzMTU5OmJhNTRlNDdkNzAxN2Q4NDAwNWNjZjUyZmEwNTcwODQ0YzI5NWQ3MjA=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "c0622eb8a7cf60ba3cfc8fbd051426fdb39b1f54", "author": {"user": {"login": "Wedds", "name": "Andrey Georgitsa"}}, "url": "https://github.com/epam/cloud-pipeline/commit/c0622eb8a7cf60ba3cfc8fbd051426fdb39b1f54", "committedDate": "2020-10-01T11:13:28Z", "message": "Issue #1445 Change CategoricalAttribute structure: allow storing links for values"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "fdb6605a37f73f4a5e4e505cc5427be85e8b2c2e", "author": {"user": {"login": "Wedds", "name": "Andrey Georgitsa"}}, "url": "https://github.com/epam/cloud-pipeline/commit/fdb6605a37f73f4a5e4e505cc5427be85e8b2c2e", "committedDate": "2020-10-01T11:57:10Z", "message": "Issue #1445 Merge links for one-to-many relation"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "7ac6770b8f1cdd15c30282c7ebbd9afd47c7d1e9", "author": {"user": {"login": "Wedds", "name": "Andrey Georgitsa"}}, "url": "https://github.com/epam/cloud-pipeline/commit/7ac6770b8f1cdd15c30282c7ebbd9afd47c7d1e9", "committedDate": "2020-10-01T12:17:35Z", "message": "Issue #1445 Do not consider id in CategoricalAttributeValue comparison"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e6ddd169657c1bcaf2137b6be3e746dc82e4010e", "author": {"user": {"login": "Wedds", "name": "Andrey Georgitsa"}}, "url": "https://github.com/epam/cloud-pipeline/commit/e6ddd169657c1bcaf2137b6be3e746dc82e4010e", "committedDate": "2020-10-01T15:15:56Z", "message": "Issue #1445 Fix CategoricalAttributeValue structure"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "0b690c0a595cca3c6fd3a3557cced047b179a18b", "author": {"user": {"login": "Wedds", "name": "Andrey Georgitsa"}}, "url": "https://github.com/epam/cloud-pipeline/commit/0b690c0a595cca3c6fd3a3557cced047b179a18b", "committedDate": "2020-10-01T15:21:56Z", "message": "Issue #1445 Fix links binding during insert operation"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "265c8a3abc069c52c05d624025bb5985bd6dda2e", "author": {"user": {"login": "Wedds", "name": "Andrey Georgitsa"}}, "url": "https://github.com/epam/cloud-pipeline/commit/265c8a3abc069c52c05d624025bb5985bd6dda2e", "committedDate": "2020-10-01T16:28:48Z", "message": "Issue #1445 Implement basic testing for linking"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "94b100217f8801b26560d798c9d622d4eafd5013", "author": {"user": {"login": "Wedds", "name": "Andrey Georgitsa"}}, "url": "https://github.com/epam/cloud-pipeline/commit/94b100217f8801b26560d798c9d622d4eafd5013", "committedDate": "2020-10-02T10:25:01Z", "message": "Issue #1445 Additional checks of categorical attribute structure during insert operation"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "45a46b7895c8ddcf93ed5a009b1faa1ca8c11702", "author": {"user": {"login": "Wedds", "name": "Andrey Georgitsa"}}, "url": "https://github.com/epam/cloud-pipeline/commit/45a46b7895c8ddcf93ed5a009b1faa1ca8c11702", "committedDate": "2020-10-02T10:21:54Z", "message": "Issue #1445 Ignore `id` property of CategoricalAttributeValue in JSONs"}, "afterCommit": {"oid": "94b100217f8801b26560d798c9d622d4eafd5013", "author": {"user": {"login": "Wedds", "name": "Andrey Georgitsa"}}, "url": "https://github.com/epam/cloud-pipeline/commit/94b100217f8801b26560d798c9d622d4eafd5013", "committedDate": "2020-10-02T10:25:01Z", "message": "Issue #1445 Additional checks of categorical attribute structure during insert operation"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f63cf4e8735650c78b9326ee4515653948a8300b", "author": {"user": {"login": "Wedds", "name": "Andrey Georgitsa"}}, "url": "https://github.com/epam/cloud-pipeline/commit/f63cf4e8735650c78b9326ee4515653948a8300b", "committedDate": "2020-10-05T09:13:02Z", "message": "Issue #1445 Assign `key` value to CategoricalAttributeValue from dictionary during insert"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTAyMDEyMDEx", "url": "https://github.com/epam/cloud-pipeline/pull/1455#pullrequestreview-502012011", "createdAt": "2020-10-05T12:39:11Z", "commit": {"oid": "f63cf4e8735650c78b9326ee4515653948a8300b"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wNVQxMjozOToxMVrOHcbIQg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wNVQxMjo0MjowMFrOHcbOvw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5OTU2NjY1OA==", "bodyText": "I think we can omit OUTER in requests, since LEFT JOIN is always LEFT OUTER JOIN", "url": "https://github.com/epam/cloud-pipeline/pull/1455#discussion_r499566658", "createdAt": "2020-10-05T12:39:11Z", "author": {"login": "mzueva"}, "path": "api/src/main/resources/dao/categorical-attribute-dao.xml", "diffHunk": "@@ -32,17 +32,45 @@\n                 ]]>\n             </value>\n         </property>\n+        <property name=\"loadAllAttributesValuesWithoutLinksQuery\">\n+            <value>\n+                <![CDATA[\n+                    SELECT key, value, id FROM pipeline.categorical_attributes\n+                ]]>\n+            </value>\n+        </property>\n         <property name=\"loadAllAttributesValuesQuery\">\n             <value>\n                 <![CDATA[\n-                    SELECT key, value FROM pipeline.categorical_attributes\n+                    SELECT\n+                        attributes.key,\n+                        attributes.value,\n+                        attributes.id,\n+                        links.child_id,\n+                        links.autofill,\n+                        links_values.key child_key,\n+                        links_values.value as child_value\n+                    FROM pipeline.categorical_attributes attributes\n+                    LEFT OUTER JOIN pipeline.categorical_attributes_links links on attributes.id=links.parent_id", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f63cf4e8735650c78b9326ee4515653948a8300b"}, "originalPosition": 24}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5OTU2Njg0MQ==", "bodyText": "Move migration to current date", "url": "https://github.com/epam/cloud-pipeline/pull/1455#discussion_r499566841", "createdAt": "2020-10-05T12:39:31Z", "author": {"login": "mzueva"}, "path": "api/src/main/resources/db/migration/v2020.09.30_13.00__issue_1445_dictionaries_links.sql", "diffHunk": "@@ -0,0 +1,9 @@\n+CREATE SEQUENCE IF NOT EXISTS pipeline.S_CATEGORICAL_ATTRIBUTES START WITH 1 INCREMENT BY 1;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f63cf4e8735650c78b9326ee4515653948a8300b"}, "originalPosition": 1}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5OTU2ODMxOQ==", "bodyText": "Could you please remove this on lines 82 & 83 (method updateCategoricalAttributes )", "url": "https://github.com/epam/cloud-pipeline/pull/1455#discussion_r499568319", "createdAt": "2020-10-05T12:42:00Z", "author": {"login": "mzueva"}, "path": "api/src/main/java/com/epam/pipeline/dao/metadata/CategoricalAttributeDao.java", "diffHunk": "@@ -72,29 +86,60 @@ public boolean updateCategoricalAttributes(final List<CategoricalAttribute> dict\n     @Transactional(propagation = Propagation.MANDATORY)\n     public boolean insertAttributesValues(final List<CategoricalAttribute> dict) {\n         final MapSqlParameterSource[] values = dict.stream()\n-            .flatMap(entry -> entry.getValues()", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f63cf4e8735650c78b9326ee4515653948a8300b"}, "originalPosition": 61}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ba54e47d7017d84005ccf52fa0570844c295d720", "author": {"user": {"login": "Wedds", "name": "Andrey Georgitsa"}}, "url": "https://github.com/epam/cloud-pipeline/commit/ba54e47d7017d84005ccf52fa0570844c295d720", "committedDate": "2020-10-05T13:16:18Z", "message": "Issue #1445 PR review comments refactoring"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3648, "cost": 1, "resetAt": "2021-11-01T14:20:25Z"}}}