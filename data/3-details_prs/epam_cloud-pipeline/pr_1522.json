{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTExNTkwODI4", "number": 1522, "title": "Jobs, that were stopped by a \"Timeout\", shall move the interim data into the \"output\" storage", "bodyText": "This PR provides implementation for issue #1520\nThe current PR contains the following changes:\n\na new system parameter CP_EXEC_TIMEOUT was introduced\nif both Timeout field and CP_EXEC_TIMEOUT system parameter were specified the CP_EXEC_TIMEOUT will be used\nif timeout was specified the launch.sh script will continue its flow after the timeout elapsed", "createdAt": "2020-10-28T14:28:25Z", "url": "https://github.com/epam/cloud-pipeline/pull/1522", "merged": true, "mergeCommit": {"oid": "ce60d254de33e09d44f0f6cb2fe16f7571877af9"}, "closed": true, "closedAt": "2020-10-28T19:06:01Z", "author": {"login": "ekazachkova"}, "timelineItems": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdW-Ax0AH2gAyNTExNTkwODI4OjU5MTBhNjcxZDRkZTM0YWIwNzU0Mzg4NmEzYWM5MDdiZTRjODdjZjE=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdXCaJoAFqTUxODk5NzM2Nw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "5910a671d4de34ab07543886a3ac907be4c87cf1", "author": {"user": {"login": "ekazachkova", "name": "Ekaterina Kazachkova"}}, "url": "https://github.com/epam/cloud-pipeline/commit/5910a671d4de34ab07543886a3ac907be4c87cf1", "committedDate": "2020-10-28T13:58:32Z", "message": "Issue #1520: Jobs, that were stopped by a \"Timeout\", shall move the interim data into the \"output\" storage"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTE4NzQzMTMw", "url": "https://github.com/epam/cloud-pipeline/pull/1522#pullrequestreview-518743130", "createdAt": "2020-10-28T14:45:29Z", "commit": {"oid": "5910a671d4de34ab07543886a3ac907be4c87cf1"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yOFQxNDo0NToyOVrOHptvPA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yOFQxNDo0Nzo0MlrOHpt2gg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMzUwMzAzNg==", "bodyText": "Could you also add CP_EXEC_TIMEOUT to deploy/contents/install/preferences/launch.system.parameters.json?", "url": "https://github.com/epam/cloud-pipeline/pull/1522#discussion_r513503036", "createdAt": "2020-10-28T14:45:29Z", "author": {"login": "mzueva"}, "path": "api/src/main/java/com/epam/pipeline/manager/execution/SystemParams.java", "diffHunk": "@@ -69,7 +69,8 @@\n     CONTAINER_CPU_RESOURCE(\"container-cpu-resource\", \"CP_CONTAINER_CPU_RESOURCE\", false, true),\n     CONTAINER_MEMORY_RESOURCE_POLICY(\"container-memory-resource-policy\",\n             \"CP_CONTAINER_MEMORY_RESOURCE_POLICY\", false, true),\n-    CP_SENSITIVE_RUN(\"cp-sensitive-run\", \"CP_SENSITIVE_RUN\", false, false);\n+    CP_SENSITIVE_RUN(\"cp-sensitive-run\", \"CP_SENSITIVE_RUN\", false, false),\n+    CP_EXEC_TIMEOUT(\"cp-exec-timeout\", \"CP_EXEC_TIMEOUT\");", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "5910a671d4de34ab07543886a3ac907be4c87cf1"}, "originalPosition": 13}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMzUwNDg5OA==", "bodyText": "I think that we need to check whether timeout was actually exceeded (possibly using exit code). Also keep in memory that we need to save CP_EXEC_RESULT to exit process with correct exit code.", "url": "https://github.com/epam/cloud-pipeline/pull/1522#discussion_r513504898", "createdAt": "2020-10-28T14:47:42Z", "author": {"login": "mzueva"}, "path": "scripts/pipeline-launch/launch.sh", "diffHunk": "@@ -1678,7 +1678,15 @@ pipe_log SUCCESS \"Environment initialization finished\" \"InitializeEnvironment\"\n \n echo \"Command text:\"\n echo \"${SCRIPT}\"\n-bash -c \"${SCRIPT}\"\n+\n+if [ ! -z \"${CP_EXEC_TIMEOUT}\" ] && [ \"${CP_EXEC_TIMEOUT}\" -gt 0 ];\n+then\n+  timeout ${CP_EXEC_TIMEOUT}m bash -c \"${SCRIPT}\"\n+  echo \"Timeout was elapsed\"", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "5910a671d4de34ab07543886a3ac907be4c87cf1"}, "originalPosition": 9}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "bbd18d497faa0a64b571afa478569e145d649e66", "author": {"user": {"login": "ekazachkova", "name": "Ekaterina Kazachkova"}}, "url": "https://github.com/epam/cloud-pipeline/commit/bbd18d497faa0a64b571afa478569e145d649e66", "committedDate": "2020-10-28T15:20:26Z", "message": "Issue #1520: Jobs, that were stopped by a \"Timeout\", shall move the interim data into the \"output\" storage"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTE4OTk3MzY3", "url": "https://github.com/epam/cloud-pipeline/pull/1522#pullrequestreview-518997367", "createdAt": "2020-10-28T19:05:52Z", "commit": {"oid": "bbd18d497faa0a64b571afa478569e145d649e66"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3686, "cost": 1, "resetAt": "2021-11-01T14:20:25Z"}}}