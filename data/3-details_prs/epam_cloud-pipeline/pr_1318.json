{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDcyNjgxOTEw", "number": 1318, "title": "Issue #1258 Users and regions listing for billing manager", "bodyText": "This PR is related to issue #1258\nPreviously ROLE_BILLING_MANAGER was introduced - such users should have full access to billing data. To perform all the operations on billing reports correctly, they must be able to load all the users and regions. Instead of authorizing this role to existing  CloudRegionController.loadAll and UserController.loadUsers methods, separated endpoints were created. It allows hiding sensitive fields, but BILLING_MANAGER will be able to proceed billing reports.", "createdAt": "2020-08-24T18:10:21Z", "url": "https://github.com/epam/cloud-pipeline/pull/1318", "merged": true, "mergeCommit": {"oid": "957a8a793df5669009a764e1a5df911967a59df6"}, "closed": true, "closedAt": "2020-08-26T10:13:56Z", "author": {"login": "Wedds"}, "timelineItems": {"totalCount": 13, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdCF3KuAH2gAyNDcyNjgxOTEwOjdhNjRiZDhkY2UxZmE2OTUyMTkzZTYwNzdlYTNmYTY1MWZhZjhjZDE=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdCpCZ0gFqTQ3NTM0Nzg2NA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "7a64bd8dce1fa6952193e6077ea3fa651faf8cd1", "author": {"user": {"login": "Wedds", "name": "Andrey Georgitsa"}}, "url": "https://github.com/epam/cloud-pipeline/commit/7a64bd8dce1fa6952193e6077ea3fa651faf8cd1", "committedDate": "2020-08-24T17:14:52Z", "message": "Issue #1258 Create endpoint to load all cloud regions for billing purposes"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "7ac572d494cd3d5ea3c891f47f6039e97192f4a3", "author": {"user": {"login": "Wedds", "name": "Andrey Georgitsa"}}, "url": "https://github.com/epam/cloud-pipeline/commit/7ac572d494cd3d5ea3c891f47f6039e97192f4a3", "committedDate": "2020-08-24T18:12:37Z", "message": "Issue #1258 Create endpoint to load all users for billing purposes"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "7764530558f88facdfa615f87c466f27504000c6", "author": {"user": {"login": "Wedds", "name": "Andrey Georgitsa"}}, "url": "https://github.com/epam/cloud-pipeline/commit/7764530558f88facdfa615f87c466f27504000c6", "committedDate": "2020-08-24T17:15:18Z", "message": "Issue #1258 Create endpoint to load all users for billing purposes"}, "afterCommit": {"oid": "7ac572d494cd3d5ea3c891f47f6039e97192f4a3", "author": {"user": {"login": "Wedds", "name": "Andrey Georgitsa"}}, "url": "https://github.com/epam/cloud-pipeline/commit/7ac572d494cd3d5ea3c891f47f6039e97192f4a3", "committedDate": "2020-08-24T18:12:37Z", "message": "Issue #1258 Create endpoint to load all users for billing purposes"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "3620c553b9fd92225b6c9c50cf6e0a7ae1481793", "author": {"user": {"login": "Wedds", "name": "Andrey Georgitsa"}}, "url": "https://github.com/epam/cloud-pipeline/commit/3620c553b9fd92225b6c9c50cf6e0a7ae1481793", "committedDate": "2020-08-25T09:21:30Z", "message": "Issue #1258 Use an object with the corresponding to `AbstractCloudRegion` type/name fields to hide sensitive information instead of object modifications via reflection, revert reflection changes"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDc0NTQxOTUx", "url": "https://github.com/epam/cloud-pipeline/pull/1318#pullrequestreview-474541951", "createdAt": "2020-08-25T14:31:40Z", "commit": {"oid": "3620c553b9fd92225b6c9c50cf6e0a7ae1481793"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDc0NTQyNTIw", "url": "https://github.com/epam/cloud-pipeline/pull/1318#pullrequestreview-474542520", "createdAt": "2020-08-25T14:32:14Z", "commit": {"oid": "3620c553b9fd92225b6c9c50cf6e0a7ae1481793"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 6, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yNVQxNDozMjoxNVrOHGbA3Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yNVQxNDozNToyNlrOHGbKhA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NjQ5NjA5Mw==", "bodyText": "Let's rename endpoint /billing -> /info", "url": "https://github.com/epam/cloud-pipeline/pull/1318#discussion_r476496093", "createdAt": "2020-08-25T14:32:15Z", "author": {"login": "mzueva"}, "path": "api/src/main/java/com/epam/pipeline/controller/region/CloudRegionController.java", "diffHunk": "@@ -75,6 +76,19 @@\n         return Result.success(cloudRegionApiService.loadAll());\n     }\n \n+    @GetMapping(\"/billing\")", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "3620c553b9fd92225b6c9c50cf6e0a7ae1481793"}, "originalPosition": 12}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NjQ5NjM1OQ==", "bodyText": "Let's rename /users/billing -> /users/info", "url": "https://github.com/epam/cloud-pipeline/pull/1318#discussion_r476496359", "createdAt": "2020-08-25T14:32:37Z", "author": {"login": "mzueva"}, "path": "api/src/main/java/com/epam/pipeline/controller/user/UserController.java", "diffHunk": "@@ -218,6 +218,20 @@ public Result deleteUser(@PathVariable Long id) {\n         return Result.success(userApiService.loadUsers());\n     }\n \n+    @RequestMapping(value = \"/users/billing\", method = RequestMethod.GET)", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "3620c553b9fd92225b6c9c50cf6e0a7ae1481793"}, "originalPosition": 4}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NjQ5NjY2OQ==", "bodyText": "@RequestMapping -> @GetMapping", "url": "https://github.com/epam/cloud-pipeline/pull/1318#discussion_r476496669", "createdAt": "2020-08-25T14:33:01Z", "author": {"login": "mzueva"}, "path": "api/src/main/java/com/epam/pipeline/controller/user/UserController.java", "diffHunk": "@@ -218,6 +218,20 @@ public Result deleteUser(@PathVariable Long id) {\n         return Result.success(userApiService.loadUsers());\n     }\n \n+    @RequestMapping(value = \"/users/billing\", method = RequestMethod.GET)", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "3620c553b9fd92225b6c9c50cf6e0a7ae1481793"}, "originalPosition": 4}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NjQ5Nzk5NA==", "bodyText": "Let's rename RegionForBilling -> CloudRegionInfo", "url": "https://github.com/epam/cloud-pipeline/pull/1318#discussion_r476497994", "createdAt": "2020-08-25T14:34:42Z", "author": {"login": "mzueva"}, "path": "api/src/main/java/com/epam/pipeline/entity/billing/RegionForBilling.java", "diffHunk": "@@ -0,0 +1,31 @@\n+/*\n+ * Copyright 2017-2020 EPAM Systems, Inc. (https://www.epam.com/)\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package com.epam.pipeline.entity.billing;\n+\n+import com.epam.pipeline.entity.region.CloudProvider;\n+import lombok.Builder;\n+import lombok.Value;\n+\n+@Value\n+@Builder\n+public class RegionForBilling {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "3620c553b9fd92225b6c9c50cf6e0a7ae1481793"}, "originalPosition": 25}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NjQ5ODIxMQ==", "bodyText": "access for ROLE_USER", "url": "https://github.com/epam/cloud-pipeline/pull/1318#discussion_r476498211", "createdAt": "2020-08-25T14:34:57Z", "author": {"login": "mzueva"}, "path": "api/src/main/java/com/epam/pipeline/manager/region/CloudRegionApiService.java", "diffHunk": "@@ -39,6 +40,11 @@\n         return cloudRegionManager.loadAll();\n     }\n \n+    @PreAuthorize(AclExpressions.FULL_BILLING_ACCESS)", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "3620c553b9fd92225b6c9c50cf6e0a7ae1481793"}, "originalPosition": 19}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NjQ5ODU2NA==", "bodyText": "access for ROLE_USER", "url": "https://github.com/epam/cloud-pipeline/pull/1318#discussion_r476498564", "createdAt": "2020-08-25T14:35:26Z", "author": {"login": "mzueva"}, "path": "api/src/main/java/com/epam/pipeline/manager/user/UserApiService.java", "diffHunk": "@@ -110,6 +111,11 @@ public PipelineUser updateUserRoles(Long id, List<Long> roles) {\n         return new ArrayList<>(userManager.loadAllUsers());\n     }\n \n+    @PreAuthorize(FULL_BILLING_ACCESS)", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "3620c553b9fd92225b6c9c50cf6e0a7ae1481793"}, "originalPosition": 12}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "9aa78108fef09a727487ab9601feb2ba782fe9c8", "author": {"user": {"login": "Wedds", "name": "Andrey Georgitsa"}}, "url": "https://github.com/epam/cloud-pipeline/commit/9aa78108fef09a727487ab9601feb2ba782fe9c8", "committedDate": "2020-08-25T15:02:06Z", "message": "Issue #1258 Generalize CloudRegion-related method"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "820ab5cff3ffdebbf4610ff8411c940b120c30a6", "author": {"user": {"login": "Wedds", "name": "Andrey Georgitsa"}}, "url": "https://github.com/epam/cloud-pipeline/commit/820ab5cff3ffdebbf4610ff8411c940b120c30a6", "committedDate": "2020-08-25T15:10:21Z", "message": "Issue #1258 Generalize User-related method"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "497e6e1de472a0b8f9509585cd7f781df07d955b", "author": {"user": {"login": "Wedds", "name": "Andrey Georgitsa"}}, "url": "https://github.com/epam/cloud-pipeline/commit/497e6e1de472a0b8f9509585cd7f781df07d955b", "committedDate": "2020-08-25T16:12:38Z", "message": "Issue #1258 Info objects refactoring"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "ce0e4f50c0760c7282603f2416fffb20f7c6c41f", "author": {"user": {"login": "Wedds", "name": "Andrey Georgitsa"}}, "url": "https://github.com/epam/cloud-pipeline/commit/ce0e4f50c0760c7282603f2416fffb20f7c6c41f", "committedDate": "2020-08-25T15:58:23Z", "message": "Issue #1258 Info objects refactoring"}, "afterCommit": {"oid": "497e6e1de472a0b8f9509585cd7f781df07d955b", "author": {"user": {"login": "Wedds", "name": "Andrey Georgitsa"}}, "url": "https://github.com/epam/cloud-pipeline/commit/497e6e1de472a0b8f9509585cd7f781df07d955b", "committedDate": "2020-08-25T16:12:38Z", "message": "Issue #1258 Info objects refactoring"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDc1Mjk1Nzc1", "url": "https://github.com/epam/cloud-pipeline/pull/1318#pullrequestreview-475295775", "createdAt": "2020-08-26T09:05:29Z", "commit": {"oid": "497e6e1de472a0b8f9509585cd7f781df07d955b"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yNlQwOTowNToyOVrOHHC5bw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yNlQwOTowNTo0OVrOHHC6JA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NzE0OTU1MQ==", "bodyText": "We still need @PreAuthorize annotation here hasRole('ADMIN') OR hasRole('ROLE_USER')", "url": "https://github.com/epam/cloud-pipeline/pull/1318#discussion_r477149551", "createdAt": "2020-08-26T09:05:29Z", "author": {"login": "mzueva"}, "path": "api/src/main/java/com/epam/pipeline/manager/region/CloudRegionApiService.java", "diffHunk": "@@ -39,6 +40,10 @@\n         return cloudRegionManager.loadAll();\n     }\n \n+    public List<CloudRegionInfo> loadAllRegionsInfo() {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "497e6e1de472a0b8f9509585cd7f781df07d955b"}, "originalPosition": 19}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NzE0OTczMg==", "bodyText": "We still need @PreAuthorize annotation here hasRole('ADMIN') OR hasRole('ROLE_USER')", "url": "https://github.com/epam/cloud-pipeline/pull/1318#discussion_r477149732", "createdAt": "2020-08-26T09:05:49Z", "author": {"login": "mzueva"}, "path": "api/src/main/java/com/epam/pipeline/manager/user/UserApiService.java", "diffHunk": "@@ -110,6 +111,10 @@ public PipelineUser updateUserRoles(Long id, List<Long> roles) {\n         return new ArrayList<>(userManager.loadAllUsers());\n     }\n \n+    public List<UserInfo> loadUsersInfo() {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "497e6e1de472a0b8f9509585cd7f781df07d955b"}, "originalPosition": 12}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d49ab71a8d1f926b8a5ebcd69c19bb1f8b74eccb", "author": {"user": {"login": "Wedds", "name": "Andrey Georgitsa"}}, "url": "https://github.com/epam/cloud-pipeline/commit/d49ab71a8d1f926b8a5ebcd69c19bb1f8b74eccb", "committedDate": "2020-08-26T09:34:48Z", "message": "Issue #1258 Perform authorization on region and user info methods"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDc1MzQ3ODY0", "url": "https://github.com/epam/cloud-pipeline/pull/1318#pullrequestreview-475347864", "createdAt": "2020-08-26T10:13:49Z", "commit": {"oid": "d49ab71a8d1f926b8a5ebcd69c19bb1f8b74eccb"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3748, "cost": 1, "resetAt": "2021-11-01T14:20:25Z"}}}