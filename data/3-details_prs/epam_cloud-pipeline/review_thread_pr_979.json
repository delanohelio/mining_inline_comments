{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0Mzc4Mjc2NDE2", "number": 979, "reviewThreads": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yMVQxNDoxMDo0NlrODh49yQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yMVQxNDoyMDozNlrODh5J3g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjM2ODYyOTIxOnYy", "diffSide": "RIGHT", "path": "pipe-cli/pipe.py", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yMVQxNDoxMDo0NlrOFs4FaA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yMVQxNDoxMDo0NlrOFs4FaA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MjYwMDU1Mg==", "bodyText": "It seems that method name is misleading", "url": "https://github.com/epam/cloud-pipeline/pull/979#discussion_r382600552", "createdAt": "2020-02-21T14:10:46Z", "author": {"login": "mzueva"}, "path": "pipe-cli/pipe.py", "diffHunk": "@@ -901,6 +902,16 @@ def storage_copy_item(source, destination, recursive, force, exclude, include, q\n                              exclude, include, quiet, tags, file_list, symlinks, skip_existing=skip_existing)\n \n \n+@storage.command('du')\n+@click.argument('path', required=False)\n+@click.option('-f', '--format', help='Format for size [G/M/K]',\n+              type=click.Choice(DuFormatType.possible_types()), required=False, default='M')\n+@click.option('-d', '--depth', help='Depth level', type=int, required=False)\n+@Config.validate_access_token(quiet_flag_property_name='quiet')\n+def storage_copy_item(path, format, depth):", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "9c9506c6903503a7196870df8ad6830da33f26fa"}, "originalPosition": 18}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjM2ODY1NTU3OnYy", "diffSide": "RIGHT", "path": "pipe-cli/src/utilities/storage/s3.py", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yMVQxNDoxODo1OVrOFs4V1Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yMVQxNDoxODo1OVrOFs4V1Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MjYwNDc1Nw==", "bodyText": "Could we extract this logic into a separate method to make it more readable?", "url": "https://github.com/epam/cloud-pipeline/pull/979#discussion_r382604757", "createdAt": "2020-02-21T14:18:59Z", "author": {"login": "mzueva"}, "path": "pipe-cli/src/utilities/storage/s3.py", "diffHunk": "@@ -411,6 +414,83 @@ def list_items(self, relative_path=None, recursive=False, page_size=StorageOpera\n         else:\n             return self.list_objects(client, prefix, operation_parameters, recursive)\n \n+    def get_summary_with_depth(self, max_depth, relative_path=None):\n+        bucket_name = self.bucket.bucket.path\n+        delimiter = S3BucketOperations.S3_PATH_SEPARATOR\n+        client = self.session.client('s3', config=S3BucketOperations.get_proxy_config())\n+        operation_parameters = {\n+            'Bucket': bucket_name\n+        }\n+        prefix = S3BucketOperations.get_prefix(delimiter, relative_path)\n+        if relative_path:\n+            operation_parameters['Prefix'] = prefix\n+            max_depth += len(prefix.split(delimiter))\n+\n+        paginator = client.get_paginator('list_objects_v2')\n+        page_iterator = paginator.paginate(**operation_parameters)\n+        result = Tree()\n+        relative_path_len = 0\n+        range_start = 1\n+        if relative_path:\n+            root_path = delimiter.join([bucket_name, relative_path])\n+            root = result.create_node(root_path, root_path, data=StorageItem())\n+            relative_path_len = len(relative_path.split(delimiter))\n+            range_start = relative_path_len + 1\n+        else:\n+            root = result.create_node(bucket_name, bucket_name, data=StorageItem())\n+\n+        for page in page_iterator:\n+            if 'Contents' in page:\n+                for file in page['Contents']:\n+                    name = self.get_file_name(file, prefix, True)\n+                    size = file['Size']\n+\n+                    tokens = name.split(delimiter)\n+                    root.data.add_item(size)\n+\n+                    if len(tokens) - relative_path_len > 1:\n+                        if relative_path:", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "9c9506c6903503a7196870df8ad6830da33f26fa"}, "originalPosition": 55}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjM2ODY2MDE0OnYy", "diffSide": "RIGHT", "path": "api/src/main/java/com/epam/pipeline/manager/security/GrantPermissionManager.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yMVQxNDoyMDozNlrOFs4Y4Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yNlQxOTozNzoxN1rOFu5WiA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MjYwNTUzNw==", "bodyText": "missing final", "url": "https://github.com/epam/cloud-pipeline/pull/979#discussion_r382605537", "createdAt": "2020-02-21T14:20:36Z", "author": {"login": "mzueva"}, "path": "api/src/main/java/com/epam/pipeline/manager/security/GrantPermissionManager.java", "diffHunk": "@@ -412,6 +412,15 @@ public boolean storagePermission(Long storageId, String permissionName) {\n         }\n     }\n \n+    public boolean storagePermissionByName(final String identifier, final String permissionName) {\n+        AbstractSecuredEntity storage = entityManager.loadByNameOrId(AclClass.DATA_STORAGE, identifier);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "9c9506c6903503a7196870df8ad6830da33f26fa"}, "originalPosition": 5}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NDcxODQ3Mg==", "bodyText": "still missing final", "url": "https://github.com/epam/cloud-pipeline/pull/979#discussion_r384718472", "createdAt": "2020-02-26T19:37:17Z", "author": {"login": "mzueva"}, "path": "api/src/main/java/com/epam/pipeline/manager/security/GrantPermissionManager.java", "diffHunk": "@@ -412,6 +412,15 @@ public boolean storagePermission(Long storageId, String permissionName) {\n         }\n     }\n \n+    public boolean storagePermissionByName(final String identifier, final String permissionName) {\n+        AbstractSecuredEntity storage = entityManager.loadByNameOrId(AclClass.DATA_STORAGE, identifier);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MjYwNTUzNw=="}, "originalCommit": {"oid": "9c9506c6903503a7196870df8ad6830da33f26fa"}, "originalPosition": 5}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 475, "cost": 1, "resetAt": "2021-11-12T13:16:51Z"}}}