{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDIzMzgwNzI2", "number": 5162, "title": "GEODE-6070: Fix ShutdownCommandOverHttpDUnitTest flakiness", "bodyText": "Use IgnoredException for DistributedSystemDisconnectedException.", "createdAt": "2020-05-26T18:33:01Z", "url": "https://github.com/apache/geode/pull/5162", "merged": true, "mergeCommit": {"oid": "57cc3c7b40816bc1b7bbae80481dea608c7caff5"}, "closed": true, "closedAt": "2020-05-29T16:41:11Z", "author": {"login": "kirklund"}, "timelineItems": {"totalCount": 6, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABclI8ltAH2gAyNDIzMzgwNzI2OjAyOGMxZTgwNjA5MmY1YWQyZjc0NzllNjkyNWUyNjI3ZTgzZjEwNDA=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcmFA26AFqTQyMTEwNDMxNg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "028c1e806092f5ad2f7479e6925e2627e83f1040", "author": {"user": {"login": "kirklund", "name": "Kirk Lund"}}, "url": "https://github.com/apache/geode/commit/028c1e806092f5ad2f7479e6925e2627e83f1040", "committedDate": "2020-05-26T18:26:42Z", "message": "GEODE-6070: Fix ShutdownCommandOverHttpDUnitTest flakiness\n\nUse IgnoredException for DistributedSystemDisconnectedException."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDIwMjc2Mjgw", "url": "https://github.com/apache/geode/pull/5162#pullrequestreview-420276280", "createdAt": "2020-05-28T16:14:46Z", "commit": {"oid": "028c1e806092f5ad2f7479e6925e2627e83f1040"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDIwMjg1ODYy", "url": "https://github.com/apache/geode/pull/5162#pullrequestreview-420285862", "createdAt": "2020-05-28T16:26:01Z", "commit": {"oid": "028c1e806092f5ad2f7479e6925e2627e83f1040"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDIwMzI3NTUw", "url": "https://github.com/apache/geode/pull/5162#pullrequestreview-420327550", "createdAt": "2020-05-28T17:16:31Z", "commit": {"oid": "028c1e806092f5ad2f7479e6925e2627e83f1040"}, "state": "APPROVED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yOFQxNzoxNjozMVrOGb_Akw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yOFQxNzoxNjozMVrOGb_Akw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMTk5NzA3NQ==", "bodyText": "Is it preferable to use withFailMessage than as for this case?", "url": "https://github.com/apache/geode/pull/5162#discussion_r431997075", "createdAt": "2020-05-28T17:16:31Z", "author": {"login": "jchen21"}, "path": "geode-web/src/distributedTest/java/org/apache/geode/management/internal/cli/commands/ShutdownCommandOverHttpDUnitTest.java", "diffHunk": "@@ -96,48 +93,61 @@ public void setup() throws Exception {\n \n     locatorString = \"localhost[\" + locatorPort + \"]\";\n \n-    locator.invoke(\n-        () -> startLocator(locatorDir, locatorPort, locatorJmxPort, locatorHttpPort));\n+    locator.invoke(() -> startLocator(locatorDir, locatorPort, locatorJmxPort, locatorHttpPort));\n     server1.invoke(() -> startServer(SERVER1_NAME, server1Dir, locatorString));\n     server2.invoke(() -> startServer(SERVER2_NAME, server2Dir, locatorString));\n \n     gfsh.connectAndVerify(locatorHttpPort, PortType.http);\n+\n+    addIgnoredException(DistributedSystemDisconnectedException.class);\n   }\n \n   @Test\n   public void testShutdownServers() {\n     String command = \"shutdown\";\n \n-    gfsh.executeAndAssertThat(command).statusIsSuccess().containsOutput(\"Shutdown is triggered\");\n+    gfsh.executeAndAssertThat(command)\n+        .statusIsSuccess()\n+        .containsOutput(\"Shutdown is triggered\");\n \n     for (VM vm : toArray(server1, server2)) {\n       vm.invoke(() -> verifyNotConnected(SERVER_LAUNCHER.get().getCache()));\n     }\n \n-    gfsh.executeAndAssertThat(\"list members\").statusIsSuccess();\n+    gfsh.executeAndAssertThat(\"list members\")\n+        .statusIsSuccess();\n+\n     assertThat(gfsh.getGfshOutput()).contains(\"locator\");\n   }\n \n   @Test\n   public void testShutdownAll() {\n     String command = \"shutdown --include-locators=true\";\n \n-    gfsh.executeAndAssertThat(command).statusIsSuccess().containsOutput(\"Shutdown is triggered\");\n+    gfsh.executeAndAssertThat(command)\n+        .statusIsSuccess()\n+        .containsOutput(\"Shutdown is triggered\");\n+\n     server1.invoke(() -> verifyNotConnected(SERVER_LAUNCHER.get().getCache()));\n     server2.invoke(() -> verifyNotConnected(SERVER_LAUNCHER.get().getCache()));\n     locator.invoke(() -> verifyNotConnected(LOCATOR_LAUNCHER.get().getCache()));\n   }\n \n   private void verifyNotConnected(Cache cache) {\n-    await().untilAsserted(() -> assertThat(cache.getDistributedSystem().isConnected()).isFalse());\n+    await().untilAsserted(() -> {\n+      assertThat(cache.getDistributedSystem().isConnected())\n+          .as(\"cache.getDistributedSystem().isConnected()\")", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "028c1e806092f5ad2f7479e6925e2627e83f1040"}, "originalPosition": 100}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDIwNDEzMDg0", "url": "https://github.com/apache/geode/pull/5162#pullrequestreview-420413084", "createdAt": "2020-05-28T19:15:02Z", "commit": {"oid": "028c1e806092f5ad2f7479e6925e2627e83f1040"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDIxMTA0MzE2", "url": "https://github.com/apache/geode/pull/5162#pullrequestreview-421104316", "createdAt": "2020-05-29T16:25:40Z", "commit": {"oid": "028c1e806092f5ad2f7479e6925e2627e83f1040"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4580, "cost": 1, "resetAt": "2021-10-29T19:57:52Z"}}}