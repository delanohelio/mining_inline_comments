{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0MzU5NjkxNTkw", "number": 4564, "title": "GEODE-7649 upgrade tests fail when v1.11 is added to geode-old-versions", "bodyText": "Geode v1.11 inadvertently changed the form of its saved membership view\nby using a FileOutputStream to write it to disk instead of using\nan ObjectOutputStream.  The latter writes additional information during\nserialization.\nNote: there is already a test for this change that will start running\nwhen v1.12 is created and v1.11 is added as a geode-old-version in\nsettings.gradle.\nThank you for submitting a contribution to Apache Geode.\nIn order to streamline the review of the contribution we ask you\nto ensure the following steps have been taken:\nFor all changes:\n\n\n Is there a JIRA ticket associated with this PR? Is it referenced in the commit message?\n\n\n Has your PR been rebased against the latest commit within the target branch (typically develop)?\n\n\n Is your initial contribution a single, squashed commit?\n\n\n Does gradlew build run cleanly?\n\n\n Have you written or updated unit tests to verify your changes?\n\n\n If adding new dependencies to the code, are these dependencies licensed in a way that is compatible for inclusion under ASF 2.0?\n\n\nNote:\nPlease ensure that once the PR is submitted, check Concourse for build issues and\nsubmit an update to your PR as soon as possible. If you need help, please send an\nemail to dev@geode.apache.org.", "createdAt": "2020-01-06T20:01:00Z", "url": "https://github.com/apache/geode/pull/4564", "merged": true, "mergeCommit": {"oid": "0b232758ed708b90e4ccc787d438676e5ac7f58c"}, "closed": true, "closedAt": "2020-01-07T01:30:20Z", "author": {"login": "bschuchardt"}, "timelineItems": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABb3xrHEAH2gAyMzU5NjkxNTkwOmMxMWM4NTZlMGIxMmE0MDljZDQ4ZTlmN2ZhYjI2NTgzZTJiMTg5YWY=", "endCursor": "Y3Vyc29yOnYyOpPPAAABb30QbJAH2gAyMzU5NjkxNTkwOjlkZjRmZmU4ZjU3NTUzZGNkNTdkMWE4MDhhNTg2ZTUxMWE0YjJmZGM=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "c11c856e0b12a409cd48e9f7fab26583e2b189af", "author": {"user": {"login": "bschuchardt", "name": "Bruce Schuchardt"}}, "url": "https://github.com/apache/geode/commit/c11c856e0b12a409cd48e9f7fab26583e2b189af", "committedDate": "2020-01-06T19:53:12Z", "message": "GEODE-7649 upgrade tests fail when v1.11 is added to geode-old-versions\n\nGeode v1.11 inadvertently changed the form of its saved membership view\nby using a FileOutputStream to write it to disk instead of using\nan ObjectOutputStream.  The latter writes additional information during\nserialization.\n\nNote: there is already a test for this change that will start running\nwhen v1.12 is created and v1.11 is added as a geode-old-version in\nsettings.gradle."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "0cc482a10d749b5b88577bf8667570cd8c3e848c", "author": {"user": {"login": "bschuchardt", "name": "Bruce Schuchardt"}}, "url": "https://github.com/apache/geode/commit/0cc482a10d749b5b88577bf8667570cd8c3e848c", "committedDate": "2020-01-06T21:36:55Z", "message": "corrected serialization in integration test"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzM4OTQxMTkz", "url": "https://github.com/apache/geode/pull/4564#pullrequestreview-338941193", "createdAt": "2020-01-06T22:44:18Z", "commit": {"oid": "0cc482a10d749b5b88577bf8667570cd8c3e848c"}, "state": "APPROVED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0wNlQyMjo0NDoxOVrOFarbaA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0wNlQyMjo0NDoxOVrOFarbaA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2MzUxODgyNA==", "bodyText": "Maybe flip this equals check Version.GEODE_1_11_0.equals(geodeVersion) - I think fromOrdinalNoThrow could return null if the version is not found?", "url": "https://github.com/apache/geode/pull/4564#discussion_r363518824", "createdAt": "2020-01-06T22:44:19Z", "author": {"login": "upthewaterspout"}, "path": "geode-core/src/main/java/org/apache/geode/distributed/internal/membership/gms/locator/GMSLocator.java", "diffHunk": "@@ -449,15 +450,21 @@ boolean recoverFromFile(File file) {\n \n       int version = ois.readInt();\n       int currentVersion = Version.getCurrentVersion().ordinal();\n-      DataInputStream input = new DataInputStream(fileInputStream);\n-      if (version != currentVersion) {\n+      DataInputStream input;\n+      if (version == currentVersion) {\n+        input = new DataInputStream(ois);\n+      } else if (version > currentVersion) {\n+        return false;\n+      } else {\n         Version geodeVersion = Version.fromOrdinalNoThrow((short) version, false);\n         logger.info(\"Peer locator found that persistent view was written with version {}\",\n             geodeVersion);\n-        if (version > currentVersion) {\n-          return false;\n+        if (geodeVersion.equals(Version.GEODE_1_11_0)) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "0cc482a10d749b5b88577bf8667570cd8c3e848c"}, "originalPosition": 36}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "9df4ffe8f57553dcd57d1a808a586e511a4b2fdc", "author": {"user": {"login": "bschuchardt", "name": "Bruce Schuchardt"}}, "url": "https://github.com/apache/geode/commit/9df4ffe8f57553dcd57d1a808a586e511a4b2fdc", "committedDate": "2020-01-06T22:53:46Z", "message": "flipping equals() check to avoid possible NPE"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3812, "cost": 1, "resetAt": "2021-10-29T19:57:52Z"}}}