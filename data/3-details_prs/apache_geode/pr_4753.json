{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0MzgyNTYzMzQ1", "number": 4753, "title": "Feature/geode 6536 1: modify borrowConnection singleHop solution", "bodyText": "Thank you for submitting a contribution to Apache Geode.\nIn order to streamline the review of the contribution we ask you\nto ensure the following steps have been taken:\nFor all changes:\n\n\n[*] Is there a JIRA ticket associated with this PR? Is it referenced in the commit message?\n\n\n[*] Has your PR been rebased against the latest commit within the target branch (typically develop)?\n\n\n[*] Is your initial contribution a single, squashed commit?\n\n\n[*] Does gradlew build run cleanly?\n\n\n[*] Have you written or updated unit tests to verify your changes?\n\n\n If adding new dependencies to the code, are these dependencies licensed in a way that is compatible for inclusion under ASF 2.0?\n\n\nNote:\nPlease ensure that once the PR is submitted, check Concourse for build issues and\nsubmit an update to your PR as soon as possible. If you need help, please send an\nemail to dev@geode.apache.org.", "createdAt": "2020-03-02T19:24:55Z", "url": "https://github.com/apache/geode/pull/4753", "merged": true, "mergeCommit": {"oid": "86defd40c6ba558b53753c51176e05f009bb32c3"}, "closed": true, "closedAt": "2020-03-10T21:56:49Z", "author": {"login": "mivanac"}, "timelineItems": {"totalCount": 18, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcJ4hpRAFqTM2NzY0OTM0OQ==", "endCursor": "Y3Vyc29yOnYyOpPPAAABcMYnzLAFqTM3MjMwMDg3NA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzY3NjQ5MzQ5", "url": "https://github.com/apache/geode/pull/4753#pullrequestreview-367649349", "createdAt": "2020-03-03T01:35:16Z", "commit": {"oid": "b92b08da95a10737ca4ac0c62cce442dca99c880"}, "state": "COMMENTED", "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wM1QwMTozNToxNlrOFw1f3w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wM1QwMTo1OTozNlrOFw15xg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4Njc1MjQ3OQ==", "bodyText": "Method comment says; its used for tests and gateway. The ticket is mainly talking about connection during singleHop; is this called during single hop?", "url": "https://github.com/apache/geode/pull/4753#discussion_r386752479", "createdAt": "2020-03-03T01:35:16Z", "author": {"login": "agingade"}, "path": "geode-core/src/main/java/org/apache/geode/cache/client/internal/PoolImpl.java", "diffHunk": "@@ -918,10 +918,14 @@ public void returnConnection(Connection conn) {\n   }\n \n   /**\n-   * Test hook that acquires and returns a connection from the pool with a given ServerLocation.\n+   * Borrows a connection to a specific server from the pool.. Used by gateway and tests. Any\n+   * connection\n+   * that is acquired using this method must be returned using returnConnection, even if it is\n+   * destroyed.\n+   *\n    */\n   public Connection acquireConnection(ServerLocation loc) {\n-    return manager.borrowConnection(loc, false);\n+    return manager.borrowConnection(loc, 15000L, false);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b92b08da95a10737ca4ac0c62cce442dca99c880"}, "originalPosition": 13}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4Njc1ODY5NQ==", "bodyText": "Based on the previous method comment; for certain commands, even if limit is hit, it's fine to create a new connection. E.g. InterestRegistration(one time ops?) I agree with that one, we need to see the ops which could really impact the system by breaking the limit conditions.\nAlso, if we look into what currently available and whats is expected from the ticket GEODE-6536 requirement:\n\n\nPrevious behavior before this change:\nIf the connection for expected server is not available, it creates a new connection and returns.\n\n\nWith the fix the behavior is:\nIf the connection for a given server is not available, it will wait for certain time and then throws exception.\n\n\nIt seems like both approach is valid based on the application requirement. In certain cases the application may not want to wait for long; instead it may choose to have a new connection created and execute the command to satisfy its response requirement (most of the time networking between the servers/peers are faster and they can take the load).\nIf this borrowConnection is used for singleHop; then we should provide both options for the application, my vote will be for approach #1 as default.\nAlso, with this, both flavors of borrowConnection() methods:\nborrowConnection(long acquireTimeout)\nPooledConnection borrowConnection(ServerLocation server, boolean onlyUseExistingCnx)\nHave lot of common code; we could have a common code that could be used by both?", "url": "https://github.com/apache/geode/pull/4753#discussion_r386758695", "createdAt": "2020-03-03T01:58:05Z", "author": {"login": "agingade"}, "path": "geode-core/src/main/java/org/apache/geode/cache/client/internal/pooling/ConnectionManagerImpl.java", "diffHunk": "@@ -301,31 +301,68 @@ public Connection borrowConnection(long acquireTimeout)\n     throw new AllConnectionsInUseException();\n   }\n \n-  /**\n-   * Borrow a connection to a specific server. This task currently allows us to break the connection\n-   * limit, because it is used by tasks from the background thread that shouldn't be constrained by\n-   * the limit. They will only violate the limit by 1 connection, and that connection will be\n-   * destroyed when returned to the pool.\n-   */\n   @Override\n-  public PooledConnection borrowConnection(ServerLocation server,\n-      boolean onlyUseExistingCnx) throws AllConnectionsInUseException, NoAvailableServersException {\n-    PooledConnection connection =\n-        availableConnectionManager.useFirst((c) -> c.getServer().equals(server));\n-    if (null != connection) {\n-      return connection;\n-    }\n+  public PooledConnection borrowConnection(ServerLocation server, long acquireTimeout,", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b92b08da95a10737ca4ac0c62cce442dca99c880"}, "originalPosition": 18}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4Njc1OTExMA==", "bodyText": "Do we need this? The java doc for \"yield\" says, its rarely appropriate and used for testing or debugging.", "url": "https://github.com/apache/geode/pull/4753#discussion_r386759110", "createdAt": "2020-03-03T01:59:36Z", "author": {"login": "agingade"}, "path": "geode-core/src/main/java/org/apache/geode/cache/client/internal/pooling/ConnectionManagerImpl.java", "diffHunk": "@@ -301,31 +301,68 @@ public Connection borrowConnection(long acquireTimeout)\n     throw new AllConnectionsInUseException();\n   }\n \n-  /**\n-   * Borrow a connection to a specific server. This task currently allows us to break the connection\n-   * limit, because it is used by tasks from the background thread that shouldn't be constrained by\n-   * the limit. They will only violate the limit by 1 connection, and that connection will be\n-   * destroyed when returned to the pool.\n-   */\n   @Override\n-  public PooledConnection borrowConnection(ServerLocation server,\n-      boolean onlyUseExistingCnx) throws AllConnectionsInUseException, NoAvailableServersException {\n-    PooledConnection connection =\n-        availableConnectionManager.useFirst((c) -> c.getServer().equals(server));\n-    if (null != connection) {\n-      return connection;\n-    }\n+  public PooledConnection borrowConnection(ServerLocation server, long acquireTimeout,\n+      boolean onlyUseExistingCnx)\n+      throws AllConnectionsInUseException, NoAvailableServersException,\n+      ServerConnectivityException {\n \n-    if (onlyUseExistingCnx) {\n-      throw new AllConnectionsInUseException();\n-    }\n+    PooledConnection connection;\n+    logger.trace(\"Connection borrowConnection single hop connection\");\n+\n+    long waitStart = NOT_WAITING;\n+    try {\n+      long timeout = System.nanoTime() + MILLISECONDS.toNanos(acquireTimeout);\n+      while (true) {\n+\n+        connection =\n+            availableConnectionManager.useFirst((c) -> c.getServer().equals(server));\n+\n+        if (null != connection) {\n+          return connection;\n+        }\n+\n+        if (connectionAccounting.tryCreate()) {\n+          try {\n+            connection = createPooledConnection(server);\n \n-    connection = forceCreateConnection(server);\n-    if (null != connection) {\n-      return connection;\n+            if (null != connection) {\n+              return connection;\n+            }\n+            throw new NoAvailableServersException();\n+          } finally {\n+            if (connection == null) {\n+              connectionAccounting.cancelTryCreate();\n+              if (connectionAccounting.isUnderMinimum()) {\n+                startBackgroundPrefill();\n+              }\n+            }\n+          }\n+        }\n+\n+        if (checkShutdownInterruptedOrTimeout(timeout)) {\n+          break;\n+        }\n+\n+        if (!onlyUseExistingCnx) {\n+          connection = forceCreateConnection(server);\n+          if (null != connection) {\n+            return connection;\n+          }\n+          throw new ServerConnectivityException(BORROW_CONN_ERROR_MSG + server);\n+        }\n+\n+        waitStart = beginConnectionWaitStatIfNotStarted(waitStart);\n+\n+        Thread.yield();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b92b08da95a10737ca4ac0c62cce442dca99c880"}, "originalPosition": 76}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzY4MzEwOTgw", "url": "https://github.com/apache/geode/pull/4753#pullrequestreview-368310980", "createdAt": "2020-03-03T20:45:47Z", "commit": {"oid": "b92b08da95a10737ca4ac0c62cce442dca99c880"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wM1QyMDo0NTo0N1rOFxV4fw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wM1QyMDo0OTo0OFrOFxWAQQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NzI4MzA3MQ==", "bodyText": "This test is now misnamed, since the test is no longer testing the condition that no connections exist.", "url": "https://github.com/apache/geode/pull/4753#discussion_r387283071", "createdAt": "2020-03-03T20:45:47Z", "author": {"login": "DonalEvans"}, "path": "geode-core/src/integrationTest/java/org/apache/geode/cache/client/internal/pooling/ConnectionManagerImplTest.java", "diffHunk": "@@ -92,9 +92,18 @@ public void startShouldEatRejectedExecutionException() {\n   @Test\n   public void borrowConnectionThrowsWhenUsingExistingConnectionsAndNoConnectionsExist() {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b92b08da95a10737ca4ac0c62cce442dca99c880"}, "originalPosition": 2}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NzI4NTA1Nw==", "bodyText": "These test names need to be more descriptive. They should say what part of the code is being tested, using what parameters and what the expected outcome is. It's also unclear to me what these two tests are actually testing that's different between the tests. Both seem to only be asserting that manager.borrowConnection(new ServerLocation(\"localhost\", 5), BORROW_TIMEOUT_MILLIS, true) returns in less than the borrow timeout.\nAlso, InterruptedException is never thrown from these methods and many of the Connection objects which are assigned are never used.", "url": "https://github.com/apache/geode/pull/4753#discussion_r387285057", "createdAt": "2020-03-03T20:49:48Z", "author": {"login": "DonalEvans"}, "path": "geode-core/src/integrationTest/java/org/apache/geode/cache/client/internal/pooling/ConnectionManagerJUnitTest.java", "diffHunk": "@@ -361,6 +363,82 @@ public void testBug41516()\n         elapsedMillis >= BORROW_TIMEOUT_MILLIS - ALLOWABLE_ERROR_IN_MILLIS);\n   }\n \n+\n+  @Test\n+  public void testSingleHopRetryConnection()", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b92b08da95a10737ca4ac0c62cce442dca99c880"}, "originalPosition": 27}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f0e37ad673953de1a3f62f0cd6ed1836eda35efd", "author": {"user": {"login": "mivanac", "name": "Mario Ivanac"}}, "url": "https://github.com/apache/geode/commit/f0e37ad673953de1a3f62f0cd6ed1836eda35efd", "committedDate": "2020-03-06T08:48:44Z", "message": "GEODE-6536: Added retry in borrowConnection/single hop"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f9af22af7ac38527a752d5b3f58138529cb4704d", "author": {"user": {"login": "mivanac", "name": "Mario Ivanac"}}, "url": "https://github.com/apache/geode/commit/f9af22af7ac38527a752d5b3f58138529cb4704d", "committedDate": "2020-03-06T08:48:44Z", "message": "GEODE-6536: bug fix"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "eaec77e329257009bb7a8531a846c95fcef93fb8", "author": {"user": {"login": "mivanac", "name": "Mario Ivanac"}}, "url": "https://github.com/apache/geode/commit/eaec77e329257009bb7a8531a846c95fcef93fb8", "committedDate": "2020-03-06T08:48:44Z", "message": "GEODE-6536: update after comments"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ac0a0a48ca12cc9e6def15c343bb2162c0bdb474", "author": {"user": {"login": "mivanac", "name": "Mario Ivanac"}}, "url": "https://github.com/apache/geode/commit/ac0a0a48ca12cc9e6def15c343bb2162c0bdb474", "committedDate": "2020-03-06T08:48:44Z", "message": "GEODE-6536: modify borrowConnection singleHop solution"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "cfedf8332ffd74a144113a03b5ff0a6dcca1bc87", "author": {"user": {"login": "mivanac", "name": "Mario Ivanac"}}, "url": "https://github.com/apache/geode/commit/cfedf8332ffd74a144113a03b5ff0a6dcca1bc87", "committedDate": "2020-03-06T08:48:44Z", "message": "GEODE-6536: test update"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "b92b08da95a10737ca4ac0c62cce442dca99c880", "author": {"user": {"login": "mivanac", "name": "Mario Ivanac"}}, "url": "https://github.com/apache/geode/commit/b92b08da95a10737ca4ac0c62cce442dca99c880", "committedDate": "2020-03-02T20:38:21Z", "message": "GEODE-6536: test update"}, "afterCommit": {"oid": "92c8e656f04b83f1f303cdbcf6462b5d3e87a754", "author": {"user": {"login": "mivanac", "name": "Mario Ivanac"}}, "url": "https://github.com/apache/geode/commit/92c8e656f04b83f1f303cdbcf6462b5d3e87a754", "committedDate": "2020-03-06T18:38:16Z", "message": "GEODE-6536: updated tests, and added parameter to desable timeout"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "2a2d8fc8e4b5813bd36a075598e8460fb404f3c2", "author": {"user": {"login": "mivanac", "name": "Mario Ivanac"}}, "url": "https://github.com/apache/geode/commit/2a2d8fc8e4b5813bd36a075598e8460fb404f3c2", "committedDate": "2020-03-06T18:54:09Z", "message": "GEODE-6536: updated tests, and added parameter to desable timeout"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "92c8e656f04b83f1f303cdbcf6462b5d3e87a754", "author": {"user": {"login": "mivanac", "name": "Mario Ivanac"}}, "url": "https://github.com/apache/geode/commit/92c8e656f04b83f1f303cdbcf6462b5d3e87a754", "committedDate": "2020-03-06T18:38:16Z", "message": "GEODE-6536: updated tests, and added parameter to desable timeout"}, "afterCommit": {"oid": "2a2d8fc8e4b5813bd36a075598e8460fb404f3c2", "author": {"user": {"login": "mivanac", "name": "Mario Ivanac"}}, "url": "https://github.com/apache/geode/commit/2a2d8fc8e4b5813bd36a075598e8460fb404f3c2", "committedDate": "2020-03-06T18:54:09Z", "message": "GEODE-6536: updated tests, and added parameter to desable timeout"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzcwNjMxNjA1", "url": "https://github.com/apache/geode/pull/4753#pullrequestreview-370631605", "createdAt": "2020-03-06T21:16:40Z", "commit": {"oid": "2a2d8fc8e4b5813bd36a075598e8460fb404f3c2"}, "state": "COMMENTED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzcwNjkyMzE2", "url": "https://github.com/apache/geode/pull/4753#pullrequestreview-370692316", "createdAt": "2020-03-06T23:53:55Z", "commit": {"oid": "2a2d8fc8e4b5813bd36a075598e8460fb404f3c2"}, "state": "COMMENTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wNlQyMzo1Mzo1NVrOFzKvog==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wN1QwMDozNzoxOVrOFzLQOg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4OTE5NzczMA==", "bodyText": "Additional comment could be added to highlight difference between \"setFreeConnectionTimeout\":\nSay:\nIt differs from \"setFreeConnectionTimeout\" which waits for any server connection in the pool, where this waits for a free connection to a specific server.", "url": "https://github.com/apache/geode/pull/4753#discussion_r389197730", "createdAt": "2020-03-06T23:53:55Z", "author": {"login": "agingade"}, "path": "geode-core/src/main/java/org/apache/geode/cache/client/PoolFactory.java", "diffHunk": "@@ -238,6 +246,25 @@\n    */\n   PoolFactory setFreeConnectionTimeout(int connectionTimeout);\n \n+\n+  /**\n+   * Sets the server connection timeout for this pool. If the pool has a max connections setting,\n+   * operations will block if there is no free connection towards specific server. The server\n+   * connection timeout\n+   * specifies how long those operations will block waiting for a free connection towards specific\n+   * server before\n+   * receiving an {@link AllConnectionsInUseException}. If max connections is not set this setting\n+   * has no\n+   * effect.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "2a2d8fc8e4b5813bd36a075598e8460fb404f3c2"}, "originalPosition": 28}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4OTIwNjA3NA==", "bodyText": "While trying to find a connection, for given time (acquireTimeout); this may get into a hot-loop; consuming the CPU; can you see if you can wait for a notification which indicates a server connection is available.\nThe above ask is nice to have. Also, currently the other borrowConnection() does not wait based on wait/notify.", "url": "https://github.com/apache/geode/pull/4753#discussion_r389206074", "createdAt": "2020-03-07T00:37:19Z", "author": {"login": "agingade"}, "path": "geode-core/src/main/java/org/apache/geode/cache/client/internal/pooling/ConnectionManagerImpl.java", "diffHunk": "@@ -301,31 +301,68 @@ public Connection borrowConnection(long acquireTimeout)\n     throw new AllConnectionsInUseException();\n   }\n \n-  /**\n-   * Borrow a connection to a specific server. This task currently allows us to break the connection\n-   * limit, because it is used by tasks from the background thread that shouldn't be constrained by\n-   * the limit. They will only violate the limit by 1 connection, and that connection will be\n-   * destroyed when returned to the pool.\n-   */\n   @Override\n-  public PooledConnection borrowConnection(ServerLocation server,\n-      boolean onlyUseExistingCnx) throws AllConnectionsInUseException, NoAvailableServersException {\n-    PooledConnection connection =\n-        availableConnectionManager.useFirst((c) -> c.getServer().equals(server));\n-    if (null != connection) {\n-      return connection;\n-    }\n+  public PooledConnection borrowConnection(ServerLocation server, long acquireTimeout,\n+      boolean onlyUseExistingCnx)\n+      throws AllConnectionsInUseException, NoAvailableServersException,\n+      ServerConnectivityException {\n \n-    if (onlyUseExistingCnx) {\n-      throw new AllConnectionsInUseException();\n-    }\n+    PooledConnection connection;\n+    logger.trace(\"Connection borrowConnection single hop connection\");\n+\n+    long waitStart = NOT_WAITING;\n+    try {\n+      long timeout = System.nanoTime() + MILLISECONDS.toNanos(acquireTimeout);\n+      while (true) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "2a2d8fc8e4b5813bd36a075598e8460fb404f3c2"}, "originalPosition": 32}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "54cf1e72ff55fbaa82a28ba81c882fb4e499136e", "author": {"user": {"login": "mivanac", "name": "Mario Ivanac"}}, "url": "https://github.com/apache/geode/commit/54cf1e72ff55fbaa82a28ba81c882fb4e499136e", "committedDate": "2020-03-08T08:21:32Z", "message": "GEODE-6536: update of cachexml impacts"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "740bcddff41bd582ad3f78e5ff322b109de35313", "author": {"user": {"login": "mivanac", "name": "Mario Ivanac"}}, "url": "https://github.com/apache/geode/commit/740bcddff41bd582ad3f78e5ff322b109de35313", "committedDate": "2020-03-08T10:21:20Z", "message": "GEODE-6536: remove cachexml restriction"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzcxNTE4Mjky", "url": "https://github.com/apache/geode/pull/4753#pullrequestreview-371518292", "createdAt": "2020-03-09T20:48:47Z", "commit": {"oid": "740bcddff41bd582ad3f78e5ff322b109de35313"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wOVQyMDo0ODo0N1rOFz41tg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wOVQyMDo1MTozMVrOFz47Mw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4OTk1Mjk1MA==", "bodyText": "A timeout of -1 is usually used to imply that the timeout is infinite, i.e. that we will wait forever to obtain a server connection if max connections is set and there is no free connections towards designated server. Would it be possible to change the default value to 0 but still ensure that the original behaviour is preserved?", "url": "https://github.com/apache/geode/pull/4753#discussion_r389952950", "createdAt": "2020-03-09T20:48:47Z", "author": {"login": "DonalEvans"}, "path": "geode-core/src/main/java/org/apache/geode/cache/client/PoolFactory.java", "diffHunk": "@@ -73,6 +73,14 @@\n    */\n   int DEFAULT_FREE_CONNECTION_TIMEOUT = 10000;\n \n+  /**\n+   * The default amount of time, in milliseconds, which we will wait for a server connection if max\n+   * connections is set and there is no free connections towards designated server.\n+   * <p>\n+   * Current value: <code>-1</code>.\n+   */\n+  int DEFAULT_SERVER_CONNECTION_TIMEOUT = -1;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "740bcddff41bd582ad3f78e5ff322b109de35313"}, "originalPosition": 10}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4OTk1NDM1NQ==", "bodyText": "When the default value for the timeout is being used, instead of hard-coding the value like here, it would be better to use a reference to the DEFAULT_SERVER_CONNECTION_TIMEOUT defined in PoolFactory.java.", "url": "https://github.com/apache/geode/pull/4753#discussion_r389954355", "createdAt": "2020-03-09T20:51:31Z", "author": {"login": "DonalEvans"}, "path": "geode-core/src/test/java/org/apache/geode/cache/client/internal/OpExecutorImplJUnitTest.java", "diffHunk": "@@ -99,7 +99,7 @@ public RuntimeException generateCancelledException(Throwable e) {\n   @Test\n   public void testExecute() throws Exception {\n     OpExecutorImpl exec = new OpExecutorImpl(manager, queueManager, endpointManager, riTracker, 3,\n-        10, cancelCriterion, null);\n+        10, -1, cancelCriterion, null);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "740bcddff41bd582ad3f78e5ff322b109de35313"}, "originalPosition": 5}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "8338203abe376c62d7070f13d9d613f1a5edf20c", "author": {"user": {"login": "mivanac", "name": "Mario Ivanac"}}, "url": "https://github.com/apache/geode/commit/8338203abe376c62d7070f13d9d613f1a5edf20c", "committedDate": "2020-03-10T10:32:56Z", "message": "GEODE-6536: update default value and documentation"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzcyMjk2NzMy", "url": "https://github.com/apache/geode/pull/4753#pullrequestreview-372296732", "createdAt": "2020-03-10T20:28:03Z", "commit": {"oid": "8338203abe376c62d7070f13d9d613f1a5edf20c"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzcyMzAwODc0", "url": "https://github.com/apache/geode/pull/4753#pullrequestreview-372300874", "createdAt": "2020-03-10T20:34:22Z", "commit": {"oid": "8338203abe376c62d7070f13d9d613f1a5edf20c"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4977, "cost": 1, "resetAt": "2021-10-29T19:57:52Z"}}}