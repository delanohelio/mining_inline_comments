{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0Mzg5MTgzMjQz", "number": 4815, "title": "GEODE-7838: getNumOfServers while rebalance is executed", "bodyText": "Thank you for submitting a contribution to Apache Geode.\nIn order to streamline the review of the contribution we ask you\nto ensure the following steps have been taken:\nFor all changes:\n\n\n Is there a JIRA ticket associated with this PR? Is it referenced in the commit message?\n\n\n Has your PR been rebased against the latest commit within the target branch (typically develop)?\n\n\n Is your initial contribution a single, squashed commit?\n\n\n Does gradlew build run cleanly?\n\n\n Have you written or updated unit tests to verify your changes?\n\n\n If adding new dependencies to the code, are these dependencies licensed in a way that is compatible for inclusion under ASF 2.0?\n\n\nNote:\nPlease ensure that once the PR is submitted, check Concourse for build issues and\nsubmit an update to your PR as soon as possible. If you need help, please send an\nemail to dev@geode.apache.org.", "createdAt": "2020-03-16T11:57:36Z", "url": "https://github.com/apache/geode/pull/4815", "merged": true, "mergeCommit": {"oid": "93e460bb12c05c9351db0b8d6cb8b9179f18caec"}, "closed": true, "closedAt": "2020-04-10T05:28:50Z", "author": {"login": "mkevo"}, "timelineItems": {"totalCount": 13, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcOMjKCgH2gAyMzg5MTgzMjQzOjUyMDYyYjZjMDdlZGIxYzczNjdjNzM5OTM4NGU2ZTNlMDJjMjVmNzM=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcWBRkvgFqTM5MTA1NDY2OA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "52062b6c07edb1c7367c7399384e6e3e02c25f73", "author": {"user": {"login": "mkevo", "name": "Mario Kevo"}}, "url": "https://github.com/apache/geode/commit/52062b6c07edb1c7367c7399384e6e3e02c25f73", "committedDate": "2020-03-16T11:38:17Z", "message": "GEODE-7383: getNumOfServers while rebalance is executed"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "216835db3d57f7f0ef593446331555e7fe0a0946", "author": {"user": {"login": "mkevo", "name": "Mario Kevo"}}, "url": "https://github.com/apache/geode/commit/216835db3d57f7f0ef593446331555e7fe0a0946", "committedDate": "2020-03-16T11:51:11Z", "message": "update method"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "7ffedc41b6481aab0462ab5f097a6cad5f5bdc7b", "author": {"user": {"login": "mkevo", "name": "Mario Kevo"}}, "url": "https://github.com/apache/geode/commit/7ffedc41b6481aab0462ab5f097a6cad5f5bdc7b", "committedDate": "2020-03-16T12:43:47Z", "message": "fix integration test"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "63e85b09a44acd303cc236448c3f9ee3459f07b9", "author": {"user": {"login": "mkevo", "name": "Mario Kevo"}}, "url": "https://github.com/apache/geode/commit/63e85b09a44acd303cc236448c3f9ee3459f07b9", "committedDate": "2020-03-16T13:03:56Z", "message": "fix for integration test v2"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "28e144edfb2b425c431d6564f4d40f6fbfe2323b", "author": {"user": {"login": "mkevo", "name": "Mario Kevo"}}, "url": "https://github.com/apache/geode/commit/28e144edfb2b425c431d6564f4d40f6fbfe2323b", "committedDate": "2020-03-26T07:18:07Z", "message": "empty commit to re-launch CI"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "fa86193969dd465e03a8774e0c5203890a1d2572", "author": {"user": {"login": "mkevo", "name": "Mario Kevo"}}, "url": "https://github.com/apache/geode/commit/fa86193969dd465e03a8774e0c5203890a1d2572", "committedDate": "2020-04-08T11:25:40Z", "message": "empty commit to re-launch tests"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzkwMjc1Mzc5", "url": "https://github.com/apache/geode/pull/4815#pullrequestreview-390275379", "createdAt": "2020-04-08T19:40:53Z", "commit": {"oid": "fa86193969dd465e03a8774e0c5203890a1d2572"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wOFQxOTo0MDo1M1rOGC-IgA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wOFQxOTo0Njo1MVrOGC-UzA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNTc2ODMyMA==", "bodyText": "This name is confusing, since the method has nothing to do with primary buckets. A better name might be \"getNumberOfMembersExecutedOn\".", "url": "https://github.com/apache/geode/pull/4815#discussion_r405768320", "createdAt": "2020-04-08T19:40:53Z", "author": {"login": "DonalEvans"}, "path": "geode-core/src/main/java/org/apache/geode/cache/partition/PartitionRebalanceInfo.java", "diffHunk": "@@ -137,4 +137,11 @@\n    * @return the time, in milliseconds, spent transferring primaries for this region\n    */\n   long getPrimaryTransferTime();\n+\n+  /**\n+   * Returns the total number of members on which command is executed.\n+   *\n+   * @return the total number of members on which command is executed\n+   */\n+  int getPrimaryNumOfMembers();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "fa86193969dd465e03a8774e0c5203890a1d2572"}, "originalPosition": 10}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNTc2OTcxMg==", "bodyText": "This method might be better named \"getTotalMembersExecutedOn\", or something else that makes it clear that it's specifically returning the number of members the command was executed on.", "url": "https://github.com/apache/geode/pull/4815#discussion_r405769712", "createdAt": "2020-04-08T19:43:24Z", "author": {"login": "DonalEvans"}, "path": "geode-core/src/main/java/org/apache/geode/cache/control/RebalanceResults.java", "diffHunk": "@@ -99,4 +99,11 @@\n    * @return the total time, in milliseconds, spent transferring primaries\n    */\n   long getTotalPrimaryTransferTime();\n+\n+  /**\n+   * Returns the total number of members on which command is executed.\n+   *\n+   * @return the total number of members on which command is executed\n+   */\n+  int getTotalNumOfMembers();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "fa86193969dd465e03a8774e0c5203890a1d2572"}, "originalPosition": 10}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNTc3MDQ2NQ==", "bodyText": "This description is potentially misleading, since the count is actually the number of members on which the rebalance was executed, which might be different from the total number of members in the system.", "url": "https://github.com/apache/geode/pull/4815#discussion_r405770465", "createdAt": "2020-04-08T19:44:51Z", "author": {"login": "DonalEvans"}, "path": "geode-core/src/main/java/org/apache/geode/management/internal/i18n/CliStrings.java", "diffHunk": "@@ -1873,6 +1873,8 @@\n       \"Total primaries transferred during this rebalance\";\n   public static final String REBALANCE__MSG__TOTALTIME =\n       \"Total time (in milliseconds) for this rebalance\";\n+  public static final String REBALANCE__MSG__MEMBER_COUNT =\n+      \"Total number of members in system during rebalance\";", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "fa86193969dd465e03a8774e0c5203890a1d2572"}, "originalPosition": 5}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNTc3MTQ2OA==", "bodyText": "Typo here, should be Of, not 0f", "url": "https://github.com/apache/geode/pull/4815#discussion_r405771468", "createdAt": "2020-04-08T19:46:51Z", "author": {"login": "DonalEvans"}, "path": "geode-management/src/main/java/org/apache/geode/management/runtime/RebalanceRegionResult.java", "diffHunk": "@@ -74,4 +74,9 @@\n    * Returns the time, in milliseconds, that the rebalance operation took for this region.\n    */\n   long getTimeInMilliseconds();\n+\n+  /**\n+   * Returns the number of members on which rebalance operation is executed.\n+   */\n+  int getNum0fMembers();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "fa86193969dd465e03a8774e0c5203890a1d2572"}, "originalPosition": 8}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "3225a84a3d7b66f30146438ee8820f0c1000c03b", "author": {"user": {"login": "mkevo", "name": "Mario Kevo"}}, "url": "https://github.com/apache/geode/commit/3225a84a3d7b66f30146438ee8820f0c1000c03b", "committedDate": "2020-04-09T13:06:04Z", "message": "update after comments"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzkwOTI2Mjg0", "url": "https://github.com/apache/geode/pull/4815#pullrequestreview-390926284", "createdAt": "2020-04-09T16:00:37Z", "commit": {"oid": "3225a84a3d7b66f30146438ee8820f0c1000c03b"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wOVQxNjowMDozN1rOGDfMew==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wOVQxNjowMDozN1rOGDfMew==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNjMxMDAxMQ==", "bodyText": "This string should ideally be replaced with a reference to the REBALANCE__MSG__MEMBER_COUNT constant.", "url": "https://github.com/apache/geode/pull/4815#discussion_r406310011", "createdAt": "2020-04-09T16:00:37Z", "author": {"login": "DonalEvans"}, "path": "geode-dunit/src/main/java/org/apache/geode/management/internal/cli/commands/RebalanceCommandDistributedTestBase.java", "diffHunk": "@@ -94,6 +98,40 @@ public void testRebalanceResultOutput() {\n     rebalanceResult.hasRow(9).contains(CliStrings.REBALANCE__MSG__MEMBER_COUNT);\n   }\n \n+  @Test\n+  public void testRebalanceResultOutputMemberCount() {\n+    server3 = cluster.startServerVM(3, \"localhost\", locator.getPort());\n+    server3.invoke(() -> {\n+      Cache cache = ClusterStartupRule.getCache();\n+      RegionFactory<Integer, Integer> dataRegionFactory =\n+          cache.createRegionFactory(RegionShortcut.PARTITION);\n+      Region region = dataRegionFactory.create(\"region-1\");\n+      for (int i = 0; i < 100; i++) {\n+        region.put(\"key\" + (i + 400), \"value\" + (i + 400));\n+      }\n+    });\n+    // check if DistributedRegionMXBean is available so that command will not fail\n+    locator.waitUntilRegionIsReadyOnExactlyThisManyServers(\"/region-1\", 3);\n+\n+    Map<String, List<String>> listMembersResult = gfsh.executeAndAssertThat(\"list members\")\n+        .hasTableSection().getActual().getContent();\n+    assertThat(listMembersResult.get(\"Name\").size()).isEqualTo(4);\n+\n+    server3.forceDisconnect();\n+\n+    Map<String, List<String>> rebalanceResult = gfsh.executeAndAssertThat(\"rebalance\")\n+        .statusIsSuccess().hasTableSection().getActual().getContent();\n+    \n+    server3.waitTilFullyReconnected();\n+\n+    listMembersResult = gfsh.executeAndAssertThat(\"list members\")\n+        .hasTableSection().getActual().getContent();\n+    assertThat(listMembersResult.get(\"Name\").size()).isEqualTo(4);\n+    assertThat(rebalanceResult.get(\"Rebalanced Stats\").get(9))\n+        .isEqualTo(\"Total number of members in system on which rebalance is executed\");", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "3225a84a3d7b66f30146438ee8820f0c1000c03b"}, "originalPosition": 54}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "7b7bb4aa2542458037b3a6f4cbeb228563f23ef0", "author": {"user": {"login": "mkevo", "name": "Mario Kevo"}}, "url": "https://github.com/apache/geode/commit/7b7bb4aa2542458037b3a6f4cbeb228563f23ef0", "committedDate": "2020-04-09T16:19:26Z", "message": "change to CliString"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "4e91ef538798b32841119194a0200f94121c422f", "author": {"user": {"login": "mkevo", "name": "Mario Kevo"}}, "url": "https://github.com/apache/geode/commit/4e91ef538798b32841119194a0200f94121c422f", "committedDate": "2020-04-09T18:54:01Z", "message": "documentation update"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzkxMDUxMTQ4", "url": "https://github.com/apache/geode/pull/4815#pullrequestreview-391051148", "createdAt": "2020-04-09T18:56:18Z", "commit": {"oid": "4e91ef538798b32841119194a0200f94121c422f"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzkxMDU0NjY4", "url": "https://github.com/apache/geode/pull/4815#pullrequestreview-391054668", "createdAt": "2020-04-09T19:01:31Z", "commit": {"oid": "4e91ef538798b32841119194a0200f94121c422f"}, "state": "COMMENTED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4869, "cost": 1, "resetAt": "2021-10-29T19:57:52Z"}}}