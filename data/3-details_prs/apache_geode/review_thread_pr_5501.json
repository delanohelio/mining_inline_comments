{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDgzMTU4NzI4", "number": 5501, "reviewThreads": {"totalCount": 8, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xMFQxNTo1MDoxM1rOEiLsjw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xMFQxNjo1NDowNlrOEiNS3Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzA0Mjc4NjcxOnYy", "diffSide": "RIGHT", "path": "geode-core/src/main/java/org/apache/geode/internal/cache/PartitionedRegion.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xMFQxNTo1MDoxM1rOHP6mJg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xMFQxNjowODowOFrOHP7ZOA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NjQ1MDcyNg==", "bodyText": "My understanding is that we no longer use this new \"tryLock\" parameter. So should we remove it from this method so that this PR does not change this code?", "url": "https://github.com/apache/geode/pull/5501#discussion_r486450726", "createdAt": "2020-09-10T15:50:13Z", "author": {"login": "dschneider-pivotal"}, "path": "geode-core/src/main/java/org/apache/geode/internal/cache/PartitionedRegion.java", "diffHunk": "@@ -611,7 +611,8 @@ PartitionedRegionRedundancyTracker getRedundancyTracker() {\n     return redundancyTracker;\n   }\n \n-  public void computeWithPrimaryLocked(Object key, Runnable r) throws PrimaryBucketLockException {\n+  public boolean computeWithPrimaryLocked(Object key, Runnable r, boolean tryLock)", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "07efdbab2667d668fffd92c0050eccad5b2f04ff"}, "originalPosition": 5}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NjQ2MzgwMA==", "bodyText": "You are correct, Darrel, we no longer need it.  Jens and I talked about it a bit this. morning and thought it might be beneficial to have the option in the method, but since it's not needed for this PR it makes sense to remove it.", "url": "https://github.com/apache/geode/pull/5501#discussion_r486463800", "createdAt": "2020-09-10T16:08:08Z", "author": {"login": "sabbey37"}, "path": "geode-core/src/main/java/org/apache/geode/internal/cache/PartitionedRegion.java", "diffHunk": "@@ -611,7 +611,8 @@ PartitionedRegionRedundancyTracker getRedundancyTracker() {\n     return redundancyTracker;\n   }\n \n-  public void computeWithPrimaryLocked(Object key, Runnable r) throws PrimaryBucketLockException {\n+  public boolean computeWithPrimaryLocked(Object key, Runnable r, boolean tryLock)", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NjQ1MDcyNg=="}, "originalCommit": {"oid": "07efdbab2667d668fffd92c0050eccad5b2f04ff"}, "originalPosition": 5}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzA0MjgwNjc0OnYy", "diffSide": "RIGHT", "path": "geode-redis/src/main/java/org/apache/geode/redis/internal/executor/key/RedisKeyCommandsFunctionInvoker.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xMFQxNTo1NDo1MFrOHP6ymw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xMFQxNjoxMjoyM1rOHP7kWw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NjQ1MzkxNQ==", "bodyText": "I think the \"while (true)\" loop should be removed. I think it is a remnant of the tryLock code. As it is now I don't see that it would ever loop.", "url": "https://github.com/apache/geode/pull/5501#discussion_r486453915", "createdAt": "2020-09-10T15:54:50Z", "author": {"login": "dschneider-pivotal"}, "path": "geode-redis/src/main/java/org/apache/geode/redis/internal/executor/key/RedisKeyCommandsFunctionInvoker.java", "diffHunk": "@@ -74,18 +73,18 @@ public String type(ByteArrayWrapper key) {\n \n \n   @Override\n-  @SuppressWarnings(\"unchecked\")\n   public boolean rename(ByteArrayWrapper oldKey, ByteArrayWrapper newKey) {\n+    while (true) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "07efdbab2667d668fffd92c0050eccad5b2f04ff"}, "originalPosition": 18}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NjQ2NjY1MQ==", "bodyText": "Truth, Darrel. Just removed it!", "url": "https://github.com/apache/geode/pull/5501#discussion_r486466651", "createdAt": "2020-09-10T16:12:23Z", "author": {"login": "sabbey37"}, "path": "geode-redis/src/main/java/org/apache/geode/redis/internal/executor/key/RedisKeyCommandsFunctionInvoker.java", "diffHunk": "@@ -74,18 +73,18 @@ public String type(ByteArrayWrapper key) {\n \n \n   @Override\n-  @SuppressWarnings(\"unchecked\")\n   public boolean rename(ByteArrayWrapper oldKey, ByteArrayWrapper newKey) {\n+    while (true) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NjQ1MzkxNQ=="}, "originalCommit": {"oid": "07efdbab2667d668fffd92c0050eccad5b2f04ff"}, "originalPosition": 18}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzA0MzAzNDA4OnYy", "diffSide": "RIGHT", "path": "geode-core/src/main/java/org/apache/geode/internal/cache/PartitionedRegion.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xMFQxNjo1MDowOFrOHP9Blw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xMFQxNzoxMzozMlrOHP94bw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NjQ5MDUxOQ==", "bodyText": "this should no longer return boolean (since we got rid of the tryLock option)", "url": "https://github.com/apache/geode/pull/5501#discussion_r486490519", "createdAt": "2020-09-10T16:50:08Z", "author": {"login": "dschneider-pivotal"}, "path": "geode-core/src/main/java/org/apache/geode/internal/cache/PartitionedRegion.java", "diffHunk": "@@ -611,7 +611,8 @@ PartitionedRegionRedundancyTracker getRedundancyTracker() {\n     return redundancyTracker;\n   }\n \n-  public void computeWithPrimaryLocked(Object key, Runnable r) throws PrimaryBucketLockException {\n+  public boolean computeWithPrimaryLocked(Object key, Runnable r)", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "4712d03186afc5909efaa15c0d1d7fb1ed533a3a"}, "originalPosition": 5}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NjUwNDU1OQ==", "bodyText": "Good call, just updated it!", "url": "https://github.com/apache/geode/pull/5501#discussion_r486504559", "createdAt": "2020-09-10T17:13:32Z", "author": {"login": "sabbey37"}, "path": "geode-core/src/main/java/org/apache/geode/internal/cache/PartitionedRegion.java", "diffHunk": "@@ -611,7 +611,8 @@ PartitionedRegionRedundancyTracker getRedundancyTracker() {\n     return redundancyTracker;\n   }\n \n-  public void computeWithPrimaryLocked(Object key, Runnable r) throws PrimaryBucketLockException {\n+  public boolean computeWithPrimaryLocked(Object key, Runnable r)", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NjQ5MDUxOQ=="}, "originalCommit": {"oid": "4712d03186afc5909efaa15c0d1d7fb1ed533a3a"}, "originalPosition": 5}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzA0MzAzNzY0OnYy", "diffSide": "RIGHT", "path": "geode-core/src/main/java/org/apache/geode/internal/cache/PartitionedRegion.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xMFQxNjo1MTowNVrOHP9DxQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xMFQxNzoxMzo1OVrOHP95ew==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NjQ5MTA3Nw==", "bodyText": "remove the \"if\" and just call br.doLockForPrimary(false);", "url": "https://github.com/apache/geode/pull/5501#discussion_r486491077", "createdAt": "2020-09-10T16:51:05Z", "author": {"login": "dschneider-pivotal"}, "path": "geode-core/src/main/java/org/apache/geode/internal/cache/PartitionedRegion.java", "diffHunk": "@@ -622,7 +623,9 @@ public void computeWithPrimaryLocked(Object key, Runnable r) throws PrimaryBucke\n     }\n \n     try {\n-      br.doLockForPrimary(false);\n+      if (!br.doLockForPrimary(false)) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "4712d03186afc5909efaa15c0d1d7fb1ed533a3a"}, "originalPosition": 15}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NjUwNDgyNw==", "bodyText": "just updated it!", "url": "https://github.com/apache/geode/pull/5501#discussion_r486504827", "createdAt": "2020-09-10T17:13:59Z", "author": {"login": "sabbey37"}, "path": "geode-core/src/main/java/org/apache/geode/internal/cache/PartitionedRegion.java", "diffHunk": "@@ -622,7 +623,9 @@ public void computeWithPrimaryLocked(Object key, Runnable r) throws PrimaryBucke\n     }\n \n     try {\n-      br.doLockForPrimary(false);\n+      if (!br.doLockForPrimary(false)) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NjQ5MTA3Nw=="}, "originalCommit": {"oid": "4712d03186afc5909efaa15c0d1d7fb1ed533a3a"}, "originalPosition": 15}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzA0MzA0MTA5OnYy", "diffSide": "RIGHT", "path": "geode-core/src/main/java/org/apache/geode/internal/cache/PrimaryBucketLockException.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xMFQxNjo1MjowN1rOHP9GFA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xMFQxNzoxNDoxMlrOHP96Bg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NjQ5MTY2OA==", "bodyText": "this javadoc needs to be updated for the signature with no boolean", "url": "https://github.com/apache/geode/pull/5501#discussion_r486491668", "createdAt": "2020-09-10T16:52:07Z", "author": {"login": "dschneider-pivotal"}, "path": "geode-core/src/main/java/org/apache/geode/internal/cache/PrimaryBucketLockException.java", "diffHunk": "@@ -19,7 +19,7 @@\n import org.apache.geode.GemFireException;\n \n /**\n- * Thrown by {@link PartitionedRegion#computeWithPrimaryLocked(Object, Runnable)}\n+ * Thrown by {@link PartitionedRegion#computeWithPrimaryLocked(Object, Runnable, boolean)}", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "4712d03186afc5909efaa15c0d1d7fb1ed533a3a"}, "originalPosition": 5}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NjUwNDk2Ng==", "bodyText": "Truth. Thanks, Darrel!", "url": "https://github.com/apache/geode/pull/5501#discussion_r486504966", "createdAt": "2020-09-10T17:14:12Z", "author": {"login": "sabbey37"}, "path": "geode-core/src/main/java/org/apache/geode/internal/cache/PrimaryBucketLockException.java", "diffHunk": "@@ -19,7 +19,7 @@\n import org.apache.geode.GemFireException;\n \n /**\n- * Thrown by {@link PartitionedRegion#computeWithPrimaryLocked(Object, Runnable)}\n+ * Thrown by {@link PartitionedRegion#computeWithPrimaryLocked(Object, Runnable, boolean)}", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NjQ5MTY2OA=="}, "originalCommit": {"oid": "4712d03186afc5909efaa15c0d1d7fb1ed533a3a"}, "originalPosition": 5}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzA0MzA0MzY5OnYy", "diffSide": "RIGHT", "path": "geode-core/src/main/java/org/apache/geode/internal/cache/PartitionedRegion.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xMFQxNjo1Mjo1NlrOHP9H1g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xMFQxNzoxNDoyMFrOHP96Wg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NjQ5MjExOA==", "bodyText": "take out this new blank line", "url": "https://github.com/apache/geode/pull/5501#discussion_r486492118", "createdAt": "2020-09-10T16:52:56Z", "author": {"login": "dschneider-pivotal"}, "path": "geode-core/src/main/java/org/apache/geode/internal/cache/PartitionedRegion.java", "diffHunk": "@@ -3395,11 +3399,10 @@ private InternalDistributedMember getNodeForBucketReadOrLoad(int bucketId) {\n    * @throws PrimaryBucketException if the remote bucket was not the primary\n    * @throws ForceReattemptException if the peer is no longer available\n    */\n+", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "4712d03186afc5909efaa15c0d1d7fb1ed533a3a"}, "originalPosition": 33}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NjUwNTA1MA==", "bodyText": "updated.", "url": "https://github.com/apache/geode/pull/5501#discussion_r486505050", "createdAt": "2020-09-10T17:14:20Z", "author": {"login": "sabbey37"}, "path": "geode-core/src/main/java/org/apache/geode/internal/cache/PartitionedRegion.java", "diffHunk": "@@ -3395,11 +3399,10 @@ private InternalDistributedMember getNodeForBucketReadOrLoad(int bucketId) {\n    * @throws PrimaryBucketException if the remote bucket was not the primary\n    * @throws ForceReattemptException if the peer is no longer available\n    */\n+", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NjQ5MjExOA=="}, "originalCommit": {"oid": "4712d03186afc5909efaa15c0d1d7fb1ed533a3a"}, "originalPosition": 33}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzA0MzA0NjUxOnYy", "diffSide": "LEFT", "path": "geode-core/src/main/java/org/apache/geode/internal/cache/PartitionedRegion.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xMFQxNjo1MzozNFrOHP9JgA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xMFQxNzoxNDoyN1rOHP96lw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NjQ5MjU0NA==", "bodyText": "restore this comment; basically get this PR to the point that it does not modify PartitionedRegion.java", "url": "https://github.com/apache/geode/pull/5501#discussion_r486492544", "createdAt": "2020-09-10T16:53:34Z", "author": {"login": "dschneider-pivotal"}, "path": "geode-core/src/main/java/org/apache/geode/internal/cache/PartitionedRegion.java", "diffHunk": "@@ -3395,11 +3399,10 @@ private InternalDistributedMember getNodeForBucketReadOrLoad(int bucketId) {\n    * @throws PrimaryBucketException if the remote bucket was not the primary\n    * @throws ForceReattemptException if the peer is no longer available\n    */\n+\n   public boolean putRemotely(final DistributedMember recipient, final EntryEventImpl event,\n       boolean ifNew, boolean ifOld, Object expectedOldValue, boolean requireOldValue)\n       throws PrimaryBucketException, ForceReattemptException {\n-    // boolean forceAck = basicGetWriter() != null\n-    // || getDistributionAdvisor().adviseNetWrite().size() > 0;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "4712d03186afc5909efaa15c0d1d7fb1ed533a3a"}, "originalPosition": 38}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NjUwNTExMQ==", "bodyText": "updated", "url": "https://github.com/apache/geode/pull/5501#discussion_r486505111", "createdAt": "2020-09-10T17:14:27Z", "author": {"login": "sabbey37"}, "path": "geode-core/src/main/java/org/apache/geode/internal/cache/PartitionedRegion.java", "diffHunk": "@@ -3395,11 +3399,10 @@ private InternalDistributedMember getNodeForBucketReadOrLoad(int bucketId) {\n    * @throws PrimaryBucketException if the remote bucket was not the primary\n    * @throws ForceReattemptException if the peer is no longer available\n    */\n+\n   public boolean putRemotely(final DistributedMember recipient, final EntryEventImpl event,\n       boolean ifNew, boolean ifOld, Object expectedOldValue, boolean requireOldValue)\n       throws PrimaryBucketException, ForceReattemptException {\n-    // boolean forceAck = basicGetWriter() != null\n-    // || getDistributionAdvisor().adviseNetWrite().size() > 0;", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NjQ5MjU0NA=="}, "originalCommit": {"oid": "4712d03186afc5909efaa15c0d1d7fb1ed533a3a"}, "originalPosition": 38}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzA0MzA0ODYxOnYy", "diffSide": "LEFT", "path": "geode-core/src/main/java/org/apache/geode/internal/cache/LocalRegion.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xMFQxNjo1NDowNlrOHP9K4w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xMFQxNzoxNDozOFrOHP968Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NjQ5Mjg5OQ==", "bodyText": "put this blank line back so that this PR does not modify LocalRegion.java", "url": "https://github.com/apache/geode/pull/5501#discussion_r486492899", "createdAt": "2020-09-10T16:54:06Z", "author": {"login": "dschneider-pivotal"}, "path": "geode-core/src/main/java/org/apache/geode/internal/cache/LocalRegion.java", "diffHunk": "@@ -5718,7 +5718,6 @@ RegionEntry basicPutEntry(final EntryEventImpl event, final long lastModified)\n   @Override\n   public long basicPutPart2(EntryEventImpl event, RegionEntry entry, boolean isInitialized,\n       long lastModified, boolean clearConflict) {\n-", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "4712d03186afc5909efaa15c0d1d7fb1ed533a3a"}, "originalPosition": 4}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NjUwNTIwMQ==", "bodyText": "updated.", "url": "https://github.com/apache/geode/pull/5501#discussion_r486505201", "createdAt": "2020-09-10T17:14:38Z", "author": {"login": "sabbey37"}, "path": "geode-core/src/main/java/org/apache/geode/internal/cache/LocalRegion.java", "diffHunk": "@@ -5718,7 +5718,6 @@ RegionEntry basicPutEntry(final EntryEventImpl event, final long lastModified)\n   @Override\n   public long basicPutPart2(EntryEventImpl event, RegionEntry entry, boolean isInitialized,\n       long lastModified, boolean clearConflict) {\n-", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NjQ5Mjg5OQ=="}, "originalCommit": {"oid": "4712d03186afc5909efaa15c0d1d7fb1ed533a3a"}, "originalPosition": 4}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4784, "cost": 1, "resetAt": "2021-11-11T21:28:48Z"}}}