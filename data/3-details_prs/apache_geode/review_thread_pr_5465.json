{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDY5Njc0Nzg3", "number": 5465, "reviewThreads": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xOFQyMjoxMDoyMVrOEZrXCw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xOVQxNTo1NToyNlrOEaCrPw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjk1MzYwMjY3OnYy", "diffSide": "RIGHT", "path": "geode-core/src/test/java/org/apache/geode/internal/net/SocketCreatorJUnitTest.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xOFQyMjoxMDoyMVrOHCocSg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xOFQyMjo1ODoyNlrOHCpeyg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MjUyMTgwMg==", "bodyText": "Should we verify that it is called with a String[] only containing the \"someCipher\"?", "url": "https://github.com/apache/geode/pull/5465#discussion_r472521802", "createdAt": "2020-08-18T22:10:21Z", "author": {"login": "pivotal-jbarrett"}, "path": "geode-core/src/test/java/org/apache/geode/internal/net/SocketCreatorJUnitTest.java", "diffHunk": "@@ -98,6 +102,30 @@ private void testBindExceptionMessageFormatting(InetAddress inetAddress) throws\n     }\n   }\n \n+  @Test\n+  public void configureSSLEngine() {\n+    SSLConfig config = new SSLConfig.Builder().setCiphers(\"someCipher\").setEnabled(true)\n+        .setProtocols(\"someProtocol\").setRequireAuth(true).setKeystore(\"someKeystore.jks\")\n+        .setAlias(\"someAlias\").setTruststore(\"someTruststore.jks\")\n+        .setEndpointIdentificationEnabled(true).build();\n+    SSLContext context = mock(SSLContext.class);\n+    SSLParameters parameters = mock(SSLParameters.class);\n+\n+    SocketCreator socketCreator = new SocketCreator(config, context);\n+\n+    SSLEngine engine = mock(SSLEngine.class);\n+    when(engine.getSSLParameters()).thenReturn(parameters);\n+\n+    engine.setEnableSessionCreation(true);\n+    socketCreator.configureSSLEngine(engine, \"somehost\", 12345, true);\n+\n+    verify(engine).setUseClientMode(isA(Boolean.class));\n+    verify(engine).setSSLParameters(parameters);\n+    verify(engine).setEnabledCipherSuites(isA(String[].class));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "3d240a666801930cb54e2f9ccd5ed4fa2f2c7aad"}, "originalPosition": 50}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MjUzODgyNg==", "bodyText": "yes, I was being lazy there.  I've corrected that", "url": "https://github.com/apache/geode/pull/5465#discussion_r472538826", "createdAt": "2020-08-18T22:58:26Z", "author": {"login": "bschuchardt"}, "path": "geode-core/src/test/java/org/apache/geode/internal/net/SocketCreatorJUnitTest.java", "diffHunk": "@@ -98,6 +102,30 @@ private void testBindExceptionMessageFormatting(InetAddress inetAddress) throws\n     }\n   }\n \n+  @Test\n+  public void configureSSLEngine() {\n+    SSLConfig config = new SSLConfig.Builder().setCiphers(\"someCipher\").setEnabled(true)\n+        .setProtocols(\"someProtocol\").setRequireAuth(true).setKeystore(\"someKeystore.jks\")\n+        .setAlias(\"someAlias\").setTruststore(\"someTruststore.jks\")\n+        .setEndpointIdentificationEnabled(true).build();\n+    SSLContext context = mock(SSLContext.class);\n+    SSLParameters parameters = mock(SSLParameters.class);\n+\n+    SocketCreator socketCreator = new SocketCreator(config, context);\n+\n+    SSLEngine engine = mock(SSLEngine.class);\n+    when(engine.getSSLParameters()).thenReturn(parameters);\n+\n+    engine.setEnableSessionCreation(true);\n+    socketCreator.configureSSLEngine(engine, \"somehost\", 12345, true);\n+\n+    verify(engine).setUseClientMode(isA(Boolean.class));\n+    verify(engine).setSSLParameters(parameters);\n+    verify(engine).setEnabledCipherSuites(isA(String[].class));", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MjUyMTgwMg=="}, "originalCommit": {"oid": "3d240a666801930cb54e2f9ccd5ed4fa2f2c7aad"}, "originalPosition": 50}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjk1MzYwNDI5OnYy", "diffSide": "RIGHT", "path": "geode-core/src/test/java/org/apache/geode/internal/net/SocketCreatorJUnitTest.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xOFQyMjoxMTowMFrOHCodSw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xOFQyMjo1OTowNVrOHCpfiQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MjUyMjA1OQ==", "bodyText": "What about a test for \"any\"?", "url": "https://github.com/apache/geode/pull/5465#discussion_r472522059", "createdAt": "2020-08-18T22:11:00Z", "author": {"login": "pivotal-jbarrett"}, "path": "geode-core/src/test/java/org/apache/geode/internal/net/SocketCreatorJUnitTest.java", "diffHunk": "@@ -98,6 +102,30 @@ private void testBindExceptionMessageFormatting(InetAddress inetAddress) throws\n     }\n   }\n \n+  @Test\n+  public void configureSSLEngine() {\n+    SSLConfig config = new SSLConfig.Builder().setCiphers(\"someCipher\").setEnabled(true)", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "3d240a666801930cb54e2f9ccd5ed4fa2f2c7aad"}, "originalPosition": 33}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MjUzOTAxNw==", "bodyText": "Yes!  I'm having lots of \"fun\" with \"any\" this week and that's an excellent idea.", "url": "https://github.com/apache/geode/pull/5465#discussion_r472539017", "createdAt": "2020-08-18T22:59:05Z", "author": {"login": "bschuchardt"}, "path": "geode-core/src/test/java/org/apache/geode/internal/net/SocketCreatorJUnitTest.java", "diffHunk": "@@ -98,6 +102,30 @@ private void testBindExceptionMessageFormatting(InetAddress inetAddress) throws\n     }\n   }\n \n+  @Test\n+  public void configureSSLEngine() {\n+    SSLConfig config = new SSLConfig.Builder().setCiphers(\"someCipher\").setEnabled(true)", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MjUyMjA1OQ=="}, "originalCommit": {"oid": "3d240a666801930cb54e2f9ccd5ed4fa2f2c7aad"}, "originalPosition": 33}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjk1Mzc0NTY3OnYy", "diffSide": "RIGHT", "path": "geode-core/src/test/java/org/apache/geode/internal/net/SocketCreatorJUnitTest.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xOFQyMzoxMjo1MFrOHCpxGg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xOVQxNToyOTowMFrOHDM0ZA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MjU0MzUxNA==", "bodyText": "Are you familiar with ArgumentCaptors in Mokito? I find it to be more readable approach to the argument validation than doAnswer approach.\nhttps://javadoc.io/doc/org.mockito/mockito-core/latest/org/mockito/Mockito.html#verify-T-", "url": "https://github.com/apache/geode/pull/5465#discussion_r472543514", "createdAt": "2020-08-18T23:12:50Z", "author": {"login": "pivotal-jbarrett"}, "path": "geode-core/src/test/java/org/apache/geode/internal/net/SocketCreatorJUnitTest.java", "diffHunk": "@@ -98,6 +106,65 @@ private void testBindExceptionMessageFormatting(InetAddress inetAddress) throws\n     }\n   }\n \n+  @Test\n+  public void configureSSLEngine() {\n+    SSLConfig config = new SSLConfig.Builder().setCiphers(\"someCipher\").setEnabled(true)\n+        .setProtocols(\"someProtocol\").setRequireAuth(true).setKeystore(\"someKeystore.jks\")\n+        .setAlias(\"someAlias\").setTruststore(\"someTruststore.jks\")\n+        .setEndpointIdentificationEnabled(true).build();\n+    SSLContext context = mock(SSLContext.class);\n+    SSLParameters parameters = mock(SSLParameters.class);\n+\n+    SocketCreator socketCreator = new SocketCreator(config, context);\n+\n+    SSLEngine engine = mock(SSLEngine.class);\n+    when(engine.getSSLParameters()).thenReturn(parameters);\n+\n+    final Object[] setProtocols = new Object[1];\n+    doAnswer((Answer<Void>) invocation -> {\n+      setProtocols[0] = invocation.getArgument(0);\n+      return null;\n+    }).when(engine).setEnabledProtocols(any(String[].class));\n+\n+    final Object[] setCiphers = new Object[1];\n+    doAnswer((Answer<Void>) invocation -> {\n+      setCiphers[0] = invocation.getArgument(0);\n+      return null;\n+    }).when(engine).setEnabledCipherSuites(any(String[].class));\n+\n+    socketCreator.configureSSLEngine(engine, \"somehost\", 12345, true);\n+\n+    verify(engine).setUseClientMode(isA(Boolean.class));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ec4638eca502bea68894d5b6e694a0a88a6e5721"}, "originalPosition": 64}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MzExNzc5Ng==", "bodyText": "I was not familiar with ArgumentCaptor.  Much simpler.", "url": "https://github.com/apache/geode/pull/5465#discussion_r473117796", "createdAt": "2020-08-19T15:29:00Z", "author": {"login": "bschuchardt"}, "path": "geode-core/src/test/java/org/apache/geode/internal/net/SocketCreatorJUnitTest.java", "diffHunk": "@@ -98,6 +106,65 @@ private void testBindExceptionMessageFormatting(InetAddress inetAddress) throws\n     }\n   }\n \n+  @Test\n+  public void configureSSLEngine() {\n+    SSLConfig config = new SSLConfig.Builder().setCiphers(\"someCipher\").setEnabled(true)\n+        .setProtocols(\"someProtocol\").setRequireAuth(true).setKeystore(\"someKeystore.jks\")\n+        .setAlias(\"someAlias\").setTruststore(\"someTruststore.jks\")\n+        .setEndpointIdentificationEnabled(true).build();\n+    SSLContext context = mock(SSLContext.class);\n+    SSLParameters parameters = mock(SSLParameters.class);\n+\n+    SocketCreator socketCreator = new SocketCreator(config, context);\n+\n+    SSLEngine engine = mock(SSLEngine.class);\n+    when(engine.getSSLParameters()).thenReturn(parameters);\n+\n+    final Object[] setProtocols = new Object[1];\n+    doAnswer((Answer<Void>) invocation -> {\n+      setProtocols[0] = invocation.getArgument(0);\n+      return null;\n+    }).when(engine).setEnabledProtocols(any(String[].class));\n+\n+    final Object[] setCiphers = new Object[1];\n+    doAnswer((Answer<Void>) invocation -> {\n+      setCiphers[0] = invocation.getArgument(0);\n+      return null;\n+    }).when(engine).setEnabledCipherSuites(any(String[].class));\n+\n+    socketCreator.configureSSLEngine(engine, \"somehost\", 12345, true);\n+\n+    verify(engine).setUseClientMode(isA(Boolean.class));", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MjU0MzUxNA=="}, "originalCommit": {"oid": "ec4638eca502bea68894d5b6e694a0a88a6e5721"}, "originalPosition": 64}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjk1NzQyMjcxOnYy", "diffSide": "RIGHT", "path": "geode-core/src/test/java/org/apache/geode/internal/net/SocketCreatorJUnitTest.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xOVQxNTo1NToyNlrOHDN65g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xOVQxNzowODowNlrOHDRWbA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MzEzNTg0Ng==", "bodyText": "You will want separate captors for each of these and then assert the values.\nArgumentCaptor<String[]> enabledProtocols = ArgumentCaptor.forClass(String[].class);\nverify(engine).setEnabledProtocols(enabledProtocols.capture());\nassertThat(enabledProtocols.getValue()).containsExactly(\"someProtocol\");\n\nArgumentCaptor<String[]> enabledCipherSuites = ArgumentCaptor.forClass(String[].class);\nverify(engine). setEnabledCipherSuites(enabledCipherSuites.capture());\nassertThat(enabledCipherSuites.getValue()).containsExactly(\"someCipher\");", "url": "https://github.com/apache/geode/pull/5465#discussion_r473135846", "createdAt": "2020-08-19T15:55:26Z", "author": {"login": "pivotal-jbarrett"}, "path": "geode-core/src/test/java/org/apache/geode/internal/net/SocketCreatorJUnitTest.java", "diffHunk": "@@ -120,28 +117,14 @@ public void configureSSLEngine() {\n     SSLEngine engine = mock(SSLEngine.class);\n     when(engine.getSSLParameters()).thenReturn(parameters);\n \n-    final Object[] setProtocols = new Object[1];\n-    doAnswer((Answer<Void>) invocation -> {\n-      setProtocols[0] = invocation.getArgument(0);\n-      return null;\n-    }).when(engine).setEnabledProtocols(any(String[].class));\n-\n-    final Object[] setCiphers = new Object[1];\n-    doAnswer((Answer<Void>) invocation -> {\n-      setCiphers[0] = invocation.getArgument(0);\n-      return null;\n-    }).when(engine).setEnabledCipherSuites(any(String[].class));\n+    ArgumentCaptor<String[]> engineArgumentCaptor = ArgumentCaptor.forClass(String[].class);\n \n     socketCreator.configureSSLEngine(engine, \"somehost\", 12345, true);\n \n     verify(engine).setUseClientMode(isA(Boolean.class));\n     verify(engine).setSSLParameters(parameters);\n-    verify(engine).setEnabledCipherSuites(isA(String[].class));\n-    assertThat(setProtocols[0]).isNotNull();\n-    String[] protocolStrings = (String[]) setProtocols[0];\n-    assertThat(protocolStrings[0].equals(\"someProtocol\"));\n-    String[] cipherStrings = (String[]) setCiphers[0];\n-    assertThat(cipherStrings[0].equals(\"someCipher\"));\n+    verify(engine).setEnabledProtocols(engineArgumentCaptor.capture());\n+    verify(engine).setEnabledCipherSuites(engineArgumentCaptor.capture());", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c7b47b5fc3b383adbf04b87c4b82d27b9e330f83"}, "originalPosition": 49}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MzE5MjA0NA==", "bodyText": "The captor in this commit does capture both String[] values.  The first capture() returns the String[] with \"someProtocol\" and the second returns the String[] with \"someCipher\".  I'll add the content checks.", "url": "https://github.com/apache/geode/pull/5465#discussion_r473192044", "createdAt": "2020-08-19T17:08:06Z", "author": {"login": "bschuchardt"}, "path": "geode-core/src/test/java/org/apache/geode/internal/net/SocketCreatorJUnitTest.java", "diffHunk": "@@ -120,28 +117,14 @@ public void configureSSLEngine() {\n     SSLEngine engine = mock(SSLEngine.class);\n     when(engine.getSSLParameters()).thenReturn(parameters);\n \n-    final Object[] setProtocols = new Object[1];\n-    doAnswer((Answer<Void>) invocation -> {\n-      setProtocols[0] = invocation.getArgument(0);\n-      return null;\n-    }).when(engine).setEnabledProtocols(any(String[].class));\n-\n-    final Object[] setCiphers = new Object[1];\n-    doAnswer((Answer<Void>) invocation -> {\n-      setCiphers[0] = invocation.getArgument(0);\n-      return null;\n-    }).when(engine).setEnabledCipherSuites(any(String[].class));\n+    ArgumentCaptor<String[]> engineArgumentCaptor = ArgumentCaptor.forClass(String[].class);\n \n     socketCreator.configureSSLEngine(engine, \"somehost\", 12345, true);\n \n     verify(engine).setUseClientMode(isA(Boolean.class));\n     verify(engine).setSSLParameters(parameters);\n-    verify(engine).setEnabledCipherSuites(isA(String[].class));\n-    assertThat(setProtocols[0]).isNotNull();\n-    String[] protocolStrings = (String[]) setProtocols[0];\n-    assertThat(protocolStrings[0].equals(\"someProtocol\"));\n-    String[] cipherStrings = (String[]) setCiphers[0];\n-    assertThat(cipherStrings[0].equals(\"someCipher\"));\n+    verify(engine).setEnabledProtocols(engineArgumentCaptor.capture());\n+    verify(engine).setEnabledCipherSuites(engineArgumentCaptor.capture());", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MzEzNTg0Ng=="}, "originalCommit": {"oid": "c7b47b5fc3b383adbf04b87c4b82d27b9e330f83"}, "originalPosition": 49}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4746, "cost": 1, "resetAt": "2021-11-11T21:28:48Z"}}}