{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDEzNjM3NjAw", "number": 5054, "title": "GEODE-8071: Use daemon threads in RebalanceCommand", "bodyText": "Changed the ExecutorService within RebalanceCommand to use daemon\nthreads, otherwise the locator refuses to gracefully shutdown.\n\nFixed minor warnings.\nAdded distributed tests.\n\nThank you for submitting a contribution to Apache Geode.\nIn order to streamline the review of the contribution we ask you\nto ensure the following steps have been taken:\nFor all changes:\n\n\n Is there a JIRA ticket associated with this PR? Is it referenced in the commit message?\n\n\n Has your PR been rebased against the latest commit within the target branch (typically develop)?\n\n\n Is your initial contribution a single, squashed commit?\n\n\n Does gradlew build run cleanly?\n\n\n Have you written or updated unit tests to verify your changes?\n\n\n If adding new dependencies to the code, are these dependencies licensed in a way that is compatible for inclusion under ASF 2.0?\n\n\nNote:\nPlease ensure that once the PR is submitted, check Concourse for build issues and\nsubmit an update to your PR as soon as possible. If you need help, please send an\nemail to dev@geode.apache.org.", "createdAt": "2020-05-05T16:56:19Z", "url": "https://github.com/apache/geode/pull/5054", "merged": true, "mergeCommit": {"oid": "d8e86cb720c054b154a16cc88fee88e73db709f3"}, "closed": true, "closedAt": "2020-05-06T11:37:11Z", "author": {"login": "jujoramos"}, "timelineItems": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABceWiJQgH2gAyNDEzNjM3NjAwOmZlYjA1MmU3MWNlZTEyYTVlN2EyY2E3MjgwOWY5YWQwN2E5MDhlNDQ=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcekkZigH2gAyNDEzNjM3NjAwOmFlNThlOGU0NzdlZDYzZWRmNTI0YTdiZWY3YWE3NTYwNzg0ZTY4Zjg=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "feb052e71cee12a5e7a2ca72809f9ad07a908e44", "author": {"user": {"login": "jujoramos", "name": "Juan Jos\u00e9 Ramos"}}, "url": "https://github.com/apache/geode/commit/feb052e71cee12a5e7a2ca72809f9ad07a908e44", "committedDate": "2020-05-05T16:19:01Z", "message": "GEODE-8071: Refactor RebalanceCommandDistributedTest."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "bd481554d8add576c885c675c2350474eb398939", "author": {"user": {"login": "jujoramos", "name": "Juan Jos\u00e9 Ramos"}}, "url": "https://github.com/apache/geode/commit/bd481554d8add576c885c675c2350474eb398939", "committedDate": "2020-05-05T16:53:13Z", "message": "GEODE-8071: Use daemon threads in RebalanceCommand\n\nChanged the ExecutorService within RebalanceCommand to use daemon\nthreads, otherwise the locator refuses to gracefully shutdown.\n\n- Fixed minor warnings.\n- Added distributed tests."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDA2MDEyMDU2", "url": "https://github.com/apache/geode/pull/5054#pullrequestreview-406012056", "createdAt": "2020-05-05T17:38:58Z", "commit": {"oid": "feb052e71cee12a5e7a2ca72809f9ad07a908e44"}, "state": "APPROVED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wNVQxNzozODo1OFrOGQ0aog==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wNVQxNzozODo1OFrOGQ0aog==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMDI4OTE4Ng==", "bodyText": "Could the ints added to the keys and values be cleared up a bit? There doesn't seem to be any reason to add 200 to them here, and if the number of entries is extracted to a constant, then it can be used in the invocation on server2 to prevent overwriting the existing data.", "url": "https://github.com/apache/geode/pull/5054#discussion_r420289186", "createdAt": "2020-05-05T17:38:58Z", "author": {"login": "DonalEvans"}, "path": "geode-dunit/src/main/java/org/apache/geode/management/internal/cli/commands/RebalanceCommandDistributedTest.java", "diffHunk": "@@ -35,40 +37,91 @@\n import org.apache.geode.test.dunit.rules.MemberVM;\n import org.apache.geode.test.junit.assertions.TabularResultModelAssert;\n import org.apache.geode.test.junit.rules.GfshCommandRule;\n+import org.apache.geode.test.junit.rules.MemberStarterRule;\n+\n+@RunWith(Parameterized.class)\n+public class RebalanceCommandDistributedTest {\n+  private static final String REGION_ONE_NAME = \"region-1\";\n+  private static final String REGION_TWO_NAME = \"region-2\";\n+  private static final String REGION_THREE_NAME = \"region-3\";\n+\n+  @Rule\n+  public GfshCommandRule gfsh = new GfshCommandRule();\n+\n+  @Rule\n+  public ClusterStartupRule cluster = new ClusterStartupRule();\n \n-@SuppressWarnings(\"serial\")\n-public class RebalanceCommandDistributedTestBase {\n+  protected MemberVM locator, server1, server2;\n \n-  @ClassRule\n-  public static ClusterStartupRule cluster = new ClusterStartupRule();\n+  @Parameterized.Parameters(name = \"ConnectionType:{0}\")\n+  public static GfshCommandRule.PortType[] connectionTypes() {\n+    return new GfshCommandRule.PortType[] {http, jmxManager};\n+  }\n \n-  @ClassRule\n-  public static GfshCommandRule gfsh = new GfshCommandRule();\n+  @Parameterized.Parameter\n+  public static GfshCommandRule.PortType portType;\n \n-  protected static MemberVM locator, server1, server2, server3;\n+  private void setUpRegions() {\n+    server1.invoke(() -> {\n+      Cache cache = ClusterStartupRule.getCache();\n+      assertThat(cache).isNotNull();\n+      RegionFactory<String, String> dataRegionFactory =\n+          cache.createRegionFactory(RegionShortcut.PARTITION);\n+      Region<String, String> region = dataRegionFactory.create(REGION_ONE_NAME);\n+      for (int i = 0; i < 10; i++) {\n+        region.put(\"key\" + (i + 200), \"value\" + (i + 200));\n+      }\n+      region = dataRegionFactory.create(REGION_TWO_NAME);\n+      for (int i = 0; i < 100; i++) {\n+        region.put(\"key\" + (i + 200), \"value\" + (i + 200));\n+      }", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "feb052e71cee12a5e7a2ca72809f9ad07a908e44"}, "originalPosition": 71}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ae58e8e477ed63edf524a7bef7aa7560784e68f8", "author": {"user": {"login": "jujoramos", "name": "Juan Jos\u00e9 Ramos"}}, "url": "https://github.com/apache/geode/commit/ae58e8e477ed63edf524a7bef7aa7560784e68f8", "committedDate": "2020-05-06T08:40:09Z", "message": "GEODE-8071: Changes requested by reviewers."}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4680, "cost": 1, "resetAt": "2021-10-29T19:57:52Z"}}}