{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDIwMjA2MzY0", "number": 5132, "title": "GEODE-8131: reader thread blocked attempting to issue an alert", "bodyText": "This PR does not solve the problem of the alert system causing a P2P\nmessage reader to block but instead ensures that the reader thread will\nwrite deserialization information to the log before issuing a fatal\nalert.  If the alert level is set to \"info\" this won't help, but no-one\nwould set the alert level to that level.\nAlong the way I removed some duplicate strings.\nThank you for submitting a contribution to Apache Geode.\nIn order to streamline the review of the contribution we ask you\nto ensure the following steps have been taken:\nFor all changes:\n\n\n Is there a JIRA ticket associated with this PR? Is it referenced in the commit message?\n\n\n Has your PR been rebased against the latest commit within the target branch (typically develop)?\n\n\n Is your initial contribution a single, squashed commit?\n\n\n Does gradlew build run cleanly?\n\n\n Have you written or updated unit tests to verify your changes?\n\n\n If adding new dependencies to the code, are these dependencies licensed in a way that is compatible for inclusion under ASF 2.0?\n\n\nNote:\nPlease ensure that once the PR is submitted, check Concourse for build issues and\nsubmit an update to your PR as soon as possible. If you need help, please send an\nemail to dev@geode.apache.org.", "createdAt": "2020-05-19T15:47:25Z", "url": "https://github.com/apache/geode/pull/5132", "merged": true, "mergeCommit": {"oid": "358fd7067cc56b1ceb8c3d7c271c3a5254d7ee93"}, "closed": true, "closedAt": "2020-05-21T21:19:38Z", "author": {"login": "bschuchardt"}, "timelineItems": {"totalCount": 6, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABci2aO3AH2gAyNDIwMjA2MzY0OjNkYjVhNGNhNWM4MDg2NTY3ZmIzZjYzYmE4NzNiNTNlZWMzNzVlYjY=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcjiX0MgFqTQxNjQwNzY1Mg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "3db5a4ca5c8086567fb3f63ba873b53eec375eb6", "author": {"user": {"login": "bschuchardt", "name": "Bruce Schuchardt"}}, "url": "https://github.com/apache/geode/commit/3db5a4ca5c8086567fb3f63ba873b53eec375eb6", "committedDate": "2020-05-19T15:43:02Z", "message": "GEODE-8131: reader thread blocked attempting to issue an alert\n\nThis PR does not solve the problem of the alert system causing a P2P\nmessage reader to block but instead ensures that the reader thread will\nwrite deserialization information to the log before issuing a fatal\nalert.  If the alert level is set to \"info\" this won't help, but no-one\nwould set the alert level to that level.\n\nAlong the way I removed some duplicate strings."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDE0NjY1ODEx", "url": "https://github.com/apache/geode/pull/5132#pullrequestreview-414665811", "createdAt": "2020-05-19T17:24:39Z", "commit": {"oid": "3db5a4ca5c8086567fb3f63ba873b53eec375eb6"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDE0ODY4MTc3", "url": "https://github.com/apache/geode/pull/5132#pullrequestreview-414868177", "createdAt": "2020-05-19T22:29:28Z", "commit": {"oid": "3db5a4ca5c8086567fb3f63ba873b53eec375eb6"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDE1NTIwOTQ3", "url": "https://github.com/apache/geode/pull/5132#pullrequestreview-415520947", "createdAt": "2020-05-20T16:37:55Z", "commit": {"oid": "3db5a4ca5c8086567fb3f63ba873b53eec375eb6"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yMFQxNjozNzo1NVrOGYUdFA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yMFQxNjozODo0OFrOGYUgOQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyODE1NDEzMg==", "bodyText": "Instead of repeating this code in three places, comment-and-all, it would be better to have the three sites call a new method e.g. logFatal(\u2026). The method could have a block comment telling about what it's contract is etc.", "url": "https://github.com/apache/geode/pull/5132#discussion_r428154132", "createdAt": "2020-05-20T16:37:55Z", "author": {"login": "Bill"}, "path": "geode-core/src/main/java/org/apache/geode/internal/tcp/Connection.java", "diffHunk": "@@ -3054,7 +3058,9 @@ private void readMessage(ByteBuffer peerDataBuffer) {\n         failureMsg = \"Unexpected failure deserializing message\";\n         failureEx = ex;\n         rpId = md.getRPid();\n-        logger.fatal(\"Unexpected failure deserializing message\", failureEx);\n+        // log at info level first in case fatal-level alert notification becomes blocked\n+        logger.info(failureMsg, failureEx);\n+        logger.fatal(failureMsg, failureEx);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "3db5a4ca5c8086567fb3f63ba873b53eec375eb6"}, "originalPosition": 27}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyODE1NDkzNw==", "bodyText": "why is toString() called explicitly in this case but not in the other two?", "url": "https://github.com/apache/geode/pull/5132#discussion_r428154937", "createdAt": "2020-05-20T16:38:48Z", "author": {"login": "Bill"}, "path": "geode-core/src/main/java/org/apache/geode/internal/tcp/Connection.java", "diffHunk": "@@ -3027,13 +3027,17 @@ private void readMessage(ByteBuffer peerDataBuffer) {\n         failureMsg = \"ClassNotFound deserializing message\";\n         failureEx = ex;\n         rpId = md.getRPid();\n-        logger.fatal(\"ClassNotFound deserializing message: {}\", ex.toString());\n+        // log at info level first in case fatal-level alert notification becomes blocked\n+        logger.info(failureMsg, failureEx);\n+        logger.fatal(failureMsg, failureEx.toString());", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "3db5a4ca5c8086567fb3f63ba873b53eec375eb6"}, "originalPosition": 7}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "cd6d5d67c635754c6377ab80ac3eba341ce4f166", "author": {"user": {"login": "bschuchardt", "name": "Bruce Schuchardt"}}, "url": "https://github.com/apache/geode/commit/cd6d5d67c635754c6377ab80ac3eba341ce4f166", "committedDate": "2020-05-21T17:03:32Z", "message": "removing duplicate code & logging toString of exceptions at fatal-level"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDE2NDA3NjUy", "url": "https://github.com/apache/geode/pull/5132#pullrequestreview-416407652", "createdAt": "2020-05-21T18:56:13Z", "commit": {"oid": "cd6d5d67c635754c6377ab80ac3eba341ce4f166"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4555, "cost": 1, "resetAt": "2021-10-29T19:57:52Z"}}}