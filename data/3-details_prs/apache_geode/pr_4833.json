{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0MzkxNzI4NTM2", "number": 4833, "title": "Feature/geode 6536 2: Added retry in borrowConnection/single hop", "bodyText": "Thank you for submitting a contribution to Apache Geode.\nIn order to streamline the review of the contribution we ask you\nto ensure the following steps have been taken:\nFor all changes:\n\n\n[*] Is there a JIRA ticket associated with this PR? Is it referenced in the commit message?\n\n\n[*] Has your PR been rebased against the latest commit within the target branch (typically develop)?\n\n\n[*] Is your initial contribution a single, squashed commit?\n\n\n[*] Does gradlew build run cleanly?\n\n\n[*] Have you written or updated unit tests to verify your changes?\n\n\n If adding new dependencies to the code, are these dependencies licensed in a way that is compatible for inclusion under ASF 2.0?\n\n\nNote:\nPlease ensure that once the PR is submitted, check Concourse for build issues and\nsubmit an update to your PR as soon as possible. If you need help, please send an\nemail to dev@geode.apache.org.", "createdAt": "2020-03-20T20:31:51Z", "url": "https://github.com/apache/geode/pull/4833", "merged": true, "mergeCommit": {"oid": "b021b127867d1e01e09fac26de10d29f896ed7dc"}, "closed": true, "closedAt": "2020-03-30T19:54:36Z", "author": {"login": "mivanac"}, "timelineItems": {"totalCount": 18, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcPy2w6gBqjMxNTE2Mzc0NzU=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcSzeVwgFqTM4NDE1MzkzOQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "11d36080adf10f1cf0eef3b389ec22b90715e46e", "author": {"user": {"login": "mivanac", "name": "Mario Ivanac"}}, "url": "https://github.com/apache/geode/commit/11d36080adf10f1cf0eef3b389ec22b90715e46e", "committedDate": "2020-03-20T20:24:22Z", "message": "GEODE-6536_2: change exception type"}, "afterCommit": {"oid": "e8d53f154be335cf2e6e5c0fecbc0748bf393c8f", "author": {"user": {"login": "mivanac", "name": "Mario Ivanac"}}, "url": "https://github.com/apache/geode/commit/e8d53f154be335cf2e6e5c0fecbc0748bf393c8f", "committedDate": "2020-03-21T10:15:35Z", "message": "GEODE-6536_2: change exception type"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "e8d53f154be335cf2e6e5c0fecbc0748bf393c8f", "author": {"user": {"login": "mivanac", "name": "Mario Ivanac"}}, "url": "https://github.com/apache/geode/commit/e8d53f154be335cf2e6e5c0fecbc0748bf393c8f", "committedDate": "2020-03-21T10:15:35Z", "message": "GEODE-6536_2: change exception type"}, "afterCommit": {"oid": "50f187f767534fd9936e39de88c3ec83bbc4e01b", "author": {"user": {"login": "mivanac", "name": "Mario Ivanac"}}, "url": "https://github.com/apache/geode/commit/50f187f767534fd9936e39de88c3ec83bbc4e01b", "committedDate": "2020-03-21T11:13:41Z", "message": "GEODE-6536_2: change exception type"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "50f187f767534fd9936e39de88c3ec83bbc4e01b", "author": {"user": {"login": "mivanac", "name": "Mario Ivanac"}}, "url": "https://github.com/apache/geode/commit/50f187f767534fd9936e39de88c3ec83bbc4e01b", "committedDate": "2020-03-21T11:13:41Z", "message": "GEODE-6536_2: change exception type"}, "afterCommit": {"oid": "0203011644e708bd3d8d8b6a3dc550638f357102", "author": {"user": {"login": "mivanac", "name": "Mario Ivanac"}}, "url": "https://github.com/apache/geode/commit/0203011644e708bd3d8d8b6a3dc550638f357102", "committedDate": "2020-03-21T12:31:05Z", "message": "GEODE-6536_2: change exception type"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzc5NzM1MTA3", "url": "https://github.com/apache/geode/pull/4833#pullrequestreview-379735107", "createdAt": "2020-03-23T19:05:11Z", "commit": {"oid": "0203011644e708bd3d8d8b6a3dc550638f357102"}, "state": "COMMENTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yM1QxOTowNToxMVrOF6UBiw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yM1QxOToxNzo1NFrOF6Ucxg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NjY4OTgwMw==", "bodyText": "Sorry, if i missed this in earlier comments. The \"onlyUseExistingCnx\" indicates no new connection to be created, by the time this gets checked, a create connection attempt will be made if \"tryCreate\" is true (above logic).\nIt seems right to keep the condition check as If(onlyUseExistingCnx) { throw new AllConnectionsInUseException();} if there are no connection to this server available, the exception may be handled differently based on the caller.", "url": "https://github.com/apache/geode/pull/4833#discussion_r396689803", "createdAt": "2020-03-23T19:05:11Z", "author": {"login": "agingade"}, "path": "geode-core/src/main/java/org/apache/geode/cache/client/internal/pooling/ConnectionManagerImpl.java", "diffHunk": "@@ -338,6 +335,10 @@ public PooledConnection borrowConnection(ServerLocation server, long acquireTime\n               }\n             }\n           }\n+          if (null != connection) {\n+            return connection;\n+          }\n+          throw new ServerConnectivityException(BORROW_CONN_ERROR_MSG + server);\n         }\n \n         if (!onlyUseExistingCnx) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "0203011644e708bd3d8d8b6a3dc550638f357102"}, "originalPosition": 24}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NjY5Njc3NA==", "bodyText": "If the tryCreate() is true, and for any reason, unable to create connection, it should be in the loop till the specified timeout (server-timeout), right? throwing an exception here will return before the specified wait time.", "url": "https://github.com/apache/geode/pull/4833#discussion_r396696774", "createdAt": "2020-03-23T19:17:54Z", "author": {"login": "agingade"}, "path": "geode-core/src/main/java/org/apache/geode/cache/client/internal/pooling/ConnectionManagerImpl.java", "diffHunk": "@@ -338,6 +335,10 @@ public PooledConnection borrowConnection(ServerLocation server, long acquireTime\n               }\n             }\n           }\n+          if (null != connection) {\n+            return connection;\n+          }\n+          throw new ServerConnectivityException(BORROW_CONN_ERROR_MSG + server);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "0203011644e708bd3d8d8b6a3dc550638f357102"}, "originalPosition": 21}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "333f2111c2635909fefc136912c3fb8996deb1af", "author": {"user": {"login": "mivanac", "name": "Mario Ivanac"}}, "url": "https://github.com/apache/geode/commit/333f2111c2635909fefc136912c3fb8996deb1af", "committedDate": "2020-03-24T17:18:31Z", "message": "GEODE-6536: Added retry in borrowConnection/single hop"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "7766e7ca8d53ca222029c2d572bd06ccc47d0aba", "author": {"user": {"login": "mivanac", "name": "Mario Ivanac"}}, "url": "https://github.com/apache/geode/commit/7766e7ca8d53ca222029c2d572bd06ccc47d0aba", "committedDate": "2020-03-24T17:18:31Z", "message": "GEODE-6536: bug fix"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d3cdfe15bdbbb979e0b44aeebeab121f0be3868a", "author": {"user": {"login": "mivanac", "name": "Mario Ivanac"}}, "url": "https://github.com/apache/geode/commit/d3cdfe15bdbbb979e0b44aeebeab121f0be3868a", "committedDate": "2020-03-24T17:18:31Z", "message": "GEODE-6536: update after comments"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "0f7ae5a32168ebc0110cdeb15ff141dca4974ee3", "author": {"user": {"login": "mivanac", "name": "Mario Ivanac"}}, "url": "https://github.com/apache/geode/commit/0f7ae5a32168ebc0110cdeb15ff141dca4974ee3", "committedDate": "2020-03-24T17:18:31Z", "message": "GEODE-6536: modify borrowConnection singleHop solution"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "82799d8f6d8987136502f2aecd1102207469a1e0", "author": {"user": {"login": "mivanac", "name": "Mario Ivanac"}}, "url": "https://github.com/apache/geode/commit/82799d8f6d8987136502f2aecd1102207469a1e0", "committedDate": "2020-03-24T17:18:31Z", "message": "GEODE-6536: test update"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "52139beae6e873350c719cefbac635f4e20e2e5a", "author": {"user": {"login": "mivanac", "name": "Mario Ivanac"}}, "url": "https://github.com/apache/geode/commit/52139beae6e873350c719cefbac635f4e20e2e5a", "committedDate": "2020-03-24T17:18:31Z", "message": "GEODE-6536: updated tests, and added parameter to desable timeout"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f3a7ac37b78cf9ad60597d041da8c8c62b45644f", "author": {"user": {"login": "mivanac", "name": "Mario Ivanac"}}, "url": "https://github.com/apache/geode/commit/f3a7ac37b78cf9ad60597d041da8c8c62b45644f", "committedDate": "2020-03-24T17:18:31Z", "message": "GEODE-6536: update of cachexml impacts"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a0f60e1d91541060553f23f6b6777d08c8469d1a", "author": {"user": {"login": "mivanac", "name": "Mario Ivanac"}}, "url": "https://github.com/apache/geode/commit/a0f60e1d91541060553f23f6b6777d08c8469d1a", "committedDate": "2020-03-24T17:18:31Z", "message": "GEODE-6536: remove cachexml restriction"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ca9fefeac72fa3ab169115f59333171357a1b0f9", "author": {"user": {"login": "mivanac", "name": "Mario Ivanac"}}, "url": "https://github.com/apache/geode/commit/ca9fefeac72fa3ab169115f59333171357a1b0f9", "committedDate": "2020-03-24T17:18:31Z", "message": "GEODE-6536: update default value and documentation"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "76ca09d568bbcd48abbcea2153e475aae93e89ce", "author": {"user": {"login": "mivanac", "name": "Mario Ivanac"}}, "url": "https://github.com/apache/geode/commit/76ca09d568bbcd48abbcea2153e475aae93e89ce", "committedDate": "2020-03-24T17:18:31Z", "message": "GEODE-6536_2: change exception type"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "6466ca8abbd2dd1e28c35cd276c607ef0365a283", "author": {"user": {"login": "mivanac", "name": "Mario Ivanac"}}, "url": "https://github.com/apache/geode/commit/6466ca8abbd2dd1e28c35cd276c607ef0365a283", "committedDate": "2020-03-24T17:18:31Z", "message": "GEODE-6536_2: seize new connection only in case onlyUseExistingCnx=false"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "0203011644e708bd3d8d8b6a3dc550638f357102", "author": {"user": {"login": "mivanac", "name": "Mario Ivanac"}}, "url": "https://github.com/apache/geode/commit/0203011644e708bd3d8d8b6a3dc550638f357102", "committedDate": "2020-03-21T12:31:05Z", "message": "GEODE-6536_2: change exception type"}, "afterCommit": {"oid": "6466ca8abbd2dd1e28c35cd276c607ef0365a283", "author": {"user": {"login": "mivanac", "name": "Mario Ivanac"}}, "url": "https://github.com/apache/geode/commit/6466ca8abbd2dd1e28c35cd276c607ef0365a283", "committedDate": "2020-03-24T17:18:31Z", "message": "GEODE-6536_2: seize new connection only in case onlyUseExistingCnx=false"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzgzODQwNTE5", "url": "https://github.com/apache/geode/pull/4833#pullrequestreview-383840519", "createdAt": "2020-03-30T13:15:21Z", "commit": {"oid": "6466ca8abbd2dd1e28c35cd276c607ef0365a283"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzg0MTUzOTM5", "url": "https://github.com/apache/geode/pull/4833#pullrequestreview-384153939", "createdAt": "2020-03-30T19:15:01Z", "commit": {"oid": "6466ca8abbd2dd1e28c35cd276c607ef0365a283"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4898, "cost": 1, "resetAt": "2021-10-29T19:57:52Z"}}}