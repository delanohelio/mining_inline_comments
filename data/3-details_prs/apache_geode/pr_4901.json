{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0Mzk3ODcxMzk5", "number": 4901, "title": "GEODE-7938: added keys query param to GET, PUT, and DELETE /{region} endpoints", "bodyText": "The previous fix did not handle initial slashes (see GEODE-7938).\nSo now we have a new queryParam \"?keys=\" that can be used in place of the old {keys} pathVar.\nThe new queryParam expects its keys to be encoded with UTF-8.\nThe previous fixes \"/**\" has been removed since it did harm to swagger.\nThank you for submitting a contribution to Apache Geode.\nIn order to streamline the review of the contribution we ask you\nto ensure the following steps have been taken:\nFor all changes:\n\n\n Is there a JIRA ticket associated with this PR? Is it referenced in the commit message?\n\n\n Has your PR been rebased against the latest commit within the target branch (typically develop)?\n\n\n Is your initial contribution a single, squashed commit?\n\n\n Does gradlew build run cleanly?\n\n\n Have you written or updated unit tests to verify your changes?\n\n\n If adding new dependencies to the code, are these dependencies licensed in a way that is compatible for inclusion under ASF 2.0?\n\n\nNote:\nPlease ensure that once the PR is submitted, check Concourse for build issues and\nsubmit an update to your PR as soon as possible. If you need help, please send an\nemail to dev@geode.apache.org.", "createdAt": "2020-04-03T00:18:44Z", "url": "https://github.com/apache/geode/pull/4901", "merged": true, "mergeCommit": {"oid": "6263f1f9a4782433d013c6b759bda8c84216b595"}, "closed": true, "closedAt": "2020-04-08T15:13:02Z", "author": {"login": "dschneider-pivotal"}, "timelineItems": {"totalCount": 10, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcT1lpeAH2gAyMzk3ODcxMzk5OjM3ODQ2YTIxYTA1ZDcyMjJlMWQwYTRhYzg5ZjM5Yjg5MzE3Nzg1YzY=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcVcNs8AH2gAyMzk3ODcxMzk5OmExYzJkNDVkNmFlZmU3OWMzMGFiNTU3Nzg5YjQzZjc3ODUzYjdiYWE=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "37846a21a05d7222e1d0a4ac89f39b89317785c6", "author": {"user": {"login": "dschneider-pivotal", "name": "Darrel Schneider"}}, "url": "https://github.com/apache/geode/commit/37846a21a05d7222e1d0a4ac89f39b89317785c6", "committedDate": "2020-04-03T00:16:44Z", "message": "added keys query param to GET, PUT, and DELETE /{region} endpoints"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "df3e53a6047cccbf82ff2d23213d6e8caa409ce9", "author": {"user": {"login": "dschneider-pivotal", "name": "Darrel Schneider"}}, "url": "https://github.com/apache/geode/commit/df3e53a6047cccbf82ff2d23213d6e8caa409ce9", "committedDate": "2020-04-04T00:36:09Z", "message": "WIP: need more testing of new endpoints\nneed to test that region name encoding is correct\nneed to verify the Content-Location is correct"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "676ae358960159f374e6ef41b64f1124b150ff62", "author": {"user": {"login": "dschneider-pivotal", "name": "Darrel Schneider"}}, "url": "https://github.com/apache/geode/commit/676ae358960159f374e6ef41b64f1124b150ff62", "committedDate": "2020-04-06T23:39:39Z", "message": "* when getting multiple keys, results are now ordered as the request was ordered\n* the code that tests for missing keys now uses the getAll result instead of sending multiple messsages and having a race in which key is deleted after the old check but before getAll\n* the Content-Location is now set correctly when doing a get with encoded keys\n* added more tests for better coverage of the PdxBasedCrudController."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "fdd541bf587938ee3a926835bcbb4fe24278e1bb", "author": {"user": {"login": "dschneider-pivotal", "name": "Darrel Schneider"}}, "url": "https://github.com/apache/geode/commit/fdd541bf587938ee3a926835bcbb4fe24278e1bb", "committedDate": "2020-04-06T23:59:54Z", "message": "cleaned up swagger notes"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzg4Njk2NTg3", "url": "https://github.com/apache/geode/pull/4901#pullrequestreview-388696587", "createdAt": "2020-04-06T23:54:29Z", "commit": {"oid": "676ae358960159f374e6ef41b64f1124b150ff62"}, "state": "APPROVED", "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wNlQyMzo1NDozMFrOGBuGHg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wN1QwMDowMjo0OFrOGBuQMA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNDQ1Njk5MA==", "bodyText": "This is less noisy and reads better:\nimport static org.hamcrest.Matchers.startsWith;\n...\nstartsWith(BASE_URL + \"/customers/\")", "url": "https://github.com/apache/geode/pull/4901#discussion_r404456990", "createdAt": "2020-04-06T23:54:30Z", "author": {"login": "demery-pivotal"}, "path": "geode-web-api/src/integrationTest/java/org/apache/geode/rest/internal/web/controllers/RestAccessControllerTest.java", "diffHunk": "@@ -620,11 +639,13 @@ public void postRegions() throws Exception {\n   @SuppressWarnings(\"unchecked\")\n   @Test\n   @WithMockUser\n-  public void getCustomers() throws Exception {\n+  public void getAllCustomers() throws Exception {\n     putAll();\n     mockMvc.perform(get(\"/v1/customers?limit=ALL\")\n         .with(POST_PROCESSOR))\n         .andExpect(status().isOk())\n+        .andExpect(\n+            header().string(\"Content-Location\", new StringStartsWith(BASE_URL + \"/customers/\")))", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "676ae358960159f374e6ef41b64f1124b150ff62"}, "originalPosition": 236}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNDQ1ODc5Mg==", "bodyText": "I think you can use AssertJ's Map assertions on regions:\nassertThat(customerRegion)\n    .hasSize(60)\n    .containsKeys(\"2\", \"3\", \"4\", \"5\");\n\nThis will make the assertion failures more helpful.", "url": "https://github.com/apache/geode/pull/4901#discussion_r404458792", "createdAt": "2020-04-07T00:00:07Z", "author": {"login": "demery-pivotal"}, "path": "geode-web-api/src/integrationTest/java/org/apache/geode/rest/internal/web/controllers/RestAccessControllerTest.java", "diffHunk": "@@ -740,12 +889,76 @@ public void deleteMultipleKeys() throws Exception {\n \n   @Test\n   @WithMockUser\n-  public void deleteMultipleKeysWithSlashes() throws Exception {\n-    putAllWithSlashes();\n-    mockMvc.perform(delete(\"/v1/customers/1\" + SLASH + \",2\" + SLASH + \",3\"\n-        + SLASH + \",4\" + SLASH + \",5\" + SLASH)\n-            .with(POST_PROCESSOR))\n+  public void deleteMultipleKeysWithQueryParam() throws Exception {\n+    putAll();\n+    assertThat(customerRegion.size()).isEqualTo(60);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "676ae358960159f374e6ef41b64f1124b150ff62"}, "originalPosition": 424}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNDQ1OTU2OA==", "bodyText": "I like the helper methods. They keep the test methods clean and focused.", "url": "https://github.com/apache/geode/pull/4901#discussion_r404459568", "createdAt": "2020-04-07T00:02:48Z", "author": {"login": "demery-pivotal"}, "path": "geode-web-api/src/integrationTest/java/org/apache/geode/rest/internal/web/controllers/RestAccessControllerTest.java", "diffHunk": "@@ -110,6 +118,30 @@\n   private static Region<?, ?> orderRegion;\n   private static Region<String, PdxInstance> customerRegion;\n \n+  private static String createKey(int keyNumber) {\n+    return KEY_PREFIX + \"KEY\" + Integer.toString(keyNumber) + KEY_SUFFIX;\n+  }\n+\n+  private static String createEncodedKey(int keyNumber) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "676ae358960159f374e6ef41b64f1124b150ff62"}, "originalPosition": 46}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzg5MTg2ODkx", "url": "https://github.com/apache/geode/pull/4901#pullrequestreview-389186891", "createdAt": "2020-04-07T14:42:27Z", "commit": {"oid": "fdd541bf587938ee3a926835bcbb4fe24278e1bb"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzg5NTI5NDgw", "url": "https://github.com/apache/geode/pull/4901#pullrequestreview-389529480", "createdAt": "2020-04-07T22:17:24Z", "commit": {"oid": "fdd541bf587938ee3a926835bcbb4fe24278e1bb"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "82efbd1ad63ff8dfccb1196a80f92ea891d1d659", "author": {"user": {"login": "dschneider-pivotal", "name": "Darrel Schneider"}}, "url": "https://github.com/apache/geode/commit/82efbd1ad63ff8dfccb1196a80f92ea891d1d659", "committedDate": "2020-04-07T23:36:56Z", "message": "Added endpoint for PUT {region}?keys=encodedKey&op=CREATE.\nThis allows users to create entries that have an encodedKey."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c8d8916d2a4b354e5e55666e9f7fce2af33f9be4", "author": {"user": {"login": "dschneider-pivotal", "name": "Darrel Schneider"}}, "url": "https://github.com/apache/geode/commit/c8d8916d2a4b354e5e55666e9f7fce2af33f9be4", "committedDate": "2020-04-07T23:44:06Z", "message": "changed test to use startsWith"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a1c2d45d6aefe79c30ab557789b43f77853b7baa", "author": {"user": {"login": "dschneider-pivotal", "name": "Darrel Schneider"}}, "url": "https://github.com/apache/geode/commit/a1c2d45d6aefe79c30ab557789b43f77853b7baa", "committedDate": "2020-04-07T23:50:48Z", "message": "test now uses hasSize"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4739, "cost": 1, "resetAt": "2021-10-29T19:57:52Z"}}}