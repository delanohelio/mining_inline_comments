{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0MzgyMDc2Mjg3", "number": 4751, "title": "GEODE-7727: modify sender thread to detect relese of connection", "bodyText": "Thank you for submitting a contribution to Apache Geode.\nIn order to streamline the review of the contribution we ask you\nto ensure the following steps have been taken:\nFor all changes:\n\n\n[*] Is there a JIRA ticket associated with this PR? Is it referenced in the commit message?\n\n\n[*] Has your PR been rebased against the latest commit within the target branch (typically develop)?\n\n\n[*] Is your initial contribution a single, squashed commit?\n\n\n[*] Does gradlew build run cleanly?\n\n\n[*] Have you written or updated unit tests to verify your changes?\n\n\n If adding new dependencies to the code, are these dependencies licensed in a way that is compatible for inclusion under ASF 2.0?\n\n\nNote:\nPlease ensure that once the PR is submitted, check Concourse for build issues and\nsubmit an update to your PR as soon as possible. If you need help, please send an\nemail to dev@geode.apache.org.", "createdAt": "2020-03-01T18:16:32Z", "url": "https://github.com/apache/geode/pull/4751", "merged": true, "mergeCommit": {"oid": "c8413592e5573f675c538c63ef9ee9f97a349e73"}, "closed": true, "closedAt": "2020-03-10T05:47:09Z", "author": {"login": "mivanac"}, "timelineItems": {"totalCount": 16, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcKIE3mgFqTM2ODE5ODg1MQ==", "endCursor": "Y3Vyc29yOnYyOpPPAAABcMEwQRAFqTM3MTU0MDI4Ng==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzY4MTk4ODUx", "url": "https://github.com/apache/geode/pull/4751#pullrequestreview-368198851", "createdAt": "2020-03-03T17:57:09Z", "commit": {"oid": "08720eeae54c92ced8170574f80da47d7c375418"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wM1QxNzo1NzowOVrOFxQcXg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wM1QyMDowNToyMlrOFxUqqA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NzE5Mzk1MA==", "bodyText": "See earlier comment about descriptive test names.\nAlso, I wanted to check that this test is able to detect the failure condition it was written for (a hang caused by async messaging) so I ran it against the previous commit on this branch, before the asyncMode field was added to the Connection class. The test doesn't pass, as expected, but it takes 5 minutes to report the hang. Would it be possible to have the test use a smaller timeout instead of the default 5 minutes to speed things up a bit for if/when it does fail?", "url": "https://github.com/apache/geode/pull/4751#discussion_r387193950", "createdAt": "2020-03-03T17:57:09Z", "author": {"login": "DonalEvans"}, "path": "geode-core/src/distributedTest/java/org/apache/geode/internal/tcp/TCPConduitDUnitTest.java", "diffHunk": "@@ -113,6 +116,88 @@ public void basicAcceptConnection() throws Exception {\n     }\n   }\n \n+\n+  @Test\n+  public void testClosingOfSenderConnections() throws Exception {\n+    final VM vm1 = VM.getVM(1);\n+    final VM vm2 = VM.getVM(2);\n+    final VM vm3 = VM.getVM(3);\n+\n+    disconnectAllFromDS();\n+\n+    int port = startLocator();\n+    properties.put(ConfigurationProperties.LOCATORS, \"localhost[\" + port + \"]\");\n+\n+    vm1.invoke(() -> startServer(properties));\n+    vm2.invoke(() -> startServer(properties));\n+    vm3.invoke(() -> startServer(properties));\n+\n+    await().untilAsserted(() -> {\n+      assertThat(ConnectionTable.getNumSenderSharedConnections()).isEqualTo(3);\n+    });\n+\n+    try {\n+      await(\"for message to be sent\").until(() -> {\n+        final SerialAckedMessage serialAckedMessage = new SerialAckedMessage();\n+        serialAckedMessage.send(system.getAllOtherMembers(), false);\n+        return true;\n+      });\n+    } finally {\n+      // DUnit won't clean up properly if the sockets are hung; we have to crash the systems.\n+      IgnoredException.addIgnoredException(\"ForcedDisconnectException|loss of quorum\");\n+      for (VM vm : Arrays.asList(vm1, vm2, vm3)) {\n+        vm.invoke(\"crash system in case it's hung\", () -> {\n+          if (system != null && system.isConnected()) {\n+            DistributedTestUtils.crashDistributedSystem(system);\n+          }\n+        });\n+      }\n+      assertThat(ConnectionTable.getNumSenderSharedConnections()).isEqualTo(0);\n+      DistributedTestUtils.crashDistributedSystem(system);\n+    }\n+  }\n+\n+  @Test\n+  public void testAsyncHanging() throws Exception {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "08720eeae54c92ced8170574f80da47d7c375418"}, "originalPosition": 65}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NzE5NTAwOQ==", "bodyText": "This test name could do with being more descriptive. A good test name should describe what part of the code is being tested, using which parameters, and what the expected outcome is.\nAlso, this test appears to be identical to the first test method in this class, with the addition of one extra assert. Are both cases needed?", "url": "https://github.com/apache/geode/pull/4751#discussion_r387195009", "createdAt": "2020-03-03T17:59:10Z", "author": {"login": "DonalEvans"}, "path": "geode-core/src/distributedTest/java/org/apache/geode/internal/tcp/TCPConduitDUnitTest.java", "diffHunk": "@@ -113,6 +116,88 @@ public void basicAcceptConnection() throws Exception {\n     }\n   }\n \n+\n+  @Test\n+  public void testClosingOfSenderConnections() throws Exception {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "08720eeae54c92ced8170574f80da47d7c375418"}, "originalPosition": 25}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NzI1NDM0NA==", "bodyText": "This block of code doesn't appear to achieve anything. The test runs the same with or without it, both before and after the asyncMode fix introduction.", "url": "https://github.com/apache/geode/pull/4751#discussion_r387254344", "createdAt": "2020-03-03T19:48:55Z", "author": {"login": "DonalEvans"}, "path": "geode-core/src/distributedTest/java/org/apache/geode/internal/tcp/TCPConduitDUnitTest.java", "diffHunk": "@@ -113,6 +116,88 @@ public void basicAcceptConnection() throws Exception {\n     }\n   }\n \n+\n+  @Test\n+  public void testClosingOfSenderConnections() throws Exception {\n+    final VM vm1 = VM.getVM(1);\n+    final VM vm2 = VM.getVM(2);\n+    final VM vm3 = VM.getVM(3);\n+\n+    disconnectAllFromDS();\n+\n+    int port = startLocator();\n+    properties.put(ConfigurationProperties.LOCATORS, \"localhost[\" + port + \"]\");\n+\n+    vm1.invoke(() -> startServer(properties));\n+    vm2.invoke(() -> startServer(properties));\n+    vm3.invoke(() -> startServer(properties));\n+\n+    await().untilAsserted(() -> {\n+      assertThat(ConnectionTable.getNumSenderSharedConnections()).isEqualTo(3);\n+    });\n+\n+    try {\n+      await(\"for message to be sent\").until(() -> {\n+        final SerialAckedMessage serialAckedMessage = new SerialAckedMessage();\n+        serialAckedMessage.send(system.getAllOtherMembers(), false);\n+        return true;\n+      });\n+    } finally {\n+      // DUnit won't clean up properly if the sockets are hung; we have to crash the systems.\n+      IgnoredException.addIgnoredException(\"ForcedDisconnectException|loss of quorum\");\n+      for (VM vm : Arrays.asList(vm1, vm2, vm3)) {\n+        vm.invoke(\"crash system in case it's hung\", () -> {\n+          if (system != null && system.isConnected()) {\n+            DistributedTestUtils.crashDistributedSystem(system);\n+          }\n+        });\n+      }\n+      assertThat(ConnectionTable.getNumSenderSharedConnections()).isEqualTo(0);\n+      DistributedTestUtils.crashDistributedSystem(system);\n+    }\n+  }\n+\n+  @Test\n+  public void testAsyncHanging() throws Exception {\n+    final VM vm1 = VM.getVM(1);\n+    final VM vm2 = VM.getVM(2);\n+    final VM vm3 = VM.getVM(3);\n+\n+    disconnectAllFromDS();\n+\n+    int port = startLocator();\n+    properties.put(ConfigurationProperties.LOCATORS, \"localhost[\" + port + \"]\");\n+    properties.put(\"async-distribution-timeout\", \"5\");\n+\n+    vm1.invoke(() -> startServer(properties));\n+    vm2.invoke(() -> startServer(properties));\n+    vm3.invoke(() -> startServer(properties));\n+\n+    await().untilAsserted(() -> {\n+      assertThat(ConnectionTable.getNumSenderSharedConnections()).isEqualTo(3);\n+    });\n+\n+    try {\n+      await(\"for message to be sent\").until(() -> {\n+        final SerialAckedMessage serialAckedMessage = new SerialAckedMessage();\n+        serialAckedMessage.send(system.getAllOtherMembers(), false);\n+        return true;\n+      });\n+    } finally {\n+      // DUnit won't clean up properly if the sockets are hung; we have to crash the systems.\n+      IgnoredException.addIgnoredException(\"ForcedDisconnectException|loss of quorum\");\n+      for (VM vm : Arrays.asList(vm1, vm2, vm3)) {\n+        vm.invoke(\"crash system in case it's hung\", () -> {\n+          if (system != null && system.isConnected()) {\n+            DistributedTestUtils.crashDistributedSystem(system);\n+          }\n+        });\n+      }\n+      DistributedTestUtils.crashDistributedSystem(system);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "08720eeae54c92ced8170574f80da47d7c375418"}, "originalPosition": 100}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NzI2MzE0NA==", "bodyText": "What is the reason for adding this as an ignored exception?  Why do we now expect to see this exception and feel okay ignoring it?", "url": "https://github.com/apache/geode/pull/4751#discussion_r387263144", "createdAt": "2020-03-03T20:05:22Z", "author": {"login": "DonalEvans"}, "path": "geode-core/src/distributedTest/java/org/apache/geode/management/DistributedSystemMXBeanWithAlertsDistributedTest.java", "diffHunk": "@@ -137,6 +137,7 @@ public void setUp() throws Exception {\n     memberVM3 = getVM(3);\n \n     managerMember = managerVM.invoke(() -> createManager());\n+    IgnoredException.addIgnoredException(\"Cannot form connection to alert listener\");", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "08720eeae54c92ced8170574f80da47d7c375418"}, "originalPosition": 4}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzcwNjQ3MjA0", "url": "https://github.com/apache/geode/pull/4751#pullrequestreview-370647204", "createdAt": "2020-03-06T21:48:05Z", "commit": {"oid": "08720eeae54c92ced8170574f80da47d7c375418"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "efb3bd4087e35992c8a038ec27935bee7c0c955e", "author": {"user": {"login": "mivanac", "name": "Mario Ivanac"}}, "url": "https://github.com/apache/geode/commit/efb3bd4087e35992c8a038ec27935bee7c0c955e", "committedDate": "2020-03-07T14:10:43Z", "message": "GEODE-7727: modify sender thread to detect relese of connection"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a4a53c370fbdb42079afffd9387e5af8a666d503", "author": {"user": {"login": "mivanac", "name": "Mario Ivanac"}}, "url": "https://github.com/apache/geode/commit/a4a53c370fbdb42079afffd9387e5af8a666d503", "committedDate": "2020-03-07T14:10:43Z", "message": "GEODE-7727: Update solution only for shared connections"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "af2de9269a25dc515157371e418ac9e0154a5eb0", "author": {"user": {"login": "mivanac", "name": "Mario Ivanac"}}, "url": "https://github.com/apache/geode/commit/af2de9269a25dc515157371e418ac9e0154a5eb0", "committedDate": "2020-03-07T14:10:43Z", "message": "GEODE-7727: added test"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c9b6a3dcbc1dc6dedc729202d4b576f9469becca", "author": {"user": {"login": "mivanac", "name": "Mario Ivanac"}}, "url": "https://github.com/apache/geode/commit/c9b6a3dcbc1dc6dedc729202d4b576f9469becca", "committedDate": "2020-03-07T14:10:43Z", "message": "GEODE-7727: update ater comments"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e7dc729854f972d3ef7a522b3b923b2179c3e0b4", "author": {"user": {"login": "mivanac", "name": "Mario Ivanac"}}, "url": "https://github.com/apache/geode/commit/e7dc729854f972d3ef7a522b3b923b2179c3e0b4", "committedDate": "2020-03-07T14:10:43Z", "message": "GEODE-7727: update test"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c4ea0deec4b684d349d22a0a156411b736fd37dd", "author": {"user": {"login": "mivanac", "name": "Mario Ivanac"}}, "url": "https://github.com/apache/geode/commit/c4ea0deec4b684d349d22a0a156411b736fd37dd", "committedDate": "2020-03-07T14:10:43Z", "message": "GEODE-7727: fix for async write hanging"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "bf1561c24b8d1e5a89949c4d42b3cda4ddeb84df", "author": {"user": {"login": "upthewaterspout", "name": "Dan Smith"}}, "url": "https://github.com/apache/geode/commit/bf1561c24b8d1e5a89949c4d42b3cda4ddeb84df", "committedDate": "2020-03-07T14:10:43Z", "message": "GEODE-7727: Test of region operations in the face of closed connections\n\nAdding a test for what happens to region operations when a connection is closed\nout from under the system. This test hangs without the changes to let the\nreader thread keep running.\n\nFix to test"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "0224b15129529753165f58e4eb9dc6a5a11dd55e", "author": {"user": {"login": "upthewaterspout", "name": "Dan Smith"}}, "url": "https://github.com/apache/geode/commit/0224b15129529753165f58e4eb9dc6a5a11dd55e", "committedDate": "2020-03-07T14:10:43Z", "message": "GEODE-7727: Preventing a double release of the input buffer\n\nThe releaseInputBuffer method was not thread safe. If it is called\nconcurrently, it will end up being released twice, which will add the buffer to\nto the buffer pool twice. Later, this could result in two threads using the\nsame buffer, resulting in corruption of the buffer.\n\nWith the changes for GEODE-7727, we made it likely that releaseInputBuffer\nwould be called concurrently. If a member departs, one thread will call\nConnection.close. Connection.close will close the socket and call\nreleaseInputBuffer. However, closing the socket will wake up the reader thread,\nwhich will also call releaseInputBuffer concurrently.\n\nMaking releaseInputBuffer thread safe by introducing a lock."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "73163ce0d5520fb6d6dc2a771313882bf3546ca2", "author": {"user": {"login": "mivanac", "name": "Mario Ivanac"}}, "url": "https://github.com/apache/geode/commit/73163ce0d5520fb6d6dc2a771313882bf3546ca2", "committedDate": "2020-03-07T14:28:23Z", "message": "GEODE-7727: update after merge"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "65a25f7406ccbcfa101b83bd4bd4ffdf5c2df3d4", "author": {"user": {"login": "mivanac", "name": "Mario Ivanac"}}, "url": "https://github.com/apache/geode/commit/65a25f7406ccbcfa101b83bd4bd4ffdf5c2df3d4", "committedDate": "2020-03-07T13:24:00Z", "message": "Merge pull request #6 from upthewaterspout/feature/GEODE-7727-fix-double-buffer\n\nTest of closed connection and fix to input buffer release logic"}, "afterCommit": {"oid": "73163ce0d5520fb6d6dc2a771313882bf3546ca2", "author": {"user": {"login": "mivanac", "name": "Mario Ivanac"}}, "url": "https://github.com/apache/geode/commit/73163ce0d5520fb6d6dc2a771313882bf3546ca2", "committedDate": "2020-03-07T14:28:23Z", "message": "GEODE-7727: update after merge"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzcxMzk4NTYz", "url": "https://github.com/apache/geode/pull/4751#pullrequestreview-371398563", "createdAt": "2020-03-09T17:47:51Z", "commit": {"oid": "73163ce0d5520fb6d6dc2a771313882bf3546ca2"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzcxNTA4MjUx", "url": "https://github.com/apache/geode/pull/4751#pullrequestreview-371508251", "createdAt": "2020-03-09T20:33:24Z", "commit": {"oid": "73163ce0d5520fb6d6dc2a771313882bf3546ca2"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wOVQyMDozMzoyNFrOFz4XHQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wOVQyMDozNjoyOVrOFz4dNw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4OTk0NTExNw==", "bodyText": "There is an empty finally block here that should either be removed along with the try, or have something relevant done in it.", "url": "https://github.com/apache/geode/pull/4751#discussion_r389945117", "createdAt": "2020-03-09T20:33:24Z", "author": {"login": "DonalEvans"}, "path": "geode-core/src/distributedTest/java/org/apache/geode/internal/tcp/ConnectionChangeHangTest.java", "diffHunk": "@@ -0,0 +1,78 @@\n+/*\n+ * Licensed to the Apache Software Foundation (ASF) under one or more contributor license\n+ * agreements. See the NOTICE file distributed with this work for additional information regarding\n+ * copyright ownership. The ASF licenses this file to You under the Apache License, Version 2.0 (the\n+ * \"License\"); you may not use this file except in compliance with the License. You may obtain a\n+ * copy of the License at\n+ *\n+ * http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software distributed under the License\n+ * is distributed on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express\n+ * or implied. See the License for the specific language governing permissions and limitations under\n+ * the License.\n+ */\n+package org.apache.geode.internal.tcp;\n+\n+import static org.apache.geode.test.awaitility.GeodeAwaitility.await;\n+import static org.assertj.core.api.Assertions.assertThat;\n+\n+import java.io.Serializable;\n+\n+import org.junit.Before;\n+import org.junit.Rule;\n+import org.junit.Test;\n+\n+import org.apache.geode.distributed.internal.InternalDistributedSystem;\n+import org.apache.geode.distributed.internal.SerialAckedMessage;\n+import org.apache.geode.test.dunit.rules.ClusterStartupRule;\n+import org.apache.geode.test.dunit.rules.MemberVM;\n+\n+public class ConnectionChangeHangTest implements Serializable {\n+  int serversToStart = 3;\n+\n+  protected static InternalDistributedSystem system =\n+      InternalDistributedSystem.getConnectedInstance();\n+\n+  @Rule\n+  public ClusterStartupRule cluster = new ClusterStartupRule(serversToStart + 1);\n+\n+  MemberVM locator;\n+  MemberVM server1;\n+  MemberVM server2;\n+  MemberVM server3;\n+\n+  @Before\n+  public void setUp() throws Exception {\n+    locator = cluster.startLocatorVM(0);\n+\n+  }\n+\n+  private MemberVM startServer(final int vmIndex) {\n+    return cluster.startServerVM(\n+        vmIndex, s -> s.withConnectionToLocator(locator.getPort())\n+            .withProperty(\"async-distribution-timeout\", \"5\"));\n+  }\n+\n+  @Test\n+\n+  public void testNoHanging() {\n+    server1 = startServer(1);\n+    server2 = startServer(2);\n+    server3 = startServer(3);\n+    locator.invoke(() -> await().untilAsserted(() -> {\n+      assertThat(ConnectionTable.getNumSenderSharedConnections()).isEqualTo(3);\n+    }));\n+\n+\n+    try {\n+      locator.invoke(() -> await(\"for message to be sent\").until(() -> {\n+        final SerialAckedMessage serialAckedMessage = new SerialAckedMessage();\n+        serialAckedMessage.send(system.getAllOtherMembers(), false);\n+        return true;\n+      }));\n+    } finally {\n+\n+    }", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "73163ce0d5520fb6d6dc2a771313882bf3546ca2"}, "originalPosition": 76}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4OTk0NTg3Nw==", "bodyText": "This test name would be more descriptive if it was something like \"serverStartupDoesNotHangWhenAsyncDistributionTimeoutIsSet\"", "url": "https://github.com/apache/geode/pull/4751#discussion_r389945877", "createdAt": "2020-03-09T20:34:54Z", "author": {"login": "DonalEvans"}, "path": "geode-core/src/distributedTest/java/org/apache/geode/internal/tcp/ConnectionChangeHangTest.java", "diffHunk": "@@ -0,0 +1,78 @@\n+/*\n+ * Licensed to the Apache Software Foundation (ASF) under one or more contributor license\n+ * agreements. See the NOTICE file distributed with this work for additional information regarding\n+ * copyright ownership. The ASF licenses this file to You under the Apache License, Version 2.0 (the\n+ * \"License\"); you may not use this file except in compliance with the License. You may obtain a\n+ * copy of the License at\n+ *\n+ * http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software distributed under the License\n+ * is distributed on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express\n+ * or implied. See the License for the specific language governing permissions and limitations under\n+ * the License.\n+ */\n+package org.apache.geode.internal.tcp;\n+\n+import static org.apache.geode.test.awaitility.GeodeAwaitility.await;\n+import static org.assertj.core.api.Assertions.assertThat;\n+\n+import java.io.Serializable;\n+\n+import org.junit.Before;\n+import org.junit.Rule;\n+import org.junit.Test;\n+\n+import org.apache.geode.distributed.internal.InternalDistributedSystem;\n+import org.apache.geode.distributed.internal.SerialAckedMessage;\n+import org.apache.geode.test.dunit.rules.ClusterStartupRule;\n+import org.apache.geode.test.dunit.rules.MemberVM;\n+\n+public class ConnectionChangeHangTest implements Serializable {\n+  int serversToStart = 3;\n+\n+  protected static InternalDistributedSystem system =\n+      InternalDistributedSystem.getConnectedInstance();\n+\n+  @Rule\n+  public ClusterStartupRule cluster = new ClusterStartupRule(serversToStart + 1);\n+\n+  MemberVM locator;\n+  MemberVM server1;\n+  MemberVM server2;\n+  MemberVM server3;\n+\n+  @Before\n+  public void setUp() throws Exception {\n+    locator = cluster.startLocatorVM(0);\n+\n+  }\n+\n+  private MemberVM startServer(final int vmIndex) {\n+    return cluster.startServerVM(\n+        vmIndex, s -> s.withConnectionToLocator(locator.getPort())\n+            .withProperty(\"async-distribution-timeout\", \"5\"));\n+  }\n+\n+  @Test\n+\n+  public void testNoHanging() {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "73163ce0d5520fb6d6dc2a771313882bf3546ca2"}, "originalPosition": 59}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4OTk0NTkzOA==", "bodyText": "There is an extra line break here", "url": "https://github.com/apache/geode/pull/4751#discussion_r389945938", "createdAt": "2020-03-09T20:35:02Z", "author": {"login": "DonalEvans"}, "path": "geode-core/src/distributedTest/java/org/apache/geode/internal/tcp/ConnectionChangeHangTest.java", "diffHunk": "@@ -0,0 +1,78 @@\n+/*\n+ * Licensed to the Apache Software Foundation (ASF) under one or more contributor license\n+ * agreements. See the NOTICE file distributed with this work for additional information regarding\n+ * copyright ownership. The ASF licenses this file to You under the Apache License, Version 2.0 (the\n+ * \"License\"); you may not use this file except in compliance with the License. You may obtain a\n+ * copy of the License at\n+ *\n+ * http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software distributed under the License\n+ * is distributed on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express\n+ * or implied. See the License for the specific language governing permissions and limitations under\n+ * the License.\n+ */\n+package org.apache.geode.internal.tcp;\n+\n+import static org.apache.geode.test.awaitility.GeodeAwaitility.await;\n+import static org.assertj.core.api.Assertions.assertThat;\n+\n+import java.io.Serializable;\n+\n+import org.junit.Before;\n+import org.junit.Rule;\n+import org.junit.Test;\n+\n+import org.apache.geode.distributed.internal.InternalDistributedSystem;\n+import org.apache.geode.distributed.internal.SerialAckedMessage;\n+import org.apache.geode.test.dunit.rules.ClusterStartupRule;\n+import org.apache.geode.test.dunit.rules.MemberVM;\n+\n+public class ConnectionChangeHangTest implements Serializable {\n+  int serversToStart = 3;\n+\n+  protected static InternalDistributedSystem system =\n+      InternalDistributedSystem.getConnectedInstance();\n+\n+  @Rule\n+  public ClusterStartupRule cluster = new ClusterStartupRule(serversToStart + 1);\n+\n+  MemberVM locator;\n+  MemberVM server1;\n+  MemberVM server2;\n+  MemberVM server3;\n+\n+  @Before\n+  public void setUp() throws Exception {\n+    locator = cluster.startLocatorVM(0);\n+\n+  }\n+\n+  private MemberVM startServer(final int vmIndex) {\n+    return cluster.startServerVM(\n+        vmIndex, s -> s.withConnectionToLocator(locator.getPort())\n+            .withProperty(\"async-distribution-timeout\", \"5\"));\n+  }\n+\n+  @Test\n+", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "73163ce0d5520fb6d6dc2a771313882bf3546ca2"}, "originalPosition": 58}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4OTk0NjY3OQ==", "bodyText": "This class should be renamed. The original name was a placeholder for use while debugging.", "url": "https://github.com/apache/geode/pull/4751#discussion_r389946679", "createdAt": "2020-03-09T20:36:29Z", "author": {"login": "DonalEvans"}, "path": "geode-core/src/distributedTest/java/org/apache/geode/internal/tcp/ConnectionChangeHangTest.java", "diffHunk": "@@ -0,0 +1,78 @@\n+/*\n+ * Licensed to the Apache Software Foundation (ASF) under one or more contributor license\n+ * agreements. See the NOTICE file distributed with this work for additional information regarding\n+ * copyright ownership. The ASF licenses this file to You under the Apache License, Version 2.0 (the\n+ * \"License\"); you may not use this file except in compliance with the License. You may obtain a\n+ * copy of the License at\n+ *\n+ * http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software distributed under the License\n+ * is distributed on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express\n+ * or implied. See the License for the specific language governing permissions and limitations under\n+ * the License.\n+ */\n+package org.apache.geode.internal.tcp;\n+\n+import static org.apache.geode.test.awaitility.GeodeAwaitility.await;\n+import static org.assertj.core.api.Assertions.assertThat;\n+\n+import java.io.Serializable;\n+\n+import org.junit.Before;\n+import org.junit.Rule;\n+import org.junit.Test;\n+\n+import org.apache.geode.distributed.internal.InternalDistributedSystem;\n+import org.apache.geode.distributed.internal.SerialAckedMessage;\n+import org.apache.geode.test.dunit.rules.ClusterStartupRule;\n+import org.apache.geode.test.dunit.rules.MemberVM;\n+\n+public class ConnectionChangeHangTest implements Serializable {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "73163ce0d5520fb6d6dc2a771313882bf3546ca2"}, "originalPosition": 31}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "53d139afd491b04515c7f536ddb337d2fc39d7f6", "author": {"user": {"login": "mivanac", "name": "Mario Ivanac"}}, "url": "https://github.com/apache/geode/commit/53d139afd491b04515c7f536ddb337d2fc39d7f6", "committedDate": "2020-03-09T21:22:43Z", "message": "GEODE-7727: update test name"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzcxNTQwMjg2", "url": "https://github.com/apache/geode/pull/4751#pullrequestreview-371540286", "createdAt": "2020-03-09T21:25:30Z", "commit": {"oid": "53d139afd491b04515c7f536ddb337d2fc39d7f6"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4973, "cost": 1, "resetAt": "2021-10-29T19:57:52Z"}}}