{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDYzNjQyNTUw", "number": 5427, "title": "GEODE-8406: Enable early-return in CI scripts for CI-only changes", "bodyText": "Creates a function that tests the code changes to be:\n\nFrom a pull request in Geode\nThose changes are more than ci,  geode-book, geode-docs\nie: code changes, not non-testable changes\n\nThank you for submitting a contribution to Apache Geode.\nIn order to streamline the review of the contribution we ask you\nto ensure the following steps have been taken:\nFor all changes:\n\n\n Is there a JIRA ticket associated with this PR? Is it referenced in the commit message?\n\n\n Has your PR been rebased against the latest commit within the target branch (typically develop)?\n\n\n Is your initial contribution a single, squashed commit?\n\n\n Does gradlew build run cleanly?\n\n\n[n/a] Have you written or updated unit tests to verify your changes?\n\n\n[n/a] If adding new dependencies to the code, are these dependencies licensed in a way that is compatible for inclusion under ASF 2.0?\n\n\nNote:\nPlease ensure that once the PR is submitted, check Concourse for build issues and\nsubmit an update to your PR as soon as possible. If you need help, please send an\nemail to dev@geode.apache.org.", "createdAt": "2020-08-05T21:05:17Z", "url": "https://github.com/apache/geode/pull/5427", "merged": true, "mergeCommit": {"oid": "fbcf0c6670a41c9ca255970a504fe0a27bd9fe43"}, "closed": true, "closedAt": "2020-08-07T16:20:30Z", "author": {"login": "rhoughton-pivot"}, "timelineItems": {"totalCount": 12, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABc8BnvXgH2gAyNDYzNjQyNTUwOjYxZDNlZWRhYzdhMzUwZTllOTlhOTU1N2U0MjExOWY1ZjhjNDNmMGI=", "endCursor": "Y3Vyc29yOnYyOpPPAAABc8UWk9AH2gAyNDYzNjQyNTUwOmJmZDg3YzNlMGZlMWRlM2YzYTJmNDBhNjk3NWIyODBjNTFiNWFhYTQ=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "61d3eedac7a350e9e99a9557e42119f5f8c43f0b", "author": {"user": {"login": "rhoughton-pivot", "name": "Robert Houghton"}}, "url": "https://github.com/apache/geode/commit/61d3eedac7a350e9e99a9557e42119f5f8c43f0b", "committedDate": "2020-08-05T20:54:51Z", "message": "GEODE-8406: Enable early-return in CI scripts for CI-only changes\n\nCreates a function that tests the code changes to be:\n1) From a pull request in Geode\n2) Those changes are more than ci,  geode-book, geode-docs\n  ie: code changes, not non-testable changes"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDYyMDI3MDcx", "url": "https://github.com/apache/geode/pull/5427#pullrequestreview-462027071", "createdAt": "2020-08-05T21:11:36Z", "commit": {"oid": "61d3eedac7a350e9e99a9557e42119f5f8c43f0b"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0wNVQyMToxMTozNlrOG8ayCA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0wNVQyMToxMTozNlrOG8ayCA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NjAwNjUzNg==", "bodyText": "what about README.md, LICENSE, or NOTICE in the top level? or other LICENSE/NOTICE files?", "url": "https://github.com/apache/geode/pull/5427#discussion_r466006536", "createdAt": "2020-08-05T21:11:36Z", "author": {"login": "onichols-pivotal"}, "path": "ci/scripts/delete_instance.sh", "diffHunk": "@@ -29,6 +29,11 @@ while [ -h \"$SOURCE\" ]; do # resolve $SOURCE until the file is no longer a symli\n done\n SCRIPTDIR=\"$( cd -P \"$( dirname \"$SOURCE\" )\" && pwd )\"\n \n+. ${SCRIPTDIR}/short_circuit_pr_tasks.sh\n+cd geode\n+  is_source_from_pr_testable \"ci\" \"dev-tools\" \"etc\" \"geode-book\" \"geode-docs\" || exit 0", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "61d3eedac7a350e9e99a9557e42119f5f8c43f0b"}, "originalPosition": 6}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDYyMDI3NDE2", "url": "https://github.com/apache/geode/pull/5427#pullrequestreview-462027416", "createdAt": "2020-08-05T21:12:10Z", "commit": {"oid": "61d3eedac7a350e9e99a9557e42119f5f8c43f0b"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0wNVQyMToxMjoxMFrOG8azFQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0wNVQyMToxMjoxMFrOG8azFQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NjAwNjgwNQ==", "bodyText": "any way to avoid duplicating this list half-a-dozen places??", "url": "https://github.com/apache/geode/pull/5427#discussion_r466006805", "createdAt": "2020-08-05T21:12:10Z", "author": {"login": "onichols-pivotal"}, "path": "ci/scripts/execute_tests.sh", "diffHunk": "@@ -34,6 +34,11 @@ if [[ -z \"${GRADLE_TASK}\" ]]; then\n   exit 1\n fi\n \n+. ${SCRIPTDIR}/short_circuit_pr_tasks.sh\n+cd geode\n+  is_source_from_pr_testable \"ci\" \"dev-tools\" \"etc\" \"geode-book\" \"geode-docs\" || exit 0", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "61d3eedac7a350e9e99a9557e42119f5f8c43f0b"}, "originalPosition": 6}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDYyMDI4MjUz", "url": "https://github.com/apache/geode/pull/5427#pullrequestreview-462028253", "createdAt": "2020-08-05T21:13:33Z", "commit": {"oid": "61d3eedac7a350e9e99a9557e42119f5f8c43f0b"}, "state": "COMMENTED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDYyMDQ2NDQ0", "url": "https://github.com/apache/geode/pull/5427#pullrequestreview-462046444", "createdAt": "2020-08-05T21:45:42Z", "commit": {"oid": "61d3eedac7a350e9e99a9557e42119f5f8c43f0b"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0wNVQyMTo0NTo0M1rOG8bwCQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0wNVQyMTo0NTo0M1rOG8bwCQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NjAyMjQwOQ==", "bodyText": "Is it necessary to have the arguments at all given that they are the same in every call? Seems you could whittle this down to a single line ${SCRIPTDIR}/short_circuit_pr_tasks.sh && exit 0, where short_circuit_pr_tasks.sh returns true if it should short circuit.", "url": "https://github.com/apache/geode/pull/5427#discussion_r466022409", "createdAt": "2020-08-05T21:45:43Z", "author": {"login": "pivotal-jbarrett"}, "path": "ci/scripts/execute_tests.sh", "diffHunk": "@@ -34,6 +34,11 @@ if [[ -z \"${GRADLE_TASK}\" ]]; then\n   exit 1\n fi\n \n+. ${SCRIPTDIR}/short_circuit_pr_tasks.sh\n+cd geode\n+  is_source_from_pr_testable \"ci\" \"dev-tools\" \"etc\" \"geode-book\" \"geode-docs\" || exit 0", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NjAwNjgwNQ=="}, "originalCommit": {"oid": "61d3eedac7a350e9e99a9557e42119f5f8c43f0b"}, "originalPosition": 6}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDYyMDU5NzAz", "url": "https://github.com/apache/geode/pull/5427#pullrequestreview-462059703", "createdAt": "2020-08-05T22:12:07Z", "commit": {"oid": "61d3eedac7a350e9e99a9557e42119f5f8c43f0b"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDYyMDgyMzMz", "url": "https://github.com/apache/geode/pull/5427#pullrequestreview-462082333", "createdAt": "2020-08-05T23:07:04Z", "commit": {"oid": "61d3eedac7a350e9e99a9557e42119f5f8c43f0b"}, "state": "APPROVED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0wNVQyMzowNzowNFrOG8dkZg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0wNVQyMzowNzowNFrOG8dkZg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NjA1MjE5OA==", "bodyText": "I also have little skin in the game, but here are some options that jump out at me:\n\nLike Jake said, let short_circuit_pr_tasks be the source of truth for what directories are excluded.\nTake an arg list, and specify those args in the task's yml.  Jinja or yml anchoring could reduce duplication.\nGet exceedingly convoluted by having this check be an independent Concourse job which outputs a sentinel file, which test jobs use to determine whether or not to short-circuit to green.\n\nI feel like the first option is best for the first iteration.", "url": "https://github.com/apache/geode/pull/5427#discussion_r466052198", "createdAt": "2020-08-05T23:07:04Z", "author": {"login": "PurelyApplied"}, "path": "ci/scripts/execute_tests.sh", "diffHunk": "@@ -34,6 +34,11 @@ if [[ -z \"${GRADLE_TASK}\" ]]; then\n   exit 1\n fi\n \n+. ${SCRIPTDIR}/short_circuit_pr_tasks.sh\n+cd geode\n+  is_source_from_pr_testable \"ci\" \"dev-tools\" \"etc\" \"geode-book\" \"geode-docs\" || exit 0", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NjAwNjgwNQ=="}, "originalCommit": {"oid": "61d3eedac7a350e9e99a9557e42119f5f8c43f0b"}, "originalPosition": 6}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "bab549ca3e1d25ba69784bc6d56015dce486d153", "author": {"user": {"login": "rhoughton-pivot", "name": "Robert Houghton"}}, "url": "https://github.com/apache/geode/commit/bab549ca3e1d25ba69784bc6d56015dce486d153", "committedDate": "2020-08-05T23:19:23Z", "message": "Applying fedback about default parameters."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDYyMTQ4ODI4", "url": "https://github.com/apache/geode/pull/5427#pullrequestreview-462148828", "createdAt": "2020-08-06T02:41:23Z", "commit": {"oid": "bab549ca3e1d25ba69784bc6d56015dce486d153"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "3752fb1e9435cd83806f941d3ad5be1417606b1b", "author": {"user": {"login": "rhoughton-pivot", "name": "Robert Houghton"}}, "url": "https://github.com/apache/geode/commit/3752fb1e9435cd83806f941d3ad5be1417606b1b", "committedDate": "2020-08-06T16:59:27Z", "message": "fix the pushd/popd in script"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "4d9cf4f7b757a154bd30517eb6a16a5d2e345340", "author": {"user": {"login": "rhoughton-pivot", "name": "Robert Houghton"}}, "url": "https://github.com/apache/geode/commit/4d9cf4f7b757a154bd30517eb6a16a5d2e345340", "committedDate": "2020-08-06T17:40:50Z", "message": "populate exclude list only if we are in a PR"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "bfd87c3e0fe1de3f3a2f40a6975b280c51b5aaa4", "author": {"user": {"login": "rhoughton-pivot", "name": "Robert Houghton"}}, "url": "https://github.com/apache/geode/commit/bfd87c3e0fe1de3f3a2f40a6975b280c51b5aaa4", "committedDate": "2020-08-06T18:44:18Z", "message": "it is the caller's responsibility to ensure the cwd is the Geode repo"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4265, "cost": 1, "resetAt": "2021-10-29T19:57:52Z"}}}