{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDkxOTEyNzg1", "number": 5544, "reviewThreads": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yNFQxNzoyNDoyMFrOEnJRpA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yNFQxNzozMTo1OVrOEnJckw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzA5NDgxODkyOnYy", "diffSide": "RIGHT", "path": "geode-redis/src/integrationTest/java/org/apache/geode/redis/internal/executor/pubsub/SubscriptionsIntegrationTest.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yNFQxNzoyNDoyMFrOHXlHPw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yNFQxODo0MzoxMFrOHXoFJg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NDQ4NzM1OQ==", "bodyText": "why a long timeout on this one but not on pingWithArgumentWhileSubscribed?", "url": "https://github.com/apache/geode/pull/5544#discussion_r494487359", "createdAt": "2020-09-24T17:24:20Z", "author": {"login": "dschneider-pivotal"}, "path": "geode-redis/src/integrationTest/java/org/apache/geode/redis/internal/executor/pubsub/SubscriptionsIntegrationTest.java", "diffHunk": "@@ -39,9 +38,8 @@\n   public static ExecutorServiceRule executor = new ExecutorServiceRule();\n \n   @Test\n-  @Ignore(\"GEODE-8515\")\n   public void pingWhileSubscribed() {\n-    Jedis client = new Jedis(\"localhost\", server.getPort());\n+    Jedis client = new Jedis(\"localhost\", server.getPort(), 1000000000);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "1eb63db55a8becd5ff71270ca2a98f78d794a5a6"}, "originalPosition": 15}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NDUzNTk3NA==", "bodyText": "Thank you for calling this out.  I had a long timeout for debugging and forgot to remove it.", "url": "https://github.com/apache/geode/pull/5544#discussion_r494535974", "createdAt": "2020-09-24T18:43:10Z", "author": {"login": "sabbey37"}, "path": "geode-redis/src/integrationTest/java/org/apache/geode/redis/internal/executor/pubsub/SubscriptionsIntegrationTest.java", "diffHunk": "@@ -39,9 +38,8 @@\n   public static ExecutorServiceRule executor = new ExecutorServiceRule();\n \n   @Test\n-  @Ignore(\"GEODE-8515\")\n   public void pingWhileSubscribed() {\n-    Jedis client = new Jedis(\"localhost\", server.getPort());\n+    Jedis client = new Jedis(\"localhost\", server.getPort(), 1000000000);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NDQ4NzM1OQ=="}, "originalCommit": {"oid": "1eb63db55a8becd5ff71270ca2a98f78d794a5a6"}, "originalPosition": 15}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzA5NDg0NjkxOnYy", "diffSide": "RIGHT", "path": "geode-redis/src/main/java/org/apache/geode/redis/internal/executor/connection/PingExecutor.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yNFQxNzozMTo1OVrOHXlY5g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yNFQxODo0MzoyOFrOHXoFvw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NDQ5MTg3OA==", "bodyText": "consider refactoring this so that we only compute the RedisResponse for subscribe if we find a client and then otherwise with (an else) compute the RedisResponse when not subscribed. I don't like all the logic we have initializing two different results and then we only end up using one or the other. I'd prefer that we only have state at the top that would be shared by either branch (for example commandElems). Once the RedisResponse is done we can then fall through to a command return.", "url": "https://github.com/apache/geode/pull/5544#discussion_r494491878", "createdAt": "2020-09-24T17:31:59Z", "author": {"login": "dschneider-pivotal"}, "path": "geode-redis/src/main/java/org/apache/geode/redis/internal/executor/connection/PingExecutor.java", "diffHunk": "@@ -31,9 +32,17 @@ public RedisResponse executeCommand(Command command,\n       ExecutionHandlerContext context) {\n     List<byte[]> commandElems = command.getProcessedCommand();\n     byte[] result = PING_RESPONSE.getBytes();\n+    byte[] subscribeResult = \"\".getBytes();\n     if (commandElems.size() > 1) {\n       result = commandElems.get(1);\n+      subscribeResult = result;\n     }\n+\n+    if (!context.getPubSub().findSubscribedChannels(context.getClient()).isEmpty()) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "1eb63db55a8becd5ff71270ca2a98f78d794a5a6"}, "originalPosition": 18}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NDUzNjEyNw==", "bodyText": "I refactored it. Check it out and let me know what you think.", "url": "https://github.com/apache/geode/pull/5544#discussion_r494536127", "createdAt": "2020-09-24T18:43:28Z", "author": {"login": "sabbey37"}, "path": "geode-redis/src/main/java/org/apache/geode/redis/internal/executor/connection/PingExecutor.java", "diffHunk": "@@ -31,9 +32,17 @@ public RedisResponse executeCommand(Command command,\n       ExecutionHandlerContext context) {\n     List<byte[]> commandElems = command.getProcessedCommand();\n     byte[] result = PING_RESPONSE.getBytes();\n+    byte[] subscribeResult = \"\".getBytes();\n     if (commandElems.size() > 1) {\n       result = commandElems.get(1);\n+      subscribeResult = result;\n     }\n+\n+    if (!context.getPubSub().findSubscribedChannels(context.getClient()).isEmpty()) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NDQ5MTg3OA=="}, "originalCommit": {"oid": "1eb63db55a8becd5ff71270ca2a98f78d794a5a6"}, "originalPosition": 18}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4639, "cost": 1, "resetAt": "2021-11-11T21:28:48Z"}}}