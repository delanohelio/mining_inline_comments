{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDQ5MTQyMjU4", "number": 5371, "title": "GEODE-8359", "bodyText": "Fix to an NPE in RegisterInterestList66, needed to validate that a we were not getting a null.", "createdAt": "2020-07-14T22:20:24Z", "url": "https://github.com/apache/geode/pull/5371", "merged": true, "mergeCommit": {"oid": "85ab54130542e95e9324cac6af59a9eb80253bff"}, "closed": true, "closedAt": "2020-07-16T20:29:54Z", "author": {"login": "mhansonp"}, "timelineItems": {"totalCount": 14, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABc0qb6tgH2gAyNDQ5MTQyMjU4OmViODk5YmFiOTY5ZDZlZGE2ZDJmNDdhZWU5ODNlNTNlN2VhYTU2ODc=", "endCursor": "Y3Vyc29yOnYyOpPPAAABc1jo7ZgFqTQ1MDExMTg4MA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "eb899bab969d6eda6d2f47aee983e53e7eaa5687", "author": {"user": {"login": "mhansonp", "name": null}}, "url": "https://github.com/apache/geode/commit/eb899bab969d6eda6d2f47aee983e53e7eaa5687", "committedDate": "2020-07-13T23:56:39Z", "message": "Debug messaging"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "cfc0a892503b22e4b906fd7664d7c7aa03f58d05", "author": {"user": {"login": "mhansonp", "name": null}}, "url": "https://github.com/apache/geode/commit/cfc0a892503b22e4b906fd7664d7c7aa03f58d05", "committedDate": "2020-07-14T18:52:55Z", "message": "revert changes to test..."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "fbf91679b733e18b3bf2795489bc3da51fe34ad6", "author": {"user": {"login": "mhansonp", "name": null}}, "url": "https://github.com/apache/geode/commit/fbf91679b733e18b3bf2795489bc3da51fe34ad6", "committedDate": "2020-07-14T21:32:09Z", "message": "Revert \"revert changes to test...\"\n\nThis reverts commit cfc0a892"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "160a60bfdc46fcc31e7be2b47fc8fc2132efc752", "author": {"user": {"login": "mhansonp", "name": null}}, "url": "https://github.com/apache/geode/commit/160a60bfdc46fcc31e7be2b47fc8fc2132efc752", "committedDate": "2020-07-14T22:06:08Z", "message": "Cleanup and bugfix for GEM-2967"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e5ec401afa4be0adb5c6f7927ee4df60fd7d9991", "author": {"user": {"login": "mhansonp", "name": null}}, "url": "https://github.com/apache/geode/commit/e5ec401afa4be0adb5c6f7927ee4df60fd7d9991", "committedDate": "2020-07-14T22:08:11Z", "message": "Spotless"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDQ4Njc0NDk3", "url": "https://github.com/apache/geode/pull/5371#pullrequestreview-448674497", "createdAt": "2020-07-15T06:51:46Z", "commit": {"oid": "e5ec401afa4be0adb5c6f7927ee4df60fd7d9991"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xNVQwNjo1MTo0N1rOGxwpOg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xNVQwNjo1MTo0N1rOGxwpOg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NDgzMDM5NA==", "bodyText": "The important chunk here copied from RegisterInterest61 which already had a bug fix for this issue.", "url": "https://github.com/apache/geode/pull/5371#discussion_r454830394", "createdAt": "2020-07-15T06:51:47Z", "author": {"login": "mhansonp"}, "path": "geode-core/src/main/java/org/apache/geode/internal/cache/tier/sockets/command/RegisterInterestList66.java", "diffHunk": "@@ -163,29 +162,40 @@ public void cmdExecute(final Message clientMessage, final ServerConnection serve\n     }\n     try {\n       securityService.authorize(Resource.DATA, Operation.READ, regionName);\n-      AuthorizeRequest authzRequest = serverConnection.getAuthzRequest();\n-      if (authzRequest != null) {\n+      AuthorizeRequest authorizeRequest = serverConnection.getAuthzRequest();\n+      if (authorizeRequest != null) {\n         if (!DynamicRegionFactory.regionIsDynamicRegionList(regionName)) {\n           RegisterInterestOperationContext registerContext =\n-              authzRequest.registerInterestListAuthorize(regionName, keys, policy);\n-          keys = (List) registerContext.getKey();\n+              authorizeRequest.registerInterestListAuthorize(regionName, keys, policy);\n+          keys = (List<Object>) registerContext.getKey();\n         }\n       }\n       // Register interest\n       serverConnection.getAcceptor().getCacheClientNotifier().registerClientInterest(regionName,\n           keys, serverConnection.getProxyID(), isDurable, sendUpdatesAsInvalidates, true,\n           regionDataPolicyPartBytes[0], true);\n-    } catch (Exception ex) {\n+    } catch (Exception e) {\n       // If an interrupted exception is thrown , rethrow it\n-      checkForInterrupt(serverConnection, ex);\n+      checkForInterrupt(serverConnection, e);\n       // Otherwise, write an exception message and continue\n-      writeChunkedException(clientMessage, ex, serverConnection);\n+      writeChunkedException(clientMessage, e, serverConnection);\n       serverConnection.setAsTrue(RESPONDED);\n       return;\n     }\n \n-    boolean isPrimary = serverConnection.getAcceptor().getCacheClientNotifier()\n-        .getClientProxy(serverConnection.getProxyID()).isPrimary();\n+    CacheClientProxy ccp = serverConnection.getAcceptor().getCacheClientNotifier()\n+        .getClientProxy(serverConnection.getProxyID());\n+\n+    if (ccp == null) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e5ec401afa4be0adb5c6f7927ee4df60fd7d9991"}, "originalPosition": 95}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDQ5MTU0MDUz", "url": "https://github.com/apache/geode/pull/5371#pullrequestreview-449154053", "createdAt": "2020-07-15T17:10:13Z", "commit": {"oid": "e5ec401afa4be0adb5c6f7927ee4df60fd7d9991"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDQ5MjA3MDM2", "url": "https://github.com/apache/geode/pull/5371#pullrequestreview-449207036", "createdAt": "2020-07-15T18:05:34Z", "commit": {"oid": "e5ec401afa4be0adb5c6f7927ee4df60fd7d9991"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xNVQxODowNTozNFrOGyJzbg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xNVQxODowNTozNFrOGyJzbg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NTI0MjYwNg==", "bodyText": "We could change the messaging part...", "url": "https://github.com/apache/geode/pull/5371#discussion_r455242606", "createdAt": "2020-07-15T18:05:34Z", "author": {"login": "agingade"}, "path": "geode-core/src/main/java/org/apache/geode/internal/cache/tier/sockets/command/RegisterInterestList66.java", "diffHunk": "@@ -163,29 +162,40 @@ public void cmdExecute(final Message clientMessage, final ServerConnection serve\n     }\n     try {\n       securityService.authorize(Resource.DATA, Operation.READ, regionName);\n-      AuthorizeRequest authzRequest = serverConnection.getAuthzRequest();\n-      if (authzRequest != null) {\n+      AuthorizeRequest authorizeRequest = serverConnection.getAuthzRequest();\n+      if (authorizeRequest != null) {\n         if (!DynamicRegionFactory.regionIsDynamicRegionList(regionName)) {\n           RegisterInterestOperationContext registerContext =\n-              authzRequest.registerInterestListAuthorize(regionName, keys, policy);\n-          keys = (List) registerContext.getKey();\n+              authorizeRequest.registerInterestListAuthorize(regionName, keys, policy);\n+          keys = (List<Object>) registerContext.getKey();\n         }\n       }\n       // Register interest\n       serverConnection.getAcceptor().getCacheClientNotifier().registerClientInterest(regionName,\n           keys, serverConnection.getProxyID(), isDurable, sendUpdatesAsInvalidates, true,\n           regionDataPolicyPartBytes[0], true);\n-    } catch (Exception ex) {\n+    } catch (Exception e) {\n       // If an interrupted exception is thrown , rethrow it\n-      checkForInterrupt(serverConnection, ex);\n+      checkForInterrupt(serverConnection, e);\n       // Otherwise, write an exception message and continue\n-      writeChunkedException(clientMessage, ex, serverConnection);\n+      writeChunkedException(clientMessage, e, serverConnection);\n       serverConnection.setAsTrue(RESPONDED);\n       return;\n     }\n \n-    boolean isPrimary = serverConnection.getAcceptor().getCacheClientNotifier()\n-        .getClientProxy(serverConnection.getProxyID()).isPrimary();\n+    CacheClientProxy ccp = serverConnection.getAcceptor().getCacheClientNotifier()\n+        .getClientProxy(serverConnection.getProxyID());\n+\n+    if (ccp == null) {\n+      IOException ioException = new IOException(\n+          \"CacheClientProxy for this client is no longer on the server , so registerInterest operation is unsuccessful\");", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e5ec401afa4be0adb5c6f7927ee4df60fd7d9991"}, "originalPosition": 97}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ef0c4958a61bf870e5287623f27ba29e07a42fe9", "author": {"user": {"login": "mhansonp", "name": null}}, "url": "https://github.com/apache/geode/commit/ef0c4958a61bf870e5287623f27ba29e07a42fe9", "committedDate": "2020-07-15T20:02:04Z", "message": "GEODE-8395: more cleanup and propogating the fix"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "06398f88528f673294b883002c1b1132ebe30728", "author": {"user": {"login": "mhansonp", "name": null}}, "url": "https://github.com/apache/geode/commit/06398f88528f673294b883002c1b1132ebe30728", "committedDate": "2020-07-15T20:05:36Z", "message": "GEODE-8359: A touch more cleanup..."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d6e4b911e594e35b04b7f3942e67da77a01272a8", "author": {"user": {"login": "mhansonp", "name": null}}, "url": "https://github.com/apache/geode/commit/d6e4b911e594e35b04b7f3942e67da77a01272a8", "committedDate": "2020-07-15T20:11:13Z", "message": "GEODE-8359: A touch more cleanup, again..."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "9edffdf727a17ee65a0781aba1d6e3f1709fdff3", "author": {"user": {"login": "mhansonp", "name": null}}, "url": "https://github.com/apache/geode/commit/9edffdf727a17ee65a0781aba1d6e3f1709fdff3", "committedDate": "2020-07-15T20:17:51Z", "message": "GEODE-8359: Spotless"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "0e28bec17350fc79d3f3c656c918282839bfeb1c", "author": {"user": {"login": "mhansonp", "name": null}}, "url": "https://github.com/apache/geode/commit/0e28bec17350fc79d3f3c656c918282839bfeb1c", "committedDate": "2020-07-15T20:44:19Z", "message": "GEODE-8359: Inconsistency."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDUwMTExODgw", "url": "https://github.com/apache/geode/pull/5371#pullrequestreview-450111880", "createdAt": "2020-07-16T18:35:27Z", "commit": {"oid": "0e28bec17350fc79d3f3c656c918282839bfeb1c"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4385, "cost": 1, "resetAt": "2021-10-29T19:57:52Z"}}}