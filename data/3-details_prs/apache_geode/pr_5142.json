{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDIxMDQxNzEy", "number": 5142, "title": "GEODE-8138: Improve semantics of the redis-port option", "bodyText": "Introduce a Geode parameter - redis-enabled which is false by default. This parameter determines whether the service is started or not.\nSet the default redis-port value to 6379\nredis-port range is 0..65535\nWhen redis-port=0, and redis-enabled=true the service will start on an ephemeral port.\nWhen gfsh is used with --redis-port, --redis-password, or --redis-bind-address, it should automatically set redis-enabled=true\n\ngemfire_properties.html.md.erb updated as part of this PR: #5130", "createdAt": "2020-05-20T22:00:48Z", "url": "https://github.com/apache/geode/pull/5142", "merged": true, "mergeCommit": {"oid": "d47e0733bc77d4863a013442e45aaad3ec990947"}, "closed": true, "closedAt": "2020-05-22T19:40:19Z", "author": {"login": "sabbey37"}, "timelineItems": {"totalCount": 9, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcjTNW0gFqTQxNTgxNDEwMA==", "endCursor": "Y3Vyc29yOnYyOpPPAAABcj1C6hgH2gAyNDIxMDQxNzEyOjUxYjlhN2E4MzIyNjM3MTM5YjEyYTE5YzQ5YTQ5YTVmYzRjOGE4MjE=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDE1ODE0MTAw", "url": "https://github.com/apache/geode/pull/5142#pullrequestreview-415814100", "createdAt": "2020-05-21T01:05:17Z", "commit": {"oid": "1b7ecd8bc2594452ade73a4f1c957dc5937b4ba2"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yMVQwMTowNToxN1rOGYi56g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yMVQwMToxNTo1M1rOGYjDnw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyODM5MDg5MA==", "bodyText": "Is the default now 6379? Also I think you want a \".\" at the end of the sentence.", "url": "https://github.com/apache/geode/pull/5142#discussion_r428390890", "createdAt": "2020-05-21T01:05:17Z", "author": {"login": "dschneider-pivotal"}, "path": "geode-core/src/main/java/org/apache/geode/distributed/internal/AbstractDistributionConfig.java", "diffHunk": "@@ -1312,11 +1313,13 @@ static Class _getAttributeType(String attName) {\n     m.put(MEMCACHED_BIND_ADDRESS,\n         \"The address the GemFireMemcachedServer will listen on for remote connections. Default is \\\"\\\" which causes the GemFireMemcachedServer to listen on the host's default address. This property is ignored if memcached-port is \\\"0\\\".\");\n     m.put(REDIS_PORT,\n-        \"The port GeodeRedisServer will listen on. Default is 0. Set to zero to disable GeodeRedisServer.\");\n+        \"The port Redis API for Geode will listen on. Default is 0\");", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "1b7ecd8bc2594452ade73a4f1c957dc5937b4ba2"}, "originalPosition": 13}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyODM5MTY3Mw==", "bodyText": "For gfsh start server I thought the default would be 6379", "url": "https://github.com/apache/geode/pull/5142#discussion_r428391673", "createdAt": "2020-05-21T01:08:47Z", "author": {"login": "dschneider-pivotal"}, "path": "geode-core/src/main/java/org/apache/geode/management/internal/i18n/CliStrings.java", "diffHunk": "@@ -2557,14 +2557,14 @@\n       \"The gemfire.properties file for configuring the Cache Server's distributed system. The file's path can be absolute or relative to the gfsh working directory.\";\n   public static final String START_SERVER__REDIS_PORT = ConfigurationProperties.REDIS_PORT;\n   public static final String START_SERVER__REDIS_PORT__HELP =\n-      \"Sets the port that the Geode Redis service listens on for Redis clients.\";\n+      \"Sets the port that the Redis API for Geode server listens on for Redis clients. The default is an ephemeral port\";", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "1b7ecd8bc2594452ade73a4f1c957dc5937b4ba2"}, "originalPosition": 5}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyODM5MjI0MA==", "bodyText": "I see this checking the password and bindAddress setting. But shouldn't it also be checking the redisPort? The comment says port and bind-address. Perhaps any redis option (including password) should enable redis.", "url": "https://github.com/apache/geode/pull/5142#discussion_r428392240", "createdAt": "2020-05-21T01:11:01Z", "author": {"login": "dschneider-pivotal"}, "path": "geode-gfsh/src/main/java/org/apache/geode/management/internal/cli/commands/StartServerCommand.java", "diffHunk": "@@ -301,6 +301,13 @@ ResultModel doStartServer(String memberName, Boolean assignBuckets, String bindA\n         ConfigurationProperties.HTTP_SERVICE_PORT, httpServicePort);\n     StartMemberUtils.setPropertyIfNotNull(gemfireProperties,\n         ConfigurationProperties.HTTP_SERVICE_BIND_ADDRESS, httpServiceBindAddress);\n+\n+    // if redis-port or redis-bind-address are specified in the command line,\n+    // REDIS_SERVICE_ENABLED should be set to true\n+    if (StringUtils.isNotBlank(redisPassword) || StringUtils.isNotBlank(redisBindAddress)) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "1b7ecd8bc2594452ade73a4f1c957dc5937b4ba2"}, "originalPosition": 7}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyODM5Mjc2OQ==", "bodyText": "Should this use RANDOM_PORT_INDICATOR instead of 0?", "url": "https://github.com/apache/geode/pull/5142#discussion_r428392769", "createdAt": "2020-05-21T01:13:21Z", "author": {"login": "dschneider-pivotal"}, "path": "geode-redis/src/main/java/org/apache/geode/redis/internal/GeodeRedisServer.java", "diffHunk": "@@ -241,7 +241,7 @@ private int setNumWorkerThreads() {\n    * to the first non-loopback address\n    */\n   public GeodeRedisServer() {\n-    this(null, -1, null);\n+    this(null, 0, null);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "1b7ecd8bc2594452ade73a4f1c957dc5937b4ba2"}, "originalPosition": 14}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyODM5MzM3NQ==", "bodyText": "Is it correct that if it is < RANDOM_PORT_INDICATOR it will use the default? I couldn't find the code that made that happen but it seems odd if I say -33456 it will listen on 6379. I think I'd prefer an IllegalArgumentException", "url": "https://github.com/apache/geode/pull/5142#discussion_r428393375", "createdAt": "2020-05-21T01:15:53Z", "author": {"login": "dschneider-pivotal"}, "path": "geode-redis/src/main/java/org/apache/geode/redis/internal/GeodeRedisServer.java", "diffHunk": "@@ -275,7 +275,8 @@ public GeodeRedisServer(String bindAddress, int port) {\n    *\n    * @param bindAddress The address to which the server will attempt to bind to\n    * @param port The port the server will bind to, will use {@value #DEFAULT_REDIS_SERVER_PORT}\n-   *        by default if argument is less than -1. If the port is {@value #RANDOM_PORT_INDICATOR}\n+   *        by default if argument is less than {@value #RANDOM_PORT_INDICATOR}. If the port is", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "1b7ecd8bc2594452ade73a4f1c957dc5937b4ba2"}, "originalPosition": 23}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDE2MjcyNjA4", "url": "https://github.com/apache/geode/pull/5142#pullrequestreview-416272608", "createdAt": "2020-05-21T15:50:24Z", "commit": {"oid": "e9538c719bf89c6033b02e4e9d1258e9548cf95a"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDE2NjA0NTY1", "url": "https://github.com/apache/geode/pull/5142#pullrequestreview-416604565", "createdAt": "2020-05-22T02:10:08Z", "commit": {"oid": "e9538c719bf89c6033b02e4e9d1258e9548cf95a"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yMlQwMjoxMDowOFrOGZIgyg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yMlQwMjoxMDowOFrOGZIgyg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTAwNzA1MA==", "bodyText": "Why add in the word \"service\" here? Why not just \"redis-enabled\". None of the other redis properties use the word \"service\". I think consistent naming conventions are really important to avoid confusion.", "url": "https://github.com/apache/geode/pull/5142#discussion_r429007050", "createdAt": "2020-05-22T02:10:08Z", "author": {"login": "pivotal-jbarrett"}, "path": "geode-core/src/main/java/org/apache/geode/distributed/ConfigurationProperties.java", "diffHunk": "@@ -1943,6 +1931,36 @@\n    * <U>Default</U>: \"\"\n    */\n   String REDIS_PASSWORD = \"redis-password\";\n+  /**\n+   * The static String definition of the <i>\"redis-port\"</i> property <a name=\"redis-port\"/a>\n+   * </p>\n+   * <U>Description</U>: Specifies the port used by Redis API for Geode which enables Redis\n+   * clients to connect and store data in GemFire distributed system. A value of 0 will select a\n+   * random port.\n+   * </p>\n+   * <U>Default</U>: \"6379\"\n+   * </p>\n+   * <U>Allowed values</U>: 0..65535\n+   */\n+  String REDIS_PORT = \"redis-port\";\n+  /**\n+   * The static String definition of the <i>\"redis-service-enabled\"</i> property <a\n+   * name=\"redis-service-enabled\"/a>\n+   * </p>\n+   * <U>Description</U>: When the default value of false, the Redis API for Geode is not available.\n+   * Set to true to enable the Redis API for Geode.</td>\n+   * </p>\n+   * <U>Default</U>: false\n+   * <td>redis-service-enabled</td>\n+   * <td>When the default value of false, the Redis API for <%=vars.product_name%> is not available.\n+   * Set\n+   * to true to enable the Redis API for <%=vars.product_name%>.</td>\n+   * <td>S</td>\n+   * <td>false</td>\n+   * </tr>\n+   * </p>\n+   */\n+  String REDIS_SERVICE_ENABLED = \"redis-service-enabled\";", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e9538c719bf89c6033b02e4e9d1258e9548cf95a"}, "originalPosition": 52}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "55abf986dc4db4448fde92974fc6f215ae30534f", "author": {"user": {"login": "sabbey37", "name": "Sarah"}}, "url": "https://github.com/apache/geode/commit/55abf986dc4db4448fde92974fc6f215ae30534f", "committedDate": "2020-05-22T14:26:34Z", "message": "GEODE-8138: Improve semantics of the redis-port option"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "e9538c719bf89c6033b02e4e9d1258e9548cf95a", "author": {"user": {"login": "sabbey37", "name": "Sarah"}}, "url": "https://github.com/apache/geode/commit/e9538c719bf89c6033b02e4e9d1258e9548cf95a", "committedDate": "2020-05-21T15:30:25Z", "message": "Fixes startserver integration tests"}, "afterCommit": {"oid": "55abf986dc4db4448fde92974fc6f215ae30534f", "author": {"user": {"login": "sabbey37", "name": "Sarah"}}, "url": "https://github.com/apache/geode/commit/55abf986dc4db4448fde92974fc6f215ae30534f", "committedDate": "2020-05-22T14:26:34Z", "message": "GEODE-8138: Improve semantics of the redis-port option"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDE2OTU0ODEx", "url": "https://github.com/apache/geode/pull/5142#pullrequestreview-416954811", "createdAt": "2020-05-22T14:27:44Z", "commit": {"oid": "55abf986dc4db4448fde92974fc6f215ae30534f"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "5cf90de85a973ba8a54f286b0e683c38df3eaccd", "author": {"user": {"login": "sabbey37", "name": "Sarah"}}, "url": "https://github.com/apache/geode/commit/5cf90de85a973ba8a54f286b0e683c38df3eaccd", "committedDate": "2020-05-22T14:31:27Z", "message": "Updates property order"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "29dd9db84c38cf582ae6830b4c331b6cbc3e2224", "author": {"user": {"login": "sabbey37", "name": "Sarah"}}, "url": "https://github.com/apache/geode/commit/29dd9db84c38cf582ae6830b4c331b6cbc3e2224", "committedDate": "2020-05-22T14:40:48Z", "message": "more formatting changes"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "51b9a7a8322637139b12a19c49a49a5fc4c8a821", "author": {"user": {"login": "sabbey37", "name": "Sarah"}}, "url": "https://github.com/apache/geode/commit/51b9a7a8322637139b12a19c49a49a5fc4c8a821", "committedDate": "2020-05-22T16:41:35Z", "message": "ci trigger"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4567, "cost": 1, "resetAt": "2021-10-29T19:57:52Z"}}}