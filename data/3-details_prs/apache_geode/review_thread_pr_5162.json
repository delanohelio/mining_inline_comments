{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDIzMzgwNzI2", "number": 5162, "reviewThreads": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yOFQxNzoxNjozMVrOEAmgog==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yOFQxNzoxNjozMVrOEAmgog==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjY5MDY2NDAyOnYy", "diffSide": "RIGHT", "path": "geode-web/src/distributedTest/java/org/apache/geode/management/internal/cli/commands/ShutdownCommandOverHttpDUnitTest.java", "isResolved": false, "comments": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yOFQxNzoxNjozMVrOGb_Akw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yOFQyMjoyNToxNFrOGcI0wA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMTk5NzA3NQ==", "bodyText": "Is it preferable to use withFailMessage than as for this case?", "url": "https://github.com/apache/geode/pull/5162#discussion_r431997075", "createdAt": "2020-05-28T17:16:31Z", "author": {"login": "jchen21"}, "path": "geode-web/src/distributedTest/java/org/apache/geode/management/internal/cli/commands/ShutdownCommandOverHttpDUnitTest.java", "diffHunk": "@@ -96,48 +93,61 @@ public void setup() throws Exception {\n \n     locatorString = \"localhost[\" + locatorPort + \"]\";\n \n-    locator.invoke(\n-        () -> startLocator(locatorDir, locatorPort, locatorJmxPort, locatorHttpPort));\n+    locator.invoke(() -> startLocator(locatorDir, locatorPort, locatorJmxPort, locatorHttpPort));\n     server1.invoke(() -> startServer(SERVER1_NAME, server1Dir, locatorString));\n     server2.invoke(() -> startServer(SERVER2_NAME, server2Dir, locatorString));\n \n     gfsh.connectAndVerify(locatorHttpPort, PortType.http);\n+\n+    addIgnoredException(DistributedSystemDisconnectedException.class);\n   }\n \n   @Test\n   public void testShutdownServers() {\n     String command = \"shutdown\";\n \n-    gfsh.executeAndAssertThat(command).statusIsSuccess().containsOutput(\"Shutdown is triggered\");\n+    gfsh.executeAndAssertThat(command)\n+        .statusIsSuccess()\n+        .containsOutput(\"Shutdown is triggered\");\n \n     for (VM vm : toArray(server1, server2)) {\n       vm.invoke(() -> verifyNotConnected(SERVER_LAUNCHER.get().getCache()));\n     }\n \n-    gfsh.executeAndAssertThat(\"list members\").statusIsSuccess();\n+    gfsh.executeAndAssertThat(\"list members\")\n+        .statusIsSuccess();\n+\n     assertThat(gfsh.getGfshOutput()).contains(\"locator\");\n   }\n \n   @Test\n   public void testShutdownAll() {\n     String command = \"shutdown --include-locators=true\";\n \n-    gfsh.executeAndAssertThat(command).statusIsSuccess().containsOutput(\"Shutdown is triggered\");\n+    gfsh.executeAndAssertThat(command)\n+        .statusIsSuccess()\n+        .containsOutput(\"Shutdown is triggered\");\n+\n     server1.invoke(() -> verifyNotConnected(SERVER_LAUNCHER.get().getCache()));\n     server2.invoke(() -> verifyNotConnected(SERVER_LAUNCHER.get().getCache()));\n     locator.invoke(() -> verifyNotConnected(LOCATOR_LAUNCHER.get().getCache()));\n   }\n \n   private void verifyNotConnected(Cache cache) {\n-    await().untilAsserted(() -> assertThat(cache.getDistributedSystem().isConnected()).isFalse());\n+    await().untilAsserted(() -> {\n+      assertThat(cache.getDistributedSystem().isConnected())\n+          .as(\"cache.getDistributedSystem().isConnected()\")", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "028c1e806092f5ad2f7479e6925e2627e83f1040"}, "originalPosition": 100}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMjE1NDE4OA==", "bodyText": "I use as to indicate an alias for the subject of the assertion, and withFailMessage as a full replacement of the failure message.\ndistributed system isConnected is probably a better example of English for an as in this case. It's kind of interesting to compare the output when using as vs withFailMessage.\nUsing as:\norg.junit.ComparisonFailure: [cache.getDistributedSystem().isConnected()] \nExpected :false\nActual   :true\n <Click to see difference>\n\n\n\tat sun.reflect.NativeConstructorAccessorImpl.newInstance0(Native Method)\n\tat sun.reflect.NativeConstructorAccessorImpl.newInstance(NativeConstructorAccessorImpl.java:62)\n\tat sun.reflect.DelegatingConstructorAccessorImpl.newInstance(DelegatingConstructorAccessorImpl.java:45)\n\tat org.apache.geode.test.awaitility.WithFailMessageTest.foo(WithFailMessageTest.java:79)\n\nUsing withFailMessage:\njava.lang.AssertionError: cache.getDistributedSystem().isConnected()\n\n\tat org.apache.geode.test.awaitility.WithFailMessageTest.foo(WithFailMessageTest.java:79)\n\nSo I only use withFailMessage if I want to actually suppress and replace the native assertion failure message.", "url": "https://github.com/apache/geode/pull/5162#discussion_r432154188", "createdAt": "2020-05-28T22:15:07Z", "author": {"login": "kirklund"}, "path": "geode-web/src/distributedTest/java/org/apache/geode/management/internal/cli/commands/ShutdownCommandOverHttpDUnitTest.java", "diffHunk": "@@ -96,48 +93,61 @@ public void setup() throws Exception {\n \n     locatorString = \"localhost[\" + locatorPort + \"]\";\n \n-    locator.invoke(\n-        () -> startLocator(locatorDir, locatorPort, locatorJmxPort, locatorHttpPort));\n+    locator.invoke(() -> startLocator(locatorDir, locatorPort, locatorJmxPort, locatorHttpPort));\n     server1.invoke(() -> startServer(SERVER1_NAME, server1Dir, locatorString));\n     server2.invoke(() -> startServer(SERVER2_NAME, server2Dir, locatorString));\n \n     gfsh.connectAndVerify(locatorHttpPort, PortType.http);\n+\n+    addIgnoredException(DistributedSystemDisconnectedException.class);\n   }\n \n   @Test\n   public void testShutdownServers() {\n     String command = \"shutdown\";\n \n-    gfsh.executeAndAssertThat(command).statusIsSuccess().containsOutput(\"Shutdown is triggered\");\n+    gfsh.executeAndAssertThat(command)\n+        .statusIsSuccess()\n+        .containsOutput(\"Shutdown is triggered\");\n \n     for (VM vm : toArray(server1, server2)) {\n       vm.invoke(() -> verifyNotConnected(SERVER_LAUNCHER.get().getCache()));\n     }\n \n-    gfsh.executeAndAssertThat(\"list members\").statusIsSuccess();\n+    gfsh.executeAndAssertThat(\"list members\")\n+        .statusIsSuccess();\n+\n     assertThat(gfsh.getGfshOutput()).contains(\"locator\");\n   }\n \n   @Test\n   public void testShutdownAll() {\n     String command = \"shutdown --include-locators=true\";\n \n-    gfsh.executeAndAssertThat(command).statusIsSuccess().containsOutput(\"Shutdown is triggered\");\n+    gfsh.executeAndAssertThat(command)\n+        .statusIsSuccess()\n+        .containsOutput(\"Shutdown is triggered\");\n+\n     server1.invoke(() -> verifyNotConnected(SERVER_LAUNCHER.get().getCache()));\n     server2.invoke(() -> verifyNotConnected(SERVER_LAUNCHER.get().getCache()));\n     locator.invoke(() -> verifyNotConnected(LOCATOR_LAUNCHER.get().getCache()));\n   }\n \n   private void verifyNotConnected(Cache cache) {\n-    await().untilAsserted(() -> assertThat(cache.getDistributedSystem().isConnected()).isFalse());\n+    await().untilAsserted(() -> {\n+      assertThat(cache.getDistributedSystem().isConnected())\n+          .as(\"cache.getDistributedSystem().isConnected()\")", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMTk5NzA3NQ=="}, "originalCommit": {"oid": "028c1e806092f5ad2f7479e6925e2627e83f1040"}, "originalPosition": 100}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMjE1NDkzMQ==", "bodyText": "And this is the same assertion failure without as or withFailMessage:\norg.junit.ComparisonFailure: \nExpected :false\nActual   :true\n <Click to see difference>\n\n\n\tat sun.reflect.NativeConstructorAccessorImpl.newInstance0(Native Method)\n\tat sun.reflect.NativeConstructorAccessorImpl.newInstance(NativeConstructorAccessorImpl.java:62)\n\tat sun.reflect.DelegatingConstructorAccessorImpl.newInstance(DelegatingConstructorAccessorImpl.java:45)\n\tat org.apache.geode.test.awaitility.WithFailMessageTest.foo(WithFailMessageTest.java:78)", "url": "https://github.com/apache/geode/pull/5162#discussion_r432154931", "createdAt": "2020-05-28T22:17:02Z", "author": {"login": "kirklund"}, "path": "geode-web/src/distributedTest/java/org/apache/geode/management/internal/cli/commands/ShutdownCommandOverHttpDUnitTest.java", "diffHunk": "@@ -96,48 +93,61 @@ public void setup() throws Exception {\n \n     locatorString = \"localhost[\" + locatorPort + \"]\";\n \n-    locator.invoke(\n-        () -> startLocator(locatorDir, locatorPort, locatorJmxPort, locatorHttpPort));\n+    locator.invoke(() -> startLocator(locatorDir, locatorPort, locatorJmxPort, locatorHttpPort));\n     server1.invoke(() -> startServer(SERVER1_NAME, server1Dir, locatorString));\n     server2.invoke(() -> startServer(SERVER2_NAME, server2Dir, locatorString));\n \n     gfsh.connectAndVerify(locatorHttpPort, PortType.http);\n+\n+    addIgnoredException(DistributedSystemDisconnectedException.class);\n   }\n \n   @Test\n   public void testShutdownServers() {\n     String command = \"shutdown\";\n \n-    gfsh.executeAndAssertThat(command).statusIsSuccess().containsOutput(\"Shutdown is triggered\");\n+    gfsh.executeAndAssertThat(command)\n+        .statusIsSuccess()\n+        .containsOutput(\"Shutdown is triggered\");\n \n     for (VM vm : toArray(server1, server2)) {\n       vm.invoke(() -> verifyNotConnected(SERVER_LAUNCHER.get().getCache()));\n     }\n \n-    gfsh.executeAndAssertThat(\"list members\").statusIsSuccess();\n+    gfsh.executeAndAssertThat(\"list members\")\n+        .statusIsSuccess();\n+\n     assertThat(gfsh.getGfshOutput()).contains(\"locator\");\n   }\n \n   @Test\n   public void testShutdownAll() {\n     String command = \"shutdown --include-locators=true\";\n \n-    gfsh.executeAndAssertThat(command).statusIsSuccess().containsOutput(\"Shutdown is triggered\");\n+    gfsh.executeAndAssertThat(command)\n+        .statusIsSuccess()\n+        .containsOutput(\"Shutdown is triggered\");\n+\n     server1.invoke(() -> verifyNotConnected(SERVER_LAUNCHER.get().getCache()));\n     server2.invoke(() -> verifyNotConnected(SERVER_LAUNCHER.get().getCache()));\n     locator.invoke(() -> verifyNotConnected(LOCATOR_LAUNCHER.get().getCache()));\n   }\n \n   private void verifyNotConnected(Cache cache) {\n-    await().untilAsserted(() -> assertThat(cache.getDistributedSystem().isConnected()).isFalse());\n+    await().untilAsserted(() -> {\n+      assertThat(cache.getDistributedSystem().isConnected())\n+          .as(\"cache.getDistributedSystem().isConnected()\")", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMTk5NzA3NQ=="}, "originalCommit": {"oid": "028c1e806092f5ad2f7479e6925e2627e83f1040"}, "originalPosition": 100}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMjE1Nzg4OA==", "bodyText": "Thank you for the explanation and examples!", "url": "https://github.com/apache/geode/pull/5162#discussion_r432157888", "createdAt": "2020-05-28T22:25:14Z", "author": {"login": "jchen21"}, "path": "geode-web/src/distributedTest/java/org/apache/geode/management/internal/cli/commands/ShutdownCommandOverHttpDUnitTest.java", "diffHunk": "@@ -96,48 +93,61 @@ public void setup() throws Exception {\n \n     locatorString = \"localhost[\" + locatorPort + \"]\";\n \n-    locator.invoke(\n-        () -> startLocator(locatorDir, locatorPort, locatorJmxPort, locatorHttpPort));\n+    locator.invoke(() -> startLocator(locatorDir, locatorPort, locatorJmxPort, locatorHttpPort));\n     server1.invoke(() -> startServer(SERVER1_NAME, server1Dir, locatorString));\n     server2.invoke(() -> startServer(SERVER2_NAME, server2Dir, locatorString));\n \n     gfsh.connectAndVerify(locatorHttpPort, PortType.http);\n+\n+    addIgnoredException(DistributedSystemDisconnectedException.class);\n   }\n \n   @Test\n   public void testShutdownServers() {\n     String command = \"shutdown\";\n \n-    gfsh.executeAndAssertThat(command).statusIsSuccess().containsOutput(\"Shutdown is triggered\");\n+    gfsh.executeAndAssertThat(command)\n+        .statusIsSuccess()\n+        .containsOutput(\"Shutdown is triggered\");\n \n     for (VM vm : toArray(server1, server2)) {\n       vm.invoke(() -> verifyNotConnected(SERVER_LAUNCHER.get().getCache()));\n     }\n \n-    gfsh.executeAndAssertThat(\"list members\").statusIsSuccess();\n+    gfsh.executeAndAssertThat(\"list members\")\n+        .statusIsSuccess();\n+\n     assertThat(gfsh.getGfshOutput()).contains(\"locator\");\n   }\n \n   @Test\n   public void testShutdownAll() {\n     String command = \"shutdown --include-locators=true\";\n \n-    gfsh.executeAndAssertThat(command).statusIsSuccess().containsOutput(\"Shutdown is triggered\");\n+    gfsh.executeAndAssertThat(command)\n+        .statusIsSuccess()\n+        .containsOutput(\"Shutdown is triggered\");\n+\n     server1.invoke(() -> verifyNotConnected(SERVER_LAUNCHER.get().getCache()));\n     server2.invoke(() -> verifyNotConnected(SERVER_LAUNCHER.get().getCache()));\n     locator.invoke(() -> verifyNotConnected(LOCATOR_LAUNCHER.get().getCache()));\n   }\n \n   private void verifyNotConnected(Cache cache) {\n-    await().untilAsserted(() -> assertThat(cache.getDistributedSystem().isConnected()).isFalse());\n+    await().untilAsserted(() -> {\n+      assertThat(cache.getDistributedSystem().isConnected())\n+          .as(\"cache.getDistributedSystem().isConnected()\")", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMTk5NzA3NQ=="}, "originalCommit": {"oid": "028c1e806092f5ad2f7479e6925e2627e83f1040"}, "originalPosition": 100}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4103, "cost": 1, "resetAt": "2021-11-11T21:28:48Z"}}}