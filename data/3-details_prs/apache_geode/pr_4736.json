{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0Mzc5OTE4Mzc3", "number": 4736, "title": "GEODE-7839: add gfsh oauth token support", "bodyText": "Thank you for submitting a contribution to Apache Geode.\nIn order to streamline the review of the contribution we ask you\nto ensure the following steps have been taken:\nFor all changes:\n\n\n Is there a JIRA ticket associated with this PR? Is it referenced in the commit message?\n\n\n Has your PR been rebased against the latest commit within the target branch (typically develop)?\n\n\n Is your initial contribution a single, squashed commit?\n\n\n Does gradlew build run cleanly?\n\n\n Have you written or updated unit tests to verify your changes?\n\n\n If adding new dependencies to the code, are these dependencies licensed in a way that is compatible for inclusion under ASF 2.0?\n\n\nNote:\nPlease ensure that once the PR is submitted, check Concourse for build issues and\nsubmit an update to your PR as soon as possible. If you need help, please send an\nemail to dev@geode.apache.org.", "createdAt": "2020-02-26T00:45:10Z", "url": "https://github.com/apache/geode/pull/4736", "merged": true, "mergeCommit": {"oid": "3ad4f1711562f928891e9ceb0e99532403ba2124"}, "closed": true, "closedAt": "2020-03-03T16:59:06Z", "author": {"login": "dschneider-pivotal"}, "timelineItems": {"totalCount": 17, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcEDdh-gH2gAyMzc5OTE4Mzc3OmQxZGY3NjE4MTNjN2ZmZWJhZWZkYmU2M2QwZGM4MTYwMzdjMmViN2Y=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcJ5IgkgFqTM2NzY3MDEzOA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "d1df761813c7ffebaefdbe63d0dc816037c2eb7f", "author": {"user": {"login": "jmelchio", "name": "Joris Melchior"}}, "url": "https://github.com/apache/geode/commit/d1df761813c7ffebaefdbe63d0dc816037c2eb7f", "committedDate": "2020-02-13T23:23:45Z", "message": "WIP - initial checkin\n\nCo-authored-by: Joris Melchior <joris.melchior@gmail.com>\nCo-authored-by: Darrel Schneider <dschneider@pivotal.io>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "cdbda6c525b2399a6acaaa7da1eeb007ebb192a2", "author": {"user": {"login": "jmelchio", "name": "Joris Melchior"}}, "url": "https://github.com/apache/geode/commit/cdbda6c525b2399a6acaaa7da1eeb007ebb192a2", "committedDate": "2020-02-14T16:13:57Z", "message": "Start of integration tests to verify token\n\nCo-authored-by: Joris Melchior <joris.melchior@gmail.com>\nCo-authored-by: Darrel Schneider <dschneider@pivotal.io>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "315c1a4d03896c920fa0de05f32e082c5cf91cc0", "author": {"user": {"login": "dschneider-pivotal", "name": "Darrel Schneider"}}, "url": "https://github.com/apache/geode/commit/315c1a4d03896c920fa0de05f32e082c5cf91cc0", "committedDate": "2020-02-14T17:52:08Z", "message": "ConnectCommand no longer retries if a TOKEN is being used. So the new token connect tests now fail (as expected)."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c1feac4b408e696f20fc98fa03b5af89b79054a7", "author": {"user": {"login": "dschneider-pivotal", "name": "Darrel Schneider"}}, "url": "https://github.com/apache/geode/commit/c1feac4b408e696f20fc98fa03b5af89b79054a7", "committedDate": "2020-02-14T18:42:06Z", "message": "jmx connect now works with a token"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "437631cac3f6a4903c0ae1bca1a7a914755b86ac", "author": {"user": {"login": "dschneider-pivotal", "name": "Darrel Schneider"}}, "url": "https://github.com/apache/geode/commit/437631cac3f6a4903c0ae1bca1a7a914755b86ac", "committedDate": "2020-02-14T19:13:00Z", "message": "http connect with token now works"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "350a05dc652f0210d8b86c9a6beb45f6597e0a68", "author": {"user": {"login": "jmelchio", "name": "Joris Melchior"}}, "url": "https://github.com/apache/geode/commit/350a05dc652f0210d8b86c9a6beb45f6597e0a68", "committedDate": "2020-02-19T17:21:02Z", "message": "Enable token acceptance for gfsh http connection\n\nAuthored-by: Joris Melchior <joris.melchior@gmail.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b37774744b2162a621e6ad0e2fca60eff04dd640", "author": {"user": {"login": "dschneider-pivotal", "name": "Darrel Schneider"}}, "url": "https://github.com/apache/geode/commit/b37774744b2162a621e6ad0e2fca60eff04dd640", "committedDate": "2020-02-19T17:23:26Z", "message": "Merge branch 'develop' into gfsh-token-support"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "787d05a0617fda4fe015068ae64a2998e88704d9", "author": {"user": {"login": "dschneider-pivotal", "name": "Darrel Schneider"}}, "url": "https://github.com/apache/geode/commit/787d05a0617fda4fe015068ae64a2998e88704d9", "committedDate": "2020-02-19T18:32:17Z", "message": "Merge branch 'develop' into gfsh-token-support"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e48a06d55ed261e831673b6a4632ce8f8393b61c", "author": {"user": {"login": "dschneider-pivotal", "name": "Darrel Schneider"}}, "url": "https://github.com/apache/geode/commit/e48a06d55ed261e831673b6a4632ce8f8393b61c", "committedDate": "2020-02-25T22:40:43Z", "message": "disabled setting AUTH_TOKEN_ENABLED_PARAM on ManagementAgent to see if tests will fail"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "92dc6238421bf360a9b2674b65b95c95ba9294e9", "author": {"user": {"login": "dschneider-pivotal", "name": "Darrel Schneider"}}, "url": "https://github.com/apache/geode/commit/92dc6238421bf360a9b2674b65b95c95ba9294e9", "committedDate": "2020-02-28T22:36:28Z", "message": "removed comment"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "97d0621cef5b445b464b16657db741ff2daa5301", "author": {"user": {"login": "dschneider-pivotal", "name": "Darrel Schneider"}}, "url": "https://github.com/apache/geode/commit/97d0621cef5b445b464b16657db741ff2daa5301", "committedDate": "2020-02-28T22:42:46Z", "message": "minor whitespace and comment cleanup"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzY2NzM1NjU2", "url": "https://github.com/apache/geode/pull/4736#pullrequestreview-366735656", "createdAt": "2020-02-28T23:05:05Z", "commit": {"oid": "97d0621cef5b445b464b16657db741ff2daa5301"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yOFQyMzowNTowNVrOFwFQnw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yOFQyMzowNTowNVrOFwFQnw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NTk2MjE0Mw==", "bodyText": "Like we discussed in the meeting, maybe checks for empty strings for username and password here as well, so that you don't need to deal with them anymore.", "url": "https://github.com/apache/geode/pull/4736#discussion_r385962143", "createdAt": "2020-02-28T23:05:05Z", "author": {"login": "jinmeiliao"}, "path": "geode-gfsh/src/main/java/org/apache/geode/management/internal/cli/commands/ConnectCommand.java", "diffHunk": "@@ -124,6 +126,14 @@ public ResultModel connect(\n       useSsl = true;\n     }\n \n+    if (\"\".equals(token)) {\n+      return ResultModel.createError(\"--token requires a value, for example --token=foo\");\n+    }\n+", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "97d0621cef5b445b464b16657db741ff2daa5301"}, "originalPosition": 22}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzY2NzM2NDU0", "url": "https://github.com/apache/geode/pull/4736#pullrequestreview-366736454", "createdAt": "2020-02-28T23:07:39Z", "commit": {"oid": "97d0621cef5b445b464b16657db741ff2daa5301"}, "state": "COMMENTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yOFQyMzowNzozOVrOFwFTEg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yOFQyMzowNzo1OFrOFwFTXA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NTk2Mjc3MA==", "bodyText": "this probably is not good. maybe use a unique string based on the token would be nice.", "url": "https://github.com/apache/geode/pull/4736#discussion_r385962770", "createdAt": "2020-02-28T23:07:39Z", "author": {"login": "jinmeiliao"}, "path": "geode-core/src/main/java/org/apache/geode/internal/security/shiro/JMXShiroAuthenticator.java", "diffHunk": "@@ -48,13 +48,16 @@ public JMXShiroAuthenticator(SecurityService securityService) {\n \n   @Override\n   public Subject authenticate(Object credentials) {\n-    String username = null;\n+    String username;\n     Properties credProps = new Properties();\n     if (credentials instanceof String[]) {\n       final String[] aCredentials = (String[]) credentials;\n       username = aCredentials[0];\n       credProps.setProperty(ResourceConstants.USER_NAME, aCredentials[0]);\n       credProps.setProperty(ResourceConstants.PASSWORD, aCredentials[1]);\n+    } else if (credentials instanceof String) {\n+      username = \"\";", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "97d0621cef5b445b464b16657db741ff2daa5301"}, "originalPosition": 13}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NTk2Mjg0NA==", "bodyText": "did we decide to do something about this now or later?", "url": "https://github.com/apache/geode/pull/4736#discussion_r385962844", "createdAt": "2020-02-28T23:07:58Z", "author": {"login": "jinmeiliao"}, "path": "geode-core/src/main/java/org/apache/geode/internal/security/shiro/JMXShiroAuthenticator.java", "diffHunk": "@@ -48,13 +48,16 @@ public JMXShiroAuthenticator(SecurityService securityService) {\n \n   @Override\n   public Subject authenticate(Object credentials) {\n-    String username = null;\n+    String username;\n     Properties credProps = new Properties();\n     if (credentials instanceof String[]) {\n       final String[] aCredentials = (String[]) credentials;\n       username = aCredentials[0];\n       credProps.setProperty(ResourceConstants.USER_NAME, aCredentials[0]);\n       credProps.setProperty(ResourceConstants.PASSWORD, aCredentials[1]);\n+    } else if (credentials instanceof String) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "97d0621cef5b445b464b16657db741ff2daa5301"}, "originalPosition": 12}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f14042e5b978b3cc2271d02c61064fbca1020f5f", "author": {"user": {"login": "dschneider-pivotal", "name": "Darrel Schneider"}}, "url": "https://github.com/apache/geode/commit/f14042e5b978b3cc2271d02c61064fbca1020f5f", "committedDate": "2020-02-28T23:48:46Z", "message": "added --token docs for gfsh connect"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "26b20f9b5f47073491b3806f1f19082ebdd7e3fe", "author": {"user": {"login": "dschneider-pivotal", "name": "Darrel Schneider"}}, "url": "https://github.com/apache/geode/commit/26b20f9b5f47073491b3806f1f19082ebdd7e3fe", "committedDate": "2020-03-02T19:36:47Z", "message": "some docs fixes based on pr review"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "cfa74a3936dc9ef3826f9cceac5e817ecf787168", "author": {"user": {"login": "dschneider-pivotal", "name": "Darrel Schneider"}}, "url": "https://github.com/apache/geode/commit/cfa74a3936dc9ef3826f9cceac5e817ecf787168", "committedDate": "2020-03-02T19:48:06Z", "message": "for the corner case of using a TOKEN but the SecurityManager\nnot returning a shiroSubject, the user name will now be\n\"token-\" followed by the hashCode of the given token."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzY3NjcwMTM4", "url": "https://github.com/apache/geode/pull/4736#pullrequestreview-367670138", "createdAt": "2020-03-03T02:45:17Z", "commit": {"oid": "cfa74a3936dc9ef3826f9cceac5e817ecf787168"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4966, "cost": 1, "resetAt": "2021-10-29T19:57:52Z"}}}