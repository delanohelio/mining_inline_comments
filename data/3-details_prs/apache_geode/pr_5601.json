{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDk5MzczODk4", "number": 5601, "title": "GEODE-8603: Potentially expand classes identified for CI stressing to include subclasses", "bodyText": "Expand any classes targeted by StressNewTest to also include sub classes.\nThis is so that we don't miss coverage if an abstract class, containing tests, is really\nexecuted through a concrete class which did not also change.", "createdAt": "2020-10-07T16:28:33Z", "url": "https://github.com/apache/geode/pull/5601", "merged": true, "mergeCommit": {"oid": "8bfe58ffc5b2fd916071d7a9e1d65e8fe8c6b08c"}, "closed": true, "closedAt": "2020-10-26T13:23:14Z", "author": {"login": "jdeppe-pivotal"}, "timelineItems": {"totalCount": 26, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdQPkMcAH2gAyNDk5MzczODk4OmQ2MzlmNzM1MDZkZmI2MDM3MTdhYThiMjdiNTVkOTlmN2RjYWE0NWU=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdVIO95AH2gAyNDk5MzczODk4OjQ3ZTYzNzIyOGQwNGM2ZmE4Yjk4ZmY5M2FlNzU2NDQ1NzE3MWYzNTE=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "d639f73506dfb603717aa8b27b55d99f7dcaa45e", "author": {"user": {"login": "jdeppe-pivotal", "name": "Jens Deppe"}}, "url": "https://github.com/apache/geode/commit/d639f73506dfb603717aa8b27b55d99f7dcaa45e", "committedDate": "2020-10-07T16:28:08Z", "message": "Expand sub classes indicated by StressNewTest"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "621887640458141efeed483a195054b866ed3c82", "author": {"user": {"login": "jdeppe-pivotal", "name": "Jens Deppe"}}, "url": "https://github.com/apache/geode/commit/621887640458141efeed483a195054b866ed3c82", "committedDate": "2020-10-07T16:55:54Z", "message": "Enable debug output"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "23953a5cf9c79fe7a5d6d8661177e7cd45258037", "author": {"user": {"login": "jdeppe-pivotal", "name": "Jens Deppe"}}, "url": "https://github.com/apache/geode/commit/23953a5cf9c79fe7a5d6d8661177e7cd45258037", "committedDate": "2020-10-07T17:28:44Z", "message": "Shaving the yak"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "42221e5244b8ba0b55032cf191131faa5d7497a5", "author": {"user": {"login": "jdeppe-pivotal", "name": "Jens Deppe"}}, "url": "https://github.com/apache/geode/commit/42221e5244b8ba0b55032cf191131faa5d7497a5", "committedDate": "2020-10-07T18:08:06Z", "message": "Fix checkPom and minor cleanup"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "04c938d29027443e215784541064e375b3fb0844", "author": {"user": {"login": "jdeppe-pivotal", "name": "Jens Deppe"}}, "url": "https://github.com/apache/geode/commit/04c938d29027443e215784541064e375b3fb0844", "committedDate": "2020-10-08T15:02:32Z", "message": "Order classpath correctly and run devBuild and printTestClasspath separately\n\nAuthored-by: Jens Deppe <jdeppe@vmware.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b4960327cc54fdc8690c798e7122005500971e56", "author": {"user": {"login": "jdeppe-pivotal", "name": "Jens Deppe"}}, "url": "https://github.com/apache/geode/commit/b4960327cc54fdc8690c798e7122005500971e56", "committedDate": "2020-10-08T16:26:47Z", "message": "Also work with actual java files"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a9edb3bef35d2d23c1e210f4e521d0569785f4dc", "author": {"user": {"login": "jdeppe-pivotal", "name": "Jens Deppe"}}, "url": "https://github.com/apache/geode/commit/a9edb3bef35d2d23c1e210f4e521d0569785f4dc", "committedDate": "2020-10-08T16:43:57Z", "message": "Improved log messages"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "55e1a5793cbbe281547ed24963bcaf5074cb7067", "author": {"user": {"login": "jdeppe-pivotal", "name": "Jens Deppe"}}, "url": "https://github.com/apache/geode/commit/55e1a5793cbbe281547ed24963bcaf5074cb7067", "committedDate": "2020-10-08T17:03:58Z", "message": "Fix bash syntax error"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTA1MTI2MDkz", "url": "https://github.com/apache/geode/pull/5601#pullrequestreview-505126093", "createdAt": "2020-10-08T20:06:07Z", "commit": {"oid": "55e1a5793cbbe281547ed24963bcaf5074cb7067"}, "state": "APPROVED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wOFQyMDowNjowN1rOHeujXg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wOFQyMDowNjowN1rOHeujXg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMTk4MjA0Ng==", "bodyText": "Is this possibly missing running concrete classes that also have subclasses? Like someone extended a real test with more subclasses?", "url": "https://github.com/apache/geode/pull/5601#discussion_r501982046", "createdAt": "2020-10-08T20:06:07Z", "author": {"login": "upthewaterspout"}, "path": "geode-junit/src/main/java/org/apache/geode/test/util/ClassScanner.java", "diffHunk": "@@ -0,0 +1,98 @@\n+/*\n+ * Licensed to the Apache Software Foundation (ASF) under one or more contributor license\n+ * agreements. See the NOTICE file distributed with this work for additional information regarding\n+ * copyright ownership. The ASF licenses this file to You under the Apache License, Version 2.0 (the\n+ * \"License\"); you may not use this file except in compliance with the License. You may obtain a\n+ * copy of the License at\n+ *\n+ * http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software distributed under the License\n+ * is distributed on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express\n+ * or implied. See the License for the specific language governing permissions and limitations under\n+ * the License.\n+ */\n+\n+package org.apache.geode.test.util;\n+\n+import java.io.File;\n+import java.util.Arrays;\n+import java.util.HashSet;\n+import java.util.List;\n+import java.util.Set;\n+import java.util.stream.Collectors;\n+\n+import io.github.classgraph.ClassGraph;\n+import io.github.classgraph.ClassInfo;\n+import io.github.classgraph.ScanResult;\n+\n+/**\n+ * This class is intended as a helper to the CI StressNewTest job.\n+ */\n+public class ClassScanner {\n+\n+  private ScanResult scanResult;\n+  private String packageToScan;\n+\n+  public ClassScanner(String packageToScan) {\n+    this.packageToScan = packageToScan;\n+    scanResult = new ClassGraph().whitelistPackages(packageToScan)\n+        .enableClassInfo()\n+        .enableAnnotationInfo().scan();\n+  }\n+\n+  public List<String> whatExtends(String classOrFile) {\n+    Set<String> classesToConsider = new HashSet<>();\n+    classesToConsider.add(pathToClass(classOrFile));\n+\n+    if (!classOrFile.contains(\".\")) {\n+      classesToConsider.addAll(fullyQualifyClass(classOrFile));\n+    }\n+\n+    return classesToConsider.stream()\n+        .flatMap(x -> scanResult.getSubclasses(x).stream().map(ClassInfo::getSimpleName))", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "55e1a5793cbbe281547ed24963bcaf5074cb7067"}, "originalPosition": 53}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTA1MTc5MjQ0", "url": "https://github.com/apache/geode/pull/5601#pullrequestreview-505179244", "createdAt": "2020-10-08T21:28:38Z", "commit": {"oid": "55e1a5793cbbe281547ed24963bcaf5074cb7067"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wOFQyMToyODozOFrOHexDdw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wOFQyMToyODozOFrOHexDdw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMjAyMzAzMQ==", "bodyText": "What is the behavior if devBuild has not been run first?", "url": "https://github.com/apache/geode/pull/5601#discussion_r502023031", "createdAt": "2020-10-08T21:28:38Z", "author": {"login": "rhoughton-pivot"}, "path": "ci/scripts/repeat-new-tests.sh", "diffHunk": "@@ -46,26 +46,56 @@ function changes_for_path() {\n   popd >> /dev/null\n }\n \n-UNIT_TEST_CHANGES=$(changes_for_path '*/src/test/java') || exit $?\n-INTEGRATION_TEST_CHANGES=$(changes_for_path '*/src/integrationTest/java') || exit $?\n-DISTRIBUTED_TEST_CHANGES=$(changes_for_path '*/src/distributedTest/java') || exit $?\n-ACCEPTANCE_TEST_CHANGES=$(changes_for_path '*/src/acceptanceTest/java') || exit $?\n-UPGRADE_TEST_CHANGES=$(changes_for_path '*/src/upgradeTest/java') || exit $?\n+function save_classpath() {\n+  echo \"Building and saving classpath\"\n+  pushd geode >> /dev/null\n+    # Do this twice since devBuild still dumps a warning string to stdout.\n+    ./gradlew --console=plain -q devBuild 2>/dev/null\n+    ./gradlew --console=plain -q printTestClasspath 2>/dev/null >/tmp/classpath.txt", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "55e1a5793cbbe281547ed24963bcaf5074cb7067"}, "originalPosition": 14}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "1c5b191b9fe3c7a756885a09e492694e6eef9461", "author": {"user": {"login": "jdeppe-pivotal", "name": "Jens Deppe"}}, "url": "https://github.com/apache/geode/commit/1c5b191b9fe3c7a756885a09e492694e6eef9461", "committedDate": "2020-10-12T15:58:28Z", "message": "Make StressNewTestHelper create the complete gradle test task commands\n\n- Since some tests may have subclasses in different source sets, (which\n  would require a different repeat task name), it's easier for the\n  command generation to all happen in the java helper rather than a\n  combination of bash and java.\n\nAuthored-by: Jens Deppe <jdeppe@vmware.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "762d9e9b3db96987f2cd7d9e3f8ca7c34c4ff87e", "author": {"user": {"login": "jdeppe-pivotal", "name": "Jens Deppe"}}, "url": "https://github.com/apache/geode/commit/762d9e9b3db96987f2cd7d9e3f8ca7c34c4ff87e", "committedDate": "2020-10-12T17:00:46Z", "message": "Only use those tasks that are defined"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "011241212f5ee675036a192fd47fe53c274710d6", "author": {"user": {"login": "jdeppe-pivotal", "name": "Jens Deppe"}}, "url": "https://github.com/apache/geode/commit/011241212f5ee675036a192fd47fe53c274710d6", "committedDate": "2020-10-12T17:58:12Z", "message": "Ensure acceptanceTest is not used"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "4fe70871dca291df67375135bf54297bb1c25999", "author": {"user": {"login": "jdeppe-pivotal", "name": "Jens Deppe"}}, "url": "https://github.com/apache/geode/commit/4fe70871dca291df67375135bf54297bb1c25999", "committedDate": "2020-10-15T16:50:36Z", "message": "Include candidate test class if it is not abstract"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "91b9944eb4d23cc28b2ef14b766420584486a3c6", "author": {"user": {"login": "jdeppe-pivotal", "name": "Jens Deppe"}}, "url": "https://github.com/apache/geode/commit/91b9944eb4d23cc28b2ef14b766420584486a3c6", "committedDate": "2020-10-15T17:26:15Z", "message": "Various changes:\n\n- Output a fake Gradle param so that scripts can determine the number of\n  tests included.\n- Change the CI stress job timeout from 6 to 10 hours.\n- Increase the test count threshold from 25 to 35 changed tests. This\n  number also includes any tests inferred by this new code.\n\nAuthored-by: Jens Deppe <jdeppe@vmware.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "162bb2a8f9de667b826179aa3fdb7cb2e3db3c8a", "author": {"user": {"login": "jdeppe-pivotal", "name": "Jens Deppe"}}, "url": "https://github.com/apache/geode/commit/162bb2a8f9de667b826179aa3fdb7cb2e3db3c8a", "committedDate": "2020-10-15T18:02:04Z", "message": "Bump images to Ubuntu 20.04"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "fda5d6da59cff572b74cc50ac329a4b580350ffb", "author": {"user": {"login": "jdeppe-pivotal", "name": "Jens Deppe"}}, "url": "https://github.com/apache/geode/commit/fda5d6da59cff572b74cc50ac329a4b580350ffb", "committedDate": "2020-10-15T19:09:46Z", "message": "Do not go interactive"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "4b16ff0e9015e7aebf2c92b94aa56e6e18796d29", "author": {"user": {"login": "jdeppe-pivotal", "name": "Jens Deppe"}}, "url": "https://github.com/apache/geode/commit/4b16ff0e9015e7aebf2c92b94aa56e6e18796d29", "committedDate": "2020-10-15T21:16:27Z", "message": "Ubuntu 20 does not include python 2.7 anymore"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "9d88b2781d4bbd1693469b201f2810c730be02d9", "author": {"user": {"login": "jdeppe-pivotal", "name": "Jens Deppe"}}, "url": "https://github.com/apache/geode/commit/9d88b2781d4bbd1693469b201f2810c730be02d9", "committedDate": "2020-10-19T13:42:32Z", "message": "Revert changes for Ubuntu 20.04"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "570ace9bd1a641d66285ef9b57a68b432039aa62", "author": {"user": {"login": "jdeppe-pivotal", "name": "Jens Deppe"}}, "url": "https://github.com/apache/geode/commit/570ace9bd1a641d66285ef9b57a68b432039aa62", "committedDate": "2020-10-22T17:48:24Z", "message": "Fix tests"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c2f3e8fffb8dd57cc8ec0efbfc5aefbdd82b26d9", "author": {"user": {"login": "jdeppe-pivotal", "name": "Jens Deppe"}}, "url": "https://github.com/apache/geode/commit/c2f3e8fffb8dd57cc8ec0efbfc5aefbdd82b26d9", "committedDate": "2020-10-22T19:07:37Z", "message": "Trigger CI"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTE1MDQyMjg0", "url": "https://github.com/apache/geode/pull/5601#pullrequestreview-515042284", "createdAt": "2020-10-22T19:15:12Z", "commit": {"oid": "c2f3e8fffb8dd57cc8ec0efbfc5aefbdd82b26d9"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTE1MDQyMzk2", "url": "https://github.com/apache/geode/pull/5601#pullrequestreview-515042396", "createdAt": "2020-10-22T19:15:20Z", "commit": {"oid": "c2f3e8fffb8dd57cc8ec0efbfc5aefbdd82b26d9"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTE1MDk3OTY1", "url": "https://github.com/apache/geode/pull/5601#pullrequestreview-515097965", "createdAt": "2020-10-22T20:34:41Z", "commit": {"oid": "c2f3e8fffb8dd57cc8ec0efbfc5aefbdd82b26d9"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTE1MTAwMTQy", "url": "https://github.com/apache/geode/pull/5601#pullrequestreview-515100142", "createdAt": "2020-10-22T20:38:09Z", "commit": {"oid": "c2f3e8fffb8dd57cc8ec0efbfc5aefbdd82b26d9"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yMlQyMDozODowOVrOHmy6ag==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yMlQyMDozODowOVrOHmy6ag==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMDQ0MjA5MA==", "bodyText": "was this intended to be left in?", "url": "https://github.com/apache/geode/pull/5601#discussion_r510442090", "createdAt": "2020-10-22T20:38:09Z", "author": {"login": "onichols-pivotal"}, "path": "geode-redis/src/integrationTest/java/org/apache/geode/redis/internal/executor/pubsub/AbstractPubSubIntegrationTest.java", "diffHunk": "@@ -51,6 +51,7 @@\n import org.apache.geode.test.junit.rules.ExecutorServiceRule;\n \n public abstract class AbstractPubSubIntegrationTest implements RedisPortSupplier {\n+  /* Trigger a stress test run */", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c2f3e8fffb8dd57cc8ec0efbfc5aefbdd82b26d9"}, "originalPosition": 4}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "47e637228d04c6fa8b98ff93ae7564457171f351", "author": {"user": {"login": "jdeppe-pivotal", "name": "Jens Deppe"}}, "url": "https://github.com/apache/geode/commit/47e637228d04c6fa8b98ff93ae7564457171f351", "committedDate": "2020-10-22T20:45:14Z", "message": "Remove superfluous comment"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4078, "cost": 1, "resetAt": "2021-10-29T19:57:52Z"}}}