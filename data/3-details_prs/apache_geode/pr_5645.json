{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTA3MTU4MDE2", "number": 5645, "title": "GEODE-7845: Now behaving with clients of various versions.", "bodyText": "", "createdAt": "2020-10-20T23:45:22Z", "url": "https://github.com/apache/geode/pull/5645", "merged": true, "mergeCommit": {"oid": "05055cf4f4066b65e93f905648dbd4957ae6ef72"}, "closed": true, "closedAt": "2020-10-22T16:46:48Z", "author": {"login": "mhansonp"}, "timelineItems": {"totalCount": 9, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdUb3AFAH2gAyNTA3MTU4MDE2OjU0ZTg3NDU5NTdlMTYzOThhMGZmNWQwZmFmMzM4YjU5OGYyODRmYTI=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdUwytSgH2gAyNTA3MTU4MDE2OmQxMDI5MjI2NDNhYjk0YmZjYjA4OWM1MmIwOTQ5ZjVkOTE2NjRkMWM=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "54e8745957e16398a0ff5d0faf338b598f284fa2", "author": {"user": {"login": "mhansonp", "name": null}}, "url": "https://github.com/apache/geode/commit/54e8745957e16398a0ff5d0faf338b598f284fa2", "committedDate": "2020-10-20T17:03:14Z", "message": "GEODE-7845: Now behaving with clients of various versions."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "8f2654f188ce0cf9410f997d021bb0e913e04f4c", "author": {"user": {"login": "mhansonp", "name": null}}, "url": "https://github.com/apache/geode/commit/8f2654f188ce0cf9410f997d021bb0e913e04f4c", "committedDate": "2020-10-20T23:53:54Z", "message": "GEODE-7845: a bit of cleanup"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "91c001f749075d793d56562bc9b333c7c4a1a180", "author": {"user": {"login": "mhansonp", "name": null}}, "url": "https://github.com/apache/geode/commit/91c001f749075d793d56562bc9b333c7c4a1a180", "committedDate": "2020-10-21T00:33:00Z", "message": "GEODE-7845: removing unneeded ServerVersionMismatchException"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTEzMjc4NDYy", "url": "https://github.com/apache/geode/pull/5645#pullrequestreview-513278462", "createdAt": "2020-10-21T03:20:42Z", "commit": {"oid": "91c001f749075d793d56562bc9b333c7c4a1a180"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yMVQwMzoyMDo0M1rOHlYwZg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yMVQwMzoyMDo0M1rOHlYwZg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwODk2NDk2Ng==", "bodyText": "Change all the ServerOperationException  to be UnsupportedOperationException in this class, including comments and method names.", "url": "https://github.com/apache/geode/pull/5645#discussion_r508964966", "createdAt": "2020-10-21T03:20:43Z", "author": {"login": "gesterzhou"}, "path": "geode-core/src/upgradeTest/java/org/apache/geode/internal/cache/rollingupgrade/RollingUpgradePartitionRegionClearServerVersionMismatch.java", "diffHunk": "@@ -109,20 +111,28 @@ public void before() {\n       region.put(\"A\", \"ValueA\");\n       region.put(\"B\", \"ValueB\");\n     });\n+  }\n+\n+  @After\n+  public void after() {\n+    locator.stop();\n+    serverNew.stop();\n+    serverOld.stop();\n \n   }\n ", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "91c001f749075d793d56562bc9b333c7c4a1a180"}, "originalPosition": 72}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTEzODE3MzE0", "url": "https://github.com/apache/geode/pull/5645#pullrequestreview-513817314", "createdAt": "2020-10-21T15:29:23Z", "commit": {"oid": "91c001f749075d793d56562bc9b333c7c4a1a180"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yMVQxNToyOToyM1rOHlygRQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yMVQxNToyOToyM1rOHlygRQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwOTM4NjgyMQ==", "bodyText": "it's better to have one test to run pr clear from an old version and another test to run pr clear from a new version. Two test methods.", "url": "https://github.com/apache/geode/pull/5645#discussion_r509386821", "createdAt": "2020-10-21T15:29:23Z", "author": {"login": "gesterzhou"}, "path": "geode-core/src/upgradeTest/java/org/apache/geode/internal/cache/rollingupgrade/RollingUpgradePartitionRegionClearServerVersionMismatch.java", "diffHunk": "@@ -109,20 +111,28 @@ public void before() {\n       region.put(\"A\", \"ValueA\");\n       region.put(\"B\", \"ValueB\");\n     });\n+  }\n+\n+  @After\n+  public void after() {\n+    locator.stop();\n+    serverNew.stop();\n+    serverOld.stop();\n \n   }\n \n   /**\n-   * testClient_ServerVersionMismatchException - validates that when a client invokes a partitioned\n-   * region clear on a cluster where one server is running an unsupported version for this feature\n-   * we return a ServerVersionMismatchException\n+   * testClient_ServerOperationException - validates that when a client invokes a partitioned region\n+   * clear on a cluster where one server is running an unsupported version for this feature we\n+   * return a ServerOperationException\n    */\n   @Test\n-  public void testClient_ServerVersionMismatchException() throws Exception {\n+  public void testClient_ServerOperationExceptionCurrentServerVersion() throws Exception {\n     IgnoredException.addIgnoredException(ServerOperationException.class);\n-    final int locatorPort = locator.getPort();\n+\n     // Get a client VM\n-    ClientVM clientVM = cluster.startClientVM(3, c -> c.withLocatorConnection(locatorPort));\n+    int serverPort = serverNew.getPort();\n+    clientVM = cluster.startClientVM(3, oldVersion, c -> c.withServerConnection(serverPort));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "91c001f749075d793d56562bc9b333c7c4a1a180"}, "originalPosition": 90}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "82395c21fdbebfba7736c66db0401fd774940e88", "author": {"user": {"login": "mhansonp", "name": null}}, "url": "https://github.com/apache/geode/commit/82395c21fdbebfba7736c66db0401fd774940e88", "committedDate": "2020-10-21T16:41:48Z", "message": "GEODE-7845: more cleanup..."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTEzOTg2ODc0", "url": "https://github.com/apache/geode/pull/5645#pullrequestreview-513986874", "createdAt": "2020-10-21T17:11:52Z", "commit": {"oid": "82395c21fdbebfba7736c66db0401fd774940e88"}, "state": "APPROVED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yMVQxNzoxMTo1MlrOHl28Ew==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yMVQxNzoxNTowN1rOHl3JBg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwOTQ1OTQ3NQ==", "bodyText": "This message reads weird. Maybe change to:\n\"Server(s) \" + memberNames + \" are running a version older than (<\" + KnownVersion.GEODE_1_14_0 + \">) which does not support partitioned region clear.\");", "url": "https://github.com/apache/geode/pull/5645#discussion_r509459475", "createdAt": "2020-10-21T17:11:52Z", "author": {"login": "kirklund"}, "path": "geode-core/src/main/java/org/apache/geode/internal/cache/PartitionedRegionClear.java", "diffHunk": "@@ -349,13 +348,14 @@ public void allServerVersionsSupportPartitionRegionClear() {\n           && (internalDistributedMember.getVersion().isOlderThan(KnownVersion.GEODE_1_14_0))) {\n         if (!memberNames.contains(internalDistributedMember.getName())) {\n           memberNames.add(internalDistributedMember.getName());\n-          logger.info(\"MLH adding \" + internalDistributedMember.getName());\n         }\n       }\n     }\n     if (!memberNames.isEmpty()) {\n-      throw new ServerVersionMismatchException(memberNames, \"Partitioned Region Clear\",\n-          KnownVersion.GEODE_1_14_0.toString());\n+      throw new UnsupportedOperationException(\n+          \"A server's \" + memberNames + \" version was too old (< \"", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "82395c21fdbebfba7736c66db0401fd774940e88"}, "originalPosition": 20}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwOTQ2Mjc5MA==", "bodyText": "I think Gester is recommending expanding the testing to include:\n\nnew client --> new server\nnew client --> old server\nold client --> new server\nold client --> old server\n\nIf (3) and (4) throw UnsupportedOperationException without sending any message to the server, then they could probably be collapsed into a single test.", "url": "https://github.com/apache/geode/pull/5645#discussion_r509462790", "createdAt": "2020-10-21T17:15:07Z", "author": {"login": "kirklund"}, "path": "geode-core/src/upgradeTest/java/org/apache/geode/internal/cache/rollingupgrade/RollingUpgradePartitionRegionClearServerVersionMismatch.java", "diffHunk": "@@ -109,20 +111,28 @@ public void before() {\n       region.put(\"A\", \"ValueA\");\n       region.put(\"B\", \"ValueB\");\n     });\n+  }\n+\n+  @After\n+  public void after() {\n+    locator.stop();\n+    serverNew.stop();\n+    serverOld.stop();\n \n   }\n \n   /**\n-   * testClient_ServerVersionMismatchException - validates that when a client invokes a partitioned\n-   * region clear on a cluster where one server is running an unsupported version for this feature\n-   * we return a ServerVersionMismatchException\n+   * testClient_ServerOperationException - validates that when a client invokes a partitioned region\n+   * clear on a cluster where one server is running an unsupported version for this feature we\n+   * return a ServerOperationException\n    */\n   @Test\n-  public void testClient_ServerVersionMismatchException() throws Exception {\n+  public void testClient_ServerOperationExceptionCurrentServerVersion() throws Exception {\n     IgnoredException.addIgnoredException(ServerOperationException.class);\n-    final int locatorPort = locator.getPort();\n+\n     // Get a client VM\n-    ClientVM clientVM = cluster.startClientVM(3, c -> c.withLocatorConnection(locatorPort));\n+    int serverPort = serverNew.getPort();\n+    clientVM = cluster.startClientVM(3, oldVersion, c -> c.withServerConnection(serverPort));", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwOTM4NjgyMQ=="}, "originalCommit": {"oid": "91c001f749075d793d56562bc9b333c7c4a1a180"}, "originalPosition": 90}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTEzOTkxNzI5", "url": "https://github.com/apache/geode/pull/5645#pullrequestreview-513991729", "createdAt": "2020-10-21T17:18:02Z", "commit": {"oid": "82395c21fdbebfba7736c66db0401fd774940e88"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d102922643ab94bfcb089c52b0949f5d91664d1c", "author": {"user": {"login": "mhansonp", "name": null}}, "url": "https://github.com/apache/geode/commit/d102922643ab94bfcb089c52b0949f5d91664d1c", "committedDate": "2020-10-21T17:26:33Z", "message": "GEODE-7845: spotless"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3948, "cost": 1, "resetAt": "2021-10-29T19:57:52Z"}}}