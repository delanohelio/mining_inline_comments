{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDM4ODQwNTc5", "number": 5288, "title": "GEODE-8283: Provide REST interface for disk-store creation", "bodyText": "Provides create, get, list and delete operations\nCan create with locator only running\n\nCo-Authored-By: Jason Huynh jhuynh@vmware.com\nThank you for submitting a contribution to Apache Geode.\nIn order to streamline the review of the contribution we ask you\nto ensure the following steps have been taken:\nFor all changes:\n\n\n Is there a JIRA ticket associated with this PR? Is it referenced in the commit message?\n\n\n Has your PR been rebased against the latest commit within the target branch (typically develop)?\n\n\n Is your initial contribution a single, squashed commit?\n\n\n Does gradlew build run cleanly?\n\n\n Have you written or updated unit tests to verify your changes?\n\n\n If adding new dependencies to the code, are these dependencies licensed in a way that is compatible for inclusion under ASF 2.0?\n\n\nNote:\nPlease ensure that once the PR is submitted, check Concourse for build issues and\nsubmit an update to your PR as soon as possible. If you need help, please send an\nemail to dev@geode.apache.org.", "createdAt": "2020-06-23T21:49:11Z", "url": "https://github.com/apache/geode/pull/5288", "merged": true, "mergeCommit": {"oid": "c9ed7d7d068cee0b8bb2f626e78a1c0090fad92d"}, "closed": true, "closedAt": "2020-06-26T13:27:35Z", "author": {"login": "jmelchio"}, "timelineItems": {"totalCount": 14, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcuRh44AFqTQzNjI5NzEzMg==", "endCursor": "Y3Vyc29yOnYyOpPPAAABcu10K2gFqTQzNzg4MzA4Nw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDM2Mjk3MTMy", "url": "https://github.com/apache/geode/pull/5288#pullrequestreview-436297132", "createdAt": "2020-06-24T03:19:29Z", "commit": {"oid": "53e61e15456205343e597985d9e84cb59fe35900"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yNFQwMzoxOToyOVrOGoBlOg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yNFQwMzozMTo1MlrOGoBvkg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NDYyMjEzOA==", "bodyText": "Does it need both id and name? Are all the attributes necessary in the rest interface? Rest interface is supposed to be a more simplified/opinionated interface than the xml. It doesn't have to repeat everything that xml object has. Rather only focus on the attributes that users would need to configure most. If having it there would confuse users rather than help them, better not provide it in the rest interface.", "url": "https://github.com/apache/geode/pull/5288#discussion_r444622138", "createdAt": "2020-06-24T03:19:29Z", "author": {"login": "jinmeiliao"}, "path": "geode-management/src/main/java/org/apache/geode/management/configuration/DiskStore.java", "diffHunk": "@@ -0,0 +1,166 @@\n+/*\n+ * Licensed to the Apache Software Foundation (ASF) under one\n+ * or more contributor license agreements. See the NOTICE file\n+ * distributed with this work for additional information\n+ * regarding copyright ownership. The ASF licenses this file\n+ * to you under the Apache License, Version 2.0 (the\n+ * \"License\"); you may not use this file except in compliance\n+ * with the License. You may obtain a copy of the License at\n+ *\n+ * http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing,\n+ * software distributed under the License is distributed on an\n+ * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n+ * KIND, either express or implied. See the License for the\n+ * specific language governing permissions and limitations\n+ * under the License.\n+ */\n+\n+package org.apache.geode.management.configuration;\n+\n+import java.util.List;\n+import java.util.Objects;\n+\n+import com.fasterxml.jackson.annotation.JsonIgnore;\n+\n+import org.apache.geode.annotations.Experimental;\n+import org.apache.geode.management.runtime.DiskStoreInfo;\n+\n+@Experimental\n+public class DiskStore extends GroupableConfiguration<DiskStoreInfo> {\n+  public static final String DISK_STORE_CONFIG_ENDPOINT = \"/diskstores\";\n+\n+  @JsonIgnore\n+  private String id;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "53e61e15456205343e597985d9e84cb59fe35900"}, "originalPosition": 35}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NDYyMjI5Nw==", "bodyText": "would an int/long be better?", "url": "https://github.com/apache/geode/pull/5288#discussion_r444622297", "createdAt": "2020-06-24T03:20:02Z", "author": {"login": "jinmeiliao"}, "path": "geode-management/src/main/java/org/apache/geode/management/configuration/DiskDir.java", "diffHunk": "@@ -0,0 +1,54 @@\n+/*\n+ * Licensed to the Apache Software Foundation (ASF) under one\n+ * or more contributor license agreements. See the NOTICE file\n+ * distributed with this work for additional information\n+ * regarding copyright ownership. The ASF licenses this file\n+ * to you under the Apache License, Version 2.0 (the\n+ * \"License\"); you may not use this file except in compliance\n+ * with the License. You may obtain a copy of the License at\n+ *\n+ * http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing,\n+ * software distributed under the License is distributed on an\n+ * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n+ * KIND, either express or implied. See the License for the\n+ * specific language governing permissions and limitations\n+ * under the License.\n+ */\n+\n+package org.apache.geode.management.configuration;\n+\n+import java.io.Serializable;\n+\n+import org.apache.geode.management.api.JsonSerializable;\n+\n+public class DiskDir implements Serializable, JsonSerializable {\n+  private String name;\n+  private String dirSize;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "53e61e15456205343e597985d9e84cb59fe35900"}, "originalPosition": 28}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NDYyMzQzOA==", "bodyText": "I don't think you need the check here. the pipeline should already make sure that there is no existing one that has the same id exists before it's calling this add", "url": "https://github.com/apache/geode/pull/5288#discussion_r444623438", "createdAt": "2020-06-24T03:25:30Z", "author": {"login": "jinmeiliao"}, "path": "geode-core/src/main/java/org/apache/geode/management/internal/configuration/mutators/DiskStoreManager.java", "diffHunk": "@@ -0,0 +1,76 @@\n+/*\n+ * Licensed to the Apache Software Foundation (ASF) under one\n+ * or more contributor license agreements. See the NOTICE file\n+ * distributed with this work for additional information\n+ * regarding copyright ownership. The ASF licenses this file\n+ * to you under the Apache License, Version 2.0 (the\n+ * \"License\"); you may not use this file except in compliance\n+ * with the License. You may obtain a copy of the License at\n+ *\n+ * http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing,\n+ * software distributed under the License is distributed on an\n+ * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n+ * KIND, either express or implied. See the License for the\n+ * specific language governing permissions and limitations\n+ * under the License.\n+ */\n+\n+package org.apache.geode.management.internal.configuration.mutators;\n+\n+import java.util.List;\n+import java.util.stream.Collectors;\n+\n+import org.apache.commons.lang3.StringUtils;\n+\n+import org.apache.geode.cache.configuration.CacheConfig;\n+import org.apache.geode.cache.configuration.DiskStoreType;\n+import org.apache.geode.distributed.ConfigurationPersistenceService;\n+import org.apache.geode.management.configuration.DiskStore;\n+import org.apache.geode.management.internal.configuration.converters.DiskStoreConverter;\n+\n+public class DiskStoreManager extends CacheConfigurationManager<DiskStore> {\n+  private final DiskStoreConverter diskStoreConverter = new DiskStoreConverter();\n+\n+  public DiskStoreManager(ConfigurationPersistenceService service) {\n+    super(service);\n+  }\n+\n+  @Override\n+  public void add(DiskStore config, CacheConfig existing) {\n+    List<DiskStoreType> diskStoreTypes = existing.getDiskStores();\n+    if (diskStoreTypes.stream().noneMatch(diskStoreType -> diskStoreType.getName()", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "53e61e15456205343e597985d9e84cb59fe35900"}, "originalPosition": 43}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NDYyMzU0Mw==", "bodyText": "same as add, no need to check", "url": "https://github.com/apache/geode/pull/5288#discussion_r444623543", "createdAt": "2020-06-24T03:25:59Z", "author": {"login": "jinmeiliao"}, "path": "geode-core/src/main/java/org/apache/geode/management/internal/configuration/mutators/DiskStoreManager.java", "diffHunk": "@@ -0,0 +1,76 @@\n+/*\n+ * Licensed to the Apache Software Foundation (ASF) under one\n+ * or more contributor license agreements. See the NOTICE file\n+ * distributed with this work for additional information\n+ * regarding copyright ownership. The ASF licenses this file\n+ * to you under the Apache License, Version 2.0 (the\n+ * \"License\"); you may not use this file except in compliance\n+ * with the License. You may obtain a copy of the License at\n+ *\n+ * http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing,\n+ * software distributed under the License is distributed on an\n+ * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n+ * KIND, either express or implied. See the License for the\n+ * specific language governing permissions and limitations\n+ * under the License.\n+ */\n+\n+package org.apache.geode.management.internal.configuration.mutators;\n+\n+import java.util.List;\n+import java.util.stream.Collectors;\n+\n+import org.apache.commons.lang3.StringUtils;\n+\n+import org.apache.geode.cache.configuration.CacheConfig;\n+import org.apache.geode.cache.configuration.DiskStoreType;\n+import org.apache.geode.distributed.ConfigurationPersistenceService;\n+import org.apache.geode.management.configuration.DiskStore;\n+import org.apache.geode.management.internal.configuration.converters.DiskStoreConverter;\n+\n+public class DiskStoreManager extends CacheConfigurationManager<DiskStore> {\n+  private final DiskStoreConverter diskStoreConverter = new DiskStoreConverter();\n+\n+  public DiskStoreManager(ConfigurationPersistenceService service) {\n+    super(service);\n+  }\n+\n+  @Override\n+  public void add(DiskStore config, CacheConfig existing) {\n+    List<DiskStoreType> diskStoreTypes = existing.getDiskStores();\n+    if (diskStoreTypes.stream().noneMatch(diskStoreType -> diskStoreType.getName()\n+        .equals(config.getName()))) {\n+      diskStoreTypes.add(diskStoreConverter.fromConfigObject(config));\n+    }\n+  }\n+\n+  @Override\n+  public void update(DiskStore config, CacheConfig existing) {\n+    throw new IllegalStateException(\"Not implemented\");\n+  }\n+\n+  @Override\n+  public void delete(DiskStore config, CacheConfig existing) {\n+    existing.getDiskStores().stream()", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "53e61e15456205343e597985d9e84cb59fe35900"}, "originalPosition": 56}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NDYyNDc4Ng==", "bodyText": "If DiskStoreInfo is an empty class (no runtime info to gather for this configuration object), then you can declare this DiskStore as public class DiskStore extends GroupableConfiguration<RuntimeInfo>. This way, for get/list, the cms will not even issue the functions to the servers to try to retrieve an empty object.", "url": "https://github.com/apache/geode/pull/5288#discussion_r444624786", "createdAt": "2020-06-24T03:31:52Z", "author": {"login": "jinmeiliao"}, "path": "geode-management/src/main/java/org/apache/geode/management/configuration/DiskStore.java", "diffHunk": "@@ -0,0 +1,166 @@\n+/*\n+ * Licensed to the Apache Software Foundation (ASF) under one\n+ * or more contributor license agreements. See the NOTICE file\n+ * distributed with this work for additional information\n+ * regarding copyright ownership. The ASF licenses this file\n+ * to you under the Apache License, Version 2.0 (the\n+ * \"License\"); you may not use this file except in compliance\n+ * with the License. You may obtain a copy of the License at\n+ *\n+ * http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing,\n+ * software distributed under the License is distributed on an\n+ * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n+ * KIND, either express or implied. See the License for the\n+ * specific language governing permissions and limitations\n+ * under the License.\n+ */\n+\n+package org.apache.geode.management.configuration;\n+\n+import java.util.List;\n+import java.util.Objects;\n+\n+import com.fasterxml.jackson.annotation.JsonIgnore;\n+\n+import org.apache.geode.annotations.Experimental;\n+import org.apache.geode.management.runtime.DiskStoreInfo;\n+\n+@Experimental\n+public class DiskStore extends GroupableConfiguration<DiskStoreInfo> {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "53e61e15456205343e597985d9e84cb59fe35900"}, "originalPosition": 31}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "236fa9e6564466fd1ab0538e2e284927a4b5c546", "author": {"user": {"login": "jmelchio", "name": "Joris Melchior"}}, "url": "https://github.com/apache/geode/commit/236fa9e6564466fd1ab0538e2e284927a4b5c546", "committedDate": "2020-06-25T01:10:36Z", "message": "Change DiskDir size to be Integer\n\n- spottless apply"}, "afterCommit": {"oid": "02d1049455bb83758ef0c1d0872451b5c2e9e059", "author": {"user": {"login": "jmelchio", "name": "Joris Melchior"}}, "url": "https://github.com/apache/geode/commit/02d1049455bb83758ef0c1d0872451b5c2e9e059", "committedDate": "2020-06-25T01:13:23Z", "message": "Change DiskDir size to be Integer\n\n- spottless apply"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "180131002cdc93403e7274bd5323a448d6ed93c0", "author": {"user": {"login": "jmelchio", "name": "Joris Melchior"}}, "url": "https://github.com/apache/geode/commit/180131002cdc93403e7274bd5323a448d6ed93c0", "committedDate": "2020-06-25T19:57:11Z", "message": "GEODE-8283: Provide REST interface for disk-store creation\n\n- Provides create, get, list and delete operations\n- Can create with locator only running\n\nCo-Authored-By: Jason Huynh <jhuynh@vmware.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "2c25481c5a0f2be667f083fc51221feb1591aef0", "author": {"user": {"login": "jmelchio", "name": "Joris Melchior"}}, "url": "https://github.com/apache/geode/commit/2c25481c5a0f2be667f083fc51221feb1591aef0", "committedDate": "2020-06-25T19:57:11Z", "message": "Fix spotless issues"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a6646470857cc8d61453abae832f26e23cc88555", "author": {"user": {"login": "jmelchio", "name": "Joris Melchior"}}, "url": "https://github.com/apache/geode/commit/a6646470857cc8d61453abae832f26e23cc88555", "committedDate": "2020-06-25T19:57:11Z", "message": "Add missing documentation files to assembly"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "5ea4e0d8f74ae22b1a9e2aba5bee68f8e1a77717", "author": {"user": {"login": "jhuynh1", "name": "Jason Huynh"}}, "url": "https://github.com/apache/geode/commit/5ea4e0d8f74ae22b1a9e2aba5bee68f8e1a77717", "committedDate": "2020-06-25T19:57:11Z", "message": "Updating assembly validation txt (#4)\n\n* Updating assembly validation txt\r\nTrying to remove disk store folders after test\r\n\r\n* Attempt to clear out disk dirs between runs\r\n\r\n* Added temporary folder and forced disk dirs to use the absolute path"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "7e5dc045e8effc180697ff64d7bcffabe0fe08ea", "author": {"user": {"login": "jmelchio", "name": "Joris Melchior"}}, "url": "https://github.com/apache/geode/commit/7e5dc045e8effc180697ff64d7bcffabe0fe08ea", "committedDate": "2020-06-25T19:57:11Z", "message": "Fix jq issues"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "5f98828019b309f7e01ca77b44b9b99d6d7947a2", "author": {"user": {"login": "jhuynh1", "name": "Jason Huynh"}}, "url": "https://github.com/apache/geode/commit/5f98828019b309f7e01ca77b44b9b99d6d7947a2", "committedDate": "2020-06-25T19:57:11Z", "message": "Disk store rest api (#5)\n\n* Updating assembly validation txt\r\nTrying to remove disk store folders after test\r\n\r\n* Attempt to clear out disk dirs between runs\r\n\r\n* Added temporary folder and forced disk dirs to use the absolute path\r\n\r\n* Added tests for groups\r\nPrevent removal of disk store from specific groups to be consistent with region api"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c68479d2f36dacdecbedb9980fb84cc9ece1771d", "author": {"user": {"login": "jmelchio", "name": "Joris Melchior"}}, "url": "https://github.com/apache/geode/commit/c68479d2f36dacdecbedb9980fb84cc9ece1771d", "committedDate": "2020-06-25T19:57:11Z", "message": "Add JQ testing for disk-store controller"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "99d21ea77d880372c3fb22c1b974a9b503731595", "author": {"user": {"login": "jmelchio", "name": "Joris Melchior"}}, "url": "https://github.com/apache/geode/commit/99d21ea77d880372c3fb22c1b974a9b503731595", "committedDate": "2020-06-25T19:57:11Z", "message": "Change DiskDir size to be Integer\n\n- spottless apply"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "9834ffabc0b5ca09a16409e4f5649a6ca1c5e8f6", "author": {"user": {"login": "jmelchio", "name": "Joris Melchior"}}, "url": "https://github.com/apache/geode/commit/9834ffabc0b5ca09a16409e4f5649a6ca1c5e8f6", "committedDate": "2020-06-25T19:57:11Z", "message": "Fix serializables"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "97ba5d0b0153840d1417f3c3b3ad4a8c217e9e6a", "author": {"user": {"login": "jmelchio", "name": "Joris Melchior"}}, "url": "https://github.com/apache/geode/commit/97ba5d0b0153840d1417f3c3b3ad4a8c217e9e6a", "committedDate": "2020-06-25T20:16:15Z", "message": "Remove Id field from DiskStore\n\n- Rebase against develop"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "43a627a42e90a029e758f2e3a04ef01d30865283", "author": {"user": {"login": "jmelchio", "name": "Joris Melchior"}}, "url": "https://github.com/apache/geode/commit/43a627a42e90a029e758f2e3a04ef01d30865283", "committedDate": "2020-06-25T03:05:27Z", "message": "Fix serializables"}, "afterCommit": {"oid": "97ba5d0b0153840d1417f3c3b3ad4a8c217e9e6a", "author": {"user": {"login": "jmelchio", "name": "Joris Melchior"}}, "url": "https://github.com/apache/geode/commit/97ba5d0b0153840d1417f3c3b3ad4a8c217e9e6a", "committedDate": "2020-06-25T20:16:15Z", "message": "Remove Id field from DiskStore\n\n- Rebase against develop"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDM3ODgzMDg3", "url": "https://github.com/apache/geode/pull/5288#pullrequestreview-437883087", "createdAt": "2020-06-25T21:48:33Z", "commit": {"oid": "97ba5d0b0153840d1417f3c3b3ad4a8c217e9e6a"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4307, "cost": 1, "resetAt": "2021-10-29T19:57:52Z"}}}