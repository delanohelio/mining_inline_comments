{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0MzY4MTM5MDM2", "number": 4641, "title": "GEODE-7604: Fix QueryConfigurationServiceConstraintsDistributedTest", "bodyText": "GEODE-7604: Fix QueryConfigurationServiceConstraintsDistributedTest\n\nRewrite test with standard Geode and JMX APIs\nRewrite CountingCqListener with AtomicIntegers\nReplace if-else with enum", "createdAt": "2020-01-28T17:29:42Z", "url": "https://github.com/apache/geode/pull/4641", "merged": true, "mergeCommit": {"oid": "eb3f7dcda0510b5604cb9515d129d7c0b953913e"}, "closed": true, "closedAt": "2020-01-29T17:18:53Z", "author": {"login": "kirklund"}, "timelineItems": {"totalCount": 7, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABb-jF0aAH2gAyMzY4MTM5MDM2OjYwNWVlZDQ4M2Y5NGNiYTZlZWM2Mjc3ZDI4Y2MxOTBhYzA3M2FiZjE=", "endCursor": "Y3Vyc29yOnYyOpPPAAABb-5yhEAH2gAyMzY4MTM5MDM2OmVhY2RhZTFhYWRiN2IyMmU0ZDI0MDYyYmI2MTQ1YmNmOTA3MDJlNjU=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "605eed483f94cba6eec6277d28cc190ac073abf1", "author": {"user": {"login": "kirklund", "name": "Kirk Lund"}}, "url": "https://github.com/apache/geode/commit/605eed483f94cba6eec6277d28cc190ac073abf1", "committedDate": "2020-01-27T20:51:16Z", "message": "GEODE-7604: Fix QueryConfigurationServiceConstraintsDistributedTest flakiness\n\n* Rewrite test with standard Geode and JMX APIs\n* Rewrite CountingCqListener with AtomicIntegers\n* Replace if-else with enum"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzQ5NTc3ODU2", "url": "https://github.com/apache/geode/pull/4641#pullrequestreview-349577856", "createdAt": "2020-01-28T17:49:17Z", "commit": {"oid": "605eed483f94cba6eec6277d28cc190ac073abf1"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yOFQxNzo0OToxN1rOFiul4w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yOFQxNzo0OToxN1rOFiul4w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MTk1OTI2Nw==", "bodyText": "The fix: Use new inner class with AtomicIntegers instead of TestCqListener which is not thread safe.", "url": "https://github.com/apache/geode/pull/4641#discussion_r371959267", "createdAt": "2020-01-28T17:49:17Z", "author": {"login": "kirklund"}, "path": "geode-cq/src/distributedTest/java/org/apache/geode/cache/query/internal/QueryConfigurationServiceConstraintsDistributedTest.java", "diffHunk": "@@ -378,4 +418,28 @@ public boolean authorize(Method method, Object target) {\n       return authorizedMethods.contains(method.getName());\n     }\n   }\n+\n+  private static class CountingCqListener implements CqListener {\n+\n+    private final AtomicInteger eventCount = new AtomicInteger();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "605eed483f94cba6eec6277d28cc190ac073abf1"}, "originalPosition": 564}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzQ5NTc3MTkw", "url": "https://github.com/apache/geode/pull/4641#pullrequestreview-349577190", "createdAt": "2020-01-28T17:48:16Z", "commit": {"oid": "605eed483f94cba6eec6277d28cc190ac073abf1"}, "state": "COMMENTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yOFQxNzo0ODoxNlrOFiuj-w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yOFQxNzo0OTozNFrOFiumgg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MTk1ODc3OQ==", "bodyText": "I thought we were encouraging people to use the ClusterStartupRule instead of DistributedRule... did that change?.", "url": "https://github.com/apache/geode/pull/4641#discussion_r371958779", "createdAt": "2020-01-28T17:48:16Z", "author": {"login": "jujoramos"}, "path": "geode-cq/src/distributedTest/java/org/apache/geode/cache/query/internal/QueryConfigurationServiceConstraintsDistributedTest.java", "diffHunk": "@@ -72,158 +90,74 @@\n   private static final int REPLACE_KEY = ENTRIES - 4;\n   private static final int INVALIDATE_KEY = ENTRIES - 5;\n   private static final QueryObject TEST_VALUE = new QueryObject(999, \"name_999\");\n-  private File logFile;\n-  protected MemberVM server;\n-  protected ClientVM client;\n-  private static TestCqListener cqListener = null;\n+\n+  private static volatile CountingCqListener cqListener;\n+  private static volatile ServerLauncher serverLauncher;\n+  private static volatile ClientCache clientCache;\n+\n+  private VM serverVM;\n+  private VM clientVM;\n+\n+  private String regionName;\n+  private String queryString;\n \n   @Rule\n-  public ClusterStartupRule cluster = new ClusterStartupRule();\n+  public DistributedRule distributedRule = new DistributedRule();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "605eed483f94cba6eec6277d28cc190ac073abf1"}, "originalPosition": 100}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MTk1OTQyNg==", "bodyText": "The set of parameters is duplicated across the test, I believe the previous approach of having a specific method to return the full list of parameters is easier to read. Am I missing something here?.", "url": "https://github.com/apache/geode/pull/4641#discussion_r371959426", "createdAt": "2020-01-28T17:49:34Z", "author": {"login": "jujoramos"}, "path": "geode-cq/src/distributedTest/java/org/apache/geode/cache/query/internal/QueryConfigurationServiceConstraintsDistributedTest.java", "diffHunk": "@@ -233,41 +167,57 @@ private void createClientCq(String queryString, boolean executeWithInitialResult\n    * The operations should succeed, the CQ should fire 'onEvent' and no errors should be logged.\n    */\n   @Test\n-  @Parameters(method = \"getRegionTypeOperationsAndCqExecutionType\")\n-  @TestCaseName(\"[{index}] {method}(RegionType:{0};Operation:{1},ExecuteWithInitialResults:{2})\")\n+  @Parameters({\n+      \"REPLICATE, PUT, true\", \"REPLICATE, PUT, false\",\n+      \"REPLICATE, CREATE, true\", \"REPLICATE, CREATE, false\",\n+      \"REPLICATE, REMOVE, true\", \"REPLICATE, REMOVE, false\",\n+      \"REPLICATE, DESTROY, true\", \"REPLICATE, DESTROY, false\",\n+      \"REPLICATE, UPDATE, true\", \"REPLICATE, UPDATE, false\",\n+      \"REPLICATE, REPLACE, true\", \"REPLICATE, REPLACE, false\",\n+      \"REPLICATE, INVALIDATE, true\", \"REPLICATE, INVALIDATE, false\",\n+      \"PARTITION, PUT, true\", \"REPLICATE, PUT, false\",\n+      \"PARTITION, CREATE, true\", \"REPLICATE, CREATE, false\",\n+      \"PARTITION, REMOVE, true\", \"REPLICATE, REMOVE, false\",\n+      \"PARTITION, DESTROY, true\", \"REPLICATE, DESTROY, false\",\n+      \"PARTITION, UPDATE, true\", \"REPLICATE, UPDATE, false\",\n+      \"PARTITION, REPLACE, true\", \"REPLICATE, REPLACE, false\",\n+      \"PARTITION, INVALIDATE, true\", \"REPLICATE, INVALIDATE, false\"})", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "605eed483f94cba6eec6277d28cc190ac073abf1"}, "originalPosition": 307}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzQ5NjI1NDUz", "url": "https://github.com/apache/geode/pull/4641#pullrequestreview-349625453", "createdAt": "2020-01-28T19:02:49Z", "commit": {"oid": "605eed483f94cba6eec6277d28cc190ac073abf1"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "0504f2b50f6608b2b2066ca0b3d176fd12cd8fbd", "author": {"user": {"login": "kirklund", "name": "Kirk Lund"}}, "url": "https://github.com/apache/geode/commit/0504f2b50f6608b2b2066ca0b3d176fd12cd8fbd", "committedDate": "2020-01-28T21:38:13Z", "message": "Trigger precheckin"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzQ5NzQxMTAz", "url": "https://github.com/apache/geode/pull/4641#pullrequestreview-349741103", "createdAt": "2020-01-28T22:11:05Z", "commit": {"oid": "0504f2b50f6608b2b2066ca0b3d176fd12cd8fbd"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "eacdae1aadb7b22e4d24062bb6145bcf90702e65", "author": {"user": {"login": "kirklund", "name": "Kirk Lund"}}, "url": "https://github.com/apache/geode/commit/eacdae1aadb7b22e4d24062bb6145bcf90702e65", "committedDate": "2020-01-28T23:18:00Z", "message": "Replace inline parameters with NamedParameters method"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3745, "cost": 1, "resetAt": "2021-10-29T19:57:52Z"}}}