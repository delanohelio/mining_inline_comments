{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDI0Mjk2Nzcx", "number": 5174, "reviewThreads": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yOFQxNjoxMDozMFrOEAk-OQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yOFQxNjoxOTowN1rOEAlN3w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjY5MDQxMjA5OnYy", "diffSide": "RIGHT", "path": "geode-redis/src/distributedTest/java/org/apache/geode/redis/executors/keys/PersistDUnitTest.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yOFQxNjoxMDozMFrOGb8d4Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yOFQxNjo0OToxN1rOGb9_mw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMTk1NTQyNQ==", "bodyText": "Is there a resion why we're calling expire separately instead of using a set option?", "url": "https://github.com/apache/geode/pull/5174#discussion_r431955425", "createdAt": "2020-05-28T16:10:30Z", "author": {"login": "ringles"}, "path": "geode-redis/src/distributedTest/java/org/apache/geode/redis/executors/keys/PersistDUnitTest.java", "diffHunk": "@@ -134,10 +133,8 @@ public void testConcurrentPersistOperations() throws InterruptedException {\n \n   private void setKeysWithExpiration(Jedis jedis, Long iterationCount, String key) {\n     for (int i = 0; i < iterationCount; i++) {\n-      SetParams setParams = new SetParams();\n-      setParams.ex(600);\n-\n-      jedis.set(key + i, \"value\" + i, setParams);\n+      jedis.sadd(key + i, \"value\" + 9);\n+      jedis.expire(key + i, 600);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "adb5adb9a0e3648603d4297756d5cad8e61b3b5b"}, "originalPosition": 17}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMTk4MDQ0Mw==", "bodyText": "early on this branch, the new expiration was only working on sets and hashes. So I changed these tests to use sets instead of strings. It seems like this test is okay with any data type so I left it using a set.", "url": "https://github.com/apache/geode/pull/5174#discussion_r431980443", "createdAt": "2020-05-28T16:49:17Z", "author": {"login": "dschneider-pivotal"}, "path": "geode-redis/src/distributedTest/java/org/apache/geode/redis/executors/keys/PersistDUnitTest.java", "diffHunk": "@@ -134,10 +133,8 @@ public void testConcurrentPersistOperations() throws InterruptedException {\n \n   private void setKeysWithExpiration(Jedis jedis, Long iterationCount, String key) {\n     for (int i = 0; i < iterationCount; i++) {\n-      SetParams setParams = new SetParams();\n-      setParams.ex(600);\n-\n-      jedis.set(key + i, \"value\" + i, setParams);\n+      jedis.sadd(key + i, \"value\" + 9);\n+      jedis.expire(key + i, 600);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMTk1NTQyNQ=="}, "originalCommit": {"oid": "adb5adb9a0e3648603d4297756d5cad8e61b3b5b"}, "originalPosition": 17}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjY5MDQyMTUyOnYy", "diffSide": "RIGHT", "path": "geode-redis/src/distributedTest/java/org/apache/geode/redis/executors/ExpireDUnitTest.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yOFQxNjoxMjoxN1rOGb8jhg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yOFQxNjo0OTowOVrOGb9_UQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMTk1Njg3MA==", "bodyText": "Is there a reason for switching from string values to Sets?", "url": "https://github.com/apache/geode/pull/5174#discussion_r431956870", "createdAt": "2020-05-28T16:12:17Z", "author": {"login": "ringles"}, "path": "geode-redis/src/distributedTest/java/org/apache/geode/redis/executors/ExpireDUnitTest.java", "diffHunk": "@@ -115,7 +113,7 @@ public static void tearDown() {\n   public void expireOnOneServer_shouldPropagateToAllServers() {\n     String key = \"key\";\n \n-    jedis1.set(key, \"value\");\n+    jedis1.sadd(key, \"value\");", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "adb5adb9a0e3648603d4297756d5cad8e61b3b5b"}, "originalPosition": 18}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMTk4MDM2OQ==", "bodyText": "early on this branch, the new expiration was only working on sets and hashes. So I changed these tests to use sets instead of strings. It seems like this test is okay with any data type so I left it using a set.", "url": "https://github.com/apache/geode/pull/5174#discussion_r431980369", "createdAt": "2020-05-28T16:49:09Z", "author": {"login": "dschneider-pivotal"}, "path": "geode-redis/src/distributedTest/java/org/apache/geode/redis/executors/ExpireDUnitTest.java", "diffHunk": "@@ -115,7 +113,7 @@ public static void tearDown() {\n   public void expireOnOneServer_shouldPropagateToAllServers() {\n     String key = \"key\";\n \n-    jedis1.set(key, \"value\");\n+    jedis1.sadd(key, \"value\");", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMTk1Njg3MA=="}, "originalCommit": {"oid": "adb5adb9a0e3648603d4297756d5cad8e61b3b5b"}, "originalPosition": 18}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjY5MDQ1MjE1OnYy", "diffSide": "RIGHT", "path": "geode-redis/src/integrationTest/java/org/apache/geode/redis/general/ExpireIntegrationTest.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yOFQxNjoxOTowN1rOGb83Ig==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yOFQxNjo0NTozNlrOGb93MA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMTk2MTg5MA==", "bodyText": "To check my understanding - the jedis.keys() command will just get the keyset, but since it doesn't get the values of the keys it doesn't trigger the active expiration. Right?", "url": "https://github.com/apache/geode/pull/5174#discussion_r431961890", "createdAt": "2020-05-28T16:19:07Z", "author": {"login": "ringles"}, "path": "geode-redis/src/integrationTest/java/org/apache/geode/redis/general/ExpireIntegrationTest.java", "diffHunk": "@@ -366,4 +371,12 @@ public void CallingExpireOnAKeyThatAlreadyHasAnExiprationTime_ShouldUpdateTheExp\n     Long timeToLive = jedis.ttl(key);\n     assertThat(timeToLive).isGreaterThan(21);\n   }\n+\n+  @Test\n+  public void should_passivelyExpireKeys() {\n+    jedis.sadd(\"key\", \"value\");\n+    jedis.pexpire(\"key\", 100);\n+\n+    GeodeAwaitility.await().until(() -> jedis.keys(\"key\").isEmpty());", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "adb5adb9a0e3648603d4297756d5cad8e61b3b5b"}, "originalPosition": 86}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMTk3ODI4OA==", "bodyText": "right", "url": "https://github.com/apache/geode/pull/5174#discussion_r431978288", "createdAt": "2020-05-28T16:45:36Z", "author": {"login": "dschneider-pivotal"}, "path": "geode-redis/src/integrationTest/java/org/apache/geode/redis/general/ExpireIntegrationTest.java", "diffHunk": "@@ -366,4 +371,12 @@ public void CallingExpireOnAKeyThatAlreadyHasAnExiprationTime_ShouldUpdateTheExp\n     Long timeToLive = jedis.ttl(key);\n     assertThat(timeToLive).isGreaterThan(21);\n   }\n+\n+  @Test\n+  public void should_passivelyExpireKeys() {\n+    jedis.sadd(\"key\", \"value\");\n+    jedis.pexpire(\"key\", 100);\n+\n+    GeodeAwaitility.await().until(() -> jedis.keys(\"key\").isEmpty());", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMTk2MTg5MA=="}, "originalCommit": {"oid": "adb5adb9a0e3648603d4297756d5cad8e61b3b5b"}, "originalPosition": 86}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4111, "cost": 1, "resetAt": "2021-11-11T21:28:48Z"}}}