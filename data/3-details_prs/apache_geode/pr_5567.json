{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDk0Njg5MDYy", "number": 5567, "title": "GEODE-8547: Added impacts to show missing disk-stores", "bodyText": "Thank you for submitting a contribution to Apache Geode.\nIn order to streamline the review of the contribution we ask you\nto ensure the following steps have been taken:\nFor all changes:\n\n\n[*] Is there a JIRA ticket associated with this PR? Is it referenced in the commit message?\n\n\n[*] Has your PR been rebased against the latest commit within the target branch (typically develop)?\n\n\n[*] Is your initial contribution a single, squashed commit?\n\n\n[*] Does gradlew build run cleanly?\n\n\n Have you written or updated unit tests to verify your changes?\n\n\n If adding new dependencies to the code, are these dependencies licensed in a way that is compatible for inclusion under ASF 2.0?\n\n\nNote:\nPlease ensure that once the PR is submitted, check Concourse for build issues and\nsubmit an update to your PR as soon as possible. If you need help, please send an\nemail to dev@geode.apache.org.", "createdAt": "2020-09-29T09:23:58Z", "url": "https://github.com/apache/geode/pull/5567", "merged": true, "mergeCommit": {"oid": "7cc14eef52e06fe1e8c56bd766df56297b9c9ff8"}, "closed": true, "closedAt": "2020-11-05T10:06:08Z", "author": {"login": "mivanac"}, "timelineItems": {"totalCount": 15, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdOFe7egFqTQ5OTg4MjE0Mw==", "endCursor": "Y3Vyc29yOnYyOpPPAAABdZdq8tABqjM5NjEwMzc5MTc=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDk5ODgyMTQz", "url": "https://github.com/apache/geode/pull/5567#pullrequestreview-499882143", "createdAt": "2020-09-30T23:35:29Z", "commit": {"oid": "6647658000ce2531bc63dd827f4215b60f492dbd"}, "state": "DISMISSED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTIyMTQwMDky", "url": "https://github.com/apache/geode/pull/5567#pullrequestreview-522140092", "createdAt": "2020-11-03T01:20:31Z", "commit": {"oid": "22454e9ab32dc408d9b93979635b32c182b953e9"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTIyOTEzOTU5", "url": "https://github.com/apache/geode/pull/5567#pullrequestreview-522913959", "createdAt": "2020-11-03T22:15:39Z", "commit": {"oid": "22454e9ab32dc408d9b93979635b32c182b953e9"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wM1QyMjoxNTozOVrOHtCZgQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wM1QyMjoyMDowOVrOHtCgoQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNjk4NzI2NQ==", "bodyText": "I believe you don't need this boolean. If no servers, missingRegions will be null, otherwise, it's empty or has data", "url": "https://github.com/apache/geode/pull/5567#discussion_r516987265", "createdAt": "2020-11-03T22:15:39Z", "author": {"login": "jinmeiliao"}, "path": "geode-gfsh/src/main/java/org/apache/geode/management/internal/cli/commands/ShowMissingDiskStoreCommand.java", "diffHunk": "@@ -53,16 +53,19 @@ public ResultModel showMissingDiskStore() {\n     Set<DistributedMember> dataMembers =\n         DiskStoreCommandsUtils.getNormalMembers((InternalCache) getCache());\n \n-    if (dataMembers.isEmpty()) {\n-      return ResultModel.createInfo(CliStrings.NO_CACHING_MEMBERS_FOUND_MESSAGE);\n+    List<ColocatedRegionDetails> missingRegions = null;\n+    boolean cacheMemberExist = false;\n+\n+    if (!dataMembers.isEmpty()) {\n+      cacheMemberExist = true;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "22454e9ab32dc408d9b93979635b32c182b953e9"}, "originalPosition": 10}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNjk4ODE5MA==", "bodyText": "here you can do something like:\nif (missingColocatedRegions == null) {\n  // set the header as \"no caching members\"\n}\nelse if (missingColocatedRegions.isEmpty()) {\n....\n}\nelse{\n....\n}", "url": "https://github.com/apache/geode/pull/5567#discussion_r516988190", "createdAt": "2020-11-03T22:17:57Z", "author": {"login": "jinmeiliao"}, "path": "geode-gfsh/src/main/java/org/apache/geode/management/internal/cli/commands/ShowMissingDiskStoreCommand.java", "diffHunk": "@@ -113,7 +116,9 @@ private ResultModel toMissingDiskStoresTabularResult(\n     }\n \n     TabularResultModel missingRegionsSection = result.addTable(MISSING_COLOCATED_REGIONS_SECTION);\n-    if (hasMissingColocatedRegions) {\n+    if (!cacheMemberExist) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "22454e9ab32dc408d9b93979635b32c182b953e9"}, "originalPosition": 43}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNjk4ODQ5OQ==", "bodyText": "instead of suppress the warning, just don't assign it to a variable", "url": "https://github.com/apache/geode/pull/5567#discussion_r516988499", "createdAt": "2020-11-03T22:18:45Z", "author": {"login": "jinmeiliao"}, "path": "geode-gfsh/src/distributedTest/java/org/apache/geode/management/internal/cli/commands/ShowMissingDiskStoreCommandDUnitTest.java", "diffHunk": "@@ -156,6 +160,71 @@ public void stoppingAndRestartingMemberDoesNotResultInMissingDiskStore() {\n     assertThat(missingDiskStoreIds).isNull();\n   }\n \n+\n+  @Test\n+  public void stopAllMembersAndStart2ndLocator() throws Exception {\n+    IgnoredException.addIgnoredException(DistributedSystemDisconnectedException.class);\n+\n+    MemberVM locator1 = lsRule.startLocatorVM(1, locator.getPort());\n+\n+    MemberVM server1 = lsRule.startServerVM(2, locator.getPort(), locator1.getPort());\n+    @SuppressWarnings(\"unused\")", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "22454e9ab32dc408d9b93979635b32c182b953e9"}, "originalPosition": 39}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNjk4ODg5NA==", "bodyText": "I believe you can just create a region without the diskstore, the same problem would still manifest. Make the test simpler", "url": "https://github.com/apache/geode/pull/5567#discussion_r516988894", "createdAt": "2020-11-03T22:19:42Z", "author": {"login": "jinmeiliao"}, "path": "geode-gfsh/src/distributedTest/java/org/apache/geode/management/internal/cli/commands/ShowMissingDiskStoreCommandDUnitTest.java", "diffHunk": "@@ -156,6 +160,71 @@ public void stoppingAndRestartingMemberDoesNotResultInMissingDiskStore() {\n     assertThat(missingDiskStoreIds).isNull();\n   }\n \n+\n+  @Test\n+  public void stopAllMembersAndStart2ndLocator() throws Exception {\n+    IgnoredException.addIgnoredException(DistributedSystemDisconnectedException.class);\n+\n+    MemberVM locator1 = lsRule.startLocatorVM(1, locator.getPort());\n+\n+    MemberVM server1 = lsRule.startServerVM(2, locator.getPort(), locator1.getPort());\n+    @SuppressWarnings(\"unused\")\n+    MemberVM server2 = lsRule.startServerVM(3, locator.getPort(), locator1.getPort());\n+\n+    final String testRegionName = \"regionA\";", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "22454e9ab32dc408d9b93979635b32c182b953e9"}, "originalPosition": 42}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNjk4OTA4OQ==", "bodyText": "you also don't need to add data and do rebalance. Maybe add a comment in your test making it clear that you are starting a stale locator first (locator 1 shutdown before locator0, and now you are starting locator 1 first), locator 1 won't start properly until a diskstore on locator 0 is revoked", "url": "https://github.com/apache/geode/pull/5567#discussion_r516989089", "createdAt": "2020-11-03T22:20:09Z", "author": {"login": "jinmeiliao"}, "path": "geode-gfsh/src/distributedTest/java/org/apache/geode/management/internal/cli/commands/ShowMissingDiskStoreCommandDUnitTest.java", "diffHunk": "@@ -156,6 +160,71 @@ public void stoppingAndRestartingMemberDoesNotResultInMissingDiskStore() {\n     assertThat(missingDiskStoreIds).isNull();\n   }\n \n+\n+  @Test\n+  public void stopAllMembersAndStart2ndLocator() throws Exception {\n+    IgnoredException.addIgnoredException(DistributedSystemDisconnectedException.class);\n+\n+    MemberVM locator1 = lsRule.startLocatorVM(1, locator.getPort());\n+\n+    MemberVM server1 = lsRule.startServerVM(2, locator.getPort(), locator1.getPort());\n+    @SuppressWarnings(\"unused\")\n+    MemberVM server2 = lsRule.startServerVM(3, locator.getPort(), locator1.getPort());\n+\n+    final String testRegionName = \"regionA\";\n+    CommandStringBuilder csb;\n+    csb = new CommandStringBuilder(CliStrings.CREATE_DISK_STORE)\n+        .addOption(CliStrings.CREATE_DISK_STORE__NAME, \"diskStore\")\n+        .addOption(CliStrings.CREATE_DISK_STORE__DIRECTORY_AND_SIZE, \"diskStoreDir\");\n+    gfshConnector.executeAndAssertThat(csb.getCommandString()).statusIsSuccess();\n+\n+    CommandStringBuilder createRegion = new CommandStringBuilder(CliStrings.CREATE_REGION)\n+        .addOption(CliStrings.CREATE_REGION__REGION, testRegionName)\n+        .addOption(CliStrings.CREATE_REGION__DISKSTORE, \"diskStore\")\n+        .addOption(CliStrings.CREATE_REGION__REGIONSHORTCUT,\n+            RegionShortcut.PARTITION_REDUNDANT_PERSISTENT.toString());\n+    await().untilAsserted(() -> gfshConnector.executeAndAssertThat(createRegion.getCommandString())\n+        .statusIsSuccess());\n+\n+\n+    lsRule.stop(1, false);\n+\n+    // Add data to the region\n+    addData(server1, testRegionName);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "22454e9ab32dc408d9b93979635b32c182b953e9"}, "originalPosition": 61}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "63de90c09dc57666b8f63451d121f137cc091e7f", "author": {"user": {"login": "mivanac", "name": "Mario Ivanac"}}, "url": "https://github.com/apache/geode/commit/63de90c09dc57666b8f63451d121f137cc091e7f", "committedDate": "2020-11-04T12:24:30Z", "message": "GEODE-8547: update after comments"}, "afterCommit": {"oid": "2d9232dc212dbb51de51773dc042e197f6ba6b52", "author": {"user": {"login": "mivanac", "name": "Mario Ivanac"}}, "url": "https://github.com/apache/geode/commit/2d9232dc212dbb51de51773dc042e197f6ba6b52", "committedDate": "2020-11-04T14:35:27Z", "message": "GEODE-8547: update after comments"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTIzNDYyOTc4", "url": "https://github.com/apache/geode/pull/5567#pullrequestreview-523462978", "createdAt": "2020-11-04T15:19:29Z", "commit": {"oid": "2d9232dc212dbb51de51773dc042e197f6ba6b52"}, "state": "COMMENTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wNFQxNToxOTozMFrOHtc29w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wNFQxNToxOTo1OFrOHtc4Tw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNzQyMDc5MQ==", "bodyText": "this variable is not used anymore.", "url": "https://github.com/apache/geode/pull/5567#discussion_r517420791", "createdAt": "2020-11-04T15:19:30Z", "author": {"login": "jinmeiliao"}, "path": "geode-gfsh/src/main/java/org/apache/geode/management/internal/cli/commands/ShowMissingDiskStoreCommand.java", "diffHunk": "@@ -95,7 +96,8 @@ private ResultModel toMissingDiskStoresTabularResult(\n     ResultModel result = new ResultModel();\n \n     boolean hasMissingDiskStores = missingDiskStores.length != 0;\n-    boolean hasMissingColocatedRegions = !missingColocatedRegions.isEmpty();\n+    boolean hasMissingColocatedRegions =", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "2d9232dc212dbb51de51773dc042e197f6ba6b52"}, "originalPosition": 20}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNzQyMTEzNQ==", "bodyText": "actually you can get rid of this variable and inline this too, to make it symetric.", "url": "https://github.com/apache/geode/pull/5567#discussion_r517421135", "createdAt": "2020-11-04T15:19:58Z", "author": {"login": "jinmeiliao"}, "path": "geode-gfsh/src/main/java/org/apache/geode/management/internal/cli/commands/ShowMissingDiskStoreCommand.java", "diffHunk": "@@ -95,7 +96,8 @@ private ResultModel toMissingDiskStoresTabularResult(\n     ResultModel result = new ResultModel();\n \n     boolean hasMissingDiskStores = missingDiskStores.length != 0;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "2d9232dc212dbb51de51773dc042e197f6ba6b52"}, "originalPosition": 18}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "1989c97eb05622fe525bf8ba5bbd8aafeac9990e", "author": {"user": {"login": "mivanac", "name": "Mario Ivanac"}}, "url": "https://github.com/apache/geode/commit/1989c97eb05622fe525bf8ba5bbd8aafeac9990e", "committedDate": "2020-11-04T16:18:14Z", "message": "GEODE-8547: Added impacts to show missing disk-stores"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "3da363adc5bee91e27226948b243494a7b4f10b2", "author": {"user": {"login": "mivanac", "name": "Mario Ivanac"}}, "url": "https://github.com/apache/geode/commit/3da363adc5bee91e27226948b243494a7b4f10b2", "committedDate": "2020-11-04T16:18:14Z", "message": "GEODE-8547: Added DUnit test"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f8579c834697bea7d81b10bda6ef1852a333ddde", "author": {"user": {"login": "mivanac", "name": "Mario Ivanac"}}, "url": "https://github.com/apache/geode/commit/f8579c834697bea7d81b10bda6ef1852a333ddde", "committedDate": "2020-11-04T16:18:15Z", "message": "GEODE-8547: update after comments"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "2d9232dc212dbb51de51773dc042e197f6ba6b52", "author": {"user": {"login": "mivanac", "name": "Mario Ivanac"}}, "url": "https://github.com/apache/geode/commit/2d9232dc212dbb51de51773dc042e197f6ba6b52", "committedDate": "2020-11-04T14:35:27Z", "message": "GEODE-8547: update after comments"}, "afterCommit": {"oid": "41e11d70d7e3246c1d846ef3bd3f514d6ea2abf0", "author": {"user": {"login": "mivanac", "name": "Mario Ivanac"}}, "url": "https://github.com/apache/geode/commit/41e11d70d7e3246c1d846ef3bd3f514d6ea2abf0", "committedDate": "2020-11-04T16:30:49Z", "message": "GEODE-8547: remove unused variables"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a643a6200ce65e08ca6df1966462b22f99e5d6b5", "author": {"user": {"login": "mivanac", "name": "Mario Ivanac"}}, "url": "https://github.com/apache/geode/commit/a643a6200ce65e08ca6df1966462b22f99e5d6b5", "committedDate": "2020-11-04T20:41:45Z", "message": "GEODE-8547: remove unused variables"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "41e11d70d7e3246c1d846ef3bd3f514d6ea2abf0", "author": {"user": {"login": "mivanac", "name": "Mario Ivanac"}}, "url": "https://github.com/apache/geode/commit/41e11d70d7e3246c1d846ef3bd3f514d6ea2abf0", "committedDate": "2020-11-04T16:30:49Z", "message": "GEODE-8547: remove unused variables"}, "afterCommit": {"oid": "a643a6200ce65e08ca6df1966462b22f99e5d6b5", "author": {"user": {"login": "mivanac", "name": "Mario Ivanac"}}, "url": "https://github.com/apache/geode/commit/a643a6200ce65e08ca6df1966462b22f99e5d6b5", "committedDate": "2020-11-04T20:41:45Z", "message": "GEODE-8547: remove unused variables"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTIzNzg5MzMy", "url": "https://github.com/apache/geode/pull/5567#pullrequestreview-523789332", "createdAt": "2020-11-04T22:41:41Z", "commit": {"oid": "e615a0f537a2ad24a2bc204ed5e79567967a55f8"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTIzNzkwNDM3", "url": "https://github.com/apache/geode/pull/5567#pullrequestreview-523790437", "createdAt": "2020-11-04T22:43:52Z", "commit": {"oid": "e615a0f537a2ad24a2bc204ed5e79567967a55f8"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "9ed6f7242e17d929655737e6cc995649dc7a2299", "author": {"user": {"login": "mivanac", "name": "Mario Ivanac"}}, "url": "https://github.com/apache/geode/commit/9ed6f7242e17d929655737e6cc995649dc7a2299", "committedDate": "2020-11-05T07:58:51Z", "message": "GEODE-8547: update test"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "e615a0f537a2ad24a2bc204ed5e79567967a55f8", "author": {"user": {"login": "mivanac", "name": "Mario Ivanac"}}, "url": "https://github.com/apache/geode/commit/e615a0f537a2ad24a2bc204ed5e79567967a55f8", "committedDate": "2020-11-04T21:49:57Z", "message": "GEODE-8547: update test"}, "afterCommit": {"oid": "9ed6f7242e17d929655737e6cc995649dc7a2299", "author": {"user": {"login": "mivanac", "name": "Mario Ivanac"}}, "url": "https://github.com/apache/geode/commit/9ed6f7242e17d929655737e6cc995649dc7a2299", "committedDate": "2020-11-05T07:58:51Z", "message": "GEODE-8547: update test"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4048, "cost": 1, "resetAt": "2021-10-29T19:57:52Z"}}}