{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDAxMTk2NTkz", "number": 4932, "title": "GEODE-7664: calling RegionConfigRealizer.exists methods doesn't need \u2026", "bodyText": "\u2026to get the runtime info of the region to avoid concurrency issues.\nThank you for submitting a contribution to Apache Geode.\nIn order to streamline the review of the contribution we ask you\nto ensure the following steps have been taken:\nFor all changes:\n\n\n Is there a JIRA ticket associated with this PR? Is it referenced in the commit message?\n\n\n Has your PR been rebased against the latest commit within the target branch (typically develop)?\n\n\n Is your initial contribution a single, squashed commit?\n\n\n Does gradlew build run cleanly?\n\n\n Have you written or updated unit tests to verify your changes?\n\n\n If adding new dependencies to the code, are these dependencies licensed in a way that is compatible for inclusion under ASF 2.0?\n\n\nNote:\nPlease ensure that once the PR is submitted, check Concourse for build issues and\nsubmit an update to your PR as soon as possible. If you need help, please send an\nemail to dev@geode.apache.org.", "createdAt": "2020-04-09T04:10:41Z", "url": "https://github.com/apache/geode/pull/4932", "merged": true, "mergeCommit": {"oid": "63c681d217bdcc3d6ed0150f977f18461be1a785"}, "closed": true, "closedAt": "2020-04-09T21:07:39Z", "author": {"login": "jinmeiliao"}, "timelineItems": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcV0heRgH2gAyNDAxMTk2NTkzOjQwNDQwMTUzMzM4YjhiOTNmMWM5MzI5ZjExM2Q0MmIyNTNkOTM0Y2E=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcWBXjjgFqTM5MTA1ODg1Nw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "40440153338b8b93f1c9329f113d42b253d934ca", "author": {"user": {"login": "jinmeiliao", "name": "Jinmei Liao"}}, "url": "https://github.com/apache/geode/commit/40440153338b8b93f1c9329f113d42b253d934ca", "committedDate": "2020-04-09T04:10:07Z", "message": "GEODE-7664: calling RegionConfigRealizer.exists methods doesn't need to get the runtime info of the region to avoid concurrency issues."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzkwOTU5ODQz", "url": "https://github.com/apache/geode/pull/4932#pullrequestreview-390959843", "createdAt": "2020-04-09T16:44:23Z", "commit": {"oid": "40440153338b8b93f1c9329f113d42b253d934ca"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wOVQxNjo0NDoyM1rOGDg0yw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wOVQxNjo1NjozNFrOGDhQPg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNjMzNjcxNQ==", "bodyText": "You can also use never() in place of times(0) if you think it's clearer.", "url": "https://github.com/apache/geode/pull/4932#discussion_r406336715", "createdAt": "2020-04-09T16:44:23Z", "author": {"login": "demery-pivotal"}, "path": "geode-core/src/test/java/org/apache/geode/management/internal/configuration/realizers/RegionConfigRealizerTest.java", "diffHunk": "@@ -113,4 +116,23 @@ public void getRegionFactoryWhenValueNotSet() throws Exception {\n     verify(regionFactory, never()).setDiskStoreName(any());\n     verify(regionFactory).setDataPolicy(DataPolicy.REPLICATE);\n   }\n+\n+  @Test\n+  public void exists() {\n+    config.setName(\"test\");\n+    when(cache.getRegion(\"/test\")).thenReturn(null);\n+    assertThat(realizer.exists(config, cache)).isFalse();\n+\n+    when(region.isDestroyed()).thenReturn(true);\n+    assertThat(realizer.exists(config, cache)).isFalse();\n+  }\n+\n+  @Test\n+  public void existsDoesNotGetRuntimeInfo() {\n+    config.setName(\"test\");\n+    when(cache.getRegion(\"/test\")).thenReturn(region);\n+    boolean exists = realizer.exists(config, cache);\n+    assertThat(exists).isTrue();\n+    verify(region, times(0)).size();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "40440153338b8b93f1c9329f113d42b253d934ca"}, "originalPosition": 45}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNjMzODM0NQ==", "bodyText": "The test name hides a very important responsibility: To report that the region exists if it is in the cache and not destroyed.\nI would write this as two tests, so that the test names can clearly document the two responsibilities: 1. Determine that the region exists. 2. Do not get runtime info.", "url": "https://github.com/apache/geode/pull/4932#discussion_r406338345", "createdAt": "2020-04-09T16:47:20Z", "author": {"login": "demery-pivotal"}, "path": "geode-core/src/test/java/org/apache/geode/management/internal/configuration/realizers/RegionConfigRealizerTest.java", "diffHunk": "@@ -113,4 +116,23 @@ public void getRegionFactoryWhenValueNotSet() throws Exception {\n     verify(regionFactory, never()).setDiskStoreName(any());\n     verify(regionFactory).setDataPolicy(DataPolicy.REPLICATE);\n   }\n+\n+  @Test\n+  public void exists() {\n+    config.setName(\"test\");\n+    when(cache.getRegion(\"/test\")).thenReturn(null);\n+    assertThat(realizer.exists(config, cache)).isFalse();\n+\n+    when(region.isDestroyed()).thenReturn(true);\n+    assertThat(realizer.exists(config, cache)).isFalse();\n+  }\n+\n+  @Test\n+  public void existsDoesNotGetRuntimeInfo() {\n+    config.setName(\"test\");\n+    when(cache.getRegion(\"/test\")).thenReturn(region);\n+    boolean exists = realizer.exists(config, cache);\n+    assertThat(exists).isTrue();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "40440153338b8b93f1c9329f113d42b253d934ca"}, "originalPosition": 44}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNjM0Mzc0Mg==", "bodyText": "This section doesn't test anything. Because cache.getRegion(\"test\") still returns null, the realizer will never call region.isDestroyed(). So this test does not ensure that the realizer pays attention to isDestroyed().\nI verified this by commenting out lines 322\u2013324 of the realizer class, and this test still passes.\nAlso, I would split this into two tests, so that the test names can clearly document the two 'does not exist' conditions:regionDoesNotExistIfNotInCache() and destroyedRegionDoesNotExist().", "url": "https://github.com/apache/geode/pull/4932#discussion_r406343742", "createdAt": "2020-04-09T16:56:34Z", "author": {"login": "demery-pivotal"}, "path": "geode-core/src/test/java/org/apache/geode/management/internal/configuration/realizers/RegionConfigRealizerTest.java", "diffHunk": "@@ -113,4 +116,23 @@ public void getRegionFactoryWhenValueNotSet() throws Exception {\n     verify(regionFactory, never()).setDiskStoreName(any());\n     verify(regionFactory).setDataPolicy(DataPolicy.REPLICATE);\n   }\n+\n+  @Test\n+  public void exists() {\n+    config.setName(\"test\");\n+    when(cache.getRegion(\"/test\")).thenReturn(null);\n+    assertThat(realizer.exists(config, cache)).isFalse();\n+\n+    when(region.isDestroyed()).thenReturn(true);\n+    assertThat(realizer.exists(config, cache)).isFalse();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "40440153338b8b93f1c9329f113d42b253d934ca"}, "originalPosition": 36}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "6d5cadb5fad1ee784b9f974beb1f194369f780fd", "author": {"user": {"login": "jinmeiliao", "name": "Jinmei Liao"}}, "url": "https://github.com/apache/geode/commit/6d5cadb5fad1ee784b9f974beb1f194369f780fd", "committedDate": "2020-04-09T18:07:47Z", "message": "review changes"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzkxMDU4ODU3", "url": "https://github.com/apache/geode/pull/4932#pullrequestreview-391058857", "createdAt": "2020-04-09T19:08:03Z", "commit": {"oid": "6d5cadb5fad1ee784b9f974beb1f194369f780fd"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4784, "cost": 1, "resetAt": "2021-10-29T19:57:52Z"}}}