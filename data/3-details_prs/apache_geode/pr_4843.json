{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0MzkyNjkyNzIy", "number": 4843, "title": "GEODE-7900: Only set the SNI hostname if it is not present", "bodyText": "It turns out the JDK sometimes automatically sets the SNI hostname and\nsometimes does not.  With openjdk 8, it only sets SNI hostname if there is a\ndot in the hostname. See sun.security.ssl.Utilities#addToSNIServerNameList\nFor this reason, we need to only set the SNI hostname if the JDK did not.\nOtherwise it will complain that there is a Duplicated server name of type 0\nNote, this fixes the Windows distributed tests failures we are seeing - for example this run https://concourse.apachegeode-ci.info/teams/main/pipelines/apache-develop-main/jobs/WindowsGfshDistributedTestOpenJDK8/builds/1391. Those failures aren't really because of windows, its because our windows CI instances have fully qualified hostnames as opposed to the linux docker containers.", "createdAt": "2020-03-23T23:24:59Z", "url": "https://github.com/apache/geode/pull/4843", "merged": true, "mergeCommit": {"oid": "a93a59eb7d55dbdc6b7f0e690555e32eaa7de8fd"}, "closed": true, "closedAt": "2020-03-24T18:05:13Z", "author": {"login": "upthewaterspout"}, "timelineItems": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcQmQaBgH2gAyMzkyNjkyNzIyOjg5NjAwMzBjMGUxZjBiYWU2ZjhkYjNlNzhlMGJlMmMwODkyYmIxYWE=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcQ1fTlAFqTM4MDQ4Mzg4NA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "8960030c0e1f0bae6f8db3e78e0be2c0892bb1aa", "author": {"user": {"login": "upthewaterspout", "name": "Dan Smith"}}, "url": "https://github.com/apache/geode/commit/8960030c0e1f0bae6f8db3e78e0be2c0892bb1aa", "committedDate": "2020-03-23T22:43:11Z", "message": "GEODE-7900: Only set the SNI hostname if it is not present\n\nIt turns out the JDK sometimes automatically sets the SNI hostname and\nsometimes does not.  With openjdk 8, it only sets SNI hostname if there is a\ndot in the hostname. See sun.security.ssl.Utilities#addToSNIServerNameList\n\nFor this reason, we need to only set the SNI hostname if the JDK did not.\nOtherwise it will complain that there is a `Duplicated server name of type 0`"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzc5OTAyOTgw", "url": "https://github.com/apache/geode/pull/4843#pullrequestreview-379902980", "createdAt": "2020-03-23T23:28:24Z", "commit": {"oid": "8960030c0e1f0bae6f8db3e78e0be2c0892bb1aa"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzgwMzkyOTk0", "url": "https://github.com/apache/geode/pull/4843#pullrequestreview-380392994", "createdAt": "2020-03-24T14:57:07Z", "commit": {"oid": "8960030c0e1f0bae6f8db3e78e0be2c0892bb1aa"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzgwNDgzODg0", "url": "https://github.com/apache/geode/pull/4843#pullrequestreview-380483884", "createdAt": "2020-03-24T16:27:23Z", "commit": {"oid": "8960030c0e1f0bae6f8db3e78e0be2c0892bb1aa"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yNFQxNjoyNzoyM1rOF64pHw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yNFQxNjoyNzoyM1rOF64pHw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NzI4OTc1OQ==", "bodyText": "Two things:\n\na nit: the allocation can be moved after the conditional :)\nis the type check sufficient or is a content check necessary?\n\non (2) I wonder if there is a scenario where SNI might be set already, but maybe it disagrees with addr.getHostName()", "url": "https://github.com/apache/geode/pull/4843#discussion_r397289759", "createdAt": "2020-03-24T16:27:23Z", "author": {"login": "Bill"}, "path": "geode-core/src/main/java/org/apache/geode/internal/net/SocketCreator.java", "diffHunk": "@@ -774,6 +775,14 @@ private void setServerNames(SSLParameters modifiedParams, HostAndPort addr) {\n     List<SNIServerName> oldNames = modifiedParams.getServerNames();\n     oldNames = oldNames == null ? Collections.emptyList() : oldNames;\n     final List<SNIServerName> serverNames = new ArrayList<>(oldNames);\n+\n+    if (serverNames.stream()\n+        .mapToInt(SNIServerName::getType)\n+        .anyMatch(type -> type == StandardConstants.SNI_HOST_NAME)) {\n+      // we already have a SNI hostname set. Do nothing.\n+      return;\n+    }\n+", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "8960030c0e1f0bae6f8db3e78e0be2c0892bb1aa"}, "originalPosition": 19}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4911, "cost": 1, "resetAt": "2021-10-29T19:57:52Z"}}}