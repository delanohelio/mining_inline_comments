{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDE1NDUxODA4", "number": 5081, "reviewThreads": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xOVQxODowODowOFrOD96fyA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xOVQxODoxMjowN1rOD96liQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjY2MjQ4MTM2OnYy", "diffSide": "RIGHT", "path": "geode-assembly/src/integrationTest/resources/expected_jars.txt", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xOVQxODowODowOFrOGXsjMg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xOVQxODo0ODo0NFrOGXuCMg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNzUwMDMzOA==", "bodyText": "why are these showing up here?", "url": "https://github.com/apache/geode/pull/5081#discussion_r427500338", "createdAt": "2020-05-19T18:08:08Z", "author": {"login": "kohlmu-pivotal"}, "path": "geode-assembly/src/integrationTest/resources/expected_jars.txt", "diffHunk": "@@ -75,6 +76,8 @@ lucene-queries\n lucene-queryparser\n mapstruct\n micrometer-core\n+module1.jar\n+module2.jar", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "5641421a53db27ca03933109447815f1babb9caa"}, "originalPosition": 13}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNzUyNDY1OA==", "bodyText": "Removed.", "url": "https://github.com/apache/geode/pull/5081#discussion_r427524658", "createdAt": "2020-05-19T18:48:44Z", "author": {"login": "yozaner1324"}, "path": "geode-assembly/src/integrationTest/resources/expected_jars.txt", "diffHunk": "@@ -75,6 +76,8 @@ lucene-queries\n lucene-queryparser\n mapstruct\n micrometer-core\n+module1.jar\n+module2.jar", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNzUwMDMzOA=="}, "originalCommit": {"oid": "5641421a53db27ca03933109447815f1babb9caa"}, "originalPosition": 13}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjY2MjQ4OTMyOnYy", "diffSide": "RIGHT", "path": "geode-assembly/build.gradle", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xOVQxODoxMDoxN1rOGXsoTw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xOVQxODo0ODo1OVrOGXuCrA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNzUwMTY0Nw==", "bodyText": "I don't think it should exposed outside of the original module", "url": "https://github.com/apache/geode/pull/5081#discussion_r427501647", "createdAt": "2020-05-19T18:10:17Z", "author": {"login": "kohlmu-pivotal"}, "path": "geode-assembly/build.gradle", "diffHunk": "@@ -577,6 +579,9 @@ distributions {\n         from {project(':geode-core').tasks.named('raJar')}\n         from {project(':geode-core').tasks.named('jcaJar')}\n \n+        from project(':geode-modules').tasks.named('module1Jar')\n+        from project(':geode-modules').tasks.named('module2Jar')", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "5641421a53db27ca03933109447815f1babb9caa"}, "originalPosition": 21}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNzUyNDc4MA==", "bodyText": "Removed.", "url": "https://github.com/apache/geode/pull/5081#discussion_r427524780", "createdAt": "2020-05-19T18:48:59Z", "author": {"login": "yozaner1324"}, "path": "geode-assembly/build.gradle", "diffHunk": "@@ -577,6 +579,9 @@ distributions {\n         from {project(':geode-core').tasks.named('raJar')}\n         from {project(':geode-core').tasks.named('jcaJar')}\n \n+        from project(':geode-modules').tasks.named('module1Jar')\n+        from project(':geode-modules').tasks.named('module2Jar')", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNzUwMTY0Nw=="}, "originalCommit": {"oid": "5641421a53db27ca03933109447815f1babb9caa"}, "originalPosition": 21}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjY2MjQ5NjA5OnYy", "diffSide": "RIGHT", "path": "geode-modules/src/main/java/org/apache/geode/services/module/impl/JBossModuleService.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xOVQxODoxMjowN1rOGXssgg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xOVQxODo0OToxNFrOGXuDSg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNzUwMjcyMg==", "bodyText": "possibly we need to remove these add them into their respective JIRA", "url": "https://github.com/apache/geode/pull/5081#discussion_r427502722", "createdAt": "2020-05-19T18:12:07Z", "author": {"login": "kohlmu-pivotal"}, "path": "geode-modules/src/main/java/org/apache/geode/services/module/impl/JBossModuleService.java", "diffHunk": "@@ -0,0 +1,136 @@\n+/*\n+ * Licensed to the Apache Software Foundation (ASF) under one or more contributor license\n+ * agreements. See the NOTICE file distributed with this work for additional information regarding\n+ * copyright ownership. The ASF licenses this file to You under the Apache License, Version 2.0 (the\n+ * \"License\"); you may not use this file except in compliance with the License. You may obtain a\n+ * copy of the License at\n+ *\n+ * http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software distributed under the License\n+ * is distributed on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express\n+ * or implied. See the License for the specific language governing permissions and limitations under\n+ * the License.\n+ */\n+\n+package org.apache.geode.services.module.impl;\n+\n+import java.io.IOException;\n+import java.util.HashMap;\n+import java.util.List;\n+import java.util.Map;\n+import java.util.jar.JarFile;\n+\n+import org.apache.logging.log4j.Logger;\n+import org.jboss.modules.LocalDependencySpecBuilder;\n+import org.jboss.modules.Module;\n+import org.jboss.modules.ModuleDependencySpecBuilder;\n+import org.jboss.modules.ModuleLoadException;\n+import org.jboss.modules.ModuleSpec;\n+import org.jboss.modules.ResourceLoader;\n+import org.jboss.modules.ResourceLoaderSpec;\n+import org.jboss.modules.ResourceLoaders;\n+import org.jboss.modules.Version;\n+\n+import org.apache.geode.annotations.Experimental;\n+import org.apache.geode.logging.internal.log4j.api.LogService;\n+import org.apache.geode.services.module.ModuleDescriptor;\n+import org.apache.geode.services.module.ModuleService;\n+\n+/**\n+ * Implementation of {@link ModuleService} using JBoss-Modules.\n+ */\n+@Experimental\n+public class JBossModuleService implements ModuleService {\n+\n+  private final Map<String, Module> modules = new HashMap<>();\n+\n+  private final GeodeModuleLoader moduleLoader = new GeodeModuleLoader();\n+\n+  private final Logger logger;\n+\n+  public JBossModuleService() {\n+    this(LogService.getLogger());\n+  }\n+\n+  public JBossModuleService(Logger logger) {\n+    this.logger = logger;\n+  }\n+\n+  public Module getModule(String name) {\n+    return modules.get(name);\n+  }\n+\n+  @Override\n+  public boolean loadModule(ModuleDescriptor moduleDescriptor) {\n+    logger.debug(String.format(\"Beginning to load module %s\", moduleDescriptor.getVersionedName()));\n+\n+    if (modules.containsKey(moduleDescriptor.getVersionedName())) {\n+      logger\n+          .warn(String.format(\"Module %s is already loaded.\", moduleDescriptor.getVersionedName()));\n+      return false;\n+    }\n+\n+    ModuleSpec.Builder builder = ModuleSpec.build(moduleDescriptor.getVersionedName());\n+    builder.setVersion(Version.parse(moduleDescriptor.getVersion()));\n+    builder.addDependency(new LocalDependencySpecBuilder()\n+        .setImportServices(true)\n+        .setExport(true)\n+        .build());\n+\n+    moduleDescriptor.getDependedOnModules().forEach(dependency -> {\n+      logger.debug(String.format(\"Adding dependency on module %s\", dependency));\n+      builder.addDependency(new ModuleDependencySpecBuilder()\n+          .setName(dependency)\n+          .build());\n+    });\n+\n+    try {\n+      for (String source : moduleDescriptor.getSources()) {\n+        logger.debug(String.format(\"Adding resource %s to module\", source));\n+        ResourceLoader resourceLoader =\n+            ResourceLoaders.createJarResourceLoader(new JarFile(source));\n+        builder.addResourceRoot(ResourceLoaderSpec.createResourceLoaderSpec(resourceLoader));\n+      }\n+    } catch (IOException e) {\n+      logger.error(e);\n+      return false;\n+    }\n+\n+    ModuleSpec moduleSpec = builder.create();\n+    moduleLoader.addModuleSpec(moduleSpec);\n+\n+    try {\n+      modules.put(moduleDescriptor.getVersionedName(),\n+          moduleLoader.loadModule(moduleSpec.getName()));\n+    } catch (ModuleLoadException e) {\n+      logger.error(e);\n+      return false;\n+    }\n+\n+    logger\n+        .debug(String.format(\"Module %s successfully loaded\", moduleDescriptor.getVersionedName()));\n+\n+    return true;\n+  }\n+\n+  @Override\n+  public boolean unloadModule(String moduleName) {\n+    return false;\n+  }\n+\n+  @Override\n+  public <T> List<T> loadService(Class<T> service) {\n+    return null;\n+  }\n+\n+  @Override\n+  public <T> List<T> loadService(String serviceName) {\n+    return null;\n+  }\n+\n+  @Override\n+  public boolean unloadService(String serviceName) {\n+    return false;\n+  }", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "5641421a53db27ca03933109447815f1babb9caa"}, "originalPosition": 135}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNzUyNDkzOA==", "bodyText": "Removed.", "url": "https://github.com/apache/geode/pull/5081#discussion_r427524938", "createdAt": "2020-05-19T18:49:14Z", "author": {"login": "yozaner1324"}, "path": "geode-modules/src/main/java/org/apache/geode/services/module/impl/JBossModuleService.java", "diffHunk": "@@ -0,0 +1,136 @@\n+/*\n+ * Licensed to the Apache Software Foundation (ASF) under one or more contributor license\n+ * agreements. See the NOTICE file distributed with this work for additional information regarding\n+ * copyright ownership. The ASF licenses this file to You under the Apache License, Version 2.0 (the\n+ * \"License\"); you may not use this file except in compliance with the License. You may obtain a\n+ * copy of the License at\n+ *\n+ * http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software distributed under the License\n+ * is distributed on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express\n+ * or implied. See the License for the specific language governing permissions and limitations under\n+ * the License.\n+ */\n+\n+package org.apache.geode.services.module.impl;\n+\n+import java.io.IOException;\n+import java.util.HashMap;\n+import java.util.List;\n+import java.util.Map;\n+import java.util.jar.JarFile;\n+\n+import org.apache.logging.log4j.Logger;\n+import org.jboss.modules.LocalDependencySpecBuilder;\n+import org.jboss.modules.Module;\n+import org.jboss.modules.ModuleDependencySpecBuilder;\n+import org.jboss.modules.ModuleLoadException;\n+import org.jboss.modules.ModuleSpec;\n+import org.jboss.modules.ResourceLoader;\n+import org.jboss.modules.ResourceLoaderSpec;\n+import org.jboss.modules.ResourceLoaders;\n+import org.jboss.modules.Version;\n+\n+import org.apache.geode.annotations.Experimental;\n+import org.apache.geode.logging.internal.log4j.api.LogService;\n+import org.apache.geode.services.module.ModuleDescriptor;\n+import org.apache.geode.services.module.ModuleService;\n+\n+/**\n+ * Implementation of {@link ModuleService} using JBoss-Modules.\n+ */\n+@Experimental\n+public class JBossModuleService implements ModuleService {\n+\n+  private final Map<String, Module> modules = new HashMap<>();\n+\n+  private final GeodeModuleLoader moduleLoader = new GeodeModuleLoader();\n+\n+  private final Logger logger;\n+\n+  public JBossModuleService() {\n+    this(LogService.getLogger());\n+  }\n+\n+  public JBossModuleService(Logger logger) {\n+    this.logger = logger;\n+  }\n+\n+  public Module getModule(String name) {\n+    return modules.get(name);\n+  }\n+\n+  @Override\n+  public boolean loadModule(ModuleDescriptor moduleDescriptor) {\n+    logger.debug(String.format(\"Beginning to load module %s\", moduleDescriptor.getVersionedName()));\n+\n+    if (modules.containsKey(moduleDescriptor.getVersionedName())) {\n+      logger\n+          .warn(String.format(\"Module %s is already loaded.\", moduleDescriptor.getVersionedName()));\n+      return false;\n+    }\n+\n+    ModuleSpec.Builder builder = ModuleSpec.build(moduleDescriptor.getVersionedName());\n+    builder.setVersion(Version.parse(moduleDescriptor.getVersion()));\n+    builder.addDependency(new LocalDependencySpecBuilder()\n+        .setImportServices(true)\n+        .setExport(true)\n+        .build());\n+\n+    moduleDescriptor.getDependedOnModules().forEach(dependency -> {\n+      logger.debug(String.format(\"Adding dependency on module %s\", dependency));\n+      builder.addDependency(new ModuleDependencySpecBuilder()\n+          .setName(dependency)\n+          .build());\n+    });\n+\n+    try {\n+      for (String source : moduleDescriptor.getSources()) {\n+        logger.debug(String.format(\"Adding resource %s to module\", source));\n+        ResourceLoader resourceLoader =\n+            ResourceLoaders.createJarResourceLoader(new JarFile(source));\n+        builder.addResourceRoot(ResourceLoaderSpec.createResourceLoaderSpec(resourceLoader));\n+      }\n+    } catch (IOException e) {\n+      logger.error(e);\n+      return false;\n+    }\n+\n+    ModuleSpec moduleSpec = builder.create();\n+    moduleLoader.addModuleSpec(moduleSpec);\n+\n+    try {\n+      modules.put(moduleDescriptor.getVersionedName(),\n+          moduleLoader.loadModule(moduleSpec.getName()));\n+    } catch (ModuleLoadException e) {\n+      logger.error(e);\n+      return false;\n+    }\n+\n+    logger\n+        .debug(String.format(\"Module %s successfully loaded\", moduleDescriptor.getVersionedName()));\n+\n+    return true;\n+  }\n+\n+  @Override\n+  public boolean unloadModule(String moduleName) {\n+    return false;\n+  }\n+\n+  @Override\n+  public <T> List<T> loadService(Class<T> service) {\n+    return null;\n+  }\n+\n+  @Override\n+  public <T> List<T> loadService(String serviceName) {\n+    return null;\n+  }\n+\n+  @Override\n+  public boolean unloadService(String serviceName) {\n+    return false;\n+  }", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNzUwMjcyMg=="}, "originalCommit": {"oid": "5641421a53db27ca03933109447815f1babb9caa"}, "originalPosition": 135}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4214, "cost": 1, "resetAt": "2021-11-11T21:28:48Z"}}}