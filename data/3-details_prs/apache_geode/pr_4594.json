{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0MzYyODc5Nzk4", "number": 4594, "title": "GEODE-6833: remove redundant ArchRule and layer spec", "bodyText": "This commit has a little ArchUnit cleanup to GEODE-6833 which was just merged.\nFor all changes:\n\n\n Is there a JIRA ticket associated with this PR? Is it referenced in the commit message?\n\n\n Has your PR been rebased against the latest commit within the target branch (typically develop)?\n\n\n Is your initial contribution a single, squashed commit?\n\n\n Does gradlew build run cleanly?\n\n\n Have you written or updated unit tests to verify your changes?\n\n\n If adding new dependencies to the code, are these dependencies licensed in a way that is compatible for inclusion under ASF 2.0?\n\n\nNote:\nPlease ensure that once the PR is submitted, check Concourse for build issues and\nsubmit an update to your PR as soon as possible. If you need help, please send an\nemail to dev@geode.apache.org.", "createdAt": "2020-01-14T23:03:27Z", "url": "https://github.com/apache/geode/pull/4594", "merged": true, "mergeCommit": {"oid": "779e5ce0fe4630534fa598e40b17e5e84cb188b3"}, "closed": true, "closedAt": "2020-01-15T01:28:15Z", "author": {"login": "Bill"}, "timelineItems": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABb6ZKl8AH2gAyMzYyODc5Nzk4OmI3ODNmM2Y1ZjA3ZGU2MTViMjA0NjFiMjAzY2JmMmRlZWRlMzBlZGM=", "endCursor": "Y3Vyc29yOnYyOpPPAAABb6aXJWgFqTM0MjkyNTAxOQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "b783f3f5f07de615b20461b203cbf2deede30edc", "author": {"user": {"login": "Bill", "name": "Bill Burcham"}}, "url": "https://github.com/apache/geode/commit/b783f3f5f07de615b20461b203cbf2deede30edc", "committedDate": "2020-01-14T23:01:44Z", "message": "GEODE-6833: remove redundant ArchRule and layer spec"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzQyODk3OTQ0", "url": "https://github.com/apache/geode/pull/4594#pullrequestreview-342897944", "createdAt": "2020-01-14T23:04:39Z", "commit": {"oid": "b783f3f5f07de615b20461b203cbf2deede30edc"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0xNFQyMzowNDozOVrOFdorOg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0xNFQyMzowNDozOVrOFdorOg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NjYxOTQ1MA==", "bodyText": "Now that we have eliminated all the spurious dependencies (except the test package one), this ArchRule is no longer needed as a baseline.", "url": "https://github.com/apache/geode/pull/4594#discussion_r366619450", "createdAt": "2020-01-14T23:04:39Z", "author": {"login": "Bill"}, "path": "geode-core/src/test/java/org/apache/geode/distributed/internal/membership/MembershipDependenciesJUnitTest.java", "diffHunk": "@@ -20,65 +20,29 @@\n \n import com.tngtech.archunit.core.importer.ImportOption;\n import com.tngtech.archunit.junit.AnalyzeClasses;\n-import com.tngtech.archunit.junit.ArchIgnore;\n import com.tngtech.archunit.junit.ArchTest;\n import com.tngtech.archunit.junit.ArchUnitRunner;\n import com.tngtech.archunit.junit.CacheMode;\n import com.tngtech.archunit.lang.ArchRule;\n import org.junit.runner.RunWith;\n \n-\n @RunWith(ArchUnitRunner.class)\n @AnalyzeClasses(packages = \"org.apache.geode.distributed.internal.membership.gms..\",\n     cacheMode = CacheMode.PER_CLASS,\n     importOptions = ImportOption.DoNotIncludeArchives.class)\n public class MembershipDependenciesJUnitTest {\n \n   /*\n-   * This test verifies that the membership component (which is currently made up of classes\n-   * inside the geode-core module, but which may someday reside in a separate module)\n-   * depends only on packages within itself (within the membership component) or packages\n-   * outside apache.geode.\n-   *\n-   * For purposes of this test, classes in the membership...adapter package are not considered.\n-   * They will eventually become part of geode-core.\n+   * This test verifies that packages defined in the geode-membership module depend only on\n+   * packages defined within that module or on packages defined outside the geode-core module\n+   * (org.apache.geode packages) or on packages defined in a handful of small \"leaf\" modules.\n    *\n-   * While this rule is ignored, comment-out the ignore annotation to run it periodically to get\n-   * the current count of deviations.\n-   */\n-  // TODO: remove ignore once membershipDoesntDependOnCoreProvisional matches this rule exactly\n-  @ArchIgnore", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b783f3f5f07de615b20461b203cbf2deede30edc"}, "originalPosition": 34}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzQyODk4MjI1", "url": "https://github.com/apache/geode/pull/4594#pullrequestreview-342898225", "createdAt": "2020-01-14T23:05:20Z", "commit": {"oid": "b783f3f5f07de615b20461b203cbf2deede30edc"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0xNFQyMzowNToyMFrOFdosDQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0xNFQyMzowNToyMFrOFdosDQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NjYxOTY2MQ==", "bodyText": "The \"adapter\" layer should not be able to access \"internal\", so I removed the former.", "url": "https://github.com/apache/geode/pull/4594#discussion_r366619661", "createdAt": "2020-01-14T23:05:20Z", "author": {"login": "Bill"}, "path": "geode-core/src/integrationTest/java/org/apache/geode/distributed/internal/membership/api/CoreOnlyUsesMembershipAPIArchUnitTest.java", "diffHunk": "@@ -105,12 +105,10 @@ public void miscCoreClassesDoNotUseMembershipInternals() {\n \n   private void checkMembershipAPIUse(JavaClasses importedClasses) {\n     ArchRule myRule = layeredArchitecture()\n-        .layer(\"adapter\")\n-        .definedBy(resideInAPackage(\"org.apache.geode.distributed.internal.membership.adapter\"))\n         .layer(\"internal\")\n         .definedBy(resideInAPackage(\"org.apache.geode.distributed.internal.membership.gms..\"))\n         .layer(\"api\").definedBy(\"org.apache.geode.distributed.internal.membership.api\")\n-        .whereLayer(\"internal\").mayOnlyBeAccessedByLayers(\"api\", \"adapter\");", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b783f3f5f07de615b20461b203cbf2deede30edc"}, "originalPosition": 9}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzQyOTI1MDE5", "url": "https://github.com/apache/geode/pull/4594#pullrequestreview-342925019", "createdAt": "2020-01-15T00:25:21Z", "commit": {"oid": "b783f3f5f07de615b20461b203cbf2deede30edc"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3844, "cost": 1, "resetAt": "2021-10-29T19:57:52Z"}}}