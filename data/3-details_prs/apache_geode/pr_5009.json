{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDA5Nzg3OTQ3", "number": 5009, "title": "GEODE-8048: change redis sets to use functions and deltas", "bodyText": "Thank you for submitting a contribution to Apache Geode.\nIn order to streamline the review of the contribution we ask you\nto ensure the following steps have been taken:\nFor all changes:\n\n\n Is there a JIRA ticket associated with this PR? Is it referenced in the commit message?\n\n\n Has your PR been rebased against the latest commit within the target branch (typically develop)?\n\n\n Is your initial contribution a single, squashed commit?\n\n\n Does gradlew build run cleanly?\n\n\n Have you written or updated unit tests to verify your changes?\n\n\n If adding new dependencies to the code, are these dependencies licensed in a way that is compatible for inclusion under ASF 2.0?\n\n\nNote:\nPlease ensure that once the PR is submitted, check Concourse for build issues and\nsubmit an update to your PR as soon as possible. If you need help, please send an\nemail to dev@geode.apache.org.", "createdAt": "2020-04-27T22:49:59Z", "url": "https://github.com/apache/geode/pull/5009", "merged": true, "mergeCommit": {"oid": "3c66f2c919d96a86f401c10c115f0064e288ffe1"}, "closed": true, "closedAt": "2020-04-30T19:09:16Z", "author": {"login": "prettyClouds"}, "timelineItems": {"totalCount": 39, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABccDMfNgFqTQwMTc3NjE2Mw==", "endCursor": "Y3Vyc29yOnYyOpPPAAABccx9AsgFqTQwMzgwMDk4NA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDAxNzc2MTYz", "url": "https://github.com/apache/geode/pull/5009#pullrequestreview-401776163", "createdAt": "2020-04-28T12:18:22Z", "commit": {"oid": "395bb3a7965a63d0f1941d76d40c85e2e81d7184"}, "state": "COMMENTED", "comments": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yOFQxMjoxODoyMlrOGNRIUQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yOFQxMjozODo0MlrOGNR6YQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNjU2NTMyOQ==", "bodyText": "This exception name tells the User what to do, i.e. \"retry\", instead of just stating what happened and letting the user decide how to handle it.\nMaybe just throwing a ConcurrentModificationException, or something like RegionUnexpectedModificationException", "url": "https://github.com/apache/geode/pull/5009#discussion_r416565329", "createdAt": "2020-04-28T12:18:22Z", "author": {"login": "prettyClouds"}, "path": "geode-redis/src/main/java/org/apache/geode/redis/internal/executor/set/DeltaSet.java", "diffHunk": "@@ -0,0 +1,261 @@\n+/*\n+ * Licensed to the Apache Software Foundation (ASF) under one or more contributor license\n+ * agreements. See the NOTICE file distributed with this work for additional information regarding\n+ * copyright ownership. The ASF licenses this file to You under the Apache License, Version 2.0 (the\n+ * \"License\"); you may not use this file except in compliance with the License. You may obtain a\n+ * copy of the License at\n+ *\n+ * http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software distributed under the License\n+ * is distributed on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express\n+ * or implied. See the License for the specific language governing permissions and limitations under\n+ * the License.\n+ */\n+\n+package org.apache.geode.redis.internal.executor.set;\n+\n+import java.io.DataInput;\n+import java.io.DataOutput;\n+import java.io.IOException;\n+import java.util.ArrayList;\n+import java.util.Collection;\n+import java.util.Collections;\n+import java.util.HashSet;\n+import java.util.Set;\n+\n+import org.apache.geode.DataSerializable;\n+import org.apache.geode.DataSerializer;\n+import org.apache.geode.Delta;\n+import org.apache.geode.InvalidDeltaException;\n+import org.apache.geode.cache.Region;\n+import org.apache.geode.redis.internal.ByteArrayWrapper;\n+\n+/**\n+ * TODO: it is probably a bad idea for this class to implement Set.\n+ * We want to be careful how other code interacts with these instances\n+ * to make sure that no modifications are made that are not thread safe\n+ * and that will always be stored in the region.\n+ * Currently the only \"correct\" methods on this class are:\n+ * members, delete, customAddAll, customRemoveAll, and the\n+ * serialization methods.\n+ */\n+public class DeltaSet implements Delta, DataSerializable {\n+\n+  public static long sadd(Region<ByteArrayWrapper, DeltaSet> region,\n+      ByteArrayWrapper key,\n+      ArrayList<ByteArrayWrapper> membersToAdd) {\n+    while (true) {\n+      DeltaSet deltaSet = region.get(key);\n+      if (deltaSet == null) {\n+        // create new set\n+        if (region.putIfAbsent(key, new DeltaSet(membersToAdd)) == null) {\n+          return membersToAdd.size();\n+        } else {\n+          // retry since another thread concurrently changed the region\n+        }\n+      } else {\n+        // update existing value\n+        try {\n+          return deltaSet.saddInstance(membersToAdd, region, key);\n+        } catch (DeltaSet.RetryDueToConcurrentModification ex) {\n+          // retry since another thread concurrently changed the region\n+        }\n+      }\n+    }\n+  }\n+\n+  public static long srem(Region<ByteArrayWrapper, DeltaSet> region,\n+      ByteArrayWrapper key,\n+      ArrayList<ByteArrayWrapper> membersToRemove) {\n+    while (true) {\n+      DeltaSet deltaSet = region.get(key);\n+      if (deltaSet == null) {\n+        return 0L;\n+      }\n+      try {\n+        return deltaSet.sremInstance(membersToRemove, region, key);\n+      } catch (DeltaSet.RetryDueToConcurrentModification ex) {\n+        // retry since another thread concurrently changed the region\n+      }\n+    }\n+  }\n+\n+  public static boolean del(Region<ByteArrayWrapper, DeltaSet> region,\n+      ByteArrayWrapper key) {\n+    while (true) {\n+      DeltaSet deltaSet = region.get(key);\n+      if (deltaSet == null) {\n+        return false;\n+      }\n+      if (deltaSet.delInstance(region, key)) {\n+        return true;\n+      } else {\n+        // retry since another thread concurrently changed the region\n+      }\n+    }\n+  }\n+\n+  public static Set<ByteArrayWrapper> members(Region<ByteArrayWrapper, DeltaSet> region,\n+      ByteArrayWrapper key) {\n+    DeltaSet deltaSet = region.get(key);\n+    if (deltaSet != null) {\n+      return deltaSet.members();\n+    } else {\n+      return Collections.emptySet();\n+    }\n+  }\n+\n+  public synchronized boolean contains(ByteArrayWrapper member) {\n+    return members.contains(member);\n+  }\n+\n+  public synchronized int size() {\n+    return members.size();\n+  }\n+\n+  private HashSet<ByteArrayWrapper> members;\n+  private transient ArrayList<ByteArrayWrapper> deltas;\n+  // true if deltas contains adds; false if removes\n+  private transient boolean deltasAreAdds;\n+\n+  DeltaSet(Collection<ByteArrayWrapper> members) {\n+    if (members instanceof HashSet) {\n+      this.members = (HashSet<ByteArrayWrapper>) members;\n+    } else {\n+      this.members = new HashSet<>(members);\n+    }\n+  }\n+\n+  // for serialization\n+  public DeltaSet() {}\n+\n+\n+  // DELTA\n+  @Override\n+  public boolean hasDelta() {\n+    return deltas != null;\n+  }\n+\n+  @Override\n+  public void toDelta(DataOutput out) throws IOException {\n+    DataSerializer.writeBoolean(deltasAreAdds, out);\n+    DataSerializer.writeArrayList(deltas, out);\n+  }\n+\n+  @Override\n+  public synchronized void fromDelta(DataInput in)\n+      throws IOException, InvalidDeltaException {\n+    boolean deltaAdds = DataSerializer.readBoolean(in);\n+    try {\n+      ArrayList<ByteArrayWrapper> deltas = DataSerializer.readArrayList(in);\n+      if (deltas != null) {\n+        if (deltaAdds) {\n+          members.addAll(deltas);\n+        } else {\n+          members.removeAll(deltas);\n+        }\n+      }\n+    } catch (ClassNotFoundException e) {\n+      throw new RuntimeException(e);\n+    }\n+  }\n+\n+  // DATA SERIALIZABLE\n+\n+  @Override\n+  public void toData(DataOutput out) throws IOException {\n+    DataSerializer.writeHashSet(members, out);\n+  }\n+\n+  @Override\n+  public void fromData(DataInput in) throws IOException, ClassNotFoundException {\n+    members = DataSerializer.readHashSet(in);\n+  }\n+\n+\n+  /**\n+   * @param membersToAdd members to add to this set; NOTE this list may by\n+   *        modified by this call\n+   * @param region the region this instance is stored in\n+   * @param key the name of the set to add to\n+   * @return the number of members actually added\n+   * @throws RetryDueToConcurrentModification if a concurrent modification is detected\n+   */\n+  private synchronized long saddInstance(ArrayList<ByteArrayWrapper> membersToAdd,\n+      Region<ByteArrayWrapper, DeltaSet> region,\n+      ByteArrayWrapper key) {\n+    if (region.get(key) != this) {\n+      throw new RetryDueToConcurrentModification();\n+    }\n+    membersToAdd.removeIf(memberToAdd -> !members.add(memberToAdd));\n+    int membersAdded = membersToAdd.size();\n+    if (membersAdded != 0) {\n+      deltasAreAdds = true;\n+      deltas = membersToAdd;\n+      try {\n+        region.put(key, this);\n+      } finally {\n+        deltas = null;\n+      }\n+    }\n+    return membersAdded;\n+  }\n+\n+  /**\n+   * @param membersToRemove members to remove from this set; NOTE this list may by\n+   *        modified by this call\n+   * @param region the region this instance is stored in\n+   * @param key the name of the set to remove from\n+   * @return the number of members actually removed\n+   * @throws RetryDueToConcurrentModification if a concurrent modification is detected\n+   */\n+  private synchronized long sremInstance(ArrayList<ByteArrayWrapper> membersToRemove,\n+      Region<ByteArrayWrapper, DeltaSet> region,\n+      ByteArrayWrapper key) {\n+    if (region.get(key) != this) {\n+      throw new RetryDueToConcurrentModification();\n+    }\n+    membersToRemove.removeIf(memberToRemove -> !members.remove(memberToRemove));\n+    int membersRemoved = membersToRemove.size();\n+    if (membersRemoved != 0) {\n+      deltasAreAdds = false;\n+      deltas = membersToRemove;\n+      try {\n+        region.put(key, this);\n+      } finally {\n+        deltas = null;\n+      }\n+    }\n+    return membersRemoved;\n+  }\n+\n+  /**\n+   * This exception is thrown if a modification fails because some other\n+   * thread changed what is stored in the region.\n+   */\n+  static class RetryDueToConcurrentModification extends RuntimeException {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "395bb3a7965a63d0f1941d76d40c85e2e81d7184"}, "originalPosition": 237}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNjU3MzAyNw==", "bodyText": "If we synchronize \"lower\" in the stack, can we avoid the complexity of looping and throwing exceptions. Can we somehow guarantee that on a given key, only one of these operations is happening simultaneously? Maybe an exclusive lock on the key?", "url": "https://github.com/apache/geode/pull/5009#discussion_r416573027", "createdAt": "2020-04-28T12:30:46Z", "author": {"login": "prettyClouds"}, "path": "geode-redis/src/main/java/org/apache/geode/redis/internal/executor/set/DeltaSet.java", "diffHunk": "@@ -0,0 +1,261 @@\n+/*\n+ * Licensed to the Apache Software Foundation (ASF) under one or more contributor license\n+ * agreements. See the NOTICE file distributed with this work for additional information regarding\n+ * copyright ownership. The ASF licenses this file to You under the Apache License, Version 2.0 (the\n+ * \"License\"); you may not use this file except in compliance with the License. You may obtain a\n+ * copy of the License at\n+ *\n+ * http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software distributed under the License\n+ * is distributed on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express\n+ * or implied. See the License for the specific language governing permissions and limitations under\n+ * the License.\n+ */\n+\n+package org.apache.geode.redis.internal.executor.set;\n+\n+import java.io.DataInput;\n+import java.io.DataOutput;\n+import java.io.IOException;\n+import java.util.ArrayList;\n+import java.util.Collection;\n+import java.util.Collections;\n+import java.util.HashSet;\n+import java.util.Set;\n+\n+import org.apache.geode.DataSerializable;\n+import org.apache.geode.DataSerializer;\n+import org.apache.geode.Delta;\n+import org.apache.geode.InvalidDeltaException;\n+import org.apache.geode.cache.Region;\n+import org.apache.geode.redis.internal.ByteArrayWrapper;\n+\n+/**\n+ * TODO: it is probably a bad idea for this class to implement Set.\n+ * We want to be careful how other code interacts with these instances\n+ * to make sure that no modifications are made that are not thread safe\n+ * and that will always be stored in the region.\n+ * Currently the only \"correct\" methods on this class are:\n+ * members, delete, customAddAll, customRemoveAll, and the\n+ * serialization methods.\n+ */\n+public class DeltaSet implements Delta, DataSerializable {\n+\n+  public static long sadd(Region<ByteArrayWrapper, DeltaSet> region,\n+      ByteArrayWrapper key,\n+      ArrayList<ByteArrayWrapper> membersToAdd) {\n+    while (true) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "395bb3a7965a63d0f1941d76d40c85e2e81d7184"}, "originalPosition": 48}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNjU3NTUxMg==", "bodyText": "When we first implemented this a few weeks back, Jens suggested having just one remote function that encapsulated all the Set commands, and the execute could just switch on some parameter.  I don't have a strong feeling either way, but I can't remember Jens' rationale...just wanted to capture the thought here, before it gets lost.", "url": "https://github.com/apache/geode/pull/5009#discussion_r416575512", "createdAt": "2020-04-28T12:34:42Z", "author": {"login": "prettyClouds"}, "path": "geode-redis/src/main/java/org/apache/geode/redis/internal/executor/set/SaddFunction.java", "diffHunk": "@@ -0,0 +1,54 @@\n+/*\n+ * Licensed to the Apache Software Foundation (ASF) under one or more contributor license\n+ * agreements. See the NOTICE file distributed with this work for additional information regarding\n+ * copyright ownership. The ASF licenses this file to You under the Apache License, Version 2.0 (the\n+ * \"License\"); you may not use this file except in compliance with the License. You may obtain a\n+ * copy of the License at\n+ *\n+ * http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software distributed under the License\n+ * is distributed on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express\n+ * or implied. See the License for the specific language governing permissions and limitations under\n+ * the License.\n+ */\n+\n+package org.apache.geode.redis.internal.executor.set;\n+\n+import java.util.ArrayList;\n+\n+import org.apache.geode.cache.Region;\n+import org.apache.geode.cache.execute.Function;\n+import org.apache.geode.cache.execute.FunctionContext;\n+import org.apache.geode.internal.cache.execute.RegionFunctionContextImpl;\n+import org.apache.geode.redis.internal.ByteArrayWrapper;\n+\n+class SaddFunction implements Function {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "395bb3a7965a63d0f1941d76d40c85e2e81d7184"}, "originalPosition": 26}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNjU3NjM4NQ==", "bodyText": "How do we get rid of these? Adding a type to the class declaration, like ... implements Function<Object>?", "url": "https://github.com/apache/geode/pull/5009#discussion_r416576385", "createdAt": "2020-04-28T12:36:04Z", "author": {"login": "prettyClouds"}, "path": "geode-redis/src/main/java/org/apache/geode/redis/internal/executor/set/SaddFunction.java", "diffHunk": "@@ -0,0 +1,54 @@\n+/*\n+ * Licensed to the Apache Software Foundation (ASF) under one or more contributor license\n+ * agreements. See the NOTICE file distributed with this work for additional information regarding\n+ * copyright ownership. The ASF licenses this file to You under the Apache License, Version 2.0 (the\n+ * \"License\"); you may not use this file except in compliance with the License. You may obtain a\n+ * copy of the License at\n+ *\n+ * http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software distributed under the License\n+ * is distributed on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express\n+ * or implied. See the License for the specific language governing permissions and limitations under\n+ * the License.\n+ */\n+\n+package org.apache.geode.redis.internal.executor.set;\n+\n+import java.util.ArrayList;\n+\n+import org.apache.geode.cache.Region;\n+import org.apache.geode.cache.execute.Function;\n+import org.apache.geode.cache.execute.FunctionContext;\n+import org.apache.geode.internal.cache.execute.RegionFunctionContextImpl;\n+import org.apache.geode.redis.internal.ByteArrayWrapper;\n+\n+class SaddFunction implements Function {\n+\n+  public static final String ID = \"SADD_FUNCTION\";\n+\n+  @SuppressWarnings(\"unchecked\")", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "395bb3a7965a63d0f1941d76d40c85e2e81d7184"}, "originalPosition": 30}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNjU3ODE0NQ==", "bodyText": "We could even use some kind of custom read-write lock...sadds should be able to happen in parallel, and srems should be able to happen in parallel exclusive of sadds, and dels just have to be exclusive of everything.", "url": "https://github.com/apache/geode/pull/5009#discussion_r416578145", "createdAt": "2020-04-28T12:38:42Z", "author": {"login": "prettyClouds"}, "path": "geode-redis/src/main/java/org/apache/geode/redis/internal/executor/set/DeltaSet.java", "diffHunk": "@@ -0,0 +1,261 @@\n+/*\n+ * Licensed to the Apache Software Foundation (ASF) under one or more contributor license\n+ * agreements. See the NOTICE file distributed with this work for additional information regarding\n+ * copyright ownership. The ASF licenses this file to You under the Apache License, Version 2.0 (the\n+ * \"License\"); you may not use this file except in compliance with the License. You may obtain a\n+ * copy of the License at\n+ *\n+ * http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software distributed under the License\n+ * is distributed on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express\n+ * or implied. See the License for the specific language governing permissions and limitations under\n+ * the License.\n+ */\n+\n+package org.apache.geode.redis.internal.executor.set;\n+\n+import java.io.DataInput;\n+import java.io.DataOutput;\n+import java.io.IOException;\n+import java.util.ArrayList;\n+import java.util.Collection;\n+import java.util.Collections;\n+import java.util.HashSet;\n+import java.util.Set;\n+\n+import org.apache.geode.DataSerializable;\n+import org.apache.geode.DataSerializer;\n+import org.apache.geode.Delta;\n+import org.apache.geode.InvalidDeltaException;\n+import org.apache.geode.cache.Region;\n+import org.apache.geode.redis.internal.ByteArrayWrapper;\n+\n+/**\n+ * TODO: it is probably a bad idea for this class to implement Set.\n+ * We want to be careful how other code interacts with these instances\n+ * to make sure that no modifications are made that are not thread safe\n+ * and that will always be stored in the region.\n+ * Currently the only \"correct\" methods on this class are:\n+ * members, delete, customAddAll, customRemoveAll, and the\n+ * serialization methods.\n+ */\n+public class DeltaSet implements Delta, DataSerializable {\n+\n+  public static long sadd(Region<ByteArrayWrapper, DeltaSet> region,\n+      ByteArrayWrapper key,\n+      ArrayList<ByteArrayWrapper> membersToAdd) {\n+    while (true) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNjU3MzAyNw=="}, "originalCommit": {"oid": "395bb3a7965a63d0f1941d76d40c85e2e81d7184"}, "originalPosition": 48}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "f2b8b4f620894c5d613906051ff28550a8f6b7fb", "author": {"user": {"login": "dschneider-pivotal", "name": "Darrel Schneider"}}, "url": "https://github.com/apache/geode/commit/f2b8b4f620894c5d613906051ff28550a8f6b7fb", "committedDate": "2020-04-28T15:55:16Z", "message": "Merge branch 'develop' into deltas"}, "afterCommit": {"oid": "91c96511d6dfd51b4196cf4c8269e17d288dba14", "author": {"user": {"login": "dschneider-pivotal", "name": "Darrel Schneider"}}, "url": "https://github.com/apache/geode/commit/91c96511d6dfd51b4196cf4c8269e17d288dba14", "committedDate": "2020-04-28T16:21:22Z", "message": "fixed some lgtm warnings about casts"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "da6c759dd584072dd4a2075a26c0e83c0570234e", "author": {"user": {"login": "dschneider-pivotal", "name": "Darrel Schneider"}}, "url": "https://github.com/apache/geode/commit/da6c759dd584072dd4a2075a26c0e83c0570234e", "committedDate": "2020-04-29T00:13:37Z", "message": "DeltaSet now supports the new delete of an empty set when doing srem"}, "afterCommit": {"oid": "e4e405adb1d9caab6319d987040c0f178e958281", "author": {"user": {"login": "dschneider-pivotal", "name": "Darrel Schneider"}}, "url": "https://github.com/apache/geode/commit/e4e405adb1d9caab6319d987040c0f178e958281", "committedDate": "2020-04-29T00:27:11Z", "message": "DeltaSet now supports the new delete of an empty set when doing srem"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "2592eca839db90569e369c4a03540bdca3267016", "author": {"user": {"login": "dschneider-pivotal", "name": "Darrel Schneider"}}, "url": "https://github.com/apache/geode/commit/2592eca839db90569e369c4a03540bdca3267016", "committedDate": "2020-04-29T06:32:35Z", "message": "make sure the redis set functions are registered"}, "afterCommit": {"oid": "dc618f20badfd0624bab547df3ad6fa275a93449", "author": {"user": {"login": "dschneider-pivotal", "name": "Darrel Schneider"}}, "url": "https://github.com/apache/geode/commit/dc618f20badfd0624bab547df3ad6fa275a93449", "committedDate": "2020-04-29T06:44:35Z", "message": "make sure the redis set functions are registered"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "0cfea4050d9316576d9085cda2db88c6012cf056", "author": {"user": {"login": "prettyClouds", "name": "Murtuza Boxwala"}}, "url": "https://github.com/apache/geode/commit/0cfea4050d9316576d9085cda2db88c6012cf056", "committedDate": "2020-04-29T22:07:05Z", "message": "Deltas"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "27170c931e2b5660bb9c765ef207964b04602f8b", "author": {"user": {"login": "prettyClouds", "name": "Murtuza Boxwala"}}, "url": "https://github.com/apache/geode/commit/27170c931e2b5660bb9c765ef207964b04602f8b", "committedDate": "2020-04-29T22:07:05Z", "message": "don't use copy constructor"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "1c966d42fc73e7540a63609b4ba81274246d2b45", "author": {"user": {"login": "dschneider-pivotal", "name": "Darrel Schneider"}}, "url": "https://github.com/apache/geode/commit/1c966d42fc73e7540a63609b4ba81274246d2b45", "committedDate": "2020-04-29T22:07:05Z", "message": "spotless"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "6ceec1a75be9a4869ad1f64289d43de2a0f3a6cf", "author": {"user": {"login": "dschneider-pivotal", "name": "Darrel Schneider"}}, "url": "https://github.com/apache/geode/commit/6ceec1a75be9a4869ad1f64289d43de2a0f3a6cf", "committedDate": "2020-04-29T22:07:05Z", "message": "now uses the function when doing sadd"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "346b010cf99b035abb1aea048487ab2b161b76a6", "author": {"user": {"login": "dschneider-pivotal", "name": "Darrel Schneider"}}, "url": "https://github.com/apache/geode/commit/346b010cf99b035abb1aea048487ab2b161b76a6", "committedDate": "2020-04-29T22:07:05Z", "message": "fixed race that caused first value in set to be lost\nif two threads concurrently added first value."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "439d37562fc26f951832198e52df4303048232ea", "author": {"user": {"login": "dschneider-pivotal", "name": "Darrel Schneider"}}, "url": "https://github.com/apache/geode/commit/439d37562fc26f951832198e52df4303048232ea", "committedDate": "2020-04-29T22:07:05Z", "message": "disabled noop optimization in customAddAll"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "82a8e0b9edc14b7d43a5808ec99631107f2f8b8d", "author": {"user": {"login": "dschneider-pivotal", "name": "Darrel Schneider"}}, "url": "https://github.com/apache/geode/commit/82a8e0b9edc14b7d43a5808ec99631107f2f8b8d", "committedDate": "2020-04-29T22:07:05Z", "message": "added DEBUG logging"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "6e39beac094d79923714eeaf1e22b837f0472a51", "author": {"user": {"login": "dschneider-pivotal", "name": "Darrel Schneider"}}, "url": "https://github.com/apache/geode/commit/6e39beac094d79923714eeaf1e22b837f0472a51", "committedDate": "2020-04-29T22:07:05Z", "message": "Revert \"added DEBUG logging\"\n\nThis reverts commit d14ab8f7b1c29cc390ab9f95398e5439f15bb0b7."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "7d853316d896ed5dea0fb0eab4cda98a4223f148", "author": {"user": {"login": "sabbey37", "name": "Sarah"}}, "url": "https://github.com/apache/geode/commit/7d853316d896ed5dea0fb0eab4cda98a4223f148", "committedDate": "2020-04-29T22:07:05Z", "message": "Adds function/delta for SREM"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "73ba857dc9ccb1c5cb3e92845c0c56ea88a3127e", "author": {"user": {"login": "sabbey37", "name": "Sarah"}}, "url": "https://github.com/apache/geode/commit/73ba857dc9ccb1c5cb3e92845c0c56ea88a3127e", "committedDate": "2020-04-29T22:07:06Z", "message": "Adds function implementation and delta for SREM and SMEMBERS"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "fc02340056559c4c9317b1ed19afefa2dcb5c1f7", "author": {"user": {"login": "jhutchison", "name": "John Hutchison"}}, "url": "https://github.com/apache/geode/commit/fc02340056559c4c9317b1ed19afefa2dcb5c1f7", "committedDate": "2020-04-29T22:07:06Z", "message": "WIP add Del function delta crap"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "30d8acabf7f1fefbb16ac23c12f9fadd22a6823d", "author": {"user": {"login": "sabbey37", "name": "Sarah"}}, "url": "https://github.com/apache/geode/commit/30d8acabf7f1fefbb16ac23c12f9fadd22a6823d", "committedDate": "2020-04-29T22:07:06Z", "message": "Fixing synchronization of members"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "9b25a3432ddd39c9cf2244b3129ff05092133a14", "author": {"user": {"login": "dschneider-pivotal", "name": "Darrel Schneider"}}, "url": "https://github.com/apache/geode/commit/9b25a3432ddd39c9cf2244b3129ff05092133a14", "committedDate": "2020-04-29T22:07:06Z", "message": "SetIntegrationTest now passes. Before it failed with class cast exceptions"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "874ae8349be1b72ce07f356efc9b504afd1742a6", "author": {"user": {"login": "jdeppe-pivotal", "name": "Jens Deppe"}}, "url": "https://github.com/apache/geode/commit/874ae8349be1b72ce07f356efc9b504afd1742a6", "committedDate": "2020-04-29T22:07:06Z", "message": "Add default constructors"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "5efd2736150aa27e6c3804111467956d888b038a", "author": {"user": {"login": "jdeppe-pivotal", "name": "Jens Deppe"}}, "url": "https://github.com/apache/geode/commit/5efd2736150aa27e6c3804111467956d888b038a", "committedDate": "2020-04-29T22:07:06Z", "message": "Fix DeltaSet"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "37d88582240b54cd1484e59852f653b70fe4ee24", "author": {"user": {"login": "dschneider-pivotal", "name": "Darrel Schneider"}}, "url": "https://github.com/apache/geode/commit/37d88582240b54cd1484e59852f653b70fe4ee24", "committedDate": "2020-04-29T22:07:06Z", "message": "reenabled addAll early out if empty set"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "3cac7f7eac6e15ffefdb8c75d483f798230f0053", "author": {"user": {"login": "dschneider-pivotal", "name": "Darrel Schneider"}}, "url": "https://github.com/apache/geode/commit/3cac7f7eac6e15ffefdb8c75d483f798230f0053", "committedDate": "2020-04-29T22:07:06Z", "message": "did some cleanup/refactoring of the DeltaSet code"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c0f26ed998078df823b69592c7dddab541a77575", "author": {"user": {"login": "dschneider-pivotal", "name": "Darrel Schneider"}}, "url": "https://github.com/apache/geode/commit/c0f26ed998078df823b69592c7dddab541a77575", "committedDate": "2020-04-29T22:07:06Z", "message": "added DeltaSet javadocs"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "fdffa4412d49a29390ae0cfcdaa6468a612522ee", "author": {"user": {"login": "dschneider-pivotal", "name": "Darrel Schneider"}}, "url": "https://github.com/apache/geode/commit/fdffa4412d49a29390ae0cfcdaa6468a612522ee", "committedDate": "2020-04-29T22:07:06Z", "message": "Fixed a concurrency issue with delete by making it synchronized.\nSimplified the concurrency check in customAddAll and customRemoveAll\nso that the deltas no longer require an ArrayList instance to be\nkept on each DeltaSet instance but instead the passed in ArrayList\nof members can be used to tell geode which members were just added/removed."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "8c28a9a075e5a90e6654ead64eacdb23702b7ae4", "author": {"user": {"login": "dschneider-pivotal", "name": "Darrel Schneider"}}, "url": "https://github.com/apache/geode/commit/8c28a9a075e5a90e6654ead64eacdb23702b7ae4", "committedDate": "2020-04-29T22:07:06Z", "message": "fixed build problems"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ca4516f6aac428973c3a13d79f12bce23e0bd611", "author": {"user": {"login": "dschneider-pivotal", "name": "Darrel Schneider"}}, "url": "https://github.com/apache/geode/commit/ca4516f6aac428973c3a13d79f12bce23e0bd611", "committedDate": "2020-04-29T22:07:06Z", "message": "got rid of GeodeRedisSetSynchronized. Now the function go right to DeltaSet"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "1ba4ccbc7538e573aa3c6f9e6e9603185788aed5", "author": {"user": {"login": "dschneider-pivotal", "name": "Darrel Schneider"}}, "url": "https://github.com/apache/geode/commit/1ba4ccbc7538e573aa3c6f9e6e9603185788aed5", "committedDate": "2020-04-29T22:07:06Z", "message": "fixed the region value type to be DeltaSet\ndid a quick impl of all set commands to expect DeltaSet"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e1ca535afca5a4623f683ff68a19c6e103688380", "author": {"user": {"login": "dschneider-pivotal", "name": "Darrel Schneider"}}, "url": "https://github.com/apache/geode/commit/e1ca535afca5a4623f683ff68a19c6e103688380", "committedDate": "2020-04-29T22:07:06Z", "message": "fixed some lgtm warnings about casts"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "81d2e8f18121356a6e6fef28a1fc7dba4afc2bb0", "author": {"user": {"login": "dschneider-pivotal", "name": "Darrel Schneider"}}, "url": "https://github.com/apache/geode/commit/81d2e8f18121356a6e6fef28a1fc7dba4afc2bb0", "committedDate": "2020-04-29T22:15:56Z", "message": "fixed spop"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "dcaa004573fd4694c2524baf7505bba2fc8bfc35", "author": {"user": {"login": "dschneider-pivotal", "name": "Darrel Schneider"}}, "url": "https://github.com/apache/geode/commit/dcaa004573fd4694c2524baf7505bba2fc8bfc35", "committedDate": "2020-04-29T22:15:57Z", "message": "fixed some serialization problems and got rid of an unneeded exception"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b6c6c0e54cb4d37b62b4e1c2e106b7b1bea95d5a", "author": {"user": {"login": "dschneider-pivotal", "name": "Darrel Schneider"}}, "url": "https://github.com/apache/geode/commit/b6c6c0e54cb4d37b62b4e1c2e106b7b1bea95d5a", "committedDate": "2020-04-29T22:15:57Z", "message": "DeltaSet now supports the new delete of an empty set when doing srem"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "83f0cac8aa4bd6f3b3ff9cf96f53c2ac691c45a8", "author": {"user": {"login": "dschneider-pivotal", "name": "Darrel Schneider"}}, "url": "https://github.com/apache/geode/commit/83f0cac8aa4bd6f3b3ff9cf96f53c2ac691c45a8", "committedDate": "2020-04-29T22:15:57Z", "message": "SRemExecutor now compiles"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "2009b3cac3872f946ef1bbb1e3bd491fe1638dd7", "author": {"user": {"login": "dschneider-pivotal", "name": "Darrel Schneider"}}, "url": "https://github.com/apache/geode/commit/2009b3cac3872f946ef1bbb1e3bd491fe1638dd7", "committedDate": "2020-04-29T22:15:57Z", "message": "RedisLockService test no longer changes region type to replicate\nsince the set region must now be a partition"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "721dcee5a2c1b8e6de7df2f89b282f8649652cb7", "author": {"user": {"login": "dschneider-pivotal", "name": "Darrel Schneider"}}, "url": "https://github.com/apache/geode/commit/721dcee5a2c1b8e6de7df2f89b282f8649652cb7", "committedDate": "2020-04-29T22:15:57Z", "message": "make sure the redis set functions are registered"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "21b618b906e4afd2dd6ad4992a2caae921cc90d6", "author": {"user": {"login": "jdeppe-pivotal", "name": "Jens Deppe"}}, "url": "https://github.com/apache/geode/commit/21b618b906e4afd2dd6ad4992a2caae921cc90d6", "committedDate": "2020-04-29T22:15:57Z", "message": "Functions are registered as part of the GeodeRedisServer startup\n\n- This also helps with tests re-running multiple times\n\nAuthored-by: Jens Deppe <jdeppe@vmware.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "db5acf018dbbd01fe87a74fd488945c1772a5721", "author": {"user": {"login": "dschneider-pivotal", "name": "Darrel Schneider"}}, "url": "https://github.com/apache/geode/commit/db5acf018dbbd01fe87a74fd488945c1772a5721", "committedDate": "2020-04-29T22:15:57Z", "message": "Revert \"make sure the redis set functions are registered\"\n\nThis reverts commit dc618f20badfd0624bab547df3ad6fa275a93449."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "18735e90bc5ee7959f62360b194d179997c8975e", "author": {"user": {"login": "dschneider-pivotal", "name": "Darrel Schneider"}}, "url": "https://github.com/apache/geode/commit/18735e90bc5ee7959f62360b194d179997c8975e", "committedDate": "2020-04-29T22:15:57Z", "message": "fix imports"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "b45c52f108e33322b87c08ce29e2aef3f64d4ae2", "author": {"user": {"login": "dschneider-pivotal", "name": "Darrel Schneider"}}, "url": "https://github.com/apache/geode/commit/b45c52f108e33322b87c08ce29e2aef3f64d4ae2", "committedDate": "2020-04-29T15:32:31Z", "message": "fix imports"}, "afterCommit": {"oid": "18735e90bc5ee7959f62360b194d179997c8975e", "author": {"user": {"login": "dschneider-pivotal", "name": "Darrel Schneider"}}, "url": "https://github.com/apache/geode/commit/18735e90bc5ee7959f62360b194d179997c8975e", "committedDate": "2020-04-29T22:15:57Z", "message": "fix imports"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ef9b5a6431eef78857501b5f8506b08d6a0fe256", "author": {"user": {"login": "jdeppe-pivotal", "name": "Jens Deppe"}}, "url": "https://github.com/apache/geode/commit/ef9b5a6431eef78857501b5f8506b08d6a0fe256", "committedDate": "2020-04-30T12:35:49Z", "message": "Add various generic type signatures\n\nAuthored-by: Jens Deppe <jdeppe@vmware.com>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDAzODAwOTg0", "url": "https://github.com/apache/geode/pull/5009#pullrequestreview-403800984", "createdAt": "2020-04-30T19:07:57Z", "commit": {"oid": "ef9b5a6431eef78857501b5f8506b08d6a0fe256"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4633, "cost": 1, "resetAt": "2021-10-29T19:57:52Z"}}}