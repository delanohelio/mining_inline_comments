{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0Mzc3MjIxNDky", "number": 4719, "title": "GEODE-6536: Added retry in borrowConnection/single hop", "bodyText": "Thank you for submitting a contribution to Apache Geode.\nIn order to streamline the review of the contribution we ask you\nto ensure the following steps have been taken:\nFor all changes:\n\n\n[*] Is there a JIRA ticket associated with this PR? Is it referenced in the commit message?\n\n\n[*] Has your PR been rebased against the latest commit within the target branch (typically develop)?\n\n\n[*] Is your initial contribution a single, squashed commit?\n\n\n[*] Does gradlew build run cleanly?\n\n\n[*] Have you written or updated unit tests to verify your changes?\n\n\n If adding new dependencies to the code, are these dependencies licensed in a way that is compatible for inclusion under ASF 2.0?\n\n\nNote:\nPlease ensure that once the PR is submitted, check Concourse for build issues and\nsubmit an update to your PR as soon as possible. If you need help, please send an\nemail to dev@geode.apache.org.", "createdAt": "2020-02-19T15:03:58Z", "url": "https://github.com/apache/geode/pull/4719", "merged": true, "mergeCommit": {"oid": "9da2cd49e2e04564b446eaad579b51e986bc2179"}, "closed": true, "closedAt": "2020-02-27T06:38:32Z", "author": {"login": "mivanac"}, "timelineItems": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcF-1IVgH2gAyMzc3MjIxNDkyOmU0NTUyZGViMmE0MWVlYTUyOTI3MDgxNTJhM2Q3ZDExYzhkMTg4OTE=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcIHrO5AH2gAyMzc3MjIxNDkyOmFlNjU2YmY2YmM5ZGJiNDhmNTMwNTFkNTRkOGExZjFkYWZjMmZiMzU=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "e4552deb2a41eea5292708152a3d7d11c8d18891", "author": {"user": {"login": "mivanac", "name": "Mario Ivanac"}}, "url": "https://github.com/apache/geode/commit/e4552deb2a41eea5292708152a3d7d11c8d18891", "committedDate": "2020-02-19T23:07:51Z", "message": "GEODE-6536: Added retry in borrowConnection/single hop"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "56729a9f453009f2bc46e275ffeb85944a997279", "author": {"user": {"login": "mivanac", "name": "Mario Ivanac"}}, "url": "https://github.com/apache/geode/commit/56729a9f453009f2bc46e275ffeb85944a997279", "committedDate": "2020-02-19T23:13:34Z", "message": "GEODE-6536: bug fix"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "3f9fac405381ecd326a4297642f48e04d962b770", "author": {"user": {"login": "mivanac", "name": "Mario Ivanac"}}, "url": "https://github.com/apache/geode/commit/3f9fac405381ecd326a4297642f48e04d962b770", "committedDate": "2020-02-19T14:55:07Z", "message": "GEODE-6536: Added retry in borrowConnection/single hop"}, "afterCommit": {"oid": "56729a9f453009f2bc46e275ffeb85944a997279", "author": {"user": {"login": "mivanac", "name": "Mario Ivanac"}}, "url": "https://github.com/apache/geode/commit/56729a9f453009f2bc46e275ffeb85944a997279", "committedDate": "2020-02-19T23:13:34Z", "message": "GEODE-6536: bug fix"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzY0Mzc0NDQz", "url": "https://github.com/apache/geode/pull/4719#pullrequestreview-364374443", "createdAt": "2020-02-25T19:08:49Z", "commit": {"oid": "56729a9f453009f2bc46e275ffeb85944a997279"}, "state": "APPROVED", "comments": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yNVQxOTowODo0OVrOFuRkxw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yNVQxOToyNzo1MFrOFuSMCg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NDA2Njc1OQ==", "bodyText": "The other acquireConnection() method uses a hard-coded timeout of 45000L, though I don't know why that is.  Why does this version use 15000L? We should remove the \"test hook\" comment because this method is used in GatewaySenderEventRemoteDispatcher.initializeConnection().", "url": "https://github.com/apache/geode/pull/4719#discussion_r384066759", "createdAt": "2020-02-25T19:08:49Z", "author": {"login": "bschuchardt"}, "path": "geode-core/src/main/java/org/apache/geode/cache/client/internal/PoolImpl.java", "diffHunk": "@@ -921,7 +921,7 @@ public void returnConnection(Connection conn) {\n    * Test hook that acquires and returns a connection from the pool with a given ServerLocation.\n    */\n   public Connection acquireConnection(ServerLocation loc) {\n-    return manager.borrowConnection(loc, false);\n+    return manager.borrowConnection(loc, 15000L, false);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "56729a9f453009f2bc46e275ffeb85944a997279"}, "originalPosition": 5}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NDA3Mjc3Nw==", "bodyText": "I don't see where this is throwing ServerOperationException.  It throws its superclass, ServerConnectivityException.", "url": "https://github.com/apache/geode/pull/4719#discussion_r384072777", "createdAt": "2020-02-25T19:20:29Z", "author": {"login": "bschuchardt"}, "path": "geode-core/src/main/java/org/apache/geode/cache/client/internal/pooling/ConnectionManagerImpl.java", "diffHunk": "@@ -308,24 +308,49 @@ public Connection borrowConnection(long acquireTimeout)\n    * destroyed when returned to the pool.\n    */\n   @Override\n-  public PooledConnection borrowConnection(ServerLocation server,\n-      boolean onlyUseExistingCnx) throws AllConnectionsInUseException, NoAvailableServersException {\n+  public PooledConnection borrowConnection(ServerLocation server, long acquireTimeout,\n+      boolean onlyUseExistingCnx)\n+      throws AllConnectionsInUseException, NoAvailableServersException, ServerOperationException {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "56729a9f453009f2bc46e275ffeb85944a997279"}, "originalPosition": 8}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NDA3NTM0MQ==", "bodyText": "If onlyUseExistingCnx is true then the acquireTimeout parameter is ignored.", "url": "https://github.com/apache/geode/pull/4719#discussion_r384075341", "createdAt": "2020-02-25T19:25:13Z", "author": {"login": "bschuchardt"}, "path": "geode-core/src/main/java/org/apache/geode/cache/client/internal/pooling/ConnectionManager.java", "diffHunk": "@@ -56,6 +56,7 @@ Connection borrowConnection(long aquireTimeout)\n    * no connection is available.\n    *\n    * @param server The server the connection needs to be to.\n+   * @param aquireTimeout The amount of time to wait for a connection to become available.\n    * @param onlyUseExistingCnx if true, will not create a new connection if none are available.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "56729a9f453009f2bc46e275ffeb85944a997279"}, "originalPosition": 5}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NDA3NjgxMA==", "bodyText": "We should get rid of the javadoc on this method.  It's hiding a more complete javadoc in the ConnectionManager interface.", "url": "https://github.com/apache/geode/pull/4719#discussion_r384076810", "createdAt": "2020-02-25T19:27:50Z", "author": {"login": "bschuchardt"}, "path": "geode-core/src/main/java/org/apache/geode/cache/client/internal/pooling/ConnectionManagerImpl.java", "diffHunk": "@@ -308,24 +308,49 @@ public Connection borrowConnection(long acquireTimeout)\n    * destroyed when returned to the pool.\n    */\n   @Override\n-  public PooledConnection borrowConnection(ServerLocation server,\n-      boolean onlyUseExistingCnx) throws AllConnectionsInUseException, NoAvailableServersException {\n+  public PooledConnection borrowConnection(ServerLocation server, long acquireTimeout,", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "56729a9f453009f2bc46e275ffeb85944a997279"}, "originalPosition": 6}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ae656bf6bc9dbb48f53051d54d8a1f1dafc2fb35", "author": {"user": {"login": "mivanac", "name": "Mario Ivanac"}}, "url": "https://github.com/apache/geode/commit/ae656bf6bc9dbb48f53051d54d8a1f1dafc2fb35", "committedDate": "2020-02-26T14:34:02Z", "message": "GEODE-6536: update after comments"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3796, "cost": 1, "resetAt": "2021-10-29T19:57:52Z"}}}