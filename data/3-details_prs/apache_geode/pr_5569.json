{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDk1MTEwMDc1", "number": 5569, "title": "GEODE-8555: SimpleDiskRegionJunitTest fails on Windows", "bodyText": "Co-authored-by: Ray Ingles ringles@pivotal.io\nUpdating Junit to 4.13, one test failed on Windows due to failure to delete some temporary test files.\nhttps://concourse.apachegeode-ci.info/teams/main/pipelines/apache-develop-main/jobs/WindowsCoreIntegrationTestOpenJDK8/builds/455\norg.apache.geode.internal.cache.SimpleDiskRegionJUnitTest > testBasicClose FAILED\n    java.lang.AssertionError:  Exception in createOverflowOnly due to java.lang.IllegalStateException: The region \"/testRegion\" has been persisted to disk so it can not be recreated on the same disk store without persistence. Either destroy the persistent region, recreate it as overflow and persistent, or create the overflow only region on a different disk store.\n        at org.junit.Assert.fail(Assert.java:89)\n        at org.apache.geode.internal.cache.SimpleDiskRegionJUnitTest.testBasicClose(SimpleDiskRegionJUnitTest.java:75)", "createdAt": "2020-09-29T21:18:20Z", "url": "https://github.com/apache/geode/pull/5569", "merged": true, "mergeCommit": {"oid": "a4c6c246dcca0a73a0d31a8ebfeac326c9b409aa"}, "closed": true, "closedAt": "2020-10-01T03:57:23Z", "author": {"login": "sabbey37"}, "timelineItems": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdNu4fNgH2gAyNDk1MTEwMDc1OmFlNDVlM2Y2ZGM3OTI3YjU4ZTJlMjVjZjViMWVmYjg4MzRiZDk1YmE=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdODx-0gFqTQ5OTgzMDAwMg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "ae45e3f6dc7927b58e2e25cf5b1efb8834bd95ba", "author": {"user": {"login": "sabbey37", "name": "Sarah"}}, "url": "https://github.com/apache/geode/commit/ae45e3f6dc7927b58e2e25cf5b1efb8834bd95ba", "committedDate": "2020-09-29T21:15:35Z", "message": "GEODE-8555: SimpleDiskRegionJunitTest fails on Windows"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "acdf51fad37fd5b22a099bb210109b0ad9688e9a", "author": {"user": {"login": "sabbey37", "name": "Sarah"}}, "url": "https://github.com/apache/geode/commit/acdf51fad37fd5b22a099bb210109b0ad9688e9a", "committedDate": "2020-09-29T23:29:15Z", "message": "Fixes weird formatting"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDk4OTk3NDQ2", "url": "https://github.com/apache/geode/pull/5569#pullrequestreview-498997446", "createdAt": "2020-09-29T23:41:05Z", "commit": {"oid": "acdf51fad37fd5b22a099bb210109b0ad9688e9a"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yOVQyMzo0MTowNVrOHaHbDw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yOVQyMzo0MTowNVrOHaHbDw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NzE0NjYzOQ==", "bodyText": "Instead of logging the error, can we add and use ErrorCollector? I would just add this to DiskRegionTestingBase up where the other Rules are defined.\n  @Rule\n  public ErrorCollector errorCollector = new ErrorCollector();\n\nAnd then:\n      try {\n        FileUtils.forceDelete(each);\n      } catch (IOException e) {\n        errorCollector.addError(e);\n      }\n\nAfter each test finishes, (if any were thrown) ErrorCollector will fail the test and print out every stack trace.\nSince SimpleDiskRegionJUnitTest is an integration test, logging the stack traces won't cause the test to fail like a distributed test would.", "url": "https://github.com/apache/geode/pull/5569#discussion_r497146639", "createdAt": "2020-09-29T23:41:05Z", "author": {"login": "kirklund"}, "path": "geode-junit/src/main/java/org/apache/geode/internal/cache/DiskRegionTestingBase.java", "diffHunk": "@@ -200,6 +202,19 @@ protected void deleteFiles() {\n     tempDir.delete();\n   }\n \n+  protected void forceDeleteFiles() {\n+    closeDiskStores();\n+    File file = tempDir.getRoot();\n+    File[] files = file.listFiles();\n+    for (File each : files) {\n+      try {\n+        FileUtils.forceDelete(each);\n+      } catch (IOException e) {\n+        LogService.getLogger().error(\"Caught\", e);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "acdf51fad37fd5b22a099bb210109b0ad9688e9a"}, "originalPosition": 28}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c98475674c280659ff717fe1e3800705326ac9ee", "author": {"user": {"login": "sabbey37", "name": "Sarah"}}, "url": "https://github.com/apache/geode/commit/c98475674c280659ff717fe1e3800705326ac9ee", "committedDate": "2020-09-30T13:44:23Z", "message": "PR review changes"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDk5ODMwMDAy", "url": "https://github.com/apache/geode/pull/5569#pullrequestreview-499830002", "createdAt": "2020-09-30T21:36:30Z", "commit": {"oid": "c98475674c280659ff717fe1e3800705326ac9ee"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4051, "cost": 1, "resetAt": "2021-10-29T19:57:52Z"}}}