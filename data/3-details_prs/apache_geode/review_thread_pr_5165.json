{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDIzNTY3OTk4", "number": 5165, "reviewThreads": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yN1QxMzo0MjoxNVrOEAGV1A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yN1QxMzo0MjoxNVrOEAGV1A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjY4NTM5MzQ4OnYy", "diffSide": "RIGHT", "path": "geode-redis/src/main/java/org/apache/geode/redis/internal/executor/string/SetNXExecutor.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yN1QxMzo0MjoxNVrOGbKtng==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yN1QxNTozNjo1MVrOGbQtOQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMTE0MDI1NA==", "bodyText": "This should be SetOptions(NX, 0L, ExpireUnit.NONE, false);", "url": "https://github.com/apache/geode/pull/5165#discussion_r431140254", "createdAt": "2020-05-27T13:42:15Z", "author": {"login": "jdeppe-pivotal"}, "path": "geode-redis/src/main/java/org/apache/geode/redis/internal/executor/string/SetNXExecutor.java", "diffHunk": "@@ -36,27 +36,23 @@\n   public void executeCommand(Command command, ExecutionHandlerContext context) {\n     List<byte[]> commandElems = command.getProcessedCommand();\n \n-    Region<ByteArrayWrapper, RedisData> region =\n-        context.getRegionProvider().getStringsRegion();\n-\n     if (commandElems.size() < 3) {\n       command.setResponse(Coder.getErrorResponse(context.getByteBufAllocator(), ArityDef.SETNX));\n       return;\n     }\n \n     ByteArrayWrapper key = command.getKey();\n-    checkAndSetDataType(key, context);\n-    byte[] value = commandElems.get(VALUE_INDEX);\n+    ByteArrayWrapper value = new ByteArrayWrapper(commandElems.get(VALUE_INDEX));\n \n-    Object oldValue =\n-        region.putIfAbsent(key, (RedisData) new RedisString(new ByteArrayWrapper(value)));\n+    RedisStringCommands stringCommands = getRedisStringCommands(context);\n+    SetOptions setOptions = new SetOptions(NX, 0L, null, false);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "3b4c1cd9aef9ff1a13b5172c58ae56c93934af5e"}, "originalPosition": 38}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMTIzODQ1Nw==", "bodyText": "Thanks for pointing this out. At this time, all that is used on the SetOptions when we call RedisStringCommands.set is the first parameter (NX in this case) so I just went with defaults on all the others. Some of these apply to expiration so they will be reviewed when the string expiration work is done.", "url": "https://github.com/apache/geode/pull/5165#discussion_r431238457", "createdAt": "2020-05-27T15:36:51Z", "author": {"login": "dschneider-pivotal"}, "path": "geode-redis/src/main/java/org/apache/geode/redis/internal/executor/string/SetNXExecutor.java", "diffHunk": "@@ -36,27 +36,23 @@\n   public void executeCommand(Command command, ExecutionHandlerContext context) {\n     List<byte[]> commandElems = command.getProcessedCommand();\n \n-    Region<ByteArrayWrapper, RedisData> region =\n-        context.getRegionProvider().getStringsRegion();\n-\n     if (commandElems.size() < 3) {\n       command.setResponse(Coder.getErrorResponse(context.getByteBufAllocator(), ArityDef.SETNX));\n       return;\n     }\n \n     ByteArrayWrapper key = command.getKey();\n-    checkAndSetDataType(key, context);\n-    byte[] value = commandElems.get(VALUE_INDEX);\n+    ByteArrayWrapper value = new ByteArrayWrapper(commandElems.get(VALUE_INDEX));\n \n-    Object oldValue =\n-        region.putIfAbsent(key, (RedisData) new RedisString(new ByteArrayWrapper(value)));\n+    RedisStringCommands stringCommands = getRedisStringCommands(context);\n+    SetOptions setOptions = new SetOptions(NX, 0L, null, false);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMTE0MDI1NA=="}, "originalCommit": {"oid": "3b4c1cd9aef9ff1a13b5172c58ae56c93934af5e"}, "originalPosition": 38}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4109, "cost": 1, "resetAt": "2021-11-11T21:28:48Z"}}}