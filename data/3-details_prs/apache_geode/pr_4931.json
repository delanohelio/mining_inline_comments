{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDAxMTM0MDU2", "number": 4931, "title": "Geode 7751: fix for Tomcat9CachingClientServerTest.containersShouldExpireInSetTimeframe", "bodyText": "", "createdAt": "2020-04-08T23:45:23Z", "url": "https://github.com/apache/geode/pull/4931", "merged": true, "mergeCommit": {"oid": "30624235a8145fd3e1373b50d5c58e0dd9c98bef"}, "closed": true, "closedAt": "2020-04-09T20:53:45Z", "author": {"login": "mhansonp"}, "timelineItems": {"totalCount": 6, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcVtxyWAH2gAyNDAxMTM0MDU2OjRlYjcwM2Q3Y2MwMzczZDI3NjRmYzM2ZWI2ZDVlNThiNjg0N2NiNDU=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcWAD5EAFqTM5MDk5NjY3MQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "4eb703d7cc0373d2764fc36eb6d5e58b6847cb45", "author": {"user": {"login": "mhansonp", "name": null}}, "url": "https://github.com/apache/geode/commit/4eb703d7cc0373d2764fc36eb6d5e58b6847cb45", "committedDate": "2020-04-08T20:18:36Z", "message": "Cleaned up test"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b235ee1f361aa3cc863a441828807d211ac3e5d0", "author": {"user": {"login": "mhansonp", "name": null}}, "url": "https://github.com/apache/geode/commit/b235ee1f361aa3cc863a441828807d211ac3e5d0", "committedDate": "2020-04-08T20:21:37Z", "message": "Spotless"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzkwOTQxOTky", "url": "https://github.com/apache/geode/pull/4931#pullrequestreview-390941992", "createdAt": "2020-04-09T16:20:49Z", "commit": {"oid": "b235ee1f361aa3cc863a441828807d211ac3e5d0"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wOVQxNjoyMDo0OVrOGDf8EQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wOVQxNjozMDoxMFrOGDgTNw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNjMyMjE5Mw==", "bodyText": "You should be able to delete the 2-second sleep. The very next line is an await.", "url": "https://github.com/apache/geode/pull/4931#discussion_r406322193", "createdAt": "2020-04-09T16:20:49Z", "author": {"login": "kirklund"}, "path": "geode-assembly/src/distributedTest/java/org/apache/geode/session/tests/CargoTestBase.java", "diffHunk": "@@ -246,13 +250,14 @@ public void containersShouldExpireInSetTimeframe()\n \n     client.setPort(Integer.parseInt(manager.getContainerPort(0)));\n     Client.Response resp = client.set(key, value);\n-\n-    getKeyValueDataOnAllClients(key, value, resp.getSessionCookie());\n-\n-    client.setMaxInactive(1);\n-    Thread.sleep(5000);\n-\n-    verifySessionIsRemoved(key);\n+    await().untilAsserted(() -> getKeyValueDataOnAllClients(key, value, resp.getSessionCookie()));\n+    client.setMaxInactive(1); // max inactive time is 1 second. Lets wait a second.\n+    Thread.sleep(2000);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b235ee1f361aa3cc863a441828807d211ac3e5d0"}, "originalPosition": 171}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNjMyMzY1OA==", "bodyText": "It should be ok as is, but I recommend making the Logger static final because that's the standard.", "url": "https://github.com/apache/geode/pull/4931#discussion_r406323658", "createdAt": "2020-04-09T16:23:06Z", "author": {"login": "kirklund"}, "path": "geode-assembly/src/distributedTest/java/org/apache/geode/session/tests/CargoTestBase.java", "diffHunk": "@@ -23,30 +25,32 @@\n import java.nio.file.Paths;\n import java.util.function.IntSupplier;\n \n+import org.apache.logging.log4j.Logger;\n import org.junit.After;\n import org.junit.Before;\n import org.junit.Rule;\n import org.junit.Test;\n import org.junit.experimental.categories.Category;\n import org.junit.rules.TestName;\n \n+import org.apache.geode.internal.AvailablePortHelper;\n import org.apache.geode.internal.UniquePortSupplier;\n import org.apache.geode.logging.internal.log4j.api.LogService;\n import org.apache.geode.modules.session.functions.GetMaxInactiveInterval;\n-import org.apache.geode.test.awaitility.GeodeAwaitility;\n import org.apache.geode.test.dunit.rules.ClusterStartupRule;\n import org.apache.geode.test.dunit.rules.MemberVM;\n import org.apache.geode.test.junit.categories.SessionTest;\n \n /**\n  * Base class for test of session replication.\n- *\n+ * <p>\n  * This class contains all of the tests of session replication functionality. Subclasses of this\n  * class configure different containers in order to run these tests against specific containers.\n  */\n @Category({SessionTest.class})\n public abstract class CargoTestBase {\n   private final UniquePortSupplier portSupplier = new UniquePortSupplier();\n+  Logger logger = LogService.getLogger();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b235ee1f361aa3cc863a441828807d211ac3e5d0"}, "originalPosition": 40}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNjMyNjgyNA==", "bodyText": "await has a built-in sleep between each iteration, so you could delete this thread sleep as well.", "url": "https://github.com/apache/geode/pull/4931#discussion_r406326824", "createdAt": "2020-04-09T16:28:08Z", "author": {"login": "kirklund"}, "path": "geode-assembly/src/distributedTest/java/org/apache/geode/session/tests/CargoTestBase.java", "diffHunk": "@@ -246,13 +250,14 @@ public void containersShouldExpireInSetTimeframe()\n \n     client.setPort(Integer.parseInt(manager.getContainerPort(0)));\n     Client.Response resp = client.set(key, value);\n-\n-    getKeyValueDataOnAllClients(key, value, resp.getSessionCookie());\n-\n-    client.setMaxInactive(1);\n-    Thread.sleep(5000);\n-\n-    verifySessionIsRemoved(key);\n+    await().untilAsserted(() -> getKeyValueDataOnAllClients(key, value, resp.getSessionCookie()));\n+    client.setMaxInactive(1); // max inactive time is 1 second. Lets wait a second.\n+    Thread.sleep(2000);\n+\n+    await().untilAsserted(() -> {\n+      verifySessionIsRemoved(key);\n+      Thread.sleep(1000);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b235ee1f361aa3cc863a441828807d211ac3e5d0"}, "originalPosition": 175}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNjMyODExOQ==", "bodyText": "This looks like debugging code that was left in. Delete it?", "url": "https://github.com/apache/geode/pull/4931#discussion_r406328119", "createdAt": "2020-04-09T16:30:10Z", "author": {"login": "kirklund"}, "path": "geode-tcp-server/src/main/java/org/apache/geode/distributed/internal/tcpserver/AdvancedSocketCreatorImpl.java", "diffHunk": "@@ -97,6 +98,9 @@ public Socket connect(HostAndPort addr, int timeout,\n       InetSocketAddress inetSocketAddress = addr.getSocketInetAddress();\n       try {\n         socket.connect(inetSocketAddress, Math.max(timeout, 0));\n+      } catch (ConnectException connectException) {\n+        LogService.getLogger().info(\"Failed to connect to \" + inetSocketAddress);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b235ee1f361aa3cc863a441828807d211ac3e5d0"}, "originalPosition": 29}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b8009c6826c87486bf3cecd2555aa8c5b0af665b", "author": {"user": {"login": "mhansonp", "name": null}}, "url": "https://github.com/apache/geode/commit/b8009c6826c87486bf3cecd2555aa8c5b0af665b", "committedDate": "2020-04-09T17:33:12Z", "message": "GEODE-7751: refactoring\n\n- making logger private static\n- removing debug logging I left in."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzkwOTk2NTA2", "url": "https://github.com/apache/geode/pull/4931#pullrequestreview-390996506", "createdAt": "2020-04-09T17:36:25Z", "commit": {"oid": "b8009c6826c87486bf3cecd2555aa8c5b0af665b"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzkwOTk2Njcx", "url": "https://github.com/apache/geode/pull/4931#pullrequestreview-390996671", "createdAt": "2020-04-09T17:36:40Z", "commit": {"oid": "b8009c6826c87486bf3cecd2555aa8c5b0af665b"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4781, "cost": 1, "resetAt": "2021-10-29T19:57:52Z"}}}