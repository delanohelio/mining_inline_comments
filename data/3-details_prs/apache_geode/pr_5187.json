{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDI1Mzc2ODY5", "number": 5187, "title": "GEODE-8179: gfsh query cmd returns incorrect results if '=' sign is missing", "bodyText": "When parsing the user input in gfsh, the first = character position was used to split strings which were expected to follow the pattern --parameter=value. But if the = sign is not introduced, the = is deleted in --parameter and value (if exists).\nIn the case of --query parameter, the value of the parameter (the query itself) is very likely to contain a =, which could be removed from the query.\nWith this modification, if a query is introduced without the = between --query and the query statement, the = will not be removed from the query.\nI also have included the --J parameter in this check, because its value is always containing a =.", "createdAt": "2020-05-29T23:41:37Z", "url": "https://github.com/apache/geode/pull/5187", "merged": true, "mergeCommit": {"oid": "4477013a1656f3d94c8d36286fa497e4406da005"}, "closed": true, "closedAt": "2020-06-12T21:34:44Z", "author": {"login": "alb3rtobr"}, "timelineItems": {"totalCount": 8, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcnbj49ABqjMzOTk1MTU0NjQ=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcqp0IYgFqTQzMDA0OTQ0MQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "b2aff33fa9dd23801e6a806f70817bcd04c67bc2", "author": {"user": {"login": "alb3rtobr", "name": "Alberto Bustamante Reyes"}}, "url": "https://github.com/apache/geode/commit/b2aff33fa9dd23801e6a806f70817bcd04c67bc2", "committedDate": "2020-05-29T23:28:58Z", "message": "GEODE-8179: gfsh query cmd returns incorrect results if '=' sign is missing"}, "afterCommit": {"oid": "74b72d97fc793c5bd0b3d9a498333302336706d1", "author": {"user": {"login": "alb3rtobr", "name": "Alberto Bustamante Reyes"}}, "url": "https://github.com/apache/geode/commit/74b72d97fc793c5bd0b3d9a498333302336706d1", "committedDate": "2020-06-02T21:15:19Z", "message": "GEODE-8179: gfsh query cmd returns incorrect results if '=' sign is missing"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "01012e65424fd9d6a66129bc9be20806d0a2bdb9", "author": {"user": {"login": "alb3rtobr", "name": "Alberto Bustamante Reyes"}}, "url": "https://github.com/apache/geode/commit/01012e65424fd9d6a66129bc9be20806d0a2bdb9", "committedDate": "2020-06-03T21:30:09Z", "message": "GEODE-8179: gfsh query cmd returns incorrect results if '=' sign is missing"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "74b72d97fc793c5bd0b3d9a498333302336706d1", "author": {"user": {"login": "alb3rtobr", "name": "Alberto Bustamante Reyes"}}, "url": "https://github.com/apache/geode/commit/74b72d97fc793c5bd0b3d9a498333302336706d1", "committedDate": "2020-06-02T21:15:19Z", "message": "GEODE-8179: gfsh query cmd returns incorrect results if '=' sign is missing"}, "afterCommit": {"oid": "01012e65424fd9d6a66129bc9be20806d0a2bdb9", "author": {"user": {"login": "alb3rtobr", "name": "Alberto Bustamante Reyes"}}, "url": "https://github.com/apache/geode/commit/01012e65424fd9d6a66129bc9be20806d0a2bdb9", "committedDate": "2020-06-03T21:30:09Z", "message": "GEODE-8179: gfsh query cmd returns incorrect results if '=' sign is missing"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDI2NjA4NjY5", "url": "https://github.com/apache/geode/pull/5187#pullrequestreview-426608669", "createdAt": "2020-06-08T20:47:48Z", "commit": {"oid": "01012e65424fd9d6a66129bc9be20806d0a2bdb9"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wOFQyMDo0Nzo0OFrOGgv1mQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wOFQyMDo0Nzo0OFrOGgv1mQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNjk5MTM4NQ==", "bodyText": "anyway to not hardcode these two conditions? maybe based the decision on \"do not remove = sign if it's in the quotes\"?", "url": "https://github.com/apache/geode/pull/5187#discussion_r436991385", "createdAt": "2020-06-08T20:47:48Z", "author": {"login": "jinmeiliao"}, "path": "geode-gfsh/src/main/java/org/apache/geode/management/internal/cli/GfshParser.java", "diffHunk": "@@ -122,21 +122,30 @@ else if (insideQuoteOf == c) {\n     List<String> splitWithWhiteSpaces = splitWithWhiteSpace(userInput);\n \n     List<String> furtherSplitWithEquals = new ArrayList<>();\n+    boolean doNotRemoveEqualsInNextToken = false;\n     for (String token : splitWithWhiteSpaces) {\n-      // if this token has equal sign, split around the first occurrence of it\n-      int indexOfFirstEqual = token.indexOf('=');\n-      if (indexOfFirstEqual < 0) {\n+      if (doNotRemoveEqualsInNextToken) {\n         furtherSplitWithEquals.add(token);\n+        doNotRemoveEqualsInNextToken = false;\n       } else {\n-        String left = token.substring(0, indexOfFirstEqual);\n-        String right = token.substring(indexOfFirstEqual + 1);\n-        if (left.length() > 0) {\n-          furtherSplitWithEquals.add(left);\n-        }\n-        if (right.length() > 0) {\n-          furtherSplitWithEquals.add(right);\n+        // if this token has equal sign, split around the first occurrence of it\n+        int indexOfFirstEqual = token.indexOf('=');\n+        if (indexOfFirstEqual < 0) {\n+          furtherSplitWithEquals.add(token);\n+        } else {\n+          String left = token.substring(0, indexOfFirstEqual);\n+          String right = token.substring(indexOfFirstEqual + 1);\n+          if (left.length() > 0) {\n+            furtherSplitWithEquals.add(left);\n+          }\n+          if (right.length() > 0) {\n+            furtherSplitWithEquals.add(right);\n+          }\n         }\n       }\n+      if (token.equals(\"--query\") || token.equals(\"--J\")) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "01012e65424fd9d6a66129bc9be20806d0a2bdb9"}, "originalPosition": 35}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b034a50dfd3988eeb721836bb9abebe2e0431b9f", "author": {"user": {"login": "alb3rtobr", "name": "Alberto Bustamante Reyes"}}, "url": "https://github.com/apache/geode/commit/b034a50dfd3988eeb721836bb9abebe2e0431b9f", "committedDate": "2020-06-09T09:01:03Z", "message": "GEODE-8179: Avoid to hardcode option names"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDI5MzI0OTkw", "url": "https://github.com/apache/geode/pull/5187#pullrequestreview-429324990", "createdAt": "2020-06-11T22:04:21Z", "commit": {"oid": "b034a50dfd3988eeb721836bb9abebe2e0431b9f"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xMVQyMjowNDoyMlrOGiwXkw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xMVQyMjowNDoyMlrOGiwXkw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzOTA5NzIzNQ==", "bodyText": "this entire for loop can be simplified to:\nfor (String token : splitWithWhiteSpaces) {\n      // do not split with \"=\" if this part starts with quotes or is part of -D\n      if(token.startsWith(\"'\") || token.startsWith(\"\\\"\") || token.startsWith(\"-D\")) {\n        furtherSplitWithEquals.add(token);\n        continue;\n      }\n      // if this token has equal sign, split around the first occurrence of it\n      int indexOfFirstEqual = token.indexOf('=');\n      if (indexOfFirstEqual < 0) {\n        furtherSplitWithEquals.add(token);\n        continue;\n      }\n      String left = token.substring(0, indexOfFirstEqual);\n      String right = token.substring(indexOfFirstEqual + 1);\n      if (left.length() > 0) {\n        furtherSplitWithEquals.add(left);\n      }\n      if (right.length() > 0) {\n        furtherSplitWithEquals.add(right);\n      }\n    }", "url": "https://github.com/apache/geode/pull/5187#discussion_r439097235", "createdAt": "2020-06-11T22:04:22Z", "author": {"login": "jinmeiliao"}, "path": "geode-gfsh/src/main/java/org/apache/geode/management/internal/cli/GfshParser.java", "diffHunk": "@@ -123,18 +123,25 @@ else if (insideQuoteOf == c) {\n \n     List<String> furtherSplitWithEquals = new ArrayList<>();\n     for (String token : splitWithWhiteSpaces) {\n-      // if this token has equal sign, split around the first occurrence of it\n       int indexOfFirstEqual = token.indexOf('=');\n-      if (indexOfFirstEqual < 0) {\n+      int indexOfFirstDoubleQuote = token.indexOf('\"');\n+      int indexOfFirstSingleQuote = token.indexOf('\\'');\n+      if (indexOfFirstEqual < 0 || token.startsWith(\"-D\")) {\n         furtherSplitWithEquals.add(token);\n       } else {\n-        String left = token.substring(0, indexOfFirstEqual);\n-        String right = token.substring(indexOfFirstEqual + 1);\n-        if (left.length() > 0) {\n-          furtherSplitWithEquals.add(left);\n-        }\n-        if (right.length() > 0) {\n-          furtherSplitWithEquals.add(right);\n+        if (indexOfFirstDoubleQuote == 0 || indexOfFirstSingleQuote == 0) {\n+          furtherSplitWithEquals.add(token);\n+        } else if ((indexOfFirstDoubleQuote < 0 && indexOfFirstSingleQuote < 0)\n+            || (indexOfFirstEqual < indexOfFirstDoubleQuote)\n+            || (indexOfFirstEqual < indexOfFirstSingleQuote)) {\n+          String left = token.substring(0, indexOfFirstEqual);\n+          String right = token.substring(indexOfFirstEqual + 1);\n+          if (left.length() > 0) {\n+            furtherSplitWithEquals.add(left);\n+          }\n+          if (right.length() > 0) {\n+            furtherSplitWithEquals.add(right);\n+          }\n         }\n       }\n     }", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b034a50dfd3988eeb721836bb9abebe2e0431b9f"}, "originalPosition": 34}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "59079ec03c8841d074b80e73bbf1010c28abc6d3", "author": {"user": {"login": "alb3rtobr", "name": "Alberto Bustamante Reyes"}}, "url": "https://github.com/apache/geode/commit/59079ec03c8841d074b80e73bbf1010c28abc6d3", "committedDate": "2020-06-12T08:21:06Z", "message": "GEODE-8179: Simplify loop after review"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDMwMDQ5NDQx", "url": "https://github.com/apache/geode/pull/5187#pullrequestreview-430049441", "createdAt": "2020-06-12T21:33:57Z", "commit": {"oid": "59079ec03c8841d074b80e73bbf1010c28abc6d3"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4398, "cost": 1, "resetAt": "2021-10-29T19:57:52Z"}}}