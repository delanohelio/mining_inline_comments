{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTMwNjI5NTcw", "number": 5799, "title": "GEODE-8634: Fix AsyncInvocationTimeoutDistributedTest flakiness", "bodyText": "Null out latch and threadId before each test.\nThe bug was caused by:\n\nThe previous test left threadId set to a non-zero value*\nThe await() in the second thread completes before the threadId.set() in the first thread executes\nThe second thread returns the wrong value for remoteThreadId\nThe wrong remoteThreadId is then compared to the caught exception's message which has a different thread id\n\n*Previous test was await_callable_timeout_includesStackTraceAsCause in all three recorded test failures\nFix is simple: always set threadId to zero value before running each test.", "createdAt": "2020-12-01T23:06:05Z", "url": "https://github.com/apache/geode/pull/5799", "merged": true, "mergeCommit": {"oid": "2e7cb33a2ac23438909e9e48d81108f5d9439a6c"}, "closed": true, "closedAt": "2020-12-05T19:01:54Z", "author": {"login": "kirklund"}, "timelineItems": {"totalCount": 6, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdindmEgFqTU0NDI1NzE5Mg==", "endCursor": "Y3Vyc29yOnYyOpPPAAABdi9FahgFqTU0NTI0NjM4Mw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTQ0MjU3MTky", "url": "https://github.com/apache/geode/pull/5799#pullrequestreview-544257192", "createdAt": "2020-12-03T18:29:17Z", "commit": {"oid": "c28f2f6da201f2f02ab54b289b561e7728e9a6c2"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "c28f2f6da201f2f02ab54b289b561e7728e9a6c2", "author": {"user": {"login": "kirklund", "name": "Kirk Lund"}}, "url": "https://github.com/apache/geode/commit/c28f2f6da201f2f02ab54b289b561e7728e9a6c2", "committedDate": "2020-12-01T23:03:32Z", "message": "GEODE-8634: Fix AsyncInvocationTimeoutDistributedTest flakiness\n\nNull out latch and threadId before each test."}, "afterCommit": {"oid": "09b1e4bf79ca3918c5310a561ffffc9d03cf34e4", "author": {"user": {"login": "kirklund", "name": "Kirk Lund"}}, "url": "https://github.com/apache/geode/commit/09b1e4bf79ca3918c5310a561ffffc9d03cf34e4", "committedDate": "2020-12-03T19:13:28Z", "message": "GEODE-8634: Fix AsyncInvocationTimeoutDistributedTest flakiness\n\nNull out latch and threadId before each test."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTQ0NDAyMTE2", "url": "https://github.com/apache/geode/pull/5799#pullrequestreview-544402116", "createdAt": "2020-12-03T20:32:34Z", "commit": {"oid": "09b1e4bf79ca3918c5310a561ffffc9d03cf34e4"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0wM1QyMDozMjozNFrOH-w91Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0wM1QyMDozMjozNFrOH-w91Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNTU3NjAyMQ==", "bodyText": "Is it better to initialize latch to CountDownLatch(0) instead of null? Also initialize it in line 45, when latch is declared?", "url": "https://github.com/apache/geode/pull/5799#discussion_r535576021", "createdAt": "2020-12-03T20:32:34Z", "author": {"login": "jchen21"}, "path": "geode-dunit/src/distributedTest/java/org/apache/geode/test/dunit/tests/AsyncInvocationTimeoutDistributedTest.java", "diffHunk": "@@ -40,12 +41,20 @@\n \n   private static final long TIMEOUT_MILLIS = getTimeout().toMillis();\n \n-  private static final AtomicReference<Long> threadId = new AtomicReference<>();\n+  private static final AtomicReference<Long> threadId = new AtomicReference<>(0L);\n   private static final AtomicReference<CountDownLatch> latch = new AtomicReference<>();\n \n   @Rule\n   public DistributedRule distributedRule = new DistributedRule();\n \n+  @Before\n+  public void setUp() {\n+    getVM(0).invoke(() -> {\n+      latch.set(null);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "09b1e4bf79ca3918c5310a561ffffc9d03cf34e4"}, "originalPosition": 22}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "8ae9198c5e9cda8d3fa3a2d3659f53e89815aed7", "author": {"user": {"login": "kirklund", "name": "Kirk Lund"}}, "url": "https://github.com/apache/geode/commit/8ae9198c5e9cda8d3fa3a2d3659f53e89815aed7", "committedDate": "2020-12-04T18:17:46Z", "message": "GEODE-8634: Fix AsyncInvocationTimeoutDistributedTest flakiness\n\nReset latch and threadId before each test."}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "09b1e4bf79ca3918c5310a561ffffc9d03cf34e4", "author": {"user": {"login": "kirklund", "name": "Kirk Lund"}}, "url": "https://github.com/apache/geode/commit/09b1e4bf79ca3918c5310a561ffffc9d03cf34e4", "committedDate": "2020-12-03T19:13:28Z", "message": "GEODE-8634: Fix AsyncInvocationTimeoutDistributedTest flakiness\n\nNull out latch and threadId before each test."}, "afterCommit": {"oid": "8ae9198c5e9cda8d3fa3a2d3659f53e89815aed7", "author": {"user": {"login": "kirklund", "name": "Kirk Lund"}}, "url": "https://github.com/apache/geode/commit/8ae9198c5e9cda8d3fa3a2d3659f53e89815aed7", "committedDate": "2020-12-04T18:17:46Z", "message": "GEODE-8634: Fix AsyncInvocationTimeoutDistributedTest flakiness\n\nReset latch and threadId before each test."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTQ1MjQ2Mzgz", "url": "https://github.com/apache/geode/pull/5799#pullrequestreview-545246383", "createdAt": "2020-12-04T19:40:47Z", "commit": {"oid": "8ae9198c5e9cda8d3fa3a2d3659f53e89815aed7"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3917, "cost": 1, "resetAt": "2021-10-29T19:57:52Z"}}}