{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0MzkyNjkyNzIy", "number": 4843, "reviewThreads": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yNFQxNjoyNzoyM1rODq3v3w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yNFQxNjoyNzoyM1rODq3v3w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjQ2MjgwMTU5OnYy", "diffSide": "RIGHT", "path": "geode-core/src/main/java/org/apache/geode/internal/net/SocketCreator.java", "isResolved": false, "comments": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yNFQxNjoyNzoyM1rOF64pHw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yNFQxNzo1NToyN1rOF68diA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NzI4OTc1OQ==", "bodyText": "Two things:\n\na nit: the allocation can be moved after the conditional :)\nis the type check sufficient or is a content check necessary?\n\non (2) I wonder if there is a scenario where SNI might be set already, but maybe it disagrees with addr.getHostName()", "url": "https://github.com/apache/geode/pull/4843#discussion_r397289759", "createdAt": "2020-03-24T16:27:23Z", "author": {"login": "Bill"}, "path": "geode-core/src/main/java/org/apache/geode/internal/net/SocketCreator.java", "diffHunk": "@@ -774,6 +775,14 @@ private void setServerNames(SSLParameters modifiedParams, HostAndPort addr) {\n     List<SNIServerName> oldNames = modifiedParams.getServerNames();\n     oldNames = oldNames == null ? Collections.emptyList() : oldNames;\n     final List<SNIServerName> serverNames = new ArrayList<>(oldNames);\n+\n+    if (serverNames.stream()\n+        .mapToInt(SNIServerName::getType)\n+        .anyMatch(type -> type == StandardConstants.SNI_HOST_NAME)) {\n+      // we already have a SNI hostname set. Do nothing.\n+      return;\n+    }\n+", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "8960030c0e1f0bae6f8db3e78e0be2c0892bb1aa"}, "originalPosition": 19}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NzMxMjA5Ng==", "bodyText": "For (2) - it certainly could disagree since the JDK is setting it to whatever it wants ... But the JDK also only allows one SNI name of a given type. So I guess we just need to decide what the behavior is that we want. I thought it would best to leave the JDK setting in place.", "url": "https://github.com/apache/geode/pull/4843#discussion_r397312096", "createdAt": "2020-03-24T16:56:39Z", "author": {"login": "upthewaterspout"}, "path": "geode-core/src/main/java/org/apache/geode/internal/net/SocketCreator.java", "diffHunk": "@@ -774,6 +775,14 @@ private void setServerNames(SSLParameters modifiedParams, HostAndPort addr) {\n     List<SNIServerName> oldNames = modifiedParams.getServerNames();\n     oldNames = oldNames == null ? Collections.emptyList() : oldNames;\n     final List<SNIServerName> serverNames = new ArrayList<>(oldNames);\n+\n+    if (serverNames.stream()\n+        .mapToInt(SNIServerName::getType)\n+        .anyMatch(type -> type == StandardConstants.SNI_HOST_NAME)) {\n+      // we already have a SNI hostname set. Do nothing.\n+      return;\n+    }\n+", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NzI4OTc1OQ=="}, "originalCommit": {"oid": "8960030c0e1f0bae6f8db3e78e0be2c0892bb1aa"}, "originalPosition": 19}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NzMyMjgwNQ==", "bodyText": "Maybe we could unconditionally delete whatever is there and replace it with our own content?", "url": "https://github.com/apache/geode/pull/4843#discussion_r397322805", "createdAt": "2020-03-24T17:11:52Z", "author": {"login": "Bill"}, "path": "geode-core/src/main/java/org/apache/geode/internal/net/SocketCreator.java", "diffHunk": "@@ -774,6 +775,14 @@ private void setServerNames(SSLParameters modifiedParams, HostAndPort addr) {\n     List<SNIServerName> oldNames = modifiedParams.getServerNames();\n     oldNames = oldNames == null ? Collections.emptyList() : oldNames;\n     final List<SNIServerName> serverNames = new ArrayList<>(oldNames);\n+\n+    if (serverNames.stream()\n+        .mapToInt(SNIServerName::getType)\n+        .anyMatch(type -> type == StandardConstants.SNI_HOST_NAME)) {\n+      // we already have a SNI hostname set. Do nothing.\n+      return;\n+    }\n+", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NzI4OTc1OQ=="}, "originalCommit": {"oid": "8960030c0e1f0bae6f8db3e78e0be2c0892bb1aa"}, "originalPosition": 19}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NzM1MjMyOA==", "bodyText": "Having looked at the path into this method, it's clear that this framework owns this socket and the only way it can set set will cause it to have the value we expect so I'm ok w/ this code as-is. Thanks for playing!", "url": "https://github.com/apache/geode/pull/4843#discussion_r397352328", "createdAt": "2020-03-24T17:55:27Z", "author": {"login": "Bill"}, "path": "geode-core/src/main/java/org/apache/geode/internal/net/SocketCreator.java", "diffHunk": "@@ -774,6 +775,14 @@ private void setServerNames(SSLParameters modifiedParams, HostAndPort addr) {\n     List<SNIServerName> oldNames = modifiedParams.getServerNames();\n     oldNames = oldNames == null ? Collections.emptyList() : oldNames;\n     final List<SNIServerName> serverNames = new ArrayList<>(oldNames);\n+\n+    if (serverNames.stream()\n+        .mapToInt(SNIServerName::getType)\n+        .anyMatch(type -> type == StandardConstants.SNI_HOST_NAME)) {\n+      // we already have a SNI hostname set. Do nothing.\n+      return;\n+    }\n+", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NzI4OTc1OQ=="}, "originalCommit": {"oid": "8960030c0e1f0bae6f8db3e78e0be2c0892bb1aa"}, "originalPosition": 19}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4415, "cost": 1, "resetAt": "2021-11-11T21:28:48Z"}}}