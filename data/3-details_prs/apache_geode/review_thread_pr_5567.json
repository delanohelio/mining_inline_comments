{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDk0Njg5MDYy", "number": 5567, "reviewThreads": {"totalCount": 7, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wM1QyMjoxNTozOVrOE1AB5A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wNFQxNToxOTo1OFrOE1RXTQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzI0MDEwNDY4OnYy", "diffSide": "RIGHT", "path": "geode-gfsh/src/main/java/org/apache/geode/management/internal/cli/commands/ShowMissingDiskStoreCommand.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wM1QyMjoxNTozOVrOHtCZgQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wM1QyMjoxNTozOVrOHtCZgQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNjk4NzI2NQ==", "bodyText": "I believe you don't need this boolean. If no servers, missingRegions will be null, otherwise, it's empty or has data", "url": "https://github.com/apache/geode/pull/5567#discussion_r516987265", "createdAt": "2020-11-03T22:15:39Z", "author": {"login": "jinmeiliao"}, "path": "geode-gfsh/src/main/java/org/apache/geode/management/internal/cli/commands/ShowMissingDiskStoreCommand.java", "diffHunk": "@@ -53,16 +53,19 @@ public ResultModel showMissingDiskStore() {\n     Set<DistributedMember> dataMembers =\n         DiskStoreCommandsUtils.getNormalMembers((InternalCache) getCache());\n \n-    if (dataMembers.isEmpty()) {\n-      return ResultModel.createInfo(CliStrings.NO_CACHING_MEMBERS_FOUND_MESSAGE);\n+    List<ColocatedRegionDetails> missingRegions = null;\n+    boolean cacheMemberExist = false;\n+\n+    if (!dataMembers.isEmpty()) {\n+      cacheMemberExist = true;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "22454e9ab32dc408d9b93979635b32c182b953e9"}, "originalPosition": 10}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzI0MDExMDg3OnYy", "diffSide": "RIGHT", "path": "geode-gfsh/src/main/java/org/apache/geode/management/internal/cli/commands/ShowMissingDiskStoreCommand.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wM1QyMjoxNzo1N1rOHtCdHg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wM1QyMjoxNzo1N1rOHtCdHg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNjk4ODE5MA==", "bodyText": "here you can do something like:\nif (missingColocatedRegions == null) {\n  // set the header as \"no caching members\"\n}\nelse if (missingColocatedRegions.isEmpty()) {\n....\n}\nelse{\n....\n}", "url": "https://github.com/apache/geode/pull/5567#discussion_r516988190", "createdAt": "2020-11-03T22:17:57Z", "author": {"login": "jinmeiliao"}, "path": "geode-gfsh/src/main/java/org/apache/geode/management/internal/cli/commands/ShowMissingDiskStoreCommand.java", "diffHunk": "@@ -113,7 +116,9 @@ private ResultModel toMissingDiskStoresTabularResult(\n     }\n \n     TabularResultModel missingRegionsSection = result.addTable(MISSING_COLOCATED_REGIONS_SECTION);\n-    if (hasMissingColocatedRegions) {\n+    if (!cacheMemberExist) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "22454e9ab32dc408d9b93979635b32c182b953e9"}, "originalPosition": 43}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzI0MDExMjcwOnYy", "diffSide": "RIGHT", "path": "geode-gfsh/src/distributedTest/java/org/apache/geode/management/internal/cli/commands/ShowMissingDiskStoreCommandDUnitTest.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wM1QyMjoxODo0NVrOHtCeUw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wM1QyMjoxODo0NVrOHtCeUw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNjk4ODQ5OQ==", "bodyText": "instead of suppress the warning, just don't assign it to a variable", "url": "https://github.com/apache/geode/pull/5567#discussion_r516988499", "createdAt": "2020-11-03T22:18:45Z", "author": {"login": "jinmeiliao"}, "path": "geode-gfsh/src/distributedTest/java/org/apache/geode/management/internal/cli/commands/ShowMissingDiskStoreCommandDUnitTest.java", "diffHunk": "@@ -156,6 +160,71 @@ public void stoppingAndRestartingMemberDoesNotResultInMissingDiskStore() {\n     assertThat(missingDiskStoreIds).isNull();\n   }\n \n+\n+  @Test\n+  public void stopAllMembersAndStart2ndLocator() throws Exception {\n+    IgnoredException.addIgnoredException(DistributedSystemDisconnectedException.class);\n+\n+    MemberVM locator1 = lsRule.startLocatorVM(1, locator.getPort());\n+\n+    MemberVM server1 = lsRule.startServerVM(2, locator.getPort(), locator1.getPort());\n+    @SuppressWarnings(\"unused\")", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "22454e9ab32dc408d9b93979635b32c182b953e9"}, "originalPosition": 39}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzI0MDExNTUxOnYy", "diffSide": "RIGHT", "path": "geode-gfsh/src/distributedTest/java/org/apache/geode/management/internal/cli/commands/ShowMissingDiskStoreCommandDUnitTest.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wM1QyMjoxOTo0MlrOHtCf3g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wM1QyMjoxOTo0MlrOHtCf3g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNjk4ODg5NA==", "bodyText": "I believe you can just create a region without the diskstore, the same problem would still manifest. Make the test simpler", "url": "https://github.com/apache/geode/pull/5567#discussion_r516988894", "createdAt": "2020-11-03T22:19:42Z", "author": {"login": "jinmeiliao"}, "path": "geode-gfsh/src/distributedTest/java/org/apache/geode/management/internal/cli/commands/ShowMissingDiskStoreCommandDUnitTest.java", "diffHunk": "@@ -156,6 +160,71 @@ public void stoppingAndRestartingMemberDoesNotResultInMissingDiskStore() {\n     assertThat(missingDiskStoreIds).isNull();\n   }\n \n+\n+  @Test\n+  public void stopAllMembersAndStart2ndLocator() throws Exception {\n+    IgnoredException.addIgnoredException(DistributedSystemDisconnectedException.class);\n+\n+    MemberVM locator1 = lsRule.startLocatorVM(1, locator.getPort());\n+\n+    MemberVM server1 = lsRule.startServerVM(2, locator.getPort(), locator1.getPort());\n+    @SuppressWarnings(\"unused\")\n+    MemberVM server2 = lsRule.startServerVM(3, locator.getPort(), locator1.getPort());\n+\n+    final String testRegionName = \"regionA\";", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "22454e9ab32dc408d9b93979635b32c182b953e9"}, "originalPosition": 42}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzI0MDExNjg2OnYy", "diffSide": "RIGHT", "path": "geode-gfsh/src/distributedTest/java/org/apache/geode/management/internal/cli/commands/ShowMissingDiskStoreCommandDUnitTest.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wM1QyMjoyMDowOVrOHtCgoQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wM1QyMjoyMDowOVrOHtCgoQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNjk4OTA4OQ==", "bodyText": "you also don't need to add data and do rebalance. Maybe add a comment in your test making it clear that you are starting a stale locator first (locator 1 shutdown before locator0, and now you are starting locator 1 first), locator 1 won't start properly until a diskstore on locator 0 is revoked", "url": "https://github.com/apache/geode/pull/5567#discussion_r516989089", "createdAt": "2020-11-03T22:20:09Z", "author": {"login": "jinmeiliao"}, "path": "geode-gfsh/src/distributedTest/java/org/apache/geode/management/internal/cli/commands/ShowMissingDiskStoreCommandDUnitTest.java", "diffHunk": "@@ -156,6 +160,71 @@ public void stoppingAndRestartingMemberDoesNotResultInMissingDiskStore() {\n     assertThat(missingDiskStoreIds).isNull();\n   }\n \n+\n+  @Test\n+  public void stopAllMembersAndStart2ndLocator() throws Exception {\n+    IgnoredException.addIgnoredException(DistributedSystemDisconnectedException.class);\n+\n+    MemberVM locator1 = lsRule.startLocatorVM(1, locator.getPort());\n+\n+    MemberVM server1 = lsRule.startServerVM(2, locator.getPort(), locator1.getPort());\n+    @SuppressWarnings(\"unused\")\n+    MemberVM server2 = lsRule.startServerVM(3, locator.getPort(), locator1.getPort());\n+\n+    final String testRegionName = \"regionA\";\n+    CommandStringBuilder csb;\n+    csb = new CommandStringBuilder(CliStrings.CREATE_DISK_STORE)\n+        .addOption(CliStrings.CREATE_DISK_STORE__NAME, \"diskStore\")\n+        .addOption(CliStrings.CREATE_DISK_STORE__DIRECTORY_AND_SIZE, \"diskStoreDir\");\n+    gfshConnector.executeAndAssertThat(csb.getCommandString()).statusIsSuccess();\n+\n+    CommandStringBuilder createRegion = new CommandStringBuilder(CliStrings.CREATE_REGION)\n+        .addOption(CliStrings.CREATE_REGION__REGION, testRegionName)\n+        .addOption(CliStrings.CREATE_REGION__DISKSTORE, \"diskStore\")\n+        .addOption(CliStrings.CREATE_REGION__REGIONSHORTCUT,\n+            RegionShortcut.PARTITION_REDUNDANT_PERSISTENT.toString());\n+    await().untilAsserted(() -> gfshConnector.executeAndAssertThat(createRegion.getCommandString())\n+        .statusIsSuccess());\n+\n+\n+    lsRule.stop(1, false);\n+\n+    // Add data to the region\n+    addData(server1, testRegionName);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "22454e9ab32dc408d9b93979635b32c182b953e9"}, "originalPosition": 61}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzI0Mjk0MjUzOnYy", "diffSide": "RIGHT", "path": "geode-gfsh/src/main/java/org/apache/geode/management/internal/cli/commands/ShowMissingDiskStoreCommand.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wNFQxNToxOTozMFrOHtc29w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wNFQxNToxOTozMFrOHtc29w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNzQyMDc5MQ==", "bodyText": "this variable is not used anymore.", "url": "https://github.com/apache/geode/pull/5567#discussion_r517420791", "createdAt": "2020-11-04T15:19:30Z", "author": {"login": "jinmeiliao"}, "path": "geode-gfsh/src/main/java/org/apache/geode/management/internal/cli/commands/ShowMissingDiskStoreCommand.java", "diffHunk": "@@ -95,7 +96,8 @@ private ResultModel toMissingDiskStoresTabularResult(\n     ResultModel result = new ResultModel();\n \n     boolean hasMissingDiskStores = missingDiskStores.length != 0;\n-    boolean hasMissingColocatedRegions = !missingColocatedRegions.isEmpty();\n+    boolean hasMissingColocatedRegions =", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "2d9232dc212dbb51de51773dc042e197f6ba6b52"}, "originalPosition": 20}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzI0Mjk0NDc3OnYy", "diffSide": "RIGHT", "path": "geode-gfsh/src/main/java/org/apache/geode/management/internal/cli/commands/ShowMissingDiskStoreCommand.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wNFQxNToxOTo1OFrOHtc4Tw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wNFQxNToxOTo1OFrOHtc4Tw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNzQyMTEzNQ==", "bodyText": "actually you can get rid of this variable and inline this too, to make it symetric.", "url": "https://github.com/apache/geode/pull/5567#discussion_r517421135", "createdAt": "2020-11-04T15:19:58Z", "author": {"login": "jinmeiliao"}, "path": "geode-gfsh/src/main/java/org/apache/geode/management/internal/cli/commands/ShowMissingDiskStoreCommand.java", "diffHunk": "@@ -95,7 +96,8 @@ private ResultModel toMissingDiskStoresTabularResult(\n     ResultModel result = new ResultModel();\n \n     boolean hasMissingDiskStores = missingDiskStores.length != 0;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "2d9232dc212dbb51de51773dc042e197f6ba6b52"}, "originalPosition": 18}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4653, "cost": 1, "resetAt": "2021-11-11T21:28:48Z"}}}