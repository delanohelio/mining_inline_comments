{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDkxOTEyNzg1", "number": 5544, "title": "GEODE-8515: Redis PING should respond appropriately when called from within a SUBSCRIBE/PSUBSCRIBE", "bodyText": "From PING documentation (https://redis.io/commands/ping):\nIf the client is subscribed to a channel or a pattern, it will instead return a multi-bulk with a \"pong\" in the first position and an empty bulk in the second position, unless an argument is provided in which case it returns a copy of the argument.", "createdAt": "2020-09-23T16:52:18Z", "url": "https://github.com/apache/geode/pull/5544", "merged": true, "mergeCommit": {"oid": "06d7bc8cf7e5896d850825d2eb8e0943d75847b1"}, "closed": true, "closedAt": "2020-09-25T00:04:18Z", "author": {"login": "sabbey37"}, "timelineItems": {"totalCount": 9, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdLvX0AgH2gAyNDkxOTEyNzg1OjVmNzA5YjIxOTBiNzJlZWY2OTY0MTNlZjgwOWU3ZjI2MDJjNWQxYWE=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdMKSXLAFqTQ5NjAyNjY5NQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "5f709b2190b72eef696413ef809e7f2602c5d1aa", "author": {"user": {"login": "sabbey37", "name": "Sarah"}}, "url": "https://github.com/apache/geode/commit/5f709b2190b72eef696413ef809e7f2602c5d1aa", "committedDate": "2020-09-23T16:41:57Z", "message": "GEODE-8515: Redis PING should respond appropriately when called from within a SUBSCRIBE/PSUBSCRIBE"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "5446fd1d625ca0a52e24597bfa3e79d87bfc1fcf", "author": {"user": {"login": "sabbey37", "name": "Sarah"}}, "url": "https://github.com/apache/geode/commit/5446fd1d625ca0a52e24597bfa3e79d87bfc1fcf", "committedDate": "2020-09-23T16:56:54Z", "message": "Fix SubscriptionsIntegrationTest"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "fa0a9a356e5806be491622a5602f5127501ae486", "author": {"user": {"login": "sabbey37", "name": "Sarah"}}, "url": "https://github.com/apache/geode/commit/fa0a9a356e5806be491622a5602f5127501ae486", "committedDate": "2020-09-23T19:35:10Z", "message": "ci trigger"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "1eb63db55a8becd5ff71270ca2a98f78d794a5a6", "author": {"user": {"login": "sabbey37", "name": "Sarah"}}, "url": "https://github.com/apache/geode/commit/1eb63db55a8becd5ff71270ca2a98f78d794a5a6", "committedDate": "2020-09-23T19:53:34Z", "message": "Removes temp file"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDk1NzkyNDg1", "url": "https://github.com/apache/geode/pull/5544#pullrequestreview-495792485", "createdAt": "2020-09-24T17:24:20Z", "commit": {"oid": "1eb63db55a8becd5ff71270ca2a98f78d794a5a6"}, "state": "COMMENTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yNFQxNzoyNDoyMFrOHXlHPw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yNFQxNzozMTo1OVrOHXlY5g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NDQ4NzM1OQ==", "bodyText": "why a long timeout on this one but not on pingWithArgumentWhileSubscribed?", "url": "https://github.com/apache/geode/pull/5544#discussion_r494487359", "createdAt": "2020-09-24T17:24:20Z", "author": {"login": "dschneider-pivotal"}, "path": "geode-redis/src/integrationTest/java/org/apache/geode/redis/internal/executor/pubsub/SubscriptionsIntegrationTest.java", "diffHunk": "@@ -39,9 +38,8 @@\n   public static ExecutorServiceRule executor = new ExecutorServiceRule();\n \n   @Test\n-  @Ignore(\"GEODE-8515\")\n   public void pingWhileSubscribed() {\n-    Jedis client = new Jedis(\"localhost\", server.getPort());\n+    Jedis client = new Jedis(\"localhost\", server.getPort(), 1000000000);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "1eb63db55a8becd5ff71270ca2a98f78d794a5a6"}, "originalPosition": 15}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NDQ5MTg3OA==", "bodyText": "consider refactoring this so that we only compute the RedisResponse for subscribe if we find a client and then otherwise with (an else) compute the RedisResponse when not subscribed. I don't like all the logic we have initializing two different results and then we only end up using one or the other. I'd prefer that we only have state at the top that would be shared by either branch (for example commandElems). Once the RedisResponse is done we can then fall through to a command return.", "url": "https://github.com/apache/geode/pull/5544#discussion_r494491878", "createdAt": "2020-09-24T17:31:59Z", "author": {"login": "dschneider-pivotal"}, "path": "geode-redis/src/main/java/org/apache/geode/redis/internal/executor/connection/PingExecutor.java", "diffHunk": "@@ -31,9 +32,17 @@ public RedisResponse executeCommand(Command command,\n       ExecutionHandlerContext context) {\n     List<byte[]> commandElems = command.getProcessedCommand();\n     byte[] result = PING_RESPONSE.getBytes();\n+    byte[] subscribeResult = \"\".getBytes();\n     if (commandElems.size() > 1) {\n       result = commandElems.get(1);\n+      subscribeResult = result;\n     }\n+\n+    if (!context.getPubSub().findSubscribedChannels(context.getClient()).isEmpty()) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "1eb63db55a8becd5ff71270ca2a98f78d794a5a6"}, "originalPosition": 18}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "261a7699c5aaf7a357fdc62ba52b720c9548ddd8", "author": {"user": {"login": "sabbey37", "name": "Sarah"}}, "url": "https://github.com/apache/geode/commit/261a7699c5aaf7a357fdc62ba52b720c9548ddd8", "committedDate": "2020-09-24T18:41:24Z", "message": "PR review changes"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDk1ODg3Mjc3", "url": "https://github.com/apache/geode/pull/5544#pullrequestreview-495887277", "createdAt": "2020-09-24T19:27:50Z", "commit": {"oid": "261a7699c5aaf7a357fdc62ba52b720c9548ddd8"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "21cef398698aa18f8c88c54921c669dccde3d19b", "author": {"user": {"login": "sabbey37", "name": "Sarah"}}, "url": "https://github.com/apache/geode/commit/21cef398698aa18f8c88c54921c669dccde3d19b", "committedDate": "2020-09-24T20:28:57Z", "message": "Review changes"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDk2MDI2Njk1", "url": "https://github.com/apache/geode/pull/5544#pullrequestreview-496026695", "createdAt": "2020-09-25T00:03:26Z", "commit": {"oid": "21cef398698aa18f8c88c54921c669dccde3d19b"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4034, "cost": 1, "resetAt": "2021-10-29T19:57:52Z"}}}