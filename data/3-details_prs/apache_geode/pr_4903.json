{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0Mzk4MjcxMzU5", "number": 4903, "title": "GEODE-7098: Tomcat8SessionsClientServerDUnitTest Tests were getting bind failures", "bodyText": "They were using SocketUtils.getAvailableTCPPort\nMoved tests to use AvailablePortHelper class\nAdded Sanity check to setup\n\nThank you for submitting a contribution to Apache Geode.\nIn order to streamline the review of the contribution we ask you\nto ensure the following steps have been taken:\nFor all changes:\n\n\n Is there a JIRA ticket associated with this PR? Is it referenced in the commit message?\n\n\n Has your PR been rebased against the latest commit within the target branch (typically develop)?\n\n\n Is your initial contribution a single, squashed commit?\n\n\n Does gradlew build run cleanly?\n\n\n Have you written or updated unit tests to verify your changes?\n\n\n If adding new dependencies to the code, are these dependencies licensed in a way that is compatible for inclusion under ASF 2.0?\n\n\nNote:\nPlease ensure that once the PR is submitted, check Concourse for build issues and\nsubmit an update to your PR as soon as possible. If you need help, please send an\nemail to dev@geode.apache.org.", "createdAt": "2020-04-03T16:31:19Z", "url": "https://github.com/apache/geode/pull/4903", "merged": true, "mergeCommit": {"oid": "abd0f54dd280b64473a4ef36149d31de4a74da1d"}, "closed": true, "closedAt": "2020-04-06T16:22:39Z", "author": {"login": "mhansonp"}, "timelineItems": {"totalCount": 8, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcT5p8pgH2gAyMzk4MjcxMzU5OmYwYmVhYzFmODY4OGJlMDI3OTNmMWVlMmU4ZWM1ZDE5NzAzNWViZWE=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcUIsWZgFqTM4NzYxNjc3Nw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "f0beac1f8688be02793f1ee2e8ec5d197035ebea", "author": {"user": {"login": "mhansonp", "name": null}}, "url": "https://github.com/apache/geode/commit/f0beac1f8688be02793f1ee2e8ec5d197035ebea", "committedDate": "2020-04-03T05:01:03Z", "message": "GEODE-7098: Tests were getting bind failures using SocketUtils.getAvailableTCPPort\n\n- Moved tests to use AvailablePortHelper class\n- Added Sanity check to setup"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "099ba3a2dff7258ee530bc440e9871838181c241", "author": {"user": {"login": "mhansonp", "name": null}}, "url": "https://github.com/apache/geode/commit/099ba3a2dff7258ee530bc440e9871838181c241", "committedDate": "2020-04-03T16:34:13Z", "message": "GEODE-7098: spotless cleanup of tests."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzg3NTk0MTgw", "url": "https://github.com/apache/geode/pull/4903#pullrequestreview-387594180", "createdAt": "2020-04-03T21:34:10Z", "commit": {"oid": "099ba3a2dff7258ee530bc440e9871838181c241"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wM1QyMTozNDoxMFrOGAqYHA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wM1QyMTozNDoxMFrOGAqYHA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMzM0NzQ4NA==", "bodyText": "Did you mean to leave checkSanity() in the code?", "url": "https://github.com/apache/geode/pull/4903#discussion_r403347484", "createdAt": "2020-04-03T21:34:10Z", "author": {"login": "kirklund"}, "path": "extensions/geode-modules-tomcat8/src/distributedTest/java/org/apache/geode/modules/session/Tomcat8SessionsDUnitTest.java", "diffHunk": "@@ -53,6 +53,7 @@ public void setUp() throws Exception {\n \n     sessionManager.getTheContext().setSessionTimeout(30);\n     region.clear();\n+    checkSanity();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "099ba3a2dff7258ee530bc440e9871838181c241"}, "originalPosition": 23}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzg3NTk5MzA3", "url": "https://github.com/apache/geode/pull/4903#pullrequestreview-387599307", "createdAt": "2020-04-03T21:46:21Z", "commit": {"oid": "099ba3a2dff7258ee530bc440e9871838181c241"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wM1QyMTo0NjoyMVrOGAqpwA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wM1QyMTo0NjoyMVrOGAqpwA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMzM1MjAwMA==", "bodyText": "This assertion says \"The region should be empty\" but then it's asserted to be equalTo(1) which isn't empty. Should it be empty or one?", "url": "https://github.com/apache/geode/pull/4903#discussion_r403352000", "createdAt": "2020-04-03T21:46:21Z", "author": {"login": "kirklund"}, "path": "extensions/geode-modules-tomcat8/src/distributedTest/java/org/apache/geode/modules/session/TestSessionsTomcat8Base.java", "diffHunk": "@@ -399,7 +407,7 @@ public void testExtraSessionsNotCreated() throws Exception {\n \n     WebResponse response = wc.getResponse(req);\n     assertThat(response.getText()).isEqualTo(\"done\");\n-    assertThat(region.size()).as(\"The region should be empty\").isEqualTo(0);\n+    assertThat(region.size()).as(\"The region should be empty\").isEqualTo(1);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "099ba3a2dff7258ee530bc440e9871838181c241"}, "originalPosition": 68}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzg3NTc2NjA5", "url": "https://github.com/apache/geode/pull/4903#pullrequestreview-387576609", "createdAt": "2020-04-03T20:59:03Z", "commit": {"oid": "099ba3a2dff7258ee530bc440e9871838181c241"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wM1QyMDo1OTowNFrOGApdaA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wM1QyMToyMDo1MlrOGAqCpA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMzMzMjQ1Ng==", "bodyText": "Did you intend to leave the logger and debug message in the test?", "url": "https://github.com/apache/geode/pull/4903#discussion_r403332456", "createdAt": "2020-04-03T20:59:04Z", "author": {"login": "igodwin"}, "path": "extensions/geode-modules-tomcat8/src/distributedTest/java/org/apache/geode/modules/session/TestSessionsTomcat8Base.java", "diffHunk": "@@ -44,26 +45,33 @@\n \n   @Rule\n   public CacheRule cacheRule = new CacheRule();\n+  protected Logger logger = LogService.getLogger();\n \n-  VM vm0;\n   int port;\n   EmbeddedTomcat8 server;\n   StandardWrapper servlet;\n   Region<String, HttpSession> region;\n   DeltaSessionManager sessionManager;\n \n+  public void checkSanity() throws Exception {\n+    testSanity();\n+  }\n+\n   /**\n    * Check that the basics are working\n    */\n-  @Test\n   public void testSanity() throws Exception {\n     WebConversation wc = new WebConversation();\n+    assertThat(wc).describedAs(\"WebConversation was\").isNotNull();\n+    logger.debug(\"Sending request to http://localhost:{}/test\", port);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "099ba3a2dff7258ee530bc440e9871838181c241"}, "originalPosition": 40}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMzM0MTk4OA==", "bodyText": "Would you either update the description or make it so that we're really testing for an empty region?", "url": "https://github.com/apache/geode/pull/4903#discussion_r403341988", "createdAt": "2020-04-03T21:20:52Z", "author": {"login": "igodwin"}, "path": "extensions/geode-modules-tomcat8/src/distributedTest/java/org/apache/geode/modules/session/TestSessionsTomcat8Base.java", "diffHunk": "@@ -399,7 +407,7 @@ public void testExtraSessionsNotCreated() throws Exception {\n \n     WebResponse response = wc.getResponse(req);\n     assertThat(response.getText()).isEqualTo(\"done\");\n-    assertThat(region.size()).as(\"The region should be empty\").isEqualTo(0);\n+    assertThat(region.size()).as(\"The region should be empty\").isEqualTo(1);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "099ba3a2dff7258ee530bc440e9871838181c241"}, "originalPosition": 68}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "acd732371ed1543cf4882d65fc68dd3dd7a8332d", "author": {"user": {"login": "mhansonp", "name": null}}, "url": "https://github.com/apache/geode/commit/acd732371ed1543cf4882d65fc68dd3dd7a8332d", "committedDate": "2020-04-03T21:56:09Z", "message": "GEODE-7098: refactoring\n\n- rename checkSanity call to basicConnectivityCheck\n- inline testSanity"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzg3NjA1NzAy", "url": "https://github.com/apache/geode/pull/4903#pullrequestreview-387605702", "createdAt": "2020-04-03T22:02:05Z", "commit": {"oid": "acd732371ed1543cf4882d65fc68dd3dd7a8332d"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzg3NjE2Nzc3", "url": "https://github.com/apache/geode/pull/4903#pullrequestreview-387616777", "createdAt": "2020-04-03T22:32:15Z", "commit": {"oid": "099ba3a2dff7258ee530bc440e9871838181c241"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4741, "cost": 1, "resetAt": "2021-10-29T19:57:52Z"}}}