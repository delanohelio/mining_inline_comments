{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0Mzk1ODUxMzUy", "number": 4885, "title": "GEODE-7938: change dev rest api to support slashes in key parameters", "bodyText": "Tests have been added that confirm that the key can now contain a '/'.\nThis was done by changing \"/{keys}\" to \"/**\" and adding code to parse the keys.\nThank you for submitting a contribution to Apache Geode.\nIn order to streamline the review of the contribution we ask you\nto ensure the following steps have been taken:\nFor all changes:\n\n\n Is there a JIRA ticket associated with this PR? Is it referenced in the commit message?\n\n\n Has your PR been rebased against the latest commit within the target branch (typically develop)?\n\n\n Is your initial contribution a single, squashed commit?\n\n\n Does gradlew build run cleanly?\n\n\n Have you written or updated unit tests to verify your changes?\n\n\n If adding new dependencies to the code, are these dependencies licensed in a way that is compatible for inclusion under ASF 2.0?\n\n\nNote:\nPlease ensure that once the PR is submitted, check Concourse for build issues and\nsubmit an update to your PR as soon as possible. If you need help, please send an\nemail to dev@geode.apache.org.", "createdAt": "2020-03-30T19:28:23Z", "url": "https://github.com/apache/geode/pull/4885", "merged": true, "mergeCommit": {"oid": "0cb54ca91cd874a42b9b8ec5a9bafdda35e0e6a9"}, "closed": true, "closedAt": "2020-04-01T16:38:20Z", "author": {"login": "dschneider-pivotal"}, "timelineItems": {"totalCount": 11, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcSzocPgH2gAyMzk1ODUxMzUyOjUyN2VhOGQ4ZTQ2MTI4ODBmMzBkOGM5ZjEwMDFlZDcyMDdlNTMzODY=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcTYhvSgFqTM4NTYzNzM0Nw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "527ea8d8e4612880f30d8c9f1001ed7207e53386", "author": {"user": {"login": "dschneider-pivotal", "name": "Darrel Schneider"}}, "url": "https://github.com/apache/geode/commit/527ea8d8e4612880f30d8c9f1001ed7207e53386", "committedDate": "2020-03-30T19:26:03Z", "message": "keys are now decoded before being used\ntests have been added with encoded keys"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "747a4ed056f7f6719227fdba62f6189d69ec843b", "author": {"user": {"login": "dschneider-pivotal", "name": "Darrel Schneider"}}, "url": "https://github.com/apache/geode/commit/747a4ed056f7f6719227fdba62f6189d69ec843b", "committedDate": "2020-03-30T23:50:30Z", "message": "delete now decodes its keys\nadded more tests of lists of keys with slashes"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "22a52e3ee2780bf7b0825e347929fb0ef95796c5", "author": {"user": {"login": "dschneider-pivotal", "name": "Darrel Schneider"}}, "url": "https://github.com/apache/geode/commit/22a52e3ee2780bf7b0825e347929fb0ef95796c5", "committedDate": "2020-03-31T00:21:35Z", "message": "Merge branch 'develop' into rest-slashes"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzg0MzkxNzgw", "url": "https://github.com/apache/geode/pull/4885#pullrequestreview-384391780", "createdAt": "2020-03-31T04:18:20Z", "commit": {"oid": "22a52e3ee2780bf7b0825e347929fb0ef95796c5"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzg0NDExMjYx", "url": "https://github.com/apache/geode/pull/4885#pullrequestreview-384411261", "createdAt": "2020-03-31T05:27:19Z", "commit": {"oid": "22a52e3ee2780bf7b0825e347929fb0ef95796c5"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0zMVQwNToyNzoyMFrOF-F1RQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0zMVQwNToyNzoyMFrOF-F1RQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMDY1MTU4OQ==", "bodyText": "Have you considered just using the Spring annotations and patterns to match the remainder of the URL path?\n@RequestMapping(value = \"/{region}/**\", ...)\nand\nString[] keys = request.getAttribute(HandlerMapping.PATH_WITHIN_HANDLER_MAPPING_ATTRIBUTE).split(\",\")", "url": "https://github.com/apache/geode/pull/4885#discussion_r400651589", "createdAt": "2020-03-31T05:27:20Z", "author": {"login": "pivotal-jbarrett"}, "path": "geode-web-api/src/main/java/org/apache/geode/rest/internal/web/controllers/PdxBasedCrudController.java", "diffHunk": "@@ -295,12 +296,13 @@ protected String getRestApiVersion() {\n       @ApiResponse(code = 500, message = \"GemFire throws an error or exception.\")})\n   @PreAuthorize(\"@securityService.authorize('WRITE', #region, #keys)\")\n   public ResponseEntity<?> update(@PathVariable(\"region\") String region,\n-      @PathVariable(\"keys\") final String[] keys,\n+      @PathVariable(\"keys\") String[] keys,", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "22a52e3ee2780bf7b0825e347929fb0ef95796c5"}, "originalPosition": 20}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzg0OTY0Mjg0", "url": "https://github.com/apache/geode/pull/4885#pullrequestreview-384964284", "createdAt": "2020-03-31T17:45:01Z", "commit": {"oid": "22a52e3ee2780bf7b0825e347929fb0ef95796c5"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "cc60b74adfc566d213636cbaa5e85551f6ab7728", "author": {"user": {"login": "dschneider-pivotal", "name": "Darrel Schneider"}}, "url": "https://github.com/apache/geode/commit/cc60b74adfc566d213636cbaa5e85551f6ab7728", "committedDate": "2020-03-31T22:37:20Z", "message": "now uses ** instead of {keys}. This allows keys\nto have a slash in them without the client needing\nto encode the keys. Since the server no longer decodes\nthen this should not break any existing use cases."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzg1MTYxMTUx", "url": "https://github.com/apache/geode/pull/4885#pullrequestreview-385161151", "createdAt": "2020-03-31T22:56:57Z", "commit": {"oid": "cc60b74adfc566d213636cbaa5e85551f6ab7728"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0zMVQyMjo1Njo1N1rOF-rI5A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0zMVQyMzowMDowNlrOF-rNCw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMTI2MjgyMA==", "bodyText": "Curious... why write it like this?", "url": "https://github.com/apache/geode/pull/4885#discussion_r401262820", "createdAt": "2020-03-31T22:56:57Z", "author": {"login": "pivotal-jbarrett"}, "path": "geode-web-api/src/integrationTest/java/org/apache/geode/rest/internal/web/controllers/RestAccessControllerTest.java", "diffHunk": "@@ -182,8 +183,7 @@ public void postEntry() throws Exception {\n   @Test\n   @WithMockUser\n   public void postEntryWithSlashKey() throws Exception {\n-    String decodedKey = \"1/2\";\n-    String key = URLEncoder.encode(decodedKey, \"UTF-8\");\n+    String key = \"1\" + SLASH + \"2\";", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "cc60b74adfc566d213636cbaa5e85551f6ab7728"}, "originalPosition": 23}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMTI2MzIxOA==", "bodyText": "So does doing this now effect any swagger documentation or code generation?", "url": "https://github.com/apache/geode/pull/4885#discussion_r401263218", "createdAt": "2020-03-31T22:58:08Z", "author": {"login": "pivotal-jbarrett"}, "path": "geode-web-api/src/main/java/org/apache/geode/rest/internal/web/controllers/PdxBasedCrudController.java", "diffHunk": "@@ -196,10 +198,9 @@ protected String getRestApiVersion() {\n    * Reading data for set of keys\n    *\n    * @param region gemfire region name\n-   * @param keys string containing comma separated keys\n    * @return JSON document\n    */\n-  @RequestMapping(method = RequestMethod.GET, value = \"/{region}/{keys}\",\n+  @RequestMapping(method = RequestMethod.GET, value = \"/{region}/**\",", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "cc60b74adfc566d213636cbaa5e85551f6ab7728"}, "originalPosition": 17}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMTI2Mzg4Mw==", "bodyText": "Did request.getAttribute(HandlerMapping.PATH_WITHIN_HANDLER_MAPPING_ATTRIBUTE) not work?", "url": "https://github.com/apache/geode/pull/4885#discussion_r401263883", "createdAt": "2020-03-31T23:00:06Z", "author": {"login": "pivotal-jbarrett"}, "path": "geode-web-api/src/main/java/org/apache/geode/rest/internal/web/controllers/AbstractBaseController.java", "diffHunk": "@@ -983,4 +974,16 @@ protected QueryService getQueryService() {\n     targetedMembers.add(cache.getDistributedSystem().getDistributedMember());\n     return targetedMembers;\n   }\n+\n+  protected String[] parseKeys(HttpServletRequest request, String region) {\n+    String uri = request.getRequestURI();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "cc60b74adfc566d213636cbaa5e85551f6ab7728"}, "originalPosition": 51}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzg1MTc4MDA2", "url": "https://github.com/apache/geode/pull/4885#pullrequestreview-385178006", "createdAt": "2020-03-31T23:44:14Z", "commit": {"oid": "cc60b74adfc566d213636cbaa5e85551f6ab7728"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "88b5a4bc424f621e62a080896a768e0ee1c29039", "author": {"user": {"login": "dschneider-pivotal", "name": "Darrel Schneider"}}, "url": "https://github.com/apache/geode/commit/88b5a4bc424f621e62a080896a768e0ee1c29039", "committedDate": "2020-03-31T23:49:24Z", "message": "improved swagger docs"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzg1NjM3MzQ3", "url": "https://github.com/apache/geode/pull/4885#pullrequestreview-385637347", "createdAt": "2020-04-01T14:25:13Z", "commit": {"oid": "88b5a4bc424f621e62a080896a768e0ee1c29039"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4721, "cost": 1, "resetAt": "2021-10-29T19:57:52Z"}}}