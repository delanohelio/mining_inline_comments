{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTE5NDEwMjA0", "number": 5732, "title": "GEODE-8694: use redis tests with patch", "bodyText": "use the redis/redis repo's test with a patch containing changes to tests\nthat fail on unimplemented commands when testing geode-redis.\nThank you for submitting a contribution to Apache Geode.\nIn order to streamline the review of the contribution we ask you\nto ensure the following steps have been taken:\nFor all changes:\n\n\n Is there a JIRA ticket associated with this PR? Is it referenced in the commit message?\n\n\n Has your PR been rebased against the latest commit within the target branch (typically develop)?\n\n\n Is your initial contribution a single, squashed commit?\n\n\n Does gradlew build run cleanly?\n\n\n Have you written or updated unit tests to verify your changes?\n\n\n If adding new dependencies to the code, are these dependencies licensed in a way that is compatible for inclusion under ASF 2.0?\n\n\nNote:\nPlease ensure that once the PR is submitted, check Concourse for build issues and\nsubmit an update to your PR as soon as possible. If you need help, please send an\nemail to dev@geode.apache.org.", "createdAt": "2020-11-11T19:39:21Z", "url": "https://github.com/apache/geode/pull/5732", "merged": true, "mergeCommit": {"oid": "2d63ecd05b42fe8262213f8ea70ad90b07c719be"}, "closed": true, "closedAt": "2020-11-18T00:36:38Z", "author": {"login": "nonbinaryprogrammer"}, "timelineItems": {"totalCount": 10, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdbjopgAFqTUyODQ5NTE3Mg==", "endCursor": "Y3Vyc29yOnYyOpPPAAABddhbwAgFqTUzMjg3MTU4OA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTI4NDk1MTcy", "url": "https://github.com/apache/geode/pull/5732#pullrequestreview-528495172", "createdAt": "2020-11-11T20:04:16Z", "commit": {"oid": "0987548470982fe8e2fd42f2784e8a3bd3c2800a"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTI4NTMyNzYw", "url": "https://github.com/apache/geode/pull/5732#pullrequestreview-528532760", "createdAt": "2020-11-11T21:03:55Z", "commit": {"oid": "0987548470982fe8e2fd42f2784e8a3bd3c2800a"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xMVQyMTowMzo1NVrOHxeNbQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xMVQyMTowNDoyOFrOHxeOsw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMTYzNzIyOQ==", "bodyText": "We should change this port back to 6379 (since the Geode Redis server without a password is started on 6379, which is why we get the error Executing test client: NOAUTH Authentication required in the RedisTests)", "url": "https://github.com/apache/geode/pull/5732#discussion_r521637229", "createdAt": "2020-11-11T21:03:55Z", "author": {"login": "sabbey37"}, "path": "ci/scripts/execute_redis_tests.sh", "diffHunk": "@@ -49,8 +51,8 @@ failCount=0\n   --redis-port=6379 \\\n   --redis-bind-address=127.0.0.1\n \n-./runtest --host 127.0.0.1 --port 6379 --single unit/type/set --single unit/expire \\\n---single unit/type/hash --single unit/type/string --single unit/type/srandmember \\\n+./runtest --host 127.0.0.1 --port 6380 --single unit/type/set --single unit/expire \\", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "0987548470982fe8e2fd42f2784e8a3bd3c2800a"}, "originalPosition": 24}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMTYzNzQ1MQ==", "bodyText": "Change this back to 0", "url": "https://github.com/apache/geode/pull/5732#discussion_r521637451", "createdAt": "2020-11-11T21:04:17Z", "author": {"login": "sabbey37"}, "path": "geode-redis/src/commonTest/java/org/apache/geode/redis/GeodeRedisServerRule.java", "diffHunk": "@@ -43,7 +43,7 @@ public GeodeRedisServerRule() {\n   @Override\n   protected void before() {\n     cache = cacheFactory.create();\n-    server = new GeodeRedisServer(\"localhost\", 0, (InternalCache) cache);\n+    server = new GeodeRedisServer(\"localhost\", 6380, (InternalCache) cache);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "0987548470982fe8e2fd42f2784e8a3bd3c2800a"}, "originalPosition": 5}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMTYzNzU1NQ==", "bodyText": "This should be ignored (and is why the Integration Tests and Stress New Test timed out).", "url": "https://github.com/apache/geode/pull/5732#discussion_r521637555", "createdAt": "2020-11-11T21:04:28Z", "author": {"login": "sabbey37"}, "path": "geode-redis/src/integrationTest/java/org/apache/geode/redis/internal/GeodeServerRunTest.java", "diffHunk": "@@ -29,7 +28,8 @@\n   public static GeodeRedisServerRule server = new GeodeRedisServerRule();\n \n   @Test\n-  @Ignore(\"This is a no-op test to conveniently run redis api for geode server for local development/testing purposes\")", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "0987548470982fe8e2fd42f2784e8a3bd3c2800a"}, "originalPosition": 12}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTI4NTM2NjMx", "url": "https://github.com/apache/geode/pull/5732#pullrequestreview-528536631", "createdAt": "2020-11-11T21:10:06Z", "commit": {"oid": "0987548470982fe8e2fd42f2784e8a3bd3c2800a"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xMVQyMToxMDowN1rOHxeZjQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xMVQyMToxMDowN1rOHxeZjQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMTY0MDMzMw==", "bodyText": "Correct me if I'm missing something, but I don't think the tests-geode-redis branch is in the redis repo.  We could check out the 5.0 branch.  Have you tried this sequence locally with a fresh clone of the redis repo that doesn't have any local branches/branches from other forks?", "url": "https://github.com/apache/geode/pull/5732#discussion_r521640333", "createdAt": "2020-11-11T21:10:07Z", "author": {"login": "sabbey37"}, "path": "ci/scripts/execute_redis_tests.sh", "diffHunk": "@@ -19,12 +19,14 @@\n \n cd ..\n \n-# We are currently using a personal fork for this repo because our code does not implement all\n+# We are currently using a patched version of this repo because our code does not implement all\n # Redis commands.  Once all commands needed to run relevant test files are implemented, we hope to\n-# use Redis's repo instead.\n-git clone --config transfer.fsckObjects=false https://github.com/prettyClouds/redis.git\n+# use Redis's repo without a patch.\n+git clone --config transfer.fsckObjects=false https://github.com/redis/redis.git\n+cp geode-redis/src/acceptanceTest/resources/0001-configure-redis-tests.patch redis\n cd redis\n git checkout tests-geode-redis", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "0987548470982fe8e2fd42f2784e8a3bd3c2800a"}, "originalPosition": 13}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "0987548470982fe8e2fd42f2784e8a3bd3c2800a", "author": {"user": {"login": "nonbinaryprogrammer", "name": "Hale Bales"}}, "url": "https://github.com/apache/geode/commit/0987548470982fe8e2fd42f2784e8a3bd3c2800a", "committedDate": "2020-11-11T19:35:10Z", "message": "GEODE-8694: use redis tests with patch\n\nuse the redis/redis repo's test with a patch containing changes to tests\nthat fail on unimplemented commands when testing geode-redis."}, "afterCommit": {"oid": "18fa75b0e3a0ad91665fa9c4db14bb3a66c8d3a1", "author": {"user": {"login": "nonbinaryprogrammer", "name": "Hale Bales"}}, "url": "https://github.com/apache/geode/commit/18fa75b0e3a0ad91665fa9c4db14bb3a66c8d3a1", "committedDate": "2020-11-12T18:37:26Z", "message": "GEODE-8694: use redis tests with patch\n\nuse the redis/redis repo's test with a patch containing changes to tests\nthat fail on unimplemented commands when testing geode-redis."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "2642787eb54e07e1f562a547b34f82cc04b7c4b9", "author": {"user": {"login": "nonbinaryprogrammer", "name": "Hale Bales"}}, "url": "https://github.com/apache/geode/commit/2642787eb54e07e1f562a547b34f82cc04b7c4b9", "committedDate": "2020-11-12T18:41:11Z", "message": "GEODE-8694: use redis tests with patch\n\nuse the redis/redis repo's test with a patch containing changes to tests\nthat fail on unimplemented commands when testing geode-redis."}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "18fa75b0e3a0ad91665fa9c4db14bb3a66c8d3a1", "author": {"user": {"login": "nonbinaryprogrammer", "name": "Hale Bales"}}, "url": "https://github.com/apache/geode/commit/18fa75b0e3a0ad91665fa9c4db14bb3a66c8d3a1", "committedDate": "2020-11-12T18:37:26Z", "message": "GEODE-8694: use redis tests with patch\n\nuse the redis/redis repo's test with a patch containing changes to tests\nthat fail on unimplemented commands when testing geode-redis."}, "afterCommit": {"oid": "2642787eb54e07e1f562a547b34f82cc04b7c4b9", "author": {"user": {"login": "nonbinaryprogrammer", "name": "Hale Bales"}}, "url": "https://github.com/apache/geode/commit/2642787eb54e07e1f562a547b34f82cc04b7c4b9", "committedDate": "2020-11-12T18:41:11Z", "message": "GEODE-8694: use redis tests with patch\n\nuse the redis/redis repo's test with a patch containing changes to tests\nthat fail on unimplemented commands when testing geode-redis."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTI5NDM0MzIy", "url": "https://github.com/apache/geode/pull/5732#pullrequestreview-529434322", "createdAt": "2020-11-12T19:41:42Z", "commit": {"oid": "2642787eb54e07e1f562a547b34f82cc04b7c4b9"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xMlQxOTo0MTo0M1rOHyLNMQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xMlQxOTo0MTo0M1rOHyLNMQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMjM3NDQ0OQ==", "bodyText": "It seems like the application of the patch is failing.  Could be related to this error:\n*** Please tell me who you are.\n\nRun\n\n  git config --global user.email \"you@example.com\"\n  git config --global user.name \"Your Name\"\n\nto set your account's default identity.\nOmit --global to set the identity only in this repository.\n\nfatal: empty ident name (for <geode@heavy-lifter-bc46dab9-e3b2-587d-b59e-a07a7b894615.c.apachegeode-ci.internal>) not allowed\n\n...though I tried removing my git credentials and running it locally with a fresh clone of redis and it worked.  Maybe an identity is required to apply a patch on heavy-lifter?", "url": "https://github.com/apache/geode/pull/5732#discussion_r522374449", "createdAt": "2020-11-12T19:41:43Z", "author": {"login": "sabbey37"}, "path": "ci/scripts/execute_redis_tests.sh", "diffHunk": "@@ -19,12 +19,14 @@\n \n cd ..\n \n-# We are currently using a personal fork for this repo because our code does not implement all\n+# We are currently using a patched version of this repo because our code does not implement all\n # Redis commands.  Once all commands needed to run relevant test files are implemented, we hope to\n-# use Redis's repo instead.\n-git clone --config transfer.fsckObjects=false https://github.com/prettyClouds/redis.git\n+# use Redis's repo without a patch.\n+git clone --config transfer.fsckObjects=false https://github.com/redis/redis.git\n+cp geode-redis/src/acceptanceTest/resources/0001-configure-redis-tests.patch redis\n cd redis\n-git checkout tests-geode-redis\n+git checkout origin/5.0\n+git am < 0001-configure-redis-tests.patch", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "2642787eb54e07e1f562a547b34f82cc04b7c4b9"}, "originalPosition": 15}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f4e727f307ba8f6f5f2d175e3ef1d8b5b3300bfe", "author": {"user": {"login": "jdeppe-pivotal", "name": "Jens Deppe"}}, "url": "https://github.com/apache/geode/commit/f4e727f307ba8f6f5f2d175e3ef1d8b5b3300bfe", "committedDate": "2020-11-17T19:54:29Z", "message": "Use git apply instead of git am to apply the patch"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "5b580b73ff2b8d0a80ff8c896ec4a6257ac31e9c", "author": {"user": {"login": "jdeppe-pivotal", "name": "Jens Deppe"}}, "url": "https://github.com/apache/geode/commit/5b580b73ff2b8d0a80ff8c896ec4a6257ac31e9c", "committedDate": "2020-11-17T20:58:22Z", "message": "Trigger CI"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTMyODcxNTg4", "url": "https://github.com/apache/geode/pull/5732#pullrequestreview-532871588", "createdAt": "2020-11-17T22:38:13Z", "commit": {"oid": "5b580b73ff2b8d0a80ff8c896ec4a6257ac31e9c"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4024, "cost": 1, "resetAt": "2021-10-29T19:57:52Z"}}}