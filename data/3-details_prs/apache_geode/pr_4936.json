{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDAxNjQ1NDg1", "number": 4936, "title": "GEODE-7851: Pulse Oauth Support", "bodyText": "create an OauthSecurityConfig to configure spring using oauth\nadd PULSE as an oauth-enabled-component, and if pulse is set to use\noauth, set the OauthSecurityConfig as the active security profile\nuse pulse.properties in the locator's working dir to externalize pulse\nauthentication provider configuration\n\nCo-authored-by: Dale Emery demery@pivotal.io\nCo-authored-by: Joris Melchior joris.melchior@gmail.com\nThank you for submitting a contribution to Apache Geode.\nIn order to streamline the review of the contribution we ask you\nto ensure the following steps have been taken:\nFor all changes:\n\n\n Is there a JIRA ticket associated with this PR? Is it referenced in the commit message?\n\n\n Has your PR been rebased against the latest commit within the target branch (typically develop)?\n\n\n Is your initial contribution a single, squashed commit?\n\n\n Does gradlew build run cleanly?\n\n\n Have you written or updated unit tests to verify your changes?\n\n\n If adding new dependencies to the code, are these dependencies licensed in a way that is compatible for inclusion under ASF 2.0?\n\n\nNote:\nPlease ensure that once the PR is submitted, check Concourse for build issues and\nsubmit an update to your PR as soon as possible. If you need help, please send an\nemail to dev@geode.apache.org.", "createdAt": "2020-04-09T21:07:54Z", "url": "https://github.com/apache/geode/pull/4936", "merged": true, "mergeCommit": {"oid": "3f9d32d571a62dfd1b53789c6fe2eb6955cfcc1c"}, "closed": true, "closedAt": "2020-04-13T21:53:31Z", "author": {"login": "demery-pivotal"}, "timelineItems": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcWC6yJAH2gAyNDAxNjQ1NDg1OjM1NGEwNjhhM2EzYTEzY2UxMWEwYzdkZTAwOThlZWNlZGI4Y2FlMGM=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcXU7aQAFqTM5MjQxNjAwNg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "354a068a3a3a13ce11a0c7de0098eecedb8cae0c", "author": {"user": {"login": "jinmeiliao", "name": "Jinmei Liao"}}, "url": "https://github.com/apache/geode/commit/354a068a3a3a13ce11a0c7de0098eecedb8cae0c", "committedDate": "2020-04-09T20:56:26Z", "message": "GEODE-7851: Pulse Oauth Support\n\n- create an OauthSecurityConfig to configure spring using oauth\n- add PULSE as an oauth-enabled-component, and if pulse is set to use\n  oauth, set the OauthSecurityConfig as the active security profile\n- use pulse.properties in the locator's working dir to externalize pulse\n  authentication provider configuration\n\nCo-authored-by: Dale Emery <demery@pivotal.io>\nCo-authored-by: Joris Melchior <joris.melchior@gmail.com>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzkyMjE4MzU2", "url": "https://github.com/apache/geode/pull/4936#pullrequestreview-392218356", "createdAt": "2020-04-13T15:27:58Z", "commit": {"oid": "354a068a3a3a13ce11a0c7de0098eecedb8cae0c"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 6, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xM1QxNToyNzo1OFrOGEqK-g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xM1QxNzoyMToyNFrOGEt60g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNzUzODQyNg==", "bodyText": "doesn't seem necessary to have this.", "url": "https://github.com/apache/geode/pull/4936#discussion_r407538426", "createdAt": "2020-04-13T15:27:58Z", "author": {"login": "jinmeiliao"}, "path": "geode-core/src/main/java/org/apache/geode/management/internal/ManagementAgent.java", "diffHunk": "@@ -196,6 +196,7 @@ private void loadWebApplications() {\n       }\n     } else {\n       String pwFile = this.config.getJmxManagerPasswordFile();\n+      String springActiveProfile = \"spring.profiles.active\";", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "354a068a3a3a13ce11a0c7de0098eecedb8cae0c"}, "originalPosition": 4}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNzU1NDgyMg==", "bodyText": "hard to associate clientName with providerName, maybe rename the property to \"clientName\"?", "url": "https://github.com/apache/geode/pull/4936#discussion_r407554822", "createdAt": "2020-04-13T15:58:44Z", "author": {"login": "jinmeiliao"}, "path": "geode-pulse/src/main/java/org/apache/geode/tools/pulse/internal/security/OAuthSecurityConfig.java", "diffHunk": "@@ -84,16 +107,15 @@ public OAuth2AuthorizedClientRepository authorizedClientRepository(\n \n   private ClientRegistration clientRegistration() {\n     return ClientRegistration.withRegistrationId(providerId)\n-        .clientId(clientId)\n-        .clientSecret(clientSecret)\n         .authorizationGrantType(AuthorizationGrantType.AUTHORIZATION_CODE)\n         .redirectUriTemplate(\"{baseUrl}/login/oauth2/code/{registrationId}\")\n-        .scope(\"openid\", \"CLUSTER:READ\", \"CLUSTER:WRITE\", \"DATA:READ\", \"DATA:WRITE\")\n+        .clientId(clientId)\n+        .clientSecret(clientSecret)\n         .authorizationUri(authorizationUri)\n         .tokenUri(tokenUri)\n         .userInfoUri(userInfoUri)\n         .jwkSetUri(jwkSetUri)\n-        .clientName(\"Pulse\")\n+        .clientName(providerName)", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "354a068a3a3a13ce11a0c7de0098eecedb8cae0c"}, "originalPosition": 86}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNzU5ODMxOQ==", "bodyText": "I believe you don't need to implement LogoutSuccessHandler since SimpleUrlLogoutSuccessHandler already implements that\nyou don't need to implement ContextAware either, Spring should take care of auto-wiring for you if you declare\n\n@Autowired\nprivate Repository repository;", "url": "https://github.com/apache/geode/pull/4936#discussion_r407598319", "createdAt": "2020-04-13T17:18:40Z", "author": {"login": "jinmeiliao"}, "path": "geode-pulse/src/main/java/org/apache/geode/tools/pulse/internal/security/LogoutHandler.java", "diffHunk": "@@ -30,24 +33,31 @@\n \n /**\n  * Handler is used to close jmx connection maintained at user-level\n- *\n  */\n-public class LogoutHandler extends SimpleUrlLogoutSuccessHandler implements LogoutSuccessHandler {\n+public class LogoutHandler extends SimpleUrlLogoutSuccessHandler implements LogoutSuccessHandler,", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "354a068a3a3a13ce11a0c7de0098eecedb8cae0c"}, "originalPosition": 17}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNzU5ODU3MQ==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n              private ApplicationContext applicationContext;\n          \n          \n            \n              @Autowired\n          \n          \n            \n              private Repository repository;", "url": "https://github.com/apache/geode/pull/4936#discussion_r407598571", "createdAt": "2020-04-13T17:19:06Z", "author": {"login": "jinmeiliao"}, "path": "geode-pulse/src/main/java/org/apache/geode/tools/pulse/internal/security/LogoutHandler.java", "diffHunk": "@@ -30,24 +33,31 @@\n \n /**\n  * Handler is used to close jmx connection maintained at user-level\n- *\n  */\n-public class LogoutHandler extends SimpleUrlLogoutSuccessHandler implements LogoutSuccessHandler {\n+public class LogoutHandler extends SimpleUrlLogoutSuccessHandler implements LogoutSuccessHandler,\n+    ApplicationContextAware {\n   private static final Logger logger = LogManager.getLogger();\n+  private ApplicationContext applicationContext;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "354a068a3a3a13ce11a0c7de0098eecedb8cae0c"}, "originalPosition": 20}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNzU5OTI4NA==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n              private final Repository repository;\n          \n          \n            \n              @Autowired\n          \n          \n            \n              private Repository repository;", "url": "https://github.com/apache/geode/pull/4936#discussion_r407599284", "createdAt": "2020-04-13T17:20:24Z", "author": {"login": "jinmeiliao"}, "path": "geode-pulse/src/main/java/org/apache/geode/tools/pulse/internal/service/ClusterDetailsService.java", "diffHunk": "@@ -44,14 +45,20 @@\n public class ClusterDetailsService implements PulseService {\n \n   private final ObjectMapper mapper = new ObjectMapper();\n+  private final Repository repository;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "354a068a3a3a13ce11a0c7de0098eecedb8cae0c"}, "originalPosition": 12}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNzU5OTgyNg==", "bodyText": "no need for this constructor if Repository variable is declared as autowired already.\nSame should be the same for all the service classes.", "url": "https://github.com/apache/geode/pull/4936#discussion_r407599826", "createdAt": "2020-04-13T17:21:24Z", "author": {"login": "jinmeiliao"}, "path": "geode-pulse/src/main/java/org/apache/geode/tools/pulse/internal/service/ClusterDetailsService.java", "diffHunk": "@@ -44,14 +45,20 @@\n public class ClusterDetailsService implements PulseService {\n \n   private final ObjectMapper mapper = new ObjectMapper();\n+  private final Repository repository;\n+\n+  @Autowired", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "354a068a3a3a13ce11a0c7de0098eecedb8cae0c"}, "originalPosition": 14}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b8ee16efb4c0f85f8753fc51a307165a07463d73", "author": {"user": {"login": "demery-pivotal", "name": "Dale Emery"}}, "url": "https://github.com/apache/geode/commit/b8ee16efb4c0f85f8753fc51a307165a07463d73", "committedDate": "2020-04-13T19:48:32Z", "message": "Add documentation and remove unnecessary code\n\n- Remove redundant 'implements LogoutSuccessHandler' from LogoutHandler.\n- Remove unused local variable in ManagementAgent.\n- Add comment in OAuthSecurityConfig explaining why we pass the the\n  OAuth provider name to ClientRegistration.clientName().\n\nAuthored-by: Dale Emery <demery@pivotal.io>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzkyNDE2MDA2", "url": "https://github.com/apache/geode/pull/4936#pullrequestreview-392416006", "createdAt": "2020-04-13T20:29:20Z", "commit": {"oid": "b8ee16efb4c0f85f8753fc51a307165a07463d73"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4789, "cost": 1, "resetAt": "2021-10-29T19:57:52Z"}}}