{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0MzU5MjAyNDY2", "number": 2926, "title": "Update GeoIP", "bodyText": "This implements the fix suggested by @Bobcat00 in #2919\nUsers of GeoIP will now be required to register a MaxMind account and create a license to download the database required by the plugin. This license is entered into the new license-key field in the configuration.", "createdAt": "2020-01-04T10:26:38Z", "url": "https://github.com/EssentialsX/Essentials/pull/2926", "merged": true, "mergeCommit": {"oid": "5020983af505f8defbf38e1e818f90086b8a5369"}, "closed": true, "closedAt": "2020-01-11T07:10:41Z", "author": {"login": "pop4959"}, "timelineItems": {"totalCount": 10, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABb3AQHbAH2gAyMzU5MjAyNDY2OjE5NjhjNWEyODgwMTg0Yjg1ZWViNDU0NDU3ZWYzYjQ2NjkzY2RlNmQ=", "endCursor": "Y3Vyc29yOnYyOpPPAAABb5NvtCgFqTM0MTUwOTA4Nw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "1968c5a2880184b85eeb454457ef3b46693cde6d", "author": {"user": {"login": "pop4959", "name": null}}, "url": "https://github.com/EssentialsX/Essentials/commit/1968c5a2880184b85eeb454457ef3b46693cde6d", "committedDate": "2020-01-04T10:18:22Z", "message": "Update GeoIP"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzM4MzU1ODY0", "url": "https://github.com/EssentialsX/Essentials/pull/2926#pullrequestreview-338355864", "createdAt": "2020-01-04T14:32:57Z", "commit": {"oid": "1968c5a2880184b85eeb454457ef3b46693cde6d"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0wNFQxNDozMjo1N1rOFaOGOg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0wNFQxNDozMjo1N1rOFaOGOg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2MzAzODI2Ng==", "bodyText": "No need else branch, because you put \"return\" in line 181.", "url": "https://github.com/EssentialsX/Essentials/pull/2926#discussion_r363038266", "createdAt": "2020-01-04T14:32:57Z", "author": {"login": "montlikadani"}, "path": "EssentialsGeoIP/src/com/earth2me/essentials/geoip/EssentialsGeoIPPlayerListener.java", "diffHunk": "@@ -175,6 +175,13 @@ private void downloadDatabase() {\n                 logger.log(Level.SEVERE, tl(\"geoIpUrlEmpty\"));\n                 return;\n             }\n+            String licenseKey = config.getString(\"database.license-key\", \"\");\n+            if (licenseKey == null || licenseKey.isEmpty()) {\n+                logger.log(Level.SEVERE, tl(\"geoIpLicenseMissing\"));\n+                return;\n+            } else {\n+                url = url.replace(\"{LICENSEKEY}\", licenseKey);\n+            }", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "1968c5a2880184b85eeb454457ef3b46693cde6d"}, "originalPosition": 10}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "6adfee773528dbf02f657228b9f84ffa40e99053", "author": {"user": {"login": "pop4959", "name": null}}, "url": "https://github.com/EssentialsX/Essentials/commit/6adfee773528dbf02f657228b9f84ffa40e99053", "committedDate": "2020-01-04T22:45:44Z", "message": "Simplify branch"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "50492f2aebfc19da9af9420a580274f55e28c590", "author": {"user": {"login": "pop4959", "name": null}}, "url": "https://github.com/EssentialsX/Essentials/commit/50492f2aebfc19da9af9420a580274f55e28c590", "committedDate": "2020-01-04T22:50:26Z", "message": "Merge branch '2.x' of https://github.com/EssentialsX/Essentials into geoip-update"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzM4MzczMjU1", "url": "https://github.com/EssentialsX/Essentials/pull/2926#pullrequestreview-338373255", "createdAt": "2020-01-04T22:55:19Z", "commit": {"oid": "6adfee773528dbf02f657228b9f84ffa40e99053"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0wNFQyMjo1NToxOVrOFaPYKg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0wNFQyMjo1Njo1OFrOFaPYbw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2MzA1OTI0Mg==", "bodyText": "This feels clowny. endsWith makes it better but obviously is a generally shitty solution. Could we possibly pick up the GZIP magic numbers and make decisions off of that?", "url": "https://github.com/EssentialsX/Essentials/pull/2926#discussion_r363059242", "createdAt": "2020-01-04T22:55:19Z", "author": {"login": "Ichbinjoe"}, "path": "EssentialsGeoIP/src/com/earth2me/essentials/geoip/EssentialsGeoIPPlayerListener.java", "diffHunk": "@@ -183,9 +189,9 @@ private void downloadDatabase() {\n             InputStream input = conn.getInputStream();\n             OutputStream output = new FileOutputStream(databaseFile);\n             byte[] buffer = new byte[2048];\n-            if (url.endsWith(\".gz\")) {\n+            if (url.contains(\"gz\")) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "6adfee773528dbf02f657228b9f84ffa40e99053"}, "originalPosition": 18}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2MzA1OTI4NQ==", "bodyText": "Given the default when will licenceKey ever be null?\nMaybe instead we should remove the default and check for null.", "url": "https://github.com/EssentialsX/Essentials/pull/2926#discussion_r363059285", "createdAt": "2020-01-04T22:56:27Z", "author": {"login": "Ichbinjoe"}, "path": "EssentialsGeoIP/src/com/earth2me/essentials/geoip/EssentialsGeoIPPlayerListener.java", "diffHunk": "@@ -175,6 +175,12 @@ private void downloadDatabase() {\n                 logger.log(Level.SEVERE, tl(\"geoIpUrlEmpty\"));\n                 return;\n             }\n+            String licenseKey = config.getString(\"database.license-key\", \"\");\n+            if (licenseKey == null || licenseKey.isEmpty()) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "50492f2aebfc19da9af9420a580274f55e28c590"}, "originalPosition": 5}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2MzA1OTMxMQ==", "bodyText": "Consider replace all maybe? idk.", "url": "https://github.com/EssentialsX/Essentials/pull/2926#discussion_r363059311", "createdAt": "2020-01-04T22:56:58Z", "author": {"login": "Ichbinjoe"}, "path": "EssentialsGeoIP/src/com/earth2me/essentials/geoip/EssentialsGeoIPPlayerListener.java", "diffHunk": "@@ -175,6 +175,12 @@ private void downloadDatabase() {\n                 logger.log(Level.SEVERE, tl(\"geoIpUrlEmpty\"));\n                 return;\n             }\n+            String licenseKey = config.getString(\"database.license-key\", \"\");\n+            if (licenseKey == null || licenseKey.isEmpty()) {\n+                logger.log(Level.SEVERE, tl(\"geoIpLicenseMissing\"));\n+                return;\n+            }\n+            url = url.replace(\"{LICENSEKEY}\", licenseKey);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "50492f2aebfc19da9af9420a580274f55e28c590"}, "originalPosition": 9}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "10c4a21be0e82f889c5e012415ea7ee4d14b5799", "author": {"user": {"login": "pop4959", "name": null}}, "url": "https://github.com/EssentialsX/Essentials/commit/10c4a21be0e82f889c5e012415ea7ee4d14b5799", "committedDate": "2020-01-04T23:17:45Z", "message": "Update old config detection"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzM4NDExNDI5", "url": "https://github.com/EssentialsX/Essentials/pull/2926#pullrequestreview-338411429", "createdAt": "2020-01-05T17:08:50Z", "commit": {"oid": "10c4a21be0e82f889c5e012415ea7ee4d14b5799"}, "state": "DISMISSED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzQwNzA2Mzk2", "url": "https://github.com/EssentialsX/Essentials/pull/2926#pullrequestreview-340706396", "createdAt": "2020-01-09T17:55:10Z", "commit": {"oid": "10c4a21be0e82f889c5e012415ea7ee4d14b5799"}, "state": "COMMENTED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f0b1cc28b581503bd24d635fcc3e764d0021553e", "author": {"user": {"login": "pop4959", "name": null}}, "url": "https://github.com/EssentialsX/Essentials/commit/f0b1cc28b581503bd24d635fcc3e764d0021553e", "committedDate": "2020-01-10T21:58:40Z", "message": "Update geoIpLicenseMissing to point to the EssX wiki"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzQxNTA5MDg3", "url": "https://github.com/EssentialsX/Essentials/pull/2926#pullrequestreview-341509087", "createdAt": "2020-01-11T07:09:29Z", "commit": {"oid": "f0b1cc28b581503bd24d635fcc3e764d0021553e"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4768, "cost": 1, "resetAt": "2021-11-01T14:20:25Z"}}}