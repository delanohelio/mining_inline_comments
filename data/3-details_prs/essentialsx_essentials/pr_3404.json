{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDM4NDAzMDIy", "number": 3404, "title": "Fix recipe command on Paper", "bodyText": "Based on PlayerRecipeBookClickEvent added in PaperMC/Paper/pull/3351. Fixes #1289, closes #1397.", "createdAt": "2020-06-23T08:21:40Z", "url": "https://github.com/EssentialsX/Essentials/pull/3404", "merged": true, "mergeCommit": {"oid": "024c56efdddec48e5c1644e4696fdbd14a67aa7e"}, "closed": true, "closedAt": "2020-07-01T22:19:43Z", "author": {"login": "pop4959"}, "timelineItems": {"totalCount": 11, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcuA__zAH2gAyNDM4NDAzMDIyOmNjMzlkMzUzMGQ4NjljNmQ5NmYxZjVkNzUyYmQyMWZkZTU4ZDJjMWQ=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcwxrkXgFqTQ0MTIyNzA4NQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "cc39d3530d869c6d96f1f5d752bd21fde58d2c1d", "author": {"user": {"login": "pop4959", "name": null}}, "url": "https://github.com/EssentialsX/Essentials/commit/cc39d3530d869c6d96f1f5d752bd21fde58d2c1d", "committedDate": "2020-06-23T08:16:30Z", "message": "Paper recipe command"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "4320e051df6e200a58befea64ba8e5476cd1e80f", "author": {"user": {"login": "pop4959", "name": null}}, "url": "https://github.com/EssentialsX/Essentials/commit/4320e051df6e200a58befea64ba8e5476cd1e80f", "committedDate": "2020-06-24T22:23:54Z", "message": "Merge branch '2.x' into paper-recipe"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ce615cb6e03b3b7d9b4b8a76df8e3a7e4f232806", "author": {"user": {"login": "pop4959", "name": null}}, "url": "https://github.com/EssentialsX/Essentials/commit/ce615cb6e03b3b7d9b4b8a76df8e3a7e4f232806", "committedDate": "2020-06-25T00:04:56Z", "message": "Less dumb implementation"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDM3MDg5NDky", "url": "https://github.com/EssentialsX/Essentials/pull/3404#pullrequestreview-437089492", "createdAt": "2020-06-25T00:17:30Z", "commit": {"oid": "ce615cb6e03b3b7d9b4b8a76df8e3a7e4f232806"}, "state": "DISMISSED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDM5NDk2ODE4", "url": "https://github.com/EssentialsX/Essentials/pull/3404#pullrequestreview-439496818", "createdAt": "2020-06-29T21:00:34Z", "commit": {"oid": "ce615cb6e03b3b7d9b4b8a76df8e3a7e4f232806"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yOVQyMTowMDozNVrOGqiClA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yOVQyMTowMDozNVrOGqiClA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NzI1MTA5Mg==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            public class PaperPlayerRecipeBookClickEventProvider extends EventProvider {\n          \n          \n            \n            public class PaperRecipeBookListener extends ProviderListener {", "url": "https://github.com/EssentialsX/Essentials/pull/3404#discussion_r447251092", "createdAt": "2020-06-29T21:00:35Z", "author": {"login": "mdcfe"}, "path": "providers/PaperProvider/src/net/ess3/provider/providers/PaperPlayerRecipeBookClickEventProvider.java", "diffHunk": "@@ -0,0 +1,24 @@\n+package net.ess3.provider.providers;\n+\n+import com.destroystokyo.paper.event.player.PlayerRecipeBookClickEvent;\n+import net.ess3.provider.EventProvider;\n+import org.bukkit.event.Event;\n+import org.bukkit.event.EventHandler;\n+\n+import java.util.function.Consumer;\n+\n+public class PaperPlayerRecipeBookClickEventProvider extends EventProvider {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ce615cb6e03b3b7d9b4b8a76df8e3a7e4f232806"}, "originalPosition": 10}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "02db2867c988abe7622796a88e903ef5a38d104c", "author": {"user": {"login": "pop4959", "name": null}}, "url": "https://github.com/EssentialsX/Essentials/commit/02db2867c988abe7622796a88e903ef5a38d104c", "committedDate": "2020-06-30T02:02:23Z", "message": "review suggestions"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDQxMTk3NDYw", "url": "https://github.com/EssentialsX/Essentials/pull/3404#pullrequestreview-441197460", "createdAt": "2020-07-01T21:07:34Z", "commit": {"oid": "02db2867c988abe7622796a88e903ef5a38d104c"}, "state": "COMMENTED", "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wMVQyMTowNzozNFrOGr1Y4A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wMVQyMToxMDo0NVrOGr1eNA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0ODYxNjY3Mg==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                                            ((Cancellable)event).setCancelled(true);\n          \n          \n            \n                                            ((Cancellable) event).setCancelled(true);", "url": "https://github.com/EssentialsX/Essentials/pull/3404#discussion_r448616672", "createdAt": "2020-07-01T21:07:34Z", "author": {"login": "mdcfe"}, "path": "Essentials/src/com/earth2me/essentials/Essentials.java", "diffHunk": "@@ -269,6 +273,18 @@ public void onEnable() {\n                     serverStateProvider = new ReflServerStateProvider(getLogger());\n                 }\n \n+                //Event Providers\n+                if (PaperLib.isPaper()) {\n+                    try {\n+                        Class.forName(\"com.destroystokyo.paper.event.player.PlayerRecipeBookClickEvent\");\n+                        recipeBookEventProvider = new PaperRecipeBookListener(event -> {\n+                            if (this.getUser(((PlayerEvent) event).getPlayer()).isRecipeSee()) {\n+                                ((Cancellable)event).setCancelled(true);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "02db2867c988abe7622796a88e903ef5a38d104c"}, "originalPosition": 57}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0ODYxNzMyNQ==", "bodyText": "This breaks the command on 1.11 and lower. Maybe add a 1.12 check here?", "url": "https://github.com/EssentialsX/Essentials/pull/3404#discussion_r448617325", "createdAt": "2020-07-01T21:09:12Z", "author": {"login": "mdcfe"}, "path": "Essentials/src/com/earth2me/essentials/commands/Commandrecipe.java", "diffHunk": "@@ -26,18 +25,16 @@\n     public Commandrecipe() {\n         super(\"recipe\");\n     }\n-    \n-    private void disableCommandForVersion1_12() throws Exception {\n-        VersionUtil.BukkitVersion version = VersionUtil.getServerBukkitVersion();\n-        if (version.isHigherThanOrEqualTo(VersionUtil.v1_12_0_R01)\n-            && !ess.getSettings().isForceEnableRecipe()) {\n-            throw new Exception(\"Please use the recipe book in your inventory.\");\n-        }\n-    }\n \n     @Override\n     public void run(final Server server, final CommandSource sender, final String commandLabel, final String[] args) throws Exception {\n-        disableCommandForVersion1_12();\n+        try {\n+            Class.forName(\"com.destroystokyo.paper.event.player.PlayerRecipeBookClickEvent\");\n+        } catch (ClassNotFoundException e) {\n+            sender.sendMessage(tl(\"unsupportedFeature\"));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "02db2867c988abe7622796a88e903ef5a38d104c"}, "originalPosition": 27}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0ODYxODAzNg==", "bodyText": "If we're removing this check entirely, remove Settings#isForceEnableRecipe too (it's an undocumented config option I used to confirm whether this bug was fixed in newer versions of Spigot).", "url": "https://github.com/EssentialsX/Essentials/pull/3404#discussion_r448618036", "createdAt": "2020-07-01T21:10:45Z", "author": {"login": "mdcfe"}, "path": "Essentials/src/com/earth2me/essentials/commands/Commandrecipe.java", "diffHunk": "@@ -26,18 +25,16 @@\n     public Commandrecipe() {\n         super(\"recipe\");\n     }\n-    \n-    private void disableCommandForVersion1_12() throws Exception {\n-        VersionUtil.BukkitVersion version = VersionUtil.getServerBukkitVersion();\n-        if (version.isHigherThanOrEqualTo(VersionUtil.v1_12_0_R01)\n-            && !ess.getSettings().isForceEnableRecipe()) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "02db2867c988abe7622796a88e903ef5a38d104c"}, "originalPosition": 16}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "61ba5c20479c90bc446223dd2a4e1a0177f84b03", "author": {"user": {"login": "pop4959", "name": null}}, "url": "https://github.com/EssentialsX/Essentials/commit/61ba5c20479c90bc446223dd2a4e1a0177f84b03", "committedDate": "2020-07-01T21:12:30Z", "message": "Update Essentials/src/com/earth2me/essentials/Essentials.java\n\nCo-authored-by: MD <1917406+md678685@users.noreply.github.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "dbd9375b453931cda5e447e5484c26f5adbba849", "author": {"user": {"login": "pop4959", "name": null}}, "url": "https://github.com/EssentialsX/Essentials/commit/dbd9375b453931cda5e447e5484c26f5adbba849", "committedDate": "2020-07-01T21:26:25Z", "message": "Review comments"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "61e48a93b711461af4983a152b81f979d861630c", "author": {"user": {"login": "pop4959", "name": null}}, "url": "https://github.com/EssentialsX/Essentials/commit/61e48a93b711461af4983a152b81f979d861630c", "committedDate": "2020-07-01T21:28:40Z", "message": "Merge branch 'paper-recipe' of https://github.com/pop4959/Essentials into paper-recipe"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDQxMjI3MDg1", "url": "https://github.com/EssentialsX/Essentials/pull/3404#pullrequestreview-441227085", "createdAt": "2020-07-01T22:07:23Z", "commit": {"oid": "61e48a93b711461af4983a152b81f979d861630c"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4520, "cost": 1, "resetAt": "2021-11-01T14:20:25Z"}}}