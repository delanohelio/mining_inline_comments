{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDIyMTg4MzM0", "number": 3320, "title": "Add support for permission contexts", "bodyText": "As discussed in #2960. Allows Essentials to register contexts with permission plugins that support them. A working implementation for LuckPerms is included in this PR. PermissionsEx 2 also has support for registering contexts, however it should probably be added at a later date, since as per @zml2008 on Discord, the API is not yet stable.", "createdAt": "2020-05-23T01:14:44Z", "url": "https://github.com/EssentialsX/Essentials/pull/3320", "merged": true, "mergeCommit": {"oid": "baab65d776be713b5fa2cf1ef492739edb75aaa7"}, "closed": true, "closedAt": "2020-06-03T20:36:29Z", "author": {"login": "pop4959"}, "timelineItems": {"totalCount": 20, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcj8FUsgH2gAyNDIyMTg4MzM0OjI0NjlhNmIxM2VlMjgzODdiYzRkYzAyYTE1Nzk5MGQzNmI4ZWU0ZTU=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcnvh_yAFqTQyMzkwNjk4NA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "2469a6b13ee28387bc4dc02a157990d36b8ee4e5", "author": {"user": {"login": "pop4959", "name": null}}, "url": "https://github.com/EssentialsX/Essentials/commit/2469a6b13ee28387bc4dc02a157990d36b8ee4e5", "committedDate": "2020-05-23T00:53:33Z", "message": "Add permission contexts to Essentials"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "784efcf855738ab2bb97e26b703af59c30873532", "author": {"user": {"login": "pop4959", "name": null}}, "url": "https://github.com/EssentialsX/Essentials/commit/784efcf855738ab2bb97e26b703af59c30873532", "committedDate": "2020-05-23T03:37:24Z", "message": "More abstraction"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "6fff9500bb61101039bf406b984821497f642e60", "author": {"user": {"login": "pop4959", "name": null}}, "url": "https://github.com/EssentialsX/Essentials/commit/6fff9500bb61101039bf406b984821497f642e60", "committedDate": "2020-05-24T03:59:27Z", "message": "Apply suggestions"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a8f6667f6343d5c92f36caa2451e155bc8046d04", "author": {"user": {"login": "pop4959", "name": null}}, "url": "https://github.com/EssentialsX/Essentials/commit/a8f6667f6343d5c92f36caa2451e155bc8046d04", "committedDate": "2020-05-24T07:55:08Z", "message": "iterable instead of set"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDE3Mzk2NjYz", "url": "https://github.com/EssentialsX/Essentials/pull/3320#pullrequestreview-417396663", "createdAt": "2020-05-24T22:21:24Z", "commit": {"oid": "a8f6667f6343d5c92f36caa2451e155bc8046d04"}, "state": "DISMISSED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ebe6553d93cf6ca55c30c0b3be627c52f2de2b85", "author": {"user": {"login": "pop4959", "name": null}}, "url": "https://github.com/EssentialsX/Essentials/commit/ebe6553d93cf6ca55c30c0b3be627c52f2de2b85", "committedDate": "2020-05-24T23:44:38Z", "message": "Address concerns about reloads"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "85b626cc2ef70c19afceae801cc6d8d6243a969a", "author": {"user": {"login": "pop4959", "name": null}}, "url": "https://github.com/EssentialsX/Essentials/commit/85b626cc2ef70c19afceae801cc6d8d6243a969a", "committedDate": "2020-05-24T23:58:16Z", "message": "Support context prefixing"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDE3NDA1MTkw", "url": "https://github.com/EssentialsX/Essentials/pull/3320#pullrequestreview-417405190", "createdAt": "2020-05-25T00:09:40Z", "commit": {"oid": "85b626cc2ef70c19afceae801cc6d8d6243a969a"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yNVQwMDowOTo0MFrOGZyKCA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yNVQwMDowOTo0MFrOGZyKCA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTY4OTM1Mg==", "bodyText": "Just want to note my objection here to defaulting to no namespacing! :)", "url": "https://github.com/EssentialsX/Essentials/pull/3320#discussion_r429689352", "createdAt": "2020-05-25T00:09:40Z", "author": {"login": "mbax"}, "path": "Essentials/src/com/earth2me/essentials/Settings.java", "diffHunk": "@@ -1653,6 +1653,12 @@ public boolean logCommandBlockCommands() {\n         return blacklist;\n     }\n \n+    // #easteregg\n+    @Override\n+    public String getContextPrefix() {\n+        return config.getString(\"context-prefix\", \"\");", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "85b626cc2ef70c19afceae801cc6d8d6243a969a"}, "originalPosition": 7}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "495f90cc1e4206199754658033620327b6947bb5", "author": {"user": {"login": "pop4959", "name": null}}, "url": "https://github.com/EssentialsX/Essentials/commit/495f90cc1e4206199754658033620327b6947bb5", "committedDate": "2020-05-25T02:44:48Z", "message": "Revert \"Support context prefixing\"\n\nThis reverts commit 85b626cc2ef70c19afceae801cc6d8d6243a969a."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "050c1cc62aed555bdb4a3768298191aeeb172fbb", "author": {"user": {"login": "pop4959", "name": null}}, "url": "https://github.com/EssentialsX/Essentials/commit/050c1cc62aed555bdb4a3768298191aeeb172fbb", "committedDate": "2020-05-25T02:46:09Z", "message": "Static prefix"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a421958a0ea239c4701f7b43f95a5e69ac97dabd", "author": {"user": {"login": "pop4959", "name": null}}, "url": "https://github.com/EssentialsX/Essentials/commit/a421958a0ea239c4701f7b43f95a5e69ac97dabd", "committedDate": "2020-05-25T03:28:07Z", "message": "this is probably also good to do"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDE3NDQwNDkw", "url": "https://github.com/EssentialsX/Essentials/pull/3320#pullrequestreview-417440490", "createdAt": "2020-05-25T03:37:15Z", "commit": {"oid": "a421958a0ea239c4701f7b43f95a5e69ac97dabd"}, "state": "DISMISSED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDE3NDQzNTg5", "url": "https://github.com/EssentialsX/Essentials/pull/3320#pullrequestreview-417443589", "createdAt": "2020-05-25T03:53:36Z", "commit": {"oid": "a421958a0ea239c4701f7b43f95a5e69ac97dabd"}, "state": "DISMISSED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDE3Njc2NDMz", "url": "https://github.com/EssentialsX/Essentials/pull/3320#pullrequestreview-417676433", "createdAt": "2020-05-25T12:26:00Z", "commit": {"oid": "a421958a0ea239c4701f7b43f95a5e69ac97dabd"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yNVQxMjoyNjowMFrOGZ_f2w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yNVQxMjoyNjowMFrOGZ_f2w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTkwNzkzMQ==", "bodyText": "These register calls should probably be in onEnable??\nUnless I'm missing something, they're currently being added on every PluginEnableEvent? (this is gonna fire every time a plugin loads?!)", "url": "https://github.com/EssentialsX/Essentials/pull/3320#discussion_r429907931", "createdAt": "2020-05-25T12:26:00Z", "author": {"login": "lucko"}, "path": "Essentials/src/com/earth2me/essentials/EssentialsPluginListener.java", "diffHunk": "@@ -25,6 +27,9 @@ public void onPluginEnable(final PluginEnableEvent event) {\n         }\n         ess.getPermissionsHandler().setUseSuperperms(ess.getSettings().useBukkitPermissions());\n         ess.getPermissionsHandler().checkPermissions();\n+        ess.getPermissionsHandler().registerContext(\"ess-afk\", player -> Collections.singleton(String.valueOf(ess.getUser(player).isAfk())), () -> ImmutableSet.of(\"true\", \"false\"));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a421958a0ea239c4701f7b43f95a5e69ac97dabd"}, "originalPosition": 20}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDE3MzM3MzY0", "url": "https://github.com/EssentialsX/Essentials/pull/3320#pullrequestreview-417337364", "createdAt": "2020-05-24T08:22:22Z", "commit": {"oid": "a8f6667f6343d5c92f36caa2451e155bc8046d04"}, "state": "DISMISSED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yNVQyMDozMDo1NlrOGaJPsg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yNVQyMDozMDo1NlrOGaJPsg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMDA2NzYzNA==", "bodyText": "These should only be re-applied when the currently active permissions handler changes.\nI'm not sure how I feel about registering these here - I'd personally have put them in a separate method or even a new class, as the amount of contexts will likely increase and it feels cluttered to throw them in here. Perhaps they could be added to a default registerContexts method on PermissionHandler?", "url": "https://github.com/EssentialsX/Essentials/pull/3320#discussion_r430067634", "createdAt": "2020-05-25T20:30:56Z", "author": {"login": "mdcfe"}, "path": "Essentials/src/com/earth2me/essentials/EssentialsPluginListener.java", "diffHunk": "@@ -25,6 +27,9 @@ public void onPluginEnable(final PluginEnableEvent event) {\n         }\n         ess.getPermissionsHandler().setUseSuperperms(ess.getSettings().useBukkitPermissions());\n         ess.getPermissionsHandler().checkPermissions();\n+        ess.getPermissionsHandler().registerContext(\"ess-afk\", player -> Collections.singleton(String.valueOf(ess.getUser(player).isAfk())), () -> ImmutableSet.of(\"true\", \"false\"));", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTkwNzkzMQ=="}, "originalCommit": {"oid": "a421958a0ea239c4701f7b43f95a5e69ac97dabd"}, "originalPosition": 20}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "bcee1e598528a7a1ae7d843e7e822ce0649a0fca", "author": {"user": {"login": "pop4959", "name": null}}, "url": "https://github.com/EssentialsX/Essentials/commit/bcee1e598528a7a1ae7d843e7e822ce0649a0fca", "committedDate": "2020-05-26T09:13:21Z", "message": "Handle registrations in onEnable/onDisable"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e51f400afff9da4dbd93a31beb16efecbd370a6b", "author": {"user": {"login": "pop4959", "name": null}}, "url": "https://github.com/EssentialsX/Essentials/commit/e51f400afff9da4dbd93a31beb16efecbd370a6b", "committedDate": "2020-05-26T09:15:53Z", "message": "Change prefixes again"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDE4MTM2OTUx", "url": "https://github.com/EssentialsX/Essentials/pull/3320#pullrequestreview-418136951", "createdAt": "2020-05-26T09:44:23Z", "commit": {"oid": "e51f400afff9da4dbd93a31beb16efecbd370a6b"}, "state": "DISMISSED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "00a9b9e5db4b1897c8522c2a3439b1d57e2832af", "author": {"user": {"login": "pop4959", "name": null}}, "url": "https://github.com/EssentialsX/Essentials/commit/00a9b9e5db4b1897c8522c2a3439b1d57e2832af", "committedDate": "2020-05-31T21:58:41Z", "message": "Change context registrations only when the active permission handler changes"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDIzOTA2OTg0", "url": "https://github.com/EssentialsX/Essentials/pull/3320#pullrequestreview-423906984", "createdAt": "2020-06-03T20:31:48Z", "commit": {"oid": "00a9b9e5db4b1897c8522c2a3439b1d57e2832af"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4724, "cost": 1, "resetAt": "2021-11-01T14:20:25Z"}}}