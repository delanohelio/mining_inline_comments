{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTQ1NzUzMDU0", "number": 3875, "title": "Add WarpModifyEvent", "bodyText": "Adds a cancellable event for when warps are modified (altered/removed/created).\nCloses #3868", "createdAt": "2020-12-27T01:50:03Z", "url": "https://github.com/EssentialsX/Essentials/pull/3875", "merged": true, "mergeCommit": {"oid": "5af9536db1ebed641aeaa7bd3243f69187e798a1"}, "closed": true, "closedAt": "2021-01-08T20:20:04Z", "author": {"login": "DarkEyeDragon"}, "timelineItems": {"totalCount": 17, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdqEQ5kAH2gAyNTQ1NzUzMDU0OmE4OTFlNWY1Zjg0MzNhOGQwOWY4NDE3M2Y0MDU3NDAxNWVkMzk5N2U=", "endCursor": "Y3Vyc29yOnYyOpPPAAABduOlZOAH2gAyNTQ1NzUzMDU0OmExNGFlODYyNWUwOGJjNmNkM2UxNmUyM2FmYWY2YzdjODZkZmI0Yzg=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "a891e5f5f8433a8d09f84173f40574015ed3997e", "author": {"user": {"login": "DarkEyeDragon", "name": "Joshua"}}, "url": "https://github.com/EssentialsX/Essentials/commit/a891e5f5f8433a8d09f84173f40574015ed3997e", "committedDate": "2020-12-26T22:00:08Z", "message": "Add WarpModifyEvent event"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "6ffec5783e0ae1b67f039cd5eff8a5a5ea183e04", "author": {"user": {"login": "DarkEyeDragon", "name": "Joshua"}}, "url": "https://github.com/EssentialsX/Essentials/commit/6ffec5783e0ae1b67f039cd5eff8a5a5ea183e04", "committedDate": "2020-12-26T22:09:46Z", "message": "Make the event not trigger if the warp does not exist."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "4d2570a918290e7a7502c7374aed7f7813eab4e6", "author": {"user": {"login": "DarkEyeDragon", "name": "Joshua"}}, "url": "https://github.com/EssentialsX/Essentials/commit/4d2570a918290e7a7502c7374aed7f7813eab4e6", "committedDate": "2020-12-27T15:38:43Z", "message": "Add javadoc and fix check violations"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "eea00e41b06a6d5dc5236d45378e2d960c1d72cc", "author": {"user": {"login": "DarkEyeDragon", "name": "Joshua"}}, "url": "https://github.com/EssentialsX/Essentials/commit/eea00e41b06a6d5dc5236d45378e2d960c1d72cc", "committedDate": "2021-01-01T23:11:10Z", "message": "Check if cancelled after the event is called..."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "60b51c4efc4fb89ca68393b5c27b3d2339b89d83", "author": {"user": {"login": "DarkEyeDragon", "name": "Joshua"}}, "url": "https://github.com/EssentialsX/Essentials/commit/60b51c4efc4fb89ca68393b5c27b3d2339b89d83", "committedDate": "2021-01-01T23:16:43Z", "message": "Moved event to V2 and made WarpModifyCause an inner class"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "3a02229894532c606b4a95d74eb2eac754ade35f", "author": {"user": {"login": "DarkEyeDragon", "name": "Joshua"}}, "url": "https://github.com/EssentialsX/Essentials/commit/3a02229894532c606b4a95d74eb2eac754ade35f", "committedDate": "2021-01-02T00:11:14Z", "message": "Added new and old location parameters"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c9405936e4c15b2ec71cebe0091551fbdab47a88", "author": {"user": {"login": "JRoy", "name": "Josh Roy"}}, "url": "https://github.com/EssentialsX/Essentials/commit/c9405936e4c15b2ec71cebe0091551fbdab47a88", "committedDate": "2021-01-02T00:30:09Z", "message": "Merge branch '2.x' into warpevent"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTYwNjEzMjI5", "url": "https://github.com/EssentialsX/Essentials/pull/3875#pullrequestreview-560613229", "createdAt": "2021-01-02T00:30:24Z", "commit": {"oid": "c9405936e4c15b2ec71cebe0091551fbdab47a88"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 6, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMS0wMlQwMDozMDoyNFrOINTp3A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMS0wMlQwMDo0NjowMVrOINTuRQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1MDgyNDQxMg==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                    Location location = ess.getWarps().getWarp(args[0]);\n          \n          \n            \n                    final Location location = ess.getWarps().getWarp(args[0]);", "url": "https://github.com/EssentialsX/Essentials/pull/3875#discussion_r550824412", "createdAt": "2021-01-02T00:30:24Z", "author": {"login": "JRoy"}, "path": "Essentials/src/main/java/com/earth2me/essentials/commands/Commanddelwarp.java", "diffHunk": "@@ -19,9 +22,18 @@ public void run(final Server server, final CommandSource sender, final String co\n         if (args.length == 0) {\n             throw new NotEnoughArgumentsException();\n         }\n-\n-        ess.getWarps().removeWarp(args[0]);\n-        sender.sendMessage(tl(\"deleteWarp\", args[0]));\n+        //Check if warp exists before calling the event\n+        Location location = ess.getWarps().getWarp(args[0]);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c9405936e4c15b2ec71cebe0091551fbdab47a88"}, "originalPosition": 18}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1MDgyNDQ0MQ==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                        if (event.isCancelled()) {\n          \n          \n            \n                            return;\n          \n          \n            \n                        }\n          \n          \n            \n                        Bukkit.getServer().getPluginManager().callEvent(event);\n          \n          \n            \n                        Bukkit.getServer().getPluginManager().callEvent(event);\n          \n          \n            \n                        if (event.isCancelled()) {\n          \n          \n            \n                            return;\n          \n          \n            \n                        }", "url": "https://github.com/EssentialsX/Essentials/pull/3875#discussion_r550824441", "createdAt": "2021-01-02T00:30:44Z", "author": {"login": "JRoy"}, "path": "Essentials/src/main/java/com/earth2me/essentials/commands/Commanddelwarp.java", "diffHunk": "@@ -19,9 +22,18 @@ public void run(final Server server, final CommandSource sender, final String co\n         if (args.length == 0) {\n             throw new NotEnoughArgumentsException();\n         }\n-\n-        ess.getWarps().removeWarp(args[0]);\n-        sender.sendMessage(tl(\"deleteWarp\", args[0]));\n+        //Check if warp exists before calling the event\n+        Location location = ess.getWarps().getWarp(args[0]);\n+        if (location != null) {\n+            final WarpModifyEvent event = new WarpModifyEvent(sender.getUser(this.ess), args[0], location, null, WarpModifyEvent.WarpModifyCause.DELETE);\n+            if (event.isCancelled()) {\n+                return;\n+            }\n+            Bukkit.getServer().getPluginManager().callEvent(event);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c9405936e4c15b2ec71cebe0091551fbdab47a88"}, "originalPosition": 24}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1MDgyNDQ4Mw==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                        if (event.isCancelled()) {\n          \n          \n            \n                            return;\n          \n          \n            \n                        }\n          \n          \n            \n                        Bukkit.getServer().getPluginManager().callEvent(event);\n          \n          \n            \n                        Bukkit.getServer().getPluginManager().callEvent(event);\n          \n          \n            \n                        if (event.isCancelled()) {\n          \n          \n            \n                            return;\n          \n          \n            \n                        }", "url": "https://github.com/EssentialsX/Essentials/pull/3875#discussion_r550824483", "createdAt": "2021-01-02T00:31:28Z", "author": {"login": "JRoy"}, "path": "Essentials/src/main/java/com/earth2me/essentials/commands/Commandsetwarp.java", "diffHunk": "@@ -32,8 +34,19 @@ public void run(final Server server, final User user, final String commandLabel,\n             warpLoc = warps.getWarp(args[0]);\n         } catch (final WarpNotFoundException | InvalidWorldException ignored) {\n         }\n-\n-        if (warpLoc == null || user.isAuthorized(\"essentials.warp.overwrite.\" + StringUtil.safeString(args[0]))) {\n+        if (warpLoc == null) {\n+            final WarpModifyEvent event = new WarpModifyEvent(user, args[0], null, user.getLocation(), WarpModifyEvent.WarpModifyCause.CREATE);\n+            if (event.isCancelled()) {\n+                return;\n+            }\n+            Bukkit.getServer().getPluginManager().callEvent(event);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c9405936e4c15b2ec71cebe0091551fbdab47a88"}, "originalPosition": 20}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1MDgyNDU1Nw==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            \n          \n          \n            \n                private static final HandlerList handlers = new HandlerList();\n          \n          \n            \n                private static final HandlerList handlers = new HandlerList();", "url": "https://github.com/EssentialsX/Essentials/pull/3875#discussion_r550824557", "createdAt": "2021-01-02T00:32:32Z", "author": {"login": "JRoy"}, "path": "Essentials/src/main/java/net/essentialsx/api/v2/events/WarpModifyEvent.java", "diffHunk": "@@ -0,0 +1,84 @@\n+package net.essentialsx.api.v2.events;\n+\n+import net.ess3.api.IUser;\n+import org.bukkit.Location;\n+import org.bukkit.event.Cancellable;\n+import org.bukkit.event.Event;\n+import org.bukkit.event.HandlerList;\n+\n+/**\n+ * Called when a warp is about to be modified.\n+ * Includes creation and deletion as described in {@link WarpModifyCause}.\n+ */\n+public class WarpModifyEvent extends Event implements Cancellable {\n+\n+    private static final HandlerList handlers = new HandlerList();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c9405936e4c15b2ec71cebe0091551fbdab47a88"}, "originalPosition": 15}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1MDgyNTUwNA==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            \n          \n          \n            \n                public HandlerList getHandlers() {\n          \n          \n            \n                    return handlers;\n          \n          \n            \n                }\n          \n          \n            \n            \n          \n          \n            \n                public static HandlerList getHandlerList() {\n          \n          \n            \n                    return handlers;\n          \n          \n            \n                }", "url": "https://github.com/EssentialsX/Essentials/pull/3875#discussion_r550825504", "createdAt": "2021-01-02T00:45:28Z", "author": {"login": "JRoy"}, "path": "Essentials/src/main/java/net/essentialsx/api/v2/events/WarpModifyEvent.java", "diffHunk": "@@ -0,0 +1,84 @@\n+package net.essentialsx.api.v2.events;\n+\n+import net.ess3.api.IUser;\n+import org.bukkit.Location;\n+import org.bukkit.event.Cancellable;\n+import org.bukkit.event.Event;\n+import org.bukkit.event.HandlerList;\n+\n+/**\n+ * Called when a warp is about to be modified.\n+ * Includes creation and deletion as described in {@link WarpModifyCause}.\n+ */\n+public class WarpModifyEvent extends Event implements Cancellable {\n+\n+    private static final HandlerList handlers = new HandlerList();\n+    private final IUser issuer;\n+    private final String warpName;\n+    private final Location oldLocation;\n+    private final Location newLocation;\n+    private final WarpModifyCause cause;\n+    private boolean cancelled;\n+\n+\n+    /**\n+     * @param issuer      the {@link IUser} issuing the command\n+     * @param warpName    the name of the warp that's being altered\n+     * @param oldLocation the old location before being modified. Null if {@link WarpModifyCause#CREATE}.\n+     * @param newLocation the new location after being modified. Null if {@link WarpModifyCause#DELETE}.\n+     * @param cause       the cause of change.\n+     */\n+    public WarpModifyEvent(IUser issuer, String warpName, Location oldLocation, Location newLocation, WarpModifyCause cause) {\n+        this.issuer = issuer;\n+        this.warpName = warpName;\n+        this.oldLocation = oldLocation;\n+        this.newLocation = newLocation;\n+        this.cause = cause;\n+    }\n+\n+    public HandlerList getHandlers() {\n+        return handlers;\n+    }\n+\n+    public static HandlerList getHandlerList() {\n+        return handlers;\n+    }", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c9405936e4c15b2ec71cebe0091551fbdab47a88"}, "originalPosition": 45}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1MDgyNTU0MQ==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                }\n          \n          \n            \n                }\n          \n          \n            \n                \n          \n          \n            \n                public HandlerList getHandlers() {\n          \n          \n            \n                    return handlers;\n          \n          \n            \n                }\n          \n          \n            \n            \n          \n          \n            \n                public static HandlerList getHandlerList() {\n          \n          \n            \n                    return handlers;\n          \n          \n            \n                }", "url": "https://github.com/EssentialsX/Essentials/pull/3875#discussion_r550825541", "createdAt": "2021-01-02T00:46:01Z", "author": {"login": "JRoy"}, "path": "Essentials/src/main/java/net/essentialsx/api/v2/events/WarpModifyEvent.java", "diffHunk": "@@ -0,0 +1,84 @@\n+package net.essentialsx.api.v2.events;\n+\n+import net.ess3.api.IUser;\n+import org.bukkit.Location;\n+import org.bukkit.event.Cancellable;\n+import org.bukkit.event.Event;\n+import org.bukkit.event.HandlerList;\n+\n+/**\n+ * Called when a warp is about to be modified.\n+ * Includes creation and deletion as described in {@link WarpModifyCause}.\n+ */\n+public class WarpModifyEvent extends Event implements Cancellable {\n+\n+    private static final HandlerList handlers = new HandlerList();\n+    private final IUser issuer;\n+    private final String warpName;\n+    private final Location oldLocation;\n+    private final Location newLocation;\n+    private final WarpModifyCause cause;\n+    private boolean cancelled;\n+\n+\n+    /**\n+     * @param issuer      the {@link IUser} issuing the command\n+     * @param warpName    the name of the warp that's being altered\n+     * @param oldLocation the old location before being modified. Null if {@link WarpModifyCause#CREATE}.\n+     * @param newLocation the new location after being modified. Null if {@link WarpModifyCause#DELETE}.\n+     * @param cause       the cause of change.\n+     */\n+    public WarpModifyEvent(IUser issuer, String warpName, Location oldLocation, Location newLocation, WarpModifyCause cause) {\n+        this.issuer = issuer;\n+        this.warpName = warpName;\n+        this.oldLocation = oldLocation;\n+        this.newLocation = newLocation;\n+        this.cause = cause;\n+    }\n+\n+    public HandlerList getHandlers() {\n+        return handlers;\n+    }\n+\n+    public static HandlerList getHandlerList() {\n+        return handlers;\n+    }\n+\n+    @Override\n+    public boolean isCancelled() {\n+        return cancelled;\n+    }\n+\n+    @Override\n+    public void setCancelled(boolean cancel) {\n+        this.cancelled = cancel;\n+    }\n+\n+    public IUser getIssuer() {\n+        return issuer;\n+    }\n+\n+    public WarpModifyCause getCause() {\n+        return cause;\n+    }\n+\n+    public String getWarpName() {\n+        return warpName;\n+    }", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c9405936e4c15b2ec71cebe0091551fbdab47a88"}, "originalPosition": 67}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "636d0d5f27600ff29119c27e906e3cec980b498f", "author": {"user": {"login": "JRoy", "name": "Josh Roy"}}, "url": "https://github.com/EssentialsX/Essentials/commit/636d0d5f27600ff29119c27e906e3cec980b498f", "committedDate": "2021-01-02T02:35:13Z", "message": "Apply suggestions from code review"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTYwNjE3MDMy", "url": "https://github.com/EssentialsX/Essentials/pull/3875#pullrequestreview-560617032", "createdAt": "2021-01-02T02:38:30Z", "commit": {"oid": "636d0d5f27600ff29119c27e906e3cec980b498f"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMS0wMlQwMjozODozMFrOINUPXg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMS0wMlQwMjozODozMFrOINUPXg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1MDgzNDAxNA==", "bodyText": "Suggested change", "url": "https://github.com/EssentialsX/Essentials/pull/3875#discussion_r550834014", "createdAt": "2021-01-02T02:38:30Z", "author": {"login": "JRoy"}, "path": "Essentials/src/main/java/net/essentialsx/api/v2/events/WarpModifyEvent.java", "diffHunk": "@@ -0,0 +1,83 @@\n+package net.essentialsx.api.v2.events;\n+\n+import net.ess3.api.IUser;\n+import org.bukkit.Location;\n+import org.bukkit.event.Cancellable;\n+import org.bukkit.event.Event;\n+import org.bukkit.event.HandlerList;\n+\n+/**\n+ * Called when a warp is about to be modified.\n+ * Includes creation and deletion as described in {@link WarpModifyCause}.\n+ */\n+public class WarpModifyEvent extends Event implements Cancellable {\n+    private static final HandlerList handlers = new HandlerList();\n+    private final IUser issuer;\n+    private final String warpName;\n+    private final Location oldLocation;\n+    private final Location newLocation;\n+    private final WarpModifyCause cause;\n+    private boolean cancelled;\n+\n+", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "636d0d5f27600ff29119c27e906e3cec980b498f"}, "originalPosition": 22}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "4af92668080c6d6730675b538d70afd3375663dc", "author": {"user": {"login": "JRoy", "name": "Josh Roy"}}, "url": "https://github.com/EssentialsX/Essentials/commit/4af92668080c6d6730675b538d70afd3375663dc", "committedDate": "2021-01-02T02:38:33Z", "message": "Update Essentials/src/main/java/net/essentialsx/api/v2/events/WarpModifyEvent.java"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e18b424b83e8edc5fe41442015fba9ae7d8879ab", "author": {"user": {"login": "JRoy", "name": "Josh Roy"}}, "url": "https://github.com/EssentialsX/Essentials/commit/e18b424b83e8edc5fe41442015fba9ae7d8879ab", "committedDate": "2021-01-02T02:44:08Z", "message": "Update WarpModifyEvent.java"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b7575089ff46085a07a49c0b6f73f236c5e77094", "author": {"user": {"login": "JRoy", "name": "Josh Roy"}}, "url": "https://github.com/EssentialsX/Essentials/commit/b7575089ff46085a07a49c0b6f73f236c5e77094", "committedDate": "2021-01-02T02:46:41Z", "message": "Update WarpModifyEvent.java"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "eed861788624437f93911c1f0ece5e2d4e35292d", "author": {"user": {"login": "JRoy", "name": "Josh Roy"}}, "url": "https://github.com/EssentialsX/Essentials/commit/eed861788624437f93911c1f0ece5e2d4e35292d", "committedDate": "2021-01-02T02:46:58Z", "message": "Update WarpModifyEvent.java"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTYwNjE3Mjkw", "url": "https://github.com/EssentialsX/Essentials/pull/3875#pullrequestreview-560617290", "createdAt": "2021-01-02T02:48:50Z", "commit": {"oid": "eed861788624437f93911c1f0ece5e2d4e35292d"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTY0NTQ0ODQ0", "url": "https://github.com/EssentialsX/Essentials/pull/3875#pullrequestreview-564544844", "createdAt": "2021-01-08T20:03:01Z", "commit": {"oid": "eed861788624437f93911c1f0ece5e2d4e35292d"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a14ae8625e08bc6cd3e16e23afaf6c7c86dfb4c8", "author": {"user": {"login": "JRoy", "name": "Josh Roy"}}, "url": "https://github.com/EssentialsX/Essentials/commit/a14ae8625e08bc6cd3e16e23afaf6c7c86dfb4c8", "committedDate": "2021-01-08T20:17:16Z", "message": "Merge branch '2.x' into warpevent"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4509, "cost": 1, "resetAt": "2021-11-01T14:20:25Z"}}}