{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDg3NjA2NDAy", "number": 3675, "title": "Make HelpInput use the known command map", "bodyText": "This PR makes HelpInput use knownCommands in the command map, rather than relying on plugin descriptions. This means that commands that have been registered programmatically (or impromptu) will be recognized and displayed in the help menu.\nThe ugly reflection is due to Spigot not exposing the command map getter. This has been tested on Spigot 1.8, 1.16.3 and Paper 1.16.3 with plugins that register commands directly to the command map.", "createdAt": "2020-09-15T22:09:21Z", "url": "https://github.com/EssentialsX/Essentials/pull/3675", "merged": true, "mergeCommit": {"oid": "a4f580e3193a12e5456b56123c85dc99500efad2"}, "closed": true, "closedAt": "2020-10-19T14:27:41Z", "author": {"login": "Citymonstret"}, "timelineItems": {"totalCount": 18, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdJQAC2gBqjM3NzA2MzE0NDI=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdUFBXKAFqTUxMTgyMjMwNA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "840a51939086f48c1f751106c8a4f5152fb74f7c", "author": {"user": {"login": "Citymonstret", "name": "Alexander S\u00f6derberg"}}, "url": "https://github.com/EssentialsX/Essentials/commit/840a51939086f48c1f751106c8a4f5152fb74f7c", "committedDate": "2020-09-15T22:56:27Z", "message": "Add PaperKnownCommandsProvider for Paper 1.11.2+"}, "afterCommit": {"oid": "c9145544fa0322f272258e93e15bcc7863ad2e30", "author": {"user": {"login": "Citymonstret", "name": "Alexander S\u00f6derberg"}}, "url": "https://github.com/EssentialsX/Essentials/commit/c9145544fa0322f272258e93e15bcc7863ad2e30", "committedDate": "2020-09-15T23:00:09Z", "message": "Add PaperKnownCommandsProvider for Paper 1.11.2+"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDg5MTY5Mzk3", "url": "https://github.com/EssentialsX/Essentials/pull/3675#pullrequestreview-489169397", "createdAt": "2020-09-15T23:15:19Z", "commit": {"oid": "c9145544fa0322f272258e93e15bcc7863ad2e30"}, "state": "DISMISSED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDg5MjE1NDcw", "url": "https://github.com/EssentialsX/Essentials/pull/3675#pullrequestreview-489215470", "createdAt": "2020-09-16T01:40:23Z", "commit": {"oid": "c9145544fa0322f272258e93e15bcc7863ad2e30"}, "state": "DISMISSED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDg5MjMxMjI0", "url": "https://github.com/EssentialsX/Essentials/pull/3675#pullrequestreview-489231224", "createdAt": "2020-09-16T02:31:24Z", "commit": {"oid": "51f0429db4db61cf7bb6087acb131fd316f1376d"}, "state": "DISMISSED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDg5Mjc2MTY4", "url": "https://github.com/EssentialsX/Essentials/pull/3675#pullrequestreview-489276168", "createdAt": "2020-09-16T05:02:19Z", "commit": {"oid": "51f0429db4db61cf7bb6087acb131fd316f1376d"}, "state": "DISMISSED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTExNzU3NjIz", "url": "https://github.com/EssentialsX/Essentials/pull/3675#pullrequestreview-511757623", "createdAt": "2020-10-19T13:26:19Z", "commit": {"oid": "51f0429db4db61cf7bb6087acb131fd316f1376d"}, "state": "DISMISSED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTExNzU4MTEz", "url": "https://github.com/EssentialsX/Essentials/pull/3675#pullrequestreview-511758113", "createdAt": "2020-10-19T13:26:48Z", "commit": {"oid": "51f0429db4db61cf7bb6087acb131fd316f1376d"}, "state": "DISMISSED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTExNzYzNzEy", "url": "https://github.com/EssentialsX/Essentials/pull/3675#pullrequestreview-511763712", "createdAt": "2020-10-19T13:32:39Z", "commit": {"oid": "d22f3cc14eb4d7836b2ae2c2fb89548a68ce13d7"}, "state": "COMMENTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xOVQxMzozMjozOVrOHkOhoQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xOVQxMzozMzowMVrOHkOizA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNzc0ODc2OQ==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            import net.ess3.provider.KnownCommandsProvider;\n          \n          \n            \n            import net.ess3.provider.ContainerProvider;\n          \n          \n            \n            import net.ess3.provider.KnownCommandsProvider;\n          \n      \n    \n    \n  \n\nOops", "url": "https://github.com/EssentialsX/Essentials/pull/3675#discussion_r507748769", "createdAt": "2020-10-19T13:32:39Z", "author": {"login": "mdcfe"}, "path": "Essentials/src/com/earth2me/essentials/Essentials.java", "diffHunk": "@@ -44,10 +44,11 @@\n import net.ess3.api.IItemDb;\n import net.ess3.api.IJails;\n import net.ess3.api.ISettings;\n+import net.ess3.nms.refl.providers.ReflKnownCommandsProvider;\n import net.ess3.nms.refl.providers.ReflServerStateProvider;\n import net.ess3.nms.refl.providers.ReflSpawnEggProvider;\n import net.ess3.nms.refl.providers.ReflSpawnerBlockProvider;\n-import net.ess3.provider.ContainerProvider;\n+import net.ess3.provider.KnownCommandsProvider;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d22f3cc14eb4d7836b2ae2c2fb89548a68ce13d7"}, "originalPosition": 9}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNzc0OTA2OA==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            import net.ess3.provider.KnownCommandsProvider;\n          \n          \n            \n            import net.ess3.provider.ContainerProvider;\n          \n          \n            \n            import net.ess3.provider.ContainerProvider;\n          \n          \n            \n            import net.ess3.provider.KnownCommandsProvider;", "url": "https://github.com/EssentialsX/Essentials/pull/3675#discussion_r507749068", "createdAt": "2020-10-19T13:33:01Z", "author": {"login": "mdcfe"}, "path": "Essentials/src/com/earth2me/essentials/IEssentials.java", "diffHunk": "@@ -4,6 +4,7 @@\n import com.earth2me.essentials.api.IJails;\n import com.earth2me.essentials.api.IWarps;\n import com.earth2me.essentials.perm.PermissionsHandler;\n+import net.ess3.provider.KnownCommandsProvider;\n import net.ess3.provider.ContainerProvider;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d22f3cc14eb4d7836b2ae2c2fb89548a68ce13d7"}, "originalPosition": 5}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTExNzY2NTM1", "url": "https://github.com/EssentialsX/Essentials/pull/3675#pullrequestreview-511766535", "createdAt": "2020-10-19T13:35:31Z", "commit": {"oid": "6a9f31bd9ba9305d6ea3b632fde7e640fc29b77a"}, "state": "DISMISSED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTExNzY3MzQ5", "url": "https://github.com/EssentialsX/Essentials/pull/3675#pullrequestreview-511767349", "createdAt": "2020-10-19T13:36:20Z", "commit": {"oid": "6a9f31bd9ba9305d6ea3b632fde7e640fc29b77a"}, "state": "DISMISSED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTExNzY3MTk4", "url": "https://github.com/EssentialsX/Essentials/pull/3675#pullrequestreview-511767198", "createdAt": "2020-10-19T13:36:11Z", "commit": {"oid": "6a9f31bd9ba9305d6ea3b632fde7e640fc29b77a"}, "state": "COMMENTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xOVQxMzozNjoxMVrOHkOsBw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xOVQxMzozNjozOFrOHkOtOw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNzc1MTQzMQ==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            \n          \n      \n    \n    \n  \n\nMake Checkstyle happy", "url": "https://github.com/EssentialsX/Essentials/pull/3675#discussion_r507751431", "createdAt": "2020-10-19T13:36:11Z", "author": {"login": "mdcfe"}, "path": "providers/NMSReflectionProvider/src/net/ess3/nms/refl/providers/ReflKnownCommandsProvider.java", "diffHunk": "@@ -0,0 +1,49 @@\n+package net.ess3.nms.refl.providers;\n+\n+import net.ess3.nms.refl.ReflUtil;\n+import net.ess3.provider.KnownCommandsProvider;\n+import org.bukkit.Bukkit;\n+import org.bukkit.Server;\n+import org.bukkit.command.Command;\n+import org.bukkit.command.SimpleCommandMap;\n+\n+import java.lang.reflect.Field;\n+import java.util.HashMap;\n+import java.util.Map;\n+\n+public class ReflKnownCommandsProvider implements KnownCommandsProvider {\n+    private final Map<String, Command> knownCommands;\n+\n+    public ReflKnownCommandsProvider() {\n+        Map<String, Command> knownCommands = new HashMap<>();\n+        try {\n+            @SuppressWarnings(\"unchecked\")\n+            final Class<? extends Server> craftServerClass = (Class<? extends Server>) ReflUtil.getOBCClass(\"CraftServer\");\n+            if (craftServerClass != null) {\n+                final Field commandMapField = ReflUtil.getFieldCached(craftServerClass, \"commandMap\");\n+                if (commandMapField != null) {\n+                    final SimpleCommandMap simpleCommandMap = (SimpleCommandMap) commandMapField.get(Bukkit.getServer());\n+                    final Field knownCommandsField = ReflUtil.getFieldCached(SimpleCommandMap.class, \"knownCommands\");\n+                    if (knownCommandsField != null) {\n+                        knownCommands = (Map<String, Command>) knownCommandsField.get(simpleCommandMap);\n+                    }\n+                }\n+            }\n+        } catch (final Exception exception)  {\n+            exception.printStackTrace();\n+        } finally {\n+            this.knownCommands = knownCommands;\n+        }\n+    }\n+\n+", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "6a9f31bd9ba9305d6ea3b632fde7e640fc29b77a"}, "originalPosition": 39}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNzc1MTczOQ==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                    } catch (final Exception exception)  {\n          \n          \n            \n                    } catch (final Exception exception) {\n          \n      \n    \n    \n  \n\nMake Checkstyle happier", "url": "https://github.com/EssentialsX/Essentials/pull/3675#discussion_r507751739", "createdAt": "2020-10-19T13:36:38Z", "author": {"login": "mdcfe"}, "path": "providers/NMSReflectionProvider/src/net/ess3/nms/refl/providers/ReflKnownCommandsProvider.java", "diffHunk": "@@ -0,0 +1,49 @@\n+package net.ess3.nms.refl.providers;\n+\n+import net.ess3.nms.refl.ReflUtil;\n+import net.ess3.provider.KnownCommandsProvider;\n+import org.bukkit.Bukkit;\n+import org.bukkit.Server;\n+import org.bukkit.command.Command;\n+import org.bukkit.command.SimpleCommandMap;\n+\n+import java.lang.reflect.Field;\n+import java.util.HashMap;\n+import java.util.Map;\n+\n+public class ReflKnownCommandsProvider implements KnownCommandsProvider {\n+    private final Map<String, Command> knownCommands;\n+\n+    public ReflKnownCommandsProvider() {\n+        Map<String, Command> knownCommands = new HashMap<>();\n+        try {\n+            @SuppressWarnings(\"unchecked\")\n+            final Class<? extends Server> craftServerClass = (Class<? extends Server>) ReflUtil.getOBCClass(\"CraftServer\");\n+            if (craftServerClass != null) {\n+                final Field commandMapField = ReflUtil.getFieldCached(craftServerClass, \"commandMap\");\n+                if (commandMapField != null) {\n+                    final SimpleCommandMap simpleCommandMap = (SimpleCommandMap) commandMapField.get(Bukkit.getServer());\n+                    final Field knownCommandsField = ReflUtil.getFieldCached(SimpleCommandMap.class, \"knownCommands\");\n+                    if (knownCommandsField != null) {\n+                        knownCommands = (Map<String, Command>) knownCommandsField.get(simpleCommandMap);\n+                    }\n+                }\n+            }\n+        } catch (final Exception exception)  {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "6a9f31bd9ba9305d6ea3b632fde7e640fc29b77a"}, "originalPosition": 32}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTExNzcwMDU0", "url": "https://github.com/EssentialsX/Essentials/pull/3675#pullrequestreview-511770054", "createdAt": "2020-10-19T13:39:05Z", "commit": {"oid": "4dfd0f1626b7287e05fa0b92947f104c280c2289"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xOVQxMzozOTowNVrOHkO0Uw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xOVQxMzozOTowNVrOHkO0Uw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNzc1MzU1NQ==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                @Override\n          \n          \n            \n            \n          \n          \n            \n                @Override\n          \n      \n    \n    \n  \n\ngithub pls", "url": "https://github.com/EssentialsX/Essentials/pull/3675#discussion_r507753555", "createdAt": "2020-10-19T13:39:05Z", "author": {"login": "mdcfe"}, "path": "providers/NMSReflectionProvider/src/net/ess3/nms/refl/providers/ReflKnownCommandsProvider.java", "diffHunk": "@@ -0,0 +1,47 @@\n+package net.ess3.nms.refl.providers;\n+\n+import net.ess3.nms.refl.ReflUtil;\n+import net.ess3.provider.KnownCommandsProvider;\n+import org.bukkit.Bukkit;\n+import org.bukkit.Server;\n+import org.bukkit.command.Command;\n+import org.bukkit.command.SimpleCommandMap;\n+\n+import java.lang.reflect.Field;\n+import java.util.HashMap;\n+import java.util.Map;\n+\n+public class ReflKnownCommandsProvider implements KnownCommandsProvider {\n+    private final Map<String, Command> knownCommands;\n+\n+    public ReflKnownCommandsProvider() {\n+        Map<String, Command> knownCommands = new HashMap<>();\n+        try {\n+            @SuppressWarnings(\"unchecked\")\n+            final Class<? extends Server> craftServerClass = (Class<? extends Server>) ReflUtil.getOBCClass(\"CraftServer\");\n+            if (craftServerClass != null) {\n+                final Field commandMapField = ReflUtil.getFieldCached(craftServerClass, \"commandMap\");\n+                if (commandMapField != null) {\n+                    final SimpleCommandMap simpleCommandMap = (SimpleCommandMap) commandMapField.get(Bukkit.getServer());\n+                    final Field knownCommandsField = ReflUtil.getFieldCached(SimpleCommandMap.class, \"knownCommands\");\n+                    if (knownCommandsField != null) {\n+                        knownCommands = (Map<String, Command>) knownCommandsField.get(simpleCommandMap);\n+                    }\n+                }\n+            }\n+        } catch (final Exception exception) {\n+            exception.printStackTrace();\n+        } finally {\n+            this.knownCommands = knownCommands;\n+        }\n+    }\n+    @Override", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "4dfd0f1626b7287e05fa0b92947f104c280c2289"}, "originalPosition": 38}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "61e9586086f610fecb733c5b3483ef60b1c19583", "author": {"user": {"login": "Citymonstret", "name": "Alexander S\u00f6derberg"}}, "url": "https://github.com/EssentialsX/Essentials/commit/61e9586086f610fecb733c5b3483ef60b1c19583", "committedDate": "2020-10-19T14:12:38Z", "message": "Make HelpInput use the known command list rather than plugin description files"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a88a98460b7cf85aeda103ce45e8824f57631582", "author": {"user": {"login": "Citymonstret", "name": "Alexander S\u00f6derberg"}}, "url": "https://github.com/EssentialsX/Essentials/commit/a88a98460b7cf85aeda103ce45e8824f57631582", "committedDate": "2020-10-19T14:15:16Z", "message": "Add PaperKnownCommandsProvider for Paper 1.11.2+"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "0ace2f5feba3b11ec0b51682a1a7e6e4f999c4fd", "author": {"user": {"login": "Citymonstret", "name": "Alexander S\u00f6derberg"}}, "url": "https://github.com/EssentialsX/Essentials/commit/0ace2f5feba3b11ec0b51682a1a7e6e4f999c4fd", "committedDate": "2020-10-19T14:15:26Z", "message": "Update the tab completion for `/help` to reflect the previous changes. Thanks to @jmanpenilla for pointing this out."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d9001b303f43fda285015f816394aad09f901c4d", "author": {"user": {"login": "mdcfe", "name": "MD"}}, "url": "https://github.com/EssentialsX/Essentials/commit/d9001b303f43fda285015f816394aad09f901c4d", "committedDate": "2020-10-19T14:15:27Z", "message": "Make Checkstyle happy"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "8a57ecaf456c0c90168a48cdc3805e87ff9b5ffe", "author": {"user": {"login": "mdcfe", "name": "MD"}}, "url": "https://github.com/EssentialsX/Essentials/commit/8a57ecaf456c0c90168a48cdc3805e87ff9b5ffe", "committedDate": "2020-10-19T13:45:45Z", "message": "Fix more merge borks"}, "afterCommit": {"oid": "d9001b303f43fda285015f816394aad09f901c4d", "author": {"user": {"login": "mdcfe", "name": "MD"}}, "url": "https://github.com/EssentialsX/Essentials/commit/d9001b303f43fda285015f816394aad09f901c4d", "committedDate": "2020-10-19T14:15:27Z", "message": "Make Checkstyle happy"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTExODIyMzA0", "url": "https://github.com/EssentialsX/Essentials/pull/3675#pullrequestreview-511822304", "createdAt": "2020-10-19T14:26:44Z", "commit": {"oid": "d9001b303f43fda285015f816394aad09f901c4d"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4618, "cost": 1, "resetAt": "2021-11-01T14:20:25Z"}}}