{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0MzU5MjAyNDY2", "number": 2926, "reviewThreads": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0wNFQxNDozMjo1N1rODVzaMA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0wNFQyMjo1Njo1OFrODV0YNw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjI0MTg4OTc2OnYy", "diffSide": "RIGHT", "path": "EssentialsGeoIP/src/com/earth2me/essentials/geoip/EssentialsGeoIPPlayerListener.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0wNFQxNDozMjo1N1rOFaOGOg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0wNFQyMjo0ODowM1rOFaPXWw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2MzAzODI2Ng==", "bodyText": "No need else branch, because you put \"return\" in line 181.", "url": "https://github.com/EssentialsX/Essentials/pull/2926#discussion_r363038266", "createdAt": "2020-01-04T14:32:57Z", "author": {"login": "montlikadani"}, "path": "EssentialsGeoIP/src/com/earth2me/essentials/geoip/EssentialsGeoIPPlayerListener.java", "diffHunk": "@@ -175,6 +175,13 @@ private void downloadDatabase() {\n                 logger.log(Level.SEVERE, tl(\"geoIpUrlEmpty\"));\n                 return;\n             }\n+            String licenseKey = config.getString(\"database.license-key\", \"\");\n+            if (licenseKey == null || licenseKey.isEmpty()) {\n+                logger.log(Level.SEVERE, tl(\"geoIpLicenseMissing\"));\n+                return;\n+            } else {\n+                url = url.replace(\"{LICENSEKEY}\", licenseKey);\n+            }", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "1968c5a2880184b85eeb454457ef3b46693cde6d"}, "originalPosition": 10}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2MzA1OTAzNQ==", "bodyText": "Fair enough.", "url": "https://github.com/EssentialsX/Essentials/pull/2926#discussion_r363059035", "createdAt": "2020-01-04T22:48:03Z", "author": {"login": "pop4959"}, "path": "EssentialsGeoIP/src/com/earth2me/essentials/geoip/EssentialsGeoIPPlayerListener.java", "diffHunk": "@@ -175,6 +175,13 @@ private void downloadDatabase() {\n                 logger.log(Level.SEVERE, tl(\"geoIpUrlEmpty\"));\n                 return;\n             }\n+            String licenseKey = config.getString(\"database.license-key\", \"\");\n+            if (licenseKey == null || licenseKey.isEmpty()) {\n+                logger.log(Level.SEVERE, tl(\"geoIpLicenseMissing\"));\n+                return;\n+            } else {\n+                url = url.replace(\"{LICENSEKEY}\", licenseKey);\n+            }", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2MzAzODI2Ng=="}, "originalCommit": {"oid": "1968c5a2880184b85eeb454457ef3b46693cde6d"}, "originalPosition": 10}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjI0MjA0Nzk5OnYy", "diffSide": "RIGHT", "path": "EssentialsGeoIP/src/com/earth2me/essentials/geoip/EssentialsGeoIPPlayerListener.java", "isResolved": true, "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0wNFQyMjo1NToxOVrOFaPYKg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0wNVQxNzowNDozNVrOFaSMHQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2MzA1OTI0Mg==", "bodyText": "This feels clowny. endsWith makes it better but obviously is a generally shitty solution. Could we possibly pick up the GZIP magic numbers and make decisions off of that?", "url": "https://github.com/EssentialsX/Essentials/pull/2926#discussion_r363059242", "createdAt": "2020-01-04T22:55:19Z", "author": {"login": "Ichbinjoe"}, "path": "EssentialsGeoIP/src/com/earth2me/essentials/geoip/EssentialsGeoIPPlayerListener.java", "diffHunk": "@@ -183,9 +189,9 @@ private void downloadDatabase() {\n             InputStream input = conn.getInputStream();\n             OutputStream output = new FileOutputStream(databaseFile);\n             byte[] buffer = new byte[2048];\n-            if (url.endsWith(\".gz\")) {\n+            if (url.contains(\"gz\")) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "6adfee773528dbf02f657228b9f84ffa40e99053"}, "originalPosition": 18}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2MzA2MDQ4NQ==", "bodyText": "We could but I don't know there's much of a point in doing so. I just changed it for now because the format of the URL changed. It used to be a direct link to a file with the .tar.gz suffix, but now it is a query parameter without the preceding . which may appear anywhere in the link. Feel free to suggest any code you think might work more cleanly.", "url": "https://github.com/EssentialsX/Essentials/pull/2926#discussion_r363060485", "createdAt": "2020-01-04T23:32:32Z", "author": {"login": "pop4959"}, "path": "EssentialsGeoIP/src/com/earth2me/essentials/geoip/EssentialsGeoIPPlayerListener.java", "diffHunk": "@@ -183,9 +189,9 @@ private void downloadDatabase() {\n             InputStream input = conn.getInputStream();\n             OutputStream output = new FileOutputStream(databaseFile);\n             byte[] buffer = new byte[2048];\n-            if (url.endsWith(\".gz\")) {\n+            if (url.contains(\"gz\")) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2MzA1OTI0Mg=="}, "originalCommit": {"oid": "6adfee773528dbf02f657228b9f84ffa40e99053"}, "originalPosition": 18}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2MzEwNTMwOQ==", "bodyText": "fuck it i guess? its a lot more code.", "url": "https://github.com/EssentialsX/Essentials/pull/2926#discussion_r363105309", "createdAt": "2020-01-05T17:04:35Z", "author": {"login": "Ichbinjoe"}, "path": "EssentialsGeoIP/src/com/earth2me/essentials/geoip/EssentialsGeoIPPlayerListener.java", "diffHunk": "@@ -183,9 +189,9 @@ private void downloadDatabase() {\n             InputStream input = conn.getInputStream();\n             OutputStream output = new FileOutputStream(databaseFile);\n             byte[] buffer = new byte[2048];\n-            if (url.endsWith(\".gz\")) {\n+            if (url.contains(\"gz\")) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2MzA1OTI0Mg=="}, "originalCommit": {"oid": "6adfee773528dbf02f657228b9f84ffa40e99053"}, "originalPosition": 18}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjI0MjA0ODM1OnYy", "diffSide": "RIGHT", "path": "EssentialsGeoIP/src/com/earth2me/essentials/geoip/EssentialsGeoIPPlayerListener.java", "isResolved": true, "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0wNFQyMjo1NjoyN1rOFaPYVQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0wNVQxNzowNToxOVrOFaSMTA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2MzA1OTI4NQ==", "bodyText": "Given the default when will licenceKey ever be null?\nMaybe instead we should remove the default and check for null.", "url": "https://github.com/EssentialsX/Essentials/pull/2926#discussion_r363059285", "createdAt": "2020-01-04T22:56:27Z", "author": {"login": "Ichbinjoe"}, "path": "EssentialsGeoIP/src/com/earth2me/essentials/geoip/EssentialsGeoIPPlayerListener.java", "diffHunk": "@@ -175,6 +175,12 @@ private void downloadDatabase() {\n                 logger.log(Level.SEVERE, tl(\"geoIpUrlEmpty\"));\n                 return;\n             }\n+            String licenseKey = config.getString(\"database.license-key\", \"\");\n+            if (licenseKey == null || licenseKey.isEmpty()) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "50492f2aebfc19da9af9420a580274f55e28c590"}, "originalPosition": 5}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2MzA2MDU5NA==", "bodyText": "Not sure. A few lines up the same code is used to check the URL though, so I just went based off of that. I figure you can never be too careful.", "url": "https://github.com/EssentialsX/Essentials/pull/2926#discussion_r363060594", "createdAt": "2020-01-04T23:36:14Z", "author": {"login": "pop4959"}, "path": "EssentialsGeoIP/src/com/earth2me/essentials/geoip/EssentialsGeoIPPlayerListener.java", "diffHunk": "@@ -175,6 +175,12 @@ private void downloadDatabase() {\n                 logger.log(Level.SEVERE, tl(\"geoIpUrlEmpty\"));\n                 return;\n             }\n+            String licenseKey = config.getString(\"database.license-key\", \"\");\n+            if (licenseKey == null || licenseKey.isEmpty()) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2MzA1OTI4NQ=="}, "originalCommit": {"oid": "50492f2aebfc19da9af9420a580274f55e28c590"}, "originalPosition": 5}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2MzEwNTM1Ng==", "bodyText": "Alright let me be more straight forward.\nGiven that you defined a default, licenseKey will never be null.", "url": "https://github.com/EssentialsX/Essentials/pull/2926#discussion_r363105356", "createdAt": "2020-01-05T17:05:19Z", "author": {"login": "Ichbinjoe"}, "path": "EssentialsGeoIP/src/com/earth2me/essentials/geoip/EssentialsGeoIPPlayerListener.java", "diffHunk": "@@ -175,6 +175,12 @@ private void downloadDatabase() {\n                 logger.log(Level.SEVERE, tl(\"geoIpUrlEmpty\"));\n                 return;\n             }\n+            String licenseKey = config.getString(\"database.license-key\", \"\");\n+            if (licenseKey == null || licenseKey.isEmpty()) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2MzA1OTI4NQ=="}, "originalCommit": {"oid": "50492f2aebfc19da9af9420a580274f55e28c590"}, "originalPosition": 5}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjI0MjA0ODU1OnYy", "diffSide": "RIGHT", "path": "EssentialsGeoIP/src/com/earth2me/essentials/geoip/EssentialsGeoIPPlayerListener.java", "isResolved": true, "comments": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0wNFQyMjo1Njo1OFrOFaPYbw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0wNVQwMDowMDoxOVrOFaPgfQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2MzA1OTMxMQ==", "bodyText": "Consider replace all maybe? idk.", "url": "https://github.com/EssentialsX/Essentials/pull/2926#discussion_r363059311", "createdAt": "2020-01-04T22:56:58Z", "author": {"login": "Ichbinjoe"}, "path": "EssentialsGeoIP/src/com/earth2me/essentials/geoip/EssentialsGeoIPPlayerListener.java", "diffHunk": "@@ -175,6 +175,12 @@ private void downloadDatabase() {\n                 logger.log(Level.SEVERE, tl(\"geoIpUrlEmpty\"));\n                 return;\n             }\n+            String licenseKey = config.getString(\"database.license-key\", \"\");\n+            if (licenseKey == null || licenseKey.isEmpty()) {\n+                logger.log(Level.SEVERE, tl(\"geoIpLicenseMissing\"));\n+                return;\n+            }\n+            url = url.replace(\"{LICENSEKEY}\", licenseKey);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "50492f2aebfc19da9af9420a580274f55e28c590"}, "originalPosition": 9}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2MzA2MDY0NQ==", "bodyText": "The license key only appears in the URL once. I think it would be very strange if it appeared more than that.", "url": "https://github.com/EssentialsX/Essentials/pull/2926#discussion_r363060645", "createdAt": "2020-01-04T23:37:40Z", "author": {"login": "pop4959"}, "path": "EssentialsGeoIP/src/com/earth2me/essentials/geoip/EssentialsGeoIPPlayerListener.java", "diffHunk": "@@ -175,6 +175,12 @@ private void downloadDatabase() {\n                 logger.log(Level.SEVERE, tl(\"geoIpUrlEmpty\"));\n                 return;\n             }\n+            String licenseKey = config.getString(\"database.license-key\", \"\");\n+            if (licenseKey == null || licenseKey.isEmpty()) {\n+                logger.log(Level.SEVERE, tl(\"geoIpLicenseMissing\"));\n+                return;\n+            }\n+            url = url.replace(\"{LICENSEKEY}\", licenseKey);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2MzA1OTMxMQ=="}, "originalCommit": {"oid": "50492f2aebfc19da9af9420a580274f55e28c590"}, "originalPosition": 9}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2MzA2MDk3MA==", "bodyText": "You could probably put the license key at the end of the URL if that was easier.  Then just append the value from the config.", "url": "https://github.com/EssentialsX/Essentials/pull/2926#discussion_r363060970", "createdAt": "2020-01-04T23:47:51Z", "author": {"login": "Bobcat00"}, "path": "EssentialsGeoIP/src/com/earth2me/essentials/geoip/EssentialsGeoIPPlayerListener.java", "diffHunk": "@@ -175,6 +175,12 @@ private void downloadDatabase() {\n                 logger.log(Level.SEVERE, tl(\"geoIpUrlEmpty\"));\n                 return;\n             }\n+            String licenseKey = config.getString(\"database.license-key\", \"\");\n+            if (licenseKey == null || licenseKey.isEmpty()) {\n+                logger.log(Level.SEVERE, tl(\"geoIpLicenseMissing\"));\n+                return;\n+            }\n+            url = url.replace(\"{LICENSEKEY}\", licenseKey);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2MzA1OTMxMQ=="}, "originalCommit": {"oid": "50492f2aebfc19da9af9420a580274f55e28c590"}, "originalPosition": 9}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2MzA2MTM3Mw==", "bodyText": "That is ironically the exact reason why I was having troubles before. I had the suffix query parameter in the middle rather than at the end, which caused url.endsWith(\".gz\") to break down. I think it's better to keep it a placeholder (in the same fashion as the base EssentialsX module does in its config). There technically isn't any requirement for the license key to be at the end (or even in the URL at all), so I don't think it would be wise to impose that on users (especially if they use a custom download link).", "url": "https://github.com/EssentialsX/Essentials/pull/2926#discussion_r363061373", "createdAt": "2020-01-05T00:00:19Z", "author": {"login": "pop4959"}, "path": "EssentialsGeoIP/src/com/earth2me/essentials/geoip/EssentialsGeoIPPlayerListener.java", "diffHunk": "@@ -175,6 +175,12 @@ private void downloadDatabase() {\n                 logger.log(Level.SEVERE, tl(\"geoIpUrlEmpty\"));\n                 return;\n             }\n+            String licenseKey = config.getString(\"database.license-key\", \"\");\n+            if (licenseKey == null || licenseKey.isEmpty()) {\n+                logger.log(Level.SEVERE, tl(\"geoIpLicenseMissing\"));\n+                return;\n+            }\n+            url = url.replace(\"{LICENSEKEY}\", licenseKey);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2MzA1OTMxMQ=="}, "originalCommit": {"oid": "50492f2aebfc19da9af9420a580274f55e28c590"}, "originalPosition": 9}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4732, "cost": 1, "resetAt": "2021-11-12T18:49:56Z"}}}