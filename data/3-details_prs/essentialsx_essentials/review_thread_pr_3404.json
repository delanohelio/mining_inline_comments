{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDM4NDAzMDIy", "number": 3404, "reviewThreads": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yOVQyMTowMDozNVrOEJ1D7g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wMVQyMToxMDo0NVrOEKqY_Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjc4NzQxOTk4OnYy", "diffSide": "RIGHT", "path": "providers/PaperProvider/src/net/ess3/provider/providers/PaperPlayerRecipeBookClickEventProvider.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yOVQyMTowMDozNVrOGqiClA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yOVQyMTowMDozNVrOGqiClA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NzI1MTA5Mg==", "bodyText": "This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters. Learn more about bidirectional Unicode characters\n\n\n  \n\n\n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            public class PaperPlayerRecipeBookClickEventProvider extends EventProvider {\n          \n          \n            \n            public class PaperRecipeBookListener extends ProviderListener {", "url": "https://github.com/EssentialsX/Essentials/pull/3404#discussion_r447251092", "createdAt": "2020-06-29T21:00:35Z", "author": {"login": "mdcfe"}, "path": "providers/PaperProvider/src/net/ess3/provider/providers/PaperPlayerRecipeBookClickEventProvider.java", "diffHunk": "@@ -0,0 +1,24 @@\n+package net.ess3.provider.providers;\n+\n+import com.destroystokyo.paper.event.player.PlayerRecipeBookClickEvent;\n+import net.ess3.provider.EventProvider;\n+import org.bukkit.event.Event;\n+import org.bukkit.event.EventHandler;\n+\n+import java.util.function.Consumer;\n+\n+public class PaperPlayerRecipeBookClickEventProvider extends EventProvider {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ce615cb6e03b3b7d9b4b8a76df8e3a7e4f232806"}, "originalPosition": 10}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjc5NjE0ODM1OnYy", "diffSide": "RIGHT", "path": "Essentials/src/com/earth2me/essentials/Essentials.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wMVQyMTowNzozNFrOGr1Y4A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wMVQyMTowNzozNFrOGr1Y4A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0ODYxNjY3Mg==", "bodyText": "This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters. Learn more about bidirectional Unicode characters\n\n\n  \n\n\n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                                            ((Cancellable)event).setCancelled(true);\n          \n          \n            \n                                            ((Cancellable) event).setCancelled(true);", "url": "https://github.com/EssentialsX/Essentials/pull/3404#discussion_r448616672", "createdAt": "2020-07-01T21:07:34Z", "author": {"login": "mdcfe"}, "path": "Essentials/src/com/earth2me/essentials/Essentials.java", "diffHunk": "@@ -269,6 +273,18 @@ public void onEnable() {\n                     serverStateProvider = new ReflServerStateProvider(getLogger());\n                 }\n \n+                //Event Providers\n+                if (PaperLib.isPaper()) {\n+                    try {\n+                        Class.forName(\"com.destroystokyo.paper.event.player.PlayerRecipeBookClickEvent\");\n+                        recipeBookEventProvider = new PaperRecipeBookListener(event -> {\n+                            if (this.getUser(((PlayerEvent) event).getPlayer()).isRecipeSee()) {\n+                                ((Cancellable)event).setCancelled(true);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "02db2867c988abe7622796a88e903ef5a38d104c"}, "originalPosition": 57}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjc5NjE1MjUzOnYy", "diffSide": "RIGHT", "path": "Essentials/src/com/earth2me/essentials/commands/Commandrecipe.java", "isResolved": true, "comments": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wMVQyMTowOToxMlrOGr1bbQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wMVQyMToxNTozNlrOGr1mRQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0ODYxNzMyNQ==", "bodyText": "This breaks the command on 1.11 and lower. Maybe add a 1.12 check here?", "url": "https://github.com/EssentialsX/Essentials/pull/3404#discussion_r448617325", "createdAt": "2020-07-01T21:09:12Z", "author": {"login": "mdcfe"}, "path": "Essentials/src/com/earth2me/essentials/commands/Commandrecipe.java", "diffHunk": "@@ -26,18 +25,16 @@\n     public Commandrecipe() {\n         super(\"recipe\");\n     }\n-    \n-    private void disableCommandForVersion1_12() throws Exception {\n-        VersionUtil.BukkitVersion version = VersionUtil.getServerBukkitVersion();\n-        if (version.isHigherThanOrEqualTo(VersionUtil.v1_12_0_R01)\n-            && !ess.getSettings().isForceEnableRecipe()) {\n-            throw new Exception(\"Please use the recipe book in your inventory.\");\n-        }\n-    }\n \n     @Override\n     public void run(final Server server, final CommandSource sender, final String commandLabel, final String[] args) throws Exception {\n-        disableCommandForVersion1_12();\n+        try {\n+            Class.forName(\"com.destroystokyo.paper.event.player.PlayerRecipeBookClickEvent\");\n+        } catch (ClassNotFoundException e) {\n+            sender.sendMessage(tl(\"unsupportedFeature\"));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "02db2867c988abe7622796a88e903ef5a38d104c"}, "originalPosition": 27}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0ODYxOTAwMA==", "bodyText": "Class::forName doesn't work? I'll look into this.", "url": "https://github.com/EssentialsX/Essentials/pull/3404#discussion_r448619000", "createdAt": "2020-07-01T21:13:02Z", "author": {"login": "pop4959"}, "path": "Essentials/src/com/earth2me/essentials/commands/Commandrecipe.java", "diffHunk": "@@ -26,18 +25,16 @@\n     public Commandrecipe() {\n         super(\"recipe\");\n     }\n-    \n-    private void disableCommandForVersion1_12() throws Exception {\n-        VersionUtil.BukkitVersion version = VersionUtil.getServerBukkitVersion();\n-        if (version.isHigherThanOrEqualTo(VersionUtil.v1_12_0_R01)\n-            && !ess.getSettings().isForceEnableRecipe()) {\n-            throw new Exception(\"Please use the recipe book in your inventory.\");\n-        }\n-    }\n \n     @Override\n     public void run(final Server server, final CommandSource sender, final String commandLabel, final String[] args) throws Exception {\n-        disableCommandForVersion1_12();\n+        try {\n+            Class.forName(\"com.destroystokyo.paper.event.player.PlayerRecipeBookClickEvent\");\n+        } catch (ClassNotFoundException e) {\n+            sender.sendMessage(tl(\"unsupportedFeature\"));", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0ODYxNzMyNQ=="}, "originalCommit": {"oid": "02db2867c988abe7622796a88e903ef5a38d104c"}, "originalPosition": 27}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0ODYxOTYyNQ==", "bodyText": "@pop4959 No, this command still works (as of the latest build) on 1.11.x and below, but by removing the 1.12 version check entirely we drop support for this command on old versions of MC. These older versions are the ones that don't have the recipe book, and so they're the versions where this command is the most useful.", "url": "https://github.com/EssentialsX/Essentials/pull/3404#discussion_r448619625", "createdAt": "2020-07-01T21:14:30Z", "author": {"login": "mdcfe"}, "path": "Essentials/src/com/earth2me/essentials/commands/Commandrecipe.java", "diffHunk": "@@ -26,18 +25,16 @@\n     public Commandrecipe() {\n         super(\"recipe\");\n     }\n-    \n-    private void disableCommandForVersion1_12() throws Exception {\n-        VersionUtil.BukkitVersion version = VersionUtil.getServerBukkitVersion();\n-        if (version.isHigherThanOrEqualTo(VersionUtil.v1_12_0_R01)\n-            && !ess.getSettings().isForceEnableRecipe()) {\n-            throw new Exception(\"Please use the recipe book in your inventory.\");\n-        }\n-    }\n \n     @Override\n     public void run(final Server server, final CommandSource sender, final String commandLabel, final String[] args) throws Exception {\n-        disableCommandForVersion1_12();\n+        try {\n+            Class.forName(\"com.destroystokyo.paper.event.player.PlayerRecipeBookClickEvent\");\n+        } catch (ClassNotFoundException e) {\n+            sender.sendMessage(tl(\"unsupportedFeature\"));", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0ODYxNzMyNQ=="}, "originalCommit": {"oid": "02db2867c988abe7622796a88e903ef5a38d104c"}, "originalPosition": 27}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0ODYyMDEwMQ==", "bodyText": "Ah right, completely overlooked that. I'll re-add this check ASAP.", "url": "https://github.com/EssentialsX/Essentials/pull/3404#discussion_r448620101", "createdAt": "2020-07-01T21:15:36Z", "author": {"login": "pop4959"}, "path": "Essentials/src/com/earth2me/essentials/commands/Commandrecipe.java", "diffHunk": "@@ -26,18 +25,16 @@\n     public Commandrecipe() {\n         super(\"recipe\");\n     }\n-    \n-    private void disableCommandForVersion1_12() throws Exception {\n-        VersionUtil.BukkitVersion version = VersionUtil.getServerBukkitVersion();\n-        if (version.isHigherThanOrEqualTo(VersionUtil.v1_12_0_R01)\n-            && !ess.getSettings().isForceEnableRecipe()) {\n-            throw new Exception(\"Please use the recipe book in your inventory.\");\n-        }\n-    }\n \n     @Override\n     public void run(final Server server, final CommandSource sender, final String commandLabel, final String[] args) throws Exception {\n-        disableCommandForVersion1_12();\n+        try {\n+            Class.forName(\"com.destroystokyo.paper.event.player.PlayerRecipeBookClickEvent\");\n+        } catch (ClassNotFoundException e) {\n+            sender.sendMessage(tl(\"unsupportedFeature\"));", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0ODYxNzMyNQ=="}, "originalCommit": {"oid": "02db2867c988abe7622796a88e903ef5a38d104c"}, "originalPosition": 27}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjc5NjE1NzQxOnYy", "diffSide": "LEFT", "path": "Essentials/src/com/earth2me/essentials/commands/Commandrecipe.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wMVQyMToxMDo0NVrOGr1eNA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wMVQyMToxMzo1NVrOGr1jXA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0ODYxODAzNg==", "bodyText": "If we're removing this check entirely, remove Settings#isForceEnableRecipe too (it's an undocumented config option I used to confirm whether this bug was fixed in newer versions of Spigot).", "url": "https://github.com/EssentialsX/Essentials/pull/3404#discussion_r448618036", "createdAt": "2020-07-01T21:10:45Z", "author": {"login": "mdcfe"}, "path": "Essentials/src/com/earth2me/essentials/commands/Commandrecipe.java", "diffHunk": "@@ -26,18 +25,16 @@\n     public Commandrecipe() {\n         super(\"recipe\");\n     }\n-    \n-    private void disableCommandForVersion1_12() throws Exception {\n-        VersionUtil.BukkitVersion version = VersionUtil.getServerBukkitVersion();\n-        if (version.isHigherThanOrEqualTo(VersionUtil.v1_12_0_R01)\n-            && !ess.getSettings().isForceEnableRecipe()) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "02db2867c988abe7622796a88e903ef5a38d104c"}, "originalPosition": 16}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0ODYxOTM1Ng==", "bodyText": "Will do", "url": "https://github.com/EssentialsX/Essentials/pull/3404#discussion_r448619356", "createdAt": "2020-07-01T21:13:55Z", "author": {"login": "pop4959"}, "path": "Essentials/src/com/earth2me/essentials/commands/Commandrecipe.java", "diffHunk": "@@ -26,18 +25,16 @@\n     public Commandrecipe() {\n         super(\"recipe\");\n     }\n-    \n-    private void disableCommandForVersion1_12() throws Exception {\n-        VersionUtil.BukkitVersion version = VersionUtil.getServerBukkitVersion();\n-        if (version.isHigherThanOrEqualTo(VersionUtil.v1_12_0_R01)\n-            && !ess.getSettings().isForceEnableRecipe()) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0ODYxODAzNg=="}, "originalCommit": {"oid": "02db2867c988abe7622796a88e903ef5a38d104c"}, "originalPosition": 16}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4562, "cost": 1, "resetAt": "2021-11-12T18:49:56Z"}}}