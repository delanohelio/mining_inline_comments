{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDE1NTkzMDYz", "number": 3248, "title": "Add serialization support to kits", "bodyText": "This PR makes use of Paper's item serialization to serialize items into base64 allowing for all items to be properly stored without needing to manual write in special cases for every complex item. There is a config option to disable using this new serialization and use the legacy ItemDB serializer since the new serializer removes the ability to manually edit/read kits.\nDefaults to not enabled\nNote: The new serializer places an @ sign in front of items serialized by the new format in order to quickly determine what is serialized by the new serializer and also to retain backward compatibility with the old serializer.\nAtt #3114\nAtt #2867\nAtt #1694\nAtt #31\nAtt #1283", "createdAt": "2020-05-09T15:48:13Z", "url": "https://github.com/EssentialsX/Essentials/pull/3248", "merged": true, "mergeCommit": {"oid": "64eb39a417ae37eda91cce8451f663f9054fe7b8"}, "closed": true, "closedAt": "2021-06-26T20:03:28Z", "author": {"login": "JRoy"}, "timelineItems": {"totalCount": 47, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcfdDMOAH2gAyNDE1NTkzMDYzOmY0NzFlNjFlMjQxMGUyNjliYTA4ZWRmODg0ZGZlMjMzYTVkNjJjYzk=", "endCursor": "Y3Vyc29yOnYyOpPPAAABeknpgrAH2gAyNDE1NTkzMDYzOjVjZTkzNTY4OTExNTA5ZDZlYmRiMTAxZmRiMWQ2Yjc2YWZmOWU4YTE=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "f471e61e2410e269ba08edf884dfe233a5d62cc9", "author": {"user": {"login": "JRoy", "name": "Josh Roy"}}, "url": "https://github.com/EssentialsX/Essentials/commit/f471e61e2410e269ba08edf884dfe233a5d62cc9", "committedDate": "2020-05-09T02:28:28Z", "message": "Fix kits forever"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "42cb735ec2be8f92c0787e9875b4536e50dddce7", "author": {"user": {"login": "JRoy", "name": "Josh Roy"}}, "url": "https://github.com/EssentialsX/Essentials/commit/42cb735ec2be8f92c0787e9875b4536e50dddce7", "committedDate": "2020-05-09T15:16:12Z", "message": "Add config option"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e53deaa2091db2808db7e240b17248af8428e794", "author": {"user": {"login": "JRoy", "name": "Josh Roy"}}, "url": "https://github.com/EssentialsX/Essentials/commit/e53deaa2091db2808db7e240b17248af8428e794", "committedDate": "2020-05-09T16:48:36Z", "message": "Default to false"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDEzMTI5MzAx", "url": "https://github.com/EssentialsX/Essentials/pull/3248#pullrequestreview-413129301", "createdAt": "2020-05-17T05:51:39Z", "commit": {"oid": "e53deaa2091db2808db7e240b17248af8428e794"}, "state": "DISMISSED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xN1QwNTo1MTo0MFrOGWebzw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xN1QwNTo1MTo0MFrOGWebzw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNjIyMDQ5NQ==", "bodyText": "Should specify that old kits will still work if enabled (for the time being)", "url": "https://github.com/EssentialsX/Essentials/pull/3248#discussion_r426220495", "createdAt": "2020-05-17T05:51:40Z", "author": {"login": "ice-fly"}, "path": "Essentials/src/config.yml", "diffHunk": "@@ -319,9 +319,17 @@ skip-used-one-time-kits-from-kit-list: false\n # Determines the functionality of the /createkit command.\n # If this is true, /createkit will give the user a link with the kit code.\n # If this is false, /createkit will add the kit to the kits.yml config file directly.\n-#\n+# Default is false.\n pastebin-createkit: false\n \n+# Determines if /createkit will generate kits with item serialization.\n+# By using serialization, there is added support for for complex items such as potions and shulker boxes.\n+# However, serialization removes the ability to edit kits by hand and kits *may* break in future versions.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e53deaa2091db2808db7e240b17248af8428e794"}, "originalPosition": 10}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "240f4711b9feee79e4b21e8e167b2586a82cb10b", "author": {"user": {"login": "JRoy", "name": "Josh Roy"}}, "url": "https://github.com/EssentialsX/Essentials/commit/240f4711b9feee79e4b21e8e167b2586a82cb10b", "committedDate": "2020-05-17T16:30:44Z", "message": "Clarify further"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b952b3fbe70dc68981e6b48d61e519c678e79efe", "author": {"user": {"login": "JRoy", "name": "Josh Roy"}}, "url": "https://github.com/EssentialsX/Essentials/commit/b952b3fbe70dc68981e6b48d61e519c678e79efe", "committedDate": "2020-07-01T14:33:37Z", "message": "Fix kits forever"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f295bc302d7fc290ebe9593474e3cfd959520c6c", "author": {"user": {"login": "JRoy", "name": "Josh Roy"}}, "url": "https://github.com/EssentialsX/Essentials/commit/f295bc302d7fc290ebe9593474e3cfd959520c6c", "committedDate": "2020-07-01T14:33:44Z", "message": "Add config option"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "820bdbfdb44021ff06bc51c0e6b58f3aab81ca84", "author": {"user": {"login": "JRoy", "name": "Josh Roy"}}, "url": "https://github.com/EssentialsX/Essentials/commit/820bdbfdb44021ff06bc51c0e6b58f3aab81ca84", "committedDate": "2020-07-01T14:33:44Z", "message": "Default to false"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c396893b8b8696c902bc9fc9fc978dbaf2636712", "author": {"user": {"login": "JRoy", "name": "Josh Roy"}}, "url": "https://github.com/EssentialsX/Essentials/commit/c396893b8b8696c902bc9fc9fc978dbaf2636712", "committedDate": "2020-07-01T14:33:45Z", "message": "Clarify further"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "9e553db82a941d83d7a118138c393ed795b564b9", "author": {"user": {"login": "JRoy", "name": "Josh Roy"}}, "url": "https://github.com/EssentialsX/Essentials/commit/9e553db82a941d83d7a118138c393ed795b564b9", "committedDate": "2020-07-01T14:42:21Z", "message": "Merge remote-tracking branch 'origin/feature/usable-kits' into feature/usable-kits"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "1426a89a6793652b5992ebebb58e1decb0e4151e", "author": {"user": {"login": "JRoy", "name": "Josh Roy"}}, "url": "https://github.com/EssentialsX/Essentials/commit/1426a89a6793652b5992ebebb58e1decb0e4151e", "committedDate": "2020-07-01T14:34:04Z", "message": "Merge remote-tracking branch 'origin/feature/usable-kits' into feature/usable-kits"}, "afterCommit": {"oid": "9e553db82a941d83d7a118138c393ed795b564b9", "author": {"user": {"login": "JRoy", "name": "Josh Roy"}}, "url": "https://github.com/EssentialsX/Essentials/commit/9e553db82a941d83d7a118138c393ed795b564b9", "committedDate": "2020-07-01T14:42:21Z", "message": "Merge remote-tracking branch 'origin/feature/usable-kits' into feature/usable-kits"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f5c58e797d4827a2a4890b6a563cdf609e78c784", "author": {"user": {"login": "JRoy", "name": "Josh Roy"}}, "url": "https://github.com/EssentialsX/Essentials/commit/f5c58e797d4827a2a4890b6a563cdf609e78c784", "committedDate": "2020-07-01T16:30:50Z", "message": "Use paper serialization and say yolo to spigot"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "36be08759d7ed4929a3e4f14fa898ad88000aca5", "author": {"user": {"login": "JRoy", "name": "Josh Roy"}}, "url": "https://github.com/EssentialsX/Essentials/commit/36be08759d7ed4929a3e4f14fa898ad88000aca5", "committedDate": "2020-07-01T16:32:19Z", "message": "Fix default value"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b7a96bbf254d7fc2388bba07c3d86471a112cb71", "author": {"user": {"login": "JRoy", "name": "Josh Roy"}}, "url": "https://github.com/EssentialsX/Essentials/commit/b7a96bbf254d7fc2388bba07c3d86471a112cb71", "committedDate": "2020-07-01T16:33:11Z", "message": "FURTHER clarify config option"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b12ff883cf3c9eb805b696d2db6fb2442fe7df20", "author": {"user": {"login": "JRoy", "name": "Josh Roy"}}, "url": "https://github.com/EssentialsX/Essentials/commit/b12ff883cf3c9eb805b696d2db6fb2442fe7df20", "committedDate": "2020-07-02T21:59:59Z", "message": "Merge branch '2.x' into feature/usable-kits"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDYwNzY5NjMz", "url": "https://github.com/EssentialsX/Essentials/pull/3248#pullrequestreview-460769633", "createdAt": "2020-08-04T12:35:42Z", "commit": {"oid": "b12ff883cf3c9eb805b696d2db6fb2442fe7df20"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0wNFQxMjozNTo0MlrOG7eYlg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0wNFQxNDowMzoyM1rOG7h2WQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NTAxNjk4Mg==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            # Determines if /createkit will generate kits with item serialization.\n          \n          \n            \n            # By using serialization, there is added support for for complex items such as potions and shulker boxes.\n          \n          \n            \n            # **Warning**: This option only works on 1.15+ Paper servers and will bypass any custom serializers.\n          \n          \n            \n            # The old kit style and commands will still work and function as expected and are not planned to be removed.\n          \n          \n            \n            # If this is true, /createkit will use item serialization otherwise, it will use the regular item alias system.\n          \n          \n            \n            # Default is false.\n          \n          \n            \n            # Determines if /createkit will generate kits using NBT item serialization.\n          \n          \n            \n            # If this is true, /createkit will store items as NBT; otherwise, it will use Essentials' human-readable item format.\n          \n          \n            \n            # By using NBT serialization, /createkit can store items with complex metadata such as shulker boxes and weapons with custom attributes.\n          \n          \n            \n            # WARNING: This option only works on 1.15+ Paper servers, and it will bypass any custom serializers from other plugins such as Magic.\n          \n          \n            \n            # This option only affects /createkit - you can still create kits by hand in `kits.yml` using Essentials' human-readable item format.\n          \n          \n            \n            # Default is false.", "url": "https://github.com/EssentialsX/Essentials/pull/3248#discussion_r465016982", "createdAt": "2020-08-04T12:35:42Z", "author": {"login": "mdcfe"}, "path": "Essentials/src/config.yml", "diffHunk": "@@ -324,9 +324,17 @@ skip-used-one-time-kits-from-kit-list: false\n # Determines the functionality of the /createkit command.\n # If this is true, /createkit will give the user a link with the kit code.\n # If this is false, /createkit will add the kit to the kits.yml config file directly.\n-#\n+# Default is false.\n pastebin-createkit: false\n \n+# Determines if /createkit will generate kits with item serialization.\n+# By using serialization, there is added support for for complex items such as potions and shulker boxes.\n+# **Warning**: This option only works on 1.15+ Paper servers and will bypass any custom serializers.\n+# The old kit style and commands will still work and function as expected and are not planned to be removed.\n+# If this is true, /createkit will use item serialization otherwise, it will use the regular item alias system.\n+# Default is false.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b12ff883cf3c9eb805b696d2db6fb2442fe7df20"}, "originalPosition": 13}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NTAxODE2MA==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            createKitUnsupported=\\u00a74Paper item serialization is enabled on a non-paper 1.15.2+ server! Falling back to regular item serializer.\n          \n          \n            \n            createKitUnsupported=\\u00a74NBT item serialization has been enabled, but this server is not running Paper 1.15.2+. Falling back to standard item serialization.", "url": "https://github.com/EssentialsX/Essentials/pull/3248#discussion_r465018160", "createdAt": "2020-08-04T12:37:54Z", "author": {"login": "mdcfe"}, "path": "Essentials/src/messages.properties", "diffHunk": "@@ -124,6 +124,7 @@ createkitCommandUsage=/<command> <kitname> <delay>\n createKitFailed=\\u00a74Error occurred whilst creating kit {0}.\n createKitSeparator=\\u00a7m-----------------------\n createKitSuccess=\\u00a76Created Kit: \\u00a7f{0}\\n\\u00a76Delay: \\u00a7f{1}\\n\\u00a76Link: \\u00a7f{2}\\n\\u00a76Copy contents in the link above into your kits.yml.\n+createKitUnsupported=\\u00a74Paper item serialization is enabled on a non-paper 1.15.2+ server! Falling back to regular item serializer.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b12ff883cf3c9eb805b696d2db6fb2442fe7df20"}, "originalPosition": 4}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NTA3Mzc1Mw==", "bodyText": "Should be translated", "url": "https://github.com/EssentialsX/Essentials/pull/3248#discussion_r465073753", "createdAt": "2020-08-04T14:03:23Z", "author": {"login": "mdcfe"}, "path": "Essentials/src/com/earth2me/essentials/Kit.java", "diffHunk": "@@ -178,6 +182,15 @@ public boolean expandItems(final User user, final List<String> items) throws Exc\n                     continue;\n                 }\n \n+                if (kitItem.startsWith(\"@\")) {\n+                    if (ess.getSerializationProvider() == null) {\n+                        ess.getLogger().log(Level.WARNING, \"Cannot give kit item in kit \\\"\" + kitName + \"\\\" to user \" + user.getName() + \" as kit item requires Paper 1.15.2+ to deserialize.\");", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b12ff883cf3c9eb805b696d2db6fb2442fe7df20"}, "originalPosition": 26}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d74ecb526ce273fa1cc09dc94690be9063715668", "author": {"user": {"login": "JRoy", "name": "Josh Roy"}}, "url": "https://github.com/EssentialsX/Essentials/commit/d74ecb526ce273fa1cc09dc94690be9063715668", "committedDate": "2020-08-04T15:41:52Z", "message": "Update Essentials/src/messages.properties\n\nCo-authored-by: MD <1917406+md678685@users.noreply.github.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "1c54694cdbc7ce97312f9b8e6615dc59e9c888e0", "author": {"user": {"login": "JRoy", "name": "Josh Roy"}}, "url": "https://github.com/EssentialsX/Essentials/commit/1c54694cdbc7ce97312f9b8e6615dc59e9c888e0", "committedDate": "2020-08-04T15:42:03Z", "message": "Update Essentials/src/config.yml\n\nCo-authored-by: MD <1917406+md678685@users.noreply.github.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "35dd6e64c2b43ee806e2d689b306026ddf2cf78b", "author": {"user": {"login": "JRoy", "name": "Josh Roy"}}, "url": "https://github.com/EssentialsX/Essentials/commit/35dd6e64c2b43ee806e2d689b306026ddf2cf78b", "committedDate": "2020-08-22T18:03:45Z", "message": "Translate warning"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "302ff37f2360964b61d05c95e5d42b413e4e0f03", "author": {"user": {"login": "JRoy", "name": "Josh Roy"}}, "url": "https://github.com/EssentialsX/Essentials/commit/302ff37f2360964b61d05c95e5d42b413e4e0f03", "committedDate": "2020-10-05T06:44:48Z", "message": "Merge branch '2.x' into feature/usable-kits\n\n# Conflicts:\n#\tEssentials/src/com/earth2me/essentials/Essentials.java\n#\tEssentials/src/com/earth2me/essentials/IEssentials.java\n#\tEssentials/src/com/earth2me/essentials/commands/Commandcreatekit.java"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "bed31e806ed50fd86793f1e377773c5c72010602", "author": {"user": {"login": "JRoy", "name": "Josh Roy"}}, "url": "https://github.com/EssentialsX/Essentials/commit/bed31e806ed50fd86793f1e377773c5c72010602", "committedDate": "2020-10-09T21:19:56Z", "message": "Merge branch '2.x' into feature/usable-kits\n\n# Conflicts:\n#\tEssentials/src/com/earth2me/essentials/Essentials.java\n#\tEssentials/src/com/earth2me/essentials/IEssentials.java"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "7b98ad26353977f958741325646c4aa127b0b577", "author": {"user": {"login": "JRoy", "name": "Josh Roy"}}, "url": "https://github.com/EssentialsX/Essentials/commit/7b98ad26353977f958741325646c4aa127b0b577", "committedDate": "2020-10-20T12:58:40Z", "message": "Merge branch '2.x' into feature/usable-kits"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "6fb7d04dc8f8c4950fc15ee5b87bca98005c18cd", "author": {"user": {"login": "JRoy", "name": "Josh Roy"}}, "url": "https://github.com/EssentialsX/Essentials/commit/6fb7d04dc8f8c4950fc15ee5b87bca98005c18cd", "committedDate": "2020-10-22T15:40:14Z", "message": "Add note about downgrading"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "1c0fd6f03e2f8d839260e5c63c2e829312f42d73", "author": {"user": {"login": "JRoy", "name": "Josh Roy"}}, "url": "https://github.com/EssentialsX/Essentials/commit/1c0fd6f03e2f8d839260e5c63c2e829312f42d73", "committedDate": "2020-11-25T22:04:08Z", "message": "Merge branch '2.x' into feature/usable-kits"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "118d138109b004044272563bc6f7ba560244d809", "author": {"user": {"login": "JRoy", "name": "Josh Roy"}}, "url": "https://github.com/EssentialsX/Essentials/commit/118d138109b004044272563bc6f7ba560244d809", "committedDate": "2021-01-22T12:40:37Z", "message": "Merge branch '2.x' into feature/usable-kits"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "55a90dca7f3233f2589b701c0108f3dbfbf09d12", "author": {"user": {"login": "JRoy", "name": "Josh Roy"}}, "url": "https://github.com/EssentialsX/Essentials/commit/55a90dca7f3233f2589b701c0108f3dbfbf09d12", "committedDate": "2021-02-20T16:32:12Z", "message": "Merge branch '2.x' into feature/usable-kits"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d18b70a99c3dd88d89f4703a5f1de1d4cc1c7fcb", "author": {"user": {"login": "JRoy", "name": "Josh Roy"}}, "url": "https://github.com/EssentialsX/Essentials/commit/d18b70a99c3dd88d89f4703a5f1de1d4cc1c7fcb", "committedDate": "2021-03-06T23:39:12Z", "message": "Merge branch '2.x' into feature/usable-kits"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "3cbc9fc876107157fe43a409164487b30947d4ff", "author": {"user": {"login": "JRoy", "name": "Josh Roy"}}, "url": "https://github.com/EssentialsX/Essentials/commit/3cbc9fc876107157fe43a409164487b30947d4ff", "committedDate": "2021-03-19T04:17:51Z", "message": "Merge branch '2.x' into feature/usable-kits"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "3ae508dc46697db073dccbdc196ecdbdca3e4d03", "author": {"user": {"login": "JRoy", "name": "Josh Roy"}}, "url": "https://github.com/EssentialsX/Essentials/commit/3ae508dc46697db073dccbdc196ecdbdca3e4d03", "committedDate": "2021-04-08T01:43:31Z", "message": "Merge branch '2.x' into feature/usable-kits"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NjMzNzg5MTg1", "url": "https://github.com/EssentialsX/Essentials/pull/3248#pullrequestreview-633789185", "createdAt": "2021-04-12T17:20:50Z", "commit": {"oid": "3ae508dc46697db073dccbdc196ecdbdca3e4d03"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wNC0xMlQxNzoyMDo1MFrOJHeSPg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wNC0xMlQxNzoyMjo1N1rOJHeXnA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDYxMTgxNTk5OA==", "bodyText": "A non-primitive is by default null; this breaks the style around unnecessarily.", "url": "https://github.com/EssentialsX/Essentials/pull/3248#discussion_r611815998", "createdAt": "2021-04-12T17:20:50Z", "author": {"login": "Proximyst"}, "path": "Essentials/src/main/java/com/earth2me/essentials/Essentials.java", "diffHunk": "@@ -144,6 +146,7 @@\n     private transient PotionMetaProvider potionMetaProvider;\n     private transient ServerStateProvider serverStateProvider;\n     private transient ContainerProvider containerProvider;\n+    private transient SerializationProvider serializationProvider = null;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "3ae508dc46697db073dccbdc196ecdbdca3e4d03"}, "originalPosition": 20}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDYxMTgxNjc4OQ==", "bodyText": "Perhaps rename this as it may not be unique to Paper forever? E.g. useSerializationProvider", "url": "https://github.com/EssentialsX/Essentials/pull/3248#discussion_r611816789", "createdAt": "2021-04-12T17:22:03Z", "author": {"login": "Proximyst"}, "path": "Essentials/src/main/java/com/earth2me/essentials/commands/Commandcreatekit.java", "diffHunk": "@@ -60,9 +61,22 @@ public void run(final Server server, final User user, final String commandLabel,\n         final String kitname = args[0];\n         final ItemStack[] items = user.getBase().getInventory().getContents();\n         final List<String> list = new ArrayList<>();\n-        for (final ItemStack is : items) {\n+\n+        boolean usePaperSerial = ess.getSettings().isUseBetterKits();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "3ae508dc46697db073dccbdc196ecdbdca3e4d03"}, "originalPosition": 14}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDYxMTgxNzEyNw==", "bodyText": "Same as above: perhaps rename this to use-nbt-serialization-in-createkit. The note in the comment specifies that it is Paper-specific.", "url": "https://github.com/EssentialsX/Essentials/pull/3248#discussion_r611817127", "createdAt": "2021-04-12T17:22:34Z", "author": {"login": "Proximyst"}, "path": "Essentials/src/main/resources/config.yml", "diffHunk": "@@ -331,9 +331,18 @@ kit-auto-equip: false\n # Determines the functionality of the /createkit command.\n # If this is true, /createkit will give the user a link with the kit code.\n # If this is false, /createkit will add the kit to the kits.yml config file directly.\n-#\n+# Default is false.\n pastebin-createkit: false\n \n+# Determines if /createkit will generate kits using NBT item serialization.\n+# If this is true, /createkit will store items as NBT; otherwise, it will use Essentials' human-readable item format.\n+# By using NBT serialization, /createkit can store items with complex metadata such as shulker boxes and weapons with custom attributes.\n+# WARNING: This option only works on 1.15+ Paper servers, and it will bypass any custom serializers from other plugins such as Magic.\n+# WARNING: When creating kits via /createkit with this option enabled, you will not be able to downgrade your server with these kit items.\n+# This option only affects /createkit - you can still create kits by hand in `kits.yml` using Essentials' human-readable item format.\n+# Default is false.\n+use-paper-serialization-in-createkit: false", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "3ae508dc46697db073dccbdc196ecdbdca3e4d03"}, "originalPosition": 15}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDYxMTgxNzM3Mg==", "bodyText": "Paper 1.15+ or Paper 1.15.2+? Config comment or message is incorrect.", "url": "https://github.com/EssentialsX/Essentials/pull/3248#discussion_r611817372", "createdAt": "2021-04-12T17:22:57Z", "author": {"login": "Proximyst"}, "path": "Essentials/src/main/resources/messages.properties", "diffHunk": "@@ -130,6 +130,7 @@ createkitCommandUsage=/<command> <kitname> <delay>\n createKitFailed=\\u00a74Error occurred whilst creating kit {0}.\n createKitSeparator=\\u00a7m-----------------------\n createKitSuccess=\\u00a76Created Kit: \\u00a7f{0}\\n\\u00a76Delay: \\u00a7f{1}\\n\\u00a76Link: \\u00a7f{2}\\n\\u00a76Copy contents in the link above into your kits.yml.\n+createKitUnsupported=\\u00a74NBT item serialization has been enabled, but this server is not running Paper 1.15.2+. Falling back to standard item serialization.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "3ae508dc46697db073dccbdc196ecdbdca3e4d03"}, "originalPosition": 4}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NjMzNzkzMDQw", "url": "https://github.com/EssentialsX/Essentials/pull/3248#pullrequestreview-633793040", "createdAt": "2021-04-12T17:25:17Z", "commit": {"oid": "3ae508dc46697db073dccbdc196ecdbdca3e4d03"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wNC0xMlQxNzoyNToxN1rOJHedkA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wNC0xMlQxNzoyNToxN1rOJHedkA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDYxMTgxODg5Ng==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            # WARNING: This option only works on 1.15+ Paper servers, and it will bypass any custom serializers from other plugins such as Magic.\n          \n          \n            \n            # WARNING: This option only works on 1.15.2+ Paper servers, and it will bypass any custom serializers from other plugins such as Magic.", "url": "https://github.com/EssentialsX/Essentials/pull/3248#discussion_r611818896", "createdAt": "2021-04-12T17:25:17Z", "author": {"login": "JRoy"}, "path": "Essentials/src/main/resources/config.yml", "diffHunk": "@@ -331,9 +331,18 @@ kit-auto-equip: false\n # Determines the functionality of the /createkit command.\n # If this is true, /createkit will give the user a link with the kit code.\n # If this is false, /createkit will add the kit to the kits.yml config file directly.\n-#\n+# Default is false.\n pastebin-createkit: false\n \n+# Determines if /createkit will generate kits using NBT item serialization.\n+# If this is true, /createkit will store items as NBT; otherwise, it will use Essentials' human-readable item format.\n+# By using NBT serialization, /createkit can store items with complex metadata such as shulker boxes and weapons with custom attributes.\n+# WARNING: This option only works on 1.15+ Paper servers, and it will bypass any custom serializers from other plugins such as Magic.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "3ae508dc46697db073dccbdc196ecdbdca3e4d03"}, "originalPosition": 11}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NjMzNzkzNDAz", "url": "https://github.com/EssentialsX/Essentials/pull/3248#pullrequestreview-633793403", "createdAt": "2021-04-12T17:25:41Z", "commit": {"oid": "3ae508dc46697db073dccbdc196ecdbdca3e4d03"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wNC0xMlQxNzoyNTo0MVrOJHeeuA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wNC0xMlQxNzoyNTo0MVrOJHeeuA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDYxMTgxOTE5Mg==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                    boolean usePaperSerial = ess.getSettings().isUseBetterKits();\n          \n          \n            \n                    boolean useSerializationProvider = ess.getSettings().isUseBetterKits();", "url": "https://github.com/EssentialsX/Essentials/pull/3248#discussion_r611819192", "createdAt": "2021-04-12T17:25:41Z", "author": {"login": "JRoy"}, "path": "Essentials/src/main/java/com/earth2me/essentials/commands/Commandcreatekit.java", "diffHunk": "@@ -60,9 +61,22 @@ public void run(final Server server, final User user, final String commandLabel,\n         final String kitname = args[0];\n         final ItemStack[] items = user.getBase().getInventory().getContents();\n         final List<String> list = new ArrayList<>();\n-        for (final ItemStack is : items) {\n+\n+        boolean usePaperSerial = ess.getSettings().isUseBetterKits();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "3ae508dc46697db073dccbdc196ecdbdca3e4d03"}, "originalPosition": 14}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NjMzNzkzOTg5", "url": "https://github.com/EssentialsX/Essentials/pull/3248#pullrequestreview-633793989", "createdAt": "2021-04-12T17:26:19Z", "commit": {"oid": "3ae508dc46697db073dccbdc196ecdbdca3e4d03"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wNC0xMlQxNzoyNjoxOVrOJHegpw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wNC0xMlQxNzoyNjoxOVrOJHegpw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDYxMTgxOTY4Nw==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                    if (usePaperSerial && ess.getSerializationProvider() == null) {\n          \n          \n            \n                        ess.showError(user.getSource(), new Exception(tl(\"createKitUnsupported\")), commandLabel);\n          \n          \n            \n                        usePaperSerial = false;\n          \n          \n            \n                    if (useSerializationProvider && ess.getSerializationProvider() == null) {\n          \n          \n            \n                        ess.showError(user.getSource(), new Exception(tl(\"createKitUnsupported\")), commandLabel);\n          \n          \n            \n                        useSerializationProvider = false;", "url": "https://github.com/EssentialsX/Essentials/pull/3248#discussion_r611819687", "createdAt": "2021-04-12T17:26:19Z", "author": {"login": "JRoy"}, "path": "Essentials/src/main/java/com/earth2me/essentials/commands/Commandcreatekit.java", "diffHunk": "@@ -60,9 +61,22 @@ public void run(final Server server, final User user, final String commandLabel,\n         final String kitname = args[0];\n         final ItemStack[] items = user.getBase().getInventory().getContents();\n         final List<String> list = new ArrayList<>();\n-        for (final ItemStack is : items) {\n+\n+        boolean usePaperSerial = ess.getSettings().isUseBetterKits();\n+\n+        if (usePaperSerial && ess.getSerializationProvider() == null) {\n+            ess.showError(user.getSource(), new Exception(tl(\"createKitUnsupported\")), commandLabel);\n+            usePaperSerial = false;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "3ae508dc46697db073dccbdc196ecdbdca3e4d03"}, "originalPosition": 18}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NjMzNzk0MTI1", "url": "https://github.com/EssentialsX/Essentials/pull/3248#pullrequestreview-633794125", "createdAt": "2021-04-12T17:26:27Z", "commit": {"oid": "3ae508dc46697db073dccbdc196ecdbdca3e4d03"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wNC0xMlQxNzoyNjoyN1rOJHehEQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wNC0xMlQxNzoyNjoyN1rOJHehEQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDYxMTgxOTc5Mw==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                            if (usePaperSerial) {\n          \n          \n            \n                            if (useSerializationProvider) {", "url": "https://github.com/EssentialsX/Essentials/pull/3248#discussion_r611819793", "createdAt": "2021-04-12T17:26:27Z", "author": {"login": "JRoy"}, "path": "Essentials/src/main/java/com/earth2me/essentials/commands/Commandcreatekit.java", "diffHunk": "@@ -60,9 +61,22 @@ public void run(final Server server, final User user, final String commandLabel,\n         final String kitname = args[0];\n         final ItemStack[] items = user.getBase().getInventory().getContents();\n         final List<String> list = new ArrayList<>();\n-        for (final ItemStack is : items) {\n+\n+        boolean usePaperSerial = ess.getSettings().isUseBetterKits();\n+\n+        if (usePaperSerial && ess.getSerializationProvider() == null) {\n+            ess.showError(user.getSource(), new Exception(tl(\"createKitUnsupported\")), commandLabel);\n+            usePaperSerial = false;\n+        }\n+\n+        for (ItemStack is : items) {\n             if (is != null && is.getType() != null && is.getType() != Material.AIR) {\n-                final String serialized = ess.getItemDb().serialize(is);\n+                final String serialized;\n+                if (usePaperSerial) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "3ae508dc46697db073dccbdc196ecdbdca3e4d03"}, "originalPosition": 25}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NjMzNzk0NzQy", "url": "https://github.com/EssentialsX/Essentials/pull/3248#pullrequestreview-633794742", "createdAt": "2021-04-12T17:27:10Z", "commit": {"oid": "3ae508dc46697db073dccbdc196ecdbdca3e4d03"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wNC0xMlQxNzoyNzoxMVrOJHejAQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wNC0xMlQxNzoyNzoxMVrOJHejAQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDYxMTgyMDI4OQ==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                    return config.getBoolean(\"use-paper-serialization-in-createkit\", false);\n          \n          \n            \n                    return config.getBoolean(\"use-nbt-serialization-in-createkit\", false);", "url": "https://github.com/EssentialsX/Essentials/pull/3248#discussion_r611820289", "createdAt": "2021-04-12T17:27:11Z", "author": {"login": "JRoy"}, "path": "Essentials/src/main/java/com/earth2me/essentials/Settings.java", "diffHunk": "@@ -1645,6 +1645,11 @@ public boolean isPastebinCreateKit() {\n         return config.getBoolean(\"pastebin-createkit\", false);\n     }\n \n+    @Override\n+    public boolean isUseBetterKits() {\n+        return config.getBoolean(\"use-paper-serialization-in-createkit\", false);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "3ae508dc46697db073dccbdc196ecdbdca3e4d03"}, "originalPosition": 6}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "20c2628ac2b2678392daa4847b8a5d288be2f2fd", "author": {"user": {"login": "JRoy", "name": "Josh Roy"}}, "url": "https://github.com/EssentialsX/Essentials/commit/20c2628ac2b2678392daa4847b8a5d288be2f2fd", "committedDate": "2021-04-12T17:27:22Z", "message": "Apply suggestions from code review"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b01c2cb0ad643d5af8cbf81078cca93147e8e59b", "author": {"user": {"login": "JRoy", "name": "Josh Roy"}}, "url": "https://github.com/EssentialsX/Essentials/commit/b01c2cb0ad643d5af8cbf81078cca93147e8e59b", "committedDate": "2021-04-26T13:21:05Z", "message": "Merge branch '2.x' into feature/usable-kits"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "8f8642b53bc08d4c21b2d0d9539d4a476e3599c4", "author": {"user": {"login": "JRoy", "name": "Josh Roy"}}, "url": "https://github.com/EssentialsX/Essentials/commit/8f8642b53bc08d4c21b2d0d9539d4a476e3599c4", "committedDate": "2021-05-13T04:27:38Z", "message": "Merge branch '2.x' into feature/usable-kits"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e427d4b475f6b6869d94916bc38d9aed0fc4e249", "author": {"user": {"login": "JRoy", "name": "Josh Roy"}}, "url": "https://github.com/EssentialsX/Essentials/commit/e427d4b475f6b6869d94916bc38d9aed0fc4e249", "committedDate": "2021-05-19T14:01:25Z", "message": "Merge branch '2.x' into feature/usable-kits"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f04158ce6da878ae7fc206db57f5fc4a72e6762a", "author": {"user": {"login": "JRoy", "name": "Josh Roy"}}, "url": "https://github.com/EssentialsX/Essentials/commit/f04158ce6da878ae7fc206db57f5fc4a72e6762a", "committedDate": "2021-06-03T11:40:13Z", "message": "Merge branch '2.x' into feature/usable-kits"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "da9521ed3fbb6d02f5aaf7b8a033eb54c899ff16", "author": {"user": {"login": "JRoy", "name": "Josh Roy"}}, "url": "https://github.com/EssentialsX/Essentials/commit/da9521ed3fbb6d02f5aaf7b8a033eb54c899ff16", "committedDate": "2021-06-07T13:43:46Z", "message": "Merge branch '2.x' into feature/usable-kits\n\n# Conflicts:\n#\tEssentials/src/main/java/com/earth2me/essentials/Essentials.java\n#\tEssentials/src/main/java/com/earth2me/essentials/commands/Commandcreatekit.java"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f840ffb8cf2330445ca79e1af0addaa5d724b9d7", "author": {"user": {"login": "JRoy", "name": "Josh Roy"}}, "url": "https://github.com/EssentialsX/Essentials/commit/f840ffb8cf2330445ca79e1af0addaa5d724b9d7", "committedDate": "2021-06-08T20:52:39Z", "message": "Merge branch '2.x' into feature/usable-kits"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "2aeb2935766ee300d63fdede41ca9c1bfaa2d2c8", "author": {"user": {"login": "JRoy", "name": "Josh Roy"}}, "url": "https://github.com/EssentialsX/Essentials/commit/2aeb2935766ee300d63fdede41ca9c1bfaa2d2c8", "committedDate": "2021-06-11T15:15:13Z", "message": "Merge branch '2.x' into feature/usable-kits"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "1a99188f1e288d22e698497b6f9015f5c8daf1f8", "author": {"user": {"login": "JRoy", "name": "Josh Roy"}}, "url": "https://github.com/EssentialsX/Essentials/commit/1a99188f1e288d22e698497b6f9015f5c8daf1f8", "committedDate": "2021-06-12T20:53:48Z", "message": "Merge branch '2.x' into feature/usable-kits"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "4b23be95ede6e7b4a8234c33178dbaceefeae9d7", "author": {"user": {"login": "JRoy", "name": "Josh Roy"}}, "url": "https://github.com/EssentialsX/Essentials/commit/4b23be95ede6e7b4a8234c33178dbaceefeae9d7", "committedDate": "2021-06-14T11:31:37Z", "message": "Merge branch '2.x' into feature/usable-kits"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NjkzMzUyMjY1", "url": "https://github.com/EssentialsX/Essentials/pull/3248#pullrequestreview-693352265", "createdAt": "2021-06-26T19:49:41Z", "commit": {"oid": "4b23be95ede6e7b4a8234c33178dbaceefeae9d7"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "5ce93568911509d6ebdb101fdb1d6b76aff9e8a1", "author": {"user": {"login": "mdcfe", "name": "MD"}}, "url": "https://github.com/EssentialsX/Essentials/commit/5ce93568911509d6ebdb101fdb1d6b76aff9e8a1", "committedDate": "2021-06-26T20:01:18Z", "message": "Merge branch '2.x' into feature/usable-kits"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4679, "cost": 1, "resetAt": "2021-11-01T14:20:25Z"}}}