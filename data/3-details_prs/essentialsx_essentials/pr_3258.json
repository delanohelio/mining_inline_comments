{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDE1OTE1Mzk5", "number": 3258, "title": "Improve backup functionality", "bodyText": "Yeah, I had no idea this feature existed but apparently somebody caught a rare bug with it.\nBefore you ask, yes the Thread#sleep in the onDisable is scary, but don't worry; It will rarely be called and it's aikar approved!\nFixes #3257\nCloses #2646", "createdAt": "2020-05-11T07:17:35Z", "url": "https://github.com/EssentialsX/Essentials/pull/3258", "merged": true, "mergeCommit": {"oid": "8b714372641a92ae4843abddfe78d8999152b52d"}, "closed": true, "closedAt": "2020-05-11T15:55:32Z", "author": {"login": "JRoy"}, "timelineItems": {"totalCount": 13, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcgKLhvAH2gAyNDE1OTE1Mzk5OmNhNWFkMDRmZjc1ZGI0MDRkYzdkZWEwMTk4NTk3N2I2MDgyZmM1MzY=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcgRuntAFqTQwOTMwMjUwNQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "ca5ad04ff75db404dc7dea01985977b6082fc536", "author": {"user": {"login": "JRoy", "name": "Josh Roy"}}, "url": "https://github.com/EssentialsX/Essentials/commit/ca5ad04ff75db404dc7dea01985977b6082fc536", "committedDate": "2020-05-11T07:03:18Z", "message": "Finish backup tasks before disabling plugin"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "5d2b822cb2b05ca573b18747659b02977484feae", "author": {"user": {"login": "JRoy", "name": "Josh Roy"}}, "url": "https://github.com/EssentialsX/Essentials/commit/5d2b822cb2b05ca573b18747659b02977484feae", "committedDate": "2020-05-11T07:13:08Z", "message": "Don't schedule new tasks when we're shutting down"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "27dfa7b7b99b1bac04039d867ddd639b5b217f3c", "author": {"user": {"login": "JRoy", "name": "Josh Roy"}}, "url": "https://github.com/EssentialsX/Essentials/commit/27dfa7b7b99b1bac04039d867ddd639b5b217f3c", "committedDate": "2020-05-11T07:13:39Z", "message": "Add config option to run backup task even when players are offline"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDA4OTQ1NTg4", "url": "https://github.com/EssentialsX/Essentials/pull/3258#pullrequestreview-408945588", "createdAt": "2020-05-11T08:01:29Z", "commit": {"oid": "27dfa7b7b99b1bac04039d867ddd639b5b217f3c"}, "state": "DISMISSED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xMVQwODowMToyOVrOGTRCjQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xMVQwODowMzoxNVrOGTRGnw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMjg1NTMwOQ==", "bodyText": "I see what you're trying to do, but as Aikar pointed out this would probably be done much better with a future. If that's too much work here, I'd at least change this to only sleep for one second at a time, to avoid superfluous waiting. The main thread doesn't have anything better to do at this point anyways.", "url": "https://github.com/EssentialsX/Essentials/pull/3258#discussion_r422855309", "createdAt": "2020-05-11T08:01:29Z", "author": {"login": "pop4959"}, "path": "Essentials/src/com/earth2me/essentials/Essentials.java", "diffHunk": "@@ -381,6 +383,13 @@ public void onDisable() {\n         getUserMap().getUUIDMap().shutdown();\n \n         HandlerList.unregisterAll(this);\n+        while (getBackup().isActive()) {\n+            try {\n+                Thread.sleep(10);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "27dfa7b7b99b1bac04039d867ddd639b5b217f3c"}, "originalPosition": 22}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMjg1NjM1MQ==", "bodyText": "I suggest changing this from always-run-backup to simply always-run to avoid redundancy since this config option is already a child of backup.", "url": "https://github.com/EssentialsX/Essentials/pull/3258#discussion_r422856351", "createdAt": "2020-05-11T08:03:15Z", "author": {"login": "pop4959"}, "path": "Essentials/src/config.yml", "diffHunk": "@@ -371,6 +371,8 @@ unprotected-sign-names:\n backup:\n   # Interval in minutes.\n   interval: 30\n+  # If true, the backup task will run even if there are no players online.\n+  always-run-backup: false", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "27dfa7b7b99b1bac04039d867ddd639b5b217f3c"}, "originalPosition": 5}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "adb2e6d51392ba2efd2e8111a8a2465bf5585861", "author": {"user": {"login": "JRoy", "name": "Josh Roy"}}, "url": "https://github.com/EssentialsX/Essentials/commit/adb2e6d51392ba2efd2e8111a8a2465bf5585861", "committedDate": "2020-05-11T12:38:23Z", "message": "Change config node"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "6cc4e3bbef50b6275204ec5e276a22eaca56886f", "author": {"user": {"login": "JRoy", "name": "Josh Roy"}}, "url": "https://github.com/EssentialsX/Essentials/commit/6cc4e3bbef50b6275204ec5e276a22eaca56886f", "committedDate": "2020-05-11T13:15:45Z", "message": "Use future because sleeping is scary!"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f0c6d1815c36a40843525b554d04f4fd3567883a", "author": {"user": {"login": "JRoy", "name": "Josh Roy"}}, "url": "https://github.com/EssentialsX/Essentials/commit/f0c6d1815c36a40843525b554d04f4fd3567883a", "committedDate": "2020-05-11T14:04:08Z", "message": "Merge branch '2.x' into bug/stupid-broken-feature"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "9247c8b1764dc7f4acf852ef246a92178047fe8d", "author": {"user": {"login": "JRoy", "name": "Josh Roy"}}, "url": "https://github.com/EssentialsX/Essentials/commit/9247c8b1764dc7f4acf852ef246a92178047fe8d", "committedDate": "2020-05-11T14:15:58Z", "message": "Yell and shame users using the /reload command"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDA5MjkxMDU2", "url": "https://github.com/EssentialsX/Essentials/pull/3258#pullrequestreview-409291056", "createdAt": "2020-05-11T15:37:53Z", "commit": {"oid": "9247c8b1764dc7f4acf852ef246a92178047fe8d"}, "state": "DISMISSED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xMVQxNTozNzo1M1rOGTh3DQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xMVQxNTozNzo1M1rOGTh3DQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMzEzMDg5Mw==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            serverReloading=There's a good chance you're probably reloading your server right now. If that's the case, why do you hate yourself? Except no support from the Essentials team when using /reload\n          \n          \n            \n            serverReloading=There's a good chance you're probably reloading your server right now. If that's the case, why do you hate yourself? Expect no support from the EssentialsX team when using /reload.\n          \n      \n    \n    \n  \n\nOthers might have other suggestions on wording.", "url": "https://github.com/EssentialsX/Essentials/pull/3258#discussion_r423130893", "createdAt": "2020-05-11T15:37:53Z", "author": {"login": "mdcfe"}, "path": "Essentials/src/messages.properties", "diffHunk": "@@ -484,6 +485,7 @@ seenOnline=\\u00a76Player\\u00a7c {0} \\u00a76has been \\u00a7aonline\\u00a76 since \\\n sellBulkPermission=\\u00a76You do not have permission to bulk sell.\n sellHandPermission=\\u00a76You do not have permission to hand sell.\n serverFull=Server is full\\!\n+serverReloading=There's a good chance you're probably reloading your server right now. If that's the case, why do you hate yourself? Except no support from the Essentials team when using /reload", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "9247c8b1764dc7f4acf852ef246a92178047fe8d"}, "originalPosition": 12}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b30dbc20e26343cc499cc0e5a9aa87f0963b0701", "author": {"user": {"login": "JRoy", "name": "Josh Roy"}}, "url": "https://github.com/EssentialsX/Essentials/commit/b30dbc20e26343cc499cc0e5a9aa87f0963b0701", "committedDate": "2020-05-11T15:42:09Z", "message": "Update Essentials/src/messages.properties\n\nCo-authored-by: md678685 <1917406+md678685@users.noreply.github.com>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDA5MzAyMTkw", "url": "https://github.com/EssentialsX/Essentials/pull/3258#pullrequestreview-409302190", "createdAt": "2020-05-11T15:50:36Z", "commit": {"oid": "b30dbc20e26343cc499cc0e5a9aa87f0963b0701"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xMVQxNTo1MDozNlrOGTiY3g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xMVQxNTo1MDozNlrOGTiY3g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMzEzOTU1MA==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            serverReloading=There's a good chance you're probably reloading your server right now. If that's the case, why do you hate yourself? Expect no support from the EssentialsX team when using /reload.\n          \n          \n            \n            serverReloading=There's a good chance you're reloading your server right now. If that's the case, why do you hate yourself? Expect no support from the EssentialsX team when using /reload.", "url": "https://github.com/EssentialsX/Essentials/pull/3258#discussion_r423139550", "createdAt": "2020-05-11T15:50:36Z", "author": {"login": "mdcfe"}, "path": "Essentials/src/messages.properties", "diffHunk": "@@ -484,6 +485,7 @@ seenOnline=\\u00a76Player\\u00a7c {0} \\u00a76has been \\u00a7aonline\\u00a76 since \\\n sellBulkPermission=\\u00a76You do not have permission to bulk sell.\n sellHandPermission=\\u00a76You do not have permission to hand sell.\n serverFull=Server is full\\!\n+serverReloading=There's a good chance you're probably reloading your server right now. If that's the case, why do you hate yourself? Expect no support from the EssentialsX team when using /reload.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b30dbc20e26343cc499cc0e5a9aa87f0963b0701"}, "originalPosition": 12}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "55fdc45422ef9746b45f931c747afe4562fd601b", "author": {"user": {"login": "mdcfe", "name": "MD"}}, "url": "https://github.com/EssentialsX/Essentials/commit/55fdc45422ef9746b45f931c747afe4562fd601b", "committedDate": "2020-05-11T15:50:51Z", "message": "Update Essentials/src/messages.properties"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDA5MzAyNTA1", "url": "https://github.com/EssentialsX/Essentials/pull/3258#pullrequestreview-409302505", "createdAt": "2020-05-11T15:50:58Z", "commit": {"oid": "55fdc45422ef9746b45f931c747afe4562fd601b"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4688, "cost": 1, "resetAt": "2021-11-01T14:20:25Z"}}}