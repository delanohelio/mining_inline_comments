{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0Mzk1MTQ1OTY1", "number": 3102, "title": "Reduce sync loads for teleporting", "bodyText": "This PR reduces the number of sync loads occurring on any teleport caused by essentials.\nFixes #2861\nFixes #2287\nFixes #3274\nFixes #3201\nFixes #2120\nDescription\nBefore this PR, essentials would get a block multiple times causing sync loads to check if it was safe to teleport to. Now, the target block's chunk if fetched async with PaperLib and passed along to LocationUtil#isBlockUnsafeForUser (which internally calls other LocationUtil methods what that chunk object) resulting in the chunk only loading once, off the main thread. The only operations remaining on the main thread is LocationUtil#getSafeDestination. This is due to the method's recursion which would be a pain to move async. However: since the chunk was already loaded async, LocationUtil#getSafeDestination most of the time won't cause sync chunk loads. The only time it would cause sync chunk loads is with an unsafe location near a chunk border.\nTest this PR\nsee #3102 (comment)\nPlease leave any bugs you find in the comments below or on the discord!\nThanks!", "createdAt": "2020-03-28T19:55:10Z", "url": "https://github.com/EssentialsX/Essentials/pull/3102", "merged": true, "mergeCommit": {"oid": "d9bf099c3d411e5f493180de9c487a93e2fcfda7"}, "closed": true, "closedAt": "2020-06-24T08:52:27Z", "author": {"login": "JRoy"}, "timelineItems": {"totalCount": 66, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcSKizXgH2gAyMzk1MTQ1OTY1OjBlMWNiNDhkMDdiZjJmYWFjYjQxYzZkNmZkNTI3NjI3NGZmOTczNDQ=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcuWCZuAFqTQzNjQ0NjgzNg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "0e1cb48d07bf2faacb41c6d6fd5276274ff97344", "author": {"user": {"login": "JRoy", "name": "Josh Roy"}}, "url": "https://github.com/EssentialsX/Essentials/commit/0e1cb48d07bf2faacb41c6d6fd5276274ff97344", "committedDate": "2020-03-28T19:33:47Z", "message": "Reduce sync teleporting loads"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzg0MzI0MTYw", "url": "https://github.com/EssentialsX/Essentials/pull/3102#pullrequestreview-384324160", "createdAt": "2020-03-31T00:28:43Z", "commit": {"oid": "0e1cb48d07bf2faacb41c6d6fd5276274ff97344"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0zMVQwMDoyODo0M1rOF-BC6A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0zMVQwMDozNDozNlrOF-BJFA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMDU3MzE2MA==", "bodyText": "We never need an 'async' call inside any other 'async' callbacks because the chunk has already been loaded - this should make the code a lot nicer.", "url": "https://github.com/EssentialsX/Essentials/pull/3102#discussion_r400573160", "createdAt": "2020-03-31T00:28:43Z", "author": {"login": "Ichbinjoe"}, "path": "Essentials/src/com/earth2me/essentials/Teleport.java", "diffHunk": "@@ -121,28 +121,38 @@ public void now(Player entity, boolean cooldown, TeleportCause cause) throws Exc\n     protected void now(IUser teleportee, ITarget target, TeleportCause cause) throws Exception {\n         cancel(false);\n         teleportee.setLastLocation();\n-        Location loc = target.getLocation();\n \n-        if (LocationUtil.isBlockUnsafeForUser(teleportee, loc.getWorld(), loc.getBlockX(), loc.getBlockY(), loc.getBlockZ())) {\n-            if (ess.getSettings().isTeleportSafetyEnabled()) {\n-                if (ess.getSettings().isForceDisableTeleportSafety()) {\n-                    PaperLib.teleportAsync(teleportee.getBase(), loc, cause);\n+        PaperLib.getChunkAtAsync(target.getLocation()).thenAccept(chunk -> {\n+            Location loc = target.getLocation();\n+            if (LocationUtil.isBlockUnsafeForUser(teleportee, chunk, loc.getBlockX(), loc.getBlockY(), loc.getBlockZ())) {\n+                if (ess.getSettings().isTeleportSafetyEnabled()) {\n+                    if (ess.getSettings().isForceDisableTeleportSafety()) {\n+                        PaperLib.teleportAsync(teleportee.getBase(), loc, cause);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "0e1cb48d07bf2faacb41c6d6fd5276274ff97344"}, "originalPosition": 15}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMDU3Mzg4Mg==", "bodyText": "I think you have hit the crux of why this hasn't happened previously :)\nWe can't throw the exception back upstream obviously because we are in a different stack frame. e.printStackTrace() isn't remotely acceptable, and even if it was, we lost the entire point of the exception - to notify the user that the destination of the teleport is unsafe. This is bad design in general (using exceptions as user feedback mechanisms), but unfortunately unless we are going to uproot the entire codebase its here to stay.\nA possible solution is to give now() a separate argument which accepts an exception as a callback, but that would bubble all the way up the stack as Node-esque hell. Not sure what the right solution here is.", "url": "https://github.com/EssentialsX/Essentials/pull/3102#discussion_r400573882", "createdAt": "2020-03-31T00:31:20Z", "author": {"login": "Ichbinjoe"}, "path": "Essentials/src/com/earth2me/essentials/Teleport.java", "diffHunk": "@@ -121,28 +121,38 @@ public void now(Player entity, boolean cooldown, TeleportCause cause) throws Exc\n     protected void now(IUser teleportee, ITarget target, TeleportCause cause) throws Exception {\n         cancel(false);\n         teleportee.setLastLocation();\n-        Location loc = target.getLocation();\n \n-        if (LocationUtil.isBlockUnsafeForUser(teleportee, loc.getWorld(), loc.getBlockX(), loc.getBlockY(), loc.getBlockZ())) {\n-            if (ess.getSettings().isTeleportSafetyEnabled()) {\n-                if (ess.getSettings().isForceDisableTeleportSafety()) {\n-                    PaperLib.teleportAsync(teleportee.getBase(), loc, cause);\n+        PaperLib.getChunkAtAsync(target.getLocation()).thenAccept(chunk -> {\n+            Location loc = target.getLocation();\n+            if (LocationUtil.isBlockUnsafeForUser(teleportee, chunk, loc.getBlockX(), loc.getBlockY(), loc.getBlockZ())) {\n+                if (ess.getSettings().isTeleportSafetyEnabled()) {\n+                    if (ess.getSettings().isForceDisableTeleportSafety()) {\n+                        PaperLib.teleportAsync(teleportee.getBase(), loc, cause);\n+                    } else {\n+                        try {\n+                            PaperLib.teleportAsync(teleportee.getBase(), LocationUtil.getSafeDestination(ess, teleportee, loc), cause);\n+                        } catch (Exception e) {\n+                            e.printStackTrace();\n+                        }\n+                    }\n                 } else {\n-                    PaperLib.teleportAsync(teleportee.getBase(), LocationUtil.getSafeDestination(ess, teleportee, loc), cause);\n+                    try {\n+                        throw new Exception(tl(\"unsafeTeleportDestination\", loc.getWorld().getName(), loc.getBlockX(), loc.getBlockY(), loc.getBlockZ()));\n+                    } catch (Exception e) {\n+                        e.printStackTrace();\n+                    }", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "0e1cb48d07bf2faacb41c6d6fd5276274ff97344"}, "originalPosition": 29}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMDU3NDQxMA==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                    x = x & 0xF;\n          \n          \n            \n                    z = z & 0xF;\n          \n          \n            \n                    return y > chunk.getWorld().getMaxHeight() || HOLLOW_MATERIALS.contains(chunk.getBlock(x, y - 1, z).getType());\n          \n          \n            \n                    return y > chunk.getWorld().getMaxHeight() || HOLLOW_MATERIALS.contains(chunk.getBlock(x & 0xf, y - 1, z & 0xf).getType());\n          \n      \n    \n    \n  \n\nWhile Java doesn't do this, other languages this kind of assignment is scary, as you may be modifying the value out of scope. (You aren't here, you are fine, but it isn't a good pattern)", "url": "https://github.com/EssentialsX/Essentials/pull/3102#discussion_r400574410", "createdAt": "2020-03-31T00:33:27Z", "author": {"login": "Ichbinjoe"}, "path": "Essentials/src/com/earth2me/essentials/utils/LocationUtil.java", "diffHunk": "@@ -89,26 +86,42 @@ public static Location getTarget(final LivingEntity entity) throws Exception {\n     }\n \n     public static boolean isBlockAboveAir(final World world, final int x, final int y, final int z) {\n-        return y > world.getMaxHeight() || HOLLOW_MATERIALS.contains(world.getBlockAt(x, y - 1, z).getType());\n+        return isBlockAboveAir(world.getChunkAt(x, z), x, y, z);\n+    }\n+\n+    public static boolean isBlockAboveAir(final Chunk chunk, int x, final int y, int z) {\n+        x = x & 0xF;\n+        z = z & 0xF;\n+        return y > chunk.getWorld().getMaxHeight() || HOLLOW_MATERIALS.contains(chunk.getBlock(x, y - 1, z).getType());", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "0e1cb48d07bf2faacb41c6d6fd5276274ff97344"}, "originalPosition": 23}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMDU3NDc0MA==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                    x = x & 0xF;\n          \n          \n            \n                    z = z & 0xF;\n          \n          \n            \n                    final Block below = chunk.getBlock(x, y - 1, z);\n          \n          \n            \n                    final Block below = chunk.getBlock(x & 0xf, y - 1, z & 0xf);\n          \n      \n    \n    \n  \n\nsame as above", "url": "https://github.com/EssentialsX/Essentials/pull/3102#discussion_r400574740", "createdAt": "2020-03-31T00:34:36Z", "author": {"login": "Ichbinjoe"}, "path": "Essentials/src/com/earth2me/essentials/utils/LocationUtil.java", "diffHunk": "@@ -89,26 +86,42 @@ public static Location getTarget(final LivingEntity entity) throws Exception {\n     }\n \n     public static boolean isBlockAboveAir(final World world, final int x, final int y, final int z) {\n-        return y > world.getMaxHeight() || HOLLOW_MATERIALS.contains(world.getBlockAt(x, y - 1, z).getType());\n+        return isBlockAboveAir(world.getChunkAt(x, z), x, y, z);\n+    }\n+\n+    public static boolean isBlockAboveAir(final Chunk chunk, int x, final int y, int z) {\n+        x = x & 0xF;\n+        z = z & 0xF;\n+        return y > chunk.getWorld().getMaxHeight() || HOLLOW_MATERIALS.contains(chunk.getBlock(x, y - 1, z).getType());\n     }\n \n     public static boolean isBlockUnsafeForUser(final IUser user, final World world, final int x, final int y, final int z) {\n-        if (user.getBase().isOnline() && world.equals(user.getBase().getWorld()) && (user.getBase().getGameMode() == GameMode.CREATIVE || user.getBase().getGameMode() == GameMode.SPECTATOR || user.isGodModeEnabled()) && user.getBase().getAllowFlight()) {\n+        return isBlockUnsafeForUser(user, world.getChunkAt(x, z), x, y, z);\n+    }\n+\n+    public static boolean isBlockUnsafeForUser(final IUser user, final Chunk chunk, final int x, final int y, final int z) {\n+        if (user.getBase().isOnline() && chunk.getWorld().equals(user.getBase().getWorld()) && (user.getBase().getGameMode() == GameMode.CREATIVE || user.getBase().getGameMode() == GameMode.SPECTATOR || user.isGodModeEnabled()) && user.getBase().getAllowFlight()) {\n             return false;\n         }\n \n-        if (isBlockDamaging(world, x, y, z)) {\n+        if (isBlockDamaging(chunk, x, y, z)) {\n             return true;\n         }\n-        return isBlockAboveAir(world, x, y, z);\n+        return isBlockAboveAir(chunk, x, y, z);\n     }\n \n     public static boolean isBlockUnsafe(final World world, final int x, final int y, final int z) {\n         return isBlockDamaging(world, x, y, z) || isBlockAboveAir(world, x, y, z);\n     }\n \n     public static boolean isBlockDamaging(final World world, final int x, final int y, final int z) {\n-        final Block below = world.getBlockAt(x, y - 1, z);\n+        return isBlockDamaging(world.getChunkAt(x, z), x, y, z);\n+    }\n+\n+    public static boolean isBlockDamaging(final Chunk chunk, int x, final int y, int z) {\n+        x = x & 0xF;\n+        z = z & 0xF;\n+        final Block below = chunk.getBlock(x, y - 1, z);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "0e1cb48d07bf2faacb41c6d6fd5276274ff97344"}, "originalPosition": 56}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "61830099b4c9ea2d32fe2b8433b428d41078c2af", "author": {"user": {"login": "JRoy", "name": "Josh Roy"}}, "url": "https://github.com/EssentialsX/Essentials/commit/61830099b4c9ea2d32fe2b8433b428d41078c2af", "committedDate": "2020-03-31T01:14:34Z", "message": "Avoid argument re-assigning"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "af869f6a9d25d58ce7bb22555c5df7b8c5323875", "author": {"user": {"login": "JRoy", "name": "Josh Roy"}}, "url": "https://github.com/EssentialsX/Essentials/commit/af869f6a9d25d58ce7bb22555c5df7b8c5323875", "committedDate": "2020-03-31T01:39:19Z", "message": "Remove async teleports when unnecessary"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "709bb830ef2810f18f5c11ce21562d095df6bfe6", "author": {"user": {"login": "JRoy", "name": "Josh Roy"}}, "url": "https://github.com/EssentialsX/Essentials/commit/709bb830ef2810f18f5c11ce21562d095df6bfe6", "committedDate": "2020-03-31T02:50:29Z", "message": "Make exceptions cleaner"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a5bc910c2c3ff9c3c119f4d7caf7080a833e94cf", "author": {"user": {"login": "JRoy", "name": "Josh Roy"}}, "url": "https://github.com/EssentialsX/Essentials/commit/a5bc910c2c3ff9c3c119f4d7caf7080a833e94cf", "committedDate": "2020-04-03T15:53:43Z", "message": "Merge branch '2.x' into feature/better-async"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "7b58655d5650f8fb6b75037d2832cd529227f7fa", "author": {"user": {"login": "JRoy", "name": "Josh Roy"}}, "url": "https://github.com/EssentialsX/Essentials/commit/7b58655d5650f8fb6b75037d2832cd529227f7fa", "committedDate": "2020-04-04T00:39:34Z", "message": "Async all the things\n\nMade an async version of every method with fallbacks for deprecated methods."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "bd49c562f77f76230d2d9b5e057e727778aabbe8", "author": {"user": {"login": "JRoy", "name": "Josh Roy"}}, "url": "https://github.com/EssentialsX/Essentials/commit/bd49c562f77f76230d2d9b5e057e727778aabbe8", "committedDate": "2020-04-04T00:48:30Z", "message": "Remove old now fallback method"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "80250ffc2592f12c646cc5ebaa19fb6334ab0bbf", "author": {"user": {"login": "JRoy", "name": "Josh Roy"}}, "url": "https://github.com/EssentialsX/Essentials/commit/80250ffc2592f12c646cc5ebaa19fb6334ab0bbf", "committedDate": "2020-04-04T03:15:26Z", "message": "Migrate everything to the new async teleport API"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c299234645235c7d19193f429cdd9b8593644bf0", "author": {"user": {"login": "JRoy", "name": "Josh Roy"}}, "url": "https://github.com/EssentialsX/Essentials/commit/c299234645235c7d19193f429cdd9b8593644bf0", "committedDate": "2020-04-04T03:17:27Z", "message": "Update ITeleport javadocs"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "1fd2d572f017e2e8d2dd5448a5352eb2d744e317", "author": {"user": {"login": "JRoy", "name": "Josh Roy"}}, "url": "https://github.com/EssentialsX/Essentials/commit/1fd2d572f017e2e8d2dd5448a5352eb2d744e317", "committedDate": "2020-04-04T15:49:47Z", "message": "Merge branch '2.x' into feature/better-async"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "24cd053ce5b6390454fb9e7035a388dacf88e3d3", "author": {"user": {"login": "JRoy", "name": "Josh Roy"}}, "url": "https://github.com/EssentialsX/Essentials/commit/24cd053ce5b6390454fb9e7035a388dacf88e3d3", "committedDate": "2020-04-04T20:36:14Z", "message": "Fix invoking via async context"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzg3NzgyOTMx", "url": "https://github.com/EssentialsX/Essentials/pull/3102#pullrequestreview-387782931", "createdAt": "2020-04-05T05:35:54Z", "commit": {"oid": "24cd053ce5b6390454fb9e7035a388dacf88e3d3"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wNVQwNTozNTo1NFrOGA89yQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wNVQwNTozNTo1NFrOGA89yQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMzY1MjA0MQ==", "bodyText": "I'm fairly certain that if a 3rd party plugin calls this it will deadlock the server. Should have been more clear when talking about 'deadlocking' in discord.\nI'm fairly certain this is the case - imagine the following:\n\nsendToJail is called\nthe server has a 'cache miss', resulting in a chunk load.\nbut wait! we are using paper, so its a cool async chunk load\nserver goes off and loads the chunk in a separate thread\nServer tries to continue to 126 - which is blocked on a lock. Main thread is now dependent on the async thread completing (which is what we want, because this is maintaining legacy behavior)\nServer is done 'loading' the chunk via IO, but now must load the chunk into the internal chunk map, which includes loading entities\nEntities have to be loaded in sync because they have to figure out bounding box stuff which calls into big block methods which look at worlds at a whole, not just the chunk\nI would assume Paper then waits for the next sync chunk to load the entities and declare the chunk 'loaded'\n\nAt this point, we have deadlocked because the sync thread is unable to progress in order to process the final chunk load, yet in order to progress the chunk must be loaded.", "url": "https://github.com/EssentialsX/Essentials/pull/3102#discussion_r403652041", "createdAt": "2020-04-05T05:35:54Z", "author": {"login": "Ichbinjoe"}, "path": "Essentials/src/com/earth2me/essentials/Jails.java", "diffHunk": "@@ -117,12 +118,31 @@ public void removeJail(final String jail) throws Exception {\n     }\n \n     @Override\n+    @Deprecated\n     public void sendToJail(final IUser user, final String jail) throws Exception {\n+        CompletableFuture<Exception> eFuture = new CompletableFuture<>();\n+        CompletableFuture<Boolean> future = new CompletableFuture<>();\n+        sendToJail(user, jail, eFuture, future);\n+        if (!future.get()) {\n+            throw eFuture.get();\n+        }", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "24cd053ce5b6390454fb9e7035a388dacf88e3d3"}, "originalPosition": 19}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f1e3bf72ed0a60e67da37e79a156e88a0ce37a76", "author": {"user": {"login": "JRoy", "name": "Josh Roy"}}, "url": "https://github.com/EssentialsX/Essentials/commit/f1e3bf72ed0a60e67da37e79a156e88a0ce37a76", "committedDate": "2020-04-06T19:34:25Z", "message": "Fix /jail using deprecated method"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ca9ebc1f5c5ff85af696ce569bd232465ed6d69a", "author": {"user": {"login": "JRoy", "name": "Josh Roy"}}, "url": "https://github.com/EssentialsX/Essentials/commit/ca9ebc1f5c5ff85af696ce569bd232465ed6d69a", "committedDate": "2020-04-06T19:45:00Z", "message": "Fix jail join handler using deprecated method"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "6f4d95709edadf941ad02aeeeec6f9a34e6e855e", "author": {"user": {"login": "JRoy", "name": "Josh Roy"}}, "url": "https://github.com/EssentialsX/Essentials/commit/6f4d95709edadf941ad02aeeeec6f9a34e6e855e", "committedDate": "2020-04-06T19:49:04Z", "message": "Merge branch '2.x' into feature/better-async"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "30ce336b7f3ccd5874b4b2b5185676fc55d02d73", "author": {"user": {"login": "JRoy", "name": "Josh Roy"}}, "url": "https://github.com/EssentialsX/Essentials/commit/30ce336b7f3ccd5874b4b2b5185676fc55d02d73", "committedDate": "2020-04-10T18:53:22Z", "message": "Rename all teleport classes to indicate async"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b2f6ce9100a6ad613611bb1976e50a84dd231127", "author": {"user": {"login": "JRoy", "name": "Josh Roy"}}, "url": "https://github.com/EssentialsX/Essentials/commit/b2f6ce9100a6ad613611bb1976e50a84dd231127", "committedDate": "2020-04-10T18:56:01Z", "message": "Remove deprecated methods"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "8e87db821cfb9f4e0dfb95895ef68d10bcf491d0", "author": {"user": {"login": "JRoy", "name": "Josh Roy"}}, "url": "https://github.com/EssentialsX/Essentials/commit/8e87db821cfb9f4e0dfb95895ef68d10bcf491d0", "committedDate": "2020-04-10T19:25:12Z", "message": "Add (and deprecate) old teleport api"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "07a346522a089dc639fbd18ed1d011ecd697017d", "author": {"user": {"login": "JRoy", "name": "Josh Roy"}}, "url": "https://github.com/EssentialsX/Essentials/commit/07a346522a089dc639fbd18ed1d011ecd697017d", "committedDate": "2020-04-10T19:37:12Z", "message": "Revert TimedTeleport.java"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "5aa587856faa3005d1987a28886e1ba51427e975", "author": {"user": {"login": "JRoy", "name": "Josh Roy"}}, "url": "https://github.com/EssentialsX/Essentials/commit/5aa587856faa3005d1987a28886e1ba51427e975", "committedDate": "2020-04-10T19:42:56Z", "message": "Reduce Diff"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "9302e413e97ff077192c403594c148a279ed2991", "author": {"user": {"login": "JRoy", "name": "Josh Roy"}}, "url": "https://github.com/EssentialsX/Essentials/commit/9302e413e97ff077192c403594c148a279ed2991", "committedDate": "2020-04-10T19:46:15Z", "message": "Add legacy sendToJail method"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "fd0ce61530843bd862ccd8dd0e55137fa1a3035c", "author": {"user": {"login": "JRoy", "name": "Josh Roy"}}, "url": "https://github.com/EssentialsX/Essentials/commit/fd0ce61530843bd862ccd8dd0e55137fa1a3035c", "committedDate": "2020-04-10T19:49:59Z", "message": "Reduce Diff Further"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzkyMTExNjcy", "url": "https://github.com/EssentialsX/Essentials/pull/3102#pullrequestreview-392111672", "createdAt": "2020-04-13T12:20:13Z", "commit": {"oid": "fd0ce61530843bd862ccd8dd0e55137fa1a3035c"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xM1QxMjoyMDoxNFrOGEk5hw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xM1QxMjoyMDoxNFrOGEk5hw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNzQ1MjAzOQ==", "bodyText": "As far as I can tell, the throw new NoChargeException() is to prevent players paying the command cost for both the /jump command and the teleport itself. Does this change alter this behaviour (or am I reading it wrong)?", "url": "https://github.com/EssentialsX/Essentials/pull/3102#discussion_r407452039", "createdAt": "2020-04-13T12:20:14Z", "author": {"login": "mdcfe"}, "path": "Essentials/src/com/earth2me/essentials/commands/Commandjump.java", "diffHunk": "@@ -46,8 +47,7 @@ public void run(final Server server, final User user, final String commandLabel,\n \n         final Trade charge = new Trade(this.getName(), ess);\n         charge.isAffordableFor(user);\n-        user.getTeleport().teleport(loc, charge, TeleportCause.COMMAND);\n-        throw new NoChargeException();\n+        user.getAsyncTeleport().teleport(loc, charge, TeleportCause.COMMAND, getNewExceptionFuture(user.getSource(), commandLabel), new CompletableFuture<>());", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "fd0ce61530843bd862ccd8dd0e55137fa1a3035c"}, "originalPosition": 14}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzkyMTEzNjU1", "url": "https://github.com/EssentialsX/Essentials/pull/3102#pullrequestreview-392113655", "createdAt": "2020-04-13T12:25:01Z", "commit": {"oid": "fd0ce61530843bd862ccd8dd0e55137fa1a3035c"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xM1QxMjoyNTowMVrOGEk_4g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xM1QxMjoyNTowMVrOGEk_4g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNzQ1MzY2Ng==", "bodyText": "Same concern over NoChargeException as earlier", "url": "https://github.com/EssentialsX/Essentials/pull/3102#discussion_r407453666", "createdAt": "2020-04-13T12:25:01Z", "author": {"login": "mdcfe"}, "path": "Essentials/src/com/earth2me/essentials/commands/Commandtppos.java", "diffHunk": "@@ -55,8 +56,7 @@ public void run(final Server server, final User user, final String commandLabel,\n         final Trade charge = new Trade(this.getName(), ess);\n         charge.isAffordableFor(user);\n         user.sendMessage(tl(\"teleporting\", loc.getWorld().getName(), loc.getBlockX(), loc.getBlockY(), loc.getBlockZ()));\n-        user.getTeleport().teleport(loc, charge, TeleportCause.COMMAND);\n-        throw new NoChargeException();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "fd0ce61530843bd862ccd8dd0e55137fa1a3035c"}, "originalPosition": 13}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzkyMTE0Nzkx", "url": "https://github.com/EssentialsX/Essentials/pull/3102#pullrequestreview-392114791", "createdAt": "2020-04-13T12:27:50Z", "commit": {"oid": "fd0ce61530843bd862ccd8dd0e55137fa1a3035c"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xM1QxMjoyNzo1MFrOGElDvQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xM1QxMjoyNzo1MFrOGElDvQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNzQ1NDY1Mw==", "bodyText": "What's the functional difference between using these two lines and just calling getNewExceptionFuture()?", "url": "https://github.com/EssentialsX/Essentials/pull/3102#discussion_r407454653", "createdAt": "2020-04-13T12:27:50Z", "author": {"login": "mdcfe"}, "path": "Essentials/src/com/earth2me/essentials/commands/Commandtpo.java", "diffHunk": "@@ -17,6 +18,8 @@ public Commandtpo() {\n \n     @Override\n     public void run(final Server server, final User user, final String commandLabel, final String[] args) throws Exception {\n+        CompletableFuture<Exception> eFuture = new CompletableFuture<>();\n+        eFuture.thenAccept(e -> showError(user.getBase(), e, commandLabel));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "fd0ce61530843bd862ccd8dd0e55137fa1a3035c"}, "originalPosition": 13}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "332545e675dc506fcb54c193a248756194b53c0c", "author": {"user": {"login": "JRoy", "name": "Josh Roy"}}, "url": "https://github.com/EssentialsX/Essentials/commit/332545e675dc506fcb54c193a248756194b53c0c", "committedDate": "2020-04-13T14:15:00Z", "message": "Use getNewExceptionFuture in Commandtpo"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzkyMTk1MzUw", "url": "https://github.com/EssentialsX/Essentials/pull/3102#pullrequestreview-392195350", "createdAt": "2020-04-13T14:53:43Z", "commit": {"oid": "332545e675dc506fcb54c193a248756194b53c0c"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 6, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xM1QxNDo1Mzo0M1rOGEpCDg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xM1QxNDo1NTo0OVrOGEpGjA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNzUxOTc1OA==", "bodyText": "getNewExceptionFuture", "url": "https://github.com/EssentialsX/Essentials/pull/3102#discussion_r407519758", "createdAt": "2020-04-13T14:53:43Z", "author": {"login": "mdcfe"}, "path": "Essentials/src/com/earth2me/essentials/commands/Commandhome.java", "diffHunk": "@@ -38,30 +38,32 @@ public void run(final Server server, final User user, final String commandLabel,\n                 }\n             }\n         }\n+        CompletableFuture<Exception> eFuture = new CompletableFuture<>();\n+        eFuture.thenAccept(e -> showError(user.getBase(), e, commandLabel));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "332545e675dc506fcb54c193a248756194b53c0c"}, "originalPosition": 17}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNzUyMDE3MQ==", "bodyText": "Another getNewExceptionFuture", "url": "https://github.com/EssentialsX/Essentials/pull/3102#discussion_r407520171", "createdAt": "2020-04-13T14:54:29Z", "author": {"login": "mdcfe"}, "path": "Essentials/src/com/earth2me/essentials/commands/Commandtp.java", "diffHunk": "@@ -23,6 +22,9 @@ public Commandtp() {\n \n     @Override\n     public void run(final Server server, final User user, final String commandLabel, final String[] args) throws Exception {\n+        CompletableFuture<Exception> eFuture = new CompletableFuture<>();\n+        CompletableFuture<Boolean> future = new CompletableFuture<>();\n+        eFuture.thenAccept(e -> showError(user.getBase(), e, commandLabel));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "332545e675dc506fcb54c193a248756194b53c0c"}, "originalPosition": 22}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNzUyMDQ4NQ==", "bodyText": "getNewExceptionFuture", "url": "https://github.com/EssentialsX/Essentials/pull/3102#discussion_r407520485", "createdAt": "2020-04-13T14:55:01Z", "author": {"login": "mdcfe"}, "path": "Essentials/src/com/earth2me/essentials/commands/Commandtpaccept.java", "diffHunk": "@@ -49,24 +51,32 @@ public void run(final Server server, final User user, final String commandLabel,\n         user.sendMessage(tl(\"requestAccepted\"));\n         requester.sendMessage(tl(\"requestAcceptedFrom\", user.getDisplayName()));\n \n-        try {\n-            if (user.isTpRequestHere()) {\n-                final Location loc = user.getTpRequestLocation();\n-                Teleport teleport = requester.getTeleport();\n-                teleport.setTpType(Teleport.TeleportType.TPA);\n-                teleport.teleportPlayer(user, user.getTpRequestLocation(), charge, TeleportCause.COMMAND);\n-                requester.sendMessage(tl(\"teleporting\", loc.getWorld().getName(), loc.getBlockX(), loc.getBlockY(), loc.getBlockZ()));\n-            } else {\n-                Teleport teleport = requester.getTeleport();\n-                teleport.setTpType(Teleport.TeleportType.TPA);\n-                teleport.teleport(user.getBase(), charge, TeleportCause.COMMAND);\n-            }\n-        } catch (Exception ex) {\n+        CompletableFuture<Exception> eFuture = new CompletableFuture<>();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "332545e675dc506fcb54c193a248756194b53c0c"}, "originalPosition": 33}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNzUyMDYyNw==", "bodyText": "getNewExceptionFuture", "url": "https://github.com/EssentialsX/Essentials/pull/3102#discussion_r407520627", "createdAt": "2020-04-13T14:55:18Z", "author": {"login": "mdcfe"}, "path": "Essentials/src/com/earth2me/essentials/commands/Commandtpall.java", "diffHunk": "@@ -41,11 +42,9 @@ private void teleportAllPlayers(Server server, CommandSource sender, User target\n             if (sender.equals(target.getBase()) && target.getWorld() != player.getWorld() && ess.getSettings().isWorldTeleportPermissions() && !target.isAuthorized(\"essentials.worlds.\" + target.getWorld().getName())) {\n                 continue;\n             }\n-            try {\n-                player.getTeleport().now(loc, false, TeleportCause.COMMAND);\n-            } catch (Exception ex) {\n-                ess.showError(sender, ex, getName());\n-            }\n+            CompletableFuture<Exception> eFuture = new CompletableFuture<>();\n+            eFuture.thenAccept(e -> showError(sender.getSender(), e, label));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "332545e675dc506fcb54c193a248756194b53c0c"}, "originalPosition": 39}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNzUyMDc5Mg==", "bodyText": "getNewExceptionFuture", "url": "https://github.com/EssentialsX/Essentials/pull/3102#discussion_r407520792", "createdAt": "2020-04-13T14:55:35Z", "author": {"login": "mdcfe"}, "path": "Essentials/src/com/earth2me/essentials/commands/Commandtpoffline.java", "diffHunk": "@@ -28,7 +30,9 @@ public void run(final Server server, final User user, final String label, final\n                 }\n \n                 user.sendMessage(tl(\"teleporting\", logout.getWorld().getName(), logout.getBlockX(), logout.getBlockY(), logout.getBlockZ()));\n-                user.getTeleport().now(logout, false, PlayerTeleportEvent.TeleportCause.COMMAND);\n+                CompletableFuture<Exception> eFuture = new CompletableFuture<>();\n+                eFuture.thenAccept(e -> showError(user.getBase(), e, label));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "332545e675dc506fcb54c193a248756194b53c0c"}, "originalPosition": 15}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNzUyMDkwOA==", "bodyText": "getNewExceptionFuture", "url": "https://github.com/EssentialsX/Essentials/pull/3102#discussion_r407520908", "createdAt": "2020-04-13T14:55:49Z", "author": {"login": "mdcfe"}, "path": "Essentials/src/com/earth2me/essentials/commands/Commandtpohere.java", "diffHunk": "@@ -28,8 +29,9 @@ public void run(final Server server, final User user, final String commandLabel,\n             throw new Exception(tl(\"noPerm\", \"essentials.worlds.\" + user.getWorld().getName()));\n         }\n \n-        // Verify permission\n-        player.getTeleport().now(user.getBase(), false, TeleportCause.COMMAND);\n+        CompletableFuture<Exception> eFuture = new CompletableFuture<>();\n+        eFuture.thenAccept(e -> showError(user.getBase(), e, commandLabel));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "332545e675dc506fcb54c193a248756194b53c0c"}, "originalPosition": 15}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d4df801271f808abb4160a242a8625e849f03465", "author": {"user": {"login": "JRoy", "name": "Josh Roy"}}, "url": "https://github.com/EssentialsX/Essentials/commit/d4df801271f808abb4160a242a8625e849f03465", "committedDate": "2020-04-13T15:44:59Z", "message": "Use getNewExceptionFuture everywhere"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzkyMzc5MjM2", "url": "https://github.com/EssentialsX/Essentials/pull/3102#pullrequestreview-392379236", "createdAt": "2020-04-13T19:31:47Z", "commit": {"oid": "d4df801271f808abb4160a242a8625e849f03465"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xM1QxOTozMTo0N1rOGEyTHw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xM1QxOTozMTo0N1rOGEyTHw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNzY3MTU4Mw==", "bodyText": "Seems like I missed this one the first time around.", "url": "https://github.com/EssentialsX/Essentials/pull/3102#discussion_r407671583", "createdAt": "2020-04-13T19:31:47Z", "author": {"login": "mdcfe"}, "path": "Essentials/src/com/earth2me/essentials/commands/Commandtp.java", "diffHunk": "@@ -113,7 +121,9 @@ public void run(final Server server, final CommandSource sender, final String co\n         if (args.length == 2) {\n             final User toPlayer = getPlayer(server, args, 1, true, false);\n             target.sendMessage(tl(\"teleportAtoB\", Console.NAME, toPlayer.getDisplayName()));\n-            target.getTeleport().now(toPlayer.getBase(), false, TeleportCause.COMMAND);\n+            CompletableFuture<Exception> eFuture = new CompletableFuture<>();\n+            target.getAsyncTeleport().now(toPlayer.getBase(), false, TeleportCause.COMMAND, eFuture, new CompletableFuture<>());\n+            eFuture.thenAccept(e -> showError(sender.getSender(), e, commandLabel));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d4df801271f808abb4160a242a8625e849f03465"}, "originalPosition": 81}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzkyMzc5OTU2", "url": "https://github.com/EssentialsX/Essentials/pull/3102#pullrequestreview-392379956", "createdAt": "2020-04-13T19:32:57Z", "commit": {"oid": "d4df801271f808abb4160a242a8625e849f03465"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xM1QxOTozMjo1N1rOGEyViA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xM1QxOTozMjo1N1rOGEyViA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNzY3MjIwMA==", "bodyText": "Also this one.", "url": "https://github.com/EssentialsX/Essentials/pull/3102#discussion_r407672200", "createdAt": "2020-04-13T19:32:57Z", "author": {"login": "mdcfe"}, "path": "Essentials/src/com/earth2me/essentials/commands/Commandtp.java", "diffHunk": "@@ -123,8 +133,15 @@ public void run(final Server server, final CommandSource sender, final String co\n             }\n             final Location loc = new Location(target.getWorld(), x, y, z, target.getLocation().getYaw(), target.getLocation().getPitch());\n             sender.sendMessage(tl(\"teleporting\", loc.getWorld().getName(), loc.getBlockX(), loc.getBlockY(), loc.getBlockZ()));\n-            target.getTeleport().now(loc, false, TeleportCause.COMMAND);\n-            target.sendMessage(tl(\"teleporting\", loc.getWorld().getName(), loc.getBlockX(), loc.getBlockY(), loc.getBlockZ()));\n+            CompletableFuture<Exception> eFuture = new CompletableFuture<>();\n+            CompletableFuture<Boolean> future = new CompletableFuture<>();\n+            target.getAsyncTeleport().now(loc, false, TeleportCause.COMMAND, eFuture, future);\n+            future.thenAccept(success -> {\n+                if (success) {\n+                    target.sendMessage(tl(\"teleporting\", loc.getWorld().getName(), loc.getBlockX(), loc.getBlockY(), loc.getBlockZ()));\n+                }\n+            });\n+            eFuture.thenAccept(e -> showError(sender.getSender(), e, commandLabel));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d4df801271f808abb4160a242a8625e849f03465"}, "originalPosition": 99}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "944f112d557b181f4b4755ae63fbaef22b0805e2", "author": {"user": {"login": "JRoy", "name": "Josh Roy"}}, "url": "https://github.com/EssentialsX/Essentials/commit/944f112d557b181f4b4755ae63fbaef22b0805e2", "committedDate": "2020-04-13T19:34:53Z", "message": "Fix even more usages"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzkyMzgzMTMy", "url": "https://github.com/EssentialsX/Essentials/pull/3102#pullrequestreview-392383132", "createdAt": "2020-04-13T19:38:09Z", "commit": {"oid": "944f112d557b181f4b4755ae63fbaef22b0805e2"}, "state": "DISMISSED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzkzMjk2Mjc0", "url": "https://github.com/EssentialsX/Essentials/pull/3102#pullrequestreview-393296274", "createdAt": "2020-04-14T21:07:19Z", "commit": {"oid": "944f112d557b181f4b4755ae63fbaef22b0805e2"}, "state": "DISMISSED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xNFQyMTowNzoxOVrOGFg8UA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xNFQyMToyNTo0N1rOGFhhuw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwODQzNTc5Mg==", "bodyText": "ok", "url": "https://github.com/EssentialsX/Essentials/pull/3102#discussion_r408435792", "createdAt": "2020-04-14T21:07:19Z", "author": {"login": "pop4959"}, "path": "Essentials/src/com/earth2me/essentials/api/ITeleport.java", "diffHunk": "@@ -117,17 +129,19 @@\n      *\n      * @param teleporter - The user performing the /back command.\n      *                   This value may be {@code null} to indicate console.\n-     * @param chargeFor - What the {@code teleporter} will be charged if teleportPlayer is successful\n+     * @param chargeFor  - What the {@code teleporter} will be charged if teleportPlayer is successful", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "944f112d557b181f4b4755ae63fbaef22b0805e2"}, "originalPosition": 87}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwODQ0NTM3MQ==", "bodyText": "Logger::info would also work here", "url": "https://github.com/EssentialsX/Essentials/pull/3102#discussion_r408445371", "createdAt": "2020-04-14T21:25:47Z", "author": {"login": "pop4959"}, "path": "Essentials/src/com/earth2me/essentials/commands/EssentialsCommand.java", "diffHunk": "@@ -344,6 +347,21 @@ private static boolean canInteractWith(User interactor, User interactee) {\n         return command.tabComplete(sender.getSender(), label, effectiveArgs);\n     }\n \n+    @Override\n+    public void showError(CommandSender sender, Throwable throwable, String commandLabel) {\n+        sender.sendMessage(tl(\"errorWithMessage\", throwable.getMessage()));\n+        if (ess.getSettings().isDebug()) {\n+            ess.getLogger().log(Level.INFO, tl(\"errorCallingCommand\", commandLabel), throwable);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "944f112d557b181f4b4755ae63fbaef22b0805e2"}, "originalPosition": 24}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzk2MTQxODEx", "url": "https://github.com/EssentialsX/Essentials/pull/3102#pullrequestreview-396141811", "createdAt": "2020-04-20T05:06:51Z", "commit": {"oid": "944f112d557b181f4b4755ae63fbaef22b0805e2"}, "state": "DISMISSED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "015eeedc07957d2dcf3f9ef5f09585211dfce91c", "author": {"user": {"login": "JRoy", "name": "Josh Roy"}}, "url": "https://github.com/EssentialsX/Essentials/commit/015eeedc07957d2dcf3f9ef5f09585211dfce91c", "committedDate": "2020-04-20T16:36:48Z", "message": "Revert LocationUtil.java"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "1013dd8ab912c0574d0694112ba0e54fc0d97f17", "author": {"user": {"login": "JRoy", "name": "Josh Roy"}}, "url": "https://github.com/EssentialsX/Essentials/commit/1013dd8ab912c0574d0694112ba0e54fc0d97f17", "committedDate": "2020-04-20T16:41:39Z", "message": "Fix issue causing unsafe locations to not work properly"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c9d35b4945f55f2d3db000f0078df0dcd2148f07", "author": {"user": {"login": "JRoy", "name": "Josh Roy"}}, "url": "https://github.com/EssentialsX/Essentials/commit/c9d35b4945f55f2d3db000f0078df0dcd2148f07", "committedDate": "2020-04-20T20:01:24Z", "message": "Add deprecated notice in IUser implementation"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "606b2040eef2b5425243706b1bd183d0abccd4f9", "author": {"user": {"login": "JRoy", "name": "Josh Roy"}}, "url": "https://github.com/EssentialsX/Essentials/commit/606b2040eef2b5425243706b1bd183d0abccd4f9", "committedDate": "2020-04-20T20:37:12Z", "message": "Use CompletableFuture#completeExceptionally for exceptions"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e95ce2a5d6c849d8eae3e947bef74aaecba43cc2", "author": {"user": {"login": "JRoy", "name": "Josh Roy"}}, "url": "https://github.com/EssentialsX/Essentials/commit/e95ce2a5d6c849d8eae3e947bef74aaecba43cc2", "committedDate": "2020-04-20T20:44:18Z", "message": "Use Essentials' logger in EssentialsCommand#showError"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "5a194fbce2ffdc82a5ceeb25e1f084b09fd851eb", "author": {"user": {"login": "JRoy", "name": "Josh Roy"}}, "url": "https://github.com/EssentialsX/Essentials/commit/5a194fbce2ffdc82a5ceeb25e1f084b09fd851eb", "committedDate": "2020-04-21T13:47:31Z", "message": "Return implementation rather than interface"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "806d607b5761a2a7f8a7c9e19a00fab26f7b00b9", "author": {"user": {"login": "JRoy", "name": "Josh Roy"}}, "url": "https://github.com/EssentialsX/Essentials/commit/806d607b5761a2a7f8a7c9e19a00fab26f7b00b9", "committedDate": "2020-04-24T15:06:49Z", "message": "Merge branch '2.x' into feature/better-async"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "613665a7f6bbe4f485def052812b4e82448b5e9e", "author": {"user": {"login": "JRoy", "name": "Josh Roy"}}, "url": "https://github.com/EssentialsX/Essentials/commit/613665a7f6bbe4f485def052812b4e82448b5e9e", "committedDate": "2020-04-27T21:42:06Z", "message": "Merge branch '2.x' into feature/better-async"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDA0NDA1MTkw", "url": "https://github.com/EssentialsX/Essentials/pull/3102#pullrequestreview-404405190", "createdAt": "2020-05-01T21:15:58Z", "commit": {"oid": "613665a7f6bbe4f485def052812b4e82448b5e9e"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wMVQyMToxNTo1OFrOGPV8cw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wMVQyMToxNTo1OFrOGPV8cw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxODc0MTM2Mw==", "bodyText": "This logic is called on main, thus this will deadlock; need to check the current thread before doing this", "url": "https://github.com/EssentialsX/Essentials/pull/3102#discussion_r418741363", "createdAt": "2020-05-01T21:15:58Z", "author": {"login": "electronicboy"}, "path": "Essentials/src/com/earth2me/essentials/AsyncTeleport.java", "diffHunk": "@@ -0,0 +1,419 @@\n+package com.earth2me.essentials;\n+\n+import com.earth2me.essentials.api.IAsyncTeleport;\n+import com.earth2me.essentials.commands.WarpNotFoundException;\n+import com.earth2me.essentials.utils.DateUtil;\n+import com.earth2me.essentials.utils.LocationUtil;\n+import io.papermc.lib.PaperLib;\n+import net.ess3.api.IEssentials;\n+import net.ess3.api.IUser;\n+import net.ess3.api.InvalidWorldException;\n+import net.ess3.api.events.UserTeleportEvent;\n+import net.ess3.api.events.UserWarpEvent;\n+import org.bukkit.Bukkit;\n+import org.bukkit.Location;\n+import org.bukkit.entity.Player;\n+import org.bukkit.event.player.PlayerRespawnEvent;\n+import org.bukkit.event.player.PlayerTeleportEvent.TeleportCause;\n+\n+import java.math.BigDecimal;\n+import java.util.Calendar;\n+import java.util.GregorianCalendar;\n+import java.util.concurrent.CompletableFuture;\n+import java.util.concurrent.ExecutionException;\n+\n+import static com.earth2me.essentials.I18n.tl;\n+\n+\n+public class AsyncTeleport implements IAsyncTeleport {\n+    private final IUser teleportOwner;\n+    private final IEssentials ess;\n+    private AsyncTimedTeleport timedTeleport;\n+\n+    private TeleportType tpType;\n+\n+    public AsyncTeleport(IUser user, IEssentials ess) {\n+        this.teleportOwner = user;\n+        this.ess = ess;\n+        tpType = TeleportType.NORMAL;\n+    }\n+\n+    public enum TeleportType {\n+        TPA,\n+        BACK,\n+        NORMAL\n+    }\n+\n+    public void cooldown(boolean check) throws Throwable {\n+        CompletableFuture<Boolean> exceptionFuture = new CompletableFuture<>();\n+        if (cooldown(check, exceptionFuture)) {\n+            try {\n+                exceptionFuture.get();\n+            } catch (ExecutionException e) {\n+                throw e.getCause();\n+            }\n+        }\n+    }\n+\n+    public boolean cooldown(boolean check, CompletableFuture<Boolean> future) {\n+        final Calendar time = new GregorianCalendar();\n+        if (teleportOwner.getLastTeleportTimestamp() > 0) {\n+            // Take the current time, and remove the delay from it.\n+            final double cooldown = ess.getSettings().getTeleportCooldown();\n+            final Calendar earliestTime = new GregorianCalendar();\n+            earliestTime.add(Calendar.SECOND, -(int) cooldown);\n+            earliestTime.add(Calendar.MILLISECOND, -(int) ((cooldown * 1000.0) % 1000.0));\n+            // This value contains the most recent time a teleportPlayer could have been used that would allow another use.\n+            final long earliestLong = earliestTime.getTimeInMillis();\n+\n+            // When was the last teleportPlayer used?\n+            final long lastTime = teleportOwner.getLastTeleportTimestamp();\n+\n+            if (lastTime > time.getTimeInMillis()) {\n+                // This is to make sure time didn't get messed up on last teleportPlayer use.\n+                // If this happens, let's give the user the benifit of the doubt.\n+                teleportOwner.setLastTeleportTimestamp(time.getTimeInMillis());\n+                return false;\n+            } else if (lastTime > earliestLong\n+                && cooldownApplies()) {\n+                time.setTimeInMillis(lastTime);\n+                time.add(Calendar.SECOND, (int) cooldown);\n+                time.add(Calendar.MILLISECOND, (int) ((cooldown * 1000.0) % 1000.0));\n+                future.completeExceptionally(new Exception(tl(\"timeBeforeTeleport\", DateUtil.formatDateDiff(time.getTimeInMillis()))));\n+                return true;\n+            }\n+        }\n+        // if justCheck is set, don't update lastTeleport; we're just checking\n+        if (!check) {\n+            teleportOwner.setLastTeleportTimestamp(time.getTimeInMillis());\n+        }\n+        return false;\n+    }\n+\n+    private boolean cooldownApplies() {\n+        boolean applies = true;\n+        String globalBypassPerm = \"essentials.teleport.cooldown.bypass\";\n+        switch (tpType) {\n+            case NORMAL:\n+                applies = !teleportOwner.isAuthorized(globalBypassPerm);\n+                break;\n+            case BACK:\n+                applies = !(teleportOwner.isAuthorized(globalBypassPerm) &&\n+                    teleportOwner.isAuthorized(\"essentials.teleport.cooldown.bypass.back\"));\n+                break;\n+            case TPA:\n+                applies = !(teleportOwner.isAuthorized(globalBypassPerm) &&\n+                    teleportOwner.isAuthorized(\"essentials.teleport.cooldown.bypass.tpa\"));\n+                break;\n+        }\n+        return applies;\n+    }\n+\n+    private void warnUser(final IUser user, final double delay) {\n+        Calendar c = new GregorianCalendar();\n+        c.add(Calendar.SECOND, (int) delay);\n+        c.add(Calendar.MILLISECOND, (int) ((delay * 1000.0) % 1000.0));\n+        user.sendMessage(tl(\"dontMoveMessage\", DateUtil.formatDateDiff(c.getTimeInMillis())));\n+    }\n+\n+\n+    @Override\n+    public void now(Location loc, boolean cooldown, TeleportCause cause, CompletableFuture<Boolean> future) {\n+        if (cooldown && cooldown(false, future)) {\n+            return;\n+        }\n+        final ITarget target = new LocationTarget(loc);\n+        nowAsync(teleportOwner, target, cause, future);\n+    }\n+\n+    @Override\n+    public void now(Player entity, boolean cooldown, TeleportCause cause, CompletableFuture<Boolean> future) {\n+        if (cooldown && cooldown(false, future)) {\n+            future.complete(false);\n+            return;\n+        }\n+        final ITarget target = new PlayerTarget(entity);\n+        nowAsync(teleportOwner, target, cause, future);\n+        future.thenAccept(success -> {\n+            if (success) {\n+                teleportOwner.sendMessage(tl(\"teleporting\", target.getLocation().getWorld().getName(), target.getLocation().getBlockX(), target.getLocation().getBlockY(), target.getLocation().getBlockZ()));\n+            }\n+        });\n+    }\n+\n+    protected void nowAsync(IUser teleportee, ITarget target, TeleportCause cause, CompletableFuture<Boolean> future) {\n+        cancel(false);\n+\n+        UserTeleportEvent event = new UserTeleportEvent(teleportee, cause, target.getLocation());\n+        Bukkit.getServer().getPluginManager().callEvent(event);\n+        if (event.isCancelled()) {\n+            return;\n+        }\n+        teleportee.setLastLocation();\n+\n+        if (!teleportee.getBase().isEmpty()) {\n+            if (!ess.getSettings().isTeleportPassengerDismount()) {\n+                future.completeExceptionally(new Exception(tl(\"passengerTeleportFail\")));\n+                return;\n+            }\n+            CompletableFuture<Object> dismountFuture = new CompletableFuture<>();\n+            Bukkit.getScheduler().runTask(ess, () -> {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "613665a7f6bbe4f485def052812b4e82448b5e9e"}, "originalPosition": 160}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "80a7dcb7894f3fe5d5e8dd2fd09dc01dd6a9483e", "author": {"user": {"login": "JRoy", "name": "Josh Roy"}}, "url": "https://github.com/EssentialsX/Essentials/commit/80a7dcb7894f3fe5d5e8dd2fd09dc01dd6a9483e", "committedDate": "2020-05-02T17:49:55Z", "message": "Avoid possible deadlocks with entity ejections"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b92ea836086062040c300e2d1057fc57b3794449", "author": {"user": {"login": "JRoy", "name": "Josh Roy"}}, "url": "https://github.com/EssentialsX/Essentials/commit/b92ea836086062040c300e2d1057fc57b3794449", "committedDate": "2020-05-02T17:50:10Z", "message": "Merge remote-tracking branch 'origin/feature/better-async' into feature/better-async"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e72746e628a38df4c77c08ff4b6611a0166005c0", "author": {"user": {"login": "JRoy", "name": "Josh Roy"}}, "url": "https://github.com/EssentialsX/Essentials/commit/e72746e628a38df4c77c08ff4b6611a0166005c0", "committedDate": "2020-05-11T06:38:46Z", "message": "Nuke some sync loads with homes\n\nTook 7 hours and 2 PRs to paper but it's here!"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDA4OTI5MzQ5", "url": "https://github.com/EssentialsX/Essentials/pull/3102#pullrequestreview-408929349", "createdAt": "2020-05-11T07:37:13Z", "commit": {"oid": "e72746e628a38df4c77c08ff4b6611a0166005c0"}, "state": "DISMISSED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDA4NjYyNjU4", "url": "https://github.com/EssentialsX/Essentials/pull/3102#pullrequestreview-408662658", "createdAt": "2020-05-09T16:04:14Z", "commit": {"oid": "b92ea836086062040c300e2d1057fc57b3794449"}, "state": "APPROVED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wOVQxNjowNDoxNVrOGS8L2A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xMVQxNjo1MTo1NlrOGTkyyw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMjUxMzYyNA==", "bodyText": "Could you undo the indentation changes here to clean up the diff?", "url": "https://github.com/EssentialsX/Essentials/pull/3102#discussion_r422513624", "createdAt": "2020-05-09T16:04:15Z", "author": {"login": "mdcfe"}, "path": "Essentials/src/com/earth2me/essentials/IUser.java", "diffHunk": "@@ -154,13 +161,13 @@\n     Map<String, Object> getConfigMap();\n \n     Map<String, Object> getConfigMap(String node);\n-    \n+", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b92ea836086062040c300e2d1057fc57b3794449"}, "originalPosition": 30}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMzE3ODk1NQ==", "bodyText": "Even if it seems redundant, changing this import from net.ess3.api.ITeleport might cause ABI breakage with plugins that built against the class when it had the old import.", "url": "https://github.com/EssentialsX/Essentials/pull/3102#discussion_r423178955", "createdAt": "2020-05-11T16:51:56Z", "author": {"login": "mdcfe"}, "path": "Essentials/src/com/earth2me/essentials/IUser.java", "diffHunk": "@@ -1,7 +1,8 @@\n package com.earth2me.essentials;\n \n+import com.earth2me.essentials.api.IAsyncTeleport;\n+import com.earth2me.essentials.api.ITeleport;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e72746e628a38df4c77c08ff4b6611a0166005c0"}, "originalPosition": 4}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDA5MzU1OTU4", "url": "https://github.com/EssentialsX/Essentials/pull/3102#pullrequestreview-409355958", "createdAt": "2020-05-11T16:57:31Z", "commit": {"oid": "e72746e628a38df4c77c08ff4b6611a0166005c0"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "318ef7c9ce255c0c30cfd0c54b559c8ad4f8daed", "author": {"user": {"login": "JRoy", "name": "Josh Roy"}}, "url": "https://github.com/EssentialsX/Essentials/commit/318ef7c9ce255c0c30cfd0c54b559c8ad4f8daed", "committedDate": "2020-05-11T17:02:50Z", "message": "Fix ABI and make the codestyle worse"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "85a49421620cf8ed4b580d62ab98dca79c5e71ac", "author": {"user": {"login": "JRoy", "name": "Josh Roy"}}, "url": "https://github.com/EssentialsX/Essentials/commit/85a49421620cf8ed4b580d62ab98dca79c5e71ac", "committedDate": "2020-05-11T17:14:31Z", "message": "Make the codestyle worse because muh diff"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c3ee63c04f3a2f44e7ca03ca756b50bef80f0141", "author": {"user": {"login": "JRoy", "name": "Josh Roy"}}, "url": "https://github.com/EssentialsX/Essentials/commit/c3ee63c04f3a2f44e7ca03ca756b50bef80f0141", "committedDate": "2020-05-11T17:15:10Z", "message": "Further ruin the codestyle"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDA5NDYwODYw", "url": "https://github.com/EssentialsX/Essentials/pull/3102#pullrequestreview-409460860", "createdAt": "2020-05-11T19:21:19Z", "commit": {"oid": "c3ee63c04f3a2f44e7ca03ca756b50bef80f0141"}, "state": "DISMISSED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "5c9f775ce57b6974743b6607a0063be9b58ef8f5", "author": {"user": {"login": "JRoy", "name": "Josh Roy"}}, "url": "https://github.com/EssentialsX/Essentials/commit/5c9f775ce57b6974743b6607a0063be9b58ef8f5", "committedDate": "2020-05-22T00:33:44Z", "message": "Merge branch '2.x' into feature/better-async"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "dec46ac803656b78b132076bde58a357363ce616", "author": {"user": {"login": "JRoy", "name": "Josh Roy"}}, "url": "https://github.com/EssentialsX/Essentials/commit/dec46ac803656b78b132076bde58a357363ce616", "committedDate": "2020-05-25T05:37:57Z", "message": "Fix error messages not showing in TimedTeleports"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDE4OTI1NzIy", "url": "https://github.com/EssentialsX/Essentials/pull/3102#pullrequestreview-418925722", "createdAt": "2020-05-27T07:30:07Z", "commit": {"oid": "dec46ac803656b78b132076bde58a357363ce616"}, "state": "DISMISSED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e22a03c8535f3719a1a0ba06a2d4a1a3b9439ebe", "author": {"user": {"login": "JRoy", "name": "Josh Roy"}}, "url": "https://github.com/EssentialsX/Essentials/commit/e22a03c8535f3719a1a0ba06a2d4a1a3b9439ebe", "committedDate": "2020-06-11T21:58:56Z", "message": "Improve messages around beds for /home"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "9efa1147d3daab7223bec584a54b61f8f268501d", "author": {"user": {"login": "JRoy", "name": "Josh Roy"}}, "url": "https://github.com/EssentialsX/Essentials/commit/9efa1147d3daab7223bec584a54b61f8f268501d", "committedDate": "2020-06-11T22:19:37Z", "message": "Fix #3274\n\nAllow unsafe locations for different worlds + spectator mode"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "7ad5bb6c6d0a258f79ba255706e5ee3aaf06a6f7", "author": {"user": {"login": "JRoy", "name": "Josh Roy"}}, "url": "https://github.com/EssentialsX/Essentials/commit/7ad5bb6c6d0a258f79ba255706e5ee3aaf06a6f7", "committedDate": "2020-06-16T21:00:11Z", "message": "Fix fly safety operators"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDM1MjE1OTE2", "url": "https://github.com/EssentialsX/Essentials/pull/3102#pullrequestreview-435215916", "createdAt": "2020-06-22T19:34:55Z", "commit": {"oid": "7ad5bb6c6d0a258f79ba255706e5ee3aaf06a6f7"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDM2MjQwODg2", "url": "https://github.com/EssentialsX/Essentials/pull/3102#pullrequestreview-436240886", "createdAt": "2020-06-24T00:10:16Z", "commit": {"oid": "7ad5bb6c6d0a258f79ba255706e5ee3aaf06a6f7"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDM2MjQxNDY3", "url": "https://github.com/EssentialsX/Essentials/pull/3102#pullrequestreview-436241467", "createdAt": "2020-06-24T00:12:09Z", "commit": {"oid": "7ad5bb6c6d0a258f79ba255706e5ee3aaf06a6f7"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDM2MjQ1NDcy", "url": "https://github.com/EssentialsX/Essentials/pull/3102#pullrequestreview-436245472", "createdAt": "2020-06-24T00:25:07Z", "commit": {"oid": "7ad5bb6c6d0a258f79ba255706e5ee3aaf06a6f7"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDM2MjY0MTk3", "url": "https://github.com/EssentialsX/Essentials/pull/3102#pullrequestreview-436264197", "createdAt": "2020-06-24T01:29:21Z", "commit": {"oid": "7ad5bb6c6d0a258f79ba255706e5ee3aaf06a6f7"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDM2NDQ2ODM2", "url": "https://github.com/EssentialsX/Essentials/pull/3102#pullrequestreview-436446836", "createdAt": "2020-06-24T08:47:08Z", "commit": {"oid": "7ad5bb6c6d0a258f79ba255706e5ee3aaf06a6f7"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4829, "cost": 1, "resetAt": "2021-11-01T14:20:25Z"}}}