{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0Mzg5NjcwNzk2", "number": 414, "title": "XRDDEV-886: System settings view", "bodyText": "JIRA ticket: https://jira.niis.org/browse/XRDDEV-886\nAlso added permission checking functionality to large and small button components.", "createdAt": "2020-03-17T07:31:18Z", "url": "https://github.com/nordic-institute/X-Road/pull/414", "merged": true, "mergeCommit": {"oid": "3416188a7c4ebce62a78bf9aad0edd91a337a670"}, "closed": true, "closedAt": "2020-03-17T10:42:43Z", "author": {"login": "raits"}, "timelineItems": {"totalCount": 9, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcMlXt7AH2gAyMzg5NjcwNzk2OjU4YTY5ZDIxYzQ0ZWFjY2JlNDRkMDZkZDg0ZmUwYTUwZDA0Yjk3ZGM=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcOgWK6AFqTM3NTkxNzg2MA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "58a69d21c44eaccbe44d06dd84fe0a50d04b97dc", "author": {"user": {"login": "raits", "name": "Raido Kaju"}}, "url": "https://github.com/nordic-institute/X-Road/commit/58a69d21c44eaccbe44d06dd84fe0a50d04b97dc", "committedDate": "2020-03-11T11:25:34Z", "message": "XRDDEV-886: initial layout"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a92f99c8372412f37e686707723ab24e71ea8b83", "author": {"user": {"login": "raits", "name": "Raido Kaju"}}, "url": "https://github.com/nordic-institute/X-Road/commit/a92f99c8372412f37e686707723ab24e71ea8b83", "committedDate": "2020-03-11T13:02:37Z", "message": "XRDDEV-886: permission handling, rest service connection for anchor and TSP"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "156dd9fa666f6f9c90b7a675ce6fb8af5f0cdcb4", "author": {"user": {"login": "raits", "name": "Raido Kaju"}}, "url": "https://github.com/nordic-institute/X-Road/commit/156dd9fa666f6f9c90b7a675ce6fb8af5f0cdcb4", "committedDate": "2020-03-12T10:54:04Z", "message": "XRDDEV-886: type definitions from XRDDEV-885 branch"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "db9067d9b02907c44a02ae2422fe035c83dbb16e", "author": {"user": {"login": "raits", "name": "Raido Kaju"}}, "url": "https://github.com/nordic-institute/X-Road/commit/db9067d9b02907c44a02ae2422fe035c83dbb16e", "committedDate": "2020-03-12T11:30:49Z", "message": "XRDDEV-886: linting and approved CA api call"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c4d33ae2e823fa377752b31d8542af9106c503ed", "author": {"user": {"login": "raits", "name": "Raido Kaju"}}, "url": "https://github.com/nordic-institute/X-Road/commit/c4d33ae2e823fa377752b31d8542af9106c503ed", "committedDate": "2020-03-17T07:29:36Z", "message": "XRDDEV-886: approved CA implementation"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzc1ODU5Mzkx", "url": "https://github.com/nordic-institute/X-Road/pull/414#pullrequestreview-375859391", "createdAt": "2020-03-17T09:21:07Z", "commit": {"oid": "c4d33ae2e823fa377752b31d8542af9106c503ed"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xN1QwOToyMTowN1rOF3TzMw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xN1QwOToyMTowN1rOF3TzMw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MzU0MDQwMw==", "bodyText": "The hearers are \"black\" or darker in the design.\nAlso some fonts seem larger or bolder compared to the design.", "url": "https://github.com/nordic-institute/X-Road/pull/414#discussion_r393540403", "createdAt": "2020-03-17T09:21:07Z", "author": {"login": "Riippi"}, "path": "src/proxy-ui-api/frontend/src/views/Settings/SystemParameters/SystemParameters.vue", "diffHunk": "@@ -0,0 +1,175 @@\n+<template>\n+  <div class=\"pt-2\">\n+    <v-card flat class=\"xrd-card\">\n+      <v-container>\n+        <v-row v-if=\"hasPermission(permissions.VIEW_ANCHOR)\">\n+          <v-col><h3>{{$t('systemParameters.configurationAnchor.title')}}</h3></v-col>\n+          <v-col class=\"text-right\">\n+            <large-button data-test=\"system-parameters-configuration-anchor-download-button\" outlined :requires-permission=\"permissions.DOWNLOAD_ANCHOR\">\n+              {{$t('systemParameters.configurationAnchor.action.download')}}\n+            </large-button>\n+            <large-button data-test=\"system-parameters-configuration-anchor-upload-button\" outlined :requires-permission=\"permissions.UPLOAD_ANCHOR\" class=\"ml-5\">\n+              {{$t('systemParameters.configurationAnchor.action.upload')}}\n+            </large-button>\n+          </v-col>\n+        </v-row>\n+        <v-row v-if=\"hasPermission(permissions.VIEW_ANCHOR)\">\n+          <v-col>\n+            <table class=\"xrd-table\">\n+              <thead>\n+              <tr>\n+                <th>{{$t('systemParameters.configurationAnchor.table.header.distinguishedName')}}</th>\n+                <th>{{$t('systemParameters.configurationAnchor.table.header.generated')}}</th>\n+              </tr>\n+              </thead>\n+              <tbody data-test=\"system-parameters-configuration-anchor-table-body\">\n+              <tr>\n+                <td>{{this.configuratonAnchor.hash}}</td>\n+                <td>{{this.configuratonAnchor.created_at | formatDateTime}}</td>\n+              </tr>\n+              </tbody>\n+            </table>\n+          </v-col>\n+        </v-row>\n+        <v-row class=\"mt-5\" v-if=\"hasPermission(permissions.VIEW_TSPS)\">\n+          <v-col><h3>{{$t('systemParameters.timestampingServices.title')}}</h3></v-col>\n+          <v-col class=\"text-right\">\n+            <large-button data-test=\"system-parameters-timestamping-services-add-button\" outlined :requires-permission=\"permissions.ADD_TSP\">\n+              {{$t('systemParameters.timestampingServices.action.add')}}\n+            </large-button>\n+          </v-col>\n+        </v-row>\n+        <v-row v-if=\"hasPermission(permissions.VIEW_TSPS)\">\n+          <v-col>\n+            <table class=\"xrd-table\">\n+              <thead>\n+              <tr>\n+                <th>{{$t('systemParameters.timestampingServices.table.header.certificateHash')}}</th>\n+                <th>{{$t('systemParameters.timestampingServices.table.header.serviceURL')}}</th>\n+                <th>&nbsp;</th>\n+              </tr>\n+              </thead>\n+              <tbody data-test=\"system-parameters-timestamping-services-table-body\">\n+              <tr v-for=\"timestampingService in this.configuredTimestampingServices\" :key=\"timestampingService.url\">\n+                <td>{{timestampingService.name}}</td>\n+                <td>{{timestampingService.url}}</td>\n+                <td>\n+                  <small-button data-test=\"system-parameters-timestamping-services-delete-button\" outlined :requires-permission=\"permissions.DELETE_TSP\">\n+                    {{$t('systemParameters.timestampingServices.table.action.delete')}}\n+                  </small-button>\n+                </td>\n+              </tr>\n+              </tbody>\n+            </table>\n+          </v-col>\n+        </v-row>\n+        <v-row class=\"mt-5\">\n+          <v-col><h3>{{$t('systemParameters.approvedCertificateAuthorities.title')}}</h3></v-col>\n+        </v-row>\n+        <v-row>\n+          <v-col>\n+            <table class=\"xrd-table\">\n+              <thead>\n+              <tr>\n+                <th>{{$t('systemParameters.approvedCertificateAuthorities.table.header.distinguishedName')}}</th>\n+                <th>{{$t('systemParameters.approvedCertificateAuthorities.table.header.ocspResponse')}}</th>\n+                <th>{{$t('systemParameters.approvedCertificateAuthorities.table.header.expires')}}</th>\n+              </tr>\n+              </thead>\n+              <tbody data-test=\"system-parameters-approved-ca-table-body\">\n+              <tr v-for=\"approvedCA in orderedCertificateAuthorities\" :key=\"approvedCA.path\">\n+                <td :class=\"{'interm-ca': !approvedCA.top_ca}\">{{approvedCA.subject_distinguished_name}}</td>\n+                <td v-if=\"approvedCA.top_ca\">{{$t('systemParameters.approvedCertificateAuthorities.table.ocspResponse.NOT_AVAILABLE')}}</td>\n+                <td v-if=\"!approvedCA.top_ca\">{{$t(`systemParameters.approvedCertificateAuthorities.table.ocspResponse.${approvedCA.ocsp_response}`)}}</td>\n+                <td>{{approvedCA.not_after | formatDate}}</td>\n+              </tr>\n+              </tbody>\n+            </table>\n+          </v-col>\n+        </v-row>\n+      </v-container>\n+    </v-card>\n+  </div>\n+</template>\n+\n+<script lang=\"ts\">\n+import Vue from 'vue';\n+import LargeButton from '@/components/ui/LargeButton.vue';\n+import SmallButton from '@/components/ui/SmallButton.vue';\n+import { Anchor, CertificateAuthority, TimestampingService } from '@/types';\n+import * as api from '@/util/api';\n+import { Permissions } from '@/global';\n+\n+export default Vue.extend({\n+  components: {\n+    LargeButton,\n+    SmallButton,\n+  },\n+  data() {\n+    return {\n+      configuratonAnchor: {} as Anchor,\n+      configuredTimestampingServices: [] as TimestampingService[],\n+      certificateAuthorities: [] as CertificateAuthority[],\n+      permissions: Permissions,\n+    };\n+  },\n+  computed: {\n+    orderedCertificateAuthorities(): CertificateAuthority[] {\n+      return this.certificateAuthorities.sort((authorityA, authorityB) => authorityA.path.localeCompare(authorityB.path));\n+    },\n+  },\n+  methods: {\n+    hasPermission(permission: Permissions): boolean {\n+      return this.$store.getters.hasPermission(permission);\n+    },\n+    async fetchConfigurationAnchor() {\n+      return api.get('/system/anchor')\n+        .then((resp) => this.configuratonAnchor = resp.data)\n+        .catch((error) => this.$bus.$emit('show-error', error.message));\n+    },\n+    async fetchConfiguredTimestampingServiced() {\n+      return api.get('/system/timestamping-services')\n+        .then((resp) => this.configuredTimestampingServices = resp.data)\n+        .catch((error) => this.$bus.$emit('show-error', error.message));\n+    },\n+    async fetchApprovedCertificateAuthorities() {\n+      return api.get('/certificate-authorities?include_intermediate_cas=true')\n+        .then((resp) => this.certificateAuthorities = resp.data)\n+        .catch((error) => this.$bus.$emit('show-error', error.message));\n+    },\n+  },\n+  created(): void {\n+    this.fetchConfigurationAnchor();\n+    this.fetchConfiguredTimestampingServiced();\n+    this.fetchApprovedCertificateAuthorities();\n+  },\n+});\n+</script>\n+\n+<style lang=\"scss\" scoped>\n+  @import \"../../../assets/colors\";\n+  @import '../../../assets/tables';\n+\n+  h3 {\n+    color: $XRoad-Grey60;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c4d33ae2e823fa377752b31d8542af9106c503ed"}, "originalPosition": 154}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "906ecfde47b8a6938c808bf5e63781f8505592d5", "author": {"user": {"login": "raits", "name": "Raido Kaju"}}, "url": "https://github.com/nordic-institute/X-Road/commit/906ecfde47b8a6938c808bf5e63781f8505592d5", "committedDate": "2020-03-17T09:48:57Z", "message": "XRDDEV-886: styling fixes"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c6ec281b0c1b63067db53107c8f7f560c9941965", "author": {"user": {"login": "raits", "name": "Raido Kaju"}}, "url": "https://github.com/nordic-institute/X-Road/commit/c6ec281b0c1b63067db53107c8f7f560c9941965", "committedDate": "2020-03-17T09:52:36Z", "message": "Merge branch 'develop' into XRDDEV-886"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzc1OTE3ODYw", "url": "https://github.com/nordic-institute/X-Road/pull/414#pullrequestreview-375917860", "createdAt": "2020-03-17T10:42:12Z", "commit": {"oid": "c6ec281b0c1b63067db53107c8f7f560c9941965"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4157, "cost": 1, "resetAt": "2021-11-01T16:19:10Z"}}}