{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0Mzc1ODI0ODUw", "number": 372, "reviewThreads": {"totalCount": 11, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xN1QxMTo0NzoyN1rODgXKuQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xN1QxMjo1OTo0N1rODgYZ9A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjM1MjYwNjAxOnYy", "diffSide": "RIGHT", "path": "src/proxy-ui-api/src/main/java/org/niis/xroad/restapi/converter/TimestampingServiceConverter.java", "isResolved": true, "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xN1QxMTo0NzoyN1rOFqhreg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xOFQyMDoyODo1OFrOFrRVOw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MDEzNjMxNA==", "bodyText": "Instead of multi-type-converters with instanceof conditional it would probably be more consistent with the existing converters to have separate convert(Iterable<String> list) and convert(<TspType> list) methods.\nI have another suggestion about removing convert(Iterable) altogether elsewhere, though.", "url": "https://github.com/nordic-institute/X-Road/pull/372#discussion_r380136314", "createdAt": "2020-02-17T11:47:27Z", "author": {"login": "jansu76"}, "path": "src/proxy-ui-api/src/main/java/org/niis/xroad/restapi/converter/TimestampingServiceConverter.java", "diffHunk": "@@ -57,7 +59,15 @@ public TimestampingService convert(String url)  {\n         return timestampingService;\n     }\n \n-    public List<TimestampingService> convert(Iterable<String> urls)  {\n-        return Streams.stream(urls).map(this::convert).collect(Collectors.toList());\n+    public TimestampingService convert(TspType tsp)  {\n+        TimestampingService timestampingService = new TimestampingService();\n+        timestampingService.setUrl(tsp.getUrl());\n+        timestampingService.setName(tsp.getName());\n+        return timestampingService;\n+    }\n+\n+    public List<TimestampingService> convert(Iterable<?> list)  {\n+        return Streams.stream(list).map(n -> n instanceof String ? convert((String)n) : convert((TspType)n))", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "16f8bc1c64e70cf1592b13ae542ac8e69f189960"}, "originalPosition": 23}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MDI0MDI2OA==", "bodyText": "Having methods convert(Iterable<String> list) and convert(Iterable<TspType> list) is not possible, because they still have the same erasure.\nOne alternative would be name them differently, e.g., convertString(Iterable<String> list) and convertTspType(Iterable<TspType> list).", "url": "https://github.com/nordic-institute/X-Road/pull/372#discussion_r380240268", "createdAt": "2020-02-17T15:19:11Z", "author": {"login": "petkivim"}, "path": "src/proxy-ui-api/src/main/java/org/niis/xroad/restapi/converter/TimestampingServiceConverter.java", "diffHunk": "@@ -57,7 +59,15 @@ public TimestampingService convert(String url)  {\n         return timestampingService;\n     }\n \n-    public List<TimestampingService> convert(Iterable<String> urls)  {\n-        return Streams.stream(urls).map(this::convert).collect(Collectors.toList());\n+    public TimestampingService convert(TspType tsp)  {\n+        TimestampingService timestampingService = new TimestampingService();\n+        timestampingService.setUrl(tsp.getUrl());\n+        timestampingService.setName(tsp.getName());\n+        return timestampingService;\n+    }\n+\n+    public List<TimestampingService> convert(Iterable<?> list)  {\n+        return Streams.stream(list).map(n -> n instanceof String ? convert((String)n) : convert((TspType)n))", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MDEzNjMxNA=="}, "originalCommit": {"oid": "16f8bc1c64e70cf1592b13ae542ac8e69f189960"}, "originalPosition": 23}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MDkxNzA1MQ==", "bodyText": "Ah, I did not realize that. Yeah, different names could be one option. I am still thinking we could avoid that though - more at #372 (comment).", "url": "https://github.com/nordic-institute/X-Road/pull/372#discussion_r380917051", "createdAt": "2020-02-18T20:28:58Z", "author": {"login": "jansu76"}, "path": "src/proxy-ui-api/src/main/java/org/niis/xroad/restapi/converter/TimestampingServiceConverter.java", "diffHunk": "@@ -57,7 +59,15 @@ public TimestampingService convert(String url)  {\n         return timestampingService;\n     }\n \n-    public List<TimestampingService> convert(Iterable<String> urls)  {\n-        return Streams.stream(urls).map(this::convert).collect(Collectors.toList());\n+    public TimestampingService convert(TspType tsp)  {\n+        TimestampingService timestampingService = new TimestampingService();\n+        timestampingService.setUrl(tsp.getUrl());\n+        timestampingService.setName(tsp.getName());\n+        return timestampingService;\n+    }\n+\n+    public List<TimestampingService> convert(Iterable<?> list)  {\n+        return Streams.stream(list).map(n -> n instanceof String ? convert((String)n) : convert((TspType)n))", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MDEzNjMxNA=="}, "originalCommit": {"oid": "16f8bc1c64e70cf1592b13ae542ac8e69f189960"}, "originalPosition": 23}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjM1MjYyOTc5OnYy", "diffSide": "RIGHT", "path": "src/proxy-ui-api/src/main/java/org/niis/xroad/restapi/service/TimestampingServiceService.java", "isResolved": true, "comments": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xN1QxMTo1NjowMlrOFqh6AQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xOVQwNTozMjowOFrOFrblig==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MDE0MDAzMw==", "bodyText": "What do you think about changing this to public Collection<TspType> getApprovedTimestampingServices() with TspType.id = null (and documenting that in the javadoc)? That would make it easier for the callers to handle both types of timestamping services with same constructs, especially it would enable bit of simplification for TimestampingServiceConverter and remove globalConfFacade calls from it. It would make converter layer more thin and dumb and I think unless there's some trouble related to that, we should try to do that to focus business logic inside the service layer. There's some exceptions to this (member name lookups, security server owner lookups) but ideally they should be minimized.", "url": "https://github.com/nordic-institute/X-Road/pull/372#discussion_r380140033", "createdAt": "2020-02-17T11:56:02Z", "author": {"login": "jansu76"}, "path": "src/proxy-ui-api/src/main/java/org/niis/xroad/restapi/service/TimestampingServiceService.java", "diffHunk": "@@ -42,20 +47,106 @@\n public class TimestampingServiceService {\n \n     private final GlobalConfService globalConfService;\n+    private final ServerConfService serverConfService;\n \n     /**\n      * constructor\n      */\n     @Autowired\n-    public TimestampingServiceService(GlobalConfService globalConfService) {\n+    public TimestampingServiceService(GlobalConfService globalConfService, ServerConfService serverConfService) {\n         this.globalConfService = globalConfService;\n+        this.serverConfService = serverConfService;\n     }\n \n     /**\n-     * Return timestamping authorities\n+     * Return approved timestamping authorities\n      * @return\n      */\n-    public Collection<String> getTimestampingServices() {\n+    public Collection<String> getApprovedTimestampingServices() {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "16f8bc1c64e70cf1592b13ae542ac8e69f189960"}, "originalPosition": 41}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MDI0MDc4MA==", "bodyText": "I ended up removing the whole TimestampingServiceService class since it was not really needed after the API changes.", "url": "https://github.com/nordic-institute/X-Road/pull/372#discussion_r380240780", "createdAt": "2020-02-17T15:20:15Z", "author": {"login": "petkivim"}, "path": "src/proxy-ui-api/src/main/java/org/niis/xroad/restapi/service/TimestampingServiceService.java", "diffHunk": "@@ -42,20 +47,106 @@\n public class TimestampingServiceService {\n \n     private final GlobalConfService globalConfService;\n+    private final ServerConfService serverConfService;\n \n     /**\n      * constructor\n      */\n     @Autowired\n-    public TimestampingServiceService(GlobalConfService globalConfService) {\n+    public TimestampingServiceService(GlobalConfService globalConfService, ServerConfService serverConfService) {\n         this.globalConfService = globalConfService;\n+        this.serverConfService = serverConfService;\n     }\n \n     /**\n-     * Return timestamping authorities\n+     * Return approved timestamping authorities\n      * @return\n      */\n-    public Collection<String> getTimestampingServices() {\n+    public Collection<String> getApprovedTimestampingServices() {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MDE0MDAzMw=="}, "originalCommit": {"oid": "16f8bc1c64e70cf1592b13ae542ac8e69f189960"}, "originalPosition": 41}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MDkxOTg1NQ==", "bodyText": "All right. The question about converter / service roles remains still though.\nWhat do you think about something like this: e750d03 ?\nI think TimestampingServiceConverter and GlobalConfService are a bit more close to what their roles \"usually\" are, and converter is thinner and dumber.\nDisclaimer: I did not live test this. Automatic tests pass though.", "url": "https://github.com/nordic-institute/X-Road/pull/372#discussion_r380919855", "createdAt": "2020-02-18T20:35:17Z", "author": {"login": "jansu76"}, "path": "src/proxy-ui-api/src/main/java/org/niis/xroad/restapi/service/TimestampingServiceService.java", "diffHunk": "@@ -42,20 +47,106 @@\n public class TimestampingServiceService {\n \n     private final GlobalConfService globalConfService;\n+    private final ServerConfService serverConfService;\n \n     /**\n      * constructor\n      */\n     @Autowired\n-    public TimestampingServiceService(GlobalConfService globalConfService) {\n+    public TimestampingServiceService(GlobalConfService globalConfService, ServerConfService serverConfService) {\n         this.globalConfService = globalConfService;\n+        this.serverConfService = serverConfService;\n     }\n \n     /**\n-     * Return timestamping authorities\n+     * Return approved timestamping authorities\n      * @return\n      */\n-    public Collection<String> getTimestampingServices() {\n+    public Collection<String> getApprovedTimestampingServices() {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MDE0MDAzMw=="}, "originalCommit": {"oid": "16f8bc1c64e70cf1592b13ae542ac8e69f189960"}, "originalPosition": 41}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MTA4NTA2Ng==", "bodyText": "I think that your solution looks good. Now the service layer returns TspType objects for both approved and configured  timestamping services which makes the implementation more consistent and simplifies the converter.\nI merged the changes, tested the API manually, and everything works as expected.", "url": "https://github.com/nordic-institute/X-Road/pull/372#discussion_r381085066", "createdAt": "2020-02-19T05:32:08Z", "author": {"login": "petkivim"}, "path": "src/proxy-ui-api/src/main/java/org/niis/xroad/restapi/service/TimestampingServiceService.java", "diffHunk": "@@ -42,20 +47,106 @@\n public class TimestampingServiceService {\n \n     private final GlobalConfService globalConfService;\n+    private final ServerConfService serverConfService;\n \n     /**\n      * constructor\n      */\n     @Autowired\n-    public TimestampingServiceService(GlobalConfService globalConfService) {\n+    public TimestampingServiceService(GlobalConfService globalConfService, ServerConfService serverConfService) {\n         this.globalConfService = globalConfService;\n+        this.serverConfService = serverConfService;\n     }\n \n     /**\n-     * Return timestamping authorities\n+     * Return approved timestamping authorities\n      * @return\n      */\n-    public Collection<String> getTimestampingServices() {\n+    public Collection<String> getApprovedTimestampingServices() {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MDE0MDAzMw=="}, "originalCommit": {"oid": "16f8bc1c64e70cf1592b13ae542ac8e69f189960"}, "originalPosition": 41}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjM1MjY1NTQ5OnYy", "diffSide": "RIGHT", "path": "src/proxy-ui-api/src/main/java/org/niis/xroad/restapi/service/TimestampingServiceService.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xN1QxMjowNTozMlrOFqiJnQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xN1QxNToyMDozMlrOFqoEMw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MDE0NDAyOQ==", "bodyText": "There is a possibility to simplify a little bit these \"find first match\" checks by using streams, as in e.g. \n  \n    \n      X-Road/src/proxy-ui-api/src/main/java/org/niis/xroad/restapi/service/ClientService.java\n    \n    \n        Lines 237 to 242\n      in\n      c5d7658\n    \n    \n    \n    \n\n        \n          \n           Optional<CertificateType> duplicate = clientType.getIsCert().stream() \n        \n\n        \n          \n                   .filter(cert -> hash.equalsIgnoreCase(calculateCertHexHash(cert.getData()))) \n        \n\n        \n          \n                   .findFirst(); \n        \n\n        \n          \n           if (duplicate.isPresent()) { \n        \n\n        \n          \n               throw new CertificateAlreadyExistsException(\"certificate already exists\"); \n        \n\n        \n          \n           }", "url": "https://github.com/nordic-institute/X-Road/pull/372#discussion_r380144029", "createdAt": "2020-02-17T12:05:32Z", "author": {"login": "jansu76"}, "path": "src/proxy-ui-api/src/main/java/org/niis/xroad/restapi/service/TimestampingServiceService.java", "diffHunk": "@@ -42,20 +47,106 @@\n public class TimestampingServiceService {\n \n     private final GlobalConfService globalConfService;\n+    private final ServerConfService serverConfService;\n \n     /**\n      * constructor\n      */\n     @Autowired\n-    public TimestampingServiceService(GlobalConfService globalConfService) {\n+    public TimestampingServiceService(GlobalConfService globalConfService, ServerConfService serverConfService) {\n         this.globalConfService = globalConfService;\n+        this.serverConfService = serverConfService;\n     }\n \n     /**\n-     * Return timestamping authorities\n+     * Return approved timestamping authorities\n      * @return\n      */\n-    public Collection<String> getTimestampingServices() {\n+    public Collection<String> getApprovedTimestampingServices() {\n         return globalConfService.getApprovedTspsForThisInstance();\n     }\n+\n+    /**\n+     * Return a list of configured timestamping services\n+     * @return\n+     */\n+    public List<TspType> getConfiguredTimestampingServices() {\n+        return serverConfService.getConfiguredTimestampingServices();\n+    }\n+\n+    public void addConfiguredTimestampingService(TimestampingService timestampingServiceToAdd)\n+            throws TimestampingServiceNotFoundException, DuplicateConfiguredTimestampingServiceException {\n+        // Check that the timestamping service is an approved timestamping service\n+        boolean match = false;\n+        for (String url: getApprovedTimestampingServices()) {\n+            if (timestampingServiceToAdd.getName().equals(globalConfService.getApprovedTspName(url))\n+                    && timestampingServiceToAdd.getUrl().equals(url)) {\n+                match = true;\n+                break;\n+            }\n+        }\n+        if (!match) {\n+            throw new TimestampingServiceNotFoundException(getExceptionMessage(timestampingServiceToAdd.getName(),\n+                    timestampingServiceToAdd.getUrl(), \"not found\"));\n+        }", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "16f8bc1c64e70cf1592b13ae542ac8e69f189960"}, "originalPosition": 67}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MDI0MDk0Nw==", "bodyText": "Fixed.", "url": "https://github.com/nordic-institute/X-Road/pull/372#discussion_r380240947", "createdAt": "2020-02-17T15:20:32Z", "author": {"login": "petkivim"}, "path": "src/proxy-ui-api/src/main/java/org/niis/xroad/restapi/service/TimestampingServiceService.java", "diffHunk": "@@ -42,20 +47,106 @@\n public class TimestampingServiceService {\n \n     private final GlobalConfService globalConfService;\n+    private final ServerConfService serverConfService;\n \n     /**\n      * constructor\n      */\n     @Autowired\n-    public TimestampingServiceService(GlobalConfService globalConfService) {\n+    public TimestampingServiceService(GlobalConfService globalConfService, ServerConfService serverConfService) {\n         this.globalConfService = globalConfService;\n+        this.serverConfService = serverConfService;\n     }\n \n     /**\n-     * Return timestamping authorities\n+     * Return approved timestamping authorities\n      * @return\n      */\n-    public Collection<String> getTimestampingServices() {\n+    public Collection<String> getApprovedTimestampingServices() {\n         return globalConfService.getApprovedTspsForThisInstance();\n     }\n+\n+    /**\n+     * Return a list of configured timestamping services\n+     * @return\n+     */\n+    public List<TspType> getConfiguredTimestampingServices() {\n+        return serverConfService.getConfiguredTimestampingServices();\n+    }\n+\n+    public void addConfiguredTimestampingService(TimestampingService timestampingServiceToAdd)\n+            throws TimestampingServiceNotFoundException, DuplicateConfiguredTimestampingServiceException {\n+        // Check that the timestamping service is an approved timestamping service\n+        boolean match = false;\n+        for (String url: getApprovedTimestampingServices()) {\n+            if (timestampingServiceToAdd.getName().equals(globalConfService.getApprovedTspName(url))\n+                    && timestampingServiceToAdd.getUrl().equals(url)) {\n+                match = true;\n+                break;\n+            }\n+        }\n+        if (!match) {\n+            throw new TimestampingServiceNotFoundException(getExceptionMessage(timestampingServiceToAdd.getName(),\n+                    timestampingServiceToAdd.getUrl(), \"not found\"));\n+        }", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MDE0NDAyOQ=="}, "originalCommit": {"oid": "16f8bc1c64e70cf1592b13ae542ac8e69f189960"}, "originalPosition": 67}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjM1MjY3MzE2OnYy", "diffSide": "RIGHT", "path": "src/proxy-ui-api/src/main/java/org/niis/xroad/restapi/openapi/TimestampingServicesApiController.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xN1QxMjoxMjozMFrOFqiU_g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xN1QxNToyMTo1OVrOFqoHPw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MDE0Njk0Mg==", "bodyText": "We've used a convention where ResourceNotFoundException is reserved for resource as in http URL. So since resource is /timestamping-services, that resource exists and the problem is in the request body, not the \"resource\" identified by the URL. By that logic this would be a BadRequestException (a problem with request body).\nAn example of this \n  \n    \n      X-Road/src/proxy-ui-api/src/main/java/org/niis/xroad/restapi/openapi/TokensApiController.java\n    \n    \n        Lines 207 to 222\n      in\n      c5d7658\n    \n    \n    \n    \n\n        \n          \n           try { \n        \n\n        \n          \n               keyAndCertRequest = keyAndCertificateRequestService.addKeyAndCertRequest( \n        \n\n        \n          \n                       tokenId, keyLabelWithCsrGenerate.getKeyLabel(), \n        \n\n        \n          \n                       memberId, \n        \n\n        \n          \n                       keyUsageInfo, \n        \n\n        \n          \n                       csrGenerate.getCaName(), \n        \n\n        \n          \n                       csrGenerate.getSubjectFieldValues(), \n        \n\n        \n          \n                       csrFormat); \n        \n\n        \n          \n           } catch (ClientNotFoundException | CertificateAuthorityNotFoundException \n        \n\n        \n          \n                   | DnFieldHelper.InvalidDnParameterException e) { \n        \n\n        \n          \n               throw new BadRequestException(e); \n        \n\n        \n          \n           } catch (ActionNotPossibleException e) { \n        \n\n        \n          \n               throw new ConflictException(e); \n        \n\n        \n          \n           } catch (TokenNotFoundException e) { \n        \n\n        \n          \n               throw new ResourceNotFoundException(e); \n        \n\n        \n          \n           } \n        \n    \n  \n\n where ClientNotFoundException -> BadRequestException and TokenNotFoundException -> ResourceNotFound (token id is in the URL)", "url": "https://github.com/nordic-institute/X-Road/pull/372#discussion_r380146942", "createdAt": "2020-02-17T12:12:30Z", "author": {"login": "jansu76"}, "path": "src/proxy-ui-api/src/main/java/org/niis/xroad/restapi/openapi/TimestampingServicesApiController.java", "diffHunk": "@@ -62,9 +65,42 @@ public TimestampingServicesApiController(TimestampingServiceService timestamping\n \n     @Override\n     @PreAuthorize(\"hasAuthority('VIEW_TSPS')\")\n-    public ResponseEntity<List<TimestampingService>> getTimestampingServices() {\n-        Collection<String> urls = timestampingServiceService.getTimestampingServices();\n-        List<TimestampingService> timestampingServices = timestampingServiceConverter.convert(urls);\n+    public ResponseEntity<List<TimestampingService>> getTimestampingServices(Boolean showConfigured) {\n+        List<TimestampingService> timestampingServices;\n+        // If show configured is true, return configured timestamping services from serverconf db.\n+        // Otherwise return approved timestamping services from global conf.\n+        if (showConfigured) {\n+            List<TspType> tsps = timestampingServiceService.getConfiguredTimestampingServices();\n+            timestampingServices = timestampingServiceConverter.convert(tsps);\n+        } else {\n+            Collection<String> urls = timestampingServiceService.getApprovedTimestampingServices();\n+            timestampingServices = timestampingServiceConverter.convert(urls);\n+        }\n         return new ResponseEntity<>(timestampingServices, HttpStatus.OK);\n     }\n+\n+    @Override\n+    @PreAuthorize(\"hasAuthority('ADD_TSP')\")\n+    public ResponseEntity<TimestampingService> addTimestampingService(TimestampingService timestampingServiceToAdd) {\n+        try {\n+            timestampingServiceService.addConfiguredTimestampingService(timestampingServiceToAdd);\n+        } catch (TimestampingServiceService.DuplicateConfiguredTimestampingServiceException e) {\n+            throw new ConflictException(e);\n+        } catch (TimestampingServiceNotFoundException e) {\n+            throw new ResourceNotFoundException(e);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "16f8bc1c64e70cf1592b13ae542ac8e69f189960"}, "originalPosition": 42}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MDI0MTcyNw==", "bodyText": "Changed this to TimestampingServiceNotFoundException => BadRequest.", "url": "https://github.com/nordic-institute/X-Road/pull/372#discussion_r380241727", "createdAt": "2020-02-17T15:21:59Z", "author": {"login": "petkivim"}, "path": "src/proxy-ui-api/src/main/java/org/niis/xroad/restapi/openapi/TimestampingServicesApiController.java", "diffHunk": "@@ -62,9 +65,42 @@ public TimestampingServicesApiController(TimestampingServiceService timestamping\n \n     @Override\n     @PreAuthorize(\"hasAuthority('VIEW_TSPS')\")\n-    public ResponseEntity<List<TimestampingService>> getTimestampingServices() {\n-        Collection<String> urls = timestampingServiceService.getTimestampingServices();\n-        List<TimestampingService> timestampingServices = timestampingServiceConverter.convert(urls);\n+    public ResponseEntity<List<TimestampingService>> getTimestampingServices(Boolean showConfigured) {\n+        List<TimestampingService> timestampingServices;\n+        // If show configured is true, return configured timestamping services from serverconf db.\n+        // Otherwise return approved timestamping services from global conf.\n+        if (showConfigured) {\n+            List<TspType> tsps = timestampingServiceService.getConfiguredTimestampingServices();\n+            timestampingServices = timestampingServiceConverter.convert(tsps);\n+        } else {\n+            Collection<String> urls = timestampingServiceService.getApprovedTimestampingServices();\n+            timestampingServices = timestampingServiceConverter.convert(urls);\n+        }\n         return new ResponseEntity<>(timestampingServices, HttpStatus.OK);\n     }\n+\n+    @Override\n+    @PreAuthorize(\"hasAuthority('ADD_TSP')\")\n+    public ResponseEntity<TimestampingService> addTimestampingService(TimestampingService timestampingServiceToAdd) {\n+        try {\n+            timestampingServiceService.addConfiguredTimestampingService(timestampingServiceToAdd);\n+        } catch (TimestampingServiceService.DuplicateConfiguredTimestampingServiceException e) {\n+            throw new ConflictException(e);\n+        } catch (TimestampingServiceNotFoundException e) {\n+            throw new ResourceNotFoundException(e);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MDE0Njk0Mg=="}, "originalCommit": {"oid": "16f8bc1c64e70cf1592b13ae542ac8e69f189960"}, "originalPosition": 42}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjM1MjY3NzEyOnYy", "diffSide": "RIGHT", "path": "src/proxy-ui-api/src/main/java/org/niis/xroad/restapi/openapi/TimestampingServicesApiController.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xN1QxMjoxMzo0OFrOFqiXPg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xN1QxNToyMjoxMlrOFqoHpg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MDE0NzUxOA==", "bodyText": "Probably BadRequest (see earlier)", "url": "https://github.com/nordic-institute/X-Road/pull/372#discussion_r380147518", "createdAt": "2020-02-17T12:13:48Z", "author": {"login": "jansu76"}, "path": "src/proxy-ui-api/src/main/java/org/niis/xroad/restapi/openapi/TimestampingServicesApiController.java", "diffHunk": "@@ -62,9 +65,42 @@ public TimestampingServicesApiController(TimestampingServiceService timestamping\n \n     @Override\n     @PreAuthorize(\"hasAuthority('VIEW_TSPS')\")\n-    public ResponseEntity<List<TimestampingService>> getTimestampingServices() {\n-        Collection<String> urls = timestampingServiceService.getTimestampingServices();\n-        List<TimestampingService> timestampingServices = timestampingServiceConverter.convert(urls);\n+    public ResponseEntity<List<TimestampingService>> getTimestampingServices(Boolean showConfigured) {\n+        List<TimestampingService> timestampingServices;\n+        // If show configured is true, return configured timestamping services from serverconf db.\n+        // Otherwise return approved timestamping services from global conf.\n+        if (showConfigured) {\n+            List<TspType> tsps = timestampingServiceService.getConfiguredTimestampingServices();\n+            timestampingServices = timestampingServiceConverter.convert(tsps);\n+        } else {\n+            Collection<String> urls = timestampingServiceService.getApprovedTimestampingServices();\n+            timestampingServices = timestampingServiceConverter.convert(urls);\n+        }\n         return new ResponseEntity<>(timestampingServices, HttpStatus.OK);\n     }\n+\n+    @Override\n+    @PreAuthorize(\"hasAuthority('ADD_TSP')\")\n+    public ResponseEntity<TimestampingService> addTimestampingService(TimestampingService timestampingServiceToAdd) {\n+        try {\n+            timestampingServiceService.addConfiguredTimestampingService(timestampingServiceToAdd);\n+        } catch (TimestampingServiceService.DuplicateConfiguredTimestampingServiceException e) {\n+            throw new ConflictException(e);\n+        } catch (TimestampingServiceNotFoundException e) {\n+            throw new ResourceNotFoundException(e);\n+        }\n+        return new ResponseEntity<>(timestampingServiceToAdd, HttpStatus.CREATED);\n+    }\n+\n+    @Override\n+    @PreAuthorize(\"hasAuthority('DELETE_TSP')\")\n+    public ResponseEntity<Void> deleteTimestampingService(TimestampingService timestampingService) {\n+        try {\n+            timestampingServiceService.deleteConfiguredTimestampingService(timestampingService);\n+        } catch (TimestampingServiceNotFoundException e) {\n+            throw new ResourceNotFoundException(e);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "16f8bc1c64e70cf1592b13ae542ac8e69f189960"}, "originalPosition": 53}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MDI0MTgzMA==", "bodyText": "Fixed.", "url": "https://github.com/nordic-institute/X-Road/pull/372#discussion_r380241830", "createdAt": "2020-02-17T15:22:12Z", "author": {"login": "petkivim"}, "path": "src/proxy-ui-api/src/main/java/org/niis/xroad/restapi/openapi/TimestampingServicesApiController.java", "diffHunk": "@@ -62,9 +65,42 @@ public TimestampingServicesApiController(TimestampingServiceService timestamping\n \n     @Override\n     @PreAuthorize(\"hasAuthority('VIEW_TSPS')\")\n-    public ResponseEntity<List<TimestampingService>> getTimestampingServices() {\n-        Collection<String> urls = timestampingServiceService.getTimestampingServices();\n-        List<TimestampingService> timestampingServices = timestampingServiceConverter.convert(urls);\n+    public ResponseEntity<List<TimestampingService>> getTimestampingServices(Boolean showConfigured) {\n+        List<TimestampingService> timestampingServices;\n+        // If show configured is true, return configured timestamping services from serverconf db.\n+        // Otherwise return approved timestamping services from global conf.\n+        if (showConfigured) {\n+            List<TspType> tsps = timestampingServiceService.getConfiguredTimestampingServices();\n+            timestampingServices = timestampingServiceConverter.convert(tsps);\n+        } else {\n+            Collection<String> urls = timestampingServiceService.getApprovedTimestampingServices();\n+            timestampingServices = timestampingServiceConverter.convert(urls);\n+        }\n         return new ResponseEntity<>(timestampingServices, HttpStatus.OK);\n     }\n+\n+    @Override\n+    @PreAuthorize(\"hasAuthority('ADD_TSP')\")\n+    public ResponseEntity<TimestampingService> addTimestampingService(TimestampingService timestampingServiceToAdd) {\n+        try {\n+            timestampingServiceService.addConfiguredTimestampingService(timestampingServiceToAdd);\n+        } catch (TimestampingServiceService.DuplicateConfiguredTimestampingServiceException e) {\n+            throw new ConflictException(e);\n+        } catch (TimestampingServiceNotFoundException e) {\n+            throw new ResourceNotFoundException(e);\n+        }\n+        return new ResponseEntity<>(timestampingServiceToAdd, HttpStatus.CREATED);\n+    }\n+\n+    @Override\n+    @PreAuthorize(\"hasAuthority('DELETE_TSP')\")\n+    public ResponseEntity<Void> deleteTimestampingService(TimestampingService timestampingService) {\n+        try {\n+            timestampingServiceService.deleteConfiguredTimestampingService(timestampingService);\n+        } catch (TimestampingServiceNotFoundException e) {\n+            throw new ResourceNotFoundException(e);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MDE0NzUxOA=="}, "originalCommit": {"oid": "16f8bc1c64e70cf1592b13ae542ac8e69f189960"}, "originalPosition": 53}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjM1MjcwNTQxOnYy", "diffSide": "RIGHT", "path": "src/proxy-ui-api/src/main/java/org/niis/xroad/restapi/openapi/TimestampingServicesApiController.java", "isResolved": true, "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xN1QxMjoyMzoyMlrOFqin5w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xOFQxNjo1Nzo0NVrOFrKhDA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MDE1MTc4Mw==", "bodyText": "We have used convention where response has Location header which points to created entity. There is a helper to make this convenient, \n  \n    \n      X-Road/src/proxy-ui-api/src/main/java/org/niis/xroad/restapi/openapi/ClientsApiController.java\n    \n    \n         Line 308\n      in\n      c5d7658\n    \n    \n    \n    \n\n        \n          \n           return createCreatedResponse(\"/api/local-groups/{id}\", createdGroup, localGroupType.getId()); \n        \n    \n  \n\n\nWe do not have a single-item-getter for timestamping services, so I wonder which would be better, a) point to all-items-getter /token-certificates or b) not include Location header at all?", "url": "https://github.com/nordic-institute/X-Road/pull/372#discussion_r380151783", "createdAt": "2020-02-17T12:23:22Z", "author": {"login": "jansu76"}, "path": "src/proxy-ui-api/src/main/java/org/niis/xroad/restapi/openapi/TimestampingServicesApiController.java", "diffHunk": "@@ -62,9 +65,42 @@ public TimestampingServicesApiController(TimestampingServiceService timestamping\n \n     @Override\n     @PreAuthorize(\"hasAuthority('VIEW_TSPS')\")\n-    public ResponseEntity<List<TimestampingService>> getTimestampingServices() {\n-        Collection<String> urls = timestampingServiceService.getTimestampingServices();\n-        List<TimestampingService> timestampingServices = timestampingServiceConverter.convert(urls);\n+    public ResponseEntity<List<TimestampingService>> getTimestampingServices(Boolean showConfigured) {\n+        List<TimestampingService> timestampingServices;\n+        // If show configured is true, return configured timestamping services from serverconf db.\n+        // Otherwise return approved timestamping services from global conf.\n+        if (showConfigured) {\n+            List<TspType> tsps = timestampingServiceService.getConfiguredTimestampingServices();\n+            timestampingServices = timestampingServiceConverter.convert(tsps);\n+        } else {\n+            Collection<String> urls = timestampingServiceService.getApprovedTimestampingServices();\n+            timestampingServices = timestampingServiceConverter.convert(urls);\n+        }\n         return new ResponseEntity<>(timestampingServices, HttpStatus.OK);\n     }\n+\n+    @Override\n+    @PreAuthorize(\"hasAuthority('ADD_TSP')\")\n+    public ResponseEntity<TimestampingService> addTimestampingService(TimestampingService timestampingServiceToAdd) {\n+        try {\n+            timestampingServiceService.addConfiguredTimestampingService(timestampingServiceToAdd);\n+        } catch (TimestampingServiceService.DuplicateConfiguredTimestampingServiceException e) {\n+            throw new ConflictException(e);\n+        } catch (TimestampingServiceNotFoundException e) {\n+            throw new ResourceNotFoundException(e);\n+        }\n+        return new ResponseEntity<>(timestampingServiceToAdd, HttpStatus.CREATED);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "16f8bc1c64e70cf1592b13ae542ac8e69f189960"}, "originalPosition": 44}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MDI0NjA5OQ==", "bodyText": "I ended up leaving this as-is - not including Location header since we do not have an endpoint for a single timestamping entity.", "url": "https://github.com/nordic-institute/X-Road/pull/372#discussion_r380246099", "createdAt": "2020-02-17T15:30:19Z", "author": {"login": "petkivim"}, "path": "src/proxy-ui-api/src/main/java/org/niis/xroad/restapi/openapi/TimestampingServicesApiController.java", "diffHunk": "@@ -62,9 +65,42 @@ public TimestampingServicesApiController(TimestampingServiceService timestamping\n \n     @Override\n     @PreAuthorize(\"hasAuthority('VIEW_TSPS')\")\n-    public ResponseEntity<List<TimestampingService>> getTimestampingServices() {\n-        Collection<String> urls = timestampingServiceService.getTimestampingServices();\n-        List<TimestampingService> timestampingServices = timestampingServiceConverter.convert(urls);\n+    public ResponseEntity<List<TimestampingService>> getTimestampingServices(Boolean showConfigured) {\n+        List<TimestampingService> timestampingServices;\n+        // If show configured is true, return configured timestamping services from serverconf db.\n+        // Otherwise return approved timestamping services from global conf.\n+        if (showConfigured) {\n+            List<TspType> tsps = timestampingServiceService.getConfiguredTimestampingServices();\n+            timestampingServices = timestampingServiceConverter.convert(tsps);\n+        } else {\n+            Collection<String> urls = timestampingServiceService.getApprovedTimestampingServices();\n+            timestampingServices = timestampingServiceConverter.convert(urls);\n+        }\n         return new ResponseEntity<>(timestampingServices, HttpStatus.OK);\n     }\n+\n+    @Override\n+    @PreAuthorize(\"hasAuthority('ADD_TSP')\")\n+    public ResponseEntity<TimestampingService> addTimestampingService(TimestampingService timestampingServiceToAdd) {\n+        try {\n+            timestampingServiceService.addConfiguredTimestampingService(timestampingServiceToAdd);\n+        } catch (TimestampingServiceService.DuplicateConfiguredTimestampingServiceException e) {\n+            throw new ConflictException(e);\n+        } catch (TimestampingServiceNotFoundException e) {\n+            throw new ResourceNotFoundException(e);\n+        }\n+        return new ResponseEntity<>(timestampingServiceToAdd, HttpStatus.CREATED);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MDE1MTc4Mw=="}, "originalCommit": {"oid": "16f8bc1c64e70cf1592b13ae542ac8e69f189960"}, "originalPosition": 44}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MDgwNTM4OA==", "bodyText": "With a fresh mind this (b) is indeed the better option since it is better to not provide wrong Location header if we cannot provide a correct one.  Discussed same thing with @TJaakkola today, about Endpoint delete, since we don't have a single item getter for that either.", "url": "https://github.com/nordic-institute/X-Road/pull/372#discussion_r380805388", "createdAt": "2020-02-18T16:57:45Z", "author": {"login": "jansu76"}, "path": "src/proxy-ui-api/src/main/java/org/niis/xroad/restapi/openapi/TimestampingServicesApiController.java", "diffHunk": "@@ -62,9 +65,42 @@ public TimestampingServicesApiController(TimestampingServiceService timestamping\n \n     @Override\n     @PreAuthorize(\"hasAuthority('VIEW_TSPS')\")\n-    public ResponseEntity<List<TimestampingService>> getTimestampingServices() {\n-        Collection<String> urls = timestampingServiceService.getTimestampingServices();\n-        List<TimestampingService> timestampingServices = timestampingServiceConverter.convert(urls);\n+    public ResponseEntity<List<TimestampingService>> getTimestampingServices(Boolean showConfigured) {\n+        List<TimestampingService> timestampingServices;\n+        // If show configured is true, return configured timestamping services from serverconf db.\n+        // Otherwise return approved timestamping services from global conf.\n+        if (showConfigured) {\n+            List<TspType> tsps = timestampingServiceService.getConfiguredTimestampingServices();\n+            timestampingServices = timestampingServiceConverter.convert(tsps);\n+        } else {\n+            Collection<String> urls = timestampingServiceService.getApprovedTimestampingServices();\n+            timestampingServices = timestampingServiceConverter.convert(urls);\n+        }\n         return new ResponseEntity<>(timestampingServices, HttpStatus.OK);\n     }\n+\n+    @Override\n+    @PreAuthorize(\"hasAuthority('ADD_TSP')\")\n+    public ResponseEntity<TimestampingService> addTimestampingService(TimestampingService timestampingServiceToAdd) {\n+        try {\n+            timestampingServiceService.addConfiguredTimestampingService(timestampingServiceToAdd);\n+        } catch (TimestampingServiceService.DuplicateConfiguredTimestampingServiceException e) {\n+            throw new ConflictException(e);\n+        } catch (TimestampingServiceNotFoundException e) {\n+            throw new ResourceNotFoundException(e);\n+        }\n+        return new ResponseEntity<>(timestampingServiceToAdd, HttpStatus.CREATED);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MDE1MTc4Mw=="}, "originalCommit": {"oid": "16f8bc1c64e70cf1592b13ae542ac8e69f189960"}, "originalPosition": 44}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjM1MjczMTAyOnYy", "diffSide": "RIGHT", "path": "src/proxy-ui-api/src/main/java/org/niis/xroad/restapi/openapi/TimestampingServicesApiController.java", "isResolved": true, "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xN1QxMjozMjoyMVrOFqi3QA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xOFQxNjo1OTo1MlrOFrKmEw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MDE1NTcxMg==", "bodyText": "Consider making timestampingServiceService.addConfiguredTimestampingService public TimestampingService addConfiguredTimestampingService(TimestampingService timestampingServiceToAdd) and returning the created object?\nNow if I understand correctly API returns partial TimestampingService object with empty updated_at, message and status? This is a bit inconsistent with how other creates work, an example:\n\n  \n    \n      X-Road/src/proxy-ui-api/src/main/java/org/niis/xroad/restapi/openapi/ClientsApiController.java\n    \n    \n        Lines 299 to 307\n      in\n      c5d7658\n    \n    \n    \n    \n\n        \n          \n           try { \n        \n\n        \n          \n               localGroupType = localGroupService.addLocalGroup(clientType.getIdentifier(), \n        \n\n        \n          \n                       localGroupConverter.convert(localGroup)); \n        \n\n        \n          \n           } catch (LocalGroupService.DuplicateLocalGroupCodeException e) { \n        \n\n        \n          \n               throw new ConflictException(e); \n        \n\n        \n          \n           } catch (ClientNotFoundException e) { \n        \n\n        \n          \n               throw new ResourceNotFoundException(e); \n        \n\n        \n          \n           } \n        \n\n        \n          \n           LocalGroup createdGroup = localGroupConverter.convert(localGroupType); \n        \n    \n  \n\n\nIt probably does not make sense to go through lots of effort to get this perfect, but at least low hanging fruits can be picked.\nSomething in guidelines about this: https://confluence.niis.org/pages/viewpage.action?pageId=8520435#APIGuidelines&Examples-POSTandPUTshouldreturnusefuldatapostputconvention", "url": "https://github.com/nordic-institute/X-Road/pull/372#discussion_r380155712", "createdAt": "2020-02-17T12:32:21Z", "author": {"login": "jansu76"}, "path": "src/proxy-ui-api/src/main/java/org/niis/xroad/restapi/openapi/TimestampingServicesApiController.java", "diffHunk": "@@ -62,9 +65,42 @@ public TimestampingServicesApiController(TimestampingServiceService timestamping\n \n     @Override\n     @PreAuthorize(\"hasAuthority('VIEW_TSPS')\")\n-    public ResponseEntity<List<TimestampingService>> getTimestampingServices() {\n-        Collection<String> urls = timestampingServiceService.getTimestampingServices();\n-        List<TimestampingService> timestampingServices = timestampingServiceConverter.convert(urls);\n+    public ResponseEntity<List<TimestampingService>> getTimestampingServices(Boolean showConfigured) {\n+        List<TimestampingService> timestampingServices;\n+        // If show configured is true, return configured timestamping services from serverconf db.\n+        // Otherwise return approved timestamping services from global conf.\n+        if (showConfigured) {\n+            List<TspType> tsps = timestampingServiceService.getConfiguredTimestampingServices();\n+            timestampingServices = timestampingServiceConverter.convert(tsps);\n+        } else {\n+            Collection<String> urls = timestampingServiceService.getApprovedTimestampingServices();\n+            timestampingServices = timestampingServiceConverter.convert(urls);\n+        }\n         return new ResponseEntity<>(timestampingServices, HttpStatus.OK);\n     }\n+\n+    @Override\n+    @PreAuthorize(\"hasAuthority('ADD_TSP')\")\n+    public ResponseEntity<TimestampingService> addTimestampingService(TimestampingService timestampingServiceToAdd) {\n+        try {\n+            timestampingServiceService.addConfiguredTimestampingService(timestampingServiceToAdd);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "16f8bc1c64e70cf1592b13ae542ac8e69f189960"}, "originalPosition": 38}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MDIyMTkwNw==", "bodyText": "I removed updated_at, message and status from the TimestampingService object that os used by /system/timestamping-servicesAPI since those attributes are related to the Diagnostics only. I created a new object TimestampingServiceDiagnostics that has those attributes. After the change the API returns a full object with all the attributes (name, url) populated.", "url": "https://github.com/nordic-institute/X-Road/pull/372#discussion_r380221907", "createdAt": "2020-02-17T14:46:03Z", "author": {"login": "petkivim"}, "path": "src/proxy-ui-api/src/main/java/org/niis/xroad/restapi/openapi/TimestampingServicesApiController.java", "diffHunk": "@@ -62,9 +65,42 @@ public TimestampingServicesApiController(TimestampingServiceService timestamping\n \n     @Override\n     @PreAuthorize(\"hasAuthority('VIEW_TSPS')\")\n-    public ResponseEntity<List<TimestampingService>> getTimestampingServices() {\n-        Collection<String> urls = timestampingServiceService.getTimestampingServices();\n-        List<TimestampingService> timestampingServices = timestampingServiceConverter.convert(urls);\n+    public ResponseEntity<List<TimestampingService>> getTimestampingServices(Boolean showConfigured) {\n+        List<TimestampingService> timestampingServices;\n+        // If show configured is true, return configured timestamping services from serverconf db.\n+        // Otherwise return approved timestamping services from global conf.\n+        if (showConfigured) {\n+            List<TspType> tsps = timestampingServiceService.getConfiguredTimestampingServices();\n+            timestampingServices = timestampingServiceConverter.convert(tsps);\n+        } else {\n+            Collection<String> urls = timestampingServiceService.getApprovedTimestampingServices();\n+            timestampingServices = timestampingServiceConverter.convert(urls);\n+        }\n         return new ResponseEntity<>(timestampingServices, HttpStatus.OK);\n     }\n+\n+    @Override\n+    @PreAuthorize(\"hasAuthority('ADD_TSP')\")\n+    public ResponseEntity<TimestampingService> addTimestampingService(TimestampingService timestampingServiceToAdd) {\n+        try {\n+            timestampingServiceService.addConfiguredTimestampingService(timestampingServiceToAdd);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MDE1NTcxMg=="}, "originalCommit": {"oid": "16f8bc1c64e70cf1592b13ae542ac8e69f189960"}, "originalPosition": 38}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MDgwNjY3NQ==", "bodyText": "Nice \ud83d\udc4d", "url": "https://github.com/nordic-institute/X-Road/pull/372#discussion_r380806675", "createdAt": "2020-02-18T16:59:52Z", "author": {"login": "jansu76"}, "path": "src/proxy-ui-api/src/main/java/org/niis/xroad/restapi/openapi/TimestampingServicesApiController.java", "diffHunk": "@@ -62,9 +65,42 @@ public TimestampingServicesApiController(TimestampingServiceService timestamping\n \n     @Override\n     @PreAuthorize(\"hasAuthority('VIEW_TSPS')\")\n-    public ResponseEntity<List<TimestampingService>> getTimestampingServices() {\n-        Collection<String> urls = timestampingServiceService.getTimestampingServices();\n-        List<TimestampingService> timestampingServices = timestampingServiceConverter.convert(urls);\n+    public ResponseEntity<List<TimestampingService>> getTimestampingServices(Boolean showConfigured) {\n+        List<TimestampingService> timestampingServices;\n+        // If show configured is true, return configured timestamping services from serverconf db.\n+        // Otherwise return approved timestamping services from global conf.\n+        if (showConfigured) {\n+            List<TspType> tsps = timestampingServiceService.getConfiguredTimestampingServices();\n+            timestampingServices = timestampingServiceConverter.convert(tsps);\n+        } else {\n+            Collection<String> urls = timestampingServiceService.getApprovedTimestampingServices();\n+            timestampingServices = timestampingServiceConverter.convert(urls);\n+        }\n         return new ResponseEntity<>(timestampingServices, HttpStatus.OK);\n     }\n+\n+    @Override\n+    @PreAuthorize(\"hasAuthority('ADD_TSP')\")\n+    public ResponseEntity<TimestampingService> addTimestampingService(TimestampingService timestampingServiceToAdd) {\n+        try {\n+            timestampingServiceService.addConfiguredTimestampingService(timestampingServiceToAdd);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MDE1NTcxMg=="}, "originalCommit": {"oid": "16f8bc1c64e70cf1592b13ae542ac8e69f189960"}, "originalPosition": 38}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjM1Mjc4MTA1OnYy", "diffSide": "RIGHT", "path": "src/proxy-ui-api/src/main/resources/openapi-definition.yaml", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xN1QxMjo1MDoyMlrOFqjVig==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xN1QxNToyMjo1MlrOFqoJEQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MDE2MzQ2Ng==", "bodyText": "Maybe consider renaming so that the \"only\" part becomes obvious. show_configured could be interpreted as\n\nno parameter / show_configured = false: show all except \"configured\" ones\nshow_configured = true: show all", "url": "https://github.com/nordic-institute/X-Road/pull/372#discussion_r380163466", "createdAt": "2020-02-17T12:50:22Z", "author": {"login": "jansu76"}, "path": "src/proxy-ui-api/src/main/resources/openapi-definition.yaml", "diffHunk": "@@ -3179,6 +3179,14 @@ paths:\n       summary: view the timestamping services\n       operationId: getTimestampingServices\n       description: Administrator views the timestamping services.\n+      parameters:\n+        - in: query\n+          name: show_configured", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "16f8bc1c64e70cf1592b13ae542ac8e69f189960"}, "originalPosition": 6}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MDI0MjE5Mw==", "bodyText": "Removed the whole query parameter as a part of refactoring the API.", "url": "https://github.com/nordic-institute/X-Road/pull/372#discussion_r380242193", "createdAt": "2020-02-17T15:22:52Z", "author": {"login": "petkivim"}, "path": "src/proxy-ui-api/src/main/resources/openapi-definition.yaml", "diffHunk": "@@ -3179,6 +3179,14 @@ paths:\n       summary: view the timestamping services\n       operationId: getTimestampingServices\n       description: Administrator views the timestamping services.\n+      parameters:\n+        - in: query\n+          name: show_configured", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MDE2MzQ2Ng=="}, "originalCommit": {"oid": "16f8bc1c64e70cf1592b13ae542ac8e69f189960"}, "originalPosition": 6}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjM1Mjc5ODk3OnYy", "diffSide": "RIGHT", "path": "src/proxy-ui-api/src/main/resources/openapi-definition.yaml", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xN1QxMjo1NjozMlrOFqjgMw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xN1QxNToyMzoxNFrOFqoJwQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MDE2NjE5NQ==", "bodyText": "using http DELETE with a request body is problematic. Specifications-wise it is on some kind of grey area, and e.g. support from some clients / load balancers etc might vary https://stackoverflow.com/questions/299628/is-an-entity-body-allowed-for-an-http-delete-request\nFor that reason we decided to have e.g. POST /service-clients/{id}/access-rights/delete and to be consistent this should be POST as well.", "url": "https://github.com/nordic-institute/X-Road/pull/372#discussion_r380166195", "createdAt": "2020-02-17T12:56:32Z", "author": {"login": "jansu76"}, "path": "src/proxy-ui-api/src/main/resources/openapi-definition.yaml", "diffHunk": "@@ -3235,23 +3243,18 @@ paths:\n           description: an existing item already exists\n         '500':\n           description: internal server error\n-  /timestamping-services/{url}:\n     delete: # ok", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "16f8bc1c64e70cf1592b13ae542ac8e69f189960"}, "originalPosition": 20}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MDI0MjM2OQ==", "bodyText": "Fixed.", "url": "https://github.com/nordic-institute/X-Road/pull/372#discussion_r380242369", "createdAt": "2020-02-17T15:23:14Z", "author": {"login": "petkivim"}, "path": "src/proxy-ui-api/src/main/resources/openapi-definition.yaml", "diffHunk": "@@ -3235,23 +3243,18 @@ paths:\n           description: an existing item already exists\n         '500':\n           description: internal server error\n-  /timestamping-services/{url}:\n     delete: # ok", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MDE2NjE5NQ=="}, "originalCommit": {"oid": "16f8bc1c64e70cf1592b13ae542ac8e69f189960"}, "originalPosition": 20}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjM1MjgwNDgyOnYy", "diffSide": "RIGHT", "path": "src/proxy-ui-api/src/main/resources/openapi-definition.yaml", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xN1QxMjo1ODoyOVrOFqjjug==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xN1QxNToyNDo0MVrOFqoMzQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MDE2NzA5OA==", "bodyText": "Delete and Add now take full TimestampingService object with unnecessary updated_at, message, status. Maybe consider making those readOnly properties, or creating a separate TimestampingServiceIdentifier { name, url } for delete and add, or moving updated_at, message, status to a different object reserved for diagnostics view only.", "url": "https://github.com/nordic-institute/X-Road/pull/372#discussion_r380167098", "createdAt": "2020-02-17T12:58:29Z", "author": {"login": "jansu76"}, "path": "src/proxy-ui-api/src/main/resources/openapi-definition.yaml", "diffHunk": "@@ -3235,23 +3243,18 @@ paths:\n           description: an existing item already exists\n         '500':\n           description: internal server error\n-  /timestamping-services/{url}:\n     delete: # ok\n       tags:\n         - security server\n       summary: delete timestamping service\n       operationId: deleteTimestampingService\n       description: Administrator removes timestamping service.\n-      parameters:\n-        - in: path\n-          name: url\n-          description: url of the timestamping service\n-          required: true\n-          schema:\n-            type: string\n-            format: text\n-            minLength: 1\n-            maxLength: 255\n+      requestBody:\n+        description: Timestamping service to delete\n+        content:\n+          application/json:\n+            schema:\n+              $ref: '#/components/schemas/TimestampingService'", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "16f8bc1c64e70cf1592b13ae542ac8e69f189960"}, "originalPosition": 41}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MDI0MzE0OQ==", "bodyText": "Removed updated_at, message and status from TimestampingService, and created a new TimestampingServiceDiagnostics objects with the attributes since they're used in the diagnostics only.", "url": "https://github.com/nordic-institute/X-Road/pull/372#discussion_r380243149", "createdAt": "2020-02-17T15:24:41Z", "author": {"login": "petkivim"}, "path": "src/proxy-ui-api/src/main/resources/openapi-definition.yaml", "diffHunk": "@@ -3235,23 +3243,18 @@ paths:\n           description: an existing item already exists\n         '500':\n           description: internal server error\n-  /timestamping-services/{url}:\n     delete: # ok\n       tags:\n         - security server\n       summary: delete timestamping service\n       operationId: deleteTimestampingService\n       description: Administrator removes timestamping service.\n-      parameters:\n-        - in: path\n-          name: url\n-          description: url of the timestamping service\n-          required: true\n-          schema:\n-            type: string\n-            format: text\n-            minLength: 1\n-            maxLength: 255\n+      requestBody:\n+        description: Timestamping service to delete\n+        content:\n+          application/json:\n+            schema:\n+              $ref: '#/components/schemas/TimestampingService'", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MDE2NzA5OA=="}, "originalCommit": {"oid": "16f8bc1c64e70cf1592b13ae542ac8e69f189960"}, "originalPosition": 41}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjM1MjgwODg0OnYy", "diffSide": "RIGHT", "path": "src/proxy-ui-api/src/main/resources/openapi-definition.yaml", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xN1QxMjo1OTo0OFrOFqjmHQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xN1QxNToyNTowMVrOFqoNdA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MDE2NzcwOQ==", "bodyText": "Different API structure without the show_configured might be more clear, after all:\nGET /timestamping-services/ (global)\nGET /system/timestamping-services/ (local)\nPOST /system/timestamping-services/ (add local)\nDELETE /system/timestamping-services/ (delete local) (actually POST /system/timestamping-services/delete)", "url": "https://github.com/nordic-institute/X-Road/pull/372#discussion_r380167709", "createdAt": "2020-02-17T12:59:48Z", "author": {"login": "jansu76"}, "path": "src/proxy-ui-api/src/main/resources/openapi-definition.yaml", "diffHunk": "@@ -3179,6 +3179,14 @@ paths:\n       summary: view the timestamping services\n       operationId: getTimestampingServices\n       description: Administrator views the timestamping services.\n+      parameters:", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "16f8bc1c64e70cf1592b13ae542ac8e69f189960"}, "originalPosition": 4}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MDI0MzMxNg==", "bodyText": "Refactored the API structure accordingly.", "url": "https://github.com/nordic-institute/X-Road/pull/372#discussion_r380243316", "createdAt": "2020-02-17T15:25:01Z", "author": {"login": "petkivim"}, "path": "src/proxy-ui-api/src/main/resources/openapi-definition.yaml", "diffHunk": "@@ -3179,6 +3179,14 @@ paths:\n       summary: view the timestamping services\n       operationId: getTimestampingServices\n       description: Administrator views the timestamping services.\n+      parameters:", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MDE2NzcwOQ=="}, "originalCommit": {"oid": "16f8bc1c64e70cf1592b13ae542ac8e69f189960"}, "originalPosition": 4}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2937, "cost": 1, "resetAt": "2021-11-12T20:28:25Z"}}}