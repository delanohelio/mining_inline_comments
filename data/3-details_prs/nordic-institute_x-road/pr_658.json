{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDcwNzI5OTU3", "number": 658, "title": "XRDDEV-1271: Avoid GlobalConf update during backup restore", "bodyText": "Refactor RestoreService to publish an restore start/stop event,\ndecoupling it from listeners (GlobalConfChecker, NotificationService).\nClean up EvictConnectionsService (no need for a transaction when\nevicting connections)", "createdAt": "2020-08-20T07:41:57Z", "url": "https://github.com/nordic-institute/X-Road/pull/658", "merged": true, "mergeCommit": {"oid": "1249fa652e1c55c30dc68967b2b72a91d5944cd7"}, "closed": true, "closedAt": "2020-08-20T12:58:24Z", "author": {"login": "jhyoty"}, "timelineItems": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdArLB4AH2gAyNDcwNzI5OTU3OjI2MTgzOTE1ZWIxZjgzYTM0OTUzMDIwYzlhMGIxMjYyMDAxYjM0MTA=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdAvyLhgFqTQ3MTU2Nzc2NQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "26183915eb1f83a34953020c9a0b1262001b3410", "author": {"user": {"login": "jhyoty", "name": "Jarkko Hy\u00f6ty"}}, "url": "https://github.com/nordic-institute/X-Road/commit/26183915eb1f83a34953020c9a0b1262001b3410", "committedDate": "2020-08-20T07:35:12Z", "message": "XRDDEV-1271: Avoid GlobalConf update during backup restore\n\n* Refactor RestoreService to publish an restore start/stop event,\n  decoupling it from listeners (GlobalConfChecker, NotificationService).\n* Clean up EvictConnectionsService (no need for a transaction when\n  evicting connections)"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDcxNTIxMzY3", "url": "https://github.com/nordic-institute/X-Road/pull/658#pullrequestreview-471521367", "createdAt": "2020-08-20T11:58:44Z", "commit": {"oid": "26183915eb1f83a34953020c9a0b1262001b3410"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yMFQxMTo1ODo0NFrOHD9gXA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yMFQxMTo1ODo0NFrOHD9gXA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MzkxNTQ4NA==", "bodyText": "Maybe a log.debug message would be useful here, and consistent with how clustered setup globalconf skipping works?", "url": "https://github.com/nordic-institute/X-Road/pull/658#discussion_r473915484", "createdAt": "2020-08-20T11:58:44Z", "author": {"login": "jansu76"}, "path": "src/proxy-ui-api/src/main/java/org/niis/xroad/restapi/scheduling/GlobalConfChecker.java", "diffHunk": "@@ -82,13 +84,18 @@ public GlobalConfChecker(GlobalConfCheckerHelper globalConfCheckerHelper, Global\n      * @throws Exception\n      */\n     @Scheduled(fixedRate = JOB_REPEAT_INTERVAL_MS, initialDelay = INITIAL_DELAY_MS)\n-    public void updateServerConf() throws Exception {\n+    @Transactional\n+    public void updateServerConf() {\n         // In clustered setup slave nodes may skip globalconf updates\n         if (SLAVE.equals(SystemProperties.getServerNodeType())) {\n             log.debug(\"This is a slave node - skip globalconf updates\");\n             return;\n         }\n \n+        if (restoreInProgress) {\n+            return;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "26183915eb1f83a34953020c9a0b1262001b3410"}, "originalPosition": 43}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "737fb1770e0c1d099e312e2dc21b28e751aeacdd", "author": {"user": {"login": "jhyoty", "name": "Jarkko Hy\u00f6ty"}}, "url": "https://github.com/nordic-institute/X-Road/commit/737fb1770e0c1d099e312e2dc21b28e751aeacdd", "committedDate": "2020-08-20T12:36:14Z", "message": "XRDDEV-1271: Improve debug logging"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDcxNTY3NzY1", "url": "https://github.com/nordic-institute/X-Road/pull/658#pullrequestreview-471567765", "createdAt": "2020-08-20T12:57:35Z", "commit": {"oid": "737fb1770e0c1d099e312e2dc21b28e751aeacdd"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4061, "cost": 1, "resetAt": "2021-11-01T16:19:10Z"}}}