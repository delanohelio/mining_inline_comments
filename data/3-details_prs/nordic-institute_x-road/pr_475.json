{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDA4NDczODEz", "number": 475, "title": "XRDDEV-958", "bodyText": "UI for adding access rights to a service client\n\nMust not be merged before XRDDEV-963", "createdAt": "2020-04-24T10:41:30Z", "url": "https://github.com/nordic-institute/X-Road/pull/475", "merged": true, "mergeCommit": {"oid": "f6902cd0d6ce2befb4d1da580dab3655c560c35f"}, "closed": true, "closedAt": "2020-05-06T12:07:13Z", "author": {"login": "TJaakkola"}, "timelineItems": {"totalCount": 12, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcahXUXgH2gAyNDA4NDczODEzOmQ2ZjBmYmMzMjlkMTAwNThjMzk0YTNiMzlhMWQyNzA5Y2FmNWNlMjc=", "endCursor": "Y3Vyc29yOnYyOpPPAAABceneragH2gAyNDA4NDczODEzOmRjODU2ZjFhNTgyNWU1MDcwMDUwODI5YjY4NzJhYzU2MjBkNTg3Yzk=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "d6f0fbc329d10058c394a3b39a1d2709caf5ce27", "author": {"user": {"login": "TJaakkola", "name": "Tapio Jaakkola"}}, "url": "https://github.com/nordic-institute/X-Road/commit/d6f0fbc329d10058c394a3b39a1d2709caf5ce27", "committedDate": "2020-04-23T18:40:27Z", "message": "XRDDEV-958: Add title to Service object as it is needed in the frontend"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a9e9ab7e8ddce9fdcc51ff3e1acddaa3467fef19", "author": {"user": {"login": "TJaakkola", "name": "Tapio Jaakkola"}}, "url": "https://github.com/nordic-institute/X-Road/commit/a9e9ab7e8ddce9fdcc51ff3e1acddaa3467fef19", "committedDate": "2020-04-23T18:41:18Z", "message": "XRDDEV-958: Implementation for adding access rights to service client"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "407aa759e438d4456f9e618f3ea29bf44ea6376d", "author": {"user": {"login": "TJaakkola", "name": "Tapio Jaakkola"}}, "url": "https://github.com/nordic-institute/X-Road/commit/407aa759e438d4456f9e618f3ea29bf44ea6376d", "committedDate": "2020-04-24T10:40:25Z", "message": "XRDDEV-958: Use default input checkbox and improve usability for adding service client access rights"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d2f5b41da40d020e093a6356adbee50b3a260fbb", "author": {"user": {"login": "TJaakkola", "name": "Tapio Jaakkola"}}, "url": "https://github.com/nordic-institute/X-Road/commit/d2f5b41da40d020e093a6356adbee50b3a260fbb", "committedDate": "2020-04-24T11:05:46Z", "message": "XRDDEV-958: Fix minor build issues. Added typings. Improved namings."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "83eaaf6e8d03d3d9be84e7d37f57224e311824a3", "author": {"user": {"login": "TJaakkola", "name": "Tapio Jaakkola"}}, "url": "https://github.com/nordic-institute/X-Road/commit/83eaaf6e8d03d3d9be84e7d37f57224e311824a3", "committedDate": "2020-04-24T14:52:10Z", "message": "XRDDEV-958: Use checkbox from vuetify"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDAyMDExOTM1", "url": "https://github.com/nordic-institute/X-Road/pull/475#pullrequestreview-402011935", "createdAt": "2020-04-28T16:31:25Z", "commit": {"oid": "83eaaf6e8d03d3d9be84e7d37f57224e311824a3"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yOFQxNjozMToyNlrOGNcxPw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yOFQxNjozNDoyMFrOGNc47w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNjc1NjAzMQ==", "bodyText": "I suppose that there is no interface in the types for the object that this method returns.\nWould it make sense to create an interface that extends AccessRight just for the ui ?\nIf so, then this might be a good place for it\nhttps://github.com/nordic-institute/X-Road/blob/develop/src/proxy-ui-api/frontend/src/ui-types.ts", "url": "https://github.com/nordic-institute/X-Road/pull/475#discussion_r416756031", "createdAt": "2020-04-28T16:31:26Z", "author": {"login": "Riippi"}, "path": "src/proxy-ui-api/frontend/src/views/Clients/ServiceClients/ServiceClientAccessRights.vue", "diffHunk": "@@ -99,36 +108,83 @@ export default Vue.extend({\n     return {\n       accessRights: [] as AccessRight[],\n       serviceClient: {} as ServiceClient,\n+      isAddServiceDialogVisible: false as boolean,\n+      serviceDescriptions: [] as ServiceDescription[],\n+      services: [] as Service[],\n     };\n   },\n   methods: {\n     fetchData() {\n \n+      this.fetchAccessRights();\n+\n       api\n         .get(`/clients/${this.id}/service-clients/${this.serviceClientId}`)\n         .then( (response: any) => this.serviceClient = response.data)\n-        .catch( (error: any) =>\n-          this.$store.dispatch('showError', error));\n+        .catch( (error: any) => this.$store.dispatch('showError', error));\n \n+      api\n+        .get(`/clients/${this.id}/service-descriptions`)\n+        .then( (response: any) => {\n+          this.serviceDescriptions = response.data;\n+        })\n+        .catch( (error: any) => this.$store.dispatch('showError', error));\n+    },\n+    fetchAccessRights() {\n       api\n         .get(`/clients/${this.id}/service-clients/${this.serviceClientId}/access-rights`)\n         .then( (response: any) => this.accessRights = response.data)\n-        .catch( (error: any) =>\n-          this.$store.dispatch('showError', error));\n-\n+        .catch( (error: any) => this.$store.dispatch('showError', error));\n     },\n-    close() {\n+    close(): void {\n       this.$router.go(-1);\n     },\n-    remove() {\n-      // NOOP\n+    addService(accessRights: AccessRight[]): void {\n+      this.hideAddService();\n+\n+      const accessRightsObject: AccessRights = { items: accessRights };\n+      api\n+        .post(`/clients/${this.id}/service-clients/${this.serviceClientId}/access-rights`, accessRightsObject)\n+        .then( (response: any) => {\n+          this.$store.dispatch('showSuccess', 'serviceClients.addServiceClientAccessRightSuccess');\n+          this.fetchAccessRights();\n+        })\n+        .catch( (error: any) => this.$store.dispatch('showError', error));\n     },\n-    addService() {\n+    hideAddService(): void {\n+      this.isAddServiceDialogVisible = false;\n+    },\n+    remove(): void {\n       // NOOP\n     },\n-    removeAll() {\n+    showAddServiceDialog(): void {\n+      this.isAddServiceDialogVisible = true;\n+    },\n+    removeAll(): void {\n       // NOOP\n     },\n+    serviceCandidates(): any[] {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "83eaaf6e8d03d3d9be84e7d37f57224e311824a3"}, "originalPosition": 118}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNjc1NjQ4NA==", "bodyText": "return type void ?", "url": "https://github.com/nordic-institute/X-Road/pull/475#discussion_r416756484", "createdAt": "2020-04-28T16:32:03Z", "author": {"login": "Riippi"}, "path": "src/proxy-ui-api/frontend/src/views/Clients/ServiceClients/ServiceClientAccessRights.vue", "diffHunk": "@@ -99,36 +108,83 @@ export default Vue.extend({\n     return {\n       accessRights: [] as AccessRight[],\n       serviceClient: {} as ServiceClient,\n+      isAddServiceDialogVisible: false as boolean,\n+      serviceDescriptions: [] as ServiceDescription[],\n+      services: [] as Service[],\n     };\n   },\n   methods: {\n     fetchData() {\n \n+      this.fetchAccessRights();\n+\n       api\n         .get(`/clients/${this.id}/service-clients/${this.serviceClientId}`)\n         .then( (response: any) => this.serviceClient = response.data)\n-        .catch( (error: any) =>\n-          this.$store.dispatch('showError', error));\n+        .catch( (error: any) => this.$store.dispatch('showError', error));\n \n+      api\n+        .get(`/clients/${this.id}/service-descriptions`)\n+        .then( (response: any) => {\n+          this.serviceDescriptions = response.data;\n+        })\n+        .catch( (error: any) => this.$store.dispatch('showError', error));\n+    },\n+    fetchAccessRights() {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "83eaaf6e8d03d3d9be84e7d37f57224e311824a3"}, "originalPosition": 77}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNjc1NjYxNQ==", "bodyText": "return type void ?", "url": "https://github.com/nordic-institute/X-Road/pull/475#discussion_r416756615", "createdAt": "2020-04-28T16:32:13Z", "author": {"login": "Riippi"}, "path": "src/proxy-ui-api/frontend/src/views/Clients/ServiceClients/ServiceClientAccessRights.vue", "diffHunk": "@@ -99,36 +108,83 @@ export default Vue.extend({\n     return {\n       accessRights: [] as AccessRight[],\n       serviceClient: {} as ServiceClient,\n+      isAddServiceDialogVisible: false as boolean,\n+      serviceDescriptions: [] as ServiceDescription[],\n+      services: [] as Service[],\n     };\n   },\n   methods: {\n     fetchData() {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "83eaaf6e8d03d3d9be84e7d37f57224e311824a3"}, "originalPosition": 59}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNjc1NzUxNQ==", "bodyText": "is there a reason to use any?", "url": "https://github.com/nordic-institute/X-Road/pull/475#discussion_r416757515", "createdAt": "2020-04-28T16:33:40Z", "author": {"login": "Riippi"}, "path": "src/proxy-ui-api/frontend/src/views/Clients/ServiceClients/AddServiceClientServiceDialog.vue", "diffHunk": "@@ -0,0 +1,115 @@\n+<template>\n+  <simpleDialog\n+    :dialog=\"dialog\"\n+    :width=\"750\"\n+    title=\"serviceClients.addService\"\n+    @save=\"save\"\n+    @cancel=\"cancel\"\n+    :disableSave=\"filterSelections().length === 0\"\n+  >\n+    <div slot=\"content\" v-if=\"this.serviceCandidates.length > 0\">\n+      <v-text-field v-model=\"search\"\n+                    :label=\"$t('serviceClients.searchPlaceHolder')\"\n+                    single-line\n+                    hide-details\n+                    data-test=\"search-service-client\"\n+                    class=\"search-input\">\n+        <v-icon slot=\"append\">mdi-magnify</v-icon>\n+      </v-text-field>\n+      <table class=\"xrd-table\">\n+        <thead>\n+        <tr>\n+          <th class=\"selection-checkbox\"></th>\n+          <th>{{$t('serviceClients.serviceCode')}}</th>\n+          <th>{{$t('serviceClients.title')}}</th>\n+        </tr>\n+        </thead>\n+        <tbody>\n+        <tr v-for=\"accessRight in searchResults()\"\n+            v-bind:key=\"accessRight.id\"\n+            class=\"service-row\"\n+            data-test=\"access-right-toggle\">\n+          <td class=\"selection-checkbox\">\n+            <div>\n+              <v-checkbox\n+                v-model=\"selections\"\n+                :value=\"accessRight\"\n+                data-test=\"access-right-checkbox-input\"\n+              /></div>\n+          </td>\n+          <td>{{accessRight.service_code}}</td>\n+          <td>{{accessRight.title}}</td>\n+        </tr>\n+        </tbody>\n+      </table>\n+    </div>\n+    <div slot=\"content\" v-else>\n+      <h3>{{$t('serviceClients.noAvailableServices')}}</h3>\n+    </div>\n+  </simpleDialog>\n+</template>\n+<script lang=\"ts\">\n+  import Vue from 'vue';\n+  import SimpleDialog from '@/components/ui/SimpleDialog.vue';\n+  import {AccessRight} from '@/types';\n+  export default Vue.extend({\n+    components: {\n+      SimpleDialog,\n+    },\n+    props: {\n+      dialog: {\n+        type: Boolean,\n+        required: true,\n+      },\n+      serviceCandidates: {\n+        type: Array,\n+        required: true,\n+      },\n+    },\n+    data() {\n+      return {\n+        selections: [] as AccessRight[],\n+        search: '' as string,\n+      };\n+    },\n+    methods: {\n+      save(): void {\n+        const items = this.selections\n+          .filter( (selection) => selection.service_code.includes(this.search))\n+          .map( (selection): AccessRight => ({service_code: selection.service_code}));\n+\n+        this.$emit('save', items);\n+        this.clear();\n+      },\n+      cancel(): void {\n+        this.$emit('cancel');\n+        this.clear();\n+      },\n+      clear(): void {\n+        this.selections = [];\n+      },\n+      searchResults(): any {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "83eaaf6e8d03d3d9be84e7d37f57224e311824a3"}, "originalPosition": 91}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNjc1Nzk5OQ==", "bodyText": "also same one line down here", "url": "https://github.com/nordic-institute/X-Road/pull/475#discussion_r416757999", "createdAt": "2020-04-28T16:34:20Z", "author": {"login": "Riippi"}, "path": "src/proxy-ui-api/frontend/src/views/Clients/ServiceClients/AddServiceClientServiceDialog.vue", "diffHunk": "@@ -0,0 +1,115 @@\n+<template>\n+  <simpleDialog\n+    :dialog=\"dialog\"\n+    :width=\"750\"\n+    title=\"serviceClients.addService\"\n+    @save=\"save\"\n+    @cancel=\"cancel\"\n+    :disableSave=\"filterSelections().length === 0\"\n+  >\n+    <div slot=\"content\" v-if=\"this.serviceCandidates.length > 0\">\n+      <v-text-field v-model=\"search\"\n+                    :label=\"$t('serviceClients.searchPlaceHolder')\"\n+                    single-line\n+                    hide-details\n+                    data-test=\"search-service-client\"\n+                    class=\"search-input\">\n+        <v-icon slot=\"append\">mdi-magnify</v-icon>\n+      </v-text-field>\n+      <table class=\"xrd-table\">\n+        <thead>\n+        <tr>\n+          <th class=\"selection-checkbox\"></th>\n+          <th>{{$t('serviceClients.serviceCode')}}</th>\n+          <th>{{$t('serviceClients.title')}}</th>\n+        </tr>\n+        </thead>\n+        <tbody>\n+        <tr v-for=\"accessRight in searchResults()\"\n+            v-bind:key=\"accessRight.id\"\n+            class=\"service-row\"\n+            data-test=\"access-right-toggle\">\n+          <td class=\"selection-checkbox\">\n+            <div>\n+              <v-checkbox\n+                v-model=\"selections\"\n+                :value=\"accessRight\"\n+                data-test=\"access-right-checkbox-input\"\n+              /></div>\n+          </td>\n+          <td>{{accessRight.service_code}}</td>\n+          <td>{{accessRight.title}}</td>\n+        </tr>\n+        </tbody>\n+      </table>\n+    </div>\n+    <div slot=\"content\" v-else>\n+      <h3>{{$t('serviceClients.noAvailableServices')}}</h3>\n+    </div>\n+  </simpleDialog>\n+</template>\n+<script lang=\"ts\">\n+  import Vue from 'vue';\n+  import SimpleDialog from '@/components/ui/SimpleDialog.vue';\n+  import {AccessRight} from '@/types';\n+  export default Vue.extend({\n+    components: {\n+      SimpleDialog,\n+    },\n+    props: {\n+      dialog: {\n+        type: Boolean,\n+        required: true,\n+      },\n+      serviceCandidates: {\n+        type: Array,\n+        required: true,\n+      },\n+    },\n+    data() {\n+      return {\n+        selections: [] as AccessRight[],\n+        search: '' as string,\n+      };\n+    },\n+    methods: {\n+      save(): void {\n+        const items = this.selections\n+          .filter( (selection) => selection.service_code.includes(this.search))\n+          .map( (selection): AccessRight => ({service_code: selection.service_code}));\n+\n+        this.$emit('save', items);\n+        this.clear();\n+      },\n+      cancel(): void {\n+        this.$emit('cancel');\n+        this.clear();\n+      },\n+      clear(): void {\n+        this.selections = [];\n+      },\n+      searchResults(): any {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNjc1NzUxNQ=="}, "originalCommit": {"oid": "83eaaf6e8d03d3d9be84e7d37f57224e311824a3"}, "originalPosition": 91}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "9538aae4992c923eb25bec7f0607dd0abca6a658", "author": {"user": {"login": "TJaakkola", "name": "Tapio Jaakkola"}}, "url": "https://github.com/nordic-institute/X-Road/commit/9538aae4992c923eb25bec7f0607dd0abca6a658", "committedDate": "2020-04-30T05:11:00Z", "message": "XRDDEV-958: Add typings"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e3424381c36275acc594d670405fb4bd6b0cc766", "author": {"user": {"login": "TJaakkola", "name": "Tapio Jaakkola"}}, "url": "https://github.com/nordic-institute/X-Road/commit/e3424381c36275acc594d670405fb4bd6b0cc766", "committedDate": "2020-04-30T05:45:23Z", "message": "XRDDEV-958: Fix linting errors"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDAzMzY4Mzcz", "url": "https://github.com/nordic-institute/X-Road/pull/475#pullrequestreview-403368373", "createdAt": "2020-04-30T09:50:42Z", "commit": {"oid": "e3424381c36275acc594d670405fb4bd6b0cc766"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "30a8d6d4bfe6d970307dfc4d85fbf0f5d157c35e", "author": {"user": {"login": "TJaakkola", "name": "Tapio Jaakkola"}}, "url": "https://github.com/nordic-institute/X-Road/commit/30a8d6d4bfe6d970307dfc4d85fbf0f5d157c35e", "committedDate": "2020-04-30T10:21:00Z", "message": "XRDDEV-958: Add typings to props & fix failing audit check"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "246f5f54824be1cc60b9be11844b6a5e5ec6d166", "author": {"user": {"login": "TJaakkola", "name": "Tapio Jaakkola"}}, "url": "https://github.com/nordic-institute/X-Road/commit/246f5f54824be1cc60b9be11844b6a5e5ec6d166", "committedDate": "2020-05-04T19:20:00Z", "message": "XRDDEV-958: Changed services to contain plain servicecode and fullservicecode"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "dc856f1a5825e5070050829b6872ac5620d587c9", "author": {"user": {"login": "TJaakkola", "name": "Tapio Jaakkola"}}, "url": "https://github.com/nordic-institute/X-Road/commit/dc856f1a5825e5070050829b6872ac5620d587c9", "committedDate": "2020-05-06T12:03:37Z", "message": "Merge branch 'develop' into XRDDEV-958"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4228, "cost": 1, "resetAt": "2021-11-01T16:19:10Z"}}}