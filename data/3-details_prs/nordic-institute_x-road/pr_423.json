{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0MzkxMzYyMzUx", "number": 423, "title": "XRDDEV-826 filter id chars", "bodyText": "https://jira.niis.org/browse/XRDDEV-826", "createdAt": "2020-03-20T05:42:26Z", "url": "https://github.com/nordic-institute/X-Road/pull/423", "merged": true, "mergeCommit": {"oid": "e7d47eee139ad45db829b12dcb63316fc8a30a15"}, "closed": true, "closedAt": "2020-04-16T09:13:38Z", "author": {"login": "jansu76"}, "timelineItems": {"totalCount": 14, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcOlkiUgH2gAyMzkxMzYyMzUxOjkzZTA3ODhjNTg1MjZkMjk5OGEwNGM4MzlhOGQzMzlmODFjODQyMGM=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcYJDeEAFqTM5NDQ0NDE4Mg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "93e0788c58526d2998a04c839a8d339f81c8420c", "author": {"user": {"login": "jansu76", "name": null}}, "url": "https://github.com/nordic-institute/X-Road/commit/93e0788c58526d2998a04c839a8d339f81c8420c", "committedDate": "2020-03-17T16:47:25Z", "message": "XRDDEV-826 add client id validators"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "91447205fae08454fa934259ee3c365f617c91a0", "author": {"user": {"login": "jansu76", "name": null}}, "url": "https://github.com/nordic-institute/X-Road/commit/91447205fae08454fa934259ee3c365f617c91a0", "committedDate": "2020-03-19T07:21:47Z", "message": "XRDDEV-826 add client validations to controller, and test them. refactor validation implementation"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "1e2d8a0716ccfc97bcab3fe05c6a78ccd93ec352", "author": {"user": {"login": "jansu76", "name": null}}, "url": "https://github.com/nordic-institute/X-Road/commit/1e2d8a0716ccfc97bcab3fe05c6a78ccd93ec352", "committedDate": "2020-03-19T16:04:16Z", "message": "XRDDEV-826 add more validations and tests"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "4046d43f025a19331c5f23a531695995b2c57211", "author": {"user": {"login": "jansu76", "name": null}}, "url": "https://github.com/nordic-institute/X-Road/commit/4046d43f025a19331c5f23a531695995b2c57211", "committedDate": "2020-03-19T16:06:52Z", "message": "XRDDEV-826 better name for SpringFirewallLogic"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "2ce321bf7b15f36c7d11d8cb938e04941d0db0fb", "author": {"user": {"login": "jansu76", "name": null}}, "url": "https://github.com/nordic-institute/X-Road/commit/2ce321bf7b15f36c7d11d8cb938e04941d0db0fb", "committedDate": "2020-03-19T20:22:31Z", "message": "Merge branch 'develop' into XRDDEV-826-filter-id-chars"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "0762cd59e1ea47adcb05aeff7a7c4e5984c1959f", "author": {"user": {"login": "jansu76", "name": null}}, "url": "https://github.com/nordic-institute/X-Road/commit/0762cd59e1ea47adcb05aeff7a7c4e5984c1959f", "committedDate": "2020-03-19T20:45:32Z", "message": "XRDDEV-826 fix ClientsApiControllerIntegrationTest, fix small openapi errors"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "9a25ba9719d9f325ec535ffa1eb8c7cee7eb1c95", "author": {"user": {"login": "jansu76", "name": null}}, "url": "https://github.com/nordic-institute/X-Road/commit/9a25ba9719d9f325ec535ffa1eb8c7cee7eb1c95", "committedDate": "2020-03-19T22:51:07Z", "message": "XRDDEV-826 add WSDL servicecode and version validation, tests, refactor ExceptionTranslator and related"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "cefa2e95efc008c15649770adbeea78e23436c46", "author": {"user": {"login": "jansu76", "name": null}}, "url": "https://github.com/nordic-institute/X-Road/commit/cefa2e95efc008c15649770adbeea78e23436c46", "committedDate": "2020-03-19T22:55:02Z", "message": "XRDDEV-826 add missing test resource wsdls"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f7d17a2d434a3095597b215c8ef662b18d65683a", "author": {"user": {"login": "jansu76", "name": null}}, "url": "https://github.com/nordic-institute/X-Road/commit/f7d17a2d434a3095597b215c8ef662b18d65683a", "committedDate": "2020-03-20T06:44:17Z", "message": "XRDDEV-826 add class missing from version control"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzg4ODQzMDY2", "url": "https://github.com/nordic-institute/X-Road/pull/423#pullrequestreview-388843066", "createdAt": "2020-04-07T07:16:08Z", "commit": {"oid": "f7d17a2d434a3095597b215c8ef662b18d65683a"}, "state": "COMMENTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wN1QwNzoxNjowOFrOGB2ANA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wN1QwODozMjowMFrOGB4yOw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNDU4NjU0OA==", "bodyText": "These methods could as well be static", "url": "https://github.com/nordic-institute/X-Road/pull/423#discussion_r404586548", "createdAt": "2020-04-07T07:16:08Z", "author": {"login": "carohauta"}, "path": "src/proxy-ui-api/src/main/java/org/niis/xroad/restapi/exceptions/ValidationErrorHelper.java", "diffHunk": "@@ -0,0 +1,63 @@\n+/**\n+ * The MIT License\n+ * Copyright (c) 2018 Estonian Information System Authority (RIA),\n+ * Nordic Institute for Interoperability Solutions (NIIS), Population Register Centre (VRK)\n+ * Copyright (c) 2015-2017 Estonian Information System Authority (RIA), Population Register Centre (VRK)\n+ *\n+ * Permission is hereby granted, free of charge, to any person obtaining a copy\n+ * of this software and associated documentation files (the \"Software\"), to deal\n+ * in the Software without restriction, including without limitation the rights\n+ * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\n+ * copies of the Software, and to permit persons to whom the Software is\n+ * furnished to do so, subject to the following conditions:\n+ *\n+ * The above copyright notice and this permission notice shall be included in\n+ * all copies or substantial portions of the Software.\n+ *\n+ * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n+ * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n+ * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n+ * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n+ * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n+ * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\n+ * THE SOFTWARE.\n+ */\n+package org.niis.xroad.restapi.exceptions;\n+\n+import org.niis.xroad.restapi.openapi.model.CodeWithMetadata;\n+import org.springframework.validation.Errors;\n+import org.springframework.web.bind.MethodArgumentNotValidException;\n+\n+import java.util.Collections;\n+\n+/**\n+ * Helper class for transforming Spring validation errors into error dtos.\n+ * Used from {@link ExceptionTranslator} and {@link SpringInternalExceptionHandler}\n+ */\n+public class ValidationErrorHelper {\n+    public static final String VALIDATION_FAILURE_ERROR = \"validation_failure\";\n+\n+    /**\n+     * Create DeviationAware error code & metadata from given org.springframework.validation.Errors.\n+     * Error code = {@link ValidationErrorHelper#VALIDATION_FAILURE_ERROR}, metadata is the\n+     * String representation of {@link Errors}\n+     */\n+    public CodeWithMetadata createError(Errors validationErrors) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f7d17a2d434a3095597b215c8ef662b18d65683a"}, "originalPosition": 45}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNDYzMjEyMw==", "bodyText": "I think this was talked in the demo couple of weeks ago but thetoString() is probably too much here. I think that the end user is only interested in the field name and the reason why the value was rejected. So maybe just add those (field and codes) to the metadata in a way that the frontend can parse and map them to the corresponding field easily. Something like this maybe (?):\n{\n    \"status\": 400,\n    \"error\": {\n        \"code\": \"validation_failure\",\n        \"metadata\": [\n            \"client.memberCode: NoColons, NoForwardslashes\", \n            \"client.subsystemCode: NoColons\"\n        ]\n    }\n}\nOr there could be a totally different response object when validation failure happens\n{\n    \"status\": 400,\n    \"error\": {\n        \"code\": \"validation_failure\",\n        \"validation_errors\": {\n            \"client.memberCode\": [ \n               \"NoColons\", \n               \"NoForwardslashes\"\n            ], \n            \"client.subsystemCode\": [\n              \"NoColons\"\n            ]\n        }\n    }\n}\nIDK probably needs some brainstorming between frontend and backend devs \ud83e\udd14", "url": "https://github.com/nordic-institute/X-Road/pull/423#discussion_r404632123", "createdAt": "2020-04-07T08:32:00Z", "author": {"login": "carohauta"}, "path": "src/proxy-ui-api/src/main/java/org/niis/xroad/restapi/exceptions/ValidationErrorHelper.java", "diffHunk": "@@ -0,0 +1,63 @@\n+/**\n+ * The MIT License\n+ * Copyright (c) 2018 Estonian Information System Authority (RIA),\n+ * Nordic Institute for Interoperability Solutions (NIIS), Population Register Centre (VRK)\n+ * Copyright (c) 2015-2017 Estonian Information System Authority (RIA), Population Register Centre (VRK)\n+ *\n+ * Permission is hereby granted, free of charge, to any person obtaining a copy\n+ * of this software and associated documentation files (the \"Software\"), to deal\n+ * in the Software without restriction, including without limitation the rights\n+ * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\n+ * copies of the Software, and to permit persons to whom the Software is\n+ * furnished to do so, subject to the following conditions:\n+ *\n+ * The above copyright notice and this permission notice shall be included in\n+ * all copies or substantial portions of the Software.\n+ *\n+ * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n+ * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n+ * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n+ * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n+ * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n+ * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\n+ * THE SOFTWARE.\n+ */\n+package org.niis.xroad.restapi.exceptions;\n+\n+import org.niis.xroad.restapi.openapi.model.CodeWithMetadata;\n+import org.springframework.validation.Errors;\n+import org.springframework.web.bind.MethodArgumentNotValidException;\n+\n+import java.util.Collections;\n+\n+/**\n+ * Helper class for transforming Spring validation errors into error dtos.\n+ * Used from {@link ExceptionTranslator} and {@link SpringInternalExceptionHandler}\n+ */\n+public class ValidationErrorHelper {\n+    public static final String VALIDATION_FAILURE_ERROR = \"validation_failure\";\n+\n+    /**\n+     * Create DeviationAware error code & metadata from given org.springframework.validation.Errors.\n+     * Error code = {@link ValidationErrorHelper#VALIDATION_FAILURE_ERROR}, metadata is the\n+     * String representation of {@link Errors}\n+     */\n+    public CodeWithMetadata createError(Errors validationErrors) {\n+        CodeWithMetadata result = new CodeWithMetadata();\n+        result.setCode(VALIDATION_FAILURE_ERROR);\n+        result.setMetadata(Collections.singletonList(validationErrors.toString()));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f7d17a2d434a3095597b215c8ef662b18d65683a"}, "originalPosition": 48}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f6e377adba086b17166c298e1536e4e95e7d3a93", "author": {"user": {"login": "jansu76", "name": null}}, "url": "https://github.com/nordic-institute/X-Road/commit/f6e377adba086b17166c298e1536e4e95e7d3a93", "committedDate": "2020-04-14T07:19:34Z", "message": "XRDDEV-826 make ValidationErrorHelper a bean"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "cc783518fc9a1ee44885adb0c3183d40b2b556a5", "author": {"user": {"login": "jansu76", "name": null}}, "url": "https://github.com/nordic-institute/X-Road/commit/cc783518fc9a1ee44885adb0c3183d40b2b556a5", "committedDate": "2020-04-14T07:27:19Z", "message": "Merge branch 'develop' into XRDDEV-826-filter-id-chars\n\nFix Conflicts:\n\tsrc/proxy-ui-api/src/test/java/org/niis/xroad/restapi/service/OrphanRemovalServiceTest.java"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "83ff480512b71ac267e3f6562970f791e51caabf", "author": {"user": {"login": "jansu76", "name": null}}, "url": "https://github.com/nordic-institute/X-Road/commit/83ff480512b71ac267e3f6562970f791e51caabf", "committedDate": "2020-04-16T06:20:39Z", "message": "XRDDEV-826 remove leftover empty constructor to fix sonar"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzk0NDQ0MTgy", "url": "https://github.com/nordic-institute/X-Road/pull/423#pullrequestreview-394444182", "createdAt": "2020-04-16T09:13:12Z", "commit": {"oid": "83ff480512b71ac267e3f6562970f791e51caabf"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4168, "cost": 1, "resetAt": "2021-11-01T16:19:10Z"}}}