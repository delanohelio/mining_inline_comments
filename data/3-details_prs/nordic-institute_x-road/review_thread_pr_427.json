{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0MzkxODU3MTI0", "number": 427, "reviewThreads": {"totalCount": 8, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wMlQwOTo1MTo0MlrODt4SPA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wMlQxMzo0NjozM1rODt9frg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjQ5NDM0Njg0OnYy", "diffSide": "RIGHT", "path": "src/proxy-ui-api/src/main/resources/openapi-definition.yaml", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wMlQwOTo1MTo0MlrOF_juiQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wNVQxMzozNDo0MVrOGBADzA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMjE4OTk2MQ==", "bodyText": "According to the OpenAPI docs:\n\nAny sibling elements of a $ref are ignored. This is because $ref works by replacing itself and everything on its level with the definition it is pointing at.\n\nMaybe consider something like\nstatus_class:\n  readOnly: true\n  allOf:\n    - $ref: '#/components/schemas/DiagnosticStatusClass'\nThe allOf keyword has had some downsides with the OpenAPI generator we are using but with enum schemas such as DiagnosticStatusClass or ConfigurationStatus it seems to work flawlessly.\nSee also TimestampingServiceDiagnostics schema object for the same properties", "url": "https://github.com/nordic-institute/X-Road/pull/427#discussion_r402189961", "createdAt": "2020-04-02T09:51:42Z", "author": {"login": "carohauta"}, "path": "src/proxy-ui-api/src/main/resources/openapi-definition.yaml", "diffHunk": "@@ -4624,6 +4714,37 @@ components:\n           uniqueItems: true\n           items:\n             $ref: '#/components/schemas/GroupMember'\n+    GlobalConfDiagnostics: # ok\n+      type: object\n+      description: global configuration diagnostics\n+      required:\n+        - status_class\n+        - status_code\n+        - prev_update_at\n+        - next_update_at\n+      properties:\n+        status_class:\n+          $ref: '#/components/schemas/DiagnosticStatusClass'\n+          readOnly: true\n+        status_code:\n+          $ref: '#/components/schemas/ConfigurationStatus'\n+          readOnly: true", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "7249aaa5605a2fe30437c827a3022e149063b79c"}, "originalPosition": 207}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMzcwMjczMg==", "bodyText": "Updated all status_code and status_class properties to use the allOf keyword . The classes that were affected are GlobalConfDiagnostics, OcspResponder and TimestampingServiceDiagnostics.", "url": "https://github.com/nordic-institute/X-Road/pull/427#discussion_r403702732", "createdAt": "2020-04-05T13:34:41Z", "author": {"login": "petkivim"}, "path": "src/proxy-ui-api/src/main/resources/openapi-definition.yaml", "diffHunk": "@@ -4624,6 +4714,37 @@ components:\n           uniqueItems: true\n           items:\n             $ref: '#/components/schemas/GroupMember'\n+    GlobalConfDiagnostics: # ok\n+      type: object\n+      description: global configuration diagnostics\n+      required:\n+        - status_class\n+        - status_code\n+        - prev_update_at\n+        - next_update_at\n+      properties:\n+        status_class:\n+          $ref: '#/components/schemas/DiagnosticStatusClass'\n+          readOnly: true\n+        status_code:\n+          $ref: '#/components/schemas/ConfigurationStatus'\n+          readOnly: true", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMjE4OTk2MQ=="}, "originalCommit": {"oid": "7249aaa5605a2fe30437c827a3022e149063b79c"}, "originalPosition": 207}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjQ5NDQzODA3OnYy", "diffSide": "RIGHT", "path": "src/proxy-ui-api/src/main/java/org/niis/xroad/restapi/openapi/DiagnosticsApiController.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wMlQxMDoxNzo1N1rOF_kpiA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wNVQxMzozNDo1NlrOGBAD3g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMjIwNTA2NA==", "bodyText": "Not a big deal but aligning constructor parameters seems to be fine by CheckStyle but to be more consistent with the majority of the codebase maybe using an 8 space continuation instead would make sense?", "url": "https://github.com/nordic-institute/X-Road/pull/427#discussion_r402205064", "createdAt": "2020-04-02T10:17:57Z", "author": {"login": "carohauta"}, "path": "src/proxy-ui-api/src/main/java/org/niis/xroad/restapi/openapi/DiagnosticsApiController.java", "diffHunk": "@@ -0,0 +1,95 @@\n+/**\n+ * The MIT License\n+ * Copyright (c) 2018 Estonian Information System Authority (RIA),\n+ * Nordic Institute for Interoperability Solutions (NIIS), Population Register Centre (VRK)\n+ * Copyright (c) 2015-2017 Estonian Information System Authority (RIA), Population Register Centre (VRK)\n+ *\n+ * Permission is hereby granted, free of charge, to any person obtaining a copy\n+ * of this software and associated documentation files (the \"Software\"), to deal\n+ * in the Software without restriction, including without limitation the rights\n+ * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\n+ * copies of the Software, and to permit persons to whom the Software is\n+ * furnished to do so, subject to the following conditions:\n+ *\n+ * The above copyright notice and this permission notice shall be included in\n+ * all copies or substantial portions of the Software.\n+ *\n+ * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n+ * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n+ * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n+ * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n+ * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n+ * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\n+ * THE SOFTWARE.\n+ */\n+package org.niis.xroad.restapi.openapi;\n+\n+import ee.ria.xroad.common.DiagnosticsStatus;\n+\n+import lombok.extern.slf4j.Slf4j;\n+import org.niis.xroad.restapi.converter.GlobalConfDiagnosticConverter;\n+import org.niis.xroad.restapi.converter.OcspResponderDiagnosticConverter;\n+import org.niis.xroad.restapi.converter.TimestampingServiceDiagnosticConverter;\n+import org.niis.xroad.restapi.dto.OcspResponderDiagnosticsStatus;\n+import org.niis.xroad.restapi.openapi.model.GlobalConfDiagnostics;\n+import org.niis.xroad.restapi.openapi.model.OcspResponderDiagnostics;\n+import org.niis.xroad.restapi.openapi.model.TimestampingServiceDiagnostics;\n+import org.niis.xroad.restapi.service.DiagnosticService;\n+import org.springframework.beans.factory.annotation.Autowired;\n+import org.springframework.http.HttpStatus;\n+import org.springframework.http.ResponseEntity;\n+import org.springframework.security.access.prepost.PreAuthorize;\n+import org.springframework.stereotype.Controller;\n+import org.springframework.web.bind.annotation.RequestMapping;\n+\n+import java.util.List;\n+\n+/**\n+ * diagnostics api\n+ */\n+@Controller\n+@RequestMapping(\"/api\")\n+@Slf4j\n+@PreAuthorize(\"denyAll\")\n+public class DiagnosticsApiController implements DiagnosticsApi {\n+\n+    private DiagnosticService diagnosticService;\n+    private GlobalConfDiagnosticConverter globalConfDiagnosticConverter;\n+    private TimestampingServiceDiagnosticConverter timestampingServiceDiagnosticConverter;\n+    private OcspResponderDiagnosticConverter ocspResponderDiagnosticConverter;\n+\n+    /**\n+     * DiagnosticsApiController constructor\n+     */\n+    @Autowired\n+    public DiagnosticsApiController(DiagnosticService diagnosticService,\n+                                    GlobalConfDiagnosticConverter globalConfDiagnosticConverter,\n+                                    TimestampingServiceDiagnosticConverter timestampingServiceDiagnosticConverter,\n+                                    OcspResponderDiagnosticConverter ocspResponderDiagnosticConverter) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "7249aaa5605a2fe30437c827a3022e149063b79c"}, "originalPosition": 68}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMzcwMjc1MA==", "bodyText": "Fixed.", "url": "https://github.com/nordic-institute/X-Road/pull/427#discussion_r403702750", "createdAt": "2020-04-05T13:34:56Z", "author": {"login": "petkivim"}, "path": "src/proxy-ui-api/src/main/java/org/niis/xroad/restapi/openapi/DiagnosticsApiController.java", "diffHunk": "@@ -0,0 +1,95 @@\n+/**\n+ * The MIT License\n+ * Copyright (c) 2018 Estonian Information System Authority (RIA),\n+ * Nordic Institute for Interoperability Solutions (NIIS), Population Register Centre (VRK)\n+ * Copyright (c) 2015-2017 Estonian Information System Authority (RIA), Population Register Centre (VRK)\n+ *\n+ * Permission is hereby granted, free of charge, to any person obtaining a copy\n+ * of this software and associated documentation files (the \"Software\"), to deal\n+ * in the Software without restriction, including without limitation the rights\n+ * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\n+ * copies of the Software, and to permit persons to whom the Software is\n+ * furnished to do so, subject to the following conditions:\n+ *\n+ * The above copyright notice and this permission notice shall be included in\n+ * all copies or substantial portions of the Software.\n+ *\n+ * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n+ * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n+ * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n+ * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n+ * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n+ * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\n+ * THE SOFTWARE.\n+ */\n+package org.niis.xroad.restapi.openapi;\n+\n+import ee.ria.xroad.common.DiagnosticsStatus;\n+\n+import lombok.extern.slf4j.Slf4j;\n+import org.niis.xroad.restapi.converter.GlobalConfDiagnosticConverter;\n+import org.niis.xroad.restapi.converter.OcspResponderDiagnosticConverter;\n+import org.niis.xroad.restapi.converter.TimestampingServiceDiagnosticConverter;\n+import org.niis.xroad.restapi.dto.OcspResponderDiagnosticsStatus;\n+import org.niis.xroad.restapi.openapi.model.GlobalConfDiagnostics;\n+import org.niis.xroad.restapi.openapi.model.OcspResponderDiagnostics;\n+import org.niis.xroad.restapi.openapi.model.TimestampingServiceDiagnostics;\n+import org.niis.xroad.restapi.service.DiagnosticService;\n+import org.springframework.beans.factory.annotation.Autowired;\n+import org.springframework.http.HttpStatus;\n+import org.springframework.http.ResponseEntity;\n+import org.springframework.security.access.prepost.PreAuthorize;\n+import org.springframework.stereotype.Controller;\n+import org.springframework.web.bind.annotation.RequestMapping;\n+\n+import java.util.List;\n+\n+/**\n+ * diagnostics api\n+ */\n+@Controller\n+@RequestMapping(\"/api\")\n+@Slf4j\n+@PreAuthorize(\"denyAll\")\n+public class DiagnosticsApiController implements DiagnosticsApi {\n+\n+    private DiagnosticService diagnosticService;\n+    private GlobalConfDiagnosticConverter globalConfDiagnosticConverter;\n+    private TimestampingServiceDiagnosticConverter timestampingServiceDiagnosticConverter;\n+    private OcspResponderDiagnosticConverter ocspResponderDiagnosticConverter;\n+\n+    /**\n+     * DiagnosticsApiController constructor\n+     */\n+    @Autowired\n+    public DiagnosticsApiController(DiagnosticService diagnosticService,\n+                                    GlobalConfDiagnosticConverter globalConfDiagnosticConverter,\n+                                    TimestampingServiceDiagnosticConverter timestampingServiceDiagnosticConverter,\n+                                    OcspResponderDiagnosticConverter ocspResponderDiagnosticConverter) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMjIwNTA2NA=="}, "originalCommit": {"oid": "7249aaa5605a2fe30437c827a3022e149063b79c"}, "originalPosition": 68}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjQ5NDgzNTk3OnYy", "diffSide": "RIGHT", "path": "src/proxy-ui-api/src/main/java/org/niis/xroad/restapi/service/DiagnosticService.java", "isResolved": true, "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wMlQxMjoxOTowN1rOF_ogLw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wN1QxMDozNzo1OVrOGB9e2g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMjI2ODIwNw==", "bodyText": "Could the http request be simplified by using the RestTemplate class that Spring offers? I think most of the manual deserializing and json parsing in this service class could be avoided with it since it should be able to map a response directly into the given MyArbitraryObject.class\nAlso could be good to ensure that there is some sort of timeout for the request.", "url": "https://github.com/nordic-institute/X-Road/pull/427#discussion_r402268207", "createdAt": "2020-04-02T12:19:07Z", "author": {"login": "carohauta"}, "path": "src/proxy-ui-api/src/main/java/org/niis/xroad/restapi/service/DiagnosticService.java", "diffHunk": "@@ -0,0 +1,204 @@\n+/**\n+ * The MIT License\n+ * Copyright (c) 2018 Estonian Information System Authority (RIA),\n+ * Nordic Institute for Interoperability Solutions (NIIS), Population Register Centre (VRK)\n+ * Copyright (c) 2015-2017 Estonian Information System Authority (RIA), Population Register Centre (VRK)\n+ *\n+ * Permission is hereby granted, free of charge, to any person obtaining a copy\n+ * of this software and associated documentation files (the \"Software\"), to deal\n+ * in the Software without restriction, including without limitation the rights\n+ * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\n+ * copies of the Software, and to permit persons to whom the Software is\n+ * furnished to do so, subject to the following conditions:\n+ *\n+ * The above copyright notice and this permission notice shall be included in\n+ * all copies or substantial portions of the Software.\n+ *\n+ * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n+ * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n+ * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n+ * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n+ * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n+ * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\n+ * THE SOFTWARE.\n+ */\n+package org.niis.xroad.restapi.service;\n+\n+import ee.ria.xroad.common.DiagnosticsStatus;\n+import ee.ria.xroad.common.PortNumbers;\n+import ee.ria.xroad.common.SystemProperties;\n+\n+import com.google.gson.Gson;\n+import com.google.gson.JsonElement;\n+import com.google.gson.JsonObject;\n+import com.google.gson.JsonParser;\n+import lombok.extern.slf4j.Slf4j;\n+import org.apache.commons.io.IOUtils;\n+import org.apache.http.HttpEntity;\n+import org.apache.http.client.methods.CloseableHttpResponse;\n+import org.apache.http.client.methods.HttpGet;\n+import org.apache.http.impl.client.CloseableHttpClient;\n+import org.apache.http.impl.client.HttpClients;\n+import org.niis.xroad.restapi.dto.OcspResponderDiagnosticsStatus;\n+import org.niis.xroad.restapi.exceptions.DeviationAwareRuntimeException;\n+import org.niis.xroad.restapi.exceptions.ErrorDeviation;\n+import org.springframework.http.HttpStatus;\n+import org.springframework.security.access.prepost.PreAuthorize;\n+import org.springframework.stereotype.Service;\n+import org.springframework.transaction.annotation.Transactional;\n+\n+import java.io.IOException;\n+import java.util.List;\n+import java.util.Map;\n+import java.util.stream.Collectors;\n+\n+/**\n+ * diagnostic service\n+ */\n+@Slf4j\n+@Service\n+@Transactional\n+@PreAuthorize(\"isAuthenticated()\")\n+public class DiagnosticService {\n+    private static final String DIAGNOSTICS_BASE_URL = \"http://localhost\";\n+    private static final int CONF_CLIENT_ADMIN_PORT = SystemProperties.getConfigurationClientAdminPort();\n+    private static final String CONF_CLIENT_ADMIN_PATH = \"status\";\n+    private static final int TIMESTAMPING_SERVICE_ADMIN_PORT = PortNumbers.ADMIN_PORT;\n+    private static final String TIMESTAMPING_SERVICE_ADMIN_PATH = \"timestampstatus\";\n+    private static final int SIGNER_ADMIN_PORT = SystemProperties.getSignerAdminPort();\n+    private static final String SIGNER_ADMIN_PATH = \"status\";\n+\n+    /**\n+     * Query global configuration status from admin port over HTTP.\n+     * @return\n+     */\n+    public DiagnosticsStatus queryGlobalConfStatus() {\n+        try {\n+            JsonObject json = sendGetRequest(buildUri(CONF_CLIENT_ADMIN_PORT, CONF_CLIENT_ADMIN_PATH));\n+            return new Gson().fromJson(json, DiagnosticsStatus.class);\n+        } catch (DiagnosticRequestException e) {\n+            throw new DeviationAwareRuntimeException(e, e.getErrorDeviation());\n+        }\n+    }\n+\n+    /**\n+     * Query timestamping services status from admin port over HTTP.\n+     * @return\n+     */\n+    public List<DiagnosticsStatus> queryTimestampingStatus() {\n+        try {\n+            JsonObject json = sendGetRequest(buildUri(TIMESTAMPING_SERVICE_ADMIN_PORT,\n+                    TIMESTAMPING_SERVICE_ADMIN_PATH));\n+            return json.entrySet().stream().filter(e -> e.getValue() instanceof JsonObject)\n+                    .map(this::parseTimestampingStatus).collect(Collectors.toList());\n+        } catch (DiagnosticRequestException e) {\n+            throw new DeviationAwareRuntimeException(e, e.getErrorDeviation());\n+        }\n+    }\n+\n+    /**\n+     * Query ocsp responders status from admin port over HTTP.\n+     * @return\n+     */\n+    public List<OcspResponderDiagnosticsStatus> queryOcspResponderStatus() {\n+        try {\n+            JsonObject json = sendGetRequest(buildUri(SIGNER_ADMIN_PORT,\n+                    SIGNER_ADMIN_PATH));\n+            JsonObject certificationServiceStatusMap = json.getAsJsonObject(\"certificationServiceStatusMap\");\n+            return certificationServiceStatusMap.entrySet().stream().filter(e -> e.getValue() instanceof JsonObject)\n+                    .map(this::parseOcspResponderDiagnosticsStatus).collect(Collectors.toList());\n+        } catch (DiagnosticRequestException e) {\n+            throw new DeviationAwareRuntimeException(e, e.getErrorDeviation());\n+        }\n+    }\n+\n+    /**\n+     * Send HTTP GET request to the given address (http://localhost:{port}/{path}).\n+     * @param address\n+     * @return\n+     * @throws DiagnosticRequestException if sending a diagnostics requests fails or an error is returned\n+     */\n+    private JsonObject sendGetRequest(String address) throws DiagnosticRequestException {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "7249aaa5605a2fe30437c827a3022e149063b79c"}, "originalPosition": 121}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMzcwNDg2NQ==", "bodyText": "Adding a timeout is a good idea. \ud83d\udc4d\nI tried using RestTemplate, but in this case it does not actually simplify the implementation that much if at all. One reason for that is that the Security Server admin components return the diagnostics response using application/octet-stream content-type. HttpMessageConverter does not support that content-type and processing fails with an exception.\nERROR o.n.x.r.e.ApplicationExceptionHandler - exception caught\norg.niis.xroad.restapi.exceptions.DeviationAwareRuntimeException: org.springframework.web.client.RestClientException: Could not extract response: no suitable HttpMessageConverter found for response type [class ee.ria.xroad.common.DiagnosticsStatus] and content type [application/octet-stream]\n\nThis can be fixed by writing a custom HttpMessageConverter, but it would probably just mean moving the current parsing logic to another class. Eventually, it would not make the implementation much simpler compared to the current approach.", "url": "https://github.com/nordic-institute/X-Road/pull/427#discussion_r403704865", "createdAt": "2020-04-05T13:52:11Z", "author": {"login": "petkivim"}, "path": "src/proxy-ui-api/src/main/java/org/niis/xroad/restapi/service/DiagnosticService.java", "diffHunk": "@@ -0,0 +1,204 @@\n+/**\n+ * The MIT License\n+ * Copyright (c) 2018 Estonian Information System Authority (RIA),\n+ * Nordic Institute for Interoperability Solutions (NIIS), Population Register Centre (VRK)\n+ * Copyright (c) 2015-2017 Estonian Information System Authority (RIA), Population Register Centre (VRK)\n+ *\n+ * Permission is hereby granted, free of charge, to any person obtaining a copy\n+ * of this software and associated documentation files (the \"Software\"), to deal\n+ * in the Software without restriction, including without limitation the rights\n+ * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\n+ * copies of the Software, and to permit persons to whom the Software is\n+ * furnished to do so, subject to the following conditions:\n+ *\n+ * The above copyright notice and this permission notice shall be included in\n+ * all copies or substantial portions of the Software.\n+ *\n+ * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n+ * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n+ * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n+ * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n+ * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n+ * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\n+ * THE SOFTWARE.\n+ */\n+package org.niis.xroad.restapi.service;\n+\n+import ee.ria.xroad.common.DiagnosticsStatus;\n+import ee.ria.xroad.common.PortNumbers;\n+import ee.ria.xroad.common.SystemProperties;\n+\n+import com.google.gson.Gson;\n+import com.google.gson.JsonElement;\n+import com.google.gson.JsonObject;\n+import com.google.gson.JsonParser;\n+import lombok.extern.slf4j.Slf4j;\n+import org.apache.commons.io.IOUtils;\n+import org.apache.http.HttpEntity;\n+import org.apache.http.client.methods.CloseableHttpResponse;\n+import org.apache.http.client.methods.HttpGet;\n+import org.apache.http.impl.client.CloseableHttpClient;\n+import org.apache.http.impl.client.HttpClients;\n+import org.niis.xroad.restapi.dto.OcspResponderDiagnosticsStatus;\n+import org.niis.xroad.restapi.exceptions.DeviationAwareRuntimeException;\n+import org.niis.xroad.restapi.exceptions.ErrorDeviation;\n+import org.springframework.http.HttpStatus;\n+import org.springframework.security.access.prepost.PreAuthorize;\n+import org.springframework.stereotype.Service;\n+import org.springframework.transaction.annotation.Transactional;\n+\n+import java.io.IOException;\n+import java.util.List;\n+import java.util.Map;\n+import java.util.stream.Collectors;\n+\n+/**\n+ * diagnostic service\n+ */\n+@Slf4j\n+@Service\n+@Transactional\n+@PreAuthorize(\"isAuthenticated()\")\n+public class DiagnosticService {\n+    private static final String DIAGNOSTICS_BASE_URL = \"http://localhost\";\n+    private static final int CONF_CLIENT_ADMIN_PORT = SystemProperties.getConfigurationClientAdminPort();\n+    private static final String CONF_CLIENT_ADMIN_PATH = \"status\";\n+    private static final int TIMESTAMPING_SERVICE_ADMIN_PORT = PortNumbers.ADMIN_PORT;\n+    private static final String TIMESTAMPING_SERVICE_ADMIN_PATH = \"timestampstatus\";\n+    private static final int SIGNER_ADMIN_PORT = SystemProperties.getSignerAdminPort();\n+    private static final String SIGNER_ADMIN_PATH = \"status\";\n+\n+    /**\n+     * Query global configuration status from admin port over HTTP.\n+     * @return\n+     */\n+    public DiagnosticsStatus queryGlobalConfStatus() {\n+        try {\n+            JsonObject json = sendGetRequest(buildUri(CONF_CLIENT_ADMIN_PORT, CONF_CLIENT_ADMIN_PATH));\n+            return new Gson().fromJson(json, DiagnosticsStatus.class);\n+        } catch (DiagnosticRequestException e) {\n+            throw new DeviationAwareRuntimeException(e, e.getErrorDeviation());\n+        }\n+    }\n+\n+    /**\n+     * Query timestamping services status from admin port over HTTP.\n+     * @return\n+     */\n+    public List<DiagnosticsStatus> queryTimestampingStatus() {\n+        try {\n+            JsonObject json = sendGetRequest(buildUri(TIMESTAMPING_SERVICE_ADMIN_PORT,\n+                    TIMESTAMPING_SERVICE_ADMIN_PATH));\n+            return json.entrySet().stream().filter(e -> e.getValue() instanceof JsonObject)\n+                    .map(this::parseTimestampingStatus).collect(Collectors.toList());\n+        } catch (DiagnosticRequestException e) {\n+            throw new DeviationAwareRuntimeException(e, e.getErrorDeviation());\n+        }\n+    }\n+\n+    /**\n+     * Query ocsp responders status from admin port over HTTP.\n+     * @return\n+     */\n+    public List<OcspResponderDiagnosticsStatus> queryOcspResponderStatus() {\n+        try {\n+            JsonObject json = sendGetRequest(buildUri(SIGNER_ADMIN_PORT,\n+                    SIGNER_ADMIN_PATH));\n+            JsonObject certificationServiceStatusMap = json.getAsJsonObject(\"certificationServiceStatusMap\");\n+            return certificationServiceStatusMap.entrySet().stream().filter(e -> e.getValue() instanceof JsonObject)\n+                    .map(this::parseOcspResponderDiagnosticsStatus).collect(Collectors.toList());\n+        } catch (DiagnosticRequestException e) {\n+            throw new DeviationAwareRuntimeException(e, e.getErrorDeviation());\n+        }\n+    }\n+\n+    /**\n+     * Send HTTP GET request to the given address (http://localhost:{port}/{path}).\n+     * @param address\n+     * @return\n+     * @throws DiagnosticRequestException if sending a diagnostics requests fails or an error is returned\n+     */\n+    private JsonObject sendGetRequest(String address) throws DiagnosticRequestException {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMjI2ODIwNw=="}, "originalCommit": {"oid": "7249aaa5605a2fe30437c827a3022e149063b79c"}, "originalPosition": 121}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNDcwOTA4Mg==", "bodyText": "Maybe moving the logic to it's own class wouldn't be so bad \ud83e\udd14 But I think this is good now since the parsing is only needed in this service.", "url": "https://github.com/nordic-institute/X-Road/pull/427#discussion_r404709082", "createdAt": "2020-04-07T10:37:59Z", "author": {"login": "carohauta"}, "path": "src/proxy-ui-api/src/main/java/org/niis/xroad/restapi/service/DiagnosticService.java", "diffHunk": "@@ -0,0 +1,204 @@\n+/**\n+ * The MIT License\n+ * Copyright (c) 2018 Estonian Information System Authority (RIA),\n+ * Nordic Institute for Interoperability Solutions (NIIS), Population Register Centre (VRK)\n+ * Copyright (c) 2015-2017 Estonian Information System Authority (RIA), Population Register Centre (VRK)\n+ *\n+ * Permission is hereby granted, free of charge, to any person obtaining a copy\n+ * of this software and associated documentation files (the \"Software\"), to deal\n+ * in the Software without restriction, including without limitation the rights\n+ * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\n+ * copies of the Software, and to permit persons to whom the Software is\n+ * furnished to do so, subject to the following conditions:\n+ *\n+ * The above copyright notice and this permission notice shall be included in\n+ * all copies or substantial portions of the Software.\n+ *\n+ * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n+ * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n+ * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n+ * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n+ * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n+ * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\n+ * THE SOFTWARE.\n+ */\n+package org.niis.xroad.restapi.service;\n+\n+import ee.ria.xroad.common.DiagnosticsStatus;\n+import ee.ria.xroad.common.PortNumbers;\n+import ee.ria.xroad.common.SystemProperties;\n+\n+import com.google.gson.Gson;\n+import com.google.gson.JsonElement;\n+import com.google.gson.JsonObject;\n+import com.google.gson.JsonParser;\n+import lombok.extern.slf4j.Slf4j;\n+import org.apache.commons.io.IOUtils;\n+import org.apache.http.HttpEntity;\n+import org.apache.http.client.methods.CloseableHttpResponse;\n+import org.apache.http.client.methods.HttpGet;\n+import org.apache.http.impl.client.CloseableHttpClient;\n+import org.apache.http.impl.client.HttpClients;\n+import org.niis.xroad.restapi.dto.OcspResponderDiagnosticsStatus;\n+import org.niis.xroad.restapi.exceptions.DeviationAwareRuntimeException;\n+import org.niis.xroad.restapi.exceptions.ErrorDeviation;\n+import org.springframework.http.HttpStatus;\n+import org.springframework.security.access.prepost.PreAuthorize;\n+import org.springframework.stereotype.Service;\n+import org.springframework.transaction.annotation.Transactional;\n+\n+import java.io.IOException;\n+import java.util.List;\n+import java.util.Map;\n+import java.util.stream.Collectors;\n+\n+/**\n+ * diagnostic service\n+ */\n+@Slf4j\n+@Service\n+@Transactional\n+@PreAuthorize(\"isAuthenticated()\")\n+public class DiagnosticService {\n+    private static final String DIAGNOSTICS_BASE_URL = \"http://localhost\";\n+    private static final int CONF_CLIENT_ADMIN_PORT = SystemProperties.getConfigurationClientAdminPort();\n+    private static final String CONF_CLIENT_ADMIN_PATH = \"status\";\n+    private static final int TIMESTAMPING_SERVICE_ADMIN_PORT = PortNumbers.ADMIN_PORT;\n+    private static final String TIMESTAMPING_SERVICE_ADMIN_PATH = \"timestampstatus\";\n+    private static final int SIGNER_ADMIN_PORT = SystemProperties.getSignerAdminPort();\n+    private static final String SIGNER_ADMIN_PATH = \"status\";\n+\n+    /**\n+     * Query global configuration status from admin port over HTTP.\n+     * @return\n+     */\n+    public DiagnosticsStatus queryGlobalConfStatus() {\n+        try {\n+            JsonObject json = sendGetRequest(buildUri(CONF_CLIENT_ADMIN_PORT, CONF_CLIENT_ADMIN_PATH));\n+            return new Gson().fromJson(json, DiagnosticsStatus.class);\n+        } catch (DiagnosticRequestException e) {\n+            throw new DeviationAwareRuntimeException(e, e.getErrorDeviation());\n+        }\n+    }\n+\n+    /**\n+     * Query timestamping services status from admin port over HTTP.\n+     * @return\n+     */\n+    public List<DiagnosticsStatus> queryTimestampingStatus() {\n+        try {\n+            JsonObject json = sendGetRequest(buildUri(TIMESTAMPING_SERVICE_ADMIN_PORT,\n+                    TIMESTAMPING_SERVICE_ADMIN_PATH));\n+            return json.entrySet().stream().filter(e -> e.getValue() instanceof JsonObject)\n+                    .map(this::parseTimestampingStatus).collect(Collectors.toList());\n+        } catch (DiagnosticRequestException e) {\n+            throw new DeviationAwareRuntimeException(e, e.getErrorDeviation());\n+        }\n+    }\n+\n+    /**\n+     * Query ocsp responders status from admin port over HTTP.\n+     * @return\n+     */\n+    public List<OcspResponderDiagnosticsStatus> queryOcspResponderStatus() {\n+        try {\n+            JsonObject json = sendGetRequest(buildUri(SIGNER_ADMIN_PORT,\n+                    SIGNER_ADMIN_PATH));\n+            JsonObject certificationServiceStatusMap = json.getAsJsonObject(\"certificationServiceStatusMap\");\n+            return certificationServiceStatusMap.entrySet().stream().filter(e -> e.getValue() instanceof JsonObject)\n+                    .map(this::parseOcspResponderDiagnosticsStatus).collect(Collectors.toList());\n+        } catch (DiagnosticRequestException e) {\n+            throw new DeviationAwareRuntimeException(e, e.getErrorDeviation());\n+        }\n+    }\n+\n+    /**\n+     * Send HTTP GET request to the given address (http://localhost:{port}/{path}).\n+     * @param address\n+     * @return\n+     * @throws DiagnosticRequestException if sending a diagnostics requests fails or an error is returned\n+     */\n+    private JsonObject sendGetRequest(String address) throws DiagnosticRequestException {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMjI2ODIwNw=="}, "originalCommit": {"oid": "7249aaa5605a2fe30437c827a3022e149063b79c"}, "originalPosition": 121}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjQ5NDkwNzQ2OnYy", "diffSide": "RIGHT", "path": "src/proxy-ui-api/src/main/java/org/niis/xroad/restapi/service/DiagnosticService.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wMlQxMjozNzoyN1rOF_pLsA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wNVQxMzozNTozM1rOGBAEMQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMjI3OTM0NA==", "bodyText": "Could the URLs maybe be placed in application properties? Something like this?", "url": "https://github.com/nordic-institute/X-Road/pull/427#discussion_r402279344", "createdAt": "2020-04-02T12:37:27Z", "author": {"login": "carohauta"}, "path": "src/proxy-ui-api/src/main/java/org/niis/xroad/restapi/service/DiagnosticService.java", "diffHunk": "@@ -0,0 +1,204 @@\n+/**\n+ * The MIT License\n+ * Copyright (c) 2018 Estonian Information System Authority (RIA),\n+ * Nordic Institute for Interoperability Solutions (NIIS), Population Register Centre (VRK)\n+ * Copyright (c) 2015-2017 Estonian Information System Authority (RIA), Population Register Centre (VRK)\n+ *\n+ * Permission is hereby granted, free of charge, to any person obtaining a copy\n+ * of this software and associated documentation files (the \"Software\"), to deal\n+ * in the Software without restriction, including without limitation the rights\n+ * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\n+ * copies of the Software, and to permit persons to whom the Software is\n+ * furnished to do so, subject to the following conditions:\n+ *\n+ * The above copyright notice and this permission notice shall be included in\n+ * all copies or substantial portions of the Software.\n+ *\n+ * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n+ * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n+ * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n+ * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n+ * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n+ * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\n+ * THE SOFTWARE.\n+ */\n+package org.niis.xroad.restapi.service;\n+\n+import ee.ria.xroad.common.DiagnosticsStatus;\n+import ee.ria.xroad.common.PortNumbers;\n+import ee.ria.xroad.common.SystemProperties;\n+\n+import com.google.gson.Gson;\n+import com.google.gson.JsonElement;\n+import com.google.gson.JsonObject;\n+import com.google.gson.JsonParser;\n+import lombok.extern.slf4j.Slf4j;\n+import org.apache.commons.io.IOUtils;\n+import org.apache.http.HttpEntity;\n+import org.apache.http.client.methods.CloseableHttpResponse;\n+import org.apache.http.client.methods.HttpGet;\n+import org.apache.http.impl.client.CloseableHttpClient;\n+import org.apache.http.impl.client.HttpClients;\n+import org.niis.xroad.restapi.dto.OcspResponderDiagnosticsStatus;\n+import org.niis.xroad.restapi.exceptions.DeviationAwareRuntimeException;\n+import org.niis.xroad.restapi.exceptions.ErrorDeviation;\n+import org.springframework.http.HttpStatus;\n+import org.springframework.security.access.prepost.PreAuthorize;\n+import org.springframework.stereotype.Service;\n+import org.springframework.transaction.annotation.Transactional;\n+\n+import java.io.IOException;\n+import java.util.List;\n+import java.util.Map;\n+import java.util.stream.Collectors;\n+\n+/**\n+ * diagnostic service\n+ */\n+@Slf4j\n+@Service\n+@Transactional\n+@PreAuthorize(\"isAuthenticated()\")\n+public class DiagnosticService {\n+    private static final String DIAGNOSTICS_BASE_URL = \"http://localhost\";", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "7249aaa5605a2fe30437c827a3022e149063b79c"}, "originalPosition": 63}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMzcwMjgzMw==", "bodyText": "Moved URLs to application properties.", "url": "https://github.com/nordic-institute/X-Road/pull/427#discussion_r403702833", "createdAt": "2020-04-05T13:35:33Z", "author": {"login": "petkivim"}, "path": "src/proxy-ui-api/src/main/java/org/niis/xroad/restapi/service/DiagnosticService.java", "diffHunk": "@@ -0,0 +1,204 @@\n+/**\n+ * The MIT License\n+ * Copyright (c) 2018 Estonian Information System Authority (RIA),\n+ * Nordic Institute for Interoperability Solutions (NIIS), Population Register Centre (VRK)\n+ * Copyright (c) 2015-2017 Estonian Information System Authority (RIA), Population Register Centre (VRK)\n+ *\n+ * Permission is hereby granted, free of charge, to any person obtaining a copy\n+ * of this software and associated documentation files (the \"Software\"), to deal\n+ * in the Software without restriction, including without limitation the rights\n+ * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\n+ * copies of the Software, and to permit persons to whom the Software is\n+ * furnished to do so, subject to the following conditions:\n+ *\n+ * The above copyright notice and this permission notice shall be included in\n+ * all copies or substantial portions of the Software.\n+ *\n+ * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n+ * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n+ * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n+ * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n+ * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n+ * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\n+ * THE SOFTWARE.\n+ */\n+package org.niis.xroad.restapi.service;\n+\n+import ee.ria.xroad.common.DiagnosticsStatus;\n+import ee.ria.xroad.common.PortNumbers;\n+import ee.ria.xroad.common.SystemProperties;\n+\n+import com.google.gson.Gson;\n+import com.google.gson.JsonElement;\n+import com.google.gson.JsonObject;\n+import com.google.gson.JsonParser;\n+import lombok.extern.slf4j.Slf4j;\n+import org.apache.commons.io.IOUtils;\n+import org.apache.http.HttpEntity;\n+import org.apache.http.client.methods.CloseableHttpResponse;\n+import org.apache.http.client.methods.HttpGet;\n+import org.apache.http.impl.client.CloseableHttpClient;\n+import org.apache.http.impl.client.HttpClients;\n+import org.niis.xroad.restapi.dto.OcspResponderDiagnosticsStatus;\n+import org.niis.xroad.restapi.exceptions.DeviationAwareRuntimeException;\n+import org.niis.xroad.restapi.exceptions.ErrorDeviation;\n+import org.springframework.http.HttpStatus;\n+import org.springframework.security.access.prepost.PreAuthorize;\n+import org.springframework.stereotype.Service;\n+import org.springframework.transaction.annotation.Transactional;\n+\n+import java.io.IOException;\n+import java.util.List;\n+import java.util.Map;\n+import java.util.stream.Collectors;\n+\n+/**\n+ * diagnostic service\n+ */\n+@Slf4j\n+@Service\n+@Transactional\n+@PreAuthorize(\"isAuthenticated()\")\n+public class DiagnosticService {\n+    private static final String DIAGNOSTICS_BASE_URL = \"http://localhost\";", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMjI3OTM0NA=="}, "originalCommit": {"oid": "7249aaa5605a2fe30437c827a3022e149063b79c"}, "originalPosition": 63}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjQ5NTE2Njg3OnYy", "diffSide": "RIGHT", "path": "src/proxy-ui-api/src/test/java/org/niis/xroad/restapi/converter/GlobalConfDiagnosticConverterTest.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wMlQxMzozOTo0MVrOF_rrqA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wNVQxMzozNTo0M1rOGBAEQg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMjMyMDI5Ng==", "bodyText": "This test class does not seem to depend on Spring so removing these annotations will speed up this test a lot.", "url": "https://github.com/nordic-institute/X-Road/pull/427#discussion_r402320296", "createdAt": "2020-04-02T13:39:41Z", "author": {"login": "carohauta"}, "path": "src/proxy-ui-api/src/test/java/org/niis/xroad/restapi/converter/GlobalConfDiagnosticConverterTest.java", "diffHunk": "@@ -0,0 +1,85 @@\n+/**\n+ * The MIT License\n+ * Copyright (c) 2018 Estonian Information System Authority (RIA),\n+ * Nordic Institute for Interoperability Solutions (NIIS), Population Register Centre (VRK)\n+ * Copyright (c) 2015-2017 Estonian Information System Authority (RIA), Population Register Centre (VRK)\n+ *\n+ * Permission is hereby granted, free of charge, to any person obtaining a copy\n+ * of this software and associated documentation files (the \"Software\"), to deal\n+ * in the Software without restriction, including without limitation the rights\n+ * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\n+ * copies of the Software, and to permit persons to whom the Software is\n+ * furnished to do so, subject to the following conditions:\n+ *\n+ * The above copyright notice and this permission notice shall be included in\n+ * all copies or substantial portions of the Software.\n+ *\n+ * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n+ * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n+ * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n+ * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n+ * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n+ * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\n+ * THE SOFTWARE.\n+ */\n+package org.niis.xroad.restapi.converter;\n+\n+import ee.ria.xroad.common.DiagnosticsErrorCodes;\n+import ee.ria.xroad.common.DiagnosticsStatus;\n+\n+import org.joda.time.DateTimeUtils;\n+import org.junit.After;\n+import org.junit.Before;\n+import org.junit.Test;\n+import org.junit.runner.RunWith;\n+import org.niis.xroad.restapi.openapi.model.ConfigurationStatus;\n+import org.niis.xroad.restapi.openapi.model.DiagnosticStatusClass;\n+import org.niis.xroad.restapi.openapi.model.GlobalConfDiagnostics;\n+import org.niis.xroad.restapi.util.TestUtils;\n+import org.springframework.boot.test.context.SpringBootTest;\n+import org.springframework.test.context.junit4.SpringRunner;\n+\n+import java.time.LocalTime;\n+\n+import static org.junit.Assert.assertEquals;\n+\n+/**\n+ * Test GlobalConfDiagnosticConverter\n+ */\n+@RunWith(SpringRunner.class)\n+@SpringBootTest\n+public class GlobalConfDiagnosticConverterTest {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "7249aaa5605a2fe30437c827a3022e149063b79c"}, "originalPosition": 51}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMzcwMjg1MA==", "bodyText": "Fixed. Updated the other converter test classes accordingly too.", "url": "https://github.com/nordic-institute/X-Road/pull/427#discussion_r403702850", "createdAt": "2020-04-05T13:35:43Z", "author": {"login": "petkivim"}, "path": "src/proxy-ui-api/src/test/java/org/niis/xroad/restapi/converter/GlobalConfDiagnosticConverterTest.java", "diffHunk": "@@ -0,0 +1,85 @@\n+/**\n+ * The MIT License\n+ * Copyright (c) 2018 Estonian Information System Authority (RIA),\n+ * Nordic Institute for Interoperability Solutions (NIIS), Population Register Centre (VRK)\n+ * Copyright (c) 2015-2017 Estonian Information System Authority (RIA), Population Register Centre (VRK)\n+ *\n+ * Permission is hereby granted, free of charge, to any person obtaining a copy\n+ * of this software and associated documentation files (the \"Software\"), to deal\n+ * in the Software without restriction, including without limitation the rights\n+ * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\n+ * copies of the Software, and to permit persons to whom the Software is\n+ * furnished to do so, subject to the following conditions:\n+ *\n+ * The above copyright notice and this permission notice shall be included in\n+ * all copies or substantial portions of the Software.\n+ *\n+ * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n+ * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n+ * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n+ * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n+ * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n+ * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\n+ * THE SOFTWARE.\n+ */\n+package org.niis.xroad.restapi.converter;\n+\n+import ee.ria.xroad.common.DiagnosticsErrorCodes;\n+import ee.ria.xroad.common.DiagnosticsStatus;\n+\n+import org.joda.time.DateTimeUtils;\n+import org.junit.After;\n+import org.junit.Before;\n+import org.junit.Test;\n+import org.junit.runner.RunWith;\n+import org.niis.xroad.restapi.openapi.model.ConfigurationStatus;\n+import org.niis.xroad.restapi.openapi.model.DiagnosticStatusClass;\n+import org.niis.xroad.restapi.openapi.model.GlobalConfDiagnostics;\n+import org.niis.xroad.restapi.util.TestUtils;\n+import org.springframework.boot.test.context.SpringBootTest;\n+import org.springframework.test.context.junit4.SpringRunner;\n+\n+import java.time.LocalTime;\n+\n+import static org.junit.Assert.assertEquals;\n+\n+/**\n+ * Test GlobalConfDiagnosticConverter\n+ */\n+@RunWith(SpringRunner.class)\n+@SpringBootTest\n+public class GlobalConfDiagnosticConverterTest {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMjMyMDI5Ng=="}, "originalCommit": {"oid": "7249aaa5605a2fe30437c827a3022e149063b79c"}, "originalPosition": 51}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjQ5NTE3MzQzOnYy", "diffSide": "RIGHT", "path": "src/proxy-ui-api/src/test/java/org/niis/xroad/restapi/converter/OcspResponderDiagnosticConverterTest.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wMlQxMzo0MDo1OFrOF_rvcQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wNVQxMzozNjoyMVrOGBAEdw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMjMyMTI2NQ==", "bodyText": "Speed up this test too by removing these Spring annotations", "url": "https://github.com/nordic-institute/X-Road/pull/427#discussion_r402321265", "createdAt": "2020-04-02T13:40:58Z", "author": {"login": "carohauta"}, "path": "src/proxy-ui-api/src/test/java/org/niis/xroad/restapi/converter/OcspResponderDiagnosticConverterTest.java", "diffHunk": "@@ -0,0 +1,161 @@\n+/**\n+ * The MIT License\n+ * Copyright (c) 2018 Estonian Information System Authority (RIA),\n+ * Nordic Institute for Interoperability Solutions (NIIS), Population Register Centre (VRK)\n+ * Copyright (c) 2015-2017 Estonian Information System Authority (RIA), Population Register Centre (VRK)\n+ *\n+ * Permission is hereby granted, free of charge, to any person obtaining a copy\n+ * of this software and associated documentation files (the \"Software\"), to deal\n+ * in the Software without restriction, including without limitation the rights\n+ * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\n+ * copies of the Software, and to permit persons to whom the Software is\n+ * furnished to do so, subject to the following conditions:\n+ *\n+ * The above copyright notice and this permission notice shall be included in\n+ * all copies or substantial portions of the Software.\n+ *\n+ * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n+ * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n+ * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n+ * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n+ * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n+ * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\n+ * THE SOFTWARE.\n+ */\n+\n+package org.niis.xroad.restapi.converter;\n+\n+import ee.ria.xroad.common.DiagnosticsErrorCodes;\n+import ee.ria.xroad.common.DiagnosticsStatus;\n+\n+import org.joda.time.DateTimeUtils;\n+import org.junit.After;\n+import org.junit.Before;\n+import org.junit.Test;\n+import org.junit.runner.RunWith;\n+import org.niis.xroad.restapi.dto.OcspResponderDiagnosticsStatus;\n+import org.niis.xroad.restapi.openapi.model.DiagnosticStatusClass;\n+import org.niis.xroad.restapi.openapi.model.OcspResponderDiagnostics;\n+import org.niis.xroad.restapi.openapi.model.OcspStatus;\n+import org.niis.xroad.restapi.util.TestUtils;\n+import org.springframework.boot.test.context.SpringBootTest;\n+import org.springframework.test.context.junit4.SpringRunner;\n+\n+import java.time.LocalTime;\n+import java.util.Arrays;\n+import java.util.List;\n+\n+import static org.junit.Assert.assertEquals;\n+\n+/**\n+ * Test CertificateAuthorityDiagnosticConverter\n+ */\n+@RunWith(SpringRunner.class)\n+@SpringBootTest\n+public class OcspResponderDiagnosticConverterTest {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "7249aaa5605a2fe30437c827a3022e149063b79c"}, "originalPosition": 55}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMzcwMjkwMw==", "bodyText": "Fixed.", "url": "https://github.com/nordic-institute/X-Road/pull/427#discussion_r403702903", "createdAt": "2020-04-05T13:36:21Z", "author": {"login": "petkivim"}, "path": "src/proxy-ui-api/src/test/java/org/niis/xroad/restapi/converter/OcspResponderDiagnosticConverterTest.java", "diffHunk": "@@ -0,0 +1,161 @@\n+/**\n+ * The MIT License\n+ * Copyright (c) 2018 Estonian Information System Authority (RIA),\n+ * Nordic Institute for Interoperability Solutions (NIIS), Population Register Centre (VRK)\n+ * Copyright (c) 2015-2017 Estonian Information System Authority (RIA), Population Register Centre (VRK)\n+ *\n+ * Permission is hereby granted, free of charge, to any person obtaining a copy\n+ * of this software and associated documentation files (the \"Software\"), to deal\n+ * in the Software without restriction, including without limitation the rights\n+ * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\n+ * copies of the Software, and to permit persons to whom the Software is\n+ * furnished to do so, subject to the following conditions:\n+ *\n+ * The above copyright notice and this permission notice shall be included in\n+ * all copies or substantial portions of the Software.\n+ *\n+ * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n+ * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n+ * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n+ * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n+ * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n+ * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\n+ * THE SOFTWARE.\n+ */\n+\n+package org.niis.xroad.restapi.converter;\n+\n+import ee.ria.xroad.common.DiagnosticsErrorCodes;\n+import ee.ria.xroad.common.DiagnosticsStatus;\n+\n+import org.joda.time.DateTimeUtils;\n+import org.junit.After;\n+import org.junit.Before;\n+import org.junit.Test;\n+import org.junit.runner.RunWith;\n+import org.niis.xroad.restapi.dto.OcspResponderDiagnosticsStatus;\n+import org.niis.xroad.restapi.openapi.model.DiagnosticStatusClass;\n+import org.niis.xroad.restapi.openapi.model.OcspResponderDiagnostics;\n+import org.niis.xroad.restapi.openapi.model.OcspStatus;\n+import org.niis.xroad.restapi.util.TestUtils;\n+import org.springframework.boot.test.context.SpringBootTest;\n+import org.springframework.test.context.junit4.SpringRunner;\n+\n+import java.time.LocalTime;\n+import java.util.Arrays;\n+import java.util.List;\n+\n+import static org.junit.Assert.assertEquals;\n+\n+/**\n+ * Test CertificateAuthorityDiagnosticConverter\n+ */\n+@RunWith(SpringRunner.class)\n+@SpringBootTest\n+public class OcspResponderDiagnosticConverterTest {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMjMyMTI2NQ=="}, "originalCommit": {"oid": "7249aaa5605a2fe30437c827a3022e149063b79c"}, "originalPosition": 55}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjQ5NTE5MDk3OnYy", "diffSide": "RIGHT", "path": "src/proxy-ui-api/src/test/java/org/niis/xroad/restapi/converter/TimestampingServiceDiagnosticConverterTest.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wMlQxMzo0NDozNVrOF_r6LQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wNVQxMzozNjozMFrOGBAEfw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMjMyNDAxMw==", "bodyText": "Speed up this test too by removing these Spring annotations", "url": "https://github.com/nordic-institute/X-Road/pull/427#discussion_r402324013", "createdAt": "2020-04-02T13:44:35Z", "author": {"login": "carohauta"}, "path": "src/proxy-ui-api/src/test/java/org/niis/xroad/restapi/converter/TimestampingServiceDiagnosticConverterTest.java", "diffHunk": "@@ -0,0 +1,120 @@\n+/**\n+ * The MIT License\n+ * Copyright (c) 2018 Estonian Information System Authority (RIA),\n+ * Nordic Institute for Interoperability Solutions (NIIS), Population Register Centre (VRK)\n+ * Copyright (c) 2015-2017 Estonian Information System Authority (RIA), Population Register Centre (VRK)\n+ *\n+ * Permission is hereby granted, free of charge, to any person obtaining a copy\n+ * of this software and associated documentation files (the \"Software\"), to deal\n+ * in the Software without restriction, including without limitation the rights\n+ * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\n+ * copies of the Software, and to permit persons to whom the Software is\n+ * furnished to do so, subject to the following conditions:\n+ *\n+ * The above copyright notice and this permission notice shall be included in\n+ * all copies or substantial portions of the Software.\n+ *\n+ * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n+ * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n+ * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n+ * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n+ * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n+ * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\n+ * THE SOFTWARE.\n+ */\n+package org.niis.xroad.restapi.converter;\n+import ee.ria.xroad.common.DiagnosticsErrorCodes;\n+import ee.ria.xroad.common.DiagnosticsStatus;\n+\n+import org.joda.time.DateTimeUtils;\n+import org.junit.After;\n+import org.junit.Before;\n+import org.junit.Test;\n+import org.junit.runner.RunWith;\n+import org.niis.xroad.restapi.openapi.model.DiagnosticStatusClass;\n+import org.niis.xroad.restapi.openapi.model.TimestampingServiceDiagnostics;\n+import org.niis.xroad.restapi.openapi.model.TimestampingStatus;\n+import org.niis.xroad.restapi.util.TestUtils;\n+import org.springframework.boot.test.context.SpringBootTest;\n+import org.springframework.test.context.junit4.SpringRunner;\n+\n+import java.time.LocalTime;\n+import java.util.ArrayList;\n+import java.util.Arrays;\n+import java.util.List;\n+\n+import static org.junit.Assert.assertEquals;\n+\n+/**\n+ * Test TimestampingServiceDiagnosticConverter\n+ */\n+@RunWith(SpringRunner.class)\n+@SpringBootTest\n+public class TimestampingServiceDiagnosticConverterTest {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "7249aaa5605a2fe30437c827a3022e149063b79c"}, "originalPosition": 53}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMzcwMjkxMQ==", "bodyText": "Fixed.", "url": "https://github.com/nordic-institute/X-Road/pull/427#discussion_r403702911", "createdAt": "2020-04-05T13:36:30Z", "author": {"login": "petkivim"}, "path": "src/proxy-ui-api/src/test/java/org/niis/xroad/restapi/converter/TimestampingServiceDiagnosticConverterTest.java", "diffHunk": "@@ -0,0 +1,120 @@\n+/**\n+ * The MIT License\n+ * Copyright (c) 2018 Estonian Information System Authority (RIA),\n+ * Nordic Institute for Interoperability Solutions (NIIS), Population Register Centre (VRK)\n+ * Copyright (c) 2015-2017 Estonian Information System Authority (RIA), Population Register Centre (VRK)\n+ *\n+ * Permission is hereby granted, free of charge, to any person obtaining a copy\n+ * of this software and associated documentation files (the \"Software\"), to deal\n+ * in the Software without restriction, including without limitation the rights\n+ * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\n+ * copies of the Software, and to permit persons to whom the Software is\n+ * furnished to do so, subject to the following conditions:\n+ *\n+ * The above copyright notice and this permission notice shall be included in\n+ * all copies or substantial portions of the Software.\n+ *\n+ * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n+ * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n+ * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n+ * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n+ * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n+ * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\n+ * THE SOFTWARE.\n+ */\n+package org.niis.xroad.restapi.converter;\n+import ee.ria.xroad.common.DiagnosticsErrorCodes;\n+import ee.ria.xroad.common.DiagnosticsStatus;\n+\n+import org.joda.time.DateTimeUtils;\n+import org.junit.After;\n+import org.junit.Before;\n+import org.junit.Test;\n+import org.junit.runner.RunWith;\n+import org.niis.xroad.restapi.openapi.model.DiagnosticStatusClass;\n+import org.niis.xroad.restapi.openapi.model.TimestampingServiceDiagnostics;\n+import org.niis.xroad.restapi.openapi.model.TimestampingStatus;\n+import org.niis.xroad.restapi.util.TestUtils;\n+import org.springframework.boot.test.context.SpringBootTest;\n+import org.springframework.test.context.junit4.SpringRunner;\n+\n+import java.time.LocalTime;\n+import java.util.ArrayList;\n+import java.util.Arrays;\n+import java.util.List;\n+\n+import static org.junit.Assert.assertEquals;\n+\n+/**\n+ * Test TimestampingServiceDiagnosticConverter\n+ */\n+@RunWith(SpringRunner.class)\n+@SpringBootTest\n+public class TimestampingServiceDiagnosticConverterTest {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMjMyNDAxMw=="}, "originalCommit": {"oid": "7249aaa5605a2fe30437c827a3022e149063b79c"}, "originalPosition": 53}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjQ5NTIwMDQ2OnYy", "diffSide": "RIGHT", "path": "src/proxy-ui-api/src/test/java/org/niis/xroad/restapi/openapi/DiagnosticsApiControllerTest.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wMlQxMzo0NjozM1rOF_r_9g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wNVQxMzozODoyOVrOGBAFlQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMjMyNTQ5NA==", "bodyText": "Very thorough testing going on here! \ud83d\udc4d", "url": "https://github.com/nordic-institute/X-Road/pull/427#discussion_r402325494", "createdAt": "2020-04-02T13:46:33Z", "author": {"login": "carohauta"}, "path": "src/proxy-ui-api/src/test/java/org/niis/xroad/restapi/openapi/DiagnosticsApiControllerTest.java", "diffHunk": "@@ -0,0 +1,413 @@\n+/**\n+ * The MIT License\n+ * Copyright (c) 2018 Estonian Information System Authority (RIA),\n+ * Nordic Institute for Interoperability Solutions (NIIS), Population Register Centre (VRK)\n+ * Copyright (c) 2015-2017 Estonian Information System Authority (RIA), Population Register Centre (VRK)\n+ *\n+ * Permission is hereby granted, free of charge, to any person obtaining a copy\n+ * of this software and associated documentation files (the \"Software\"), to deal\n+ * in the Software without restriction, including without limitation the rights\n+ * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\n+ * copies of the Software, and to permit persons to whom the Software is\n+ * furnished to do so, subject to the following conditions:\n+ *\n+ * The above copyright notice and this permission notice shall be included in\n+ * all copies or substantial portions of the Software.\n+ *\n+ * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n+ * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n+ * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n+ * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n+ * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n+ * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\n+ * THE SOFTWARE.\n+ */\n+package org.niis.xroad.restapi.openapi;\n+\n+import ee.ria.xroad.common.DiagnosticsErrorCodes;\n+import ee.ria.xroad.common.DiagnosticsStatus;\n+\n+import lombok.extern.slf4j.Slf4j;\n+import org.joda.time.DateTimeUtils;\n+import org.junit.After;\n+import org.junit.Test;\n+import org.junit.runner.RunWith;\n+import org.niis.xroad.restapi.dto.OcspResponderDiagnosticsStatus;\n+import org.niis.xroad.restapi.openapi.model.ConfigurationStatus;\n+import org.niis.xroad.restapi.openapi.model.DiagnosticStatusClass;\n+import org.niis.xroad.restapi.openapi.model.GlobalConfDiagnostics;\n+import org.niis.xroad.restapi.openapi.model.OcspResponderDiagnostics;\n+import org.niis.xroad.restapi.openapi.model.OcspStatus;\n+import org.niis.xroad.restapi.openapi.model.TimestampingServiceDiagnostics;\n+import org.niis.xroad.restapi.openapi.model.TimestampingStatus;\n+import org.niis.xroad.restapi.service.DiagnosticService;\n+import org.niis.xroad.restapi.util.TestUtils;\n+import org.springframework.beans.factory.annotation.Autowired;\n+import org.springframework.boot.test.autoconfigure.jdbc.AutoConfigureTestDatabase;\n+import org.springframework.boot.test.context.SpringBootTest;\n+import org.springframework.boot.test.mock.mockito.MockBean;\n+import org.springframework.http.HttpStatus;\n+import org.springframework.http.ResponseEntity;\n+import org.springframework.security.test.context.support.WithMockUser;\n+import org.springframework.test.context.junit4.SpringRunner;\n+import org.springframework.transaction.annotation.Transactional;\n+\n+import java.time.LocalTime;\n+import java.util.Arrays;\n+import java.util.List;\n+\n+import static junit.framework.TestCase.fail;\n+import static org.junit.Assert.assertEquals;\n+import static org.mockito.Mockito.when;\n+\n+/**\n+ * Test DiagnosticsApiController\n+ */\n+@RunWith(SpringRunner.class)\n+@SpringBootTest\n+@AutoConfigureTestDatabase\n+@Transactional\n+@Slf4j\n+public class DiagnosticsApiControllerTest {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "7249aaa5605a2fe30437c827a3022e149063b79c"}, "originalPosition": 71}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMzcwMzE4OQ==", "bodyText": "The date/time conversions were a bit tricky since the source data uses LocalTime that does not contain date information. Therefore, better to test them thoroughly. :)", "url": "https://github.com/nordic-institute/X-Road/pull/427#discussion_r403703189", "createdAt": "2020-04-05T13:38:29Z", "author": {"login": "petkivim"}, "path": "src/proxy-ui-api/src/test/java/org/niis/xroad/restapi/openapi/DiagnosticsApiControllerTest.java", "diffHunk": "@@ -0,0 +1,413 @@\n+/**\n+ * The MIT License\n+ * Copyright (c) 2018 Estonian Information System Authority (RIA),\n+ * Nordic Institute for Interoperability Solutions (NIIS), Population Register Centre (VRK)\n+ * Copyright (c) 2015-2017 Estonian Information System Authority (RIA), Population Register Centre (VRK)\n+ *\n+ * Permission is hereby granted, free of charge, to any person obtaining a copy\n+ * of this software and associated documentation files (the \"Software\"), to deal\n+ * in the Software without restriction, including without limitation the rights\n+ * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\n+ * copies of the Software, and to permit persons to whom the Software is\n+ * furnished to do so, subject to the following conditions:\n+ *\n+ * The above copyright notice and this permission notice shall be included in\n+ * all copies or substantial portions of the Software.\n+ *\n+ * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n+ * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n+ * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n+ * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n+ * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n+ * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\n+ * THE SOFTWARE.\n+ */\n+package org.niis.xroad.restapi.openapi;\n+\n+import ee.ria.xroad.common.DiagnosticsErrorCodes;\n+import ee.ria.xroad.common.DiagnosticsStatus;\n+\n+import lombok.extern.slf4j.Slf4j;\n+import org.joda.time.DateTimeUtils;\n+import org.junit.After;\n+import org.junit.Test;\n+import org.junit.runner.RunWith;\n+import org.niis.xroad.restapi.dto.OcspResponderDiagnosticsStatus;\n+import org.niis.xroad.restapi.openapi.model.ConfigurationStatus;\n+import org.niis.xroad.restapi.openapi.model.DiagnosticStatusClass;\n+import org.niis.xroad.restapi.openapi.model.GlobalConfDiagnostics;\n+import org.niis.xroad.restapi.openapi.model.OcspResponderDiagnostics;\n+import org.niis.xroad.restapi.openapi.model.OcspStatus;\n+import org.niis.xroad.restapi.openapi.model.TimestampingServiceDiagnostics;\n+import org.niis.xroad.restapi.openapi.model.TimestampingStatus;\n+import org.niis.xroad.restapi.service.DiagnosticService;\n+import org.niis.xroad.restapi.util.TestUtils;\n+import org.springframework.beans.factory.annotation.Autowired;\n+import org.springframework.boot.test.autoconfigure.jdbc.AutoConfigureTestDatabase;\n+import org.springframework.boot.test.context.SpringBootTest;\n+import org.springframework.boot.test.mock.mockito.MockBean;\n+import org.springframework.http.HttpStatus;\n+import org.springframework.http.ResponseEntity;\n+import org.springframework.security.test.context.support.WithMockUser;\n+import org.springframework.test.context.junit4.SpringRunner;\n+import org.springframework.transaction.annotation.Transactional;\n+\n+import java.time.LocalTime;\n+import java.util.Arrays;\n+import java.util.List;\n+\n+import static junit.framework.TestCase.fail;\n+import static org.junit.Assert.assertEquals;\n+import static org.mockito.Mockito.when;\n+\n+/**\n+ * Test DiagnosticsApiController\n+ */\n+@RunWith(SpringRunner.class)\n+@SpringBootTest\n+@AutoConfigureTestDatabase\n+@Transactional\n+@Slf4j\n+public class DiagnosticsApiControllerTest {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMjMyNTQ5NA=="}, "originalCommit": {"oid": "7249aaa5605a2fe30437c827a3022e149063b79c"}, "originalPosition": 71}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2790, "cost": 1, "resetAt": "2021-11-12T20:28:25Z"}}}