{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0Mzc0NDI4NTU4", "number": 365, "title": "XRDDEV-913", "bodyText": "Fix xroad-opmonitor standalone installation for Ubuntu 18", "createdAt": "2020-02-12T17:15:54Z", "url": "https://github.com/nordic-institute/X-Road/pull/365", "merged": true, "mergeCommit": {"oid": "476c2600502842e8c5484a97f378a06db62cbf12"}, "closed": true, "closedAt": "2020-02-19T10:22:14Z", "author": {"login": "iluwatar"}, "timelineItems": {"totalCount": 7, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcDUz9zgH2gAyMzc0NDI4NTU4OjU0NTI4NzJhY2UyNGY1OWFlZWE3MjcyZGFlYjUwNzM4ZDQ3NmI0Mzk=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcFz4DMgFqTM2MDk5NDE5Mg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "5452872ace24f59aeea7272daeb50738d476b439", "author": {"user": {"login": "iluwatar", "name": "Ilkka Sepp\u00e4l\u00e4"}}, "url": "https://github.com/nordic-institute/X-Road/commit/5452872ace24f59aeea7272daeb50738d476b439", "committedDate": "2020-02-11T17:02:43Z", "message": "XRDDEV-913 add debug logging"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b65acb6c83f280bb50d1729de551800f2052d851", "author": {"user": {"login": "iluwatar", "name": "Ilkka Sepp\u00e4l\u00e4"}}, "url": "https://github.com/nordic-institute/X-Road/commit/b65acb6c83f280bb50d1729de551800f2052d851", "committedDate": "2020-02-12T12:23:26Z", "message": "XRDDEV-913 fix op-monitor standalone installation on Ubuntu"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c2c245a932fbe534e5b35db0fa66ee350f1bc93c", "author": {"user": {"login": "iluwatar", "name": "Ilkka Sepp\u00e4l\u00e4"}}, "url": "https://github.com/nordic-institute/X-Road/commit/c2c245a932fbe534e5b35db0fa66ee350f1bc93c", "committedDate": "2020-02-12T15:51:26Z", "message": "Revert \"XRDDEV-913 add debug logging\"\n\nThis reverts commit 5452872ace24f59aeea7272daeb50738d476b439."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzU5NjQxNjQw", "url": "https://github.com/nordic-institute/X-Road/pull/365#pullrequestreview-359641640", "createdAt": "2020-02-17T10:44:03Z", "commit": {"oid": "c2c245a932fbe534e5b35db0fa66ee350f1bc93c"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xN1QxMDo0NDowM1rOFqf8pw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xN1QxMDo0NDowM1rOFqf8pw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MDEwNzk0Mw==", "bodyText": "I suppose that this can still fail if opmonitor is standalone and using remote DB? This could be fixed by reverting the changes, and making the db_get not to fail (makes it also possible to use a pre-initialized remote db). Something like:\nRET=\ndb_get xroad-common/database-host || true\ndb_host=\"${RET:-127.0.0.1:5432}\"\ndb_stop", "url": "https://github.com/nordic-institute/X-Road/pull/365#discussion_r380107943", "createdAt": "2020-02-17T10:44:03Z", "author": {"login": "jhyoty"}, "path": "src/packages/src/xroad/ubuntu/generic/xroad-opmonitor.postinst", "diffHunk": "@@ -33,24 +33,25 @@ configure() {\n \n   db_properties=/etc/xroad/db.properties\n   root_properties=/etc/xroad.properties\n-\n-  RET=\n-  db_get xroad-common/database-host\n-  db_host=\"$RET\"\n-  db_url=jdbc:postgresql://${db_host}/${db_name}\n-  db_addr=${db_host%%:*}\n-  db_port=${db_host##*:}\n-  db_initialized=false\n+  db_host=127.0.0.1:5432\n \n   if  [[ -f ${root_properties} && $(get_prop ${root_properties} postgres.connection.password) != \"\" ]]\n   then\n     master_passwd=$(crudini --get ${root_properties} '' postgres.connection.password)\n     export PGPASSWORD=${master_passwd}\n     psql_cmd=remote_psql\n+    RET=\n+    db_get xroad-common/database-host", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c2c245a932fbe534e5b35db0fa66ee350f1bc93c"}, "originalPosition": 20}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "48d8f07128151cb2ab5713a5379f7dd1a27fe418", "author": {"user": {"login": "iluwatar", "name": "Ilkka Sepp\u00e4l\u00e4"}}, "url": "https://github.com/nordic-institute/X-Road/commit/48d8f07128151cb2ab5713a5379f7dd1a27fe418", "committedDate": "2020-02-19T07:27:23Z", "message": "Revert \"XRDDEV-913 fix op-monitor standalone installation on Ubuntu\"\n\nThis reverts commit b65acb6c83f280bb50d1729de551800f2052d851."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b946da4ce1f45689333fa55acfe7ccbdadfbfba1", "author": {"user": {"login": "iluwatar", "name": "Ilkka Sepp\u00e4l\u00e4"}}, "url": "https://github.com/nordic-institute/X-Road/commit/b946da4ce1f45689333fa55acfe7ccbdadfbfba1", "committedDate": "2020-02-19T07:30:48Z", "message": "XRDDEV-913 reading db host does not fail"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzYwOTk0MTky", "url": "https://github.com/nordic-institute/X-Road/pull/365#pullrequestreview-360994192", "createdAt": "2020-02-19T10:22:05Z", "commit": {"oid": "b946da4ce1f45689333fa55acfe7ccbdadfbfba1"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4308, "cost": 1, "resetAt": "2021-11-01T16:19:10Z"}}}