{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDc3MDU3NTg1", "number": 678, "title": "XRDDEV-680 OpenAPI validation", "bodyText": "Adds an OpenAPI validator Gradle Plugin to the project. Check confluence for additional info about the validator and the reasons/tech behind it: https://confluence.niis.org/display/XRDDEV/OpenAPI+3+Validation\nJIRA: https://jira.niis.org/browse/XRDDEV-680", "createdAt": "2020-09-01T12:47:54Z", "url": "https://github.com/nordic-institute/X-Road/pull/678", "merged": true, "mergeCommit": {"oid": "4feb2d829aef3867b3dc203de3c7adcf99da9026"}, "closed": true, "closedAt": "2020-09-10T07:55:10Z", "author": {"login": "carohauta"}, "timelineItems": {"totalCount": 15, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdC_tNYgH2gAyNDc3MDU3NTg1OmVjMGYyMWVjYTc2MzdlOTE5ZjM0YzcwMDgzYzNjOWUzMmFmODc4N2I=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdHKZL-AFqTQ4NDkwNzExMg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "ec0f21eca7637e919f34c70083c3c9e32af8787b", "author": {"user": {"login": "carohauta", "name": "Caro Hautam\u00e4ki"}}, "url": "https://github.com/nordic-institute/X-Road/commit/ec0f21eca7637e919f34c70083c3c9e32af8787b", "committedDate": "2020-08-27T12:38:29Z", "message": "XRDDEV-680 Fix validation warnings"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "9f8f700bc9baf87648dae530e44e1e8b91547da0", "author": {"user": {"login": "carohauta", "name": "Caro Hautam\u00e4ki"}}, "url": "https://github.com/nordic-institute/X-Road/commit/9f8f700bc9baf87648dae530e44e1e8b91547da0", "committedDate": "2020-08-27T12:43:50Z", "message": "XRDDEV-680 Fix one more validation warning"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f1659d32521a7656c031b15f5f9a14b2f8cdf9e7", "author": {"user": {"login": "carohauta", "name": "Caro Hautam\u00e4ki"}}, "url": "https://github.com/nordic-institute/X-Road/commit/f1659d32521a7656c031b15f5f9a14b2f8cdf9e7", "committedDate": "2020-08-31T12:56:13Z", "message": "XRDDEV-680 Add oas-validator module"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "169f603f311bb1dc9d6508ca1fedea0085d61fe1", "author": {"user": {"login": "carohauta", "name": "Caro Hautam\u00e4ki"}}, "url": "https://github.com/nordic-institute/X-Road/commit/169f603f311bb1dc9d6508ca1fedea0085d61fe1", "committedDate": "2020-08-31T13:07:02Z", "message": "XRDDEV-680 Fix more validation errors"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "206060f6d8b7ca8d8ea86b6c7b65013728574918", "author": {"user": {"login": "carohauta", "name": "Caro Hautam\u00e4ki"}}, "url": "https://github.com/nordic-institute/X-Road/commit/206060f6d8b7ca8d8ea86b6c7b65013728574918", "committedDate": "2020-08-31T14:00:13Z", "message": "XRDDEV-680 Clean validator"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "026453c453706a36ea434360911264fec3dbcf8c", "author": {"user": {"login": "carohauta", "name": "Caro Hautam\u00e4ki"}}, "url": "https://github.com/nordic-institute/X-Road/commit/026453c453706a36ea434360911264fec3dbcf8c", "committedDate": "2020-08-31T14:18:25Z", "message": "XRDDEV-680 Remove redundant dep"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "6a5e5c1a0a4eb758e91b392ec1656f05aed2bd9b", "author": {"user": {"login": "carohauta", "name": "Caro Hautam\u00e4ki"}}, "url": "https://github.com/nordic-institute/X-Road/commit/6a5e5c1a0a4eb758e91b392ec1656f05aed2bd9b", "committedDate": "2020-09-01T10:23:56Z", "message": "XRDDEV-680 Add OpenAPI 3 spec style validations\n\n* define path and param styling (kebab-case and snake_case)\n* define some mandatory fields such as description, operationId and summary"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "8b13fcab6006cfccb19e69fc886f031e355f5b0d", "author": {"user": {"login": "carohauta", "name": "Caro Hautam\u00e4ki"}}, "url": "https://github.com/nordic-institute/X-Road/commit/8b13fcab6006cfccb19e69fc886f031e355f5b0d", "committedDate": "2020-09-01T11:32:57Z", "message": "XRDDEV-680 Add some tests to oas-validator"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "00026e67fc170aa12a27363991922f9e1a0883d1", "author": {"user": {"login": "carohauta", "name": "Caro Hautam\u00e4ki"}}, "url": "https://github.com/nordic-institute/X-Road/commit/00026e67fc170aa12a27363991922f9e1a0883d1", "committedDate": "2020-09-01T11:56:29Z", "message": "XRDDEV-680 Add missing license"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "6328489aaa5fa137676385ebbacbcc4b0db7449b", "author": {"user": {"login": "carohauta", "name": "Caro Hautam\u00e4ki"}}, "url": "https://github.com/nordic-institute/X-Road/commit/6328489aaa5fa137676385ebbacbcc4b0db7449b", "committedDate": "2020-09-03T06:35:13Z", "message": "XRDDEV-680 Refactor OpenAPI Validator to a Gradle Plugin"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e6fe73a1f6b7360024356740ac9ec3f8f947078d", "author": {"user": {"login": "carohauta", "name": "Caro Hautam\u00e4ki"}}, "url": "https://github.com/nordic-institute/X-Road/commit/e6fe73a1f6b7360024356740ac9ec3f8f947078d", "committedDate": "2020-09-03T06:48:56Z", "message": "XRDDEV-680 Add null check for API def paths"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "012eeb1528b5e662654e47cc79c0553183fe574c", "author": {"user": {"login": "carohauta", "name": "Caro Hautam\u00e4ki"}}, "url": "https://github.com/nordic-institute/X-Road/commit/012eeb1528b5e662654e47cc79c0553183fe574c", "committedDate": "2020-09-03T09:02:36Z", "message": "XRDDEV-680 Readme for the validator gradle plugin"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDg0MDU5MjEz", "url": "https://github.com/nordic-institute/X-Road/pull/678#pullrequestreview-484059213", "createdAt": "2020-09-08T11:56:30Z", "commit": {"oid": "012eeb1528b5e662654e47cc79c0553183fe574c"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wOFQxMTo1NjozMFrOHOZdcA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wOFQxMTo1NjozMFrOHOZdcA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NDg1OTI0OA==", "bodyText": "There seem to be some validation error cases (duplicate property or required -tag in openapi-authentication.yaml) that result in an exception that is printed out, but validation result is SUCCESS and build continues.\nPossibly caused by a JsonParseException that is thrown out instead of GradleException. Not sure, but would it be a good idea to catch all exceptions that happen during validation and wrapping them in GradleException(\"API definition validation failed\", rootCause), or something?", "url": "https://github.com/nordic-institute/X-Road/pull/678#discussion_r484859248", "createdAt": "2020-09-08T11:56:30Z", "author": {"login": "jansu76"}, "path": "src/buildSrc/src/main/java/org/niis/xroad/oasvalidatorplugin/Oas3ValidatorGradlePlugin.java", "diffHunk": "@@ -0,0 +1,78 @@\n+/**\n+ * The MIT License\n+ * Copyright (c) 2019- Nordic Institute for Interoperability Solutions (NIIS)\n+ * Copyright (c) 2018 Estonian Information System Authority (RIA),\n+ * Nordic Institute for Interoperability Solutions (NIIS), Population Register Centre (VRK)\n+ * Copyright (c) 2015-2017 Estonian Information System Authority (RIA), Population Register Centre (VRK)\n+ *\n+ * Permission is hereby granted, free of charge, to any person obtaining a copy\n+ * of this software and associated documentation files (the \"Software\"), to deal\n+ * in the Software without restriction, including without limitation the rights\n+ * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\n+ * copies of the Software, and to permit persons to whom the Software is\n+ * furnished to do so, subject to the following conditions:\n+ *\n+ * The above copyright notice and this permission notice shall be included in\n+ * all copies or substantial portions of the Software.\n+ *\n+ * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n+ * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n+ * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n+ * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n+ * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n+ * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\n+ * THE SOFTWARE.\n+ */\n+package org.niis.xroad.oasvalidatorplugin;\n+\n+import org.gradle.api.GradleException;\n+import org.gradle.api.Plugin;\n+import org.gradle.api.Project;\n+import org.openapi4j.core.exception.ResolutionException;\n+\n+import java.util.ArrayList;\n+import java.util.List;\n+\n+public class Oas3ValidatorGradlePlugin implements Plugin<Project> {\n+    private static final String PARAMETERS_NAME = \"apiValidationParameters\";\n+    private static final String TASK_NAME = \"validateApiDefinitions\";\n+\n+    public Oas3ValidatorGradlePlugin() {\n+    }\n+\n+    @Override\n+    public void apply(Project project) {\n+        Oas3ValidatorExtension extension = project.getExtensions()\n+                .create(PARAMETERS_NAME, Oas3ValidatorExtension.class);\n+\n+        project.task(TASK_NAME)\n+                .doLast(task -> {\n+                    if (extension.getApiDefinitionPaths() == null || extension.getApiDefinitionPaths().isEmpty()) {\n+                        throw new GradleException(\"No API definition file paths provided\");\n+                    }\n+                    System.out.println(System.lineSeparator() + \"--- API VALIDATION START ---\");\n+                    boolean isCompleteValidationSuccess = true;\n+                    List<ApiValidationResults> allValidationResults = new ArrayList<>();\n+                    extension.getApiDefinitionPaths().forEach(path -> {\n+                        try {\n+                            ApiValidationResults validationResults = Oas3Validator.validate(path);\n+                            allValidationResults.add(validationResults);\n+                        } catch (ResolutionException e) {\n+                            throw new GradleException(\"API definition not found\", e);\n+                        }\n+                    });\n+                    for (ApiValidationResults apiValidationResults : allValidationResults) {\n+                        ApiValidationResult apiSpecValidationResult = apiValidationResults", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "012eeb1528b5e662654e47cc79c0553183fe574c"}, "originalPosition": 65}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e4aa58c0c8e4b5ed1f3c15421a7ca296c8629b17", "author": {"user": {"login": "carohauta", "name": "Caro Hautam\u00e4ki"}}, "url": "https://github.com/nordic-institute/X-Road/commit/e4aa58c0c8e4b5ed1f3c15421a7ca296c8629b17", "committedDate": "2020-09-09T09:02:21Z", "message": "XRDDEV-680 Fix validation results when JSON parsing fails"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDg0OTA3MTEy", "url": "https://github.com/nordic-institute/X-Road/pull/678#pullrequestreview-484907112", "createdAt": "2020-09-09T11:21:16Z", "commit": {"oid": "e4aa58c0c8e4b5ed1f3c15421a7ca296c8629b17"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4068, "cost": 1, "resetAt": "2021-11-01T16:19:10Z"}}}