{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0Mzk1MzAyNzUx", "number": 440, "reviewThreads": {"totalCount": 6, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yMFQwNzoxNDoxNFrODzlJDQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yMFQwODoyMjozOFrODzmywQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjU1NDEyNDkzOnYy", "diffSide": "RIGHT", "path": "src/proxy-ui-api/src/main/java/org/niis/xroad/restapi/service/ClientService.java", "isResolved": true, "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yMFQwNzoxNDoxNFrOGIGZpw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yMFQxNToxMzozM1rOGIZhpA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMTE0NjY2Mw==", "bodyText": "Should not throw OpenAPI related exceptions from the service layer.", "url": "https://github.com/nordic-institute/X-Road/pull/440#discussion_r411146663", "createdAt": "2020-04-20T07:14:14Z", "author": {"login": "carohauta"}, "path": "src/proxy-ui-api/src/main/java/org/niis/xroad/restapi/service/ClientService.java", "diffHunk": "@@ -413,20 +431,51 @@ public ClientType deleteTlsCertificate(ClientId id, String certificateHash)\n      * @param subsystemCode\n      * @param showMembers include members (without subsystemCode) in the results\n      * @param internalSearch search only in the local clients\n+     * @param onlyLocalClientWithValidSignCert include only local clients that have valid sign cert\n+     * @param onlyLocallyMissingClients list only clients that are missing from this security server\n      * @return ClientType list\n      */\n     public List<ClientType> findClients(String name, String instance, String memberClass, String memberCode,\n-            String subsystemCode, boolean showMembers, boolean internalSearch) {\n+            String subsystemCode, boolean showMembers, boolean internalSearch,\n+            boolean onlyLocalClientWithValidSignCert, boolean onlyLocallyMissingClients) {\n+        if ((onlyLocalClientWithValidSignCert || internalSearch) && onlyLocallyMissingClients) {\n+            throw new BadRequestException(\"Illegally using parameters for \"", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "13fc88933e19bbc49671bed730ed3238b5eab6c8"}, "originalPosition": 89}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMTE1ODgxOA==", "bodyText": "Actually coming to think of this: should an exception be thrown at all here? After all the query parameters are just for filtering the results of the request. Returning an empty list because of too excessive filtering does not seem wrong to me \ud83e\udd37\u200d\u2642\ufe0f", "url": "https://github.com/nordic-institute/X-Road/pull/440#discussion_r411158818", "createdAt": "2020-04-20T07:36:08Z", "author": {"login": "carohauta"}, "path": "src/proxy-ui-api/src/main/java/org/niis/xroad/restapi/service/ClientService.java", "diffHunk": "@@ -413,20 +431,51 @@ public ClientType deleteTlsCertificate(ClientId id, String certificateHash)\n      * @param subsystemCode\n      * @param showMembers include members (without subsystemCode) in the results\n      * @param internalSearch search only in the local clients\n+     * @param onlyLocalClientWithValidSignCert include only local clients that have valid sign cert\n+     * @param onlyLocallyMissingClients list only clients that are missing from this security server\n      * @return ClientType list\n      */\n     public List<ClientType> findClients(String name, String instance, String memberClass, String memberCode,\n-            String subsystemCode, boolean showMembers, boolean internalSearch) {\n+            String subsystemCode, boolean showMembers, boolean internalSearch,\n+            boolean onlyLocalClientWithValidSignCert, boolean onlyLocallyMissingClients) {\n+        if ((onlyLocalClientWithValidSignCert || internalSearch) && onlyLocallyMissingClients) {\n+            throw new BadRequestException(\"Illegally using parameters for \"", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMTE0NjY2Mw=="}, "originalCommit": {"oid": "13fc88933e19bbc49671bed730ed3238b5eab6c8"}, "originalPosition": 89}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMTQ2MDAwNA==", "bodyText": "Okay makes sense since the parameters are optional. Removed the if-block.", "url": "https://github.com/nordic-institute/X-Road/pull/440#discussion_r411460004", "createdAt": "2020-04-20T15:13:33Z", "author": {"login": "TJaakkola"}, "path": "src/proxy-ui-api/src/main/java/org/niis/xroad/restapi/service/ClientService.java", "diffHunk": "@@ -413,20 +431,51 @@ public ClientType deleteTlsCertificate(ClientId id, String certificateHash)\n      * @param subsystemCode\n      * @param showMembers include members (without subsystemCode) in the results\n      * @param internalSearch search only in the local clients\n+     * @param onlyLocalClientWithValidSignCert include only local clients that have valid sign cert\n+     * @param onlyLocallyMissingClients list only clients that are missing from this security server\n      * @return ClientType list\n      */\n     public List<ClientType> findClients(String name, String instance, String memberClass, String memberCode,\n-            String subsystemCode, boolean showMembers, boolean internalSearch) {\n+            String subsystemCode, boolean showMembers, boolean internalSearch,\n+            boolean onlyLocalClientWithValidSignCert, boolean onlyLocallyMissingClients) {\n+        if ((onlyLocalClientWithValidSignCert || internalSearch) && onlyLocallyMissingClients) {\n+            throw new BadRequestException(\"Illegally using parameters for \"", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMTE0NjY2Mw=="}, "originalCommit": {"oid": "13fc88933e19bbc49671bed730ed3238b5eab6c8"}, "originalPosition": 89}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjU1NDE3Nzk1OnYy", "diffSide": "RIGHT", "path": "src/proxy-ui-api/src/main/resources/openapi-definition.yaml", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yMFQwNzoyODoyN1rOGIG4QQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yMFQxNjowNzoyNVrOGIcKKQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMTE1NDQ5Nw==", "bodyText": "I was thinking about the parameter names and was wondering if it could be possible to have for example internal_search, external_search (new one) and exclude_local parameters and you could just combine those to get the desired output. But this is pretty complex search already so maybe it would not be so good idea to add even more parameters to the mix.\nBut anyway maybe this parameter could be named simply exclude_local or exclude_local_clients?", "url": "https://github.com/nordic-institute/X-Road/pull/440#discussion_r411154497", "createdAt": "2020-04-20T07:28:27Z", "author": {"login": "carohauta"}, "path": "src/proxy-ui-api/src/main/resources/openapi-definition.yaml", "diffHunk": "@@ -651,6 +651,20 @@ paths:\n           schema:\n             type: boolean\n             default: true\n+        - in: query\n+          name: only_local_client_with_valid_sign_cert\n+          description: to search only local clients with valid sign cert\n+          required: false\n+          schema:\n+            type: boolean\n+            default: false\n+        - in: query\n+          name: only_locally_missing_clients", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "13fc88933e19bbc49671bed730ed3238b5eab6c8"}, "originalPosition": 12}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMTUwMzE0NQ==", "bodyText": "Yeah, I'd prefer not to add extra params to this anymore. Also current naming is a bit clumsy. I think exclude_local is good as this is a client search anyway so no necessary to include that in the name.\nRenamed.", "url": "https://github.com/nordic-institute/X-Road/pull/440#discussion_r411503145", "createdAt": "2020-04-20T16:07:25Z", "author": {"login": "TJaakkola"}, "path": "src/proxy-ui-api/src/main/resources/openapi-definition.yaml", "diffHunk": "@@ -651,6 +651,20 @@ paths:\n           schema:\n             type: boolean\n             default: true\n+        - in: query\n+          name: only_local_client_with_valid_sign_cert\n+          description: to search only local clients with valid sign cert\n+          required: false\n+          schema:\n+            type: boolean\n+            default: false\n+        - in: query\n+          name: only_locally_missing_clients", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMTE1NDQ5Nw=="}, "originalCommit": {"oid": "13fc88933e19bbc49671bed730ed3238b5eab6c8"}, "originalPosition": 12}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjU1NDE4NjgyOnYy", "diffSide": "RIGHT", "path": "src/proxy-ui-api/src/main/resources/openapi-definition.yaml", "isResolved": true, "comments": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yMFQwNzozMDo0M1rOGIG9VA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yMFQxNjozNTo0M1rOGIdbRw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMTE1NTc5Ng==", "bodyText": "If internal_search is true, wouldn't something like has_valid_sign_cert also be descriptive enough?", "url": "https://github.com/nordic-institute/X-Road/pull/440#discussion_r411155796", "createdAt": "2020-04-20T07:30:43Z", "author": {"login": "carohauta"}, "path": "src/proxy-ui-api/src/main/resources/openapi-definition.yaml", "diffHunk": "@@ -651,6 +651,20 @@ paths:\n           schema:\n             type: boolean\n             default: true\n+        - in: query\n+          name: only_local_client_with_valid_sign_cert", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "13fc88933e19bbc49671bed730ed3238b5eab6c8"}, "originalPosition": 5}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMTE5MDQwOQ==", "bodyText": "is_not_local_client and member_missing_sign_cert are also something that have been talked about in Slack", "url": "https://github.com/nordic-institute/X-Road/pull/440#discussion_r411190409", "createdAt": "2020-04-20T08:28:05Z", "author": {"login": "carohauta"}, "path": "src/proxy-ui-api/src/main/resources/openapi-definition.yaml", "diffHunk": "@@ -651,6 +651,20 @@ paths:\n           schema:\n             type: boolean\n             default: true\n+        - in: query\n+          name: only_local_client_with_valid_sign_cert", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMTE1NTc5Ng=="}, "originalCommit": {"oid": "13fc88933e19bbc49671bed730ed3238b5eab6c8"}, "originalPosition": 5}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMTQ4MjcyOA==", "bodyText": "If internal_search is true that would be true, but internal search can be false and then has_valid_sign_cert sounds like any client that has valid sign cert is included. This option means also filtering out global clients.\nI'm not quite sure what to do with this - to have a cumbersome but descriptive name or simpler name that describes only part of its functionality (?) -  but I think the name should be simplified a bit and just expect that api users read the documentation.\nis_not_local_client fits the other parameter added.\nmember_missing_sign_cert would mean a different set of results. if member_missing_sign_cert=true was the parameter I'd expect the result to contain only members that don't have signed cert. In the case member_missing_sign_cert=false I think it shouldn't have an effect to the returned resultset.\nThe question here \u261d\ufe0f is: should findClient return different resultset when this parameter is set to false and when it haven't been set at all? In the current implementation I've decided that passing these two parameters as false is equal to not sending them at all.", "url": "https://github.com/nordic-institute/X-Road/pull/440#discussion_r411482728", "createdAt": "2020-04-20T15:41:54Z", "author": {"login": "TJaakkola"}, "path": "src/proxy-ui-api/src/main/resources/openapi-definition.yaml", "diffHunk": "@@ -651,6 +651,20 @@ paths:\n           schema:\n             type: boolean\n             default: true\n+        - in: query\n+          name: only_local_client_with_valid_sign_cert", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMTE1NTc5Ng=="}, "originalCommit": {"oid": "13fc88933e19bbc49671bed730ed3238b5eab6c8"}, "originalPosition": 5}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMTUwNTkzMA==", "bodyText": "Perhaps a compromise: local_valid_sign_cert?", "url": "https://github.com/nordic-institute/X-Road/pull/440#discussion_r411505930", "createdAt": "2020-04-20T16:11:13Z", "author": {"login": "TJaakkola"}, "path": "src/proxy-ui-api/src/main/resources/openapi-definition.yaml", "diffHunk": "@@ -651,6 +651,20 @@ paths:\n           schema:\n             type: boolean\n             default: true\n+        - in: query\n+          name: only_local_client_with_valid_sign_cert", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMTE1NTc5Ng=="}, "originalCommit": {"oid": "13fc88933e19bbc49671bed730ed3238b5eab6c8"}, "originalPosition": 5}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMTUyMzkxMQ==", "bodyText": "Renamed to local_valid_sign_cert. Lets change it again if you can come up with a better name.", "url": "https://github.com/nordic-institute/X-Road/pull/440#discussion_r411523911", "createdAt": "2020-04-20T16:35:43Z", "author": {"login": "TJaakkola"}, "path": "src/proxy-ui-api/src/main/resources/openapi-definition.yaml", "diffHunk": "@@ -651,6 +651,20 @@ paths:\n           schema:\n             type: boolean\n             default: true\n+        - in: query\n+          name: only_local_client_with_valid_sign_cert", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMTE1NTc5Ng=="}, "originalCommit": {"oid": "13fc88933e19bbc49671bed730ed3238b5eab6c8"}, "originalPosition": 5}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjU1NDI3MTM0OnYy", "diffSide": "RIGHT", "path": "src/proxy-ui-api/src/main/java/org/niis/xroad/restapi/service/ClientService.java", "isResolved": true, "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yMFQwNzo1Mjo0NFrOGIHuNw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yMVQwNjoxMDo0M1rOGI0L8A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMTE2ODMxMQ==", "bodyText": "Could this be added into buildClientSearchPredicate method with a logical and? In it's current state this predicate causes an extra iteration through possibly quite large set of clients in here.", "url": "https://github.com/nordic-institute/X-Road/pull/440#discussion_r411168311", "createdAt": "2020-04-20T07:52:44Z", "author": {"login": "carohauta"}, "path": "src/proxy-ui-api/src/main/java/org/niis/xroad/restapi/service/ClientService.java", "diffHunk": "@@ -562,6 +611,40 @@ public void changeOwner(String memberClass, String memberCode, String subsystemC\n         return clientTypePredicate;\n     }\n \n+    /**\n+     * Create predicate function for filtering by valid local sign cert\n+     *\n+     * @param onlyLocalClientWithValidSignCert\n+     * @return\n+     */\n+    private Predicate<ClientType> buildValidSignCertPredicate(boolean onlyLocalClientWithValidSignCert) {\n+\n+        if (onlyLocalClientWithValidSignCert) {\n+            Predicate<ClientType> validSignCertPredicate = clientType -> false;\n+            validSignCertPredicate = validSignCertPredicate.or(this::hasValidLocalSignCertCheck);\n+            return validSignCertPredicate;\n+        }", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "13fc88933e19bbc49671bed730ed3238b5eab6c8"}, "originalPosition": 147}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMTUyMzUzOA==", "bodyText": "Yes, I did think this while I implemented it but somehow came to the conclusion it wouldn't work. But now that I though it again I think it should work and should be there.", "url": "https://github.com/nordic-institute/X-Road/pull/440#discussion_r411523538", "createdAt": "2020-04-20T16:35:07Z", "author": {"login": "TJaakkola"}, "path": "src/proxy-ui-api/src/main/java/org/niis/xroad/restapi/service/ClientService.java", "diffHunk": "@@ -562,6 +611,40 @@ public void changeOwner(String memberClass, String memberCode, String subsystemC\n         return clientTypePredicate;\n     }\n \n+    /**\n+     * Create predicate function for filtering by valid local sign cert\n+     *\n+     * @param onlyLocalClientWithValidSignCert\n+     * @return\n+     */\n+    private Predicate<ClientType> buildValidSignCertPredicate(boolean onlyLocalClientWithValidSignCert) {\n+\n+        if (onlyLocalClientWithValidSignCert) {\n+            Predicate<ClientType> validSignCertPredicate = clientType -> false;\n+            validSignCertPredicate = validSignCertPredicate.or(this::hasValidLocalSignCertCheck);\n+            return validSignCertPredicate;\n+        }", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMTE2ODMxMQ=="}, "originalCommit": {"oid": "13fc88933e19bbc49671bed730ed3238b5eab6c8"}, "originalPosition": 147}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMTg5NjgxNg==", "bodyText": "Refactored.", "url": "https://github.com/nordic-institute/X-Road/pull/440#discussion_r411896816", "createdAt": "2020-04-21T06:10:43Z", "author": {"login": "TJaakkola"}, "path": "src/proxy-ui-api/src/main/java/org/niis/xroad/restapi/service/ClientService.java", "diffHunk": "@@ -562,6 +611,40 @@ public void changeOwner(String memberClass, String memberCode, String subsystemC\n         return clientTypePredicate;\n     }\n \n+    /**\n+     * Create predicate function for filtering by valid local sign cert\n+     *\n+     * @param onlyLocalClientWithValidSignCert\n+     * @return\n+     */\n+    private Predicate<ClientType> buildValidSignCertPredicate(boolean onlyLocalClientWithValidSignCert) {\n+\n+        if (onlyLocalClientWithValidSignCert) {\n+            Predicate<ClientType> validSignCertPredicate = clientType -> false;\n+            validSignCertPredicate = validSignCertPredicate.or(this::hasValidLocalSignCertCheck);\n+            return validSignCertPredicate;\n+        }", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMTE2ODMxMQ=="}, "originalCommit": {"oid": "13fc88933e19bbc49671bed730ed3238b5eab6c8"}, "originalPosition": 147}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjU1NDMzNTA2OnYy", "diffSide": "RIGHT", "path": "src/proxy-ui-api/src/test/java/org/niis/xroad/restapi/util/ClientUtilsTest.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yMFQwODowODo0OFrOGIITnQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yMFQxNToyNzoyN1rOGIaNdA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMTE3Nzg4NQ==", "bodyText": "Seems to be a simple utility test -> does not need Spring context or database to run. Removing these annotations will cut about 20 seconds off of the execution time of the test.", "url": "https://github.com/nordic-institute/X-Road/pull/440#discussion_r411177885", "createdAt": "2020-04-20T08:08:48Z", "author": {"login": "carohauta"}, "path": "src/proxy-ui-api/src/test/java/org/niis/xroad/restapi/util/ClientUtilsTest.java", "diffHunk": "@@ -0,0 +1,97 @@\n+/**\n+ * The MIT License\n+ * Copyright (c) 2018 Estonian Information System Authority (RIA),\n+ * Nordic Institute for Interoperability Solutions (NIIS), Population Register Centre (VRK)\n+ * Copyright (c) 2015-2017 Estonian Information System Authority (RIA), Population Register Centre (VRK)\n+ *\n+ * Permission is hereby granted, free of charge, to any person obtaining a copy\n+ * of this software and associated documentation files (the \"Software\"), to deal\n+ * in the Software without restriction, including without limitation the rights\n+ * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\n+ * copies of the Software, and to permit persons to whom the Software is\n+ * furnished to do so, subject to the following conditions:\n+ *\n+ * The above copyright notice and this permission notice shall be included in\n+ * all copies or substantial portions of the Software.\n+ *\n+ * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n+ * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n+ * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n+ * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n+ * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n+ * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\n+ * THE SOFTWARE.\n+ */\n+package org.niis.xroad.restapi.util;\n+\n+import ee.ria.xroad.common.identifier.ClientId;\n+import ee.ria.xroad.signer.protocol.dto.CertificateInfo;\n+\n+import lombok.extern.slf4j.Slf4j;\n+import org.bouncycastle.asn1.x509.CRLReason;\n+import org.bouncycastle.cert.ocsp.RevokedStatus;\n+import org.bouncycastle.cert.ocsp.UnknownStatus;\n+import org.junit.Test;\n+import org.junit.runner.RunWith;\n+import org.springframework.boot.test.autoconfigure.jdbc.AutoConfigureTestDatabase;\n+import org.springframework.boot.test.context.SpringBootTest;\n+import org.springframework.test.context.junit4.SpringRunner;\n+\n+import java.util.ArrayList;\n+import java.util.Arrays;\n+import java.util.Date;\n+import java.util.List;\n+\n+import static org.junit.Assert.assertFalse;\n+import static org.junit.Assert.assertTrue;\n+\n+@RunWith(SpringRunner.class)\n+@SpringBootTest\n+@AutoConfigureTestDatabase", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "13fc88933e19bbc49671bed730ed3238b5eab6c8"}, "originalPosition": 50}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMTQ3MTIyMA==", "bodyText": "Removed and faster it is \ud83d\udc4d", "url": "https://github.com/nordic-institute/X-Road/pull/440#discussion_r411471220", "createdAt": "2020-04-20T15:27:27Z", "author": {"login": "TJaakkola"}, "path": "src/proxy-ui-api/src/test/java/org/niis/xroad/restapi/util/ClientUtilsTest.java", "diffHunk": "@@ -0,0 +1,97 @@\n+/**\n+ * The MIT License\n+ * Copyright (c) 2018 Estonian Information System Authority (RIA),\n+ * Nordic Institute for Interoperability Solutions (NIIS), Population Register Centre (VRK)\n+ * Copyright (c) 2015-2017 Estonian Information System Authority (RIA), Population Register Centre (VRK)\n+ *\n+ * Permission is hereby granted, free of charge, to any person obtaining a copy\n+ * of this software and associated documentation files (the \"Software\"), to deal\n+ * in the Software without restriction, including without limitation the rights\n+ * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\n+ * copies of the Software, and to permit persons to whom the Software is\n+ * furnished to do so, subject to the following conditions:\n+ *\n+ * The above copyright notice and this permission notice shall be included in\n+ * all copies or substantial portions of the Software.\n+ *\n+ * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n+ * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n+ * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n+ * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n+ * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n+ * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\n+ * THE SOFTWARE.\n+ */\n+package org.niis.xroad.restapi.util;\n+\n+import ee.ria.xroad.common.identifier.ClientId;\n+import ee.ria.xroad.signer.protocol.dto.CertificateInfo;\n+\n+import lombok.extern.slf4j.Slf4j;\n+import org.bouncycastle.asn1.x509.CRLReason;\n+import org.bouncycastle.cert.ocsp.RevokedStatus;\n+import org.bouncycastle.cert.ocsp.UnknownStatus;\n+import org.junit.Test;\n+import org.junit.runner.RunWith;\n+import org.springframework.boot.test.autoconfigure.jdbc.AutoConfigureTestDatabase;\n+import org.springframework.boot.test.context.SpringBootTest;\n+import org.springframework.test.context.junit4.SpringRunner;\n+\n+import java.util.ArrayList;\n+import java.util.Arrays;\n+import java.util.Date;\n+import java.util.List;\n+\n+import static org.junit.Assert.assertFalse;\n+import static org.junit.Assert.assertTrue;\n+\n+@RunWith(SpringRunner.class)\n+@SpringBootTest\n+@AutoConfigureTestDatabase", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMTE3Nzg4NQ=="}, "originalCommit": {"oid": "13fc88933e19bbc49671bed730ed3238b5eab6c8"}, "originalPosition": 50}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjU1NDM5NTUzOnYy", "diffSide": "RIGHT", "path": "src/proxy-ui-api/src/main/java/org/niis/xroad/restapi/util/ClientUtils.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yMFQwODoyMjozOFrOGII2KQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yMFQwODoyMjozOFrOGII2KQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMTE4NjcyOQ==", "bodyText": "The Javadoc of ClientId#memberEquals says that \"This comparison ignores subsystem part of the identifier\". Is this fine? Basic equals (overridden in XRoadId) seems to offer a full comparison including the subsystem if that is something that is needed.", "url": "https://github.com/nordic-institute/X-Road/pull/440#discussion_r411186729", "createdAt": "2020-04-20T08:22:38Z", "author": {"login": "carohauta"}, "path": "src/proxy-ui-api/src/main/java/org/niis/xroad/restapi/util/ClientUtils.java", "diffHunk": "@@ -0,0 +1,58 @@\n+/**\n+ * The MIT License\n+ * Copyright (c) 2018 Estonian Information System Authority (RIA),\n+ * Nordic Institute for Interoperability Solutions (NIIS), Population Register Centre (VRK)\n+ * Copyright (c) 2015-2017 Estonian Information System Authority (RIA), Population Register Centre (VRK)\n+ *\n+ * Permission is hereby granted, free of charge, to any person obtaining a copy\n+ * of this software and associated documentation files (the \"Software\"), to deal\n+ * in the Software without restriction, including without limitation the rights\n+ * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\n+ * copies of the Software, and to permit persons to whom the Software is\n+ * furnished to do so, subject to the following conditions:\n+ *\n+ * The above copyright notice and this permission notice shall be included in\n+ * all copies or substantial portions of the Software.\n+ *\n+ * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n+ * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n+ * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n+ * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n+ * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n+ * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\n+ * THE SOFTWARE.\n+ */\n+package org.niis.xroad.restapi.util;\n+\n+import ee.ria.xroad.common.identifier.ClientId;\n+import ee.ria.xroad.signer.protocol.dto.CertificateInfo;\n+\n+import java.util.List;\n+\n+public final class ClientUtils {\n+\n+    private ClientUtils() {\n+        // noop\n+    }\n+\n+    /**\n+     *\n+     * @param clientId\n+     * @param certificateInfos\n+     * @return\n+     * @throws OcspUtils.OcspStatusExtractionException\n+     */\n+    public static boolean hasValidLocalSignCert(ClientId clientId, List<CertificateInfo> certificateInfos)\n+            throws OcspUtils.OcspStatusExtractionException {\n+        for (CertificateInfo certificateInfo : certificateInfos) {\n+            String ocspResponseStatus = OcspUtils.getOcspResponseStatus(certificateInfo.getOcspBytes());\n+            if (clientId.memberEquals(certificateInfo.getMemberId())", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "13fc88933e19bbc49671bed730ed3238b5eab6c8"}, "originalPosition": 49}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2795, "cost": 1, "resetAt": "2021-11-12T20:28:25Z"}}}