{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDQ0Nzg4NzM4", "number": 580, "title": "XRDDEV-1179 Add clients and service clients sorting", "bodyText": "Sort clients by name (primary) and client id (secondary).\nSort service clients by name / group description (primary) and id (secondary).\nUpdate unit tests.\n\nJIRA issue: https://jira.niis.org/browse/XRDDEV-1179", "createdAt": "2020-07-06T13:49:09Z", "url": "https://github.com/nordic-institute/X-Road/pull/580", "merged": true, "mergeCommit": {"oid": "16493e4c85bae9d83e5ec1dd37406a7d7d256a77"}, "closed": true, "closedAt": "2020-07-15T13:16:45Z", "author": {"login": "petkivim"}, "timelineItems": {"totalCount": 16, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcyRiFvgH2gAyNDQ0Nzg4NzM4OmU4ZjZiNGZlY2U3YTU0NmQwNGQwODg1YTdhOGNkZjZlYzZlMDBlYjg=", "endCursor": "Y3Vyc29yOnYyOpPPAAABc02esygH2gAyNDQ0Nzg4NzM4OjczYTYxYTg3OWYxYTU4ZTUyMDE5MmZmNDFhNjYzYTU4YzUyMTJmNmQ=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "e8f6b4fece7a546d04d0885a7a8cdf6ec6e00eb8", "author": {"user": {"login": "petkivim", "name": "Petteri Kivim\u00e4ki"}}, "url": "https://github.com/nordic-institute/X-Road/commit/e8f6b4fece7a546d04d0885a7a8cdf6ec6e00eb8", "committedDate": "2020-07-06T13:47:55Z", "message": "XRDDEV-1179 Add sorting clients and service clients sorting\n\n- Sort clients by name (primary) and client id (secondary).\n- Sort service clients by name / group description (primary) and id (secondary).\n- Update unit tests."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "2b58df88dcaf26ffc0f28af76127999233f5cd47", "author": {"user": {"login": "petkivim", "name": "Petteri Kivim\u00e4ki"}}, "url": "https://github.com/nordic-institute/X-Road/commit/2b58df88dcaf26ffc0f28af76127999233f5cd47", "committedDate": "2020-07-06T14:48:46Z", "message": "XRDDEV-1179 Fix failing test"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "fddea15b1321ae408427e319a8ae25146dad43b7", "author": {"user": {"login": "petkivim", "name": "Petteri Kivim\u00e4ki"}}, "url": "https://github.com/nordic-institute/X-Road/commit/fddea15b1321ae408427e319a8ae25146dad43b7", "committedDate": "2020-07-06T15:28:57Z", "message": "XRDDEV-1179 Fix checkstyle error"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "8be464f01bf35bd44390e2405fe16c4e78a07957", "author": {"user": {"login": "petkivim", "name": "Petteri Kivim\u00e4ki"}}, "url": "https://github.com/nordic-institute/X-Road/commit/8be464f01bf35bd44390e2405fe16c4e78a07957", "committedDate": "2020-07-06T17:15:01Z", "message": "XRDDEV-1179 Fix Sonarqube findings"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "7655aaa306110c89e7ee9d43664eb26ca3f08d5f", "author": {"user": {"login": "petkivim", "name": "Petteri Kivim\u00e4ki"}}, "url": "https://github.com/nordic-institute/X-Road/commit/7655aaa306110c89e7ee9d43664eb26ca3f08d5f", "committedDate": "2020-07-07T01:09:40Z", "message": "XRDDEV-1179 Remove unused imports"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "39c23aea3880b7ef9c38c8af30bacc3a864b3cad", "author": {"user": {"login": "petkivim", "name": "Petteri Kivim\u00e4ki"}}, "url": "https://github.com/nordic-institute/X-Road/commit/39c23aea3880b7ef9c38c8af30bacc3a864b3cad", "committedDate": "2020-07-07T04:45:57Z", "message": "XRDDEV-1179 Make comparison in lower case letters"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "9f61d4581009dfae6a4de98d0abe927dfadf4cc0", "author": {"user": {"login": "petkivim", "name": "Petteri Kivim\u00e4ki"}}, "url": "https://github.com/nordic-institute/X-Road/commit/9f61d4581009dfae6a4de98d0abe927dfadf4cc0", "committedDate": "2020-07-07T04:52:09Z", "message": "XRDDEV-1179 Update tests"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "8926c9f8906716e21d9b803a757927ea527bae18", "author": {"user": {"login": "petkivim", "name": "Petteri Kivim\u00e4ki"}}, "url": "https://github.com/nordic-institute/X-Road/commit/8926c9f8906716e21d9b803a757927ea527bae18", "committedDate": "2020-07-08T08:18:50Z", "message": "XRDDEV-1179 Add sorting to Client -> Local groups\n\n- Add backend implementation.\n- Update frontend implementation."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "80e9faadf8eaec101f6daa6a10d552ab0ff934f4", "author": {"user": {"login": "petkivim", "name": "Petteri Kivim\u00e4ki"}}, "url": "https://github.com/nordic-institute/X-Road/commit/80e9faadf8eaec101f6daa6a10d552ab0ff934f4", "committedDate": "2020-07-08T08:29:08Z", "message": "XRDDEV-1179 Refactor clients and service clients sorting"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDQ3ODEzMzg2", "url": "https://github.com/nordic-institute/X-Road/pull/580#pullrequestreview-447813386", "createdAt": "2020-07-14T06:10:49Z", "commit": {"oid": "80e9faadf8eaec101f6daa6a10d552ab0ff934f4"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xNFQwNjoxMDo0OVrOGxFjHA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xNFQwNjo1MDozOFrOGxGh1w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NDEyNDMxNg==", "bodyText": "Instead of this concrete list-sorting method (and ClientUtils.sortClientsList) a Comparator implementing the comparison logic would be more reusable (can sort arrays, sorted sets etc), and maybe even a bit cleaner design. Both Comparators could then be in same package (probably org.niis.xroad.restapi.controller or org.niis.xroad.restapi.openapi - or maybe even a new org.niis.xroad.restapi.converter.comparator to signal this is part of the \"converting\" domain...) and so be more consistent with each other and \"discoverable\".\nFor the actual implementation, there's also alternatives https://stackoverflow.com/a/20093642/1469083 such as\n\nusing Comparator.comparing+thenComparing+nullsFirst builders (end result may be cleaner or messier)\nusing Guava or Apache commons helpers\n\nAlthough the actual implementation is pretty simple so I don't know if alternative ways are worth it.", "url": "https://github.com/nordic-institute/X-Road/pull/580#discussion_r454124316", "createdAt": "2020-07-14T06:10:49Z", "author": {"login": "jansu76"}, "path": "src/proxy-ui-api/src/main/java/org/niis/xroad/restapi/controller/ServiceClientHelper.java", "diffHunk": "@@ -104,4 +105,27 @@ public BadRequestException wrapInBadRequestException(\n         return new BadRequestException(INVALID_SERVICE_CLIENT_ID + e.getServiceClientIdentifier(),\n                 new ErrorDeviation(ERROR_INVALID_SERVICE_CLIENT_ID));\n     }\n+\n+    /**\n+     * Sort a list of ServiceClient objects using member name / group description as the primary sort key, and client id\n+     * as the secondary sort key.\n+     * @param clients\n+     */\n+    public void sortServiceClientsList(List<ServiceClient> clients) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "80e9faadf8eaec101f6daa6a10d552ab0ff934f4"}, "originalPosition": 18}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NDEyNjcxMg==", "bodyText": "I would add some tests to verify just the ordering (without any controllers, services, etc) and the logic for different null / not null cases etc.\nIn fact, I would usually start with the test and then write the implementation, I find that the easiest way to reach correct result in details like \"should null here be +1 or -1...?\". Especially since the test should be easy to implement (building a few ServiceClient objects with wanted name & id fields, and the test could be a pure (fast) unit test for Comparators without any Spring constructs).", "url": "https://github.com/nordic-institute/X-Road/pull/580#discussion_r454126712", "createdAt": "2020-07-14T06:17:05Z", "author": {"login": "jansu76"}, "path": "src/proxy-ui-api/src/main/java/org/niis/xroad/restapi/controller/ServiceClientHelper.java", "diffHunk": "@@ -104,4 +105,27 @@ public BadRequestException wrapInBadRequestException(\n         return new BadRequestException(INVALID_SERVICE_CLIENT_ID + e.getServiceClientIdentifier(),\n                 new ErrorDeviation(ERROR_INVALID_SERVICE_CLIENT_ID));\n     }\n+\n+    /**\n+     * Sort a list of ServiceClient objects using member name / group description as the primary sort key, and client id\n+     * as the secondary sort key.\n+     * @param clients\n+     */\n+    public void sortServiceClientsList(List<ServiceClient> clients) {\n+        clients.sort((c1, c2) -> {\n+                if (c1.getName() == null && c2.getName() == null) {\n+                    return c1.getId().compareToIgnoreCase(c2.getId());", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "80e9faadf8eaec101f6daa6a10d552ab0ff934f4"}, "originalPosition": 21}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NDEzMzMxNw==", "bodyText": "I am happy to see that sorting is a separate feature, and not e.g. included in ServiceClientConverter.convertServiceClientDtos. I think it keeps the role of converters more clear and retains the possibility of only converting without changing the order.", "url": "https://github.com/nordic-institute/X-Road/pull/580#discussion_r454133317", "createdAt": "2020-07-14T06:34:04Z", "author": {"login": "jansu76"}, "path": "src/proxy-ui-api/src/main/java/org/niis/xroad/restapi/controller/ServiceClientHelper.java", "diffHunk": "@@ -104,4 +105,27 @@ public BadRequestException wrapInBadRequestException(\n         return new BadRequestException(INVALID_SERVICE_CLIENT_ID + e.getServiceClientIdentifier(),\n                 new ErrorDeviation(ERROR_INVALID_SERVICE_CLIENT_ID));\n     }\n+\n+    /**\n+     * Sort a list of ServiceClient objects using member name / group description as the primary sort key, and client id\n+     * as the secondary sort key.\n+     * @param clients\n+     */\n+    public void sortServiceClientsList(List<ServiceClient> clients) {\n+        clients.sort((c1, c2) -> {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "80e9faadf8eaec101f6daa6a10d552ab0ff934f4"}, "originalPosition": 19}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NDE0MDM3NQ==", "bodyText": "There are some APIs that return unsorted service client collections:\n\nEndpointsApiController.addEndpointServiceClients (response from adding a new service client to an endpoint)\nServicesApiController.addServiceServiceClients (same for a service)\n\nThat's probably OK, although could consider adding the sort to them also, for consistency.", "url": "https://github.com/nordic-institute/X-Road/pull/580#discussion_r454140375", "createdAt": "2020-07-14T06:50:38Z", "author": {"login": "jansu76"}, "path": "src/proxy-ui-api/src/main/java/org/niis/xroad/restapi/openapi/EndpointsApiController.java", "diffHunk": "@@ -156,6 +156,7 @@ public EndpointsApiController(\n         }\n         List<ServiceClient> serviceClients = serviceClientConverter", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "80e9faadf8eaec101f6daa6a10d552ab0ff934f4"}, "originalPosition": 2}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "2ef2ebc1e91d252659a3acf08efac9235852369d", "author": {"user": {"login": "petkivim", "name": "Petteri Kivim\u00e4ki"}}, "url": "https://github.com/nordic-institute/X-Road/commit/2ef2ebc1e91d252659a3acf08efac9235852369d", "committedDate": "2020-07-14T10:42:58Z", "message": "XRDDEV-1179 Refactor implementation based on review comments\n\n- Implement comparator classes instead of helper methods.\n- Add unit tests."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "49d93454d758ae03bc28428de8e6d71241bac612", "author": {"user": {"login": "petkivim", "name": "Petteri Kivim\u00e4ki"}}, "url": "https://github.com/nordic-institute/X-Road/commit/49d93454d758ae03bc28428de8e6d71241bac612", "committedDate": "2020-07-14T10:56:20Z", "message": "XRDDEV-1179 Add sorting to two endpoints"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f379ee0a0b90f66c195277c532015878d86bd512", "author": {"user": {"login": "petkivim", "name": "Petteri Kivim\u00e4ki"}}, "url": "https://github.com/nordic-institute/X-Road/commit/f379ee0a0b90f66c195277c532015878d86bd512", "committedDate": "2020-07-14T11:34:11Z", "message": "XRDDEV-1179 Use class variables instead of creating new comparator object every time"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "91222c952f3837ad3257f8df5db89b470733ff39", "author": {"user": {"login": "petkivim", "name": "Petteri Kivim\u00e4ki"}}, "url": "https://github.com/nordic-institute/X-Road/commit/91222c952f3837ad3257f8df5db89b470733ff39", "committedDate": "2020-07-14T11:58:02Z", "message": "XRDDEV-1179 Update initializing the comparators in controllers"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDQ4MDY1ODQy", "url": "https://github.com/nordic-institute/X-Road/pull/580#pullrequestreview-448065842", "createdAt": "2020-07-14T12:38:27Z", "commit": {"oid": "91222c952f3837ad3257f8df5db89b470733ff39"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "73a61a879f1a58e520192ff41a663a58c5212f6d", "author": {"user": {"login": "petkivim", "name": "Petteri Kivim\u00e4ki"}}, "url": "https://github.com/nordic-institute/X-Road/commit/73a61a879f1a58e520192ff41a663a58c5212f6d", "committedDate": "2020-07-14T13:58:33Z", "message": "Merge branch 'develop' into XRDDEV-1179"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4125, "cost": 1, "resetAt": "2021-11-01T16:19:10Z"}}}