{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDg3NTEzMDU2", "number": 712, "title": "XRDDEV-1319 Permission checks", "bodyText": "Jira ticket: https://jira.niis.org/browse/XRDDEV-1319", "createdAt": "2020-09-15T19:28:03Z", "url": "https://github.com/nordic-institute/X-Road/pull/712", "merged": true, "mergeCommit": {"oid": "f304ec91251b81c90f0cf3cb7e56dd84308c2494"}, "closed": true, "closedAt": "2020-09-16T17:25:00Z", "author": {"login": "Riippi"}, "timelineItems": {"totalCount": 19, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdHxbyIAH2gAyNDg3NTEzMDU2OjNhZTMxMTIzZjNmNTFlODA4MjcwYTczNzk0NTU1MTA2YjUxNTdjZDI=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdJfYHUgFqTQ4OTgyMDE5Ng==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "3ae31123f3f51e808270a73794555106b5157cd2", "author": {"user": {"login": "Riippi", "name": "Mikko Riippi"}}, "url": "https://github.com/nordic-institute/X-Road/commit/3ae31123f3f51e808270a73794555106b5157cd2", "committedDate": "2020-09-11T08:50:24Z", "message": "XRDDEV-1319 Fix delete client permission"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "cddcfa3e7099b4383aa2e17edc61d1d2d53490cb", "author": {"user": {"login": "jansu76", "name": null}}, "url": "https://github.com/nordic-institute/X-Road/commit/cddcfa3e7099b4383aa2e17edc61d1d2d53490cb", "committedDate": "2020-09-11T13:52:28Z", "message": "XRDDEV-1223 Split permission view_cert into two parts: view_auth_cert and view_sign_cert. Grant view_sign_cert permission to XROAD_SERVICE_ADMINISTRATOR. Ignore frontend audit error about dtsgenerator for 24h"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d1260c0e3c7d3ed585af7b64b3f6b0f8a327d7af", "author": {"user": {"login": "Riippi", "name": "Mikko Riippi"}}, "url": "https://github.com/nordic-institute/X-Road/commit/d1260c0e3c7d3ed585af7b64b3f6b0f8a327d7af", "committedDate": "2020-09-14T12:27:41Z", "message": "XRDDEV-1319 Update permission related comments"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "9c62374951867390edaa13de18eb3533429ce153", "author": {"user": {"login": "Riippi", "name": "Mikko Riippi"}}, "url": "https://github.com/nordic-institute/X-Road/commit/9c62374951867390edaa13de18eb3533429ce153", "committedDate": "2020-09-15T10:53:52Z", "message": "XRDDEV-1319 Change restore backup to use proper permission"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "334a7fb4c824e6aef71585100be4d4aa64ff02e1", "author": {"user": {"login": "Riippi", "name": "Mikko Riippi"}}, "url": "https://github.com/nordic-institute/X-Road/commit/334a7fb4c824e6aef71585100be4d4aa64ff02e1", "committedDate": "2020-09-15T10:55:33Z", "message": "XRDDEV-1319 Add check for EDIT_SERVICE_PARAMS permission"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f053b9959a276be031e48b75b18551349f9615a7", "author": {"user": {"login": "Riippi", "name": "Mikko Riippi"}}, "url": "https://github.com/nordic-institute/X-Road/commit/f053b9959a276be031e48b75b18551349f9615a7", "committedDate": "2020-09-15T11:46:50Z", "message": "XRDDEV-1319 Add check for EDIT_SERVICE_ACL permission"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a974ad50b287d197867355bfb7ee62548dd5fe75", "author": {"user": {"login": "Riippi", "name": "Mikko Riippi"}}, "url": "https://github.com/nordic-institute/X-Road/commit/a974ad50b287d197867355bfb7ee62548dd5fe75", "committedDate": "2020-09-15T12:01:13Z", "message": "XRDDEV-1319 Updates to keys & certificates permission handling"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "3dcc89bf1f43d43d160b48a1ec6fdc91b0b31f73", "author": {"user": {"login": "Riippi", "name": "Mikko Riippi"}}, "url": "https://github.com/nordic-institute/X-Road/commit/3dcc89bf1f43d43d160b48a1ec6fdc91b0b31f73", "committedDate": "2020-09-15T12:14:24Z", "message": "XRDDEV-1319 Add permission view_approved_certificate_authorities for XROAD_REGISTRATION_OFFICER role"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a5e21377636f4cfc4d1b1f8dc0b127fdb5865223", "author": {"user": {"login": "Riippi", "name": "Mikko Riippi"}}, "url": "https://github.com/nordic-institute/X-Road/commit/a5e21377636f4cfc4d1b1f8dc0b127fdb5865223", "committedDate": "2020-09-15T13:18:59Z", "message": "XRDDEV-1319 Updates to keys & certificates permission handling"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "57be0e9b10d62c1ad45dc1b9f81e2105d0af97ff", "author": {"user": {"login": "Riippi", "name": "Mikko Riippi"}}, "url": "https://github.com/nordic-institute/X-Road/commit/57be0e9b10d62c1ad45dc1b9f81e2105d0af97ff", "committedDate": "2020-09-15T13:23:29Z", "message": "XRDDEV-1319 Update permission check in csr wizard"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "243e87ece4a0d16dd3aec03f79a7fec110f9a6da", "author": {"user": {"login": "Riippi", "name": "Mikko Riippi"}}, "url": "https://github.com/nordic-institute/X-Road/commit/243e87ece4a0d16dd3aec03f79a7fec110f9a6da", "committedDate": "2020-09-15T13:38:53Z", "message": "XRDDEV-1319 Update permission checks for service endpoints"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a8592b9f716e079a5e0c0cc9588ee00db3b8d814", "author": {"user": {"login": "Riippi", "name": "Mikko Riippi"}}, "url": "https://github.com/nordic-institute/X-Road/commit/a8592b9f716e079a5e0c0cc9588ee00db3b8d814", "committedDate": "2020-09-15T15:28:10Z", "message": "XRDDEV-1319 Fix small ui glitch"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "1e3a3cc089ec8241902bf933f8526d33393edcab", "author": {"user": {"login": "Riippi", "name": "Mikko Riippi"}}, "url": "https://github.com/nordic-institute/X-Road/commit/1e3a3cc089ec8241902bf933f8526d33393edcab", "committedDate": "2020-09-15T16:37:04Z", "message": "XRDDEV-1319 Add route permission checks for \"add client\" paths"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "736b870edf9be2f7a1f5c22a647750548d60001f", "author": {"user": {"login": "Riippi", "name": "Mikko Riippi"}}, "url": "https://github.com/nordic-institute/X-Road/commit/736b870edf9be2f7a1f5c22a647750548d60001f", "committedDate": "2020-09-15T19:13:32Z", "message": "XRDDEV-1319 Fix linter issue"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "de69a4d98afaacba65cb4c951bdc03fbf3abba81", "author": {"user": {"login": "Riippi", "name": "Mikko Riippi"}}, "url": "https://github.com/nordic-institute/X-Road/commit/de69a4d98afaacba65cb4c951bdc03fbf3abba81", "committedDate": "2020-09-15T19:22:32Z", "message": "Merge branch 'bugfix-6.24.1' into XRDDEV-1319-permission-checks\n\n# Conflicts:\n#\tsrc/proxy-ui-api/frontend/audit-resolve.json\n#\tsrc/proxy-ui-api/frontend/package-lock.json"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDg5NDQ3NjAx", "url": "https://github.com/nordic-institute/X-Road/pull/712#pullrequestreview-489447601", "createdAt": "2020-09-16T09:34:49Z", "commit": {"oid": "de69a4d98afaacba65cb4c951bdc03fbf3abba81"}, "state": "APPROVED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xNlQwOTozNDo0OVrOHSok3A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xNlQwOTozNDo0OVrOHSok3A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4OTMwMTIxMg==", "bodyText": "typo", "url": "https://github.com/nordic-institute/X-Road/pull/712#discussion_r489301212", "createdAt": "2020-09-16T09:34:49Z", "author": {"login": "TJaakkola"}, "path": "src/proxy-ui-api/frontend/src/views/KeysAndCertificates/SignAndAuthKeys/KeysTable.vue", "diffHunk": "@@ -206,37 +204,37 @@ export default Vue.extend({\n     };\n   },\n   computed: {\n-    hasPermission(): boolean {\n+    canImportFromToken(): boolean {\n+      // Can the user import cwrtificate from hardware token", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "de69a4d98afaacba65cb4c951bdc03fbf3abba81"}, "originalPosition": 53}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDg5NTYxODI5", "url": "https://github.com/nordic-institute/X-Road/pull/712#pullrequestreview-489561829", "createdAt": "2020-09-16T12:15:24Z", "commit": {"oid": "de69a4d98afaacba65cb4c951bdc03fbf3abba81"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xNlQxMjoxNToyNFrOHSt-Ag==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xNlQxMjoxOTo0NFrOHSuHzw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4OTM4OTU3MA==", "bodyText": "Does this work OK if key does not yet have a defined usage (no CSRs have been created) and user has only generate_auth_cert_req permission, not generate_sign_cert_req? (there is no such role at the moment, though, which would hide the issue)", "url": "https://github.com/nordic-institute/X-Road/pull/712#discussion_r489389570", "createdAt": "2020-09-16T12:15:24Z", "author": {"login": "jansu76"}, "path": "src/proxy-ui-api/frontend/src/views/KeysAndCertificates/SignAndAuthKeys/KeyRow.vue", "diffHunk": "@@ -65,29 +63,41 @@ export default Vue.extend({\n       type: Object as Prop<Key>,\n       required: true,\n     },\n-    hasPermission: {\n-      type: Boolean,\n-    },\n     tokenLoggedIn: {\n       type: Boolean,\n     },\n   },\n-  methods: {\n-    disableGenerateCsr(key: Key): boolean {\n-      if (!this.tokenLoggedIn) {\n-        return true;\n+  computed: {\n+    showGenerateCsr(): boolean {\n+      // Check if the user has permission to see generate csr action\n+      if (this.tokenKey.usage === 'AUTHENTICATION') {\n+        return this.$store.getters.hasPermission(\n+          Permissions.GENERATE_AUTH_CERT_REQ,\n+        );\n       }\n+      // If key usage is not auth then it has to be sign\n+      return this.$store.getters.hasPermission(", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "de69a4d98afaacba65cb4c951bdc03fbf3abba81"}, "originalPosition": 49}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4OTM5MDU0Mg==", "bodyText": "Should be generate_sign_cert_req?", "url": "https://github.com/nordic-institute/X-Road/pull/712#discussion_r489390542", "createdAt": "2020-09-16T12:17:02Z", "author": {"login": "jansu76"}, "path": "src/proxy-ui-api/frontend/src/views/KeysAndCertificates/SignAndAuthKeys/KeysTable.vue", "diffHunk": "@@ -206,37 +204,37 @@ export default Vue.extend({\n     };\n   },\n   computed: {\n-    hasPermission(): boolean {\n+    canImportFromToken(): boolean {\n+      // Can the user import cwrtificate from hardware token\n+      return this.$store.getters.hasPermission(Permissions.IMPORT_SIGN_CERT);\n+    },\n+\n+    showRegisterCertButton(): boolean {\n+      // Decide if the user can register a certificate\n       return this.$store.getters.hasPermission(\n-        Permissions.ACTIVATE_DEACTIVATE_TOKEN,\n+        Permissions.SEND_AUTH_CERT_REG_REQ,\n       );\n     },\n-    showRegisterCertButton(): boolean {\n-      if (\n-        this.hasPermission &&\n-        this.$store.getters.hasPermission(Permissions.SEND_AUTH_CERT_REG_REQ)\n-      ) {\n-        return true;\n-      }\n-      return false;\n+\n+    canCreateAuthCsr(): boolean {\n+      return this.$store.getters.hasPermission(\n+        Permissions.GENERATE_AUTH_CERT_REQ,\n+      );\n+    },\n+    canCreateSignCsr(): boolean {\n+      return this.$store.getters.hasPermission(\n+        Permissions.GENERATE_AUTH_CERT_REQ,", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "de69a4d98afaacba65cb4c951bdc03fbf3abba81"}, "originalPosition": 80}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4OTM5MjA3OQ==", "bodyText": "Would method name canCreateCsr be more descriptive (and same style seems to be used elsewhere)?", "url": "https://github.com/nordic-institute/X-Road/pull/712#discussion_r489392079", "createdAt": "2020-09-16T12:19:44Z", "author": {"login": "jansu76"}, "path": "src/proxy-ui-api/frontend/src/views/KeysAndCertificates/SignAndAuthKeys/UnknownKeysTable.vue", "diffHunk": "@@ -94,9 +94,9 @@ export default Vue.extend({\n   },\n   computed: {\n     hasPermission(): boolean {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "de69a4d98afaacba65cb4c951bdc03fbf3abba81"}, "originalPosition": 3}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "3b34dcb3e73bf711851bb561087f64937fd551b9", "author": {"user": {"login": "Riippi", "name": "Mikko Riippi"}}, "url": "https://github.com/nordic-institute/X-Road/commit/3b34dcb3e73bf711851bb561087f64937fd551b9", "committedDate": "2020-09-16T12:49:12Z", "message": "XRDDEV-1319 Fix PR issues"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDg5ODIwMTk2", "url": "https://github.com/nordic-institute/X-Road/pull/712#pullrequestreview-489820196", "createdAt": "2020-09-16T16:55:57Z", "commit": {"oid": "3b34dcb3e73bf711851bb561087f64937fd551b9"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4078, "cost": 1, "resetAt": "2021-11-01T16:19:10Z"}}}