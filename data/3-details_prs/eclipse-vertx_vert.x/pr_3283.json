{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0Mzc0MzU1MTA0", "number": 3283, "title": "Use a http server to hold the port busy before the real test.", "bodyText": "Signed-off-by: Rodrigo Salado Anaya rodrigo.salado.anaya@gmail.com\nMotivation:\nImprovement to the test testListenInvalidPort, currently when port 80 is available the test fails.\nmvn -Dtest=NetTest#testListenInvalidPort test", "createdAt": "2020-02-12T14:58:09Z", "url": "https://github.com/eclipse-vertx/vert.x/pull/3283", "merged": true, "mergeCommit": {"oid": "b7c04644faa9b84bc6673f9ca4894d942892886c"}, "closed": true, "closedAt": "2020-02-20T08:58:21Z", "author": {"login": "rodrigoSaladoAnaya"}, "timelineItems": {"totalCount": 8, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcDnlIzgH2gAyMzc0MzU1MTA0OmE3NGY3MTcwZWU2NjIyZDkyM2I0NWQ1NmVlZTJjNzhlZTNjYjhkZWI=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcF7i8MAH2gAyMzc0MzU1MTA0OmE0ODZjZjY0YzFlMjZlZTkyOTQ3NWFlMWQ2Y2VhNTYzZTNjMTQ0NGI=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "a74f7170ee6622d923b45d56eee2c78ee3cb8deb", "author": {"user": {"login": "rodrigoSaladoAnaya", "name": "Rodrigo Salado Anaya"}}, "url": "https://github.com/eclipse-vertx/vert.x/commit/a74f7170ee6622d923b45d56eee2c78ee3cb8deb", "committedDate": "2020-02-12T14:54:43Z", "message": "Use a http server to hold the port busy before the real test.\n\nSigned-off-by: Rodrigo Salado Anaya <rodrigo.salado.anaya@gmail.com>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzU3NTQyMTI5", "url": "https://github.com/eclipse-vertx/vert.x/pull/3283#pullrequestreview-357542129", "createdAt": "2020-02-12T15:23:45Z", "commit": {"oid": "a74f7170ee6622d923b45d56eee2c78ee3cb8deb"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xMlQxNToyMzo0NVrOFoy4LQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xMlQxNToyMzo0NVrOFoy4LQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3ODMyMDk0MQ==", "bodyText": "can you use the onSuccess / onFailure lambdas to improve the test ?", "url": "https://github.com/eclipse-vertx/vert.x/pull/3283#discussion_r378320941", "createdAt": "2020-02-12T15:23:45Z", "author": {"login": "vietj"}, "path": "src/test/java/io/vertx/core/net/NetTest.java", "diffHunk": "@@ -903,16 +903,21 @@ public void testConnectInvalidConnectHandler() throws Exception {\n \n   @Test\n   public void testListenInvalidPort() {\n-    /* Port 80 is free to use by any application on Windows, so this test fails. */\n-    Assume.assumeFalse(System.getProperty(\"os.name\").startsWith(\"Windows\"));\n-    server.close();\n-    server = vertx.createNetServer(new NetServerOptions().setPort(80));\n-    server.connectHandler((netSocket) -> {\n-    }).listen(ar -> {\n-      assertTrue(ar.failed());\n-      assertFalse(ar.succeeded());\n-      assertNotNull(ar.cause());\n-      testComplete();\n+    final int port = 9090;\n+    final HttpServer httpServer = vertx.createHttpServer();\n+    httpServer.requestHandler(r -> {}).listen(port, httpResult -> {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a74f7170ee6622d923b45d56eee2c78ee3cb8deb"}, "originalPosition": 16}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "bf15c5365786f4c17e447ce399da3ba1d2ae3e79", "author": {"user": {"login": "rodrigoSaladoAnaya", "name": "Rodrigo Salado Anaya"}}, "url": "https://github.com/eclipse-vertx/vert.x/commit/bf15c5365786f4c17e447ce399da3ba1d2ae3e79", "committedDate": "2020-02-12T16:28:24Z", "message": "Use the onSuccess / onFailure lambdas to improve the test\n\nSigned-off-by: Rodrigo Salado Anaya <rodrigo.salado.anaya@gmail.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "1da4245ddf4fe052086ffba8bbd81e0be89f8717", "author": {"user": {"login": "rodrigoSaladoAnaya", "name": "Rodrigo Salado Anaya"}}, "url": "https://github.com/eclipse-vertx/vert.x/commit/1da4245ddf4fe052086ffba8bbd81e0be89f8717", "committedDate": "2020-02-13T15:04:12Z", "message": "Following the recommendation of use AsyncTestBase.onFailure()\n\nSigned-off-by: Rodrigo Salado Anaya <rodrigo.salado.anaya@gmail.com>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzU4ODAwMzQ3", "url": "https://github.com/eclipse-vertx/vert.x/pull/3283#pullrequestreview-358800347", "createdAt": "2020-02-14T09:13:36Z", "commit": {"oid": "1da4245ddf4fe052086ffba8bbd81e0be89f8717"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xNFQwOToxMzozN1rOFpv6Ew==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xNFQwOToxMzozN1rOFpv6Ew==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3OTMyMDg1MQ==", "bodyText": "I think here we need an onSuccess(...) block", "url": "https://github.com/eclipse-vertx/vert.x/pull/3283#discussion_r379320851", "createdAt": "2020-02-14T09:13:37Z", "author": {"login": "vietj"}, "path": "src/test/java/io/vertx/core/net/NetTest.java", "diffHunk": "@@ -903,18 +903,18 @@ public void testConnectInvalidConnectHandler() throws Exception {\n \n   @Test\n   public void testListenInvalidPort() {\n-    /* Port 80 is free to use by any application on Windows, so this test fails. */\n-    Assume.assumeFalse(System.getProperty(\"os.name\").startsWith(\"Windows\"));\n-    server.close();\n-    server = vertx.createNetServer(new NetServerOptions().setPort(80));\n-    server.connectHandler((netSocket) -> {\n-    }).listen(ar -> {\n-      assertTrue(ar.failed());\n-      assertFalse(ar.succeeded());\n-      assertNotNull(ar.cause());\n-      testComplete();\n-    });\n+    final int port = 9090;\n+    final HttpServer httpServer = vertx.createHttpServer()\n+      .requestHandler(ignore -> {})\n+      .listen(port, httpResult ->", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "1da4245ddf4fe052086ffba8bbd81e0be89f8717"}, "originalPosition": 18}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "0ed9f538c6b482701143939d99f7ba60a91d2484", "author": {"user": {"login": "rodrigoSaladoAnaya", "name": "Rodrigo Salado Anaya"}}, "url": "https://github.com/eclipse-vertx/vert.x/commit/0ed9f538c6b482701143939d99f7ba60a91d2484", "committedDate": "2020-02-14T14:42:03Z", "message": "Use onSuccess to check the port in the http server\n\nSigned-off-by: Rodrigo Salado Anaya <rodrigo.salado.anaya@gmail.com>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzYxMzE1NDM0", "url": "https://github.com/eclipse-vertx/vert.x/pull/3283#pullrequestreview-361315434", "createdAt": "2020-02-19T18:05:06Z", "commit": {"oid": "0ed9f538c6b482701143939d99f7ba60a91d2484"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xOVQxODowNTowNlrOFrxz8g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xOVQxODowNTowNlrOFrxz8g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MTQ0OTIwMg==", "bodyText": "we need this close to be in a finally block", "url": "https://github.com/eclipse-vertx/vert.x/pull/3283#discussion_r381449202", "createdAt": "2020-02-19T18:05:06Z", "author": {"login": "vietj"}, "path": "src/test/java/io/vertx/core/net/NetTest.java", "diffHunk": "@@ -903,18 +903,18 @@ public void testConnectInvalidConnectHandler() throws Exception {\n \n   @Test\n   public void testListenInvalidPort() {\n-    /* Port 80 is free to use by any application on Windows, so this test fails. */\n-    Assume.assumeFalse(System.getProperty(\"os.name\").startsWith(\"Windows\"));\n-    server.close();\n-    server = vertx.createNetServer(new NetServerOptions().setPort(80));\n-    server.connectHandler((netSocket) -> {\n-    }).listen(ar -> {\n-      assertTrue(ar.failed());\n-      assertFalse(ar.succeeded());\n-      assertNotNull(ar.cause());\n-      testComplete();\n-    });\n+    final int port = 9090;\n+    final HttpServer httpServer = vertx.createHttpServer()\n+      .requestHandler(ignore -> {})\n+      .listen(port, onSuccess(s ->\n+        vertx.createNetServer()\n+          .connectHandler(ignore -> {})\n+          .listen(port, onFailure(error -> {\n+            assertNotNull(error);\n+            testComplete();\n+          }))));\n     await();\n+    httpServer.close();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "0ed9f538c6b482701143939d99f7ba60a91d2484"}, "originalPosition": 26}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a486cf64c1e26ee929475ae1d6cea563e3c1444b", "author": {"user": {"login": "rodrigoSaladoAnaya", "name": "Rodrigo Salado Anaya"}}, "url": "https://github.com/eclipse-vertx/vert.x/commit/a486cf64c1e26ee929475ae1d6cea563e3c1444b", "committedDate": "2020-02-19T19:18:16Z", "message": "Use a finally block to close the http server\n\nSigned-off-by: Rodrigo Salado Anaya <rodrigo.salado.anaya@gmail.com>"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1739, "cost": 1, "resetAt": "2021-11-01T13:51:04Z"}}}