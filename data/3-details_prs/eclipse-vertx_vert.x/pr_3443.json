{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDMzNTgyMjk3", "number": 3443, "title": "testListenInvalidPort now valid for Windows and OSX", "bodyText": "Motivation:\nThe test 'testListenInvalidPort' fails on OSX as it is possible to use port 7 in that env,\nfrom reading the test it also looks like this is true in Windows too.\nIts test's failure trips up 'mvn clean install' on OSX.\nThis PR changes the test to first occupy a valid port (by asking for port 0)\nexclusively (need to set this on OSX) and then using that occupied port\nfor the collision. The socket is Closable so the try with resources should\nclose the port (after the await) meaning the test should not leak socket\nresources.\nThis test is also mentioned as failing in another env in #3051\nSigned-off-by: Gordon Hutchison Gordon.Hutchison@gmail.com", "createdAt": "2020-06-12T09:53:04Z", "url": "https://github.com/eclipse-vertx/vert.x/pull/3443", "merged": true, "mergeCommit": {"oid": "7dc1f054f8143ca68a55c013034acf426d4ba164"}, "closed": true, "closedAt": "2020-06-13T12:52:44Z", "author": {"login": "hutchig"}, "timelineItems": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcqfl9MgH2gAyNDMzNTgyMjk3Ojc2NDE4ZjIwZmJjNDFkNGFkNGU4NzQ1NWM5MGJhNzVkMjI4MjQ4ZTc=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcqmYnjgH2gAyNDMzNTgyMjk3Ojk4MzFiNTE4Y2RhMWE2YWUxMDZhYjA3NTYzOTk2ZmU2NGQwY2FlMTk=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "76418f20fbc41d4ad4e87455c90ba75d228248e7", "author": {"user": {"login": "hutchig", "name": "Gordon Hutchison"}}, "url": "https://github.com/eclipse-vertx/vert.x/commit/76418f20fbc41d4ad4e87455c90ba75d228248e7", "committedDate": "2020-06-12T09:39:25Z", "message": "testListenInvalidPort now valid for Windows and OSX\n\nSigned-off-by: Gordon Hutchison <Gordon.Hutchison@gmail.com>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDI5NjU1Nzk4", "url": "https://github.com/eclipse-vertx/vert.x/pull/3443#pullrequestreview-429655798", "createdAt": "2020-06-12T11:07:21Z", "commit": {"oid": "76418f20fbc41d4ad4e87455c90ba75d228248e7"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xMlQxMTowNzoyMlrOGjAIvg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xMlQxMTowNzoyMlrOGjAIvg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzOTM1NTU4Mg==", "bodyText": "the occupied server socket should be closed in a finally block surrounding this", "url": "https://github.com/eclipse-vertx/vert.x/pull/3443#discussion_r439355582", "createdAt": "2020-06-12T11:07:22Z", "author": {"login": "vietj"}, "path": "src/test/java/io/vertx/core/http/HttpTest.java", "diffHunk": "@@ -2704,12 +2705,13 @@ public void testGetAbsoluteURI() {\n \n   @Test\n   public void testListenInvalidPort() throws Exception {\n-    /* Port 7 is free for use by any application in Windows, so this test fails. */\n-    Assume.assumeFalse(System.getProperty(\"os.name\").startsWith(\"Windows\"));\n     server.close();\n-    server = vertx.createHttpServer(new HttpServerOptions().setPort(7));\n-    server.requestHandler(noOpHandler()).listen(onFailure(server -> testComplete()));\n-    await();\n+    try(ServerSocket occupied = new ServerSocket(0)){\n+      occupied.setReuseAddress(false);\n+      server = vertx.createHttpServer(new HttpServerOptions().setPort(occupied.getLocalPort()));\n+      server.requestHandler(noOpHandler()).listen(onFailure(server -> testComplete()));\n+      await();\n+    }", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "76418f20fbc41d4ad4e87455c90ba75d228248e7"}, "originalPosition": 23}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "9831b518cda1a6ae106ab07563996fe64d0cae19", "author": {"user": {"login": "hutchig", "name": "Gordon Hutchison"}}, "url": "https://github.com/eclipse-vertx/vert.x/commit/9831b518cda1a6ae106ab07563996fe64d0cae19", "committedDate": "2020-06-12T17:34:11Z", "message": "Change HttpTest::testListenInvalidPort to use finally\n\nSigned-off-by: Gordon Hutchison <Gordon.Hutchison@gmail.com>"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1676, "cost": 1, "resetAt": "2021-11-01T13:51:04Z"}}}