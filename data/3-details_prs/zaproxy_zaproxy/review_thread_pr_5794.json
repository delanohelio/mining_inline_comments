{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0MzYxNjgxNDgy", "number": 5794, "reviewThreads": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0xMVQwMTo1ODo0N1rODXTsRA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0xMlQxNTozODo0OVrODXYeLw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjI1NzY2NDY4OnYy", "diffSide": "RIGHT", "path": "zap/src/main/java/org/parosproxy/paros/Constant.java", "isResolved": true, "comments": {"totalCount": 6, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0xMVQwMTo1ODo0N1rOFcjv5Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0xMlQxNjowMDowOFrOFcqA8A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NTQ5MDE0OQ==", "bodyText": "I've probably overlooked something, but this seemed necessary to make it stick.", "url": "https://github.com/zaproxy/zaproxy/pull/5794#discussion_r365490149", "createdAt": "2020-01-11T01:58:47Z", "author": {"login": "kingthorin"}, "path": "zap/src/main/java/org/parosproxy/paros/Constant.java", "diffHunk": "@@ -1092,6 +1095,29 @@ private static void upgradeFrom2_8_0(XMLConfiguration config) {\n         // Update to a newer default user agent\n         config.setProperty(\n                 ConnectionParam.DEFAULT_USER_AGENT, ConnectionParam.DEFAULT_DEFAULT_USER_AGENT);\n+        updatePscanTagMailtoPattern(config);\n+    }\n+\n+    private static void updatePscanTagMailtoPattern(XMLConfiguration config) {\n+        String autoTagScannersKey = \"pscans.autoTagScanners.scanner\";\n+        List<HierarchicalConfiguration> tagScanners = config.configurationsAt(autoTagScannersKey);\n+        String badPattern = \"<.*href\\\\s*['\\\"]?mailto:\";\n+        String goodPattern = \"<.*href\\\\s*=['\\\"]?mailto:\";\n+\n+        for (int i = 0, size = tagScanners.size(); i < size; ++i) {\n+            String elementBaseKey = autoTagScannersKey + \"(\" + i + \").\";\n+            String currentKeyResBodyRegex = elementBaseKey + \"resBodyRegex\";\n+            if (config.getProperty(currentKeyResBodyRegex).equals(badPattern)) {\n+                config.setProperty(currentKeyResBodyRegex, goodPattern);\n+                break;\n+            }\n+        }\n+\n+        try {\n+            config.save();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "4af577ccb357517c8091a1b59fcee7db266fd5ee"}, "originalPosition": 40}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NTU5MDk0MA==", "bodyText": "It shouldn't, the config is already being saved after calling all upgradeFrom_ methods (when setting the latest version). I also tested without this statement and the tag was updated in the file.", "url": "https://github.com/zaproxy/zaproxy/pull/5794#discussion_r365590940", "createdAt": "2020-01-12T15:31:33Z", "author": {"login": "thc202"}, "path": "zap/src/main/java/org/parosproxy/paros/Constant.java", "diffHunk": "@@ -1092,6 +1095,29 @@ private static void upgradeFrom2_8_0(XMLConfiguration config) {\n         // Update to a newer default user agent\n         config.setProperty(\n                 ConnectionParam.DEFAULT_USER_AGENT, ConnectionParam.DEFAULT_DEFAULT_USER_AGENT);\n+        updatePscanTagMailtoPattern(config);\n+    }\n+\n+    private static void updatePscanTagMailtoPattern(XMLConfiguration config) {\n+        String autoTagScannersKey = \"pscans.autoTagScanners.scanner\";\n+        List<HierarchicalConfiguration> tagScanners = config.configurationsAt(autoTagScannersKey);\n+        String badPattern = \"<.*href\\\\s*['\\\"]?mailto:\";\n+        String goodPattern = \"<.*href\\\\s*=['\\\"]?mailto:\";\n+\n+        for (int i = 0, size = tagScanners.size(); i < size; ++i) {\n+            String elementBaseKey = autoTagScannersKey + \"(\" + i + \").\";\n+            String currentKeyResBodyRegex = elementBaseKey + \"resBodyRegex\";\n+            if (config.getProperty(currentKeyResBodyRegex).equals(badPattern)) {\n+                config.setProperty(currentKeyResBodyRegex, goodPattern);\n+                break;\n+            }\n+        }\n+\n+        try {\n+            config.save();", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NTQ5MDE0OQ=="}, "originalCommit": {"oid": "4af577ccb357517c8091a1b59fcee7db266fd5ee"}, "originalPosition": 40}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NTU5MTc3NA==", "bodyText": "But did you see it in the UI as updated?", "url": "https://github.com/zaproxy/zaproxy/pull/5794#discussion_r365591774", "createdAt": "2020-01-12T15:45:09Z", "author": {"login": "kingthorin"}, "path": "zap/src/main/java/org/parosproxy/paros/Constant.java", "diffHunk": "@@ -1092,6 +1095,29 @@ private static void upgradeFrom2_8_0(XMLConfiguration config) {\n         // Update to a newer default user agent\n         config.setProperty(\n                 ConnectionParam.DEFAULT_USER_AGENT, ConnectionParam.DEFAULT_DEFAULT_USER_AGENT);\n+        updatePscanTagMailtoPattern(config);\n+    }\n+\n+    private static void updatePscanTagMailtoPattern(XMLConfiguration config) {\n+        String autoTagScannersKey = \"pscans.autoTagScanners.scanner\";\n+        List<HierarchicalConfiguration> tagScanners = config.configurationsAt(autoTagScannersKey);\n+        String badPattern = \"<.*href\\\\s*['\\\"]?mailto:\";\n+        String goodPattern = \"<.*href\\\\s*=['\\\"]?mailto:\";\n+\n+        for (int i = 0, size = tagScanners.size(); i < size; ++i) {\n+            String elementBaseKey = autoTagScannersKey + \"(\" + i + \").\";\n+            String currentKeyResBodyRegex = elementBaseKey + \"resBodyRegex\";\n+            if (config.getProperty(currentKeyResBodyRegex).equals(badPattern)) {\n+                config.setProperty(currentKeyResBodyRegex, goodPattern);\n+                break;\n+            }\n+        }\n+\n+        try {\n+            config.save();", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NTQ5MDE0OQ=="}, "originalCommit": {"oid": "4af577ccb357517c8091a1b59fcee7db266fd5ee"}, "originalPosition": 40}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NTU5MTkzNQ==", "bodyText": "Yes, it was the new value.", "url": "https://github.com/zaproxy/zaproxy/pull/5794#discussion_r365591935", "createdAt": "2020-01-12T15:46:26Z", "author": {"login": "thc202"}, "path": "zap/src/main/java/org/parosproxy/paros/Constant.java", "diffHunk": "@@ -1092,6 +1095,29 @@ private static void upgradeFrom2_8_0(XMLConfiguration config) {\n         // Update to a newer default user agent\n         config.setProperty(\n                 ConnectionParam.DEFAULT_USER_AGENT, ConnectionParam.DEFAULT_DEFAULT_USER_AGENT);\n+        updatePscanTagMailtoPattern(config);\n+    }\n+\n+    private static void updatePscanTagMailtoPattern(XMLConfiguration config) {\n+        String autoTagScannersKey = \"pscans.autoTagScanners.scanner\";\n+        List<HierarchicalConfiguration> tagScanners = config.configurationsAt(autoTagScannersKey);\n+        String badPattern = \"<.*href\\\\s*['\\\"]?mailto:\";\n+        String goodPattern = \"<.*href\\\\s*=['\\\"]?mailto:\";\n+\n+        for (int i = 0, size = tagScanners.size(); i < size; ++i) {\n+            String elementBaseKey = autoTagScannersKey + \"(\" + i + \").\";\n+            String currentKeyResBodyRegex = elementBaseKey + \"resBodyRegex\";\n+            if (config.getProperty(currentKeyResBodyRegex).equals(badPattern)) {\n+                config.setProperty(currentKeyResBodyRegex, goodPattern);\n+                break;\n+            }\n+        }\n+\n+        try {\n+            config.save();", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NTQ5MDE0OQ=="}, "originalCommit": {"oid": "4af577ccb357517c8091a1b59fcee7db266fd5ee"}, "originalPosition": 40}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NTU5MjYyOA==", "bodyText": "Probably because of how I was testing? Inserting the method call at 610'ish so it'd be used in devmode... I'll remove this try block.", "url": "https://github.com/zaproxy/zaproxy/pull/5794#discussion_r365592628", "createdAt": "2020-01-12T15:57:55Z", "author": {"login": "kingthorin"}, "path": "zap/src/main/java/org/parosproxy/paros/Constant.java", "diffHunk": "@@ -1092,6 +1095,29 @@ private static void upgradeFrom2_8_0(XMLConfiguration config) {\n         // Update to a newer default user agent\n         config.setProperty(\n                 ConnectionParam.DEFAULT_USER_AGENT, ConnectionParam.DEFAULT_DEFAULT_USER_AGENT);\n+        updatePscanTagMailtoPattern(config);\n+    }\n+\n+    private static void updatePscanTagMailtoPattern(XMLConfiguration config) {\n+        String autoTagScannersKey = \"pscans.autoTagScanners.scanner\";\n+        List<HierarchicalConfiguration> tagScanners = config.configurationsAt(autoTagScannersKey);\n+        String badPattern = \"<.*href\\\\s*['\\\"]?mailto:\";\n+        String goodPattern = \"<.*href\\\\s*=['\\\"]?mailto:\";\n+\n+        for (int i = 0, size = tagScanners.size(); i < size; ++i) {\n+            String elementBaseKey = autoTagScannersKey + \"(\" + i + \").\";\n+            String currentKeyResBodyRegex = elementBaseKey + \"resBodyRegex\";\n+            if (config.getProperty(currentKeyResBodyRegex).equals(badPattern)) {\n+                config.setProperty(currentKeyResBodyRegex, goodPattern);\n+                break;\n+            }\n+        }\n+\n+        try {\n+            config.save();", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NTQ5MDE0OQ=="}, "originalCommit": {"oid": "4af577ccb357517c8091a1b59fcee7db266fd5ee"}, "originalPosition": 40}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NTU5MjgxNg==", "bodyText": "Right, in that case it would not be saved.", "url": "https://github.com/zaproxy/zaproxy/pull/5794#discussion_r365592816", "createdAt": "2020-01-12T16:00:08Z", "author": {"login": "thc202"}, "path": "zap/src/main/java/org/parosproxy/paros/Constant.java", "diffHunk": "@@ -1092,6 +1095,29 @@ private static void upgradeFrom2_8_0(XMLConfiguration config) {\n         // Update to a newer default user agent\n         config.setProperty(\n                 ConnectionParam.DEFAULT_USER_AGENT, ConnectionParam.DEFAULT_DEFAULT_USER_AGENT);\n+        updatePscanTagMailtoPattern(config);\n+    }\n+\n+    private static void updatePscanTagMailtoPattern(XMLConfiguration config) {\n+        String autoTagScannersKey = \"pscans.autoTagScanners.scanner\";\n+        List<HierarchicalConfiguration> tagScanners = config.configurationsAt(autoTagScannersKey);\n+        String badPattern = \"<.*href\\\\s*['\\\"]?mailto:\";\n+        String goodPattern = \"<.*href\\\\s*=['\\\"]?mailto:\";\n+\n+        for (int i = 0, size = tagScanners.size(); i < size; ++i) {\n+            String elementBaseKey = autoTagScannersKey + \"(\" + i + \").\";\n+            String currentKeyResBodyRegex = elementBaseKey + \"resBodyRegex\";\n+            if (config.getProperty(currentKeyResBodyRegex).equals(badPattern)) {\n+                config.setProperty(currentKeyResBodyRegex, goodPattern);\n+                break;\n+            }\n+        }\n+\n+        try {\n+            config.save();", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NTQ5MDE0OQ=="}, "originalCommit": {"oid": "4af577ccb357517c8091a1b59fcee7db266fd5ee"}, "originalPosition": 40}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjI1ODQ0NDk5OnYy", "diffSide": "RIGHT", "path": "zap/src/main/java/org/parosproxy/paros/Constant.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0xMlQxNTozMjowOFrOFcp51A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0xMlQxNTo0NTo1N1rOFcp9UA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NTU5MDk5Ng==", "bodyText": "Worth adding \\\\s* after the equals.", "url": "https://github.com/zaproxy/zaproxy/pull/5794#discussion_r365590996", "createdAt": "2020-01-12T15:32:08Z", "author": {"login": "thc202"}, "path": "zap/src/main/java/org/parosproxy/paros/Constant.java", "diffHunk": "@@ -1092,6 +1095,29 @@ private static void upgradeFrom2_8_0(XMLConfiguration config) {\n         // Update to a newer default user agent\n         config.setProperty(\n                 ConnectionParam.DEFAULT_USER_AGENT, ConnectionParam.DEFAULT_DEFAULT_USER_AGENT);\n+        updatePscanTagMailtoPattern(config);\n+    }\n+\n+    private static void updatePscanTagMailtoPattern(XMLConfiguration config) {\n+        String autoTagScannersKey = \"pscans.autoTagScanners.scanner\";\n+        List<HierarchicalConfiguration> tagScanners = config.configurationsAt(autoTagScannersKey);\n+        String badPattern = \"<.*href\\\\s*['\\\"]?mailto:\";\n+        String goodPattern = \"<.*href\\\\s*=['\\\"]?mailto:\";", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "4af577ccb357517c8091a1b59fcee7db266fd5ee"}, "originalPosition": 28}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NTU5MTg4OA==", "bodyText": "Okay", "url": "https://github.com/zaproxy/zaproxy/pull/5794#discussion_r365591888", "createdAt": "2020-01-12T15:45:57Z", "author": {"login": "kingthorin"}, "path": "zap/src/main/java/org/parosproxy/paros/Constant.java", "diffHunk": "@@ -1092,6 +1095,29 @@ private static void upgradeFrom2_8_0(XMLConfiguration config) {\n         // Update to a newer default user agent\n         config.setProperty(\n                 ConnectionParam.DEFAULT_USER_AGENT, ConnectionParam.DEFAULT_DEFAULT_USER_AGENT);\n+        updatePscanTagMailtoPattern(config);\n+    }\n+\n+    private static void updatePscanTagMailtoPattern(XMLConfiguration config) {\n+        String autoTagScannersKey = \"pscans.autoTagScanners.scanner\";\n+        List<HierarchicalConfiguration> tagScanners = config.configurationsAt(autoTagScannersKey);\n+        String badPattern = \"<.*href\\\\s*['\\\"]?mailto:\";\n+        String goodPattern = \"<.*href\\\\s*=['\\\"]?mailto:\";", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NTU5MDk5Ng=="}, "originalCommit": {"oid": "4af577ccb357517c8091a1b59fcee7db266fd5ee"}, "originalPosition": 28}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjI1ODQ0NzgzOnYy", "diffSide": "RIGHT", "path": "zap/src/main/java/org/parosproxy/paros/Constant.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0xMlQxNTozODo0OVrOFcp7Yg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0xMlQxNTozODo0OVrOFcp7Yg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NTU5MTM5NA==", "bodyText": "String currentKeyResBodyRegex = autoTagScannersKey + \"(\" + i + \").resBodyRegex\";", "url": "https://github.com/zaproxy/zaproxy/pull/5794#discussion_r365591394", "createdAt": "2020-01-12T15:38:49Z", "author": {"login": "thc202"}, "path": "zap/src/main/java/org/parosproxy/paros/Constant.java", "diffHunk": "@@ -1092,6 +1095,29 @@ private static void upgradeFrom2_8_0(XMLConfiguration config) {\n         // Update to a newer default user agent\n         config.setProperty(\n                 ConnectionParam.DEFAULT_USER_AGENT, ConnectionParam.DEFAULT_DEFAULT_USER_AGENT);\n+        updatePscanTagMailtoPattern(config);\n+    }\n+\n+    private static void updatePscanTagMailtoPattern(XMLConfiguration config) {\n+        String autoTagScannersKey = \"pscans.autoTagScanners.scanner\";\n+        List<HierarchicalConfiguration> tagScanners = config.configurationsAt(autoTagScannersKey);\n+        String badPattern = \"<.*href\\\\s*['\\\"]?mailto:\";\n+        String goodPattern = \"<.*href\\\\s*=['\\\"]?mailto:\";\n+\n+        for (int i = 0, size = tagScanners.size(); i < size; ++i) {\n+            String elementBaseKey = autoTagScannersKey + \"(\" + i + \").\";\n+            String currentKeyResBodyRegex = elementBaseKey + \"resBodyRegex\";", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "4af577ccb357517c8091a1b59fcee7db266fd5ee"}, "originalPosition": 32}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 641, "cost": 1, "resetAt": "2021-11-13T14:23:39Z"}}}