{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDE2NDQ3ODk5", "number": 5975, "title": "Alert API: Bulk Change Confidence or Risk - Fixes 5845", "bodyText": "Added API actions to bulk update Confidence or Risk based on a CSV string of alert IDs. Extracted some code to convenience methods which also lead to minor modification of code within deleteAlert and addAlert processing.\nFixes #5845\nSigned-off-by: kingthorin kingthorin@users.noreply.github.com", "createdAt": "2020-05-12T02:31:56Z", "url": "https://github.com/zaproxy/zaproxy/pull/5975", "merged": true, "mergeCommit": {"oid": "947473cc0daa73de7f69a1ff7fc436bb3c4f852f"}, "closed": true, "closedAt": "2020-05-12T14:32:12Z", "author": {"login": "kingthorin"}, "timelineItems": {"totalCount": 9, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcgg7L2AFqTQwOTg2NjMwMg==", "endCursor": "Y3Vyc29yOnYyOpPPAAABcglMwogFqTQxMDEwNDY1MA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDA5ODY2MzAy", "url": "https://github.com/zaproxy/zaproxy/pull/5975#pullrequestreview-409866302", "createdAt": "2020-05-12T09:32:30Z", "commit": {"oid": "7d7d42cc995bd1639e00218894b31d85ea68dfa2"}, "state": "COMMENTED", "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xMlQwOTozMjozMFrOGT-Sow==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xMlQwOTozMzoxMFrOGT-UmA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMzU5NjcwNw==", "bodyText": "I'd suggest collect them first to ensure all IDs are valid before starting processing the alerts (while missing alert will also lead to partial updates it's one less thing).\nThis can also be extracted, something like:\nupdateAlerts(alert -> alert.setConfidence(confidenceId));\nand let updateAlerts extract/loop the IDs and get/process the alerts.", "url": "https://github.com/zaproxy/zaproxy/pull/5975#discussion_r423596707", "createdAt": "2020-05-12T09:32:30Z", "author": {"login": "thc202"}, "path": "zap/src/main/java/org/zaproxy/zap/extension/alert/AlertAPI.java", "diffHunk": "@@ -402,6 +392,34 @@ public ApiResponse handleApiAction(String name, JSONObject params) throws ApiExc\n             newAlert.setWascId(wascId);\n             extension.alertFound(newAlert, msg.getHistoryRef());\n             return new ApiResponseElement(name, Integer.toString(newAlert.getAlertId()));\n+        }  else if (ACTION_UPDATE_ALERTS_CONFIDENCE.equals(name)) {\n+            String alertIds = ApiUtils.getNonEmptyStringParam(params, PARAM_ALERT_IDS);\n+            int confidenceId = getConfidenceId(params);\n+\n+            StringTokenizer tokenizer = new StringTokenizer(alertIds, \",\");\n+            while (tokenizer.hasMoreTokens()) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "7d7d42cc995bd1639e00218894b31d85ea68dfa2"}, "originalPosition": 112}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMzU5NzEyNw==", "bodyText": "Just Update the confidence of alerts.? To avoid repeating the description of the parameter (same for the other endpoint).", "url": "https://github.com/zaproxy/zaproxy/pull/5975#discussion_r423597127", "createdAt": "2020-05-12T09:33:04Z", "author": {"login": "thc202"}, "path": "zap/src/main/resources/org/zaproxy/zap/resources/Messages.properties", "diffHunk": "@@ -63,10 +63,17 @@ alert.api.action.updateAlert.param.references = The reference details for the al\n alert.api.action.updateAlert.param.evidence = The evidence associated with the alert.\n alert.api.action.updateAlert.param.cweId = The CWE identifier associated with the alert.\n alert.api.action.updateAlert.param.wascId = The WASC identifier associated with the alert.\n+alert.api.action.updateAlertsConfidence = Update the confidence of the alerts with the given IDs (comma separated values).", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "7d7d42cc995bd1639e00218894b31d85ea68dfa2"}, "originalPosition": 4}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMzU5NzIwOA==", "bodyText": "Double semicolon.", "url": "https://github.com/zaproxy/zaproxy/pull/5975#discussion_r423597208", "createdAt": "2020-05-12T09:33:10Z", "author": {"login": "thc202"}, "path": "zap/src/main/java/org/zaproxy/zap/extension/alert/AlertAPI.java", "diffHunk": "@@ -336,19 +342,7 @@ public ApiResponse handleApiAction(String name, JSONObject params) throws ApiExc\n             int cweId = getParam(params, PARAM_CWEID, 0);\n             int wascId = getParam(params, PARAM_WASCID, 0);\n \n-            RecordAlert recAlert;\n-            try {\n-                recAlert = Model.getSingleton().getDb().getTableAlert().read(alertId);\n-            } catch (DatabaseException e) {\n-                logger.error(e.getMessage(), e);\n-                throw new ApiException(ApiException.Type.INTERNAL_ERROR, e);\n-            }\n-\n-            if (recAlert == null) {\n-                throw new ApiException(ApiException.Type.DOES_NOT_EXIST, PARAM_ALERT_ID);\n-            }\n-\n-            Alert updatedAlert = new Alert(recAlert);\n+            Alert updatedAlert = getAlertFromDb(alertId, PARAM_ALERT_ID);;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "7d7d42cc995bd1639e00218894b31d85ea68dfa2"}, "originalPosition": 84}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "7d7d42cc995bd1639e00218894b31d85ea68dfa2", "author": {"user": {"login": "kingthorin", "name": "Rick M"}}, "url": "https://github.com/zaproxy/zaproxy/commit/7d7d42cc995bd1639e00218894b31d85ea68dfa2", "committedDate": "2020-05-12T02:31:24Z", "message": "Alert API: Bulk Change Confidence or Risk - Fixes 5845\n\nAdded API actions to bulk update Confidence or Risk based on a CSV\nstring of alert IDs. Extracted some code to convenience methods which\nalso lead to minor modification of code within deleteAlert and addAlert\nprocessing.\n\nSigned-off-by: kingthorin <kingthorin@users.noreply.github.com>"}, "afterCommit": {"oid": "6d10291bb737a495285dac1a8bc3cb52f874960c", "author": {"user": {"login": "kingthorin", "name": "Rick M"}}, "url": "https://github.com/zaproxy/zaproxy/commit/6d10291bb737a495285dac1a8bc3cb52f874960c", "committedDate": "2020-05-12T09:33:48Z", "message": "Alert API: Bulk Change Confidence or Risk - Fixes 5845\n\nAdded API actions to bulk update Confidence or Risk based on a CSV\nstring of alert IDs. Extracted some code to convenience methods which\nalso lead to minor modification of code within deleteAlert and addAlert\nprocessing.\n\nSigned-off-by: kingthorin <kingthorin@users.noreply.github.com>"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "6d10291bb737a495285dac1a8bc3cb52f874960c", "author": {"user": {"login": "kingthorin", "name": "Rick M"}}, "url": "https://github.com/zaproxy/zaproxy/commit/6d10291bb737a495285dac1a8bc3cb52f874960c", "committedDate": "2020-05-12T09:33:48Z", "message": "Alert API: Bulk Change Confidence or Risk - Fixes 5845\n\nAdded API actions to bulk update Confidence or Risk based on a CSV\nstring of alert IDs. Extracted some code to convenience methods which\nalso lead to minor modification of code within deleteAlert and addAlert\nprocessing.\n\nSigned-off-by: kingthorin <kingthorin@users.noreply.github.com>"}, "afterCommit": {"oid": "eba5745f0092c7625380de649766225b3476e7b8", "author": {"user": {"login": "kingthorin", "name": "Rick M"}}, "url": "https://github.com/zaproxy/zaproxy/commit/eba5745f0092c7625380de649766225b3476e7b8", "committedDate": "2020-05-12T10:18:47Z", "message": "Alert API: Bulk Change Confidence or Risk - Fixes 5845\n\nAdded API actions to bulk update Confidence or Risk based on a CSV\nstring of alert IDs. Extracted some code to convenience methods which\nalso lead to minor modification of code within deleteAlert and addAlert\nprocessing.\n\nSigned-off-by: kingthorin <kingthorin@users.noreply.github.com>"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "eba5745f0092c7625380de649766225b3476e7b8", "author": {"user": {"login": "kingthorin", "name": "Rick M"}}, "url": "https://github.com/zaproxy/zaproxy/commit/eba5745f0092c7625380de649766225b3476e7b8", "committedDate": "2020-05-12T10:18:47Z", "message": "Alert API: Bulk Change Confidence or Risk - Fixes 5845\n\nAdded API actions to bulk update Confidence or Risk based on a CSV\nstring of alert IDs. Extracted some code to convenience methods which\nalso lead to minor modification of code within deleteAlert and addAlert\nprocessing.\n\nSigned-off-by: kingthorin <kingthorin@users.noreply.github.com>"}, "afterCommit": {"oid": "a5ddf40520ff031ea595f0e86266f894c8db0f65", "author": {"user": {"login": "kingthorin", "name": "Rick M"}}, "url": "https://github.com/zaproxy/zaproxy/commit/a5ddf40520ff031ea595f0e86266f894c8db0f65", "committedDate": "2020-05-12T10:32:34Z", "message": "Alert API: Bulk Change Confidence or Risk - Fixes 5845\n\nAdded API actions to bulk update Confidence or Risk based on a CSV\nstring of alert IDs. Extracted some code to convenience methods which\nalso lead to minor modification of code within deleteAlert and addAlert\nprocessing.\n\nSigned-off-by: kingthorin <kingthorin@users.noreply.github.com>"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "a5ddf40520ff031ea595f0e86266f894c8db0f65", "author": {"user": {"login": "kingthorin", "name": "Rick M"}}, "url": "https://github.com/zaproxy/zaproxy/commit/a5ddf40520ff031ea595f0e86266f894c8db0f65", "committedDate": "2020-05-12T10:32:34Z", "message": "Alert API: Bulk Change Confidence or Risk - Fixes 5845\n\nAdded API actions to bulk update Confidence or Risk based on a CSV\nstring of alert IDs. Extracted some code to convenience methods which\nalso lead to minor modification of code within deleteAlert and addAlert\nprocessing.\n\nSigned-off-by: kingthorin <kingthorin@users.noreply.github.com>"}, "afterCommit": {"oid": "5a844cde47a95e125f2a24f021a2917b0f986a46", "author": {"user": {"login": "kingthorin", "name": "Rick M"}}, "url": "https://github.com/zaproxy/zaproxy/commit/5a844cde47a95e125f2a24f021a2917b0f986a46", "committedDate": "2020-05-12T10:38:24Z", "message": "Alert API: Bulk Change Confidence or Risk - Fixes 5845\n\nAdded API actions to bulk update Confidence or Risk based on a CSV\nstring of alert IDs. Extracted some code to convenience methods which\nalso lead to minor modification of code within deleteAlert and addAlert\nprocessing.\n\nSigned-off-by: kingthorin <kingthorin@users.noreply.github.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "2b93fcfd4631fa75d0411b5d23d3e769b444249d", "author": {"user": {"login": "kingthorin", "name": "Rick M"}}, "url": "https://github.com/zaproxy/zaproxy/commit/2b93fcfd4631fa75d0411b5d23d3e769b444249d", "committedDate": "2020-05-12T10:44:36Z", "message": "Alert API: Bulk Change Confidence or Risk - Fixes 5845\n\nAdded API actions to bulk update Confidence or Risk based on a CSV\nstring of alert IDs. Extracted some code to convenience methods which\nalso lead to minor modification of code within deleteAlert and addAlert\nprocessing.\n\nSigned-off-by: kingthorin <kingthorin@users.noreply.github.com>"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "5a844cde47a95e125f2a24f021a2917b0f986a46", "author": {"user": {"login": "kingthorin", "name": "Rick M"}}, "url": "https://github.com/zaproxy/zaproxy/commit/5a844cde47a95e125f2a24f021a2917b0f986a46", "committedDate": "2020-05-12T10:38:24Z", "message": "Alert API: Bulk Change Confidence or Risk - Fixes 5845\n\nAdded API actions to bulk update Confidence or Risk based on a CSV\nstring of alert IDs. Extracted some code to convenience methods which\nalso lead to minor modification of code within deleteAlert and addAlert\nprocessing.\n\nSigned-off-by: kingthorin <kingthorin@users.noreply.github.com>"}, "afterCommit": {"oid": "2b93fcfd4631fa75d0411b5d23d3e769b444249d", "author": {"user": {"login": "kingthorin", "name": "Rick M"}}, "url": "https://github.com/zaproxy/zaproxy/commit/2b93fcfd4631fa75d0411b5d23d3e769b444249d", "committedDate": "2020-05-12T10:44:36Z", "message": "Alert API: Bulk Change Confidence or Risk - Fixes 5845\n\nAdded API actions to bulk update Confidence or Risk based on a CSV\nstring of alert IDs. Extracted some code to convenience methods which\nalso lead to minor modification of code within deleteAlert and addAlert\nprocessing.\n\nSigned-off-by: kingthorin <kingthorin@users.noreply.github.com>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDEwMDgxNTQ1", "url": "https://github.com/zaproxy/zaproxy/pull/5975#pullrequestreview-410081545", "createdAt": "2020-05-12T14:09:54Z", "commit": {"oid": "2b93fcfd4631fa75d0411b5d23d3e769b444249d"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDEwMTA0NjUw", "url": "https://github.com/zaproxy/zaproxy/pull/5975#pullrequestreview-410104650", "createdAt": "2020-05-12T14:32:05Z", "commit": {"oid": "2b93fcfd4631fa75d0411b5d23d3e769b444249d"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 170, "cost": 1, "resetAt": "2021-11-02T10:47:05Z"}}}