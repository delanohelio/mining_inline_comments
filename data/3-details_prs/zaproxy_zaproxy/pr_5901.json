{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0Mzg5OTk4NzE3", "number": 5901, "title": " prevent adding empty/duplicated regex from UI", "bodyText": "Solve #5899\nRemove duplicated messages from Messages.properties", "createdAt": "2020-03-17T18:15:34Z", "url": "https://github.com/zaproxy/zaproxy/pull/5901", "merged": true, "mergeCommit": {"oid": "a9e4eafbdb6e2afb8a45c90247797604a6713b6e"}, "closed": true, "closedAt": "2020-04-02T13:41:45Z", "author": {"login": "khalil2535"}, "timelineItems": {"totalCount": 10, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcOnIa5gFqTM3NjMwMDMxMA==", "endCursor": "Y3Vyc29yOnYyOpPPAAABcTsgExAFqTM4NjQzNjcyNQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzc2MzAwMzEw", "url": "https://github.com/zaproxy/zaproxy/pull/5901#pullrequestreview-376300310", "createdAt": "2020-03-17T18:30:07Z", "commit": {"oid": "18b3f61012d14c0cdcc002c71fcd90371cef97f6"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xN1QxODozMDowN1rOF3o87Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xN1QxODozNjowNlrOF3pLJg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5Mzg4Njk1Nw==", "bodyText": "This is syntactically correct but it would be best to use curly braces for consistency", "url": "https://github.com/zaproxy/zaproxy/pull/5901#discussion_r393886957", "createdAt": "2020-03-17T18:30:07Z", "author": {"login": "kingthorin"}, "path": "zap/src/main/java/org/zaproxy/zap/view/MultipleRegexesOptionsPanel.java", "diffHunk": "@@ -212,8 +226,13 @@ protected void init() {\n         @Override\n         protected boolean validateFields() {\n             try {\n-                Pattern.compile(getRegexTextField().getText(), Pattern.CASE_INSENSITIVE);\n-            } catch (PatternSyntaxException e) {\n+                String trimmedRegex = getRegexTextField().getText().trim();\n+                if (trimmedRegex.trim().isEmpty()) return false; // to prevent accepting empty regex", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "18b3f61012d14c0cdcc002c71fcd90371cef97f6"}, "originalPosition": 64}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5Mzg4NzUyOA==", "bodyText": "Also why trim the trimmed value, is there a reason to apply it twice?", "url": "https://github.com/zaproxy/zaproxy/pull/5901#discussion_r393887528", "createdAt": "2020-03-17T18:31:02Z", "author": {"login": "kingthorin"}, "path": "zap/src/main/java/org/zaproxy/zap/view/MultipleRegexesOptionsPanel.java", "diffHunk": "@@ -212,8 +226,13 @@ protected void init() {\n         @Override\n         protected boolean validateFields() {\n             try {\n-                Pattern.compile(getRegexTextField().getText(), Pattern.CASE_INSENSITIVE);\n-            } catch (PatternSyntaxException e) {\n+                String trimmedRegex = getRegexTextField().getText().trim();\n+                if (trimmedRegex.trim().isEmpty()) return false; // to prevent accepting empty regex", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5Mzg4Njk1Nw=="}, "originalCommit": {"oid": "18b3f61012d14c0cdcc002c71fcd90371cef97f6"}, "originalPosition": 64}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5Mzg4OTYwMA==", "bodyText": "Why were these API keys/values removed?", "url": "https://github.com/zaproxy/zaproxy/pull/5901#discussion_r393889600", "createdAt": "2020-03-17T18:34:26Z", "author": {"login": "kingthorin"}, "path": "zap/src/main/resources/org/zaproxy/zap/resources/Messages.properties", "diffHunk": "@@ -223,9 +223,6 @@ api.options.addr.dialog.remove.text = Are you sure you want to remove the select\n api.options.addr.dialog.remove.button.cancel = Cancel\n api.options.addr.dialog.remove.button.confirm = Remove\n api.options.addr.dialog.remove.checkbox.label = Do not show this message again\n-api.options.addr.table.header.enabled\t= Enabled\n-api.options.addr.table.header.regex\t= Regex\n-api.options.addr.table.header.value\t= Address", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a48052f7638d2570016d4ad05ad1b3fce813cf93"}, "originalPosition": 6}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5Mzg5MDAyMQ==", "bodyText": "Why was this changed with no corresponding usage change?", "url": "https://github.com/zaproxy/zaproxy/pull/5901#discussion_r393890021", "createdAt": "2020-03-17T18:35:13Z", "author": {"login": "kingthorin"}, "path": "zap/src/main/resources/org/zaproxy/zap/resources/Messages.properties", "diffHunk": "@@ -1106,8 +1103,8 @@ cfu.update.message.resourcesNotSavedAndActiveActions = <html>There are unsaved r\n cfu.update.message.resourcesNotSaved   = <html>The following resources have not been saved:<ul>{0}</ul>The changes might be lost if the update fails. Continue with update?</html>\n cfu.warn.addon.with.extensions.with.missing.requirements = Optional Add-ons:\n cfu.warn.addon.with.missing.requirements = Missing Requirements:\n-cfu.warn.addon.with.missing.requirements.addon = A cyclic dependency was detected.\n cfu.warn.addon.with.missing.requirements.addon = Add-on \"{0}\"\n+cfu.warn.addon.with.missing.requirements.addon.cyclic = A cyclic dependency was detected.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a48052f7638d2570016d4ad05ad1b3fce813cf93"}, "originalPosition": 16}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5Mzg5MDU5OA==", "bodyText": "Please turn this into a proper sentence (caps and punctuation).", "url": "https://github.com/zaproxy/zaproxy/pull/5901#discussion_r393890598", "createdAt": "2020-03-17T18:36:06Z", "author": {"login": "kingthorin"}, "path": "zap/src/main/resources/org/zaproxy/zap/resources/Messages.properties", "diffHunk": "@@ -2115,6 +2112,7 @@ multiple.options.regexes.dialog.remove.regex.button.confirm = Remove\n multiple.options.regexes.dialog.remove.regex.checkbox.label = Do not show this message again\n multiple.options.regexes.dialog.regex.invalid.title = Invalid Regular Expression\n multiple.options.regexes.dialog.regex.invalid.text = The provided regular expression is not valid:\\n{0}\n+multiple.options.regexes.dialog.regex.invalid.alreadyExist.text = regular expression already exists", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a48052f7638d2570016d4ad05ad1b3fce813cf93"}, "originalPosition": 24}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzc2MzU2Mzk5", "url": "https://github.com/zaproxy/zaproxy/pull/5901#pullrequestreview-376356399", "createdAt": "2020-03-17T19:52:21Z", "commit": {"oid": "3a76ad940ff4c3d50d1620cd7a109509d252d6c8"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzgxMDc2NTM2", "url": "https://github.com/zaproxy/zaproxy/pull/5901#pullrequestreview-381076536", "createdAt": "2020-03-25T11:51:25Z", "commit": {"oid": "3a76ad940ff4c3d50d1620cd7a109509d252d6c8"}, "state": "COMMENTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yNVQxMTo1MToyNVrOF7Xifg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yNVQxMTo1Mzo0NFrOF7Xn-w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5Nzc5NTk2Ng==", "bodyText": "The description of the method could be tweaked as well. validateRegexs should be updated accordingly.\nThe empty should be lower case (same in the exception message).", "url": "https://github.com/zaproxy/zaproxy/pull/5901#discussion_r397795966", "createdAt": "2020-03-25T11:51:25Z", "author": {"login": "thc202"}, "path": "zap/src/main/java/org/zaproxy/zap/model/Context.java", "diffHunk": "@@ -343,17 +343,18 @@ private static void validateRegexs(List<String> regexs) {\n      * Validates that the given regular expression is not {@code null} nor invalid.\n      *\n      * @param regex the regular expression to be validated\n-     * @throws IllegalArgumentException if the regular expression is {@code null}.\n+     * @throws IllegalArgumentException if the regular expression is {@code null} or Empty.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "3a76ad940ff4c3d50d1620cd7a109509d252d6c8"}, "originalPosition": 5}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5Nzc5NzM3MQ==", "bodyText": "We should not use exceptions for normal/common control flow (when we can avoid it, they are expensive to create). This should show the dialogue and return.\nI'd suggest using other title (e.g. Duplicated Regular Expression) for the error and show without The provided regular expression is not valid:, seems unnecessary.", "url": "https://github.com/zaproxy/zaproxy/pull/5901#discussion_r397797371", "createdAt": "2020-03-25T11:53:44Z", "author": {"login": "thc202"}, "path": "zap/src/main/java/org/zaproxy/zap/view/MultipleRegexesOptionsPanel.java", "diffHunk": "@@ -212,8 +226,12 @@ protected void init() {\n         @Override\n         protected boolean validateFields() {\n             try {\n-                Pattern.compile(getRegexTextField().getText(), Pattern.CASE_INSENSITIVE);\n-            } catch (PatternSyntaxException e) {\n+                String trimmedRegex = getRegexTextField().getText().trim();\n+                if (regexes != null && regexes.contains(trimmedRegex)) {\n+                    throw new IllegalArgumentException(TEXT_ALREADY_EXIST_INVALID_REGEX_DIALOG);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "3a76ad940ff4c3d50d1620cd7a109509d252d6c8"}, "originalPosition": 65}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzgxMDgxMTUx", "url": "https://github.com/zaproxy/zaproxy/pull/5901#pullrequestreview-381081151", "createdAt": "2020-03-25T11:58:41Z", "commit": {"oid": "3a76ad940ff4c3d50d1620cd7a109509d252d6c8"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yNVQxMTo1ODo0MVrOF7XyDw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yNVQxMTo1ODo0MVrOF7XyDw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5Nzc5OTk1MQ==", "bodyText": "For consistency in what we accept/show we should also trim in performAction.", "url": "https://github.com/zaproxy/zaproxy/pull/5901#discussion_r397799951", "createdAt": "2020-03-25T11:58:41Z", "author": {"login": "thc202"}, "path": "zap/src/main/java/org/zaproxy/zap/view/MultipleRegexesOptionsPanel.java", "diffHunk": "@@ -212,8 +226,12 @@ protected void init() {\n         @Override\n         protected boolean validateFields() {\n             try {\n-                Pattern.compile(getRegexTextField().getText(), Pattern.CASE_INSENSITIVE);\n-            } catch (PatternSyntaxException e) {\n+                String trimmedRegex = getRegexTextField().getText().trim();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "3a76ad940ff4c3d50d1620cd7a109509d252d6c8"}, "originalPosition": 63}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzg0OTc1NTQz", "url": "https://github.com/zaproxy/zaproxy/pull/5901#pullrequestreview-384975543", "createdAt": "2020-03-31T17:59:59Z", "commit": {"oid": "91b354fb0902b86125297389c3bca52e4ef23b72"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0zMVQxNzo1OTo1OVrOF-hr5w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0zMVQxNzo1OTo1OVrOF-hr5w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMTEwNzk0Mw==", "bodyText": "This lost the catch and error message, was that on purpose?", "url": "https://github.com/zaproxy/zaproxy/pull/5901#discussion_r401107943", "createdAt": "2020-03-31T17:59:59Z", "author": {"login": "thc202"}, "path": "zap/src/main/java/org/zaproxy/zap/view/MultipleRegexesOptionsPanel.java", "diffHunk": "@@ -211,23 +227,23 @@ protected void init() {\n \n         @Override\n         protected boolean validateFields() {\n-            try {\n-                Pattern.compile(getRegexTextField().getText(), Pattern.CASE_INSENSITIVE);\n-            } catch (PatternSyntaxException e) {\n+            String trimmedRegex = getRegexTextField().getText().trim();\n+            if (regexes != null && regexes.contains(trimmedRegex)) {\n                 JOptionPane.showMessageDialog(\n                         this,\n-                        MessageFormat.format(TEXT_INVALID_REGEX_DIALOG, e.getLocalizedMessage()),\n-                        TITLE_INVALID_REGEX_DIALOG,\n+                        TEXT_ALREADY_EXIST_INVALID_REGEX_DIALOG,\n+                        TITLE_ALREADY_EXIST_INVALID_REGEX_DIALOG,\n                         JOptionPane.INFORMATION_MESSAGE);\n                 getRegexTextField().requestFocusInWindow();\n                 return false;\n             }\n+            Pattern.compile(trimmedRegex, Pattern.CASE_INSENSITIVE);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "91b354fb0902b86125297389c3bca52e4ef23b72"}, "originalPosition": 83}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzg0OTgzMjI4", "url": "https://github.com/zaproxy/zaproxy/pull/5901#pullrequestreview-384983228", "createdAt": "2020-03-31T18:10:36Z", "commit": {"oid": "91b354fb0902b86125297389c3bca52e4ef23b72"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0zMVQxODoxMDozN1rOF-iEnw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0zMVQxODoxMDozN1rOF-iEnw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMTExNDI3MQ==", "bodyText": "It will have to set the list each time (same for modify), it might change after constructing the dialogue.", "url": "https://github.com/zaproxy/zaproxy/pull/5901#discussion_r401114271", "createdAt": "2020-03-31T18:10:37Z", "author": {"login": "thc202"}, "path": "zap/src/main/java/org/zaproxy/zap/view/MultipleRegexesOptionsPanel.java", "diffHunk": "@@ -89,7 +87,7 @@ public void setRegexes(List<String> regexes) {\n     @Override\n     public String showAddDialogue() {\n         if (addDialog == null) {\n-            addDialog = new DialogAddRegex(owner);\n+            addDialog = new DialogAddRegex(owner, this.getRegexes());", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "91b354fb0902b86125297389c3bca52e4ef23b72"}, "originalPosition": 17}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f6efe1278838566f32c99a164fa2a4eedd60c76d", "author": {"user": {"login": "khalil2535", "name": "Mahmoud Khalil"}}, "url": "https://github.com/zaproxy/zaproxy/commit/f6efe1278838566f32c99a164fa2a4eedd60c76d", "committedDate": "2020-04-02T11:00:37Z", "message": "prevent adding empty/duplicated regex from UI\n\nSigned-off-by: mahmoud khalil <khalil2535@protonmail.com>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzg2NDI4Mjk2", "url": "https://github.com/zaproxy/zaproxy/pull/5901#pullrequestreview-386428296", "createdAt": "2020-04-02T13:32:16Z", "commit": {"oid": "f6efe1278838566f32c99a164fa2a4eedd60c76d"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzg2NDM0MjM4", "url": "https://github.com/zaproxy/zaproxy/pull/5901#pullrequestreview-386434238", "createdAt": "2020-04-02T13:38:51Z", "commit": {"oid": "f6efe1278838566f32c99a164fa2a4eedd60c76d"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzg2NDM2NzI1", "url": "https://github.com/zaproxy/zaproxy/pull/5901#pullrequestreview-386436725", "createdAt": "2020-04-02T13:41:31Z", "commit": {"oid": "f6efe1278838566f32c99a164fa2a4eedd60c76d"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 232, "cost": 1, "resetAt": "2021-11-02T10:47:05Z"}}}