{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDYyMjc4MzI5", "number": 6108, "title": "Add `IS_CONTAINERIZED` env var to containerized check", "bodyText": "Hi encountered a similar problem to #6080 when running ZAP on a Kubernetes cluster using containerd.\nI could not find a similar file for containerd, so I've added a more generalized solution, which sets a custom env var in the docker image build, this should then be present in all container runtimes.\nThis should allow the container to function correctly in all container runtimes, as it is not bound to a specific implementation.\nThis should also be able to replace the two existing checks (os.path.exists('/.dockerenv') or os.path.exists('/run/.containerenv')), as it should work for any container runtime.", "createdAt": "2020-08-03T16:31:40Z", "url": "https://github.com/zaproxy/zaproxy/pull/6108", "merged": true, "mergeCommit": {"oid": "c72c46cd6ba92a835d944331a4bcb3e6891c501b"}, "closed": true, "closedAt": "2020-08-06T10:19:35Z", "author": {"login": "J12934"}, "timelineItems": {"totalCount": 10, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABc7UqjuABqjM2MTY2OTY2OTg=", "endCursor": "Y3Vyc29yOnYyOpPPAAABc8NIEXgFqTQ2MjM5MTA3NA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "17ef4d1bbe32cb947778f0b61eea7dc75d2ef8c8", "author": {"user": {"login": "J12934", "name": "Jannik Hollenbach"}}, "url": "https://github.com/zaproxy/zaproxy/commit/17ef4d1bbe32cb947778f0b61eea7dc75d2ef8c8", "committedDate": "2020-08-03T16:27:19Z", "message": "Add `IS_CONTAINERIZED` env var to containerized check\n\nThis should allow the container to function correctly in all\ncontainer runtimes, as it is not bound to a specifc\nimplementation"}, "afterCommit": {"oid": "50e8143491e3860ce906923913752ffdfe2bdd24", "author": {"user": {"login": "J12934", "name": "Jannik Hollenbach"}}, "url": "https://github.com/zaproxy/zaproxy/commit/50e8143491e3860ce906923913752ffdfe2bdd24", "committedDate": "2020-08-03T16:32:00Z", "message": "Add `IS_CONTAINERIZED` env var to containerized check\n\nThis should allow the container to function correctly in all\ncontainer runtimes, as it is not bound to a specifc\nimplementation\n\nSigned-off-by: Jannik Hollenbach <13718901+J12934@users.noreply.github.com>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDYwMjM1OTk3", "url": "https://github.com/zaproxy/zaproxy/pull/6108#pullrequestreview-460235997", "createdAt": "2020-08-03T18:06:28Z", "commit": {"oid": "50e8143491e3860ce906923913752ffdfe2bdd24"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0wM1QxODowNjoyOFrOG7DlXQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0wM1QxODowNjoyOFrOG7DlXQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NDU3Nzg4NQ==", "bodyText": "This image does not use the Python scripts, does no harm either.", "url": "https://github.com/zaproxy/zaproxy/pull/6108#discussion_r464577885", "createdAt": "2020-08-03T18:06:28Z", "author": {"login": "thc202"}, "path": "docker/Dockerfile-bare", "diffHunk": "@@ -33,5 +33,6 @@ ENV PATH $JAVA_HOME/bin:/zap/:$PATH\n ENV ZAP_PATH /zap/zap.sh\n ENV HOME /home/zap/\n ENV ZAP_PORT 8080\n+ENV IS_CONTAINERIZED true", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "50e8143491e3860ce906923913752ffdfe2bdd24"}, "originalPosition": 4}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDYwMjM2MDQ2", "url": "https://github.com/zaproxy/zaproxy/pull/6108#pullrequestreview-460236046", "createdAt": "2020-08-03T18:06:34Z", "commit": {"oid": "50e8143491e3860ce906923913752ffdfe2bdd24"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDYwMjQ1MTcw", "url": "https://github.com/zaproxy/zaproxy/pull/6108#pullrequestreview-460245170", "createdAt": "2020-08-03T18:21:04Z", "commit": {"oid": "50e8143491e3860ce906923913752ffdfe2bdd24"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0wM1QxODoyMTowNFrOG7ECVg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0wM1QxODoyMTowNFrOG7ECVg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NDU4NTMwMg==", "bodyText": "Should this actually check the value? Can anyone foresee a scenario where someone might purposefully set it to false or some value other than true?", "url": "https://github.com/zaproxy/zaproxy/pull/6108#discussion_r464585302", "createdAt": "2020-08-03T18:21:04Z", "author": {"login": "kingthorin"}, "path": "docker/zap_common.py", "diffHunk": "@@ -244,7 +244,7 @@ def cp_to_docker(cid, file, dir):\n \n \n def running_in_docker():\n-    return os.path.exists('/.dockerenv') or os.path.exists('/run/.containerenv')\n+    return os.path.exists('/.dockerenv') or os.path.exists('/run/.containerenv') or os.environ.get(\"IS_CONTAINERIZED\") is not None", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "50e8143491e3860ce906923913752ffdfe2bdd24"}, "originalPosition": 5}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "8a79b9999ecd9d3fbc6dc35f9c35f033b5860e4d", "author": {"user": {"login": "J12934", "name": "Jannik Hollenbach"}}, "url": "https://github.com/zaproxy/zaproxy/commit/8a79b9999ecd9d3fbc6dc35f9c35f033b5860e4d", "committedDate": "2020-08-04T09:11:18Z", "message": "Add `IS_CONTAINERIZED` env var to containerized check\n\nThis should allow the container to function correctly in all\ncontainer runtimes, as it is not bound to a specifc\nimplementation\n\nSigned-off-by: Jannik Hollenbach <13718901+J12934@users.noreply.github.com>"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "50e8143491e3860ce906923913752ffdfe2bdd24", "author": {"user": {"login": "J12934", "name": "Jannik Hollenbach"}}, "url": "https://github.com/zaproxy/zaproxy/commit/50e8143491e3860ce906923913752ffdfe2bdd24", "committedDate": "2020-08-03T16:32:00Z", "message": "Add `IS_CONTAINERIZED` env var to containerized check\n\nThis should allow the container to function correctly in all\ncontainer runtimes, as it is not bound to a specifc\nimplementation\n\nSigned-off-by: Jannik Hollenbach <13718901+J12934@users.noreply.github.com>"}, "afterCommit": {"oid": "001eb9daaf4ee853dcc1b5222cf0700387c30ab4", "author": {"user": {"login": "J12934", "name": "Jannik Hollenbach"}}, "url": "https://github.com/zaproxy/zaproxy/commit/001eb9daaf4ee853dcc1b5222cf0700387c30ab4", "committedDate": "2020-08-04T09:11:52Z", "message": "Ensure that IS_CONTAINERIZED is actually set to true"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d69abfb13beaeb6118fdead43d3bb601969bacf8", "author": {"user": {"login": "J12934", "name": "Jannik Hollenbach"}}, "url": "https://github.com/zaproxy/zaproxy/commit/d69abfb13beaeb6118fdead43d3bb601969bacf8", "committedDate": "2020-08-04T09:12:37Z", "message": "Ensure that IS_CONTAINERIZED is actually set to true\n\nSigned-off-by: Jannik Hollenbach <13718901+J12934@users.noreply.github.com>"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "001eb9daaf4ee853dcc1b5222cf0700387c30ab4", "author": {"user": {"login": "J12934", "name": "Jannik Hollenbach"}}, "url": "https://github.com/zaproxy/zaproxy/commit/001eb9daaf4ee853dcc1b5222cf0700387c30ab4", "committedDate": "2020-08-04T09:11:52Z", "message": "Ensure that IS_CONTAINERIZED is actually set to true"}, "afterCommit": {"oid": "d69abfb13beaeb6118fdead43d3bb601969bacf8", "author": {"user": {"login": "J12934", "name": "Jannik Hollenbach"}}, "url": "https://github.com/zaproxy/zaproxy/commit/d69abfb13beaeb6118fdead43d3bb601969bacf8", "committedDate": "2020-08-04T09:12:37Z", "message": "Ensure that IS_CONTAINERIZED is actually set to true\n\nSigned-off-by: Jannik Hollenbach <13718901+J12934@users.noreply.github.com>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDYwNjk5NzI2", "url": "https://github.com/zaproxy/zaproxy/pull/6108#pullrequestreview-460699726", "createdAt": "2020-08-04T10:44:45Z", "commit": {"oid": "d69abfb13beaeb6118fdead43d3bb601969bacf8"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDYyMzkxMDc0", "url": "https://github.com/zaproxy/zaproxy/pull/6108#pullrequestreview-462391074", "createdAt": "2020-08-06T10:19:07Z", "commit": {"oid": "d69abfb13beaeb6118fdead43d3bb601969bacf8"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 197, "cost": 1, "resetAt": "2021-11-02T10:47:05Z"}}}