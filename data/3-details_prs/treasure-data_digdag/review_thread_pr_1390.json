{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDAwNjY1MDU1", "number": 1390, "reviewThreads": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wOVQwMzoxODozOVrODwPXMQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wOVQwNzozODo1MVrODwSjjQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjUxOTA5OTM3OnYy", "diffSide": "RIGHT", "path": "digdag-core/src/main/java/io/digdag/core/repository/ProjectControl.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wOVQwMzoxODozOVrOGDINSQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wOVQwNzowMTowMVrOGDL_aQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNTkzMzM4NQ==", "bodyText": "Just in case, if validation fail, updateSchedules() has been cancelled ?\nIf this method is only called in transaction and updateSchedules() has no side effect except Pg, I guess it is OK.", "url": "https://github.com/treasure-data/digdag/pull/1390#discussion_r405933385", "createdAt": "2020-04-09T03:18:39Z", "author": {"login": "yoyama"}, "path": "digdag-core/src/main/java/io/digdag/core/repository/ProjectControl.java", "diffHunk": "@@ -69,6 +71,7 @@ public void insertRevisionArchiveData(int revId, byte[] data)\n     {\n         List<StoredWorkflowDefinition> list = insertWorkflowDefinitionsWithoutSchedules(revision, defs);\n         updateSchedules(revision, list, srm, currentTime);\n+        validateSla(defs);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b7679b19f29ad528b4925b4c5d9fcfe4529e19d3"}, "originalPosition": 13}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNTk5NTM2OQ==", "bodyText": "Thank you for checking, I think I should move this before inserting actually, so I fixed it.\na1ea9c6", "url": "https://github.com/treasure-data/digdag/pull/1390#discussion_r405995369", "createdAt": "2020-04-09T07:01:01Z", "author": {"login": "naritta"}, "path": "digdag-core/src/main/java/io/digdag/core/repository/ProjectControl.java", "diffHunk": "@@ -69,6 +71,7 @@ public void insertRevisionArchiveData(int revId, byte[] data)\n     {\n         List<StoredWorkflowDefinition> list = insertWorkflowDefinitionsWithoutSchedules(revision, defs);\n         updateSchedules(revision, list, srm, currentTime);\n+        validateSla(defs);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNTkzMzM4NQ=="}, "originalCommit": {"oid": "b7679b19f29ad528b4925b4c5d9fcfe4529e19d3"}, "originalPosition": 13}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjUxOTU4NjE5OnYy", "diffSide": "RIGHT", "path": "digdag-tests/src/test/resources/acceptance/sla/invalid_config.dig", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wOVQwNzoyNzowNVrOGDMuhw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wOVQwNzoyNzowNVrOGDMuhw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNjAwNzQzMQ==", "bodyText": "Just in case. If sla contain both duration: and 'duration2:'  is it error ?\nI am not sure, but adding some test cases may be better.", "url": "https://github.com/treasure-data/digdag/pull/1390#discussion_r406007431", "createdAt": "2020-04-09T07:27:05Z", "author": {"login": "yoyama"}, "path": "digdag-tests/src/test/resources/acceptance/sla/invalid_config.dig", "diffHunk": "@@ -0,0 +1,7 @@\n+timezone: UTC\n+\n+sla:\n+  duration2: 00:00:05", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a1ea9c6584d5e08776adb5056851eaec415f0dc0"}, "originalPosition": 4}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjUxOTYyMjUzOnYy", "diffSide": "RIGHT", "path": "digdag-core/src/main/java/io/digdag/core/workflow/SlaCalculator.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wOVQwNzozODo1MVrOGDNE_A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wOVQwNzozODo1MVrOGDNE_A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNjAxMzE4MA==", "bodyText": "This exception is defined as package private.\nI am not sure how and where this exception is handled.\nIf it is only processed in same package, it is ok.", "url": "https://github.com/treasure-data/digdag/pull/1390#discussion_r406013180", "createdAt": "2020-04-09T07:38:51Z", "author": {"login": "yoyama"}, "path": "digdag-core/src/main/java/io/digdag/core/workflow/SlaCalculator.java", "diffHunk": "@@ -13,22 +17,53 @@\n import com.google.inject.Inject;\n import io.digdag.client.config.Config;\n import io.digdag.client.config.ConfigException;\n+import io.digdag.core.agent.CheckedConfig;\n+import io.digdag.core.agent.EditDistance;\n+import org.slf4j.Logger;\n+import org.slf4j.LoggerFactory;\n+\n import static java.util.Locale.ENGLISH;\n \n+class UnusedConfigException extends ConfigException", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a1ea9c6584d5e08776adb5056851eaec415f0dc0"}, "originalPosition": 24}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1195, "cost": 1, "resetAt": "2021-11-13T14:23:39Z"}}}