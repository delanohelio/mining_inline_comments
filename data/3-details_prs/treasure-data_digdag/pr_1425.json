{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDM5OTExODcw", "number": 1425, "title": "Mask debug message in \"evaluated config\"", "bodyText": "Mask \"evaluated config\" debug message except predefined keys.", "createdAt": "2020-06-25T09:54:44Z", "url": "https://github.com/treasure-data/digdag/pull/1425", "merged": true, "mergeCommit": {"oid": "ac13f6466dd4fb3b165794e2421ee944f508e606"}, "closed": true, "closedAt": "2020-07-05T08:30:02Z", "author": {"login": "yoyama"}, "timelineItems": {"totalCount": 7, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcu49vPgBqjM0ODQ3MDY5NjI=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcwg74egFqTQ0MDUwODIwMg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "bb47533839a5f2f1f54fe982f0ac7e29574952b2", "author": {"user": null}, "url": "https://github.com/treasure-data/digdag/commit/bb47533839a5f2f1f54fe982f0ac7e29574952b2", "committedDate": "2020-06-25T09:53:21Z", "message": "Mask \"evaluated config\" debug message."}, "afterCommit": {"oid": "4002d318f118f0f931784e029d667f436117e8b3", "author": {"user": null}, "url": "https://github.com/treasure-data/digdag/commit/4002d318f118f0f931784e029d667f436117e8b3", "committedDate": "2020-06-26T01:28:31Z", "message": "Mask \"evaluated config\" debug message."}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "4002d318f118f0f931784e029d667f436117e8b3", "author": {"user": null}, "url": "https://github.com/treasure-data/digdag/commit/4002d318f118f0f931784e029d667f436117e8b3", "committedDate": "2020-06-26T01:28:31Z", "message": "Mask \"evaluated config\" debug message."}, "afterCommit": {"oid": "4223b1078b3e45a0251ac79e31c7979e6b2d753d", "author": {"user": null}, "url": "https://github.com/treasure-data/digdag/commit/4223b1078b3e45a0251ac79e31c7979e6b2d753d", "committedDate": "2020-06-29T01:43:23Z", "message": "Mask \"evaluated config\" debug message."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "40109ad4e43159567c1e24046809e34c961b0474", "author": {"user": null}, "url": "https://github.com/treasure-data/digdag/commit/40109ad4e43159567c1e24046809e34c961b0474", "committedDate": "2020-06-29T03:16:19Z", "message": "Mask \"evaluated config\" debug message."}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "4223b1078b3e45a0251ac79e31c7979e6b2d753d", "author": {"user": null}, "url": "https://github.com/treasure-data/digdag/commit/4223b1078b3e45a0251ac79e31c7979e6b2d753d", "committedDate": "2020-06-29T01:43:23Z", "message": "Mask \"evaluated config\" debug message."}, "afterCommit": {"oid": "40109ad4e43159567c1e24046809e34c961b0474", "author": {"user": null}, "url": "https://github.com/treasure-data/digdag/commit/40109ad4e43159567c1e24046809e34c961b0474", "committedDate": "2020-06-29T03:16:19Z", "message": "Mask \"evaluated config\" debug message."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDQwNTA0MTM1", "url": "https://github.com/treasure-data/digdag/pull/1425#pullrequestreview-440504135", "createdAt": "2020-07-01T02:21:06Z", "commit": {"oid": "40109ad4e43159567c1e24046809e34c961b0474"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wMVQwMjoyMTowNlrOGrUlDg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wMVQwMjoyMTowNlrOGrUlDg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0ODA3OTExOA==", "bodyText": "Config.set() just shares the reference to the values without copying data and won't consume memory a lot. Looks good.", "url": "https://github.com/treasure-data/digdag/pull/1425#discussion_r448079118", "createdAt": "2020-07-01T02:21:06Z", "author": {"login": "komamitsu"}, "path": "digdag-core/src/main/java/io/digdag/core/agent/OperatorManager.java", "diffHunk": "@@ -388,4 +387,30 @@ public static void collectExceptionMessage(StringBuilder sb, Throwable ex, Strin\n             collectExceptionMessage(sb, t, used);\n         }\n     }\n+\n+    private static final String[] CONFIG_KEYS_FOR_LOGGING = {\n+            \"project_id\",\n+            \"session_id\",\n+            \"session_time\",\n+            \"attempt_id\",\n+            \"task_name\",\n+            \"last_session_time\",\n+            \"last_executed_session_time\",\n+            \"next_session_time\",\n+            \"session_uuid\",\n+            \"timezone\"\n+    };\n+\n+    @VisibleForTesting\n+    public Config filterConfigForLogging(Config src)\n+    {\n+        Config dst = cf.create();\n+        for (String key : CONFIG_KEYS_FOR_LOGGING) {\n+            Optional<Object> v = src.getOptional(key, Object.class);\n+            if (v.isPresent()) {\n+                dst.set(key, v.get());", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "40109ad4e43159567c1e24046809e34c961b0474"}, "originalPosition": 50}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDQwNTA0MTc4", "url": "https://github.com/treasure-data/digdag/pull/1425#pullrequestreview-440504178", "createdAt": "2020-07-01T02:21:16Z", "commit": {"oid": "40109ad4e43159567c1e24046809e34c961b0474"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDQwNTA4MjAy", "url": "https://github.com/treasure-data/digdag/pull/1425#pullrequestreview-440508202", "createdAt": "2020-07-01T02:35:22Z", "commit": {"oid": "40109ad4e43159567c1e24046809e34c961b0474"}, "state": "APPROVED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wMVQwMjozNToyMlrOGrUykw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wMVQwMjozNToyMlrOGrUykw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0ODA4MjU3OQ==", "bodyText": "How about adding session_unixtime  as well? I think it's good to have it.", "url": "https://github.com/treasure-data/digdag/pull/1425#discussion_r448082579", "createdAt": "2020-07-01T02:35:22Z", "author": {"login": "szyn"}, "path": "digdag-core/src/main/java/io/digdag/core/agent/OperatorManager.java", "diffHunk": "@@ -388,4 +387,30 @@ public static void collectExceptionMessage(StringBuilder sb, Throwable ex, Strin\n             collectExceptionMessage(sb, t, used);\n         }\n     }\n+\n+    private static final String[] CONFIG_KEYS_FOR_LOGGING = {\n+            \"project_id\",\n+            \"session_id\",\n+            \"session_time\",", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "40109ad4e43159567c1e24046809e34c961b0474"}, "originalPosition": 33}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4033, "cost": 1, "resetAt": "2021-11-01T16:37:27Z"}}}