{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDAwNjY1MDU1", "number": 1390, "title": "Add validation for sla operator", "bodyText": "For now, there is no validation for pushing workflows with sla.\nThis PR validation for sla operator.", "createdAt": "2020-04-08T06:59:29Z", "url": "https://github.com/treasure-data/digdag/pull/1390", "merged": true, "mergeCommit": {"oid": "98a45019e84f7a27a5afe404240fd9419176333a"}, "closed": true, "closedAt": "2020-04-13T08:56:38Z", "author": {"login": "naritta"}, "timelineItems": {"totalCount": 6, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcVzyWpgFqTM5MDQ2NTY0MA==", "endCursor": "Y3Vyc29yOnYyOpPPAAABcXILP4ABqjMyMjU5OTk2NzI=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzkwNDY1NjQw", "url": "https://github.com/treasure-data/digdag/pull/1390#pullrequestreview-390465640", "createdAt": "2020-04-09T03:18:39Z", "commit": {"oid": "b7679b19f29ad528b4925b4c5d9fcfe4529e19d3"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wOVQwMzoxODozOVrOGDINSQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wOVQwMzoxODozOVrOGDINSQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNTkzMzM4NQ==", "bodyText": "Just in case, if validation fail, updateSchedules() has been cancelled ?\nIf this method is only called in transaction and updateSchedules() has no side effect except Pg, I guess it is OK.", "url": "https://github.com/treasure-data/digdag/pull/1390#discussion_r405933385", "createdAt": "2020-04-09T03:18:39Z", "author": {"login": "yoyama"}, "path": "digdag-core/src/main/java/io/digdag/core/repository/ProjectControl.java", "diffHunk": "@@ -69,6 +71,7 @@ public void insertRevisionArchiveData(int revId, byte[] data)\n     {\n         List<StoredWorkflowDefinition> list = insertWorkflowDefinitionsWithoutSchedules(revision, defs);\n         updateSchedules(revision, list, srm, currentTime);\n+        validateSla(defs);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b7679b19f29ad528b4925b4c5d9fcfe4529e19d3"}, "originalPosition": 13}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzkwNTUwMjEz", "url": "https://github.com/treasure-data/digdag/pull/1390#pullrequestreview-390550213", "createdAt": "2020-04-09T07:27:05Z", "commit": {"oid": "a1ea9c6584d5e08776adb5056851eaec415f0dc0"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wOVQwNzoyNzowNVrOGDMuhw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wOVQwNzoyNzowNVrOGDMuhw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNjAwNzQzMQ==", "bodyText": "Just in case. If sla contain both duration: and 'duration2:'  is it error ?\nI am not sure, but adding some test cases may be better.", "url": "https://github.com/treasure-data/digdag/pull/1390#discussion_r406007431", "createdAt": "2020-04-09T07:27:05Z", "author": {"login": "yoyama"}, "path": "digdag-tests/src/test/resources/acceptance/sla/invalid_config.dig", "diffHunk": "@@ -0,0 +1,7 @@\n+timezone: UTC\n+\n+sla:\n+  duration2: 00:00:05", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a1ea9c6584d5e08776adb5056851eaec415f0dc0"}, "originalPosition": 4}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzkwNTU3Mjk2", "url": "https://github.com/treasure-data/digdag/pull/1390#pullrequestreview-390557296", "createdAt": "2020-04-09T07:38:51Z", "commit": {"oid": "a1ea9c6584d5e08776adb5056851eaec415f0dc0"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wOVQwNzozODo1MVrOGDNE_A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wOVQwNzozODo1MVrOGDNE_A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNjAxMzE4MA==", "bodyText": "This exception is defined as package private.\nI am not sure how and where this exception is handled.\nIf it is only processed in same package, it is ok.", "url": "https://github.com/treasure-data/digdag/pull/1390#discussion_r406013180", "createdAt": "2020-04-09T07:38:51Z", "author": {"login": "yoyama"}, "path": "digdag-core/src/main/java/io/digdag/core/workflow/SlaCalculator.java", "diffHunk": "@@ -13,22 +17,53 @@\n import com.google.inject.Inject;\n import io.digdag.client.config.Config;\n import io.digdag.client.config.ConfigException;\n+import io.digdag.core.agent.CheckedConfig;\n+import io.digdag.core.agent.EditDistance;\n+import org.slf4j.Logger;\n+import org.slf4j.LoggerFactory;\n+\n import static java.util.Locale.ENGLISH;\n \n+class UnusedConfigException extends ConfigException", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a1ea9c6584d5e08776adb5056851eaec415f0dc0"}, "originalPosition": 24}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzkwNTU3NTQ4", "url": "https://github.com/treasure-data/digdag/pull/1390#pullrequestreview-390557548", "createdAt": "2020-04-09T07:39:15Z", "commit": {"oid": "a1ea9c6584d5e08776adb5056851eaec415f0dc0"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "863bf67131c258af80eaac49a46250dc77460170", "author": {"user": {"login": "naritta", "name": "Ritta Narita"}}, "url": "https://github.com/treasure-data/digdag/commit/863bf67131c258af80eaac49a46250dc77460170", "committedDate": "2020-04-13T05:37:42Z", "message": "Add validation for sla operator"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "a1ea9c6584d5e08776adb5056851eaec415f0dc0", "author": {"user": {"login": "naritta", "name": "Ritta Narita"}}, "url": "https://github.com/treasure-data/digdag/commit/a1ea9c6584d5e08776adb5056851eaec415f0dc0", "committedDate": "2020-04-09T06:59:50Z", "message": "insert validation before updating db"}, "afterCommit": {"oid": "863bf67131c258af80eaac49a46250dc77460170", "author": {"user": {"login": "naritta", "name": "Ritta Narita"}}, "url": "https://github.com/treasure-data/digdag/commit/863bf67131c258af80eaac49a46250dc77460170", "committedDate": "2020-04-13T05:37:42Z", "message": "Add validation for sla operator"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4128, "cost": 1, "resetAt": "2021-11-01T16:37:27Z"}}}