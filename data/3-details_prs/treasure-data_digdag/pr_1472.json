{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTExOTc2OTU1", "number": 1472, "title": "Introduce debug logs to leave the request and response contents of ECS task submission", "bodyText": "What does this PR change?\nThis PR introduces debug logs for EcsCommandExecutor to show the contents of request/response of a submitted task.\nBackground\nWhen we faced error responses (4xx) from AWS ECS API, we can not inspect what parameters are included in the request that  EcsCommandExecutor sent.\nThis PR shows the contents for request/response from AWS ECS API to do that.", "createdAt": "2020-10-29T03:03:04Z", "url": "https://github.com/treasure-data/digdag/pull/1472", "merged": true, "mergeCommit": {"oid": "ff787dc9ff9254f07a305ff21e637b878065f2a9"}, "closed": true, "closedAt": "2020-10-29T07:47:08Z", "author": {"login": "serihiro"}, "timelineItems": {"totalCount": 7, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdXK4NCABqjM5MzQ0NDY1MzI=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdXNNniAFqTUxOTM5OTIzNA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "1557e9b6b8e853aaa767cf85e9a345a1a9b93301", "author": {"user": null}, "url": "https://github.com/treasure-data/digdag/commit/1557e9b6b8e853aaa767cf85e9a345a1a9b93301", "committedDate": "2020-10-29T02:50:41Z", "message": "Introduce debug logs\nto leave the request and response contents of ECS task submission"}, "afterCommit": {"oid": "4d130e956a38f60eb7c2dfaf7a1c34f085639a2d", "author": {"user": null}, "url": "https://github.com/treasure-data/digdag/commit/4d130e956a38f60eb7c2dfaf7a1c34f085639a2d", "committedDate": "2020-10-29T04:57:48Z", "message": "Introduce debug logs\nto leave the request and response contents of ECS task submission"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "27c3ea32c24ac16a67146795bae4e1228f92ce85", "author": {"user": null}, "url": "https://github.com/treasure-data/digdag/commit/27c3ea32c24ac16a67146795bae4e1228f92ce85", "committedDate": "2020-10-29T05:23:59Z", "message": "Introduce debug logs\nto leave the request and response contents of ECS task submission"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "4d130e956a38f60eb7c2dfaf7a1c34f085639a2d", "author": {"user": null}, "url": "https://github.com/treasure-data/digdag/commit/4d130e956a38f60eb7c2dfaf7a1c34f085639a2d", "committedDate": "2020-10-29T04:57:48Z", "message": "Introduce debug logs\nto leave the request and response contents of ECS task submission"}, "afterCommit": {"oid": "27c3ea32c24ac16a67146795bae4e1228f92ce85", "author": {"user": null}, "url": "https://github.com/treasure-data/digdag/commit/27c3ea32c24ac16a67146795bae4e1228f92ce85", "committedDate": "2020-10-29T05:23:59Z", "message": "Introduce debug logs\nto leave the request and response contents of ECS task submission"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTE5MzUxODQ2", "url": "https://github.com/treasure-data/digdag/pull/1472#pullrequestreview-519351846", "createdAt": "2020-10-29T05:58:47Z", "commit": {"oid": "27c3ea32c24ac16a67146795bae4e1228f92ce85"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yOVQwNTo1ODo0OFrOHqMEKQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yOVQwNTo1ODo0OFrOHqMEKQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMzk5OTkxMw==", "bodyText": "why not static method?", "url": "https://github.com/treasure-data/digdag/pull/1472#discussion_r513999913", "createdAt": "2020-10-29T05:58:48Z", "author": {"login": "myui"}, "path": "digdag-standards/src/main/java/io/digdag/standards/command/EcsCommandExecutor.java", "diffHunk": "@@ -797,4 +799,50 @@ protected void setCapacityProviderStrategy(final EcsClientConfig clientConfig, f\n             request.setCapacityProviderStrategy(Arrays.asList(capacityProviderStrategyItem));\n         }\n     }\n+\n+    private String dumpTaskRequest(final RunTaskRequest request)", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "27c3ea32c24ac16a67146795bae4e1228f92ce85"}, "originalPosition": 24}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTE5MzUyMDE5", "url": "https://github.com/treasure-data/digdag/pull/1472#pullrequestreview-519352019", "createdAt": "2020-10-29T05:59:20Z", "commit": {"oid": "27c3ea32c24ac16a67146795bae4e1228f92ce85"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yOVQwNTo1OToyMFrOHqMFUA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yOVQwNTo1OToyMFrOHqMFUA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNDAwMDIwOA==", "bodyText": "ditto. static method.", "url": "https://github.com/treasure-data/digdag/pull/1472#discussion_r514000208", "createdAt": "2020-10-29T05:59:20Z", "author": {"login": "myui"}, "path": "digdag-standards/src/main/java/io/digdag/standards/command/EcsCommandExecutor.java", "diffHunk": "@@ -797,4 +799,50 @@ protected void setCapacityProviderStrategy(final EcsClientConfig clientConfig, f\n             request.setCapacityProviderStrategy(Arrays.asList(capacityProviderStrategyItem));\n         }\n     }\n+\n+    private String dumpTaskRequest(final RunTaskRequest request)\n+    {\n+        final StringBuilder sb = new StringBuilder();\n+        sb.append(\"{\");\n+        if (request.getCluster() != null) { sb.append(\"Cluster: \").append(request.getCluster()).append(\",\"); }\n+        if (request.getTaskDefinition() != null) { sb.append(\"TaskDefinition: \").append(request.getTaskDefinition()).append(\",\"); }\n+        if (request.getLaunchType() != null) { sb.append(\"LaunchType: \").append(request.getLaunchType()).append(\",\"); }\n+        if (request.getCapacityProviderStrategy() != null) { sb.append(\"CapacityProviderStrategy: \").append(request.getCapacityProviderStrategy()).append(\",\"); }\n+        if (request.getPlacementConstraints() != null) { sb.append(\"PlacementConstraints: \").append(request.getPlacementConstraints()).append(\",\"); }\n+        if (request.getPlacementStrategy() != null) { sb.append(\"PlacementStrategy: \").append(request.getPlacementStrategy()).append(\",\"); }\n+        if (request.getPlatformVersion() != null) { sb.append(\"PlatformVersion: \").append(request.getPlatformVersion()).append(\",\"); }\n+        TaskOverride overrides = request.getOverrides();\n+        if (overrides != null) {\n+            if (overrides.getCpu() != null) {\n+                sb.append(\"CPU: \").append(overrides.getCpu()).append(\",\");\n+            }\n+\n+            if (overrides.getCpu() != null) {\n+                sb.append(\"Memory: \").append(overrides.getMemory());\n+            }\n+        }\n+        sb.append(\"}\");\n+        return sb.toString();\n+    }\n+\n+    private String dumpTaskResult(final RunTaskResult result)", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "27c3ea32c24ac16a67146795bae4e1228f92ce85"}, "originalPosition": 49}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "75ccbff14b7b3742b11ea3f9c967be06adc92a50", "author": {"user": null}, "url": "https://github.com/treasure-data/digdag/commit/75ccbff14b7b3742b11ea3f9c967be06adc92a50", "committedDate": "2020-10-29T06:53:52Z", "message": "Make stateless methods to static"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTE5Mzk5MjM0", "url": "https://github.com/treasure-data/digdag/pull/1472#pullrequestreview-519399234", "createdAt": "2020-10-29T07:41:08Z", "commit": {"oid": "75ccbff14b7b3742b11ea3f9c967be06adc92a50"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4070, "cost": 1, "resetAt": "2021-11-01T16:37:27Z"}}}