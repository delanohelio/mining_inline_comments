{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDY3MzMyNDA3", "number": 1444, "reviewThreads": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xNFQwODowMzoxNlrOEYYDXA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yOFQwNzoxMTo0M1rOEdgJ9g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjkzOTk1MzU2OnYy", "diffSide": "RIGHT", "path": "digdag-docs/src/operators/td.md", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xNFQwODowMzoxNlrOHArXVg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xNFQwODowMzoxNlrOHArXVg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MDQ3MjUzNA==", "bodyText": "Can you describe the priority order of existing engine_version and this one?", "url": "https://github.com/treasure-data/digdag/pull/1444#discussion_r470472534", "createdAt": "2020-08-14T08:03:16Z", "author": {"login": "komamitsu"}, "path": "digdag-docs/src/operators/td.md", "diffHunk": "@@ -277,6 +277,28 @@ When you set those parameters, use [digdag secrets command](https://docs.digdag.\n   engine_version: stable\n   ```\n \n+* **hive_engine_version**: NAME\n+\n+  Specify engine version for Hive.\n+\n+  Examples:\n+\n+  ```\n+  engine: hive\n+  hive_engine_version: stable", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "0081d86c65963dab82eea44c97ac1db96c410e86"}, "originalPosition": 12}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjkzOTk1NDI0OnYy", "diffSide": "RIGHT", "path": "digdag-docs/src/operators/td.md", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xNFQwODowMzozMFrOHArXwA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xNFQwODowMzozMFrOHArXwA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MDQ3MjY0MA==", "bodyText": "Same as above", "url": "https://github.com/treasure-data/digdag/pull/1444#discussion_r470472640", "createdAt": "2020-08-14T08:03:30Z", "author": {"login": "komamitsu"}, "path": "digdag-docs/src/operators/td.md", "diffHunk": "@@ -277,6 +277,28 @@ When you set those parameters, use [digdag secrets command](https://docs.digdag.\n   engine_version: stable\n   ```\n \n+* **hive_engine_version**: NAME\n+\n+  Specify engine version for Hive.\n+\n+  Examples:\n+\n+  ```\n+  engine: hive\n+  hive_engine_version: stable\n+  ```\n+\n+* **presto_engine_version**: NAME", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "0081d86c65963dab82eea44c97ac1db96c410e86"}, "originalPosition": 15}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjkzOTk2MjIwOnYy", "diffSide": "RIGHT", "path": "digdag-standards/src/test/java/io/digdag/standards/operator/td/TdOperatorFactoryTest.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xNFQwODowNjowOVrOHArcng==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xNFQwODowNjowOVrOHArcng==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MDQ3Mzg4Ng==", "bodyText": "How about adding engine_version to check the new parameter expectedly overrides it?", "url": "https://github.com/treasure-data/digdag/pull/1444#discussion_r470473886", "createdAt": "2020-08-14T08:06:09Z", "author": {"login": "komamitsu"}, "path": "digdag-standards/src/test/java/io/digdag/standards/operator/td/TdOperatorFactoryTest.java", "diffHunk": "@@ -101,6 +101,56 @@ public void testTDJobRequestParamsWithEngineVersion()\n         assertEquals(\"stable\", jobRequest.getEngineVersion().get().toString());\n     }\n \n+    @Test\n+    public void testTDJobRequestParamsWithHiveEngineVersion()\n+            throws Exception\n+    {\n+        Path projectPath = Paths.get(\"\").normalize().toAbsolutePath();\n+\n+        Config config = newConfig()\n+                .set(\"database\", \"testdb\")\n+                .set(\"query\", \"select 1\")\n+                .set(\"engine\", \"hive\")\n+                .set(\"hive_engine_version\", \"stable\")", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "0081d86c65963dab82eea44c97ac1db96c410e86"}, "originalPosition": 14}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjk5MzcwOTk4OnYy", "diffSide": "RIGHT", "path": "digdag-standards/src/test/java/io/digdag/standards/operator/td/TdForEachOperatorFactoryTest.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yOFQwNzoxMTo0M1rOHIsKtA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yOFQwNzoxMTo0M1rOHIsKtA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3ODg3NDI5Mg==", "bodyText": "\ud83d\udcaf", "url": "https://github.com/treasure-data/digdag/pull/1444#discussion_r478874292", "createdAt": "2020-08-28T07:11:43Z", "author": {"login": "komamitsu"}, "path": "digdag-standards/src/test/java/io/digdag/standards/operator/td/TdForEachOperatorFactoryTest.java", "diffHunk": "@@ -82,6 +82,83 @@ public void testTDJobRequestParamsWithEngineVersion()\n         assertEquals(\"stable\", jobRequest.getEngineVersion().get().toString());\n     }\n \n+    @Test\n+    public void testTDJobRequestParamsWithHiveEngineVersion()\n+            throws Exception\n+    {\n+        Path projectPath = Paths.get(\"\").normalize().toAbsolutePath();\n+\n+        Config config = newConfig()\n+                .set(\"database\", \"testdb\")\n+                .set(\"query\", \"select 1\")\n+                .set(\"engine\", \"hive\")\n+                .set(\"hive_engine_version\", \"stable\")\n+                .set(\"_do\", newConfig().set(\"+show\", newConfig().set(\"echo>\", \"aaaa\")));\n+\n+        when(op.submitNewJobWithRetry(any(TDJobRequest.class))).thenReturn(\"\");\n+        when(op.getDatabase()).thenReturn(\"testdb\");\n+\n+        TDJobRequest jobRequest = testTDJobRequestParams(projectPath, config);\n+\n+        assertEquals(\"testdb\", jobRequest.getDatabase());\n+        assertEquals(\"select 1\", jobRequest.getQuery());\n+        assertEquals(\"hive\", jobRequest.getType().toString());\n+        assertTrue(jobRequest.getEngineVersion().isPresent());\n+        assertEquals(\"stable\", jobRequest.getEngineVersion().get().toString());\n+    }\n+\n+    @Test\n+    public void testHiveEngineVersionOverridesEngineVersion()\n+            throws Exception\n+    {\n+        Path projectPath = Paths.get(\"\").normalize().toAbsolutePath();\n+\n+        Config config = newConfig()\n+                .set(\"database\", \"testdb\")\n+                .set(\"query\", \"select 1\")\n+                .set(\"engine\", \"hive\")\n+                .set(\"engine_version\", \"stable\")\n+                .set(\"hive_engine_version\", \"current\")\n+                .set(\"_do\", newConfig().set(\"+show\", newConfig().set(\"echo>\", \"aaaa\")));\n+\n+        when(op.submitNewJobWithRetry(any(TDJobRequest.class))).thenReturn(\"\");\n+        when(op.getDatabase()).thenReturn(\"testdb\");\n+\n+        TDJobRequest jobRequest = testTDJobRequestParams(projectPath, config);\n+\n+        assertEquals(\"testdb\", jobRequest.getDatabase());\n+        assertEquals(\"select 1\", jobRequest.getQuery());\n+        assertEquals(\"hive\", jobRequest.getType().toString());\n+        assertTrue(jobRequest.getEngineVersion().isPresent());\n+        assertEquals(\"current\", jobRequest.getEngineVersion().get().toString());\n+    }\n+\n+    @Test\n+    public void testHiveEngineVersionNotOverridesEngineVersionIfEngineIsPresto()", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "5cea4f05b5ab3efe5c8daeb92a7af446b5711769"}, "originalPosition": 56}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1143, "cost": 1, "resetAt": "2021-11-13T14:23:39Z"}}}