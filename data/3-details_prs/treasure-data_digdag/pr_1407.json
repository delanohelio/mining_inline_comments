{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDE4Mzg3NDE3", "number": 1407, "title": "Use GitHub Actions instead of Travis CI and improve the CI test itself", "bodyText": "We've used Travis CI for CI testing, but it takes more than 40 minutes. I guess it's due to insufficient parallelism and so on. Github Actions is now available and I think we can take advantage of its parallelism and resources.\nThis pull request contains the following changes:\n\nRun CI tests on Github Actions\nStop using Travis CI\nCI test performance improvements\n\nAvoid running duplicated tests\nAvoid unnecessary UI builds as much as possible\n\n\nRemove a static analysis that hasn't worked recently\n\nWe'll revisit static analysis on CI later to improve the quality of source code", "createdAt": "2020-05-15T05:39:38Z", "url": "https://github.com/treasure-data/digdag/pull/1407", "merged": true, "mergeCommit": {"oid": "d1de1e0581cbcc93ebc45bc232c1a28c0fa29698"}, "closed": true, "closedAt": "2020-07-22T03:47:31Z", "author": {"login": "komamitsu"}, "timelineItems": {"totalCount": 21, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcfNMqiAH2gAyNDE4Mzg3NDE3OjljZmE0ODQwMmZhMjAzODMxZTFmMjI4NWJiNDkxMzM0NTU2YzdjN2I=", "endCursor": "Y3Vyc29yOnYyOpPPAAABc3A_yBgH2gAyNDE4Mzg3NDE3Ojg5ZjM5MDUxOTVmMTQwZGZmZmI2ZjI2MTAzYzAwNTg4YThjNjNmMDk=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "9cfa48402fa203831e1f2285bb491334556c7c7b", "author": {"user": {"login": "komamitsu", "name": "Mitsunori Komatsu"}}, "url": "https://github.com/treasure-data/digdag/commit/9cfa48402fa203831e1f2285bb491334556c7c7b", "committedDate": "2020-05-08T08:00:20Z", "message": "Create ci.yml"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "20443650db3f5c29085a8a94869b5b750ceca793", "author": {"user": {"login": "komamitsu", "name": "Mitsunori Komatsu"}}, "url": "https://github.com/treasure-data/digdag/commit/20443650db3f5c29085a8a94869b5b750ceca793", "committedDate": "2020-05-08T08:39:30Z", "message": "Update ci.yml"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ef4f1fe6abf8564e9be1f803bcec1b85d375176c", "author": {"user": {"login": "komamitsu", "name": "Mitsunori Komatsu"}}, "url": "https://github.com/treasure-data/digdag/commit/ef4f1fe6abf8564e9be1f803bcec1b85d375176c", "committedDate": "2020-05-08T09:26:04Z", "message": "Show stacktrace in docker run"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ebb05f2ae4d16e0e6caa0270ffd0290e4866d91d", "author": {"user": {"login": "komamitsu", "name": "Mitsunori Komatsu"}}, "url": "https://github.com/treasure-data/digdag/commit/ebb05f2ae4d16e0e6caa0270ffd0290e4866d91d", "committedDate": "2020-05-08T12:52:50Z", "message": "Update ci.yml"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "49bc667ba5e13be9bb728ba8d719d610d74a9903", "author": {"user": {"login": "komamitsu", "name": "Mitsunori Komatsu"}}, "url": "https://github.com/treasure-data/digdag/commit/49bc667ba5e13be9bb728ba8d719d610d74a9903", "committedDate": "2020-05-08T13:37:07Z", "message": "Correct a description about CI_ACCEPTANCE_TEST"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "8399642dd7e487d326eedb6ad7489ed06275db23", "author": {"user": {"login": "komamitsu", "name": "Mitsunori Komatsu"}}, "url": "https://github.com/treasure-data/digdag/commit/8399642dd7e487d326eedb6ad7489ed06275db23", "committedDate": "2020-05-08T13:37:59Z", "message": "Tweak Github Actions workflow config"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "5df1f42707feb7de8f9e8013b7273a59a5e1a38c", "author": {"user": {"login": "komamitsu", "name": "Mitsunori Komatsu"}}, "url": "https://github.com/treasure-data/digdag/commit/5df1f42707feb7de8f9e8013b7273a59a5e1a38c", "committedDate": "2020-05-13T05:55:03Z", "message": "Avoid building all CI nodes with UI"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "707477e21c9b74ffb5b5c4faf12d9869ae0c4fcd", "author": {"user": {"login": "komamitsu", "name": "Mitsunori Komatsu"}}, "url": "https://github.com/treasure-data/digdag/commit/707477e21c9b74ffb5b5c4faf12d9869ae0c4fcd", "committedDate": "2020-05-13T05:55:43Z", "message": "Remove CI on Travis CI"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "313002bab6c26c48a167f52d8b86d23bbaa3fa32", "author": {"user": {"login": "komamitsu", "name": "Mitsunori Komatsu"}}, "url": "https://github.com/treasure-data/digdag/commit/313002bab6c26c48a167f52d8b86d23bbaa3fa32", "committedDate": "2020-05-13T06:07:38Z", "message": "Fix script"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "5106f0df4400016b47fe50a68e606d708d731b20", "author": {"user": {"login": "komamitsu", "name": "Mitsunori Komatsu"}}, "url": "https://github.com/treasure-data/digdag/commit/5106f0df4400016b47fe50a68e606d708d731b20", "committedDate": "2020-05-13T06:42:02Z", "message": "Integrate with Coveralls on Github Actions"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "3eb61993739708542f3b98d125809e5bd0db95b0", "author": {"user": {"login": "komamitsu", "name": "Mitsunori Komatsu"}}, "url": "https://github.com/treasure-data/digdag/commit/3eb61993739708542f3b98d125809e5bd0db95b0", "committedDate": "2020-05-13T06:48:36Z", "message": "Update ci.yml"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "8d3119a222a6132ff62dea4736afc5925dcc6523", "author": {"user": {"login": "komamitsu", "name": "Mitsunori Komatsu"}}, "url": "https://github.com/treasure-data/digdag/commit/8d3119a222a6132ff62dea4736afc5925dcc6523", "committedDate": "2020-05-13T09:42:23Z", "message": "Remove Coveralls integration for now"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "db45ac89eba36a9842361635f99a10c0a53d1298", "author": {"user": {"login": "komamitsu", "name": "Mitsunori Komatsu"}}, "url": "https://github.com/treasure-data/digdag/commit/db45ac89eba36a9842361635f99a10c0a53d1298", "committedDate": "2020-05-14T05:55:48Z", "message": "Update ci.yml"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "5207a3223b7b477e3d016f5420e96dba900b7f58", "author": {"user": {"login": "komamitsu", "name": "Mitsunori Komatsu"}}, "url": "https://github.com/treasure-data/digdag/commit/5207a3223b7b477e3d016f5420e96dba900b7f58", "committedDate": "2020-05-15T06:16:01Z", "message": "Avoid UI build in case of h2 tests"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "0d81ed356a8ed62c85fcdbf40a1c9de959e86efa", "author": {"user": {"login": "komamitsu", "name": "Mitsunori Komatsu"}}, "url": "https://github.com/treasure-data/digdag/commit/0d81ed356a8ed62c85fcdbf40a1c9de959e86efa", "committedDate": "2020-06-19T12:06:34Z", "message": "Use '-x buildUi' instead of '-PwithoutUi'"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "187c48d6614013e6f4e08099f36e24407e927ca9", "author": {"user": {"login": "komamitsu", "name": "Mitsunori Komatsu"}}, "url": "https://github.com/treasure-data/digdag/commit/187c48d6614013e6f4e08099f36e24407e927ca9", "committedDate": "2020-07-09T08:47:41Z", "message": "Update ci.yml\n\nPrevent duplicated CI build"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDUxNDE2Nzk3", "url": "https://github.com/treasure-data/digdag/pull/1407#pullrequestreview-451416797", "createdAt": "2020-07-20T08:53:29Z", "commit": {"oid": "187c48d6614013e6f4e08099f36e24407e927ca9"}, "state": "COMMENTED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "38b302f0fdff2f6e084e437042702a6a0469ad7a", "author": {"user": {"login": "komamitsu", "name": "Mitsunori Komatsu"}}, "url": "https://github.com/treasure-data/digdag/commit/38b302f0fdff2f6e084e437042702a6a0469ad7a", "committedDate": "2020-07-21T06:45:22Z", "message": "Update README.md\n\nReplace the badge of Travis CI with Github Action's one"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDUyMTc0MTE1", "url": "https://github.com/treasure-data/digdag/pull/1407#pullrequestreview-452174115", "createdAt": "2020-07-21T06:56:01Z", "commit": {"oid": "38b302f0fdff2f6e084e437042702a6a0469ad7a"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yMVQwNjo1NjowMVrOG0qlqA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yMVQwNjo1NjowMVrOG0qlqA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1Nzg3NjkwNA==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            \"${BASEDIR}/run_test_h2.sh\" ${WITHOUT_BUILD_UI}\n          \n          \n            \n            \"${BASEDIR}/run_test_h2.sh\" ${BUILD_UI_OPT}\n          \n      \n    \n    \n  \n\nIsn't this line ${BUILD_UI_OPT} instead of ${WITHOUT_BUILD_UI}?", "url": "https://github.com/treasure-data/digdag/pull/1407#discussion_r457876904", "createdAt": "2020-07-21T06:56:01Z", "author": {"login": "szyn"}, "path": "ci/run_test.sh", "diffHunk": "@@ -9,6 +9,16 @@ if [[ $(( 1 % ${CI_NODE_TOTAL} )) -eq ${CI_NODE_INDEX} ]]; then\n     \"${BASEDIR}/validate.sh\"\n fi\n \n-\"${BASEDIR}/run_test_h2.sh\"\n-\"${BASEDIR}/run_test_pg.sh\"\n+WITH_BUILD_UI=\"\"\n+WITHOUT_BUILD_UI=\"-x buildUi\"\n+\n+# Don't need to build UI always\n+if [[ $(( 2 % ${CI_NODE_TOTAL} )) -eq ${CI_NODE_INDEX} ]]; then\n+  BUILD_UI_OPT=${WITH_BUILD_UI}\n+else\n+  BUILD_UI_OPT=${WITHOUT_BUILD_UI}\n+fi\n+\n+\"${BASEDIR}/run_test_h2.sh\" ${WITHOUT_BUILD_UI}", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "38b302f0fdff2f6e084e437042702a6a0469ad7a"}, "originalPosition": 16}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDUyMTgxNDkx", "url": "https://github.com/treasure-data/digdag/pull/1407#pullrequestreview-452181491", "createdAt": "2020-07-21T07:08:42Z", "commit": {"oid": "38b302f0fdff2f6e084e437042702a6a0469ad7a"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "89f3905195f140dfffb6f26103c00588a8c63f09", "author": {"user": {"login": "komamitsu", "name": "Mitsunori Komatsu"}}, "url": "https://github.com/treasure-data/digdag/commit/89f3905195f140dfffb6f26103c00588a8c63f09", "committedDate": "2020-07-21T07:21:35Z", "message": "Add a comment"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4020, "cost": 1, "resetAt": "2021-11-01T16:37:27Z"}}}