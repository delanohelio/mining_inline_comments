{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDcyMjg1ODA4", "number": 1447, "title": "Add task details as comments automatically to the query run by td operator", "bodyText": "Currently, it's hard to identify which the workflow runs the job because we don't have information in the query issued by a workflow.\nThis PR support to add task details as comments automatically to the top of the query run by td operator, the following information will be added.\n\nproject_id\nproject_name\nworkflow_name\nsession_id\nattempt_id\ntask_name\n\nThe above information will help the admin/user to identify/debug the workflow from the job results easily.", "createdAt": "2020-08-24T06:19:03Z", "url": "https://github.com/treasure-data/digdag/pull/1447", "merged": true, "mergeCommit": {"oid": "069ed09f3cac01620eeaaaf6ff931349f7dcf0f6"}, "closed": true, "closedAt": "2020-08-26T05:30:16Z", "author": {"login": "szyn"}, "timelineItems": {"totalCount": 12, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdB7_5WgH2gAyNDcyMjg1ODA4Ojc0NTAwMTNjZTQ1ODY0OTliMDFlZTY3MTc4ZGU0ZWRkNTI4ODQ4NmE=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdCWWlmAH2gAyNDcyMjg1ODA4OjdiY2U4NWQ1YmM2YTRlNTU4YzQ4ZGE3YTI1Y2ZkMmIwZTc4NTJhYWI=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "7450013ce4586499b01ee67178de4edd5288486a", "author": {"user": {"login": "szyn", "name": "Shota Suzuki"}}, "url": "https://github.com/treasure-data/digdag/commit/7450013ce4586499b01ee67178de4edd5288486a", "committedDate": "2020-08-24T05:45:21Z", "message": "Add task details as comments automatically to the query run by td operator"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDczMTUxMDAx", "url": "https://github.com/treasure-data/digdag/pull/1447#pullrequestreview-473151001", "createdAt": "2020-08-24T06:29:11Z", "commit": {"oid": "7450013ce4586499b01ee67178de4edd5288486a"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yNFQwNjoyOToxMVrOHFWNcQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yNFQwNjoyOToxMVrOHFWNcQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NTM2ODgxNw==", "bodyText": "Why not return StringBuilder from the method to avoid this String concatenation?", "url": "https://github.com/treasure-data/digdag/pull/1447#discussion_r475368817", "createdAt": "2020-08-24T06:29:11Z", "author": {"login": "komamitsu"}, "path": "digdag-standards/src/main/java/io/digdag/standards/operator/td/TdOperatorFactory.java", "diffHunk": "@@ -219,11 +219,13 @@ else if (createTable.isPresent()) {\n                     throw new ConfigException(\"Unknown 'engine:' option (available options are: hive and presto): \"+engine);\n             }\n \n+            final String sql = createStmtComment(request) + stmt;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "7450013ce4586499b01ee67178de4edd5288486a"}, "originalPosition": 19}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "9db104eb77b0680e932fbc655cb1f51f4a704cfe", "author": {"user": {"login": "szyn", "name": "Shota Suzuki"}}, "url": "https://github.com/treasure-data/digdag/commit/9db104eb77b0680e932fbc655cb1f51f4a704cfe", "committedDate": "2020-08-24T06:42:19Z", "message": "Update to return StringBuilder to avoid String concatenation"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "9854db2ccbfac05780558e4689ea3e4888c58310", "author": {"user": {"login": "szyn", "name": "Shota Suzuki"}}, "url": "https://github.com/treasure-data/digdag/commit/9854db2ccbfac05780558e4689ea3e4888c58310", "committedDate": "2020-08-24T06:51:20Z", "message": "Fix tests"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDc0MDM0MTk1", "url": "https://github.com/treasure-data/digdag/pull/1447#pullrequestreview-474034195", "createdAt": "2020-08-25T01:36:03Z", "commit": {"oid": "9854db2ccbfac05780558e4689ea3e4888c58310"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yNVQwMTozNjowM1rOHF_Z3A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yNVQwMTozNjowM1rOHF_Z3A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NjA0Mzc0MA==", "bodyText": "FYI: Another option may be a method String wrapStmtWithComment(TaskRequest request, String sql)", "url": "https://github.com/treasure-data/digdag/pull/1447#discussion_r476043740", "createdAt": "2020-08-25T01:36:03Z", "author": {"login": "komamitsu"}, "path": "digdag-standards/src/main/java/io/digdag/standards/operator/td/TdOperatorFactory.java", "diffHunk": "@@ -533,4 +535,15 @@ else if (c == DELIMITER_CHAR) {\n             return escapedValue.toString();\n         }\n     }\n+\n+    @VisibleForTesting\n+    static StringBuilder createStmtComment(TaskRequest request)", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "9854db2ccbfac05780558e4689ea3e4888c58310"}, "originalPosition": 45}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDc0MDM0NzI3", "url": "https://github.com/treasure-data/digdag/pull/1447#pullrequestreview-474034727", "createdAt": "2020-08-25T01:37:54Z", "commit": {"oid": "9854db2ccbfac05780558e4689ea3e4888c58310"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yNVQwMTozNzo1NVrOHF_euA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yNVQwMTozNzo1NVrOHF_euA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NjA0NDk4NA==", "bodyText": "There is no test to check createStmtComment() works expectedly?", "url": "https://github.com/treasure-data/digdag/pull/1447#discussion_r476044984", "createdAt": "2020-08-25T01:37:55Z", "author": {"login": "komamitsu"}, "path": "digdag-standards/src/test/java/io/digdag/standards/operator/td/TdOperatorFactoryTest.java", "diffHunk": "@@ -93,9 +110,10 @@ public void testTDJobRequestParamsWithEngineVersion()\n         when(op.getDatabase()).thenReturn(\"testdb\");\n \n         TDJobRequest jobRequest = testTDJobRequestParams(projectPath, config);\n+        String sql = createStmtComment(taskRequest).append(\"select 1\").toString();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "9854db2ccbfac05780558e4689ea3e4888c58310"}, "originalPosition": 63}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "83f00c1c0e6973d7d4baeaf4b49b601b834bb9cc", "author": {"user": {"login": "szyn", "name": "Shota Suzuki"}}, "url": "https://github.com/treasure-data/digdag/commit/83f00c1c0e6973d7d4baeaf4b49b601b834bb9cc", "committedDate": "2020-08-25T02:40:54Z", "message": "Use wrapStmtWithComment method to simplify"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e55103be6eb8680da8b4de0b2983fc46aac59498", "author": {"user": {"login": "szyn", "name": "Shota Suzuki"}}, "url": "https://github.com/treasure-data/digdag/commit/e55103be6eb8680da8b4de0b2983fc46aac59498", "committedDate": "2020-08-25T02:57:13Z", "message": "Add unit tests for wrapStmtWithComment method"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d617e150ea2e81127e1d6b64aef70961bd5dd3fd", "author": {"user": {"login": "szyn", "name": "Shota Suzuki"}}, "url": "https://github.com/treasure-data/digdag/commit/d617e150ea2e81127e1d6b64aef70961bd5dd3fd", "committedDate": "2020-08-25T02:57:31Z", "message": "Fix tests"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDc0MTQwMjA2", "url": "https://github.com/treasure-data/digdag/pull/1447#pullrequestreview-474140206", "createdAt": "2020-08-25T05:14:51Z", "commit": {"oid": "d617e150ea2e81127e1d6b64aef70961bd5dd3fd"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "89ad87b1fed59b8bb3f8e7fbd5ffe195472947f5", "author": {"user": {"login": "szyn", "name": "Shota Suzuki"}}, "url": "https://github.com/treasure-data/digdag/commit/89ad87b1fed59b8bb3f8e7fbd5ffe195472947f5", "committedDate": "2020-08-25T11:08:51Z", "message": "Add workflow_name in comments"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "7bce85d5bc6a4e558c48da7a25cfd2b0e7852aab", "author": {"user": {"login": "szyn", "name": "Shota Suzuki"}}, "url": "https://github.com/treasure-data/digdag/commit/7bce85d5bc6a4e558c48da7a25cfd2b0e7852aab", "committedDate": "2020-08-25T12:27:40Z", "message": "Fix tests"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4049, "cost": 1, "resetAt": "2021-11-01T16:37:27Z"}}}