{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDcyMjg1ODA4", "number": 1447, "reviewThreads": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yNFQwNjoyOToxMVrOEbbFhw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yNVQwMTozNzo1NVrOEb1BhA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjk3MTkwNzkxOnYy", "diffSide": "RIGHT", "path": "digdag-standards/src/main/java/io/digdag/standards/operator/td/TdOperatorFactory.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yNFQwNjoyOToxMVrOHFWNcQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yNFQwNjo1NTo0MlrOHFW0jA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NTM2ODgxNw==", "bodyText": "Why not return StringBuilder from the method to avoid this String concatenation?", "url": "https://github.com/treasure-data/digdag/pull/1447#discussion_r475368817", "createdAt": "2020-08-24T06:29:11Z", "author": {"login": "komamitsu"}, "path": "digdag-standards/src/main/java/io/digdag/standards/operator/td/TdOperatorFactory.java", "diffHunk": "@@ -219,11 +219,13 @@ else if (createTable.isPresent()) {\n                     throw new ConfigException(\"Unknown 'engine:' option (available options are: hive and presto): \"+engine);\n             }\n \n+            final String sql = createStmtComment(request) + stmt;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "7450013ce4586499b01ee67178de4edd5288486a"}, "originalPosition": 19}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NTM3ODgyOA==", "bodyText": "Good point, thank you. Updated: 9db104e", "url": "https://github.com/treasure-data/digdag/pull/1447#discussion_r475378828", "createdAt": "2020-08-24T06:55:42Z", "author": {"login": "szyn"}, "path": "digdag-standards/src/main/java/io/digdag/standards/operator/td/TdOperatorFactory.java", "diffHunk": "@@ -219,11 +219,13 @@ else if (createTable.isPresent()) {\n                     throw new ConfigException(\"Unknown 'engine:' option (available options are: hive and presto): \"+engine);\n             }\n \n+            final String sql = createStmtComment(request) + stmt;", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NTM2ODgxNw=="}, "originalCommit": {"oid": "7450013ce4586499b01ee67178de4edd5288486a"}, "originalPosition": 19}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjk3NjE1MDQ0OnYy", "diffSide": "RIGHT", "path": "digdag-standards/src/main/java/io/digdag/standards/operator/td/TdOperatorFactory.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yNVQwMTozNjowM1rOHF_Z3A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yNVQwNDozODozOVrOHGGupA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NjA0Mzc0MA==", "bodyText": "FYI: Another option may be a method String wrapStmtWithComment(TaskRequest request, String sql)", "url": "https://github.com/treasure-data/digdag/pull/1447#discussion_r476043740", "createdAt": "2020-08-25T01:36:03Z", "author": {"login": "komamitsu"}, "path": "digdag-standards/src/main/java/io/digdag/standards/operator/td/TdOperatorFactory.java", "diffHunk": "@@ -533,4 +535,15 @@ else if (c == DELIMITER_CHAR) {\n             return escapedValue.toString();\n         }\n     }\n+\n+    @VisibleForTesting\n+    static StringBuilder createStmtComment(TaskRequest request)", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "9854db2ccbfac05780558e4689ea3e4888c58310"}, "originalPosition": 45}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NjE2Mzc0OA==", "bodyText": "That's better \ud83d\udc4d  Updated: 83f00c1", "url": "https://github.com/treasure-data/digdag/pull/1447#discussion_r476163748", "createdAt": "2020-08-25T04:38:39Z", "author": {"login": "szyn"}, "path": "digdag-standards/src/main/java/io/digdag/standards/operator/td/TdOperatorFactory.java", "diffHunk": "@@ -533,4 +535,15 @@ else if (c == DELIMITER_CHAR) {\n             return escapedValue.toString();\n         }\n     }\n+\n+    @VisibleForTesting\n+    static StringBuilder createStmtComment(TaskRequest request)", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NjA0Mzc0MA=="}, "originalCommit": {"oid": "9854db2ccbfac05780558e4689ea3e4888c58310"}, "originalPosition": 45}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjk3NjE1NzQ4OnYy", "diffSide": "RIGHT", "path": "digdag-standards/src/test/java/io/digdag/standards/operator/td/TdOperatorFactoryTest.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yNVQwMTozNzo1NVrOHF_euA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yNVQwNDozOTo0MVrOHGGx-g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NjA0NDk4NA==", "bodyText": "There is no test to check createStmtComment() works expectedly?", "url": "https://github.com/treasure-data/digdag/pull/1447#discussion_r476044984", "createdAt": "2020-08-25T01:37:55Z", "author": {"login": "komamitsu"}, "path": "digdag-standards/src/test/java/io/digdag/standards/operator/td/TdOperatorFactoryTest.java", "diffHunk": "@@ -93,9 +110,10 @@ public void testTDJobRequestParamsWithEngineVersion()\n         when(op.getDatabase()).thenReturn(\"testdb\");\n \n         TDJobRequest jobRequest = testTDJobRequestParams(projectPath, config);\n+        String sql = createStmtComment(taskRequest).append(\"select 1\").toString();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "9854db2ccbfac05780558e4689ea3e4888c58310"}, "originalPosition": 63}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NjE2NDYwMg==", "bodyText": "Added a test case to check wrapStmtWithComment()  e55103b", "url": "https://github.com/treasure-data/digdag/pull/1447#discussion_r476164602", "createdAt": "2020-08-25T04:39:41Z", "author": {"login": "szyn"}, "path": "digdag-standards/src/test/java/io/digdag/standards/operator/td/TdOperatorFactoryTest.java", "diffHunk": "@@ -93,9 +110,10 @@ public void testTDJobRequestParamsWithEngineVersion()\n         when(op.getDatabase()).thenReturn(\"testdb\");\n \n         TDJobRequest jobRequest = testTDJobRequestParams(projectPath, config);\n+        String sql = createStmtComment(taskRequest).append(\"select 1\").toString();", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NjA0NDk4NA=="}, "originalCommit": {"oid": "9854db2ccbfac05780558e4689ea3e4888c58310"}, "originalPosition": 63}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1145, "cost": 1, "resetAt": "2021-11-13T14:23:39Z"}}}