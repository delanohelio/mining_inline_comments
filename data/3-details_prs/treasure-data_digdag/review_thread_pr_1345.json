{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0MzY4MDQyNzYy", "number": 1345, "reviewThreads": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yOVQwOTowMDo0MVrODbfxew==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yOVQwOTowMDo0MVrODbfxew==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjMwMTU4NzE1OnYy", "diffSide": "RIGHT", "path": "digdag-core/src/main/java/io/digdag/core/database/DatabaseSessionStoreManager.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yOVQwOTowMDo0MVrOFjA3Ug==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yOVQxNjozMzowMVrOFjPK5A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MjI1ODY0Mg==", "bodyText": "These code may be better to remove.", "url": "https://github.com/treasure-data/digdag/pull/1345#discussion_r372258642", "createdAt": "2020-01-29T09:00:41Z", "author": {"login": "yoyama"}, "path": "digdag-core/src/main/java/io/digdag/core/database/DatabaseSessionStoreManager.java", "diffHunk": "@@ -905,16 +906,50 @@ public void addResumingTasks(long attemptId, List<ResumingTask> tasks)\n         }\n \n         @DigdagTimed(value = \"dtcst_\", category = \"db\", appendMethodName = true)\n+        /**\n+         * Filter the child task if it is generated sub task.\n+         * Check the child task full name has '^sub' position later the parent full name.\n+         * @param parentFullName\n+         * @return\n+         */\n+        @VisibleForTesting\n+        public Predicate<StoredTask> funcFilterGeneratedSubtasks(Optional<String>parentFullName)\n+        {\n+            Predicate<StoredTask> filterGeneratedSubtasks = (s) -> {\n+                if (!parentFullName.isPresent()) {\n+                    return true;\n+                }\n+                String pfname = parentFullName.get();\n+                String chfname = s.getFullName();\n+                int pfnameLen = pfname.length();\n+                int chfnameLen = chfname.length();\n+\n+                if (chfname.startsWith(pfname)\n+                        && chfname.substring(pfnameLen).contains(\"^sub\")) {\n+                    // && chfnameLen > pfnameLen + \"^sub\".length()) {\n+                    logger.debug(\"Exclude generated task:{} from retry target\", chfname);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "6ebb6230fb9be08f362e9eaad72349d9be79e0d5"}, "originalPosition": 33}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MjQ5MzAyOA==", "bodyText": "I deleted here. 1071cbf", "url": "https://github.com/treasure-data/digdag/pull/1345#discussion_r372493028", "createdAt": "2020-01-29T16:33:01Z", "author": {"login": "naritta"}, "path": "digdag-core/src/main/java/io/digdag/core/database/DatabaseSessionStoreManager.java", "diffHunk": "@@ -905,16 +906,50 @@ public void addResumingTasks(long attemptId, List<ResumingTask> tasks)\n         }\n \n         @DigdagTimed(value = \"dtcst_\", category = \"db\", appendMethodName = true)\n+        /**\n+         * Filter the child task if it is generated sub task.\n+         * Check the child task full name has '^sub' position later the parent full name.\n+         * @param parentFullName\n+         * @return\n+         */\n+        @VisibleForTesting\n+        public Predicate<StoredTask> funcFilterGeneratedSubtasks(Optional<String>parentFullName)\n+        {\n+            Predicate<StoredTask> filterGeneratedSubtasks = (s) -> {\n+                if (!parentFullName.isPresent()) {\n+                    return true;\n+                }\n+                String pfname = parentFullName.get();\n+                String chfname = s.getFullName();\n+                int pfnameLen = pfname.length();\n+                int chfnameLen = chfname.length();\n+\n+                if (chfname.startsWith(pfname)\n+                        && chfname.substring(pfnameLen).contains(\"^sub\")) {\n+                    // && chfnameLen > pfnameLen + \"^sub\".length()) {\n+                    logger.debug(\"Exclude generated task:{} from retry target\", chfname);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MjI1ODY0Mg=="}, "originalCommit": {"oid": "6ebb6230fb9be08f362e9eaad72349d9be79e0d5"}, "originalPosition": 33}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1182, "cost": 1, "resetAt": "2021-11-13T14:23:39Z"}}}