{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0MzY1MzU0NTA3", "number": 2646, "title": "Workflow step definitions", "bodyText": "PR for the following rest contracts:\n\nhttps://github.com/DSpace/Rest7Contract/blob/master/workflowdefinitions.md\nhttps://github.com/DSpace/Rest7Contract/blob/master/workflowsteps.md\nhttps://github.com/DSpace/Rest7Contract/blob/master/workflowactions.md\n\nThis PR also contains the changes made in: #2420, so this PR should be accepted prior to this one.", "createdAt": "2020-01-21T15:09:06Z", "url": "https://github.com/DSpace/DSpace/pull/2646", "merged": true, "mergeCommit": {"oid": "373e8e1603918fb00cf8891385729a6c3fc79aaa"}, "closed": true, "closedAt": "2020-02-25T10:55:54Z", "author": {"login": "KevinVdV"}, "timelineItems": {"totalCount": 50, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABbvUKAYAH2gAyMzY1MzU0NTA3OjU4ODcwYjA3OWQ0ODA0N2Q1NGMzMDM1ZmFjYjMzMzUwODVlMWY1MDU=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcHu4C0ABqjMwNjg2Njk3MzM=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "58870b079d48047d54c3035facb3335085e1f505", "author": {"user": {"login": "MarieVerdonck", "name": "Marie Verdonck"}}, "url": "https://github.com/DSpace/DSpace/commit/58870b079d48047d54c3035facb3335085e1f505", "committedDate": "2019-12-11T12:58:24Z", "message": "67694: new /api/config/workflowsdefintions endpoints:\n/api/config/workflowdefinitions/<:definition-name>\n/api/config/workflowdefinitions\n/api/config/workflowdefinitions/search/findByCollection?uuid=<:collection-uuid>\n/api/config/workflowdefinitions/<:definition-name>/collections\n\nSigned-off-by: Marie Verdonck <maria.verdonck@atmire.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "6084fae35797adcd778f6d5e832b421103f75137", "author": {"user": {"login": "MarieVerdonck", "name": "Marie Verdonck"}}, "url": "https://github.com/DSpace/DSpace/commit/6084fae35797adcd778f6d5e832b421103f75137", "committedDate": "2019-12-12T09:42:04Z", "message": "67694: checkstyle and licenses"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "8a3479e75349028a33b5659eebd5b78894bebadf", "author": {"user": {"login": "MarieVerdonck", "name": "Marie Verdonck"}}, "url": "https://github.com/DSpace/DSpace/commit/8a3479e75349028a33b5659eebd5b78894bebadf", "committedDate": "2019-12-17T10:08:17Z", "message": "67694: Exception handling improvements and /search moved to repository"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "943b3f13565cf2c0412d68388012ea80e4ad59a4", "author": {"user": {"login": "MarieVerdonck", "name": "Marie Verdonck"}}, "url": "https://github.com/DSpace/DSpace/commit/943b3f13565cf2c0412d68388012ea80e4ad59a4", "committedDate": "2019-12-17T15:31:31Z", "message": "67694: isDefault fix, workflowdefinitions IT, exception handling"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "39c727a8032e35f5a7ac9f41a908c65527eb93ca", "author": {"user": {"login": "MarieVerdonck", "name": "Marie Verdonck"}}, "url": "https://github.com/DSpace/DSpace/commit/39c727a8032e35f5a7ac9f41a908c65527eb93ca", "committedDate": "2019-12-19T09:50:02Z", "message": "67694: forgot to log error stack itself"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "7ef537507f30ce2ac7d18807322d482113ecad17", "author": {"user": {"login": "MarieVerdonck", "name": "Marie Verdonck"}}, "url": "https://github.com/DSpace/DSpace/commit/7ef537507f30ce2ac7d18807322d482113ecad17", "committedDate": "2019-12-20T10:21:17Z", "message": "- Merged with KevinVdV/DSpace/DS-4239-migrate-workflow-xml-to-spring\n- Changed all implementations of XmlWorkflowFactoryImpl to work with new mapping\n- Moved their java doc to XmlWorkflowFactory\n- Removed/Changed exceptions\n- Altered tests in WorkflowDefinitionRestRepositoryIT to work with changes\n\nMerge remote-tracking branch 'github-kevin/DS-4239-migrate-workflow-xml-to-spring' into workflow-step-definitions\n\n# Conflicts:\n#\tdspace-api/src/main/java/org/dspace/xmlworkflow/XmlWorkflowFactoryImpl.java\n#\tdspace-api/src/main/java/org/dspace/xmlworkflow/factory/XmlWorkflowFactory.java"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "59ef4ef0652c13a5c33b2ad55ced5f3f87c954b0", "author": {"user": {"login": "MarieVerdonck", "name": "Marie Verdonck"}}, "url": "https://github.com/DSpace/DSpace/commit/59ef4ef0652c13a5c33b2ad55ced5f3f87c954b0", "committedDate": "2019-12-20T10:22:59Z", "message": "Merge branch 'w2p-67996-workflow-junit-tests' into workflow-step-definitions"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "2521fa5107820a65a2e66e8fb8ef2b860cd521f4", "author": {"user": {"login": "MarieVerdonck", "name": "Marie Verdonck"}}, "url": "https://github.com/DSpace/DSpace/commit/2521fa5107820a65a2e66e8fb8ef2b860cd521f4", "committedDate": "2019-12-23T11:09:02Z", "message": "67998: Merged in w2p-67996, altered XmlWorkflowFactoryTest to destroy created comcol"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "414b82f9cb73853933ab20aa0df32ad2d27db767", "author": {"user": {"login": "MarieVerdonck", "name": "Marie Verdonck"}}, "url": "https://github.com/DSpace/DSpace/commit/414b82f9cb73853933ab20aa0df32ad2d27db767", "committedDate": "2020-01-02T16:05:19Z", "message": "67998: feedback exceptions"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "9dd433412ac41ae759f2d36c2dd846c9b9d25d71", "author": {"user": {"login": "MarieVerdonck", "name": "Marie Verdonck"}}, "url": "https://github.com/DSpace/DSpace/commit/9dd433412ac41ae759f2d36c2dd846c9b9d25d71", "committedDate": "2020-01-02T16:40:18Z", "message": "67998: tested config handle moved, since other non-collection dso already create at that handle"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d8dc4f113c1bbaa8406b30f65ee21f7e412d7059", "author": {"user": {"login": "MarieVerdonck", "name": "Marie Verdonck"}}, "url": "https://github.com/DSpace/DSpace/commit/d8dc4f113c1bbaa8406b30f65ee21f7e412d7059", "committedDate": "2020-01-03T11:39:06Z", "message": "67998: non-numbered handle config so can't accidentally be created"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "7ed292e7542d5b9db8a051d85bca1d6b07d01b8b", "author": {"user": {"login": "MarieVerdonck", "name": "Marie Verdonck"}}, "url": "https://github.com/DSpace/DSpace/commit/7ed292e7542d5b9db8a051d85bca1d6b07d01b8b", "committedDate": "2020-01-03T16:11:26Z", "message": "68150: fix and tests for pagination for api/config/workflowdefinitions"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a254ae31e29b3b19250144db995f4a4f6f8ebefe", "author": {"user": {"login": "MarieVerdonck", "name": "Marie Verdonck"}}, "url": "https://github.com/DSpace/DSpace/commit/a254ae31e29b3b19250144db995f4a4f6f8ebefe", "committedDate": "2020-01-06T11:50:52Z", "message": "68150: /workflowdefinitions/defaultWorkflow/collections now returns all non-mapped collections and now returns paginated result + tests"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "2c6c51752e98f8ebc5ed0d6730d1f54464817502", "author": {"user": {"login": "MarieVerdonck", "name": "Marie Verdonck"}}, "url": "https://github.com/DSpace/DSpace/commit/2c6c51752e98f8ebc5ed0d6730d1f54464817502", "committedDate": "2020-01-06T15:50:02Z", "message": "68155: /api/config/workflowactions/<:action-name> endpoint + tests"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "50eb5be31c888899160f37f8d2384ff193e16260", "author": {"user": {"login": "MarieVerdonck", "name": "Marie Verdonck"}}, "url": "https://github.com/DSpace/DSpace/commit/50eb5be31c888899160f37f8d2384ff193e16260", "committedDate": "2020-01-08T10:55:19Z", "message": "68150: resolve collection handles to collection in XmlWorkflowFactory & forgotten exception"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "4f0b48b4ffd13c23db0931eb120223653cd34171", "author": {"user": {"login": "MarieVerdonck", "name": "Marie Verdonck"}}, "url": "https://github.com/DSpace/DSpace/commit/4f0b48b4ffd13c23db0931eb120223653cd34171", "committedDate": "2020-01-08T13:13:40Z", "message": "68155: SUBMIT_CANCEL option removed from SelectReviewerAction"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "22b1f6231d4252a1031e68daad2556c0a5aed02b", "author": {"user": {"login": "MarieVerdonck", "name": "Marie Verdonck"}}, "url": "https://github.com/DSpace/DSpace/commit/22b1f6231d4252a1031e68daad2556c0a5aed02b", "committedDate": "2020-01-09T13:24:37Z", "message": "68155: xmlWorkflowFactory autowired where possible & WorkflowAction.name > id"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "766d021a1a56e32934e5a1fea6eda46a5fd96259", "author": {"user": {"login": "MarieVerdonck", "name": "Marie Verdonck"}}, "url": "https://github.com/DSpace/DSpace/commit/766d021a1a56e32934e5a1fea6eda46a5fd96259", "committedDate": "2020-01-10T16:01:33Z", "message": "68253: GET /api/config/workflowsteps/<:step-name> endpoint"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "2c5acf0cfb8a0b2b424c56c247d20ff000919b8c", "author": {"user": {"login": "MarieVerdonck", "name": "Marie Verdonck"}}, "url": "https://github.com/DSpace/DSpace/commit/2c5acf0cfb8a0b2b424c56c247d20ff000919b8c", "committedDate": "2020-01-13T11:45:54Z", "message": "68253: GET /api/config/workflowsteps/<:step-name> IT"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b76933e7c122da7545b76cbc9587f9784d9c6914", "author": {"user": {"login": "MarieVerdonck", "name": "Marie Verdonck"}}, "url": "https://github.com/DSpace/DSpace/commit/b76933e7c122da7545b76cbc9587f9784d9c6914", "committedDate": "2020-01-14T12:06:27Z", "message": "68274: /api/config/workflowdefinitions/<:definition-name>/steps endpoint and link"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c171140371efa605dd145178255af577e293a484", "author": {"user": {"login": "MarieVerdonck", "name": "Marie Verdonck"}}, "url": "https://github.com/DSpace/DSpace/commit/c171140371efa605dd145178255af577e293a484", "committedDate": "2020-01-16T13:19:11Z", "message": "68274: /workflowdefinitions/<:definition-name>/steps endpoint as embedded resource and collections link"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "25dd5162b0cb7b42974ca8de6ea911dd7bfe11ea", "author": {"user": {"login": "KevinVdV", "name": "Kevin Van de Velde"}}, "url": "https://github.com/DSpace/DSpace/commit/25dd5162b0cb7b42974ca8de6ea911dd7bfe11ea", "committedDate": "2020-01-21T08:30:07Z", "message": "Merge branch 'DS-4239-migrate-workflow-xml-to-spring' into workflow-step-definitions"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "20d9b330d097676fbf4c7890f90c9642b87246d2", "author": {"user": {"login": "KevinVdV", "name": "Kevin Van de Velde"}}, "url": "https://github.com/DSpace/DSpace/commit/20d9b330d097676fbf4c7890f90c9642b87246d2", "committedDate": "2020-01-21T11:49:29Z", "message": "Fixing merge issue in the workflow-actions.xml file"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzQ5NDA2MjQz", "url": "https://github.com/DSpace/DSpace/pull/2646#pullrequestreview-349406243", "createdAt": "2020-01-28T14:16:47Z", "commit": {"oid": "20d9b330d097676fbf4c7890f90c9642b87246d2"}, "state": "COMMENTED", "comments": {"totalCount": 6, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yOFQxNDoxNjo0OFrOFimh5A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yOFQxNTowMzoxMlrOFioUzw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MTgyNzE3Mg==", "bodyText": "Can you add JavaDocs here", "url": "https://github.com/DSpace/DSpace/pull/2646#discussion_r371827172", "createdAt": "2020-01-28T14:16:48Z", "author": {"login": "benbosman"}, "path": "dspace-api/src/main/java/org/dspace/xmlworkflow/state/actions/WorkflowActionConfig.java", "diffHunk": "@@ -59,4 +61,8 @@ public Step getStep() {\n         return step;\n     }\n \n+    public List<String> getOptions() {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "20d9b330d097676fbf4c7890f90c9642b87246d2"}, "originalPosition": 13}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MTgyNzQ2MA==", "bodyText": "Can you add JavaDocs here", "url": "https://github.com/DSpace/DSpace/pull/2646#discussion_r371827460", "createdAt": "2020-01-28T14:17:18Z", "author": {"login": "benbosman"}, "path": "dspace-api/src/main/java/org/dspace/xmlworkflow/state/actions/Action.java", "diffHunk": "@@ -36,15 +36,16 @@\n public abstract class Action {\n \n     private WorkflowActionConfig parent;\n-    private static String ERROR_FIELDS_ATTRIBUTE = \"dspace.workflow.error_fields\";\n-\n+    private static final String ERROR_FIELDS_ATTRIBUTE = \"dspace.workflow.error_fields\";\n \n     public abstract void activate(Context c, XmlWorkflowItem wf)\n         throws SQLException, IOException, AuthorizeException, WorkflowException;\n \n     public abstract ActionResult execute(Context c, XmlWorkflowItem wfi, Step step, HttpServletRequest request)\n         throws SQLException, AuthorizeException, IOException, WorkflowException;\n \n+    public abstract List<String> getOptions();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "20d9b330d097676fbf4c7890f90c9642b87246d2"}, "originalPosition": 14}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MTgyOTIyMQ==", "bodyText": "Since SUBMIT_EDIT_METADATA is a 'special' action, would it make sense to set it in the ProcessingAction for reuse?", "url": "https://github.com/DSpace/DSpace/pull/2646#discussion_r371829221", "createdAt": "2020-01-28T14:20:21Z", "author": {"login": "benbosman"}, "path": "dspace-api/src/main/java/org/dspace/xmlworkflow/state/actions/processingaction/AcceptEditRejectAction.java", "diffHunk": "@@ -31,40 +33,50 @@\n  */\n public class AcceptEditRejectAction extends ProcessingAction {\n \n-    public static final int MAIN_PAGE = 0;\n-    public static final int REJECT_PAGE = 1;\n+    private static final String SUBMIT_APPROVE = \"submit_approve\";\n+    private static final String SUBMIT_REJECT = \"submit_reject\";\n+    private static final String SUBMIT_EDIT_METADATA = \"submit_edit_metadata\";", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "20d9b330d097676fbf4c7890f90c9642b87246d2"}, "originalPosition": 17}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MTgzOTg3MA==", "bodyText": "why does this have to differ from the default?", "url": "https://github.com/DSpace/DSpace/pull/2646#discussion_r371839870", "createdAt": "2020-01-28T14:37:10Z", "author": {"login": "benbosman"}, "path": "dspace-api/src/test/data/dspaceFolder/config/spring/api/workflow-actions.xml", "diffHunk": "@@ -0,0 +1,99 @@\n+<?xml version=\"1.0\" encoding=\"UTF-8\"?>\n+<beans\n+    xmlns=\"http://www.springframework.org/schema/beans\"\n+    xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\"\n+    xmlns:util=\"http://www.springframework.org/schema/util\"\n+    xsi:schemaLocation=\"http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans-4.3.xsd\n+                           http://www.springframework.org/schema/util http://www.springframework.org/schema/util/spring-util-4.3.xsd\">\n+\n+    <bean id=\"claimactionAPI\" class=\"org.dspace.xmlworkflow.state.actions.userassignment.ClaimAction\" scope=\"prototype\"/>\n+    <bean id=\"reviewactionAPI\" class=\"org.dspace.xmlworkflow.state.actions.processingaction.ReviewAction\" scope=\"prototype\"/>\n+    <bean id=\"editactionAPI\" class=\"org.dspace.xmlworkflow.state.actions.processingaction.AcceptEditRejectAction\" scope=\"prototype\"/>\n+    <bean id=\"finaleditactionAPI\" class=\"org.dspace.xmlworkflow.state.actions.processingaction.FinalEditAction\" scope=\"prototype\"/>\n+    <bean id=\"singleuserreviewactionAPI\" class=\"org.dspace.xmlworkflow.state.actions.processingaction.SingleUserReviewAction\" scope=\"prototype\"/>\n+\n+    <bean id=\"selectrevieweractionAPI\" class=\"org.dspace.xmlworkflow.state.actions.processingaction.SelectReviewerAction\" scope=\"prototype\">\n+        <property name=\"role\" ref=\"reviewer\"/>", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "20d9b330d097676fbf4c7890f90c9642b87246d2"}, "originalPosition": 16}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MTg1MDE2Nw==", "bodyText": "I would expect a more generic 400 or 500 exception here since it exists but can't be retrieved", "url": "https://github.com/DSpace/DSpace/pull/2646#discussion_r371850167", "createdAt": "2020-01-28T14:53:20Z", "author": {"login": "benbosman"}, "path": "dspace-server-webapp/src/main/java/org/dspace/app/rest/repository/WorkflowDefinitionRestRepository.java", "diffHunk": "@@ -0,0 +1,89 @@\n+/**\n+ * The contents of this file are subject to the license and copyright\n+ * detailed in the LICENSE and NOTICE files at the root of the source\n+ * tree and available online at\n+ *\n+ * http://www.dspace.org/license/\n+ */\n+package org.dspace.app.rest.repository;\n+\n+import java.sql.SQLException;\n+import java.util.List;\n+import java.util.UUID;\n+\n+import org.dspace.app.rest.Parameter;\n+import org.dspace.app.rest.SearchRestMethod;\n+import org.dspace.app.rest.model.WorkflowDefinitionRest;\n+import org.dspace.content.Collection;\n+import org.dspace.content.service.CollectionService;\n+import org.dspace.core.Context;\n+import org.dspace.xmlworkflow.WorkflowConfigurationException;\n+import org.dspace.xmlworkflow.factory.XmlWorkflowFactory;\n+import org.dspace.xmlworkflow.state.Workflow;\n+import org.springframework.beans.factory.annotation.Autowired;\n+import org.springframework.data.domain.Page;\n+import org.springframework.data.domain.Pageable;\n+import org.springframework.data.rest.webmvc.ResourceNotFoundException;\n+import org.springframework.stereotype.Component;\n+\n+/**\n+ * This is the rest repository responsible for managing WorkflowDefinition Rest objects\n+ *\n+ * @author Maria Verdonck (Atmire) on 11/12/2019\n+ */\n+@Component(WorkflowDefinitionRest.CATEGORY + \".\" + WorkflowDefinitionRest.NAME)\n+public class WorkflowDefinitionRestRepository extends DSpaceRestRepository<WorkflowDefinitionRest, String> {\n+\n+    @Autowired\n+    protected XmlWorkflowFactory xmlWorkflowFactory;\n+\n+    @Autowired\n+    private CollectionService collectionService;\n+\n+    @Override\n+    public WorkflowDefinitionRest findOne(Context context, String workflowName) {\n+        if (xmlWorkflowFactory.workflowByThisNameExists(workflowName)) {\n+            try {\n+                return converter.toRest(xmlWorkflowFactory.getWorkflowByName(workflowName), utils.obtainProjection());\n+            } catch (WorkflowConfigurationException e) {\n+                throw new ResourceNotFoundException(\"No workflow with name \" + workflowName + \" is configured\");", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "20d9b330d097676fbf4c7890f90c9642b87246d2"}, "originalPosition": 49}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MTg1NjU5MQ==", "bodyText": "Shouldn't this also return the collection specifically linked to the default workflow (if any)?", "url": "https://github.com/DSpace/DSpace/pull/2646#discussion_r371856591", "createdAt": "2020-01-28T15:03:12Z", "author": {"login": "benbosman"}, "path": "dspace-server-webapp/src/main/java/org/dspace/app/rest/WorkflowDefinitionController.java", "diffHunk": "@@ -0,0 +1,76 @@\n+/**\n+ * The contents of this file are subject to the license and copyright\n+ * detailed in the LICENSE and NOTICE files at the root of the source\n+ * tree and available online at\n+ *\n+ * http://www.dspace.org/license/\n+ */\n+package org.dspace.app.rest;\n+\n+import java.util.List;\n+import javax.servlet.http.HttpServletRequest;\n+\n+import org.dspace.app.rest.converter.ConverterService;\n+import org.dspace.app.rest.model.CollectionRest;\n+import org.dspace.app.rest.model.WorkflowDefinitionRest;\n+import org.dspace.app.rest.utils.ContextUtil;\n+import org.dspace.app.rest.utils.Utils;\n+import org.dspace.content.Collection;\n+import org.dspace.core.Context;\n+import org.dspace.xmlworkflow.factory.XmlWorkflowFactory;\n+import org.springframework.beans.factory.annotation.Autowired;\n+import org.springframework.data.domain.Page;\n+import org.springframework.data.domain.Pageable;\n+import org.springframework.data.rest.webmvc.ResourceNotFoundException;\n+import org.springframework.web.bind.annotation.PathVariable;\n+import org.springframework.web.bind.annotation.RequestMapping;\n+import org.springframework.web.bind.annotation.RequestMethod;\n+import org.springframework.web.bind.annotation.RestController;\n+\n+/**\n+ * Rest controller that handles the config for workflow definitions\n+ *\n+ * @author Maria Verdonck (Atmire) on 11/12/2019\n+ */\n+@RestController\n+@RequestMapping(\"/api/\" + WorkflowDefinitionRest.CATEGORY + \"/\" + WorkflowDefinitionRest.NAME_PLURAL)\n+public class WorkflowDefinitionController {\n+\n+    @Autowired\n+    protected XmlWorkflowFactory xmlWorkflowFactory;\n+\n+    @Autowired\n+    protected ConverterService converter;\n+\n+    @Autowired\n+    protected Utils utils;\n+\n+    /**\n+     * GET endpoint that returns the list of collections that make an explicit use of the workflow-definition.\n+     * If a collection doesn't specify the workflow-definition to be used, the default mapping applies,\n+     * but this collection is not included in the list returned by this method.\n+     *\n+     * @param request      The request object\n+     * @param workflowName Name of workflow we want the collections of that are mapped to is\n+     * @return List of collections mapped to the requested workflow\n+     */\n+    @RequestMapping(method = RequestMethod.GET, value = \"/{workflowName}/collections\")\n+    public Page<CollectionRest> getCollections(HttpServletRequest request, @PathVariable String workflowName,\n+                                               Pageable pageable) {\n+        if (xmlWorkflowFactory.workflowByThisNameExists(workflowName)) {\n+            Context context = ContextUtil.obtainContext(request);\n+            List<Collection> collectionsMappedToWorkflow;\n+            if (xmlWorkflowFactory.isDefaultWorkflow(workflowName)) {\n+                collectionsMappedToWorkflow = xmlWorkflowFactory.getAllNonMappedCollectionsHandles(context);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "20d9b330d097676fbf4c7890f90c9642b87246d2"}, "originalPosition": 64}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "8b51ba692d9546651eda19d6f87965dcaaba712f", "author": {"user": {"login": "MarieVerdonck", "name": "Marie Verdonck"}}, "url": "https://github.com/DSpace/DSpace/commit/8b51ba692d9546651eda19d6f87965dcaaba712f", "committedDate": "2020-01-31T10:55:48Z", "message": "Merge remote-tracking branch 'dspace-origin/master' into workflow-step-definitions"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "aaa9d5ed2977d6e081c4e468737227ff660ff1f9", "author": {"user": {"login": "MarieVerdonck", "name": "Marie Verdonck"}}, "url": "https://github.com/DSpace/DSpace/commit/aaa9d5ed2977d6e081c4e468737227ff660ff1f9", "committedDate": "2020-01-31T12:10:42Z", "message": "[DS-2646]: javadoc & SUBMIT_EDIT_METADATA to ProcessingAction"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "1820659a804e9c6ab43406b32fcc20e1b1d5bc6d", "author": {"user": {"login": "MarieVerdonck", "name": "Marie Verdonck"}}, "url": "https://github.com/DSpace/DSpace/commit/1820659a804e9c6ab43406b32fcc20e1b1d5bc6d", "committedDate": "2020-01-31T12:11:40Z", "message": "[DS-2646]: api/config/workflowdefinitions/defaultWorkflow/collections :\nreturns all non-mapped collections & all collections specifically mapped to defaultWorkflow\n& Exception comment"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "6680d233e26942aa80dc2c2370b5e885a4e52724", "author": {"user": {"login": "MarieVerdonck", "name": "Marie Verdonck"}}, "url": "https://github.com/DSpace/DSpace/commit/6680d233e26942aa80dc2c2370b5e885a4e52724", "committedDate": "2020-01-31T15:03:36Z", "message": "[DS-2646]: checkstyle fix"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "bda2e510415a29c27da5404c077ed44150b8d746", "author": {"user": {"login": "KevinVdV", "name": "Kevin Van de Velde"}}, "url": "https://github.com/DSpace/DSpace/commit/bda2e510415a29c27da5404c077ed44150b8d746", "committedDate": "2020-02-03T12:15:30Z", "message": "Fixing configuration in the workflow-actions.xml test file"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f732577425e0305730f2ef9b33cba6d309bf066b", "author": {"user": {"login": "KevinVdV", "name": "Kevin Van de Velde"}}, "url": "https://github.com/DSpace/DSpace/commit/f732577425e0305730f2ef9b33cba6d309bf066b", "committedDate": "2020-02-03T12:15:57Z", "message": "Merge branch 'master' into workflow-step-definitions"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzUzODU5NzEy", "url": "https://github.com/DSpace/DSpace/pull/2646#pullrequestreview-353859712", "createdAt": "2020-02-05T16:30:42Z", "commit": {"oid": "f732577425e0305730f2ef9b33cba6d309bf066b"}, "state": "COMMENTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0wNVQxNjozMDo0MlrOFl-iJw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0wNVQxNjozNjoyNlrOFl-wDw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NTM2NjE4Mw==", "bodyText": "This controller is misnamed & seems to be mapping the same request path as WorkflowDefinitionRestRepository (and WorkflowDefinitionRest).   I'd recommend renaming this to WorkflowDefinitionCollectionController (or similar), as this controller is specifically managing the Collection relationship here.  We can also then add a more specific RequestMapping...along the lines of:\n@RequestMapping(\"/api/\" + WorkflowDefinitionRest.CATEGORY + \"/\" + WorkflowDefinitionRest.NAME_PLURAL + \"/{workflowName}/collections\")\npublic class WorkflowDefinitionCollectionsController {", "url": "https://github.com/DSpace/DSpace/pull/2646#discussion_r375366183", "createdAt": "2020-02-05T16:30:42Z", "author": {"login": "tdonohue"}, "path": "dspace-server-webapp/src/main/java/org/dspace/app/rest/WorkflowDefinitionController.java", "diffHunk": "@@ -0,0 +1,76 @@\n+/**\n+ * The contents of this file are subject to the license and copyright\n+ * detailed in the LICENSE and NOTICE files at the root of the source\n+ * tree and available online at\n+ *\n+ * http://www.dspace.org/license/\n+ */\n+package org.dspace.app.rest;\n+\n+import java.util.ArrayList;\n+import java.util.List;\n+import javax.servlet.http.HttpServletRequest;\n+\n+import org.dspace.app.rest.converter.ConverterService;\n+import org.dspace.app.rest.model.CollectionRest;\n+import org.dspace.app.rest.model.WorkflowDefinitionRest;\n+import org.dspace.app.rest.utils.ContextUtil;\n+import org.dspace.app.rest.utils.Utils;\n+import org.dspace.content.Collection;\n+import org.dspace.core.Context;\n+import org.dspace.xmlworkflow.factory.XmlWorkflowFactory;\n+import org.springframework.beans.factory.annotation.Autowired;\n+import org.springframework.data.domain.Page;\n+import org.springframework.data.domain.Pageable;\n+import org.springframework.data.rest.webmvc.ResourceNotFoundException;\n+import org.springframework.web.bind.annotation.PathVariable;\n+import org.springframework.web.bind.annotation.RequestMapping;\n+import org.springframework.web.bind.annotation.RequestMethod;\n+import org.springframework.web.bind.annotation.RestController;\n+\n+/**\n+ * Rest controller that handles the config for workflow definitions\n+ *\n+ * @author Maria Verdonck (Atmire) on 11/12/2019\n+ */\n+@RestController\n+@RequestMapping(\"/api/\" + WorkflowDefinitionRest.CATEGORY + \"/\" + WorkflowDefinitionRest.NAME_PLURAL)\n+public class WorkflowDefinitionController {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f732577425e0305730f2ef9b33cba6d309bf066b"}, "originalPosition": 38}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NTM2OTc0Mw==", "bodyText": "This class seems unnecessary to me, as it's just calling the setup() of AbstractControllerIntegrationTest.  Is there a reason why we don't just remove this class and use AbstractControllerIntegrationTest directly?", "url": "https://github.com/DSpace/DSpace/pull/2646#discussion_r375369743", "createdAt": "2020-02-05T16:36:26Z", "author": {"login": "tdonohue"}, "path": "dspace-server-webapp/src/test/java/org/dspace/app/rest/test/AbstractWorkflowDefinitionIntegrationTest.java", "diffHunk": "@@ -0,0 +1,20 @@\n+/**\n+ * The contents of this file are subject to the license and copyright\n+ * detailed in the LICENSE and NOTICE files at the root of the source\n+ * tree and available online at\n+ *\n+ * http://www.dspace.org/license/\n+ */\n+package org.dspace.app.rest.test;\n+\n+/**\n+ * @author Maria Verdonck (Atmire) on 17/12/2019\n+ */\n+public class AbstractWorkflowDefinitionIntegrationTest extends AbstractControllerIntegrationTest {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f732577425e0305730f2ef9b33cba6d309bf066b"}, "originalPosition": 13}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "2fd967744c052b59eae9a84739cef61882bba7c7", "author": {"user": {"login": "MarieVerdonck", "name": "Marie Verdonck"}}, "url": "https://github.com/DSpace/DSpace/commit/2fd967744c052b59eae9a84739cef61882bba7c7", "committedDate": "2020-02-10T10:05:52Z", "message": "[DS-2646]: Workflow Endpoints now need authenticated access + tests:\nWorkflowDefinition, WorkflowActions & WorkflowSteps Endpoints"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e35e5a6b3a80b22e95e61efe21002176ffbe9788", "author": {"user": {"login": "MarieVerdonck", "name": "Marie Verdonck"}}, "url": "https://github.com/DSpace/DSpace/commit/e35e5a6b3a80b22e95e61efe21002176ffbe9788", "committedDate": "2020-02-10T13:27:49Z", "message": "[DS-2646]: /workflowdefinitions/<:name>/collections via @LinkRest (Controller to LinkRepository)\nand /steps set embedOptional to true\n> /workflowdefinitions/<:name> has links of subresources, but no embeds"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "1f8e44079393a8c9f53c75e2cf7f74d84096976c", "author": {"user": {"login": "MarieVerdonck", "name": "Marie Verdonck"}}, "url": "https://github.com/DSpace/DSpace/commit/1f8e44079393a8c9f53c75e2cf7f74d84096976c", "committedDate": "2020-02-10T14:18:58Z", "message": "[DS-2646]: checkstyle"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c1193c68904b9f9b1505c3b79006acb355dd95e8", "author": {"user": {"login": "MarieVerdonck", "name": "Marie Verdonck"}}, "url": "https://github.com/DSpace/DSpace/commit/c1193c68904b9f9b1505c3b79006acb355dd95e8", "committedDate": "2020-02-10T15:25:26Z", "message": "[DS-2646]: test fix"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzU3MDYxNDk3", "url": "https://github.com/DSpace/DSpace/pull/2646#pullrequestreview-357061497", "createdAt": "2020-02-11T23:03:54Z", "commit": {"oid": "c1193c68904b9f9b1505c3b79006acb355dd95e8"}, "state": "COMMENTED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "0c9e50ca721e856f967c28d6d8ca36b6600d0f24", "author": {"user": {"login": "MarieVerdonck", "name": "Marie Verdonck"}}, "url": "https://github.com/DSpace/DSpace/commit/0c9e50ca721e856f967c28d6d8ca36b6600d0f24", "committedDate": "2020-02-12T15:46:14Z", "message": "[DS-2646]: /workflowdefintions/<:name>/steps fixed + new tests &\nendpoint result names changed to without Resource"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "207f7455125e8ac51685add70a10ce8683cbd7c1", "author": {"user": {"login": "MarieVerdonck", "name": "Marie Verdonck"}}, "url": "https://github.com/DSpace/DSpace/commit/207f7455125e8ac51685add70a10ce8683cbd7c1", "committedDate": "2020-02-12T17:29:08Z", "message": "[DS-2646]: test and checkstyle fixes"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c498838e3932d1afc76148dfd61569a4971f0229", "author": {"user": {"login": "KevinVdV", "name": "Kevin Van de Velde"}}, "url": "https://github.com/DSpace/DSpace/commit/c498838e3932d1afc76148dfd61569a4971f0229", "committedDate": "2020-02-19T08:39:21Z", "message": "Merge remote-tracking branch 'upstream/master' into workflow-step-definitions"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "570f77d1a629bfa6e0cf9f8ae69d17fbf030f457", "author": {"user": {"login": "MarieVerdonck", "name": "Marie Verdonck"}}, "url": "https://github.com/DSpace/DSpace/commit/570f77d1a629bfa6e0cf9f8ae69d17fbf030f457", "committedDate": "2020-02-19T14:28:35Z", "message": "68860: test fixes after merging latest dspace-origin/master"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ff30538dadb72a48ac5bad94da43ae0a764fabd6", "author": {"user": {"login": "MarieVerdonck", "name": "Marie Verdonck"}}, "url": "https://github.com/DSpace/DSpace/commit/ff30538dadb72a48ac5bad94da43ae0a764fabd6", "committedDate": "2020-02-24T11:55:58Z", "message": "Merge remote-tracking branch 'dspace-origin/master' into workflow-step-definitions\n\n# Conflicts:\n#\tdspace-api/src/test/java/org/dspace/xmlworkflow/XmlWorkflowFactoryTest.java"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d395be6a3e67a2082688b133d0cbdf641b836135", "author": {"user": {"login": "MarieVerdonck", "name": "Marie Verdonck"}}, "url": "https://github.com/DSpace/DSpace/commit/d395be6a3e67a2082688b133d0cbdf641b836135", "committedDate": "2020-02-24T12:24:07Z", "message": "test fix after master merge"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e0acfbc6e44c0fcba2b1fe67014dd7bde6bd7646", "author": {"user": {"login": "MarieVerdonck", "name": "Marie Verdonck"}}, "url": "https://github.com/DSpace/DSpace/commit/e0acfbc6e44c0fcba2b1fe67014dd7bde6bd7646", "committedDate": "2020-02-24T12:27:08Z", "message": "constant for expected http status"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ffc1505f010ef920392264b919b98b964c52221a", "author": {"user": {"login": "MarieVerdonck", "name": "Marie Verdonck"}}, "url": "https://github.com/DSpace/DSpace/commit/ffc1505f010ef920392264b919b98b964c52221a", "committedDate": "2020-02-24T13:29:04Z", "message": "LinkRepositories so that subresources paths work without projection=full (for workflowdefinitions/defaultWorkflow/steps and /workflowsteps/editstep/actions)"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c4548d3c6115a0b0f223e5503d1ccdea91a2f1fa", "author": {"user": {"login": "MarieVerdonck", "name": "Marie Verdonck"}}, "url": "https://github.com/DSpace/DSpace/commit/c4548d3c6115a0b0f223e5503d1ccdea91a2f1fa", "committedDate": "2020-02-24T14:10:46Z", "message": "missing licenses"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "8a83d344f526e51ccbb1768250d5b511125e1c5e", "author": {"user": {"login": "MarieVerdonck", "name": "Marie Verdonck"}}, "url": "https://github.com/DSpace/DSpace/commit/8a83d344f526e51ccbb1768250d5b511125e1c5e", "committedDate": "2020-02-24T14:52:37Z", "message": "checkstyle"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzYzNzIyMTA0", "url": "https://github.com/DSpace/DSpace/pull/2646#pullrequestreview-363722104", "createdAt": "2020-02-24T21:42:37Z", "commit": {"oid": "e0acfbc6e44c0fcba2b1fe67014dd7bde6bd7646"}, "state": "APPROVED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yNFQyMTo0MjozOFrOFtw7Fw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yNFQyMTo0MjozOFrOFtw7Fw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MzUzMTc5OQ==", "bodyText": "@MarieVerdonck : This could be simplified by writing\n.andExpect(status().isBadRequest());   You'll see similar code in other ITs in our codebase.", "url": "https://github.com/DSpace/DSpace/pull/2646#discussion_r383531799", "createdAt": "2020-02-24T21:42:38Z", "author": {"login": "tdonohue"}, "path": "dspace-server-webapp/src/test/java/org/dspace/app/rest/WorkflowDefinitionRestRepositoryIT.java", "diffHunk": "@@ -239,7 +240,7 @@ public void getWorkflowDefinitionByCollectionId_nonValidUUID() throws Exception\n         //When we call this facets endpoint\n         getClient(token).perform(get(WORKFLOW_DEFINITIONS_ENDPOINT + \"/search/findByCollection?uuid=\" + nonValidUUID))\n             //We expect a 400 Illegal Argument Exception cannot convert UUID\n-            .andExpect(status().is(400))\n+            .andExpect(status().is(HttpStatus.SC_BAD_REQUEST))", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e0acfbc6e44c0fcba2b1fe67014dd7bde6bd7646"}, "originalPosition": 13}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzYzOTU3MDUw", "url": "https://github.com/DSpace/DSpace/pull/2646#pullrequestreview-363957050", "createdAt": "2020-02-25T08:46:14Z", "commit": {"oid": "8a83d344f526e51ccbb1768250d5b511125e1c5e"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ba6792a43cbce32272d01f624318f8f1cb388831", "author": {"user": {"login": "MarieVerdonck", "name": "Marie Verdonck"}}, "url": "https://github.com/DSpace/DSpace/commit/ba6792a43cbce32272d01f624318f8f1cb388831", "committedDate": "2020-02-25T09:40:16Z", "message": "is(HttpStatus.SC_BAD_REQUEST) to isBadRequest()"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": null, "afterCommit": {"oid": "ba6792a43cbce32272d01f624318f8f1cb388831", "author": {"user": {"login": "MarieVerdonck", "name": "Marie Verdonck"}}, "url": "https://github.com/DSpace/DSpace/commit/ba6792a43cbce32272d01f624318f8f1cb388831", "committedDate": "2020-02-25T09:40:16Z", "message": "is(HttpStatus.SC_BAD_REQUEST) to isBadRequest()"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1558, "cost": 1, "resetAt": "2021-11-01T13:51:04Z"}}}