{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0Mzc5MDkwNTg4", "number": 2690, "title": "DS-4380:  Update XOAI (OAI-PMH) for full JDK11 compatibility", "bodyText": "Minor PR to update to XOAI v3.3.0, which is more compatible with JDK11.  In XOAI v3.3.0, I've updated dependencies to avoid any \"An illegal reflective access operation has occurred\" warnings when running JDK 9 or above.  See https://github.com/DSpace/xoai/releases/tag/xoai-3.3.0\nThis PR also makes a minor refactor to the classes which obtain the Solr configuration for dspace-oai to ensure they provide better logging & use the more correct version of the configuration oai.solr.url.\nI've tested both of these minor changes locally and they work well on latest master and with JDK11.", "createdAt": "2020-02-24T16:40:22Z", "url": "https://github.com/DSpace/DSpace/pull/2690", "merged": true, "mergeCommit": {"oid": "9910d89caab8d8254b560b37d4877901034e098c"}, "closed": true, "closedAt": "2020-02-24T17:24:07Z", "author": {"login": "tdonohue"}, "timelineItems": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcHgNVqgH2gAyMzc5MDkwNTg4OjhjY2VlYThmMDZmZWMwYmY5ZGY2ZjgzZjA2NDFkOGVmMDgzNTM3ZDk=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcHhDtKAFqTM2MzU2ODM0Mg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "8cceea8f06fec0bf9df6f83f0641d8ef083537d9", "author": {"user": {"login": "tdonohue", "name": "Tim Donohue"}}, "url": "https://github.com/DSpace/DSpace/commit/8cceea8f06fec0bf9df6f83f0641d8ef083537d9", "committedDate": "2020-02-24T16:35:05Z", "message": "Upgrade to XOAI 3.3.0 for JDK11 compatibility."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d78f3c393b85e824e82262e9a2017ef8afd75cf6", "author": {"user": {"login": "tdonohue", "name": "Tim Donohue"}}, "url": "https://github.com/DSpace/DSpace/commit/d78f3c393b85e824e82262e9a2017ef8afd75cf6", "committedDate": "2020-02-24T16:35:14Z", "message": "Minor refactor to make it easier to debug OAI Solr connection problems. Update to new config format"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzYzNTQyNTE1", "url": "https://github.com/DSpace/DSpace/pull/2690#pullrequestreview-363542515", "createdAt": "2020-02-24T16:52:10Z", "commit": {"oid": "d78f3c393b85e824e82262e9a2017ef8afd75cf6"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzYzNTY4MzQy", "url": "https://github.com/DSpace/DSpace/pull/2690#pullrequestreview-363568342", "createdAt": "2020-02-24T17:29:05Z", "commit": {"oid": "d78f3c393b85e824e82262e9a2017ef8afd75cf6"}, "state": "COMMENTED", "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yNFQxNzoyOTowNVrOFtpTrw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yNFQxNzozMjozNVrOFtpbGQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MzQwNzAyMw==", "bodyText": "Switch to ConfigurationService?", "url": "https://github.com/DSpace/DSpace/pull/2690#discussion_r383407023", "createdAt": "2020-02-24T17:29:05Z", "author": {"login": "mwoodiupui"}, "path": "dspace-oai/src/main/java/org/dspace/xoai/solr/DSpaceSolrServer.java", "diffHunk": "@@ -30,12 +30,12 @@ private DSpaceSolrServer() { }\n \n     public static SolrClient getServer() throws SolrServerException {\n         if (_server == null) {\n+            String serverUrl = ConfigurationManager.getProperty(\"oai.solr.url\");", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d78f3c393b85e824e82262e9a2017ef8afd75cf6"}, "originalPosition": 4}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MzQwODg4MA==", "bodyText": "Parameterize?", "url": "https://github.com/DSpace/DSpace/pull/2690#discussion_r383408880", "createdAt": "2020-02-24T17:32:30Z", "author": {"login": "mwoodiupui"}, "path": "dspace-oai/src/main/java/org/dspace/xoai/solr/DSpaceSolrServer.java", "diffHunk": "@@ -30,12 +30,12 @@ private DSpaceSolrServer() { }\n \n     public static SolrClient getServer() throws SolrServerException {\n         if (_server == null) {\n+            String serverUrl = ConfigurationManager.getProperty(\"oai.solr.url\");\n             try {\n-                _server = new HttpSolrClient.Builder(\n-                    ConfigurationManager.getProperty(\"oai\", \"solr.url\")).build();\n-                log.debug(\"Solr Server Initialized\");\n+                _server = new HttpSolrClient.Builder(serverUrl).build();\n+                log.debug(\"OAI Solr Server Initialized\");\n             } catch (Exception e) {\n-                log.error(e.getMessage(), e);\n+                log.error(\"Could not initialize OAI Solr Server at \" + serverUrl , e);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d78f3c393b85e824e82262e9a2017ef8afd75cf6"}, "originalPosition": 13}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MzQwODkyMQ==", "bodyText": "Message could be parameterized:  log.error(\"Could not initializa OAI Solr Server at {}\", serverUrl, e);\nUnlikely to save many cycles, but it's a good habit to get into.", "url": "https://github.com/DSpace/DSpace/pull/2690#discussion_r383408921", "createdAt": "2020-02-24T17:32:35Z", "author": {"login": "mwoodiupui"}, "path": "dspace-oai/src/main/java/org/dspace/xoai/services/impl/solr/DSpaceSolrServerResolver.java", "diffHunk": "@@ -26,11 +26,12 @@\n     @Override\n     public SolrClient getServer() throws SolrServerException {\n         if (server == null) {\n+            String serverUrl = configurationService.getProperty(\"oai.solr.url\");\n             try {\n-                server = new HttpSolrClient.Builder(configurationService.getProperty(\"oai\", \"solr.url\")).build();\n-                log.debug(\"Solr Server Initialized\");\n+                server = new HttpSolrClient.Builder(serverUrl).build();\n+                log.debug(\"OAI Solr Server Initialized\");\n             } catch (Exception e) {\n-                log.error(e.getMessage(), e);\n+                log.error(\"Could not initialize OAI Solr Server at \" + serverUrl , e);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d78f3c393b85e824e82262e9a2017ef8afd75cf6"}, "originalPosition": 12}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1628, "cost": 1, "resetAt": "2021-11-01T13:51:04Z"}}}