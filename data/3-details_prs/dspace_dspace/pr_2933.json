{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDcwMTY0MzE1", "number": 2933, "title": "Cookie preferences & End User Agreement per account - initial registries update", "bodyText": "References\n\nFixes GitHub issue\n\nDescription\nThis adds in the initial metadatafields for the cookie preference related work.\nThe current fields have been provided by @artlowel as he is handling the Angular version implementation of this.\nInstructions for Reviewers\nThis basically only adds in some metadatafields, and adds in a check to make sure that these metadatas exist and can be filled in on an eperson level.\nChecklist\nThis checklist provides a reminder of what we are going to look for when reviewing your PR. You need not complete this checklist prior to creating your PR (draft PRs are always welcome). If you are unsure about an item in the checklist, don't hesitate to ask. We're here to help!\n\n My PR is small in size (e.g. less than 1,000 lines of code, not including comments & integration tests). Exceptions may be made if previously agreed upon.\n My PR passes Checkstyle validation based on the Code Style Guide.\n My PR includes Javadoc for all new (or modified) public methods and classes. It also includes Javadoc for large or complex private methods.\n My PR passes all tests and includes new/updated Unit or Integration Tests based on the Code Testing Guide.\n If my PR includes new, third-party dependencies (in any pom.xml), I've made sure their licenses align with the DSpace BSD License based on the Licensing of Contributions documentation.\n If my PR modifies the REST API, I've linked to the REST Contract page (or open PR) related to this change.", "createdAt": "2020-08-19T13:26:55Z", "url": "https://github.com/DSpace/DSpace/pull/2933", "merged": true, "mergeCommit": {"oid": "bb6413af106848379aa10bc45eec2d115bff0865"}, "closed": true, "closedAt": "2020-09-03T15:06:46Z", "author": {"login": "jonas-atmire"}, "timelineItems": {"totalCount": 8, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABc-kFGCAH2gAyNDcwMTY0MzE1OmUxZmI4Nzc3M2M0YWFjMTgwNzJmYjhlZWYzN2NmODY2OTQ1ZDk1ZTQ=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdDWxksAFqTQ3NzgyNTk5OA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "e1fb87773c4aac18072fb8eef37cf866945d95e4", "author": {"user": {"login": "samuelcambien", "name": "Samuel Cambien (Atmire)"}}, "url": "https://github.com/DSpace/DSpace/commit/e1fb87773c4aac18072fb8eef37cf866945d95e4", "committedDate": "2020-08-13T18:11:32Z", "message": "taskid 72455 Cookie Preferences per account"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "5eaee53c6b8f598e6c1392dc12660b7505646fcf", "author": {"user": {"login": "samuelcambien", "name": "Samuel Cambien (Atmire)"}}, "url": "https://github.com/DSpace/DSpace/commit/5eaee53c6b8f598e6c1392dc12660b7505646fcf", "committedDate": "2020-08-19T13:16:59Z", "message": "taskid 72455 Cookie Preferences per account - feedback"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "899f04c5ed1651ce04c3a51e1442c9d9cd4bac81", "author": {"user": {"login": "jonas-atmire", "name": "Jonas Van Goolen"}}, "url": "https://github.com/DSpace/DSpace/commit/899f04c5ed1651ce04c3a51e1442c9d9cd4bac81", "committedDate": "2020-08-20T11:06:02Z", "message": "Additional metadatafield related to the cookie preferences"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "1773b40acb9fe65488abc59e8c101c66767650c8", "author": {"user": {"login": "jonas-atmire", "name": "Jonas Van Goolen"}}, "url": "https://github.com/DSpace/DSpace/commit/1773b40acb9fe65488abc59e8c101c66767650c8", "committedDate": "2020-08-20T12:53:31Z", "message": "Checkstyle fix"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDcxNjU1Njg3", "url": "https://github.com/DSpace/DSpace/pull/2933#pullrequestreview-471655687", "createdAt": "2020-08-20T14:12:39Z", "commit": {"oid": "1773b40acb9fe65488abc59e8c101c66767650c8"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yMFQxNDoxMjozOVrOHEDjTw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yMFQxNDoxMjozOVrOHEDjTw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NDAxNDU0Mw==", "bodyText": "I would prefer to have dspace.agreements.acceptedDate storing the timestamp of the acceptance. Anyway it would be better to add some scope note about how it will be used", "url": "https://github.com/DSpace/DSpace/pull/2933#discussion_r474014543", "createdAt": "2020-08-20T14:12:39Z", "author": {"login": "abollini"}, "path": "dspace/config/registries/dspace-types.xml", "diffHunk": "@@ -16,5 +16,18 @@\n         <scope_note></scope_note>\n     </dc-type>\n \n+    <dc-type>\n+        <schema>dspace</schema>\n+        <element>agreements</element>\n+        <qualifier>end-user</qualifier>", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "1773b40acb9fe65488abc59e8c101c66767650c8"}, "originalPosition": 7}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDcyNTU2Mjc3", "url": "https://github.com/DSpace/DSpace/pull/2933#pullrequestreview-472556277", "createdAt": "2020-08-21T14:51:26Z", "commit": {"oid": "1773b40acb9fe65488abc59e8c101c66767650c8"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yMVQxNDo1MToyNlrOHEwT_A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yMVQxNDo1NToyMFrOHEwdow==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NDc0NzkwMA==", "bodyText": "I would like to see these tests have more accurate sample metadata.  So, based on the discussion in this ticket, the end-user field should likely be set to true, and the cookies field should store a sample Klaro cookie (if we know what that looks like...if we do not, some sort of sample array of values is good enough).  That would help us better document how these fields are expected to be used.", "url": "https://github.com/DSpace/DSpace/pull/2933#discussion_r474747900", "createdAt": "2020-08-21T14:51:26Z", "author": {"login": "tdonohue"}, "path": "dspace-api/src/test/java/org/dspace/eperson/EPersonTest.java", "diffHunk": "@@ -78,6 +78,23 @@ public void destroy() {\n         super.destroy();\n     }\n \n+    @Test\n+    public void testPreferences() throws Exception {\n+\n+        ePersonService.addMetadata(context, eperson, \"dspace\", \"agreements\", \"end-user\", null, \"test\");\n+        ePersonService.addMetadata(context, eperson, \"dspace\", \"agreements\", \"cookies\", null,\n+                                   \"Dspace cookies agreement metadata\");", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "1773b40acb9fe65488abc59e8c101c66767650c8"}, "originalPosition": 9}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NDc0ODk2MA==", "bodyText": "As noted elsewhere, we should add a scope note here.  It could say something like: \"Stores whether the End User Agreement has been accepted by an EPerson. Valid values; true, false\"", "url": "https://github.com/DSpace/DSpace/pull/2933#discussion_r474748960", "createdAt": "2020-08-21T14:53:09Z", "author": {"login": "tdonohue"}, "path": "dspace/config/registries/dspace-types.xml", "diffHunk": "@@ -16,5 +16,18 @@\n         <scope_note></scope_note>\n     </dc-type>\n \n+    <dc-type>\n+        <schema>dspace</schema>\n+        <element>agreements</element>\n+        <qualifier>end-user</qualifier>\n+        <scope_note></scope_note>", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "1773b40acb9fe65488abc59e8c101c66767650c8"}, "originalPosition": 8}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NDc1MDM3MQ==", "bodyText": "Same here, should have a scope note.  It could say something like: \"Stores the cookie preferences of an EPerson, as selected in last session. Value will be an array of cookieName/boolean pairs, specifying which cookies are allowed or not allowed.\"  (Please verify this for accuracy, but I think that's correct.)", "url": "https://github.com/DSpace/DSpace/pull/2933#discussion_r474750371", "createdAt": "2020-08-21T14:55:20Z", "author": {"login": "tdonohue"}, "path": "dspace/config/registries/dspace-types.xml", "diffHunk": "@@ -16,5 +16,18 @@\n         <scope_note></scope_note>\n     </dc-type>\n \n+    <dc-type>\n+        <schema>dspace</schema>\n+        <element>agreements</element>\n+        <qualifier>end-user</qualifier>\n+        <scope_note></scope_note>\n+    </dc-type>\n+\n+    <dc-type>\n+        <schema>dspace</schema>\n+        <element>agreements</element>\n+        <qualifier>cookies</qualifier>\n+        <scope_note></scope_note>", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "1773b40acb9fe65488abc59e8c101c66767650c8"}, "originalPosition": 15}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "8adc7e5c318bd09dcf38133319da61d67b261328", "author": {"user": {"login": "samuelcambien", "name": "Samuel Cambien (Atmire)"}}, "url": "https://github.com/DSpace/DSpace/commit/8adc7e5c318bd09dcf38133319da61d67b261328", "committedDate": "2020-08-28T13:26:22Z", "message": "taskid 72455 Cookie Preferences per account - add scope notes and more realistic test value"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDc3ODI1OTk4", "url": "https://github.com/DSpace/DSpace/pull/2933#pullrequestreview-477825998", "createdAt": "2020-08-28T15:31:04Z", "commit": {"oid": "8adc7e5c318bd09dcf38133319da61d67b261328"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1322, "cost": 1, "resetAt": "2021-11-01T13:51:04Z"}}}