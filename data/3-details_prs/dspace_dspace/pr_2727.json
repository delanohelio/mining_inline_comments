{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0Mzk2MzkxNDkz", "number": 2727, "title": " Administer Workflow (Abort WorkflowItem, Delete WorkflowItem)", "bodyText": "References\n\nLink to REST Contract\n\nDescription\nThis includes support for building an administer workflow page and the corresponding actions. This is part of beta 3\nInstructions for Reviewers\nList of changes in this PR:\n\nThis includes support for the expunge parameter in the DELETE call\nThis adds a workflowAdmin discovery configuration where admins can view all workflow items (not just their own).\nThis moves the code for handling the workspace and workflow items filtering to  SolrServiceWorkspaceWorkflowRestrictionPlugin and the indexing to SolrServiceResourceRestrictionPlugin. This removes overrides of the behavior in the SolrServiceImpl\n\nChecklist\n\n My PR is small in size\n My PR passes Checkstyle validation based on the Code Style Guide\n My PR includes Javadoc for all new (or modified) public methods and classes. It also includes Javadoc for large or complex private methods. (WIP)\n My PR passes all tests and includes new/updated Unit or Integration Tests for any bug fixes, improvements or new features. A few reminders about what constitutes good tests:\n If my PR modifies the REST API, I've linked to the REST Contract page (or open PR) related to this change.\n My PR is compatible with master. (WIP)", "createdAt": "2020-03-31T14:54:28Z", "url": "https://github.com/DSpace/DSpace/pull/2727", "merged": true, "mergeCommit": {"oid": "e4ab84e29bd1913975674b2839108cad47683b33"}, "closed": true, "closedAt": "2020-05-01T14:48:54Z", "author": {"login": "benbosman"}, "timelineItems": {"totalCount": 16, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcO4jzqgH2gAyMzk2MzkxNDkzOmNjNDcxYzRmNTBmZDgxOTFiYjgwM2M1MmUyYTE4YzRlZTIxOGM5ZjU=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcdC2EMgFqTQwNDIwMDMyMQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "cc471c4f50fd8191bb803c52e2a18c4ee218c9f5", "author": {"user": {"login": "antoine-atmire", "name": "Antoine Snyers"}}, "url": "https://github.com/DSpace/DSpace/commit/cc471c4f50fd8191bb803c52e2a18c4ee218c9f5", "committedDate": "2020-03-18T14:54:49Z", "message": "Add the SolrServiceWorkspaceWorkflowRestrictionPlugin and the workflowAdmin bean\n\nThis moves some workspace and workflow specific code from SolrServiceImpl to\nthe new SolrServiceWorkspaceWorkflowRestrictionPlugin. This also updates the\nSolrServiceResourceRestrictionPlugin to restrict those records based on read\nrights as well."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "224d252f1ab440aa0bd2c8625d6df63363af3238", "author": {"user": {"login": "antoine-atmire", "name": "Antoine Snyers"}}, "url": "https://github.com/DSpace/DSpace/commit/224d252f1ab440aa0bd2c8625d6df63363af3238", "committedDate": "2020-03-25T13:13:03Z", "message": "Add comments to discovery.xml config and move constants to plugin class"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "63bacbde32da384dd8d74adecfc0d318126f14cf", "author": {"user": {"login": "antoine-atmire", "name": "Antoine Snyers"}}, "url": "https://github.com/DSpace/DSpace/commit/63bacbde32da384dd8d74adecfc0d318126f14cf", "committedDate": "2020-03-26T08:52:06Z", "message": "Add an integration test for the workflowAdmin configuration"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "db1ce66b9aeab4ca0ad423c35196c253322c108e", "author": {"user": {"login": "antoine-atmire", "name": "Antoine Snyers"}}, "url": "https://github.com/DSpace/DSpace/commit/db1ce66b9aeab4ca0ad423c35196c253322c108e", "committedDate": "2020-03-31T09:20:32Z", "message": "Add license to new java file"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "40fd23aee9779a7b9176b75d09fcbd94827356bc", "author": {"user": {"login": "antoine-atmire", "name": "Antoine Snyers"}}, "url": "https://github.com/DSpace/DSpace/commit/40fd23aee9779a7b9176b75d09fcbd94827356bc", "committedDate": "2020-03-31T11:33:45Z", "message": "Update imports"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "102a2e8d6acc895ab887acf9420630fd5fcd868d", "author": {"user": {"login": "antoine-atmire", "name": "Antoine Snyers"}}, "url": "https://github.com/DSpace/DSpace/commit/102a2e8d6acc895ab887acf9420630fd5fcd868d", "committedDate": "2020-04-01T09:53:46Z", "message": "Merge remote-tracking branch 'upstream/master' into workflow-item-read-rights"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "eff40c4f8213bbd5f92b8a51fc42dd65846232a4", "author": {"user": {"login": "antoine-atmire", "name": "Antoine Snyers"}}, "url": "https://github.com/DSpace/DSpace/commit/eff40c4f8213bbd5f92b8a51fc42dd65846232a4", "committedDate": "2020-04-01T10:40:04Z", "message": "Update javadoc"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "03427d1cddc080618215946713048d9e8ac8b3d8", "author": {"user": {"login": "antoine-atmire", "name": "Antoine Snyers"}}, "url": "https://github.com/DSpace/DSpace/commit/03427d1cddc080618215946713048d9e8ac8b3d8", "committedDate": "2020-04-01T13:35:36Z", "message": "Update javadoc"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "af523ea822d5b7b140a99753cdb804f385a5b42e", "author": {"user": {"login": "antoine-atmire", "name": "Antoine Snyers"}}, "url": "https://github.com/DSpace/DSpace/commit/af523ea822d5b7b140a99753cdb804f385a5b42e", "committedDate": "2020-04-02T07:19:37Z", "message": "Rearrange imports"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "3dc413c366787ebbaa82bdd0fb13e3853b63e5d9", "author": {"user": {"login": "antoine-atmire", "name": "Antoine Snyers"}}, "url": "https://github.com/DSpace/DSpace/commit/3dc413c366787ebbaa82bdd0fb13e3853b63e5d9", "committedDate": "2020-04-02T12:29:29Z", "message": "Make a separate bean for workflowAdmin and clarify the comments in the ITs"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzg3NzMwODAz", "url": "https://github.com/DSpace/DSpace/pull/2727#pullrequestreview-387730803", "createdAt": "2020-04-04T20:09:10Z", "commit": {"oid": "3dc413c366787ebbaa82bdd0fb13e3853b63e5d9"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wNFQyMDowOToxMFrOGA0Y0w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wNFQyMDowOToxMFrOGA0Y0w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMzUxMTUwNw==", "bodyText": "would not be better to index the wrofklowitem directly and just limit this configuration to retrieve the workflowitem instead than tasks? the UI need to list the workflowitem and delete / reset such workflow. A single workflow could result in multiple tasks depending on the workflow steps so there is not necessary a one to one mapping. Having the count in the UI based on tasks instead than workflow could generate confusion in the admin", "url": "https://github.com/DSpace/DSpace/pull/2727#discussion_r403511507", "createdAt": "2020-04-04T20:09:10Z", "author": {"login": "abollini"}, "path": "dspace/config/spring/api/discovery.xml", "diffHunk": "@@ -807,6 +815,83 @@\n         <property name=\"spellCheckEnabled\" value=\"true\"/>\n     </bean>\n \n+    <!--The workflowAdmin configuration settings for discovery -->\n+    <bean id=\"workflowAdminConfiguration\"\n+        class=\"org.dspace.discovery.configuration.DiscoveryConfiguration\"\n+        scope=\"prototype\">\n+        <property name=\"id\" value=\"workflowAdmin\" />\n+        <!--Which sidebar facets are to be displayed -->\n+        <property name=\"sidebarFacets\">\n+            <list>\n+                <ref bean=\"searchFilterObjectNamedType\" />\n+                <ref bean=\"searchFilterType\" />\n+                <ref bean=\"searchFilterIssued\" />\n+                <ref bean=\"searchFilterSubmitter\" />\n+            </list>\n+        </property>\n+        <!--The search filters which can be used on the discovery search page -->\n+        <property name=\"searchFilters\">\n+            <list>\n+                <ref bean=\"searchFilterObjectNamedType\" />\n+                <ref bean=\"searchFilterType\" />\n+                <ref bean=\"searchFilterIssued\" />\n+                <ref bean=\"searchFilterSubmitter\" />\n+            </list>\n+        </property>\n+        <!--The sort filters for the discovery search-->\n+        <property name=\"searchSortConfiguration\">\n+            <bean class=\"org.dspace.discovery.configuration.DiscoverySortConfiguration\">\n+                <!--<property name=\"defaultSort\" ref=\"sortDateIssued\"/>-->\n+                <!--DefaultSortOrder can either be desc or asc (desc is default)-->\n+                <property name=\"defaultSortOrder\" value=\"desc\"/>\n+                <property name=\"sortFields\">\n+                    <list>\n+                        <ref bean=\"sortTitle\" />\n+                        <ref bean=\"sortDateIssued\" />\n+                    </list>\n+                </property>\n+            </bean>\n+        </property>\n+        <!--Any default filter queries, these filter queries will be used for all\n+            queries done by discovery for this configuration -->\n+        <property name=\"defaultFilterQueries\">\n+            <list>\n+                <!--Only find PoolTask and ClaimedTask -->\n+                <value>search.resourcetype:PoolTask OR search.resourcetype:ClaimedTask</value>", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "3dc413c366787ebbaa82bdd0fb13e3853b63e5d9"}, "originalPosition": 72}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzk0MDk2NTMz", "url": "https://github.com/DSpace/DSpace/pull/2727#pullrequestreview-394096533", "createdAt": "2020-04-15T20:06:40Z", "commit": {"oid": "3dc413c366787ebbaa82bdd0fb13e3853b63e5d9"}, "state": "COMMENTED", "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xNVQyMDowNjo0MFrOGGJpUw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xNVQyMDoxMDozNFrOGGJxXA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwOTEwMjY3NQ==", "bodyText": "Not necessarily required of this PR, but this big if/else if seems like something we should refactor at some point.  It implies to me that IndexableInProgressSubmission, IndexablePoolTask and IndexableClaimedTask should all implement an interface that has a getDSO() (or getRelatedDSO()) method.   That would make this easier to extend in the future.", "url": "https://github.com/DSpace/DSpace/pull/2727#discussion_r409102675", "createdAt": "2020-04-15T20:06:40Z", "author": {"login": "tdonohue"}, "path": "dspace-api/src/main/java/org/dspace/discovery/SolrServiceResourceRestrictionPlugin.java", "diffHunk": "@@ -61,8 +66,21 @@\n \n     @Override\n     public void additionalIndex(Context context, IndexableObject idxObj, SolrInputDocument document) {\n+        DSpaceObject dso = null;\n         if (idxObj instanceof IndexableDSpaceObject) {\n-            DSpaceObject dso = ((IndexableDSpaceObject) idxObj).getIndexedObject();\n+            dso = ((IndexableDSpaceObject) idxObj).getIndexedObject();\n+        } else if (idxObj instanceof IndexableInProgressSubmission) {\n+            final InProgressSubmission inProgressSubmission\n+                    = ((IndexableInProgressSubmission) idxObj).getIndexedObject();\n+            dso = inProgressSubmission.getItem();\n+        } else if (idxObj instanceof IndexablePoolTask) {\n+            final PoolTask poolTask = ((IndexablePoolTask) idxObj).getIndexedObject();\n+            dso = poolTask.getWorkflowItem().getItem();\n+        } else if (idxObj instanceof IndexableClaimedTask) {\n+            final ClaimedTask claimedTask = ((IndexableClaimedTask) idxObj).getIndexedObject();\n+            dso = claimedTask.getWorkflowItem().getItem();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "3dc413c366787ebbaa82bdd0fb13e3853b63e5d9"}, "originalPosition": 50}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwOTEwMzEyOQ==", "bodyText": "Could we add quick JavaDocs to this method while we are updating it?", "url": "https://github.com/DSpace/DSpace/pull/2727#discussion_r409103129", "createdAt": "2020-04-15T20:07:35Z", "author": {"login": "tdonohue"}, "path": "dspace-api/src/main/java/org/dspace/discovery/SolrServiceSearchPlugin.java", "diffHunk": "@@ -19,5 +19,6 @@\n  */\n public interface SolrServiceSearchPlugin {\n \n-    public void additionalSearchParameters(Context context, DiscoverQuery discoveryQuery, SolrQuery solrQuery);\n+    public void additionalSearchParameters(Context context, DiscoverQuery discoveryQuery, SolrQuery solrQuery)", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "3dc413c366787ebbaa82bdd0fb13e3853b63e5d9"}, "originalPosition": 5}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwOTEwNDczMg==", "bodyText": "There's a weird gap in this comment.  Tiny thing to cleanup.", "url": "https://github.com/DSpace/DSpace/pull/2727#discussion_r409104732", "createdAt": "2020-04-15T20:10:34Z", "author": {"login": "tdonohue"}, "path": "dspace/config/spring/api/discovery.xml", "diffHunk": "@@ -53,8 +54,15 @@\n                <entry key=\"site\" value-ref=\"homepageConfiguration\" />\n                <!--<entry key=\"123456789/7621\" value-ref=\"defaultConfiguration\"/>-->\n                <!-- Used to show filters and results on MyDSpace -->\n+               <!-- Do not change the id of special entries or else they won't work -->\n+               <!-- \"workspace\" is a special entry to search for your own workspac\n+\n+               e items -->", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "3dc413c366787ebbaa82bdd0fb13e3853b63e5d9"}, "originalPosition": 17}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "3263d7f137aa27376306d906eae4cdbe5c7969ca", "author": {"user": {"login": "antoine-atmire", "name": "Antoine Snyers"}}, "url": "https://github.com/DSpace/DSpace/commit/3263d7f137aa27376306d906eae4cdbe5c7969ca", "committedDate": "2020-04-17T08:24:03Z", "message": "Return workflow items for the workflowAdmin configuration"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "bf54ae6af0f63e00056bd5573144762f7ce5c1b7", "author": {"user": {"login": "antoine-atmire", "name": "Antoine Snyers"}}, "url": "https://github.com/DSpace/DSpace/commit/bf54ae6af0f63e00056bd5573144762f7ce5c1b7", "committedDate": "2020-04-28T09:47:03Z", "message": "Add JavaDocs"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDAzNjE2Mzk1", "url": "https://github.com/DSpace/DSpace/pull/2727#pullrequestreview-403616395", "createdAt": "2020-04-30T15:11:01Z", "commit": {"oid": "bf54ae6af0f63e00056bd5573144762f7ce5c1b7"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDA0MjAwMzIx", "url": "https://github.com/DSpace/DSpace/pull/2727#pullrequestreview-404200321", "createdAt": "2020-05-01T14:48:45Z", "commit": {"oid": "bf54ae6af0f63e00056bd5573144762f7ce5c1b7"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1413, "cost": 1, "resetAt": "2021-11-01T13:51:04Z"}}}