{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0Mzc1MzExOTk1", "number": 2673, "reviewThreads": {"totalCount": 17, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xOVQyMTo0MTozMVrODhO2zQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yN1QxNjoxNDoxMVrODjhD2w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjM2MTczMDA1OnYy", "diffSide": "RIGHT", "path": "dspace-server-webapp/src/main/java/org/dspace/app/rest/repository/CollectionParentCommunityLinkRepository.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xOVQyMTo0MTozMVrOFr4pTA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xOVQyMTo0MTozMVrOFr4pTA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MTU2MTE2NA==", "bodyText": "Please add JavaDocs", "url": "https://github.com/DSpace/DSpace/pull/2673#discussion_r381561164", "createdAt": "2020-02-19T21:41:31Z", "author": {"login": "tdonohue"}, "path": "dspace-server-webapp/src/main/java/org/dspace/app/rest/repository/CollectionParentCommunityLinkRepository.java", "diffHunk": "@@ -0,0 +1,50 @@\n+/**\n+ * The contents of this file are subject to the license and copyright\n+ * detailed in the LICENSE and NOTICE files at the root of the source\n+ * tree and available online at\n+ *\n+ * http://www.dspace.org/license/\n+ */\n+package org.dspace.app.rest.repository;\n+\n+import java.sql.SQLException;\n+import java.util.UUID;\n+import javax.annotation.Nullable;\n+import javax.servlet.http.HttpServletRequest;\n+\n+import org.dspace.app.rest.model.CollectionRest;\n+import org.dspace.app.rest.model.CommunityRest;\n+import org.dspace.app.rest.projection.Projection;\n+import org.dspace.content.Collection;\n+import org.dspace.content.Community;\n+import org.dspace.content.service.CollectionService;\n+import org.dspace.core.Context;\n+import org.springframework.beans.factory.annotation.Autowired;\n+import org.springframework.data.domain.Pageable;\n+import org.springframework.data.rest.webmvc.ResourceNotFoundException;\n+import org.springframework.stereotype.Component;\n+\n+@Component(CollectionRest.CATEGORY + \".\" + CollectionRest.NAME + \".\" + CollectionRest.PARENT_COMMUNITY)\n+public class CollectionParentCommunityLinkRepository extends AbstractDSpaceRestRepository", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "6447176f02a43210dd8f5044c18cd398c76c15a6"}, "originalPosition": 28}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjM2MTczMTU0OnYy", "diffSide": "RIGHT", "path": "dspace-server-webapp/src/main/java/org/dspace/app/rest/repository/CollectionParentCommunityLinkRepository.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xOVQyMTo0MjowMFrOFr4qKA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xOVQyMTo0MjowMFrOFr4qKA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MTU2MTM4NA==", "bodyText": "Same here, JavaDocs for this method please", "url": "https://github.com/DSpace/DSpace/pull/2673#discussion_r381561384", "createdAt": "2020-02-19T21:42:00Z", "author": {"login": "tdonohue"}, "path": "dspace-server-webapp/src/main/java/org/dspace/app/rest/repository/CollectionParentCommunityLinkRepository.java", "diffHunk": "@@ -0,0 +1,50 @@\n+/**\n+ * The contents of this file are subject to the license and copyright\n+ * detailed in the LICENSE and NOTICE files at the root of the source\n+ * tree and available online at\n+ *\n+ * http://www.dspace.org/license/\n+ */\n+package org.dspace.app.rest.repository;\n+\n+import java.sql.SQLException;\n+import java.util.UUID;\n+import javax.annotation.Nullable;\n+import javax.servlet.http.HttpServletRequest;\n+\n+import org.dspace.app.rest.model.CollectionRest;\n+import org.dspace.app.rest.model.CommunityRest;\n+import org.dspace.app.rest.projection.Projection;\n+import org.dspace.content.Collection;\n+import org.dspace.content.Community;\n+import org.dspace.content.service.CollectionService;\n+import org.dspace.core.Context;\n+import org.springframework.beans.factory.annotation.Autowired;\n+import org.springframework.data.domain.Pageable;\n+import org.springframework.data.rest.webmvc.ResourceNotFoundException;\n+import org.springframework.stereotype.Component;\n+\n+@Component(CollectionRest.CATEGORY + \".\" + CollectionRest.NAME + \".\" + CollectionRest.PARENT_COMMUNITY)\n+public class CollectionParentCommunityLinkRepository extends AbstractDSpaceRestRepository\n+    implements LinkRestRepository {\n+\n+    @Autowired\n+    private CollectionService collectionService;\n+\n+    public CommunityRest getParentCommunity(@Nullable HttpServletRequest httpServletRequest,", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "6447176f02a43210dd8f5044c18cd398c76c15a6"}, "originalPosition": 34}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjM2MTczNzYyOnYy", "diffSide": "RIGHT", "path": "dspace-server-webapp/src/main/java/org/dspace/app/rest/repository/CommunityParentCommunityLinkRepository.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xOVQyMTo0Mzo1MFrOFr4tww==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xOVQyMTo0Mzo1MFrOFr4tww==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MTU2MjMwNw==", "bodyText": "Again, Javadocs needed for this Class and for the getParentCommunity method below.", "url": "https://github.com/DSpace/DSpace/pull/2673#discussion_r381562307", "createdAt": "2020-02-19T21:43:50Z", "author": {"login": "tdonohue"}, "path": "dspace-server-webapp/src/main/java/org/dspace/app/rest/repository/CommunityParentCommunityLinkRepository.java", "diffHunk": "@@ -0,0 +1,51 @@\n+/**\n+ * The contents of this file are subject to the license and copyright\n+ * detailed in the LICENSE and NOTICE files at the root of the source\n+ * tree and available online at\n+ *\n+ * http://www.dspace.org/license/\n+ */\n+package org.dspace.app.rest.repository;\n+\n+import java.sql.SQLException;\n+import java.util.UUID;\n+import javax.annotation.Nullable;\n+import javax.servlet.http.HttpServletRequest;\n+\n+import org.dspace.app.rest.model.CommunityRest;\n+import org.dspace.app.rest.projection.Projection;\n+import org.dspace.content.Community;\n+import org.dspace.content.service.CommunityService;\n+import org.dspace.core.Context;\n+import org.springframework.beans.factory.annotation.Autowired;\n+import org.springframework.data.domain.Pageable;\n+import org.springframework.data.rest.webmvc.ResourceNotFoundException;\n+import org.springframework.stereotype.Component;\n+\n+@Component(CommunityRest.CATEGORY + \".\" + CommunityRest.NAME + \".\" + CommunityRest.PARENT_COMMUNITY)\n+public class CommunityParentCommunityLinkRepository extends AbstractDSpaceRestRepository", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "6447176f02a43210dd8f5044c18cd398c76c15a6"}, "originalPosition": 26}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjM2NTM3MjgzOnYy", "diffSide": "RIGHT", "path": "dspace-server-webapp/src/test/java/org/dspace/app/rest/CommunityCollectionParentIT.java", "isResolved": true, "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yMFQxNTo1MzowM1rOFsY6nw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yN1QxNjowMzo0NlrOFvXEag==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MjA4OTg4Nw==", "bodyText": "why are we parsing the json instead than use the existing Matcher? this also apply to all the other tests", "url": "https://github.com/DSpace/DSpace/pull/2673#discussion_r382089887", "createdAt": "2020-02-20T15:53:03Z", "author": {"login": "abollini"}, "path": "dspace-server-webapp/src/test/java/org/dspace/app/rest/CommunityCollectionParentIT.java", "diffHunk": "@@ -0,0 +1,311 @@\n+/**\n+ * The contents of this file are subject to the license and copyright\n+ * detailed in the LICENSE and NOTICE files at the root of the source\n+ * tree and available online at\n+ *\n+ * http://www.dspace.org/license/\n+ */\n+package org.dspace.app.rest;\n+\n+import static org.hamcrest.CoreMatchers.equalTo;\n+import static org.hamcrest.CoreMatchers.not;\n+import static org.junit.Assert.assertThat;\n+import static org.springframework.test.web.servlet.request.MockMvcRequestBuilders.get;\n+import static org.springframework.test.web.servlet.result.MockMvcResultMatchers.status;\n+\n+import java.sql.SQLException;\n+import java.util.Map;\n+\n+import com.fasterxml.jackson.databind.ObjectMapper;\n+import org.dspace.app.rest.builder.CollectionBuilder;\n+import org.dspace.app.rest.builder.CommunityBuilder;\n+import org.dspace.app.rest.builder.ItemBuilder;\n+import org.dspace.app.rest.test.AbstractControllerIntegrationTest;\n+import org.dspace.authorize.AuthorizeException;\n+import org.dspace.content.Collection;\n+import org.dspace.content.Community;\n+import org.dspace.content.Item;\n+import org.dspace.content.service.CollectionService;\n+import org.dspace.content.service.CommunityService;\n+import org.junit.Before;\n+import org.junit.Test;\n+import org.springframework.beans.factory.annotation.Autowired;\n+import org.springframework.test.web.servlet.MvcResult;\n+\n+public class CommunityCollectionParentIT extends AbstractControllerIntegrationTest {\n+\n+    @Autowired\n+    private CollectionService collectionService;\n+\n+    @Autowired\n+    private CommunityService communityService;\n+\n+    Community communityA;\n+    Community communityB;\n+    Community communityAA;\n+    Community communityAB;\n+\n+    Collection col1;\n+    Collection col2;\n+    Collection col3;\n+\n+    Item itemX;\n+    Item itemY;\n+    Item itemZ;\n+\n+\n+    @Before\n+    public void setup() throws SQLException, AuthorizeException {\n+        //We turn off the authorization system in order to create the structure as defined below\n+        context.turnOffAuthorisationSystem();\n+        //** GIVEN **\n+        //1. A community-collection structure with one parent community with sub-community and one collection.\n+        communityA = CommunityBuilder.createCommunity(context)\n+                                     .withName(\"Parent CommunityA\")\n+                                     .build();\n+        communityB = CommunityBuilder.createCommunity(context)\n+                                     .withName(\"Parent CommunityB\")\n+                                     .build();\n+        communityAA = CommunityBuilder.createSubCommunity(context, communityA)\n+                                      .withName(\"Sub Community\")\n+                                      .build();\n+        communityAB = CommunityBuilder.createSubCommunity(context, communityA)\n+                                      .withName(\"Sub Community Two\")\n+                                      .build();\n+        col1 = CollectionBuilder.createCollection(context, communityAA).withName(\"Collection 1\").build();\n+        col2 = CollectionBuilder.createCollection(context, communityAA).withName(\"Collection 2\").build();\n+        col3 = CollectionBuilder.createCollection(context, communityAB).withName(\"Collection 3\").build();\n+        communityService.addCollection(context, communityAB, col2);\n+\n+\n+        itemX = ItemBuilder.createItem(context, col1)\n+                           .withTitle(\"Public item 1\")\n+                           .withIssueDate(\"2017-10-17\")\n+                           .withAuthor(\"Smith, Donald\").withAuthor(\"Doe, John\")\n+                           .withSubject(\"ExtraEntry\")\n+                           .build();\n+\n+        itemY = ItemBuilder.createItem(context, col1)\n+                           .withTitle(\"Public item 1\")\n+                           .withIssueDate(\"2017-10-17\")\n+                           .withAuthor(\"Smith, Donald\").withAuthor(\"Doe, John\")\n+                           .withSubject(\"ExtraEntry\")\n+                           .build();\n+        collectionService.addItem(context, col2, itemY);\n+        itemZ = ItemBuilder.createItem(context, col2)\n+                           .withTitle(\"Public item 1\")\n+                           .withIssueDate(\"2017-10-17\")\n+                           .withAuthor(\"Smith, Donald\").withAuthor(\"Doe, John\")\n+                           .withSubject(\"ExtraEntry\")\n+                           .build();\n+\n+        context.restoreAuthSystemState();\n+    }\n+\n+    @Test\n+    public void itemXOwningCollectionTest() throws Exception {\n+\n+        ObjectMapper mapper = new ObjectMapper();\n+        String token = getAuthToken(admin.getEmail(), password);\n+        MvcResult mvcResult = getClient(token).perform(get(\"/api/core/items/\" + itemX.getID() + \"/owningCollection\"))\n+                                              .andReturn();\n+\n+        String content = mvcResult.getResponse().getContentAsString();\n+        Map<String, Object> map = mapper.readValue(content, Map.class);\n+        String collectionUuidString = String.valueOf(map.get(\"uuid\"));\n+        String collectionName = String.valueOf(map.get(\"name\"));\n+\n+        mvcResult = getClient(token).perform(get(\"/api/core/collections/\" + col1.getID())).andReturn();\n+        content = mvcResult.getResponse().getContentAsString();\n+        map = mapper.readValue(content, Map.class);\n+        String actualCollectionName = String.valueOf(map.get(\"name\"));\n+\n+        assertThat(collectionName, equalTo(actualCollectionName));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "6447176f02a43210dd8f5044c18cd398c76c15a6"}, "originalPosition": 123}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MjI2MjQzNg==", "bodyText": "Good point, yes there is a org.dspace.app.rest.matcher.CollectionMatcher which can be used to compare JSON results against a known set of values.  There's some good examples in the CollectionRestRepositoryIT.\nIn fact, all the tests in this IT should likely be updated to use either CollectionMatcher or CommunityMatcher.  (and those two matchers could be updated with new comparison methods as needed).  I had completely overlooked that in this PR.", "url": "https://github.com/DSpace/DSpace/pull/2673#discussion_r382262436", "createdAt": "2020-02-20T21:16:46Z", "author": {"login": "tdonohue"}, "path": "dspace-server-webapp/src/test/java/org/dspace/app/rest/CommunityCollectionParentIT.java", "diffHunk": "@@ -0,0 +1,311 @@\n+/**\n+ * The contents of this file are subject to the license and copyright\n+ * detailed in the LICENSE and NOTICE files at the root of the source\n+ * tree and available online at\n+ *\n+ * http://www.dspace.org/license/\n+ */\n+package org.dspace.app.rest;\n+\n+import static org.hamcrest.CoreMatchers.equalTo;\n+import static org.hamcrest.CoreMatchers.not;\n+import static org.junit.Assert.assertThat;\n+import static org.springframework.test.web.servlet.request.MockMvcRequestBuilders.get;\n+import static org.springframework.test.web.servlet.result.MockMvcResultMatchers.status;\n+\n+import java.sql.SQLException;\n+import java.util.Map;\n+\n+import com.fasterxml.jackson.databind.ObjectMapper;\n+import org.dspace.app.rest.builder.CollectionBuilder;\n+import org.dspace.app.rest.builder.CommunityBuilder;\n+import org.dspace.app.rest.builder.ItemBuilder;\n+import org.dspace.app.rest.test.AbstractControllerIntegrationTest;\n+import org.dspace.authorize.AuthorizeException;\n+import org.dspace.content.Collection;\n+import org.dspace.content.Community;\n+import org.dspace.content.Item;\n+import org.dspace.content.service.CollectionService;\n+import org.dspace.content.service.CommunityService;\n+import org.junit.Before;\n+import org.junit.Test;\n+import org.springframework.beans.factory.annotation.Autowired;\n+import org.springframework.test.web.servlet.MvcResult;\n+\n+public class CommunityCollectionParentIT extends AbstractControllerIntegrationTest {\n+\n+    @Autowired\n+    private CollectionService collectionService;\n+\n+    @Autowired\n+    private CommunityService communityService;\n+\n+    Community communityA;\n+    Community communityB;\n+    Community communityAA;\n+    Community communityAB;\n+\n+    Collection col1;\n+    Collection col2;\n+    Collection col3;\n+\n+    Item itemX;\n+    Item itemY;\n+    Item itemZ;\n+\n+\n+    @Before\n+    public void setup() throws SQLException, AuthorizeException {\n+        //We turn off the authorization system in order to create the structure as defined below\n+        context.turnOffAuthorisationSystem();\n+        //** GIVEN **\n+        //1. A community-collection structure with one parent community with sub-community and one collection.\n+        communityA = CommunityBuilder.createCommunity(context)\n+                                     .withName(\"Parent CommunityA\")\n+                                     .build();\n+        communityB = CommunityBuilder.createCommunity(context)\n+                                     .withName(\"Parent CommunityB\")\n+                                     .build();\n+        communityAA = CommunityBuilder.createSubCommunity(context, communityA)\n+                                      .withName(\"Sub Community\")\n+                                      .build();\n+        communityAB = CommunityBuilder.createSubCommunity(context, communityA)\n+                                      .withName(\"Sub Community Two\")\n+                                      .build();\n+        col1 = CollectionBuilder.createCollection(context, communityAA).withName(\"Collection 1\").build();\n+        col2 = CollectionBuilder.createCollection(context, communityAA).withName(\"Collection 2\").build();\n+        col3 = CollectionBuilder.createCollection(context, communityAB).withName(\"Collection 3\").build();\n+        communityService.addCollection(context, communityAB, col2);\n+\n+\n+        itemX = ItemBuilder.createItem(context, col1)\n+                           .withTitle(\"Public item 1\")\n+                           .withIssueDate(\"2017-10-17\")\n+                           .withAuthor(\"Smith, Donald\").withAuthor(\"Doe, John\")\n+                           .withSubject(\"ExtraEntry\")\n+                           .build();\n+\n+        itemY = ItemBuilder.createItem(context, col1)\n+                           .withTitle(\"Public item 1\")\n+                           .withIssueDate(\"2017-10-17\")\n+                           .withAuthor(\"Smith, Donald\").withAuthor(\"Doe, John\")\n+                           .withSubject(\"ExtraEntry\")\n+                           .build();\n+        collectionService.addItem(context, col2, itemY);\n+        itemZ = ItemBuilder.createItem(context, col2)\n+                           .withTitle(\"Public item 1\")\n+                           .withIssueDate(\"2017-10-17\")\n+                           .withAuthor(\"Smith, Donald\").withAuthor(\"Doe, John\")\n+                           .withSubject(\"ExtraEntry\")\n+                           .build();\n+\n+        context.restoreAuthSystemState();\n+    }\n+\n+    @Test\n+    public void itemXOwningCollectionTest() throws Exception {\n+\n+        ObjectMapper mapper = new ObjectMapper();\n+        String token = getAuthToken(admin.getEmail(), password);\n+        MvcResult mvcResult = getClient(token).perform(get(\"/api/core/items/\" + itemX.getID() + \"/owningCollection\"))\n+                                              .andReturn();\n+\n+        String content = mvcResult.getResponse().getContentAsString();\n+        Map<String, Object> map = mapper.readValue(content, Map.class);\n+        String collectionUuidString = String.valueOf(map.get(\"uuid\"));\n+        String collectionName = String.valueOf(map.get(\"name\"));\n+\n+        mvcResult = getClient(token).perform(get(\"/api/core/collections/\" + col1.getID())).andReturn();\n+        content = mvcResult.getResponse().getContentAsString();\n+        map = mapper.readValue(content, Map.class);\n+        String actualCollectionName = String.valueOf(map.get(\"name\"));\n+\n+        assertThat(collectionName, equalTo(actualCollectionName));", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MjA4OTg4Nw=="}, "originalCommit": {"oid": "6447176f02a43210dd8f5044c18cd398c76c15a6"}, "originalPosition": 123}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NTIwNTM1NA==", "bodyText": "this has been addressed", "url": "https://github.com/DSpace/DSpace/pull/2673#discussion_r385205354", "createdAt": "2020-02-27T16:03:46Z", "author": {"login": "abollini"}, "path": "dspace-server-webapp/src/test/java/org/dspace/app/rest/CommunityCollectionParentIT.java", "diffHunk": "@@ -0,0 +1,311 @@\n+/**\n+ * The contents of this file are subject to the license and copyright\n+ * detailed in the LICENSE and NOTICE files at the root of the source\n+ * tree and available online at\n+ *\n+ * http://www.dspace.org/license/\n+ */\n+package org.dspace.app.rest;\n+\n+import static org.hamcrest.CoreMatchers.equalTo;\n+import static org.hamcrest.CoreMatchers.not;\n+import static org.junit.Assert.assertThat;\n+import static org.springframework.test.web.servlet.request.MockMvcRequestBuilders.get;\n+import static org.springframework.test.web.servlet.result.MockMvcResultMatchers.status;\n+\n+import java.sql.SQLException;\n+import java.util.Map;\n+\n+import com.fasterxml.jackson.databind.ObjectMapper;\n+import org.dspace.app.rest.builder.CollectionBuilder;\n+import org.dspace.app.rest.builder.CommunityBuilder;\n+import org.dspace.app.rest.builder.ItemBuilder;\n+import org.dspace.app.rest.test.AbstractControllerIntegrationTest;\n+import org.dspace.authorize.AuthorizeException;\n+import org.dspace.content.Collection;\n+import org.dspace.content.Community;\n+import org.dspace.content.Item;\n+import org.dspace.content.service.CollectionService;\n+import org.dspace.content.service.CommunityService;\n+import org.junit.Before;\n+import org.junit.Test;\n+import org.springframework.beans.factory.annotation.Autowired;\n+import org.springframework.test.web.servlet.MvcResult;\n+\n+public class CommunityCollectionParentIT extends AbstractControllerIntegrationTest {\n+\n+    @Autowired\n+    private CollectionService collectionService;\n+\n+    @Autowired\n+    private CommunityService communityService;\n+\n+    Community communityA;\n+    Community communityB;\n+    Community communityAA;\n+    Community communityAB;\n+\n+    Collection col1;\n+    Collection col2;\n+    Collection col3;\n+\n+    Item itemX;\n+    Item itemY;\n+    Item itemZ;\n+\n+\n+    @Before\n+    public void setup() throws SQLException, AuthorizeException {\n+        //We turn off the authorization system in order to create the structure as defined below\n+        context.turnOffAuthorisationSystem();\n+        //** GIVEN **\n+        //1. A community-collection structure with one parent community with sub-community and one collection.\n+        communityA = CommunityBuilder.createCommunity(context)\n+                                     .withName(\"Parent CommunityA\")\n+                                     .build();\n+        communityB = CommunityBuilder.createCommunity(context)\n+                                     .withName(\"Parent CommunityB\")\n+                                     .build();\n+        communityAA = CommunityBuilder.createSubCommunity(context, communityA)\n+                                      .withName(\"Sub Community\")\n+                                      .build();\n+        communityAB = CommunityBuilder.createSubCommunity(context, communityA)\n+                                      .withName(\"Sub Community Two\")\n+                                      .build();\n+        col1 = CollectionBuilder.createCollection(context, communityAA).withName(\"Collection 1\").build();\n+        col2 = CollectionBuilder.createCollection(context, communityAA).withName(\"Collection 2\").build();\n+        col3 = CollectionBuilder.createCollection(context, communityAB).withName(\"Collection 3\").build();\n+        communityService.addCollection(context, communityAB, col2);\n+\n+\n+        itemX = ItemBuilder.createItem(context, col1)\n+                           .withTitle(\"Public item 1\")\n+                           .withIssueDate(\"2017-10-17\")\n+                           .withAuthor(\"Smith, Donald\").withAuthor(\"Doe, John\")\n+                           .withSubject(\"ExtraEntry\")\n+                           .build();\n+\n+        itemY = ItemBuilder.createItem(context, col1)\n+                           .withTitle(\"Public item 1\")\n+                           .withIssueDate(\"2017-10-17\")\n+                           .withAuthor(\"Smith, Donald\").withAuthor(\"Doe, John\")\n+                           .withSubject(\"ExtraEntry\")\n+                           .build();\n+        collectionService.addItem(context, col2, itemY);\n+        itemZ = ItemBuilder.createItem(context, col2)\n+                           .withTitle(\"Public item 1\")\n+                           .withIssueDate(\"2017-10-17\")\n+                           .withAuthor(\"Smith, Donald\").withAuthor(\"Doe, John\")\n+                           .withSubject(\"ExtraEntry\")\n+                           .build();\n+\n+        context.restoreAuthSystemState();\n+    }\n+\n+    @Test\n+    public void itemXOwningCollectionTest() throws Exception {\n+\n+        ObjectMapper mapper = new ObjectMapper();\n+        String token = getAuthToken(admin.getEmail(), password);\n+        MvcResult mvcResult = getClient(token).perform(get(\"/api/core/items/\" + itemX.getID() + \"/owningCollection\"))\n+                                              .andReturn();\n+\n+        String content = mvcResult.getResponse().getContentAsString();\n+        Map<String, Object> map = mapper.readValue(content, Map.class);\n+        String collectionUuidString = String.valueOf(map.get(\"uuid\"));\n+        String collectionName = String.valueOf(map.get(\"name\"));\n+\n+        mvcResult = getClient(token).perform(get(\"/api/core/collections/\" + col1.getID())).andReturn();\n+        content = mvcResult.getResponse().getContentAsString();\n+        map = mapper.readValue(content, Map.class);\n+        String actualCollectionName = String.valueOf(map.get(\"name\"));\n+\n+        assertThat(collectionName, equalTo(actualCollectionName));", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MjA4OTg4Nw=="}, "originalCommit": {"oid": "6447176f02a43210dd8f5044c18cd398c76c15a6"}, "originalPosition": 123}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjM2NTQ4NjUzOnYy", "diffSide": "RIGHT", "path": "dspace-server-webapp/src/test/java/org/dspace/app/rest/CommunityCollectionParentIT.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yMFQxNjoyMjowNlrOFsaC-w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yMFQxNjoyMjowNlrOFsaC-w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MjEwODQxMQ==", "bodyText": "I don't see any value in adding a more test for AB as this is the same test data category than AA", "url": "https://github.com/DSpace/DSpace/pull/2673#discussion_r382108411", "createdAt": "2020-02-20T16:22:06Z", "author": {"login": "abollini"}, "path": "dspace-server-webapp/src/test/java/org/dspace/app/rest/CommunityCollectionParentIT.java", "diffHunk": "@@ -0,0 +1,311 @@\n+/**\n+ * The contents of this file are subject to the license and copyright\n+ * detailed in the LICENSE and NOTICE files at the root of the source\n+ * tree and available online at\n+ *\n+ * http://www.dspace.org/license/\n+ */\n+package org.dspace.app.rest;\n+\n+import static org.hamcrest.CoreMatchers.equalTo;\n+import static org.hamcrest.CoreMatchers.not;\n+import static org.junit.Assert.assertThat;\n+import static org.springframework.test.web.servlet.request.MockMvcRequestBuilders.get;\n+import static org.springframework.test.web.servlet.result.MockMvcResultMatchers.status;\n+\n+import java.sql.SQLException;\n+import java.util.Map;\n+\n+import com.fasterxml.jackson.databind.ObjectMapper;\n+import org.dspace.app.rest.builder.CollectionBuilder;\n+import org.dspace.app.rest.builder.CommunityBuilder;\n+import org.dspace.app.rest.builder.ItemBuilder;\n+import org.dspace.app.rest.test.AbstractControllerIntegrationTest;\n+import org.dspace.authorize.AuthorizeException;\n+import org.dspace.content.Collection;\n+import org.dspace.content.Community;\n+import org.dspace.content.Item;\n+import org.dspace.content.service.CollectionService;\n+import org.dspace.content.service.CommunityService;\n+import org.junit.Before;\n+import org.junit.Test;\n+import org.springframework.beans.factory.annotation.Autowired;\n+import org.springframework.test.web.servlet.MvcResult;\n+\n+public class CommunityCollectionParentIT extends AbstractControllerIntegrationTest {\n+\n+    @Autowired\n+    private CollectionService collectionService;\n+\n+    @Autowired\n+    private CommunityService communityService;\n+\n+    Community communityA;\n+    Community communityB;\n+    Community communityAA;\n+    Community communityAB;\n+\n+    Collection col1;\n+    Collection col2;\n+    Collection col3;\n+\n+    Item itemX;\n+    Item itemY;\n+    Item itemZ;\n+\n+\n+    @Before\n+    public void setup() throws SQLException, AuthorizeException {\n+        //We turn off the authorization system in order to create the structure as defined below\n+        context.turnOffAuthorisationSystem();\n+        //** GIVEN **\n+        //1. A community-collection structure with one parent community with sub-community and one collection.\n+        communityA = CommunityBuilder.createCommunity(context)\n+                                     .withName(\"Parent CommunityA\")\n+                                     .build();\n+        communityB = CommunityBuilder.createCommunity(context)\n+                                     .withName(\"Parent CommunityB\")\n+                                     .build();\n+        communityAA = CommunityBuilder.createSubCommunity(context, communityA)\n+                                      .withName(\"Sub Community\")\n+                                      .build();\n+        communityAB = CommunityBuilder.createSubCommunity(context, communityA)\n+                                      .withName(\"Sub Community Two\")\n+                                      .build();\n+        col1 = CollectionBuilder.createCollection(context, communityAA).withName(\"Collection 1\").build();\n+        col2 = CollectionBuilder.createCollection(context, communityAA).withName(\"Collection 2\").build();\n+        col3 = CollectionBuilder.createCollection(context, communityAB).withName(\"Collection 3\").build();\n+        communityService.addCollection(context, communityAB, col2);\n+\n+\n+        itemX = ItemBuilder.createItem(context, col1)\n+                           .withTitle(\"Public item 1\")\n+                           .withIssueDate(\"2017-10-17\")\n+                           .withAuthor(\"Smith, Donald\").withAuthor(\"Doe, John\")\n+                           .withSubject(\"ExtraEntry\")\n+                           .build();\n+\n+        itemY = ItemBuilder.createItem(context, col1)\n+                           .withTitle(\"Public item 1\")\n+                           .withIssueDate(\"2017-10-17\")\n+                           .withAuthor(\"Smith, Donald\").withAuthor(\"Doe, John\")\n+                           .withSubject(\"ExtraEntry\")\n+                           .build();\n+        collectionService.addItem(context, col2, itemY);\n+        itemZ = ItemBuilder.createItem(context, col2)\n+                           .withTitle(\"Public item 1\")\n+                           .withIssueDate(\"2017-10-17\")\n+                           .withAuthor(\"Smith, Donald\").withAuthor(\"Doe, John\")\n+                           .withSubject(\"ExtraEntry\")\n+                           .build();\n+\n+        context.restoreAuthSystemState();\n+    }\n+\n+    @Test\n+    public void itemXOwningCollectionTest() throws Exception {\n+\n+        ObjectMapper mapper = new ObjectMapper();\n+        String token = getAuthToken(admin.getEmail(), password);\n+        MvcResult mvcResult = getClient(token).perform(get(\"/api/core/items/\" + itemX.getID() + \"/owningCollection\"))\n+                                              .andReturn();\n+\n+        String content = mvcResult.getResponse().getContentAsString();\n+        Map<String, Object> map = mapper.readValue(content, Map.class);\n+        String collectionUuidString = String.valueOf(map.get(\"uuid\"));\n+        String collectionName = String.valueOf(map.get(\"name\"));\n+\n+        mvcResult = getClient(token).perform(get(\"/api/core/collections/\" + col1.getID())).andReturn();\n+        content = mvcResult.getResponse().getContentAsString();\n+        map = mapper.readValue(content, Map.class);\n+        String actualCollectionName = String.valueOf(map.get(\"name\"));\n+\n+        assertThat(collectionName, equalTo(actualCollectionName));\n+        assertThat(collectionUuidString, equalTo(String.valueOf(col1.getID())));\n+        assertThat(collectionUuidString, not(String.valueOf(col2.getID())));\n+\n+    }\n+\n+    @Test\n+    public void itemYOwningCollectionTest() throws Exception {\n+\n+        ObjectMapper mapper = new ObjectMapper();\n+        String token = getAuthToken(admin.getEmail(), password);\n+        MvcResult mvcResult = getClient(token).perform(get(\"/api/core/items/\" + itemY.getID() + \"/owningCollection\"))\n+                                              .andReturn();\n+\n+        String content = mvcResult.getResponse().getContentAsString();\n+        Map<String, Object> map = mapper.readValue(content, Map.class);\n+        String collectionUuidString = String.valueOf(map.get(\"uuid\"));\n+        String collectionName = String.valueOf(map.get(\"name\"));\n+\n+        mvcResult = getClient(token).perform(get(\"/api/core/collections/\" + col1.getID())).andReturn();\n+        content = mvcResult.getResponse().getContentAsString();\n+        map = mapper.readValue(content, Map.class);\n+        String actualCollectionName = String.valueOf(map.get(\"name\"));\n+\n+        assertThat(collectionName, equalTo(actualCollectionName));\n+        assertThat(collectionUuidString, equalTo(String.valueOf(col1.getID())));\n+        assertThat(collectionUuidString, not(String.valueOf(col2.getID())));\n+\n+    }\n+\n+    @Test\n+    public void itemZOwningCollectionTest() throws Exception {\n+\n+        ObjectMapper mapper = new ObjectMapper();\n+        String token = getAuthToken(admin.getEmail(), password);\n+        MvcResult mvcResult = getClient(token).perform(get(\"/api/core/items/\" + itemZ.getID() + \"/owningCollection\"))\n+                                              .andReturn();\n+\n+        String content = mvcResult.getResponse().getContentAsString();\n+        Map<String, Object> map = mapper.readValue(content, Map.class);\n+        String collectionUuidString = String.valueOf(map.get(\"uuid\"));\n+        String collectionName = String.valueOf(map.get(\"name\"));\n+\n+        mvcResult = getClient(token).perform(get(\"/api/core/collections/\" + col2.getID())).andReturn();\n+        content = mvcResult.getResponse().getContentAsString();\n+        map = mapper.readValue(content, Map.class);\n+        String actualCollectionName = String.valueOf(map.get(\"name\"));\n+\n+        assertThat(collectionName, equalTo(actualCollectionName));\n+        assertThat(collectionUuidString, equalTo(String.valueOf(col2.getID())));\n+        assertThat(collectionUuidString, not(String.valueOf(col1.getID())));\n+\n+    }\n+\n+    @Test\n+    public void col1ParentCommunityTest() throws Exception {\n+\n+        ObjectMapper mapper = new ObjectMapper();\n+        String token = getAuthToken(admin.getEmail(), password);\n+        MvcResult mvcResult = getClient(token)\n+            .perform(get(\"/api/core/collections/\" + col1.getID() + \"/parentCommunity\")).andReturn();\n+\n+        String content = mvcResult.getResponse().getContentAsString();\n+        Map<String, Object> map = mapper.readValue(content, Map.class);\n+        String communityUuidString = String.valueOf(map.get(\"uuid\"));\n+        String communityName = String.valueOf(map.get(\"name\"));\n+\n+        mvcResult = getClient(token).perform(get(\"/api/core/communities/\" + communityAA.getID())).andReturn();\n+        content = mvcResult.getResponse().getContentAsString();\n+        map = mapper.readValue(content, Map.class);\n+        String actualCommunityName = String.valueOf(map.get(\"name\"));\n+\n+        assertThat(communityName, equalTo(actualCommunityName));\n+        assertThat(communityUuidString, equalTo(String.valueOf(communityAA.getID())));\n+        assertThat(communityUuidString, not(String.valueOf(communityA.getID())));\n+        assertThat(communityUuidString, not(String.valueOf(communityAB.getID())));\n+\n+    }\n+\n+    @Test\n+    public void col2ParentCommunityTest() throws Exception {\n+\n+        ObjectMapper mapper = new ObjectMapper();\n+        String token = getAuthToken(admin.getEmail(), password);\n+        MvcResult mvcResult = getClient(token)\n+            .perform(get(\"/api/core/collections/\" + col2.getID() + \"/parentCommunity\")).andReturn();\n+\n+        String content = mvcResult.getResponse().getContentAsString();\n+        Map<String, Object> map = mapper.readValue(content, Map.class);\n+        String communityUuidString = String.valueOf(map.get(\"uuid\"));\n+        String communityName = String.valueOf(map.get(\"name\"));\n+\n+        mvcResult = getClient(token).perform(get(\"/api/core/communities/\" + communityAA.getID())).andReturn();\n+        content = mvcResult.getResponse().getContentAsString();\n+        map = mapper.readValue(content, Map.class);\n+        String actualCommunityName = String.valueOf(map.get(\"name\"));\n+\n+        assertThat(communityName, equalTo(actualCommunityName));\n+        assertThat(communityUuidString, equalTo(String.valueOf(communityAA.getID())));\n+        assertThat(communityUuidString, not(String.valueOf(communityA.getID())));\n+        assertThat(communityUuidString, not(String.valueOf(communityAB.getID())));\n+\n+    }\n+\n+    @Test\n+    public void col3ParentCommunityTest() throws Exception {\n+\n+        ObjectMapper mapper = new ObjectMapper();\n+        String token = getAuthToken(admin.getEmail(), password);\n+        MvcResult mvcResult = getClient(token)\n+            .perform(get(\"/api/core/collections/\" + col3.getID() + \"/parentCommunity\")).andReturn();\n+\n+        String content = mvcResult.getResponse().getContentAsString();\n+        Map<String, Object> map = mapper.readValue(content, Map.class);\n+        String communityUuidString = String.valueOf(map.get(\"uuid\"));\n+        String communityName = String.valueOf(map.get(\"name\"));\n+\n+        mvcResult = getClient(token).perform(get(\"/api/core/communities/\" + communityAB.getID())).andReturn();\n+        content = mvcResult.getResponse().getContentAsString();\n+        map = mapper.readValue(content, Map.class);\n+        String actualCommunityName = String.valueOf(map.get(\"name\"));\n+\n+        assertThat(communityName, equalTo(actualCommunityName));\n+        assertThat(communityUuidString, equalTo(String.valueOf(communityAB.getID())));\n+        assertThat(communityUuidString, not(String.valueOf(communityA.getID())));\n+        assertThat(communityUuidString, not(String.valueOf(communityAA.getID())));\n+\n+    }\n+\n+    @Test\n+    public void comAAParentCommunityTest() throws Exception {\n+\n+        ObjectMapper mapper = new ObjectMapper();\n+        String token = getAuthToken(admin.getEmail(), password);\n+        MvcResult mvcResult = getClient(token)\n+            .perform(get(\"/api/core/communities/\" + communityAA.getID() + \"/parentCommunity\")).andReturn();\n+\n+        String content = mvcResult.getResponse().getContentAsString();\n+        Map<String, Object> map = mapper.readValue(content, Map.class);\n+        String communityUuidString = String.valueOf(map.get(\"uuid\"));\n+        String communityName = String.valueOf(map.get(\"name\"));\n+\n+        mvcResult = getClient(token).perform(get(\"/api/core/communities/\" + communityA.getID())).andReturn();\n+        content = mvcResult.getResponse().getContentAsString();\n+        map = mapper.readValue(content, Map.class);\n+        String actualCommunityName = String.valueOf(map.get(\"name\"));\n+\n+        assertThat(communityName, equalTo(actualCommunityName));\n+        assertThat(communityUuidString, equalTo(String.valueOf(communityA.getID())));\n+        assertThat(communityUuidString, not(String.valueOf(communityB.getID())));\n+\n+    }\n+\n+\n+    @Test\n+    public void comABParentCommunityTest() throws Exception {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "6447176f02a43210dd8f5044c18cd398c76c15a6"}, "originalPosition": 278}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjM2NTQ5ODA3OnYy", "diffSide": "RIGHT", "path": "dspace-server-webapp/src/test/java/org/dspace/app/rest/CommunityCollectionParentIT.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yMFQxNjoyNTowM1rOFsaKOQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yMFQxNjoyNTowM1rOFsaKOQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MjExMDI2NQ==", "bodyText": "we can avoid to retrieve this value from the REST, the findOne endpoint has already test in the specific IT class. Doing it again here will only slow our test", "url": "https://github.com/DSpace/DSpace/pull/2673#discussion_r382110265", "createdAt": "2020-02-20T16:25:03Z", "author": {"login": "abollini"}, "path": "dspace-server-webapp/src/test/java/org/dspace/app/rest/CommunityCollectionParentIT.java", "diffHunk": "@@ -0,0 +1,311 @@\n+/**\n+ * The contents of this file are subject to the license and copyright\n+ * detailed in the LICENSE and NOTICE files at the root of the source\n+ * tree and available online at\n+ *\n+ * http://www.dspace.org/license/\n+ */\n+package org.dspace.app.rest;\n+\n+import static org.hamcrest.CoreMatchers.equalTo;\n+import static org.hamcrest.CoreMatchers.not;\n+import static org.junit.Assert.assertThat;\n+import static org.springframework.test.web.servlet.request.MockMvcRequestBuilders.get;\n+import static org.springframework.test.web.servlet.result.MockMvcResultMatchers.status;\n+\n+import java.sql.SQLException;\n+import java.util.Map;\n+\n+import com.fasterxml.jackson.databind.ObjectMapper;\n+import org.dspace.app.rest.builder.CollectionBuilder;\n+import org.dspace.app.rest.builder.CommunityBuilder;\n+import org.dspace.app.rest.builder.ItemBuilder;\n+import org.dspace.app.rest.test.AbstractControllerIntegrationTest;\n+import org.dspace.authorize.AuthorizeException;\n+import org.dspace.content.Collection;\n+import org.dspace.content.Community;\n+import org.dspace.content.Item;\n+import org.dspace.content.service.CollectionService;\n+import org.dspace.content.service.CommunityService;\n+import org.junit.Before;\n+import org.junit.Test;\n+import org.springframework.beans.factory.annotation.Autowired;\n+import org.springframework.test.web.servlet.MvcResult;\n+\n+public class CommunityCollectionParentIT extends AbstractControllerIntegrationTest {\n+\n+    @Autowired\n+    private CollectionService collectionService;\n+\n+    @Autowired\n+    private CommunityService communityService;\n+\n+    Community communityA;\n+    Community communityB;\n+    Community communityAA;\n+    Community communityAB;\n+\n+    Collection col1;\n+    Collection col2;\n+    Collection col3;\n+\n+    Item itemX;\n+    Item itemY;\n+    Item itemZ;\n+\n+\n+    @Before\n+    public void setup() throws SQLException, AuthorizeException {\n+        //We turn off the authorization system in order to create the structure as defined below\n+        context.turnOffAuthorisationSystem();\n+        //** GIVEN **\n+        //1. A community-collection structure with one parent community with sub-community and one collection.\n+        communityA = CommunityBuilder.createCommunity(context)\n+                                     .withName(\"Parent CommunityA\")\n+                                     .build();\n+        communityB = CommunityBuilder.createCommunity(context)\n+                                     .withName(\"Parent CommunityB\")\n+                                     .build();\n+        communityAA = CommunityBuilder.createSubCommunity(context, communityA)\n+                                      .withName(\"Sub Community\")\n+                                      .build();\n+        communityAB = CommunityBuilder.createSubCommunity(context, communityA)\n+                                      .withName(\"Sub Community Two\")\n+                                      .build();\n+        col1 = CollectionBuilder.createCollection(context, communityAA).withName(\"Collection 1\").build();\n+        col2 = CollectionBuilder.createCollection(context, communityAA).withName(\"Collection 2\").build();\n+        col3 = CollectionBuilder.createCollection(context, communityAB).withName(\"Collection 3\").build();\n+        communityService.addCollection(context, communityAB, col2);\n+\n+\n+        itemX = ItemBuilder.createItem(context, col1)\n+                           .withTitle(\"Public item 1\")\n+                           .withIssueDate(\"2017-10-17\")\n+                           .withAuthor(\"Smith, Donald\").withAuthor(\"Doe, John\")\n+                           .withSubject(\"ExtraEntry\")\n+                           .build();\n+\n+        itemY = ItemBuilder.createItem(context, col1)\n+                           .withTitle(\"Public item 1\")\n+                           .withIssueDate(\"2017-10-17\")\n+                           .withAuthor(\"Smith, Donald\").withAuthor(\"Doe, John\")\n+                           .withSubject(\"ExtraEntry\")\n+                           .build();\n+        collectionService.addItem(context, col2, itemY);\n+        itemZ = ItemBuilder.createItem(context, col2)\n+                           .withTitle(\"Public item 1\")\n+                           .withIssueDate(\"2017-10-17\")\n+                           .withAuthor(\"Smith, Donald\").withAuthor(\"Doe, John\")\n+                           .withSubject(\"ExtraEntry\")\n+                           .build();\n+\n+        context.restoreAuthSystemState();\n+    }\n+\n+    @Test\n+    public void itemXOwningCollectionTest() throws Exception {\n+\n+        ObjectMapper mapper = new ObjectMapper();\n+        String token = getAuthToken(admin.getEmail(), password);\n+        MvcResult mvcResult = getClient(token).perform(get(\"/api/core/items/\" + itemX.getID() + \"/owningCollection\"))\n+                                              .andReturn();\n+\n+        String content = mvcResult.getResponse().getContentAsString();\n+        Map<String, Object> map = mapper.readValue(content, Map.class);\n+        String collectionUuidString = String.valueOf(map.get(\"uuid\"));\n+        String collectionName = String.valueOf(map.get(\"name\"));\n+\n+        mvcResult = getClient(token).perform(get(\"/api/core/collections/\" + col1.getID())).andReturn();\n+        content = mvcResult.getResponse().getContentAsString();\n+        map = mapper.readValue(content, Map.class);\n+        String actualCollectionName = String.valueOf(map.get(\"name\"));\n+\n+        assertThat(collectionName, equalTo(actualCollectionName));\n+        assertThat(collectionUuidString, equalTo(String.valueOf(col1.getID())));\n+        assertThat(collectionUuidString, not(String.valueOf(col2.getID())));\n+\n+    }\n+\n+    @Test\n+    public void itemYOwningCollectionTest() throws Exception {\n+\n+        ObjectMapper mapper = new ObjectMapper();\n+        String token = getAuthToken(admin.getEmail(), password);\n+        MvcResult mvcResult = getClient(token).perform(get(\"/api/core/items/\" + itemY.getID() + \"/owningCollection\"))\n+                                              .andReturn();\n+\n+        String content = mvcResult.getResponse().getContentAsString();\n+        Map<String, Object> map = mapper.readValue(content, Map.class);\n+        String collectionUuidString = String.valueOf(map.get(\"uuid\"));\n+        String collectionName = String.valueOf(map.get(\"name\"));\n+\n+        mvcResult = getClient(token).perform(get(\"/api/core/collections/\" + col1.getID())).andReturn();\n+        content = mvcResult.getResponse().getContentAsString();\n+        map = mapper.readValue(content, Map.class);\n+        String actualCollectionName = String.valueOf(map.get(\"name\"));\n+\n+        assertThat(collectionName, equalTo(actualCollectionName));\n+        assertThat(collectionUuidString, equalTo(String.valueOf(col1.getID())));\n+        assertThat(collectionUuidString, not(String.valueOf(col2.getID())));\n+\n+    }\n+\n+    @Test\n+    public void itemZOwningCollectionTest() throws Exception {\n+\n+        ObjectMapper mapper = new ObjectMapper();\n+        String token = getAuthToken(admin.getEmail(), password);\n+        MvcResult mvcResult = getClient(token).perform(get(\"/api/core/items/\" + itemZ.getID() + \"/owningCollection\"))\n+                                              .andReturn();\n+\n+        String content = mvcResult.getResponse().getContentAsString();\n+        Map<String, Object> map = mapper.readValue(content, Map.class);\n+        String collectionUuidString = String.valueOf(map.get(\"uuid\"));\n+        String collectionName = String.valueOf(map.get(\"name\"));\n+\n+        mvcResult = getClient(token).perform(get(\"/api/core/collections/\" + col2.getID())).andReturn();\n+        content = mvcResult.getResponse().getContentAsString();\n+        map = mapper.readValue(content, Map.class);\n+        String actualCollectionName = String.valueOf(map.get(\"name\"));\n+\n+        assertThat(collectionName, equalTo(actualCollectionName));\n+        assertThat(collectionUuidString, equalTo(String.valueOf(col2.getID())));\n+        assertThat(collectionUuidString, not(String.valueOf(col1.getID())));\n+\n+    }\n+\n+    @Test\n+    public void col1ParentCommunityTest() throws Exception {\n+\n+        ObjectMapper mapper = new ObjectMapper();\n+        String token = getAuthToken(admin.getEmail(), password);\n+        MvcResult mvcResult = getClient(token)\n+            .perform(get(\"/api/core/collections/\" + col1.getID() + \"/parentCommunity\")).andReturn();\n+\n+        String content = mvcResult.getResponse().getContentAsString();\n+        Map<String, Object> map = mapper.readValue(content, Map.class);\n+        String communityUuidString = String.valueOf(map.get(\"uuid\"));\n+        String communityName = String.valueOf(map.get(\"name\"));\n+\n+        mvcResult = getClient(token).perform(get(\"/api/core/communities/\" + communityAA.getID())).andReturn();\n+        content = mvcResult.getResponse().getContentAsString();\n+        map = mapper.readValue(content, Map.class);\n+        String actualCommunityName = String.valueOf(map.get(\"name\"));\n+\n+        assertThat(communityName, equalTo(actualCommunityName));\n+        assertThat(communityUuidString, equalTo(String.valueOf(communityAA.getID())));\n+        assertThat(communityUuidString, not(String.valueOf(communityA.getID())));\n+        assertThat(communityUuidString, not(String.valueOf(communityAB.getID())));\n+\n+    }\n+\n+    @Test\n+    public void col2ParentCommunityTest() throws Exception {\n+\n+        ObjectMapper mapper = new ObjectMapper();\n+        String token = getAuthToken(admin.getEmail(), password);\n+        MvcResult mvcResult = getClient(token)\n+            .perform(get(\"/api/core/collections/\" + col2.getID() + \"/parentCommunity\")).andReturn();\n+\n+        String content = mvcResult.getResponse().getContentAsString();\n+        Map<String, Object> map = mapper.readValue(content, Map.class);\n+        String communityUuidString = String.valueOf(map.get(\"uuid\"));\n+        String communityName = String.valueOf(map.get(\"name\"));\n+\n+        mvcResult = getClient(token).perform(get(\"/api/core/communities/\" + communityAA.getID())).andReturn();\n+        content = mvcResult.getResponse().getContentAsString();\n+        map = mapper.readValue(content, Map.class);\n+        String actualCommunityName = String.valueOf(map.get(\"name\"));\n+\n+        assertThat(communityName, equalTo(actualCommunityName));\n+        assertThat(communityUuidString, equalTo(String.valueOf(communityAA.getID())));\n+        assertThat(communityUuidString, not(String.valueOf(communityA.getID())));\n+        assertThat(communityUuidString, not(String.valueOf(communityAB.getID())));\n+\n+    }\n+\n+    @Test\n+    public void col3ParentCommunityTest() throws Exception {\n+\n+        ObjectMapper mapper = new ObjectMapper();\n+        String token = getAuthToken(admin.getEmail(), password);\n+        MvcResult mvcResult = getClient(token)\n+            .perform(get(\"/api/core/collections/\" + col3.getID() + \"/parentCommunity\")).andReturn();\n+\n+        String content = mvcResult.getResponse().getContentAsString();\n+        Map<String, Object> map = mapper.readValue(content, Map.class);\n+        String communityUuidString = String.valueOf(map.get(\"uuid\"));\n+        String communityName = String.valueOf(map.get(\"name\"));\n+\n+        mvcResult = getClient(token).perform(get(\"/api/core/communities/\" + communityAB.getID())).andReturn();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "6447176f02a43210dd8f5044c18cd398c76c15a6"}, "originalPosition": 240}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjM3NzM5NTE2OnYy", "diffSide": "RIGHT", "path": "dspace-server-webapp/src/test/java/org/dspace/app/rest/CommunityCollectionParentIT.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yNVQxNDozODoyOFrOFuIgaw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yNVQxNDozODoyOFrOFuIgaw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MzkxODE4Nw==", "bodyText": "we should find a better name for this IT class as it also include test related to items. Should be TraverseCommunityCollectionItemParent ? mabye a sentence as javadoc explaining that could be also useful", "url": "https://github.com/DSpace/DSpace/pull/2673#discussion_r383918187", "createdAt": "2020-02-25T14:38:28Z", "author": {"login": "abollini"}, "path": "dspace-server-webapp/src/test/java/org/dspace/app/rest/CommunityCollectionParentIT.java", "diffHunk": "@@ -0,0 +1,218 @@\n+/**\n+ * The contents of this file are subject to the license and copyright\n+ * detailed in the LICENSE and NOTICE files at the root of the source\n+ * tree and available online at\n+ *\n+ * http://www.dspace.org/license/\n+ */\n+package org.dspace.app.rest;\n+\n+import static org.hamcrest.CoreMatchers.is;\n+import static org.hamcrest.CoreMatchers.not;\n+import static org.springframework.test.web.servlet.request.MockMvcRequestBuilders.get;\n+import static org.springframework.test.web.servlet.result.MockMvcResultMatchers.jsonPath;\n+import static org.springframework.test.web.servlet.result.MockMvcResultMatchers.status;\n+\n+import java.sql.SQLException;\n+\n+import org.dspace.app.rest.builder.CollectionBuilder;\n+import org.dspace.app.rest.builder.CommunityBuilder;\n+import org.dspace.app.rest.builder.ItemBuilder;\n+import org.dspace.app.rest.matcher.CollectionMatcher;\n+import org.dspace.app.rest.matcher.CommunityMatcher;\n+import org.dspace.app.rest.test.AbstractControllerIntegrationTest;\n+import org.dspace.authorize.AuthorizeException;\n+import org.dspace.content.Collection;\n+import org.dspace.content.Community;\n+import org.dspace.content.Item;\n+import org.dspace.content.service.CollectionService;\n+import org.dspace.content.service.CommunityService;\n+import org.hamcrest.Matchers;\n+import org.junit.Before;\n+import org.junit.Test;\n+import org.springframework.beans.factory.annotation.Autowired;\n+\n+public class CommunityCollectionParentIT extends AbstractControllerIntegrationTest {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "06f5199ec7e5bd36b84349e2ac22ad286356c613"}, "originalPosition": 35}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjM3NzQwNDgzOnYy", "diffSide": "RIGHT", "path": "dspace-server-webapp/src/test/java/org/dspace/app/rest/CommunityCollectionParentIT.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yNVQxNDo0MDo1MlrOFuImSQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yNVQxNDo0MDo1MlrOFuImSQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MzkxOTY4OQ==", "bodyText": "can we use the same name convention used for the community to make easier follow the hierarchy? colAA1, colAA2, colAB1", "url": "https://github.com/DSpace/DSpace/pull/2673#discussion_r383919689", "createdAt": "2020-02-25T14:40:52Z", "author": {"login": "abollini"}, "path": "dspace-server-webapp/src/test/java/org/dspace/app/rest/CommunityCollectionParentIT.java", "diffHunk": "@@ -0,0 +1,218 @@\n+/**\n+ * The contents of this file are subject to the license and copyright\n+ * detailed in the LICENSE and NOTICE files at the root of the source\n+ * tree and available online at\n+ *\n+ * http://www.dspace.org/license/\n+ */\n+package org.dspace.app.rest;\n+\n+import static org.hamcrest.CoreMatchers.is;\n+import static org.hamcrest.CoreMatchers.not;\n+import static org.springframework.test.web.servlet.request.MockMvcRequestBuilders.get;\n+import static org.springframework.test.web.servlet.result.MockMvcResultMatchers.jsonPath;\n+import static org.springframework.test.web.servlet.result.MockMvcResultMatchers.status;\n+\n+import java.sql.SQLException;\n+\n+import org.dspace.app.rest.builder.CollectionBuilder;\n+import org.dspace.app.rest.builder.CommunityBuilder;\n+import org.dspace.app.rest.builder.ItemBuilder;\n+import org.dspace.app.rest.matcher.CollectionMatcher;\n+import org.dspace.app.rest.matcher.CommunityMatcher;\n+import org.dspace.app.rest.test.AbstractControllerIntegrationTest;\n+import org.dspace.authorize.AuthorizeException;\n+import org.dspace.content.Collection;\n+import org.dspace.content.Community;\n+import org.dspace.content.Item;\n+import org.dspace.content.service.CollectionService;\n+import org.dspace.content.service.CommunityService;\n+import org.hamcrest.Matchers;\n+import org.junit.Before;\n+import org.junit.Test;\n+import org.springframework.beans.factory.annotation.Autowired;\n+\n+public class CommunityCollectionParentIT extends AbstractControllerIntegrationTest {\n+\n+    @Autowired\n+    private CollectionService collectionService;\n+\n+    @Autowired\n+    private CommunityService communityService;\n+\n+    Community communityA;\n+    Community communityB;\n+    Community communityAA;\n+    Community communityAB;\n+\n+    Collection col1;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "06f5199ec7e5bd36b84349e2ac22ad286356c613"}, "originalPosition": 48}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjM3NzQwOTU1OnYy", "diffSide": "RIGHT", "path": "dspace-server-webapp/src/test/java/org/dspace/app/rest/CommunityCollectionParentIT.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yNVQxNDo0MTo1OFrOFuIpHw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yNVQxNDo0MTo1OFrOFuIpHw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MzkyMDQxNQ==", "bodyText": "as above, maybe itemAA, itemAAmappedInAB, itemAB", "url": "https://github.com/DSpace/DSpace/pull/2673#discussion_r383920415", "createdAt": "2020-02-25T14:41:58Z", "author": {"login": "abollini"}, "path": "dspace-server-webapp/src/test/java/org/dspace/app/rest/CommunityCollectionParentIT.java", "diffHunk": "@@ -0,0 +1,218 @@\n+/**\n+ * The contents of this file are subject to the license and copyright\n+ * detailed in the LICENSE and NOTICE files at the root of the source\n+ * tree and available online at\n+ *\n+ * http://www.dspace.org/license/\n+ */\n+package org.dspace.app.rest;\n+\n+import static org.hamcrest.CoreMatchers.is;\n+import static org.hamcrest.CoreMatchers.not;\n+import static org.springframework.test.web.servlet.request.MockMvcRequestBuilders.get;\n+import static org.springframework.test.web.servlet.result.MockMvcResultMatchers.jsonPath;\n+import static org.springframework.test.web.servlet.result.MockMvcResultMatchers.status;\n+\n+import java.sql.SQLException;\n+\n+import org.dspace.app.rest.builder.CollectionBuilder;\n+import org.dspace.app.rest.builder.CommunityBuilder;\n+import org.dspace.app.rest.builder.ItemBuilder;\n+import org.dspace.app.rest.matcher.CollectionMatcher;\n+import org.dspace.app.rest.matcher.CommunityMatcher;\n+import org.dspace.app.rest.test.AbstractControllerIntegrationTest;\n+import org.dspace.authorize.AuthorizeException;\n+import org.dspace.content.Collection;\n+import org.dspace.content.Community;\n+import org.dspace.content.Item;\n+import org.dspace.content.service.CollectionService;\n+import org.dspace.content.service.CommunityService;\n+import org.hamcrest.Matchers;\n+import org.junit.Before;\n+import org.junit.Test;\n+import org.springframework.beans.factory.annotation.Autowired;\n+\n+public class CommunityCollectionParentIT extends AbstractControllerIntegrationTest {\n+\n+    @Autowired\n+    private CollectionService collectionService;\n+\n+    @Autowired\n+    private CommunityService communityService;\n+\n+    Community communityA;\n+    Community communityB;\n+    Community communityAA;\n+    Community communityAB;\n+\n+    Collection col1;\n+    Collection col2;\n+    Collection col3;\n+\n+    Item itemX;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "06f5199ec7e5bd36b84349e2ac22ad286356c613"}, "originalPosition": 52}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjM3NzQxNDI5OnYy", "diffSide": "RIGHT", "path": "dspace-server-webapp/src/test/java/org/dspace/app/rest/CommunityCollectionParentIT.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yNVQxNDo0MzowNlrOFuIsBQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yNVQxNDo0MzowNlrOFuIsBQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MzkyMTE1Nw==", "bodyText": "my suggestion is to remove this test as it is functionally equivalent to col1ParentCommunityTest", "url": "https://github.com/DSpace/DSpace/pull/2673#discussion_r383921157", "createdAt": "2020-02-25T14:43:06Z", "author": {"login": "abollini"}, "path": "dspace-server-webapp/src/test/java/org/dspace/app/rest/CommunityCollectionParentIT.java", "diffHunk": "@@ -0,0 +1,218 @@\n+/**\n+ * The contents of this file are subject to the license and copyright\n+ * detailed in the LICENSE and NOTICE files at the root of the source\n+ * tree and available online at\n+ *\n+ * http://www.dspace.org/license/\n+ */\n+package org.dspace.app.rest;\n+\n+import static org.hamcrest.CoreMatchers.is;\n+import static org.hamcrest.CoreMatchers.not;\n+import static org.springframework.test.web.servlet.request.MockMvcRequestBuilders.get;\n+import static org.springframework.test.web.servlet.result.MockMvcResultMatchers.jsonPath;\n+import static org.springframework.test.web.servlet.result.MockMvcResultMatchers.status;\n+\n+import java.sql.SQLException;\n+\n+import org.dspace.app.rest.builder.CollectionBuilder;\n+import org.dspace.app.rest.builder.CommunityBuilder;\n+import org.dspace.app.rest.builder.ItemBuilder;\n+import org.dspace.app.rest.matcher.CollectionMatcher;\n+import org.dspace.app.rest.matcher.CommunityMatcher;\n+import org.dspace.app.rest.test.AbstractControllerIntegrationTest;\n+import org.dspace.authorize.AuthorizeException;\n+import org.dspace.content.Collection;\n+import org.dspace.content.Community;\n+import org.dspace.content.Item;\n+import org.dspace.content.service.CollectionService;\n+import org.dspace.content.service.CommunityService;\n+import org.hamcrest.Matchers;\n+import org.junit.Before;\n+import org.junit.Test;\n+import org.springframework.beans.factory.annotation.Autowired;\n+\n+public class CommunityCollectionParentIT extends AbstractControllerIntegrationTest {\n+\n+    @Autowired\n+    private CollectionService collectionService;\n+\n+    @Autowired\n+    private CommunityService communityService;\n+\n+    Community communityA;\n+    Community communityB;\n+    Community communityAA;\n+    Community communityAB;\n+\n+    Collection col1;\n+    Collection col2;\n+    Collection col3;\n+\n+    Item itemX;\n+    Item itemY;\n+    Item itemZ;\n+\n+\n+    @Before\n+    public void setup() throws SQLException, AuthorizeException {\n+        //We turn off the authorization system in order to create the structure as defined below\n+        context.turnOffAuthorisationSystem();\n+        //** GIVEN **\n+        //1. A community-collection structure with one parent community with sub-community and one collection.\n+        communityA = CommunityBuilder.createCommunity(context)\n+                                     .withName(\"Parent CommunityA\")\n+                                     .build();\n+        communityB = CommunityBuilder.createCommunity(context)\n+                                     .withName(\"Parent CommunityB\")\n+                                     .build();\n+        communityAA = CommunityBuilder.createSubCommunity(context, communityA)\n+                                      .withName(\"Sub Community\")\n+                                      .build();\n+        communityAB = CommunityBuilder.createSubCommunity(context, communityA)\n+                                      .withName(\"Sub Community Two\")\n+                                      .build();\n+        col1 = CollectionBuilder.createCollection(context, communityAA).withName(\"Collection 1\").build();\n+        col2 = CollectionBuilder.createCollection(context, communityAA).withName(\"Collection 2\").build();\n+        col3 = CollectionBuilder.createCollection(context, communityAB).withName(\"Collection 3\").build();\n+        communityService.addCollection(context, communityAB, col2);\n+\n+\n+        itemX = ItemBuilder.createItem(context, col1)\n+                           .withTitle(\"Public item 1\")\n+                           .withIssueDate(\"2017-10-17\")\n+                           .withAuthor(\"Smith, Donald\").withAuthor(\"Doe, John\")\n+                           .withSubject(\"ExtraEntry\")\n+                           .build();\n+\n+        itemY = ItemBuilder.createItem(context, col1)\n+                           .withTitle(\"Public item 1\")\n+                           .withIssueDate(\"2017-10-17\")\n+                           .withAuthor(\"Smith, Donald\").withAuthor(\"Doe, John\")\n+                           .withSubject(\"ExtraEntry\")\n+                           .build();\n+        collectionService.addItem(context, col2, itemY);\n+        itemZ = ItemBuilder.createItem(context, col2)\n+                           .withTitle(\"Public item 1\")\n+                           .withIssueDate(\"2017-10-17\")\n+                           .withAuthor(\"Smith, Donald\").withAuthor(\"Doe, John\")\n+                           .withSubject(\"ExtraEntry\")\n+                           .build();\n+\n+        context.restoreAuthSystemState();\n+    }\n+\n+    @Test\n+    public void itemXOwningCollectionTest() throws Exception {\n+\n+        String token = getAuthToken(admin.getEmail(), password);\n+        getClient(token).perform(get(\"/api/core/items/\" + itemX.getID() + \"/owningCollection\"))\n+                        .andExpect(jsonPath(\"$\", is(CollectionMatcher.matchCollectionEntry(col1.getName(), col1.getID(),\n+                                                                                           col1.getHandle()))))\n+                        .andExpect(jsonPath(\"$\", Matchers\n+                            .not(is(CollectionMatcher\n+                                        .matchCollectionEntry(col2.getName(), col2.getID(), col2.getHandle())))));\n+\n+    }\n+\n+    @Test\n+    public void itemYOwningCollectionTest() throws Exception {\n+\n+        String token = getAuthToken(admin.getEmail(), password);\n+        getClient(token).perform(get(\"/api/core/items/\" + itemY.getID() + \"/owningCollection\"))\n+                        .andExpect(jsonPath(\"$\", is(CollectionMatcher.matchCollectionEntry(col1.getName(), col1.getID(),\n+                                                                                           col1.getHandle()))))\n+                        .andExpect(jsonPath(\"$\", Matchers\n+                            .not(is(CollectionMatcher\n+                                        .matchCollectionEntry(col2.getName(), col2.getID(), col2.getHandle())))));\n+    }\n+\n+    @Test\n+    public void itemZOwningCollectionTest() throws Exception {\n+\n+        String token = getAuthToken(admin.getEmail(), password);\n+        getClient(token).perform(get(\"/api/core/items/\" + itemZ.getID() + \"/owningCollection\"))\n+                        .andExpect(jsonPath(\"$\", is(CollectionMatcher.matchCollectionEntry(col2.getName(), col2.getID(),\n+                                                                                           col2.getHandle()))))\n+                        .andExpect(jsonPath(\"$\", Matchers\n+                            .not(is(CollectionMatcher\n+                                        .matchCollectionEntry(col1.getName(), col1.getID(), col1.getHandle())))));\n+\n+    }\n+\n+    @Test\n+    public void col1ParentCommunityTest() throws Exception {\n+\n+        String token = getAuthToken(admin.getEmail(), password);\n+        getClient(token).perform(get(\"/api/core/collections/\" + col1.getID() + \"/parentCommunity\"))\n+                        .andExpect(jsonPath(\"$\", is(CommunityMatcher\n+                                                        .matchCommunityEntry(communityAA.getName(), communityAA.getID(),\n+                                                                             communityAA.getHandle()))))\n+                        .andExpect(jsonPath(\"$\", not(is(CommunityMatcher.matchCommunityEntry(communityA.getName(),\n+                                                                                             communityA.getID(),\n+                                                                                             communityA.getHandle())))))\n+                        .andExpect(jsonPath(\"$\", not(is(CommunityMatcher.matchCommunityEntry(communityAB.getName(),\n+                                                                                             communityAB.getID(),\n+                                                                                             communityAB\n+                                                                                                 .getHandle())))));\n+\n+    }\n+\n+    @Test\n+    public void col2ParentCommunityTest() throws Exception {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "06f5199ec7e5bd36b84349e2ac22ad286356c613"}, "originalPosition": 162}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjM3NzQxNTc3OnYy", "diffSide": "RIGHT", "path": "dspace-server-webapp/src/test/java/org/dspace/app/rest/CommunityCollectionParentIT.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yNVQxNDo0MzoyNlrOFuIs4Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yNVQxNDo0MzoyNlrOFuIs4Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MzkyMTM3Nw==", "bodyText": "my suggestion is to remove this test as it is functionally equivalent to col1ParentCommunityTest", "url": "https://github.com/DSpace/DSpace/pull/2673#discussion_r383921377", "createdAt": "2020-02-25T14:43:26Z", "author": {"login": "abollini"}, "path": "dspace-server-webapp/src/test/java/org/dspace/app/rest/CommunityCollectionParentIT.java", "diffHunk": "@@ -0,0 +1,218 @@\n+/**\n+ * The contents of this file are subject to the license and copyright\n+ * detailed in the LICENSE and NOTICE files at the root of the source\n+ * tree and available online at\n+ *\n+ * http://www.dspace.org/license/\n+ */\n+package org.dspace.app.rest;\n+\n+import static org.hamcrest.CoreMatchers.is;\n+import static org.hamcrest.CoreMatchers.not;\n+import static org.springframework.test.web.servlet.request.MockMvcRequestBuilders.get;\n+import static org.springframework.test.web.servlet.result.MockMvcResultMatchers.jsonPath;\n+import static org.springframework.test.web.servlet.result.MockMvcResultMatchers.status;\n+\n+import java.sql.SQLException;\n+\n+import org.dspace.app.rest.builder.CollectionBuilder;\n+import org.dspace.app.rest.builder.CommunityBuilder;\n+import org.dspace.app.rest.builder.ItemBuilder;\n+import org.dspace.app.rest.matcher.CollectionMatcher;\n+import org.dspace.app.rest.matcher.CommunityMatcher;\n+import org.dspace.app.rest.test.AbstractControllerIntegrationTest;\n+import org.dspace.authorize.AuthorizeException;\n+import org.dspace.content.Collection;\n+import org.dspace.content.Community;\n+import org.dspace.content.Item;\n+import org.dspace.content.service.CollectionService;\n+import org.dspace.content.service.CommunityService;\n+import org.hamcrest.Matchers;\n+import org.junit.Before;\n+import org.junit.Test;\n+import org.springframework.beans.factory.annotation.Autowired;\n+\n+public class CommunityCollectionParentIT extends AbstractControllerIntegrationTest {\n+\n+    @Autowired\n+    private CollectionService collectionService;\n+\n+    @Autowired\n+    private CommunityService communityService;\n+\n+    Community communityA;\n+    Community communityB;\n+    Community communityAA;\n+    Community communityAB;\n+\n+    Collection col1;\n+    Collection col2;\n+    Collection col3;\n+\n+    Item itemX;\n+    Item itemY;\n+    Item itemZ;\n+\n+\n+    @Before\n+    public void setup() throws SQLException, AuthorizeException {\n+        //We turn off the authorization system in order to create the structure as defined below\n+        context.turnOffAuthorisationSystem();\n+        //** GIVEN **\n+        //1. A community-collection structure with one parent community with sub-community and one collection.\n+        communityA = CommunityBuilder.createCommunity(context)\n+                                     .withName(\"Parent CommunityA\")\n+                                     .build();\n+        communityB = CommunityBuilder.createCommunity(context)\n+                                     .withName(\"Parent CommunityB\")\n+                                     .build();\n+        communityAA = CommunityBuilder.createSubCommunity(context, communityA)\n+                                      .withName(\"Sub Community\")\n+                                      .build();\n+        communityAB = CommunityBuilder.createSubCommunity(context, communityA)\n+                                      .withName(\"Sub Community Two\")\n+                                      .build();\n+        col1 = CollectionBuilder.createCollection(context, communityAA).withName(\"Collection 1\").build();\n+        col2 = CollectionBuilder.createCollection(context, communityAA).withName(\"Collection 2\").build();\n+        col3 = CollectionBuilder.createCollection(context, communityAB).withName(\"Collection 3\").build();\n+        communityService.addCollection(context, communityAB, col2);\n+\n+\n+        itemX = ItemBuilder.createItem(context, col1)\n+                           .withTitle(\"Public item 1\")\n+                           .withIssueDate(\"2017-10-17\")\n+                           .withAuthor(\"Smith, Donald\").withAuthor(\"Doe, John\")\n+                           .withSubject(\"ExtraEntry\")\n+                           .build();\n+\n+        itemY = ItemBuilder.createItem(context, col1)\n+                           .withTitle(\"Public item 1\")\n+                           .withIssueDate(\"2017-10-17\")\n+                           .withAuthor(\"Smith, Donald\").withAuthor(\"Doe, John\")\n+                           .withSubject(\"ExtraEntry\")\n+                           .build();\n+        collectionService.addItem(context, col2, itemY);\n+        itemZ = ItemBuilder.createItem(context, col2)\n+                           .withTitle(\"Public item 1\")\n+                           .withIssueDate(\"2017-10-17\")\n+                           .withAuthor(\"Smith, Donald\").withAuthor(\"Doe, John\")\n+                           .withSubject(\"ExtraEntry\")\n+                           .build();\n+\n+        context.restoreAuthSystemState();\n+    }\n+\n+    @Test\n+    public void itemXOwningCollectionTest() throws Exception {\n+\n+        String token = getAuthToken(admin.getEmail(), password);\n+        getClient(token).perform(get(\"/api/core/items/\" + itemX.getID() + \"/owningCollection\"))\n+                        .andExpect(jsonPath(\"$\", is(CollectionMatcher.matchCollectionEntry(col1.getName(), col1.getID(),\n+                                                                                           col1.getHandle()))))\n+                        .andExpect(jsonPath(\"$\", Matchers\n+                            .not(is(CollectionMatcher\n+                                        .matchCollectionEntry(col2.getName(), col2.getID(), col2.getHandle())))));\n+\n+    }\n+\n+    @Test\n+    public void itemYOwningCollectionTest() throws Exception {\n+\n+        String token = getAuthToken(admin.getEmail(), password);\n+        getClient(token).perform(get(\"/api/core/items/\" + itemY.getID() + \"/owningCollection\"))\n+                        .andExpect(jsonPath(\"$\", is(CollectionMatcher.matchCollectionEntry(col1.getName(), col1.getID(),\n+                                                                                           col1.getHandle()))))\n+                        .andExpect(jsonPath(\"$\", Matchers\n+                            .not(is(CollectionMatcher\n+                                        .matchCollectionEntry(col2.getName(), col2.getID(), col2.getHandle())))));\n+    }\n+\n+    @Test\n+    public void itemZOwningCollectionTest() throws Exception {\n+\n+        String token = getAuthToken(admin.getEmail(), password);\n+        getClient(token).perform(get(\"/api/core/items/\" + itemZ.getID() + \"/owningCollection\"))\n+                        .andExpect(jsonPath(\"$\", is(CollectionMatcher.matchCollectionEntry(col2.getName(), col2.getID(),\n+                                                                                           col2.getHandle()))))\n+                        .andExpect(jsonPath(\"$\", Matchers\n+                            .not(is(CollectionMatcher\n+                                        .matchCollectionEntry(col1.getName(), col1.getID(), col1.getHandle())))));\n+\n+    }\n+\n+    @Test\n+    public void col1ParentCommunityTest() throws Exception {\n+\n+        String token = getAuthToken(admin.getEmail(), password);\n+        getClient(token).perform(get(\"/api/core/collections/\" + col1.getID() + \"/parentCommunity\"))\n+                        .andExpect(jsonPath(\"$\", is(CommunityMatcher\n+                                                        .matchCommunityEntry(communityAA.getName(), communityAA.getID(),\n+                                                                             communityAA.getHandle()))))\n+                        .andExpect(jsonPath(\"$\", not(is(CommunityMatcher.matchCommunityEntry(communityA.getName(),\n+                                                                                             communityA.getID(),\n+                                                                                             communityA.getHandle())))))\n+                        .andExpect(jsonPath(\"$\", not(is(CommunityMatcher.matchCommunityEntry(communityAB.getName(),\n+                                                                                             communityAB.getID(),\n+                                                                                             communityAB\n+                                                                                                 .getHandle())))));\n+\n+    }\n+\n+    @Test\n+    public void col2ParentCommunityTest() throws Exception {\n+\n+        String token = getAuthToken(admin.getEmail(), password);\n+        getClient(token)\n+            .perform(get(\"/api/core/collections/\" + col2.getID() + \"/parentCommunity\"))\n+            .andExpect(jsonPath(\"$\", is(CommunityMatcher.matchCommunityEntry(communityAA.getName(), communityAA.getID(),\n+                                                                             communityAA.getHandle()))))\n+            .andExpect(jsonPath(\"$\", not(is(CommunityMatcher\n+                                                .matchCommunityEntry(communityA.getName(), communityA.getID(),\n+                                                                     communityA.getHandle())))))\n+            .andExpect(jsonPath(\"$\", not(is(CommunityMatcher\n+                                                .matchCommunityEntry(communityAB.getName(), communityAB.getID(),\n+                                                                     communityAB.getHandle())))));\n+\n+    }\n+\n+    @Test\n+    public void col3ParentCommunityTest() throws Exception {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "06f5199ec7e5bd36b84349e2ac22ad286356c613"}, "originalPosition": 179}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjM3NzQyOTc0OnYy", "diffSide": "RIGHT", "path": "dspace-server-webapp/src/test/java/org/dspace/app/rest/CommunityCollectionParentIT.java", "isResolved": true, "comments": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yNVQxNDo0NjozN1rOFuI1ZQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yN1QxNjoxMjo1NlrOFvXcSg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MzkyMzU1Nw==", "bodyText": "we need all the test related to the security and wrong scenarios.\nThe specified item, collection, community\n\ndon't exist, don't make sense (i.e. it is not an uuid) -> (404)\nare not visibile (401, 403)\nthe starting object is visible but the parent is not visible (401, 403)", "url": "https://github.com/DSpace/DSpace/pull/2673#discussion_r383923557", "createdAt": "2020-02-25T14:46:37Z", "author": {"login": "abollini"}, "path": "dspace-server-webapp/src/test/java/org/dspace/app/rest/CommunityCollectionParentIT.java", "diffHunk": "@@ -0,0 +1,218 @@\n+/**\n+ * The contents of this file are subject to the license and copyright\n+ * detailed in the LICENSE and NOTICE files at the root of the source\n+ * tree and available online at\n+ *\n+ * http://www.dspace.org/license/\n+ */\n+package org.dspace.app.rest;\n+\n+import static org.hamcrest.CoreMatchers.is;\n+import static org.hamcrest.CoreMatchers.not;\n+import static org.springframework.test.web.servlet.request.MockMvcRequestBuilders.get;\n+import static org.springframework.test.web.servlet.result.MockMvcResultMatchers.jsonPath;\n+import static org.springframework.test.web.servlet.result.MockMvcResultMatchers.status;\n+\n+import java.sql.SQLException;\n+\n+import org.dspace.app.rest.builder.CollectionBuilder;\n+import org.dspace.app.rest.builder.CommunityBuilder;\n+import org.dspace.app.rest.builder.ItemBuilder;\n+import org.dspace.app.rest.matcher.CollectionMatcher;\n+import org.dspace.app.rest.matcher.CommunityMatcher;\n+import org.dspace.app.rest.test.AbstractControllerIntegrationTest;\n+import org.dspace.authorize.AuthorizeException;\n+import org.dspace.content.Collection;\n+import org.dspace.content.Community;\n+import org.dspace.content.Item;\n+import org.dspace.content.service.CollectionService;\n+import org.dspace.content.service.CommunityService;\n+import org.hamcrest.Matchers;\n+import org.junit.Before;\n+import org.junit.Test;\n+import org.springframework.beans.factory.annotation.Autowired;\n+\n+public class CommunityCollectionParentIT extends AbstractControllerIntegrationTest {\n+\n+    @Autowired\n+    private CollectionService collectionService;\n+\n+    @Autowired\n+    private CommunityService communityService;\n+\n+    Community communityA;\n+    Community communityB;\n+    Community communityAA;\n+    Community communityAB;\n+\n+    Collection col1;\n+    Collection col2;\n+    Collection col3;\n+\n+    Item itemX;\n+    Item itemY;\n+    Item itemZ;\n+\n+\n+    @Before\n+    public void setup() throws SQLException, AuthorizeException {\n+        //We turn off the authorization system in order to create the structure as defined below\n+        context.turnOffAuthorisationSystem();\n+        //** GIVEN **\n+        //1. A community-collection structure with one parent community with sub-community and one collection.\n+        communityA = CommunityBuilder.createCommunity(context)\n+                                     .withName(\"Parent CommunityA\")\n+                                     .build();\n+        communityB = CommunityBuilder.createCommunity(context)\n+                                     .withName(\"Parent CommunityB\")\n+                                     .build();\n+        communityAA = CommunityBuilder.createSubCommunity(context, communityA)\n+                                      .withName(\"Sub Community\")\n+                                      .build();\n+        communityAB = CommunityBuilder.createSubCommunity(context, communityA)\n+                                      .withName(\"Sub Community Two\")\n+                                      .build();\n+        col1 = CollectionBuilder.createCollection(context, communityAA).withName(\"Collection 1\").build();\n+        col2 = CollectionBuilder.createCollection(context, communityAA).withName(\"Collection 2\").build();\n+        col3 = CollectionBuilder.createCollection(context, communityAB).withName(\"Collection 3\").build();\n+        communityService.addCollection(context, communityAB, col2);\n+\n+\n+        itemX = ItemBuilder.createItem(context, col1)\n+                           .withTitle(\"Public item 1\")\n+                           .withIssueDate(\"2017-10-17\")\n+                           .withAuthor(\"Smith, Donald\").withAuthor(\"Doe, John\")\n+                           .withSubject(\"ExtraEntry\")\n+                           .build();\n+\n+        itemY = ItemBuilder.createItem(context, col1)\n+                           .withTitle(\"Public item 1\")\n+                           .withIssueDate(\"2017-10-17\")\n+                           .withAuthor(\"Smith, Donald\").withAuthor(\"Doe, John\")\n+                           .withSubject(\"ExtraEntry\")\n+                           .build();\n+        collectionService.addItem(context, col2, itemY);\n+        itemZ = ItemBuilder.createItem(context, col2)\n+                           .withTitle(\"Public item 1\")\n+                           .withIssueDate(\"2017-10-17\")\n+                           .withAuthor(\"Smith, Donald\").withAuthor(\"Doe, John\")\n+                           .withSubject(\"ExtraEntry\")\n+                           .build();\n+\n+        context.restoreAuthSystemState();\n+    }\n+\n+    @Test\n+    public void itemXOwningCollectionTest() throws Exception {\n+\n+        String token = getAuthToken(admin.getEmail(), password);\n+        getClient(token).perform(get(\"/api/core/items/\" + itemX.getID() + \"/owningCollection\"))\n+                        .andExpect(jsonPath(\"$\", is(CollectionMatcher.matchCollectionEntry(col1.getName(), col1.getID(),\n+                                                                                           col1.getHandle()))))\n+                        .andExpect(jsonPath(\"$\", Matchers\n+                            .not(is(CollectionMatcher\n+                                        .matchCollectionEntry(col2.getName(), col2.getID(), col2.getHandle())))));\n+\n+    }\n+\n+    @Test\n+    public void itemYOwningCollectionTest() throws Exception {\n+\n+        String token = getAuthToken(admin.getEmail(), password);\n+        getClient(token).perform(get(\"/api/core/items/\" + itemY.getID() + \"/owningCollection\"))\n+                        .andExpect(jsonPath(\"$\", is(CollectionMatcher.matchCollectionEntry(col1.getName(), col1.getID(),\n+                                                                                           col1.getHandle()))))\n+                        .andExpect(jsonPath(\"$\", Matchers\n+                            .not(is(CollectionMatcher\n+                                        .matchCollectionEntry(col2.getName(), col2.getID(), col2.getHandle())))));\n+    }\n+\n+    @Test\n+    public void itemZOwningCollectionTest() throws Exception {\n+\n+        String token = getAuthToken(admin.getEmail(), password);\n+        getClient(token).perform(get(\"/api/core/items/\" + itemZ.getID() + \"/owningCollection\"))\n+                        .andExpect(jsonPath(\"$\", is(CollectionMatcher.matchCollectionEntry(col2.getName(), col2.getID(),\n+                                                                                           col2.getHandle()))))\n+                        .andExpect(jsonPath(\"$\", Matchers\n+                            .not(is(CollectionMatcher\n+                                        .matchCollectionEntry(col1.getName(), col1.getID(), col1.getHandle())))));\n+\n+    }\n+\n+    @Test\n+    public void col1ParentCommunityTest() throws Exception {\n+\n+        String token = getAuthToken(admin.getEmail(), password);\n+        getClient(token).perform(get(\"/api/core/collections/\" + col1.getID() + \"/parentCommunity\"))\n+                        .andExpect(jsonPath(\"$\", is(CommunityMatcher\n+                                                        .matchCommunityEntry(communityAA.getName(), communityAA.getID(),\n+                                                                             communityAA.getHandle()))))\n+                        .andExpect(jsonPath(\"$\", not(is(CommunityMatcher.matchCommunityEntry(communityA.getName(),\n+                                                                                             communityA.getID(),\n+                                                                                             communityA.getHandle())))))\n+                        .andExpect(jsonPath(\"$\", not(is(CommunityMatcher.matchCommunityEntry(communityAB.getName(),\n+                                                                                             communityAB.getID(),\n+                                                                                             communityAB\n+                                                                                                 .getHandle())))));\n+\n+    }\n+\n+    @Test\n+    public void col2ParentCommunityTest() throws Exception {\n+\n+        String token = getAuthToken(admin.getEmail(), password);\n+        getClient(token)\n+            .perform(get(\"/api/core/collections/\" + col2.getID() + \"/parentCommunity\"))\n+            .andExpect(jsonPath(\"$\", is(CommunityMatcher.matchCommunityEntry(communityAA.getName(), communityAA.getID(),\n+                                                                             communityAA.getHandle()))))\n+            .andExpect(jsonPath(\"$\", not(is(CommunityMatcher\n+                                                .matchCommunityEntry(communityA.getName(), communityA.getID(),\n+                                                                     communityA.getHandle())))))\n+            .andExpect(jsonPath(\"$\", not(is(CommunityMatcher\n+                                                .matchCommunityEntry(communityAB.getName(), communityAB.getID(),\n+                                                                     communityAB.getHandle())))));\n+\n+    }\n+\n+    @Test\n+    public void col3ParentCommunityTest() throws Exception {\n+\n+        String token = getAuthToken(admin.getEmail(), password);\n+        getClient(token)\n+            .perform(get(\"/api/core/collections/\" + col3.getID() + \"/parentCommunity\"))\n+            .andExpect(jsonPath(\"$\", is(CommunityMatcher.matchCommunityEntry(communityAB.getName(), communityAB.getID(),\n+                                                                             communityAB.getHandle()))))\n+            .andExpect(jsonPath(\"$\", not(is(CommunityMatcher\n+                                                .matchCommunityEntry(communityA.getName(), communityA.getID(),\n+                                                                     communityA.getHandle())))))\n+            .andExpect(jsonPath(\"$\", not(is(CommunityMatcher\n+                                                .matchCommunityEntry(communityAA.getName(), communityAA.getID(),\n+                                                                     communityAA.getHandle())))));\n+\n+    }\n+\n+    @Test\n+    public void comAAParentCommunityTest() throws Exception {\n+\n+        String token = getAuthToken(admin.getEmail(), password);\n+        getClient(token)\n+            .perform(get(\"/api/core/communities/\" + communityAA.getID() + \"/parentCommunity\"))\n+            .andExpect(jsonPath(\"$\", Matchers\n+                .is(CommunityMatcher.matchCommunityEntry(communityA.getID(), communityA.getHandle()))))\n+            .andExpect(jsonPath(\"$\", Matchers\n+                .not(Matchers.is(CommunityMatcher.matchCommunityEntry(communityB.getID(), communityB.getHandle())))));\n+\n+    }\n+\n+    @Test\n+    public void comAParentCommunityTest() throws Exception {\n+\n+        String token = getAuthToken(admin.getEmail(), password);\n+        getClient(token).perform(get(\"/api/core/communities/\" + communityA.getID() + \"/parentCommunity\"))\n+                        .andExpect(status().isNoContent());\n+\n+\n+    }\n+", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "06f5199ec7e5bd36b84349e2ac22ad286356c613"}, "originalPosition": 217}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MzkzNzk5OQ==", "bodyText": "@abollini : I'm not sure the 404 test is needed, as we already have corresponding 404 tests in ITs for Communities, Collections & Items. How can a 404 test here add anything different?\nI do agree that the other two types of tests would be worth adding, though we could consider doing so as a separate security ticket (as you noted), provided that we create a ticket in JIRA.", "url": "https://github.com/DSpace/DSpace/pull/2673#discussion_r383937999", "createdAt": "2020-02-25T15:07:47Z", "author": {"login": "tdonohue"}, "path": "dspace-server-webapp/src/test/java/org/dspace/app/rest/CommunityCollectionParentIT.java", "diffHunk": "@@ -0,0 +1,218 @@\n+/**\n+ * The contents of this file are subject to the license and copyright\n+ * detailed in the LICENSE and NOTICE files at the root of the source\n+ * tree and available online at\n+ *\n+ * http://www.dspace.org/license/\n+ */\n+package org.dspace.app.rest;\n+\n+import static org.hamcrest.CoreMatchers.is;\n+import static org.hamcrest.CoreMatchers.not;\n+import static org.springframework.test.web.servlet.request.MockMvcRequestBuilders.get;\n+import static org.springframework.test.web.servlet.result.MockMvcResultMatchers.jsonPath;\n+import static org.springframework.test.web.servlet.result.MockMvcResultMatchers.status;\n+\n+import java.sql.SQLException;\n+\n+import org.dspace.app.rest.builder.CollectionBuilder;\n+import org.dspace.app.rest.builder.CommunityBuilder;\n+import org.dspace.app.rest.builder.ItemBuilder;\n+import org.dspace.app.rest.matcher.CollectionMatcher;\n+import org.dspace.app.rest.matcher.CommunityMatcher;\n+import org.dspace.app.rest.test.AbstractControllerIntegrationTest;\n+import org.dspace.authorize.AuthorizeException;\n+import org.dspace.content.Collection;\n+import org.dspace.content.Community;\n+import org.dspace.content.Item;\n+import org.dspace.content.service.CollectionService;\n+import org.dspace.content.service.CommunityService;\n+import org.hamcrest.Matchers;\n+import org.junit.Before;\n+import org.junit.Test;\n+import org.springframework.beans.factory.annotation.Autowired;\n+\n+public class CommunityCollectionParentIT extends AbstractControllerIntegrationTest {\n+\n+    @Autowired\n+    private CollectionService collectionService;\n+\n+    @Autowired\n+    private CommunityService communityService;\n+\n+    Community communityA;\n+    Community communityB;\n+    Community communityAA;\n+    Community communityAB;\n+\n+    Collection col1;\n+    Collection col2;\n+    Collection col3;\n+\n+    Item itemX;\n+    Item itemY;\n+    Item itemZ;\n+\n+\n+    @Before\n+    public void setup() throws SQLException, AuthorizeException {\n+        //We turn off the authorization system in order to create the structure as defined below\n+        context.turnOffAuthorisationSystem();\n+        //** GIVEN **\n+        //1. A community-collection structure with one parent community with sub-community and one collection.\n+        communityA = CommunityBuilder.createCommunity(context)\n+                                     .withName(\"Parent CommunityA\")\n+                                     .build();\n+        communityB = CommunityBuilder.createCommunity(context)\n+                                     .withName(\"Parent CommunityB\")\n+                                     .build();\n+        communityAA = CommunityBuilder.createSubCommunity(context, communityA)\n+                                      .withName(\"Sub Community\")\n+                                      .build();\n+        communityAB = CommunityBuilder.createSubCommunity(context, communityA)\n+                                      .withName(\"Sub Community Two\")\n+                                      .build();\n+        col1 = CollectionBuilder.createCollection(context, communityAA).withName(\"Collection 1\").build();\n+        col2 = CollectionBuilder.createCollection(context, communityAA).withName(\"Collection 2\").build();\n+        col3 = CollectionBuilder.createCollection(context, communityAB).withName(\"Collection 3\").build();\n+        communityService.addCollection(context, communityAB, col2);\n+\n+\n+        itemX = ItemBuilder.createItem(context, col1)\n+                           .withTitle(\"Public item 1\")\n+                           .withIssueDate(\"2017-10-17\")\n+                           .withAuthor(\"Smith, Donald\").withAuthor(\"Doe, John\")\n+                           .withSubject(\"ExtraEntry\")\n+                           .build();\n+\n+        itemY = ItemBuilder.createItem(context, col1)\n+                           .withTitle(\"Public item 1\")\n+                           .withIssueDate(\"2017-10-17\")\n+                           .withAuthor(\"Smith, Donald\").withAuthor(\"Doe, John\")\n+                           .withSubject(\"ExtraEntry\")\n+                           .build();\n+        collectionService.addItem(context, col2, itemY);\n+        itemZ = ItemBuilder.createItem(context, col2)\n+                           .withTitle(\"Public item 1\")\n+                           .withIssueDate(\"2017-10-17\")\n+                           .withAuthor(\"Smith, Donald\").withAuthor(\"Doe, John\")\n+                           .withSubject(\"ExtraEntry\")\n+                           .build();\n+\n+        context.restoreAuthSystemState();\n+    }\n+\n+    @Test\n+    public void itemXOwningCollectionTest() throws Exception {\n+\n+        String token = getAuthToken(admin.getEmail(), password);\n+        getClient(token).perform(get(\"/api/core/items/\" + itemX.getID() + \"/owningCollection\"))\n+                        .andExpect(jsonPath(\"$\", is(CollectionMatcher.matchCollectionEntry(col1.getName(), col1.getID(),\n+                                                                                           col1.getHandle()))))\n+                        .andExpect(jsonPath(\"$\", Matchers\n+                            .not(is(CollectionMatcher\n+                                        .matchCollectionEntry(col2.getName(), col2.getID(), col2.getHandle())))));\n+\n+    }\n+\n+    @Test\n+    public void itemYOwningCollectionTest() throws Exception {\n+\n+        String token = getAuthToken(admin.getEmail(), password);\n+        getClient(token).perform(get(\"/api/core/items/\" + itemY.getID() + \"/owningCollection\"))\n+                        .andExpect(jsonPath(\"$\", is(CollectionMatcher.matchCollectionEntry(col1.getName(), col1.getID(),\n+                                                                                           col1.getHandle()))))\n+                        .andExpect(jsonPath(\"$\", Matchers\n+                            .not(is(CollectionMatcher\n+                                        .matchCollectionEntry(col2.getName(), col2.getID(), col2.getHandle())))));\n+    }\n+\n+    @Test\n+    public void itemZOwningCollectionTest() throws Exception {\n+\n+        String token = getAuthToken(admin.getEmail(), password);\n+        getClient(token).perform(get(\"/api/core/items/\" + itemZ.getID() + \"/owningCollection\"))\n+                        .andExpect(jsonPath(\"$\", is(CollectionMatcher.matchCollectionEntry(col2.getName(), col2.getID(),\n+                                                                                           col2.getHandle()))))\n+                        .andExpect(jsonPath(\"$\", Matchers\n+                            .not(is(CollectionMatcher\n+                                        .matchCollectionEntry(col1.getName(), col1.getID(), col1.getHandle())))));\n+\n+    }\n+\n+    @Test\n+    public void col1ParentCommunityTest() throws Exception {\n+\n+        String token = getAuthToken(admin.getEmail(), password);\n+        getClient(token).perform(get(\"/api/core/collections/\" + col1.getID() + \"/parentCommunity\"))\n+                        .andExpect(jsonPath(\"$\", is(CommunityMatcher\n+                                                        .matchCommunityEntry(communityAA.getName(), communityAA.getID(),\n+                                                                             communityAA.getHandle()))))\n+                        .andExpect(jsonPath(\"$\", not(is(CommunityMatcher.matchCommunityEntry(communityA.getName(),\n+                                                                                             communityA.getID(),\n+                                                                                             communityA.getHandle())))))\n+                        .andExpect(jsonPath(\"$\", not(is(CommunityMatcher.matchCommunityEntry(communityAB.getName(),\n+                                                                                             communityAB.getID(),\n+                                                                                             communityAB\n+                                                                                                 .getHandle())))));\n+\n+    }\n+\n+    @Test\n+    public void col2ParentCommunityTest() throws Exception {\n+\n+        String token = getAuthToken(admin.getEmail(), password);\n+        getClient(token)\n+            .perform(get(\"/api/core/collections/\" + col2.getID() + \"/parentCommunity\"))\n+            .andExpect(jsonPath(\"$\", is(CommunityMatcher.matchCommunityEntry(communityAA.getName(), communityAA.getID(),\n+                                                                             communityAA.getHandle()))))\n+            .andExpect(jsonPath(\"$\", not(is(CommunityMatcher\n+                                                .matchCommunityEntry(communityA.getName(), communityA.getID(),\n+                                                                     communityA.getHandle())))))\n+            .andExpect(jsonPath(\"$\", not(is(CommunityMatcher\n+                                                .matchCommunityEntry(communityAB.getName(), communityAB.getID(),\n+                                                                     communityAB.getHandle())))));\n+\n+    }\n+\n+    @Test\n+    public void col3ParentCommunityTest() throws Exception {\n+\n+        String token = getAuthToken(admin.getEmail(), password);\n+        getClient(token)\n+            .perform(get(\"/api/core/collections/\" + col3.getID() + \"/parentCommunity\"))\n+            .andExpect(jsonPath(\"$\", is(CommunityMatcher.matchCommunityEntry(communityAB.getName(), communityAB.getID(),\n+                                                                             communityAB.getHandle()))))\n+            .andExpect(jsonPath(\"$\", not(is(CommunityMatcher\n+                                                .matchCommunityEntry(communityA.getName(), communityA.getID(),\n+                                                                     communityA.getHandle())))))\n+            .andExpect(jsonPath(\"$\", not(is(CommunityMatcher\n+                                                .matchCommunityEntry(communityAA.getName(), communityAA.getID(),\n+                                                                     communityAA.getHandle())))));\n+\n+    }\n+\n+    @Test\n+    public void comAAParentCommunityTest() throws Exception {\n+\n+        String token = getAuthToken(admin.getEmail(), password);\n+        getClient(token)\n+            .perform(get(\"/api/core/communities/\" + communityAA.getID() + \"/parentCommunity\"))\n+            .andExpect(jsonPath(\"$\", Matchers\n+                .is(CommunityMatcher.matchCommunityEntry(communityA.getID(), communityA.getHandle()))))\n+            .andExpect(jsonPath(\"$\", Matchers\n+                .not(Matchers.is(CommunityMatcher.matchCommunityEntry(communityB.getID(), communityB.getHandle())))));\n+\n+    }\n+\n+    @Test\n+    public void comAParentCommunityTest() throws Exception {\n+\n+        String token = getAuthToken(admin.getEmail(), password);\n+        getClient(token).perform(get(\"/api/core/communities/\" + communityA.getID() + \"/parentCommunity\"))\n+                        .andExpect(status().isNoContent());\n+\n+\n+    }\n+", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MzkyMzU1Nw=="}, "originalCommit": {"oid": "06f5199ec7e5bd36b84349e2ac22ad286356c613"}, "originalPosition": 217}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4Mzk0MTA0OQ==", "bodyText": "obvious test are useful for the future because they look obvious now that we know the implementation but if we go trough a refactoring the implementation could be completely different and break something that we expect to just work. So I always recommend to make black box test, indeed we should follow a TDD approach that would imply that.\nAnyway, I'm not completely sure that it will return 404 right now, maybe we can get a NPE o ClassCastException so a 500 see https://github.com/DSpace/DSpace/pull/2673/files#diff-59c10eaa99f8fbc2322484a9bacff5afR51 (again I'm just guessing but it is wrong to look to the communityservice to get the answer, we need to have test to proof it)", "url": "https://github.com/DSpace/DSpace/pull/2673#discussion_r383941049", "createdAt": "2020-02-25T15:12:39Z", "author": {"login": "abollini"}, "path": "dspace-server-webapp/src/test/java/org/dspace/app/rest/CommunityCollectionParentIT.java", "diffHunk": "@@ -0,0 +1,218 @@\n+/**\n+ * The contents of this file are subject to the license and copyright\n+ * detailed in the LICENSE and NOTICE files at the root of the source\n+ * tree and available online at\n+ *\n+ * http://www.dspace.org/license/\n+ */\n+package org.dspace.app.rest;\n+\n+import static org.hamcrest.CoreMatchers.is;\n+import static org.hamcrest.CoreMatchers.not;\n+import static org.springframework.test.web.servlet.request.MockMvcRequestBuilders.get;\n+import static org.springframework.test.web.servlet.result.MockMvcResultMatchers.jsonPath;\n+import static org.springframework.test.web.servlet.result.MockMvcResultMatchers.status;\n+\n+import java.sql.SQLException;\n+\n+import org.dspace.app.rest.builder.CollectionBuilder;\n+import org.dspace.app.rest.builder.CommunityBuilder;\n+import org.dspace.app.rest.builder.ItemBuilder;\n+import org.dspace.app.rest.matcher.CollectionMatcher;\n+import org.dspace.app.rest.matcher.CommunityMatcher;\n+import org.dspace.app.rest.test.AbstractControllerIntegrationTest;\n+import org.dspace.authorize.AuthorizeException;\n+import org.dspace.content.Collection;\n+import org.dspace.content.Community;\n+import org.dspace.content.Item;\n+import org.dspace.content.service.CollectionService;\n+import org.dspace.content.service.CommunityService;\n+import org.hamcrest.Matchers;\n+import org.junit.Before;\n+import org.junit.Test;\n+import org.springframework.beans.factory.annotation.Autowired;\n+\n+public class CommunityCollectionParentIT extends AbstractControllerIntegrationTest {\n+\n+    @Autowired\n+    private CollectionService collectionService;\n+\n+    @Autowired\n+    private CommunityService communityService;\n+\n+    Community communityA;\n+    Community communityB;\n+    Community communityAA;\n+    Community communityAB;\n+\n+    Collection col1;\n+    Collection col2;\n+    Collection col3;\n+\n+    Item itemX;\n+    Item itemY;\n+    Item itemZ;\n+\n+\n+    @Before\n+    public void setup() throws SQLException, AuthorizeException {\n+        //We turn off the authorization system in order to create the structure as defined below\n+        context.turnOffAuthorisationSystem();\n+        //** GIVEN **\n+        //1. A community-collection structure with one parent community with sub-community and one collection.\n+        communityA = CommunityBuilder.createCommunity(context)\n+                                     .withName(\"Parent CommunityA\")\n+                                     .build();\n+        communityB = CommunityBuilder.createCommunity(context)\n+                                     .withName(\"Parent CommunityB\")\n+                                     .build();\n+        communityAA = CommunityBuilder.createSubCommunity(context, communityA)\n+                                      .withName(\"Sub Community\")\n+                                      .build();\n+        communityAB = CommunityBuilder.createSubCommunity(context, communityA)\n+                                      .withName(\"Sub Community Two\")\n+                                      .build();\n+        col1 = CollectionBuilder.createCollection(context, communityAA).withName(\"Collection 1\").build();\n+        col2 = CollectionBuilder.createCollection(context, communityAA).withName(\"Collection 2\").build();\n+        col3 = CollectionBuilder.createCollection(context, communityAB).withName(\"Collection 3\").build();\n+        communityService.addCollection(context, communityAB, col2);\n+\n+\n+        itemX = ItemBuilder.createItem(context, col1)\n+                           .withTitle(\"Public item 1\")\n+                           .withIssueDate(\"2017-10-17\")\n+                           .withAuthor(\"Smith, Donald\").withAuthor(\"Doe, John\")\n+                           .withSubject(\"ExtraEntry\")\n+                           .build();\n+\n+        itemY = ItemBuilder.createItem(context, col1)\n+                           .withTitle(\"Public item 1\")\n+                           .withIssueDate(\"2017-10-17\")\n+                           .withAuthor(\"Smith, Donald\").withAuthor(\"Doe, John\")\n+                           .withSubject(\"ExtraEntry\")\n+                           .build();\n+        collectionService.addItem(context, col2, itemY);\n+        itemZ = ItemBuilder.createItem(context, col2)\n+                           .withTitle(\"Public item 1\")\n+                           .withIssueDate(\"2017-10-17\")\n+                           .withAuthor(\"Smith, Donald\").withAuthor(\"Doe, John\")\n+                           .withSubject(\"ExtraEntry\")\n+                           .build();\n+\n+        context.restoreAuthSystemState();\n+    }\n+\n+    @Test\n+    public void itemXOwningCollectionTest() throws Exception {\n+\n+        String token = getAuthToken(admin.getEmail(), password);\n+        getClient(token).perform(get(\"/api/core/items/\" + itemX.getID() + \"/owningCollection\"))\n+                        .andExpect(jsonPath(\"$\", is(CollectionMatcher.matchCollectionEntry(col1.getName(), col1.getID(),\n+                                                                                           col1.getHandle()))))\n+                        .andExpect(jsonPath(\"$\", Matchers\n+                            .not(is(CollectionMatcher\n+                                        .matchCollectionEntry(col2.getName(), col2.getID(), col2.getHandle())))));\n+\n+    }\n+\n+    @Test\n+    public void itemYOwningCollectionTest() throws Exception {\n+\n+        String token = getAuthToken(admin.getEmail(), password);\n+        getClient(token).perform(get(\"/api/core/items/\" + itemY.getID() + \"/owningCollection\"))\n+                        .andExpect(jsonPath(\"$\", is(CollectionMatcher.matchCollectionEntry(col1.getName(), col1.getID(),\n+                                                                                           col1.getHandle()))))\n+                        .andExpect(jsonPath(\"$\", Matchers\n+                            .not(is(CollectionMatcher\n+                                        .matchCollectionEntry(col2.getName(), col2.getID(), col2.getHandle())))));\n+    }\n+\n+    @Test\n+    public void itemZOwningCollectionTest() throws Exception {\n+\n+        String token = getAuthToken(admin.getEmail(), password);\n+        getClient(token).perform(get(\"/api/core/items/\" + itemZ.getID() + \"/owningCollection\"))\n+                        .andExpect(jsonPath(\"$\", is(CollectionMatcher.matchCollectionEntry(col2.getName(), col2.getID(),\n+                                                                                           col2.getHandle()))))\n+                        .andExpect(jsonPath(\"$\", Matchers\n+                            .not(is(CollectionMatcher\n+                                        .matchCollectionEntry(col1.getName(), col1.getID(), col1.getHandle())))));\n+\n+    }\n+\n+    @Test\n+    public void col1ParentCommunityTest() throws Exception {\n+\n+        String token = getAuthToken(admin.getEmail(), password);\n+        getClient(token).perform(get(\"/api/core/collections/\" + col1.getID() + \"/parentCommunity\"))\n+                        .andExpect(jsonPath(\"$\", is(CommunityMatcher\n+                                                        .matchCommunityEntry(communityAA.getName(), communityAA.getID(),\n+                                                                             communityAA.getHandle()))))\n+                        .andExpect(jsonPath(\"$\", not(is(CommunityMatcher.matchCommunityEntry(communityA.getName(),\n+                                                                                             communityA.getID(),\n+                                                                                             communityA.getHandle())))))\n+                        .andExpect(jsonPath(\"$\", not(is(CommunityMatcher.matchCommunityEntry(communityAB.getName(),\n+                                                                                             communityAB.getID(),\n+                                                                                             communityAB\n+                                                                                                 .getHandle())))));\n+\n+    }\n+\n+    @Test\n+    public void col2ParentCommunityTest() throws Exception {\n+\n+        String token = getAuthToken(admin.getEmail(), password);\n+        getClient(token)\n+            .perform(get(\"/api/core/collections/\" + col2.getID() + \"/parentCommunity\"))\n+            .andExpect(jsonPath(\"$\", is(CommunityMatcher.matchCommunityEntry(communityAA.getName(), communityAA.getID(),\n+                                                                             communityAA.getHandle()))))\n+            .andExpect(jsonPath(\"$\", not(is(CommunityMatcher\n+                                                .matchCommunityEntry(communityA.getName(), communityA.getID(),\n+                                                                     communityA.getHandle())))))\n+            .andExpect(jsonPath(\"$\", not(is(CommunityMatcher\n+                                                .matchCommunityEntry(communityAB.getName(), communityAB.getID(),\n+                                                                     communityAB.getHandle())))));\n+\n+    }\n+\n+    @Test\n+    public void col3ParentCommunityTest() throws Exception {\n+\n+        String token = getAuthToken(admin.getEmail(), password);\n+        getClient(token)\n+            .perform(get(\"/api/core/collections/\" + col3.getID() + \"/parentCommunity\"))\n+            .andExpect(jsonPath(\"$\", is(CommunityMatcher.matchCommunityEntry(communityAB.getName(), communityAB.getID(),\n+                                                                             communityAB.getHandle()))))\n+            .andExpect(jsonPath(\"$\", not(is(CommunityMatcher\n+                                                .matchCommunityEntry(communityA.getName(), communityA.getID(),\n+                                                                     communityA.getHandle())))))\n+            .andExpect(jsonPath(\"$\", not(is(CommunityMatcher\n+                                                .matchCommunityEntry(communityAA.getName(), communityAA.getID(),\n+                                                                     communityAA.getHandle())))));\n+\n+    }\n+\n+    @Test\n+    public void comAAParentCommunityTest() throws Exception {\n+\n+        String token = getAuthToken(admin.getEmail(), password);\n+        getClient(token)\n+            .perform(get(\"/api/core/communities/\" + communityAA.getID() + \"/parentCommunity\"))\n+            .andExpect(jsonPath(\"$\", Matchers\n+                .is(CommunityMatcher.matchCommunityEntry(communityA.getID(), communityA.getHandle()))))\n+            .andExpect(jsonPath(\"$\", Matchers\n+                .not(Matchers.is(CommunityMatcher.matchCommunityEntry(communityB.getID(), communityB.getHandle())))));\n+\n+    }\n+\n+    @Test\n+    public void comAParentCommunityTest() throws Exception {\n+\n+        String token = getAuthToken(admin.getEmail(), password);\n+        getClient(token).perform(get(\"/api/core/communities/\" + communityA.getID() + \"/parentCommunity\"))\n+                        .andExpect(status().isNoContent());\n+\n+\n+    }\n+", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MzkyMzU1Nw=="}, "originalCommit": {"oid": "06f5199ec7e5bd36b84349e2ac22ad286356c613"}, "originalPosition": 217}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NTIxMTQ2Ng==", "bodyText": "it has been addressed", "url": "https://github.com/DSpace/DSpace/pull/2673#discussion_r385211466", "createdAt": "2020-02-27T16:12:56Z", "author": {"login": "abollini"}, "path": "dspace-server-webapp/src/test/java/org/dspace/app/rest/CommunityCollectionParentIT.java", "diffHunk": "@@ -0,0 +1,218 @@\n+/**\n+ * The contents of this file are subject to the license and copyright\n+ * detailed in the LICENSE and NOTICE files at the root of the source\n+ * tree and available online at\n+ *\n+ * http://www.dspace.org/license/\n+ */\n+package org.dspace.app.rest;\n+\n+import static org.hamcrest.CoreMatchers.is;\n+import static org.hamcrest.CoreMatchers.not;\n+import static org.springframework.test.web.servlet.request.MockMvcRequestBuilders.get;\n+import static org.springframework.test.web.servlet.result.MockMvcResultMatchers.jsonPath;\n+import static org.springframework.test.web.servlet.result.MockMvcResultMatchers.status;\n+\n+import java.sql.SQLException;\n+\n+import org.dspace.app.rest.builder.CollectionBuilder;\n+import org.dspace.app.rest.builder.CommunityBuilder;\n+import org.dspace.app.rest.builder.ItemBuilder;\n+import org.dspace.app.rest.matcher.CollectionMatcher;\n+import org.dspace.app.rest.matcher.CommunityMatcher;\n+import org.dspace.app.rest.test.AbstractControllerIntegrationTest;\n+import org.dspace.authorize.AuthorizeException;\n+import org.dspace.content.Collection;\n+import org.dspace.content.Community;\n+import org.dspace.content.Item;\n+import org.dspace.content.service.CollectionService;\n+import org.dspace.content.service.CommunityService;\n+import org.hamcrest.Matchers;\n+import org.junit.Before;\n+import org.junit.Test;\n+import org.springframework.beans.factory.annotation.Autowired;\n+\n+public class CommunityCollectionParentIT extends AbstractControllerIntegrationTest {\n+\n+    @Autowired\n+    private CollectionService collectionService;\n+\n+    @Autowired\n+    private CommunityService communityService;\n+\n+    Community communityA;\n+    Community communityB;\n+    Community communityAA;\n+    Community communityAB;\n+\n+    Collection col1;\n+    Collection col2;\n+    Collection col3;\n+\n+    Item itemX;\n+    Item itemY;\n+    Item itemZ;\n+\n+\n+    @Before\n+    public void setup() throws SQLException, AuthorizeException {\n+        //We turn off the authorization system in order to create the structure as defined below\n+        context.turnOffAuthorisationSystem();\n+        //** GIVEN **\n+        //1. A community-collection structure with one parent community with sub-community and one collection.\n+        communityA = CommunityBuilder.createCommunity(context)\n+                                     .withName(\"Parent CommunityA\")\n+                                     .build();\n+        communityB = CommunityBuilder.createCommunity(context)\n+                                     .withName(\"Parent CommunityB\")\n+                                     .build();\n+        communityAA = CommunityBuilder.createSubCommunity(context, communityA)\n+                                      .withName(\"Sub Community\")\n+                                      .build();\n+        communityAB = CommunityBuilder.createSubCommunity(context, communityA)\n+                                      .withName(\"Sub Community Two\")\n+                                      .build();\n+        col1 = CollectionBuilder.createCollection(context, communityAA).withName(\"Collection 1\").build();\n+        col2 = CollectionBuilder.createCollection(context, communityAA).withName(\"Collection 2\").build();\n+        col3 = CollectionBuilder.createCollection(context, communityAB).withName(\"Collection 3\").build();\n+        communityService.addCollection(context, communityAB, col2);\n+\n+\n+        itemX = ItemBuilder.createItem(context, col1)\n+                           .withTitle(\"Public item 1\")\n+                           .withIssueDate(\"2017-10-17\")\n+                           .withAuthor(\"Smith, Donald\").withAuthor(\"Doe, John\")\n+                           .withSubject(\"ExtraEntry\")\n+                           .build();\n+\n+        itemY = ItemBuilder.createItem(context, col1)\n+                           .withTitle(\"Public item 1\")\n+                           .withIssueDate(\"2017-10-17\")\n+                           .withAuthor(\"Smith, Donald\").withAuthor(\"Doe, John\")\n+                           .withSubject(\"ExtraEntry\")\n+                           .build();\n+        collectionService.addItem(context, col2, itemY);\n+        itemZ = ItemBuilder.createItem(context, col2)\n+                           .withTitle(\"Public item 1\")\n+                           .withIssueDate(\"2017-10-17\")\n+                           .withAuthor(\"Smith, Donald\").withAuthor(\"Doe, John\")\n+                           .withSubject(\"ExtraEntry\")\n+                           .build();\n+\n+        context.restoreAuthSystemState();\n+    }\n+\n+    @Test\n+    public void itemXOwningCollectionTest() throws Exception {\n+\n+        String token = getAuthToken(admin.getEmail(), password);\n+        getClient(token).perform(get(\"/api/core/items/\" + itemX.getID() + \"/owningCollection\"))\n+                        .andExpect(jsonPath(\"$\", is(CollectionMatcher.matchCollectionEntry(col1.getName(), col1.getID(),\n+                                                                                           col1.getHandle()))))\n+                        .andExpect(jsonPath(\"$\", Matchers\n+                            .not(is(CollectionMatcher\n+                                        .matchCollectionEntry(col2.getName(), col2.getID(), col2.getHandle())))));\n+\n+    }\n+\n+    @Test\n+    public void itemYOwningCollectionTest() throws Exception {\n+\n+        String token = getAuthToken(admin.getEmail(), password);\n+        getClient(token).perform(get(\"/api/core/items/\" + itemY.getID() + \"/owningCollection\"))\n+                        .andExpect(jsonPath(\"$\", is(CollectionMatcher.matchCollectionEntry(col1.getName(), col1.getID(),\n+                                                                                           col1.getHandle()))))\n+                        .andExpect(jsonPath(\"$\", Matchers\n+                            .not(is(CollectionMatcher\n+                                        .matchCollectionEntry(col2.getName(), col2.getID(), col2.getHandle())))));\n+    }\n+\n+    @Test\n+    public void itemZOwningCollectionTest() throws Exception {\n+\n+        String token = getAuthToken(admin.getEmail(), password);\n+        getClient(token).perform(get(\"/api/core/items/\" + itemZ.getID() + \"/owningCollection\"))\n+                        .andExpect(jsonPath(\"$\", is(CollectionMatcher.matchCollectionEntry(col2.getName(), col2.getID(),\n+                                                                                           col2.getHandle()))))\n+                        .andExpect(jsonPath(\"$\", Matchers\n+                            .not(is(CollectionMatcher\n+                                        .matchCollectionEntry(col1.getName(), col1.getID(), col1.getHandle())))));\n+\n+    }\n+\n+    @Test\n+    public void col1ParentCommunityTest() throws Exception {\n+\n+        String token = getAuthToken(admin.getEmail(), password);\n+        getClient(token).perform(get(\"/api/core/collections/\" + col1.getID() + \"/parentCommunity\"))\n+                        .andExpect(jsonPath(\"$\", is(CommunityMatcher\n+                                                        .matchCommunityEntry(communityAA.getName(), communityAA.getID(),\n+                                                                             communityAA.getHandle()))))\n+                        .andExpect(jsonPath(\"$\", not(is(CommunityMatcher.matchCommunityEntry(communityA.getName(),\n+                                                                                             communityA.getID(),\n+                                                                                             communityA.getHandle())))))\n+                        .andExpect(jsonPath(\"$\", not(is(CommunityMatcher.matchCommunityEntry(communityAB.getName(),\n+                                                                                             communityAB.getID(),\n+                                                                                             communityAB\n+                                                                                                 .getHandle())))));\n+\n+    }\n+\n+    @Test\n+    public void col2ParentCommunityTest() throws Exception {\n+\n+        String token = getAuthToken(admin.getEmail(), password);\n+        getClient(token)\n+            .perform(get(\"/api/core/collections/\" + col2.getID() + \"/parentCommunity\"))\n+            .andExpect(jsonPath(\"$\", is(CommunityMatcher.matchCommunityEntry(communityAA.getName(), communityAA.getID(),\n+                                                                             communityAA.getHandle()))))\n+            .andExpect(jsonPath(\"$\", not(is(CommunityMatcher\n+                                                .matchCommunityEntry(communityA.getName(), communityA.getID(),\n+                                                                     communityA.getHandle())))))\n+            .andExpect(jsonPath(\"$\", not(is(CommunityMatcher\n+                                                .matchCommunityEntry(communityAB.getName(), communityAB.getID(),\n+                                                                     communityAB.getHandle())))));\n+\n+    }\n+\n+    @Test\n+    public void col3ParentCommunityTest() throws Exception {\n+\n+        String token = getAuthToken(admin.getEmail(), password);\n+        getClient(token)\n+            .perform(get(\"/api/core/collections/\" + col3.getID() + \"/parentCommunity\"))\n+            .andExpect(jsonPath(\"$\", is(CommunityMatcher.matchCommunityEntry(communityAB.getName(), communityAB.getID(),\n+                                                                             communityAB.getHandle()))))\n+            .andExpect(jsonPath(\"$\", not(is(CommunityMatcher\n+                                                .matchCommunityEntry(communityA.getName(), communityA.getID(),\n+                                                                     communityA.getHandle())))))\n+            .andExpect(jsonPath(\"$\", not(is(CommunityMatcher\n+                                                .matchCommunityEntry(communityAA.getName(), communityAA.getID(),\n+                                                                     communityAA.getHandle())))));\n+\n+    }\n+\n+    @Test\n+    public void comAAParentCommunityTest() throws Exception {\n+\n+        String token = getAuthToken(admin.getEmail(), password);\n+        getClient(token)\n+            .perform(get(\"/api/core/communities/\" + communityAA.getID() + \"/parentCommunity\"))\n+            .andExpect(jsonPath(\"$\", Matchers\n+                .is(CommunityMatcher.matchCommunityEntry(communityA.getID(), communityA.getHandle()))))\n+            .andExpect(jsonPath(\"$\", Matchers\n+                .not(Matchers.is(CommunityMatcher.matchCommunityEntry(communityB.getID(), communityB.getHandle())))));\n+\n+    }\n+\n+    @Test\n+    public void comAParentCommunityTest() throws Exception {\n+\n+        String token = getAuthToken(admin.getEmail(), password);\n+        getClient(token).perform(get(\"/api/core/communities/\" + communityA.getID() + \"/parentCommunity\"))\n+                        .andExpect(status().isNoContent());\n+\n+\n+    }\n+", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MzkyMzU1Nw=="}, "originalCommit": {"oid": "06f5199ec7e5bd36b84349e2ac22ad286356c613"}, "originalPosition": 217}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjM3NzQ0MjExOnYy", "diffSide": "RIGHT", "path": "dspace-server-webapp/src/test/java/org/dspace/app/rest/matcher/CollectionMatcher.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yNVQxNDo0OTozM1rOFuI8-A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yN1QxNjo1OToxMFrOFvZTMA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MzkyNTQ5Ng==", "bodyText": "please don't reduce the scope of the matcher as this would have the effect to reduce the usefulness of the existing tests. Instead, if a new match method that exclude embedded is required overload the method", "url": "https://github.com/DSpace/DSpace/pull/2673#discussion_r383925496", "createdAt": "2020-02-25T14:49:33Z", "author": {"login": "abollini"}, "path": "dspace-server-webapp/src/test/java/org/dspace/app/rest/matcher/CollectionMatcher.java", "diffHunk": "@@ -31,8 +31,7 @@ private CollectionMatcher() {\n     public static Matcher<? super Object> matchCollectionEntry(String name, UUID uuid, String handle, Bitstream logo) {\n         return allOf(\n                 matchProperties(name, uuid, handle),\n-                matchLinks(uuid),\n-                matchLogo(logo)\n+                matchLinks(uuid)", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "06f5199ec7e5bd36b84349e2ac22ad286356c613"}, "originalPosition": 6}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NTI0MTkwNA==", "bodyText": "@abollini : This was resolved in a different manner.  A new matchCollectionEntryFullProjection() method was added, and all existing tests that depend on embeds (full projection) were updated to use that new method.", "url": "https://github.com/DSpace/DSpace/pull/2673#discussion_r385241904", "createdAt": "2020-02-27T16:59:10Z", "author": {"login": "tdonohue"}, "path": "dspace-server-webapp/src/test/java/org/dspace/app/rest/matcher/CollectionMatcher.java", "diffHunk": "@@ -31,8 +31,7 @@ private CollectionMatcher() {\n     public static Matcher<? super Object> matchCollectionEntry(String name, UUID uuid, String handle, Bitstream logo) {\n         return allOf(\n                 matchProperties(name, uuid, handle),\n-                matchLinks(uuid),\n-                matchLogo(logo)\n+                matchLinks(uuid)", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MzkyNTQ5Ng=="}, "originalCommit": {"oid": "06f5199ec7e5bd36b84349e2ac22ad286356c613"}, "originalPosition": 6}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjM3NzQ0Mzk2OnYy", "diffSide": "RIGHT", "path": "dspace-server-webapp/src/test/java/org/dspace/app/rest/matcher/CommunityMatcher.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yNVQxNDo0OTo1OFrOFuI-Ew==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yN1QxNjo1OTozMlrOFvZUMg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MzkyNTc3OQ==", "bodyText": "again better overload the method than reduce the checks", "url": "https://github.com/DSpace/DSpace/pull/2673#discussion_r383925779", "createdAt": "2020-02-25T14:49:58Z", "author": {"login": "abollini"}, "path": "dspace-server-webapp/src/test/java/org/dspace/app/rest/matcher/CommunityMatcher.java", "diffHunk": "@@ -31,8 +31,6 @@ private CommunityMatcher() { }\n                 hasJsonPath(\"$.uuid\", is(uuid.toString())),\n                 hasJsonPath(\"$.handle\", is(handle)),\n                 hasJsonPath(\"$.type\", is(\"community\")),", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "06f5199ec7e5bd36b84349e2ac22ad286356c613"}, "originalPosition": 3}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NTI0MjE2Mg==", "bodyText": "@abollini : This was resolved in a different manner.  A new matchCommunityEntryFullProjection() method was added, and all existing tests that depend on embeds (full projection) were updated to use that new method.", "url": "https://github.com/DSpace/DSpace/pull/2673#discussion_r385242162", "createdAt": "2020-02-27T16:59:32Z", "author": {"login": "tdonohue"}, "path": "dspace-server-webapp/src/test/java/org/dspace/app/rest/matcher/CommunityMatcher.java", "diffHunk": "@@ -31,8 +31,6 @@ private CommunityMatcher() { }\n                 hasJsonPath(\"$.uuid\", is(uuid.toString())),\n                 hasJsonPath(\"$.handle\", is(handle)),\n                 hasJsonPath(\"$.type\", is(\"community\")),", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MzkyNTc3OQ=="}, "originalCommit": {"oid": "06f5199ec7e5bd36b84349e2ac22ad286356c613"}, "originalPosition": 3}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjM3NzQ0NDY1OnYy", "diffSide": "LEFT", "path": "dspace-server-webapp/src/test/java/org/dspace/app/rest/matcher/CommunityMatcher.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yNVQxNDo1MDowOVrOFuI-iw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yN1QxNzowMDoxNFrOFvZV2A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MzkyNTg5OQ==", "bodyText": "again better overload the method than reduce the checks", "url": "https://github.com/DSpace/DSpace/pull/2673#discussion_r383925899", "createdAt": "2020-02-25T14:50:09Z", "author": {"login": "abollini"}, "path": "dspace-server-webapp/src/test/java/org/dspace/app/rest/matcher/CommunityMatcher.java", "diffHunk": "@@ -55,8 +53,6 @@ private CommunityMatcher() { }\n     public static Matcher<? super Object> matchCommunityEntry(String name, UUID uuid, String handle) {\n         return allOf(\n             matchProperties(name, uuid, handle),\n-            hasJsonPath(\"$._embedded.collections\", Matchers.not(Matchers.empty())),", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "06f5199ec7e5bd36b84349e2ac22ad286356c613"}, "originalPosition": 13}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NTI0MjU4NA==", "bodyText": "@abollini : This was resolved in a different manner. A new matchCommunityEntryFullProjection() method was added, and all existing tests that depend on embeds (full projection) were updated to use that new method.", "url": "https://github.com/DSpace/DSpace/pull/2673#discussion_r385242584", "createdAt": "2020-02-27T17:00:14Z", "author": {"login": "tdonohue"}, "path": "dspace-server-webapp/src/test/java/org/dspace/app/rest/matcher/CommunityMatcher.java", "diffHunk": "@@ -55,8 +53,6 @@ private CommunityMatcher() { }\n     public static Matcher<? super Object> matchCommunityEntry(String name, UUID uuid, String handle) {\n         return allOf(\n             matchProperties(name, uuid, handle),\n-            hasJsonPath(\"$._embedded.collections\", Matchers.not(Matchers.empty())),", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MzkyNTg5OQ=="}, "originalCommit": {"oid": "06f5199ec7e5bd36b84349e2ac22ad286356c613"}, "originalPosition": 13}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjM4NTY3NDQ5OnYy", "diffSide": "RIGHT", "path": "dspace-server-webapp/src/test/java/org/dspace/app/rest/CommunityCollectionItemParentIT.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yN1QxNjoxMTo1NFrOFvXZkQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yN1QxNzozODo0NFrOFvavOw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NTIxMDc2OQ==", "bodyText": "we need a bug issue for that", "url": "https://github.com/DSpace/DSpace/pull/2673#discussion_r385210769", "createdAt": "2020-02-27T16:11:54Z", "author": {"login": "abollini"}, "path": "dspace-server-webapp/src/test/java/org/dspace/app/rest/CommunityCollectionItemParentIT.java", "diffHunk": "@@ -0,0 +1,374 @@\n+/**\n+ * The contents of this file are subject to the license and copyright\n+ * detailed in the LICENSE and NOTICE files at the root of the source\n+ * tree and available online at\n+ *\n+ * http://www.dspace.org/license/\n+ */\n+package org.dspace.app.rest;\n+\n+import static org.hamcrest.CoreMatchers.is;\n+import static org.hamcrest.CoreMatchers.not;\n+import static org.springframework.test.web.servlet.request.MockMvcRequestBuilders.get;\n+import static org.springframework.test.web.servlet.result.MockMvcResultMatchers.jsonPath;\n+import static org.springframework.test.web.servlet.result.MockMvcResultMatchers.status;\n+\n+import java.sql.SQLException;\n+import java.util.UUID;\n+\n+import org.dspace.app.rest.builder.CollectionBuilder;\n+import org.dspace.app.rest.builder.CommunityBuilder;\n+import org.dspace.app.rest.builder.ItemBuilder;\n+import org.dspace.app.rest.matcher.CollectionMatcher;\n+import org.dspace.app.rest.matcher.CommunityMatcher;\n+import org.dspace.app.rest.test.AbstractControllerIntegrationTest;\n+import org.dspace.authorize.AuthorizeException;\n+import org.dspace.authorize.service.AuthorizeService;\n+import org.dspace.content.Collection;\n+import org.dspace.content.Community;\n+import org.dspace.content.Item;\n+import org.dspace.content.service.CollectionService;\n+import org.dspace.content.service.CommunityService;\n+import org.hamcrest.Matchers;\n+import org.junit.Before;\n+import org.junit.Ignore;\n+import org.junit.Test;\n+import org.springframework.beans.factory.annotation.Autowired;\n+\n+public class CommunityCollectionItemParentIT extends AbstractControllerIntegrationTest {\n+\n+    @Autowired\n+    private CollectionService collectionService;\n+\n+    @Autowired\n+    private CommunityService communityService;\n+\n+    @Autowired\n+    private AuthorizeService authorizeService;\n+\n+    Community communityA;\n+    Community communityB;\n+    Community communityAA;\n+    Community communityAB;\n+\n+    Collection colAA1;\n+    Collection colAA2;\n+    Collection colAB1;\n+\n+    Item itemAA1;\n+    Item itemAA1MappedInAA2;\n+    Item itemAA2;\n+\n+\n+    @Before\n+    public void setup() throws SQLException, AuthorizeException {\n+        //We turn off the authorization system in order to create the structure as defined below\n+        context.turnOffAuthorisationSystem();\n+        //** GIVEN **\n+        //1. A community-collection structure with one parent community with sub-community and one collection.\n+        communityA = CommunityBuilder.createCommunity(context)\n+                                     .withName(\"Parent CommunityA\")\n+                                     .build();\n+        communityB = CommunityBuilder.createCommunity(context)\n+                                     .withName(\"Parent CommunityB\")\n+                                     .build();\n+        communityAA = CommunityBuilder.createSubCommunity(context, communityA)\n+                                      .withName(\"Sub Community\")\n+                                      .build();\n+        communityAB = CommunityBuilder.createSubCommunity(context, communityA)\n+                                      .withName(\"Sub Community Two\")\n+                                      .build();\n+        colAA1 = CollectionBuilder.createCollection(context, communityAA).withName(\"Collection 1\").build();\n+        colAA2 = CollectionBuilder.createCollection(context, communityAA).withName(\"Collection 2\").build();\n+        colAB1 = CollectionBuilder.createCollection(context, communityAB).withName(\"Collection 3\").build();\n+        communityService.addCollection(context, communityAB, colAA2);\n+\n+\n+        itemAA1 = ItemBuilder.createItem(context, colAA1)\n+                             .withTitle(\"Public item 1\")\n+                             .withIssueDate(\"2017-10-17\")\n+                             .withAuthor(\"Smith, Donald\").withAuthor(\"Doe, John\")\n+                             .withSubject(\"ExtraEntry\")\n+                             .build();\n+\n+        itemAA1MappedInAA2 = ItemBuilder.createItem(context, colAA1)\n+                                        .withTitle(\"Public item 1\")\n+                                        .withIssueDate(\"2017-10-17\")\n+                                        .withAuthor(\"Smith, Donald\").withAuthor(\"Doe, John\")\n+                                        .withSubject(\"ExtraEntry\")\n+                                        .build();\n+        collectionService.addItem(context, colAA2, itemAA1MappedInAA2);\n+        itemAA2 = ItemBuilder.createItem(context, colAA2)\n+                             .withTitle(\"Public item 1\")\n+                             .withIssueDate(\"2017-10-17\")\n+                             .withAuthor(\"Smith, Donald\").withAuthor(\"Doe, John\")\n+                             .withSubject(\"ExtraEntry\")\n+                             .build();\n+\n+        context.restoreAuthSystemState();\n+    }\n+\n+    @Test\n+    public void itemXOwningCollectionTest() throws Exception {\n+\n+        String token = getAuthToken(admin.getEmail(), password);\n+        getClient(token).perform(get(\"/api/core/items/\" + itemAA1.getID() + \"/owningCollection\"))\n+                        .andExpect(jsonPath(\"$\", is(CollectionMatcher.matchCollectionEntry(colAA1.getName(),\n+                                                                                           colAA1.getID(),\n+                                                                                           colAA1.getHandle()))))\n+                        .andExpect(jsonPath(\"$\", Matchers\n+                            .not(is(CollectionMatcher\n+                                        .matchCollectionEntry(colAA2.getName(), colAA2.getID(), colAA2.getHandle())))));\n+\n+    }\n+\n+    @Test\n+    public void itemYOwningCollectionTest() throws Exception {\n+\n+        String token = getAuthToken(admin.getEmail(), password);\n+        getClient(token).perform(get(\"/api/core/items/\" + itemAA1MappedInAA2.getID() + \"/owningCollection\"))\n+                        .andExpect(jsonPath(\"$\", is(CollectionMatcher.matchCollectionEntry(colAA1.getName(),\n+                                                                                           colAA1.getID(),\n+                                                                                           colAA1.getHandle()))))\n+                        .andExpect(jsonPath(\"$\", Matchers\n+                            .not(is(CollectionMatcher\n+                                        .matchCollectionEntry(colAA2.getName(), colAA2.getID(), colAA2.getHandle())))));\n+    }\n+\n+    @Test\n+    public void itemZOwningCollectionTest() throws Exception {\n+\n+        String token = getAuthToken(admin.getEmail(), password);\n+        getClient(token).perform(get(\"/api/core/items/\" + itemAA2.getID() + \"/owningCollection\"))\n+                        .andExpect(jsonPath(\"$\", is(CollectionMatcher.matchCollectionEntry(colAA2.getName(),\n+                                                                                           colAA2.getID(),\n+                                                                                           colAA2.getHandle()))))\n+                        .andExpect(jsonPath(\"$\", Matchers\n+                            .not(is(CollectionMatcher\n+                                        .matchCollectionEntry(colAA1.getName(), colAA1.getID(), colAA1.getHandle())))));\n+\n+    }\n+\n+    @Test\n+    public void col1ParentCommunityTest() throws Exception {\n+\n+        String token = getAuthToken(admin.getEmail(), password);\n+        getClient(token).perform(get(\"/api/core/collections/\" + colAA1.getID() + \"/parentCommunity\"))\n+                        .andExpect(jsonPath(\"$\", is(CommunityMatcher\n+                                                        .matchCommunityEntry(communityAA.getName(), communityAA.getID(),\n+                                                                             communityAA.getHandle()))))\n+                        .andExpect(jsonPath(\"$\", not(is(CommunityMatcher.matchCommunityEntry(communityA.getName(),\n+                                                                                             communityA.getID(),\n+                                                                                             communityA.getHandle())))))\n+                        .andExpect(jsonPath(\"$\", not(is(CommunityMatcher.matchCommunityEntry(communityAB.getName(),\n+                                                                                             communityAB.getID(),\n+                                                                                             communityAB\n+                                                                                                 .getHandle())))));\n+\n+    }\n+\n+    @Test\n+    public void comAAParentCommunityTest() throws Exception {\n+\n+        String token = getAuthToken(admin.getEmail(), password);\n+        getClient(token)\n+            .perform(get(\"/api/core/communities/\" + communityAA.getID() + \"/parentCommunity\"))\n+            .andExpect(jsonPath(\"$\", Matchers\n+                .is(CommunityMatcher.matchCommunityEntry(communityA.getID(), communityA.getHandle()))))\n+            .andExpect(jsonPath(\"$\", Matchers\n+                .not(Matchers.is(CommunityMatcher.matchCommunityEntry(communityB.getID(), communityB.getHandle())))));\n+\n+    }\n+\n+    @Test\n+    public void comAParentCommunityTest() throws Exception {\n+\n+        String token = getAuthToken(admin.getEmail(), password);\n+        getClient(token).perform(get(\"/api/core/communities/\" + communityA.getID() + \"/parentCommunity\"))\n+                        .andExpect(status().isNoContent());\n+\n+\n+    }\n+\n+    @Test\n+    public void parentCommunityWrongUUIDTest() throws Exception {\n+\n+        String token = getAuthToken(admin.getEmail(), password);\n+        getClient(token).perform(get(\"/api/core/communities/\" + UUID.randomUUID() + \"/parentCommunity\"))\n+                        .andExpect(status().isNotFound());\n+\n+\n+    }\n+\n+    @Test\n+    public void parentCommunityPrivateCommunityUnAuthorizedTest() throws Exception {\n+\n+        context.turnOffAuthorisationSystem();\n+        authorizeService.removeAllPolicies(context, communityAA);\n+        context.restoreAuthSystemState();\n+        getClient().perform(get(\"/api/core/communities/\" + communityAA.getID() + \"/parentCommunity\"))\n+            .andExpect(status().isUnauthorized());\n+\n+    }\n+\n+    //Enable this test when this security level has been supported\n+    @Ignore\n+    @Test\n+    public void parentCommunityPrivateParentCommunityUnAuthorizedTest() throws Exception {\n+\n+        context.turnOffAuthorisationSystem();\n+        authorizeService.removeAllPolicies(context, communityA);\n+        context.restoreAuthSystemState();\n+        getClient().perform(get(\"/api/core/communities/\" + communityAA.getID() + \"/parentCommunity\"))\n+                   .andExpect(status().isUnauthorized());\n+\n+    }\n+\n+    @Test\n+    public void parentCommunityPrivateCommunityForbiddenTest() throws Exception {\n+\n+        context.turnOffAuthorisationSystem();\n+        authorizeService.removeAllPolicies(context, communityAA);\n+        context.restoreAuthSystemState();\n+        String token = getAuthToken(eperson.getEmail(), password);\n+        getClient(token).perform(get(\"/api/core/communities/\" + communityAA.getID() + \"/parentCommunity\"))\n+                   .andExpect(status().isForbidden());\n+\n+    }\n+\n+    //Enable this test when this security level has been supported\n+    @Ignore\n+    @Test\n+    public void parentCommunityPrivateParentCommunityForbiddenTest() throws Exception {\n+\n+        context.turnOffAuthorisationSystem();\n+        authorizeService.removeAllPolicies(context, communityA);\n+        context.restoreAuthSystemState();\n+        String token = getAuthToken(eperson.getEmail(), password);\n+        getClient(token).perform(get(\"/api/core/communities/\" + communityAA.getID() + \"/parentCommunity\"))\n+                        .andExpect(status().isForbidden());\n+\n+    }\n+\n+    @Test\n+    public void parentCommunityForCollectionWrongUUIDTest() throws Exception {\n+\n+        String token = getAuthToken(admin.getEmail(), password);\n+        getClient(token).perform(get(\"/api/core/collections/\" + UUID.randomUUID() + \"/parentCommunity\"))\n+                        .andExpect(status().isNotFound());\n+\n+\n+    }\n+\n+    @Test\n+    public void parentCommunityForCollectionPrivateCollectionUnAuthorizedTest() throws Exception {\n+\n+        context.turnOffAuthorisationSystem();\n+        authorizeService.removeAllPolicies(context, colAA1);\n+        context.restoreAuthSystemState();\n+        getClient().perform(get(\"/api/core/collections/\" + colAA1.getID() + \"/parentCommunity\"))\n+                   .andExpect(status().isUnauthorized());\n+\n+    }\n+\n+    //Enable this test when this security level has been supported", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "abf82a3f465464a7b52a9dc107406351709464c5"}, "originalPosition": 274}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NTI2NTQ2Nw==", "bodyText": "https://jira.lyrasis.org/browse/DS-4444", "url": "https://github.com/DSpace/DSpace/pull/2673#discussion_r385265467", "createdAt": "2020-02-27T17:38:44Z", "author": {"login": "benbosman"}, "path": "dspace-server-webapp/src/test/java/org/dspace/app/rest/CommunityCollectionItemParentIT.java", "diffHunk": "@@ -0,0 +1,374 @@\n+/**\n+ * The contents of this file are subject to the license and copyright\n+ * detailed in the LICENSE and NOTICE files at the root of the source\n+ * tree and available online at\n+ *\n+ * http://www.dspace.org/license/\n+ */\n+package org.dspace.app.rest;\n+\n+import static org.hamcrest.CoreMatchers.is;\n+import static org.hamcrest.CoreMatchers.not;\n+import static org.springframework.test.web.servlet.request.MockMvcRequestBuilders.get;\n+import static org.springframework.test.web.servlet.result.MockMvcResultMatchers.jsonPath;\n+import static org.springframework.test.web.servlet.result.MockMvcResultMatchers.status;\n+\n+import java.sql.SQLException;\n+import java.util.UUID;\n+\n+import org.dspace.app.rest.builder.CollectionBuilder;\n+import org.dspace.app.rest.builder.CommunityBuilder;\n+import org.dspace.app.rest.builder.ItemBuilder;\n+import org.dspace.app.rest.matcher.CollectionMatcher;\n+import org.dspace.app.rest.matcher.CommunityMatcher;\n+import org.dspace.app.rest.test.AbstractControllerIntegrationTest;\n+import org.dspace.authorize.AuthorizeException;\n+import org.dspace.authorize.service.AuthorizeService;\n+import org.dspace.content.Collection;\n+import org.dspace.content.Community;\n+import org.dspace.content.Item;\n+import org.dspace.content.service.CollectionService;\n+import org.dspace.content.service.CommunityService;\n+import org.hamcrest.Matchers;\n+import org.junit.Before;\n+import org.junit.Ignore;\n+import org.junit.Test;\n+import org.springframework.beans.factory.annotation.Autowired;\n+\n+public class CommunityCollectionItemParentIT extends AbstractControllerIntegrationTest {\n+\n+    @Autowired\n+    private CollectionService collectionService;\n+\n+    @Autowired\n+    private CommunityService communityService;\n+\n+    @Autowired\n+    private AuthorizeService authorizeService;\n+\n+    Community communityA;\n+    Community communityB;\n+    Community communityAA;\n+    Community communityAB;\n+\n+    Collection colAA1;\n+    Collection colAA2;\n+    Collection colAB1;\n+\n+    Item itemAA1;\n+    Item itemAA1MappedInAA2;\n+    Item itemAA2;\n+\n+\n+    @Before\n+    public void setup() throws SQLException, AuthorizeException {\n+        //We turn off the authorization system in order to create the structure as defined below\n+        context.turnOffAuthorisationSystem();\n+        //** GIVEN **\n+        //1. A community-collection structure with one parent community with sub-community and one collection.\n+        communityA = CommunityBuilder.createCommunity(context)\n+                                     .withName(\"Parent CommunityA\")\n+                                     .build();\n+        communityB = CommunityBuilder.createCommunity(context)\n+                                     .withName(\"Parent CommunityB\")\n+                                     .build();\n+        communityAA = CommunityBuilder.createSubCommunity(context, communityA)\n+                                      .withName(\"Sub Community\")\n+                                      .build();\n+        communityAB = CommunityBuilder.createSubCommunity(context, communityA)\n+                                      .withName(\"Sub Community Two\")\n+                                      .build();\n+        colAA1 = CollectionBuilder.createCollection(context, communityAA).withName(\"Collection 1\").build();\n+        colAA2 = CollectionBuilder.createCollection(context, communityAA).withName(\"Collection 2\").build();\n+        colAB1 = CollectionBuilder.createCollection(context, communityAB).withName(\"Collection 3\").build();\n+        communityService.addCollection(context, communityAB, colAA2);\n+\n+\n+        itemAA1 = ItemBuilder.createItem(context, colAA1)\n+                             .withTitle(\"Public item 1\")\n+                             .withIssueDate(\"2017-10-17\")\n+                             .withAuthor(\"Smith, Donald\").withAuthor(\"Doe, John\")\n+                             .withSubject(\"ExtraEntry\")\n+                             .build();\n+\n+        itemAA1MappedInAA2 = ItemBuilder.createItem(context, colAA1)\n+                                        .withTitle(\"Public item 1\")\n+                                        .withIssueDate(\"2017-10-17\")\n+                                        .withAuthor(\"Smith, Donald\").withAuthor(\"Doe, John\")\n+                                        .withSubject(\"ExtraEntry\")\n+                                        .build();\n+        collectionService.addItem(context, colAA2, itemAA1MappedInAA2);\n+        itemAA2 = ItemBuilder.createItem(context, colAA2)\n+                             .withTitle(\"Public item 1\")\n+                             .withIssueDate(\"2017-10-17\")\n+                             .withAuthor(\"Smith, Donald\").withAuthor(\"Doe, John\")\n+                             .withSubject(\"ExtraEntry\")\n+                             .build();\n+\n+        context.restoreAuthSystemState();\n+    }\n+\n+    @Test\n+    public void itemXOwningCollectionTest() throws Exception {\n+\n+        String token = getAuthToken(admin.getEmail(), password);\n+        getClient(token).perform(get(\"/api/core/items/\" + itemAA1.getID() + \"/owningCollection\"))\n+                        .andExpect(jsonPath(\"$\", is(CollectionMatcher.matchCollectionEntry(colAA1.getName(),\n+                                                                                           colAA1.getID(),\n+                                                                                           colAA1.getHandle()))))\n+                        .andExpect(jsonPath(\"$\", Matchers\n+                            .not(is(CollectionMatcher\n+                                        .matchCollectionEntry(colAA2.getName(), colAA2.getID(), colAA2.getHandle())))));\n+\n+    }\n+\n+    @Test\n+    public void itemYOwningCollectionTest() throws Exception {\n+\n+        String token = getAuthToken(admin.getEmail(), password);\n+        getClient(token).perform(get(\"/api/core/items/\" + itemAA1MappedInAA2.getID() + \"/owningCollection\"))\n+                        .andExpect(jsonPath(\"$\", is(CollectionMatcher.matchCollectionEntry(colAA1.getName(),\n+                                                                                           colAA1.getID(),\n+                                                                                           colAA1.getHandle()))))\n+                        .andExpect(jsonPath(\"$\", Matchers\n+                            .not(is(CollectionMatcher\n+                                        .matchCollectionEntry(colAA2.getName(), colAA2.getID(), colAA2.getHandle())))));\n+    }\n+\n+    @Test\n+    public void itemZOwningCollectionTest() throws Exception {\n+\n+        String token = getAuthToken(admin.getEmail(), password);\n+        getClient(token).perform(get(\"/api/core/items/\" + itemAA2.getID() + \"/owningCollection\"))\n+                        .andExpect(jsonPath(\"$\", is(CollectionMatcher.matchCollectionEntry(colAA2.getName(),\n+                                                                                           colAA2.getID(),\n+                                                                                           colAA2.getHandle()))))\n+                        .andExpect(jsonPath(\"$\", Matchers\n+                            .not(is(CollectionMatcher\n+                                        .matchCollectionEntry(colAA1.getName(), colAA1.getID(), colAA1.getHandle())))));\n+\n+    }\n+\n+    @Test\n+    public void col1ParentCommunityTest() throws Exception {\n+\n+        String token = getAuthToken(admin.getEmail(), password);\n+        getClient(token).perform(get(\"/api/core/collections/\" + colAA1.getID() + \"/parentCommunity\"))\n+                        .andExpect(jsonPath(\"$\", is(CommunityMatcher\n+                                                        .matchCommunityEntry(communityAA.getName(), communityAA.getID(),\n+                                                                             communityAA.getHandle()))))\n+                        .andExpect(jsonPath(\"$\", not(is(CommunityMatcher.matchCommunityEntry(communityA.getName(),\n+                                                                                             communityA.getID(),\n+                                                                                             communityA.getHandle())))))\n+                        .andExpect(jsonPath(\"$\", not(is(CommunityMatcher.matchCommunityEntry(communityAB.getName(),\n+                                                                                             communityAB.getID(),\n+                                                                                             communityAB\n+                                                                                                 .getHandle())))));\n+\n+    }\n+\n+    @Test\n+    public void comAAParentCommunityTest() throws Exception {\n+\n+        String token = getAuthToken(admin.getEmail(), password);\n+        getClient(token)\n+            .perform(get(\"/api/core/communities/\" + communityAA.getID() + \"/parentCommunity\"))\n+            .andExpect(jsonPath(\"$\", Matchers\n+                .is(CommunityMatcher.matchCommunityEntry(communityA.getID(), communityA.getHandle()))))\n+            .andExpect(jsonPath(\"$\", Matchers\n+                .not(Matchers.is(CommunityMatcher.matchCommunityEntry(communityB.getID(), communityB.getHandle())))));\n+\n+    }\n+\n+    @Test\n+    public void comAParentCommunityTest() throws Exception {\n+\n+        String token = getAuthToken(admin.getEmail(), password);\n+        getClient(token).perform(get(\"/api/core/communities/\" + communityA.getID() + \"/parentCommunity\"))\n+                        .andExpect(status().isNoContent());\n+\n+\n+    }\n+\n+    @Test\n+    public void parentCommunityWrongUUIDTest() throws Exception {\n+\n+        String token = getAuthToken(admin.getEmail(), password);\n+        getClient(token).perform(get(\"/api/core/communities/\" + UUID.randomUUID() + \"/parentCommunity\"))\n+                        .andExpect(status().isNotFound());\n+\n+\n+    }\n+\n+    @Test\n+    public void parentCommunityPrivateCommunityUnAuthorizedTest() throws Exception {\n+\n+        context.turnOffAuthorisationSystem();\n+        authorizeService.removeAllPolicies(context, communityAA);\n+        context.restoreAuthSystemState();\n+        getClient().perform(get(\"/api/core/communities/\" + communityAA.getID() + \"/parentCommunity\"))\n+            .andExpect(status().isUnauthorized());\n+\n+    }\n+\n+    //Enable this test when this security level has been supported\n+    @Ignore\n+    @Test\n+    public void parentCommunityPrivateParentCommunityUnAuthorizedTest() throws Exception {\n+\n+        context.turnOffAuthorisationSystem();\n+        authorizeService.removeAllPolicies(context, communityA);\n+        context.restoreAuthSystemState();\n+        getClient().perform(get(\"/api/core/communities/\" + communityAA.getID() + \"/parentCommunity\"))\n+                   .andExpect(status().isUnauthorized());\n+\n+    }\n+\n+    @Test\n+    public void parentCommunityPrivateCommunityForbiddenTest() throws Exception {\n+\n+        context.turnOffAuthorisationSystem();\n+        authorizeService.removeAllPolicies(context, communityAA);\n+        context.restoreAuthSystemState();\n+        String token = getAuthToken(eperson.getEmail(), password);\n+        getClient(token).perform(get(\"/api/core/communities/\" + communityAA.getID() + \"/parentCommunity\"))\n+                   .andExpect(status().isForbidden());\n+\n+    }\n+\n+    //Enable this test when this security level has been supported\n+    @Ignore\n+    @Test\n+    public void parentCommunityPrivateParentCommunityForbiddenTest() throws Exception {\n+\n+        context.turnOffAuthorisationSystem();\n+        authorizeService.removeAllPolicies(context, communityA);\n+        context.restoreAuthSystemState();\n+        String token = getAuthToken(eperson.getEmail(), password);\n+        getClient(token).perform(get(\"/api/core/communities/\" + communityAA.getID() + \"/parentCommunity\"))\n+                        .andExpect(status().isForbidden());\n+\n+    }\n+\n+    @Test\n+    public void parentCommunityForCollectionWrongUUIDTest() throws Exception {\n+\n+        String token = getAuthToken(admin.getEmail(), password);\n+        getClient(token).perform(get(\"/api/core/collections/\" + UUID.randomUUID() + \"/parentCommunity\"))\n+                        .andExpect(status().isNotFound());\n+\n+\n+    }\n+\n+    @Test\n+    public void parentCommunityForCollectionPrivateCollectionUnAuthorizedTest() throws Exception {\n+\n+        context.turnOffAuthorisationSystem();\n+        authorizeService.removeAllPolicies(context, colAA1);\n+        context.restoreAuthSystemState();\n+        getClient().perform(get(\"/api/core/collections/\" + colAA1.getID() + \"/parentCommunity\"))\n+                   .andExpect(status().isUnauthorized());\n+\n+    }\n+\n+    //Enable this test when this security level has been supported", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NTIxMDc2OQ=="}, "originalCommit": {"oid": "abf82a3f465464a7b52a9dc107406351709464c5"}, "originalPosition": 274}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjM4NTY4NDExOnYy", "diffSide": "RIGHT", "path": "dspace-server-webapp/src/test/java/org/dspace/app/rest/CommunityCollectionItemParentIT.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yN1QxNjoxNDoxMVrOFvXfgg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yN1QxNjoxNDoxMVrOFvXfgg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NTIxMjI5MA==", "bodyText": "can you rename the test methods according to the refactored name of the items variable?", "url": "https://github.com/DSpace/DSpace/pull/2673#discussion_r385212290", "createdAt": "2020-02-27T16:14:11Z", "author": {"login": "abollini"}, "path": "dspace-server-webapp/src/test/java/org/dspace/app/rest/CommunityCollectionItemParentIT.java", "diffHunk": "@@ -0,0 +1,374 @@\n+/**\n+ * The contents of this file are subject to the license and copyright\n+ * detailed in the LICENSE and NOTICE files at the root of the source\n+ * tree and available online at\n+ *\n+ * http://www.dspace.org/license/\n+ */\n+package org.dspace.app.rest;\n+\n+import static org.hamcrest.CoreMatchers.is;\n+import static org.hamcrest.CoreMatchers.not;\n+import static org.springframework.test.web.servlet.request.MockMvcRequestBuilders.get;\n+import static org.springframework.test.web.servlet.result.MockMvcResultMatchers.jsonPath;\n+import static org.springframework.test.web.servlet.result.MockMvcResultMatchers.status;\n+\n+import java.sql.SQLException;\n+import java.util.UUID;\n+\n+import org.dspace.app.rest.builder.CollectionBuilder;\n+import org.dspace.app.rest.builder.CommunityBuilder;\n+import org.dspace.app.rest.builder.ItemBuilder;\n+import org.dspace.app.rest.matcher.CollectionMatcher;\n+import org.dspace.app.rest.matcher.CommunityMatcher;\n+import org.dspace.app.rest.test.AbstractControllerIntegrationTest;\n+import org.dspace.authorize.AuthorizeException;\n+import org.dspace.authorize.service.AuthorizeService;\n+import org.dspace.content.Collection;\n+import org.dspace.content.Community;\n+import org.dspace.content.Item;\n+import org.dspace.content.service.CollectionService;\n+import org.dspace.content.service.CommunityService;\n+import org.hamcrest.Matchers;\n+import org.junit.Before;\n+import org.junit.Ignore;\n+import org.junit.Test;\n+import org.springframework.beans.factory.annotation.Autowired;\n+\n+public class CommunityCollectionItemParentIT extends AbstractControllerIntegrationTest {\n+\n+    @Autowired\n+    private CollectionService collectionService;\n+\n+    @Autowired\n+    private CommunityService communityService;\n+\n+    @Autowired\n+    private AuthorizeService authorizeService;\n+\n+    Community communityA;\n+    Community communityB;\n+    Community communityAA;\n+    Community communityAB;\n+\n+    Collection colAA1;\n+    Collection colAA2;\n+    Collection colAB1;\n+\n+    Item itemAA1;\n+    Item itemAA1MappedInAA2;\n+    Item itemAA2;\n+\n+\n+    @Before\n+    public void setup() throws SQLException, AuthorizeException {\n+        //We turn off the authorization system in order to create the structure as defined below\n+        context.turnOffAuthorisationSystem();\n+        //** GIVEN **\n+        //1. A community-collection structure with one parent community with sub-community and one collection.\n+        communityA = CommunityBuilder.createCommunity(context)\n+                                     .withName(\"Parent CommunityA\")\n+                                     .build();\n+        communityB = CommunityBuilder.createCommunity(context)\n+                                     .withName(\"Parent CommunityB\")\n+                                     .build();\n+        communityAA = CommunityBuilder.createSubCommunity(context, communityA)\n+                                      .withName(\"Sub Community\")\n+                                      .build();\n+        communityAB = CommunityBuilder.createSubCommunity(context, communityA)\n+                                      .withName(\"Sub Community Two\")\n+                                      .build();\n+        colAA1 = CollectionBuilder.createCollection(context, communityAA).withName(\"Collection 1\").build();\n+        colAA2 = CollectionBuilder.createCollection(context, communityAA).withName(\"Collection 2\").build();\n+        colAB1 = CollectionBuilder.createCollection(context, communityAB).withName(\"Collection 3\").build();\n+        communityService.addCollection(context, communityAB, colAA2);\n+\n+\n+        itemAA1 = ItemBuilder.createItem(context, colAA1)\n+                             .withTitle(\"Public item 1\")\n+                             .withIssueDate(\"2017-10-17\")\n+                             .withAuthor(\"Smith, Donald\").withAuthor(\"Doe, John\")\n+                             .withSubject(\"ExtraEntry\")\n+                             .build();\n+\n+        itemAA1MappedInAA2 = ItemBuilder.createItem(context, colAA1)\n+                                        .withTitle(\"Public item 1\")\n+                                        .withIssueDate(\"2017-10-17\")\n+                                        .withAuthor(\"Smith, Donald\").withAuthor(\"Doe, John\")\n+                                        .withSubject(\"ExtraEntry\")\n+                                        .build();\n+        collectionService.addItem(context, colAA2, itemAA1MappedInAA2);\n+        itemAA2 = ItemBuilder.createItem(context, colAA2)\n+                             .withTitle(\"Public item 1\")\n+                             .withIssueDate(\"2017-10-17\")\n+                             .withAuthor(\"Smith, Donald\").withAuthor(\"Doe, John\")\n+                             .withSubject(\"ExtraEntry\")\n+                             .build();\n+\n+        context.restoreAuthSystemState();\n+    }\n+\n+    @Test\n+    public void itemXOwningCollectionTest() throws Exception {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "abf82a3f465464a7b52a9dc107406351709464c5"}, "originalPosition": 112}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1644, "cost": 1, "resetAt": "2021-11-12T13:16:51Z"}}}