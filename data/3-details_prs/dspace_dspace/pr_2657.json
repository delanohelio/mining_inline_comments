{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0MzY4NjUwODEz", "number": 2657, "title": "[DS-4257] dspace.url and dspace.baseUrl config cleanup", "bodyText": "This PR is the final stage of https://jira.lyrasis.org/browse/DS-4257 (Spring Boot webapp refactor).  I finally got back to this.\nIt refactors our configuration slightly to better differentiate between our URL-based configurations.\nTwo new configurations are added:\n\ndspace.server.url = The URL of the server webapp (i.e. DSpace backend)\ndspace.ui.url = The URL of the Angular UI (i.e. DSpace frontend)\ndspace.ui.hostname = The hostname of the DSpace UI (This config is only really used as an \"identifier\" for DSpace in modules like OAI-PMH)\n\nUPDATE: I've updated this PR to refactor out the need for a \"hostname\" configuration. See notes below under the dspace.hostname bullet.\n\n\n\nThese old URL configurations have been removed (replaced by the above):\n\ndspace.baseUrl is removed and (usually) replaced by dspace.server.url.  However, in a few rare cases it was actually referring to the UI and was replaced by dspace.ui.url.\ndspace.url is removed and (usually) replaced by dspace.ui.url. However, in a few rare cases it was actually referring to the backend and was replaced by dspace.server.url.\ndspace.hostname is completely removed (with no replacement).  Instead, I've refactored the code that used dspace.hostname to instead parse the hostname from the appropriate dspace.*.url configuration.\n\nAdded a new Utils.getHostName() utility method to parse the hostname from any URL. Added tests to prove it works.  Refactored Java code that previously used dspace.hostname to now use this utility method.\nChanged OAI-PMH's description.xml to use the existing oai.identifier.prefix (which previously defaulted to dspace.hostname).  Changed oai.identifier.prefix to now be set dynamically to the hostname of the dspace.ui.url (if not specified in the oai.cfg or similar)\nRefactored OAI-PMH build process to no longer populate the description.xml using Ant filters. Instead, any configuration variables in the description.xml are now populated dynamically.  This ensures it can use the oai.identifier.prefix (now populated dynamically).\n\n\ndspace.mobileUrl is completely removed (no longer used anywhere in our codebase and not applicable for Angular UI).\n\nNOTE: Once this PR is merged, we need to ensure all DSpace 7 developers are aware of the new configurations.  Additionally, the REST API demo site must update its local.cfg to use the new configurations (or else errors may occur).", "createdAt": "2020-01-29T16:28:51Z", "url": "https://github.com/DSpace/DSpace/pull/2657", "merged": true, "mergeCommit": {"oid": "820722d2e6e848a5b486c56b6596ce1473d16792"}, "closed": true, "closedAt": "2020-02-13T20:52:15Z", "author": {"login": "tdonohue"}, "timelineItems": {"totalCount": 13, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABb_cl15AFqTM1MDkzMTAyMg==", "endCursor": "Y3Vyc29yOnYyOpPPAAABcEATs_ABqjMwMzYyNzUwNjA=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzUwOTMxMDIy", "url": "https://github.com/DSpace/DSpace/pull/2657#pullrequestreview-350931022", "createdAt": "2020-01-30T15:50:49Z", "commit": null, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0zMFQxNTo1MDo1MFrOFjwB4A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0zMFQxNTo1MDo1MFrOFjwB4A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MzAzMTM5Mg==", "bodyText": "If this should match dspace.ui.url then shouldn't we refer to it in dspace.ui.url (and dspace.server.url)?  That is:\ndspace.ui.hostname = localhost\ndspace.ui.url = http://${dspace.ui.hostname}:3000\ndspace.server.url = http://${dspace.ui.hostname}:8080/server\n\n(That does make the name dspace.ui.hostname confusing, though.)", "url": "https://github.com/DSpace/DSpace/pull/2657#discussion_r373031392", "createdAt": "2020-01-30T15:50:50Z", "author": {"login": "mwoodiupui"}, "path": "dspace/config/local.cfg.EXAMPLE", "diffHunk": "@@ -30,14 +30,18 @@\n # Windows note: Please remember to use forward slashes for all paths (e.g. C:/dspace)\n dspace.dir=/dspace\n \n-# DSpace host name - should match base URL.  Do not include port number\n-dspace.hostname = localhost\n+# URL of DSpace backend ('server' webapp). Include port number etc.\n+# This is where REST API and all enabled server modules (OAI-PMH, SWORD, SWORDv2, RDF, etc) will respond\n+dspace.server.url = http://localhost:8080/server\n \n-# DSpace server backend webapp URL.  Include port number etc.\n-dspace.baseUrl = http://localhost:8080/server\n+# DSpace UI hostname. Should match dspace.ui.url.  Do not include port number.", "state": "SUBMITTED", "replyTo": null, "originalCommit": null, "originalPosition": 12}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzUxNDU5NDMz", "url": "https://github.com/DSpace/DSpace/pull/2657#pullrequestreview-351459433", "createdAt": "2020-01-31T11:58:31Z", "commit": null, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": null, "afterCommit": null}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": null, "afterCommit": null}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzUyMjU1ODI1", "url": "https://github.com/DSpace/DSpace/pull/2657#pullrequestreview-352255825", "createdAt": "2020-02-03T13:36:23Z", "commit": null, "state": "APPROVED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0wM1QxMzozNjoyNFrOFkxhnA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0wM1QxMzozNjoyNFrOFkxhnA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NDEwNDQ3Ng==", "bodyText": "Why do we do this?", "url": "https://github.com/DSpace/DSpace/pull/2657#discussion_r374104476", "createdAt": "2020-02-03T13:36:24Z", "author": {"login": "mwoodiupui"}, "path": "dspace-api/src/main/java/org/dspace/core/Utils.java", "diffHunk": "@@ -408,4 +413,38 @@ public static String standardize(String schema, String element, String qualifier\n             return schema + separator + element + separator + qualifier;\n         }\n     }\n+\n+\n+    /**\n+     * Retrieve the hostname from a given URI string\n+     * @param uriString URI string\n+     * @return hostname (without any www.) or null (if URI was invalid)\n+     */\n+    public static String getHostName(String uriString) {\n+        try {\n+            URI uri = new URI(uriString);\n+            String hostname = uri.getHost();\n+            // remove the \"www.\" from hostname, if it exists", "state": "SUBMITTED", "replyTo": null, "originalCommit": null, "originalPosition": 35}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f64553e31cca5a1c7a19339bc84ecf37a61617f2", "author": {"user": {"login": "tdonohue", "name": "Tim Donohue"}}, "url": "https://github.com/DSpace/DSpace/commit/f64553e31cca5a1c7a19339bc84ecf37a61617f2", "committedDate": "2020-02-13T19:36:00Z", "message": "Remove final references to old dspace.restUrl config"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "5e3e9b8f9d3d3560f1b77e3ce6e471d109dfdb8a", "author": {"user": {"login": "tdonohue", "name": "Tim Donohue"}}, "url": "https://github.com/DSpace/DSpace/commit/5e3e9b8f9d3d3560f1b77e3ce6e471d109dfdb8a", "committedDate": "2020-02-13T19:40:23Z", "message": "Replace all usages of dspace.baseUrl with either dspace.server.url or dspace.ui.url (depending on use case)"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e8180f11cb06539f2faada43cf420df4f2453d5e", "author": {"user": {"login": "tdonohue", "name": "Tim Donohue"}}, "url": "https://github.com/DSpace/DSpace/commit/e8180f11cb06539f2faada43cf420df4f2453d5e", "committedDate": "2020-02-13T19:40:33Z", "message": "Replace all usages of dspace.url with either dspace.ui.url or dspace.server.url (depending on use case)"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c55f29de6ad01b2856c9daddf796cbaf01572376", "author": {"user": {"login": "tdonohue", "name": "Tim Donohue"}}, "url": "https://github.com/DSpace/DSpace/commit/c55f29de6ad01b2856c9daddf796cbaf01572376", "committedDate": "2020-02-13T19:40:34Z", "message": "Replace dspace.hostname with dspace.ui.hostname. Enhance descriptions of how/where configs are used"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d455d7df87cfbc606f4f3ae93fd5b2511b18b862", "author": {"user": {"login": "tdonohue", "name": "Tim Donohue"}}, "url": "https://github.com/DSpace/DSpace/commit/d455d7df87cfbc606f4f3ae93fd5b2511b18b862", "committedDate": "2020-02-13T19:40:34Z", "message": "Fix minor test & checkstyle failures"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b116c55714f34866c75b2e4733bab021e7f735ed", "author": {"user": {"login": "tdonohue", "name": "Tim Donohue"}}, "url": "https://github.com/DSpace/DSpace/commit/b116c55714f34866c75b2e4733bab021e7f735ed", "committedDate": "2020-02-13T19:40:35Z", "message": "Refactor code to remove the need for a \"hostname\" configuration."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "3c43dbdcddf39b2ba638e65bf29e700e1c59c3fa", "author": {"user": {"login": "tdonohue", "name": "Tim Donohue"}}, "url": "https://github.com/DSpace/DSpace/commit/3c43dbdcddf39b2ba638e65bf29e700e1c59c3fa", "committedDate": "2020-02-13T19:42:36Z", "message": "Replace dspace.url with dspace.server.url in recent code comments"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": null, "afterCommit": {"oid": "3c43dbdcddf39b2ba638e65bf29e700e1c59c3fa", "author": {"user": {"login": "tdonohue", "name": "Tim Donohue"}}, "url": "https://github.com/DSpace/DSpace/commit/3c43dbdcddf39b2ba638e65bf29e700e1c59c3fa", "committedDate": "2020-02-13T19:42:36Z", "message": "Replace dspace.url with dspace.server.url in recent code comments"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1578, "cost": 1, "resetAt": "2021-11-01T13:51:04Z"}}}