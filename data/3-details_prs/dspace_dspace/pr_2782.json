{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDM2NDU1MDU3", "number": 2782, "title": "DSpace (Solr) Statistics - Usage Reports", "bodyText": "References\n\nREST Contract\n\nDescription\nThis PR adds in the functionality to retrieve the statistics created through the viewevents\nInstructions for Reviewers\nList of changes in this PR:\n\nRest representations of Usage Reports in the DSpace statistics, and it's related converter\nEndpoints have been added to the StatisticsRestRepository, keeping the open PreAuthorize related PR in mind (using the findOne method for permission checks)\n\nPlease refer to the viewevents information on stats creation\nMake sure to also have a valid GeoLite configured in usage-statistics.cfg\nSharded Cores\nNote that we added in a flag to check if the solr statistics core is sharded or not. We noticed that, if the code assumes that the core is sharded, while it isn't that statistics are counted twice.\nThis is because the 'default' statistics core is loaded in, and then from the related solr, it tries to find any additional core/shard, resulting in a query being done similar to the following\n\nshards=localhost:8983/solr/statistics,localhost:8983/solr/statistics\n\nSolr autocommit\nPlease keep in mind that solr's autocommit might not be 100% functional in all cases\nThe time between autocommits is defined as:\n\n${solr.autoCommit.maxTime:900000}\n\nIf a solr.autoCommit.maxtime is found, that is used, otherwise it defaults to 15 minutes.\nIn some instances, this (A workaround is 'hardcoding' it to 15 minutes manually in solrconfig.xml)\nThis will need to be followed up separately as well for investigation (Not a technically breaking problem at this point)\nChecklist\nThis checklist provides a reminder of what we are going to look for when reviewing your PR. You need not complete this checklist prior to creating your PR (draft PRs are always welcome). If you are unsure about an item in the checklist, don't hesitate to ask. We're here to help!\n\n My PR is small in size (e.g. less than 1,000 lines of code, not including comments & integration tests). Exceptions may be made if previously agreed upon.\n My PR passes Checkstyle validation based on the Code Style Guide.\n My PR includes Javadoc for all new (or modified) public methods and classes. It also includes Javadoc for large or complex private methods.\n My PR passes all tests and includes new/updated Unit or Integration Tests based on the Code Testing Guide.\n If my PR includes new, third-party dependencies (in any pom.xml), I've made sure their licenses align with the DSpace BSD License based on the Licensing of Contributions documentation.\n If my PR modifies the REST API, I've linked to the REST Contract page (or open PR) related to this change.", "createdAt": "2020-06-18T12:56:37Z", "url": "https://github.com/DSpace/DSpace/pull/2782", "merged": true, "mergeCommit": {"oid": "0385352151d58a589b390948d2597f001aa45c57"}, "closed": true, "closedAt": "2020-09-11T17:40:21Z", "author": {"login": "jonas-atmire"}, "timelineItems": {"totalCount": 31, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcuxBMXgBqjM0ODMxMzYxMTU=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdH3go2AFqTQ4NjkyODQ2NQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "d84ba5a3f9dcb0e16ced4df3e59712c1a2415d2b", "author": {"user": {"login": "MarieVerdonck", "name": "Marie Verdonck"}}, "url": "https://github.com/DSpace/DSpace/commit/d84ba5a3f9dcb0e16ced4df3e59712c1a2415d2b", "committedDate": "2020-06-22T14:57:07Z", "message": "71214: self link for /statistics/usagereport endpoint"}, "afterCommit": {"oid": "83cdb824a8f4ec1833091795210401fcb1486c8c", "author": {"user": {"login": "MarieVerdonck", "name": "Marie Verdonck"}}, "url": "https://github.com/DSpace/DSpace/commit/83cdb824a8f4ec1833091795210401fcb1486c8c", "committedDate": "2020-06-25T16:12:26Z", "message": "71424: Label always on UsageReportPoint for UI &\nTests fixed by adding null check on targetId in EvaluatorPlugins"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDYyNDgxOTQ1", "url": "https://github.com/DSpace/DSpace/pull/2782#pullrequestreview-462481945", "createdAt": "2020-08-06T12:45:03Z", "commit": null, "state": "COMMENTED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "161fb9b518ed317372254a33edb956293baeb454", "author": {"user": {"login": "MarieVerdonck", "name": "Marie Verdonck"}}, "url": "https://github.com/DSpace/DSpace/commit/161fb9b518ed317372254a33edb956293baeb454", "committedDate": "2020-08-07T08:30:21Z", "message": "71214: Usage Reports WIP:\n - TotalVisits, TopCountries & TopCities done\n - TotalVisitsPerMonth Wip\n - TODO: TotalDownloads & IT"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d603ddf40770a2e8f73196cca5f55dc0b8d88d0c", "author": {"user": {"login": "MarieVerdonck", "name": "Marie Verdonck"}}, "url": "https://github.com/DSpace/DSpace/commit/d603ddf40770a2e8f73196cca5f55dc0b8d88d0c", "committedDate": "2020-08-07T08:30:21Z", "message": "71214: - Usage Reports TotalVisitPerMonth fixed (facet works with range not date any more)\n- settable facetMinCount to get month points with no views\n- TotalDownloads added"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "619d4de3ad6789cd1da6f64335826b74a1722647", "author": {"user": {"login": "MarieVerdonck", "name": "Marie Verdonck"}}, "url": "https://github.com/DSpace/DSpace/commit/619d4de3ad6789cd1da6f64335826b74a1722647", "committedDate": "2020-08-07T08:30:21Z", "message": "71214: Test Fix & Usage Reports First set of Tests (TotalVisits & TotalVisitsPerMonth)"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "16df8f38f901544a2be686f0ffbff65a0d2f1fb9", "author": {"user": {"login": "MarieVerdonck", "name": "Marie Verdonck"}}, "url": "https://github.com/DSpace/DSpace/commit/16df8f38f901544a2be686f0ffbff65a0d2f1fb9", "committedDate": "2020-08-07T08:30:21Z", "message": "71214: checkstyle & Tests for TotalDownloads usage report"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "2b0a3664cafba6187d3dad0a9a53a718e479f4bc", "author": {"user": {"login": "MarieVerdonck", "name": "Marie Verdonck"}}, "url": "https://github.com/DSpace/DSpace/commit/2b0a3664cafba6187d3dad0a9a53a718e479f4bc", "committedDate": "2020-08-07T08:30:21Z", "message": "71214: checkstyle & javadoc"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "1bf46bca898a0dcacf18c9b77d2eb825f3a466bd", "author": {"user": {"login": "MarieVerdonck", "name": "Marie Verdonck"}}, "url": "https://github.com/DSpace/DSpace/commit/1bf46bca898a0dcacf18c9b77d2eb825f3a466bd", "committedDate": "2020-08-07T08:30:54Z", "message": "71214: TopCities & TopCountries usage report tests"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e2d2681816127aa55d961a3f0a11d35caa3b8274", "author": {"user": {"login": "MarieVerdonck", "name": "Marie Verdonck"}}, "url": "https://github.com/DSpace/DSpace/commit/e2d2681816127aa55d961a3f0a11d35caa3b8274", "committedDate": "2020-08-07T08:30:54Z", "message": "71214: Usage reports authorization + tests (need read access on dso)"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "6c68d58c90346e82f294987a7d3b9efdc955de87", "author": {"user": {"login": "MarieVerdonck", "name": "Marie Verdonck"}}, "url": "https://github.com/DSpace/DSpace/commit/6c68d58c90346e82f294987a7d3b9efdc955de87", "committedDate": "2020-08-07T08:30:54Z", "message": "71214: Search Usage reports endpoint & global site usage report &\nexception changes, todo: search usage report endpoint tests"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "af16704b89308c0b117b4b1f6dfe02adf41078e3", "author": {"user": {"login": "MarieVerdonck", "name": "Marie Verdonck"}}, "url": "https://github.com/DSpace/DSpace/commit/af16704b89308c0b117b4b1f6dfe02adf41078e3", "committedDate": "2020-08-07T08:30:54Z", "message": "71214: Usage report search tests & Config for non-sharded stat solr"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "9c16b743f8fce8c86e5d844083ed73d7bbea66bb", "author": {"user": {"login": "MarieVerdonck", "name": "Marie Verdonck"}}, "url": "https://github.com/DSpace/DSpace/commit/9c16b743f8fce8c86e5d844083ed73d7bbea66bb", "committedDate": "2020-08-07T08:30:54Z", "message": "71214: checkstyle"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f66064f02313281738a3f94c2f0481fb72fee37c", "author": {"user": {"login": "MarieVerdonck", "name": "Marie Verdonck"}}, "url": "https://github.com/DSpace/DSpace/commit/f66064f02313281738a3f94c2f0481fb72fee37c", "committedDate": "2020-08-07T08:30:54Z", "message": "71424: endpoint methods moved to StatisticsRestRepository"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "9694858018cc55bc13e12675bacfcc94466d1f3d", "author": {"user": {"login": "MarieVerdonck", "name": "Marie Verdonck"}}, "url": "https://github.com/DSpace/DSpace/commit/9694858018cc55bc13e12675bacfcc94466d1f3d", "committedDate": "2020-08-07T08:30:54Z", "message": "71424: permission check back to EvaluatorPlugin, exception message fix"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "5c7541a28335d6526c12f2f2af975fef9ac2327c", "author": {"user": {"login": "MarieVerdonck", "name": "Marie Verdonck"}}, "url": "https://github.com/DSpace/DSpace/commit/5c7541a28335d6526c12f2f2af975fef9ac2327c", "committedDate": "2020-08-07T08:30:54Z", "message": "71214: self link for /statistics/usagereport endpoint"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "485800a79e08e88de311b6d572ad9b5723f1e167", "author": {"user": {"login": "MarieVerdonck", "name": "Marie Verdonck"}}, "url": "https://github.com/DSpace/DSpace/commit/485800a79e08e88de311b6d572ad9b5723f1e167", "committedDate": "2020-08-07T08:30:54Z", "message": "71424: Label always on UsageReportPoint for UI &\nTests fixed by adding null check on targetId in EvaluatorPlugins"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "94e3d3df6804b28b1e66a598ff8c43f521119996", "author": {"user": {"login": "MarieVerdonck", "name": "Marie Verdonck"}}, "url": "https://github.com/DSpace/DSpace/commit/94e3d3df6804b28b1e66a598ff8c43f521119996", "committedDate": "2020-08-07T08:30:54Z", "message": "Null checks for inconsistent stat data points"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "fbba2302b66c76c02acfd52a2af5c410690ce163", "author": {"user": {"login": "MarieVerdonck", "name": "Marie Verdonck"}}, "url": "https://github.com/DSpace/DSpace/commit/fbba2302b66c76c02acfd52a2af5c410690ce163", "committedDate": "2020-08-07T08:30:54Z", "message": "Null check for dso handle"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f0644f5b6b302c4abe9632fefdc83dd94b81c8a7", "author": {"user": {"login": "MarieVerdonck", "name": "Marie Verdonck"}}, "url": "https://github.com/DSpace/DSpace/commit/f0644f5b6b302c4abe9632fefdc83dd94b81c8a7", "committedDate": "2020-08-07T08:30:54Z", "message": "Id fix most popular items site wide"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "24534f943e06a1309a1c36f0a07fb81a3951a12c", "author": {"user": {"login": "MarieVerdonck", "name": "Marie Verdonck"}}, "url": "https://github.com/DSpace/DSpace/commit/24534f943e06a1309a1c36f0a07fb81a3951a12c", "committedDate": "2020-08-07T10:36:12Z", "message": "Builders moved fixes"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": null, "afterCommit": {"oid": "24534f943e06a1309a1c36f0a07fb81a3951a12c", "author": {"user": {"login": "MarieVerdonck", "name": "Marie Verdonck"}}, "url": "https://github.com/DSpace/DSpace/commit/24534f943e06a1309a1c36f0a07fb81a3951a12c", "committedDate": "2020-08-07T10:36:12Z", "message": "Builders moved fixes"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c88b6ef2e7c28a924d85fa3d04cce769baaebb3c", "author": {"user": {"login": "MarieVerdonck", "name": "Marie Verdonck"}}, "url": "https://github.com/DSpace/DSpace/commit/c88b6ef2e7c28a924d85fa3d04cce769baaebb3c", "committedDate": "2020-08-31T14:30:24Z", "message": "72788: explicit solr.commit allowed config added for Statistics tests"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDgxODU5MDQx", "url": "https://github.com/DSpace/DSpace/pull/2782#pullrequestreview-481859041", "createdAt": "2020-09-03T13:50:27Z", "commit": {"oid": "c88b6ef2e7c28a924d85fa3d04cce769baaebb3c"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 6, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wM1QxMzo1MDoyOFrOHMnjFA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wM1QxNjozNzoyN1rOHMu3KA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4Mjk5MjkxNg==", "bodyText": "I'm not sure I understand why we turned this into a variable. It looks like it's now always zero (0) in this PR.  I'm not against making this a variable you need to pass in, but I don't understand the reasoning, as it seems like a lot of code refactoring to turn a 1 into a 0.  Could you explain why you've gone with this approach?\nI'm probably missing something, but it'd be nice to understand why sometimes this might need to be 0 and why sometimes it might need to be 1.  We also may want to describe that a bit more in the JavaDocs for facetMinCount, so that it's clear what 0 or 1 mean here.", "url": "https://github.com/DSpace/DSpace/pull/2782#discussion_r482992916", "createdAt": "2020-09-03T13:50:28Z", "author": {"login": "tdonohue"}, "path": "dspace-api/src/main/java/org/dspace/statistics/SolrLoggerServiceImpl.java", "diffHunk": "@@ -985,28 +996,29 @@ protected String getDateView(String name, String type, Context context) {\n     @Override\n     public QueryResponse query(String query, String filterQuery,\n                                String facetField, int rows, int max, String dateType, String dateStart,\n-                               String dateEnd, List<String> facetQueries, String sort, boolean ascending)\n+                               String dateEnd, List<String> facetQueries, String sort, boolean ascending,\n+                               int facetMinCount)\n         throws SolrServerException, IOException {\n         if (solr == null) {\n             return null;\n         }\n \n         // System.out.println(\"QUERY\");\n         SolrQuery solrQuery = new SolrQuery().setRows(rows).setQuery(query)\n-                                             .setFacetMinCount(1);\n+                                             .setFacetMinCount(facetMinCount);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c88b6ef2e7c28a924d85fa3d04cce769baaebb3c"}, "originalPosition": 147}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4Mjk5NTQxMA==", "bodyText": "Needs JavaDocs as it's unclear what a valid \"type\" is for this class.  All others of these UsageReportPointRest class seem to have a constant type.", "url": "https://github.com/DSpace/DSpace/pull/2782#discussion_r482995410", "createdAt": "2020-09-03T13:53:48Z", "author": {"login": "tdonohue"}, "path": "dspace-server-webapp/src/main/java/org/dspace/app/rest/model/UsageReportPointDsoTotalVisitsRest.java", "diffHunk": "@@ -0,0 +1,28 @@\n+/**\n+ * The contents of this file are subject to the license and copyright\n+ * detailed in the LICENSE and NOTICE files at the root of the source\n+ * tree and available online at\n+ *\n+ * http://www.dspace.org/license/\n+ */\n+package org.dspace.app.rest.model;\n+\n+/**\n+ * This class serves as a REST representation of a TotalVisit data Point of a DSO's {@link UsageReportRest} from the\n+ * DSpace statistics\n+ *\n+ * @author Maria Verdonck (Atmire) on 08/06/2020\n+ */\n+public class UsageReportPointDsoTotalVisitsRest extends UsageReportPointRest {\n+\n+    private String type;\n+\n+    @Override\n+    public String getType() {\n+        return this.type;\n+    }\n+\n+    public void setType(String type) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c88b6ef2e7c28a924d85fa3d04cce769baaebb3c"}, "originalPosition": 25}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4Mjk5NTk2Nw==", "bodyText": "Please add JavaDocs to all these public methods...that way they will be inherited (via @Override) to all extending classes.", "url": "https://github.com/DSpace/DSpace/pull/2782#discussion_r482995967", "createdAt": "2020-09-03T13:54:32Z", "author": {"login": "tdonohue"}, "path": "dspace-server-webapp/src/main/java/org/dspace/app/rest/model/UsageReportPointRest.java", "diffHunk": "@@ -0,0 +1,69 @@\n+/**\n+ * The contents of this file are subject to the license and copyright\n+ * detailed in the LICENSE and NOTICE files at the root of the source\n+ * tree and available online at\n+ *\n+ * http://www.dspace.org/license/\n+ */\n+package org.dspace.app.rest.model;\n+\n+import java.util.HashMap;\n+import java.util.Map;\n+\n+import org.dspace.app.rest.StatisticsRestController;\n+\n+/**\n+ * This class serves as a REST representation of a Point of a {@link UsageReportRest} from the DSpace statistics\n+ *\n+ * @author Maria Verdonck (Atmire) on 08/06/2020\n+ */\n+public class UsageReportPointRest extends BaseObjectRest<String> {\n+    public static final String NAME = \"point\";\n+    public static final String CATEGORY = RestModel.STATISTICS;\n+    protected String id;\n+    protected String label;\n+    private Map<String, Integer> values;\n+\n+    public String getCategory() {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c88b6ef2e7c28a924d85fa3d04cce769baaebb3c"}, "originalPosition": 27}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4Mjk5NzE3NQ==", "bodyText": "Same here, JavaDocs on all the public methods would help distinguish this from UsageReportPointRest, as the two classes look very similar at a glance.", "url": "https://github.com/DSpace/DSpace/pull/2782#discussion_r482997175", "createdAt": "2020-09-03T13:56:05Z", "author": {"login": "tdonohue"}, "path": "dspace-server-webapp/src/main/java/org/dspace/app/rest/model/UsageReportRest.java", "diffHunk": "@@ -0,0 +1,66 @@\n+/**\n+ * The contents of this file are subject to the license and copyright\n+ * detailed in the LICENSE and NOTICE files at the root of the source\n+ * tree and available online at\n+ *\n+ * http://www.dspace.org/license/\n+ */\n+package org.dspace.app.rest.model;\n+\n+import java.util.ArrayList;\n+import java.util.List;\n+\n+import com.fasterxml.jackson.annotation.JsonProperty;\n+import org.dspace.app.rest.StatisticsRestController;\n+\n+/**\n+ * This class serves as a REST representation of a Usage Report from the DSpace statistics\n+ *\n+ * @author Maria Verdonck (Atmire) on 08/06/2020\n+ */\n+public class UsageReportRest extends BaseObjectRest<String> {\n+    public static final String NAME = \"usagereport\";\n+    public static final String CATEGORY = RestModel.STATISTICS;\n+\n+    @JsonProperty(value = \"report-type\")\n+    private String reportType;\n+    private List<UsageReportPointRest> points;\n+\n+    public String getCategory() {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c88b6ef2e7c28a924d85fa3d04cce769baaebb3c"}, "originalPosition": 29}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MzAwMDgwNg==", "bodyText": "This looks odd. Why does it need to extend AbstractDSpaceRestRepository when this isn't a RestRepository class?  It's also odd that this service is placed under the org.dspace.app.rest.repository package (where no other Services exist)\nI'm open to other ideas, but I wonder if this should be renamed UsageReportUtils and put under the org.dspace.app.rest.utils package with other similar utility classes?", "url": "https://github.com/DSpace/DSpace/pull/2782#discussion_r483000806", "createdAt": "2020-09-03T14:00:38Z", "author": {"login": "tdonohue"}, "path": "dspace-server-webapp/src/main/java/org/dspace/app/rest/repository/UsageReportService.java", "diffHunk": "@@ -0,0 +1,359 @@\n+/**\n+ * The contents of this file are subject to the license and copyright\n+ * detailed in the LICENSE and NOTICE files at the root of the source\n+ * tree and available online at\n+ *\n+ * http://www.dspace.org/license/\n+ */\n+package org.dspace.app.rest.repository;\n+\n+import java.io.IOException;\n+import java.sql.SQLException;\n+import java.text.ParseException;\n+import java.util.ArrayList;\n+import java.util.List;\n+import java.util.UUID;\n+\n+import org.apache.commons.lang3.StringUtils;\n+import org.apache.solr.client.solrj.SolrServerException;\n+import org.dspace.app.rest.exception.DSpaceBadRequestException;\n+import org.dspace.app.rest.model.UsageReportPointCityRest;\n+import org.dspace.app.rest.model.UsageReportPointCountryRest;\n+import org.dspace.app.rest.model.UsageReportPointDateRest;\n+import org.dspace.app.rest.model.UsageReportPointDsoTotalVisitsRest;\n+import org.dspace.app.rest.model.UsageReportRest;\n+import org.dspace.app.rest.utils.DSpaceObjectUtils;\n+import org.dspace.content.Bitstream;\n+import org.dspace.content.DSpaceObject;\n+import org.dspace.content.Item;\n+import org.dspace.content.Site;\n+import org.dspace.core.Constants;\n+import org.dspace.core.Context;\n+import org.dspace.handle.service.HandleService;\n+import org.dspace.statistics.Dataset;\n+import org.dspace.statistics.content.DatasetDSpaceObjectGenerator;\n+import org.dspace.statistics.content.DatasetTimeGenerator;\n+import org.dspace.statistics.content.DatasetTypeGenerator;\n+import org.dspace.statistics.content.StatisticsDataVisits;\n+import org.dspace.statistics.content.StatisticsListing;\n+import org.dspace.statistics.content.StatisticsTable;\n+import org.springframework.beans.factory.annotation.Autowired;\n+import org.springframework.data.rest.webmvc.ResourceNotFoundException;\n+import org.springframework.stereotype.Component;\n+\n+/**\n+ * This is the Service dealing with the {@link UsageReportRest} logic\n+ *\n+ * @author Maria Verdonck (Atmire) on 08/06/2020\n+ */\n+@Component\n+public class UsageReportService extends AbstractDSpaceRestRepository {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c88b6ef2e7c28a924d85fa3d04cce769baaebb3c"}, "originalPosition": 50}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MzExMjc0NA==", "bodyText": "Am I correct to assume that site's should set this to true if they are running stats-util -s to shard their index each year?  https://wiki.lyrasis.org/display/DSDOC6x/SOLR+Statistics+Maintenance#SOLRStatisticsMaintenance-SolrShardingByYear\nIf so, we should document that in this comment. by saying something like;\nIf you are sharding your statistics index each year by running \"dspace stats-util -s\", you should set this to \"true\"\nFinally, as a general question, why did we default this to false?  It seems like in the current code, it's essentially defaulting to true...as SolrLoggerServiceImpl.initSolrYearCores() always runs by default and it checks to see if you have any year-based shards available.   So, is this fixing some bug you stumbled across with initSolrYearCores()?", "url": "https://github.com/DSpace/DSpace/pull/2782#discussion_r483112744", "createdAt": "2020-09-03T16:37:27Z", "author": {"login": "tdonohue"}, "path": "dspace/config/modules/usage-statistics.cfg", "diffHunk": "@@ -40,3 +40,6 @@ usage-statistics.authorization.admin.workflow=true\n # Enable/disable if a matching for a bot should be case sensitive\n # Setting this value to true will increase cpu usage, but bots will be found more accurately\n #usage-statistics.bots.case-insensitive = false\n+\n+# Set to true if the statistics core is sharded into a core per year, defaults to false\n+usage-statistics.shardedByYear = false", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c88b6ef2e7c28a924d85fa3d04cce769baaebb3c"}, "originalPosition": 6}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "88fbb77aa5b5aef90b71b7c97766647bb0d44dbe", "author": {"user": {"login": "MarieVerdonck", "name": "Marie Verdonck"}}, "url": "https://github.com/DSpace/DSpace/commit/88fbb77aa5b5aef90b71b7c97766647bb0d44dbe", "committedDate": "2020-09-04T10:26:18Z", "message": "72788: Feedback processed: Javadoc, moved service > util, config comment"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "64cf386b2597d9fc98a169d99c9d0a1d2b81637d", "author": {"user": {"login": "MarieVerdonck", "name": "Marie Verdonck"}}, "url": "https://github.com/DSpace/DSpace/commit/64cf386b2597d9fc98a169d99c9d0a1d2b81637d", "committedDate": "2020-09-04T10:29:38Z", "message": "72788: Feedback processed: Removed unneeded extends"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "65da1216fdb0733347a16693263b8f22daa07624", "author": {"user": {"login": "MarieVerdonck", "name": "Marie Verdonck"}}, "url": "https://github.com/DSpace/DSpace/commit/65da1216fdb0733347a16693263b8f22daa07624", "committedDate": "2020-09-04T11:58:32Z", "message": "Valid DSO UUID check"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDgyODExMjky", "url": "https://github.com/DSpace/DSpace/pull/2782#pullrequestreview-482811292", "createdAt": "2020-09-04T16:48:38Z", "commit": {"oid": "65da1216fdb0733347a16693263b8f22daa07624"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "346ff69bcd777a28880f5db999f55dcec074844e", "author": {"user": {"login": "MarieVerdonck", "name": "Marie Verdonck"}}, "url": "https://github.com/DSpace/DSpace/commit/346ff69bcd777a28880f5db999f55dcec074844e", "committedDate": "2020-09-07T08:58:37Z", "message": "73025: Fix self link"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDg1NDEwNDg3", "url": "https://github.com/DSpace/DSpace/pull/2782#pullrequestreview-485410487", "createdAt": "2020-09-09T21:17:53Z", "commit": {"oid": "346ff69bcd777a28880f5db999f55dcec074844e"}, "state": "COMMENTED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDg1NDI5MDkw", "url": "https://github.com/DSpace/DSpace/pull/2782#pullrequestreview-485429090", "createdAt": "2020-09-09T21:52:10Z", "commit": {"oid": "346ff69bcd777a28880f5db999f55dcec074844e"}, "state": "COMMENTED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDg2OTI4NDY1", "url": "https://github.com/DSpace/DSpace/pull/2782#pullrequestreview-486928465", "createdAt": "2020-09-11T15:55:08Z", "commit": {"oid": "346ff69bcd777a28880f5db999f55dcec074844e"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1494, "cost": 1, "resetAt": "2021-11-01T13:51:04Z"}}}