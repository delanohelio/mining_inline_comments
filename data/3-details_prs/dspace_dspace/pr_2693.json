{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0MzgwMTQ3NjM1", "number": 2693, "title": "DS-4440 GDPR - Anonymize statistics feature", "bodyText": "This PR adds a script to anonymise records in the Solr statistics core. The script will anonymise the IP values by rewriting (\u2018masking\u2019) the last part. This mask is configurable, both for ipv4 and ipv6 addresses.\nFor IPv4 addresses, the last number will be replaced by the mask, defined by the configuration key \u2018anonymise_statistics.ip_v4_mask\u2019 which defaults to \u2018254\u2019.\nFor example, 109.74.16.171 is rewritten as 109.74.16.254\nFor IPv6 address, the last two numbers will be replaced by the mask, defined by the configuration key \u2018anonymise_statistics.ip_v6_mask\u2019 which defaults to \u2018FFFF:FFFF\u2019\nFor example, 2001:0db8:85a3:0000:0000:8a2e:0370:7334 is rewritten as 2001:0db8:85a3:0000:0000:8a2e:FFFF:FFFF\nFor each anonymised record, the DNS field is also replaced by \u201canonymised\u201d.\nThe program only processes records older than 90 days. This period can be altered with the config \u2018anonymise_statistics.time_limit\u2019 (expressed in days).\nThe command \u2018anonymise-statistics\u2019 has been added to launcher.xml to launch the script.\nThe script takes an optional parameter \u2018-s [sleep]\u2019 (expressed in ms), which will make the Java thread sleep between the calls to Solr to reduce the load impact.\nThe Solr service commit mechanism is also optimised by adding multi-threading support. The script takes an optional parameter \u2018-t [threads]\u2019 to indicate how many threads the Solr service can use for this, if not given the thread count defaults to 2.\nBesides the 'anonymise-statistics' script, which anonymises existing statistics record, the PR also allows for statistics records to be anonymised the moment they are created.\nEnabling this feature can be done by setting the configuration parameter \"anonymise_statistics.anonymise_on_log\" to true.\nWhen this configuration property is not set, the feature is disabled by default.\nFinally, the PR also adds pagination support to SolrLoggerService\nThe work done on this PR is sponsored and led by the Humboldt-Universit\u00e4t zu Berlin.\nThis PR is related to https://jira.lyrasis.org/browse/DS-4440", "createdAt": "2020-02-26T10:43:09Z", "url": "https://github.com/DSpace/DSpace/pull/2693", "merged": true, "mergeCommit": {"oid": "acf16ebe6dc69e5d8c823797a8da402ef932cc18"}, "closed": true, "closedAt": "2020-06-07T04:16:43Z", "author": {"login": "samuelcambien"}, "timelineItems": {"totalCount": 12, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcIETx1AH2gAyMzgwMTQ3NjM1OjMwMWM0OTMyY2E2MmNjZGY1ZmY2NDVjMmI1MjQ3NzQxZGE1NzhlMWM=", "endCursor": "Y3Vyc29yOnYyOpPPAAABce6CotgH2gAyMzgwMTQ3NjM1OjQ3Y2YxMTAyNzllODBkYWE2OGMwYTI5ZDY0MDk2M2M1MzA4YzY4NzA=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "301c4932ca62ccdf5ff645c2b5247741da578e1c", "author": {"user": null}, "url": "https://github.com/DSpace/DSpace/commit/301c4932ca62ccdf5ff645c2b5247741da578e1c", "committedDate": "2020-02-26T10:38:42Z", "message": "DS-4440 GDPR - Anonymize statistics feature"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzcwMjcxNTU4", "url": "https://github.com/DSpace/DSpace/pull/2693#pullrequestreview-370271558", "createdAt": "2020-03-06T11:58:44Z", "commit": {"oid": "301c4932ca62ccdf5ff645c2b5247741da578e1c"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wNlQxMTo1ODo0NVrOFy2YqA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wNlQxMTo1ODo0NVrOFy2YqA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4ODg2NDE2OA==", "bodyText": "This looks like a typo to me. Shouldn't that be org.dspace.statistics.AnonymizeStatistics? ( pnb )", "url": "https://github.com/DSpace/DSpace/pull/2693#discussion_r388864168", "createdAt": "2020-03-06T11:58:45Z", "author": {"login": "ssolim"}, "path": "dspace/config/launcher.xml", "diffHunk": "@@ -380,4 +380,11 @@\n             <class>org.dspace.app.util.Version</class>\n         </step>\n     </command>\n+    <command>\n+        <name>anonymize-statistics</name>\n+        <description>Anonymize the ip values of the solr statistics</description>\n+        <step>\n+            <class>com.atmire.dspace.statistics.AnonymizeStatistics</class>", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "301c4932ca62ccdf5ff645c2b5247741da578e1c"}, "originalPosition": 8}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d9b3e465e5be328fd2314dbe9ced45ced3548f41", "author": {"user": null}, "url": "https://github.com/DSpace/DSpace/commit/d9b3e465e5be328fd2314dbe9ced45ced3548f41", "committedDate": "2020-03-10T17:57:01Z", "message": "DS-4440 GDPR - Anonymize statistics feature - feedback"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzg5NjE0Njgw", "url": "https://github.com/DSpace/DSpace/pull/2693#pullrequestreview-389614680", "createdAt": "2020-04-08T02:33:02Z", "commit": {"oid": "d9b3e465e5be328fd2314dbe9ced45ced3548f41"}, "state": "COMMENTED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzg5NzM0MTc3", "url": "https://github.com/DSpace/DSpace/pull/2693#pullrequestreview-389734177", "createdAt": "2020-04-08T07:55:27Z", "commit": {"oid": "d9b3e465e5be328fd2314dbe9ced45ced3548f41"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "245ef2f95c06e03f6f951a734c559c411e2c36d0", "author": {"user": {"login": "samuelcambien", "name": "Samuel Cambien (Atmire)"}}, "url": "https://github.com/DSpace/DSpace/commit/245ef2f95c06e03f6f951a734c559c411e2c36d0", "committedDate": "2020-04-09T12:52:51Z", "message": "DS-4440 GDPR - Anonymize statistics feature - feedback: default configuration & spelling"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b0088af73f50271d846113136c4922601939dd10", "author": {"user": {"login": "samuelcambien", "name": "Samuel Cambien (Atmire)"}}, "url": "https://github.com/DSpace/DSpace/commit/b0088af73f50271d846113136c4922601939dd10", "committedDate": "2020-04-09T12:59:08Z", "message": "DS-4440 GDPR - Anonymize statistics feature - feedback: default configuration & spelling bis"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "8a19dc3cb7906d8b10b5d6eb9a0253b5bb969f9b", "author": {"user": {"login": "samuelcambien", "name": "Samuel Cambien (Atmire)"}}, "url": "https://github.com/DSpace/DSpace/commit/8a19dc3cb7906d8b10b5d6eb9a0253b5bb969f9b", "committedDate": "2020-04-09T12:59:56Z", "message": "DS-4440 GDPR - Anonymize statistics feature - feedback: default configuration & spelling tris"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzk3OTUxNDE4", "url": "https://github.com/DSpace/DSpace/pull/2693#pullrequestreview-397951418", "createdAt": "2020-04-22T08:18:09Z", "commit": {"oid": "8a19dc3cb7906d8b10b5d6eb9a0253b5bb969f9b"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzk4Njg2NzM5", "url": "https://github.com/DSpace/DSpace/pull/2693#pullrequestreview-398686739", "createdAt": "2020-04-23T00:48:25Z", "commit": {"oid": "8a19dc3cb7906d8b10b5d6eb9a0253b5bb969f9b"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzk5MDYwNzUx", "url": "https://github.com/DSpace/DSpace/pull/2693#pullrequestreview-399060751", "createdAt": "2020-04-23T12:43:58Z", "commit": {"oid": "8a19dc3cb7906d8b10b5d6eb9a0253b5bb969f9b"}, "state": "COMMENTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yM1QxMjo0Mzo1OFrOGKnVbQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yM1QxMjo1Njo1MVrOGKn5dQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMzc4MzQwNQ==", "bodyText": "There are two superfluous quotes at the end of the two mask options.", "url": "https://github.com/DSpace/DSpace/pull/2693#discussion_r413783405", "createdAt": "2020-04-23T12:43:58Z", "author": {"login": "AlexanderS"}, "path": "dspace/config/modules/usage-statistics.cfg", "diffHunk": "@@ -40,4 +40,21 @@ usage-statistics.authorization.admin.workflow=true\n \n # Enable/disable if a matching for a bot should be case sensitive\n # Setting this value to true will increase cpu usage, but bots will be found more accurately\n-#usage-statistics.bots.case-insensitive = false\n\\ No newline at end of file\n+#usage-statistics.bots.case-insensitive = false\n+\n+# Configuration parameters for anonymizing statistics\n+\n+# Anonymize statistics the moment they are created\n+# anonymize_statistics.anonymize_on_log = false\n+\n+# Mask to replace the last group of an IPv4 address\n+# anonymize_statistics.ip_v4_mask = 255\"\n+\n+# Mask to replace the last two groups of an IPv6 address\n+# anonymize_statistics.ip_v6_mask = FFFF:FFFF\"", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "8a19dc3cb7906d8b10b5d6eb9a0253b5bb969f9b"}, "originalPosition": 17}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMzc5MjYyOQ==", "bodyText": "The space before the config settings with the default values should be removed, so that there is a difference between comments and default config values.", "url": "https://github.com/DSpace/DSpace/pull/2693#discussion_r413792629", "createdAt": "2020-04-23T12:56:51Z", "author": {"login": "AlexanderS"}, "path": "dspace/config/modules/usage-statistics.cfg", "diffHunk": "@@ -40,4 +40,21 @@ usage-statistics.authorization.admin.workflow=true\n \n # Enable/disable if a matching for a bot should be case sensitive\n # Setting this value to true will increase cpu usage, but bots will be found more accurately\n-#usage-statistics.bots.case-insensitive = false\n\\ No newline at end of file\n+#usage-statistics.bots.case-insensitive = false\n+\n+# Configuration parameters for anonymizing statistics\n+\n+# Anonymize statistics the moment they are created\n+# anonymize_statistics.anonymize_on_log = false", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "8a19dc3cb7906d8b10b5d6eb9a0253b5bb969f9b"}, "originalPosition": 11}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "47cf110279e80daa68c0a29d640963c5308c6870", "author": {"user": {"login": "samuelcambien", "name": "Samuel Cambien (Atmire)"}}, "url": "https://github.com/DSpace/DSpace/commit/47cf110279e80daa68c0a29d640963c5308c6870", "committedDate": "2020-05-07T09:41:11Z", "message": "DS-4440 GDPR - Anonymize statistics feature - feedback: default configuration"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1638, "cost": 1, "resetAt": "2021-11-01T13:51:04Z"}}}