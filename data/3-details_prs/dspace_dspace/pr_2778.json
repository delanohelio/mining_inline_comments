{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDMyMzY3NTk3", "number": 2778, "title": "Pre authorize annotations for subresources", "bodyText": "References\nAdd references/links to any related tickets or PRs. These may include:\n\nLink to initial REST implementation\n\nDescription\nWhen including a subresource, e.g. via embedding, the permissions of the subresources will now be verified based on the @PreAuthorize setting of the findOne() method.\nThe default @PreAuthorize on the abstract findOne() method has been set to @PreAuthorize(\"hasAuthority('ADMIN')\").\nInstructions for Reviewers\nThe ConverterService will now use the @PreAuthorize to determine whether a resource can be embedded. It will automatically replace the #id in the annotation with the object's ID (but the syntax should be #id)\nThe ITs were already included in #2726, they still verify that the permissions are enforced on the subresources.\nSome PermissionEvaluatorPlugins which were required for #2726 have been removed again because the permissions can now be retrieved from the findOne() method\nSince there was a conflict on the permissions of the AuthorizationFeatureRest (sometimes anonymous and sometimes admin), this has been adjusted here as well\nChecklist\nThis checklist provides a reminder of what we are going to look for when reviewing your PR. You need not complete this checklist prior to creating your PR (draft PRs are always welcome). If you are unsure about an item in the checklist, don't hesitate to ask. We're here to help!\n\n My PR is small in size (e.g. less than 1,000 lines of code, not including comments & integration tests). Exceptions may be made if previously agreed upon.\n My PR passes Checkstyle validation based on the Code Style Guide.\n My PR includes Javadoc for all new (or modified) public methods and classes. It also includes Javadoc for large or complex private methods.\n My PR passes all tests and includes new/updated Unit or Integration Tests based on the Code Testing Guide.\n If my PR includes new, third-party dependencies (in any pom.xml), I've made sure their licenses align with the DSpace BSD License based on the Licensing of Contributions documentation.\n If my PR modifies the REST API, I've linked to the REST Contract page (or open PR) related to this change.", "createdAt": "2020-06-10T10:40:45Z", "url": "https://github.com/DSpace/DSpace/pull/2778", "merged": true, "mergeCommit": {"oid": "124117c16940a0bfb895a589467bd49a3dd8711f"}, "closed": true, "closedAt": "2020-06-18T16:14:31Z", "author": {"login": "benbosman"}, "timelineItems": {"totalCount": 13, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABclVLJsAH2gAyNDMyMzY3NTk3OmVlMTIwYjQxNWY4ZGUyYTQ3OGViZWE1MGUwNzk1YTczNTJkNmJhMTA=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcsgBHkAH2gAyNDMyMzY3NTk3OjU1OTAwMWNmNDMxYTk4N2VlMDM1NjNjMzkyMDAzMTk1ZjE0MWJhZjg=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "ee120b415f8de2a478ebea50e0795a7352d6ba10", "author": {"user": {"login": "Raf-atmire", "name": null}}, "url": "https://github.com/DSpace/DSpace/commit/ee120b415f8de2a478ebea50e0795a7352d6ba10", "committedDate": "2020-05-27T08:41:28Z", "message": "[Task 71143] initial implementation of the preauthorize annotations in the converterservice"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e068abb87fe2f23f63571c335686edb859ca9c28", "author": {"user": {"login": "Raf-atmire", "name": null}}, "url": "https://github.com/DSpace/DSpace/commit/e068abb87fe2f23f63571c335686edb859ca9c28", "committedDate": "2020-05-27T08:43:31Z", "message": "undo unnecessary changes"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "6c0ee98fa616ea63af7aa68f6a500f7ef25be780", "author": {"user": {"login": "Raf-atmire", "name": null}}, "url": "https://github.com/DSpace/DSpace/commit/6c0ee98fa616ea63af7aa68f6a500f7ef25be780", "committedDate": "2020-06-02T12:56:00Z", "message": "SPEL parsing of the preAuthorize annotation in converterService work"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "397a156186f33333e83e16bebb3b3940761fe5e7", "author": {"user": {"login": "Raf-atmire", "name": null}}, "url": "https://github.com/DSpace/DSpace/commit/397a156186f33333e83e16bebb3b3940761fe5e7", "committedDate": "2020-06-05T11:56:39Z", "message": "[Task 71143] Intermediate work on PreAuthorize annotation parsing"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "49d40598f0e2ca26f3683128852887c970ee8046", "author": {"user": {"login": "Raf-atmire", "name": null}}, "url": "https://github.com/DSpace/DSpace/commit/49d40598f0e2ca26f3683128852887c970ee8046", "committedDate": "2020-06-08T11:04:59Z", "message": "[Task 71143] implemented the PreAuthorize check in ConverterService for the findOne of a BaseObjectRest when the toRest method is called"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "7be092813903c4e59f27109fd6702e5d281a1966", "author": {"user": {"login": "Raf-atmire", "name": null}}, "url": "https://github.com/DSpace/DSpace/commit/7be092813903c4e59f27109fd6702e5d281a1966", "committedDate": "2020-06-08T13:12:40Z", "message": "[Task 71143] fixed checkstyle"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "4a40b8d1028aaa37f712fd53243696650a99763b", "author": {"user": {"login": "Raf-atmire", "name": null}}, "url": "https://github.com/DSpace/DSpace/commit/4a40b8d1028aaa37f712fd53243696650a99763b", "committedDate": "2020-06-09T07:25:06Z", "message": "[Task 71308] applied feedback to the PreAuthorize parsing in converterService feature"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "faef05258a60e04bfcdaed9d8e81a0ec266b4a29", "author": {"user": {"login": "Raf-atmire", "name": null}}, "url": "https://github.com/DSpace/DSpace/commit/faef05258a60e04bfcdaed9d8e81a0ec266b4a29", "committedDate": "2020-06-10T09:51:44Z", "message": "[Task 71335] removed unneeded PermissionEvaluatorPlugins and changed PreAuthorize annotations where necessary"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "56629fd34e82b9a29ada8b65a7b1a41557b99f7f", "author": {"user": {"login": "Raf-atmire", "name": null}}, "url": "https://github.com/DSpace/DSpace/commit/56629fd34e82b9a29ada8b65a7b1a41557b99f7f", "committedDate": "2020-06-10T09:53:24Z", "message": "[Task 71335] removed wrongly added preAuthorize on bitstreamFormatRestRepository#findAll"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "5f44fe11f7da5885f7f6f285fac23fd3a5c2605e", "author": {"user": {"login": "Raf-atmire", "name": null}}, "url": "https://github.com/DSpace/DSpace/commit/5f44fe11f7da5885f7f6f285fac23fd3a5c2605e", "committedDate": "2020-06-10T11:50:17Z", "message": "Undo findall preauthorize annotation change on AuthorizationFeatureRestRepository"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDMzMzEzMDM1", "url": "https://github.com/DSpace/DSpace/pull/2778#pullrequestreview-433313035", "createdAt": "2020-06-18T14:00:15Z", "commit": {"oid": "5f44fe11f7da5885f7f6f285fac23fd3a5c2605e"}, "state": "APPROVED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xOFQxNDowMDoxNlrOGlwttw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xOFQxNDowMDoxNlrOGlwttw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MjI0ODYzMQ==", "bodyText": "this should be possible now\nsee https://github.com/DSpace/DSpace/pull/2778/files#diff-311a7e07c257d9c869f4de1347f5f761R51", "url": "https://github.com/DSpace/DSpace/pull/2778#discussion_r442248631", "createdAt": "2020-06-18T14:00:16Z", "author": {"login": "abollini"}, "path": "dspace-server-webapp/src/test/java/org/dspace/app/rest/AuthorizationRestRepositoryIT.java", "diffHunk": "@@ -804,6 +805,11 @@ public void findByObjectInternalServerErrorTest() throws Exception {\n      * \n      * @throws Exception\n      */\n+    // This test currently doesn't work as expected since the AuthorizationFeatureRestRepository#findOne method\n+    // is only exposed to admins. Currently we're performing checks on the individual REST objects with its findOne\n+    // Permission constraints, which is ADMIN in this case. Seeing as we're trying to retrieve it with a normal\n+    // EPerson token in the second test, this will fail.\n+    @Ignore", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "5f44fe11f7da5885f7f6f285fac23fd3a5c2605e"}, "originalPosition": 16}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "8172dd5fb0688ef2539af96b5a470b6187a4f937", "author": {"user": {"login": "benbosman", "name": null}}, "url": "https://github.com/DSpace/DSpace/commit/8172dd5fb0688ef2539af96b5a470b6187a4f937", "committedDate": "2020-06-18T15:05:31Z", "message": "Re-enable findByObjectAndFeatureTest\n\nThe findByObjectAndFeatureTest can be used again thanks to https://github.com/DSpace/DSpace/pull/2778/files#diff-311a7e07c257d9c869f4de1347f5f761R51"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "559001cf431a987ee03563c392003195f141baf8", "author": {"user": {"login": "benbosman", "name": null}}, "url": "https://github.com/DSpace/DSpace/commit/559001cf431a987ee03563c392003195f141baf8", "committedDate": "2020-06-18T15:16:56Z", "message": "Removing unused import"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1489, "cost": 1, "resetAt": "2021-11-01T13:51:04Z"}}}