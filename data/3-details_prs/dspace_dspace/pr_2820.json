{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDQzNTA4OTY1", "number": 2820, "title": "Curation tasks using the scripts and processes functionality", "bodyText": "References\nAdd references/links to any related tickets or PRs.\n\nLink to Scripts and processes REST Contract -> There is no explicit rest contract for the curation tasks implementation\nLink to Curation Tasks documentation\n\nDescription\nThis PR adds in the functionality of the curation tasks to the recently merged scripts and processes functionality.\nDocumentation on the curation task can be found above.\nInstructions for Reviewers\nList of changes in this PR:\n\nThe curation tasks process has been moved to the scripts.xml config\nCurationCli has been made a DSpaceRunnable\nConfiguration of the script can be found in CurationClientOptions\nAt present, all curation tasks are admin only (Which is checked in the CurationScriptConfiguration)\n\nStarting a curation task can be done by performing a POST request on the endpoint\n\n/api/system/scripts/curate/processes\n\nAll parameter values should be provided in the body that has to use the multipart/form-data content type.\nThe simples of this is with a properties parameter, than contains JSON with the required options, ie the following properties will start the 'noop' curation task(-t) for the provided eperson(-e) and handle (-i)\n  {\n    \"name\": \"-e\",\n    \"value\": \"atmirenv@gmail.com\"\n  },\n  {\n    \"name\": \"-t\",\n    \"value\":\"noop\"\n  },\n  {\n    \"name\": \"-i\",\n    \"value\":\"123456789/8\"\n  }\n]\n\nWhen using the '-T' option, this allows the code to handle a text file containing a list of tasknames to be performed. (An example which is also used in the IT can be found here\nNote:\nCurationScriptIT at present does not yet contain the check to see if calling the 'noop' task actually ends up on (This IS logged in the dspace logs, but not explicitly returned as a particular status, apart from the scripts and processes returning the properties that have been sent to the endpoint, but that is not a marker to see if it has been executed or not)\nWe need to investigate to properly and cleanly mock the 'NoOpCurationTask' (In combination with the autowiring that is being done in the class), after which we can verify if the 'perform' method has been called correctly.\nChecklist\nThis checklist provides a reminder of what we are going to look for when reviewing your PR. You need not complete this checklist prior to creating your PR (draft PRs are always welcome). If you are unsure about an item in the checklist, don't hesitate to ask. We're here to help!\n\n My PR is small in size (e.g. less than 1,000 lines of code, not including comments & integration tests). Exceptions may be made if previously agreed upon.\n My PR passes Checkstyle validation based on the Code Style Guide.\n My PR includes Javadoc for all new (or modified) public methods and classes. It also includes Javadoc for large or complex private methods.\n My PR passes all tests and includes new/updated Unit or Integration Tests based on the Code Testing Guide.\n If my PR includes new, third-party dependencies (in any pom.xml), I've made sure their licenses align with the DSpace BSD License based on the Licensing of Contributions documentation.\n If my PR modifies the REST API, I've linked to the REST Contract page (or open PR) related to this change.", "createdAt": "2020-07-02T13:13:57Z", "url": "https://github.com/DSpace/DSpace/pull/2820", "merged": true, "mergeCommit": {"oid": "1301e43ceeacebc94bbcaed4c1297607d82ae64a"}, "closed": true, "closedAt": "2020-07-31T19:14:14Z", "author": {"login": "jonas-atmire"}, "timelineItems": {"totalCount": 13, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcwq_2WAH2gAyNDQzNTA4OTY1OmEyZGUzYzY4MmU1YjI1N2RhMzE5YmRmYjY3YWMzMTc2OWQ1Yjg0MGM=", "endCursor": "Y3Vyc29yOnYyOpPPAAABc6W8trgFqTQ1OTMxMDMzMw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "a2de3c682e5b257da319bdfb67ac31769d5b840c", "author": {"user": {"login": "MarieVerdonck", "name": "Marie Verdonck"}}, "url": "https://github.com/DSpace/DSpace/commit/a2de3c682e5b257da319bdfb67ac31769d5b840c", "committedDate": "2020-07-01T14:20:12Z", "message": "71513: curation script to DSpaceRunnable"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "107a19e909b96621ad25af652b73149b6a5e2310", "author": {"user": {"login": "MarieVerdonck", "name": "Marie Verdonck"}}, "url": "https://github.com/DSpace/DSpace/commit/107a19e909b96621ad25af652b73149b6a5e2310", "committedDate": "2020-07-01T14:20:12Z", "message": "71513: small fix and script call name change"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "351363b79eca7b2b5e819e2efeea1c3f124298dc", "author": {"user": {"login": "MarieVerdonck", "name": "Marie Verdonck"}}, "url": "https://github.com/DSpace/DSpace/commit/351363b79eca7b2b5e819e2efeea1c3f124298dc", "committedDate": "2020-07-01T14:20:12Z", "message": "71513: spelling"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "79c317154ef435613efbd70b24c0a277ce3a35ad", "author": {"user": {"login": "MarieVerdonck", "name": "Marie Verdonck"}}, "url": "https://github.com/DSpace/DSpace/commit/79c317154ef435613efbd70b24c0a277ce3a35ad", "committedDate": "2020-07-01T14:20:12Z", "message": "71513: ITs for curate script"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "85e31825cc6ab6890bf6825c5424a5f332ca000d", "author": {"user": {"login": "MarieVerdonck", "name": "Marie Verdonck"}}, "url": "https://github.com/DSpace/DSpace/commit/85e31825cc6ab6890bf6825c5424a5f332ca000d", "committedDate": "2020-07-01T14:20:12Z", "message": "71513: test fix from adding curate script to test script definitions"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "9ef83bf185a2270661bc25378044ca5d8cdcc239", "author": {"user": {"login": "MarieVerdonck", "name": "Marie Verdonck"}}, "url": "https://github.com/DSpace/DSpace/commit/9ef83bf185a2270661bc25378044ca5d8cdcc239", "committedDate": "2020-07-01T14:20:12Z", "message": "71513: -i valid dso or all check + test &\nfix so that -t plugin-key instead of entire config &\nAdded test voor noop curate output"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a437cf41c3ec3488d9d7516045c41d484e3f5489", "author": {"user": {"login": "MarieVerdonck", "name": "Marie Verdonck"}}, "url": "https://github.com/DSpace/DSpace/commit/a437cf41c3ec3488d9d7516045c41d484e3f5489", "committedDate": "2020-07-01T14:20:12Z", "message": "missing license"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e7b33c5fb5bca314384c97088ea43a4dbd93cf6c", "author": {"user": {"login": "MarieVerdonck", "name": "Marie Verdonck"}}, "url": "https://github.com/DSpace/DSpace/commit/e7b33c5fb5bca314384c97088ea43a4dbd93cf6c", "committedDate": "2020-07-01T15:53:06Z", "message": "71629: fix testCurate_NoOpTask"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "fec04568ffcf761777702144ba47007293b39fb0", "author": {"user": {"login": "MarieVerdonck", "name": "Marie Verdonck"}}, "url": "https://github.com/DSpace/DSpace/commit/fec04568ffcf761777702144ba47007293b39fb0", "committedDate": "2020-07-02T13:49:18Z", "message": "71629: checkstyle & removed unused annotations"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": null, "afterCommit": {"oid": "fec04568ffcf761777702144ba47007293b39fb0", "author": {"user": {"login": "MarieVerdonck", "name": "Marie Verdonck"}}, "url": "https://github.com/DSpace/DSpace/commit/fec04568ffcf761777702144ba47007293b39fb0", "committedDate": "2020-07-02T13:49:18Z", "message": "71629: checkstyle & removed unused annotations"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDUxOTk0MDk2", "url": "https://github.com/DSpace/DSpace/pull/2820#pullrequestreview-451994096", "createdAt": "2020-07-20T22:10:07Z", "commit": {"oid": "fec04568ffcf761777702144ba47007293b39fb0"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yMFQyMjoxMDowN1rOG0hBBw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yMFQyMjoxMDowN1rOG0hBBw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NzcyMDA3MQ==", "bodyText": "This should have a comment to explain it.  Something like:\n# Ensure list of Curation Tasks (defined above) is available via the REST API /api/config/properties endpoint\nUPDATE:  I'm also realizing that this curate.cfg file needs more updates.  It looks like we no longer need the curate.ui.* settings in this file (they likely can be removed entirely as they are not needed in DSpace/dspace-angular#799).   Additionally, we should update the list of plugin.named.org.dspace.curate.CurationTask to comment out those tasks which are normally NOT enabled by default.  As in DSpace v6.x, there should only be 3 default tasks enabled... profileformats, requiredmetadata, and checklinks.  You could leave noop uncommented, but both vscan and translate should be commented out as they require additional configuration to work correctly.\nUPDATE 2:  I'm also now wondering where this plugin.named.org.dspace.curate.CurationTask setting is being used from the REST API.  After reviewing DSpace/dspace-angular#799, it looks like it is NOT used there.  So, we may be able to simply remove this new rest.properties.exposed line altogether. But, I still think we should comment out the vscan and translate tasks by default, so they are not runnable from REST API until configured.", "url": "https://github.com/DSpace/DSpace/pull/2820#discussion_r457720071", "createdAt": "2020-07-20T22:10:07Z", "author": {"login": "tdonohue"}, "path": "dspace/config/modules/curate.cfg", "diffHunk": "@@ -52,3 +52,6 @@ curate.ui.statusmessages = \\\n      2 = Skip, \\\n      other = Invalid Status\n \n+\n+rest.properties.exposed = plugin.named.org.dspace.curate.CurationTask", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "fec04568ffcf761777702144ba47007293b39fb0"}, "originalPosition": 5}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "7a269f3460525eb6395af4b1a71fa3a91aafbb0b", "author": {"user": {"login": "jonas-atmire", "name": "Jonas Van Goolen"}}, "url": "https://github.com/DSpace/DSpace/commit/7a269f3460525eb6395af4b1a71fa3a91aafbb0b", "committedDate": "2020-07-23T08:00:51Z", "message": "Curate.cfg properties cleanup based on PR feedback - https://github.com/DSpace/DSpace/pull/2820"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDU5MzEwMzMz", "url": "https://github.com/DSpace/DSpace/pull/2820#pullrequestreview-459310333", "createdAt": "2020-07-31T16:37:55Z", "commit": {"oid": "7a269f3460525eb6395af4b1a71fa3a91aafbb0b"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1516, "cost": 1, "resetAt": "2021-11-01T13:51:04Z"}}}