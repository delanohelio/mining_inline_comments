{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTEyODE5NjU5", "number": 3036, "title": "support CSV import to schema \"person\"", "bodyText": "References\n\nFixes #3006\n\nDescription\nThis PR adds a fix to the DSpaceCSV.java class to make it possible to better distinguish a normal \"person\" metadata field from an authority field.\nAny field that doesn't start with [AUTHORITY_TYPE] is now treated as a regular field without the chance of it being detected as an authorityType, we made sure that this only happens if the String is surrounded by brackets.\nInstructions for Reviewers\nList of changes in this PR:\n\nMade sure that the AuthorityType evaluating is only done for Strings between brackets\nAdded test to ensure that the CSV import with person metadata works now\n\nHow to test this PR:\n\nMake a CSV with a person.birthDate metadata field in it with a value\nImport the CSV and verify that the person.birthDate is added to the imported Item\n\nChecklist\n\n My PR is small in size (e.g. less than 1,000 lines of code, not including comments & integration tests). Exceptions may be made if previously agreed upon.\n My PR passes Checkstyle validation based on the Code Style Guide.\n My PR includes Javadoc for all new (or modified) public methods and classes. It also includes Javadoc for large or complex private methods.\n My PR passes all tests and includes new/updated Unit or Integration Tests based on the Code Testing Guide.\n If my PR includes new, third-party dependencies (in any pom.xml), I've made sure their licenses align with the DSpace BSD License based on the Licensing of Contributions documentation.\n If my PR modifies the REST API, I've linked to the REST Contract page (or open PR) related to this change.", "createdAt": "2020-10-30T07:43:41Z", "url": "https://github.com/DSpace/DSpace/pull/3036", "merged": true, "mergeCommit": {"oid": "4b49095ff9837b1a7de35ac9573027549b6ae08b"}, "closed": true, "closedAt": "2020-11-19T14:50:17Z", "author": {"login": "Raf-atmire"}, "timelineItems": {"totalCount": 13, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABc0eTRogH2gAyNTEyODE5NjU5OmY0OTI0MTViY2MzNjg2MjhiM2VmM2QyMTZjMmQ4YjRkMTEyZGM3NmE=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdd-taEgH2gAyNTEyODE5NjU5OjAzYzIxZGUwZWIwNjRiZTYzNTAyNjk5YzAyNjU5MTFhN2U2OTMyMDA=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "f492415bcc368628b3ef3d216c2d8b4d112dc76a", "author": {"user": {"login": "Raf-atmire", "name": null}}, "url": "https://github.com/DSpace/DSpace/commit/f492415bcc368628b3ef3d216c2d8b4d112dc76a", "committedDate": "2020-07-13T09:48:21Z", "message": "[Task 71780] added support for the person schema in the csv import and added a test for it"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f71a6ee5d5148b2e3299c7eeea666a6d0559b7fd", "author": {"user": {"login": "benbosman", "name": null}}, "url": "https://github.com/DSpace/DSpace/commit/f71a6ee5d5148b2e3299c7eeea666a6d0559b7fd", "committedDate": "2020-10-14T12:21:51Z", "message": "Merge remote-tracking branch 'community/main' into w2p-71780_support-csv-import-person-schema\n\n# Conflicts:\n#\tdspace-api/src/test/java/org/dspace/app/bulkedit/MetadataImportTest.java"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "86ddfc205c7f41abf36e7aa17934988a543331b6", "author": {"user": {"login": "Raf-atmire", "name": null}}, "url": "https://github.com/DSpace/DSpace/commit/86ddfc205c7f41abf36e7aa17934988a543331b6", "committedDate": "2020-10-26T10:37:45Z", "message": "Merge remote-tracking branch 'dspace/main' into w2p-71780_support-csv-import-person-schema"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "2cbbbf95b3115ae605a96639a65b2f080026a991", "author": {"user": {"login": "Raf-atmire", "name": null}}, "url": "https://github.com/DSpace/DSpace/commit/2cbbbf95b3115ae605a96639a65b2f080026a991", "committedDate": "2020-10-26T12:27:47Z", "message": "Rewriting MetadataImportTest with builders"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "6c8eb146a65f1aa27c52f563f3c6b5646617c89a", "author": {"user": {"login": "Raf-atmire", "name": null}}, "url": "https://github.com/DSpace/DSpace/commit/6c8eb146a65f1aa27c52f563f3c6b5646617c89a", "committedDate": "2020-11-12T10:07:40Z", "message": "Merge remote-tracking branch 'dspace/main' into w2p-71780_support-csv-import-person-schema"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ca653ea0b55bb60bf3a5e688633f44f8a58825bc", "author": {"user": {"login": "Raf-atmire", "name": null}}, "url": "https://github.com/DSpace/DSpace/commit/ca653ea0b55bb60bf3a5e688633f44f8a58825bc", "committedDate": "2020-11-12T10:11:23Z", "message": "Merge remote-tracking branch 'dspace/main' into w2p-71780_support-csv-import-person-schema\n\nConflicts:\n\tdspace-api/src/test/java/org/dspace/app/bulkedit/MetadataImportTest.java"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTMyNTAwODQ5", "url": "https://github.com/DSpace/DSpace/pull/3036#pullrequestreview-532500849", "createdAt": "2020-11-17T15:39:08Z", "commit": {"oid": "ca653ea0b55bb60bf3a5e688633f44f8a58825bc"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xN1QxNTozOTowOFrOH07X1w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xN1QxNTozOTowOFrOH07X1w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNTI2MDc1OQ==", "bodyText": "@Raf-atmire : This test file does not appear to be used anywhere?  Am I misunderstanding how/where this configuration is used?  I'd expect it to appear in one of our IT classes.", "url": "https://github.com/DSpace/DSpace/pull/3036#discussion_r525260759", "createdAt": "2020-11-17T15:39:08Z", "author": {"login": "tdonohue"}, "path": "dspace-api/src/test/resources/test-config.properties", "diffHunk": "@@ -13,3 +13,4 @@ test.folder = ./target/testing/\n test.bitstream = ./target/testing/dspace/assetstore/ConstitutionofIreland.pdf\n test.exportcsv = ./target/testing/dspace/assetstore/test.csv\n test.importcsv = ./target/testing/dspace/assetstore/testImport.csv\n+test.importpersoncsv = ./target/testing/dspace/assetstore/testImportPerson.csv", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ca653ea0b55bb60bf3a5e688633f44f8a58825bc"}, "originalPosition": 4}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "86d39a92f74f1e4d43008d139ae7940a05de46a1", "author": {"user": {"login": "Raf-atmire", "name": null}}, "url": "https://github.com/DSpace/DSpace/commit/86d39a92f74f1e4d43008d139ae7940a05de46a1", "committedDate": "2020-11-18T12:54:56Z", "message": "Re-added personMetadataImportTest in MetadataImportIT and deleted unused test params"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTMzNTEyNTcx", "url": "https://github.com/DSpace/DSpace/pull/3036#pullrequestreview-533512571", "createdAt": "2020-11-18T14:40:16Z", "commit": {"oid": "86d39a92f74f1e4d43008d139ae7940a05de46a1"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTMzODUxNzg2", "url": "https://github.com/DSpace/DSpace/pull/3036#pullrequestreview-533851786", "createdAt": "2020-11-18T20:32:40Z", "commit": {"oid": "86d39a92f74f1e4d43008d139ae7940a05de46a1"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTMzODUzNDU0", "url": "https://github.com/DSpace/DSpace/pull/3036#pullrequestreview-533853454", "createdAt": "2020-11-18T20:34:58Z", "commit": {"oid": "86d39a92f74f1e4d43008d139ae7940a05de46a1"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xOFQyMDozNDo1OFrOH2BGjA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xOFQyMDozNDo1OFrOH2BGjA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNjQwMzIxMg==", "bodyText": "Tiny thing I just realized.  You likely can simplify this line to be itemService.delete(context, importedItem);  I don't think you should need the itemService.find() here...unless I'm missing something.\nIn any case, this is extremely minor. The code overall is good.", "url": "https://github.com/DSpace/DSpace/pull/3036#discussion_r526403212", "createdAt": "2020-11-18T20:34:58Z", "author": {"login": "tdonohue"}, "path": "dspace-api/src/test/java/org/dspace/app/bulkedit/MetadataImportIT.java", "diffHunk": "@@ -152,6 +152,22 @@ public void relationshipMetadataImporAlreadyExistingItemTest() throws Exception\n \n     }\n \n+    @Test\n+    public void personMetadataImportTest() throws Exception {\n+\n+        String[] csv = {\"id,collection,dc.title,person.birthDate\",\n+            \"+,\" + collection.getHandle() + \",\\\"Test Import 2\\\",\" + \"2000\"};\n+        performImportScript(csv);\n+        Item importedItem = findItemByName(\"Test Import 2\");\n+        assertTrue(\n+            StringUtils.equals(\n+                itemService.getMetadata(importedItem, \"person\", \"birthDate\", null, Item.ANY)\n+                           .get(0).getValue(), \"2000\"));\n+        context.turnOffAuthorisationSystem();\n+        itemService.delete(context, itemService.find(context, importedItem.getID()));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "86d39a92f74f1e4d43008d139ae7940a05de46a1"}, "originalPosition": 16}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c442545fc136ae438f64e9af37fbe912257aaa0e", "author": {"user": {"login": "Raf-atmire", "name": null}}, "url": "https://github.com/DSpace/DSpace/commit/c442545fc136ae438f64e9af37fbe912257aaa0e", "committedDate": "2020-11-19T08:44:19Z", "message": "Merge remote-tracking branch 'dspace/main' into w2p-71780_support-csv-import-person-schema\n\nConflicts:\n\tdspace-api/src/test/java/org/dspace/app/bulkedit/MetadataImportIT.java"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "03c21de0eb064be63502699c0265911a7e693200", "author": {"user": {"login": "Raf-atmire", "name": null}}, "url": "https://github.com/DSpace/DSpace/commit/03c21de0eb064be63502699c0265911a7e693200", "committedDate": "2020-11-19T08:44:45Z", "message": "simplified itemservice.delete in MetadataImportIT"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1372, "cost": 1, "resetAt": "2021-11-01T13:51:04Z"}}}