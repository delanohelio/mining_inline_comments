{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0MzkyNjY2NDYx", "number": 2720, "title": "Upgrade backend to Spring Boot v2.2.6, Spring v5.2.5, Spring HATEOAS v1.0.3", "bodyText": "This PR resolves two GitHub security alerts (on master) by upgrading our dependencies to the following:\n\nSpring Boot v.2.2.6\nSpring v5.2.5\n\nThis includes the removal of MediaType.APPLICATION_JSON_UTF8 (in favor of just MediaType.APPLICATION_JSON), as JSON best practices are now to only have a generic media type.  See spring-projects/spring-framework#22788 (comment)\n\n\nSpring HATEOAS v1.0.3\n\nThe changes Spring HATEOAS in v1.0.x are quite large.  A lot of classes were moved around/renamed, and a few even removed (see release notes above). The majority of the code changes in this PR are related to Spring HATEOAS changes.\n\n\nSpring Security v5.3.1\nJetty v9 (to align with Spring)\nMockito v3.1.0 (again, alignment with Spring)\n\nThis PR also includes some minor refactoring of the Parent POM to reorganize/sort the <properties> section.  This is ready for early reviews, but additional testing is still in progress.", "createdAt": "2020-03-23T22:14:41Z", "url": "https://github.com/DSpace/DSpace/pull/2720", "merged": true, "mergeCommit": {"oid": "2cff30e59b3adcdeeff033b23ab0c57809a6d7f9"}, "closed": true, "closedAt": "2020-04-30T21:23:31Z", "author": {"login": "tdonohue"}, "timelineItems": {"totalCount": 26, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcQ4JD1gBqjMxNjEyNjYwMDY=", "endCursor": "Y3Vyc29yOnYyOpPPAAABccuSHfgFqTQwMzU5NzU4OQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "HeadRefForcePushedEvent", "beforeCommit": null, "afterCommit": null}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": null, "afterCommit": null}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": null, "afterCommit": null}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzk2MzE3Njc4", "url": "https://github.com/DSpace/DSpace/pull/2720#pullrequestreview-396317678", "createdAt": "2020-04-20T10:09:28Z", "commit": null, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yMFQxMDowOToyOFrOGINHYw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yMFQxMDowOToyOFrOGINHYw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMTI1NjY3NQ==", "bodyText": "Was there a specific reason to remove the \"StandardCharsets.UTF_8\" here ? Seems kind of strange to remove it.", "url": "https://github.com/DSpace/DSpace/pull/2720#discussion_r411256675", "createdAt": "2020-04-20T10:09:28Z", "author": {"login": "KevinVdV"}, "path": "dspace-server-webapp/src/test/java/org/dspace/app/rest/test/AbstractControllerIntegrationTest.java", "diffHunk": "@@ -80,7 +79,7 @@\n     public static final String BASE_REST_SERVER_URL = \"http://localhost\";\n \n     protected MediaType contentType = new MediaType(MediaTypes.HAL_JSON.getType(),\n-                                                    MediaTypes.HAL_JSON.getSubtype(), StandardCharsets.UTF_8);", "state": "SUBMITTED", "replyTo": null, "originalCommit": null, "originalPosition": 21}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "3d4eb91efb2686e9df923627a9eb86d9d8cbe400", "author": {"user": {"login": "tdonohue", "name": "Tim Donohue"}}, "url": "https://github.com/DSpace/DSpace/commit/3d4eb91efb2686e9df923627a9eb86d9d8cbe400", "committedDate": "2020-04-22T14:11:05Z", "message": "Upgrade Spring v5.2.4, Spring Boot v2.2.5, HAL Browser v3.2.5, Mockito 3.1.0"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "5420408c82ff6360c45720158a46fabbb9ce5bba", "author": {"user": {"login": "tdonohue", "name": "Tim Donohue"}}, "url": "https://github.com/DSpace/DSpace/commit/5420408c82ff6360c45720158a46fabbb9ce5bba", "committedDate": "2020-04-22T14:11:06Z", "message": "Updating code to Spring HATEOAS v1.0 compatibility"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "4503cf800bcf67d771f2575ce9b770c0324cd157", "author": {"user": {"login": "tdonohue", "name": "Tim Donohue"}}, "url": "https://github.com/DSpace/DSpace/commit/4503cf800bcf67d771f2575ce9b770c0324cd157", "committedDate": "2020-04-22T14:11:06Z", "message": "Fix compilation errors in Tests"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "79678710336d95fd9b9a90d6f202b1a5adfd9060", "author": {"user": {"login": "tdonohue", "name": "Tim Donohue"}}, "url": "https://github.com/DSpace/DSpace/commit/79678710336d95fd9b9a90d6f202b1a5adfd9060", "committedDate": "2020-04-22T14:11:06Z", "message": "Correct Spring Security version for REST API. Realign related dependencies"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "95e25f2fcc2db0cd9b95c6443889d038f61001bf", "author": {"user": {"login": "tdonohue", "name": "Tim Donohue"}}, "url": "https://github.com/DSpace/DSpace/commit/95e25f2fcc2db0cd9b95c6443889d038f61001bf", "committedDate": "2020-04-22T14:11:06Z", "message": "Pin version of Jetty to same version used in Solr. Update IT settings"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "32f5d62963783c234baea12ad499e185464b4727", "author": {"user": {"login": "tdonohue", "name": "Tim Donohue"}}, "url": "https://github.com/DSpace/DSpace/commit/32f5d62963783c234baea12ad499e185464b4727", "committedDate": "2020-04-22T14:11:06Z", "message": "Ensure getRel() always uses value() to obtain String value"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "48c5e6953f2874073c0c1402a906cf63355e55a2", "author": {"user": {"login": "tdonohue", "name": "Tim Donohue"}}, "url": "https://github.com/DSpace/DSpace/commit/48c5e6953f2874073c0c1402a906cf63355e55a2", "committedDate": "2020-04-22T14:11:07Z", "message": "Cleanup: Reorder/organize POM properties"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "5feeb89d1381ba3de27ffb86ff052558dc2d68dd", "author": {"user": {"login": "tdonohue", "name": "Tim Donohue"}}, "url": "https://github.com/DSpace/DSpace/commit/5feeb89d1381ba3de27ffb86ff052558dc2d68dd", "committedDate": "2020-04-22T14:11:07Z", "message": "Remove jsonpath from Parent POM dependencies. It strangely causes JSONPath `NoClassDefFoundError`s in Spring HATEOAS during runtime. Removing from Parent POM (but leaving in dspace-server-webapp) resolves those errors."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "967b9debd01442c87f4614051b72b8a55a1471c4", "author": {"user": {"login": "tdonohue", "name": "Tim Donohue"}}, "url": "https://github.com/DSpace/DSpace/commit/967b9debd01442c87f4614051b72b8a55a1471c4", "committedDate": "2020-04-22T14:11:07Z", "message": "Replacement for Identifiable interface, which was removed in Spring HATEOAS v1. Ensure any BaseObjectRest is referenced by identifier like previously."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "3804b358546b4b9e52dcd1efbc7091e8cce55661", "author": {"user": {"login": "tdonohue", "name": "Tim Donohue"}}, "url": "https://github.com/DSpace/DSpace/commit/3804b358546b4b9e52dcd1efbc7091e8cce55661", "committedDate": "2020-04-22T14:11:07Z", "message": "Checkstyle fixes"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c571e0927ac4581459bc48bd74cdc241956049ae", "author": {"user": {"login": "tdonohue", "name": "Tim Donohue"}}, "url": "https://github.com/DSpace/DSpace/commit/c571e0927ac4581459bc48bd74cdc241956049ae", "committedDate": "2020-04-22T14:11:07Z", "message": "Fix broken/incorrect mock statement"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "88855a8fe1caa9337217cf577566e8fc4f7da054", "author": {"user": {"login": "tdonohue", "name": "Tim Donohue"}}, "url": "https://github.com/DSpace/DSpace/commit/88855a8fe1caa9337217cf577566e8fc4f7da054", "committedDate": "2020-04-22T14:11:07Z", "message": "Minor update to recent code based on update to Spring Boot"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "9219657ede822bbda35fab68c74b7d2d029477b9", "author": {"user": {"login": "tdonohue", "name": "Tim Donohue"}}, "url": "https://github.com/DSpace/DSpace/commit/9219657ede822bbda35fab68c74b7d2d029477b9", "committedDate": "2020-04-22T14:11:07Z", "message": "Fix dependencies in /dspace/modules/server.  Minor dependency reordering"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "edcefe188593c0eff2b1d4811fae0a304ba5f251", "author": {"user": {"login": "tdonohue", "name": "Tim Donohue"}}, "url": "https://github.com/DSpace/DSpace/commit/edcefe188593c0eff2b1d4811fae0a304ba5f251", "committedDate": "2020-04-22T14:11:08Z", "message": "Fix dependency convergence issue between dspace-rest and dspace-oai"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ee0d6f03bd630b7330a26bbfd78967c009e4ca93", "author": {"user": {"login": "tdonohue", "name": "Tim Donohue"}}, "url": "https://github.com/DSpace/DSpace/commit/ee0d6f03bd630b7330a26bbfd78967c009e4ca93", "committedDate": "2020-04-22T14:44:40Z", "message": "Rename DSpaceRelProvider to DSpaceLinkRelationProvider to match HATEOAS classes"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "75d65b0f702c8f17a941099b58b0260c2fca53cd", "author": {"user": {"login": "tdonohue", "name": "Tim Donohue"}}, "url": "https://github.com/DSpace/DSpace/commit/75d65b0f702c8f17a941099b58b0260c2fca53cd", "committedDate": "2020-04-22T14:45:20Z", "message": "Spring HATEOAS updates for new code (after rebase on master)"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": null, "afterCommit": {"oid": "75d65b0f702c8f17a941099b58b0260c2fca53cd", "author": {"user": {"login": "tdonohue", "name": "Tim Donohue"}}, "url": "https://github.com/DSpace/DSpace/commit/75d65b0f702c8f17a941099b58b0260c2fca53cd", "committedDate": "2020-04-22T14:45:20Z", "message": "Spring HATEOAS updates for new code (after rebase on master)"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "eb9ae8e14d925cf419ace195eaf43a1bf6ef6421", "author": {"user": {"login": "tdonohue", "name": "Tim Donohue"}}, "url": "https://github.com/DSpace/DSpace/commit/eb9ae8e14d925cf419ace195eaf43a1bf6ef6421", "committedDate": "2020-04-22T15:25:13Z", "message": "Upgrade to latest version of Spring dependencies (as new versions have been released)"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e89b8d39437a7fa4925cd428fcf08d2614bdd8e6", "author": {"user": {"login": "tdonohue", "name": "Tim Donohue"}}, "url": "https://github.com/DSpace/DSpace/commit/e89b8d39437a7fa4925cd428fcf08d2614bdd8e6", "committedDate": "2020-04-22T15:32:32Z", "message": "Checkstyle fixes to previous updates"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzk4ODc3MDA4", "url": "https://github.com/DSpace/DSpace/pull/2720#pullrequestreview-398877008", "createdAt": "2020-04-23T08:32:23Z", "commit": {"oid": "e89b8d39437a7fa4925cd428fcf08d2614bdd8e6"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzk5OTAxNTY0", "url": "https://github.com/DSpace/DSpace/pull/2720#pullrequestreview-399901564", "createdAt": "2020-04-24T12:29:24Z", "commit": {"oid": "e89b8d39437a7fa4925cd428fcf08d2614bdd8e6"}, "state": "COMMENTED", "comments": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yNFQxMjoyOToyNVrOGLVYww==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yNVQxNjo1NTozMVrOGL3tng==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNDUzNzkyMw==", "bodyText": "this doesn't seem to be really needed", "url": "https://github.com/DSpace/DSpace/pull/2720#discussion_r414537923", "createdAt": "2020-04-24T12:29:25Z", "author": {"login": "abollini"}, "path": "dspace-server-webapp/pom.xml", "diffHunk": "@@ -346,6 +338,7 @@\n         <dependency>\n             <groupId>com.jayway.jsonpath</groupId>\n             <artifactId>json-path-assert</artifactId>\n+            <version>${json-path.version}</version>", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e89b8d39437a7fa4925cd428fcf08d2614bdd8e6"}, "originalPosition": 39}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNDUzODMxMA==", "bodyText": "can we can drop this line?", "url": "https://github.com/DSpace/DSpace/pull/2720#discussion_r414538310", "createdAt": "2020-04-24T12:30:06Z", "author": {"login": "abollini"}, "path": "dspace-server-webapp/pom.xml", "diffHunk": "@@ -241,11 +239,7 @@\n         <dependency>\n             <groupId>org.springframework.data</groupId>\n             <artifactId>spring-data-rest-hal-browser</artifactId>\n-            <version>3.1.10.RELEASE</version>\n-            <!-- if you get a java.util.zip.ZipException: invalid LOC\n-                 header (bad signature) during the tomcat startup\n-                 force the use of the previous version as the jar file\n-                 looks corrupted in the maven repository -->\n+            <version>${spring-hal-browser.version}</version>", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e89b8d39437a7fa4925cd428fcf08d2614bdd8e6"}, "originalPosition": 18}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNTA5OTA0Mw==", "bodyText": "This method is new and potentially alter the existing implementation, Do you have identified a specific use case where this change is required? is this fixing an existing bug?", "url": "https://github.com/DSpace/DSpace/pull/2720#discussion_r415099043", "createdAt": "2020-04-25T16:48:38Z", "author": {"login": "abollini"}, "path": "dspace-server-webapp/src/main/java/org/dspace/app/rest/utils/Utils.java", "diffHunk": "@@ -159,32 +158,64 @@\n      * @return the existing instance if it is not null, a default pageable instance otherwise.\n      */\n     public Pageable getPageable(@Nullable Pageable optionalPageable) {\n-        return optionalPageable != null ? optionalPageable : new PageRequest(0, DEFAULT_PAGE_SIZE);\n-    }\n-\n-    public Link linkToSingleResource(DSpaceResource r, String rel) {\n-        RestAddressableModel data = r.getContent();\n-        return linkToSingleResource(data, rel);\n+        return optionalPageable != null ? optionalPageable : PageRequest.of(0, DEFAULT_PAGE_SIZE);\n     }\n \n+    /**\n+     * Create a HAL Link to a single resource\n+     * @param data the resource itself\n+     * @param rel name of the link relation to create\n+     * @return created Link object\n+     */\n     public Link linkToSingleResource(RestAddressableModel data, String rel) {\n-        return linkTo(data.getController(), data.getCategory(), data.getTypePlural()).slash(data)\n+        // Create link using Spring HATEOAS link builder\n+        return linkTo(data.getController(), data.getCategory(), data.getTypePlural()).slash(getIdentifierForLink(data))\n                                                                                      .withRel(rel);\n     }\n \n+    /**\n+     * Create a HAL Link to a subresource of given resource. This method assumes the name & link to the subresource\n+     * are both the same string value. See other linkToSubResource method if they are different.\n+     * @param data main resource\n+     * @param rel name/subpath of the subresource (assumed to be the same)\n+     * @return created Link object\n+     */\n     public Link linkToSubResource(RestAddressableModel data, String rel) {\n         return linkToSubResource(data, rel, rel);\n     }\n \n+    /**\n+     * Create a HAL Link to a subresource of given resource using given path name and link name\n+     * @param data main resource\n+     * @param rel name of the subresource link relation to create\n+     * @param path subpath for the subresource\n+     * @return created Link object\n+     */\n     public Link linkToSubResource(RestAddressableModel data, String rel, String path) {\n-        return linkTo(data.getController(), data.getCategory(), data.getTypePlural()).slash(data).slash(path)\n+        // Create link using Spring HATEOAS link builder\n+        return linkTo(data.getController(), data.getCategory(), data.getTypePlural()).slash(getIdentifierForLink(data))\n+                                                                                     .slash(path)\n                                                                                      .withRel(rel);\n     }\n \n+    /**\n+     * Returns an identifier for a given resource, to be used in a Link.\n+     * @param data resource to identify\n+     * @return identifier, which is either an ID (if exists) or string representation of the object.\n+     */\n+    private Serializable getIdentifierForLink(RestAddressableModel data) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e89b8d39437a7fa4925cd428fcf08d2614bdd8e6"}, "originalPosition": 74}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNTEwMDMxOA==", "bodyText": "is really needed to make the version explicit here?", "url": "https://github.com/DSpace/DSpace/pull/2720#discussion_r415100318", "createdAt": "2020-04-25T16:55:31Z", "author": {"login": "abollini"}, "path": "dspace/modules/server/pom.xml", "diffHunk": "@@ -234,39 +234,16 @@ just adding new jar in the classloader</description>\n             <type>war</type>\n         </dependency>\n \n-        <dependency>\n-            <groupId>org.springframework.boot</groupId>\n-            <artifactId>spring-boot-starter-tomcat</artifactId>\n-            <scope>provided</scope>\n-            <version>${spring-boot.version}</version>\n-        </dependency>\n-        <dependency>\n-            <groupId>org.springframework</groupId>\n-            <artifactId>spring-test</artifactId>\n-            <scope>test</scope>\n-        </dependency>\n+        <!-- Test Dependencies -->\n         <dependency>\n             <groupId>org.springframework.boot</groupId>\n             <artifactId>spring-boot-starter-test</artifactId>\n-            <exclusions>\n-                <!-- Temporary exclusion to avoid dependency conflict with version of org.json:json used by dspace-api.\n-                     NOTE: THIS CAN BE REMOVED ONCE WE UPGRADE TO SPRING-BOOT v1.5 (or above), see DS-3802\n-                     As of Spring-Boot 1.5, org.json:json is no longer used by spring-boot-starter-test -->\n-                <exclusion>\n-                    <groupId>org.json</groupId>\n-                    <artifactId>json</artifactId>\n-                </exclusion>\n-                <!-- More recent version used for testing below -->\n-                <exclusion>\n-                    <groupId>com.jayway.jsonpath</groupId>\n-                    <artifactId>json-path</artifactId>\n-                </exclusion>\n-            </exclusions>\n             <scope>test</scope>\n         </dependency>\n         <dependency>\n             <groupId>com.jayway.jsonpath</groupId>\n             <artifactId>json-path-assert</artifactId>\n+            <version>${json-path.version}</version>", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e89b8d39437a7fa4925cd428fcf08d2614bdd8e6"}, "originalPosition": 38}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDAzNTk3NTg5", "url": "https://github.com/DSpace/DSpace/pull/2720#pullrequestreview-403597589", "createdAt": "2020-04-30T14:51:23Z", "commit": {"oid": "e89b8d39437a7fa4925cd428fcf08d2614bdd8e6"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1660, "cost": 1, "resetAt": "2021-11-01T13:51:04Z"}}}