{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTAzMzExNDU4", "number": 3002, "title": "Support itemService.getMetadata with virtual md field", "bodyText": "Description\nWhen using e.g. itemService.getMetadata(item, \"relation\", \"isAuthorOfPublication\", null, Item.ANY, true); the virtual metadata is currently not returned. This is due to ItemServiceImpl not using virtual metadata when the schema is \"relation\".\nInstructions for Reviewers\nThe RelationshipMetadataServiceTest.java fails with the master code.\nTo support e.g. itemService.getMetadata(publication, \"relation\", \"isJournalOfPublication\", Item.ANY, Item.ANY, true), the ItemServiceImpl should use virtual metadata when the schema is \"relation\".\nChecklist\nThis checklist provides a reminder of what we are going to look for when reviewing your PR. You need not complete this checklist prior to creating your PR (draft PRs are always welcome). If you are unsure about an item in the checklist, don't hesitate to ask. We're here to help!\n\n My PR is small in size (e.g. less than 1,000 lines of code, not including comments & integration tests). Exceptions may be made if previously agreed upon.\n My PR passes Checkstyle validation based on the Code Style Guide.\n My PR includes Javadoc for all new (or modified) public methods and classes. It also includes Javadoc for large or complex private methods.\n My PR passes all tests and includes new/updated Unit or Integration Tests based on the Code Testing Guide.\n If my PR includes new, third-party dependencies (in any pom.xml), I've made sure their licenses align with the DSpace BSD License based on the Licensing of Contributions documentation.\n If my PR modifies the REST API, I've linked to the REST Contract page (or open PR) related to this change.", "createdAt": "2020-10-14T11:40:07Z", "url": "https://github.com/DSpace/DSpace/pull/3002", "merged": true, "mergeCommit": {"oid": "adff448a66dc41ee53a1acc44af6beb2da0a0f6c"}, "closed": true, "closedAt": "2020-12-01T18:56:18Z", "author": {"login": "benbosman"}, "timelineItems": {"totalCount": 10, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABc77ARzgH2gAyNTAzMzExNDU4OjFhODE4YjMwNGMxMWZlMGJjOGU0OTkwOTZmMGE2MzExNDk3MjAyZjE=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdh-pD7AFqTU0MjIwMjA1MQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "1a818b304c11fe0bc8e499096f0a6311497202f1", "author": {"user": {"login": "MarieVerdonck", "name": "Marie Verdonck"}}, "url": "https://github.com/DSpace/DSpace/commit/1a818b304c11fe0bc8e499096f0a6311497202f1", "committedDate": "2020-08-05T13:12:19Z", "message": "72348: Test getMetadata implicit virtual metadata"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "0f069cc14c978fef6a0916915ffda39aca1c8751", "author": {"user": {"login": "MarieVerdonck", "name": "Marie Verdonck"}}, "url": "https://github.com/DSpace/DSpace/commit/0f069cc14c978fef6a0916915ffda39aca1c8751", "committedDate": "2020-08-05T13:16:54Z", "message": "72348: Fixes so getMetadata returns implicit virtual metadata"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "7677bd92e185bbd5016c0bb68df2d0bd70b08a5c", "author": {"user": {"login": "MarieVerdonck", "name": "Marie Verdonck"}}, "url": "https://github.com/DSpace/DSpace/commit/7677bd92e185bbd5016c0bb68df2d0bd70b08a5c", "committedDate": "2020-08-05T14:03:59Z", "message": "checkstyle"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "894ec569f1fb5c3bdef8efcec1d525590904f1e7", "author": {"user": {"login": "benbosman", "name": null}}, "url": "https://github.com/DSpace/DSpace/commit/894ec569f1fb5c3bdef8efcec1d525590904f1e7", "committedDate": "2020-10-14T10:53:33Z", "message": "Merge remote-tracking branch 'community/main' into w2p-72348_Support-itemService-getMetadata-with-virtual-md"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTE5MDg0OTQx", "url": "https://github.com/DSpace/DSpace/pull/3002#pullrequestreview-519084941", "createdAt": "2020-10-28T21:08:03Z", "commit": {"oid": "894ec569f1fb5c3bdef8efcec1d525590904f1e7"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yOFQyMTowODowM1rOHp9f8w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yOFQyMTowODowM1rOHp9f8w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMzc2MTI2Nw==", "bodyText": "Can we update this test method to use Builder classes?  Currently, it does not appear to be cleaning up after itself.", "url": "https://github.com/DSpace/DSpace/pull/3002#discussion_r513761267", "createdAt": "2020-10-28T21:08:03Z", "author": {"login": "tdonohue"}, "path": "dspace-api/src/test/java/org/dspace/content/RelationshipMetadataServiceTest.java", "diffHunk": "@@ -496,6 +497,123 @@ public void testGetNextLeftPlace() throws Exception {\n         assertThat(relationshipService.findNextLeftPlaceByLeftItem(context, leftItem), equalTo(2));\n \n \n+    }\n \n+    @Test\n+    public void testGetVirtualMetadata() throws SQLException, AuthorizeException {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "894ec569f1fb5c3bdef8efcec1d525590904f1e7"}, "originalPosition": 15}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTIxNzQxOTI0", "url": "https://github.com/DSpace/DSpace/pull/3002#pullrequestreview-521741924", "createdAt": "2020-11-02T15:37:28Z", "commit": {"oid": "894ec569f1fb5c3bdef8efcec1d525590904f1e7"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "8e2e564b6dd89bb565e91e50d13a45de6938e82e", "author": {"user": {"login": "MarieVerdonck", "name": "Marie Verdonck"}}, "url": "https://github.com/DSpace/DSpace/commit/8e2e564b6dd89bb565e91e50d13a45de6938e82e", "committedDate": "2020-11-20T13:52:02Z", "message": "74685: Refactor RelationshipMetadataServiceTest to use Builders"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTM1NTQ3ODc5", "url": "https://github.com/DSpace/DSpace/pull/3002#pullrequestreview-535547879", "createdAt": "2020-11-20T15:51:43Z", "commit": {"oid": "8e2e564b6dd89bb565e91e50d13a45de6938e82e"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0yMFQxNTo1MTo0M1rOH3VXwQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0yMFQxNTo1MTo0M1rOH3VXwQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNzc4Mzg3Mw==", "bodyText": "This file should now be renamed RelationshipMetadataServiceIT since it's been switched to an Integration Test instead of a Unit Test.", "url": "https://github.com/DSpace/DSpace/pull/3002#discussion_r527783873", "createdAt": "2020-11-20T15:51:43Z", "author": {"login": "tdonohue"}, "path": "dspace-api/src/test/java/org/dspace/content/RelationshipMetadataServiceTest.java", "diffHunk": "@@ -29,17 +33,13 @@\n import org.dspace.content.service.RelationshipService;\n import org.dspace.content.service.RelationshipTypeService;\n import org.dspace.content.service.WorkspaceItemService;\n-import org.junit.After;\n import org.junit.Before;\n import org.junit.Test;\n \n-public class RelationshipMetadataServiceTest extends AbstractUnitTest {\n-\n-    private static final Logger log = org.apache.logging.log4j.LogManager\n-        .getLogger(RelationshipMetadataServiceTest.class);\n+public class RelationshipMetadataServiceTest extends AbstractIntegrationTestWithDatabase {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "8e2e564b6dd89bb565e91e50d13a45de6938e82e"}, "originalPosition": 34}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "5654dc36685c00af0f809b2e8f50d3dd8bdb2aa8", "author": {"user": {"login": "MarieVerdonck", "name": "Marie Verdonck"}}, "url": "https://github.com/DSpace/DSpace/commit/5654dc36685c00af0f809b2e8f50d3dd8bdb2aa8", "committedDate": "2020-11-24T18:15:25Z", "message": "Rename after refactor RelationshipMetadataServiceTest => RelationshipMetadataServiceIT since it now inherits from AbstractIT class"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTQyMjAyMDUx", "url": "https://github.com/DSpace/DSpace/pull/3002#pullrequestreview-542202051", "createdAt": "2020-12-01T18:55:42Z", "commit": {"oid": "5654dc36685c00af0f809b2e8f50d3dd8bdb2aa8"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1344, "cost": 1, "resetAt": "2021-11-01T13:51:04Z"}}}