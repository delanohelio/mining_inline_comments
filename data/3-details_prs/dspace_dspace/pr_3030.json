{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTEyMDc3ODUx", "number": 3030, "title": "Uri parameters not added for self link", "bodyText": "References\nAdd references/links to any related issues or PRs. These may include:\n\nFixes #2919\nInitially noticed in this issue\n\nDescription\nInstructions for Reviewers\nList of changes in this PR:\n\nThe executeSearchMethods method in RestResourceController.java has been extended to now also return the parameters that were initially send in the request back using the self link\nThe parameters are passed along to 'getEncodedParameterStringFromRequestParams' which basically takes in the request parameters, and similarly to SearchFacetValueHalLinkFactory utilises the UriComponentsBuilder to build the URI, with the addition of an encode, to make sure that the link remains exactly the same\n\nSteps to test\n\nNavigate to {url}/api/core/metadatafields/search/bySchema?schema=dc\n\nThat self link should contain exactly the same {url}/api/core/metadatafields/search/bySchema?schema=dc\n\n\nNavigate to {url}/api/core/metadatafields/search/bySchema (So, without parameters)\n\nThat self link should contain exactly the same {url}/api/core/metadatafields/search/bySchema\n\n\n\nThe self-links should be the same as the initial request and resolve to a correct endpoint\nChecklist\nThis checklist provides a reminder of what we are going to look for when reviewing your PR. You need not complete this checklist prior to creating your PR (draft PRs are always welcome). If you are unsure about an item in the checklist, don't hesitate to ask. We're here to help!\n\n My PR is small in size (e.g. less than 1,000 lines of code, not including comments & integration tests). Exceptions may be made if previously agreed upon.\n My PR passes Checkstyle validation based on the Code Style Guide.\n My PR includes Javadoc for all new (or modified) public methods and classes. It also includes Javadoc for large or complex private methods.\n My PR passes all tests and includes new/updated Unit or Integration Tests based on the Code Testing Guide.\n If my PR includes new, third-party dependencies (in any pom.xml), I've made sure their licenses align with the DSpace BSD License based on the Licensing of Contributions documentation.\n If my PR modifies the REST API, I've linked to the REST Contract page (or open PR) related to this change.", "createdAt": "2020-10-29T07:29:54Z", "url": "https://github.com/DSpace/DSpace/pull/3030", "merged": true, "mergeCommit": {"oid": "72f5ea3383659a03d94783ef4b0c0bd322c1b6b0"}, "closed": true, "closedAt": "2020-11-06T07:50:06Z", "author": {"login": "jonas-atmire"}, "timelineItems": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdXCyVegH2gAyNTEyMDc3ODUxOjc0ZjE0NTQwZDFiODNkNjRkZmRhOTYzZTJlOWRhNzE2ZGIzMmVhYzk=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdZORv-AH2gAyNTEyMDc3ODUxOjBlMjk2NTI4ZGU4ZDkwMDFlNDgxMGU3MmUyOWQyMWUwZGQ0M2ZkYmM=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "74f14540d1b83d64dfda963e2e9da716db32eac9", "author": {"user": {"login": "jonas-atmire", "name": "Jonas Van Goolen"}}, "url": "https://github.com/DSpace/DSpace/commit/74f14540d1b83d64dfda963e2e9da716db32eac9", "committedDate": "2020-10-28T19:32:17Z", "message": "Issue 2919 -> URI parameters not properly added for self-links"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "dcfe58f104184cdb84fca2790c03f7f2d08852f7", "author": {"user": {"login": "jonas-atmire", "name": "Jonas Van Goolen"}}, "url": "https://github.com/DSpace/DSpace/commit/dcfe58f104184cdb84fca2790c03f7f2d08852f7", "committedDate": "2020-10-28T19:33:23Z", "message": "Merge branch 'main' into Issue_2919_URI-Parameters-not-added-for-self-link"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "8637378a8976ba50270f3469d330f34b5f576a31", "author": {"user": {"login": "jonas-atmire", "name": "Jonas Van Goolen"}}, "url": "https://github.com/DSpace/DSpace/commit/8637378a8976ba50270f3469d330f34b5f576a31", "committedDate": "2020-10-29T06:46:14Z", "message": "Issue 2919 -> Checkstyle fix"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTIzMjczNjAx", "url": "https://github.com/DSpace/DSpace/pull/3030#pullrequestreview-523273601", "createdAt": "2020-11-04T11:27:39Z", "commit": {"oid": "8637378a8976ba50270f3469d330f34b5f576a31"}, "state": "APPROVED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wNFQxMToyNzozOVrOHtUGIQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wNFQxMToyNzozOVrOHtUGIQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNzI3NzIxNw==", "bodyText": "please update / remote the comments as they don't apply to these tests", "url": "https://github.com/DSpace/DSpace/pull/3030#discussion_r517277217", "createdAt": "2020-11-04T11:27:39Z", "author": {"login": "abollini"}, "path": "dspace-server-webapp/src/test/java/org/dspace/app/rest/RestResourceControllerIT.java", "diffHunk": "@@ -71,4 +73,24 @@ public void notExistentResourceValidSubPath() throws Exception {\n                 .andExpect(status().isNotFound());\n     }\n \n+    @Test\n+    public void selfLinkContainsRequestParametersWhenProvided() throws Exception {\n+        // When we call the root endpoint\n+        getClient().perform(get(\"/api/core/metadatafields/search/byFieldName?schema=dc&offset=0\"))\n+                   // The status has to be 404 Not Found\n+                   .andExpect(jsonPath(\"$._links.self.href\", endsWith(\n+                           \"/api/core/metadatafields/search/byFieldName?schema=dc&offset=0\")));\n+    }\n+\n+    @Test\n+    public void selfLinkDevoidOfRequestParametersWhenNoneProvided() throws Exception {\n+        // When we call the root endpoint\n+        getClient().perform(get(\"/api/core/metadatafields/search/byFieldName\"))\n+                   // The status has to be 404 Not Found\n+                   .andExpect(jsonPath(\"$._links.self.href\",\n+                                       endsWith(\"/api/core/metadatafields/search/byFieldName\")));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "8637378a8976ba50270f3469d330f34b5f576a31"}, "originalPosition": 29}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "0e296528de8d9001e4810e72e29d21e0dd43fdbc", "author": {"user": {"login": "jonas-atmire", "name": "Jonas Van Goolen"}}, "url": "https://github.com/DSpace/DSpace/commit/0e296528de8d9001e4810e72e29d21e0dd43fdbc", "committedDate": "2020-11-04T14:03:24Z", "message": "Update RestResourceControllerIT.java"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1366, "cost": 1, "resetAt": "2021-11-01T13:51:04Z"}}}