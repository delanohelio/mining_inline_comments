{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDU2NTk3NzMx", "number": 2121, "title": "Fixed piglin SlimefunItem pickup", "bodyText": "Description\n\nPiglins now can not pick up items which are SlimefunItems.\nA low-budget video about the fix: https://imgur.com/G0PDuZl\nChanges\n\n\nAdded a check when piglins are about to pick up Slimefun items. When this happens, we cancel EntityPickupItemEvent.\n\nRelated Issues\n\n\n#2097\nChecklist\n\n\n\n I have fully tested the proposed changes and promise that they will not break everything into chaos.\n I have also tested the proposed changes in combination with various popular addons and can confirm my changes do not break them.\n I followed the existing code standards and didn't mess up the formatting.\n I did my best to add documentation to any public classes or methods I added.\n I added sufficient Unit Tests to cover my code.", "createdAt": "2020-07-25T10:24:36Z", "url": "https://github.com/Slimefun/Slimefun4/pull/2121", "merged": true, "mergeCommit": {"oid": "ebce279cf2fe211bb944c73fcce70c354d67e100"}, "closed": true, "closedAt": "2020-07-25T11:56:59Z", "author": {"login": "poma123"}, "timelineItems": {"totalCount": 10, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABc4VuQHAH2gAyNDU2NTk3NzMxOjlmYjc5Yzg2MjI1ZWIyODgyNDg1OGZmMzBmOTA4ZWEwYTM1ZWE0NTI=", "endCursor": "Y3Vyc29yOnYyOpPPAAABc4XSxtAFqTQ1NTI4MDczNw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "9fb79c86225eb28824858ff30f908ea0a35ea452", "author": {"user": {"login": "poma123", "name": null}}, "url": "https://github.com/Slimefun/Slimefun4/commit/9fb79c86225eb28824858ff30f908ea0a35ea452", "committedDate": "2020-07-25T10:04:22Z", "message": "Fixed piglin SlimefunItem pickup"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "17a68ddcf507fce0d73708d22fb1169d7706f0ac", "author": {"user": {"login": "poma123", "name": null}}, "url": "https://github.com/Slimefun/Slimefun4/commit/17a68ddcf507fce0d73708d22fb1169d7706f0ac", "committedDate": "2020-07-25T10:19:02Z", "message": "Removed unnecessary Zombified Piglin check"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDU1Mjc3MTE2", "url": "https://github.com/Slimefun/Slimefun4/pull/2121#pullrequestreview-455277116", "createdAt": "2020-07-25T10:30:04Z", "commit": {"oid": "17a68ddcf507fce0d73708d22fb1169d7706f0ac"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yNVQxMDozMDowNFrOG3EDSQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yNVQxMDozMDowNFrOG3EDSQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MDM5MTI0MQ==", "bodyText": "Enum comparisons should be done using == instead of .equals() as it allows the JVM to do premature eliminations during compiler-time rather than runtime.", "url": "https://github.com/Slimefun/Slimefun4/pull/2121#discussion_r460391241", "createdAt": "2020-07-25T10:30:04Z", "author": {"login": "TheBusyBiscuit"}, "path": "src/main/java/io/github/thebusybiscuit/slimefun4/implementation/listeners/ItemPickupListener.java", "diffHunk": "@@ -30,6 +34,12 @@ public void onEntityPickup(EntityPickupItemEvent e) {\n         else if (e.getItem().getItemStack().hasItemMeta() && e.getItem().getItemStack().getItemMeta().hasDisplayName() && e.getItem().getItemStack().getItemMeta().getDisplayName().startsWith(ITEM_PREFIX)) {\n             e.setCancelled(true);\n             e.getItem().remove();\n+        } else if (SlimefunPlugin.getMinecraftVersion().isAtLeast(MinecraftVersion.MINECRAFT_1_16)) {\n+            if (e.getEntityType().equals(EntityType.PIGLIN)) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "17a68ddcf507fce0d73708d22fb1169d7706f0ac"}, "originalPosition": 26}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a6d69ee9d68c036e3909281c5d057be0b99c5637", "author": {"user": {"login": "poma123", "name": null}}, "url": "https://github.com/Slimefun/Slimefun4/commit/a6d69ee9d68c036e3909281c5d057be0b99c5637", "committedDate": "2020-07-25T10:31:52Z", "message": "Requested changes"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "5ff93b75e04a6101507ecd11259bf52dcd85cbf4", "author": {"user": {"login": "poma123", "name": null}}, "url": "https://github.com/Slimefun/Slimefun4/commit/5ff93b75e04a6101507ecd11259bf52dcd85cbf4", "committedDate": "2020-07-25T11:37:04Z", "message": "Added PiglinListener"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDU1MjgwMDU3", "url": "https://github.com/Slimefun/Slimefun4/pull/2121#pullrequestreview-455280057", "createdAt": "2020-07-25T11:38:32Z", "commit": {"oid": "5ff93b75e04a6101507ecd11259bf52dcd85cbf4"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yNVQxMTozODozM1rOG3EXkA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yNVQxMTozODozM1rOG3EXkA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MDM5NjQzMg==", "bodyText": "I know I know don't blame me!!!", "url": "https://github.com/Slimefun/Slimefun4/pull/2121#discussion_r460396432", "createdAt": "2020-07-25T11:38:33Z", "author": {"login": "poma123"}, "path": "src/main/java/io/github/thebusybiscuit/slimefun4/implementation/SlimefunPlugin.java", "diffHunk": "@@ -10,9 +10,12 @@\n import java.util.logging.Level;\n import java.util.stream.Collectors;\n \n+import io.github.thebusybiscuit.slimefun4.implementation.listeners.*;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "5ff93b75e04a6101507ecd11259bf52dcd85cbf4"}, "originalPosition": 4}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a323b09e38755d8b73f51782eafd32cb1227bb90", "author": {"user": {"login": "poma123", "name": null}}, "url": "https://github.com/Slimefun/Slimefun4/commit/a323b09e38755d8b73f51782eafd32cb1227bb90", "committedDate": "2020-07-25T11:41:11Z", "message": "Fixed a tremendous mistake"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDU1MjgwMDY1", "url": "https://github.com/Slimefun/Slimefun4/pull/2121#pullrequestreview-455280065", "createdAt": "2020-07-25T11:38:44Z", "commit": {"oid": "5ff93b75e04a6101507ecd11259bf52dcd85cbf4"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yNVQxMTozODo0NFrOG3EXlg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yNVQxMTo0MTo0MVrOG3EYiw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MDM5NjQzOA==", "bodyText": "No star imports please D:", "url": "https://github.com/Slimefun/Slimefun4/pull/2121#discussion_r460396438", "createdAt": "2020-07-25T11:38:44Z", "author": {"login": "TheBusyBiscuit"}, "path": "src/main/java/io/github/thebusybiscuit/slimefun4/implementation/SlimefunPlugin.java", "diffHunk": "@@ -10,9 +10,12 @@\n import java.util.logging.Level;\n import java.util.stream.Collectors;\n \n+import io.github.thebusybiscuit.slimefun4.implementation.listeners.*;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "5ff93b75e04a6101507ecd11259bf52dcd85cbf4"}, "originalPosition": 4}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MDM5NjQ3MA==", "bodyText": "Also what is that import doing here?", "url": "https://github.com/Slimefun/Slimefun4/pull/2121#discussion_r460396470", "createdAt": "2020-07-25T11:39:05Z", "author": {"login": "TheBusyBiscuit"}, "path": "src/main/java/io/github/thebusybiscuit/slimefun4/implementation/SlimefunPlugin.java", "diffHunk": "@@ -10,9 +10,12 @@\n import java.util.logging.Level;\n import java.util.stream.Collectors;\n \n+import io.github.thebusybiscuit.slimefun4.implementation.listeners.*;\n+import me.mrCookieSlime.Slimefun.Objects.SlimefunItem.SlimefunItem;\n import org.bukkit.Bukkit;\n import org.bukkit.Server;\n import org.bukkit.command.Command;\n+import org.bukkit.entity.EntityType;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "5ff93b75e04a6101507ecd11259bf52dcd85cbf4"}, "originalPosition": 9}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MDM5NjYyNw==", "bodyText": "We should probably also add a message saying that you cannot barter with piglins using Slimefun items.", "url": "https://github.com/Slimefun/Slimefun4/pull/2121#discussion_r460396627", "createdAt": "2020-07-25T11:40:45Z", "author": {"login": "TheBusyBiscuit"}, "path": "src/main/java/io/github/thebusybiscuit/slimefun4/implementation/listeners/PiglinListener.java", "diffHunk": "@@ -0,0 +1,56 @@\n+package io.github.thebusybiscuit.slimefun4.implementation.listeners;\n+\n+import io.github.thebusybiscuit.slimefun4.implementation.SlimefunPlugin;\n+import me.mrCookieSlime.Slimefun.Objects.SlimefunItem.SlimefunItem;\n+import org.bukkit.entity.EntityType;\n+import org.bukkit.entity.Item;\n+import org.bukkit.event.EventHandler;\n+import org.bukkit.event.Listener;\n+import org.bukkit.event.entity.EntityPickupItemEvent;\n+import org.bukkit.event.entity.EntityTargetEvent;\n+import org.bukkit.event.player.PlayerInteractAtEntityEvent;\n+import org.bukkit.event.player.PlayerInteractEntityEvent;\n+import org.bukkit.inventory.EquipmentSlot;\n+import org.bukkit.inventory.ItemStack;\n+\n+/**\n+ * Listens to \"Piglin trading events\" to prevent trading with Slimefun items.\n+ *\n+ * @author poma123\n+ */\n+public class PiglinListener implements Listener {\n+\n+    public PiglinListener(SlimefunPlugin plugin) {\n+        plugin.getServer().getPluginManager().registerEvents(this, plugin);\n+    }\n+\n+    @EventHandler\n+    public void onEntityPickup(EntityPickupItemEvent e) {\n+        if (e.getEntityType() == EntityType.PIGLIN) {\n+            if (SlimefunItem.getByItem(e.getItem().getItemStack()) != null) {\n+                e.setCancelled(true);\n+            }\n+        }\n+    }\n+\n+    @EventHandler\n+    public void onInteractEntity(PlayerInteractEntityEvent e) {\n+        if (!e.getRightClicked().isValid() || e.getRightClicked().getType() != EntityType.PIGLIN) {\n+            return;\n+        }\n+\n+        ItemStack itemStack;\n+\n+        if (e.getHand() == EquipmentSlot.OFF_HAND) {\n+            itemStack = e.getPlayer().getInventory().getItemInOffHand();\n+        } else {\n+            itemStack = e.getPlayer().getInventory().getItemInMainHand();\n+        }\n+\n+        SlimefunItem sfItem = SlimefunItem.getByItem(itemStack);\n+\n+        if (sfItem != null) {\n+            e.setCancelled(true);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "5ff93b75e04a6101507ecd11259bf52dcd85cbf4"}, "originalPosition": 53}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MDM5NjY4Mw==", "bodyText": "Also just a small performance optimization: We should check if the item is a gold ingot, that way we won't have to do any checks that are not needed.", "url": "https://github.com/Slimefun/Slimefun4/pull/2121#discussion_r460396683", "createdAt": "2020-07-25T11:41:41Z", "author": {"login": "TheBusyBiscuit"}, "path": "src/main/java/io/github/thebusybiscuit/slimefun4/implementation/listeners/PiglinListener.java", "diffHunk": "@@ -0,0 +1,56 @@\n+package io.github.thebusybiscuit.slimefun4.implementation.listeners;\n+\n+import io.github.thebusybiscuit.slimefun4.implementation.SlimefunPlugin;\n+import me.mrCookieSlime.Slimefun.Objects.SlimefunItem.SlimefunItem;\n+import org.bukkit.entity.EntityType;\n+import org.bukkit.entity.Item;\n+import org.bukkit.event.EventHandler;\n+import org.bukkit.event.Listener;\n+import org.bukkit.event.entity.EntityPickupItemEvent;\n+import org.bukkit.event.entity.EntityTargetEvent;\n+import org.bukkit.event.player.PlayerInteractAtEntityEvent;\n+import org.bukkit.event.player.PlayerInteractEntityEvent;\n+import org.bukkit.inventory.EquipmentSlot;\n+import org.bukkit.inventory.ItemStack;\n+\n+/**\n+ * Listens to \"Piglin trading events\" to prevent trading with Slimefun items.\n+ *\n+ * @author poma123\n+ */\n+public class PiglinListener implements Listener {\n+\n+    public PiglinListener(SlimefunPlugin plugin) {\n+        plugin.getServer().getPluginManager().registerEvents(this, plugin);\n+    }\n+\n+    @EventHandler\n+    public void onEntityPickup(EntityPickupItemEvent e) {\n+        if (e.getEntityType() == EntityType.PIGLIN) {\n+            if (SlimefunItem.getByItem(e.getItem().getItemStack()) != null) {\n+                e.setCancelled(true);\n+            }\n+        }\n+    }\n+\n+    @EventHandler\n+    public void onInteractEntity(PlayerInteractEntityEvent e) {\n+        if (!e.getRightClicked().isValid() || e.getRightClicked().getType() != EntityType.PIGLIN) {\n+            return;\n+        }\n+\n+        ItemStack itemStack;\n+\n+        if (e.getHand() == EquipmentSlot.OFF_HAND) {\n+            itemStack = e.getPlayer().getInventory().getItemInOffHand();\n+        } else {\n+            itemStack = e.getPlayer().getInventory().getItemInMainHand();\n+        }\n+", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "5ff93b75e04a6101507ecd11259bf52dcd85cbf4"}, "originalPosition": 49}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "dde3ec26ba57e3bd73d81c2ab7b977811f8390a0", "author": {"user": {"login": "poma123", "name": null}}, "url": "https://github.com/Slimefun/Slimefun4/commit/dde3ec26ba57e3bd73d81c2ab7b977811f8390a0", "committedDate": "2020-07-25T11:51:10Z", "message": "Requested changes"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDU1MjgwNzM3", "url": "https://github.com/Slimefun/Slimefun4/pull/2121#pullrequestreview-455280737", "createdAt": "2020-07-25T11:54:10Z", "commit": {"oid": "dde3ec26ba57e3bd73d81c2ab7b977811f8390a0"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2516, "cost": 1, "resetAt": "2021-11-02T10:47:05Z"}}}