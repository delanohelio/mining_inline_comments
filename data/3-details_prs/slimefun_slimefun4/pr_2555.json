{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTIyMDUwNjMx", "number": 2555, "title": "Fixed a bug of Duplicate items with BlockPlacer", "bodyText": "Fixed a bug of Duplicate items with BlockPlacer's delay\nDescription\non BlockPlacer place an item, just take out the item when it place,then one in hand and\nanother is placed.\nChanges\nwhen BlockPlacer place,there shouldn't be someone viewing it.\nI have no better way to fix it.\nRelated Issues\nWith BlockPlacer's Place delay,it can Duplicate almost any block,just take out the item in BlockPlacer on BlockPlacer place.\nChecklist\n\n\n\n I have fully tested the proposed changes and promise that they will not break everything into chaos.\n I have also tested the proposed changes in combination with various popular addons and can confirm my changes do not break them.\n I followed the existing code standards and didn't mess up the formatting.\n I did my best to add documentation to any public classes or methods I added.\n I have added Nonnull and Nullable annotations to my methods to indicate their behaviour for null values\n I added sufficient Unit Tests to cover my code.", "createdAt": "2020-11-17T00:07:45Z", "url": "https://github.com/Slimefun/Slimefun4/pull/2555", "merged": true, "mergeCommit": {"oid": "eea3254d11c55088c0ef1e294213ec37926808f0"}, "closed": true, "closedAt": "2020-11-19T17:08:03Z", "author": {"login": "LobbyTech-MC"}, "timelineItems": {"totalCount": 8, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABddOBPgAH2gAyNTIyMDUwNjMxOjNkYjc3YTAwODE2NmM2ZjYxYmI5MzYwZjI5MDVmNzU0ZTA1Y2Y2Y2M=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdeCnsoAFqTUzNDQyNzgyMg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "3db77a008166c6f61bb9360f2905f754e05cf6cc", "author": {"user": {"login": "LobbyTech-MC", "name": "LobbyTech"}}, "url": "https://github.com/Slimefun/Slimefun4/commit/3db77a008166c6f61bb9360f2905f754e05cf6cc", "committedDate": "2020-11-17T00:01:04Z", "message": "Fixed a bug of Duplicate items with BlockPlacer\n\nFixed a bug of Duplicate items with BlockPlacer's delay\r\non BlockPlacer place an item, just take out the item when it place,then one in hand and \r\nanother is placed"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTMxOTMxMzA5", "url": "https://github.com/Slimefun/Slimefun4/pull/2555#pullrequestreview-531931309", "createdAt": "2020-11-17T00:27:03Z", "commit": {"oid": "3db77a008166c6f61bb9360f2905f754e05cf6cc"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xN1QwMDoyNzowNFrOH0fk_Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xN1QwMDoyODoyMFrOH0fmaw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNDgwNTM3Mw==", "bodyText": "Formatting, please adhere to our code style guidelines, there should be a space after the if and before the curly bracket {", "url": "https://github.com/Slimefun/Slimefun4/pull/2555#discussion_r524805373", "createdAt": "2020-11-17T00:27:04Z", "author": {"login": "TheBusyBiscuit"}, "path": "src/main/java/io/github/thebusybiscuit/slimefun4/implementation/items/blocks/BlockPlacer.java", "diffHunk": "@@ -146,6 +146,10 @@ private boolean isBlacklisted(Material type) {\n     private void placeSlimefunBlock(SlimefunItem sfItem, ItemStack item, Block block, Dispenser dispenser) {\n         BlockPlacerPlaceEvent e = new BlockPlacerPlaceEvent(dispenser.getBlock(), item, block);\n         Bukkit.getPluginManager().callEvent(e);\n+        \n+        if(!dispenser.getInventory().getViewers().isEmpty()){", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "3db77a008166c6f61bb9360f2905f754e05cf6cc"}, "originalPosition": 5}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNDgwNTM5MQ==", "bodyText": "Formatting, please adhere to our code style guidelines, there should be a space after the if and before the curly bracket {", "url": "https://github.com/Slimefun/Slimefun4/pull/2555#discussion_r524805391", "createdAt": "2020-11-17T00:27:07Z", "author": {"login": "TheBusyBiscuit"}, "path": "src/main/java/io/github/thebusybiscuit/slimefun4/implementation/items/blocks/BlockPlacer.java", "diffHunk": "@@ -182,6 +186,10 @@ private void placeSlimefunBlock(SlimefunItem sfItem, ItemStack item, Block block\n     private void placeBlock(ItemStack item, Block facedBlock, Dispenser dispenser) {\n         BlockPlacerPlaceEvent e = new BlockPlacerPlaceEvent(dispenser.getBlock(), item, facedBlock);\n         Bukkit.getPluginManager().callEvent(e);\n+        \n+        if(!dispenser.getInventory().getViewers().isEmpty()){", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "3db77a008166c6f61bb9360f2905f754e05cf6cc"}, "originalPosition": 16}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNDgwNTcwMA==", "bodyText": "There is no point in calling an Event when it gets cancelled anyway.\nThe whole point of the Event contract is that others get a say in the outcome of the Event, not that their changes get overridden otherwise.\nIf no block gets placed, then there shouldn't even be an Event called.", "url": "https://github.com/Slimefun/Slimefun4/pull/2555#discussion_r524805700", "createdAt": "2020-11-17T00:28:11Z", "author": {"login": "TheBusyBiscuit"}, "path": "src/main/java/io/github/thebusybiscuit/slimefun4/implementation/items/blocks/BlockPlacer.java", "diffHunk": "@@ -146,6 +146,10 @@ private boolean isBlacklisted(Material type) {\n     private void placeSlimefunBlock(SlimefunItem sfItem, ItemStack item, Block block, Dispenser dispenser) {\n         BlockPlacerPlaceEvent e = new BlockPlacerPlaceEvent(dispenser.getBlock(), item, block);\n         Bukkit.getPluginManager().callEvent(e);\n+        \n+        if(!dispenser.getInventory().getViewers().isEmpty()){\n+        \te.setCancelled(true);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "3db77a008166c6f61bb9360f2905f754e05cf6cc"}, "originalPosition": 6}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNDgwNTczOQ==", "bodyText": "There is no point in calling an Event when it gets cancelled anyway.\nThe whole point of the Event contract is that others get a say in the outcome of the Event, not that their changes get overridden otherwise.\nIf no block gets placed, then there shouldn't even be an Event called.", "url": "https://github.com/Slimefun/Slimefun4/pull/2555#discussion_r524805739", "createdAt": "2020-11-17T00:28:20Z", "author": {"login": "TheBusyBiscuit"}, "path": "src/main/java/io/github/thebusybiscuit/slimefun4/implementation/items/blocks/BlockPlacer.java", "diffHunk": "@@ -182,6 +186,10 @@ private void placeSlimefunBlock(SlimefunItem sfItem, ItemStack item, Block block\n     private void placeBlock(ItemStack item, Block facedBlock, Dispenser dispenser) {\n         BlockPlacerPlaceEvent e = new BlockPlacerPlaceEvent(dispenser.getBlock(), item, facedBlock);\n         Bukkit.getPluginManager().callEvent(e);\n+        \n+        if(!dispenser.getInventory().getViewers().isEmpty()){\n+        \te.setCancelled(true);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "3db77a008166c6f61bb9360f2905f754e05cf6cc"}, "originalPosition": 17}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "965e34869568b3fa4850253ccdfe2e8582ea0c91", "author": {"user": {"login": "LobbyTech-MC", "name": "LobbyTech"}}, "url": "https://github.com/Slimefun/Slimefun4/commit/965e34869568b3fa4850253ccdfe2e8582ea0c91", "committedDate": "2020-11-17T01:13:03Z", "message": "Update BlockPlacer.java"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTMyMjU2Mzg4", "url": "https://github.com/Slimefun/Slimefun4/pull/2555#pullrequestreview-532256388", "createdAt": "2020-11-17T11:11:29Z", "commit": {"oid": "965e34869568b3fa4850253ccdfe2e8582ea0c91"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xN1QxMToxMToyOVrOH0v6_w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xN1QxMToxNDoxOFrOH0wBOA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNTA3MzE1MQ==", "bodyText": "Still formatting...", "url": "https://github.com/Slimefun/Slimefun4/pull/2555#discussion_r525073151", "createdAt": "2020-11-17T11:11:29Z", "author": {"login": "TheBusyBiscuit"}, "path": "src/main/java/io/github/thebusybiscuit/slimefun4/implementation/items/blocks/BlockPlacer.java", "diffHunk": "@@ -145,7 +145,10 @@ private boolean isBlacklisted(Material type) {\n \n     private void placeSlimefunBlock(SlimefunItem sfItem, ItemStack item, Block block, Dispenser dispenser) {\n         BlockPlacerPlaceEvent e = new BlockPlacerPlaceEvent(dispenser.getBlock(), item, block);\n-        Bukkit.getPluginManager().callEvent(e);\n+        \n+        if(dispenser.getInventory().getViewers().isEmpty()) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "965e34869568b3fa4850253ccdfe2e8582ea0c91"}, "originalPosition": 6}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNTA3MzYzMA==", "bodyText": "Putting this here makes absolutely no sense.\nThe only thing it would do is break all other plugins and allow for many other duplications.", "url": "https://github.com/Slimefun/Slimefun4/pull/2555#discussion_r525073630", "createdAt": "2020-11-17T11:12:19Z", "author": {"login": "TheBusyBiscuit"}, "path": "src/main/java/io/github/thebusybiscuit/slimefun4/implementation/items/blocks/BlockPlacer.java", "diffHunk": "@@ -145,7 +145,10 @@ private boolean isBlacklisted(Material type) {\n \n     private void placeSlimefunBlock(SlimefunItem sfItem, ItemStack item, Block block, Dispenser dispenser) {\n         BlockPlacerPlaceEvent e = new BlockPlacerPlaceEvent(dispenser.getBlock(), item, block);\n-        Bukkit.getPluginManager().callEvent(e);\n+        \n+        if(dispenser.getInventory().getViewers().isEmpty()) {\n+        \tBukkit.getPluginManager().callEvent(e);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "965e34869568b3fa4850253ccdfe2e8582ea0c91"}, "originalPosition": 7}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNTA3NDY3NQ==", "bodyText": "You cannot just make only the event calling conditional. The check must occur far before any Event is even called, so better before these methods are even invoked in the first place.\nAlso, you should really test your changes before-hand.", "url": "https://github.com/Slimefun/Slimefun4/pull/2555#discussion_r525074675", "createdAt": "2020-11-17T11:14:11Z", "author": {"login": "TheBusyBiscuit"}, "path": "src/main/java/io/github/thebusybiscuit/slimefun4/implementation/items/blocks/BlockPlacer.java", "diffHunk": "@@ -145,7 +145,10 @@ private boolean isBlacklisted(Material type) {\n \n     private void placeSlimefunBlock(SlimefunItem sfItem, ItemStack item, Block block, Dispenser dispenser) {\n         BlockPlacerPlaceEvent e = new BlockPlacerPlaceEvent(dispenser.getBlock(), item, block);\n-        Bukkit.getPluginManager().callEvent(e);\n+        \n+        if(dispenser.getInventory().getViewers().isEmpty()) {\n+        \tBukkit.getPluginManager().callEvent(e);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNTA3MzYzMA=="}, "originalCommit": {"oid": "965e34869568b3fa4850253ccdfe2e8582ea0c91"}, "originalPosition": 7}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNTA3NDc0NA==", "bodyText": "Still formatting...", "url": "https://github.com/Slimefun/Slimefun4/pull/2555#discussion_r525074744", "createdAt": "2020-11-17T11:14:18Z", "author": {"login": "TheBusyBiscuit"}, "path": "src/main/java/io/github/thebusybiscuit/slimefun4/implementation/items/blocks/BlockPlacer.java", "diffHunk": "@@ -181,7 +184,10 @@ private void placeSlimefunBlock(SlimefunItem sfItem, ItemStack item, Block block\n \n     private void placeBlock(ItemStack item, Block facedBlock, Dispenser dispenser) {\n         BlockPlacerPlaceEvent e = new BlockPlacerPlaceEvent(dispenser.getBlock(), item, facedBlock);\n-        Bukkit.getPluginManager().callEvent(e);\n+        \n+        if(dispenser.getInventory().getViewers().isEmpty()) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "965e34869568b3fa4850253ccdfe2e8582ea0c91"}, "originalPosition": 18}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d76f77cd84d793e5ac51fffabf17ec79dbb1185a", "author": {"user": {"login": "LobbyTech-MC", "name": "LobbyTech"}}, "url": "https://github.com/Slimefun/Slimefun4/commit/d76f77cd84d793e5ac51fffabf17ec79dbb1185a", "committedDate": "2020-11-18T01:21:59Z", "message": "Update BlockPlacer.java"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "024dbf4fc55098d662f149f911240e74dd4cc604", "author": {"user": {"login": "LobbyTech-MC", "name": "LobbyTech"}}, "url": "https://github.com/Slimefun/Slimefun4/commit/024dbf4fc55098d662f149f911240e74dd4cc604", "committedDate": "2020-11-18T01:37:54Z", "message": "Update BlockPlacer.java"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTM0MjkyODA2", "url": "https://github.com/Slimefun/Slimefun4/pull/2555#pullrequestreview-534292806", "createdAt": "2020-11-19T10:46:29Z", "commit": {"oid": "024dbf4fc55098d662f149f911240e74dd4cc604"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTM0NDI3ODIy", "url": "https://github.com/Slimefun/Slimefun4/pull/2555#pullrequestreview-534427822", "createdAt": "2020-11-19T13:18:08Z", "commit": {"oid": "024dbf4fc55098d662f149f911240e74dd4cc604"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2586, "cost": 1, "resetAt": "2021-11-02T10:47:05Z"}}}