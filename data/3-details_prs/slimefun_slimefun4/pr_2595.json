{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTMzMDQ5NDk2", "number": 2595, "title": "Fix ghost blocks", "bodyText": "Description\nFixes instances of ghost blocks (places where you can't place blocks, because for SF it exist and for server not).\nAs for now I did quick test of it and it looks like everything worked. I also plan to test in on working server soon.\nChanges\nAdded some logic to BlockListener.onBlockPlaceExisting for checking if targeted block is air (and if it is, removing it and dropping item).\nRelated Issues\nhttps://github.com/Slimefun/Slimefun4/wiki/Common-Issues#unplaceable-blocks\nhttps://youtu.be/HYlNRKud5kI\nChecklist\n\n\n\n I have fully tested the proposed changes and promise that they will not break everything into chaos.\n I have also tested the proposed changes in combination with various popular addons and can confirm my changes do not break them.\n I followed the existing code standards and didn't mess up the formatting.\n I did my best to add documentation to any public classes or methods I added.\n I have added Nonnull and Nullable annotations to my methods to indicate their behaviour for null values\n I added sufficient Unit Tests to cover my code.\n\n^ Leaving this empty, as I prefer someone else to rate it (1st and 2nd one I will check after tests).", "createdAt": "2020-12-05T17:06:05Z", "url": "https://github.com/Slimefun/Slimefun4/pull/2595", "merged": true, "mergeCommit": {"oid": "5aa5ca1aed4c8df5bfc56c70ceea112834da9a9d"}, "closed": true, "closedAt": "2020-12-10T20:51:01Z", "author": {"login": "Patbox"}, "timelineItems": {"totalCount": 10, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdjPN2GgH2gAyNTMzMDQ5NDk2OmY0NjMzYzUyOGZiMmU2MTUyOWEyOTdiZWYzYzkzMTJlMTdlYTYyYzI=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdk5rToAFqTU0OTU5MDU4Ng==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "f4633c528fb2e61529a297bef3c9312e17ea62c2", "author": {"user": {"login": "Patbox", "name": null}}, "url": "https://github.com/Slimefun/Slimefun4/commit/f4633c528fb2e61529a297bef3c9312e17ea62c2", "committedDate": "2020-12-05T16:48:17Z", "message": "Fix ghost blocks"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTQ1NjI2Mjk1", "url": "https://github.com/Slimefun/Slimefun4/pull/2595#pullrequestreview-545626295", "createdAt": "2020-12-05T17:54:04Z", "commit": {"oid": "f4633c528fb2e61529a297bef3c9312e17ea62c2"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 8, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0wNVQxNzo1NDowNVrOH_9lyg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0wNVQxNzo1NzoyMVrOH_9n_w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNjgzMTQzNA==", "bodyText": "Why would you return; here...\nIf this is to prevent the Event from being cancelled, use an if/else structure.", "url": "https://github.com/Slimefun/Slimefun4/pull/2595#discussion_r536831434", "createdAt": "2020-12-05T17:54:05Z", "author": {"login": "TheBusyBiscuit"}, "path": "src/main/java/io/github/thebusybiscuit/slimefun4/implementation/listeners/BlockListener.java", "diffHunk": "@@ -58,7 +61,18 @@ public void onBlockPlaceExisting(BlockPlaceEvent e) {\n         // This prevents Players from placing a block where another block already exists\n         // While this can cause ghost blocks it also prevents them from replacing grass\n         // or saplings etc...\n-        if (BlockStorage.hasBlockInfo(e.getBlock())) {\n+        Block block = e.getBlock();\n+        if (BlockStorage.hasBlockInfo(block)) {\n+            if (e.getBlockReplacedState().getType().isAir()) {\n+                Iterator<ItemStack> item = BlockStorage.check(block).getDrops().iterator();\n+                World world = block.getWorld();\n+                Location loc = block.getLocation();\n+                while (item.hasNext()) {\n+                    world.dropItem(loc, item.next());\n+                }\n+                BlockStorage.clearBlockInfo(block);\n+                return;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f4633c528fb2e61529a297bef3c9312e17ea62c2"}, "originalPosition": 32}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNjgzMTQ3NA==", "bodyText": "Why the iterator...", "url": "https://github.com/Slimefun/Slimefun4/pull/2595#discussion_r536831474", "createdAt": "2020-12-05T17:54:14Z", "author": {"login": "TheBusyBiscuit"}, "path": "src/main/java/io/github/thebusybiscuit/slimefun4/implementation/listeners/BlockListener.java", "diffHunk": "@@ -58,7 +61,18 @@ public void onBlockPlaceExisting(BlockPlaceEvent e) {\n         // This prevents Players from placing a block where another block already exists\n         // While this can cause ghost blocks it also prevents them from replacing grass\n         // or saplings etc...\n-        if (BlockStorage.hasBlockInfo(e.getBlock())) {\n+        Block block = e.getBlock();\n+        if (BlockStorage.hasBlockInfo(block)) {\n+            if (e.getBlockReplacedState().getType().isAir()) {\n+                Iterator<ItemStack> item = BlockStorage.check(block).getDrops().iterator();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f4633c528fb2e61529a297bef3c9312e17ea62c2"}, "originalPosition": 25}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNjgzMTUxOQ==", "bodyText": "You cannot drop null or air items, so you would need to check for that.", "url": "https://github.com/Slimefun/Slimefun4/pull/2595#discussion_r536831519", "createdAt": "2020-12-05T17:54:30Z", "author": {"login": "TheBusyBiscuit"}, "path": "src/main/java/io/github/thebusybiscuit/slimefun4/implementation/listeners/BlockListener.java", "diffHunk": "@@ -58,7 +61,18 @@ public void onBlockPlaceExisting(BlockPlaceEvent e) {\n         // This prevents Players from placing a block where another block already exists\n         // While this can cause ghost blocks it also prevents them from replacing grass\n         // or saplings etc...\n-        if (BlockStorage.hasBlockInfo(e.getBlock())) {\n+        Block block = e.getBlock();\n+        if (BlockStorage.hasBlockInfo(block)) {\n+            if (e.getBlockReplacedState().getType().isAir()) {\n+                Iterator<ItemStack> item = BlockStorage.check(block).getDrops().iterator();\n+                World world = block.getWorld();\n+                Location loc = block.getLocation();\n+                while (item.hasNext()) {\n+                    world.dropItem(loc, item.next());", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f4633c528fb2e61529a297bef3c9312e17ea62c2"}, "originalPosition": 29}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNjgzMTU2Mw==", "bodyText": "Also *dropItemNaturally", "url": "https://github.com/Slimefun/Slimefun4/pull/2595#discussion_r536831563", "createdAt": "2020-12-05T17:54:47Z", "author": {"login": "TheBusyBiscuit"}, "path": "src/main/java/io/github/thebusybiscuit/slimefun4/implementation/listeners/BlockListener.java", "diffHunk": "@@ -58,7 +61,18 @@ public void onBlockPlaceExisting(BlockPlaceEvent e) {\n         // This prevents Players from placing a block where another block already exists\n         // While this can cause ghost blocks it also prevents them from replacing grass\n         // or saplings etc...\n-        if (BlockStorage.hasBlockInfo(e.getBlock())) {\n+        Block block = e.getBlock();\n+        if (BlockStorage.hasBlockInfo(block)) {\n+            if (e.getBlockReplacedState().getType().isAir()) {\n+                Iterator<ItemStack> item = BlockStorage.check(block).getDrops().iterator();\n+                World world = block.getWorld();\n+                Location loc = block.getLocation();\n+                while (item.hasNext()) {\n+                    world.dropItem(loc, item.next());", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f4633c528fb2e61529a297bef3c9312e17ea62c2"}, "originalPosition": 29}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNjgzMTY4NA==", "bodyText": "These two statements can be merged.", "url": "https://github.com/Slimefun/Slimefun4/pull/2595#discussion_r536831684", "createdAt": "2020-12-05T17:55:42Z", "author": {"login": "TheBusyBiscuit"}, "path": "src/main/java/io/github/thebusybiscuit/slimefun4/implementation/listeners/BlockListener.java", "diffHunk": "@@ -58,7 +61,18 @@ public void onBlockPlaceExisting(BlockPlaceEvent e) {\n         // This prevents Players from placing a block where another block already exists\n         // While this can cause ghost blocks it also prevents them from replacing grass\n         // or saplings etc...\n-        if (BlockStorage.hasBlockInfo(e.getBlock())) {\n+        Block block = e.getBlock();\n+        if (BlockStorage.hasBlockInfo(block)) {\n+            if (e.getBlockReplacedState().getType().isAir()) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f4633c528fb2e61529a297bef3c9312e17ea62c2"}, "originalPosition": 24}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNjgzMTczMA==", "bodyText": "The order of these checks should be swapped for performance reasons.", "url": "https://github.com/Slimefun/Slimefun4/pull/2595#discussion_r536831730", "createdAt": "2020-12-05T17:55:56Z", "author": {"login": "TheBusyBiscuit"}, "path": "src/main/java/io/github/thebusybiscuit/slimefun4/implementation/listeners/BlockListener.java", "diffHunk": "@@ -58,7 +61,18 @@ public void onBlockPlaceExisting(BlockPlaceEvent e) {\n         // This prevents Players from placing a block where another block already exists\n         // While this can cause ghost blocks it also prevents them from replacing grass\n         // or saplings etc...\n-        if (BlockStorage.hasBlockInfo(e.getBlock())) {\n+        Block block = e.getBlock();\n+        if (BlockStorage.hasBlockInfo(block)) {\n+            if (e.getBlockReplacedState().getType().isAir()) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f4633c528fb2e61529a297bef3c9312e17ea62c2"}, "originalPosition": 24}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNjgzMTkwMQ==", "bodyText": "Calling BlockStorage.check() here is completely redundant.\nYou are already doing a check by doing hasBlockInfo() above, this is essentially doing two concurrent operations redundantly, a null check would be more sufficient here.", "url": "https://github.com/Slimefun/Slimefun4/pull/2595#discussion_r536831901", "createdAt": "2020-12-05T17:56:55Z", "author": {"login": "TheBusyBiscuit"}, "path": "src/main/java/io/github/thebusybiscuit/slimefun4/implementation/listeners/BlockListener.java", "diffHunk": "@@ -58,7 +61,18 @@ public void onBlockPlaceExisting(BlockPlaceEvent e) {\n         // This prevents Players from placing a block where another block already exists\n         // While this can cause ghost blocks it also prevents them from replacing grass\n         // or saplings etc...\n-        if (BlockStorage.hasBlockInfo(e.getBlock())) {\n+        Block block = e.getBlock();\n+        if (BlockStorage.hasBlockInfo(block)) {\n+            if (e.getBlockReplacedState().getType().isAir()) {\n+                Iterator<ItemStack> item = BlockStorage.check(block).getDrops().iterator();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f4633c528fb2e61529a297bef3c9312e17ea62c2"}, "originalPosition": 25}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNjgzMTk5OQ==", "bodyText": "Not really much of a point in making these variables here.", "url": "https://github.com/Slimefun/Slimefun4/pull/2595#discussion_r536831999", "createdAt": "2020-12-05T17:57:21Z", "author": {"login": "TheBusyBiscuit"}, "path": "src/main/java/io/github/thebusybiscuit/slimefun4/implementation/listeners/BlockListener.java", "diffHunk": "@@ -58,7 +61,18 @@ public void onBlockPlaceExisting(BlockPlaceEvent e) {\n         // This prevents Players from placing a block where another block already exists\n         // While this can cause ghost blocks it also prevents them from replacing grass\n         // or saplings etc...\n-        if (BlockStorage.hasBlockInfo(e.getBlock())) {\n+        Block block = e.getBlock();\n+        if (BlockStorage.hasBlockInfo(block)) {\n+            if (e.getBlockReplacedState().getType().isAir()) {\n+                Iterator<ItemStack> item = BlockStorage.check(block).getDrops().iterator();\n+                World world = block.getWorld();\n+                Location loc = block.getLocation();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f4633c528fb2e61529a297bef3c9312e17ea62c2"}, "originalPosition": 27}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ff634c0f5ce91ca4955b43c57c77e0b7c726f7fc", "author": {"user": {"login": "Patbox", "name": null}}, "url": "https://github.com/Slimefun/Slimefun4/commit/ff634c0f5ce91ca4955b43c57c77e0b7c726f7fc", "committedDate": "2020-12-05T19:22:03Z", "message": "Make code better"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTQ1NjQzNzU3", "url": "https://github.com/Slimefun/Slimefun4/pull/2595#pullrequestreview-545643757", "createdAt": "2020-12-05T19:28:49Z", "commit": {"oid": "ff634c0f5ce91ca4955b43c57c77e0b7c726f7fc"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0wNVQxOToyODo0OVrOIAAbhA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0wNVQxOTozMjoxM1rOIAAdtA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNjg3Nzk1Ng==", "bodyText": "Speaking of which, since you modified this class, feel free to add yourself here.\nSo we know who to contact XD", "url": "https://github.com/Slimefun/Slimefun4/pull/2595#discussion_r536877956", "createdAt": "2020-12-05T19:28:49Z", "author": {"login": "TheBusyBiscuit"}, "path": "src/main/java/io/github/thebusybiscuit/slimefun4/implementation/listeners/BlockListener.java", "diffHunk": "@@ -38,10 +38,10 @@\n /**\n  * The {@link BlockListener} is responsible for listening to the {@link BlockPlaceEvent}\n  * and {@link BlockBreakEvent}.\n- * \n+ *\n  * @author TheBusyBiscuit\n  * @author Linox\n- * ", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ff634c0f5ce91ca4955b43c57c77e0b7c726f7fc"}, "originalPosition": 8}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNjg3ODQ5OA==", "bodyText": "As stated in a prior review, these two checks should be swapped for performance reason.\nAny BlockStorage operations might be heavy depending on their concurrent behaviour and take a relatively long time to compute, whereas the .isAir() check is very inexpensive.\nSwapping will reduce those heavy lookups to a bare minimum.\n\n  \n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                    Block block = e.getBlock();\n          \n          \n            \n                    SlimefunItem sfItem = BlockStorage.check(block);\n          \n          \n            \n            \n          \n          \n            \n                    if (sfItem != null) {\n          \n          \n            \n                        if (e.getBlockReplacedState().getType().isAir()) {\n          \n          \n            \n                    if (e.getBlockReplacedState().getType().isAir()) {\n          \n          \n            \n                        Block block = e.getBlock();\n          \n          \n            \n                        SlimefunItem sfItem = BlockStorage.check(block);\n          \n          \n            \n            \n          \n          \n            \n                        if (sfItem != null) {", "url": "https://github.com/Slimefun/Slimefun4/pull/2595#discussion_r536878498", "createdAt": "2020-12-05T19:32:10Z", "author": {"login": "TheBusyBiscuit"}, "path": "src/main/java/io/github/thebusybiscuit/slimefun4/implementation/listeners/BlockListener.java", "diffHunk": "@@ -58,8 +58,18 @@ public void onBlockPlaceExisting(BlockPlaceEvent e) {\n         // This prevents Players from placing a block where another block already exists\n         // While this can cause ghost blocks it also prevents them from replacing grass\n         // or saplings etc...\n-        if (BlockStorage.hasBlockInfo(e.getBlock())) {\n-            e.setCancelled(true);\n+        Block block = e.getBlock();\n+        SlimefunItem sfItem = BlockStorage.check(block);\n+\n+        if (sfItem != null) {\n+            if (e.getBlockReplacedState().getType().isAir()) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ff634c0f5ce91ca4955b43c57c77e0b7c726f7fc"}, "originalPosition": 23}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNjg3ODUxNg==", "bodyText": "Formatting, also for non-blocks a simple AIR check is sufficient.\n\n  \n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                                if (item != null && !item.getType().isAir()) { block.getWorld().dropItemNaturally(block.getLocation(), item); }\n          \n          \n            \n                                if (item != null && item.getType() != Material.AIR) {\n          \n          \n            \n                                    block.getWorld().dropItemNaturally(block.getLocation(), item);\n          \n          \n            \n                                }", "url": "https://github.com/Slimefun/Slimefun4/pull/2595#discussion_r536878516", "createdAt": "2020-12-05T19:32:13Z", "author": {"login": "TheBusyBiscuit"}, "path": "src/main/java/io/github/thebusybiscuit/slimefun4/implementation/listeners/BlockListener.java", "diffHunk": "@@ -58,8 +58,18 @@ public void onBlockPlaceExisting(BlockPlaceEvent e) {\n         // This prevents Players from placing a block where another block already exists\n         // While this can cause ghost blocks it also prevents them from replacing grass\n         // or saplings etc...\n-        if (BlockStorage.hasBlockInfo(e.getBlock())) {\n-            e.setCancelled(true);\n+        Block block = e.getBlock();\n+        SlimefunItem sfItem = BlockStorage.check(block);\n+\n+        if (sfItem != null) {\n+            if (e.getBlockReplacedState().getType().isAir()) {\n+                for (ItemStack item : sfItem.getDrops()) {\n+                    if (item != null && !item.getType().isAir()) { block.getWorld().dropItemNaturally(block.getLocation(), item); }", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ff634c0f5ce91ca4955b43c57c77e0b7c726f7fc"}, "originalPosition": 25}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "7afb9b9791e4cd54996e5a566c5a847908d570cb", "author": {"user": {"login": "Patbox", "name": null}}, "url": "https://github.com/Slimefun/Slimefun4/commit/7afb9b9791e4cd54996e5a566c5a847908d570cb", "committedDate": "2020-12-05T19:51:30Z", "message": "Implement more suggestions"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTQ5MDc4NzQw", "url": "https://github.com/Slimefun/Slimefun4/pull/2595#pullrequestreview-549078740", "createdAt": "2020-12-10T10:56:54Z", "commit": {"oid": "7afb9b9791e4cd54996e5a566c5a847908d570cb"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xMFQxMDo1Njo1NVrOIDDatg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xMFQxMDo1OToxNlrOIDDgsQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MDA3MjYzMA==", "bodyText": "I probably worded that wrongly, the null check is still required here, I simply meant that you could replace .isAir() with a Material.AIR check.\nBut either works tbh.\n\n  \n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                                if (!item.getType().isAir()) {\n          \n          \n            \n                                if (item != null && !item.getType().isAir()) {", "url": "https://github.com/Slimefun/Slimefun4/pull/2595#discussion_r540072630", "createdAt": "2020-12-10T10:56:55Z", "author": {"login": "TheBusyBiscuit"}, "path": "src/main/java/io/github/thebusybiscuit/slimefun4/implementation/listeners/BlockListener.java", "diffHunk": "@@ -58,8 +59,21 @@ public void onBlockPlaceExisting(BlockPlaceEvent e) {\n         // This prevents Players from placing a block where another block already exists\n         // While this can cause ghost blocks it also prevents them from replacing grass\n         // or saplings etc...\n-        if (BlockStorage.hasBlockInfo(e.getBlock())) {\n-            e.setCancelled(true);\n+        Block block = e.getBlock();\n+\n+        if (e.getBlockReplacedState().getType().isAir()) {\n+            SlimefunItem sfItem = BlockStorage.check(block);\n+\n+            if (sfItem != null) {\n+                for (ItemStack item : sfItem.getDrops()) {\n+                    if (!item.getType().isAir()) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "7afb9b9791e4cd54996e5a566c5a847908d570cb"}, "originalPosition": 27}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MDA3NDE2MQ==", "bodyText": "I would suggest to add a fallback here, because the BlockPlaceEvent will also be called when a Player tries to place the block in the same space as tall grass or other passable materials.\nFor these, we want to cancel it nonetheless as they would need to destroy the block first.\n\n  \n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                    }\n          \n          \n            \n                    } else if (BlockStorage.hasBlockInfo(e.getBlock())) {\n          \n          \n            \n                        e.setCancelled(true);\n          \n          \n            \n                    }", "url": "https://github.com/Slimefun/Slimefun4/pull/2595#discussion_r540074161", "createdAt": "2020-12-10T10:59:16Z", "author": {"login": "TheBusyBiscuit"}, "path": "src/main/java/io/github/thebusybiscuit/slimefun4/implementation/listeners/BlockListener.java", "diffHunk": "@@ -58,8 +59,21 @@ public void onBlockPlaceExisting(BlockPlaceEvent e) {\n         // This prevents Players from placing a block where another block already exists\n         // While this can cause ghost blocks it also prevents them from replacing grass\n         // or saplings etc...\n-        if (BlockStorage.hasBlockInfo(e.getBlock())) {\n-            e.setCancelled(true);\n+        Block block = e.getBlock();\n+\n+        if (e.getBlockReplacedState().getType().isAir()) {\n+            SlimefunItem sfItem = BlockStorage.check(block);\n+\n+            if (sfItem != null) {\n+                for (ItemStack item : sfItem.getDrops()) {\n+                    if (!item.getType().isAir()) {\n+                        block.getWorld().dropItemNaturally(block.getLocation(), item);\n+                    }\n+                }\n+                BlockStorage.clearBlockInfo(block);\n+            } else {\n+                e.setCancelled(true);\n+            }\n         }", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "7afb9b9791e4cd54996e5a566c5a847908d570cb"}, "originalPosition": 35}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "28e5771ca8068576b883e5c2c9ce27278ef0d13c", "author": {"user": {"login": "Patbox", "name": null}}, "url": "https://github.com/Slimefun/Slimefun4/commit/28e5771ca8068576b883e5c2c9ce27278ef0d13c", "committedDate": "2020-12-10T11:38:31Z", "message": "Implement more suggestions"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTQ5MTEyNzYy", "url": "https://github.com/Slimefun/Slimefun4/pull/2595#pullrequestreview-549112762", "createdAt": "2020-12-10T11:41:33Z", "commit": {"oid": "28e5771ca8068576b883e5c2c9ce27278ef0d13c"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTQ5MzU0OTM4", "url": "https://github.com/Slimefun/Slimefun4/pull/2595#pullrequestreview-549354938", "createdAt": "2020-12-10T16:07:40Z", "commit": {"oid": "28e5771ca8068576b883e5c2c9ce27278ef0d13c"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTQ5NTkwNTg2", "url": "https://github.com/Slimefun/Slimefun4/pull/2595#pullrequestreview-549590586", "createdAt": "2020-12-10T20:50:24Z", "commit": {"oid": "28e5771ca8068576b883e5c2c9ce27278ef0d13c"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2591, "cost": 1, "resetAt": "2021-11-02T10:47:05Z"}}}