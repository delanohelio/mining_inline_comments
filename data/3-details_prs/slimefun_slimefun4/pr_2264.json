{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDc1OTIxNTMy", "number": 2264, "title": "Fixes #2263", "bodyText": "Description\n\nMade coolers also saturate the player when they get hunger damage.\nChanges\n\nMade it so when a player gets hunger damage they use their cooler.\nRelated Issues\n\n\nFixes #2263\nChecklist\n\n\n\n I have fully tested the proposed changes and promise that they will not break everything into chaos.\n I have also tested the proposed changes in combination with various popular addons and can confirm my changes do not break them.\n I followed the existing code standards and didn't mess up the formatting.\n I did my best to add documentation to any public classes or methods I added.\n I added sufficient Unit Tests to cover my code.\n\nNote: I did these changes ftom mobile. So yeah... it needs testing and I can't do that.", "createdAt": "2020-08-30T14:55:36Z", "url": "https://github.com/Slimefun/Slimefun4/pull/2264", "merged": true, "mergeCommit": {"oid": "2eeb0a9eee8d3b417a30a08adee6f5b301472231"}, "closed": true, "closedAt": "2020-08-30T16:42:58Z", "author": {"login": "LinoxGH"}, "timelineItems": {"totalCount": 14, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdD_cCTgH2gAyNDc1OTIxNTMyOmUwOTE0YWY2ZDljN2QxMzcyYjY1OWIxOGVmMWQ1NzYyYWIwMTEzMzg=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdEA_ghAFqTQ3ODIxNzgxMw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "e0914af6d9c7d1372b659b18ef1d5762ab011338", "author": {"user": {"login": "LinoxGH", "name": null}}, "url": "https://github.com/Slimefun/Slimefun4/commit/e0914af6d9c7d1372b659b18ef1d5762ab011338", "committedDate": "2020-08-30T14:53:39Z", "message": "Fixes #2263"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDc4MjEwNTI5", "url": "https://github.com/Slimefun/Slimefun4/pull/2264#pullrequestreview-478210529", "createdAt": "2020-08-30T14:59:43Z", "commit": {"oid": "e0914af6d9c7d1372b659b18ef1d5762ab011338"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDc4MjEwNjAy", "url": "https://github.com/Slimefun/Slimefun4/pull/2264#pullrequestreview-478210602", "createdAt": "2020-08-30T15:00:41Z", "commit": {"oid": "e0914af6d9c7d1372b659b18ef1d5762ab011338"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0zMFQxNTowMDo0MVrOHJjePA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0zMFQxNTowMDo1OFrOHJjeVQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3OTc4MDQxMg==", "bodyText": "You can remove the \"EntityDamageEvent\" here, it's already imported.", "url": "https://github.com/Slimefun/Slimefun4/pull/2264#discussion_r479780412", "createdAt": "2020-08-30T15:00:41Z", "author": {"login": "TheBusyBiscuit"}, "path": "src/main/java/io/github/thebusybiscuit/slimefun4/implementation/listeners/CoolerListener.java", "diffHunk": "@@ -47,14 +49,29 @@ public void onHungerLoss(FoodLevelChangeEvent e) {\n         Player p = (Player) e.getEntity();\n \n         if (e.getFoodLevel() < p.getFoodLevel()) {\n-            for (ItemStack item : p.getInventory().getContents()) {\n-                if (cooler.isItem(item)) {\n-                    if (Slimefun.hasUnlocked(p, cooler, true)) {\n-                        takeJuiceFromCooler(p, item);\n-                    }\n-                    else {\n-                        return;\n-                    }\n+            checkAndConsume(p);\n+        }\n+    }\n+    \n+    @EventHandler\n+    public void onHungerDamage(EntityDamageEvent e) {\n+        if (cooler == null || cooler.isDisabled()) {\n+            return;\n+        }\n+        \n+        if (e.getCause() == EntityDamageEvent.DamageCause.STARVATION) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e0914af6d9c7d1372b659b18ef1d5762ab011338"}, "originalPosition": 44}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3OTc4MDQzNw==", "bodyText": "You will need to check whether the Entity is actually a Player first before casting.", "url": "https://github.com/Slimefun/Slimefun4/pull/2264#discussion_r479780437", "createdAt": "2020-08-30T15:00:58Z", "author": {"login": "TheBusyBiscuit"}, "path": "src/main/java/io/github/thebusybiscuit/slimefun4/implementation/listeners/CoolerListener.java", "diffHunk": "@@ -47,14 +49,29 @@ public void onHungerLoss(FoodLevelChangeEvent e) {\n         Player p = (Player) e.getEntity();\n \n         if (e.getFoodLevel() < p.getFoodLevel()) {\n-            for (ItemStack item : p.getInventory().getContents()) {\n-                if (cooler.isItem(item)) {\n-                    if (Slimefun.hasUnlocked(p, cooler, true)) {\n-                        takeJuiceFromCooler(p, item);\n-                    }\n-                    else {\n-                        return;\n-                    }\n+            checkAndConsume(p);\n+        }\n+    }\n+    \n+    @EventHandler\n+    public void onHungerDamage(EntityDamageEvent e) {\n+        if (cooler == null || cooler.isDisabled()) {\n+            return;\n+        }\n+        \n+        if (e.getCause() == EntityDamageEvent.DamageCause.STARVATION) {\n+            checkAndConsume((Player) e.getEntity());", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e0914af6d9c7d1372b659b18ef1d5762ab011338"}, "originalPosition": 45}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "cdb6eeab968a957f544f45c9f0e33e513690df47", "author": {"user": {"login": "LinoxGH", "name": null}}, "url": "https://github.com/Slimefun/Slimefun4/commit/cdb6eeab968a957f544f45c9f0e33e513690df47", "committedDate": "2020-08-30T15:13:45Z", "message": "Did the requested changes."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "3d0c642477622f9d2487b81d4a8a22f49152f63c", "author": {"user": {"login": "LinoxGH", "name": null}}, "url": "https://github.com/Slimefun/Slimefun4/commit/3d0c642477622f9d2487b81d4a8a22f49152f63c", "committedDate": "2020-08-30T15:14:39Z", "message": "Added an additional check for Wind Staff"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a8f6f51724b3ce37435ad00e67b6df7ac66a66a9", "author": {"user": {"login": "LinoxGH", "name": null}}, "url": "https://github.com/Slimefun/Slimefun4/commit/a8f6f51724b3ce37435ad00e67b6df7ac66a66a9", "committedDate": "2020-08-30T15:15:31Z", "message": "Added a new message."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e8498f8c0c3daf85b84906cb841a6d56eabec72e", "author": {"user": {"login": "LinoxGH", "name": null}}, "url": "https://github.com/Slimefun/Slimefun4/commit/e8498f8c0c3daf85b84906cb841a6d56eabec72e", "committedDate": "2020-08-30T15:15:59Z", "message": "Update CHANGELOG.md"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDc4MjExODAz", "url": "https://github.com/Slimefun/Slimefun4/pull/2264#pullrequestreview-478211803", "createdAt": "2020-08-30T15:17:43Z", "commit": {"oid": "e8498f8c0c3daf85b84906cb841a6d56eabec72e"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0zMFQxNToxNzo0NFrOHJjlFA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0zMFQxNToxNzo0NFrOHJjlFA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3OTc4MjE2NA==", "bodyText": "I don't think we should send a message here, if the FoodLevelChangeEvent was cancelled, then we should simply not consume any hunger points. The wind staff itself did not fail, if the event was cancelled, this is most likely because that server doesn't use the hunger system...", "url": "https://github.com/Slimefun/Slimefun4/pull/2264#discussion_r479782164", "createdAt": "2020-08-30T15:17:44Z", "author": {"login": "TheBusyBiscuit"}, "path": "src/main/java/io/github/thebusybiscuit/slimefun4/implementation/items/magical/WindStaff.java", "diffHunk": "@@ -31,6 +31,11 @@ public ItemUseHandler getItemHandler() {\n                 if (p.getInventory().getItemInMainHand().getType() != Material.SHEARS && p.getGameMode() != GameMode.CREATIVE) {\n                     FoodLevelChangeEvent event = new FoodLevelChangeEvent(p, p.getFoodLevel() - 2);\n                     Bukkit.getPluginManager().callEvent(event);\n+                    \n+                    if (event.isCancelled()) {\n+                        SlimefunPlugin.getLocalization().sendMessage(p, \"messages.wind-staff-fail\", true);\n+                        return;\n+                    }", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e8498f8c0c3daf85b84906cb841a6d56eabec72e"}, "originalPosition": 8}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "dffc5758e28c0a00c193f76bf6d0347e6b30b5ae", "author": {"user": {"login": "LinoxGH", "name": null}}, "url": "https://github.com/Slimefun/Slimefun4/commit/dffc5758e28c0a00c193f76bf6d0347e6b30b5ae", "committedDate": "2020-08-30T15:21:50Z", "message": "Fixed compilation error."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "305dd57b3950670ad1b2e6ce0580ed84da613d3b", "author": {"user": {"login": "LinoxGH", "name": null}}, "url": "https://github.com/Slimefun/Slimefun4/commit/305dd57b3950670ad1b2e6ce0580ed84da613d3b", "committedDate": "2020-08-30T15:25:08Z", "message": "Did the requested change."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "bfc84d03b27169f8fd7e4411e60d2ef75904be1b", "author": {"user": {"login": "LinoxGH", "name": null}}, "url": "https://github.com/Slimefun/Slimefun4/commit/bfc84d03b27169f8fd7e4411e60d2ef75904be1b", "committedDate": "2020-08-30T15:26:12Z", "message": "Undid the changes to language files."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDc4MjEyNzkw", "url": "https://github.com/Slimefun/Slimefun4/pull/2264#pullrequestreview-478212790", "createdAt": "2020-08-30T15:31:42Z", "commit": {"oid": "bfc84d03b27169f8fd7e4411e60d2ef75904be1b"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0zMFQxNTozMTo0MlrOHJjqaQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0zMFQxNTozMTo0MlrOHJjqaQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3OTc4MzUyOQ==", "bodyText": "\"or an\", not \"and a\"", "url": "https://github.com/Slimefun/Slimefun4/pull/2264#discussion_r479783529", "createdAt": "2020-08-30T15:31:42Z", "author": {"login": "TheBusyBiscuit"}, "path": "src/main/java/io/github/thebusybiscuit/slimefun4/implementation/listeners/CoolerListener.java", "diffHunk": "@@ -19,10 +21,11 @@\n import me.mrCookieSlime.Slimefun.api.Slimefun;\n \n /**\n- * This {@link Listener} listens for a {@link FoodLevelChangeEvent} and consumes a {@link Juice}\n- * from any {@link Cooler} that can be found in the {@link Inventory} of the given {@link Player}.\n+ * This {@link Listener} listens for a {@link FoodLevelChangeEvent} and a {@link EntityDamageEvent} for starvation damage", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "bfc84d03b27169f8fd7e4411e60d2ef75904be1b"}, "originalPosition": 15}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "918edbeeb1bfdb7e441fbb5fac0731835f7ab69b", "author": {"user": {"login": "LinoxGH", "name": null}}, "url": "https://github.com/Slimefun/Slimefun4/commit/918edbeeb1bfdb7e441fbb5fac0731835f7ab69b", "committedDate": "2020-08-30T15:42:57Z", "message": "Fixed the javadocs."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDc4MjE3ODEz", "url": "https://github.com/Slimefun/Slimefun4/pull/2264#pullrequestreview-478217813", "createdAt": "2020-08-30T16:42:18Z", "commit": {"oid": "918edbeeb1bfdb7e441fbb5fac0731835f7ab69b"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2441, "cost": 1, "resetAt": "2021-11-02T10:47:05Z"}}}