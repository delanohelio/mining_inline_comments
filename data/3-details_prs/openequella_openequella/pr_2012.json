{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDQ1MTk3MzE4", "number": 2012, "title": "Refactor the LoginNotice settings pages to use the new SettingsPageTemplate", "bodyText": "Checklist\n\n\n the contributor license agreement is signed\n commit message follows commit guidelines\n tests are included\n screenshots are included showing significant UI changes\n documentation is changed or added\n\nDescription of change\n\nThis is the second in a series following on from #1990 and is an attempt to standardise our settings pages with the new pattern established with the New Search UI work.\nThis work involved:\n\nRemoval of tab layout for notice editors;\nRemoval of custom save button and snackbar/notifications;\nReworking save methods and handlers;\nCombining the two editors under the new SettingsPageTemplate instead;\nReworking the ScalaCheck tests - however this was nicely isolated in the Page class due to reasonable abstraction of processes\n\nAttempted to fit in with what was there as much as possible and undertook minimal component level refactoring. And it seemed it had most of what was needed for triggers for the SettingsPageTemplate for prevent nav, etc.\nThere is a known existing issue with TinyMCE at the moment (on develop and all sibling branches), so please ignore that in the below screenshot. (It will be fixed soon elsewhere.)", "createdAt": "2020-07-07T06:56:37Z", "url": "https://github.com/openequella/openEQUELLA/pull/2012", "merged": true, "mergeCommit": {"oid": "2551b3ed83f229900d40f90ae0509dca53cd46ae"}, "closed": true, "closedAt": "2020-07-08T04:12:40Z", "author": {"login": "edalex-ian"}, "timelineItems": {"totalCount": 7, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcyfvEjAH2gAyNDQ1MTk3MzE4OjczYmM2NDQzMGQ4YTA1MmJhMDM3ODI2NGI4MjAxYTQzYzIyZTYwN2U=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcyyB5KgFqTQ0NDM5MDc3Mw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "73bc64430d8a052ba0378264b8201a43c22e607e", "author": {"user": {"login": "edalex-ian", "name": null}}, "url": "https://github.com/openequella/openEQUELLA/commit/73bc64430d8a052ba0378264b8201a43c22e607e", "committedDate": "2020-07-07T06:20:46Z", "message": "Refactor Login Notice settings pages to use SettingPageTemplate"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "75f2cd133860d15c37e57dfaf6e20f0c7cf9d85c", "author": {"user": {"login": "edalex-ian", "name": null}}, "url": "https://github.com/openequella/openEQUELLA/commit/75f2cd133860d15c37e57dfaf6e20f0c7cf9d85c", "committedDate": "2020-07-07T06:20:46Z", "message": "Rework LoginNoticeMenuPropertiesSerial\n\nNeeded updates to support the UI refactor."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDQ0MzQzMjA3", "url": "https://github.com/openequella/openEQUELLA/pull/2012#pullrequestreview-444343207", "createdAt": "2020-07-08T00:54:52Z", "commit": {"oid": "75f2cd133860d15c37e57dfaf6e20f0c7cf9d85c"}, "state": "APPROVED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wOFQwMDo1NDo1MlrOGuUb5g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wOFQwMDo1NTo1M1rOGuUdAw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MTIyMjUwMg==", "bodyText": "Was there a push to remove ? operators and replace them with null checks? Or am I misremembering?", "url": "https://github.com/openequella/openEQUELLA/pull/2012#discussion_r451222502", "createdAt": "2020-07-08T00:54:52Z", "author": {"login": "SammyIsConfused"}, "path": "Source/Plugins/Core/com.equella.core/js/tsrc/loginnotice/LoginNoticeConfigPage.tsx", "diffHunk": "@@ -132,115 +93,47 @@ class LoginNoticeConfigPage extends React.Component<\n     }\n   };\n \n-  handleChangeTab = (event: React.ChangeEvent<{}>, selectedTab: number) => {\n-    this.setState({ selectedTab }, () =>\n-      this.props.updateTemplate((tp) => ({ ...tp, tabs: this.tabs() }))\n-    );\n-  };\n-\n   clearNotifications = () => {\n     this.setState({ notificationOpen: false });\n   };\n \n-  notificationString = (notificationType: NotificationType): string => {\n-    switch (notificationType) {\n-      case NotificationType.Revert:\n-        return strings.notifications.cancelled;\n-      case NotificationType.Clear:\n-        return strings.notifications.cleared;\n-      case NotificationType.Save:\n-        return strings.notifications.saved;\n-    }\n-  };\n-\n-  Notifications = () => {\n-    return (\n-      <MessageInfo\n-        title={this.notificationString(this.state.notifications)}\n-        open={this.state.notificationOpen}\n-        onClose={this.clearNotifications}\n-        variant=\"success\"\n-      />\n-    );\n-  };\n-\n-  notify = (notificationType: NotificationType) => {\n-    this.setState({ notificationOpen: true, notifications: notificationType });\n-  };\n-\n-  Configurators = () => {\n-    switch (this.state.selectedTab) {\n-      case 0:\n-        return (\n-          <PreLoginNoticeConfigurator\n-            handleError={this.handleError}\n-            notify={this.notify}\n-            ref={this.preLoginNoticeConfigurator}\n-            preventNav={this.preventNav}\n-          />\n-        );\n-      default:\n-        return (\n-          <PostLoginNoticeConfigurator\n-            handleError={this.handleError}\n-            notify={this.notify}\n-            ref={this.postLoginNoticeConfigurator}\n-            preventNav={this.preventNav}\n-          />\n-        );\n-    }\n-  };\n-\n-  handleSubmitButton = () => {\n-    switch (this.state.selectedTab) {\n-      case 0:\n-        if (this.preLoginNoticeConfigurator.current) {\n-          this.preLoginNoticeConfigurator.current.handleSubmitPreNotice();\n-        }\n-        break;\n-      default:\n-        if (this.postLoginNoticeConfigurator.current) {\n-          this.postLoginNoticeConfigurator.current.handleSubmitPostNotice();\n-        }\n-        break;\n+  save = async () => {\n+    try {\n+      await this.preLoginNoticeConfigurator.current?.save();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "75f2cd133860d15c37e57dfaf6e20f0c7cf9d85c"}, "originalPosition": 165}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MTIyMjc4Nw==", "bodyText": "JSDoc strings should start with a capital letter.", "url": "https://github.com/openequella/openEQUELLA/pull/2012#discussion_r451222787", "createdAt": "2020-07-08T00:55:53Z", "author": {"login": "SammyIsConfused"}, "path": "Source/Plugins/Core/com.equella.core/js/tsrc/loginnotice/PostLoginNoticeConfigurator.tsx", "diffHunk": "@@ -29,24 +29,28 @@ import { commonString } from \"../util/commonstrings\";\n import {\n   clearPostLoginNotice,\n   getPostLoginNotice,\n-  NotificationType,\n-  submitPostLoginNotice,\n   strings,\n+  submitPostLoginNotice,\n } from \"./LoginNoticeModule\";\n import { AxiosError, AxiosResponse } from \"axios\";\n import Dialog from \"@material-ui/core/Dialog\";\n import DialogTitle from \"@material-ui/core/DialogTitle\";\n import DialogActions from \"@material-ui/core/DialogActions\";\n+import SettingsListHeading from \"../components/SettingsListHeading\";\n \n interface PostLoginNoticeConfiguratorProps {\n   handleError: (axiosError: AxiosError) => void;\n-  notify: (notificationType: NotificationType) => void;\n   preventNav: (prevNav: boolean) => void;\n }\n \n interface PostLoginNoticeConfiguratorState {\n-  postNotice?: string; //what is currently in the textfield\n-  dbPostNotice?: string; //what is currently in the database\n+  /** what is currently in the textfield */\n+  postNotice?: string;\n+\n+  /** what is currently in the database */", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "75f2cd133860d15c37e57dfaf6e20f0c7cf9d85c"}, "originalPosition": 27}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDQ0MzUyMzIw", "url": "https://github.com/openequella/openEQUELLA/pull/2012#pullrequestreview-444352320", "createdAt": "2020-07-08T01:26:40Z", "commit": {"oid": "75f2cd133860d15c37e57dfaf6e20f0c7cf9d85c"}, "state": "APPROVED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wOFQwMToyNjo0MFrOGuU7Lw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wOFQwMTozMTowMFrOGuU_fw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MTIzMDUxMQ==", "bodyText": "Do we need to catch errors here ?\nAlso, I would try then((data) => this.setState({ dbPostNotice: data.postNotice }) in case that server slightly changes the notice such as doing a toLowercase() . But I don't know much about what has done for this feature, so this should be fine.", "url": "https://github.com/openequella/openEQUELLA/pull/2012#discussion_r451230511", "createdAt": "2020-07-08T01:26:40Z", "author": {"login": "PenghaiZhang"}, "path": "Source/Plugins/Core/com.equella.core/js/tsrc/loginnotice/PostLoginNoticeConfigurator.tsx", "diffHunk": "@@ -63,36 +67,15 @@ class PostLoginNoticeConfigurator extends React.Component<\n     };\n   }\n \n-  handleSubmitPostNotice = () => {\n-    if (this.state.postNotice != undefined) {\n-      submitPostLoginNotice(this.state.postNotice)\n-        .then(() => {\n-          this.props.notify(NotificationType.Save);\n-          this.setState({ dbPostNotice: this.state.postNotice });\n-          this.props.preventNav(false);\n-        })\n-        .catch((error: AxiosError) => {\n-          this.props.handleError(error);\n-        });\n-    }\n-  };\n+  save = async () =>\n+    (this.state.postNotice\n+      ? submitPostLoginNotice(this.state.postNotice)\n+      : clearPostLoginNotice()\n+    ).then(() => this.setState({ dbPostNotice: this.state.postNotice }));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "75f2cd133860d15c37e57dfaf6e20f0c7cf9d85c"}, "originalPosition": 55}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MTIzMTYxNQ==", "bodyText": "Just a query: the name of this component implies that it is created for settings, but do we want to reuse it in other non-setting cards or use CardHeader?", "url": "https://github.com/openequella/openEQUELLA/pull/2012#discussion_r451231615", "createdAt": "2020-07-08T01:31:00Z", "author": {"login": "PenghaiZhang"}, "path": "Source/Plugins/Core/com.equella.core/js/tsrc/loginnotice/PostLoginNoticeConfigurator.tsx", "diffHunk": "@@ -119,40 +102,13 @@ class PostLoginNoticeConfigurator extends React.Component<\n     this.setState({ clearStaged: true });\n   };\n \n-  Dialogs = () => {\n-    return (\n-      <div>\n-        <Dialog\n-          open={this.state.clearStaged}\n-          onClose={() => this.setState({ clearStaged: false })}\n-        >\n-          <DialogTitle>{strings.clear.title}</DialogTitle>\n-          <DialogContent>\n-            <DialogContentText>{strings.clear.confirm}</DialogContentText>\n-          </DialogContent>\n-          <DialogActions>\n-            <Button id=\"okToClear\" onClick={this.handleClearPostNotice}>\n-              {commonString.action.ok}\n-            </Button>\n-            <Button\n-              id=\"cancelClear\"\n-              onClick={() => this.setState({ clearStaged: false })}\n-            >\n-              {commonString.action.cancel}\n-            </Button>\n-          </DialogActions>\n-        </Dialog>\n-      </div>\n-    );\n-  };\n-\n   render() {\n     const { postNotice, dbPostNotice } = this.state;\n-    const Dialogs = this.Dialogs;\n     return (\n       <>\n         <Card>\n           <CardContent>\n+            <SettingsListHeading heading={strings.postLogin.title} />", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "75f2cd133860d15c37e57dfaf6e20f0c7cf9d85c"}, "originalPosition": 116}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e29e7ada2702fe4baef40edeeb5e8e22e5002891", "author": {"user": {"login": "edalex-ian", "name": null}}, "url": "https://github.com/openequella/openEQUELLA/commit/e29e7ada2702fe4baef40edeeb5e8e22e5002891", "committedDate": "2020-07-08T01:33:00Z", "message": "Tidy up PostLoginNoticeConfigurator JSDoc\n\nFeedback from PR #2012"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDQ0MzU3OTYx", "url": "https://github.com/openequella/openEQUELLA/pull/2012#pullrequestreview-444357961", "createdAt": "2020-07-08T01:45:56Z", "commit": {"oid": "e29e7ada2702fe4baef40edeeb5e8e22e5002891"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDQ0MzkwNzcz", "url": "https://github.com/openequella/openEQUELLA/pull/2012#pullrequestreview-444390773", "createdAt": "2020-07-08T03:39:37Z", "commit": {"oid": "e29e7ada2702fe4baef40edeeb5e8e22e5002891"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4935, "cost": 1, "resetAt": "2021-11-01T16:37:27Z"}}}