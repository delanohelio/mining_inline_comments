{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDE1OTA5MDE1", "number": 1721, "title": "Fix the mandatory fields bug in moderation", "bodyText": "Checklist\n\n\n the contributor license agreement is signed\n commit message follows commit guidelines\n tests are included\n screenshots are included showing significant UI changes\n documentation is changed or added\n\nDescription of change\n\n#1678\nThere were a couple other areas in which the mandatory fields check happened - during SaveAndContinue, and during EditInWizard (moderation edits). These were missed during #1708, as the steps to reproduce didn't involve moderation.\nA test has been added (VisibilityScriptingBugTest) to verifiy this has been fixed.\nThis also includes editing the vanilla institution, which is where the large modified file count comes from. To review just relevant files, add a file filter just allowing .java and .yml files.", "createdAt": "2020-05-11T07:02:49Z", "url": "https://github.com/openequella/openEQUELLA/pull/1721", "merged": true, "mergeCommit": {"oid": "c1945a1fe8c57d9cd8641b155e496184a6fa284b"}, "closed": true, "closedAt": "2020-05-13T06:37:34Z", "author": {"login": "SammyIsConfused"}, "timelineItems": {"totalCount": 12, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcgKG09AH2gAyNDE1OTA5MDE1OjMwZDY2YmIxMTA1NjA4MzA4YjVjZGUxOTRjNzBkYjY5OTgwYjc5ZWQ=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcgy_kogH2gAyNDE1OTA5MDE1OmZkODg1MDRiMjE5NTJkN2NmOGY1NDRkZTdkMzllOWI4YjgxZmZhY2I=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "30d66bb1105608308b5cde194c70db69980b79ed", "author": {"user": null}, "url": "https://github.com/openequella/openEQUELLA/commit/30d66bb1105608308b5cde194c70db69980b79ed", "committedDate": "2020-05-11T06:58:10Z", "message": "Fix the mandatory fields bug in EditInWizard and SaveAndContinue"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDA4OTM0NjM4", "url": "https://github.com/openequella/openEQUELLA/pull/1721#pullrequestreview-408934638", "createdAt": "2020-05-11T07:45:19Z", "commit": {"oid": "30d66bb1105608308b5cde194c70db69980b79ed"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "53ad1da82a3547210ee82a2238d5f9991d59c5f0", "author": {"user": null}, "url": "https://github.com/openequella/openEQUELLA/commit/53ad1da82a3547210ee82a2238d5f9991d59c5f0", "committedDate": "2020-05-12T05:46:46Z", "message": "Consolidate EditInWizard and SaveAndContinue validation\n\nBy inserting a function to WizardCommand.java. Note: The\nRootWizardSection validation could not be consolidated with this,\nas they do not share common inheritance."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "808ed8a9cc1c11df05065416523334bce18c3e5a", "author": {"user": null}, "url": "https://github.com/openequella/openEQUELLA/commit/808ed8a9cc1c11df05065416523334bce18c3e5a", "committedDate": "2020-05-13T02:21:58Z", "message": "Update vanilla institution to support the new test\n\nInvolved adding users and roles,\na new collection and changing permissions."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "45c324c0d85601ce254bcf12280c14dd8454ab3f", "author": {"user": null}, "url": "https://github.com/openequella/openEQUELLA/commit/45c324c0d85601ce254bcf12280c14dd8454ab3f", "committedDate": "2020-05-13T02:23:54Z", "message": "Add VisibilityScriptingBugTest.java"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "bc04cec8ab0a0c4e93ac4613c5af4687d68984bb", "author": {"user": null}, "url": "https://github.com/openequella/openEQUELLA/commit/bc04cec8ab0a0c4e93ac4613c5af4687d68984bb", "committedDate": "2020-05-13T02:24:42Z", "message": "Add test to CI"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "0a3f4c9589215de7a85503abd14c93b81167a25f", "author": {"user": null}, "url": "https://github.com/openequella/openEQUELLA/commit/0a3f4c9589215de7a85503abd14c93b81167a25f", "committedDate": "2020-05-13T02:41:44Z", "message": "Remove unnecessary files from institution so it will import properly"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "3389742f1b5291847259e691b186880941146013", "author": {"user": null}, "url": "https://github.com/openequella/openEQUELLA/commit/3389742f1b5291847259e691b186880941146013", "committedDate": "2020-05-12T07:18:14Z", "message": "Add loaded check before save in test"}, "afterCommit": {"oid": "0a3f4c9589215de7a85503abd14c93b81167a25f", "author": {"user": null}, "url": "https://github.com/openequella/openEQUELLA/commit/0a3f4c9589215de7a85503abd14c93b81167a25f", "committedDate": "2020-05-13T02:41:44Z", "message": "Remove unnecessary files from institution so it will import properly"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "db96d60a8df7c7600b375f0bbf60e4db8d7aaacd", "author": {"user": null}, "url": "https://github.com/openequella/openEQUELLA/commit/db96d60a8df7c7600b375f0bbf60e4db8d7aaacd", "committedDate": "2020-05-13T03:15:36Z", "message": "Start in old UI\n\nThis institution was starting in the old UI. This messes up some tests."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDEwNTg2MDA1", "url": "https://github.com/openequella/openEQUELLA/pull/1721#pullrequestreview-410586005", "createdAt": "2020-05-13T04:53:48Z", "commit": {"oid": "db96d60a8df7c7600b375f0bbf60e4db8d7aaacd"}, "state": "APPROVED", "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xM1QwNDo1Mzo0OFrOGUhX6g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xM1QwNDo1NjozNFrOGUhaeQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNDE3MTQ5OA==", "bodyText": "Seeing this is matching DATE you should derive it from DATE even if that's storing it in a constant.", "url": "https://github.com/openequella/openEQUELLA/pull/1721#discussion_r424171498", "createdAt": "2020-05-13T04:53:48Z", "author": {"login": "edalex-ian"}, "path": "autotest/OldTests/src/test/java/com/tle/webtests/test/contribute/bugs/VisibilityScriptingBugTest.java", "diffHunk": "@@ -0,0 +1,94 @@\n+package com.tle.webtests.test.contribute.bugs;\n+\n+import static com.tle.webtests.framework.Assert.assertTrue;\n+\n+import com.tle.webtests.framework.TestInstitution;\n+import com.tle.webtests.pageobject.searching.SearchPage;\n+import com.tle.webtests.pageobject.viewitem.ItemXmlPage;\n+import com.tle.webtests.pageobject.viewitem.SummaryPage;\n+import com.tle.webtests.pageobject.wizard.ContributePage;\n+import com.tle.webtests.pageobject.wizard.WizardPageTab;\n+import com.tle.webtests.test.AbstractCleanupTest;\n+import java.util.Date;\n+import org.testng.annotations.Test;\n+\n+@TestInstitution(\"vanilla\")\n+public class VisibilityScriptingBugTest extends AbstractCleanupTest {\n+\n+  private static final String METADATA_INPUT_USER = \"cpddm\";\n+  private static final String TOGGLE_USER = \"csme\";\n+  private static final String ADMIN_USER = \"TLE_ADMINISTRATOR\";\n+  private static final String PASS = \"tle010\";\n+  private static final String COLLECTION = \"Test Wizard Issue\";\n+  private static final String ITEM_NAME = \"VisibilityScriptingBugTest - Lost Metadata Test Item 1\";\n+  private static final Date DATE = new Date(1589256742342L);\n+  private static final String DATE_AS_STRING = \"2020-05-12\";", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "db96d60a8df7c7600b375f0bbf60e4db8d7aaacd"}, "originalPosition": 25}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNDE3MTg2OA==", "bodyText": "Good to see the use of constants, but that sure is a lot. Keep in mind you only need them if you're using a value more than once. Also, for a big block like this best to sort them, and if they're related group them into (sorted) blocks. (A good example of this was just trying to find RADIO2 after I'd already found RADIO1.", "url": "https://github.com/openequella/openEQUELLA/pull/1721#discussion_r424171868", "createdAt": "2020-05-13T04:55:19Z", "author": {"login": "edalex-ian"}, "path": "autotest/OldTests/src/test/java/com/tle/webtests/test/contribute/bugs/VisibilityScriptingBugTest.java", "diffHunk": "@@ -0,0 +1,94 @@\n+package com.tle.webtests.test.contribute.bugs;\n+\n+import static com.tle.webtests.framework.Assert.assertTrue;\n+\n+import com.tle.webtests.framework.TestInstitution;\n+import com.tle.webtests.pageobject.searching.SearchPage;\n+import com.tle.webtests.pageobject.viewitem.ItemXmlPage;\n+import com.tle.webtests.pageobject.viewitem.SummaryPage;\n+import com.tle.webtests.pageobject.wizard.ContributePage;\n+import com.tle.webtests.pageobject.wizard.WizardPageTab;\n+import com.tle.webtests.test.AbstractCleanupTest;\n+import java.util.Date;\n+import org.testng.annotations.Test;\n+\n+@TestInstitution(\"vanilla\")\n+public class VisibilityScriptingBugTest extends AbstractCleanupTest {\n+\n+  private static final String METADATA_INPUT_USER = \"cpddm\";\n+  private static final String TOGGLE_USER = \"csme\";\n+  private static final String ADMIN_USER = \"TLE_ADMINISTRATOR\";\n+  private static final String PASS = \"tle010\";\n+  private static final String COLLECTION = \"Test Wizard Issue\";\n+  private static final String ITEM_NAME = \"VisibilityScriptingBugTest - Lost Metadata Test Item 1\";\n+  private static final Date DATE = new Date(1589256742342L);\n+  private static final String DATE_AS_STRING = \"2020-05-12\";\n+  private static final String EMAIL = \"test@test.com\";\n+  private static final String DROPDOWN = \"List 2\";\n+  private static final String CHECKBOX = \"one\";\n+  private static final String RADIO1 = \"Radio 1\";\n+  private static final String SHUFFLE1 = \"Shuffle 1\";\n+  private static final String SHUFFLE2 = \"Shuffle 2\";\n+  private static final String ROLE = \"System Administrator\";\n+  private static final String RADIO2 = \"Yes\";\n+  private static final String XML_PATH = \"item/itembody/\";\n+  private static final String ROLE_ID = \"ROLE_SYSTEM_ADMINISTRATOR\";\n+  private static final String USER_ID = \"4026b550-9a1f-4521-9b56-9ec737c02526\";", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "db96d60a8df7c7600b375f0bbf60e4db8d7aaacd"}, "originalPosition": 36}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNDE3MjE1Mw==", "bodyText": "Be worthwhile in this case to add JavaDoc to the class which has a link off to the GitHub issue.", "url": "https://github.com/openequella/openEQUELLA/pull/1721#discussion_r424172153", "createdAt": "2020-05-13T04:56:34Z", "author": {"login": "edalex-ian"}, "path": "autotest/OldTests/src/test/java/com/tle/webtests/test/contribute/bugs/VisibilityScriptingBugTest.java", "diffHunk": "@@ -0,0 +1,94 @@\n+package com.tle.webtests.test.contribute.bugs;\n+\n+import static com.tle.webtests.framework.Assert.assertTrue;\n+\n+import com.tle.webtests.framework.TestInstitution;\n+import com.tle.webtests.pageobject.searching.SearchPage;\n+import com.tle.webtests.pageobject.viewitem.ItemXmlPage;\n+import com.tle.webtests.pageobject.viewitem.SummaryPage;\n+import com.tle.webtests.pageobject.wizard.ContributePage;\n+import com.tle.webtests.pageobject.wizard.WizardPageTab;\n+import com.tle.webtests.test.AbstractCleanupTest;\n+import java.util.Date;\n+import org.testng.annotations.Test;\n+\n+@TestInstitution(\"vanilla\")\n+public class VisibilityScriptingBugTest extends AbstractCleanupTest {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "db96d60a8df7c7600b375f0bbf60e4db8d7aaacd"}, "originalPosition": 16}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDEwNjAxODg4", "url": "https://github.com/openequella/openEQUELLA/pull/1721#pullrequestreview-410601888", "createdAt": "2020-05-13T05:41:56Z", "commit": {"oid": "db96d60a8df7c7600b375f0bbf60e4db8d7aaacd"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "fd88504b21952d7cf8f544de7d39e9b8b81ffacb", "author": {"user": null}, "url": "https://github.com/openequella/openEQUELLA/commit/fd88504b21952d7cf8f544de7d39e9b8b81ffacb", "committedDate": "2020-05-13T06:36:21Z", "message": "Add JavaDoc to the test and tidy up the constants"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 103, "cost": 1, "resetAt": "2021-11-01T16:19:10Z"}}}