{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDc4MjU3ODQ3", "number": 2253, "title": "Modify /search2 to return a list of words to highlight", "bodyText": "Checklist\n\n\n the contributor license agreement is signed\n commit message follows commit guidelines\n tests are included\n\nDescription of change\n\nIn the New Search UI we plan to highlight matching terms as they were done in the legacy UI. To emulate this, we need the search endpoint to return the list of words to highlight based on the query. This here PR does that.\nAs well as that, I did some minor unrelated refactoring of DefaultSearch.QueryParser as I was reading code - so I thought I might as well include it here (contained in ce0e9cc). Also while adding a test for this, I did some tidy-up of Search2ApiTest. And also as an aside, so that I could document the new SearchResult param, I also documented all the others.", "createdAt": "2020-09-03T00:16:23Z", "url": "https://github.com/openequella/openEQUELLA/pull/2253", "merged": true, "mergeCommit": {"oid": "52e0c9a2cd5fcf507428fced292aaea71e6244a8"}, "closed": true, "closedAt": "2020-09-03T05:35:44Z", "author": {"login": "edalex-ian"}, "timelineItems": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdFFG6eAH2gAyNDc4MjU3ODQ3OmNlMGU5Y2NlNGE4MDg1NDM5NjcwODk5MmVmYTU0OGQzMWFiM2Y1ZTE=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdFJoduAFqTQ4MTQ5OTU3Ng==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "ce0e9cce4a80854396708992efa548d31ab3f5e1", "author": {"user": {"login": "edalex-ian", "name": null}}, "url": "https://github.com/openequella/openEQUELLA/commit/ce0e9cce4a80854396708992efa548d31ab3f5e1", "committedDate": "2020-09-03T00:03:56Z", "message": "Update DefaultSearch.QueryParser for Java 8\n\nThat is, use the enhanced for loop; and diamond operator for generic constructors.\n\nWhile at it, remove an unused variable (tokens) and some old NLS comments."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ef3901efe1c89b90e71208ed2fcfd95f57f15c94", "author": {"user": {"login": "edalex-ian", "name": null}}, "url": "https://github.com/openequella/openEQUELLA/commit/ef3901efe1c89b90e71208ed2fcfd95f57f15c94", "committedDate": "2020-09-03T00:06:01Z", "message": "Return words to hightlight from /search2\n\nWe need to return which words should be highlighted from a query, so the New UI can emulate the word highlighting in search results of the legacy UI."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDgxMzk2NTEw", "url": "https://github.com/openequella/openEQUELLA/pull/2253#pullrequestreview-481396510", "createdAt": "2020-09-03T00:16:48Z", "commit": {"oid": "ef3901efe1c89b90e71208ed2fcfd95f57f15c94"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wM1QwMDoxNjo0OVrOHMQU1A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wM1QwMDoxNjo0OVrOHMQU1A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MjYxMjQzNg==", "bodyText": "This wasn't used - other than to store values (never read from).", "url": "https://github.com/openequella/openEQUELLA/pull/2253#discussion_r482612436", "createdAt": "2020-09-03T00:16:49Z", "author": {"login": "edalex-ian"}, "path": "Source/Plugins/Core/com.equella.base/src/com/tle/common/search/DefaultSearch.java", "diffHunk": "@@ -404,29 +404,26 @@ private boolean anyEmpty(Collection<?>... collections) {\n   }\n \n   public static class QueryParser {\n-    private final List<QueryToken> tokens;\n+\n     private final List<String> hilight;\n \n     public QueryParser(String query) {\n-      hilight = new ArrayList<String>();\n-      tokens = new ArrayList<QueryToken>();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ef3901efe1c89b90e71208ed2fcfd95f57f15c94"}, "originalPosition": 10}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDgxNDI1MTkw", "url": "https://github.com/openequella/openEQUELLA/pull/2253#pullrequestreview-481425190", "createdAt": "2020-09-03T01:40:25Z", "commit": {"oid": "ef3901efe1c89b90e71208ed2fcfd95f57f15c94"}, "state": "COMMENTED", "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wM1QwMTo0MDoyNVrOHMSI6w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wM1QwMTo0MjozNlrOHMSLNg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MjY0MjE1NQ==", "bodyText": "is this name specific to a library?\nIf not spelling it out fully could be nice\n\n  \n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                private final List<String> hilight;\n          \n          \n            \n                private final List<String> highlight;", "url": "https://github.com/openequella/openEQUELLA/pull/2253#discussion_r482642155", "createdAt": "2020-09-03T01:40:25Z", "author": {"login": "ChristianMurphy"}, "path": "Source/Plugins/Core/com.equella.base/src/com/tle/common/search/DefaultSearch.java", "diffHunk": "@@ -404,29 +404,26 @@ private boolean anyEmpty(Collection<?>... collections) {\n   }\n \n   public static class QueryParser {\n-    private final List<QueryToken> tokens;\n+\n     private final List<String> hilight;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ef3901efe1c89b90e71208ed2fcfd95f57f15c94"}, "originalPosition": 6}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MjY0MjIzOA==", "bodyText": "\ud83c\udfa8 \ud83d\udc4d", "url": "https://github.com/openequella/openEQUELLA/pull/2253#discussion_r482642238", "createdAt": "2020-09-03T01:40:44Z", "author": {"login": "ChristianMurphy"}, "path": "Source/Plugins/Core/com.equella.base/src/com/tle/common/search/DefaultSearch.java", "diffHunk": "@@ -404,29 +404,26 @@ private boolean anyEmpty(Collection<?>... collections) {\n   }\n \n   public static class QueryParser {\n-    private final List<QueryToken> tokens;\n+\n     private final List<String> hilight;\n \n     public QueryParser(String query) {\n-      hilight = new ArrayList<String>();\n-      tokens = new ArrayList<QueryToken>();\n+      hilight = new ArrayList<>();\n       parseQuery(query);\n     }\n \n     protected void parseQuery(final String query) {\n       final List<QueryToken> newTokens = QueryToken.tokenize(query);\n-      tokens.addAll(newTokens);\n \n-      for (int i = 0; i < newTokens.size(); i++) {\n-        final QueryToken qtok = newTokens.get(i);\n+      for (final QueryToken qtok : newTokens) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ef3901efe1c89b90e71208ed2fcfd95f57f15c94"}, "originalPosition": 21}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MjY0Mjc0Mg==", "bodyText": "\ud83c\udfa8 \ud83d\udc4d", "url": "https://github.com/openequella/openEQUELLA/pull/2253#discussion_r482642742", "createdAt": "2020-09-03T01:42:36Z", "author": {"login": "ChristianMurphy"}, "path": "Source/Plugins/Core/com.equella.core/scalasrc/com/tle/web/api/search/model/SearchResult.scala", "diffHunk": "@@ -18,4 +18,17 @@\n \n package com.tle.web.api.search.model\n \n-case class SearchResult[T](start: Int, length: Int, available: Int, results: List[T])\n+/**\n+  * Represents the results for a search query.\n+  *\n+  * @param start The starting offset into the total search results\n+  * @param length How many results can be found in `results`\n+  * @param available The maximum number of results available for paging\n+  * @param results The individual items which match the search\n+  * @param highlight List of words to use to highlight when displaying the results\n+  */", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ef3901efe1c89b90e71208ed2fcfd95f57f15c94"}, "originalPosition": 13}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDgxNDk5NTc2", "url": "https://github.com/openequella/openEQUELLA/pull/2253#pullrequestreview-481499576", "createdAt": "2020-09-03T05:20:12Z", "commit": {"oid": "ef3901efe1c89b90e71208ed2fcfd95f57f15c94"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 440, "cost": 1, "resetAt": "2021-11-01T16:19:10Z"}}}