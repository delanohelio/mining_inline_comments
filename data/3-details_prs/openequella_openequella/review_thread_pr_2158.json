{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDY1Mjg3MTMx", "number": 2158, "reviewThreads": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xMFQwNjoyNzo1MlrOEWq0wQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xMFQwNjoyNzo1MlrOEWq0wQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjkyMjA1NzYxOnYy", "diffSide": "RIGHT", "path": "Source/Plugins/Core/com.equella.core/src/com/tle/core/settings/service/impl/ThemeSettingsServiceImpl.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xMFQwNjoyNzo1MlrOG-CoHw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xMFQwNjo1OTowMlrOG-DPOA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NzcwNzkzNQ==", "bodyText": "The logic for this used to be:\n\n!legacyCssExists OR baseSassUpdated\n\nNow it's:\n\nlegacyCssExists AND baseSassUpdated\n\nI believe that means on the first run of a fresh system, this will not get generated.", "url": "https://github.com/openequella/openEQUELLA/pull/2158#discussion_r467707935", "createdAt": "2020-08-10T06:27:52Z", "author": {"login": "edalex-ian"}, "path": "Source/Plugins/Core/com.equella.core/src/com/tle/core/settings/service/impl/ThemeSettingsServiceImpl.java", "diffHunk": "@@ -165,16 +166,22 @@ private String themeToJSONString(NewUITheme theme) throws JsonProcessingExceptio\n   }\n \n   public InputStream getLegacyCss() throws IOException {\n-    File baseLegacySass =\n-        new File(getClass().getResource(\"/web/sass/\" + SASS_LEGACY_CSS_FILENAME).getFile());\n     CustomisationFile customisationFile = new CustomisationFile();\n-    boolean legacyCssExists = fileSystemService.fileExists(customisationFile, LEGACY_CSS_FILENAME);\n-    boolean baseSassUpdated =\n-        baseLegacySass.lastModified()\n-            > fileSystemService.lastModified(customisationFile, LEGACY_CSS_FILENAME);\n \n-    if (!legacyCssExists || baseSassUpdated) {\n-      compileSass();\n+    // get last modified date of the scss file\n+    URLConnection conn =\n+        getClass().getResource(\"/web/sass/\" + SASS_LEGACY_CSS_FILENAME).openConnection();\n+    long lastMod = conn.getLastModified();\n+    conn.getInputStream().close();\n+\n+    // compare against the modified date of the css file if it exists\n+    boolean legacyCssExists = fileSystemService.fileExists(customisationFile, LEGACY_CSS_FILENAME);\n+    if (legacyCssExists) {\n+      long cssLastMod = fileSystemService.lastModified(customisationFile, LEGACY_CSS_FILENAME);\n+      boolean baseSassUpdated = lastMod > cssLastMod;\n+      if (baseSassUpdated) {\n+        compileSass();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "6f87bfa24d6e325ddf1771ff14e87d93ce422fe3"}, "originalPosition": 43}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NzcxNzk0NA==", "bodyText": "Gah! Yup, I forgot the else for the initial legacyCssExists check. Sorry about that.", "url": "https://github.com/openequella/openEQUELLA/pull/2158#discussion_r467717944", "createdAt": "2020-08-10T06:59:02Z", "author": {"login": "SammyIsConfused"}, "path": "Source/Plugins/Core/com.equella.core/src/com/tle/core/settings/service/impl/ThemeSettingsServiceImpl.java", "diffHunk": "@@ -165,16 +166,22 @@ private String themeToJSONString(NewUITheme theme) throws JsonProcessingExceptio\n   }\n \n   public InputStream getLegacyCss() throws IOException {\n-    File baseLegacySass =\n-        new File(getClass().getResource(\"/web/sass/\" + SASS_LEGACY_CSS_FILENAME).getFile());\n     CustomisationFile customisationFile = new CustomisationFile();\n-    boolean legacyCssExists = fileSystemService.fileExists(customisationFile, LEGACY_CSS_FILENAME);\n-    boolean baseSassUpdated =\n-        baseLegacySass.lastModified()\n-            > fileSystemService.lastModified(customisationFile, LEGACY_CSS_FILENAME);\n \n-    if (!legacyCssExists || baseSassUpdated) {\n-      compileSass();\n+    // get last modified date of the scss file\n+    URLConnection conn =\n+        getClass().getResource(\"/web/sass/\" + SASS_LEGACY_CSS_FILENAME).openConnection();\n+    long lastMod = conn.getLastModified();\n+    conn.getInputStream().close();\n+\n+    // compare against the modified date of the css file if it exists\n+    boolean legacyCssExists = fileSystemService.fileExists(customisationFile, LEGACY_CSS_FILENAME);\n+    if (legacyCssExists) {\n+      long cssLastMod = fileSystemService.lastModified(customisationFile, LEGACY_CSS_FILENAME);\n+      boolean baseSassUpdated = lastMod > cssLastMod;\n+      if (baseSassUpdated) {\n+        compileSass();", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NzcwNzkzNQ=="}, "originalCommit": {"oid": "6f87bfa24d6e325ddf1771ff14e87d93ce422fe3"}, "originalPosition": 43}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1207, "cost": 1, "resetAt": "2021-11-12T20:44:06Z"}}}