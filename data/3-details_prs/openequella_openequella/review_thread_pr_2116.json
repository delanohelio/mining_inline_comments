{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDU4MTM2Mjg3", "number": 2116, "reviewThreads": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yOVQwMToxODowN1rOETDr8g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yOVQwMTo1ODoxNlrOETEJAQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjg4NDE4ODAyOnYy", "diffSide": "RIGHT", "path": "Source/Plugins/Core/com.equella.core/js/tsrc/components/DateRangeSelector.tsx", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yOVQwMToxODowN1rOG4lIyQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yOVQwMToxODowN1rOG4lIyQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MTk4MTg5Nw==", "bodyText": "The initial date range always meets one of the below four conditions and therefore onDateRangeChange is called. This results in an extra render which should not be performed. So here I want  this effect to skip the first render.", "url": "https://github.com/openequella/openEQUELLA/pull/2116#discussion_r461981897", "createdAt": "2020-07-29T01:18:07Z", "author": {"login": "PenghaiZhang"}, "path": "Source/Plugins/Core/com.equella.core/js/tsrc/components/DateRangeSelector.tsx", "diffHunk": "@@ -118,6 +120,38 @@ export const DateRangeSelector = ({\n   const startLabel = startDatePickerLabel ?? defaultStartDatePickerLabel;\n   const endLabel = endDatePickerLabel ?? defaultEndDatePickerLabel;\n \n+  /**\n+   * MUI KeyboardDatePicker requires its value to be controlled by state,\n+   * in order to properly parse and validate TextField inputs.\n+   */\n+  const [stateDateRange, setStateDateRange] = useState<DateRange | undefined>(\n+    dateRange\n+  );\n+\n+  const isInitialRender = useRef(true);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "6d8b830855ce6f1d3b2e2e98636acf52e8d2eb5c"}, "originalPosition": 29}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjg4NDI0MzQ2OnYy", "diffSide": "RIGHT", "path": "Source/Plugins/Core/com.equella.core/js/tsrc/components/DateRangeSelector.tsx", "isResolved": true, "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yOVQwMTo0ODowNlrOG4loVg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yOVQwNDoyMToyM1rOG4oBUQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MTk4OTk3NA==", "bodyText": "How would either of these fail the isValid check? If they're not undefined then they're a Date and shouldn't they be valid?", "url": "https://github.com/openequella/openEQUELLA/pull/2116#discussion_r461989974", "createdAt": "2020-07-29T01:48:06Z", "author": {"login": "edalex-ian"}, "path": "Source/Plugins/Core/com.equella.core/js/tsrc/components/DateRangeSelector.tsx", "diffHunk": "@@ -118,6 +120,38 @@ export const DateRangeSelector = ({\n   const startLabel = startDatePickerLabel ?? defaultStartDatePickerLabel;\n   const endLabel = endDatePickerLabel ?? defaultEndDatePickerLabel;\n \n+  /**\n+   * MUI KeyboardDatePicker requires its value to be controlled by state,\n+   * in order to properly parse and validate TextField inputs.\n+   */\n+  const [stateDateRange, setStateDateRange] = useState<DateRange | undefined>(\n+    dateRange\n+  );\n+\n+  const isInitialRender = useRef(true);\n+  useEffect(() => {\n+    if (isInitialRender.current) {\n+      isInitialRender.current = false;\n+      return;\n+    }\n+    const start = stateDateRange?.start;\n+    const end = stateDateRange?.end;\n+    const isStartValid = start && DateTime.fromJSDate(start).isValid;\n+    const isEndValid = end && DateTime.fromJSDate(end).isValid;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "6d8b830855ce6f1d3b2e2e98636acf52e8d2eb5c"}, "originalPosition": 38}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MjAyNjU5NA==", "bodyText": "The Date picker returns a value whose type is DateTime rather than Date.  An object of DateTime could be an invalid date. For example, users can put an incomplete date 01/01/202 in the TextField.\n\nYou can see the second log indicates a DateTime object has an invalid date.", "url": "https://github.com/openequella/openEQUELLA/pull/2116#discussion_r462026594", "createdAt": "2020-07-29T04:10:20Z", "author": {"login": "PenghaiZhang"}, "path": "Source/Plugins/Core/com.equella.core/js/tsrc/components/DateRangeSelector.tsx", "diffHunk": "@@ -118,6 +120,38 @@ export const DateRangeSelector = ({\n   const startLabel = startDatePickerLabel ?? defaultStartDatePickerLabel;\n   const endLabel = endDatePickerLabel ?? defaultEndDatePickerLabel;\n \n+  /**\n+   * MUI KeyboardDatePicker requires its value to be controlled by state,\n+   * in order to properly parse and validate TextField inputs.\n+   */\n+  const [stateDateRange, setStateDateRange] = useState<DateRange | undefined>(\n+    dateRange\n+  );\n+\n+  const isInitialRender = useRef(true);\n+  useEffect(() => {\n+    if (isInitialRender.current) {\n+      isInitialRender.current = false;\n+      return;\n+    }\n+    const start = stateDateRange?.start;\n+    const end = stateDateRange?.end;\n+    const isStartValid = start && DateTime.fromJSDate(start).isValid;\n+    const isEndValid = end && DateTime.fromJSDate(end).isValid;", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MTk4OTk3NA=="}, "originalCommit": {"oid": "6d8b830855ce6f1d3b2e2e98636acf52e8d2eb5c"}, "originalPosition": 38}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MjAyOTEzNw==", "bodyText": "Aaaahhhh gotcha! I thought it was post that. \ud83d\udc4d", "url": "https://github.com/openequella/openEQUELLA/pull/2116#discussion_r462029137", "createdAt": "2020-07-29T04:21:23Z", "author": {"login": "edalex-ian"}, "path": "Source/Plugins/Core/com.equella.core/js/tsrc/components/DateRangeSelector.tsx", "diffHunk": "@@ -118,6 +120,38 @@ export const DateRangeSelector = ({\n   const startLabel = startDatePickerLabel ?? defaultStartDatePickerLabel;\n   const endLabel = endDatePickerLabel ?? defaultEndDatePickerLabel;\n \n+  /**\n+   * MUI KeyboardDatePicker requires its value to be controlled by state,\n+   * in order to properly parse and validate TextField inputs.\n+   */\n+  const [stateDateRange, setStateDateRange] = useState<DateRange | undefined>(\n+    dateRange\n+  );\n+\n+  const isInitialRender = useRef(true);\n+  useEffect(() => {\n+    if (isInitialRender.current) {\n+      isInitialRender.current = false;\n+      return;\n+    }\n+    const start = stateDateRange?.start;\n+    const end = stateDateRange?.end;\n+    const isStartValid = start && DateTime.fromJSDate(start).isValid;\n+    const isEndValid = end && DateTime.fromJSDate(end).isValid;", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MTk4OTk3NA=="}, "originalCommit": {"oid": "6d8b830855ce6f1d3b2e2e98636acf52e8d2eb5c"}, "originalPosition": 38}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjg4NDI0OTY5OnYy", "diffSide": "RIGHT", "path": "Source/Plugins/Core/com.equella.core/js/tsrc/components/DateRangeSelector.tsx", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yOVQwMTo1MTozMlrOG4lr_A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yOVQwMTo1MTozMlrOG4lr_A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MTk5MDkwOA==", "bodyText": "I would've been inclined to leave this as was (taking a parameter) so that you have a nice simple pure stand-alone function (easier to maintain and reason out). But it's done now, so up to you.", "url": "https://github.com/openequella/openEQUELLA/pull/2116#discussion_r461990908", "createdAt": "2020-07-29T01:51:32Z", "author": {"login": "edalex-ian"}, "path": "Source/Plugins/Core/com.equella.core/js/tsrc/components/DateRangeSelector.tsx", "diffHunk": "@@ -163,18 +197,18 @@ export const DateRangeSelector = ({\n    *\n    * @param dateRange A date range to be converted to a Quick date option label.\n    */\n-  const dateRangeToDateOptionConverter = (dateRange?: DateRange): string => {\n+  const dateRangeToDateOptionConverter = (): string => {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "6d8b830855ce6f1d3b2e2e98636acf52e8d2eb5c"}, "originalPosition": 61}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjg4NDI2MjQxOnYy", "diffSide": "RIGHT", "path": "Source/Plugins/Core/com.equella.core/js/tsrc/components/DateRangeSelector.tsx", "isResolved": true, "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yOVQwMTo1ODoxNlrOG4ly_w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yOVQwNDozODowNFrOG4oRGA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MTk5MjcwMw==", "bodyText": "I think here we should either:\na. Use the Locale again; or\nb. Go with the more internationally acceptable ISO format.", "url": "https://github.com/openequella/openEQUELLA/pull/2116#discussion_r461992703", "createdAt": "2020-07-29T01:58:16Z", "author": {"login": "edalex-ian"}, "path": "Source/Plugins/Core/com.equella.core/js/tsrc/components/DateRangeSelector.tsx", "diffHunk": "@@ -224,36 +258,47 @@ export const DateRangeSelector = ({\n       {\n         field: \"start\",\n         label: startLabel,\n-        value: dateRange?.start,\n+        value: stateDateRange?.start,\n       },\n       {\n         field: \"end\",\n         label: endLabel,\n-        value: dateRange?.end,\n+        value: stateDateRange?.end,\n       },\n     ];\n \n-    return dateRangePickers.map(({ field, label, value }) => (\n-      <Grid item key={field}>\n-        <DatePicker\n-          disableFuture\n-          variant=\"inline\"\n-          inputVariant=\"outlined\"\n-          autoOk\n-          labelFunc={(value, invalidLabel) =>\n-            value?.toLocaleString() ?? invalidLabel\n-          }\n-          label={!value ? label : \"\"}\n-          value={value ?? null}\n-          onChange={(newDate: MaterialUiPickersDate) =>\n-            onDateRangeChange({\n-              ...dateRange,\n-              [field]: newDate?.toJSDate(),\n-            })\n-          }\n-        />\n-      </Grid>\n-    ));\n+    return dateRangePickers.map(({ field, label, value }) => {\n+      const isStart = field === \"start\";\n+      return (\n+        <Grid item key={field} xs={12} md={6}>\n+          <KeyboardDatePicker\n+            disableFuture\n+            variant=\"dialog\"\n+            clearable\n+            inputVariant=\"outlined\"\n+            autoOk\n+            // Show date in locale string, or nothing if date is null.\n+            labelFunc={(date, _) => {\n+              return date?.toLocaleString() ?? \"\";\n+            }}\n+            // TextField inputs are parsed to this format.\n+            format=\"dd/MM/yyyy\"", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "6d8b830855ce6f1d3b2e2e98636acf52e8d2eb5c"}, "originalPosition": 149}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MjAyNzUyMQ==", "bodyText": "I have not found any approach to change the format depending on locale. If we go with ISO, should we give some help texts ?", "url": "https://github.com/openequella/openEQUELLA/pull/2116#discussion_r462027521", "createdAt": "2020-07-29T04:14:27Z", "author": {"login": "PenghaiZhang"}, "path": "Source/Plugins/Core/com.equella.core/js/tsrc/components/DateRangeSelector.tsx", "diffHunk": "@@ -224,36 +258,47 @@ export const DateRangeSelector = ({\n       {\n         field: \"start\",\n         label: startLabel,\n-        value: dateRange?.start,\n+        value: stateDateRange?.start,\n       },\n       {\n         field: \"end\",\n         label: endLabel,\n-        value: dateRange?.end,\n+        value: stateDateRange?.end,\n       },\n     ];\n \n-    return dateRangePickers.map(({ field, label, value }) => (\n-      <Grid item key={field}>\n-        <DatePicker\n-          disableFuture\n-          variant=\"inline\"\n-          inputVariant=\"outlined\"\n-          autoOk\n-          labelFunc={(value, invalidLabel) =>\n-            value?.toLocaleString() ?? invalidLabel\n-          }\n-          label={!value ? label : \"\"}\n-          value={value ?? null}\n-          onChange={(newDate: MaterialUiPickersDate) =>\n-            onDateRangeChange({\n-              ...dateRange,\n-              [field]: newDate?.toJSDate(),\n-            })\n-          }\n-        />\n-      </Grid>\n-    ));\n+    return dateRangePickers.map(({ field, label, value }) => {\n+      const isStart = field === \"start\";\n+      return (\n+        <Grid item key={field} xs={12} md={6}>\n+          <KeyboardDatePicker\n+            disableFuture\n+            variant=\"dialog\"\n+            clearable\n+            inputVariant=\"outlined\"\n+            autoOk\n+            // Show date in locale string, or nothing if date is null.\n+            labelFunc={(date, _) => {\n+              return date?.toLocaleString() ?? \"\";\n+            }}\n+            // TextField inputs are parsed to this format.\n+            format=\"dd/MM/yyyy\"", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MTk5MjcwMw=="}, "originalCommit": {"oid": "6d8b830855ce6f1d3b2e2e98636acf52e8d2eb5c"}, "originalPosition": 149}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MjAzMzE3Ng==", "bodyText": "Okay, as discussed, let's just go ISO on both sides and leave this for now.", "url": "https://github.com/openequella/openEQUELLA/pull/2116#discussion_r462033176", "createdAt": "2020-07-29T04:38:04Z", "author": {"login": "edalex-ian"}, "path": "Source/Plugins/Core/com.equella.core/js/tsrc/components/DateRangeSelector.tsx", "diffHunk": "@@ -224,36 +258,47 @@ export const DateRangeSelector = ({\n       {\n         field: \"start\",\n         label: startLabel,\n-        value: dateRange?.start,\n+        value: stateDateRange?.start,\n       },\n       {\n         field: \"end\",\n         label: endLabel,\n-        value: dateRange?.end,\n+        value: stateDateRange?.end,\n       },\n     ];\n \n-    return dateRangePickers.map(({ field, label, value }) => (\n-      <Grid item key={field}>\n-        <DatePicker\n-          disableFuture\n-          variant=\"inline\"\n-          inputVariant=\"outlined\"\n-          autoOk\n-          labelFunc={(value, invalidLabel) =>\n-            value?.toLocaleString() ?? invalidLabel\n-          }\n-          label={!value ? label : \"\"}\n-          value={value ?? null}\n-          onChange={(newDate: MaterialUiPickersDate) =>\n-            onDateRangeChange({\n-              ...dateRange,\n-              [field]: newDate?.toJSDate(),\n-            })\n-          }\n-        />\n-      </Grid>\n-    ));\n+    return dateRangePickers.map(({ field, label, value }) => {\n+      const isStart = field === \"start\";\n+      return (\n+        <Grid item key={field} xs={12} md={6}>\n+          <KeyboardDatePicker\n+            disableFuture\n+            variant=\"dialog\"\n+            clearable\n+            inputVariant=\"outlined\"\n+            autoOk\n+            // Show date in locale string, or nothing if date is null.\n+            labelFunc={(date, _) => {\n+              return date?.toLocaleString() ?? \"\";\n+            }}\n+            // TextField inputs are parsed to this format.\n+            format=\"dd/MM/yyyy\"", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MTk5MjcwMw=="}, "originalCommit": {"oid": "6d8b830855ce6f1d3b2e2e98636acf52e8d2eb5c"}, "originalPosition": 149}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1178, "cost": 1, "resetAt": "2021-11-12T20:44:06Z"}}}