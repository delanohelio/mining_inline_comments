{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDQzODU2MDk3", "number": 1998, "title": "Add sorting options for Search page", "bodyText": "#1306\nChecklist\n\n the [contributor license agreement][] is signed\n commit message follows [commit guidelines][]\n tests are included\n screenshots are included showing significant UI changes\n documentation is changed or added\n\nDescription of change\nAdded a sorting control on Search page to allow sorting search results. The initially selected sort order is consistent with the default sort order configured on the Search setting page.", "createdAt": "2020-07-03T05:14:40Z", "url": "https://github.com/openequella/openEQUELLA/pull/1998", "merged": true, "mergeCommit": {"oid": "c161b59a796341576450ae69672ccebe8aa38f66"}, "closed": true, "closedAt": "2020-07-06T22:54:56Z", "author": {"login": "PenghaiZhang"}, "timelineItems": {"totalCount": 9, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcxMUFPAH2gAyNDQzODU2MDk3OmMwMTI2ZjBhNjM2ZTMwMzQ1MzBhOWIwYWQ1NmYwOWEzNGFhM2M4ZmU=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcySGplgFqTQ0MzEyNzAzMA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "c0126f0a636e3034530a9b0ad56f09a34aa3c8fe", "author": {"user": {"login": "PenghaiZhang", "name": null}}, "url": "https://github.com/openequella/openEQUELLA/commit/c0126f0a636e3034530a9b0ad56f09a34aa3c8fe", "committedDate": "2020-07-03T05:09:10Z", "message": "Add sorting options for Search page\n\n1. Move the title of Search result list into a MUI CardHeader.\n2. Add a MUI Select in the CardHeader's action as the search sorting control.\n3. Create a functions which provides data for above Select."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDQyMTUwNjQ5", "url": "https://github.com/openequella/openEQUELLA/pull/1998#pullrequestreview-442150649", "createdAt": "2020-07-03T05:17:23Z", "commit": {"oid": "c0126f0a636e3034530a9b0ad56f09a34aa3c8fe"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wM1QwNToxNzoyM1rOGsj9lA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wM1QwNToxNzoyM1rOGsj9lA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0OTM3OTczMg==", "bodyText": "Do we want a separate component for this control like the Search query bar?", "url": "https://github.com/openequella/openEQUELLA/pull/1998#discussion_r449379732", "createdAt": "2020-07-03T05:17:23Z", "author": {"login": "PenghaiZhang"}, "path": "Source/Plugins/Core/com.equella.core/js/tsrc/search/SearchPage.tsx", "diffHunk": "@@ -135,6 +135,26 @@ const SearchPage = ({ updateTemplate }: TemplateUpdateProps) => {\n \n       <Grid item xs={9}>\n         <Card>\n+          <CardHeader\n+            title={searchStrings.subtitle}\n+            action={\n+              <Select", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c0126f0a636e3034530a9b0ad56f09a34aa3c8fe"}, "originalPosition": 50}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDQyMTUxNjU5", "url": "https://github.com/openequella/openEQUELLA/pull/1998#pullrequestreview-442151659", "createdAt": "2020-07-03T05:20:52Z", "commit": {"oid": "c0126f0a636e3034530a9b0ad56f09a34aa3c8fe"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wM1QwNToyMDo1MlrOGskBCA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wM1QwNToyMDo1MlrOGskBCA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0OTM4MDYxNg==", "bodyText": "I noted that the style of CardHeader's title seems to be consistent with SettingsListHeading.", "url": "https://github.com/openequella/openEQUELLA/pull/1998#discussion_r449380616", "createdAt": "2020-07-03T05:20:52Z", "author": {"login": "PenghaiZhang"}, "path": "Source/Plugins/Core/com.equella.core/js/tsrc/search/SearchPage.tsx", "diffHunk": "@@ -135,6 +135,26 @@ const SearchPage = ({ updateTemplate }: TemplateUpdateProps) => {\n \n       <Grid item xs={9}>\n         <Card>\n+          <CardHeader\n+            title={searchStrings.subtitle}", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c0126f0a636e3034530a9b0ad56f09a34aa3c8fe"}, "originalPosition": 48}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDQyNzE3MjI5", "url": "https://github.com/openequella/openEQUELLA/pull/1998#pullrequestreview-442717229", "createdAt": "2020-07-05T23:52:10Z", "commit": {"oid": "c0126f0a636e3034530a9b0ad56f09a34aa3c8fe"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wNVQyMzo1MjoxMFrOGtFuJQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wNVQyMzo1MjoxMFrOGtFuJQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0OTkzMjgzNw==", "bodyText": "This really should be a return type of Map<SortOrder, string>, and maybe then a name to better reflect it's purpose like: getSortingOptionStrings(). Then, it'd also possibly worthwhile to memoize it - as it is completely static for each run (no need to build the data structure again).", "url": "https://github.com/openequella/openEQUELLA/pull/1998#discussion_r449932837", "createdAt": "2020-07-05T23:52:10Z", "author": {"login": "edalex-ian"}, "path": "Source/Plugins/Core/com.equella.core/js/tsrc/search/SearchModule.ts", "diffHunk": "@@ -40,33 +72,22 @@ export const searchItems = (\n   return OEQ.Search.search(API_BASE_URL, searchParams);\n };\n \n-export const defaultPagedSearchResult: OEQ.Common.PagedResult<OEQ.Search.SearchResultItem> = {\n-  start: 0,\n-  length: 10,\n-  available: 10,\n-  results: [],\n-};\n-\n /**\n- * Type of all search options on Search page\n+ * Provide the search sorting control's data source.\n  */\n-export interface SearchOptions {\n-  /**\n-   * The number of items displayed in one page.\n-   */\n-  rowsPerPage: number;\n-  /**\n-   * Selected page.\n-   */\n-  currentPage: number;\n-  /**\n-   * Selected search result sorting order.\n-   */\n-  sortOrder: SortOrder | undefined;\n-}\n-\n-export const defaultSearchOptions: SearchOptions = {\n-  rowsPerPage: 10,\n-  currentPage: 0,\n-  sortOrder: undefined,\n+export const getSortingOptions = (): Record<string, SortOrder> => {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c0126f0a636e3034530a9b0ad56f09a34aa3c8fe"}, "originalPosition": 73}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDQyNzI2MTAz", "url": "https://github.com/openequella/openEQUELLA/pull/1998#pullrequestreview-442726103", "createdAt": "2020-07-06T01:09:04Z", "commit": {"oid": "c0126f0a636e3034530a9b0ad56f09a34aa3c8fe"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wNlQwMTowOTowNVrOGtGRPA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wNlQwMToxMToyNlrOGtGSlw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0OTk0MTgyMA==", "bodyText": "Is it worth having a test for this function?", "url": "https://github.com/openequella/openEQUELLA/pull/1998#discussion_r449941820", "createdAt": "2020-07-06T01:09:05Z", "author": {"login": "SammyIsConfused"}, "path": "Source/Plugins/Core/com.equella.core/js/tsrc/search/SearchModule.ts", "diffHunk": "@@ -40,33 +72,22 @@ export const searchItems = (\n   return OEQ.Search.search(API_BASE_URL, searchParams);\n };\n \n-export const defaultPagedSearchResult: OEQ.Common.PagedResult<OEQ.Search.SearchResultItem> = {\n-  start: 0,\n-  length: 10,\n-  available: 10,\n-  results: [],\n-};\n-\n /**\n- * Type of all search options on Search page\n+ * Provide the search sorting control's data source.\n  */\n-export interface SearchOptions {\n-  /**\n-   * The number of items displayed in one page.\n-   */\n-  rowsPerPage: number;\n-  /**\n-   * Selected page.\n-   */\n-  currentPage: number;\n-  /**\n-   * Selected search result sorting order.\n-   */\n-  sortOrder: SortOrder | undefined;\n-}\n-\n-export const defaultSearchOptions: SearchOptions = {\n-  rowsPerPage: 10,\n-  currentPage: 0,\n-  sortOrder: undefined,\n+export const getSortingOptions = (): Record<string, SortOrder> => {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c0126f0a636e3034530a9b0ad56f09a34aa3c8fe"}, "originalPosition": 73}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0OTk0MjE2Nw==", "bodyText": "Not sure I quite understand this return - so depending on language strings the shape of the return data will change? If someone changed these values in a language pack would the data remain the same or map to the new strings? And would that break anything if so?", "url": "https://github.com/openequella/openEQUELLA/pull/1998#discussion_r449942167", "createdAt": "2020-07-06T01:11:26Z", "author": {"login": "SammyIsConfused"}, "path": "Source/Plugins/Core/com.equella.core/js/tsrc/search/SearchModule.ts", "diffHunk": "@@ -40,33 +72,22 @@ export const searchItems = (\n   return OEQ.Search.search(API_BASE_URL, searchParams);\n };\n \n-export const defaultPagedSearchResult: OEQ.Common.PagedResult<OEQ.Search.SearchResultItem> = {\n-  start: 0,\n-  length: 10,\n-  available: 10,\n-  results: [],\n-};\n-\n /**\n- * Type of all search options on Search page\n+ * Provide the search sorting control's data source.\n  */\n-export interface SearchOptions {\n-  /**\n-   * The number of items displayed in one page.\n-   */\n-  rowsPerPage: number;\n-  /**\n-   * Selected page.\n-   */\n-  currentPage: number;\n-  /**\n-   * Selected search result sorting order.\n-   */\n-  sortOrder: SortOrder | undefined;\n-}\n-\n-export const defaultSearchOptions: SearchOptions = {\n-  rowsPerPage: 10,\n-  currentPage: 0,\n-  sortOrder: undefined,\n+export const getSortingOptions = (): Record<string, SortOrder> => {\n+  const {\n+    relevance,\n+    lastModified,\n+    dateCreated,\n+    title,\n+    userRating,\n+  } = languageStrings.settings.searching.searchPageSettings;\n+  return {\n+    [relevance]: SortOrder.RANK,", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c0126f0a636e3034530a9b0ad56f09a34aa3c8fe"}, "originalPosition": 82}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "638fa01ab6796294c348689889e022e708d4c41e", "author": {"user": {"login": "PenghaiZhang", "name": null}}, "url": "https://github.com/openequella/openEQUELLA/commit/638fa01ab6796294c348689889e022e708d4c41e", "committedDate": "2020-07-06T05:58:21Z", "message": "Create a separate component for Search order control\n\nPull the search order control out from Search page and add a dedicated\ncomponent for it. Also make this component memorized so that it does not\nget re-rendered when other controls change search options."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "12c48d321df286f686a6365da89150e4de2b121d", "author": {"user": {"login": "PenghaiZhang", "name": null}}, "url": "https://github.com/openequella/openEQUELLA/commit/12c48d321df286f686a6365da89150e4de2b121d", "committedDate": "2020-07-06T06:09:27Z", "message": "Update the JSDoc for 'sortingOptionStrings'."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDQyODEwMDgz", "url": "https://github.com/openequella/openEQUELLA/pull/1998#pullrequestreview-442810083", "createdAt": "2020-07-06T06:44:56Z", "commit": {"oid": "12c48d321df286f686a6365da89150e4de2b121d"}, "state": "APPROVED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wNlQwNjo0NDo1NlrOGtKq0w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wNlQwNjo0NDo1NlrOGtKq0w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MDAxMzkwNw==", "bodyText": "This gave me pause, until I saw it's to maintain referential consistency when passed into your memoised SearchOrderSelect. \ud83d\udc4d", "url": "https://github.com/openequella/openEQUELLA/pull/1998#discussion_r450013907", "createdAt": "2020-07-06T06:44:56Z", "author": {"login": "edalex-ian"}, "path": "Source/Plugins/Core/com.equella.core/js/tsrc/search/SearchPage.tsx", "diffHunk": "@@ -120,6 +115,16 @@ const SearchPage = ({ updateTemplate }: TemplateUpdateProps) => {\n    */\n   const searchResultList = <List>{searchResults}</List>;\n \n+  /**\n+   * Provide a memorized callback for updating sort order in order to avoid re-rendering\n+   * component SearchOrderSelect when other search control values are changed.\n+   */\n+  const handleSortOrderChanged = useCallback(\n+    (order: SortOrder) =>\n+      setSearchOptions({ ...searchOptions, sortOrder: order }),\n+    []", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "12c48d321df286f686a6365da89150e4de2b121d"}, "originalPosition": 55}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDQzMTI3MDMw", "url": "https://github.com/openequella/openEQUELLA/pull/1998#pullrequestreview-443127030", "createdAt": "2020-07-06T14:27:51Z", "commit": {"oid": "12c48d321df286f686a6365da89150e4de2b121d"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4926, "cost": 1, "resetAt": "2021-11-01T16:37:27Z"}}}