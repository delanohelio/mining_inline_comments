{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDUyODc4NTk2", "number": 2074, "title": "Remember search options when going 'back' to the search page", "bodyText": "Checklist\n\n\n the contributor license agreement is signed\n commit message follows commit guidelines\n tests are included\n screenshots are included showing significant UI changes\n\nDescription of change\n\nThe main feature which was being implemented here was to remember what options a user has selected on a search page when they use the back button to return to a search. But also snuck in a quick couple of others (reduced prominence of raw mode toggle; and remove need to press enter when in raw search mode) following team review.\nThis became a bit more involved, as it was realised SearchBar was handling the state around raw mode itself - rather than pushing state up. As a result, SearchBar was refactored to use two way binding to support pushing this state up allowing it to be stored in history. However SearchBar does still maintain it's own internal state of the current query value to support debouncing of sending the new query value up.\nIn addition to state, it was also noted that SearchBar had taken on the business logic around what raw mode meant. This then was also pushed out back to the Module layer, which in turn then also meant the test should be moved - and others added.\n(A also swapped the debounce used by the SearchBar to the one included in Material-UI to reduce dependency on lodash.)\nOf note, is that with the two way binding being used for the new Collections control, it automatically had those options stored in history. Therefore, if this pattern is observed going forward, the additional settings will also readily be persisted for 'on back'.\nA couple of screenshots to show the change in the raw toggle:\n\n\n#1306", "createdAt": "2020-07-19T23:56:41Z", "url": "https://github.com/openequella/openEQUELLA/pull/2074", "merged": true, "mergeCommit": {"oid": "1d5aac6e0fc13f8f8079bd694b1f4ed7f7494dc7"}, "closed": true, "closedAt": "2020-07-20T04:50:33Z", "author": {"login": "edalex-ian"}, "timelineItems": {"totalCount": 10, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABc1u3azAH2gAyNDUyODc4NTk2OmJlNTViOWYxMzYxZTczMDY0MWJkMzk4YWRlNmNhNzE3ZmMwNThjNGE=", "endCursor": "Y3Vyc29yOnYyOpPPAAABc2oR40AFqTQ1MTI0ODM2Ng==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "be55b9f1361e730641bd398ade6ca717fc058c4a", "author": {"user": {"login": "edalex-ian", "name": null}}, "url": "https://github.com/openequella/openEQUELLA/commit/be55b9f1361e730641bd398ade6ca717fc058c4a", "committedDate": "2020-07-17T07:40:14Z", "message": "Persist SearchPageOptions in history\n\nSo that when users go 'back' to the SearchPage the can continue with their previous search."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ad3746dc02ee1b8950417395197e04779817df0d", "author": {"user": {"login": "edalex-ian", "name": null}}, "url": "https://github.com/openequella/openEQUELLA/commit/ad3746dc02ee1b8950417395197e04779817df0d", "committedDate": "2020-07-17T07:48:53Z", "message": "Refactor SearchBar to raise up state\n\nThe SearchBar was attempting to handle too much state, and this\nspecifically became problematic when trying to persist the Raw Mode\nsetting in history. Further, the business logic around Raw Mode had also\nended up in the UI layer (component) rather than the module."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ade507381e8fb06c6180a5eb825c4741dc07bdf7", "author": {"user": {"login": "edalex-ian", "name": null}}, "url": "https://github.com/openequella/openEQUELLA/commit/ade507381e8fb06c6180a5eb825c4741dc07bdf7", "committedDate": "2020-07-17T07:49:02Z", "message": "Support storing Sort Order in history"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "00570cf8f591233453a8f2bb602b9dda4a8edcc0", "author": {"user": {"login": "edalex-ian", "name": null}}, "url": "https://github.com/openequella/openEQUELLA/commit/00570cf8f591233453a8f2bb602b9dda4a8edcc0", "committedDate": "2020-07-17T07:49:02Z", "message": "Fix issue with Raw Mode flipping on submit"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "18069e256b770ae6d3ae8312672962680d585acf", "author": {"user": {"login": "edalex-ian", "name": null}}, "url": "https://github.com/openequella/openEQUELLA/commit/18069e256b770ae6d3ae8312672962680d585acf", "committedDate": "2020-07-17T07:54:42Z", "message": "Rework tests to support refactored SearchPage/Bar/etc."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e53a2a2214be8adf0af30ca236b4848a0cc4f1a0", "author": {"user": {"login": "edalex-ian", "name": null}}, "url": "https://github.com/openequella/openEQUELLA/commit/e53a2a2214be8adf0af30ca236b4848a0cc4f1a0", "committedDate": "2020-07-17T07:54:46Z", "message": "Reduce prominence of the Raw search toggle"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c471d3fdc8895efbaf19e845a7c537c5659624c1", "author": {"user": {"login": "edalex-ian", "name": null}}, "url": "https://github.com/openequella/openEQUELLA/commit/c471d3fdc8895efbaf19e845a7c537c5659624c1", "committedDate": "2020-07-17T07:54:46Z", "message": "Remove requirement to press enter in raw search mode\n\nThe team discussion decided this was unneeded complexity."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "2e5c6c623ad21ee90d6b33a20c424f580fff7305", "author": {"user": {"login": "edalex-ian", "name": null}}, "url": "https://github.com/openequella/openEQUELLA/commit/2e5c6c623ad21ee90d6b33a20c424f580fff7305", "committedDate": "2020-07-20T00:03:00Z", "message": "Tidy up SearchModule raw mode comments"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "774c7ea8db4c46180a81aefb375568302d841f84", "author": {"user": {"login": "edalex-ian", "name": null}}, "url": "https://github.com/openequella/openEQUELLA/commit/774c7ea8db4c46180a81aefb375568302d841f84", "committedDate": "2020-07-20T02:14:27Z", "message": "Update SearchBar story\n\nSo as to match updated SearchBar."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDUxMjQ4MzY2", "url": "https://github.com/openequella/openEQUELLA/pull/2074#pullrequestreview-451248366", "createdAt": "2020-07-20T02:26:14Z", "commit": {"oid": "774c7ea8db4c46180a81aefb375568302d841f84"}, "state": "APPROVED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yMFQwMjoyNjoxNVrOGz00gw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yMFQwMjoyNzo1NVrOGz01nQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1Njk5NTk3MQ==", "bodyText": "May I ask why not use toHaveBeenCalledWith({...defaultSearchOptions, query: \"\"}) ?", "url": "https://github.com/openequella/openEQUELLA/pull/2074#discussion_r456995971", "createdAt": "2020-07-20T02:26:15Z", "author": {"login": "PenghaiZhang"}, "path": "Source/Plugins/Core/com.equella.core/js/__tests__/tsrc/search/SearchModule.test.ts", "diffHunk": "@@ -32,4 +32,40 @@ describe(\"SearchModule\", () => {\n     expect(searchResult.available).toBe(12);\n     expect(searchResult.results).toHaveLength(12);\n   });\n+\n+  const validateSearchQuery = (expectedQuery: string) => {\n+    const calls = mockedSearch.mock.calls;\n+    const params = calls[0][1]; // Second parameter of the call is the 'params'\n+    expect(params.query).toEqual(expectedQuery);\n+  };\n+\n+  it(\"should not append a wildcard for a search which is empty when trimmed\", async () => {\n+    mockedSearch.mockReset();\n+    await SearchModule.searchItems({\n+      ...SearchModule.defaultSearchOptions,\n+      query: \"   \",\n+    });\n+    validateSearchQuery(\"\");", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "774c7ea8db4c46180a81aefb375568302d841f84"}, "originalPosition": 26}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1Njk5NjI1Mw==", "bodyText": "I am not familiar with mock.calls.  May I ask if 0 means this is the first call ? And what does 1 stand for ?", "url": "https://github.com/openequella/openEQUELLA/pull/2074#discussion_r456996253", "createdAt": "2020-07-20T02:27:55Z", "author": {"login": "PenghaiZhang"}, "path": "Source/Plugins/Core/com.equella.core/js/__tests__/tsrc/search/SearchModule.test.ts", "diffHunk": "@@ -32,4 +32,40 @@ describe(\"SearchModule\", () => {\n     expect(searchResult.available).toBe(12);\n     expect(searchResult.results).toHaveLength(12);\n   });\n+\n+  const validateSearchQuery = (expectedQuery: string) => {\n+    const calls = mockedSearch.mock.calls;\n+    const params = calls[0][1]; // Second parameter of the call is the 'params'", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "774c7ea8db4c46180a81aefb375568302d841f84"}, "originalPosition": 16}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4981, "cost": 1, "resetAt": "2021-11-01T16:37:27Z"}}}