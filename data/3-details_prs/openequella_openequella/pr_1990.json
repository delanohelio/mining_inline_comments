{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDQzMjAzMTI1", "number": 1990, "title": "Refactor Theme Editor page to use the new standard SettingsPageTemplate", "bodyText": "Checklist\n\n\n the contributor license agreement is signed\n commit message follows commit guidelines\n tests are included\n screenshots are included showing significant UI changes\n documentation is changed or added\n\nDescription of change\n\nWell, this was one of those small little refactors that suddenly became a bit more... Not too much more, but.. you'll see.\nThe intention was to make ThemePage use the new SettingsPageTemplate and SettingsList so as to be consistent with our new settings work. That was achieved, however getting there got a bit tricker due to some bumps with the the ColorPickerComponent, so that ended up also getting refactored as well. It went from a class based component to a functional one, and rather than a pop-over is now a dialog (which is also more consistent), as well as some of it's oddities were removed and tidied up.\nBut also did some tweaking to SettingsList for a stronger heading, while also providing the heading as a stand-alone component. This was triggered by noting some of the other new settings pages had copy and pasted the Typography block to match what was in SettingsList.\nIn Summary:\n\nThemePage refactored to use SettingsPageTemplate and SettingsList\nColorPickerComponent refactored to functional component and dialog based\nChanged heading style of SettingsList\nAdded new component SettingsListHeading (primarily for easy re-use)\nRemoved display of current logo from ThemePage as it was redundant - current logo is always shown top left of the page\nAdded back navigation to SettingsPage (for consistency, easy of use)\n\nI also wanted to at least add SettingsListHeading to Storybook. However Storybook is currently broken on component/new-search-page. (I'll attempt to look at this on the side.)\nUpdated ThemePage\n\nUpdated ColorPickerComponent\n\nExample of modified headings on other settings page", "createdAt": "2020-07-02T02:40:54Z", "url": "https://github.com/openequella/openEQUELLA/pull/1990", "merged": true, "mergeCommit": {"oid": "c3d0bf613e5f29f62186f4ee2a45b2268b76c600"}, "closed": true, "closedAt": "2020-07-02T05:05:35Z", "author": {"login": "edalex-ian"}, "timelineItems": {"totalCount": 9, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcw1E5jAH2gAyNDQzMjAzMTI1OmU2NDE5OTZiMjFhODllMmFhYjhhMzY1MmYwNTg4ZGI3NDEzMDIzYzE=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcw3m6sAFqTQ0MTM1MTU5OQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "e641996b21a89e2aab8a3652f0588db7413023c1", "author": {"user": {"login": "edalex-ian", "name": null}}, "url": "https://github.com/openequella/openEQUELLA/commit/e641996b21a89e2aab8a3652f0588db7413023c1", "committedDate": "2020-07-02T02:04:46Z", "message": "Convert ColorPickerComponent to functional component\n\nAlso included some minor changes in how it works, to better utilise two way binding.\n\nPaves the way for further rework."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "1225404052745303428e36eee9caa159f54bdcc2", "author": {"user": {"login": "edalex-ian", "name": null}}, "url": "https://github.com/openequella/openEQUELLA/commit/1225404052745303428e36eee9caa159f54bdcc2", "committedDate": "2020-07-02T02:04:46Z", "message": "Convert ColorPickerComponent to Dialog based\n\nThe old setup had a couple of issues when attempting to refactor the theme settings page (the one place it's used) to the SettingsPageTemplate."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "cfb3a3067f1a4725146936d3c18192f864f5b5f5", "author": {"user": {"login": "edalex-ian", "name": null}}, "url": "https://github.com/openequella/openEQUELLA/commit/cfb3a3067f1a4725146936d3c18192f864f5b5f5", "committedDate": "2020-07-02T02:04:46Z", "message": "Refactor ThemePage to use SettingPageTemplate\n\nSo as to ensure a consistent user experience with all the other new settings pages."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f4fe9bdfbeb5e2729151923fd48634e1bd58e3ae", "author": {"user": {"login": "edalex-ian", "name": null}}, "url": "https://github.com/openequella/openEQUELLA/commit/f4fe9bdfbeb5e2729151923fd48634e1bd58e3ae", "committedDate": "2020-07-02T02:04:46Z", "message": "Modify SettingsList to have a more dominant heading\n\nThe other heading was rather subtle and often lost in the background."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ff8ca0b85d4aaf09c426830083cd6c92ae128afc", "author": {"user": {"login": "edalex-ian", "name": null}}, "url": "https://github.com/openequella/openEQUELLA/commit/ff8ca0b85d4aaf09c426830083cd6c92ae128afc", "committedDate": "2020-07-02T02:04:46Z", "message": "Add back navigation to ThemePage\n\nFor consistency with other new ui settings pages, and ease of use."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "0a4e7b2490ab8e2f4ea937539b2a425bbb5a7278", "author": {"user": {"login": "edalex-ian", "name": null}}, "url": "https://github.com/openequella/openEQUELLA/commit/0a4e7b2490ab8e2f4ea937539b2a425bbb5a7278", "committedDate": "2020-07-02T02:04:46Z", "message": "Split out the SettingsList heading component\n\nThis then facilitates a more fool proof way when other settings areas doing their own content."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "4dd3877f4270a56d30ec088c3f7bf998e30d173f", "author": {"user": {"login": "edalex-ian", "name": null}}, "url": "https://github.com/openequella/openEQUELLA/commit/4dd3877f4270a56d30ec088c3f7bf998e30d173f", "committedDate": "2020-07-02T02:04:46Z", "message": "Refactor settings pages to use SettingsListHeading\n\nSo as to ensure consistency."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDQxMzM3MzQ5", "url": "https://github.com/openequella/openEQUELLA/pull/1990#pullrequestreview-441337349", "createdAt": "2020-07-02T04:10:55Z", "commit": {"oid": "4dd3877f4270a56d30ec088c3f7bf998e30d173f"}, "state": "COMMENTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wMlQwNDoxMDo1NVrOGr8x3A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wMlQwNDoyNzoxM1rOGr9Ajw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0ODczNzc1Ng==", "bodyText": "If all color settings are already default and I press the reset button again, will the Save button become enabled and allow me to submit?", "url": "https://github.com/openequella/openEQUELLA/pull/1990#discussion_r448737756", "createdAt": "2020-07-02T04:10:55Z", "author": {"login": "PenghaiZhang"}, "path": "Source/Plugins/Core/com.equella.core/js/tsrc/theme/ThemePage.tsx", "diffHunk": "@@ -122,6 +130,7 @@ class ThemePage extends React.Component<\n         menuIcon: \"#000000\",\n         primaryText: \"#000000\",\n         secondaryText: \"#444444\",\n+        changesUnsaved: true,", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "4dd3877f4270a56d30ec088c3f7bf998e30d173f"}, "originalPosition": 146}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0ODc0MTUxOQ==", "bodyText": "I like this try...catch block because it makes this function easy to read. Only when the two promises get resolved,  the state is updated.", "url": "https://github.com/openequella/openEQUELLA/pull/1990#discussion_r448741519", "createdAt": "2020-07-02T04:27:13Z", "author": {"login": "PenghaiZhang"}, "path": "Source/Plugins/Core/com.equella.core/js/tsrc/theme/ThemePage.tsx", "diffHunk": "@@ -184,58 +168,52 @@ class ThemePage extends React.Component<\n         this.setState({\n           logoToUpload: file,\n           fileName: file.name,\n+          changesUnsaved: true,\n         });\n       };\n     }\n   };\n \n-  submitTheme = () => {\n-    axios\n-      .put(`${API_BASE_URL}/theme/settings/`, {\n-        primaryColor: this.state.primary,\n-        secondaryColor: this.state.secondary,\n-        backgroundColor: this.state.background,\n-        menuItemColor: this.state.menu,\n-        menuItemIconColor: this.state.menuIcon,\n-        menuItemTextColor: this.state.menuText,\n-        primaryTextColor: this.state.primaryText,\n-        menuTextColor: this.state.secondaryText,\n-        fontSize: 14,\n-      })\n-      .then(() => {\n-        this.reload();\n-      })\n-      .catch((error) => {\n-        this.handleError(error);\n-      });\n-  };\n+  submitTheme = () =>\n+    axios.put(`${API_BASE_URL}/theme/settings/`, {\n+      primaryColor: this.state.primary,\n+      secondaryColor: this.state.secondary,\n+      backgroundColor: this.state.background,\n+      menuItemColor: this.state.menu,\n+      menuItemIconColor: this.state.menuIcon,\n+      menuItemTextColor: this.state.menuText,\n+      primaryTextColor: this.state.primaryText,\n+      menuTextColor: this.state.secondaryText,\n+      fontSize: 14,\n+    });\n+\n+  submitLogo = () =>\n+    this.state.logoToUpload &&\n+    axios.put(`${API_BASE_URL}/theme/logo/`, this.state.logoToUpload);\n+\n+  async saveChanges() {\n+    try {\n+      await this.submitLogo();\n+      await this.submitTheme();\n+      this.setState({ changesUnsaved: false, showSuccess: true });", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "4dd3877f4270a56d30ec088c3f7bf998e30d173f"}, "originalPosition": 242}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDQxMzUxNTk5", "url": "https://github.com/openequella/openEQUELLA/pull/1990#pullrequestreview-441351599", "createdAt": "2020-07-02T05:01:44Z", "commit": {"oid": "4dd3877f4270a56d30ec088c3f7bf998e30d173f"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4920, "cost": 1, "resetAt": "2021-11-01T16:37:27Z"}}}