{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDQ5ODk3OTM2", "number": 2059, "title": "Feature/collection selector", "bodyText": "#1306\nChecklist\n\n the [contributor license agreement][] is signed\n commit message follows [commit guidelines][]\n tests are included\n screenshots are included showing significant UI changes\n documentation is changed or added\n\nDescription of change\nCreated a new component for Collection Selector. It's basically a MUI Autocomplete, which supports multiple selections, text inputs and chips. Also added two Jest tests  for it.", "createdAt": "2020-07-16T04:56:35Z", "url": "https://github.com/openequella/openEQUELLA/pull/2059", "merged": true, "mergeCommit": {"oid": "f864d509387296b24376f315e17c1b63a84fdb80"}, "closed": true, "closedAt": "2020-07-17T06:40:12Z", "author": {"login": "PenghaiZhang"}, "timelineItems": {"totalCount": 19, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABc1X44igH2gAyNDQ5ODk3OTM2OjkyMGFmZWNmYWRjZWE0NzcyNmM1OWYwNWU0YzU5OGI3ODQ4MzFmYzk=", "endCursor": "Y3Vyc29yOnYyOpPPAAABc1sOv4AH2gAyNDQ5ODk3OTM2OjA3ZTcyNGI0NzJkMGU0ZDViOTJlMTc0NWJlNmZmZTUwN2MyMTcyN2M=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "920afecfadcea47726c59f05e4c598b784831fc9", "author": {"user": {"login": "PenghaiZhang", "name": null}}, "url": "https://github.com/openequella/openEQUELLA/commit/920afecfadcea47726c59f05e4c598b784831fc9", "committedDate": "2020-07-16T04:54:01Z", "message": "Create a new component for Collection Selector\n\n1. The component is implemented by MUI Autocomplete, which supports\n   multiple selection.\n2. Integrate this component with CollectionModule and Search page.\n3. Update function 'searchItems' and interface 'SearchOptions' to include\n   collections."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "3ce437bc462a8d8946dc1cc61810f25bf9461997", "author": {"user": {"login": "PenghaiZhang", "name": null}}, "url": "https://github.com/openequella/openEQUELLA/commit/3ce437bc462a8d8946dc1cc61810f25bf9461997", "committedDate": "2020-07-16T04:54:01Z", "message": "Add a Jest test for the Collection Selector."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDQ5NTA4MDU1", "url": "https://github.com/openequella/openEQUELLA/pull/2059#pullrequestreview-449508055", "createdAt": "2020-07-16T05:01:35Z", "commit": {"oid": "3ce437bc462a8d8946dc1cc61810f25bf9461997"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xNlQwNTowMTozNVrOGyaMbA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xNlQwNTowMTozNVrOGyaMbA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NTUxMTE0OA==", "bodyText": "I was trying to add one more  expect here.\nexpect(SearchModule.searchItems).toHaveBeenCalledWith({\n  ...defaultSearchOptions,\n  collections: selectedCollections\n})\n\nBut this expect always failed which is strange, but I will try to fix it.", "url": "https://github.com/openequella/openEQUELLA/pull/2059#discussion_r455511148", "createdAt": "2020-07-16T05:01:35Z", "author": {"login": "PenghaiZhang"}, "path": "Source/Plugins/Core/com.equella.core/js/__tests__/tsrc/search/SearchPage.test.tsx", "diffHunk": "@@ -228,4 +239,17 @@ describe(\"<SearchPage/>\", () => {\n     and the search triggered by the Enter key.*/\n     expect(SearchModule.searchItems).toHaveBeenCalledTimes(2);\n   });\n+\n+  it(\"should filter search results by collections\", async () => {\n+    const selectedCollections = [\n+      \"8e3caf16-f3cb-b3dd-d403-e5eb8d545fff\",\n+      \"8e3caf16-f3cb-b3dd-d403-e5eb8d545ffe\",\n+    ];\n+    const collectionSelector = component.find(CollectionSelector);\n+    const handleCollectionChange: (\n+      collections: string[]\n+    ) => void = collectionSelector.prop(\"onSelectionChange\");\n+    await awaitAct(() => handleCollectionChange(selectedCollections));\n+    expect(SearchModule.searchItems).toHaveBeenCalledTimes(2);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "3ce437bc462a8d8946dc1cc61810f25bf9461997"}, "originalPosition": 78}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "113c6b1f7ad417b25203dbd914253c060789e2a5", "author": {"user": {"login": "PenghaiZhang", "name": null}}, "url": "https://github.com/openequella/openEQUELLA/commit/113c6b1f7ad417b25203dbd914253c060789e2a5", "committedDate": "2020-07-16T05:28:37Z", "message": "Enable the portal of Autocomplete."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDQ5NTMwMzg3", "url": "https://github.com/openequella/openEQUELLA/pull/2059#pullrequestreview-449530387", "createdAt": "2020-07-16T06:07:08Z", "commit": {"oid": "113c6b1f7ad417b25203dbd914253c060789e2a5"}, "state": "APPROVED", "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xNlQwNjowNzowOFrOGybWlw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xNlQwNjoxMDozM1rOGybbFA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NTUzMDEzNQ==", "bodyText": "I did not know you could find like this directly. That's really neat.", "url": "https://github.com/openequella/openEQUELLA/pull/2059#discussion_r455530135", "createdAt": "2020-07-16T06:07:08Z", "author": {"login": "SammyIsConfused"}, "path": "Source/Plugins/Core/com.equella.core/js/__tests__/tsrc/search/SearchPage.test.tsx", "diffHunk": "@@ -228,4 +239,17 @@ describe(\"<SearchPage/>\", () => {\n     and the search triggered by the Enter key.*/\n     expect(SearchModule.searchItems).toHaveBeenCalledTimes(2);\n   });\n+\n+  it(\"should filter search results by collections\", async () => {\n+    const selectedCollections = [\n+      \"8e3caf16-f3cb-b3dd-d403-e5eb8d545fff\",\n+      \"8e3caf16-f3cb-b3dd-d403-e5eb8d545ffe\",\n+    ];\n+    const collectionSelector = component.find(CollectionSelector);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "113c6b1f7ad417b25203dbd914253c060789e2a5"}, "originalPosition": 73}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NTUzMDQ3NQ==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n               * Fire when collection selections are changed.\n          \n          \n            \n               * Fires when collection selections are changed.", "url": "https://github.com/openequella/openEQUELLA/pull/2059#discussion_r455530475", "createdAt": "2020-07-16T06:08:08Z", "author": {"login": "SammyIsConfused"}, "path": "Source/Plugins/Core/com.equella.core/js/tsrc/search/components/CollectionSelector.tsx", "diffHunk": "@@ -0,0 +1,80 @@\n+/*\n+ * Licensed to The Apereo Foundation under one or more contributor license\n+ * agreements. See the NOTICE file distributed with this work for additional\n+ * information regarding copyright ownership.\n+ *\n+ * The Apereo Foundation licenses this file to you under the Apache License,\n+ * Version 2.0, (the \"License\"); you may not use this file except in compliance\n+ * with the License. You may obtain a copy of the License at:\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+import * as React from \"react\";\n+import { Checkbox, TextField } from \"@material-ui/core\";\n+import { useEffect, useState } from \"react\";\n+import { collectionListSummary } from \"../../modules/CollectionsModule\";\n+import { Autocomplete } from \"@material-ui/lab\";\n+import CheckBoxOutlineBlankIcon from \"@material-ui/icons/CheckBoxOutlineBlank\";\n+import CheckBoxIcon from \"@material-ui/icons/CheckBox\";\n+\n+interface CollectionSelectorProps {\n+  /**\n+   * Fire when collection selections are changed.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "113c6b1f7ad417b25203dbd914253c060789e2a5"}, "originalPosition": 28}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NTUzMTI4NA==", "bodyText": "This should be a language string.", "url": "https://github.com/openequella/openEQUELLA/pull/2059#discussion_r455531284", "createdAt": "2020-07-16T06:10:33Z", "author": {"login": "SammyIsConfused"}, "path": "Source/Plugins/Core/com.equella.core/js/tsrc/search/components/CollectionSelector.tsx", "diffHunk": "@@ -0,0 +1,80 @@\n+/*\n+ * Licensed to The Apereo Foundation under one or more contributor license\n+ * agreements. See the NOTICE file distributed with this work for additional\n+ * information regarding copyright ownership.\n+ *\n+ * The Apereo Foundation licenses this file to you under the Apache License,\n+ * Version 2.0, (the \"License\"); you may not use this file except in compliance\n+ * with the License. You may obtain a copy of the License at:\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+import * as React from \"react\";\n+import { Checkbox, TextField } from \"@material-ui/core\";\n+import { useEffect, useState } from \"react\";\n+import { collectionListSummary } from \"../../modules/CollectionsModule\";\n+import { Autocomplete } from \"@material-ui/lab\";\n+import CheckBoxOutlineBlankIcon from \"@material-ui/icons/CheckBoxOutlineBlank\";\n+import CheckBoxIcon from \"@material-ui/icons/CheckBox\";\n+\n+interface CollectionSelectorProps {\n+  /**\n+   * Fire when collection selections are changed.\n+   * @param collections Selected collections.\n+   */\n+  onSelectionChange: (collections: string[]) => void;\n+}\n+\n+/**\n+ * As a refine search control, this component is used to filter search results by collections.\n+ */\n+export const CollectionSelector = ({\n+  onSelectionChange,\n+}: CollectionSelectorProps) => {\n+  const [collections, setCollections] = useState<[string, string][]>([]);\n+  useEffect(() => {\n+    collectionListSummary([\n+      \"SEARCH_COLLECTION\",\n+    ]).then((collections: Map<string, string>) =>\n+      setCollections(Array.from(collections))\n+    );\n+  }, []);\n+\n+  return (\n+    <Autocomplete\n+      multiple\n+      fullWidth\n+      limitTags={2}\n+      onChange={(event: React.ChangeEvent<{}>, value: [string, string][]) => {\n+        onSelectionChange(value.map((collection) => collection[0]));\n+      }}\n+      options={collections}\n+      disableCloseOnSelect\n+      getOptionLabel={(collection) => collection[1]}\n+      renderOption={(collection, { selected }) => (\n+        <>\n+          <Checkbox\n+            icon={<CheckBoxOutlineBlankIcon fontSize=\"small\" />}\n+            checkedIcon={<CheckBoxIcon fontSize=\"small\" />}\n+            checked={selected}\n+          />\n+          {collection[1]}\n+        </>\n+      )}\n+      renderInput={(params) => (\n+        <TextField\n+          {...params}\n+          variant=\"outlined\"\n+          label=\"Collections\"", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "113c6b1f7ad417b25203dbd914253c060789e2a5"}, "originalPosition": 74}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "422f7efef153684db8f91087a069cf56b6eb8f3a", "author": {"user": {"login": "PenghaiZhang", "name": null}}, "url": "https://github.com/openequella/openEQUELLA/commit/422f7efef153684db8f91087a069cf56b6eb8f3a", "committedDate": "2020-07-16T06:17:46Z", "message": "Add language strings for Collection selector."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDQ5NTM2MTYx", "url": "https://github.com/openequella/openEQUELLA/pull/2059#pullrequestreview-449536161", "createdAt": "2020-07-16T06:21:01Z", "commit": {"oid": "113c6b1f7ad417b25203dbd914253c060789e2a5"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xNlQwNjoyMTowMVrOGybpbA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xNlQwNjoyMTowMVrOGybpbA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NTUzNDk1Ng==", "bodyText": "I wonder if people are confused by collection[0] and collection[1]. They refer to the uuid and name of a collection. Perhaps another interface can help this ?", "url": "https://github.com/openequella/openEQUELLA/pull/2059#discussion_r455534956", "createdAt": "2020-07-16T06:21:01Z", "author": {"login": "PenghaiZhang"}, "path": "Source/Plugins/Core/com.equella.core/js/tsrc/search/components/CollectionSelector.tsx", "diffHunk": "@@ -0,0 +1,80 @@\n+/*\n+ * Licensed to The Apereo Foundation under one or more contributor license\n+ * agreements. See the NOTICE file distributed with this work for additional\n+ * information regarding copyright ownership.\n+ *\n+ * The Apereo Foundation licenses this file to you under the Apache License,\n+ * Version 2.0, (the \"License\"); you may not use this file except in compliance\n+ * with the License. You may obtain a copy of the License at:\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+import * as React from \"react\";\n+import { Checkbox, TextField } from \"@material-ui/core\";\n+import { useEffect, useState } from \"react\";\n+import { collectionListSummary } from \"../../modules/CollectionsModule\";\n+import { Autocomplete } from \"@material-ui/lab\";\n+import CheckBoxOutlineBlankIcon from \"@material-ui/icons/CheckBoxOutlineBlank\";\n+import CheckBoxIcon from \"@material-ui/icons/CheckBox\";\n+\n+interface CollectionSelectorProps {\n+  /**\n+   * Fire when collection selections are changed.\n+   * @param collections Selected collections.\n+   */\n+  onSelectionChange: (collections: string[]) => void;\n+}\n+\n+/**\n+ * As a refine search control, this component is used to filter search results by collections.\n+ */\n+export const CollectionSelector = ({\n+  onSelectionChange,\n+}: CollectionSelectorProps) => {\n+  const [collections, setCollections] = useState<[string, string][]>([]);\n+  useEffect(() => {\n+    collectionListSummary([\n+      \"SEARCH_COLLECTION\",\n+    ]).then((collections: Map<string, string>) =>\n+      setCollections(Array.from(collections))\n+    );\n+  }, []);\n+\n+  return (\n+    <Autocomplete\n+      multiple\n+      fullWidth\n+      limitTags={2}\n+      onChange={(event: React.ChangeEvent<{}>, value: [string, string][]) => {\n+        onSelectionChange(value.map((collection) => collection[0]));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "113c6b1f7ad417b25203dbd914253c060789e2a5"}, "originalPosition": 55}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b7b4dc75f41161333fc3906d14acb62e9f169a06", "author": {"user": {"login": "PenghaiZhang", "name": null}}, "url": "https://github.com/openequella/openEQUELLA/commit/b7b4dc75f41161333fc3906d14acb62e9f169a06", "committedDate": "2020-07-16T06:37:35Z", "message": "Add a test to ensure selected collections are included in a search."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDUwMjE1NTYx", "url": "https://github.com/openequella/openEQUELLA/pull/2059#pullrequestreview-450215561", "createdAt": "2020-07-16T21:04:47Z", "commit": {"oid": "b7b4dc75f41161333fc3906d14acb62e9f169a06"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xNlQyMTowNDo0N1rOGy8vdQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xNlQyMTowNDo0N1rOGy8vdQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NjA3NzE3Mw==", "bodyText": "Would it make sense to destructure this directly in the function params?", "url": "https://github.com/openequella/openEQUELLA/pull/2059#discussion_r456077173", "createdAt": "2020-07-16T21:04:47Z", "author": {"login": "ChristianMurphy"}, "path": "Source/Plugins/Core/com.equella.core/js/tsrc/search/SearchModule.ts", "diffHunk": "@@ -40,7 +40,13 @@ export const defaultPagedSearchResult: OEQ.Common.PagedResult<OEQ.Search.SearchR\n export const searchItems = (\n   searchOptions: SearchOptions\n ): Promise<OEQ.Common.PagedResult<OEQ.Search.SearchResultItem>> => {\n-  const { query, rowsPerPage, currentPage, sortOrder } = searchOptions;\n+  const {\n+    query,\n+    rowsPerPage,\n+    currentPage,\n+    sortOrder,\n+    collections,\n+  } = searchOptions;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b7b4dc75f41161333fc3906d14acb62e9f169a06"}, "originalPosition": 11}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDUwMjcyNTE3", "url": "https://github.com/openequella/openEQUELLA/pull/2059#pullrequestreview-450272517", "createdAt": "2020-07-16T23:02:42Z", "commit": {"oid": "b7b4dc75f41161333fc3906d14acb62e9f169a06"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xNlQyMzowMjo0MlrOGy_rXQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xNlQyMzowNzo0MlrOGy_xxQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NjEyNTI3Nw==", "bodyText": "For the other onChange type handlers above we've used handler functions (e.g. handleSortOrderChanged()). For consistency, let's stick with that. (As an aside, when working through some refactoring on this, having them split out like this (even for simple functions) has been handy.", "url": "https://github.com/openequella/openEQUELLA/pull/2059#discussion_r456125277", "createdAt": "2020-07-16T23:02:42Z", "author": {"login": "edalex-ian"}, "path": "Source/Plugins/Core/com.equella.core/js/tsrc/search/SearchPage.tsx", "diffHunk": "@@ -137,11 +138,11 @@ const SearchPage = ({ updateTemplate }: TemplateUpdateProps) => {\n \n       <Grid item xs={3}>\n         <RefineSearchPanel>\n-          <Typography>place holder 1</Typography>\n-          <Typography>place holder 2</Typography>\n-          <Typography>place holder 3</Typography>\n-          <Typography>place holder 4</Typography>\n-          <Typography>place holder 5</Typography>\n+          <CollectionSelector\n+            onSelectionChange={(collections: string[]) =>", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b7b4dc75f41161333fc3906d14acb62e9f169a06"}, "originalPosition": 27}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NjEyNjI5Mg==", "bodyText": "Yes, would be good to do the destructure. As one question I had earlier on in this was whether or not collection: string was the UUID or the name - and was hoping this would clarify for me (which in its current state does not).", "url": "https://github.com/openequella/openEQUELLA/pull/2059#discussion_r456126292", "createdAt": "2020-07-16T23:05:31Z", "author": {"login": "edalex-ian"}, "path": "Source/Plugins/Core/com.equella.core/js/tsrc/search/components/CollectionSelector.tsx", "diffHunk": "@@ -0,0 +1,80 @@\n+/*\n+ * Licensed to The Apereo Foundation under one or more contributor license\n+ * agreements. See the NOTICE file distributed with this work for additional\n+ * information regarding copyright ownership.\n+ *\n+ * The Apereo Foundation licenses this file to you under the Apache License,\n+ * Version 2.0, (the \"License\"); you may not use this file except in compliance\n+ * with the License. You may obtain a copy of the License at:\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+import * as React from \"react\";\n+import { Checkbox, TextField } from \"@material-ui/core\";\n+import { useEffect, useState } from \"react\";\n+import { collectionListSummary } from \"../../modules/CollectionsModule\";\n+import { Autocomplete } from \"@material-ui/lab\";\n+import CheckBoxOutlineBlankIcon from \"@material-ui/icons/CheckBoxOutlineBlank\";\n+import CheckBoxIcon from \"@material-ui/icons/CheckBox\";\n+\n+interface CollectionSelectorProps {\n+  /**\n+   * Fire when collection selections are changed.\n+   * @param collections Selected collections.\n+   */\n+  onSelectionChange: (collections: string[]) => void;\n+}\n+\n+/**\n+ * As a refine search control, this component is used to filter search results by collections.\n+ */\n+export const CollectionSelector = ({\n+  onSelectionChange,\n+}: CollectionSelectorProps) => {\n+  const [collections, setCollections] = useState<[string, string][]>([]);\n+  useEffect(() => {\n+    collectionListSummary([\n+      \"SEARCH_COLLECTION\",\n+    ]).then((collections: Map<string, string>) =>\n+      setCollections(Array.from(collections))\n+    );\n+  }, []);\n+\n+  return (\n+    <Autocomplete\n+      multiple\n+      fullWidth\n+      limitTags={2}\n+      onChange={(event: React.ChangeEvent<{}>, value: [string, string][]) => {\n+        onSelectionChange(value.map((collection) => collection[0]));", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NTUzNDk1Ng=="}, "originalCommit": {"oid": "113c6b1f7ad417b25203dbd914253c060789e2a5"}, "originalPosition": 55}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NjEyNjkxNw==", "bodyText": "In my current work to support 'back' to the search page, we need a prop that allows us to set the initial selections. Any chance you could add this?", "url": "https://github.com/openequella/openEQUELLA/pull/2059#discussion_r456126917", "createdAt": "2020-07-16T23:07:42Z", "author": {"login": "edalex-ian"}, "path": "Source/Plugins/Core/com.equella.core/js/tsrc/search/components/CollectionSelector.tsx", "diffHunk": "@@ -0,0 +1,83 @@\n+/*\n+ * Licensed to The Apereo Foundation under one or more contributor license\n+ * agreements. See the NOTICE file distributed with this work for additional\n+ * information regarding copyright ownership.\n+ *\n+ * The Apereo Foundation licenses this file to you under the Apache License,\n+ * Version 2.0, (the \"License\"); you may not use this file except in compliance\n+ * with the License. You may obtain a copy of the License at:\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+import * as React from \"react\";\n+import { Checkbox, TextField } from \"@material-ui/core\";\n+import { useEffect, useState } from \"react\";\n+import { collectionListSummary } from \"../../modules/CollectionsModule\";\n+import { Autocomplete } from \"@material-ui/lab\";\n+import CheckBoxOutlineBlankIcon from \"@material-ui/icons/CheckBoxOutlineBlank\";\n+import CheckBoxIcon from \"@material-ui/icons/CheckBox\";\n+import { languageStrings } from \"../../util/langstrings\";\n+\n+interface CollectionSelectorProps {\n+  /**\n+   * Fires when collection selections are changed.\n+   * @param collections Selected collections.\n+   */\n+  onSelectionChange: (collections: string[]) => void;\n+}", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b7b4dc75f41161333fc3906d14acb62e9f169a06"}, "originalPosition": 33}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDUwMjg2OTcx", "url": "https://github.com/openequella/openEQUELLA/pull/2059#pullrequestreview-450286971", "createdAt": "2020-07-16T23:44:41Z", "commit": {"oid": "b7b4dc75f41161333fc3906d14acb62e9f169a06"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xNlQyMzo0NDo0MlrOGzAfMQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xNlQyMzo0NDo0MlrOGzAfMQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NjEzODU0NQ==", "bodyText": "what are collection[0] and collection[1]?\nAre these things we could destructure and give more meaningful names?", "url": "https://github.com/openequella/openEQUELLA/pull/2059#discussion_r456138545", "createdAt": "2020-07-16T23:44:42Z", "author": {"login": "ChristianMurphy"}, "path": "Source/Plugins/Core/com.equella.core/js/tsrc/search/components/CollectionSelector.tsx", "diffHunk": "@@ -0,0 +1,83 @@\n+/*\n+ * Licensed to The Apereo Foundation under one or more contributor license\n+ * agreements. See the NOTICE file distributed with this work for additional\n+ * information regarding copyright ownership.\n+ *\n+ * The Apereo Foundation licenses this file to you under the Apache License,\n+ * Version 2.0, (the \"License\"); you may not use this file except in compliance\n+ * with the License. You may obtain a copy of the License at:\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+import * as React from \"react\";\n+import { Checkbox, TextField } from \"@material-ui/core\";\n+import { useEffect, useState } from \"react\";\n+import { collectionListSummary } from \"../../modules/CollectionsModule\";\n+import { Autocomplete } from \"@material-ui/lab\";\n+import CheckBoxOutlineBlankIcon from \"@material-ui/icons/CheckBoxOutlineBlank\";\n+import CheckBoxIcon from \"@material-ui/icons/CheckBox\";\n+import { languageStrings } from \"../../util/langstrings\";\n+\n+interface CollectionSelectorProps {\n+  /**\n+   * Fires when collection selections are changed.\n+   * @param collections Selected collections.\n+   */\n+  onSelectionChange: (collections: string[]) => void;\n+}\n+\n+/**\n+ * As a refine search control, this component is used to filter search results by collections.\n+ */\n+export const CollectionSelector = ({\n+  onSelectionChange,\n+}: CollectionSelectorProps) => {\n+  const collectionSelectorStrings =\n+    languageStrings.searchpage.collectionSelector;\n+  const [collections, setCollections] = useState<[string, string][]>([]);\n+  useEffect(() => {\n+    collectionListSummary([\n+      \"SEARCH_COLLECTION\",\n+    ]).then((collections: Map<string, string>) =>\n+      setCollections(Array.from(collections))\n+    );\n+  }, []);\n+\n+  return (\n+    <Autocomplete\n+      multiple\n+      fullWidth\n+      limitTags={2}\n+      onChange={(_, value: [string, string][]) => {\n+        onSelectionChange(value.map((collection) => collection[0]));\n+      }}\n+      options={collections}\n+      disableCloseOnSelect\n+      getOptionLabel={(collection) => collection[1]}\n+      renderOption={(collection, { selected }) => (\n+        <>\n+          <Checkbox\n+            icon={<CheckBoxOutlineBlankIcon fontSize=\"small\" />}\n+            checkedIcon={<CheckBoxIcon fontSize=\"small\" />}\n+            checked={selected}\n+          />\n+          {collection[1]}", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b7b4dc75f41161333fc3906d14acb62e9f169a06"}, "originalPosition": 70}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "4cf9953f3f0228d080626f4d084789482cf5b2d2", "author": {"user": {"login": "PenghaiZhang", "name": null}}, "url": "https://github.com/openequella/openEQUELLA/commit/4cf9953f3f0228d080626f4d084789482cf5b2d2", "committedDate": "2020-07-17T01:56:15Z", "message": "A few updates for Collection selector\n\n1. Allow the component to take an initial value to support the feature\n   of 'back to Search page'.\n2. The component's value is now controlled by state.\n3. Add a simplified type for Collection.\n4. Update Search page test to use the Collection type."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDUwMzI4MjMx", "url": "https://github.com/openequella/openEQUELLA/pull/2059#pullrequestreview-450328231", "createdAt": "2020-07-17T02:06:20Z", "commit": {"oid": "4cf9953f3f0228d080626f4d084789482cf5b2d2"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDUwMzMwODc5", "url": "https://github.com/openequella/openEQUELLA/pull/2059#pullrequestreview-450330879", "createdAt": "2020-07-17T02:16:08Z", "commit": {"oid": "4cf9953f3f0228d080626f4d084789482cf5b2d2"}, "state": "APPROVED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xN1QwMjoxNjowOVrOGzDCVg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xN1QwMjoxNjowOVrOGzDCVg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NjE4MDMxMA==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n             * A simplified type of Collection used when only collection'uuid and name are required.\n          \n          \n            \n             * A simplified type of Collection used when only collection uuid and name are required.", "url": "https://github.com/openequella/openEQUELLA/pull/2059#discussion_r456180310", "createdAt": "2020-07-17T02:16:09Z", "author": {"login": "SammyIsConfused"}, "path": "Source/Plugins/Core/com.equella.core/js/tsrc/modules/CollectionsModule.ts", "diffHunk": "@@ -35,3 +35,17 @@ export const collectionListSummary = (\n     length: 100,\n     privilege: requiredPrivileges,\n   }).then(summarisePagedBaseEntities);\n+\n+/**\n+ * A simplified type of Collection used when only collection'uuid and name are required.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "4cf9953f3f0228d080626f4d084789482cf5b2d2"}, "originalPosition": 6}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b6ab50681116b5b2106df7e8d6b85becd988a992", "author": {"user": {"login": "PenghaiZhang", "name": null}}, "url": "https://github.com/openequella/openEQUELLA/commit/b6ab50681116b5b2106df7e8d6b85becd988a992", "committedDate": "2020-07-17T02:20:54Z", "message": "Properly use 'getOptionSelected' to check if a collection is selected"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "1404db5a04196b5f3687abdd931c244ca58505e2", "author": {"user": {"login": "PenghaiZhang", "name": null}}, "url": "https://github.com/openequella/openEQUELLA/commit/1404db5a04196b5f3687abdd931c244ca58505e2", "committedDate": "2020-07-17T02:22:02Z", "message": "Fix a typo issue for Collection module.\n\nCo-authored-by: SammyIsConfused <samantha.fisher@edalex.com>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDUwMzQwNzk5", "url": "https://github.com/openequella/openEQUELLA/pull/2059#pullrequestreview-450340799", "createdAt": "2020-07-17T02:52:10Z", "commit": {"oid": "1404db5a04196b5f3687abdd931c244ca58505e2"}, "state": "APPROVED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xN1QwMjo1MjoxMFrOGzDmGA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xN1QwMjo1NjoyMVrOGzDqLw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NjE4OTQ2NA==", "bodyText": "If it's more useful, how about changing collectionListSummary to return Collection[]?", "url": "https://github.com/openequella/openEQUELLA/pull/2059#discussion_r456189464", "createdAt": "2020-07-17T02:52:10Z", "author": {"login": "edalex-ian"}, "path": "Source/Plugins/Core/com.equella.core/js/tsrc/search/components/CollectionSelector.tsx", "diffHunk": "@@ -0,0 +1,103 @@\n+/*\n+ * Licensed to The Apereo Foundation under one or more contributor license\n+ * agreements. See the NOTICE file distributed with this work for additional\n+ * information regarding copyright ownership.\n+ *\n+ * The Apereo Foundation licenses this file to you under the Apache License,\n+ * Version 2.0, (the \"License\"); you may not use this file except in compliance\n+ * with the License. You may obtain a copy of the License at:\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+import * as React from \"react\";\n+import { Checkbox, TextField } from \"@material-ui/core\";\n+import { useEffect, useState } from \"react\";\n+import {\n+  Collection,\n+  collectionListSummary,\n+} from \"../../modules/CollectionsModule\";\n+import { Autocomplete } from \"@material-ui/lab\";\n+import CheckBoxOutlineBlankIcon from \"@material-ui/icons/CheckBoxOutlineBlank\";\n+import CheckBoxIcon from \"@material-ui/icons/CheckBox\";\n+import { languageStrings } from \"../../util/langstrings\";\n+\n+interface CollectionSelectorProps {\n+  /**\n+   * Fires when collection selections are changed.\n+   * @param collections Selected collections.\n+   */\n+  onSelectionChange: (collections: Collection[]) => void;\n+  /**\n+   * Initially selected collections.\n+   */\n+  value?: Collection[];\n+}\n+\n+/**\n+ * As a refine search control, this component is used to filter search results by collections.\n+ * The initially selected collections are either provided through props or an empty array.\n+ */\n+export const CollectionSelector = ({\n+  onSelectionChange,\n+  value,\n+}: CollectionSelectorProps) => {\n+  const collectionSelectorStrings =\n+    languageStrings.searchpage.collectionSelector;\n+  const [collections, setCollections] = useState<Collection[]>([]);\n+  const [selectedCollections, setSelectedCollections] = useState<Collection[]>(\n+    value ?? []\n+  );\n+\n+  useEffect(() => {\n+    collectionListSummary([", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "1404db5a04196b5f3687abdd931c244ca58505e2"}, "originalPosition": 58}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NjE5MDUxMQ==", "bodyText": "Do you need that in state at all?\nI'd assume you'd just use value directly down on the AutoComplete's value, and then rely on two way binding via onSelectionChange. \ud83e\udd14", "url": "https://github.com/openequella/openEQUELLA/pull/2059#discussion_r456190511", "createdAt": "2020-07-17T02:56:21Z", "author": {"login": "edalex-ian"}, "path": "Source/Plugins/Core/com.equella.core/js/tsrc/search/components/CollectionSelector.tsx", "diffHunk": "@@ -0,0 +1,103 @@\n+/*\n+ * Licensed to The Apereo Foundation under one or more contributor license\n+ * agreements. See the NOTICE file distributed with this work for additional\n+ * information regarding copyright ownership.\n+ *\n+ * The Apereo Foundation licenses this file to you under the Apache License,\n+ * Version 2.0, (the \"License\"); you may not use this file except in compliance\n+ * with the License. You may obtain a copy of the License at:\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+import * as React from \"react\";\n+import { Checkbox, TextField } from \"@material-ui/core\";\n+import { useEffect, useState } from \"react\";\n+import {\n+  Collection,\n+  collectionListSummary,\n+} from \"../../modules/CollectionsModule\";\n+import { Autocomplete } from \"@material-ui/lab\";\n+import CheckBoxOutlineBlankIcon from \"@material-ui/icons/CheckBoxOutlineBlank\";\n+import CheckBoxIcon from \"@material-ui/icons/CheckBox\";\n+import { languageStrings } from \"../../util/langstrings\";\n+\n+interface CollectionSelectorProps {\n+  /**\n+   * Fires when collection selections are changed.\n+   * @param collections Selected collections.\n+   */\n+  onSelectionChange: (collections: Collection[]) => void;\n+  /**\n+   * Initially selected collections.\n+   */\n+  value?: Collection[];\n+}\n+\n+/**\n+ * As a refine search control, this component is used to filter search results by collections.\n+ * The initially selected collections are either provided through props or an empty array.\n+ */\n+export const CollectionSelector = ({\n+  onSelectionChange,\n+  value,\n+}: CollectionSelectorProps) => {\n+  const collectionSelectorStrings =\n+    languageStrings.searchpage.collectionSelector;\n+  const [collections, setCollections] = useState<Collection[]>([]);\n+  const [selectedCollections, setSelectedCollections] = useState<Collection[]>(\n+    value ?? []\n+  );", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "1404db5a04196b5f3687abdd931c244ca58505e2"}, "originalPosition": 55}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "9e4bfa7d48e229a9419ffc1cca6ef84d81d72189", "author": {"user": {"login": "PenghaiZhang", "name": null}}, "url": "https://github.com/openequella/openEQUELLA/commit/9e4bfa7d48e229a9419ffc1cca6ef84d81d72189", "committedDate": "2020-07-17T04:35:39Z", "message": "Change the return of collectionListSummary from Map to Array."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "07e724b472d0e4d5b92e1745be6ffe507c21727c", "author": {"user": {"login": "PenghaiZhang", "name": null}}, "url": "https://github.com/openequella/openEQUELLA/commit/07e724b472d0e4d5b92e1745be6ffe507c21727c", "committedDate": "2020-07-17T04:36:00Z", "message": "Remove CollectionSelector's unnecessary state usage."}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4976, "cost": 1, "resetAt": "2021-11-01T16:37:27Z"}}}