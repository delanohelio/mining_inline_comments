{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDQzMjAzMTI1", "number": 1990, "reviewThreads": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wMlQwNDoxMDo1NVrOEKvPZg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wMlQwNDoyNzoxM1rOEKvZZg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjc5Njk1MjA2OnYy", "diffSide": "RIGHT", "path": "Source/Plugins/Core/com.equella.core/js/tsrc/theme/ThemePage.tsx", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wMlQwNDoxMDo1NVrOGr8x3A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wMlQwNDo1NzozM1rOGr9d4A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0ODczNzc1Ng==", "bodyText": "If all color settings are already default and I press the reset button again, will the Save button become enabled and allow me to submit?", "url": "https://github.com/openequella/openEQUELLA/pull/1990#discussion_r448737756", "createdAt": "2020-07-02T04:10:55Z", "author": {"login": "PenghaiZhang"}, "path": "Source/Plugins/Core/com.equella.core/js/tsrc/theme/ThemePage.tsx", "diffHunk": "@@ -122,6 +130,7 @@ class ThemePage extends React.Component<\n         menuIcon: \"#000000\",\n         primaryText: \"#000000\",\n         secondaryText: \"#444444\",\n+        changesUnsaved: true,", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "4dd3877f4270a56d30ec088c3f7bf998e30d173f"}, "originalPosition": 146}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0ODc0OTAyNA==", "bodyText": "Yup, it will. It's very simple.\nArguably it could have some more smarts in there. However there's no real harm as a result, and for that kind of stuff I've tried to keep the logic pretty well the same.\nIndeed, the logo reset was designed to reload when pushing the button, and I've left that as is for now. But in the future, we may want to come back and refactor that side of things.", "url": "https://github.com/openequella/openEQUELLA/pull/1990#discussion_r448749024", "createdAt": "2020-07-02T04:57:33Z", "author": {"login": "edalex-ian"}, "path": "Source/Plugins/Core/com.equella.core/js/tsrc/theme/ThemePage.tsx", "diffHunk": "@@ -122,6 +130,7 @@ class ThemePage extends React.Component<\n         menuIcon: \"#000000\",\n         primaryText: \"#000000\",\n         secondaryText: \"#444444\",\n+        changesUnsaved: true,", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0ODczNzc1Ng=="}, "originalCommit": {"oid": "4dd3877f4270a56d30ec088c3f7bf998e30d173f"}, "originalPosition": 146}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjc5Njk3NzY2OnYy", "diffSide": "RIGHT", "path": "Source/Plugins/Core/com.equella.core/js/tsrc/theme/ThemePage.tsx", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wMlQwNDoyNzoxM1rOGr9Ajw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wMlQwNDo1MjowN1rOGr9Yjw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0ODc0MTUxOQ==", "bodyText": "I like this try...catch block because it makes this function easy to read. Only when the two promises get resolved,  the state is updated.", "url": "https://github.com/openequella/openEQUELLA/pull/1990#discussion_r448741519", "createdAt": "2020-07-02T04:27:13Z", "author": {"login": "PenghaiZhang"}, "path": "Source/Plugins/Core/com.equella.core/js/tsrc/theme/ThemePage.tsx", "diffHunk": "@@ -184,58 +168,52 @@ class ThemePage extends React.Component<\n         this.setState({\n           logoToUpload: file,\n           fileName: file.name,\n+          changesUnsaved: true,\n         });\n       };\n     }\n   };\n \n-  submitTheme = () => {\n-    axios\n-      .put(`${API_BASE_URL}/theme/settings/`, {\n-        primaryColor: this.state.primary,\n-        secondaryColor: this.state.secondary,\n-        backgroundColor: this.state.background,\n-        menuItemColor: this.state.menu,\n-        menuItemIconColor: this.state.menuIcon,\n-        menuItemTextColor: this.state.menuText,\n-        primaryTextColor: this.state.primaryText,\n-        menuTextColor: this.state.secondaryText,\n-        fontSize: 14,\n-      })\n-      .then(() => {\n-        this.reload();\n-      })\n-      .catch((error) => {\n-        this.handleError(error);\n-      });\n-  };\n+  submitTheme = () =>\n+    axios.put(`${API_BASE_URL}/theme/settings/`, {\n+      primaryColor: this.state.primary,\n+      secondaryColor: this.state.secondary,\n+      backgroundColor: this.state.background,\n+      menuItemColor: this.state.menu,\n+      menuItemIconColor: this.state.menuIcon,\n+      menuItemTextColor: this.state.menuText,\n+      primaryTextColor: this.state.primaryText,\n+      menuTextColor: this.state.secondaryText,\n+      fontSize: 14,\n+    });\n+\n+  submitLogo = () =>\n+    this.state.logoToUpload &&\n+    axios.put(`${API_BASE_URL}/theme/logo/`, this.state.logoToUpload);\n+\n+  async saveChanges() {\n+    try {\n+      await this.submitLogo();\n+      await this.submitTheme();\n+      this.setState({ changesUnsaved: false, showSuccess: true });", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "4dd3877f4270a56d30ec088c3f7bf998e30d173f"}, "originalPosition": 242}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0ODc0NzY2Mw==", "bodyText": "Yeah, the async function syntax is definitely a big win for readability.", "url": "https://github.com/openequella/openEQUELLA/pull/1990#discussion_r448747663", "createdAt": "2020-07-02T04:52:07Z", "author": {"login": "edalex-ian"}, "path": "Source/Plugins/Core/com.equella.core/js/tsrc/theme/ThemePage.tsx", "diffHunk": "@@ -184,58 +168,52 @@ class ThemePage extends React.Component<\n         this.setState({\n           logoToUpload: file,\n           fileName: file.name,\n+          changesUnsaved: true,\n         });\n       };\n     }\n   };\n \n-  submitTheme = () => {\n-    axios\n-      .put(`${API_BASE_URL}/theme/settings/`, {\n-        primaryColor: this.state.primary,\n-        secondaryColor: this.state.secondary,\n-        backgroundColor: this.state.background,\n-        menuItemColor: this.state.menu,\n-        menuItemIconColor: this.state.menuIcon,\n-        menuItemTextColor: this.state.menuText,\n-        primaryTextColor: this.state.primaryText,\n-        menuTextColor: this.state.secondaryText,\n-        fontSize: 14,\n-      })\n-      .then(() => {\n-        this.reload();\n-      })\n-      .catch((error) => {\n-        this.handleError(error);\n-      });\n-  };\n+  submitTheme = () =>\n+    axios.put(`${API_BASE_URL}/theme/settings/`, {\n+      primaryColor: this.state.primary,\n+      secondaryColor: this.state.secondary,\n+      backgroundColor: this.state.background,\n+      menuItemColor: this.state.menu,\n+      menuItemIconColor: this.state.menuIcon,\n+      menuItemTextColor: this.state.menuText,\n+      primaryTextColor: this.state.primaryText,\n+      menuTextColor: this.state.secondaryText,\n+      fontSize: 14,\n+    });\n+\n+  submitLogo = () =>\n+    this.state.logoToUpload &&\n+    axios.put(`${API_BASE_URL}/theme/logo/`, this.state.logoToUpload);\n+\n+  async saveChanges() {\n+    try {\n+      await this.submitLogo();\n+      await this.submitTheme();\n+      this.setState({ changesUnsaved: false, showSuccess: true });", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0ODc0MTUxOQ=="}, "originalCommit": {"oid": "4dd3877f4270a56d30ec088c3f7bf998e30d173f"}, "originalPosition": 242}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1240, "cost": 1, "resetAt": "2021-11-12T20:44:06Z"}}}