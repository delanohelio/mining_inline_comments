{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDM5ODA2MjU4", "number": 1949, "title": "EBP improvements", "bodyText": "Checklist\n\n the [contributor license agreement][] is signed\n commit message follows [commit guidelines][]\n tests are included\n screenshots are included showing significant UI changes\n documentation is changed or added\n\nDescription of change\n@mrblippy 's test found that auto-complete taxonomy control is still half width, and the Wizard right nav does display properly in Moderation page. So this PR aims to fix these two issues.", "createdAt": "2020-06-25T08:15:35Z", "url": "https://github.com/openequella/openEQUELLA/pull/1949", "merged": true, "mergeCommit": {"oid": "768f90ba4e49cac5ffad5ecea011f46edfad3089"}, "closed": true, "closedAt": "2020-06-26T08:45:53Z", "author": {"login": "PenghaiZhang"}, "timelineItems": {"totalCount": 10, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcunR_mgH2gAyNDM5ODA2MjU4OjQ4YzVhYzMyMzc1ZDU3NDIxMWUyNmM5YmY3MDM3ODBiY2FjZGU4N2Y=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcu9sUegFqTQzODA1NjQyMQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "48c5ac32375d574211e26c9bf703780bcacde87f", "author": {"user": {"login": "PenghaiZhang", "name": null}}, "url": "https://github.com/openequella/openEQUELLA/commit/48c5ac32375d574211e26c9bf703780bcacde87f", "committedDate": "2020-06-25T04:52:33Z", "message": "Make the Auto-complete taxonomy control full width."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "add491ccf7beb40a38b5bc2105d1c3b1473d2335", "author": {"user": {"login": "PenghaiZhang", "name": null}}, "url": "https://github.com/openequella/openEQUELLA/commit/add491ccf7beb40a38b5bc2105d1c3b1473d2335", "committedDate": "2020-06-25T08:13:10Z", "message": "Make right navigation bar stick on top of Moderation page\n\nDue to different page layout, the CSS style applied on 'affix-div' has\nto be slightly different. And in Moderation page, apply this style only\nwhen the Moderation panel is invisible in viewport."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDM3MjY4NDE0", "url": "https://github.com/openequella/openEQUELLA/pull/1949#pullrequestreview-437268414", "createdAt": "2020-06-25T08:16:51Z", "commit": {"oid": "add491ccf7beb40a38b5bc2105d1c3b1473d2335"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yNVQwODoxNjo1MVrOGowO-w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yNVQwODoxNjo1MVrOGowO-w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NTM4NjQ5MQ==", "bodyText": "This new function is the only real change I made. Prettier did others I think.", "url": "https://github.com/openequella/openEQUELLA/pull/1949#discussion_r445386491", "createdAt": "2020-06-25T08:16:51Z", "author": {"login": "PenghaiZhang"}, "path": "Source/Plugins/Core/com.equella.core/resources/web/scripts/wizardctrl.js", "diffHunk": "@@ -1,24 +1,62 @@\n+/*\n+ * Licensed to The Apereo Foundation under one or more contributor license\n+ * agreements. See the NOTICE file distributed with this work for additional\n+ * information regarding copyright ownership.\n+ *\n+ * The Apereo Foundation licenses this file to you under the Apache License,\n+ * Version 2.0, (the \"License\"); you may not use this file except in compliance\n+ * with the License. You may obtain a copy of the License at:\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n var WizardCtrl = {\n-\tsetMessage : function(ctrlid, message)\n-\t{\n-\t\tvar $ctrl = $(\"#\" + ctrlid);\n-\t\tvar $content = $ctrl.children(\"div:first-child\");\n-\t\tvar $msg = $content.children(\"p.ctrlinvalidmessage\");\n-\t\tif (!message)\n-\t\t{\n-\t\t\t$content.removeClass(\"ctrlinvalid\");\n-\t\t\t$msg.empty();\n-\t\t}\n-\t\telse\n-\t\t{\n-\t\t\t$content.addClass(\"ctrlinvalid\");\n-\t\t\t$msg.html(message);\n-\t\t}\n-\t},\n-\taffixDiv: function() {\n-\t    var ad = $(\"#affix-div\");\n-\t    ad.attr(\"data-spy\", \"affix\");\n-\t    var offset = (ad.offset().top) - 55;\n-\t    ad.attr(\"data-offset-top\",offset);\n-\t}\n-};\n\\ No newline at end of file\n+  setMessage: function (ctrlid, message) {\n+    var $ctrl = $(\"#\" + ctrlid);\n+    var $content = $ctrl.children(\"div:first-child\");\n+    var $msg = $content.children(\"p.ctrlinvalidmessage\");\n+    if (!message) {\n+      $content.removeClass(\"ctrlinvalid\");\n+      $msg.empty();\n+    } else {\n+      $content.addClass(\"ctrlinvalid\");\n+      $msg.html(message);\n+    }\n+  },\n+  affixDiv: function () {\n+    var ad = $(\"#affix-div\");\n+    ad.attr(\"data-spy\", \"affix\");\n+    var offset = ad.offset().top - 55;\n+    ad.attr(\"data-offset-top\", offset);\n+  },\n+  affixDivNewUI: function () {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "add491ccf7beb40a38b5bc2105d1c3b1473d2335"}, "originalPosition": 61}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDM3OTMxMTU3", "url": "https://github.com/openequella/openEQUELLA/pull/1949#pullrequestreview-437931157", "createdAt": "2020-06-25T23:47:41Z", "commit": {"oid": "add491ccf7beb40a38b5bc2105d1c3b1473d2335"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yNVQyMzo0Nzo0MVrOGpPa4A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yNVQyMzo1OTozOVrOGpPn4g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NTg5NzQ0MA==", "bodyText": "I think we're safe to use const as that's even supported in IE11 (unlike let). So we should.", "url": "https://github.com/openequella/openEQUELLA/pull/1949#discussion_r445897440", "createdAt": "2020-06-25T23:47:41Z", "author": {"login": "edalex-ian"}, "path": "Source/Plugins/Core/com.equella.core/resources/web/scripts/wizardctrl.js", "diffHunk": "@@ -1,24 +1,62 @@\n+/*\n+ * Licensed to The Apereo Foundation under one or more contributor license\n+ * agreements. See the NOTICE file distributed with this work for additional\n+ * information regarding copyright ownership.\n+ *\n+ * The Apereo Foundation licenses this file to you under the Apache License,\n+ * Version 2.0, (the \"License\"); you may not use this file except in compliance\n+ * with the License. You may obtain a copy of the License at:\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n var WizardCtrl = {\n-\tsetMessage : function(ctrlid, message)\n-\t{\n-\t\tvar $ctrl = $(\"#\" + ctrlid);\n-\t\tvar $content = $ctrl.children(\"div:first-child\");\n-\t\tvar $msg = $content.children(\"p.ctrlinvalidmessage\");\n-\t\tif (!message)\n-\t\t{\n-\t\t\t$content.removeClass(\"ctrlinvalid\");\n-\t\t\t$msg.empty();\n-\t\t}\n-\t\telse\n-\t\t{\n-\t\t\t$content.addClass(\"ctrlinvalid\");\n-\t\t\t$msg.html(message);\n-\t\t}\n-\t},\n-\taffixDiv: function() {\n-\t    var ad = $(\"#affix-div\");\n-\t    ad.attr(\"data-spy\", \"affix\");\n-\t    var offset = (ad.offset().top) - 55;\n-\t    ad.attr(\"data-offset-top\",offset);\n-\t}\n-};\n\\ No newline at end of file\n+  setMessage: function (ctrlid, message) {\n+    var $ctrl = $(\"#\" + ctrlid);\n+    var $content = $ctrl.children(\"div:first-child\");\n+    var $msg = $content.children(\"p.ctrlinvalidmessage\");\n+    if (!message) {\n+      $content.removeClass(\"ctrlinvalid\");\n+      $msg.empty();\n+    } else {\n+      $content.addClass(\"ctrlinvalid\");\n+      $msg.html(message);\n+    }\n+  },\n+  affixDiv: function () {\n+    var ad = $(\"#affix-div\");\n+    ad.attr(\"data-spy\", \"affix\");\n+    var offset = ad.offset().top - 55;\n+    ad.attr(\"data-offset-top\", offset);\n+  },\n+  affixDivNewUI: function () {\n+    var moderate = $(\"#moderate\");", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "add491ccf7beb40a38b5bc2105d1c3b1473d2335"}, "originalPosition": 62}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NTg5OTMxNw==", "bodyText": "We need some improved variable names here. Maybe:\n\nmoderateTop -> moderationControlsHeight\nscrollTop -> currentWindowYPos", "url": "https://github.com/openequella/openEQUELLA/pull/1949#discussion_r445899317", "createdAt": "2020-06-25T23:54:32Z", "author": {"login": "edalex-ian"}, "path": "Source/Plugins/Core/com.equella.core/resources/web/scripts/wizardctrl.js", "diffHunk": "@@ -1,24 +1,62 @@\n+/*\n+ * Licensed to The Apereo Foundation under one or more contributor license\n+ * agreements. See the NOTICE file distributed with this work for additional\n+ * information regarding copyright ownership.\n+ *\n+ * The Apereo Foundation licenses this file to you under the Apache License,\n+ * Version 2.0, (the \"License\"); you may not use this file except in compliance\n+ * with the License. You may obtain a copy of the License at:\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n var WizardCtrl = {\n-\tsetMessage : function(ctrlid, message)\n-\t{\n-\t\tvar $ctrl = $(\"#\" + ctrlid);\n-\t\tvar $content = $ctrl.children(\"div:first-child\");\n-\t\tvar $msg = $content.children(\"p.ctrlinvalidmessage\");\n-\t\tif (!message)\n-\t\t{\n-\t\t\t$content.removeClass(\"ctrlinvalid\");\n-\t\t\t$msg.empty();\n-\t\t}\n-\t\telse\n-\t\t{\n-\t\t\t$content.addClass(\"ctrlinvalid\");\n-\t\t\t$msg.html(message);\n-\t\t}\n-\t},\n-\taffixDiv: function() {\n-\t    var ad = $(\"#affix-div\");\n-\t    ad.attr(\"data-spy\", \"affix\");\n-\t    var offset = (ad.offset().top) - 55;\n-\t    ad.attr(\"data-offset-top\",offset);\n-\t}\n-};\n\\ No newline at end of file\n+  setMessage: function (ctrlid, message) {\n+    var $ctrl = $(\"#\" + ctrlid);\n+    var $content = $ctrl.children(\"div:first-child\");\n+    var $msg = $content.children(\"p.ctrlinvalidmessage\");\n+    if (!message) {\n+      $content.removeClass(\"ctrlinvalid\");\n+      $msg.empty();\n+    } else {\n+      $content.addClass(\"ctrlinvalid\");\n+      $msg.html(message);\n+    }\n+  },\n+  affixDiv: function () {\n+    var ad = $(\"#affix-div\");\n+    ad.attr(\"data-spy\", \"affix\");\n+    var offset = ad.offset().top - 55;\n+    ad.attr(\"data-offset-top\", offset);\n+  },\n+  affixDivNewUI: function () {\n+    var moderate = $(\"#moderate\");\n+    var affixDiv = $(\"#affix-div\");\n+    if (moderate.length > 0) {\n+      $(window).on(\"scroll\", function () {\n+        // Use outerHeight to include margin.\n+        var moderateTop = moderate.outerHeight(true);\n+        var scrollTop = $(window).scrollTop();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "add491ccf7beb40a38b5bc2105d1c3b1473d2335"}, "originalPosition": 68}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NTkwMDc3MA==", "bodyText": "jQuery works such that if you add the same class again then it has no effect. And removing a non-existing class has no effect. (hmmm, unless maybe performance).\nAlso, this should be a if/else - not just two ifs. And in that case, a ternary operator would be fine I'd say.\nWith all that in mind, is this then just:\ncurrentWindowYPos >= moderationControlsHeight ?\n  affixDiv.addClass(\"moderation-rightNav\") :\n  affixDiv.removeClass(\"moderation-rightNav\" )", "url": "https://github.com/openequella/openEQUELLA/pull/1949#discussion_r445900770", "createdAt": "2020-06-25T23:59:39Z", "author": {"login": "edalex-ian"}, "path": "Source/Plugins/Core/com.equella.core/resources/web/scripts/wizardctrl.js", "diffHunk": "@@ -1,24 +1,62 @@\n+/*\n+ * Licensed to The Apereo Foundation under one or more contributor license\n+ * agreements. See the NOTICE file distributed with this work for additional\n+ * information regarding copyright ownership.\n+ *\n+ * The Apereo Foundation licenses this file to you under the Apache License,\n+ * Version 2.0, (the \"License\"); you may not use this file except in compliance\n+ * with the License. You may obtain a copy of the License at:\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n var WizardCtrl = {\n-\tsetMessage : function(ctrlid, message)\n-\t{\n-\t\tvar $ctrl = $(\"#\" + ctrlid);\n-\t\tvar $content = $ctrl.children(\"div:first-child\");\n-\t\tvar $msg = $content.children(\"p.ctrlinvalidmessage\");\n-\t\tif (!message)\n-\t\t{\n-\t\t\t$content.removeClass(\"ctrlinvalid\");\n-\t\t\t$msg.empty();\n-\t\t}\n-\t\telse\n-\t\t{\n-\t\t\t$content.addClass(\"ctrlinvalid\");\n-\t\t\t$msg.html(message);\n-\t\t}\n-\t},\n-\taffixDiv: function() {\n-\t    var ad = $(\"#affix-div\");\n-\t    ad.attr(\"data-spy\", \"affix\");\n-\t    var offset = (ad.offset().top) - 55;\n-\t    ad.attr(\"data-offset-top\",offset);\n-\t}\n-};\n\\ No newline at end of file\n+  setMessage: function (ctrlid, message) {\n+    var $ctrl = $(\"#\" + ctrlid);\n+    var $content = $ctrl.children(\"div:first-child\");\n+    var $msg = $content.children(\"p.ctrlinvalidmessage\");\n+    if (!message) {\n+      $content.removeClass(\"ctrlinvalid\");\n+      $msg.empty();\n+    } else {\n+      $content.addClass(\"ctrlinvalid\");\n+      $msg.html(message);\n+    }\n+  },\n+  affixDiv: function () {\n+    var ad = $(\"#affix-div\");\n+    ad.attr(\"data-spy\", \"affix\");\n+    var offset = ad.offset().top - 55;\n+    ad.attr(\"data-offset-top\", offset);\n+  },\n+  affixDivNewUI: function () {\n+    var moderate = $(\"#moderate\");\n+    var affixDiv = $(\"#affix-div\");\n+    if (moderate.length > 0) {\n+      $(window).on(\"scroll\", function () {\n+        // Use outerHeight to include margin.\n+        var moderateTop = moderate.outerHeight(true);\n+        var scrollTop = $(window).scrollTop();\n+        if (\n+          scrollTop >= moderateTop &&\n+          !affixDiv.hasClass(\"moderation-rightNav\")\n+        ) {\n+          affixDiv.addClass(\"moderation-rightNav\");\n+        }\n+        if (\n+          scrollTop < moderateTop &&\n+          affixDiv.hasClass(\"moderation-rightNav\")\n+        ) {\n+          affixDiv.removeClass(\"moderation-rightNav\");\n+        }", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "add491ccf7beb40a38b5bc2105d1c3b1473d2335"}, "originalPosition": 80}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDM3OTQyOTcy", "url": "https://github.com/openequella/openEQUELLA/pull/1949#pullrequestreview-437942972", "createdAt": "2020-06-26T00:26:27Z", "commit": {"oid": "add491ccf7beb40a38b5bc2105d1c3b1473d2335"}, "state": "COMMENTED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "158a6eba41ab75833112755bda7acaf668741be7", "author": {"user": {"login": "PenghaiZhang", "name": null}}, "url": "https://github.com/openequella/openEQUELLA/commit/158a6eba41ab75833112755bda7acaf668741be7", "committedDate": "2020-06-26T00:39:44Z", "message": "Improve readability of JS function 'affixDivNewUI'."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e936dc65ecf06076ebd0e28f5c1213a2a6a8232c", "author": {"user": {"login": "PenghaiZhang", "name": null}}, "url": "https://github.com/openequella/openEQUELLA/commit/e936dc65ecf06076ebd0e28f5c1213a2a6a8232c", "committedDate": "2020-06-26T04:50:26Z", "message": "Attempt to pass TaxonomyControlsTest on GHA\n\nGHA's builds failed TaxonomyControlsTest because the test somehow selected\na wrong taxonomy term. So try to ensure right term is selected."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "34db9f55b6b4194781f9f85508e40231afbdff10", "author": {"user": {"login": "PenghaiZhang", "name": null}}, "url": "https://github.com/openequella/openEQUELLA/commit/34db9f55b6b4194781f9f85508e40231afbdff10", "committedDate": "2020-06-26T06:51:26Z", "message": "Use Media Queries to control the width of auto-complete taxonomy control."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f098c89ce5b812a8dbe5777ad312614f9468e833", "author": {"user": {"login": "PenghaiZhang", "name": null}}, "url": "https://github.com/openequella/openEQUELLA/commit/f098c89ce5b812a8dbe5777ad312614f9468e833", "committedDate": "2020-06-26T06:53:57Z", "message": "Revert \"Attempt to pass TaxonomyControlsTest on GHA\"\n\nThis reverts commit e936dc65ecf06076ebd0e28f5c1213a2a6a8232c."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDM4MDU2NDIx", "url": "https://github.com/openequella/openEQUELLA/pull/1949#pullrequestreview-438056421", "createdAt": "2020-06-26T06:59:13Z", "commit": {"oid": "f098c89ce5b812a8dbe5777ad312614f9468e833"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 18, "cost": 1, "resetAt": "2021-11-01T16:19:10Z"}}}