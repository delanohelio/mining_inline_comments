{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDg3NjU0NjA5", "number": 2286, "title": "Functional tests for new Search page", "bodyText": "#1306\nChecklist\n\n the [contributor license agreement][] is signed\n commit message follows [commit guidelines][]\n tests are included\n screenshots are included showing significant UI changes\n documentation is changed or added\n\nDescription of change\nCreated functional tests for new Search page.\nFour scenarios are tested:\n\nopen the page and perform an initial search; and\nperform a new search and then search with query and filters; and\nview an Item's summary page; and\ngo back to the page.\n\nSorry, I forgot to separate each test case into different commit. \ud83d\ude2d", "createdAt": "2020-09-16T00:47:03Z", "url": "https://github.com/openequella/openEQUELLA/pull/2286", "merged": true, "mergeCommit": {"oid": "b63b69d4b1a7b3004675cecd6f6cb88fca9f10ab"}, "closed": true, "closedAt": "2020-10-12T05:03:04Z", "author": {"login": "PenghaiZhang"}, "timelineItems": {"totalCount": 48, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdI9U1sAH2gAyNDg3NjU0NjA5OmJkZTkyNzEzMWU3YzRmNzFkMDM1NWQ3MDk1NzdkMzBiYThiYjJhMDk=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdRq5-UgH2gAyNDg3NjU0NjA5OjAwOGNlNmViNzdhMmNlOWY4MGM2YzNjNjEwZTA1ZTgzMjEwNjRhZTY=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "bde927131e7c4f71d0355d709577d30ba8bb2a09", "author": {"user": {"login": "PenghaiZhang", "name": null}}, "url": "https://github.com/openequella/openEQUELLA/commit/bde927131e7c4f71d0355d709577d30ba8bb2a09", "committedDate": "2020-09-15T01:15:36Z", "message": "Give Search result list an ID so that the autotest can access\nthe list conveniently."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "24eae671157d385656b2e8f4fec204e0cf8f66ad", "author": {"user": {"login": "PenghaiZhang", "name": null}}, "url": "https://github.com/openequella/openEQUELLA/commit/24eae671157d385656b2e8f4fec204e0cf8f66ad", "committedDate": "2020-09-15T01:15:36Z", "message": "Add a autotest PageObject for the new Search page."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "85feaeb69fdf6fdcc4c00b35f06ac9666f757ac2", "author": {"user": {"login": "PenghaiZhang", "name": null}}, "url": "https://github.com/openequella/openEQUELLA/commit/85feaeb69fdf6fdcc4c00b35f06ac9666f757ac2", "committedDate": "2020-09-15T01:15:36Z", "message": "Add a Selenium test for the new Search page\n\n1. Create two methods to help access the list of Search\nresult items and the link of a specified item.\n\n2. Create a test case to check if the initial search is\ncompleted after open the page. This method is also annotated\nby 'BeforeMethod'.\n\n3. Create a test case to check if clicking an item will\nopen this item's summary page."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "9fbc496fe263fe41ee5ee30ed4e5accefaf9a067", "author": {"user": {"login": "PenghaiZhang", "name": null}}, "url": "https://github.com/openequella/openEQUELLA/commit/9fbc496fe263fe41ee5ee30ed4e5accefaf9a067", "committedDate": "2020-09-16T00:30:45Z", "message": "Add more methods interacting with the Search page."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "2f72472bbb65630dc8bcf10660c915c50bcec794", "author": {"user": {"login": "PenghaiZhang", "name": null}}, "url": "https://github.com/openequella/openEQUELLA/commit/2f72472bbb65630dc8bcf10660c915c50bcec794", "committedDate": "2020-09-16T00:32:28Z", "message": "Add more test cases for new Search page."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e98f38eb45cc92eb1090710d5a04d6a5dbe4bcc0", "author": {"user": {"login": "PenghaiZhang", "name": null}}, "url": "https://github.com/openequella/openEQUELLA/commit/e98f38eb45cc92eb1090710d5a04d6a5dbe4bcc0", "committedDate": "2020-09-16T00:35:47Z", "message": "Include the new test suite in CI."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "77cc9bcb056a32a44ed31290408821abd4ea584c", "author": {"user": {"login": "PenghaiZhang", "name": null}}, "url": "https://github.com/openequella/openEQUELLA/commit/77cc9bcb056a32a44ed31290408821abd4ea584c", "committedDate": "2020-10-06T03:11:13Z", "message": "Merge branch 'component/new-search-page' into feature/autotests-for-search-page"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e942b10ada781e535cf78aa41acb1283d759c805", "author": {"user": {"login": "PenghaiZhang", "name": null}}, "url": "https://github.com/openequella/openEQUELLA/commit/e942b10ada781e535cf78aa41acb1283d759c805", "committedDate": "2020-10-06T04:55:47Z", "message": "Add the AutoTest account to Institution Facet."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "72cf800ee3bdcb0f4273c95472d07c46bd44e509", "author": {"user": {"login": "PenghaiZhang", "name": null}}, "url": "https://github.com/openequella/openEQUELLA/commit/72cf800ee3bdcb0f4273c95472d07c46bd44e509", "committedDate": "2020-10-06T05:15:18Z", "message": "Update the search settings of Institution Facet."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "2e1e982e3eac6772227ff5025712439f568da82e", "author": {"user": {"login": "PenghaiZhang", "name": null}}, "url": "https://github.com/openequella/openEQUELLA/commit/2e1e982e3eac6772227ff5025712439f568da82e", "committedDate": "2020-10-06T06:10:17Z", "message": "Update the ACLs of Institution Facet."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d17d4c49785fa802df2fdc827029d3a878c6be17", "author": {"user": {"login": "PenghaiZhang", "name": null}}, "url": "https://github.com/openequella/openEQUELLA/commit/d17d4c49785fa802df2fdc827029d3a878c6be17", "committedDate": "2020-10-06T06:11:16Z", "message": "Update NewSearchPageTest to run against Institution Facet."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c8e9776d128ce2cecb49d92fd7c51c856658d0a6", "author": {"user": {"login": "PenghaiZhang", "name": null}}, "url": "https://github.com/openequella/openEQUELLA/commit/c8e9776d128ce2cecb49d92fd7c51c856658d0a6", "committedDate": "2020-10-06T06:13:50Z", "message": "Add testing items to Institution Facet."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ad345cdab0d4bce5b441856afd04c6ff72f251ed", "author": {"user": {"login": "PenghaiZhang", "name": null}}, "url": "https://github.com/openequella/openEQUELLA/commit/ad345cdab0d4bce5b441856afd04c6ff72f251ed", "committedDate": "2020-10-06T06:20:37Z", "message": "No longer need the ID of searchResultList so remove it."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTAzNDIyOTU1", "url": "https://github.com/openequella/openEQUELLA/pull/2286#pullrequestreview-503422955", "createdAt": "2020-10-06T23:15:13Z", "commit": {"oid": "ad345cdab0d4bce5b441856afd04c6ff72f251ed"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 7, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wNlQyMzoxNToxM1rOHddHGA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wN1QwMDowNDozOVrOHdeB3Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMDY0NzcwNA==", "bodyText": "Curious.... You say the initial search should return 10 items, but then you wait for 16...", "url": "https://github.com/openequella/openEQUELLA/pull/2286#discussion_r500647704", "createdAt": "2020-10-06T23:15:13Z", "author": {"login": "edalex-ian"}, "path": "autotest/OldTests/src/test/java/com/tle/webtests/test/searching/NewSearchPageTest.java", "diffHunk": "@@ -0,0 +1,71 @@\n+package com.tle.webtests.test.searching;\n+\n+import static org.testng.Assert.assertEquals;\n+\n+import com.tle.webtests.framework.TestInstitution;\n+import com.tle.webtests.pageobject.searching.NewSearchPage;\n+import com.tle.webtests.pageobject.viewitem.SummaryPage;\n+import com.tle.webtests.test.AbstractCleanupAutoTest;\n+import org.openqa.selenium.WebElement;\n+import org.testng.annotations.Test;\n+\n+@TestInstitution(\"facet\")\n+public class NewSearchPageTest extends AbstractCleanupAutoTest {\n+  private NewSearchPage searchPage;\n+\n+  @Test(description = \"open the new Search page and wait for initial search completed\")\n+  public void initialSearch() {\n+    searchPage = new NewSearchPage(context).load();\n+    // The initial search should return 10 items.\n+    searchPage.waitForSearchCompleted(16);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ad345cdab0d4bce5b441856afd04c6ff72f251ed"}, "originalPosition": 20}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMDY0ODk0MA==", "bodyText": "It'd be good to have this as a method of NewSearchPage. Maybe with a signature of: SummaryPage selectItem(String itemTitle).", "url": "https://github.com/openequella/openEQUELLA/pull/2286#discussion_r500648940", "createdAt": "2020-10-06T23:19:20Z", "author": {"login": "edalex-ian"}, "path": "autotest/OldTests/src/test/java/com/tle/webtests/test/searching/NewSearchPageTest.java", "diffHunk": "@@ -0,0 +1,71 @@\n+package com.tle.webtests.test.searching;\n+\n+import static org.testng.Assert.assertEquals;\n+\n+import com.tle.webtests.framework.TestInstitution;\n+import com.tle.webtests.pageobject.searching.NewSearchPage;\n+import com.tle.webtests.pageobject.viewitem.SummaryPage;\n+import com.tle.webtests.test.AbstractCleanupAutoTest;\n+import org.openqa.selenium.WebElement;\n+import org.testng.annotations.Test;\n+\n+@TestInstitution(\"facet\")\n+public class NewSearchPageTest extends AbstractCleanupAutoTest {\n+  private NewSearchPage searchPage;\n+\n+  @Test(description = \"open the new Search page and wait for initial search completed\")\n+  public void initialSearch() {\n+    searchPage = new NewSearchPage(context).load();\n+    // The initial search should return 10 items.\n+    searchPage.waitForSearchCompleted(16);\n+  }\n+\n+  @Test(dependsOnMethods = \"initialSearch\", description = \"Search with a query and refine controls\")\n+  public void searchByFilters() {\n+    searchPage.newSearch();\n+    // Search by Collections.\n+    searchPage.selectCollection(\"programming\");\n+    searchPage.waitForSearchCompleted(9);\n+    // Expand the Refine control panel.\n+    searchPage.expandRefineControlPanel();\n+    // Search by Item status.\n+    searchPage.selectStatus(true);\n+    searchPage.waitForSearchCompleted(10);\n+    // Search by a query.\n+    searchPage.changeQuery(\"Java\");\n+    searchPage.waitForSearchCompleted(4);\n+    // Exclude attachments in a search.\n+    searchPage.selectSearchAttachments(false);\n+    searchPage.waitForSearchCompleted(4);\n+    // Search by date ranges.\n+    searchPage.selectCustomDateRange(\"2020-10-01\", \"2020-10-06\");\n+    searchPage.waitForSearchCompleted(1);\n+    // Search by an owner.\n+    searchPage.selectOwner(\"AutoTest\");\n+    searchPage.waitForSearchCompleted(1);\n+  }\n+\n+  @Test(description = \"open an item's summary page\", dependsOnMethods = \"searchByFilters\")\n+  public void openItemSummaryPage() {\n+    final String ITEM_TITLE = \"Java (cloned)\";\n+    WebElement titleLink = searchPage.getItemTitleLink(ITEM_TITLE);\n+    titleLink.click();\n+    SummaryPage summary = new SummaryPage(context).get();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ad345cdab0d4bce5b441856afd04c6ff72f251ed"}, "originalPosition": 53}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMDY0OTQxNQ==", "bodyText": "Could be good to add a comment above this to highlight what the following lines are doing:\n\n  \n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                assertEquals(searchBar.getAttribute(\"value\"), \"Java\");\n          \n          \n            \n                // Expect when going 'back' to the search page, the previous search settings have been remembered\n          \n          \n            \n                assertEquals(searchBar.getAttribute(\"value\"), \"Java\");", "url": "https://github.com/openequella/openEQUELLA/pull/2286#discussion_r500649415", "createdAt": "2020-10-06T23:21:01Z", "author": {"login": "edalex-ian"}, "path": "autotest/OldTests/src/test/java/com/tle/webtests/test/searching/NewSearchPageTest.java", "diffHunk": "@@ -0,0 +1,71 @@\n+package com.tle.webtests.test.searching;\n+\n+import static org.testng.Assert.assertEquals;\n+\n+import com.tle.webtests.framework.TestInstitution;\n+import com.tle.webtests.pageobject.searching.NewSearchPage;\n+import com.tle.webtests.pageobject.viewitem.SummaryPage;\n+import com.tle.webtests.test.AbstractCleanupAutoTest;\n+import org.openqa.selenium.WebElement;\n+import org.testng.annotations.Test;\n+\n+@TestInstitution(\"facet\")\n+public class NewSearchPageTest extends AbstractCleanupAutoTest {\n+  private NewSearchPage searchPage;\n+\n+  @Test(description = \"open the new Search page and wait for initial search completed\")\n+  public void initialSearch() {\n+    searchPage = new NewSearchPage(context).load();\n+    // The initial search should return 10 items.\n+    searchPage.waitForSearchCompleted(16);\n+  }\n+\n+  @Test(dependsOnMethods = \"initialSearch\", description = \"Search with a query and refine controls\")\n+  public void searchByFilters() {\n+    searchPage.newSearch();\n+    // Search by Collections.\n+    searchPage.selectCollection(\"programming\");\n+    searchPage.waitForSearchCompleted(9);\n+    // Expand the Refine control panel.\n+    searchPage.expandRefineControlPanel();\n+    // Search by Item status.\n+    searchPage.selectStatus(true);\n+    searchPage.waitForSearchCompleted(10);\n+    // Search by a query.\n+    searchPage.changeQuery(\"Java\");\n+    searchPage.waitForSearchCompleted(4);\n+    // Exclude attachments in a search.\n+    searchPage.selectSearchAttachments(false);\n+    searchPage.waitForSearchCompleted(4);\n+    // Search by date ranges.\n+    searchPage.selectCustomDateRange(\"2020-10-01\", \"2020-10-06\");\n+    searchPage.waitForSearchCompleted(1);\n+    // Search by an owner.\n+    searchPage.selectOwner(\"AutoTest\");\n+    searchPage.waitForSearchCompleted(1);\n+  }\n+\n+  @Test(description = \"open an item's summary page\", dependsOnMethods = \"searchByFilters\")\n+  public void openItemSummaryPage() {\n+    final String ITEM_TITLE = \"Java (cloned)\";\n+    WebElement titleLink = searchPage.getItemTitleLink(ITEM_TITLE);\n+    titleLink.click();\n+    SummaryPage summary = new SummaryPage(context).get();\n+    assertEquals(summary.getItemTitle(), ITEM_TITLE);\n+  }\n+\n+  @Test(\n+      description = \"Go back to the Search page from another page\",\n+      dependsOnMethods = \"openItemSummaryPage\")\n+  public void backToSearchPage() {\n+    context.getDriver().navigate().back();\n+    WebElement searchBar = searchPage.getSearchBar();\n+    assertEquals(searchBar.getAttribute(\"value\"), \"Java\");", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ad345cdab0d4bce5b441856afd04c6ff72f251ed"}, "originalPosition": 63}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMDY1NzEzOA==", "bodyText": "I was wondering why you were going through this pain when you actually don't need anything else AbstractCleanupAutoTest really provides - other than perhaps the prepareBrowserSession implementation. So on digging deeper I think it would be good to:\n\nMove com.tle.webtests.test.AbstractCleanupTest#logon, com.tle.webtests.test.AbstractCleanupTest#AUTOTEST_LOGON and com.tle.webtests.test.AbstractCleanupTest#AUTOTEST_PASSWD to com.tle.webtests.test.AbstractSessionTest\nMake this test then simply extend com.tle.webtests.test.AbstractSessionTest\nAnd in this test add your implementation of prepareBrowserSession which simply calls the newly located com.tle.webtests.test.AbstractSessionTest#logon", "url": "https://github.com/openequella/openEQUELLA/pull/2286#discussion_r500657138", "createdAt": "2020-10-06T23:46:31Z", "author": {"login": "edalex-ian"}, "path": "autotest/OldTests/src/test/java/com/tle/webtests/test/searching/NewSearchPageTest.java", "diffHunk": "@@ -0,0 +1,71 @@\n+package com.tle.webtests.test.searching;\n+\n+import static org.testng.Assert.assertEquals;\n+\n+import com.tle.webtests.framework.TestInstitution;\n+import com.tle.webtests.pageobject.searching.NewSearchPage;\n+import com.tle.webtests.pageobject.viewitem.SummaryPage;\n+import com.tle.webtests.test.AbstractCleanupAutoTest;\n+import org.openqa.selenium.WebElement;\n+import org.testng.annotations.Test;\n+\n+@TestInstitution(\"facet\")\n+public class NewSearchPageTest extends AbstractCleanupAutoTest {\n+  private NewSearchPage searchPage;\n+\n+  @Test(description = \"open the new Search page and wait for initial search completed\")\n+  public void initialSearch() {\n+    searchPage = new NewSearchPage(context).load();\n+    // The initial search should return 10 items.\n+    searchPage.waitForSearchCompleted(16);\n+  }\n+\n+  @Test(dependsOnMethods = \"initialSearch\", description = \"Search with a query and refine controls\")\n+  public void searchByFilters() {\n+    searchPage.newSearch();\n+    // Search by Collections.\n+    searchPage.selectCollection(\"programming\");\n+    searchPage.waitForSearchCompleted(9);\n+    // Expand the Refine control panel.\n+    searchPage.expandRefineControlPanel();\n+    // Search by Item status.\n+    searchPage.selectStatus(true);\n+    searchPage.waitForSearchCompleted(10);\n+    // Search by a query.\n+    searchPage.changeQuery(\"Java\");\n+    searchPage.waitForSearchCompleted(4);\n+    // Exclude attachments in a search.\n+    searchPage.selectSearchAttachments(false);\n+    searchPage.waitForSearchCompleted(4);\n+    // Search by date ranges.\n+    searchPage.selectCustomDateRange(\"2020-10-01\", \"2020-10-06\");\n+    searchPage.waitForSearchCompleted(1);\n+    // Search by an owner.\n+    searchPage.selectOwner(\"AutoTest\");\n+    searchPage.waitForSearchCompleted(1);\n+  }\n+\n+  @Test(description = \"open an item's summary page\", dependsOnMethods = \"searchByFilters\")\n+  public void openItemSummaryPage() {\n+    final String ITEM_TITLE = \"Java (cloned)\";\n+    WebElement titleLink = searchPage.getItemTitleLink(ITEM_TITLE);\n+    titleLink.click();\n+    SummaryPage summary = new SummaryPage(context).get();\n+    assertEquals(summary.getItemTitle(), ITEM_TITLE);\n+  }\n+\n+  @Test(\n+      description = \"Go back to the Search page from another page\",\n+      dependsOnMethods = \"openItemSummaryPage\")\n+  public void backToSearchPage() {\n+    context.getDriver().navigate().back();\n+    WebElement searchBar = searchPage.getSearchBar();\n+    assertEquals(searchBar.getAttribute(\"value\"), \"Java\");\n+    searchPage.waitForSearchCompleted(1);\n+  }\n+\n+  @Override\n+  protected void cleanupAfterClass() throws Exception {\n+    // This test does not need to clean anything.\n+  }", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ad345cdab0d4bce5b441856afd04c6ff72f251ed"}, "originalPosition": 70}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMDY2MDg1OQ==", "bodyText": "Seeing this is all about testing the new stuff, should we perhaps move it (and the below Page class) over to the io.github.openequella package tree? Maybe they could be:\n\nio.github.openequella.search.NewSearchPageTest\nio.github.openequella.pages.search.NewSearchPage", "url": "https://github.com/openequella/openEQUELLA/pull/2286#discussion_r500660859", "createdAt": "2020-10-06T23:58:23Z", "author": {"login": "edalex-ian"}, "path": "autotest/OldTests/src/test/java/com/tle/webtests/test/searching/NewSearchPageTest.java", "diffHunk": "@@ -0,0 +1,71 @@\n+package com.tle.webtests.test.searching;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ad345cdab0d4bce5b441856afd04c6ff72f251ed"}, "originalPosition": 1}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMDY2MTAyMw==", "bodyText": "Hmmmm, so is this getting run as part of the 'Old UI' mode of tests?", "url": "https://github.com/openequella/openEQUELLA/pull/2286#discussion_r500661023", "createdAt": "2020-10-06T23:58:56Z", "author": {"login": "edalex-ian"}, "path": "autotest/OldTests/testng-codebuild.yaml", "diffHunk": "@@ -4,6 +4,7 @@ threadCount: 1\n tests:\n   - name: OneAfterAnother\n     classes:\n+      - com.tle.webtests.test.searching.NewSearchPageTest", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ad345cdab0d4bce5b441856afd04c6ff72f251ed"}, "originalPosition": 4}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMDY2Mjc0OQ==", "bodyText": "Is this unused?", "url": "https://github.com/openequella/openEQUELLA/pull/2286#discussion_r500662749", "createdAt": "2020-10-07T00:04:39Z", "author": {"login": "edalex-ian"}, "path": "autotest/Tests/src/main/java/com/tle/webtests/pageobject/searching/NewSearchPage.java", "diffHunk": "@@ -0,0 +1,193 @@\n+package com.tle.webtests.pageobject.searching;\n+\n+import com.tle.webtests.framework.PageContext;\n+import com.tle.webtests.pageobject.AbstractPage;\n+import org.openqa.selenium.By;\n+import org.openqa.selenium.Keys;\n+import org.openqa.selenium.WebElement;\n+import org.openqa.selenium.support.ui.ExpectedConditions;\n+\n+public class NewSearchPage extends AbstractPage<NewSearchPage> {\n+\n+  public NewSearchPage(PageContext context) {\n+    super(context);\n+  }\n+\n+  @Override\n+  protected void loadUrl() {\n+    driver.get(context.getBaseUrl() + \"page/search\");\n+  }\n+\n+  /** Find the Search query bar. */\n+  public WebElement getSearchBar() {\n+    return driver.findElement(By.id(\"searchBar\"));\n+  }\n+\n+  @Override\n+  protected WebElement findLoadedElement() {\n+    // When the Search bar is visible, the page is loaded.\n+    return getSearchBar();\n+  }\n+\n+  /**\n+   * Wait until the correct number of items are displayed.\n+   *\n+   * @param itemCount The expected number of items\n+   */\n+  public void waitForSearchCompleted(int itemCount) {\n+    waiter.until(\n+        ExpectedConditions.visibilityOfElementLocated(\n+            By.xpath(\"//span[text()='Search results (\" + itemCount + \")']\")));\n+  }\n+\n+  /** Perform a new search. */\n+  public void newSearch() {\n+    WebElement newSearchButton = driver.findElement(By.xpath(\"//button[span=('New search')]\"));\n+    newSearchButton.click();\n+  }\n+\n+  /**\n+   * Change the search query.\n+   *\n+   * @param query A text used as search query.\n+   */\n+  public void changeQuery(String query) {\n+    WebElement searchBar = getSearchBar();\n+    searchBar.sendKeys(query);\n+  }\n+\n+  /**\n+   * Get the link of an Item's title which links to the Item's summary page.\n+   *\n+   * @param title The text of an Item's title\n+   */\n+  public WebElement getItemTitleLink(String title) {\n+    return driver.findElement(By.linkText(title));\n+  }\n+\n+  public void expandRefineControlPanel() {\n+    WebElement showMore = driver.findElement(By.id(\"collapsibleRefinePanelButton\"));\n+    showMore.click();\n+  }\n+  /**\n+   * Select Collections by typing keywords in the Selector's TextField.\n+   *\n+   * @param collectionNames A list of Collection names\n+   */\n+  public void selectCollection(String... collectionNames) {\n+    WebElement collectionSelector = getRefineControl(\"CollectionSelector\");\n+    WebElement collectionSelectTextField = collectionSelector.findElement(By.xpath(\".//input\"));\n+    for (String name : collectionNames) {\n+      collectionSelectTextField.sendKeys(name);\n+      collectionSelectTextField.sendKeys(Keys.DOWN);\n+      collectionSelectTextField.sendKeys(Keys.ENTER);\n+    }\n+    // Press TAB to remove the focus so the Collection dropdown list will disappear.\n+    collectionSelectTextField.sendKeys(Keys.TAB);\n+  }\n+\n+  /**\n+   * Select one of the date range quick options.\n+   *\n+   * @param quickOption The text of a quick option\n+   */\n+  public void selectDateRangeQuickOption(String quickOption) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ad345cdab0d4bce5b441856afd04c6ff72f251ed"}, "originalPosition": 94}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTAzNTM3Njg1", "url": "https://github.com/openequella/openEQUELLA/pull/2286#pullrequestreview-503537685", "createdAt": "2020-10-07T05:37:40Z", "commit": {"oid": "ad345cdab0d4bce5b441856afd04c6ff72f251ed"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wN1QwNTozNzo0MVrOHdjPcQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wN1QwNTozNzo0MVrOHdjPcQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMDc0ODE0NQ==", "bodyText": "I wonder if instead we should use the @FindById and a class property. \ud83e\udd14", "url": "https://github.com/openequella/openEQUELLA/pull/2286#discussion_r500748145", "createdAt": "2020-10-07T05:37:41Z", "author": {"login": "edalex-ian"}, "path": "autotest/Tests/src/main/java/com/tle/webtests/pageobject/searching/NewSearchPage.java", "diffHunk": "@@ -0,0 +1,193 @@\n+package com.tle.webtests.pageobject.searching;\n+\n+import com.tle.webtests.framework.PageContext;\n+import com.tle.webtests.pageobject.AbstractPage;\n+import org.openqa.selenium.By;\n+import org.openqa.selenium.Keys;\n+import org.openqa.selenium.WebElement;\n+import org.openqa.selenium.support.ui.ExpectedConditions;\n+\n+public class NewSearchPage extends AbstractPage<NewSearchPage> {\n+\n+  public NewSearchPage(PageContext context) {\n+    super(context);\n+  }\n+\n+  @Override\n+  protected void loadUrl() {\n+    driver.get(context.getBaseUrl() + \"page/search\");\n+  }\n+\n+  /** Find the Search query bar. */\n+  public WebElement getSearchBar() {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ad345cdab0d4bce5b441856afd04c6ff72f251ed"}, "originalPosition": 22}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "dface0bf9888e3c480927efb15ec52d4f7f3d294", "author": {"user": {"login": "PenghaiZhang", "name": null}}, "url": "https://github.com/openequella/openEQUELLA/commit/dface0bf9888e3c480927efb15ec52d4f7f3d294", "committedDate": "2020-10-07T22:03:54Z", "message": "Update NewSearchPageTest comments."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "13f6ae0e0bf38dda7ed93c09106d15ca5d7a3797", "author": {"user": {"login": "PenghaiZhang", "name": null}}, "url": "https://github.com/openequella/openEQUELLA/commit/13f6ae0e0bf38dda7ed93c09106d15ca5d7a3797", "committedDate": "2020-10-07T22:08:22Z", "message": "Add a method in NewSearchPage to abstract out\nthe user action of selecting an item."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "fbe86ad0a42f835d3164c05703423fff25b4ea81", "author": {"user": {"login": "PenghaiZhang", "name": null}}, "url": "https://github.com/openequella/openEQUELLA/commit/fbe86ad0a42f835d3164c05703423fff25b4ea81", "committedDate": "2020-10-07T22:18:51Z", "message": "Clean up the autotest class tree.\n\n1. Move the method for logon as Autotest and two constants\nfrom AbstractCleanupTest to AbstractSessionTest.\n2. Make NewSearchPageTest extend AbstractSessionTest and\noverride method 'prepareBrowserSession' for logon."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "391c11905a4794b010f233e0a56876c365d4353f", "author": {"user": {"login": "PenghaiZhang", "name": null}}, "url": "https://github.com/openequella/openEQUELLA/commit/391c11905a4794b010f233e0a56876c365d4353f", "committedDate": "2020-10-07T22:39:22Z", "message": "Move NewSearchPage and NewSearchPageTest to package\n'io.github.openequella'."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "063efc130b7e9a8ad2e3592ddf8076345449375a", "author": {"user": {"login": "PenghaiZhang", "name": null}}, "url": "https://github.com/openequella/openEQUELLA/commit/063efc130b7e9a8ad2e3592ddf8076345449375a", "committedDate": "2020-10-07T22:46:54Z", "message": "Check whether selecting date range quick options works\nin NewSearchPageTest."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f323bfd1ae6fb702350e53e0e1783ced5b9a6beb", "author": {"user": {"login": "PenghaiZhang", "name": null}}, "url": "https://github.com/openequella/openEQUELLA/commit/f323bfd1ae6fb702350e53e0e1783ced5b9a6beb", "committedDate": "2020-10-07T23:37:51Z", "message": "Use the 'FindBy' annotation to locate some new search\npage Web elements."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d050d13da10d191f972a644f3491709f00210988", "author": {"user": {"login": "PenghaiZhang", "name": null}}, "url": "https://github.com/openequella/openEQUELLA/commit/d050d13da10d191f972a644f3491709f00210988", "committedDate": "2020-10-08T03:02:39Z", "message": "Update testing Institution Facet."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "92dbb54acba1937afde1c707a0d6bf070054271f", "author": {"user": {"login": "PenghaiZhang", "name": null}}, "url": "https://github.com/openequella/openEQUELLA/commit/92dbb54acba1937afde1c707a0d6bf070054271f", "committedDate": "2020-10-08T03:03:28Z", "message": "Add a test to check if new search page is accessible\nwithout any error for low privileged users."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTA0NDA2NDUw", "url": "https://github.com/openequella/openEQUELLA/pull/2286#pullrequestreview-504406450", "createdAt": "2020-10-08T03:36:23Z", "commit": {"oid": "92dbb54acba1937afde1c707a0d6bf070054271f"}, "state": "APPROVED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wOFQwMzozNjoyNFrOHeMzyQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wOFQwMzozNjoyNFrOHeMzyQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMTQyOTE5Mw==", "bodyText": "Does it need to depend on any prior test? Seeing it's logging in with a new session, it should be stand-alone really shouldn't it?", "url": "https://github.com/openequella/openEQUELLA/pull/2286#discussion_r501429193", "createdAt": "2020-10-08T03:36:24Z", "author": {"login": "edalex-ian"}, "path": "autotest/OldTests/src/test/java/io/github/openequella/search/NewSearchPageTest.java", "diffHunk": "@@ -60,12 +68,22 @@ public void openItemSummaryPage() {\n   public void backToSearchPage() {\n     context.getDriver().navigate().back();\n     WebElement searchBar = searchPage.getSearchBar();\n+    // Expect when going 'back' to the search page, the previous search\n+    // settings have been remembered.\n     assertEquals(searchBar.getAttribute(\"value\"), \"Java\");\n     searchPage.waitForSearchCompleted(1);\n   }\n \n-  @Override\n-  protected void cleanupAfterClass() throws Exception {\n-    // This test does not need to clean anything.\n+  @Test(description = \"Search with a low privileged user\", dependsOnMethods = \"backToSearchPage\")", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "92dbb54acba1937afde1c707a0d6bf070054271f"}, "originalPosition": 71}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "522486df25d3cb67e26900f9fb47431b83291b7b", "author": {"user": {"login": "PenghaiZhang", "name": null}}, "url": "https://github.com/openequella/openEQUELLA/commit/522486df25d3cb67e26900f9fb47431b83291b7b", "committedDate": "2020-10-08T04:28:53Z", "message": "Merge branch 'component/new-search-page' into feature/autotests-for-search-page"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c9d124b50161135ea72c69c187737ad2318dc47a", "author": {"user": {"login": "PenghaiZhang", "name": null}}, "url": "https://github.com/openequella/openEQUELLA/commit/c9d124b50161135ea72c69c187737ad2318dc47a", "committedDate": "2020-10-08T04:51:44Z", "message": "Update SearchFacets test because of three new facets\ngenerated from new testing items."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "21a7734190defa8b7297891b1c57a1597f9de125", "author": {"user": {"login": "PenghaiZhang", "name": null}}, "url": "https://github.com/openequella/openEQUELLA/commit/21a7734190defa8b7297891b1c57a1597f9de125", "committedDate": "2020-10-08T21:53:26Z", "message": "Update the classpath of NewSearchPageTest in CI yaml."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "98096c04139353d1e892e17503198c2b5c542579", "author": {"user": {"login": "PenghaiZhang", "name": null}}, "url": "https://github.com/openequella/openEQUELLA/commit/98096c04139353d1e892e17503198c2b5c542579", "committedDate": "2020-10-08T23:19:29Z", "message": "Try to use the administrator account to run REST Module\ntests: Search and SearchFacets."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "9f4dc7840cf45fcd281d31179261e7a8431108bb", "author": {"user": {"login": "PenghaiZhang", "name": null}}, "url": "https://github.com/openequella/openEQUELLA/commit/9f4dc7840cf45fcd281d31179261e7a8431108bb", "committedDate": "2020-10-09T01:20:23Z", "message": "Revert \"Try to use the administrator account to run REST Module\"\n\nThis reverts commit 98096c04139353d1e892e17503198c2b5c542579."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d4a7316e352193da896d9a79d956cc959f5931df", "author": {"user": {"login": "PenghaiZhang", "name": null}}, "url": "https://github.com/openequella/openEQUELLA/commit/d4a7316e352193da896d9a79d956cc959f5931df", "committedDate": "2020-10-09T01:21:03Z", "message": "Make sure date range quick option is clickable."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "9bf8e8cbcda36e7263f4470da0ce5bbc59470aef", "author": {"user": {"login": "PenghaiZhang", "name": null}}, "url": "https://github.com/openequella/openEQUELLA/commit/9bf8e8cbcda36e7263f4470da0ce5bbc59470aef", "committedDate": "2020-10-09T02:31:01Z", "message": "Create a new annotation used to specify whether a\ntest should be skipped in Old UI mode."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f6f61dc3f4aab15e0647eef4f7521a88e413cd59", "author": {"user": {"login": "PenghaiZhang", "name": null}}, "url": "https://github.com/openequella/openEQUELLA/commit/f6f61dc3f4aab15e0647eef4f7521a88e413cd59", "committedDate": "2020-10-09T02:44:58Z", "message": "Revert \"Create a new annotation used to specify whether a\"\n\nThis reverts commit 9bf8e8cbcda36e7263f4470da0ce5bbc59470aef."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "8fb70264b0f11a5620680faf426d63e75604cd12", "author": {"user": {"login": "PenghaiZhang", "name": null}}, "url": "https://github.com/openequella/openEQUELLA/commit/8fb70264b0f11a5620680faf426d63e75604cd12", "committedDate": "2020-10-09T02:46:56Z", "message": "Add a workaround to temporarily pass NewSearchPageTest\nin Old UI."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "bbf3c5bba2cf2527806f36d7372f306d6f702236", "author": {"user": {"login": "PenghaiZhang", "name": null}}, "url": "https://github.com/openequella/openEQUELLA/commit/bbf3c5bba2cf2527806f36d7372f306d6f702236", "committedDate": "2020-10-09T03:41:07Z", "message": "Add a wait for selecting date range quick option."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "4d17b48dfd0b2901dbeca68a45f3dfec54714a34", "author": {"user": {"login": "PenghaiZhang", "name": null}}, "url": "https://github.com/openequella/openEQUELLA/commit/4d17b48dfd0b2901dbeca68a45f3dfec54714a34", "committedDate": "2020-10-09T05:32:29Z", "message": "Add testing code to check why SearchFacets/Search tests\nfail on CI."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a0b4173743a4813da3164e342ccd81d4be5ef21b", "author": {"user": {"login": "PenghaiZhang", "name": null}}, "url": "https://github.com/openequella/openEQUELLA/commit/a0b4173743a4813da3164e342ccd81d4be5ef21b", "committedDate": "2020-10-09T06:33:50Z", "message": "A couple tweaks for NewSearchPageTest."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ceab6ffa644c8e4073cf4c226ebf71cfb5d71996", "author": {"user": {"login": "PenghaiZhang", "name": null}}, "url": "https://github.com/openequella/openEQUELLA/commit/ceab6ffa644c8e4073cf4c226ebf71cfb5d71996", "committedDate": "2020-10-09T09:03:59Z", "message": "Remove the action of selecting date range option\n'Today'."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "7ff0586bae4cdf0a7966283b01b0773588887cf0", "author": {"user": {"login": "PenghaiZhang", "name": null}}, "url": "https://github.com/openequella/openEQUELLA/commit/7ff0586bae4cdf0a7966283b01b0773588887cf0", "committedDate": "2020-10-10T01:29:26Z", "message": "Two tweaks to help NewSearchPageTest pass on CI."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "019814ede747a61789d1678e42b4112d98b02e68", "author": {"user": {"login": "PenghaiZhang", "name": null}}, "url": "https://github.com/openequella/openEQUELLA/commit/019814ede747a61789d1678e42b4112d98b02e68", "committedDate": "2020-10-10T08:25:52Z", "message": "Wait until Owner Select dialog is closed."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "51ebf38b42bce89630e7952ccaa473652712e1b5", "author": {"user": {"login": "PenghaiZhang", "name": null}}, "url": "https://github.com/openequella/openEQUELLA/commit/51ebf38b42bce89630e7952ccaa473652712e1b5", "committedDate": "2020-10-10T22:33:40Z", "message": "Wait until the whole MUI Owner select Dialog is closed."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "56a32348fe47c4dcc0603a6079ec2b8295edf394", "author": {"user": {"login": "PenghaiZhang", "name": null}}, "url": "https://github.com/openequella/openEQUELLA/commit/56a32348fe47c4dcc0603a6079ec2b8295edf394", "committedDate": "2020-10-10T22:45:04Z", "message": "Testing code to check what UI mode NewSearchPageTest\nis running against."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "cc97a410146632c770810d61d0647a5fe031b94a", "author": {"user": {"login": "PenghaiZhang", "name": null}}, "url": "https://github.com/openequella/openEQUELLA/commit/cc97a410146632c770810d61d0647a5fe031b94a", "committedDate": "2020-10-11T01:38:19Z", "message": "Revert the abstract method of opening ItemSummary\nPage to check why this page is incorrectly open."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b14c3b196afdecb938975a3ef514bdf10969fa0b", "author": {"user": {"login": "PenghaiZhang", "name": null}}, "url": "https://github.com/openequella/openEQUELLA/commit/b14c3b196afdecb938975a3ef514bdf10969fa0b", "committedDate": "2020-10-11T05:35:28Z", "message": "Revert \"Revert the abstract method of opening ItemSummary\"\n\nThis reverts commit cc97a410146632c770810d61d0647a5fe031b94a."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b90041c63802510a45f4b8bbf8adf9b44ed54825", "author": {"user": {"login": "PenghaiZhang", "name": null}}, "url": "https://github.com/openequella/openEQUELLA/commit/b90041c63802510a45f4b8bbf8adf9b44ed54825", "committedDate": "2020-10-11T05:37:41Z", "message": "Take screenshots to check if Summary page is on\nNew UI mode."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "3366c9e39fb44a264e0ac86ac2ba4f90c8b6ec95", "author": {"user": {"login": "PenghaiZhang", "name": null}}, "url": "https://github.com/openequella/openEQUELLA/commit/3366c9e39fb44a264e0ac86ac2ba4f90c8b6ec95", "committedDate": "2020-10-12T02:03:51Z", "message": "Let 'Facet' Institution run in Old UI by default."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "2985f8e681052b3eab85ca7b100d07f76a1675c6", "author": {"user": {"login": "PenghaiZhang", "name": null}}, "url": "https://github.com/openequella/openEQUELLA/commit/2985f8e681052b3eab85ca7b100d07f76a1675c6", "committedDate": "2020-10-12T02:33:09Z", "message": "Remove NewSearchPageTest testing code."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "9a4941b84fcec9490dcf7a395257a92d75321869", "author": {"user": {"login": "PenghaiZhang", "name": null}}, "url": "https://github.com/openequella/openEQUELLA/commit/9a4941b84fcec9490dcf7a395257a92d75321869", "committedDate": "2020-10-12T02:52:00Z", "message": "Remove AxiosInstance testing code."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "008ce6eb77a2ce9f80c6c3c610e05e8321064ae6", "author": {"user": {"login": "PenghaiZhang", "name": null}}, "url": "https://github.com/openequella/openEQUELLA/commit/008ce6eb77a2ce9f80c6c3c610e05e8321064ae6", "committedDate": "2020-10-12T02:53:17Z", "message": "Revert changes made on AxiosInstance.ts"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 461, "cost": 1, "resetAt": "2021-11-01T16:19:10Z"}}}