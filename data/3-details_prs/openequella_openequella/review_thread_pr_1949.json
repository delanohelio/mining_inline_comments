{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDM5ODA2MjU4", "number": 1949, "reviewThreads": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yNVQwODoxNjo1MVrOEIqNKQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yNVQyMzo1OTozOVrOEI9kog==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjc3NTE1NTYxOnYy", "diffSide": "RIGHT", "path": "Source/Plugins/Core/com.equella.core/resources/web/scripts/wizardctrl.js", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yNVQwODoxNjo1MVrOGowO-w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yNVQwODoxNjo1MVrOGowO-w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NTM4NjQ5MQ==", "bodyText": "This new function is the only real change I made. Prettier did others I think.", "url": "https://github.com/openequella/openEQUELLA/pull/1949#discussion_r445386491", "createdAt": "2020-06-25T08:16:51Z", "author": {"login": "PenghaiZhang"}, "path": "Source/Plugins/Core/com.equella.core/resources/web/scripts/wizardctrl.js", "diffHunk": "@@ -1,24 +1,62 @@\n+/*\n+ * Licensed to The Apereo Foundation under one or more contributor license\n+ * agreements. See the NOTICE file distributed with this work for additional\n+ * information regarding copyright ownership.\n+ *\n+ * The Apereo Foundation licenses this file to you under the Apache License,\n+ * Version 2.0, (the \"License\"); you may not use this file except in compliance\n+ * with the License. You may obtain a copy of the License at:\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n var WizardCtrl = {\n-\tsetMessage : function(ctrlid, message)\n-\t{\n-\t\tvar $ctrl = $(\"#\" + ctrlid);\n-\t\tvar $content = $ctrl.children(\"div:first-child\");\n-\t\tvar $msg = $content.children(\"p.ctrlinvalidmessage\");\n-\t\tif (!message)\n-\t\t{\n-\t\t\t$content.removeClass(\"ctrlinvalid\");\n-\t\t\t$msg.empty();\n-\t\t}\n-\t\telse\n-\t\t{\n-\t\t\t$content.addClass(\"ctrlinvalid\");\n-\t\t\t$msg.html(message);\n-\t\t}\n-\t},\n-\taffixDiv: function() {\n-\t    var ad = $(\"#affix-div\");\n-\t    ad.attr(\"data-spy\", \"affix\");\n-\t    var offset = (ad.offset().top) - 55;\n-\t    ad.attr(\"data-offset-top\",offset);\n-\t}\n-};\n\\ No newline at end of file\n+  setMessage: function (ctrlid, message) {\n+    var $ctrl = $(\"#\" + ctrlid);\n+    var $content = $ctrl.children(\"div:first-child\");\n+    var $msg = $content.children(\"p.ctrlinvalidmessage\");\n+    if (!message) {\n+      $content.removeClass(\"ctrlinvalid\");\n+      $msg.empty();\n+    } else {\n+      $content.addClass(\"ctrlinvalid\");\n+      $msg.html(message);\n+    }\n+  },\n+  affixDiv: function () {\n+    var ad = $(\"#affix-div\");\n+    ad.attr(\"data-spy\", \"affix\");\n+    var offset = ad.offset().top - 55;\n+    ad.attr(\"data-offset-top\", offset);\n+  },\n+  affixDivNewUI: function () {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "add491ccf7beb40a38b5bc2105d1c3b1473d2335"}, "originalPosition": 61}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjc3ODMwNzYzOnYy", "diffSide": "RIGHT", "path": "Source/Plugins/Core/com.equella.core/resources/web/scripts/wizardctrl.js", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yNVQyMzo0Nzo0MVrOGpPa4A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yNVQyMzo0Nzo0MVrOGpPa4A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NTg5NzQ0MA==", "bodyText": "I think we're safe to use const as that's even supported in IE11 (unlike let). So we should.", "url": "https://github.com/openequella/openEQUELLA/pull/1949#discussion_r445897440", "createdAt": "2020-06-25T23:47:41Z", "author": {"login": "edalex-ian"}, "path": "Source/Plugins/Core/com.equella.core/resources/web/scripts/wizardctrl.js", "diffHunk": "@@ -1,24 +1,62 @@\n+/*\n+ * Licensed to The Apereo Foundation under one or more contributor license\n+ * agreements. See the NOTICE file distributed with this work for additional\n+ * information regarding copyright ownership.\n+ *\n+ * The Apereo Foundation licenses this file to you under the Apache License,\n+ * Version 2.0, (the \"License\"); you may not use this file except in compliance\n+ * with the License. You may obtain a copy of the License at:\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n var WizardCtrl = {\n-\tsetMessage : function(ctrlid, message)\n-\t{\n-\t\tvar $ctrl = $(\"#\" + ctrlid);\n-\t\tvar $content = $ctrl.children(\"div:first-child\");\n-\t\tvar $msg = $content.children(\"p.ctrlinvalidmessage\");\n-\t\tif (!message)\n-\t\t{\n-\t\t\t$content.removeClass(\"ctrlinvalid\");\n-\t\t\t$msg.empty();\n-\t\t}\n-\t\telse\n-\t\t{\n-\t\t\t$content.addClass(\"ctrlinvalid\");\n-\t\t\t$msg.html(message);\n-\t\t}\n-\t},\n-\taffixDiv: function() {\n-\t    var ad = $(\"#affix-div\");\n-\t    ad.attr(\"data-spy\", \"affix\");\n-\t    var offset = (ad.offset().top) - 55;\n-\t    ad.attr(\"data-offset-top\",offset);\n-\t}\n-};\n\\ No newline at end of file\n+  setMessage: function (ctrlid, message) {\n+    var $ctrl = $(\"#\" + ctrlid);\n+    var $content = $ctrl.children(\"div:first-child\");\n+    var $msg = $content.children(\"p.ctrlinvalidmessage\");\n+    if (!message) {\n+      $content.removeClass(\"ctrlinvalid\");\n+      $msg.empty();\n+    } else {\n+      $content.addClass(\"ctrlinvalid\");\n+      $msg.html(message);\n+    }\n+  },\n+  affixDiv: function () {\n+    var ad = $(\"#affix-div\");\n+    ad.attr(\"data-spy\", \"affix\");\n+    var offset = ad.offset().top - 55;\n+    ad.attr(\"data-offset-top\", offset);\n+  },\n+  affixDivNewUI: function () {\n+    var moderate = $(\"#moderate\");", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "add491ccf7beb40a38b5bc2105d1c3b1473d2335"}, "originalPosition": 62}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjc3ODMxOTUzOnYy", "diffSide": "RIGHT", "path": "Source/Plugins/Core/com.equella.core/resources/web/scripts/wizardctrl.js", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yNVQyMzo1NDozMlrOGpPiNQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yNVQyMzo1NDozMlrOGpPiNQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NTg5OTMxNw==", "bodyText": "We need some improved variable names here. Maybe:\n\nmoderateTop -> moderationControlsHeight\nscrollTop -> currentWindowYPos", "url": "https://github.com/openequella/openEQUELLA/pull/1949#discussion_r445899317", "createdAt": "2020-06-25T23:54:32Z", "author": {"login": "edalex-ian"}, "path": "Source/Plugins/Core/com.equella.core/resources/web/scripts/wizardctrl.js", "diffHunk": "@@ -1,24 +1,62 @@\n+/*\n+ * Licensed to The Apereo Foundation under one or more contributor license\n+ * agreements. See the NOTICE file distributed with this work for additional\n+ * information regarding copyright ownership.\n+ *\n+ * The Apereo Foundation licenses this file to you under the Apache License,\n+ * Version 2.0, (the \"License\"); you may not use this file except in compliance\n+ * with the License. You may obtain a copy of the License at:\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n var WizardCtrl = {\n-\tsetMessage : function(ctrlid, message)\n-\t{\n-\t\tvar $ctrl = $(\"#\" + ctrlid);\n-\t\tvar $content = $ctrl.children(\"div:first-child\");\n-\t\tvar $msg = $content.children(\"p.ctrlinvalidmessage\");\n-\t\tif (!message)\n-\t\t{\n-\t\t\t$content.removeClass(\"ctrlinvalid\");\n-\t\t\t$msg.empty();\n-\t\t}\n-\t\telse\n-\t\t{\n-\t\t\t$content.addClass(\"ctrlinvalid\");\n-\t\t\t$msg.html(message);\n-\t\t}\n-\t},\n-\taffixDiv: function() {\n-\t    var ad = $(\"#affix-div\");\n-\t    ad.attr(\"data-spy\", \"affix\");\n-\t    var offset = (ad.offset().top) - 55;\n-\t    ad.attr(\"data-offset-top\",offset);\n-\t}\n-};\n\\ No newline at end of file\n+  setMessage: function (ctrlid, message) {\n+    var $ctrl = $(\"#\" + ctrlid);\n+    var $content = $ctrl.children(\"div:first-child\");\n+    var $msg = $content.children(\"p.ctrlinvalidmessage\");\n+    if (!message) {\n+      $content.removeClass(\"ctrlinvalid\");\n+      $msg.empty();\n+    } else {\n+      $content.addClass(\"ctrlinvalid\");\n+      $msg.html(message);\n+    }\n+  },\n+  affixDiv: function () {\n+    var ad = $(\"#affix-div\");\n+    ad.attr(\"data-spy\", \"affix\");\n+    var offset = ad.offset().top - 55;\n+    ad.attr(\"data-offset-top\", offset);\n+  },\n+  affixDivNewUI: function () {\n+    var moderate = $(\"#moderate\");\n+    var affixDiv = $(\"#affix-div\");\n+    if (moderate.length > 0) {\n+      $(window).on(\"scroll\", function () {\n+        // Use outerHeight to include margin.\n+        var moderateTop = moderate.outerHeight(true);\n+        var scrollTop = $(window).scrollTop();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "add491ccf7beb40a38b5bc2105d1c3b1473d2335"}, "originalPosition": 68}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjc3ODMyODY2OnYy", "diffSide": "RIGHT", "path": "Source/Plugins/Core/com.equella.core/resources/web/scripts/wizardctrl.js", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yNVQyMzo1OTozOVrOGpPn4g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yNlQwMDozNjoyNlrOGpQLmA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NTkwMDc3MA==", "bodyText": "jQuery works such that if you add the same class again then it has no effect. And removing a non-existing class has no effect. (hmmm, unless maybe performance).\nAlso, this should be a if/else - not just two ifs. And in that case, a ternary operator would be fine I'd say.\nWith all that in mind, is this then just:\ncurrentWindowYPos >= moderationControlsHeight ?\n  affixDiv.addClass(\"moderation-rightNav\") :\n  affixDiv.removeClass(\"moderation-rightNav\" )", "url": "https://github.com/openequella/openEQUELLA/pull/1949#discussion_r445900770", "createdAt": "2020-06-25T23:59:39Z", "author": {"login": "edalex-ian"}, "path": "Source/Plugins/Core/com.equella.core/resources/web/scripts/wizardctrl.js", "diffHunk": "@@ -1,24 +1,62 @@\n+/*\n+ * Licensed to The Apereo Foundation under one or more contributor license\n+ * agreements. See the NOTICE file distributed with this work for additional\n+ * information regarding copyright ownership.\n+ *\n+ * The Apereo Foundation licenses this file to you under the Apache License,\n+ * Version 2.0, (the \"License\"); you may not use this file except in compliance\n+ * with the License. You may obtain a copy of the License at:\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n var WizardCtrl = {\n-\tsetMessage : function(ctrlid, message)\n-\t{\n-\t\tvar $ctrl = $(\"#\" + ctrlid);\n-\t\tvar $content = $ctrl.children(\"div:first-child\");\n-\t\tvar $msg = $content.children(\"p.ctrlinvalidmessage\");\n-\t\tif (!message)\n-\t\t{\n-\t\t\t$content.removeClass(\"ctrlinvalid\");\n-\t\t\t$msg.empty();\n-\t\t}\n-\t\telse\n-\t\t{\n-\t\t\t$content.addClass(\"ctrlinvalid\");\n-\t\t\t$msg.html(message);\n-\t\t}\n-\t},\n-\taffixDiv: function() {\n-\t    var ad = $(\"#affix-div\");\n-\t    ad.attr(\"data-spy\", \"affix\");\n-\t    var offset = (ad.offset().top) - 55;\n-\t    ad.attr(\"data-offset-top\",offset);\n-\t}\n-};\n\\ No newline at end of file\n+  setMessage: function (ctrlid, message) {\n+    var $ctrl = $(\"#\" + ctrlid);\n+    var $content = $ctrl.children(\"div:first-child\");\n+    var $msg = $content.children(\"p.ctrlinvalidmessage\");\n+    if (!message) {\n+      $content.removeClass(\"ctrlinvalid\");\n+      $msg.empty();\n+    } else {\n+      $content.addClass(\"ctrlinvalid\");\n+      $msg.html(message);\n+    }\n+  },\n+  affixDiv: function () {\n+    var ad = $(\"#affix-div\");\n+    ad.attr(\"data-spy\", \"affix\");\n+    var offset = ad.offset().top - 55;\n+    ad.attr(\"data-offset-top\", offset);\n+  },\n+  affixDivNewUI: function () {\n+    var moderate = $(\"#moderate\");\n+    var affixDiv = $(\"#affix-div\");\n+    if (moderate.length > 0) {\n+      $(window).on(\"scroll\", function () {\n+        // Use outerHeight to include margin.\n+        var moderateTop = moderate.outerHeight(true);\n+        var scrollTop = $(window).scrollTop();\n+        if (\n+          scrollTop >= moderateTop &&\n+          !affixDiv.hasClass(\"moderation-rightNav\")\n+        ) {\n+          affixDiv.addClass(\"moderation-rightNav\");\n+        }\n+        if (\n+          scrollTop < moderateTop &&\n+          affixDiv.hasClass(\"moderation-rightNav\")\n+        ) {\n+          affixDiv.removeClass(\"moderation-rightNav\");\n+        }", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "add491ccf7beb40a38b5bc2105d1c3b1473d2335"}, "originalPosition": 80}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NTkwOTkxMg==", "bodyText": "Yeah performance was what I was thinking yesterday although it shouldn't cause huge performance issue.", "url": "https://github.com/openequella/openEQUELLA/pull/1949#discussion_r445909912", "createdAt": "2020-06-26T00:36:26Z", "author": {"login": "PenghaiZhang"}, "path": "Source/Plugins/Core/com.equella.core/resources/web/scripts/wizardctrl.js", "diffHunk": "@@ -1,24 +1,62 @@\n+/*\n+ * Licensed to The Apereo Foundation under one or more contributor license\n+ * agreements. See the NOTICE file distributed with this work for additional\n+ * information regarding copyright ownership.\n+ *\n+ * The Apereo Foundation licenses this file to you under the Apache License,\n+ * Version 2.0, (the \"License\"); you may not use this file except in compliance\n+ * with the License. You may obtain a copy of the License at:\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n var WizardCtrl = {\n-\tsetMessage : function(ctrlid, message)\n-\t{\n-\t\tvar $ctrl = $(\"#\" + ctrlid);\n-\t\tvar $content = $ctrl.children(\"div:first-child\");\n-\t\tvar $msg = $content.children(\"p.ctrlinvalidmessage\");\n-\t\tif (!message)\n-\t\t{\n-\t\t\t$content.removeClass(\"ctrlinvalid\");\n-\t\t\t$msg.empty();\n-\t\t}\n-\t\telse\n-\t\t{\n-\t\t\t$content.addClass(\"ctrlinvalid\");\n-\t\t\t$msg.html(message);\n-\t\t}\n-\t},\n-\taffixDiv: function() {\n-\t    var ad = $(\"#affix-div\");\n-\t    ad.attr(\"data-spy\", \"affix\");\n-\t    var offset = (ad.offset().top) - 55;\n-\t    ad.attr(\"data-offset-top\",offset);\n-\t}\n-};\n\\ No newline at end of file\n+  setMessage: function (ctrlid, message) {\n+    var $ctrl = $(\"#\" + ctrlid);\n+    var $content = $ctrl.children(\"div:first-child\");\n+    var $msg = $content.children(\"p.ctrlinvalidmessage\");\n+    if (!message) {\n+      $content.removeClass(\"ctrlinvalid\");\n+      $msg.empty();\n+    } else {\n+      $content.addClass(\"ctrlinvalid\");\n+      $msg.html(message);\n+    }\n+  },\n+  affixDiv: function () {\n+    var ad = $(\"#affix-div\");\n+    ad.attr(\"data-spy\", \"affix\");\n+    var offset = ad.offset().top - 55;\n+    ad.attr(\"data-offset-top\", offset);\n+  },\n+  affixDivNewUI: function () {\n+    var moderate = $(\"#moderate\");\n+    var affixDiv = $(\"#affix-div\");\n+    if (moderate.length > 0) {\n+      $(window).on(\"scroll\", function () {\n+        // Use outerHeight to include margin.\n+        var moderateTop = moderate.outerHeight(true);\n+        var scrollTop = $(window).scrollTop();\n+        if (\n+          scrollTop >= moderateTop &&\n+          !affixDiv.hasClass(\"moderation-rightNav\")\n+        ) {\n+          affixDiv.addClass(\"moderation-rightNav\");\n+        }\n+        if (\n+          scrollTop < moderateTop &&\n+          affixDiv.hasClass(\"moderation-rightNav\")\n+        ) {\n+          affixDiv.removeClass(\"moderation-rightNav\");\n+        }", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NTkwMDc3MA=="}, "originalCommit": {"oid": "add491ccf7beb40a38b5bc2105d1c3b1473d2335"}, "originalPosition": 80}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1338, "cost": 1, "resetAt": "2021-11-12T20:44:06Z"}}}