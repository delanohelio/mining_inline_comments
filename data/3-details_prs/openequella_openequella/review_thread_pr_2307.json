{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDkwMDMxNjc3", "number": 2307, "reviewThreads": {"totalCount": 7, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yMVQwNTowNzo1MFrOElgLFg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yM1QyMzoyMDozNVrOEm0Q_Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzA3NzU5ODk0OnYy", "diffSide": "RIGHT", "path": "Source/Plugins/Core/com.equella.core/js/tsrc/api/currentuser.ts", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yMVQwNTowNzo1MFrOHVA0dw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yMVQwNTowNzo1MFrOHVA0dw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MTc5NTU3NQ==", "bodyText": "Aaahhhh, this reminds me.\nWe need to drop out currentuser.ts and use the support in oeq-ts-rest-api. So, this PR seems as good as any.\nCould you please remove currentuser.ts and move the code to use getCurrentUserDetails (and supporting interfaces) @ https://github.com/openequella/openEQUELLA/blob/develop/oeq-ts-rest-api/src/LegacyContent.ts#L38", "url": "https://github.com/openequella/openEQUELLA/pull/2307#discussion_r491795575", "createdAt": "2020-09-21T05:07:50Z", "author": {"login": "edalex-ian"}, "path": "Source/Plugins/Core/com.equella.core/js/tsrc/api/currentuser.ts", "diffHunk": "@@ -31,6 +31,7 @@ export interface UserData {\n   guest: boolean;\n   autoLoggedIn: boolean;\n   prefsEditable: boolean;\n+  username: string;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b411d98b56d51712ec68b33d13f0571a79c313cd"}, "originalPosition": 4}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzA3NzYxMDgxOnYy", "diffSide": "RIGHT", "path": "Source/Plugins/Core/com.equella.core/js/tsrc/mainui/Template.tsx", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yMVQwNToxNjoxN1rOHVA66w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yMVQwNToxNjoxN1rOHVA66w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MTc5NzIyNw==", "bodyText": "Could be good to also have a fallback here - just so we never have an empty \"bubble\" of a tooltip. Maybe \"Username unknown\". \ud83e\udd14", "url": "https://github.com/openequella/openEQUELLA/pull/2307#discussion_r491797227", "createdAt": "2020-09-21T05:16:17Z", "author": {"login": "edalex-ian"}, "path": "Source/Plugins/Core/com.equella.core/js/tsrc/mainui/Template.tsx", "diffHunk": "@@ -512,7 +512,7 @@ export const Template = React.memo(function Template({\n                 topBarString.notifications\n               )}\n             </Hidden>\n-            <Tooltip title={strings.menu.title}>\n+            <Tooltip title={currentUser?.username}>", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b411d98b56d51712ec68b33d13f0571a79c313cd"}, "originalPosition": 5}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzA4NjAwMjk1OnYy", "diffSide": "RIGHT", "path": "Source/Plugins/Core/com.equella.core/js/tsrc/legacycontent/LegacyContent.tsx", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yMlQyMzo1NDo0OVrOHWQPpw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yMlQyMzo1NDo0OVrOHWQPpw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MzA5Njg3MQ==", "bodyText": "The convention for this library is to:\n\n  \n    \n  \n    \n\n  \n  This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters. Learn more about bidirectional Unicode characters\n\n\n  \n\n\n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            import type { CurrentUserDetails } from \"@openequella/rest-api-client/dist/LegacyContent\";\n          \n          \n            \n            import * as OEQ from \"@openequella\";\n          \n      \n    \n    \n  \n\nAnd then use accordingly.", "url": "https://github.com/openequella/openEQUELLA/pull/2307#discussion_r493096871", "createdAt": "2020-09-22T23:54:49Z", "author": {"login": "edalex-ian"}, "path": "Source/Plugins/Core/com.equella.core/js/tsrc/legacycontent/LegacyContent.tsx", "diffHunk": "@@ -20,6 +20,7 @@ import { ErrorResponse, fromAxiosResponse } from \"../api/errors\";\n import Axios from \"axios\";\n import { v4 } from \"uuid\";\n import { Config } from \"../config\";\n+import type { CurrentUserDetails } from \"@openequella/rest-api-client/dist/LegacyContent\";", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ee7b1aaa4170c150ac6564578e6cce774073f92f"}, "originalPosition": 4}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzA4NjAwNDUwOnYy", "diffSide": "RIGHT", "path": "Source/Plugins/Core/com.equella.core/js/tsrc/mainui/Template.tsx", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yMlQyMzo1NToyMVrOHWQQeg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yMlQyMzo1NToyMVrOHWQQeg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MzA5NzA4Mg==", "bodyText": "The convention for this library is to:\n\n  \n    \n  \n    \n\n  \n  This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters. Learn more about bidirectional Unicode characters\n\n\n  \n\n\n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            import type {\n          \n          \n            \n              CurrentUserDetails,\n          \n          \n            \n              MenuItem as MI,\n          \n          \n            \n            } from \"@openequella/rest-api-client/dist/LegacyContent\";\n          \n          \n            \n            import * as OEQ from \"@openequella\";\n          \n      \n    \n    \n  \n\nAnd then use accordingly.", "url": "https://github.com/openequella/openEQUELLA/pull/2307#discussion_r493097082", "createdAt": "2020-09-22T23:55:21Z", "author": {"login": "edalex-ian"}, "path": "Source/Plugins/Core/com.equella.core/js/tsrc/mainui/Template.tsx", "diffHunk": "@@ -46,11 +46,15 @@ import {\n import luxonUtils from \"@date-io/luxon\";\n import { makeStyles, Theme } from \"@material-ui/core/styles\";\n import { languageStrings } from \"../util/langstrings\";\n-import { guestUser, MenuItem as MI, UserData } from \"../api/currentuser\";\n import MessageInfo from \"../components/MessageInfo\";\n import { Link } from \"react-router-dom\";\n import { LocationDescriptor } from \"history\";\n import { routes } from \"./routes\";\n+import type {\n+  CurrentUserDetails,\n+  MenuItem as MI,\n+} from \"@openequella/rest-api-client/dist/LegacyContent\";", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ee7b1aaa4170c150ac6564578e6cce774073f92f"}, "originalPosition": 12}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzA4NjAwNTQ0OnYy", "diffSide": "RIGHT", "path": "Source/Plugins/Core/com.equella.core/js/tsrc/mainui/index.tsx", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yMlQyMzo1NTo1NFrOHWQRBg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yMlQyMzo1NTo1NFrOHWQRBg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MzA5NzIyMg==", "bodyText": "The convention for this library is to:\n\n  \n    \n  \n    \n\n  \n  This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters. Learn more about bidirectional Unicode characters\n\n\n  \n\n\n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            import type { CurrentUserDetails } from \"@openequella/rest-api-client/dist/LegacyContent\";\n          \n          \n            \n            import * as OEQ from \"@openequella\";\n          \n      \n    \n    \n  \n\nAnd then use accordingly.", "url": "https://github.com/openequella/openEQUELLA/pull/2307#discussion_r493097222", "createdAt": "2020-09-22T23:55:54Z", "author": {"login": "edalex-ian"}, "path": "Source/Plugins/Core/com.equella.core/js/tsrc/mainui/index.tsx", "diffHunk": "@@ -43,11 +43,12 @@ import {\n   PageContent,\n } from \"../legacycontent/LegacyContent\";\n import HtmlParser from \"react-html-parser\";\n-import { getCurrentUser, UserData } from \"../api/currentuser\";\n import { ErrorResponse } from \"../api/errors\";\n import ErrorPage from \"./ErrorPage\";\n import { LegacyForm } from \"../legacycontent/LegacyForm\";\n import SettingsPage from \"../settings/SettingsPage\";\n+import type { CurrentUserDetails } from \"@openequella/rest-api-client/dist/LegacyContent\";", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ee7b1aaa4170c150ac6564578e6cce774073f92f"}, "originalPosition": 9}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzA5MTM3NDIzOnYy", "diffSide": "RIGHT", "path": "Source/Plugins/Core/com.equella.core/js/tsrc/util/langstrings.ts", "isResolved": true, "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yM1QyMzoxOToyN1rOHXEStA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yNFQwMTo1OTo0NlrOHXHD6A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5Mzk0OTYyMA==", "bodyText": "As we have a language string change log now, do we need to put this new string into the log  when component is merged to develop?", "url": "https://github.com/openequella/openEQUELLA/pull/2307#discussion_r493949620", "createdAt": "2020-09-23T23:19:27Z", "author": {"login": "PenghaiZhang"}, "path": "Source/Plugins/Core/com.equella.core/js/tsrc/util/langstrings.ts", "diffHunk": "@@ -237,6 +237,7 @@ export const languageStrings = {\n       title: \"My Account\",\n       logout: \"Logout\",\n       prefs: \"My preferences\",\n+      usernameUnknown: \"Username unknown\",", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ee7b1aaa4170c150ac6564578e6cce774073f92f"}, "originalPosition": 4}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5Mzk4OTQ5Mw==", "bodyText": "You raise a good point there @PenghaiZhang\nI was only thinking though to do that with the ResourceCentre ones for now - i.e. the old properly released ones. It feels like all these (langstrings.ts) are essentially 'new' for 2020.2. But after that, then we'd want to document these too me thinks.\nWhat do you think?", "url": "https://github.com/openequella/openEQUELLA/pull/2307#discussion_r493989493", "createdAt": "2020-09-24T01:37:43Z", "author": {"login": "edalex-ian"}, "path": "Source/Plugins/Core/com.equella.core/js/tsrc/util/langstrings.ts", "diffHunk": "@@ -237,6 +237,7 @@ export const languageStrings = {\n       title: \"My Account\",\n       logout: \"Logout\",\n       prefs: \"My preferences\",\n+      usernameUnknown: \"Username unknown\",", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5Mzk0OTYyMA=="}, "originalCommit": {"oid": "ee7b1aaa4170c150ac6564578e6cce774073f92f"}, "originalPosition": 4}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5Mzk5NDk4NA==", "bodyText": "That's a good idea! I agree.", "url": "https://github.com/openequella/openEQUELLA/pull/2307#discussion_r493994984", "createdAt": "2020-09-24T01:59:46Z", "author": {"login": "PenghaiZhang"}, "path": "Source/Plugins/Core/com.equella.core/js/tsrc/util/langstrings.ts", "diffHunk": "@@ -237,6 +237,7 @@ export const languageStrings = {\n       title: \"My Account\",\n       logout: \"Logout\",\n       prefs: \"My preferences\",\n+      usernameUnknown: \"Username unknown\",", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5Mzk0OTYyMA=="}, "originalCommit": {"oid": "ee7b1aaa4170c150ac6564578e6cce774073f92f"}, "originalPosition": 4}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzA5MTM3NjYxOnYy", "diffSide": "RIGHT", "path": "Source/Plugins/Core/com.equella.core/js/tsrc/modules/UserDetailsModule.ts", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yM1QyMzoyMDozNVrOHXEUEw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yNVQwMDowMjozOFrOHXwiRg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5Mzk0OTk3MQ==", "bodyText": "Can simplify the callback to (result: OEQ.LegacyContent.CurrentUserDetails) => result to save 2 lines \ud83d\ude04", "url": "https://github.com/openequella/openEQUELLA/pull/2307#discussion_r493949971", "createdAt": "2020-09-23T23:20:35Z", "author": {"login": "PenghaiZhang"}, "path": "Source/Plugins/Core/com.equella.core/js/tsrc/modules/UserDetailsModule.ts", "diffHunk": "@@ -15,41 +15,15 @@\n  * See the License for the specific language governing permissions and\n  * limitations under the License.\n  */\n-import Axios from \"axios\";\n+import * as OEQ from \"@openequella/rest-api-client\";\n+import { API_BASE_URL } from \"../config\";\n \n-export interface MenuItem {\n-  route?: string;\n-  href?: string;\n-  title: string;\n-  systemIcon?: string;\n-  iconUrl?: string;\n-  newWindow: boolean;\n-}\n-\n-export interface UserData {\n-  id: string;\n-  guest: boolean;\n-  autoLoggedIn: boolean;\n-  prefsEditable: boolean;\n-  counts?: {\n-    tasks: number;\n-    notifications: number;\n-  };\n-  menuGroups: MenuItem[][];\n-}\n-\n-export const guestUser: UserData = {\n-  id: \"guest\",\n-  guest: true,\n-  autoLoggedIn: false,\n-  prefsEditable: false,\n-  counts: {\n-    tasks: 0,\n-    notifications: 0,\n-  },\n-  menuGroups: [],\n-};\n-\n-export function getCurrentUser(): Promise<UserData> {\n-  return Axios.get<UserData>(\"api/content/currentuser\").then((r) => r.data);\n-}\n+/**\n+ * Gets the current user's info from the server as OEQ.LegacyContent.CurrentUserDetails.\n+ */\n+export const getCurrentUserDetails = () =>\n+  OEQ.LegacyContent.getCurrentUserDetails(API_BASE_URL).then(\n+    (result: OEQ.LegacyContent.CurrentUserDetails) => {\n+      return result;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ee7b1aaa4170c150ac6564578e6cce774073f92f"}, "originalPosition": 50}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NDY3NDUwMg==", "bodyText": "Done!", "url": "https://github.com/openequella/openEQUELLA/pull/2307#discussion_r494674502", "createdAt": "2020-09-25T00:02:38Z", "author": {"login": "SammyIsConfused"}, "path": "Source/Plugins/Core/com.equella.core/js/tsrc/modules/UserDetailsModule.ts", "diffHunk": "@@ -15,41 +15,15 @@\n  * See the License for the specific language governing permissions and\n  * limitations under the License.\n  */\n-import Axios from \"axios\";\n+import * as OEQ from \"@openequella/rest-api-client\";\n+import { API_BASE_URL } from \"../config\";\n \n-export interface MenuItem {\n-  route?: string;\n-  href?: string;\n-  title: string;\n-  systemIcon?: string;\n-  iconUrl?: string;\n-  newWindow: boolean;\n-}\n-\n-export interface UserData {\n-  id: string;\n-  guest: boolean;\n-  autoLoggedIn: boolean;\n-  prefsEditable: boolean;\n-  counts?: {\n-    tasks: number;\n-    notifications: number;\n-  };\n-  menuGroups: MenuItem[][];\n-}\n-\n-export const guestUser: UserData = {\n-  id: \"guest\",\n-  guest: true,\n-  autoLoggedIn: false,\n-  prefsEditable: false,\n-  counts: {\n-    tasks: 0,\n-    notifications: 0,\n-  },\n-  menuGroups: [],\n-};\n-\n-export function getCurrentUser(): Promise<UserData> {\n-  return Axios.get<UserData>(\"api/content/currentuser\").then((r) => r.data);\n-}\n+/**\n+ * Gets the current user's info from the server as OEQ.LegacyContent.CurrentUserDetails.\n+ */\n+export const getCurrentUserDetails = () =>\n+  OEQ.LegacyContent.getCurrentUserDetails(API_BASE_URL).then(\n+    (result: OEQ.LegacyContent.CurrentUserDetails) => {\n+      return result;", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5Mzk0OTk3MQ=="}, "originalCommit": {"oid": "ee7b1aaa4170c150ac6564578e6cce774073f92f"}, "originalPosition": 50}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1809, "cost": 1, "resetAt": "2021-11-12T20:44:06Z"}}}