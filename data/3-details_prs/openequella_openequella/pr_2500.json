{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTE4MjA2MDAy", "number": 2500, "title": "Include Selection Session information in RenderData.", "bodyText": "#688\nChecklist\n\n the [contributor license agreement][] is signed\n commit message follows [commit guidelines][]\n tests are included\n screenshots are included showing significant UI changes\n documentation is changed or added\n\nDescription of change\nThis PR adds Selection Session data to renderData for the new search UI.  The data includes: the ID of a Selection Session, the ID of an Integration and the layout which is used.", "createdAt": "2020-11-10T04:45:27Z", "url": "https://github.com/openequella/openEQUELLA/pull/2500", "merged": true, "mergeCommit": {"oid": "162e7fd8387631510f7e06cca5675ec9b5a24eb8"}, "closed": true, "closedAt": "2020-11-11T22:06:27Z", "author": {"login": "PenghaiZhang"}, "timelineItems": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdbBIeQgH2gAyNTE4MjA2MDAyOjk1ODYyOWM5NWFkMzM1NDk1NDdiMzg3OWU3N2UxZDUyZjMyZjYyOWI=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdbVLT0gH2gAyNTE4MjA2MDAyOmYwOGExNDAzZTgyMGUyNGRkMWVlOTU5ZGRkYmZlNzM5NGI0Y2U0YTc=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "958629c95ad33549547b3879e77e1d52f32f629b", "author": {"user": {"login": "PenghaiZhang", "name": null}}, "url": "https://github.com/openequella/openEQUELLA/commit/958629c95ad33549547b3879e77e1d52f32f629b", "committedDate": "2020-11-10T03:52:21Z", "message": "Include Selection Session information in RenderData."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTI2ODUwNjA4", "url": "https://github.com/openequella/openEQUELLA/pull/2500#pullrequestreview-526850608", "createdAt": "2020-11-10T04:49:54Z", "commit": {"oid": "958629c95ad33549547b3879e77e1d52f32f629b"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xMFQwNDo0OTo1NFrOHwLo3A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xMFQwNDo0OTo1NFrOHwLo3A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMDI4NDM4MA==", "bodyText": "In selectOrAdd mode, the Integration ID is null, according to my research. So I make it optional.", "url": "https://github.com/openequella/openEQUELLA/pull/2500#discussion_r520284380", "createdAt": "2020-11-10T04:49:54Z", "author": {"login": "PenghaiZhang"}, "path": "Source/Plugins/Core/com.equella.core/js/tsrc/mainui/index.tsx", "diffHunk": "@@ -20,11 +20,18 @@ import * as ReactDOM from \"react-dom\";\n import { initStrings } from \"../util/langstrings\";\n import \"../util/polyfill\";\n \n+interface SelectionSessionInfo {\n+  stateId: string;\n+  integId?: string;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "958629c95ad33549547b3879e77e1d52f32f629b"}, "originalPosition": 6}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "199709d20235830ee7e21bf49cc0812a9a14f7ff", "author": {"user": {"login": "PenghaiZhang", "name": null}}, "url": "https://github.com/openequella/openEQUELLA/commit/199709d20235830ee7e21bf49cc0812a9a14f7ff", "committedDate": "2020-11-10T22:42:31Z", "message": "Only retrieve Integration ID when Integration Section is available."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTI3ODI0NzM3", "url": "https://github.com/openequella/openEQUELLA/pull/2500#pullrequestreview-527824737", "createdAt": "2020-11-11T02:51:14Z", "commit": {"oid": "199709d20235830ee7e21bf49cc0812a9a14f7ff"}, "state": "APPROVED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xMVQwMjo1MToxNFrOHw6fAA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xMVQwMjo1Njo0MlrOHw6zxw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMTA1MTkwNA==", "bodyText": "Would it be easy to add some TSDoc, or would that be a matter of digging further into the internals of Selection Sessions?", "url": "https://github.com/openequella/openEQUELLA/pull/2500#discussion_r521051904", "createdAt": "2020-11-11T02:51:14Z", "author": {"login": "edalex-ian"}, "path": "Source/Plugins/Core/com.equella.core/js/tsrc/mainui/index.tsx", "diffHunk": "@@ -20,11 +20,18 @@ import * as ReactDOM from \"react-dom\";\n import { initStrings } from \"../util/langstrings\";\n import \"../util/polyfill\";\n \n+interface SelectionSessionInfo {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "199709d20235830ee7e21bf49cc0812a9a14f7ff"}, "originalPosition": 4}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMTA1NzIyMw==", "bodyText": "I prefer this to the normal use of ObjectExpression vargs. Makes me wonder if we can do anything more declarative, but good for now. \ud83d\udc4d\n(No action required.)", "url": "https://github.com/openequella/openEQUELLA/pull/2500#discussion_r521057223", "createdAt": "2020-11-11T02:56:42Z", "author": {"login": "edalex-ian"}, "path": "Source/Plugins/Core/com.equella.core/scalasrc/com/tle/web/template/RenderNewTemplate.scala", "diffHunk": "@@ -141,6 +144,31 @@ object RenderNewTemplate {\n         }\n       })\n \n+  private def getSelectionSessionInfo(context: RenderEventContext): Option[ObjectExpression] = {\n+    val currentSession = LegacyGuice.selectionService.get().getCurrentSession(context)\n+    Option(currentSession).map(session => {\n+      val layout = session.getLayout match {\n+        case Layout.COURSE => \"coursesearch\"\n+        case Layout.NORMAL => \"search\"\n+        case Layout.SKINNY => \"skinnysearch\"\n+      }\n+\n+      val rootSelectionSection: RootSelectionSection =\n+        context.lookupSection(classOf[RootSelectionSection])\n+      val stateId = rootSelectionSection.getSessionId(context)\n+\n+      val integrationSection: IntegrationSection =\n+        context.lookupSection(classOf[IntegrationSection])\n+      val integId = Option(integrationSection).map(_.getStateId(context)).orNull\n+\n+      val selectionSessionInfo = new ObjectExpression\n+      selectionSessionInfo.put(\"stateId\", stateId)\n+      selectionSessionInfo.put(\"integId\", integId)\n+      selectionSessionInfo.put(\"layout\", layout)", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "199709d20235830ee7e21bf49cc0812a9a14f7ff"}, "originalPosition": 34}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f08a1403e820e24dd1ee959dddbfe7394b4ce4a7", "author": {"user": {"login": "PenghaiZhang", "name": null}}, "url": "https://github.com/openequella/openEQUELLA/commit/f08a1403e820e24dd1ee959dddbfe7394b4ce4a7", "committedDate": "2020-11-11T03:13:33Z", "message": "Add TSDoc for type 'SelectionSessionInfo'."}}]}}}, "rateLimit": {"limit": 5000, "remaining": 334, "cost": 1, "resetAt": "2021-11-01T16:19:10Z"}}}