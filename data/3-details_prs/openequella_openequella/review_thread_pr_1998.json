{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDQzODU2MDk3", "number": 1998, "reviewThreads": {"totalCount": 6, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wM1QwNToxNzoyM1rOELIDrQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wNlQwNjo0NDo1NlrOELjw2w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjgwMTAxODA1OnYy", "diffSide": "RIGHT", "path": "Source/Plugins/Core/com.equella.core/js/tsrc/search/SearchPage.tsx", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wM1QwNToxNzoyM1rOGsj9lA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wNVQyMzozOToyN1rOGtFpOQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0OTM3OTczMg==", "bodyText": "Do we want a separate component for this control like the Search query bar?", "url": "https://github.com/openequella/openEQUELLA/pull/1998#discussion_r449379732", "createdAt": "2020-07-03T05:17:23Z", "author": {"login": "PenghaiZhang"}, "path": "Source/Plugins/Core/com.equella.core/js/tsrc/search/SearchPage.tsx", "diffHunk": "@@ -135,6 +135,26 @@ const SearchPage = ({ updateTemplate }: TemplateUpdateProps) => {\n \n       <Grid item xs={9}>\n         <Card>\n+          <CardHeader\n+            title={searchStrings.subtitle}\n+            action={\n+              <Select", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c0126f0a636e3034530a9b0ad56f09a34aa3c8fe"}, "originalPosition": 50}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0OTkzMTU3Nw==", "bodyText": "I think at least pulling it out to a component within this function would be worthwhile for now. That way we have this key component at least stand-alone and here we can have <CardHeader ... action={<SearchOrderSelect />}/>} which is more readable.", "url": "https://github.com/openequella/openEQUELLA/pull/1998#discussion_r449931577", "createdAt": "2020-07-05T23:39:27Z", "author": {"login": "edalex-ian"}, "path": "Source/Plugins/Core/com.equella.core/js/tsrc/search/SearchPage.tsx", "diffHunk": "@@ -135,6 +135,26 @@ const SearchPage = ({ updateTemplate }: TemplateUpdateProps) => {\n \n       <Grid item xs={9}>\n         <Card>\n+          <CardHeader\n+            title={searchStrings.subtitle}\n+            action={\n+              <Select", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0OTM3OTczMg=="}, "originalCommit": {"oid": "c0126f0a636e3034530a9b0ad56f09a34aa3c8fe"}, "originalPosition": 50}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjgwMTAyNDQ5OnYy", "diffSide": "RIGHT", "path": "Source/Plugins/Core/com.equella.core/js/tsrc/search/SearchPage.tsx", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wM1QwNToyMDo1MlrOGskBCA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wNVQyMzozNDoxOVrOGtFnEA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0OTM4MDYxNg==", "bodyText": "I noted that the style of CardHeader's title seems to be consistent with SettingsListHeading.", "url": "https://github.com/openequella/openEQUELLA/pull/1998#discussion_r449380616", "createdAt": "2020-07-03T05:20:52Z", "author": {"login": "PenghaiZhang"}, "path": "Source/Plugins/Core/com.equella.core/js/tsrc/search/SearchPage.tsx", "diffHunk": "@@ -135,6 +135,26 @@ const SearchPage = ({ updateTemplate }: TemplateUpdateProps) => {\n \n       <Grid item xs={9}>\n         <Card>\n+          <CardHeader\n+            title={searchStrings.subtitle}", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c0126f0a636e3034530a9b0ad56f09a34aa3c8fe"}, "originalPosition": 48}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0OTkzMTAyNA==", "bodyText": "Nice work. Not sure how I missed that. May need to go back and refactor my refactors once they're done. ;)", "url": "https://github.com/openequella/openEQUELLA/pull/1998#discussion_r449931024", "createdAt": "2020-07-05T23:34:19Z", "author": {"login": "edalex-ian"}, "path": "Source/Plugins/Core/com.equella.core/js/tsrc/search/SearchPage.tsx", "diffHunk": "@@ -135,6 +135,26 @@ const SearchPage = ({ updateTemplate }: TemplateUpdateProps) => {\n \n       <Grid item xs={9}>\n         <Card>\n+          <CardHeader\n+            title={searchStrings.subtitle}", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0OTM4MDYxNg=="}, "originalCommit": {"oid": "c0126f0a636e3034530a9b0ad56f09a34aa3c8fe"}, "originalPosition": 48}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjgwNTAwNDUxOnYy", "diffSide": "RIGHT", "path": "Source/Plugins/Core/com.equella.core/js/tsrc/search/SearchModule.ts", "isResolved": true, "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wNVQyMzo1MjoxMFrOGtFuJQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wNlQwNDowMToxOFrOGtIIwA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0OTkzMjgzNw==", "bodyText": "This really should be a return type of Map<SortOrder, string>, and maybe then a name to better reflect it's purpose like: getSortingOptionStrings(). Then, it'd also possibly worthwhile to memoize it - as it is completely static for each run (no need to build the data structure again).", "url": "https://github.com/openequella/openEQUELLA/pull/1998#discussion_r449932837", "createdAt": "2020-07-05T23:52:10Z", "author": {"login": "edalex-ian"}, "path": "Source/Plugins/Core/com.equella.core/js/tsrc/search/SearchModule.ts", "diffHunk": "@@ -40,33 +72,22 @@ export const searchItems = (\n   return OEQ.Search.search(API_BASE_URL, searchParams);\n };\n \n-export const defaultPagedSearchResult: OEQ.Common.PagedResult<OEQ.Search.SearchResultItem> = {\n-  start: 0,\n-  length: 10,\n-  available: 10,\n-  results: [],\n-};\n-\n /**\n- * Type of all search options on Search page\n+ * Provide the search sorting control's data source.\n  */\n-export interface SearchOptions {\n-  /**\n-   * The number of items displayed in one page.\n-   */\n-  rowsPerPage: number;\n-  /**\n-   * Selected page.\n-   */\n-  currentPage: number;\n-  /**\n-   * Selected search result sorting order.\n-   */\n-  sortOrder: SortOrder | undefined;\n-}\n-\n-export const defaultSearchOptions: SearchOptions = {\n-  rowsPerPage: 10,\n-  currentPage: 0,\n-  sortOrder: undefined,\n+export const getSortingOptions = (): Record<string, SortOrder> => {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c0126f0a636e3034530a9b0ad56f09a34aa3c8fe"}, "originalPosition": 73}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0OTk1NTAzNQ==", "bodyText": "I am curious that if the cost of using useMemo is more expensive than rebuilding that simple map. This map only needs to be built when the component is mounted.  So I feel it might be more worthwhile to memorize this sorting component to avoid unnecessary re-render.", "url": "https://github.com/openequella/openEQUELLA/pull/1998#discussion_r449955035", "createdAt": "2020-07-06T02:27:13Z", "author": {"login": "PenghaiZhang"}, "path": "Source/Plugins/Core/com.equella.core/js/tsrc/search/SearchModule.ts", "diffHunk": "@@ -40,33 +72,22 @@ export const searchItems = (\n   return OEQ.Search.search(API_BASE_URL, searchParams);\n };\n \n-export const defaultPagedSearchResult: OEQ.Common.PagedResult<OEQ.Search.SearchResultItem> = {\n-  start: 0,\n-  length: 10,\n-  available: 10,\n-  results: [],\n-};\n-\n /**\n- * Type of all search options on Search page\n+ * Provide the search sorting control's data source.\n  */\n-export interface SearchOptions {\n-  /**\n-   * The number of items displayed in one page.\n-   */\n-  rowsPerPage: number;\n-  /**\n-   * Selected page.\n-   */\n-  currentPage: number;\n-  /**\n-   * Selected search result sorting order.\n-   */\n-  sortOrder: SortOrder | undefined;\n-}\n-\n-export const defaultSearchOptions: SearchOptions = {\n-  rowsPerPage: 10,\n-  currentPage: 0,\n-  sortOrder: undefined,\n+export const getSortingOptions = (): Record<string, SortOrder> => {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0OTkzMjgzNw=="}, "originalCommit": {"oid": "c0126f0a636e3034530a9b0ad56f09a34aa3c8fe"}, "originalPosition": 73}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0OTk3MjQxNg==", "bodyText": "Not sure I'm seeing the cost you mention, so I'd be interested to discuss that. But really, that is a bit of a premature optimisations, and so requires no action right now. ;)", "url": "https://github.com/openequella/openEQUELLA/pull/1998#discussion_r449972416", "createdAt": "2020-07-06T04:01:18Z", "author": {"login": "edalex-ian"}, "path": "Source/Plugins/Core/com.equella.core/js/tsrc/search/SearchModule.ts", "diffHunk": "@@ -40,33 +72,22 @@ export const searchItems = (\n   return OEQ.Search.search(API_BASE_URL, searchParams);\n };\n \n-export const defaultPagedSearchResult: OEQ.Common.PagedResult<OEQ.Search.SearchResultItem> = {\n-  start: 0,\n-  length: 10,\n-  available: 10,\n-  results: [],\n-};\n-\n /**\n- * Type of all search options on Search page\n+ * Provide the search sorting control's data source.\n  */\n-export interface SearchOptions {\n-  /**\n-   * The number of items displayed in one page.\n-   */\n-  rowsPerPage: number;\n-  /**\n-   * Selected page.\n-   */\n-  currentPage: number;\n-  /**\n-   * Selected search result sorting order.\n-   */\n-  sortOrder: SortOrder | undefined;\n-}\n-\n-export const defaultSearchOptions: SearchOptions = {\n-  rowsPerPage: 10,\n-  currentPage: 0,\n-  sortOrder: undefined,\n+export const getSortingOptions = (): Record<string, SortOrder> => {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0OTkzMjgzNw=="}, "originalCommit": {"oid": "c0126f0a636e3034530a9b0ad56f09a34aa3c8fe"}, "originalPosition": 73}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjgwNTA3MTMwOnYy", "diffSide": "RIGHT", "path": "Source/Plugins/Core/com.equella.core/js/tsrc/search/SearchModule.ts", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wNlQwMTowOTowNVrOGtGRPA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wNlQwNjowNDozM1rOGtJ0rg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0OTk0MTgyMA==", "bodyText": "Is it worth having a test for this function?", "url": "https://github.com/openequella/openEQUELLA/pull/1998#discussion_r449941820", "createdAt": "2020-07-06T01:09:05Z", "author": {"login": "SammyIsConfused"}, "path": "Source/Plugins/Core/com.equella.core/js/tsrc/search/SearchModule.ts", "diffHunk": "@@ -40,33 +72,22 @@ export const searchItems = (\n   return OEQ.Search.search(API_BASE_URL, searchParams);\n };\n \n-export const defaultPagedSearchResult: OEQ.Common.PagedResult<OEQ.Search.SearchResultItem> = {\n-  start: 0,\n-  length: 10,\n-  available: 10,\n-  results: [],\n-};\n-\n /**\n- * Type of all search options on Search page\n+ * Provide the search sorting control's data source.\n  */\n-export interface SearchOptions {\n-  /**\n-   * The number of items displayed in one page.\n-   */\n-  rowsPerPage: number;\n-  /**\n-   * Selected page.\n-   */\n-  currentPage: number;\n-  /**\n-   * Selected search result sorting order.\n-   */\n-  sortOrder: SortOrder | undefined;\n-}\n-\n-export const defaultSearchOptions: SearchOptions = {\n-  rowsPerPage: 10,\n-  currentPage: 0,\n-  sortOrder: undefined,\n+export const getSortingOptions = (): Record<string, SortOrder> => {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c0126f0a636e3034530a9b0ad56f09a34aa3c8fe"}, "originalPosition": 73}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MDAwMDA0Ng==", "bodyText": "I have refactored this to a simple map so we probably do not need a test.", "url": "https://github.com/openequella/openEQUELLA/pull/1998#discussion_r450000046", "createdAt": "2020-07-06T06:04:33Z", "author": {"login": "PenghaiZhang"}, "path": "Source/Plugins/Core/com.equella.core/js/tsrc/search/SearchModule.ts", "diffHunk": "@@ -40,33 +72,22 @@ export const searchItems = (\n   return OEQ.Search.search(API_BASE_URL, searchParams);\n };\n \n-export const defaultPagedSearchResult: OEQ.Common.PagedResult<OEQ.Search.SearchResultItem> = {\n-  start: 0,\n-  length: 10,\n-  available: 10,\n-  results: [],\n-};\n-\n /**\n- * Type of all search options on Search page\n+ * Provide the search sorting control's data source.\n  */\n-export interface SearchOptions {\n-  /**\n-   * The number of items displayed in one page.\n-   */\n-  rowsPerPage: number;\n-  /**\n-   * Selected page.\n-   */\n-  currentPage: number;\n-  /**\n-   * Selected search result sorting order.\n-   */\n-  sortOrder: SortOrder | undefined;\n-}\n-\n-export const defaultSearchOptions: SearchOptions = {\n-  rowsPerPage: 10,\n-  currentPage: 0,\n-  sortOrder: undefined,\n+export const getSortingOptions = (): Record<string, SortOrder> => {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0OTk0MTgyMA=="}, "originalCommit": {"oid": "c0126f0a636e3034530a9b0ad56f09a34aa3c8fe"}, "originalPosition": 73}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjgwNTA3NDAxOnYy", "diffSide": "RIGHT", "path": "Source/Plugins/Core/com.equella.core/js/tsrc/search/SearchModule.ts", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wNlQwMToxMToyNlrOGtGSlw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wNlQwNjowNjoxNVrOGtJ2hQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0OTk0MjE2Nw==", "bodyText": "Not sure I quite understand this return - so depending on language strings the shape of the return data will change? If someone changed these values in a language pack would the data remain the same or map to the new strings? And would that break anything if so?", "url": "https://github.com/openequella/openEQUELLA/pull/1998#discussion_r449942167", "createdAt": "2020-07-06T01:11:26Z", "author": {"login": "SammyIsConfused"}, "path": "Source/Plugins/Core/com.equella.core/js/tsrc/search/SearchModule.ts", "diffHunk": "@@ -40,33 +72,22 @@ export const searchItems = (\n   return OEQ.Search.search(API_BASE_URL, searchParams);\n };\n \n-export const defaultPagedSearchResult: OEQ.Common.PagedResult<OEQ.Search.SearchResultItem> = {\n-  start: 0,\n-  length: 10,\n-  available: 10,\n-  results: [],\n-};\n-\n /**\n- * Type of all search options on Search page\n+ * Provide the search sorting control's data source.\n  */\n-export interface SearchOptions {\n-  /**\n-   * The number of items displayed in one page.\n-   */\n-  rowsPerPage: number;\n-  /**\n-   * Selected page.\n-   */\n-  currentPage: number;\n-  /**\n-   * Selected search result sorting order.\n-   */\n-  sortOrder: SortOrder | undefined;\n-}\n-\n-export const defaultSearchOptions: SearchOptions = {\n-  rowsPerPage: 10,\n-  currentPage: 0,\n-  sortOrder: undefined,\n+export const getSortingOptions = (): Record<string, SortOrder> => {\n+  const {\n+    relevance,\n+    lastModified,\n+    dateCreated,\n+    title,\n+    userRating,\n+  } = languageStrings.settings.searching.searchPageSettings;\n+  return {\n+    [relevance]: SortOrder.RANK,", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c0126f0a636e3034530a9b0ad56f09a34aa3c8fe"}, "originalPosition": 82}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MDAwMDUxNw==", "bodyText": "I think it would be fine as long as the values provided by eunm SortOrder keep consistent because which option is selected is determined by the value rather than the text. But anyway, this function has been removed.", "url": "https://github.com/openequella/openEQUELLA/pull/1998#discussion_r450000517", "createdAt": "2020-07-06T06:06:15Z", "author": {"login": "PenghaiZhang"}, "path": "Source/Plugins/Core/com.equella.core/js/tsrc/search/SearchModule.ts", "diffHunk": "@@ -40,33 +72,22 @@ export const searchItems = (\n   return OEQ.Search.search(API_BASE_URL, searchParams);\n };\n \n-export const defaultPagedSearchResult: OEQ.Common.PagedResult<OEQ.Search.SearchResultItem> = {\n-  start: 0,\n-  length: 10,\n-  available: 10,\n-  results: [],\n-};\n-\n /**\n- * Type of all search options on Search page\n+ * Provide the search sorting control's data source.\n  */\n-export interface SearchOptions {\n-  /**\n-   * The number of items displayed in one page.\n-   */\n-  rowsPerPage: number;\n-  /**\n-   * Selected page.\n-   */\n-  currentPage: number;\n-  /**\n-   * Selected search result sorting order.\n-   */\n-  sortOrder: SortOrder | undefined;\n-}\n-\n-export const defaultSearchOptions: SearchOptions = {\n-  rowsPerPage: 10,\n-  currentPage: 0,\n-  sortOrder: undefined,\n+export const getSortingOptions = (): Record<string, SortOrder> => {\n+  const {\n+    relevance,\n+    lastModified,\n+    dateCreated,\n+    title,\n+    userRating,\n+  } = languageStrings.settings.searching.searchPageSettings;\n+  return {\n+    [relevance]: SortOrder.RANK,", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0OTk0MjE2Nw=="}, "originalCommit": {"oid": "c0126f0a636e3034530a9b0ad56f09a34aa3c8fe"}, "originalPosition": 82}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjgwNTU1NzM5OnYy", "diffSide": "RIGHT", "path": "Source/Plugins/Core/com.equella.core/js/tsrc/search/SearchPage.tsx", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wNlQwNjo0NDo1NlrOGtKq0w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wNlQwNjo0NDo1NlrOGtKq0w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MDAxMzkwNw==", "bodyText": "This gave me pause, until I saw it's to maintain referential consistency when passed into your memoised SearchOrderSelect. \ud83d\udc4d", "url": "https://github.com/openequella/openEQUELLA/pull/1998#discussion_r450013907", "createdAt": "2020-07-06T06:44:56Z", "author": {"login": "edalex-ian"}, "path": "Source/Plugins/Core/com.equella.core/js/tsrc/search/SearchPage.tsx", "diffHunk": "@@ -120,6 +115,16 @@ const SearchPage = ({ updateTemplate }: TemplateUpdateProps) => {\n    */\n   const searchResultList = <List>{searchResults}</List>;\n \n+  /**\n+   * Provide a memorized callback for updating sort order in order to avoid re-rendering\n+   * component SearchOrderSelect when other search control values are changed.\n+   */\n+  const handleSortOrderChanged = useCallback(\n+    (order: SortOrder) =>\n+      setSearchOptions({ ...searchOptions, sortOrder: order }),\n+    []", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "12c48d321df286f686a6365da89150e4de2b121d"}, "originalPosition": 55}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1246, "cost": 1, "resetAt": "2021-11-12T20:44:06Z"}}}