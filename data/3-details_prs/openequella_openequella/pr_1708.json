{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDE0Mzk4NzQ0", "number": 1708, "title": "Contribution wizard lost metadata fix", "bodyText": "To ensure metadata attributed to hidden pages is not wiped by the\nmandatory field check.\n\nChecklist\n\n\n the contributor license agreement is signed\n commit message follows commit guidelines\n\nDescription of change\n#1678\nThe lost metadata was caused by the mandatory fields check - it would initialize all pages of a wizard. Since wizards can have visibility scripting, this caused issues with hidden pages initializing when they shouldn't, which wipes their metadata.\nSurrounding this initialisation with a check against isViewable() solves the issue whilst retaining mandatory field checking.", "createdAt": "2020-05-07T00:28:45Z", "url": "https://github.com/openequella/openEQUELLA/pull/1708", "merged": true, "mergeCommit": {"oid": "5fb336d8ca98a7c28a0901951b1b81e1d5f07ea5"}, "closed": true, "closedAt": "2020-05-07T06:56:21Z", "author": {"login": "SammyIsConfused"}, "timelineItems": {"totalCount": 6, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABceyDnogH2gAyNDE0Mzk4NzQ0OmIzZDNjNmQ1ZTE1ZWIzOTk2MjEzZjMxM2M1ZGNmZDczMDlmNzhiYWM=", "endCursor": "Y3Vyc29yOnYyOpPPAAABce1PM7gFqTQwNzEzNTUxOA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "b3d3c6d5e15eb3996213f313c5dcfd7309f78bac", "author": {"user": null}, "url": "https://github.com/openequella/openEQUELLA/commit/b3d3c6d5e15eb3996213f313c5dcfd7309f78bac", "committedDate": "2020-05-07T00:23:01Z", "message": "Surround initilise page function with viewable check\n\nTo ensure metadata attributed to hidden pages is not wiped by the\nmandatory field check."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDA3MDkzNDkz", "url": "https://github.com/openequella/openEQUELLA/pull/1708#pullrequestreview-407093493", "createdAt": "2020-05-07T01:30:31Z", "commit": {"oid": "b3d3c6d5e15eb3996213f313c5dcfd7309f78bac"}, "state": "APPROVED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wN1QwMTozMDozMVrOGRrNLA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wN1QwMTozMDozMVrOGRrNLA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMTE4Njg2MA==", "bodyText": "So as to stay within the functional paradigm a bit, how's about:\n\n  \n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                    .forEach(\n          \n          \n            \n                        p -> {\n          \n          \n            \n                          if (p.isViewable()) {\n          \n          \n            \n                            wizardService.ensureInitialisedPage(info, p, ps.getReloadFunction(), true);\n          \n          \n            \n                          }\n          \n          \n            \n                        });\n          \n          \n            \n                    .stream().filter(WebWizardPage::isViewable)\n          \n          \n            \n                    .forEach(p -> wizardService.ensureInitialisedPage(info, p, ps.getReloadFunction(), true));\n          \n      \n    \n    \n  \n\nI think this also has a slight readability benefit.", "url": "https://github.com/openequella/openEQUELLA/pull/1708#discussion_r421186860", "createdAt": "2020-05-07T01:30:31Z", "author": {"login": "edalex-ian"}, "path": "Source/Plugins/Core/com.equella.core/src/com/tle/web/wizard/section/RootWizardSection.java", "diffHunk": "@@ -305,6 +305,11 @@ void validateMandatoryFields(SectionInfo info, WizardState state) {\n     PagesSection ps = info.lookupSection(PagesSection.class);\n     wizardService\n         .getWizardPages(state)\n-        .forEach(p -> wizardService.ensureInitialisedPage(info, p, ps.getReloadFunction(), true));\n+        .forEach(\n+            p -> {\n+              if (p.isViewable()) {\n+                wizardService.ensureInitialisedPage(info, p, ps.getReloadFunction(), true);\n+              }\n+            });", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b3d3c6d5e15eb3996213f313c5dcfd7309f78bac"}, "originalPosition": 10}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "0785e0c7f1d13c0df7ac983eb74d9f55275aa2c6", "author": {"user": null}, "url": "https://github.com/openequella/openEQUELLA/commit/0785e0c7f1d13c0df7ac983eb74d9f55275aa2c6", "committedDate": "2020-05-07T01:35:28Z", "message": "Make viewable check a filter rather than an if statement\n\nCo-authored-by: edalex-ian <43919233+edalex-ian@users.noreply.github.com>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDA3MDk1Mzg5", "url": "https://github.com/openequella/openEQUELLA/pull/1708#pullrequestreview-407095389", "createdAt": "2020-05-07T01:36:44Z", "commit": {"oid": "0785e0c7f1d13c0df7ac983eb74d9f55275aa2c6"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f786b71e48fb4d7d28ee5efa6ab65c9cd1c225d8", "author": {"user": null}, "url": "https://github.com/openequella/openEQUELLA/commit/f786b71e48fb4d7d28ee5efa6ab65c9cd1c225d8", "committedDate": "2020-05-07T01:36:58Z", "message": "Add import statement for WebWizardPage"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDA3MTM1NTE4", "url": "https://github.com/openequella/openEQUELLA/pull/1708#pullrequestreview-407135518", "createdAt": "2020-05-07T04:05:23Z", "commit": {"oid": "f786b71e48fb4d7d28ee5efa6ab65c9cd1c225d8"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 99, "cost": 1, "resetAt": "2021-11-01T16:19:10Z"}}}