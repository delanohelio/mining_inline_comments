{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTAzNzk3NzQ2", "number": 2410, "title": "View Item comment count from new search page", "bodyText": "#1306\nChecklist\n\n the [contributor license agreement][] is signed\n commit message follows [commit guidelines][]\n tests are included\n screenshots are included showing significant UI changes\n documentation is changed or added\n\nDescription of change\nShow the number of Comments as a link. Clicking the link will open Item Summary page with #comments-list anchor.\nThe link is hidden if users don't have permission to view comment or the number is 0.", "createdAt": "2020-10-15T04:45:47Z", "url": "https://github.com/openequella/openEQUELLA/pull/2410", "merged": true, "mergeCommit": {"oid": "7e2dd6893efbe46fdfa228692491a188aa65bc0f"}, "closed": true, "closedAt": "2020-10-19T00:06:40Z", "author": {"login": "PenghaiZhang"}, "timelineItems": {"totalCount": 10, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdSUb8rAH2gAyNTAzNzk3NzQ2OjNjNTJiYzY1YTI0N2E5MzVlZDU4MWFmN2FmYmQ3NmJhMjQzNDRiMDU=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdT4qMZAFqTUxMTMxNzYxMA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "3c52bc65a247a935ed581af7afbd76ba24344b05", "author": {"user": {"login": "PenghaiZhang", "name": null}}, "url": "https://github.com/openequella/openEQUELLA/commit/3c52bc65a247a935ed581af7afbd76ba24344b05", "committedDate": "2020-10-14T03:16:30Z", "message": "Display Item comment count on new search page.\n\nShow number of Comments as link. If link selected,take\nuser to Summary page with ''#comments-list' anchor.\nHide link if permissions not granted."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c6e3888a421693715f34887c60cc2fadb3ba51cd", "author": {"user": {"login": "PenghaiZhang", "name": null}}, "url": "https://github.com/openequella/openEQUELLA/commit/c6e3888a421693715f34887c60cc2fadb3ba51cd", "committedDate": "2020-10-14T03:44:09Z", "message": "Two tweaks for component SearchResult\n\n1. Use language strings to properly display comment count.\n2. Slightly refactor 'itemMetadata'."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "82c172822c4d7db4fced26b51852a151f2fd13ea", "author": {"user": {"login": "PenghaiZhang", "name": null}}, "url": "https://github.com/openequella/openEQUELLA/commit/82c172822c4d7db4fced26b51852a151f2fd13ea", "committedDate": "2020-10-14T05:37:04Z", "message": "Merge branch 'component/new-search-page' into feature/view-comment-from-search-page"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "88a92780c620c0e7f383154d3ad6662b2c91c96e", "author": {"user": {"login": "PenghaiZhang", "name": null}}, "url": "https://github.com/openequella/openEQUELLA/commit/88a92780c620c0e7f383154d3ad6662b2c91c96e", "committedDate": "2020-10-15T03:22:46Z", "message": "Merge branch 'develop' into feature/view-comment-from-search-page"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f846f6de6c3144a3491f1211620c9cb5bd81287a", "author": {"user": {"login": "PenghaiZhang", "name": null}}, "url": "https://github.com/openequella/openEQUELLA/commit/f846f6de6c3144a3491f1211620c9cb5bd81287a", "committedDate": "2020-10-15T03:51:13Z", "message": "Don't show comment count in new search page if it's 0."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTA5MDM4MzQw", "url": "https://github.com/openequella/openEQUELLA/pull/2410#pullrequestreview-509038340", "createdAt": "2020-10-15T06:29:50Z", "commit": {"oid": "f846f6de6c3144a3491f1211620c9cb5bd81287a"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "8528b4ccd8549a6aa104715802a6daa46550f1ea", "author": {"user": {"login": "PenghaiZhang", "name": null}}, "url": "https://github.com/openequella/openEQUELLA/commit/8528b4ccd8549a6aa104715802a6daa46550f1ea", "committedDate": "2020-10-15T22:07:17Z", "message": "Created Jest tests for showing Item comment count."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTA5ODcxNTk3", "url": "https://github.com/openequella/openEQUELLA/pull/2410#pullrequestreview-509871597", "createdAt": "2020-10-15T23:15:47Z", "commit": {"oid": "8528b4ccd8549a6aa104715802a6daa46550f1ea"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xNVQyMzoxNTo0N1rOHiermA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xNVQyMzoxODoxMlrOHieuoA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNTkxNjMxMg==", "bodyText": "Should use the languageString for 'No comments'.", "url": "https://github.com/openequella/openEQUELLA/pull/2410#discussion_r505916312", "createdAt": "2020-10-15T23:15:47Z", "author": {"login": "edalex-ian"}, "path": "Source/Plugins/Core/com.equella.core/js/__tests__/tsrc/search/components/SearchResult.test.tsx", "diffHunk": "@@ -52,4 +53,30 @@ describe(\"<SearchResult/>\", () => {\n       queryByLabelText(container, keywordFoundInAttachmentLabel)\n     ).not.toBeInTheDocument();\n   });\n+\n+  it.each([\n+    [\"singular comment\", mockData.basicSearchObj],\n+    [\"plural comments\", mockData.attachSearchObj],\n+  ])(\n+    \"should show comment count as a link for %s\",\n+    (testName: string, item: OEQ.Search.SearchResultItem) => {\n+      const { container } = renderSearchResult(item);\n+      const countLink = getByText(\n+        container,\n+        formatSize(item.commentCount ?? 0, languageStrings.searchpage.comments),\n+        { selector: \"a\" }\n+      );\n+\n+      expect(countLink).toBeInTheDocument();\n+    }\n+  );\n+\n+  it(\"should hide comment count link if count is 0\", () => {\n+    const { container } = renderSearchResult(\n+      mockData.keywordFoundInAttachmentObj\n+    );\n+    expect(\n+      queryByLabelText(container, `No comments`, { selector: \"a\" })", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "8528b4ccd8549a6aa104715802a6daa46550f1ea"}, "originalPosition": 44}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNTkxNjU1MA==", "bodyText": "This line will never fail, because if getByText fails it'll throw an exception. In this context I normally go with queryByText for an item to be checked.", "url": "https://github.com/openequella/openEQUELLA/pull/2410#discussion_r505916550", "createdAt": "2020-10-15T23:16:33Z", "author": {"login": "edalex-ian"}, "path": "Source/Plugins/Core/com.equella.core/js/__tests__/tsrc/search/components/SearchResult.test.tsx", "diffHunk": "@@ -52,4 +53,30 @@ describe(\"<SearchResult/>\", () => {\n       queryByLabelText(container, keywordFoundInAttachmentLabel)\n     ).not.toBeInTheDocument();\n   });\n+\n+  it.each([\n+    [\"singular comment\", mockData.basicSearchObj],\n+    [\"plural comments\", mockData.attachSearchObj],\n+  ])(\n+    \"should show comment count as a link for %s\",\n+    (testName: string, item: OEQ.Search.SearchResultItem) => {\n+      const { container } = renderSearchResult(item);\n+      const countLink = getByText(\n+        container,\n+        formatSize(item.commentCount ?? 0, languageStrings.searchpage.comments),\n+        { selector: \"a\" }\n+      );\n+\n+      expect(countLink).toBeInTheDocument();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "8528b4ccd8549a6aa104715802a6daa46550f1ea"}, "originalPosition": 35}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNTkxNjc0Nw==", "bodyText": "Better to just go straight to destructing what you want:\n\n  \n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                  const { container } = renderSearchResult(item);\n          \n          \n            \n                  const { getByText } = renderSearchResult(item);", "url": "https://github.com/openequella/openEQUELLA/pull/2410#discussion_r505916747", "createdAt": "2020-10-15T23:17:09Z", "author": {"login": "edalex-ian"}, "path": "Source/Plugins/Core/com.equella.core/js/__tests__/tsrc/search/components/SearchResult.test.tsx", "diffHunk": "@@ -52,4 +53,30 @@ describe(\"<SearchResult/>\", () => {\n       queryByLabelText(container, keywordFoundInAttachmentLabel)\n     ).not.toBeInTheDocument();\n   });\n+\n+  it.each([\n+    [\"singular comment\", mockData.basicSearchObj],\n+    [\"plural comments\", mockData.attachSearchObj],\n+  ])(\n+    \"should show comment count as a link for %s\",\n+    (testName: string, item: OEQ.Search.SearchResultItem) => {\n+      const { container } = renderSearchResult(item);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "8528b4ccd8549a6aa104715802a6daa46550f1ea"}, "originalPosition": 28}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNTkxNzA4OA==", "bodyText": "This is kind of just copying the same code from the code under test. Almost like testing 1 === 1 directly. Really a test should do it a different way to the code under test.", "url": "https://github.com/openequella/openEQUELLA/pull/2410#discussion_r505917088", "createdAt": "2020-10-15T23:18:12Z", "author": {"login": "edalex-ian"}, "path": "Source/Plugins/Core/com.equella.core/js/__tests__/tsrc/search/components/SearchResult.test.tsx", "diffHunk": "@@ -52,4 +53,30 @@ describe(\"<SearchResult/>\", () => {\n       queryByLabelText(container, keywordFoundInAttachmentLabel)\n     ).not.toBeInTheDocument();\n   });\n+\n+  it.each([\n+    [\"singular comment\", mockData.basicSearchObj],\n+    [\"plural comments\", mockData.attachSearchObj],\n+  ])(\n+    \"should show comment count as a link for %s\",\n+    (testName: string, item: OEQ.Search.SearchResultItem) => {\n+      const { container } = renderSearchResult(item);\n+      const countLink = getByText(\n+        container,\n+        formatSize(item.commentCount ?? 0, languageStrings.searchpage.comments),", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "8528b4ccd8549a6aa104715802a6daa46550f1ea"}, "originalPosition": 31}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a363e9d3eb458db9ac3445513db874628041a993", "author": {"user": {"login": "PenghaiZhang", "name": null}}, "url": "https://github.com/openequella/openEQUELLA/commit/a363e9d3eb458db9ac3445513db874628041a993", "committedDate": "2020-10-16T02:36:51Z", "message": "Tweaks for SearchResult test."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTExMzE3NjEw", "url": "https://github.com/openequella/openEQUELLA/pull/2410#pullrequestreview-511317610", "createdAt": "2020-10-19T00:02:34Z", "commit": {"oid": "a363e9d3eb458db9ac3445513db874628041a993"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 399, "cost": 1, "resetAt": "2021-11-01T16:19:10Z"}}}