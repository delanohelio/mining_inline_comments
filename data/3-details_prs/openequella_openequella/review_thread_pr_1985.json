{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDQyNDk2NTY0", "number": 1985, "reviewThreads": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wMVQwODowNzowNlrOEKaGpw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wMlQwMzoxNzoyNVrOEKuuxQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjc5MzQ4OTAzOnYy", "diffSide": "RIGHT", "path": "Source/Plugins/Core/com.equella.core/js/tsrc/search/SearchPage.tsx", "isResolved": true, "comments": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wMVQwODowNzowNlrOGrbWlw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wMlQwNzoyNzo0OVrOGsArag==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0ODE5MDEwMw==", "bodyText": "The idea is that we don't need to do a search for initial state values.\nSo we can use this hook to create an object that persists until the component is unmounted.  And then use this object to help skip calling below useEffect for initial state values.\nThis way is recommended by react according to my research, but I am happy to discuss better approaches.", "url": "https://github.com/openequella/openEQUELLA/pull/1985#discussion_r448190103", "createdAt": "2020-07-01T08:07:06Z", "author": {"login": "PenghaiZhang"}, "path": "Source/Plugins/Core/com.equella.core/js/tsrc/search/SearchPage.tsx", "diffHunk": "@@ -16,55 +16,88 @@\n  * limitations under the License.\n  */\n import * as React from \"react\";\n-import { useEffect, useState } from \"react\";\n+import { useEffect, useRef, useState } from \"react\";\n import {\n   templateDefaults,\n   templateError,\n   TemplateUpdateProps,\n } from \"../mainui/Template\";\n import { languageStrings } from \"../util/langstrings\";\n import {\n+  Card,\n+  CardActions,\n+  CardContent,\n+  Grid,\n   IconButton,\n   List,\n-  ListItem,\n   ListSubheader,\n+  TablePagination,\n   TextField,\n-  Grid,\n-  Card,\n-  CardContent,\n } from \"@material-ui/core\";\n import SearchIcon from \"@material-ui/icons/Search\";\n-import { searchItems } from \"./SearchModule\";\n+import { defaultPagedSearchResult, searchItems } from \"./SearchModule\";\n import * as OEQ from \"@openequella/rest-api-client\";\n import SearchResult from \"./components/SearchResult\";\n import { generateFromError } from \"../api/errors\";\n import {\n   getSearchSettingsFromServer,\n   SearchSettings,\n+  SortOrder,\n } from \"../settings/Search/SearchSettingsModule\";\n+import { makeStyles } from \"@material-ui/core/styles\";\n+\n+const useStyles = makeStyles({\n+  cardAction: {\n+    display: \"flex\",\n+    justifyContent: \"center\",\n+  },\n+});\n \n const SearchPage = ({ updateTemplate }: TemplateUpdateProps) => {\n+  const classes = useStyles();\n   const searchStrings = languageStrings.searchpage;\n-  const [searchResultItems, setSearchResultItems] = useState<\n-    OEQ.Search.SearchResultItem[]\n-  >([]);\n+\n+  const [rowsPerPage, setRowsPerPage] = useState<number>(10);\n+  const [currentPage, setCurrentPage] = useState<number>(0);\n+  const [sortOrder, setSortOrder] = useState<SortOrder>(SortOrder.RANK);\n+  const [pagedSearchResult, setPagedSearchResult] = useState<\n+    OEQ.Common.PagedResult<OEQ.Search.SearchResultItem>\n+  >(defaultPagedSearchResult);\n \n   /**\n-   * Update the page title and do a default search.\n+   * Construct a standard search criteria.\n+   */\n+  const standardParams: OEQ.Search.SearchParams = {\n+    start: currentPage * rowsPerPage,\n+    length: rowsPerPage,\n+    status: [OEQ.Common.ItemStatus.LIVE, OEQ.Common.ItemStatus.REVIEW],\n+    order: sortOrder,\n+  };\n+  /**\n+   * Update the page title and retrieve Search settings.\n    */\n   useEffect(() => {\n     updateTemplate((tp) => ({\n       ...templateDefaults(searchStrings.title)(tp),\n     }));\n \n-    getSearchSettingsFromServer().then((settings: SearchSettings) =>\n-      search({\n-        status: [OEQ.Common.ItemStatus.LIVE, OEQ.Common.ItemStatus.REVIEW],\n-        order: settings.defaultSearchSort,\n-      })\n-    );\n+    getSearchSettingsFromServer().then((settings: SearchSettings) => {\n+      setSortOrder(settings.defaultSearchSort);\n+    });\n   }, []);\n \n+  /**\n+   * Trigger a search when state values change, but skip the initial values.\n+   */\n+  const isInitialSearch = useRef(true);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ff578348c4b687959d7171d978be7dd7f26f6f41"}, "originalPosition": 93}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0ODcyMTk0Nw==", "bodyText": "And so are you saying that initially, we wont see any search results until at least the above effect to getSearchSettingsFromServer completes and calls setSortOrder?", "url": "https://github.com/openequella/openEQUELLA/pull/1985#discussion_r448721947", "createdAt": "2020-07-02T03:02:14Z", "author": {"login": "edalex-ian"}, "path": "Source/Plugins/Core/com.equella.core/js/tsrc/search/SearchPage.tsx", "diffHunk": "@@ -16,55 +16,88 @@\n  * limitations under the License.\n  */\n import * as React from \"react\";\n-import { useEffect, useState } from \"react\";\n+import { useEffect, useRef, useState } from \"react\";\n import {\n   templateDefaults,\n   templateError,\n   TemplateUpdateProps,\n } from \"../mainui/Template\";\n import { languageStrings } from \"../util/langstrings\";\n import {\n+  Card,\n+  CardActions,\n+  CardContent,\n+  Grid,\n   IconButton,\n   List,\n-  ListItem,\n   ListSubheader,\n+  TablePagination,\n   TextField,\n-  Grid,\n-  Card,\n-  CardContent,\n } from \"@material-ui/core\";\n import SearchIcon from \"@material-ui/icons/Search\";\n-import { searchItems } from \"./SearchModule\";\n+import { defaultPagedSearchResult, searchItems } from \"./SearchModule\";\n import * as OEQ from \"@openequella/rest-api-client\";\n import SearchResult from \"./components/SearchResult\";\n import { generateFromError } from \"../api/errors\";\n import {\n   getSearchSettingsFromServer,\n   SearchSettings,\n+  SortOrder,\n } from \"../settings/Search/SearchSettingsModule\";\n+import { makeStyles } from \"@material-ui/core/styles\";\n+\n+const useStyles = makeStyles({\n+  cardAction: {\n+    display: \"flex\",\n+    justifyContent: \"center\",\n+  },\n+});\n \n const SearchPage = ({ updateTemplate }: TemplateUpdateProps) => {\n+  const classes = useStyles();\n   const searchStrings = languageStrings.searchpage;\n-  const [searchResultItems, setSearchResultItems] = useState<\n-    OEQ.Search.SearchResultItem[]\n-  >([]);\n+\n+  const [rowsPerPage, setRowsPerPage] = useState<number>(10);\n+  const [currentPage, setCurrentPage] = useState<number>(0);\n+  const [sortOrder, setSortOrder] = useState<SortOrder>(SortOrder.RANK);\n+  const [pagedSearchResult, setPagedSearchResult] = useState<\n+    OEQ.Common.PagedResult<OEQ.Search.SearchResultItem>\n+  >(defaultPagedSearchResult);\n \n   /**\n-   * Update the page title and do a default search.\n+   * Construct a standard search criteria.\n+   */\n+  const standardParams: OEQ.Search.SearchParams = {\n+    start: currentPage * rowsPerPage,\n+    length: rowsPerPage,\n+    status: [OEQ.Common.ItemStatus.LIVE, OEQ.Common.ItemStatus.REVIEW],\n+    order: sortOrder,\n+  };\n+  /**\n+   * Update the page title and retrieve Search settings.\n    */\n   useEffect(() => {\n     updateTemplate((tp) => ({\n       ...templateDefaults(searchStrings.title)(tp),\n     }));\n \n-    getSearchSettingsFromServer().then((settings: SearchSettings) =>\n-      search({\n-        status: [OEQ.Common.ItemStatus.LIVE, OEQ.Common.ItemStatus.REVIEW],\n-        order: settings.defaultSearchSort,\n-      })\n-    );\n+    getSearchSettingsFromServer().then((settings: SearchSettings) => {\n+      setSortOrder(settings.defaultSearchSort);\n+    });\n   }, []);\n \n+  /**\n+   * Trigger a search when state values change, but skip the initial values.\n+   */\n+  const isInitialSearch = useRef(true);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0ODE5MDEwMw=="}, "originalCommit": {"oid": "ff578348c4b687959d7171d978be7dd7f26f6f41"}, "originalPosition": 93}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0ODczNDU0NA==", "bodyText": "Is the goal of this similar to https://ahooks.js.org/hooks/life-cycle/use-update-effect ?", "url": "https://github.com/openequella/openEQUELLA/pull/1985#discussion_r448734544", "createdAt": "2020-07-02T03:57:56Z", "author": {"login": "ChristianMurphy"}, "path": "Source/Plugins/Core/com.equella.core/js/tsrc/search/SearchPage.tsx", "diffHunk": "@@ -16,55 +16,88 @@\n  * limitations under the License.\n  */\n import * as React from \"react\";\n-import { useEffect, useState } from \"react\";\n+import { useEffect, useRef, useState } from \"react\";\n import {\n   templateDefaults,\n   templateError,\n   TemplateUpdateProps,\n } from \"../mainui/Template\";\n import { languageStrings } from \"../util/langstrings\";\n import {\n+  Card,\n+  CardActions,\n+  CardContent,\n+  Grid,\n   IconButton,\n   List,\n-  ListItem,\n   ListSubheader,\n+  TablePagination,\n   TextField,\n-  Grid,\n-  Card,\n-  CardContent,\n } from \"@material-ui/core\";\n import SearchIcon from \"@material-ui/icons/Search\";\n-import { searchItems } from \"./SearchModule\";\n+import { defaultPagedSearchResult, searchItems } from \"./SearchModule\";\n import * as OEQ from \"@openequella/rest-api-client\";\n import SearchResult from \"./components/SearchResult\";\n import { generateFromError } from \"../api/errors\";\n import {\n   getSearchSettingsFromServer,\n   SearchSettings,\n+  SortOrder,\n } from \"../settings/Search/SearchSettingsModule\";\n+import { makeStyles } from \"@material-ui/core/styles\";\n+\n+const useStyles = makeStyles({\n+  cardAction: {\n+    display: \"flex\",\n+    justifyContent: \"center\",\n+  },\n+});\n \n const SearchPage = ({ updateTemplate }: TemplateUpdateProps) => {\n+  const classes = useStyles();\n   const searchStrings = languageStrings.searchpage;\n-  const [searchResultItems, setSearchResultItems] = useState<\n-    OEQ.Search.SearchResultItem[]\n-  >([]);\n+\n+  const [rowsPerPage, setRowsPerPage] = useState<number>(10);\n+  const [currentPage, setCurrentPage] = useState<number>(0);\n+  const [sortOrder, setSortOrder] = useState<SortOrder>(SortOrder.RANK);\n+  const [pagedSearchResult, setPagedSearchResult] = useState<\n+    OEQ.Common.PagedResult<OEQ.Search.SearchResultItem>\n+  >(defaultPagedSearchResult);\n \n   /**\n-   * Update the page title and do a default search.\n+   * Construct a standard search criteria.\n+   */\n+  const standardParams: OEQ.Search.SearchParams = {\n+    start: currentPage * rowsPerPage,\n+    length: rowsPerPage,\n+    status: [OEQ.Common.ItemStatus.LIVE, OEQ.Common.ItemStatus.REVIEW],\n+    order: sortOrder,\n+  };\n+  /**\n+   * Update the page title and retrieve Search settings.\n    */\n   useEffect(() => {\n     updateTemplate((tp) => ({\n       ...templateDefaults(searchStrings.title)(tp),\n     }));\n \n-    getSearchSettingsFromServer().then((settings: SearchSettings) =>\n-      search({\n-        status: [OEQ.Common.ItemStatus.LIVE, OEQ.Common.ItemStatus.REVIEW],\n-        order: settings.defaultSearchSort,\n-      })\n-    );\n+    getSearchSettingsFromServer().then((settings: SearchSettings) => {\n+      setSortOrder(settings.defaultSearchSort);\n+    });\n   }, []);\n \n+  /**\n+   * Trigger a search when state values change, but skip the initial values.\n+   */\n+  const isInitialSearch = useRef(true);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0ODE5MDEwMw=="}, "originalCommit": {"oid": "ff578348c4b687959d7171d978be7dd7f26f6f41"}, "originalPosition": 93}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0ODgwMTI5OA==", "bodyText": "And so are you saying that initially, we wont see any search results until at least the above effect to getSearchSettingsFromServer completes and calls setSortOrder?\n\nYes, but I wonder if we want a initial search no matter getSearchSettingsFromServer succeeds or fails.", "url": "https://github.com/openequella/openEQUELLA/pull/1985#discussion_r448801298", "createdAt": "2020-07-02T07:27:07Z", "author": {"login": "PenghaiZhang"}, "path": "Source/Plugins/Core/com.equella.core/js/tsrc/search/SearchPage.tsx", "diffHunk": "@@ -16,55 +16,88 @@\n  * limitations under the License.\n  */\n import * as React from \"react\";\n-import { useEffect, useState } from \"react\";\n+import { useEffect, useRef, useState } from \"react\";\n import {\n   templateDefaults,\n   templateError,\n   TemplateUpdateProps,\n } from \"../mainui/Template\";\n import { languageStrings } from \"../util/langstrings\";\n import {\n+  Card,\n+  CardActions,\n+  CardContent,\n+  Grid,\n   IconButton,\n   List,\n-  ListItem,\n   ListSubheader,\n+  TablePagination,\n   TextField,\n-  Grid,\n-  Card,\n-  CardContent,\n } from \"@material-ui/core\";\n import SearchIcon from \"@material-ui/icons/Search\";\n-import { searchItems } from \"./SearchModule\";\n+import { defaultPagedSearchResult, searchItems } from \"./SearchModule\";\n import * as OEQ from \"@openequella/rest-api-client\";\n import SearchResult from \"./components/SearchResult\";\n import { generateFromError } from \"../api/errors\";\n import {\n   getSearchSettingsFromServer,\n   SearchSettings,\n+  SortOrder,\n } from \"../settings/Search/SearchSettingsModule\";\n+import { makeStyles } from \"@material-ui/core/styles\";\n+\n+const useStyles = makeStyles({\n+  cardAction: {\n+    display: \"flex\",\n+    justifyContent: \"center\",\n+  },\n+});\n \n const SearchPage = ({ updateTemplate }: TemplateUpdateProps) => {\n+  const classes = useStyles();\n   const searchStrings = languageStrings.searchpage;\n-  const [searchResultItems, setSearchResultItems] = useState<\n-    OEQ.Search.SearchResultItem[]\n-  >([]);\n+\n+  const [rowsPerPage, setRowsPerPage] = useState<number>(10);\n+  const [currentPage, setCurrentPage] = useState<number>(0);\n+  const [sortOrder, setSortOrder] = useState<SortOrder>(SortOrder.RANK);\n+  const [pagedSearchResult, setPagedSearchResult] = useState<\n+    OEQ.Common.PagedResult<OEQ.Search.SearchResultItem>\n+  >(defaultPagedSearchResult);\n \n   /**\n-   * Update the page title and do a default search.\n+   * Construct a standard search criteria.\n+   */\n+  const standardParams: OEQ.Search.SearchParams = {\n+    start: currentPage * rowsPerPage,\n+    length: rowsPerPage,\n+    status: [OEQ.Common.ItemStatus.LIVE, OEQ.Common.ItemStatus.REVIEW],\n+    order: sortOrder,\n+  };\n+  /**\n+   * Update the page title and retrieve Search settings.\n    */\n   useEffect(() => {\n     updateTemplate((tp) => ({\n       ...templateDefaults(searchStrings.title)(tp),\n     }));\n \n-    getSearchSettingsFromServer().then((settings: SearchSettings) =>\n-      search({\n-        status: [OEQ.Common.ItemStatus.LIVE, OEQ.Common.ItemStatus.REVIEW],\n-        order: settings.defaultSearchSort,\n-      })\n-    );\n+    getSearchSettingsFromServer().then((settings: SearchSettings) => {\n+      setSortOrder(settings.defaultSearchSort);\n+    });\n   }, []);\n \n+  /**\n+   * Trigger a search when state values change, but skip the initial values.\n+   */\n+  const isInitialSearch = useRef(true);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0ODE5MDEwMw=="}, "originalCommit": {"oid": "ff578348c4b687959d7171d978be7dd7f26f6f41"}, "originalPosition": 93}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0ODgwMTY0Mg==", "bodyText": "Is the goal of this similar to https://ahooks.js.org/hooks/life-cycle/use-update-effect ?\n\nYes!!", "url": "https://github.com/openequella/openEQUELLA/pull/1985#discussion_r448801642", "createdAt": "2020-07-02T07:27:49Z", "author": {"login": "PenghaiZhang"}, "path": "Source/Plugins/Core/com.equella.core/js/tsrc/search/SearchPage.tsx", "diffHunk": "@@ -16,55 +16,88 @@\n  * limitations under the License.\n  */\n import * as React from \"react\";\n-import { useEffect, useState } from \"react\";\n+import { useEffect, useRef, useState } from \"react\";\n import {\n   templateDefaults,\n   templateError,\n   TemplateUpdateProps,\n } from \"../mainui/Template\";\n import { languageStrings } from \"../util/langstrings\";\n import {\n+  Card,\n+  CardActions,\n+  CardContent,\n+  Grid,\n   IconButton,\n   List,\n-  ListItem,\n   ListSubheader,\n+  TablePagination,\n   TextField,\n-  Grid,\n-  Card,\n-  CardContent,\n } from \"@material-ui/core\";\n import SearchIcon from \"@material-ui/icons/Search\";\n-import { searchItems } from \"./SearchModule\";\n+import { defaultPagedSearchResult, searchItems } from \"./SearchModule\";\n import * as OEQ from \"@openequella/rest-api-client\";\n import SearchResult from \"./components/SearchResult\";\n import { generateFromError } from \"../api/errors\";\n import {\n   getSearchSettingsFromServer,\n   SearchSettings,\n+  SortOrder,\n } from \"../settings/Search/SearchSettingsModule\";\n+import { makeStyles } from \"@material-ui/core/styles\";\n+\n+const useStyles = makeStyles({\n+  cardAction: {\n+    display: \"flex\",\n+    justifyContent: \"center\",\n+  },\n+});\n \n const SearchPage = ({ updateTemplate }: TemplateUpdateProps) => {\n+  const classes = useStyles();\n   const searchStrings = languageStrings.searchpage;\n-  const [searchResultItems, setSearchResultItems] = useState<\n-    OEQ.Search.SearchResultItem[]\n-  >([]);\n+\n+  const [rowsPerPage, setRowsPerPage] = useState<number>(10);\n+  const [currentPage, setCurrentPage] = useState<number>(0);\n+  const [sortOrder, setSortOrder] = useState<SortOrder>(SortOrder.RANK);\n+  const [pagedSearchResult, setPagedSearchResult] = useState<\n+    OEQ.Common.PagedResult<OEQ.Search.SearchResultItem>\n+  >(defaultPagedSearchResult);\n \n   /**\n-   * Update the page title and do a default search.\n+   * Construct a standard search criteria.\n+   */\n+  const standardParams: OEQ.Search.SearchParams = {\n+    start: currentPage * rowsPerPage,\n+    length: rowsPerPage,\n+    status: [OEQ.Common.ItemStatus.LIVE, OEQ.Common.ItemStatus.REVIEW],\n+    order: sortOrder,\n+  };\n+  /**\n+   * Update the page title and retrieve Search settings.\n    */\n   useEffect(() => {\n     updateTemplate((tp) => ({\n       ...templateDefaults(searchStrings.title)(tp),\n     }));\n \n-    getSearchSettingsFromServer().then((settings: SearchSettings) =>\n-      search({\n-        status: [OEQ.Common.ItemStatus.LIVE, OEQ.Common.ItemStatus.REVIEW],\n-        order: settings.defaultSearchSort,\n-      })\n-    );\n+    getSearchSettingsFromServer().then((settings: SearchSettings) => {\n+      setSortOrder(settings.defaultSearchSort);\n+    });\n   }, []);\n \n+  /**\n+   * Trigger a search when state values change, but skip the initial values.\n+   */\n+  const isInitialSearch = useRef(true);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0ODE5MDEwMw=="}, "originalCommit": {"oid": "ff578348c4b687959d7171d978be7dd7f26f6f41"}, "originalPosition": 93}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjc5MzQ5NTU4OnYy", "diffSide": "RIGHT", "path": "Source/Plugins/Core/com.equella.core/js/tsrc/search/SearchPage.tsx", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wMVQwODowODo1MFrOGrbaZw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wMlQwMzoxMzowOVrOGr79Tg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0ODE5MTA3OQ==", "bodyText": "I had a pondering that if we should move const [query, setQuery] = React.useState<string>(\"\"); done in #1967 to here,  pass setQuery to SearchBar, and then add query as one dependency for this hook. So I image when the page is completed, this array of dependencies will include values of most controls / panels.", "url": "https://github.com/openequella/openEQUELLA/pull/1985#discussion_r448191079", "createdAt": "2020-07-01T08:08:50Z", "author": {"login": "PenghaiZhang"}, "path": "Source/Plugins/Core/com.equella.core/js/tsrc/search/SearchPage.tsx", "diffHunk": "@@ -16,55 +16,88 @@\n  * limitations under the License.\n  */\n import * as React from \"react\";\n-import { useEffect, useState } from \"react\";\n+import { useEffect, useRef, useState } from \"react\";\n import {\n   templateDefaults,\n   templateError,\n   TemplateUpdateProps,\n } from \"../mainui/Template\";\n import { languageStrings } from \"../util/langstrings\";\n import {\n+  Card,\n+  CardActions,\n+  CardContent,\n+  Grid,\n   IconButton,\n   List,\n-  ListItem,\n   ListSubheader,\n+  TablePagination,\n   TextField,\n-  Grid,\n-  Card,\n-  CardContent,\n } from \"@material-ui/core\";\n import SearchIcon from \"@material-ui/icons/Search\";\n-import { searchItems } from \"./SearchModule\";\n+import { defaultPagedSearchResult, searchItems } from \"./SearchModule\";\n import * as OEQ from \"@openequella/rest-api-client\";\n import SearchResult from \"./components/SearchResult\";\n import { generateFromError } from \"../api/errors\";\n import {\n   getSearchSettingsFromServer,\n   SearchSettings,\n+  SortOrder,\n } from \"../settings/Search/SearchSettingsModule\";\n+import { makeStyles } from \"@material-ui/core/styles\";\n+\n+const useStyles = makeStyles({\n+  cardAction: {\n+    display: \"flex\",\n+    justifyContent: \"center\",\n+  },\n+});\n \n const SearchPage = ({ updateTemplate }: TemplateUpdateProps) => {\n+  const classes = useStyles();\n   const searchStrings = languageStrings.searchpage;\n-  const [searchResultItems, setSearchResultItems] = useState<\n-    OEQ.Search.SearchResultItem[]\n-  >([]);\n+\n+  const [rowsPerPage, setRowsPerPage] = useState<number>(10);\n+  const [currentPage, setCurrentPage] = useState<number>(0);\n+  const [sortOrder, setSortOrder] = useState<SortOrder>(SortOrder.RANK);\n+  const [pagedSearchResult, setPagedSearchResult] = useState<\n+    OEQ.Common.PagedResult<OEQ.Search.SearchResultItem>\n+  >(defaultPagedSearchResult);\n \n   /**\n-   * Update the page title and do a default search.\n+   * Construct a standard search criteria.\n+   */\n+  const standardParams: OEQ.Search.SearchParams = {\n+    start: currentPage * rowsPerPage,\n+    length: rowsPerPage,\n+    status: [OEQ.Common.ItemStatus.LIVE, OEQ.Common.ItemStatus.REVIEW],\n+    order: sortOrder,\n+  };\n+  /**\n+   * Update the page title and retrieve Search settings.\n    */\n   useEffect(() => {\n     updateTemplate((tp) => ({\n       ...templateDefaults(searchStrings.title)(tp),\n     }));\n \n-    getSearchSettingsFromServer().then((settings: SearchSettings) =>\n-      search({\n-        status: [OEQ.Common.ItemStatus.LIVE, OEQ.Common.ItemStatus.REVIEW],\n-        order: settings.defaultSearchSort,\n-      })\n-    );\n+    getSearchSettingsFromServer().then((settings: SearchSettings) => {\n+      setSortOrder(settings.defaultSearchSort);\n+    });\n   }, []);\n \n+  /**\n+   * Trigger a search when state values change, but skip the initial values.\n+   */\n+  const isInitialSearch = useRef(true);\n+  useEffect(() => {\n+    if (isInitialSearch.current) {\n+      isInitialSearch.current = false;\n+    } else {\n+      search(standardParams);\n+    }\n+  }, [rowsPerPage, currentPage, sortOrder]);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ff578348c4b687959d7171d978be7dd7f26f6f41"}, "originalPosition": 100}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0ODcyNDMwMg==", "bodyText": "I like your thinking. \ud83d\udc4d\nI do wonder whether we may need to consider having a single bit of state though which contains an object with all our search options. I feel this will make things clearer and to ensure we don't miss any. Hey, maybe it's even the params that ultimately get passed to search. But I see there is some misalignment there, and you may need an intermediate object. However that object could then be passed to search and perhaps it has to the log to transform it to OEQ.Search.SearchParams. \ud83e\udd14\nWhat do you think? Could we set that up here now? And then when #1967 gets done it just plugs on in with query?", "url": "https://github.com/openequella/openEQUELLA/pull/1985#discussion_r448724302", "createdAt": "2020-07-02T03:13:09Z", "author": {"login": "edalex-ian"}, "path": "Source/Plugins/Core/com.equella.core/js/tsrc/search/SearchPage.tsx", "diffHunk": "@@ -16,55 +16,88 @@\n  * limitations under the License.\n  */\n import * as React from \"react\";\n-import { useEffect, useState } from \"react\";\n+import { useEffect, useRef, useState } from \"react\";\n import {\n   templateDefaults,\n   templateError,\n   TemplateUpdateProps,\n } from \"../mainui/Template\";\n import { languageStrings } from \"../util/langstrings\";\n import {\n+  Card,\n+  CardActions,\n+  CardContent,\n+  Grid,\n   IconButton,\n   List,\n-  ListItem,\n   ListSubheader,\n+  TablePagination,\n   TextField,\n-  Grid,\n-  Card,\n-  CardContent,\n } from \"@material-ui/core\";\n import SearchIcon from \"@material-ui/icons/Search\";\n-import { searchItems } from \"./SearchModule\";\n+import { defaultPagedSearchResult, searchItems } from \"./SearchModule\";\n import * as OEQ from \"@openequella/rest-api-client\";\n import SearchResult from \"./components/SearchResult\";\n import { generateFromError } from \"../api/errors\";\n import {\n   getSearchSettingsFromServer,\n   SearchSettings,\n+  SortOrder,\n } from \"../settings/Search/SearchSettingsModule\";\n+import { makeStyles } from \"@material-ui/core/styles\";\n+\n+const useStyles = makeStyles({\n+  cardAction: {\n+    display: \"flex\",\n+    justifyContent: \"center\",\n+  },\n+});\n \n const SearchPage = ({ updateTemplate }: TemplateUpdateProps) => {\n+  const classes = useStyles();\n   const searchStrings = languageStrings.searchpage;\n-  const [searchResultItems, setSearchResultItems] = useState<\n-    OEQ.Search.SearchResultItem[]\n-  >([]);\n+\n+  const [rowsPerPage, setRowsPerPage] = useState<number>(10);\n+  const [currentPage, setCurrentPage] = useState<number>(0);\n+  const [sortOrder, setSortOrder] = useState<SortOrder>(SortOrder.RANK);\n+  const [pagedSearchResult, setPagedSearchResult] = useState<\n+    OEQ.Common.PagedResult<OEQ.Search.SearchResultItem>\n+  >(defaultPagedSearchResult);\n \n   /**\n-   * Update the page title and do a default search.\n+   * Construct a standard search criteria.\n+   */\n+  const standardParams: OEQ.Search.SearchParams = {\n+    start: currentPage * rowsPerPage,\n+    length: rowsPerPage,\n+    status: [OEQ.Common.ItemStatus.LIVE, OEQ.Common.ItemStatus.REVIEW],\n+    order: sortOrder,\n+  };\n+  /**\n+   * Update the page title and retrieve Search settings.\n    */\n   useEffect(() => {\n     updateTemplate((tp) => ({\n       ...templateDefaults(searchStrings.title)(tp),\n     }));\n \n-    getSearchSettingsFromServer().then((settings: SearchSettings) =>\n-      search({\n-        status: [OEQ.Common.ItemStatus.LIVE, OEQ.Common.ItemStatus.REVIEW],\n-        order: settings.defaultSearchSort,\n-      })\n-    );\n+    getSearchSettingsFromServer().then((settings: SearchSettings) => {\n+      setSortOrder(settings.defaultSearchSort);\n+    });\n   }, []);\n \n+  /**\n+   * Trigger a search when state values change, but skip the initial values.\n+   */\n+  const isInitialSearch = useRef(true);\n+  useEffect(() => {\n+    if (isInitialSearch.current) {\n+      isInitialSearch.current = false;\n+    } else {\n+      search(standardParams);\n+    }\n+  }, [rowsPerPage, currentPage, sortOrder]);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0ODE5MTA3OQ=="}, "originalCommit": {"oid": "ff578348c4b687959d7171d978be7dd7f26f6f41"}, "originalPosition": 100}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjc5MzUwMDkxOnYy", "diffSide": "LEFT", "path": "Source/Plugins/Core/com.equella.core/js/tsrc/search/SearchPage.tsx", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wMVQwODoxMDoyNFrOGrbdvg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wMVQwODoxMDoyNFrOGrbdvg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0ODE5MTkzNA==", "bodyText": "This ListItem is redundant as SearchResult already returns a ListItem.", "url": "https://github.com/openequella/openEQUELLA/pull/1985#discussion_r448191934", "createdAt": "2020-07-01T08:10:24Z", "author": {"login": "PenghaiZhang"}, "path": "Source/Plugins/Core/com.equella.core/js/tsrc/search/SearchPage.tsx", "diffHunk": "@@ -76,19 +109,17 @@ const SearchPage = ({ updateTemplate }: TemplateUpdateProps) => {\n   const search = (params?: OEQ.Search.SearchParams): void => {\n     searchItems(params)\n       .then((items: OEQ.Common.PagedResult<OEQ.Search.SearchResultItem>) =>\n-        setSearchResultItems(items.results)\n+        setPagedSearchResult(items)\n       )\n       .catch((error: Error) => handleError(error));\n   };\n \n   /**\n    * A SearchResult that represents one of the search result items.\n    */\n-  const searchResults = searchResultItems.map(\n+  const searchResults = pagedSearchResult.results.map(\n     (item: OEQ.Search.SearchResultItem) => (\n-      <ListItem key={item.uuid} divider>", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ff578348c4b687959d7171d978be7dd7f26f6f41"}, "originalPosition": 121}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjc5Njg0MDA5OnYy", "diffSide": "RIGHT", "path": "Source/Plugins/Core/com.equella.core/js/tsrc/search/SearchPage.tsx", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wMlQwMjo1ODoyN1rOGr7wqw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wMlQwMjo1ODoyN1rOGr7wqw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0ODcyMTA2Nw==", "bodyText": "<Grid> is able to do this layout type stuff, I feel we should standardise on using it instead of custom styles.", "url": "https://github.com/openequella/openEQUELLA/pull/1985#discussion_r448721067", "createdAt": "2020-07-02T02:58:27Z", "author": {"login": "edalex-ian"}, "path": "Source/Plugins/Core/com.equella.core/js/tsrc/search/SearchPage.tsx", "diffHunk": "@@ -16,55 +16,88 @@\n  * limitations under the License.\n  */\n import * as React from \"react\";\n-import { useEffect, useState } from \"react\";\n+import { useEffect, useRef, useState } from \"react\";\n import {\n   templateDefaults,\n   templateError,\n   TemplateUpdateProps,\n } from \"../mainui/Template\";\n import { languageStrings } from \"../util/langstrings\";\n import {\n+  Card,\n+  CardActions,\n+  CardContent,\n+  Grid,\n   IconButton,\n   List,\n-  ListItem,\n   ListSubheader,\n+  TablePagination,\n   TextField,\n-  Grid,\n-  Card,\n-  CardContent,\n } from \"@material-ui/core\";\n import SearchIcon from \"@material-ui/icons/Search\";\n-import { searchItems } from \"./SearchModule\";\n+import { defaultPagedSearchResult, searchItems } from \"./SearchModule\";\n import * as OEQ from \"@openequella/rest-api-client\";\n import SearchResult from \"./components/SearchResult\";\n import { generateFromError } from \"../api/errors\";\n import {\n   getSearchSettingsFromServer,\n   SearchSettings,\n+  SortOrder,\n } from \"../settings/Search/SearchSettingsModule\";\n+import { makeStyles } from \"@material-ui/core/styles\";\n+\n+const useStyles = makeStyles({\n+  cardAction: {\n+    display: \"flex\",\n+    justifyContent: \"center\",\n+  },\n+});", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ff578348c4b687959d7171d978be7dd7f26f6f41"}, "originalPosition": 45}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjc5Njg2ODUzOnYy", "diffSide": "RIGHT", "path": "Source/Plugins/Core/com.equella.core/js/tsrc/search/SearchPage.tsx", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wMlQwMzoxNzoyNVrOGr8BZg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wMlQwMzoxNzoyNVrOGr8BZg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0ODcyNTM1MA==", "bodyText": "Are there any non-standard params? Maybe I'm missing something, but it seems like this could just be:\n\n  \n    \n  \n    \n\n  \n  This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters. Learn more about bidirectional Unicode characters\n\n\n  \n\n\n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n              const standardParams: OEQ.Search.SearchParams = {\n          \n          \n            \n              const searchParams: OEQ.Search.SearchParams = {", "url": "https://github.com/openequella/openEQUELLA/pull/1985#discussion_r448725350", "createdAt": "2020-07-02T03:17:25Z", "author": {"login": "edalex-ian"}, "path": "Source/Plugins/Core/com.equella.core/js/tsrc/search/SearchPage.tsx", "diffHunk": "@@ -16,55 +16,88 @@\n  * limitations under the License.\n  */\n import * as React from \"react\";\n-import { useEffect, useState } from \"react\";\n+import { useEffect, useRef, useState } from \"react\";\n import {\n   templateDefaults,\n   templateError,\n   TemplateUpdateProps,\n } from \"../mainui/Template\";\n import { languageStrings } from \"../util/langstrings\";\n import {\n+  Card,\n+  CardActions,\n+  CardContent,\n+  Grid,\n   IconButton,\n   List,\n-  ListItem,\n   ListSubheader,\n+  TablePagination,\n   TextField,\n-  Grid,\n-  Card,\n-  CardContent,\n } from \"@material-ui/core\";\n import SearchIcon from \"@material-ui/icons/Search\";\n-import { searchItems } from \"./SearchModule\";\n+import { defaultPagedSearchResult, searchItems } from \"./SearchModule\";\n import * as OEQ from \"@openequella/rest-api-client\";\n import SearchResult from \"./components/SearchResult\";\n import { generateFromError } from \"../api/errors\";\n import {\n   getSearchSettingsFromServer,\n   SearchSettings,\n+  SortOrder,\n } from \"../settings/Search/SearchSettingsModule\";\n+import { makeStyles } from \"@material-ui/core/styles\";\n+\n+const useStyles = makeStyles({\n+  cardAction: {\n+    display: \"flex\",\n+    justifyContent: \"center\",\n+  },\n+});\n \n const SearchPage = ({ updateTemplate }: TemplateUpdateProps) => {\n+  const classes = useStyles();\n   const searchStrings = languageStrings.searchpage;\n-  const [searchResultItems, setSearchResultItems] = useState<\n-    OEQ.Search.SearchResultItem[]\n-  >([]);\n+\n+  const [rowsPerPage, setRowsPerPage] = useState<number>(10);\n+  const [currentPage, setCurrentPage] = useState<number>(0);\n+  const [sortOrder, setSortOrder] = useState<SortOrder>(SortOrder.RANK);\n+  const [pagedSearchResult, setPagedSearchResult] = useState<\n+    OEQ.Common.PagedResult<OEQ.Search.SearchResultItem>\n+  >(defaultPagedSearchResult);\n \n   /**\n-   * Update the page title and do a default search.\n+   * Construct a standard search criteria.\n+   */\n+  const standardParams: OEQ.Search.SearchParams = {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ff578348c4b687959d7171d978be7dd7f26f6f41"}, "originalPosition": 65}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1238, "cost": 1, "resetAt": "2021-11-12T20:44:06Z"}}}