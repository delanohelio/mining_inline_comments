{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDkwMDMxNjc3", "number": 2307, "title": "Add a tooltip to show the username on the account icon", "bodyText": "Checklist\n\n\n the contributor license agreement is signed\n commit message follows commit guidelines\n screenshots are included showing significant UI changes\n\nDescription of change\n#796\nChange the tooltip on the account icon in the top right of a page to show the user's username instead. Also, refactor away from currentuser.ts to use the oeq-ts-rest-api.", "createdAt": "2020-09-21T04:50:53Z", "url": "https://github.com/openequella/openEQUELLA/pull/2307", "merged": true, "mergeCommit": {"oid": "2abab76587388ae504242a34ed73ab948cca0a4b"}, "closed": true, "closedAt": "2020-09-28T03:26:40Z", "author": {"login": "SammyIsConfused"}, "timelineItems": {"totalCount": 14, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdK77xlAH2gAyNDkwMDMxNjc3OmI1MmU3NDk5MmU4Nzk2NWE3M2I2MDhmMDdjOGRiYjk5NTU3ZjhlNTI=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdNHJ8jgH2gAyNDkwMDMxNjc3OmEwZGI3ZWUxM2RiYzYzNTY1YmU2MDlmNGI0NDk1OTJmN2NiZWFlNzU=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "b52e74992e87965a73b608f07c8dbb99557f8e52", "author": {"user": null}, "url": "https://github.com/openequella/openEQUELLA/commit/b52e74992e87965a73b608f07c8dbb99557f8e52", "committedDate": "2020-09-21T04:46:10Z", "message": "Add username field to UserData"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b411d98b56d51712ec68b33d13f0571a79c313cd", "author": {"user": null}, "url": "https://github.com/openequella/openEQUELLA/commit/b411d98b56d51712ec68b33d13f0571a79c313cd", "committedDate": "2020-09-21T04:46:27Z", "message": "Change the icon tooltip to the username"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDkyMjgxMjkw", "url": "https://github.com/openequella/openEQUELLA/pull/2307#pullrequestreview-492281290", "createdAt": "2020-09-21T05:07:50Z", "commit": {"oid": "b411d98b56d51712ec68b33d13f0571a79c313cd"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yMVQwNTowNzo1MFrOHVA0dw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yMVQwNToxNjoxN1rOHVA66w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MTc5NTU3NQ==", "bodyText": "Aaahhhh, this reminds me.\nWe need to drop out currentuser.ts and use the support in oeq-ts-rest-api. So, this PR seems as good as any.\nCould you please remove currentuser.ts and move the code to use getCurrentUserDetails (and supporting interfaces) @ https://github.com/openequella/openEQUELLA/blob/develop/oeq-ts-rest-api/src/LegacyContent.ts#L38", "url": "https://github.com/openequella/openEQUELLA/pull/2307#discussion_r491795575", "createdAt": "2020-09-21T05:07:50Z", "author": {"login": "edalex-ian"}, "path": "Source/Plugins/Core/com.equella.core/js/tsrc/api/currentuser.ts", "diffHunk": "@@ -31,6 +31,7 @@ export interface UserData {\n   guest: boolean;\n   autoLoggedIn: boolean;\n   prefsEditable: boolean;\n+  username: string;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b411d98b56d51712ec68b33d13f0571a79c313cd"}, "originalPosition": 4}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MTc5NzIyNw==", "bodyText": "Could be good to also have a fallback here - just so we never have an empty \"bubble\" of a tooltip. Maybe \"Username unknown\". \ud83e\udd14", "url": "https://github.com/openequella/openEQUELLA/pull/2307#discussion_r491797227", "createdAt": "2020-09-21T05:16:17Z", "author": {"login": "edalex-ian"}, "path": "Source/Plugins/Core/com.equella.core/js/tsrc/mainui/Template.tsx", "diffHunk": "@@ -512,7 +512,7 @@ export const Template = React.memo(function Template({\n                 topBarString.notifications\n               )}\n             </Hidden>\n-            <Tooltip title={strings.menu.title}>\n+            <Tooltip title={currentUser?.username}>", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b411d98b56d51712ec68b33d13f0571a79c313cd"}, "originalPosition": 5}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "81dc0bb12440ca40aa4d0b8a64e369b27f7fd068", "author": {"user": null}, "url": "https://github.com/openequella/openEQUELLA/commit/81dc0bb12440ca40aa4d0b8a64e369b27f7fd068", "committedDate": "2020-09-21T06:07:30Z", "message": "Merge branch 'develop' into feature/see_logged_in_details"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f9afaf8c6354614e4801e6f3fffb5f5fae44de3f", "author": {"user": null}, "url": "https://github.com/openequella/openEQUELLA/commit/f9afaf8c6354614e4801e6f3fffb5f5fae44de3f", "committedDate": "2020-09-22T02:27:04Z", "message": "Delete currentuser.ts and refactor to use the oeq-ts-rest-api"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "50fbaa38e2986134c3129ac227e70896c71fe0ee", "author": {"user": null}, "url": "https://github.com/openequella/openEQUELLA/commit/50fbaa38e2986134c3129ac227e70896c71fe0ee", "committedDate": "2020-09-22T02:34:55Z", "message": "Add a fallback state for an unknown user name"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ee7b1aaa4170c150ac6564578e6cce774073f92f", "author": {"user": null}, "url": "https://github.com/openequella/openEQUELLA/commit/ee7b1aaa4170c150ac6564578e6cce774073f92f", "committedDate": "2020-09-22T02:38:50Z", "message": "Make whitespace changes"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDkzOTIxODE3", "url": "https://github.com/openequella/openEQUELLA/pull/2307#pullrequestreview-493921817", "createdAt": "2020-09-22T23:54:48Z", "commit": {"oid": "ee7b1aaa4170c150ac6564578e6cce774073f92f"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yMlQyMzo1NDo0OVrOHWQPpw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yMlQyMzo1NTo1NFrOHWQRBg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MzA5Njg3MQ==", "bodyText": "The convention for this library is to:\n\n  \n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            import type { CurrentUserDetails } from \"@openequella/rest-api-client/dist/LegacyContent\";\n          \n          \n            \n            import * as OEQ from \"@openequella\";\n          \n      \n    \n    \n  \n\nAnd then use accordingly.", "url": "https://github.com/openequella/openEQUELLA/pull/2307#discussion_r493096871", "createdAt": "2020-09-22T23:54:49Z", "author": {"login": "edalex-ian"}, "path": "Source/Plugins/Core/com.equella.core/js/tsrc/legacycontent/LegacyContent.tsx", "diffHunk": "@@ -20,6 +20,7 @@ import { ErrorResponse, fromAxiosResponse } from \"../api/errors\";\n import Axios from \"axios\";\n import { v4 } from \"uuid\";\n import { Config } from \"../config\";\n+import type { CurrentUserDetails } from \"@openequella/rest-api-client/dist/LegacyContent\";", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ee7b1aaa4170c150ac6564578e6cce774073f92f"}, "originalPosition": 4}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MzA5NzA4Mg==", "bodyText": "The convention for this library is to:\n\n  \n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            import type {\n          \n          \n            \n              CurrentUserDetails,\n          \n          \n            \n              MenuItem as MI,\n          \n          \n            \n            } from \"@openequella/rest-api-client/dist/LegacyContent\";\n          \n          \n            \n            import * as OEQ from \"@openequella\";\n          \n      \n    \n    \n  \n\nAnd then use accordingly.", "url": "https://github.com/openequella/openEQUELLA/pull/2307#discussion_r493097082", "createdAt": "2020-09-22T23:55:21Z", "author": {"login": "edalex-ian"}, "path": "Source/Plugins/Core/com.equella.core/js/tsrc/mainui/Template.tsx", "diffHunk": "@@ -46,11 +46,15 @@ import {\n import luxonUtils from \"@date-io/luxon\";\n import { makeStyles, Theme } from \"@material-ui/core/styles\";\n import { languageStrings } from \"../util/langstrings\";\n-import { guestUser, MenuItem as MI, UserData } from \"../api/currentuser\";\n import MessageInfo from \"../components/MessageInfo\";\n import { Link } from \"react-router-dom\";\n import { LocationDescriptor } from \"history\";\n import { routes } from \"./routes\";\n+import type {\n+  CurrentUserDetails,\n+  MenuItem as MI,\n+} from \"@openequella/rest-api-client/dist/LegacyContent\";", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ee7b1aaa4170c150ac6564578e6cce774073f92f"}, "originalPosition": 12}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MzA5NzIyMg==", "bodyText": "The convention for this library is to:\n\n  \n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            import type { CurrentUserDetails } from \"@openequella/rest-api-client/dist/LegacyContent\";\n          \n          \n            \n            import * as OEQ from \"@openequella\";\n          \n      \n    \n    \n  \n\nAnd then use accordingly.", "url": "https://github.com/openequella/openEQUELLA/pull/2307#discussion_r493097222", "createdAt": "2020-09-22T23:55:54Z", "author": {"login": "edalex-ian"}, "path": "Source/Plugins/Core/com.equella.core/js/tsrc/mainui/index.tsx", "diffHunk": "@@ -43,11 +43,12 @@ import {\n   PageContent,\n } from \"../legacycontent/LegacyContent\";\n import HtmlParser from \"react-html-parser\";\n-import { getCurrentUser, UserData } from \"../api/currentuser\";\n import { ErrorResponse } from \"../api/errors\";\n import ErrorPage from \"./ErrorPage\";\n import { LegacyForm } from \"../legacycontent/LegacyForm\";\n import SettingsPage from \"../settings/SettingsPage\";\n+import type { CurrentUserDetails } from \"@openequella/rest-api-client/dist/LegacyContent\";", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ee7b1aaa4170c150ac6564578e6cce774073f92f"}, "originalPosition": 9}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDk0NzM4NTI0", "url": "https://github.com/openequella/openEQUELLA/pull/2307#pullrequestreview-494738524", "createdAt": "2020-09-23T14:43:49Z", "commit": {"oid": "ee7b1aaa4170c150ac6564578e6cce774073f92f"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDk1MTE0OTk4", "url": "https://github.com/openequella/openEQUELLA/pull/2307#pullrequestreview-495114998", "createdAt": "2020-09-23T23:19:26Z", "commit": {"oid": "ee7b1aaa4170c150ac6564578e6cce774073f92f"}, "state": "APPROVED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yM1QyMzoxOToyN1rOHXEStA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yM1QyMzoyMDozNVrOHXEUEw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5Mzk0OTYyMA==", "bodyText": "As we have a language string change log now, do we need to put this new string into the log  when component is merged to develop?", "url": "https://github.com/openequella/openEQUELLA/pull/2307#discussion_r493949620", "createdAt": "2020-09-23T23:19:27Z", "author": {"login": "PenghaiZhang"}, "path": "Source/Plugins/Core/com.equella.core/js/tsrc/util/langstrings.ts", "diffHunk": "@@ -237,6 +237,7 @@ export const languageStrings = {\n       title: \"My Account\",\n       logout: \"Logout\",\n       prefs: \"My preferences\",\n+      usernameUnknown: \"Username unknown\",", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ee7b1aaa4170c150ac6564578e6cce774073f92f"}, "originalPosition": 4}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5Mzk0OTk3MQ==", "bodyText": "Can simplify the callback to (result: OEQ.LegacyContent.CurrentUserDetails) => result to save 2 lines \ud83d\ude04", "url": "https://github.com/openequella/openEQUELLA/pull/2307#discussion_r493949971", "createdAt": "2020-09-23T23:20:35Z", "author": {"login": "PenghaiZhang"}, "path": "Source/Plugins/Core/com.equella.core/js/tsrc/modules/UserDetailsModule.ts", "diffHunk": "@@ -15,41 +15,15 @@\n  * See the License for the specific language governing permissions and\n  * limitations under the License.\n  */\n-import Axios from \"axios\";\n+import * as OEQ from \"@openequella/rest-api-client\";\n+import { API_BASE_URL } from \"../config\";\n \n-export interface MenuItem {\n-  route?: string;\n-  href?: string;\n-  title: string;\n-  systemIcon?: string;\n-  iconUrl?: string;\n-  newWindow: boolean;\n-}\n-\n-export interface UserData {\n-  id: string;\n-  guest: boolean;\n-  autoLoggedIn: boolean;\n-  prefsEditable: boolean;\n-  counts?: {\n-    tasks: number;\n-    notifications: number;\n-  };\n-  menuGroups: MenuItem[][];\n-}\n-\n-export const guestUser: UserData = {\n-  id: \"guest\",\n-  guest: true,\n-  autoLoggedIn: false,\n-  prefsEditable: false,\n-  counts: {\n-    tasks: 0,\n-    notifications: 0,\n-  },\n-  menuGroups: [],\n-};\n-\n-export function getCurrentUser(): Promise<UserData> {\n-  return Axios.get<UserData>(\"api/content/currentuser\").then((r) => r.data);\n-}\n+/**\n+ * Gets the current user's info from the server as OEQ.LegacyContent.CurrentUserDetails.\n+ */\n+export const getCurrentUserDetails = () =>\n+  OEQ.LegacyContent.getCurrentUserDetails(API_BASE_URL).then(\n+    (result: OEQ.LegacyContent.CurrentUserDetails) => {\n+      return result;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ee7b1aaa4170c150ac6564578e6cce774073f92f"}, "originalPosition": 50}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "8da05efd1a40d17dc2d0300daea003f14f7eb606", "author": {"user": null}, "url": "https://github.com/openequella/openEQUELLA/commit/8da05efd1a40d17dc2d0300daea003f14f7eb606", "committedDate": "2020-09-25T00:00:17Z", "message": "Rename to UserModule.ts"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "8d2550a7f946c8d67a9180389d77ae9e3ac66c47", "author": {"user": null}, "url": "https://github.com/openequella/openEQUELLA/commit/8d2550a7f946c8d67a9180389d77ae9e3ac66c47", "committedDate": "2020-09-25T00:01:30Z", "message": "Use the correct import convention for the rest-api-client"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDk2MDcwNzM2", "url": "https://github.com/openequella/openEQUELLA/pull/2307#pullrequestreview-496070736", "createdAt": "2020-09-25T02:31:50Z", "commit": {"oid": "8d2550a7f946c8d67a9180389d77ae9e3ac66c47"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a0db7ee13dbc63565be609f4b449592f7cbeae75", "author": {"user": null}, "url": "https://github.com/openequella/openEQUELLA/commit/a0db7ee13dbc63565be609f4b449592f7cbeae75", "committedDate": "2020-09-27T22:58:27Z", "message": "Apply whitespace changes"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 479, "cost": 1, "resetAt": "2021-11-01T16:19:10Z"}}}