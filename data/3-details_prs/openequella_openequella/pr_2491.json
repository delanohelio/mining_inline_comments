{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTE1NzU3ODU3", "number": 2491, "title": "Add steps to ci.yaml to build and artefact storybook", "bodyText": "Checklist\n\n\n the contributor license agreement is signed\n commit message follows commit guidelines\n\nDescription of change\nThis PR adds steps to GitHub Actions workflow to build the static instance of Storybook and upload it as an artefact.\nDrafted until I see it working on CI.", "createdAt": "2020-11-05T02:52:24Z", "url": "https://github.com/openequella/openEQUELLA/pull/2491", "merged": true, "mergeCommit": {"oid": "8106073e66130a031e4d8f461795811050373ff1"}, "closed": true, "closedAt": "2020-11-12T22:07:36Z", "author": {"login": "SammyIsConfused"}, "timelineItems": {"totalCount": 18, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdZZPUXAH2gAyNTE1NzU3ODU3OjM3YmI5Y2M2ODUyYzQ1MWVmNGVkZTRkOGUyYTJlOWE0MTliMTIzNDE=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdbeZ9lAFqTUyODE5NDM0Mw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "37bb9cc6852c451ef4ede4d8e2a2e9a419b12341", "author": {"user": null}, "url": "https://github.com/openequella/openEQUELLA/commit/37bb9cc6852c451ef4ede4d8e2a2e9a419b12341", "committedDate": "2020-11-05T02:49:42Z", "message": "Add steps to ci.yaml to build and artefact storybook\n\nAlso add storybook-static to gitignore."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "402fd57e7cc1f566dae2a1ae894d47df4e3550f2", "author": {"user": null}, "url": "https://github.com/openequella/openEQUELLA/commit/402fd57e7cc1f566dae2a1ae894d47df4e3550f2", "committedDate": "2020-11-05T03:09:04Z", "message": "Fix whitespace in ci.yaml"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "18a26df45ee7ab7af3c0b190d7dc93ee4aa46802", "author": {"user": null}, "url": "https://github.com/openequella/openEQUELLA/commit/18a26df45ee7ab7af3c0b190d7dc93ee4aa46802", "committedDate": "2020-11-05T03:59:33Z", "message": "Remove storybook-static folder after it has been used"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d13b043d81a7c77bbff89843343c07ec761d82bc", "author": {"user": null}, "url": "https://github.com/openequella/openEQUELLA/commit/d13b043d81a7c77bbff89843343c07ec761d82bc", "committedDate": "2020-11-05T04:33:08Z", "message": "Remove leading slash from rm call"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTI0NzA1NjMy", "url": "https://github.com/openequella/openEQUELLA/pull/2491#pullrequestreview-524705632", "createdAt": "2020-11-05T21:59:24Z", "commit": {"oid": "d13b043d81a7c77bbff89843343c07ec761d82bc"}, "state": "APPROVED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wNVQyMTo1OToyNFrOHuYVDg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wNVQyMTo1OToyNFrOHuYVDg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxODM5NTE1MA==", "bodyText": "This seems like something which we may want to add to the eslint ignore or prettier ignore.\nIt will likely be an issue if the static storybook pages are built locally, could be nice to fix it for both cases.", "url": "https://github.com/openequella/openEQUELLA/pull/2491#discussion_r518395150", "createdAt": "2020-11-05T21:59:24Z", "author": {"login": "ChristianMurphy"}, "path": ".github/workflows/ci.yaml", "diffHunk": "@@ -78,6 +78,28 @@ jobs:\n         run: |\n           npm ci\n \n+      - name: Generate Static Storybook instance\n+        working-directory: Source/Plugins/Core/com.equella.core/js\n+        run: |\n+          npm run build-storybook\n+\n+      - name: Package Static Storybook instance\n+        run: |\n+          tar cvf storybook.tar --transform='s/.\\+\\///' \\\n+          Source/Plugins/Core/com.equella.core/js/storybook-static\n+\n+      - name: Remove Storybook Folder After Packaging\n+        # We need this step so that storybook isn't included in the checks\n+        working-directory: Source/Plugins/Core/com.equella.core/js\n+        run: |\n+          rm -R storybook-static", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d13b043d81a7c77bbff89843343c07ec761d82bc"}, "originalPosition": 18}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "683ae556be84133878675cf23a37b0fc52880d9c", "author": {"user": null}, "url": "https://github.com/openequella/openEQUELLA/commit/683ae556be84133878675cf23a37b0fc52880d9c", "committedDate": "2020-11-09T00:43:29Z", "message": "Do all storybook actions from js folder"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "4a876980e5af187070511fad97b74c5554371997", "author": {"user": null}, "url": "https://github.com/openequella/openEQUELLA/commit/4a876980e5af187070511fad97b74c5554371997", "committedDate": "2020-11-09T01:07:12Z", "message": "Add storybook-static to eslint ignore and typescript compile"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "2c3d1068cd9dacd9707094bff93bae8000f15aa1", "author": {"user": null}, "url": "https://github.com/openequella/openEQUELLA/commit/2c3d1068cd9dacd9707094bff93bae8000f15aa1", "committedDate": "2020-11-09T01:12:45Z", "message": "Add a .prettierignore"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "dc720368c69a148e06c9562703bdd7bd11b57f71", "author": {"user": null}, "url": "https://github.com/openequella/openEQUELLA/commit/dc720368c69a148e06c9562703bdd7bd11b57f71", "committedDate": "2020-11-09T01:25:48Z", "message": "Remove working-directory from Save Storybook step\n\nApparently using an action and setting a working-directory are mutually exclusive. So instead just set the path in the with block."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTI2NzQ4MTU3", "url": "https://github.com/openequella/openEQUELLA/pull/2491#pullrequestreview-526748157", "createdAt": "2020-11-09T23:54:55Z", "commit": {"oid": "dc720368c69a148e06c9562703bdd7bd11b57f71"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTI2NzUwNzUy", "url": "https://github.com/openequella/openEQUELLA/pull/2491#pullrequestreview-526750752", "createdAt": "2020-11-10T00:01:24Z", "commit": {"oid": "dc720368c69a148e06c9562703bdd7bd11b57f71"}, "state": "APPROVED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xMFQwMDowMToyNFrOHwGaMg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xMFQwMDowMjoxMVrOHwGbMw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMDE5ODcwNg==", "bodyText": "does this still need to be removed?\nNow that it is ignored by the linting and formatting tools?", "url": "https://github.com/openequella/openEQUELLA/pull/2491#discussion_r520198706", "createdAt": "2020-11-10T00:01:24Z", "author": {"login": "ChristianMurphy"}, "path": ".github/workflows/ci.yaml", "diffHunk": "@@ -78,6 +78,27 @@ jobs:\n         run: |\n           npm ci\n \n+      - name: Generate Static Storybook instance\n+        working-directory: Source/Plugins/Core/com.equella.core/js\n+        run: |\n+          npm run build-storybook\n+\n+      - name: Package Static Storybook instance\n+        working-directory: Source/Plugins/Core/com.equella.core/js\n+        run: |\n+          tar cvf storybook.tar storybook-static\n+\n+      - name: Remove Storybook Folder After Packaging\n+        working-directory: Source/Plugins/Core/com.equella.core/js\n+        run: |\n+          rm -R storybook-static", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "dc720368c69a148e06c9562703bdd7bd11b57f71"}, "originalPosition": 17}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMDE5ODk2Mw==", "bodyText": "could these be combined into a single step?", "url": "https://github.com/openequella/openEQUELLA/pull/2491#discussion_r520198963", "createdAt": "2020-11-10T00:02:11Z", "author": {"login": "ChristianMurphy"}, "path": ".github/workflows/ci.yaml", "diffHunk": "@@ -78,6 +78,27 @@ jobs:\n         run: |\n           npm ci\n \n+      - name: Generate Static Storybook instance\n+        working-directory: Source/Plugins/Core/com.equella.core/js\n+        run: |\n+          npm run build-storybook\n+\n+      - name: Package Static Storybook instance\n+        working-directory: Source/Plugins/Core/com.equella.core/js\n+        run: |\n+          tar cvf storybook.tar storybook-static", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "dc720368c69a148e06c9562703bdd7bd11b57f71"}, "originalPosition": 12}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTI2ODI3Mzg5", "url": "https://github.com/openequella/openEQUELLA/pull/2491#pullrequestreview-526827389", "createdAt": "2020-11-10T03:32:28Z", "commit": {"oid": "dc720368c69a148e06c9562703bdd7bd11b57f71"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "6dbd054f35e05436d05604162572d025a9a39f2f", "author": {"user": null}, "url": "https://github.com/openequella/openEQUELLA/commit/6dbd054f35e05436d05604162572d025a9a39f2f", "committedDate": "2020-11-10T03:47:20Z", "message": "Move storybook steps to their own job"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "46735b7d57338c6c6e7fb9dfe07e5687be8c6847", "author": {"user": null}, "url": "https://github.com/openequella/openEQUELLA/commit/46735b7d57338c6c6e7fb9dfe07e5687be8c6847", "committedDate": "2020-11-10T22:10:33Z", "message": "Remove unnecessary SBT and Ivy caches"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTI3ODExOTY0", "url": "https://github.com/openequella/openEQUELLA/pull/2491#pullrequestreview-527811964", "createdAt": "2020-11-11T02:40:09Z", "commit": {"oid": "46735b7d57338c6c6e7fb9dfe07e5687be8c6847"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xMVQwMjo0MDowOVrOHw5-5w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xMVQwMjo0Nzo0MlrOHw6RSw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMTA0MzY4Nw==", "bodyText": "Is that required? AFAICT, everything done below is JS / Node.", "url": "https://github.com/openequella/openEQUELLA/pull/2491#discussion_r521043687", "createdAt": "2020-11-11T02:40:09Z", "author": {"login": "edalex-ian"}, "path": ".github/workflows/ci.yaml", "diffHunk": "@@ -110,6 +110,56 @@ jobs:\n           name: Artefacts\n           path: artefacts.tar\n \n+  build_storybook:\n+    runs-on: ubuntu-latest\n+    steps:\n+      # Using v1 (rather than v2) through-out this workflow due to issue:\n+      # https://github.com/actions/checkout/issues/237\n+      - uses: actions/checkout@v1\n+\n+      - name: NPM Cache\n+        uses: actions/cache@v2\n+        with:\n+          path: ~/.npm\n+          key: ${{ runner.os }}-npm-${{ hashFiles('**/package-lock.json') }}\n+          restore-keys: |\n+            ${{ runner.os }}-npm-\n+\n+      - name: Read .nvmrc\n+        run: echo ::set-output name=NVMRC::$(cat .nvmrc)\n+        id: nvm\n+\n+      - name: Setup node\n+        uses: actions/setup-node@v1\n+        with:\n+          node-version: \"${{ steps.nvm.outputs.NVMRC }}\"\n+\n+      - name: Set up JDK 1.8\n+        uses: actions/setup-java@v1\n+        with:\n+          java-version: 1.8", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "46735b7d57338c6c6e7fb9dfe07e5687be8c6847"}, "originalPosition": 31}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMTA0NDg2MA==", "bodyText": "This should sit down with the code it belongs to: Source/Plugins/Core/com.equella.core/js/.gitignore", "url": "https://github.com/openequella/openEQUELLA/pull/2491#discussion_r521044860", "createdAt": "2020-11-11T02:42:17Z", "author": {"login": "edalex-ian"}, "path": ".gitignore", "diffHunk": "@@ -17,4 +17,4 @@ generated.keystore\n Source/Plugins/Kaltura\n server.xml\n node_modules/\n-\n+storybook-static/", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "46735b7d57338c6c6e7fb9dfe07e5687be8c6847"}, "originalPosition": 5}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMTA0ODM5NQ==", "bodyText": "It would be prudent to have it's own cache for this me thinks.\nbe good to replace -npm- on lines 124 and 126:\n\n  \n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                      key: ${{ runner.os }}-npm-${{ hashFiles('**/package-lock.json') }}\n          \n          \n            \n                      restore-keys: |\n          \n          \n            \n                        ${{ runner.os }}-npm-\n          \n          \n            \n                      key: ${{ runner.os }}-npm.storybook-${{ hashFiles('**/package-lock.json') }}\n          \n          \n            \n                      restore-keys: |\n          \n          \n            \n                        ${{ runner.os }}-npm.storybook-", "url": "https://github.com/openequella/openEQUELLA/pull/2491#discussion_r521048395", "createdAt": "2020-11-11T02:47:42Z", "author": {"login": "edalex-ian"}, "path": ".github/workflows/ci.yaml", "diffHunk": "@@ -110,6 +110,56 @@ jobs:\n           name: Artefacts\n           path: artefacts.tar\n \n+  build_storybook:\n+    runs-on: ubuntu-latest\n+    steps:\n+      # Using v1 (rather than v2) through-out this workflow due to issue:\n+      # https://github.com/actions/checkout/issues/237\n+      - uses: actions/checkout@v1\n+\n+      - name: NPM Cache\n+        uses: actions/cache@v2\n+        with:\n+          path: ~/.npm\n+          key: ${{ runner.os }}-npm-${{ hashFiles('**/package-lock.json') }}\n+          restore-keys: |\n+            ${{ runner.os }}-npm-", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "46735b7d57338c6c6e7fb9dfe07e5687be8c6847"}, "originalPosition": 17}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "6664a2ef502c29cb2f61295826d6d202965ea6bc", "author": {"user": null}, "url": "https://github.com/openequella/openEQUELLA/commit/6664a2ef502c29cb2f61295826d6d202965ea6bc", "committedDate": "2020-11-11T05:37:11Z", "message": "Don't set up JDK during storybook, set up own NPM cache"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTI3ODgwOTg4", "url": "https://github.com/openequella/openEQUELLA/pull/2491#pullrequestreview-527880988", "createdAt": "2020-11-11T05:56:02Z", "commit": {"oid": "6664a2ef502c29cb2f61295826d6d202965ea6bc"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTI4MTk0MzQz", "url": "https://github.com/openequella/openEQUELLA/pull/2491#pullrequestreview-528194343", "createdAt": "2020-11-11T13:58:42Z", "commit": {"oid": "6664a2ef502c29cb2f61295826d6d202965ea6bc"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 329, "cost": 1, "resetAt": "2021-11-01T16:19:10Z"}}}