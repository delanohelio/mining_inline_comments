{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTE5NTI5OTQz", "number": 2504, "title": "Feature/navigate to item summary page", "bodyText": "#688\nChecklist\n\n the [contributor license agreement][] is signed\n commit message follows [commit guidelines][]\n tests are included\n screenshots are included showing significant UI changes\n documentation is changed or added\n\nDescription of change\nThis PR focuses on the feature of navigating from new Search page to the ItemSummary page.\nIn the context of Selection Session, the link to ItemSummary page requires some extra query params to help the Legacy server rendering.\nAll required information is available in front-end now,  and we just need to add these query params in each Item title link.\nAlso, you will see MUI Link is used. This is probably due to two reasons:\n\nthe mixed environment where new tsx component is used in Legacy content;\nthe only component that can be used when the ItemSummary  page URL is matched in the routes is LegacyPage.\n\nSo I suggest we come back and address the problem when we have a new tsx component for ItemSummary page.\nA video is available here.", "createdAt": "2020-11-12T00:10:15Z", "url": "https://github.com/openequella/openEQUELLA/pull/2504", "merged": true, "mergeCommit": {"oid": "e5b383fa2182e7c8bc85cde36d86f687bbfd779e"}, "closed": true, "closedAt": "2020-11-15T22:00:27Z", "author": {"login": "PenghaiZhang"}, "timelineItems": {"totalCount": 20, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdbm4t6AH2gAyNTE5NTI5OTQzOmEyNDVhZmZkZGQ3YTk1OTU1ZTQ5YTIzMjg2NWMzZGI0OGEyYmU4MmQ=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdcTNfngH2gAyNTE5NTI5OTQzOjliOTM1OGZjYTE1ODY2M2YxOTMzNDEzMDA0MzZiNjYwZTNjODk2Njc=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "a245affddd7a95955e49a232865c3db48a2be82d", "author": {"user": {"login": "PenghaiZhang", "name": null}}, "url": "https://github.com/openequella/openEQUELLA/commit/a245affddd7a95955e49a232865c3db48a2be82d", "committedDate": "2020-11-11T23:51:32Z", "message": "Tweak 'NewPageProps' and 'NewPage'\n\nRename 'isOpenInSelectionSession' to 'forceRefresh' and add\na comment to explain why 'SettingsPage' needs 'forceRefresh'."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "6e1ab77726517286b1af093fa913d5c4032e8929", "author": {"user": {"login": "PenghaiZhang", "name": null}}, "url": "https://github.com/openequella/openEQUELLA/commit/6e1ab77726517286b1af093fa913d5c4032e8929", "committedDate": "2020-11-11T23:51:32Z", "message": "Remove the extra call of 'getNewSearchUIContent' in\nAbstractRootSearchSection."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "33b75433dd5b6d5f79aadb79da64b2764b1814b6", "author": {"user": {"login": "PenghaiZhang", "name": null}}, "url": "https://github.com/openequella/openEQUELLA/commit/33b75433dd5b6d5f79aadb79da64b2764b1814b6", "committedDate": "2020-11-11T23:51:33Z", "message": "Navigate from new Search page to ItemSummary page in\nSelection Session.\n\nTo display the Selection Session specific ItemSummary\npage, extra information such as the ID of a Selection\nSession and the Item count of a Search result is required\nto help the legacy server rendering. So we can collect\nSelection Session info from 'renderData' and pass Search\nresult data from component 'SearchPage' to 'SearchResult',\nand then add query params to each Item title link.\n\nPlease note that MUI Link is used for the navigation in\nSelection Session. This is due to the complexity of creating\na route in this context. Once we have a new component for\nItemSummary page, we should come back and use React Router\nLink."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b8205991b6ea09183ad1f840a72332da2b3833c0", "author": {"user": {"login": "PenghaiZhang", "name": null}}, "url": "https://github.com/openequella/openEQUELLA/commit/b8205991b6ea09183ad1f840a72332da2b3833c0", "committedDate": "2020-11-12T00:53:11Z", "message": "Make 'indexNumber' and 'totalCount' optional."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "398e915fca4db56a9640d24c161da667aebd6dc1", "author": {"user": {"login": "PenghaiZhang", "name": null}}, "url": "https://github.com/openequella/openEQUELLA/commit/398e915fca4db56a9640d24c161da667aebd6dc1", "committedDate": "2020-11-12T01:11:38Z", "message": "Update the Storybook of SearchResultList."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTI4NjU3NjUw", "url": "https://github.com/openequella/openEQUELLA/pull/2504#pullrequestreview-528657650", "createdAt": "2020-11-12T00:49:56Z", "commit": {"oid": "33b75433dd5b6d5f79aadb79da64b2764b1814b6"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xMlQwMDo0OTo1NlrOHxkulA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xMlQwMToxMDozN1rOHxlbqQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMTc0NDAyMA==", "bodyText": "How about if you you make forceRefresh default to false so that the absence of this property on the element means it's off?", "url": "https://github.com/openequella/openEQUELLA/pull/2504#discussion_r521744020", "createdAt": "2020-11-12T00:49:56Z", "author": {"login": "edalex-ian"}, "path": "Source/Plugins/Core/com.equella.core/js/tsrc/mainui/App.tsx", "diffHunk": "@@ -93,15 +86,17 @@ const App = ({ entryPage }: AppProps) => {\n     [\n       Literal(\"searchPage\"),\n       () => (\n-        <NewPage classPrefix=\"oeq-nsp\" isOpenInSelectionSession>\n+        <NewPage classPrefix=\"oeq-nsp\" forceRefresh={false}>", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "33b75433dd5b6d5f79aadb79da64b2764b1814b6"}, "originalPosition": 41}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMTc0NTAzNA==", "bodyText": "I believe you need to update the SB stories for these - I'd say that's what's triggering the build failure.\nhmmm, is it possible these props will help us later to add support for the Item Summary Page next/prev buttons?", "url": "https://github.com/openequella/openEQUELLA/pull/2504#discussion_r521745034", "createdAt": "2020-11-12T00:51:41Z", "author": {"login": "edalex-ian"}, "path": "Source/Plugins/Core/com.equella.core/js/tsrc/search/components/SearchResult.tsx", "diffHunk": "@@ -112,12 +117,22 @@ export interface SearchResultProps {\n    * The details of the items to display.\n    */\n   item: OEQ.Search.SearchResultItem;\n+  /**\n+   * The index of an search result Item which does not take Pagination into account.\n+   */\n+  indexNumber: number;\n+  /**\n+   * The total number of available Items matching current Search options.\n+   */\n+  totalCount: number;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "33b75433dd5b6d5f79aadb79da64b2764b1814b6"}, "originalPosition": 37}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMTc1NTU2MQ==", "bodyText": "This block of logic should really be out in the Module layer. It's more to do with the internal workings of oEQ as opposed to how we present a result.\nconst buildSelectionSessionItemSummaryLink =\n  ({ stateId, integId, layout }: SelectionSessionInfo,\n  indexNumber?: number, totalCount?: number): string => {\n    ...\n}\nIf you had something like that, then this method could be more (declarative) like:\nconst itemLink = () => {\n  const itemTitle = name ? highlightField(name) : uuid;\n  const basicLink = <Link to={routes.ViewItem.to(uuid, version)}>{itemTitle}</Link>;\n  return renderData?.selectionSessionInfo ?\n    (<MUILink\n      href={buildSelectionSessionItemSummaryLink(renderData.selectionSessionInfo)}\n      underline=\"none\">\n        {itemTitle}\n    </MUILink>) :\n    basicLink;\n}\nAdded bonus, would be that you can then also easily unit test this.", "url": "https://github.com/openequella/openEQUELLA/pull/2504#discussion_r521755561", "createdAt": "2020-11-12T01:10:37Z", "author": {"login": "edalex-ian"}, "path": "Source/Plugins/Core/com.equella.core/js/tsrc/search/components/SearchResult.tsx", "diffHunk": "@@ -366,11 +381,36 @@ export default function SearchResult({\n   const highlightField = (fieldValue: string) =>\n     ReactHtmlParser(highlight(fieldValue, highlights, classes.highlight));\n \n-  const itemLink = (\n-    <Link to={routes.ViewItem.to(uuid, version)}>\n-      {name ? highlightField(name) : uuid}\n-    </Link>\n-  );\n+  const itemLink = () => {\n+    const itemTitle = name ? highlightField(name) : uuid;\n+    if (renderData?.selectionSessionInfo) {\n+      const { stateId, integId, layout } = renderData.selectionSessionInfo;\n+      let itemSummaryPageLink = AppConfig.baseUrl.concat(\n+        `items/${uuid}/${version}/?_sl.stateId=${stateId}&a=${layout}&search=%/searching.do`\n+      );\n+\n+      if (indexNumber !== undefined && totalCount !== undefined) {\n+        itemSummaryPageLink = itemSummaryPageLink.concat(\n+          `&index=${indexNumber}&available=${totalCount}`\n+        );\n+      }\n+\n+      // integId can be null in 'Resource Selector'.\n+      if (integId) {\n+        itemSummaryPageLink = itemSummaryPageLink.concat(`&_int.id=${integId}`);\n+      }", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b8205991b6ea09183ad1f840a72332da2b3833c0"}, "originalPosition": 75}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ac2004a300d4a197ebb1a55559b718da3f0b7eba", "author": {"user": {"login": "PenghaiZhang", "name": null}}, "url": "https://github.com/openequella/openEQUELLA/commit/ac2004a300d4a197ebb1a55559b718da3f0b7eba", "committedDate": "2020-11-12T02:29:26Z", "message": "Make 'forceRefresh' optional and default to false."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "4718deea2fd017a60ddadbe744633bc159d67b76", "author": {"user": {"login": "PenghaiZhang", "name": null}}, "url": "https://github.com/openequella/openEQUELLA/commit/4718deea2fd017a60ddadbe744633bc159d67b76", "committedDate": "2020-11-12T03:48:11Z", "message": "Add a new ts module for Selection Session which provides\na function to generate ItemSummary link."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "52bc0c66963e8a003dc0268d947a0c59cb1c28ea", "author": {"user": {"login": "PenghaiZhang", "name": null}}, "url": "https://github.com/openequella/openEQUELLA/commit/52bc0c66963e8a003dc0268d947a0c59cb1c28ea", "committedDate": "2020-11-12T03:51:55Z", "message": "Remove Item index and Item count for SearchResult\n\nDue to the Next/Prev buttons in ItemSummary page\nnot working, do not put Item index and Item count\nin Item title link."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTI4NzgxODM2", "url": "https://github.com/openequella/openEQUELLA/pull/2504#pullrequestreview-528781836", "createdAt": "2020-11-12T06:30:35Z", "commit": {"oid": "52bc0c66963e8a003dc0268d947a0c59cb1c28ea"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xMlQwNjozMDozNVrOHxsPIA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xMlQwNjozMDozNVrOHxsPIA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMTg2NzA0MA==", "bodyText": "Hmmm, TSDoc is a bit curious here, as really the param is a SelectionSessionInfo object and you'd refer there for the value of the inside params. \ud83d\ude15\nHere's how it's done in JSDoc land... But no TSDoc / typedoc description is jumping out for me. \ud83d\ude1e", "url": "https://github.com/openequella/openEQUELLA/pull/2504#discussion_r521867040", "createdAt": "2020-11-12T06:30:35Z", "author": {"login": "edalex-ian"}, "path": "Source/Plugins/Core/com.equella.core/js/tsrc/modules/SelectionSessionModule.ts", "diffHunk": "@@ -0,0 +1,43 @@\n+/*\n+ * Licensed to The Apereo Foundation under one or more contributor license\n+ * agreements. See the NOTICE file distributed with this work for additional\n+ * information regarding copyright ownership.\n+ *\n+ * The Apereo Foundation licenses this file to you under the Apache License,\n+ * Version 2.0, (the \"License\"); you may not use this file except in compliance\n+ * with the License. You may obtain a copy of the License at:\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+import { AppConfig } from \"../AppConfig\";\n+import { SelectionSessionInfo } from \"../mainui\";\n+\n+/**\n+ * Build a Selection Session specific ItemSummary Link.\n+ * @param stateId The ID of a Selection Session\n+ * @param integId The ID of a LSM Integration\n+ * @param layout The UI layout used in Selection Session", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "52bc0c66963e8a003dc0268d947a0c59cb1c28ea"}, "originalPosition": 25}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "792d1c24ccf853d6b428f4733037652419557400", "author": {"user": {"login": "PenghaiZhang", "name": null}}, "url": "https://github.com/openequella/openEQUELLA/commit/792d1c24ccf853d6b428f4733037652419557400", "committedDate": "2020-11-12T23:30:32Z", "message": "Centralise 'renderData' and provide a function to access it."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "876623e1d100a60a8370ad0e130404bf3389f7dc", "author": {"user": {"login": "PenghaiZhang", "name": null}}, "url": "https://github.com/openequella/openEQUELLA/commit/876623e1d100a60a8370ad0e130404bf3389f7dc", "committedDate": "2020-11-13T04:35:54Z", "message": "Add a type guard for accessing 'renderData'."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "6538f4a5310f6ac450d9aeeba159663acb5f63c5", "author": {"user": {"login": "PenghaiZhang", "name": null}}, "url": "https://github.com/openequella/openEQUELLA/commit/6538f4a5310f6ac450d9aeeba159663acb5f63c5", "committedDate": "2020-11-13T05:10:16Z", "message": "Update TSDoc for 'buildSelectionSessionItemSummaryLink'."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f3b59b93da0bd4f56ea93188d6a46d2da8cbe924", "author": {"user": {"login": "PenghaiZhang", "name": null}}, "url": "https://github.com/openequella/openEQUELLA/commit/f3b59b93da0bd4f56ea93188d6a46d2da8cbe924", "committedDate": "2020-11-13T05:11:57Z", "message": "Add a Jest test for 'SelectionSessionModule'."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "8413122da80bb64867f16ca6caa72a3c9c247a68", "author": {"user": {"login": "PenghaiZhang", "name": null}}, "url": "https://github.com/openequella/openEQUELLA/commit/8413122da80bb64867f16ca6caa72a3c9c247a68", "committedDate": "2020-11-13T05:12:33Z", "message": "Tidy ups for SearchResult and SearchResultList."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "52ad7612e2f10aa6339f85abf3c3381242d12d67", "author": {"user": {"login": "PenghaiZhang", "name": null}}, "url": "https://github.com/openequella/openEQUELLA/commit/52ad7612e2f10aa6339f85abf3c3381242d12d67", "committedDate": "2020-11-13T05:15:26Z", "message": "Add Jest tests to check the Item title link of SearchResult."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTMwNDY0NjU2", "url": "https://github.com/openequella/openEQUELLA/pull/2504#pullrequestreview-530464656", "createdAt": "2020-11-13T22:47:29Z", "commit": {"oid": "52ad7612e2f10aa6339f85abf3c3381242d12d67"}, "state": "APPROVED", "comments": {"totalCount": 9, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xM1QyMjo0NzoyOVrOHzB_pQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xM1QyMzowODozNlrOHzCYUg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMzI3MjEwMQ==", "bodyText": "Due to the name of this file we already know it's for the SelectionSessionModule. More so, this block is all about the buildSelectionSessionItemSummaryLink so it'd make more sense to go with:\n\n  \n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            describe(\"SelectionSessionModule\", () => {\n          \n          \n            \n            describe(\"buildSelectionSessionItemSummaryLink()\", () => {\n          \n      \n    \n    \n  \n\nAnd then later when SelectionSessionModule has more functions, you'd add another describe block for each function.", "url": "https://github.com/openequella/openEQUELLA/pull/2504#discussion_r523272101", "createdAt": "2020-11-13T22:47:29Z", "author": {"login": "edalex-ian"}, "path": "Source/Plugins/Core/com.equella.core/js/__tests__/tsrc/modules/SelectionSessionModule.test.ts", "diffHunk": "@@ -0,0 +1,50 @@\n+/*\n+ * Licensed to The Apereo Foundation under one or more contributor license\n+ * agreements. See the NOTICE file distributed with this work for additional\n+ * information regarding copyright ownership.\n+ *\n+ * The Apereo Foundation licenses this file to you under the Apache License,\n+ * Version 2.0, (the \"License\"); you may not use this file except in compliance\n+ * with the License. You may obtain a copy of the License at:\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+import { getSearchResult } from \"../../../__mocks__/SearchResult.mock\";\n+import type { SelectionSessionInfo } from \"../../../tsrc/AppConfig\";\n+import { buildSelectionSessionItemSummaryLink } from \"../../../tsrc/modules/SelectionSessionModule\";\n+\n+describe(\"SelectionSessionModule\", () => {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "52ad7612e2f10aa6339f85abf3c3381242d12d67"}, "originalPosition": 22}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMzI3MjM5Nw==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n              it(\"should build a URL for accessing ItemSummary page in Selection Session\", () => {\n          \n          \n            \n              it(\"builds basic URLs for accessing ItemSummary pages in Selection Session mode\", () => {", "url": "https://github.com/openequella/openEQUELLA/pull/2504#discussion_r523272397", "createdAt": "2020-11-13T22:48:31Z", "author": {"login": "edalex-ian"}, "path": "Source/Plugins/Core/com.equella.core/js/__tests__/tsrc/modules/SelectionSessionModule.test.ts", "diffHunk": "@@ -0,0 +1,50 @@\n+/*\n+ * Licensed to The Apereo Foundation under one or more contributor license\n+ * agreements. See the NOTICE file distributed with this work for additional\n+ * information regarding copyright ownership.\n+ *\n+ * The Apereo Foundation licenses this file to you under the Apache License,\n+ * Version 2.0, (the \"License\"); you may not use this file except in compliance\n+ * with the License. You may obtain a copy of the License at:\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+import { getSearchResult } from \"../../../__mocks__/SearchResult.mock\";\n+import type { SelectionSessionInfo } from \"../../../tsrc/AppConfig\";\n+import { buildSelectionSessionItemSummaryLink } from \"../../../tsrc/modules/SelectionSessionModule\";\n+\n+describe(\"SelectionSessionModule\", () => {\n+  const selectionSessionInfo: SelectionSessionInfo = {\n+    stateId: \"1\",\n+    layout: \"coursesearch\",\n+  };\n+  const { uuid, version } = getSearchResult.results[0];\n+\n+  it(\"should build a URL for accessing ItemSummary page in Selection Session\", () => {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "52ad7612e2f10aa6339f85abf3c3381242d12d67"}, "originalPosition": 29}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMzI3MjY0Nw==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n              it(\"should also include Integration ID in the URL\", () => {\n          \n          \n            \n              it(\"will include the Integration ID in the URL if provided in SelectionSessionInfo\", () => {", "url": "https://github.com/openequella/openEQUELLA/pull/2504#discussion_r523272647", "createdAt": "2020-11-13T22:49:20Z", "author": {"login": "edalex-ian"}, "path": "Source/Plugins/Core/com.equella.core/js/__tests__/tsrc/modules/SelectionSessionModule.test.ts", "diffHunk": "@@ -0,0 +1,50 @@\n+/*\n+ * Licensed to The Apereo Foundation under one or more contributor license\n+ * agreements. See the NOTICE file distributed with this work for additional\n+ * information regarding copyright ownership.\n+ *\n+ * The Apereo Foundation licenses this file to you under the Apache License,\n+ * Version 2.0, (the \"License\"); you may not use this file except in compliance\n+ * with the License. You may obtain a copy of the License at:\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+import { getSearchResult } from \"../../../__mocks__/SearchResult.mock\";\n+import type { SelectionSessionInfo } from \"../../../tsrc/AppConfig\";\n+import { buildSelectionSessionItemSummaryLink } from \"../../../tsrc/modules/SelectionSessionModule\";\n+\n+describe(\"SelectionSessionModule\", () => {\n+  const selectionSessionInfo: SelectionSessionInfo = {\n+    stateId: \"1\",\n+    layout: \"coursesearch\",\n+  };\n+  const { uuid, version } = getSearchResult.results[0];\n+\n+  it(\"should build a URL for accessing ItemSummary page in Selection Session\", () => {\n+    const link = buildSelectionSessionItemSummaryLink(\n+      selectionSessionInfo,\n+      uuid,\n+      version\n+    );\n+    expect(link).toBe(\n+      \"items/9b9bf5a9-c5af-490b-88fe-7e330679fad2/1/?_sl.stateId=1&a=coursesearch\"\n+    );\n+  });\n+\n+  it(\"should also include Integration ID in the URL\", () => {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "52ad7612e2f10aa6339f85abf3c3381242d12d67"}, "originalPosition": 40}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMzI3NDExMA==", "bodyText": "Should this be:\n\n  \n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n              selectionSessionInfo: SelectionSessionInfo | null;\n          \n          \n            \n              selectionSessionInfo?: SelectionSessionInfo;\n          \n      \n    \n    \n  \n\nOr is it explicitly null sometimes?", "url": "https://github.com/openequella/openEQUELLA/pull/2504#discussion_r523274110", "createdAt": "2020-11-13T22:54:18Z", "author": {"login": "edalex-ian"}, "path": "Source/Plugins/Core/com.equella.core/js/tsrc/AppConfig.ts", "diffHunk": "@@ -22,6 +22,41 @@ interface Config {\n   baseUrl: string;\n }\n \n+/**\n+ * Structure of Selection Session information which is used to help build\n+ * components(e.g. SearchResult) in the context of Selection Session.\n+ */\n+export interface SelectionSessionInfo {\n+  /**\n+   * The ID of a Selection Session\n+   */\n+  stateId: string;\n+  /**\n+   * The ID of an LMS Integration\n+   */\n+  integId?: string;\n+  /**\n+   * The UI layout used in Selection Session\n+   */\n+  layout: \"coursesearch\" | \"search\" | \"skinnysearch\";\n+}\n+\n+export interface RenderData {\n+  baseResources: string;\n+  newUI: boolean;\n+  autotestMode: boolean;\n+  newSearch: boolean;\n+  selectionSessionInfo: SelectionSessionInfo | null;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "52ad7612e2f10aa6339f85abf3c3381242d12d67"}, "originalPosition": 28}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMzI3NjUxNA==", "bodyText": "Being an exported function, we should make sure we fully type it:\n\n  \n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            export const getRenderData = () => {\n          \n          \n            \n            export const getRenderData = (): RenderData | undefined => {", "url": "https://github.com/openequella/openEQUELLA/pull/2504#discussion_r523276514", "createdAt": "2020-11-13T23:02:00Z", "author": {"login": "edalex-ian"}, "path": "Source/Plugins/Core/com.equella.core/js/tsrc/AppConfig.ts", "diffHunk": "@@ -22,6 +22,41 @@ interface Config {\n   baseUrl: string;\n }\n \n+/**\n+ * Structure of Selection Session information which is used to help build\n+ * components(e.g. SearchResult) in the context of Selection Session.\n+ */\n+export interface SelectionSessionInfo {\n+  /**\n+   * The ID of a Selection Session\n+   */\n+  stateId: string;\n+  /**\n+   * The ID of an LMS Integration\n+   */\n+  integId?: string;\n+  /**\n+   * The UI layout used in Selection Session\n+   */\n+  layout: \"coursesearch\" | \"search\" | \"skinnysearch\";\n+}\n+\n+export interface RenderData {\n+  baseResources: string;\n+  newUI: boolean;\n+  autotestMode: boolean;\n+  newSearch: boolean;\n+  selectionSessionInfo: SelectionSessionInfo | null;\n+}\n+\n+declare const renderData: RenderData | undefined;\n+export const getRenderData = () => {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "52ad7612e2f10aa6339f85abf3c3381242d12d67"}, "originalPosition": 32}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMzI3NzExMQ==", "bodyText": "Nit: Should this be more specific - should we be checking to see if renderData is an instance of RenderData. If so, maybe rework this function to a simple () => match(...).", "url": "https://github.com/openequella/openEQUELLA/pull/2504#discussion_r523277111", "createdAt": "2020-11-13T23:04:05Z", "author": {"login": "edalex-ian"}, "path": "Source/Plugins/Core/com.equella.core/js/tsrc/AppConfig.ts", "diffHunk": "@@ -22,6 +22,41 @@ interface Config {\n   baseUrl: string;\n }\n \n+/**\n+ * Structure of Selection Session information which is used to help build\n+ * components(e.g. SearchResult) in the context of Selection Session.\n+ */\n+export interface SelectionSessionInfo {\n+  /**\n+   * The ID of a Selection Session\n+   */\n+  stateId: string;\n+  /**\n+   * The ID of an LMS Integration\n+   */\n+  integId?: string;\n+  /**\n+   * The UI layout used in Selection Session\n+   */\n+  layout: \"coursesearch\" | \"search\" | \"skinnysearch\";\n+}\n+\n+export interface RenderData {\n+  baseResources: string;\n+  newUI: boolean;\n+  autotestMode: boolean;\n+  newSearch: boolean;\n+  selectionSessionInfo: SelectionSessionInfo | null;\n+}\n+\n+declare const renderData: RenderData | undefined;\n+export const getRenderData = () => {\n+  if (typeof renderData !== \"undefined\") {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "52ad7612e2f10aa6339f85abf3c3381242d12d67"}, "originalPosition": 33}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMzI3NzMxMQ==", "bodyText": "Noice! \ud83d\udc4d", "url": "https://github.com/openequella/openEQUELLA/pull/2504#discussion_r523277311", "createdAt": "2020-11-13T23:04:42Z", "author": {"login": "edalex-ian"}, "path": "Source/Plugins/Core/com.equella.core/js/tsrc/components/RichTextEditor.tsx", "diffHunk": "@@ -59,9 +59,8 @@ import \"tinymce/plugins/toc\";\n import \"tinymce/plugins/visualblocks\";\n import \"tinymce/plugins/visualchars\";\n import \"tinymce/plugins/wordcount\";\n-import type { RenderData } from \"../mainui\";\n \n-declare const renderData: RenderData | undefined;\n+const renderData = getRenderData();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "52ad7612e2f10aa6339f85abf3c3381242d12d67"}, "originalPosition": 16}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMzI3NzY2NA==", "bodyText": "Yup, I think this makes much more sense now in AppConfig. Good work. \ud83d\udc4d", "url": "https://github.com/openequella/openEQUELLA/pull/2504#discussion_r523277664", "createdAt": "2020-11-13T23:05:48Z", "author": {"login": "edalex-ian"}, "path": "Source/Plugins/Core/com.equella.core/js/tsrc/mainui/index.tsx", "diffHunk": "@@ -20,32 +20,6 @@ import * as ReactDOM from \"react-dom\";\n import { initStrings } from \"../util/langstrings\";\n import \"../util/polyfill\";\n \n-/**\n- * Structure of Selection Session information which is used to help build\n- * components(e.g. SearchResult) in the context of Selection Session.\n- */\n-interface SelectionSessionInfo {\n-  /**\n-   * The ID of a Selection Session\n-   */\n-  stateId: string;\n-  /**\n-   * The ID of an LMS Integration\n-   */\n-  integId?: string;\n-  /**\n-   * The UI layout used in Selection Session\n-   */\n-  layout: string;\n-}\n-\n-export interface RenderData {\n-  baseResources: string;\n-  newUI: boolean;\n-  autotestMode: boolean;\n-  newSearch: boolean;\n-  selectionSessionInfo: SelectionSessionInfo | null;\n-}", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "52ad7612e2f10aa6339f85abf3c3381242d12d67"}, "originalPosition": 29}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMzI3ODQxOA==", "bodyText": "Nit. Seeing you're only using in once place below, throwing in a variable is a bit redundant.", "url": "https://github.com/openequella/openEQUELLA/pull/2504#discussion_r523278418", "createdAt": "2020-11-13T23:08:36Z", "author": {"login": "edalex-ian"}, "path": "Source/Plugins/Core/com.equella.core/js/tsrc/search/components/SearchResult.tsx", "diffHunk": "@@ -137,7 +140,7 @@ export default function SearchResult({\n     attachment: OEQ.Search.Attachment;\n     viewerDetails?: OEQ.MimeType.MimeTypeViewerDetail;\n   }\n-\n+  const renderData = getRenderData();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "52ad7612e2f10aa6339f85abf3c3381242d12d67"}, "originalPosition": 28}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "2d666d551e7aa059a9d2b6cd91558f8c8d9197ba", "author": {"user": {"login": "PenghaiZhang", "name": null}}, "url": "https://github.com/openequella/openEQUELLA/commit/2d666d551e7aa059a9d2b6cd91558f8c8d9197ba", "committedDate": "2020-11-14T01:50:19Z", "message": "A few tweaks for SelectionSessionModule test."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "2dc1424f9b296c1b7408ee400c8cb8dbd1863307", "author": {"user": {"login": "PenghaiZhang", "name": null}}, "url": "https://github.com/openequella/openEQUELLA/commit/2dc1424f9b296c1b7408ee400c8cb8dbd1863307", "committedDate": "2020-11-14T02:49:54Z", "message": "Type function 'getRenderData'."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "9b9358fca158663f193341300436b660e3c89667", "author": {"user": {"login": "PenghaiZhang", "name": null}}, "url": "https://github.com/openequella/openEQUELLA/commit/9b9358fca158663f193341300436b660e3c89667", "committedDate": "2020-11-14T03:30:03Z", "message": "Simplify function 'getRenderData'."}}]}}}, "rateLimit": {"limit": 5000, "remaining": 338, "cost": 1, "resetAt": "2021-11-01T16:19:10Z"}}}