{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0Mzg1MTA1MTEy", "number": 1529, "title": "test: add unit tests for typescript utils", "bodyText": "Checklist\n\n\n the contributor license agreement is signed\n commit message follows commit guidelines\n tests are included\n\nDescription of change\nAdds unit tests for typescript utils.\nalso adds support for writing tests in typescript.\n-------------------|---------|----------|---------|---------|-------------------\nFile               | % Stmts | % Branch | % Funcs | % Lines | Uncovered Line #s \n-------------------|---------|----------|---------|---------|-------------------\nAll files          |   95.18 |     87.1 |   86.67 |      96 |                   \n mainui            |   91.67 |      100 |      50 |     100 |                   \n  ErrorPage.tsx    |   91.67 |      100 |      50 |     100 |                   \n util              |   95.77 |    86.21 |   92.31 |   95.52 |                   \n  actionutil.ts    |      80 |      100 |      75 |      80 | 30,31             \n  commonstrings.ts |     100 |      100 |     100 |     100 |                   \n  dictionary.ts    |     100 |       50 |     100 |     100 | 15                \n  encodequery.ts   |     100 |       90 |     100 |     100 | 17                \n  langstrings.ts   |   96.55 |    81.82 |     100 |   96.43 | 57                \n  validation.ts    |     100 |      100 |     100 |     100 |                   \n-------------------|---------|----------|---------|---------|-------------------\n\nTest Suites: 8 passed, 8 total\nTests:       29 passed, 29 total\nSnapshots:   0 total\nTime:        6.441s", "createdAt": "2020-03-07T05:06:27Z", "url": "https://github.com/openequella/openEQUELLA/pull/1529", "merged": true, "mergeCommit": {"oid": "a26663ac6455c6a25532e8ccd97a57b741bc1914"}, "closed": true, "closedAt": "2020-03-15T22:16:51Z", "author": {"login": "ChristianMurphy"}, "timelineItems": {"totalCount": 11, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcLNk9VgH2gAyMzg1MTA1MTEyOmZkYzNlM2Y3MjU1NDYwZDk3Y2IwNDg3ZDllM2VmY2ZlMmNlMDJkNDU=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcNEYlLAFqTM3Mzk2NDk3OA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "fdc3e3f7255460d97cb0487d9e3efcfe2ce02d45", "author": {"user": {"login": "ChristianMurphy", "name": "Christian Murphy"}}, "url": "https://github.com/openequella/openEQUELLA/commit/fdc3e3f7255460d97cb0487d9e3efcfe2ce02d45", "committedDate": "2020-03-07T05:08:23Z", "message": "test: add unit tests for typescript utils\n\nalso adds support for writing tests in typescript\n\n```\n----------------|----------|----------|----------|----------|-------------------|\nFile            |  % Stmts | % Branch |  % Funcs |  % Lines | Uncovered Line #s |\n----------------|----------|----------|----------|----------|-------------------|\nAll files       |    97.83 |    88.89 |      100 |    97.67 |                   |\n encodequery.ts |      100 |       90 |      100 |      100 |                10 |\n langstrings.ts |       96 |    81.82 |      100 |    95.83 |                40 |\n validation.ts  |      100 |      100 |      100 |      100 |                   |\n----------------|----------|----------|----------|----------|-------------------|\n```"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "f0f690e28ac25749f7455852d7dd105906f1c90d", "author": {"user": {"login": "ChristianMurphy", "name": "Christian Murphy"}}, "url": "https://github.com/openequella/openEQUELLA/commit/f0f690e28ac25749f7455852d7dd105906f1c90d", "committedDate": "2020-03-07T05:04:30Z", "message": "test: add unit tests for typescript utils\n\nalso adds support for writing tests in typescript\n\n```\n----------------|----------|----------|----------|----------|-------------------|\nFile            |  % Stmts | % Branch |  % Funcs |  % Lines | Uncovered Line #s |\n----------------|----------|----------|----------|----------|-------------------|\nAll files       |    97.83 |    88.89 |      100 |    97.67 |                   |\n encodequery.ts |      100 |       90 |      100 |      100 |                10 |\n langstrings.ts |       96 |    81.82 |      100 |    95.83 |                40 |\n validation.ts  |      100 |      100 |      100 |      100 |                   |\n----------------|----------|----------|----------|----------|-------------------|\n```"}, "afterCommit": {"oid": "fdc3e3f7255460d97cb0487d9e3efcfe2ce02d45", "author": {"user": {"login": "ChristianMurphy", "name": "Christian Murphy"}}, "url": "https://github.com/openequella/openEQUELLA/commit/fdc3e3f7255460d97cb0487d9e3efcfe2ce02d45", "committedDate": "2020-03-07T05:08:23Z", "message": "test: add unit tests for typescript utils\n\nalso adds support for writing tests in typescript\n\n```\n----------------|----------|----------|----------|----------|-------------------|\nFile            |  % Stmts | % Branch |  % Funcs |  % Lines | Uncovered Line #s |\n----------------|----------|----------|----------|----------|-------------------|\nAll files       |    97.83 |    88.89 |      100 |    97.67 |                   |\n encodequery.ts |      100 |       90 |      100 |      100 |                10 |\n langstrings.ts |       96 |    81.82 |      100 |    95.83 |                40 |\n validation.ts  |      100 |      100 |      100 |      100 |                   |\n----------------|----------|----------|----------|----------|-------------------|\n```"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "70f0033cbcb94fb7d29b563c99ebd6b8f7b6b9dd", "author": {"user": {"login": "ChristianMurphy", "name": "Christian Murphy"}}, "url": "https://github.com/openequella/openEQUELLA/commit/70f0033cbcb94fb7d29b563c99ebd6b8f7b6b9dd", "committedDate": "2020-03-07T18:22:56Z", "message": "test: add more util tests and add a mainui test\n\nuse ts-jest to validate typings on typescript tests.\nadd enzyme to add utilities for testing ui components.\nadd tsdoc comments to utils."}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "f0e74668ef39e606e0e6743f224d178815eb91bd", "author": {"user": {"login": "ChristianMurphy", "name": "Christian Murphy"}}, "url": "https://github.com/openequella/openEQUELLA/commit/f0e74668ef39e606e0e6743f224d178815eb91bd", "committedDate": "2020-03-07T18:18:23Z", "message": "test: add more util tests and add a mainui test\n\nuse ts-jest to validate typings on typescript tests.\nadd enzyme to add utilities for testing ui components.\nadd tsdoc comments to utils."}, "afterCommit": {"oid": "70f0033cbcb94fb7d29b563c99ebd6b8f7b6b9dd", "author": {"user": {"login": "ChristianMurphy", "name": "Christian Murphy"}}, "url": "https://github.com/openequella/openEQUELLA/commit/70f0033cbcb94fb7d29b563c99ebd6b8f7b6b9dd", "committedDate": "2020-03-07T18:22:56Z", "message": "test: add more util tests and add a mainui test\n\nuse ts-jest to validate typings on typescript tests.\nadd enzyme to add utilities for testing ui components.\nadd tsdoc comments to utils."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzcwNzgxMjEx", "url": "https://github.com/openequella/openEQUELLA/pull/1529#pullrequestreview-370781211", "createdAt": "2020-03-07T18:23:51Z", "commit": {"oid": "70f0033cbcb94fb7d29b563c99ebd6b8f7b6b9dd"}, "state": "COMMENTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wN1QxODoyMzo1MVrOFzRGig==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wN1QxODoyNTowN1rOFzRGwQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4OTMwMTg5OA==", "bodyText": "open to a better description, it's not entirely clear from the code why this util exists.", "url": "https://github.com/openequella/openEQUELLA/pull/1529#discussion_r389301898", "createdAt": "2020-03-07T18:23:51Z", "author": {"login": "ChristianMurphy"}, "path": "Source/Plugins/Core/com.equella.core/js/tsrc/util/actionutil.test.ts", "diffHunk": "@@ -0,0 +1,38 @@\n+import { actionCreator, wrapAsyncWorker } from \"./actionutil\";\n+\n+describe(\"actionutil\", () => {\n+  describe(\"actionCreator\", () => {\n+    it(\"should return a sync action\", () => {\n+      const actionFactory = actionCreator(\"example\");\n+      expect(typeof actionFactory).toBe(\"function\");\n+      const action = actionFactory();\n+      expect(action).toMatchObject({ type: \"example\", payload: undefined });\n+    });\n+\n+    it(\"should return an async action\", () => {\n+      const actionFactory = actionCreator.async(\"example\");\n+      expect(typeof actionFactory).toBe(\"object\");\n+\n+      const action = actionFactory.started(\"payload\");\n+      expect(action).toMatchObject({\n+        type: \"example_STARTED\",\n+        payload: \"payload\"\n+      });\n+    });\n+  });\n+\n+  describe(\"wrapAsyncWorker\", () => {\n+    it(\"should do something?\", async () => {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "70f0033cbcb94fb7d29b563c99ebd6b8f7b6b9dd"}, "originalPosition": 25}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4OTMwMTk1Mw==", "bodyText": "Note, when material ui styles on the page, use createMount to automatically setup the context providers.\nhttps://material-ui.com/guides/testing/", "url": "https://github.com/openequella/openEQUELLA/pull/1529#discussion_r389301953", "createdAt": "2020-03-07T18:25:07Z", "author": {"login": "ChristianMurphy"}, "path": "Source/Plugins/Core/com.equella.core/js/tsrc/mainui/ErrorPage.test.tsx", "diffHunk": "@@ -0,0 +1,49 @@\n+import * as React from \"react\";\n+import { createMount } from \"@material-ui/core/test-utils\";\n+import ErrorPage from \"./ErrorPage\";\n+\n+jest.mock(\"@material-ui/styles\", () => ({\n+  makeStyles: () => () => ({ errorPage: \"mock-classname\" })\n+}));\n+\n+describe(\"<ErrorPage />\", () => {\n+  let mount: ReturnType<typeof createMount>;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "70f0033cbcb94fb7d29b563c99ebd6b8f7b6b9dd"}, "originalPosition": 10}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzcxNTU0NDcz", "url": "https://github.com/openequella/openEQUELLA/pull/1529#pullrequestreview-371554473", "createdAt": "2020-03-09T21:52:19Z", "commit": {"oid": "70f0033cbcb94fb7d29b563c99ebd6b8f7b6b9dd"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wOVQyMTo1MjoyMFrOFz6pHA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wOVQyMTo1MjoyMFrOFz6pHA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4OTk4MjQ5Mg==", "bodyText": "Nice! We should probably raise a Issue to do that - especially as we move to the New UI in earnest.", "url": "https://github.com/openequella/openEQUELLA/pull/1529#discussion_r389982492", "createdAt": "2020-03-09T21:52:20Z", "author": {"login": "edalex-ian"}, "path": "Source/Plugins/Core/com.equella.core/js/tsrc/util/langstrings.ts", "diffHunk": "@@ -7,8 +7,17 @@ export interface Sizes {\n   one: string;\n   more: string;\n }\n+\n+/**\n+ * Get appropriate language string based off size of value\n+ *\n+ * @param size size or count of value\n+ * @param strings language strings to choose from\n+ *\n+ * TODO: replace with https://github.com/formatjs/react-intl", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "70f0033cbcb94fb7d29b563c99ebd6b8f7b6b9dd"}, "originalPosition": 11}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c650fd3a8cb56e3047864c2ea134bb2bffa1ffa2", "author": {"user": {"login": "ChristianMurphy", "name": "Christian Murphy"}}, "url": "https://github.com/openequella/openEQUELLA/commit/c650fd3a8cb56e3047864c2ea134bb2bffa1ffa2", "committedDate": "2020-03-12T16:17:42Z", "message": "test: refactor use __test__ folder, use describe blocks in versioncheck"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "5a33aa18ae53874f8001b21036c9090aec11faff", "author": {"user": {"login": "ChristianMurphy", "name": "Christian Murphy"}}, "url": "https://github.com/openequella/openEQUELLA/commit/5a33aa18ae53874f8001b21036c9090aec11faff", "committedDate": "2020-03-12T17:30:57Z", "message": "test: migrate version check test to typescript, replace eval with rewire"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzczNzY0MDA0", "url": "https://github.com/openequella/openEQUELLA/pull/1529#pullrequestreview-373764004", "createdAt": "2020-03-12T17:34:32Z", "commit": {"oid": "5a33aa18ae53874f8001b21036c9090aec11faff"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xMlQxNzozNDozMlrOF1ogGw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xMlQxNzozNDozMlrOF1ogGw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MTc4MjQyNw==", "bodyText": "rewire allows access to non-exported variables, without needing to run eval.\nhttps://github.com/jhnns/rewire", "url": "https://github.com/openequella/openEQUELLA/pull/1529#discussion_r391782427", "createdAt": "2020-03-12T17:34:32Z", "author": {"login": "ChristianMurphy"}, "path": "Source/Plugins/Core/com.equella.core/js/__tests__/versioncheck.test.ts", "diffHunk": "@@ -1,12 +1,8 @@\n-// versioncheck.js is not processed by Parcel and it only serves to the browser.\n-// So here need to read the file and then evaluate its content\n-const mockData = require(\"../__mocks__/versioncheck_mock_data\");\n-const fs = require(\"fs\");\n-const version_check_js_file = fs.readFileSync(\n-  \"../resources/web/js/versioncheck.js\",\n-  \"utf8\"\n-);\n-eval(version_check_js_file);\n+import * as mockData from \"../__mocks__/versioncheck_mock_data\";\n+import rewire = require(\"rewire\");\n+\n+const versioncheck = rewire(\"../../resources/web/js/versioncheck.js\");\n+const createCheckResult = versioncheck.__get__(\"createCheckResult\");", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "5a33aa18ae53874f8001b21036c9090aec11faff"}, "originalPosition": 14}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "4b82f0cebfc47cd9f5143a5951c988e9ff799276", "author": {"user": {"login": "ChristianMurphy", "name": "Christian Murphy"}}, "url": "https://github.com/openequella/openEQUELLA/commit/4b82f0cebfc47cd9f5143a5951c988e9ff799276", "committedDate": "2020-03-12T23:06:38Z", "message": "Merge branch 'develop' into test/utils"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzczOTY0OTc4", "url": "https://github.com/openequella/openEQUELLA/pull/1529#pullrequestreview-373964978", "createdAt": "2020-03-12T23:33:34Z", "commit": {"oid": "4b82f0cebfc47cd9f5143a5951c988e9ff799276"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 155, "cost": 1, "resetAt": "2021-11-01T16:19:10Z"}}}