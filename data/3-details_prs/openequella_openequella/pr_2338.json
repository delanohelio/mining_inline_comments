{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDkzODEwNTcy", "number": 2338, "title": "Add lookup functionality to UserQuery rest module, with a few basic tests", "bodyText": "Checklist\n\n\n the contributor license agreement is signed\n commit message follows commit guidelines\n tests are included\n\nDescription of change\n\nAdds oEQ userquery/lookup REST endpoint support to the oeq-ts-rest-api module.\nThis will enable us to lookup oEQ users, groups and roles by id.\nThe primary driver for implementing this is to allow for the new Search page to read in a user id from a query string, and display the correct user details in the OwnerSelector control.", "createdAt": "2020-09-28T01:01:45Z", "url": "https://github.com/openequella/openEQUELLA/pull/2338", "merged": true, "mergeCommit": {"oid": "7f616fce71367358f6b67fc629452f296d4721e2"}, "closed": true, "closedAt": "2020-09-29T04:00:58Z", "author": {"login": "mrblippy"}, "timelineItems": {"totalCount": 8, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdNIfQhAH2gAyNDkzODEwNTcyOmIzYWUxMGI0NWI5MmI3MDBjOGEzY2EwZjU5ODk1MjFjYTJjZmY0NTA=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdNc_6SAFqTQ5Nzk4Mjk1OA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "b3ae10b45b92b700c8a3ca0f5989521ca2cff450", "author": {"user": {"login": "mrblippy", "name": "Nick Charles"}}, "url": "https://github.com/openequella/openEQUELLA/commit/b3ae10b45b92b700c8a3ca0f5989521ca2cff450", "committedDate": "2020-09-28T00:31:38Z", "message": "Add lookup functionality to UserQuery rest module, with a few basic tests"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDk3MTM1MTY4", "url": "https://github.com/openequella/openEQUELLA/pull/2338#pullrequestreview-497135168", "createdAt": "2020-09-28T01:05:16Z", "commit": {"oid": "b3ae10b45b92b700c8a3ca0f5989521ca2cff450"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yOFQwMTowNToxN1rOHYrs4A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yOFQwMTowOTo1NlrOHYrv3Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NTY0Mzg3Mg==", "bodyText": "No need to put the type info in the comment. So this (and the below three) can be:\n\n  \n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n              /** String array of User IDs to lookup. */\n          \n          \n            \n              /** User IDs to lookup. */\n          \n      \n    \n    \n  \n\nOr if you want more, keep it abstract:\n\n  \n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n              /** String array of User IDs to lookup. */\n          \n          \n            \n              /** List of User IDs to lookup. */", "url": "https://github.com/openequella/openEQUELLA/pull/2338#discussion_r495643872", "createdAt": "2020-09-28T01:05:17Z", "author": {"login": "edalex-ian"}, "path": "oeq-ts-rest-api/src/UserQuery.ts", "diffHunk": "@@ -61,6 +61,15 @@ export interface SearchParams {\n   users: boolean;\n }\n \n+export interface LookupParams {\n+  /** String array of User IDs to lookup. */", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b3ae10b45b92b700c8a3ca0f5989521ca2cff450"}, "originalPosition": 14}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NTY0NDM0OQ==", "bodyText": "Be good to highlight in this description how this is different from search().", "url": "https://github.com/openequella/openEQUELLA/pull/2338#discussion_r495644349", "createdAt": "2020-09-28T01:08:09Z", "author": {"login": "edalex-ian"}, "path": "oeq-ts-rest-api/src/UserQuery.ts", "diffHunk": "@@ -81,3 +90,18 @@ export const search = (\n     isSearchResult,\n     params\n   );\n+\n+/**\n+ * Lookup for users and related entities (i.e. groups and roles).", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b3ae10b45b92b700c8a3ca0f5989521ca2cff450"}, "originalPosition": 31}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NTY0NDU0NA==", "bodyText": "Please include support for a validator here (like in GET).", "url": "https://github.com/openequella/openEQUELLA/pull/2338#discussion_r495644544", "createdAt": "2020-09-28T01:09:25Z", "author": {"login": "edalex-ian"}, "path": "oeq-ts-rest-api/src/AxiosInstance.ts", "diffHunk": "@@ -68,4 +68,10 @@ export const PUT = <T, R>(path: string, data?: T): Promise<R> =>\n     .then((response: AxiosResponse<R>) => response.data)\n     .catch(catchHandler);\n \n+export const POST = <T, R>(path: string, data?: T): Promise<R> =>", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b3ae10b45b92b700c8a3ca0f5989521ca2cff450"}, "originalPosition": 4}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NTY0NDYzNw==", "bodyText": "Once you add support for a validator to POST, you want to add that in here too.", "url": "https://github.com/openequella/openEQUELLA/pull/2338#discussion_r495644637", "createdAt": "2020-09-28T01:09:56Z", "author": {"login": "edalex-ian"}, "path": "oeq-ts-rest-api/src/UserQuery.ts", "diffHunk": "@@ -81,3 +90,18 @@ export const search = (\n     isSearchResult,\n     params\n   );\n+\n+/**\n+ * Lookup for users and related entities (i.e. groups and roles).\n+ *\n+ * @param apiBasePath Base URI to the oEQ institution and API\n+ * @param params Query parameters to customize result\n+ */\n+export const lookup = (\n+  apiBasePath: string,\n+  params: LookupParams\n+): Promise<SearchResult> =>\n+  POST<LookupParams, SearchResult>(\n+    apiBasePath + USERQUERY_ROOT_PATH + '/lookup',\n+    params\n+  );", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b3ae10b45b92b700c8a3ca0f5989521ca2cff450"}, "originalPosition": 43}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "6c784aaf947c9c7f2cc6a517652a3367273059f1", "author": {"user": {"login": "mrblippy", "name": "Nick Charles"}}, "url": "https://github.com/openequella/openEQUELLA/commit/6c784aaf947c9c7f2cc6a517652a3367273059f1", "committedDate": "2020-09-28T03:26:45Z", "message": "Add validator to axios POST function"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "91c576e2830e2a48909d8a1a779a5ab078911ce5", "author": {"user": {"login": "mrblippy", "name": "Nick Charles"}}, "url": "https://github.com/openequella/openEQUELLA/commit/91c576e2830e2a48909d8a1a779a5ab078911ce5", "committedDate": "2020-09-28T03:37:30Z", "message": "Tidy up comments for UserQuery lookup"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDk3MTczNzA4", "url": "https://github.com/openequella/openEQUELLA/pull/2338#pullrequestreview-497173708", "createdAt": "2020-09-28T04:03:16Z", "commit": {"oid": "91c576e2830e2a48909d8a1a779a5ab078911ce5"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDk3MTc5MjQ0", "url": "https://github.com/openequella/openEQUELLA/pull/2338#pullrequestreview-497179244", "createdAt": "2020-09-28T04:28:23Z", "commit": {"oid": "91c576e2830e2a48909d8a1a779a5ab078911ce5"}, "state": "APPROVED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yOFQwNDoyODoyM1rOHYuGJQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yOFQwNDoyODoyM1rOHYuGJQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NTY4MzEwOQ==", "bodyText": "Do we know that the AxiosResponse contains R yet?\nI though that is what validator on line 87 is for?\nmight it be unknown at this point in time?\n\n  \n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                .then((response: AxiosResponse<R>) => {\n          \n          \n            \n                .then((response: AxiosResponse<unknown>) => {", "url": "https://github.com/openequella/openEQUELLA/pull/2338#discussion_r495683109", "createdAt": "2020-09-28T04:28:23Z", "author": {"login": "ChristianMurphy"}, "path": "oeq-ts-rest-api/src/AxiosInstance.ts", "diffHunk": "@@ -68,4 +68,29 @@ export const PUT = <T, R>(path: string, data?: T): Promise<R> =>\n     .then((response: AxiosResponse<R>) => response.data)\n     .catch(catchHandler);\n \n+/**\n+ * Executes a HTTP POST for a given path.\n+ *\n+ * @param path The URL path for the target POST\n+ * @param validator A function to perform runtime type checking against the result - typically with typescript-is\n+ * @param data The data to be sent in POST request\n+ */\n+export const POST = <T, R>(\n+  path: string,\n+  validator: (data: unknown) => data is R,\n+  data?: T\n+): Promise<R> =>\n+  axios\n+    .post(path, data)\n+    .then((response: AxiosResponse<R>) => {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "91c576e2830e2a48909d8a1a779a5ab078911ce5"}, "originalPosition": 18}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "dd9a4be5855e4ecc1603ad1de500e07f687d6a26", "author": {"user": {"login": "mrblippy", "name": "Nick Charles"}}, "url": "https://github.com/openequella/openEQUELLA/commit/dd9a4be5855e4ecc1603ad1de500e07f687d6a26", "committedDate": "2020-09-28T05:21:16Z", "message": "Change AxiosResponse to unknown type, we won't know the type until the validator does its thing"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDk3OTgyOTU4", "url": "https://github.com/openequella/openEQUELLA/pull/2338#pullrequestreview-497982958", "createdAt": "2020-09-29T00:25:24Z", "commit": {"oid": "dd9a4be5855e4ecc1603ad1de500e07f687d6a26"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 484, "cost": 1, "resetAt": "2021-11-01T16:19:10Z"}}}