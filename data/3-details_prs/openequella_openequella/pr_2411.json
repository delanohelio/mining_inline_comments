{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTAzODU0MjUz", "number": 2411, "title": "Feature/view attachments", "bodyText": "Checklist\n\n\n the contributor license agreement is signed\n commit message follows commit guidelines\n tests are included\n screenshots are included showing significant UI changes\n\nDescription of change\n\nThis PR adds support to the New Search UI to handle viewing attachments when you click on them in the search results. It was envisaged as just a little UI work, but turned into a whole lot more due to the various viewers etc which you can configure based on MIME type. (This is also the continuation of work started in #2339 and #2345.)\nThere is still more work which should be done to match the Legacy UI, and possibly also some responsive UI improvements. But the PR was getting a bit long, so I thought it best to draw a line in the sand.\nIt includes a simple Lightbox component, (which ideally should have been in its own PR). Tests for this are primarily visual via the Storybook stories.\nThe basic flow of the new bits are:\n\nSearchResultList (existing)\nSearchResult (existing) - uses the new MimeTypesModule and ViewerModule\nItemAttachmentLink receives configuration from above\nLightbox is used if it's determined that's what should be used for the specified attachment type\n\nSearchResultList was slightly refactored to work in a more component composition way when it came to the SearchResult components. This was highlighted when attempting to write tests and easily inject different methods to retrieve MIME type configuration and the like.\nThere's a few different things in this, so a movie instead of screenshots (30 days expiry): https://streamable.com/o1o2ny", "createdAt": "2020-10-15T06:15:10Z", "url": "https://github.com/openequella/openEQUELLA/pull/2411", "merged": true, "mergeCommit": {"oid": "2dfb96d00de7b0a337d36b6a2f5dd6f5e6403eb3"}, "closed": true, "closedAt": "2020-10-21T03:18:04Z", "author": {"login": "edalex-ian"}, "timelineItems": {"totalCount": 27, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdSo7s0gH2gAyNTAzODU0MjUzOmJiNjFjODUzYWJjZTIwNDNjMzU4NmQ1Y2RiNTBmYzBkYjA0OTY4YzI=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdUj0ehgFqTUxMzI1OTcxNw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "bb61c853abce2043c3586d5cdb50fc0db04968c2", "author": {"user": {"login": "edalex-ian", "name": null}}, "url": "https://github.com/openequella/openEQUELLA/commit/bb61c853abce2043c3586d5cdb50fc0db04968c2", "committedDate": "2020-10-15T03:09:17Z", "message": "feat(front-end): Establish new MimeTypesModule\n\nIncluded refactoring method from SearchFilterSettingsModule.ts while also addressing a minor typo in function name for validateMimeTypeName."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "dfa461d9ca3349ce9b461328e0c764e6d505cfe3", "author": {"user": {"login": "edalex-ian", "name": null}}, "url": "https://github.com/openequella/openEQUELLA/commit/dfa461d9ca3349ce9b461328e0c764e6d505cfe3", "committedDate": "2020-10-15T03:09:17Z", "message": "chore(oeq-ts-rest-api): Add viewer type \"save\""}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ca4f24834aad12bd35bd09fdca7704be615a2f9f", "author": {"user": {"login": "edalex-ian", "name": null}}, "url": "https://github.com/openequella/openEQUELLA/commit/ca4f24834aad12bd35bd09fdca7704be615a2f9f", "committedDate": "2020-10-15T03:09:17Z", "message": "feat(front-end): Add a Lightbox component"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "9e9a06f3c038f6d7de077b24b74c693ba37e089c", "author": {"user": {"login": "edalex-ian", "name": null}}, "url": "https://github.com/openequella/openEQUELLA/commit/9e9a06f3c038f6d7de077b24b74c693ba37e089c", "committedDate": "2020-10-15T03:09:17Z", "message": "feat(front-end): Make Lightbox title param optional"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "2f5df93cb4e548486c8d5e83de5547885aaf4c0a", "author": {"user": {"login": "edalex-ian", "name": null}}, "url": "https://github.com/openequella/openEQUELLA/commit/2f5df93cb4e548486c8d5e83de5547885aaf4c0a", "committedDate": "2020-10-15T03:09:17Z", "message": "feat(front-end): Add support to MimeTypesModule for retrieving viewer configurations"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "3d74bf3d3f7e83927f1901461d9a5f5afe96df8a", "author": {"user": {"login": "edalex-ian", "name": null}}, "url": "https://github.com/openequella/openEQUELLA/commit/3d74bf3d3f7e83927f1901461d9a5f5afe96df8a", "committedDate": "2020-10-15T03:09:17Z", "message": "chore(front-end): Use more relevant attachment description"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "bff171056ac8c7f48c78678cc19ef736b1f2ea34", "author": {"user": {"login": "edalex-ian", "name": null}}, "url": "https://github.com/openequella/openEQUELLA/commit/bff171056ac8c7f48c78678cc19ef736b1f2ea34", "committedDate": "2020-10-15T03:09:17Z", "message": "feat(front-end): Create new ViewerModule to assist with determining viewer"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ebb606dac760fc67b9141a7bddcb3e1b79324f53", "author": {"user": {"login": "edalex-ian", "name": null}}, "url": "https://github.com/openequella/openEQUELLA/commit/ebb606dac760fc67b9141a7bddcb3e1b79324f53", "committedDate": "2020-10-15T03:09:17Z", "message": "feat(front-end): Create new ItemAttachmentLink for linking to attachments / viewer"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "944ffc5e5b1c5c7deec0b6a0e3fe932c45c3a105", "author": {"user": {"login": "edalex-ian", "name": null}}, "url": "https://github.com/openequella/openEQUELLA/commit/944ffc5e5b1c5c7deec0b6a0e3fe932c45c3a105", "committedDate": "2020-10-15T03:09:17Z", "message": "feat(front-end): Integrate ItemAttachmentLink for linking to attachments / viewer"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "0819a7557660953f9a3b03e5631a209af34a7d6b", "author": {"user": {"login": "edalex-ian", "name": null}}, "url": "https://github.com/openequella/openEQUELLA/commit/0819a7557660953f9a3b03e5631a209af34a7d6b", "committedDate": "2020-10-15T03:09:17Z", "message": "chore(front-end): Tidy-up and document MIME type validator regex"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b458cc0ef0ca739faa6b2d5510016828e5cc0ed3", "author": {"user": {"login": "edalex-ian", "name": null}}, "url": "https://github.com/openequella/openEQUELLA/commit/b458cc0ef0ca739faa6b2d5510016828e5cc0ed3", "committedDate": "2020-10-15T03:09:17Z", "message": "chore(front-end): Support optional attachments SearchResult.test.tsx"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c4dee709dbdba69e1235fc4adaa50f2a127fe020", "author": {"user": {"login": "edalex-ian", "name": null}}, "url": "https://github.com/openequella/openEQUELLA/commit/c4dee709dbdba69e1235fc4adaa50f2a127fe020", "committedDate": "2020-10-15T05:41:05Z", "message": "fix(front-end): Properly handle when there are _no_ attachments\n\nWhen there we no attachments the SearchResult was getting in an infinite loop of state updates. Although it was happy when with an empty collection ([]), for some reason (even though there is a default param to []) when it 'attachments' was undefined, things spiraled out of control.\n\nThis is the case when a user has insufficient privileges to see attachments - and then the property is omitted from the search2 response."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTA5OTk0MzU0", "url": "https://github.com/openequella/openEQUELLA/pull/2411#pullrequestreview-509994354", "createdAt": "2020-10-16T03:57:53Z", "commit": {"oid": "bb61c853abce2043c3586d5cdb50fc0db04968c2"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xNlQwMzo1Nzo1NFrOHimADQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xNlQwMzo1Nzo1NFrOHimADQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNjAzNjIzNw==", "bodyText": "What about giving an example for this regex ?", "url": "https://github.com/openequella/openEQUELLA/pull/2411#discussion_r506036237", "createdAt": "2020-10-16T03:57:54Z", "author": {"login": "PenghaiZhang"}, "path": "Source/Plugins/Core/com.equella.core/js/tsrc/modules/MimeTypesModule.ts", "diffHunk": "@@ -0,0 +1,68 @@\n+/*\n+ * Licensed to The Apereo Foundation under one or more contributor license\n+ * agreements. See the NOTICE file distributed with this work for additional\n+ * information regarding copyright ownership.\n+ *\n+ * The Apereo Foundation licenses this file to you under the Apache License,\n+ * Version 2.0, (the \"License\"); you may not use this file except in compliance\n+ * with the License. You may obtain a copy of the License at:\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+import * as OEQ from \"@openequella/rest-api-client\";\n+import { API_BASE_URL } from \"../config\";\n+\n+export const getMIMETypesFromServer = (): Promise<\n+  OEQ.MimeType.MimeTypeEntry[]\n+> => OEQ.MimeType.listMimeTypes(API_BASE_URL);\n+\n+/**\n+ * Given a MIME Type of the form `<type>/<sub-type>`, validate correct form and then return\n+ * `type` and `sub-type` in a tuple. `sub-type` will actually also include any attributes, etc. as\n+ * that's all we need for now (i.e. we're not so interested in sub-types yet).\n+ *\n+ * @param mimeType a MIME type of the form `<type>/<sub-type>`\n+ */\n+export const splitMimeType = (mimeType: string): [string, string] => {\n+  const validMimeTypeRegex = /^\\w+\\/[+.=; \\w\\-]+$/i;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "bb61c853abce2043c3586d5cdb50fc0db04968c2"}, "originalPosition": 33}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTEwMDAzNjM4", "url": "https://github.com/openequella/openEQUELLA/pull/2411#pullrequestreview-510003638", "createdAt": "2020-10-16T04:20:12Z", "commit": {"oid": "c4dee709dbdba69e1235fc4adaa50f2a127fe020"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xNlQwNDoyMDoxMlrOHimZsQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xNlQwNDoyMDoxMlrOHimZsQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNjA0MjgwMQ==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n               * Content to be surrounded byt he link.\n          \n          \n            \n               * Content to be surrounded by the link.", "url": "https://github.com/openequella/openEQUELLA/pull/2411#discussion_r506042801", "createdAt": "2020-10-16T04:20:12Z", "author": {"login": "PenghaiZhang"}, "path": "Source/Plugins/Core/com.equella.core/js/tsrc/components/ItemAttachmentLink.tsx", "diffHunk": "@@ -0,0 +1,99 @@\n+/*\n+ * Licensed to The Apereo Foundation under one or more contributor license\n+ * agreements. See the NOTICE file distributed with this work for additional\n+ * information regarding copyright ownership.\n+ *\n+ * The Apereo Foundation licenses this file to you under the Apache License,\n+ * Version 2.0, (the \"License\"); you may not use this file except in compliance\n+ * with the License. You may obtain a copy of the License at:\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+import * as React from \"react\";\n+import { SyntheticEvent, useState } from \"react\";\n+import { ViewerDefinition } from \"../modules/ViewerModule\";\n+import Lightbox from \"./Lightbox\";\n+\n+export interface ItemAttachmentLinkProps {\n+  /**\n+   * Content to be surrounded byt he link.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c4dee709dbdba69e1235fc4adaa50f2a127fe020"}, "originalPosition": 25}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTA5OTczMjQ3", "url": "https://github.com/openequella/openEQUELLA/pull/2411#pullrequestreview-509973247", "createdAt": "2020-10-16T02:39:34Z", "commit": {"oid": "c4dee709dbdba69e1235fc4adaa50f2a127fe020"}, "state": "COMMENTED", "comments": {"totalCount": 12, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xNlQwMjo0MTo0MFrOHij6TA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xNlQwNDo0Mjo0MVrOHimucA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNjAwMTk5Ng==", "bodyText": "We are getting eslint warnings for it blocks starting on 249, 254 and 261 - (it wouldn't let me select these as comment targets as they aren't part of the diff).\n\"Test has no assertions\". Now obviously it does, but they are within the expectSearchItemsCalledWithStatus(liveStatuses) function.\nI wonder if there's any way to get eslint to be happy with that. Perhaps getting it to fit within a standard expect call?\nAlong the lines of: expect(SearchItemsCalledWithStatus(liveStatuses)).toBeTruthy();\nJust a thought - I know this was unchanged within this PR, this review simply highlighted it to me. Feel free to ignore.", "url": "https://github.com/openequella/openEQUELLA/pull/2411#discussion_r506001996", "createdAt": "2020-10-16T02:41:40Z", "author": {"login": "SammyIsConfused"}, "path": "Source/Plugins/Core/com.equella.core/js/__tests__/tsrc/search/SearchPage.test.tsx", "diffHunk": "@@ -85,6 +86,13 @@ mockCollections.mockResolvedValue(getCollectionMap);\n mockListUsers.mockResolvedValue(UserSearchMock.users);\n mockListClassification.mockResolvedValue(CategorySelectorMock.classifications);\n \n+// Mock out a collaborator of SearchResult\n+jest\n+  .spyOn(MimeTypesModule, \"getMimeTypeDefaultViewerDetails\")\n+  .mockResolvedValue({\n+    viewerId: \"fancy\",\n+  } as OEQ.MimeType.MimeTypeViewerDetail);\n+", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c4dee709dbdba69e1235fc4adaa50f2a127fe020"}, "originalPosition": 18}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNjAwMzA4NQ==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n               * Content to be surrounded byt he link.\n          \n          \n            \n               * Content to be surrounded by the link.", "url": "https://github.com/openequella/openEQUELLA/pull/2411#discussion_r506003085", "createdAt": "2020-10-16T02:43:34Z", "author": {"login": "SammyIsConfused"}, "path": "Source/Plugins/Core/com.equella.core/js/tsrc/components/ItemAttachmentLink.tsx", "diffHunk": "@@ -0,0 +1,99 @@\n+/*\n+ * Licensed to The Apereo Foundation under one or more contributor license\n+ * agreements. See the NOTICE file distributed with this work for additional\n+ * information regarding copyright ownership.\n+ *\n+ * The Apereo Foundation licenses this file to you under the Apache License,\n+ * Version 2.0, (the \"License\"); you may not use this file except in compliance\n+ * with the License. You may obtain a copy of the License at:\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+import * as React from \"react\";\n+import { SyntheticEvent, useState } from \"react\";\n+import { ViewerDefinition } from \"../modules/ViewerModule\";\n+import Lightbox from \"./Lightbox\";\n+\n+export interface ItemAttachmentLinkProps {\n+  /**\n+   * Content to be surrounded byt he link.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c4dee709dbdba69e1235fc4adaa50f2a127fe020"}, "originalPosition": 25}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNjAwNDk3MQ==", "bodyText": "These two comments seem a little strange to me - it makes it seem like Lightbox is an example of what could be in the variable rather than an example of a type of viewer.\nPerhaps worth omitting the e.g. Lightbox., or rewording?", "url": "https://github.com/openequella/openEQUELLA/pull/2411#discussion_r506004971", "createdAt": "2020-10-16T02:46:57Z", "author": {"login": "SammyIsConfused"}, "path": "Source/Plugins/Core/com.equella.core/js/tsrc/components/ItemAttachmentLink.tsx", "diffHunk": "@@ -0,0 +1,99 @@\n+/*\n+ * Licensed to The Apereo Foundation under one or more contributor license\n+ * agreements. See the NOTICE file distributed with this work for additional\n+ * information regarding copyright ownership.\n+ *\n+ * The Apereo Foundation licenses this file to you under the Apache License,\n+ * Version 2.0, (the \"License\"); you may not use this file except in compliance\n+ * with the License. You may obtain a copy of the License at:\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+import * as React from \"react\";\n+import { SyntheticEvent, useState } from \"react\";\n+import { ViewerDefinition } from \"../modules/ViewerModule\";\n+import Lightbox from \"./Lightbox\";\n+\n+export interface ItemAttachmentLinkProps {\n+  /**\n+   * Content to be surrounded byt he link.\n+   */\n+  children: React.ReactNode;\n+  /**\n+   * Optional description that will be passed to chosen viewer - e.g. Lightbox.\n+   */\n+  description?: string;\n+  /**\n+   * Optional mimeType that will be passed to chosen viewer - e.g. Lightbox.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c4dee709dbdba69e1235fc4adaa50f2a127fe020"}, "originalPosition": 33}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNjAwNTM1MQ==", "bodyText": "Since we are using React, you can safely use ReactElement rather than JSX.Element.", "url": "https://github.com/openequella/openEQUELLA/pull/2411#discussion_r506005351", "createdAt": "2020-10-16T02:47:33Z", "author": {"login": "SammyIsConfused"}, "path": "Source/Plugins/Core/com.equella.core/js/tsrc/components/ItemAttachmentLink.tsx", "diffHunk": "@@ -0,0 +1,99 @@\n+/*\n+ * Licensed to The Apereo Foundation under one or more contributor license\n+ * agreements. See the NOTICE file distributed with this work for additional\n+ * information regarding copyright ownership.\n+ *\n+ * The Apereo Foundation licenses this file to you under the Apache License,\n+ * Version 2.0, (the \"License\"); you may not use this file except in compliance\n+ * with the License. You may obtain a copy of the License at:\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+import * as React from \"react\";\n+import { SyntheticEvent, useState } from \"react\";\n+import { ViewerDefinition } from \"../modules/ViewerModule\";\n+import Lightbox from \"./Lightbox\";\n+\n+export interface ItemAttachmentLinkProps {\n+  /**\n+   * Content to be surrounded byt he link.\n+   */\n+  children: React.ReactNode;\n+  /**\n+   * Optional description that will be passed to chosen viewer - e.g. Lightbox.\n+   */\n+  description?: string;\n+  /**\n+   * Optional mimeType that will be passed to chosen viewer - e.g. Lightbox.\n+   */\n+  mimeType?: string;\n+  /**\n+   * Viewer details for the attachment this link is pointing to. Controls which viewer is triggered\n+   * when the link is clicked.\n+   */\n+  viewerDetails: ViewerDefinition;\n+}\n+\n+/**\n+ * A component to be used for viewing attachments in a uniform manner.\n+ */\n+const ItemAttachmentLink = ({\n+  children,\n+  description,\n+  mimeType,\n+  viewerDetails: [viewer, url],\n+}: ItemAttachmentLinkProps) => {\n+  const [showLightbox, setShowLightbox] = useState<boolean>(false);\n+\n+  let link: JSX.Element = (", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c4dee709dbdba69e1235fc4adaa50f2a127fe020"}, "originalPosition": 54}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNjAwODIzMQ==", "bodyText": "Got a feeling the linter might be unhappy with this - I seem to remember there being an rule regarding  tags without a valid href being a no-no.\nPerhaps its just that if there is a href, it must be a valid one? If so, not including one might be alright.", "url": "https://github.com/openequella/openEQUELLA/pull/2411#discussion_r506008231", "createdAt": "2020-10-16T02:52:15Z", "author": {"login": "SammyIsConfused"}, "path": "Source/Plugins/Core/com.equella.core/js/tsrc/components/ItemAttachmentLink.tsx", "diffHunk": "@@ -0,0 +1,99 @@\n+/*\n+ * Licensed to The Apereo Foundation under one or more contributor license\n+ * agreements. See the NOTICE file distributed with this work for additional\n+ * information regarding copyright ownership.\n+ *\n+ * The Apereo Foundation licenses this file to you under the Apache License,\n+ * Version 2.0, (the \"License\"); you may not use this file except in compliance\n+ * with the License. You may obtain a copy of the License at:\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+import * as React from \"react\";\n+import { SyntheticEvent, useState } from \"react\";\n+import { ViewerDefinition } from \"../modules/ViewerModule\";\n+import Lightbox from \"./Lightbox\";\n+\n+export interface ItemAttachmentLinkProps {\n+  /**\n+   * Content to be surrounded byt he link.\n+   */\n+  children: React.ReactNode;\n+  /**\n+   * Optional description that will be passed to chosen viewer - e.g. Lightbox.\n+   */\n+  description?: string;\n+  /**\n+   * Optional mimeType that will be passed to chosen viewer - e.g. Lightbox.\n+   */\n+  mimeType?: string;\n+  /**\n+   * Viewer details for the attachment this link is pointing to. Controls which viewer is triggered\n+   * when the link is clicked.\n+   */\n+  viewerDetails: ViewerDefinition;\n+}\n+\n+/**\n+ * A component to be used for viewing attachments in a uniform manner.\n+ */\n+const ItemAttachmentLink = ({\n+  children,\n+  description,\n+  mimeType,\n+  viewerDetails: [viewer, url],\n+}: ItemAttachmentLinkProps) => {\n+  const [showLightbox, setShowLightbox] = useState<boolean>(false);\n+\n+  let link: JSX.Element = (\n+    <a href={url} target=\"_blank\" rel=\"noreferrer\">\n+      {children}\n+    </a>\n+  );\n+  switch (viewer) {\n+    case \"lightbox\":\n+      if (!mimeType) {\n+        throw new Error(\n+          \"'mimeType' must be specified when viewer is 'lightbox'.\"\n+        );\n+      }\n+      link = (\n+        <>\n+          <a", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c4dee709dbdba69e1235fc4adaa50f2a127fe020"}, "originalPosition": 68}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNjAwODQxNQ==", "bodyText": "Language string here? Or do we not do those for error strings?", "url": "https://github.com/openequella/openEQUELLA/pull/2411#discussion_r506008415", "createdAt": "2020-10-16T02:52:42Z", "author": {"login": "SammyIsConfused"}, "path": "Source/Plugins/Core/com.equella.core/js/tsrc/components/ItemAttachmentLink.tsx", "diffHunk": "@@ -0,0 +1,99 @@\n+/*\n+ * Licensed to The Apereo Foundation under one or more contributor license\n+ * agreements. See the NOTICE file distributed with this work for additional\n+ * information regarding copyright ownership.\n+ *\n+ * The Apereo Foundation licenses this file to you under the Apache License,\n+ * Version 2.0, (the \"License\"); you may not use this file except in compliance\n+ * with the License. You may obtain a copy of the License at:\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+import * as React from \"react\";\n+import { SyntheticEvent, useState } from \"react\";\n+import { ViewerDefinition } from \"../modules/ViewerModule\";\n+import Lightbox from \"./Lightbox\";\n+\n+export interface ItemAttachmentLinkProps {\n+  /**\n+   * Content to be surrounded byt he link.\n+   */\n+  children: React.ReactNode;\n+  /**\n+   * Optional description that will be passed to chosen viewer - e.g. Lightbox.\n+   */\n+  description?: string;\n+  /**\n+   * Optional mimeType that will be passed to chosen viewer - e.g. Lightbox.\n+   */\n+  mimeType?: string;\n+  /**\n+   * Viewer details for the attachment this link is pointing to. Controls which viewer is triggered\n+   * when the link is clicked.\n+   */\n+  viewerDetails: ViewerDefinition;\n+}\n+\n+/**\n+ * A component to be used for viewing attachments in a uniform manner.\n+ */\n+const ItemAttachmentLink = ({\n+  children,\n+  description,\n+  mimeType,\n+  viewerDetails: [viewer, url],\n+}: ItemAttachmentLinkProps) => {\n+  const [showLightbox, setShowLightbox] = useState<boolean>(false);\n+\n+  let link: JSX.Element = (\n+    <a href={url} target=\"_blank\" rel=\"noreferrer\">\n+      {children}\n+    </a>\n+  );\n+  switch (viewer) {\n+    case \"lightbox\":\n+      if (!mimeType) {\n+        throw new Error(\n+          \"'mimeType' must be specified when viewer is 'lightbox'.\"", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c4dee709dbdba69e1235fc4adaa50f2a127fe020"}, "originalPosition": 63}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNjAwOTIwOA==", "bodyText": "So these colours will be hardcoded, as opposed to derived from the theme?", "url": "https://github.com/openequella/openEQUELLA/pull/2411#discussion_r506009208", "createdAt": "2020-10-16T02:54:26Z", "author": {"login": "SammyIsConfused"}, "path": "Source/Plugins/Core/com.equella.core/js/tsrc/components/Lightbox.tsx", "diffHunk": "@@ -0,0 +1,199 @@\n+/*\n+ * Licensed to The Apereo Foundation under one or more contributor license\n+ * agreements. See the NOTICE file distributed with this work for additional\n+ * information regarding copyright ownership.\n+ *\n+ * The Apereo Foundation licenses this file to you under the Apache License,\n+ * Version 2.0, (the \"License\"); you may not use this file except in compliance\n+ * with the License. You may obtain a copy of the License at:\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+import {\n+  Backdrop,\n+  Card,\n+  CardContent,\n+  IconButton,\n+  Theme,\n+  Toolbar,\n+  Typography,\n+} from \"@material-ui/core\";\n+import { makeStyles } from \"@material-ui/core/styles\";\n+import CloseIcon from \"@material-ui/icons/Close\";\n+import OpenInNewIcon from \"@material-ui/icons/OpenInNew\";\n+import * as React from \"react\";\n+import { SyntheticEvent } from \"react\";\n+import {\n+  isBrowserSupportedAudio,\n+  isBrowserSupportedVideo,\n+  splitMimeType,\n+} from \"../modules/MimeTypesModule\";\n+import { languageStrings } from \"../util/langstrings\";\n+\n+const useStyles = makeStyles((theme: Theme) => ({\n+  lightboxBackdrop: {\n+    backgroundColor: \"#000000cc\",\n+    cursor: \"default\", // Replace the backdrop 'pointer' style\n+    zIndex: theme.zIndex.drawer + 1,\n+  },\n+  lightboxAudio: {\n+    minWidth: 200,\n+    width: \"60vw\",\n+  },\n+  lightboxContent: {\n+    maxWidth: \"80vw\",\n+    maxHeight: \"80vh\",\n+  },\n+  lightboxImage: {\n+    minWidth: 100,\n+    minHeight: 100,\n+  },\n+  menuButton: {\n+    color: \"inherit\",\n+    \"&:hover\": {\n+      background: \"#505050\",\n+    },\n+  },\n+  title: {\n+    flexGrow: 1,\n+  },\n+  toolbar: {\n+    backgroundColor: \"#0a0a0a\",", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c4dee709dbdba69e1235fc4adaa50f2a127fe020"}, "originalPosition": 67}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNjAxMDE0MQ==", "bodyText": "This is strange. I have never seen both variant and component set like this.\nIf you omit component here, would it still look the same? I'm pretty sure elsewhere we have h5s that in the html are h2s that didn't get set by the component.", "url": "https://github.com/openequella/openEQUELLA/pull/2411#discussion_r506010141", "createdAt": "2020-10-16T02:56:15Z", "author": {"login": "SammyIsConfused"}, "path": "Source/Plugins/Core/com.equella.core/js/tsrc/components/Lightbox.tsx", "diffHunk": "@@ -0,0 +1,199 @@\n+/*\n+ * Licensed to The Apereo Foundation under one or more contributor license\n+ * agreements. See the NOTICE file distributed with this work for additional\n+ * information regarding copyright ownership.\n+ *\n+ * The Apereo Foundation licenses this file to you under the Apache License,\n+ * Version 2.0, (the \"License\"); you may not use this file except in compliance\n+ * with the License. You may obtain a copy of the License at:\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+import {\n+  Backdrop,\n+  Card,\n+  CardContent,\n+  IconButton,\n+  Theme,\n+  Toolbar,\n+  Typography,\n+} from \"@material-ui/core\";\n+import { makeStyles } from \"@material-ui/core/styles\";\n+import CloseIcon from \"@material-ui/icons/Close\";\n+import OpenInNewIcon from \"@material-ui/icons/OpenInNew\";\n+import * as React from \"react\";\n+import { SyntheticEvent } from \"react\";\n+import {\n+  isBrowserSupportedAudio,\n+  isBrowserSupportedVideo,\n+  splitMimeType,\n+} from \"../modules/MimeTypesModule\";\n+import { languageStrings } from \"../util/langstrings\";\n+\n+const useStyles = makeStyles((theme: Theme) => ({\n+  lightboxBackdrop: {\n+    backgroundColor: \"#000000cc\",\n+    cursor: \"default\", // Replace the backdrop 'pointer' style\n+    zIndex: theme.zIndex.drawer + 1,\n+  },\n+  lightboxAudio: {\n+    minWidth: 200,\n+    width: \"60vw\",\n+  },\n+  lightboxContent: {\n+    maxWidth: \"80vw\",\n+    maxHeight: \"80vh\",\n+  },\n+  lightboxImage: {\n+    minWidth: 100,\n+    minHeight: 100,\n+  },\n+  menuButton: {\n+    color: \"inherit\",\n+    \"&:hover\": {\n+      background: \"#505050\",\n+    },\n+  },\n+  title: {\n+    flexGrow: 1,\n+  },\n+  toolbar: {\n+    backgroundColor: \"#0a0a0a\",\n+    color: \"#fafafa\",\n+    position: \"absolute\",\n+    top: 0,\n+    width: \"100%\",\n+  },\n+}));\n+\n+export interface LightboxProps {\n+  /** MIME type of the items specified by `src` */\n+  mimeType: string;\n+  /** Function to call when the Lightbox is closing. */\n+  onClose: () => void;\n+  /** Control whether to hide (`false`) or show (`true`) the Lightbox. */\n+  open: boolean;\n+  /** URL for the item to display in the Lightbox. */\n+  src: string;\n+  /** Title to display at the top of the Lightbox. */\n+  title?: string;\n+}\n+\n+const Lightbox = ({ mimeType, onClose, open, src, title }: LightboxProps) => {\n+  const classes = useStyles();\n+  const {\n+    close: labelClose,\n+    openInNewWindow: labelOpenInNewWindow,\n+  } = languageStrings.common.action;\n+  const {\n+    unsupportedContent: labelUnsupportedContent,\n+  } = languageStrings.lightboxComponent;\n+\n+  let content = (\n+    <Card>\n+      <CardContent>\n+        <Typography variant=\"h5\" component=\"h2\">", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c4dee709dbdba69e1235fc4adaa50f2a127fe020"}, "originalPosition": 101}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNjAxMTg4MQ==", "bodyText": "Really like this. Regex definitions can be so opaque and hard to come back to.", "url": "https://github.com/openequella/openEQUELLA/pull/2411#discussion_r506011881", "createdAt": "2020-10-16T02:59:21Z", "author": {"login": "SammyIsConfused"}, "path": "Source/Plugins/Core/com.equella.core/js/tsrc/modules/MimeTypesModule.ts", "diffHunk": "@@ -0,0 +1,111 @@\n+/*\n+ * Licensed to The Apereo Foundation under one or more contributor license\n+ * agreements. See the NOTICE file distributed with this work for additional\n+ * information regarding copyright ownership.\n+ *\n+ * The Apereo Foundation licenses this file to you under the Apache License,\n+ * Version 2.0, (the \"License\"); you may not use this file except in compliance\n+ * with the License. You may obtain a copy of the License at:\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+import * as OEQ from \"@openequella/rest-api-client\";\n+import { memoize } from \"lodash\";\n+import { API_BASE_URL } from \"../config\";\n+\n+export const getMIMETypesFromServer = (): Promise<\n+  OEQ.MimeType.MimeTypeEntry[]\n+> => OEQ.MimeType.listMimeTypes(API_BASE_URL);\n+\n+/**\n+ * Retrieve the Viewer Configuration for the specified MIME type from the server - or from cache.\n+ * Note this function is cached (memoized) and so any server side changes will not take effect\n+ * until the app is reloaded.\n+ *\n+ * @param mimeType the MIME type to get the configuration for\n+ */\n+export const getMimeTypeViewerConfiguration: (\n+  mimeType: string\n+) => Promise<OEQ.MimeType.MimeTypeViewerConfiguration> = memoize(\n+  async (mimeType: string): Promise<OEQ.MimeType.MimeTypeViewerConfiguration> =>\n+    await OEQ.MimeType.getViewersForMimeType(API_BASE_URL, mimeType)\n+);\n+\n+/**\n+ * Retrieve the default viewer details for the specified MIME type from the server - or from cache.\n+ * This function relies on `getMimeTypeViewerConfiguration` which is cached (memoized) and so any\n+ * server side changes will not take effect until the app is reloaded.\n+ *\n+ * @param mimeType the MIME type to get default viewer details for\n+ */\n+export const getMimeTypeDefaultViewerDetails = async (\n+  mimeType: string\n+): Promise<OEQ.MimeType.MimeTypeViewerDetail> => {\n+  const cfg = await getMimeTypeViewerConfiguration(mimeType);\n+  const viewerDetails = cfg.viewers.find(\n+    (v) => v.viewerId === cfg.defaultViewer\n+  );\n+  if (!viewerDetails) {\n+    throw new ReferenceError(\n+      `Missing viewer details for default viewer with id: \"${cfg.defaultViewer}\"`\n+    );\n+  }\n+\n+  return viewerDetails;\n+};\n+\n+/**\n+ * Given a MIME Type of the form `<type>/<sub-type>`, validate correct form and then return\n+ * `type` and `sub-type` in a tuple. `sub-type` will actually also include any attributes, etc. as\n+ * that's all we need for now (i.e. we're not so interested in sub-types yet).\n+ *\n+ * @param mimeType a MIME type of the form `<type>/<sub-type>`\n+ */\n+export const splitMimeType = (mimeType: string): [string, string] => {\n+  // Regex break down:", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c4dee709dbdba69e1235fc4adaa50f2a127fe020"}, "originalPosition": 71}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNjA0NzQ3OA==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n               * Optional function to dependency inject for retrieval of viewers (good for storybook etc). Will\n          \n          \n            \n               * Optional function to inject dependency for retrieval of viewers (good for storybook etc). Will", "url": "https://github.com/openequella/openEQUELLA/pull/2411#discussion_r506047478", "createdAt": "2020-10-16T04:40:06Z", "author": {"login": "SammyIsConfused"}, "path": "Source/Plugins/Core/com.equella.core/js/tsrc/search/components/SearchResult.tsx", "diffHunk": "@@ -87,6 +90,15 @@ const useStyles = makeStyles((theme: Theme) => {\n });\n \n export interface SearchResultProps {\n+  /**\n+   * Optional function to dependency inject for retrieval of viewers (good for storybook etc). Will", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c4dee709dbdba69e1235fc4adaa50f2a127fe020"}, "originalPosition": 22}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNjA0NzczOQ==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                  // Short circuit if this component is unmounted before all it's comms is done.\n          \n          \n            \n                  // Short circuit if this component is unmounted before all its comms is done.", "url": "https://github.com/openequella/openEQUELLA/pull/2411#discussion_r506047739", "createdAt": "2020-10-16T04:41:08Z", "author": {"login": "SammyIsConfused"}, "path": "Source/Plugins/Core/com.equella.core/js/tsrc/search/components/SearchResult.tsx", "diffHunk": "@@ -113,13 +126,58 @@ export default function SearchResult({\n   },\n   highlights,\n }: SearchResultProps) {\n-  const classes = useStyles();\n+  interface AttachmentAndViewerDetails {\n+    attachment: OEQ.Search.Attachment;\n+    viewerDetails?: OEQ.MimeType.MimeTypeViewerDetail;\n+  }\n \n-  const searchResultStrings = languageStrings.searchpage.searchresult;\n+  const classes = useStyles();\n \n-  const [attachExpanded, setAttachExpanded] = React.useState(\n+  const [attachExpanded, setAttachExpanded] = useState(\n     displayOptions?.standardOpen ?? false\n   );\n+  const [\n+    attachmentsWithViewerDetails,\n+    setAttachmentsWithViewerDetails,\n+  ] = useState<AttachmentAndViewerDetails[]>([]);\n+\n+  const searchResultStrings = languageStrings.searchpage.searchresult;\n+\n+  // Responsible for determining the MIME type viewer for the provided attachments\n+  useEffect(() => {\n+    let mounted = true;\n+\n+    if (!attachments || !attachments.length) {\n+      // If there are no attachments, skip this effect\n+      return;\n+    }\n+\n+    const transform = async (\n+      a: OEQ.Search.Attachment\n+    ): Promise<AttachmentAndViewerDetails> => {\n+      const viewerDetails = a.mimeType\n+        ? await getViewerDetails(a.mimeType)\n+        : undefined;\n+      return {\n+        attachment: a,\n+        viewerDetails: viewerDetails,\n+      };\n+    };\n+\n+    (async () => {\n+      const viewerDetails = await Promise.all(\n+        attachments.map<Promise<AttachmentAndViewerDetails>>(transform)\n+      );\n+      if (mounted) {\n+        setAttachmentsWithViewerDetails(viewerDetails);\n+      }\n+    })();\n+\n+    return () => {\n+      // Short circuit if this component is unmounted before all it's comms is done.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c4dee709dbdba69e1235fc4adaa50f2a127fe020"}, "originalPosition": 96}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNjA0ODExMg==", "bodyText": "Got a feeling you can just use item={item} here.", "url": "https://github.com/openequella/openEQUELLA/pull/2411#discussion_r506048112", "createdAt": "2020-10-16T04:42:41Z", "author": {"login": "SammyIsConfused"}, "path": "Source/Plugins/Core/com.equella.core/js/tsrc/search/components/SearchResultList.tsx", "diffHunk": "@@ -174,3 +155,27 @@ export const SearchResultList = ({\n     </Card>\n   );\n };\n+\n+/**\n+ * Helper function for generating a collection of child `<SearchResult>` elements (for use inside\n+ * `<SearchResultList>`) from a collection of OEQ.Search.SearchResultItem[].\n+ *\n+ * @param items the search result items to map over\n+ * @param highlights a list of highlight terms\n+ * @param getViewerDetails optional function to override retrieval of viewer details\n+ */\n+export const mapSearchResultItems = (\n+  items: OEQ.Search.SearchResultItem[],\n+  highlights: string[],\n+  getViewerDetails?: (\n+    mimeType: string\n+  ) => Promise<OEQ.MimeType.MimeTypeViewerDetail>\n+): React.ReactNode[] =>\n+  items.map((item) => (\n+    <SearchResult\n+      key={item.uuid}\n+      item={{ ...item }}", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c4dee709dbdba69e1235fc4adaa50f2a127fe020"}, "originalPosition": 100}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTEwMDE1MDAw", "url": "https://github.com/openequella/openEQUELLA/pull/2411#pullrequestreview-510015000", "createdAt": "2020-10-16T04:28:12Z", "commit": {"oid": "c4dee709dbdba69e1235fc4adaa50f2a127fe020"}, "state": "COMMENTED", "comments": {"totalCount": 9, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xNlQwNDoyODoxM1rOHimg7w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xNlQwNToyNzozM1rOHincOg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNjA0NDY1NQ==", "bodyText": "We have mixed use of MUI Link and <a> across different pages. Do we want to consistently use either one ?", "url": "https://github.com/openequella/openEQUELLA/pull/2411#discussion_r506044655", "createdAt": "2020-10-16T04:28:13Z", "author": {"login": "PenghaiZhang"}, "path": "Source/Plugins/Core/com.equella.core/js/tsrc/components/ItemAttachmentLink.tsx", "diffHunk": "@@ -0,0 +1,99 @@\n+/*\n+ * Licensed to The Apereo Foundation under one or more contributor license\n+ * agreements. See the NOTICE file distributed with this work for additional\n+ * information regarding copyright ownership.\n+ *\n+ * The Apereo Foundation licenses this file to you under the Apache License,\n+ * Version 2.0, (the \"License\"); you may not use this file except in compliance\n+ * with the License. You may obtain a copy of the License at:\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+import * as React from \"react\";\n+import { SyntheticEvent, useState } from \"react\";\n+import { ViewerDefinition } from \"../modules/ViewerModule\";\n+import Lightbox from \"./Lightbox\";\n+\n+export interface ItemAttachmentLinkProps {\n+  /**\n+   * Content to be surrounded byt he link.\n+   */\n+  children: React.ReactNode;\n+  /**\n+   * Optional description that will be passed to chosen viewer - e.g. Lightbox.\n+   */\n+  description?: string;\n+  /**\n+   * Optional mimeType that will be passed to chosen viewer - e.g. Lightbox.\n+   */\n+  mimeType?: string;\n+  /**\n+   * Viewer details for the attachment this link is pointing to. Controls which viewer is triggered\n+   * when the link is clicked.\n+   */\n+  viewerDetails: ViewerDefinition;\n+}\n+\n+/**\n+ * A component to be used for viewing attachments in a uniform manner.\n+ */\n+const ItemAttachmentLink = ({\n+  children,\n+  description,\n+  mimeType,\n+  viewerDetails: [viewer, url],\n+}: ItemAttachmentLinkProps) => {\n+  const [showLightbox, setShowLightbox] = useState<boolean>(false);\n+\n+  let link: JSX.Element = (\n+    <a href={url} target=\"_blank\" rel=\"noreferrer\">", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c4dee709dbdba69e1235fc4adaa50f2a127fe020"}, "originalPosition": 55}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNjA0NTQ3OQ==", "bodyText": "I remember there is a MUI rule saying one should not use a link if the link is not really working as a link. A button should be used instead.  I may be wrong though.", "url": "https://github.com/openequella/openEQUELLA/pull/2411#discussion_r506045479", "createdAt": "2020-10-16T04:31:41Z", "author": {"login": "PenghaiZhang"}, "path": "Source/Plugins/Core/com.equella.core/js/tsrc/components/ItemAttachmentLink.tsx", "diffHunk": "@@ -0,0 +1,99 @@\n+/*\n+ * Licensed to The Apereo Foundation under one or more contributor license\n+ * agreements. See the NOTICE file distributed with this work for additional\n+ * information regarding copyright ownership.\n+ *\n+ * The Apereo Foundation licenses this file to you under the Apache License,\n+ * Version 2.0, (the \"License\"); you may not use this file except in compliance\n+ * with the License. You may obtain a copy of the License at:\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+import * as React from \"react\";\n+import { SyntheticEvent, useState } from \"react\";\n+import { ViewerDefinition } from \"../modules/ViewerModule\";\n+import Lightbox from \"./Lightbox\";\n+\n+export interface ItemAttachmentLinkProps {\n+  /**\n+   * Content to be surrounded byt he link.\n+   */\n+  children: React.ReactNode;\n+  /**\n+   * Optional description that will be passed to chosen viewer - e.g. Lightbox.\n+   */\n+  description?: string;\n+  /**\n+   * Optional mimeType that will be passed to chosen viewer - e.g. Lightbox.\n+   */\n+  mimeType?: string;\n+  /**\n+   * Viewer details for the attachment this link is pointing to. Controls which viewer is triggered\n+   * when the link is clicked.\n+   */\n+  viewerDetails: ViewerDefinition;\n+}\n+\n+/**\n+ * A component to be used for viewing attachments in a uniform manner.\n+ */\n+const ItemAttachmentLink = ({\n+  children,\n+  description,\n+  mimeType,\n+  viewerDetails: [viewer, url],\n+}: ItemAttachmentLinkProps) => {\n+  const [showLightbox, setShowLightbox] = useState<boolean>(false);\n+\n+  let link: JSX.Element = (\n+    <a href={url} target=\"_blank\" rel=\"noreferrer\">\n+      {children}\n+    </a>\n+  );\n+  switch (viewer) {\n+    case \"lightbox\":\n+      if (!mimeType) {\n+        throw new Error(\n+          \"'mimeType' must be specified when viewer is 'lightbox'.\"\n+        );\n+      }\n+      link = (\n+        <>\n+          <a", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c4dee709dbdba69e1235fc4adaa50f2a127fe020"}, "originalPosition": 68}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNjA0NTg5Ng==", "bodyText": "Why not explicitly set the value to be true ?", "url": "https://github.com/openequella/openEQUELLA/pull/2411#discussion_r506045896", "createdAt": "2020-10-16T04:33:31Z", "author": {"login": "PenghaiZhang"}, "path": "Source/Plugins/Core/com.equella.core/js/tsrc/components/ItemAttachmentLink.tsx", "diffHunk": "@@ -0,0 +1,99 @@\n+/*\n+ * Licensed to The Apereo Foundation under one or more contributor license\n+ * agreements. See the NOTICE file distributed with this work for additional\n+ * information regarding copyright ownership.\n+ *\n+ * The Apereo Foundation licenses this file to you under the Apache License,\n+ * Version 2.0, (the \"License\"); you may not use this file except in compliance\n+ * with the License. You may obtain a copy of the License at:\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+import * as React from \"react\";\n+import { SyntheticEvent, useState } from \"react\";\n+import { ViewerDefinition } from \"../modules/ViewerModule\";\n+import Lightbox from \"./Lightbox\";\n+\n+export interface ItemAttachmentLinkProps {\n+  /**\n+   * Content to be surrounded byt he link.\n+   */\n+  children: React.ReactNode;\n+  /**\n+   * Optional description that will be passed to chosen viewer - e.g. Lightbox.\n+   */\n+  description?: string;\n+  /**\n+   * Optional mimeType that will be passed to chosen viewer - e.g. Lightbox.\n+   */\n+  mimeType?: string;\n+  /**\n+   * Viewer details for the attachment this link is pointing to. Controls which viewer is triggered\n+   * when the link is clicked.\n+   */\n+  viewerDetails: ViewerDefinition;\n+}\n+\n+/**\n+ * A component to be used for viewing attachments in a uniform manner.\n+ */\n+const ItemAttachmentLink = ({\n+  children,\n+  description,\n+  mimeType,\n+  viewerDetails: [viewer, url],\n+}: ItemAttachmentLinkProps) => {\n+  const [showLightbox, setShowLightbox] = useState<boolean>(false);\n+\n+  let link: JSX.Element = (\n+    <a href={url} target=\"_blank\" rel=\"noreferrer\">\n+      {children}\n+    </a>\n+  );\n+  switch (viewer) {\n+    case \"lightbox\":\n+      if (!mimeType) {\n+        throw new Error(\n+          \"'mimeType' must be specified when viewer is 'lightbox'.\"\n+        );\n+      }\n+      link = (\n+        <>\n+          <a\n+            onClick={(event: SyntheticEvent) => {\n+              setShowLightbox(!showLightbox);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c4dee709dbdba69e1235fc4adaa50f2a127fe020"}, "originalPosition": 70}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNjA0Njg4MA==", "bodyText": "If nothing is done in this case, why not remove it ? I guess you still  keep it because you want to clearly match the type viewer ?\nIf this case is removed, then this switch could be simplified to a if.", "url": "https://github.com/openequella/openEQUELLA/pull/2411#discussion_r506046880", "createdAt": "2020-10-16T04:37:42Z", "author": {"login": "PenghaiZhang"}, "path": "Source/Plugins/Core/com.equella.core/js/tsrc/components/ItemAttachmentLink.tsx", "diffHunk": "@@ -0,0 +1,99 @@\n+/*\n+ * Licensed to The Apereo Foundation under one or more contributor license\n+ * agreements. See the NOTICE file distributed with this work for additional\n+ * information regarding copyright ownership.\n+ *\n+ * The Apereo Foundation licenses this file to you under the Apache License,\n+ * Version 2.0, (the \"License\"); you may not use this file except in compliance\n+ * with the License. You may obtain a copy of the License at:\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+import * as React from \"react\";\n+import { SyntheticEvent, useState } from \"react\";\n+import { ViewerDefinition } from \"../modules/ViewerModule\";\n+import Lightbox from \"./Lightbox\";\n+\n+export interface ItemAttachmentLinkProps {\n+  /**\n+   * Content to be surrounded byt he link.\n+   */\n+  children: React.ReactNode;\n+  /**\n+   * Optional description that will be passed to chosen viewer - e.g. Lightbox.\n+   */\n+  description?: string;\n+  /**\n+   * Optional mimeType that will be passed to chosen viewer - e.g. Lightbox.\n+   */\n+  mimeType?: string;\n+  /**\n+   * Viewer details for the attachment this link is pointing to. Controls which viewer is triggered\n+   * when the link is clicked.\n+   */\n+  viewerDetails: ViewerDefinition;\n+}\n+\n+/**\n+ * A component to be used for viewing attachments in a uniform manner.\n+ */\n+const ItemAttachmentLink = ({\n+  children,\n+  description,\n+  mimeType,\n+  viewerDetails: [viewer, url],\n+}: ItemAttachmentLinkProps) => {\n+  const [showLightbox, setShowLightbox] = useState<boolean>(false);\n+\n+  let link: JSX.Element = (\n+    <a href={url} target=\"_blank\" rel=\"noreferrer\">\n+      {children}\n+    </a>\n+  );\n+  switch (viewer) {\n+    case \"lightbox\":\n+      if (!mimeType) {\n+        throw new Error(\n+          \"'mimeType' must be specified when viewer is 'lightbox'.\"\n+        );\n+      }\n+      link = (\n+        <>\n+          <a\n+            onClick={(event: SyntheticEvent) => {\n+              setShowLightbox(!showLightbox);\n+              event.stopPropagation();\n+            }}\n+          >\n+            {children}\n+          </a>\n+          {showLightbox && ( // minor optimisation to minimise DOM\n+            <Lightbox\n+              mimeType={mimeType}\n+              onClose={() => setShowLightbox(false)}\n+              open={showLightbox}\n+              src={url}\n+              title={description}\n+            />\n+          )}\n+        </>\n+      );\n+      break;\n+    case \"link\":", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c4dee709dbdba69e1235fc4adaa50f2a127fe020"}, "originalPosition": 88}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNjA0ODQxMg==", "bodyText": "items refer to Item attachments, don't they?", "url": "https://github.com/openequella/openEQUELLA/pull/2411#discussion_r506048412", "createdAt": "2020-10-16T04:43:55Z", "author": {"login": "PenghaiZhang"}, "path": "Source/Plugins/Core/com.equella.core/js/tsrc/components/Lightbox.tsx", "diffHunk": "@@ -0,0 +1,199 @@\n+/*\n+ * Licensed to The Apereo Foundation under one or more contributor license\n+ * agreements. See the NOTICE file distributed with this work for additional\n+ * information regarding copyright ownership.\n+ *\n+ * The Apereo Foundation licenses this file to you under the Apache License,\n+ * Version 2.0, (the \"License\"); you may not use this file except in compliance\n+ * with the License. You may obtain a copy of the License at:\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+import {\n+  Backdrop,\n+  Card,\n+  CardContent,\n+  IconButton,\n+  Theme,\n+  Toolbar,\n+  Typography,\n+} from \"@material-ui/core\";\n+import { makeStyles } from \"@material-ui/core/styles\";\n+import CloseIcon from \"@material-ui/icons/Close\";\n+import OpenInNewIcon from \"@material-ui/icons/OpenInNew\";\n+import * as React from \"react\";\n+import { SyntheticEvent } from \"react\";\n+import {\n+  isBrowserSupportedAudio,\n+  isBrowserSupportedVideo,\n+  splitMimeType,\n+} from \"../modules/MimeTypesModule\";\n+import { languageStrings } from \"../util/langstrings\";\n+\n+const useStyles = makeStyles((theme: Theme) => ({\n+  lightboxBackdrop: {\n+    backgroundColor: \"#000000cc\",\n+    cursor: \"default\", // Replace the backdrop 'pointer' style\n+    zIndex: theme.zIndex.drawer + 1,\n+  },\n+  lightboxAudio: {\n+    minWidth: 200,\n+    width: \"60vw\",\n+  },\n+  lightboxContent: {\n+    maxWidth: \"80vw\",\n+    maxHeight: \"80vh\",\n+  },\n+  lightboxImage: {\n+    minWidth: 100,\n+    minHeight: 100,\n+  },\n+  menuButton: {\n+    color: \"inherit\",\n+    \"&:hover\": {\n+      background: \"#505050\",\n+    },\n+  },\n+  title: {\n+    flexGrow: 1,\n+  },\n+  toolbar: {\n+    backgroundColor: \"#0a0a0a\",\n+    color: \"#fafafa\",\n+    position: \"absolute\",\n+    top: 0,\n+    width: \"100%\",\n+  },\n+}));\n+\n+export interface LightboxProps {\n+  /** MIME type of the items specified by `src` */", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c4dee709dbdba69e1235fc4adaa50f2a127fe020"}, "originalPosition": 76}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNjA1NTEzNw==", "bodyText": "We can also use some .\n[\n    // Standard\n    \"audio/mpeg\",\n    \"audio/ogg\",\n    \"audio/wav\",\n    // oEQ standard types\n    \"audio/x-mp3\",\n  ].some((supported) => mimeType.startsWith(supported));", "url": "https://github.com/openequella/openEQUELLA/pull/2411#discussion_r506055137", "createdAt": "2020-10-16T05:10:32Z", "author": {"login": "PenghaiZhang"}, "path": "Source/Plugins/Core/com.equella.core/js/tsrc/modules/MimeTypesModule.ts", "diffHunk": "@@ -0,0 +1,111 @@\n+/*\n+ * Licensed to The Apereo Foundation under one or more contributor license\n+ * agreements. See the NOTICE file distributed with this work for additional\n+ * information regarding copyright ownership.\n+ *\n+ * The Apereo Foundation licenses this file to you under the Apache License,\n+ * Version 2.0, (the \"License\"); you may not use this file except in compliance\n+ * with the License. You may obtain a copy of the License at:\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+import * as OEQ from \"@openequella/rest-api-client\";\n+import { memoize } from \"lodash\";\n+import { API_BASE_URL } from \"../config\";\n+\n+export const getMIMETypesFromServer = (): Promise<\n+  OEQ.MimeType.MimeTypeEntry[]\n+> => OEQ.MimeType.listMimeTypes(API_BASE_URL);\n+\n+/**\n+ * Retrieve the Viewer Configuration for the specified MIME type from the server - or from cache.\n+ * Note this function is cached (memoized) and so any server side changes will not take effect\n+ * until the app is reloaded.\n+ *\n+ * @param mimeType the MIME type to get the configuration for\n+ */\n+export const getMimeTypeViewerConfiguration: (\n+  mimeType: string\n+) => Promise<OEQ.MimeType.MimeTypeViewerConfiguration> = memoize(\n+  async (mimeType: string): Promise<OEQ.MimeType.MimeTypeViewerConfiguration> =>\n+    await OEQ.MimeType.getViewersForMimeType(API_BASE_URL, mimeType)\n+);\n+\n+/**\n+ * Retrieve the default viewer details for the specified MIME type from the server - or from cache.\n+ * This function relies on `getMimeTypeViewerConfiguration` which is cached (memoized) and so any\n+ * server side changes will not take effect until the app is reloaded.\n+ *\n+ * @param mimeType the MIME type to get default viewer details for\n+ */\n+export const getMimeTypeDefaultViewerDetails = async (\n+  mimeType: string\n+): Promise<OEQ.MimeType.MimeTypeViewerDetail> => {\n+  const cfg = await getMimeTypeViewerConfiguration(mimeType);\n+  const viewerDetails = cfg.viewers.find(\n+    (v) => v.viewerId === cfg.defaultViewer\n+  );\n+  if (!viewerDetails) {\n+    throw new ReferenceError(\n+      `Missing viewer details for default viewer with id: \"${cfg.defaultViewer}\"`\n+    );\n+  }\n+\n+  return viewerDetails;\n+};\n+\n+/**\n+ * Given a MIME Type of the form `<type>/<sub-type>`, validate correct form and then return\n+ * `type` and `sub-type` in a tuple. `sub-type` will actually also include any attributes, etc. as\n+ * that's all we need for now (i.e. we're not so interested in sub-types yet).\n+ *\n+ * @param mimeType a MIME type of the form `<type>/<sub-type>`\n+ */\n+export const splitMimeType = (mimeType: string): [string, string] => {\n+  // Regex break down:\n+  // ^\\w+          Starting with 1 or more word characters\n+  // \\/            Followed by a forward slash\n+  // [+.=; \\w-]+$  Ending with 1 or more of the allowed characters: + . = ; <space> - or word characters\n+  // /i            And all done with case insensitivity\n+  const validMimeTypeRegex = /^\\w+\\/[+.=; \\w-]+$/i;\n+  if (!validMimeTypeRegex.test(mimeType)) {\n+    throw new TypeError(\n+      `Provided string [${mimeType}] is NOT a validly formatted MIME type.`\n+    );\n+  }\n+\n+  return mimeType.split(\"/\", 2) as [string, string];\n+};\n+\n+/**\n+ * Provides a quick check to see if the `mimeType` is a MIME type which can typically be\n+ * played by the built in browser audio player.\n+ *\n+ * @param mimeType A MIME type to be checked\n+ */\n+export const isBrowserSupportedAudio = (mimeType: string): boolean =>\n+  [\n+    // Standard\n+    \"audio/mpeg\",\n+    \"audio/ogg\",\n+    \"audio/wav\",\n+    // oEQ standard types\n+    \"audio/x-mp3\",\n+  ].find((supported) => mimeType.startsWith(supported)) !== undefined;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c4dee709dbdba69e1235fc4adaa50f2a127fe020"}, "originalPosition": 100}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNjA1NjQ2Nw==", "bodyText": "This function is imported from UI layer. Is this something we try to decouple  ?", "url": "https://github.com/openequella/openEQUELLA/pull/2411#discussion_r506056467", "createdAt": "2020-10-16T05:15:32Z", "author": {"login": "PenghaiZhang"}, "path": "Source/Plugins/Core/com.equella.core/js/tsrc/modules/ViewerModule.ts", "diffHunk": "@@ -0,0 +1,65 @@\n+/*\n+ * Licensed to The Apereo Foundation under one or more contributor license\n+ * agreements. See the NOTICE file distributed with this work for additional\n+ * information regarding copyright ownership.\n+ *\n+ * The Apereo Foundation licenses this file to you under the Apache License,\n+ * Version 2.0, (the \"License\"); you may not use this file except in compliance\n+ * with the License. You may obtain a copy of the License at:\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+import * as OEQ from \"@openequella/rest-api-client\";\n+import { isLightboxSupportedMimeType } from \"../components/Lightbox\";", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c4dee709dbdba69e1235fc4adaa50f2a127fe020"}, "originalPosition": 19}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNjA1ODQ3Ng==", "bodyText": "We can remove !attachments because it is an empty array by default.", "url": "https://github.com/openequella/openEQUELLA/pull/2411#discussion_r506058476", "createdAt": "2020-10-16T05:23:07Z", "author": {"login": "PenghaiZhang"}, "path": "Source/Plugins/Core/com.equella.core/js/tsrc/search/components/SearchResult.tsx", "diffHunk": "@@ -113,13 +126,58 @@ export default function SearchResult({\n   },\n   highlights,\n }: SearchResultProps) {\n-  const classes = useStyles();\n+  interface AttachmentAndViewerDetails {\n+    attachment: OEQ.Search.Attachment;\n+    viewerDetails?: OEQ.MimeType.MimeTypeViewerDetail;\n+  }\n \n-  const searchResultStrings = languageStrings.searchpage.searchresult;\n+  const classes = useStyles();\n \n-  const [attachExpanded, setAttachExpanded] = React.useState(\n+  const [attachExpanded, setAttachExpanded] = useState(\n     displayOptions?.standardOpen ?? false\n   );\n+  const [\n+    attachmentsWithViewerDetails,\n+    setAttachmentsWithViewerDetails,\n+  ] = useState<AttachmentAndViewerDetails[]>([]);\n+\n+  const searchResultStrings = languageStrings.searchpage.searchresult;\n+\n+  // Responsible for determining the MIME type viewer for the provided attachments\n+  useEffect(() => {\n+    let mounted = true;\n+\n+    if (!attachments || !attachments.length) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c4dee709dbdba69e1235fc4adaa50f2a127fe020"}, "originalPosition": 69}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNjA1OTgzNA==", "bodyText": "Do we need any error handling here ?", "url": "https://github.com/openequella/openEQUELLA/pull/2411#discussion_r506059834", "createdAt": "2020-10-16T05:27:33Z", "author": {"login": "PenghaiZhang"}, "path": "Source/Plugins/Core/com.equella.core/js/tsrc/search/components/SearchResult.tsx", "diffHunk": "@@ -113,13 +126,58 @@ export default function SearchResult({\n   },\n   highlights,\n }: SearchResultProps) {\n-  const classes = useStyles();\n+  interface AttachmentAndViewerDetails {\n+    attachment: OEQ.Search.Attachment;\n+    viewerDetails?: OEQ.MimeType.MimeTypeViewerDetail;\n+  }\n \n-  const searchResultStrings = languageStrings.searchpage.searchresult;\n+  const classes = useStyles();\n \n-  const [attachExpanded, setAttachExpanded] = React.useState(\n+  const [attachExpanded, setAttachExpanded] = useState(\n     displayOptions?.standardOpen ?? false\n   );\n+  const [\n+    attachmentsWithViewerDetails,\n+    setAttachmentsWithViewerDetails,\n+  ] = useState<AttachmentAndViewerDetails[]>([]);\n+\n+  const searchResultStrings = languageStrings.searchpage.searchresult;\n+\n+  // Responsible for determining the MIME type viewer for the provided attachments\n+  useEffect(() => {\n+    let mounted = true;\n+\n+    if (!attachments || !attachments.length) {\n+      // If there are no attachments, skip this effect\n+      return;\n+    }\n+\n+    const transform = async (\n+      a: OEQ.Search.Attachment\n+    ): Promise<AttachmentAndViewerDetails> => {\n+      const viewerDetails = a.mimeType\n+        ? await getViewerDetails(a.mimeType)\n+        : undefined;\n+      return {\n+        attachment: a,\n+        viewerDetails: viewerDetails,\n+      };\n+    };\n+\n+    (async () => {\n+      const viewerDetails = await Promise.all(", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c4dee709dbdba69e1235fc4adaa50f2a127fe020"}, "originalPosition": 87}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "968f844bb6cb4d2ea56e5ffea6c7ae4d7968562b", "author": {"user": {"login": "edalex-ian", "name": null}}, "url": "https://github.com/openequella/openEQUELLA/commit/968f844bb6cb4d2ea56e5ffea6c7ae4d7968562b", "committedDate": "2020-10-19T03:30:27Z", "message": "chore(front-end): Fix typo in comment\n\nFeedback from PR #2411"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "fff90cc8df3db4370ebd6c9ecaf91d4f92644445", "author": {"user": {"login": "edalex-ian", "name": null}}, "url": "https://github.com/openequella/openEQUELLA/commit/fff90cc8df3db4370ebd6c9ecaf91d4f92644445", "committedDate": "2020-10-19T03:41:02Z", "message": "chore(front-end): Clarify example in JSDoc for ItemAttachmentLinkProps\n\nFeedback from PR #2411"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "7c80023fdb16c63dd0c520dca43c19448cdcf8ee", "author": {"user": {"login": "edalex-ian", "name": null}}, "url": "https://github.com/openequella/openEQUELLA/commit/7c80023fdb16c63dd0c520dca43c19448cdcf8ee", "committedDate": "2020-10-19T03:43:54Z", "message": "chore(front-end): Fix grammar in comment\n\nFeedback from PR #2411"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "4cfdb4e9480595b899349a0fec6a260f87f1a54a", "author": {"user": {"login": "edalex-ian", "name": null}}, "url": "https://github.com/openequella/openEQUELLA/commit/4cfdb4e9480595b899349a0fec6a260f87f1a54a", "committedDate": "2020-10-19T04:01:37Z", "message": "fix(front-end): Remove excessive spread operator\n\nFeedback from PR #2411"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "21f22371e8540e808849f5b95dd7ab14e610add6", "author": {"user": {"login": "edalex-ian", "name": null}}, "url": "https://github.com/openequella/openEQUELLA/commit/21f22371e8540e808849f5b95dd7ab14e610add6", "committedDate": "2020-10-19T04:29:10Z", "message": "chore(front-end): Refactor viewer determination in ItemAttachmentLink\n\nThe initial implementation morphed overtime, and what was left was really for the future and doco. Review feedback highlighted in its current state (and honoring YAGNI) it could be simplified into a ternary. This in term has also helped to make it more declarative, so that's a win. :)\n\nFeedback from PR #2411"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "67b159d59ed33464b2a4f4c807094f6c797422b5", "author": {"user": {"login": "edalex-ian", "name": null}}, "url": "https://github.com/openequella/openEQUELLA/commit/67b159d59ed33464b2a4f4c807094f6c797422b5", "committedDate": "2020-10-19T04:44:49Z", "message": "chore(front-end): Use .some rather than .find\n\nFeedback from PR #2411"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "901b643016d8e60d677004c3e818a8db18a605df", "author": {"user": {"login": "edalex-ian", "name": null}}, "url": "https://github.com/openequella/openEQUELLA/commit/901b643016d8e60d677004c3e818a8db18a605df", "committedDate": "2020-10-20T00:24:13Z", "message": "feat(front-end): Add error handling when determining viewer\n\nFeedback from PR #2411"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "533845101d43b09ee7617391f303161a90af8f1e", "author": {"user": {"login": "edalex-ian", "name": null}}, "url": "https://github.com/openequella/openEQUELLA/commit/533845101d43b09ee7617391f303161a90af8f1e", "committedDate": "2020-10-20T02:10:08Z", "message": "fix(front-end): Use <Link> instead of <a>\n\nThis way we can maintain consistent styling with an institution's theme, while also being able to use 'component' to specify to use 'button' for links which are just to trigger onClicks.\n\nFeedback from PR #2411"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "97845203b8d093f9a5682a145b50ffe6fd00c964", "author": {"user": {"login": "edalex-ian", "name": null}}, "url": "https://github.com/openequella/openEQUELLA/commit/97845203b8d093f9a5682a145b50ffe6fd00c964", "committedDate": "2020-10-20T05:51:34Z", "message": "Merge branch 'develop' into feature/view-attachments"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "cb4d620a9f659198811c098bc126bca7d387fca4", "author": {"user": {"login": "edalex-ian", "name": null}}, "url": "https://github.com/openequella/openEQUELLA/commit/cb4d620a9f659198811c098bc126bca7d387fca4", "committedDate": "2020-10-21T00:53:57Z", "message": "refactor(front-end): Use runtypes match rather than switch\n\nThis facilitates maintaining a declarative style and avoid the pitfalls of a switch statement.\n\nFeedback from PR #2411"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTEzMjU5NzE3", "url": "https://github.com/openequella/openEQUELLA/pull/2411#pullrequestreview-513259717", "createdAt": "2020-10-21T02:19:43Z", "commit": {"oid": "cb4d620a9f659198811c098bc126bca7d387fca4"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 403, "cost": 1, "resetAt": "2021-11-01T16:19:10Z"}}}