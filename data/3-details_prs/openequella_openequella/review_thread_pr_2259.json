{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDgyMzc0MDk0", "number": 2259, "reviewThreads": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wOVQwMDowNDozM1rOEhdLSA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wOVQwNDoyNTo1N1rOEhgBiQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzAzNTE2NDg4OnYy", "diffSide": "RIGHT", "path": "Source/Plugins/Core/com.equella.core/js/tsrc/search/components/CategorySelector.tsx", "isResolved": true, "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wOVQwMDowNDozM1rOHOx9QQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wOVQwNDo1MDo1NlrOHO2kzA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NTI2MDYwOQ==", "bodyText": "It was struggling for me to give proper names in this function. so HELP wanted.", "url": "https://github.com/openequella/openEQUELLA/pull/2259#discussion_r485260609", "createdAt": "2020-09-09T00:04:33Z", "author": {"login": "PenghaiZhang"}, "path": "Source/Plugins/Core/com.equella.core/js/tsrc/search/components/CategorySelector.tsx", "diffHunk": "@@ -212,21 +212,28 @@ export const CategorySelector = ({\n   ): ReactElement[] => {\n     const selectedTerms: string[] =\n       selectedCategories?.find((c) => c.id === id)?.categories ?? [];\n-    const selectedFacets: OEQ.SearchFacets.Facet[] = selectedTerms.map(\n-      (selectedTerm) => {\n-        const facet = categories.find((c) => selectedTerm === c.term);\n-        if (!facet) {\n-          throw new Error(\n-            \"Data integrity issue, we're unable to match a selected term.\"\n-          );\n-        }\n \n-        return facet;\n-      }\n+    // Previously selected categories that still apply to current search criteria.\n+    const selectedAndExist = categories.filter((c) =>", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "60493f59770677cee1748dd8ab7eeded34361082"}, "originalPosition": 16}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NTMyOTQwMA==", "bodyText": "You could go with:\n\nselectedApplicable\nselectedNotApplicable\nnotSelected\n\nAnd to further this idea, it'd be great to maintain the relationships here strictly back to selectedTerms. So how about changing the first two sets to be processed with something like:\nconst [selectedApplicable, selectedNotApplicable] =\n  selectedTerms.reduce<[OEQ.SearchFacets.Facet[], OEQ.SearchFacets.Facet[]]>(\n    ([applicable, notApplicable], term) => {\n      const applicableCategory = category.find( c => c.term === term );\n      return applicableCategory\n        ? [applicable.concat(applicableCategory), notApplicable]\n        : [applicable, notApplicable.concat({term: term, count: 0});\n    }, [[], []]);\nThis is a bit more verbose, but it ties it the data structure it is being generated from, and so I think it's worth that.", "url": "https://github.com/openequella/openEQUELLA/pull/2259#discussion_r485329400", "createdAt": "2020-09-09T04:25:36Z", "author": {"login": "edalex-ian"}, "path": "Source/Plugins/Core/com.equella.core/js/tsrc/search/components/CategorySelector.tsx", "diffHunk": "@@ -212,21 +212,28 @@ export const CategorySelector = ({\n   ): ReactElement[] => {\n     const selectedTerms: string[] =\n       selectedCategories?.find((c) => c.id === id)?.categories ?? [];\n-    const selectedFacets: OEQ.SearchFacets.Facet[] = selectedTerms.map(\n-      (selectedTerm) => {\n-        const facet = categories.find((c) => selectedTerm === c.term);\n-        if (!facet) {\n-          throw new Error(\n-            \"Data integrity issue, we're unable to match a selected term.\"\n-          );\n-        }\n \n-        return facet;\n-      }\n+    // Previously selected categories that still apply to current search criteria.\n+    const selectedAndExist = categories.filter((c) =>", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NTI2MDYwOQ=="}, "originalCommit": {"oid": "60493f59770677cee1748dd8ab7eeded34361082"}, "originalPosition": 16}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NTMzNjI2OA==", "bodyText": "This is a very good use of reduce! I like it!", "url": "https://github.com/openequella/openEQUELLA/pull/2259#discussion_r485336268", "createdAt": "2020-09-09T04:50:56Z", "author": {"login": "PenghaiZhang"}, "path": "Source/Plugins/Core/com.equella.core/js/tsrc/search/components/CategorySelector.tsx", "diffHunk": "@@ -212,21 +212,28 @@ export const CategorySelector = ({\n   ): ReactElement[] => {\n     const selectedTerms: string[] =\n       selectedCategories?.find((c) => c.id === id)?.categories ?? [];\n-    const selectedFacets: OEQ.SearchFacets.Facet[] = selectedTerms.map(\n-      (selectedTerm) => {\n-        const facet = categories.find((c) => selectedTerm === c.term);\n-        if (!facet) {\n-          throw new Error(\n-            \"Data integrity issue, we're unable to match a selected term.\"\n-          );\n-        }\n \n-        return facet;\n-      }\n+    // Previously selected categories that still apply to current search criteria.\n+    const selectedAndExist = categories.filter((c) =>", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NTI2MDYwOQ=="}, "originalCommit": {"oid": "60493f59770677cee1748dd8ab7eeded34361082"}, "originalPosition": 16}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzAzNTYzMTQ1OnYy", "diffSide": "RIGHT", "path": "Source/Plugins/Core/com.equella.core/js/tsrc/search/components/CategorySelector.tsx", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wOVQwNDoyNTo1N1rOHO2KSA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wOVQwNDoyNTo1N1rOHO2KSA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NTMyOTQ4MA==", "bodyText": "I'm guess this is a typo and should be:\n\n  \n    \n  \n    \n\n  \n  This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters. Learn more about bidirectional Unicode characters\n\n\n  \n\n\n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                const noSelected = categories.filter(\n          \n          \n            \n                const notSelected = categories.filter(", "url": "https://github.com/openequella/openEQUELLA/pull/2259#discussion_r485329480", "createdAt": "2020-09-09T04:25:57Z", "author": {"login": "edalex-ian"}, "path": "Source/Plugins/Core/com.equella.core/js/tsrc/search/components/CategorySelector.tsx", "diffHunk": "@@ -212,21 +212,28 @@ export const CategorySelector = ({\n   ): ReactElement[] => {\n     const selectedTerms: string[] =\n       selectedCategories?.find((c) => c.id === id)?.categories ?? [];\n-    const selectedFacets: OEQ.SearchFacets.Facet[] = selectedTerms.map(\n-      (selectedTerm) => {\n-        const facet = categories.find((c) => selectedTerm === c.term);\n-        if (!facet) {\n-          throw new Error(\n-            \"Data integrity issue, we're unable to match a selected term.\"\n-          );\n-        }\n \n-        return facet;\n-      }\n+    // Previously selected categories that still apply to current search criteria.\n+    const selectedAndExist = categories.filter((c) =>\n+      selectedTerms.includes(c.term)\n     );\n-    const orderedFacets = selectedFacets.concat(\n-      categories.filter((c) => !selectedFacets.includes(c))\n+\n+    // Previously selected categories that do not apply to current search criteria.\n+    // Their counts should be 0.\n+    const selectedButDisappear = selectedTerms\n+      .filter((t) => categories.every((c) => c.term !== t))\n+      .map((t) => ({ term: t, count: 0 }));\n+\n+    // Categories that apply to current search criteria but have not been selected.\n+    const noSelected = categories.filter(", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "60493f59770677cee1748dd8ab7eeded34361082"}, "originalPosition": 29}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1784, "cost": 1, "resetAt": "2021-11-12T20:44:06Z"}}}