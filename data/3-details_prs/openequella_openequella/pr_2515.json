{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTIxMjk3MjE3", "number": 2515, "title": "Feature/buttons for selecting resources", "bodyText": "#688\nChecklist\n\n the [contributor license agreement][] is signed\n commit message follows [commit guidelines][]\n tests are included\n screenshots are included showing significant UI changes\n documentation is changed or added\n\nDescription of change\nThis PR created a new component called ResourceSelector which is used to select the ItemSummary page and attachments in Selection Session.\nThis PR is more focused on UI so there are no concrete event handlers passed into ResourceSelector yet.", "createdAt": "2020-11-16T01:03:14Z", "url": "https://github.com/openequella/openEQUELLA/pull/2515", "merged": true, "mergeCommit": {"oid": "2e8e8bb5af0b26c15aa9420c68207299deed8b9a"}, "closed": true, "closedAt": "2020-11-23T04:28:08Z", "author": {"login": "PenghaiZhang"}, "timelineItems": {"totalCount": 12, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdc5QbjgH2gAyNTIxMjk3MjE3OjViMjc1MTBiZWQwYzcxNjI0MGZkNDUyZGU4NGMxYjZjZDRkMmRmMjI=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdfLDJkgH2gAyNTIxMjk3MjE3OmVjMDY5NWZjYzE0ZDZjYzEzMzgwYzE2NmExMTEzNWMzYWYxN2YzNDU=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "5b27510bed0c716240fd452de84c1b6cd4d2df22", "author": {"user": {"login": "PenghaiZhang", "name": null}}, "url": "https://github.com/openequella/openEQUELLA/commit/5b27510bed0c716240fd452de84c1b6cd4d2df22", "committedDate": "2020-11-15T23:49:39Z", "message": "Add a new component Resource Selector and use\nit in component SearchResult."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "982b163ebfd091138db9d4b200b7cf7680418675", "author": {"user": {"login": "PenghaiZhang", "name": null}}, "url": "https://github.com/openequella/openEQUELLA/commit/982b163ebfd091138db9d4b200b7cf7680418675", "committedDate": "2020-11-16T00:10:00Z", "message": "Add a Storybook for ResourceSelector."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "0d961df0b5ffd1a740ee159cbc98d0b588e08ae5", "author": {"user": {"login": "PenghaiZhang", "name": null}}, "url": "https://github.com/openequella/openEQUELLA/commit/0d961df0b5ffd1a740ee159cbc98d0b588e08ae5", "committedDate": "2020-11-16T00:42:16Z", "message": "Add a Jest test to check if buttons for selecting\nresources are displayed in Selection Sessiin."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTMxODQwNzIw", "url": "https://github.com/openequella/openEQUELLA/pull/2515#pullrequestreview-531840720", "createdAt": "2020-11-16T22:30:36Z", "commit": {"oid": "0d961df0b5ffd1a740ee159cbc98d0b588e08ae5"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xNlQyMjozMDozNlrOH0YG6w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xNlQyMjozMzo0MlrOH0YThQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNDY4Mjk4Nw==", "bodyText": "You could probably have a bit of JSDoc explaining this function.", "url": "https://github.com/openequella/openEQUELLA/pull/2515#discussion_r524682987", "createdAt": "2020-11-16T22:30:36Z", "author": {"login": "SammyIsConfused"}, "path": "Source/Plugins/Core/com.equella.core/js/tsrc/search/components/ResourceSelector.tsx", "diffHunk": "@@ -0,0 +1,57 @@\n+/*\n+ * Licensed to The Apereo Foundation under one or more contributor license\n+ * agreements. See the NOTICE file distributed with this work for additional\n+ * information regarding copyright ownership.\n+ *\n+ * The Apereo Foundation licenses this file to you under the Apache License,\n+ * Version 2.0, (the \"License\"); you may not use this file except in compliance\n+ * with the License. You may obtain a copy of the License at:\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+import { IconButton } from \"@material-ui/core\";\n+import Tooltip from \"@material-ui/core/Tooltip\";\n+import DoubleArrowIcon from \"@material-ui/icons/DoubleArrow\";\n+import * as React from \"react\";\n+\n+export interface ResourceSelectorProps {\n+  /**\n+   * Text for the label of ResourceSelector\n+   */\n+  labelText: string;\n+  /**\n+   * Handler for clicking the ResourceSelector\n+   */\n+  onClick: () => void;\n+  /**\n+   * Whether to stop the propagation of a click event\n+   */\n+  isStopPropagation?: boolean;\n+}\n+\n+export const ResourceSelector = ({", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "0d961df0b5ffd1a740ee159cbc98d0b588e08ae5"}, "originalPosition": 38}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNDY4NDI2Ng==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                              onClick={nop} // todo: replace nop with an handler for selecting one attachment\n          \n          \n            \n                              onClick={nop} // todo: replace nop with a handler for selecting one attachment", "url": "https://github.com/openequella/openEQUELLA/pull/2515#discussion_r524684266", "createdAt": "2020-11-16T22:31:47Z", "author": {"login": "SammyIsConfused"}, "path": "Source/Plugins/Core/com.equella.core/js/tsrc/search/components/SearchResult.tsx", "diffHunk": "@@ -314,11 +322,39 @@ export default function SearchResult({\n             >\n               <ListItemText color=\"primary\" primary={description} />\n             </ItemAttachmentLink>\n+            {selectionSessionData && (\n+              <ListItemSecondaryAction>\n+                <ResourceSelector\n+                  labelText={selectResourceStrings.attachment}\n+                  isStopPropagation\n+                  onClick={nop} // todo: replace nop with an handler for selecting one attachment", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "0d961df0b5ffd1a740ee159cbc98d0b588e08ae5"}, "originalPosition": 52}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNDY4NTA0MQ==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                        onClick={nop} // todo: replace nop with an handler for selecting attachments\n          \n          \n            \n                        onClick={nop} // todo: replace nop with a handler for selecting attachments", "url": "https://github.com/openequella/openEQUELLA/pull/2515#discussion_r524685041", "createdAt": "2020-11-16T22:32:31Z", "author": {"login": "SammyIsConfused"}, "path": "Source/Plugins/Core/com.equella.core/js/tsrc/search/components/SearchResult.tsx", "diffHunk": "@@ -314,11 +322,39 @@ export default function SearchResult({\n             >\n               <ListItemText color=\"primary\" primary={description} />\n             </ItemAttachmentLink>\n+            {selectionSessionData && (\n+              <ListItemSecondaryAction>\n+                <ResourceSelector\n+                  labelText={selectResourceStrings.attachment}\n+                  isStopPropagation\n+                  onClick={nop} // todo: replace nop with an handler for selecting one attachment\n+                />\n+              </ListItemSecondaryAction>\n+            )}\n           </ListItem>\n         );\n       }\n     );\n \n+    const accordionText = (\n+      <Typography>{searchResultStrings.attachments}</Typography>\n+    );\n+\n+    const accordionSummaryContent = selectionSessionData ? (\n+      <Grid container alignItems=\"center\">\n+        <Grid item>{accordionText}</Grid>\n+        <Grid>\n+          <ResourceSelector\n+            labelText={selectResourceStrings.allAttachments}\n+            isStopPropagation\n+            onClick={nop} // todo: replace nop with an handler for selecting attachments", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "0d961df0b5ffd1a740ee159cbc98d0b588e08ae5"}, "originalPosition": 72}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNDY4NjIxMw==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                      onClick={nop} // todo: replace nop with an handler for selecting summary page\n          \n          \n            \n                      onClick={nop} // todo: replace nop with a handler for selecting summary page", "url": "https://github.com/openequella/openEQUELLA/pull/2515#discussion_r524686213", "createdAt": "2020-11-16T22:33:42Z", "author": {"login": "SammyIsConfused"}, "path": "Source/Plugins/Core/com.equella.core/js/tsrc/search/components/SearchResult.tsx", "diffHunk": "@@ -390,14 +428,29 @@ export default function SearchResult({\n     );\n   };\n \n+  const itemPrimaryContent = selectionSessionData ? (\n+    <Grid container alignItems=\"center\">\n+      <Grid item>{itemLink()}</Grid>\n+      <Grid item>\n+        <ResourceSelector\n+          labelText={selectResourceStrings.summaryPage}\n+          isStopPropagation\n+          onClick={nop} // todo: replace nop with an handler for selecting summary page", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "0d961df0b5ffd1a740ee159cbc98d0b588e08ae5"}, "originalPosition": 127}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTMxODQ4MzA4", "url": "https://github.com/openequella/openEQUELLA/pull/2515#pullrequestreview-531848308", "createdAt": "2020-11-16T22:44:44Z", "commit": {"oid": "0d961df0b5ffd1a740ee159cbc98d0b588e08ae5"}, "state": "APPROVED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xNlQyMjo0NDo0NVrOH0ZBQQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xNlQyMjo0NDo0NVrOH0ZBQQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNDY5NzkyMQ==", "bodyText": "Nit: I wonder if doing a change like this would help readability:\n\n  \n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n              const selectionSessionData = renderData?.selectionSessionInfo;\n          \n          \n            \n              const inSelectionSession: boolean = renderData?.selectionSessionInfo;\n          \n      \n    \n    \n  \n\nAnd then in the one place you need selectionSessionInfo as the actual data structure, you simply use renderData?.selectionSessionInfo.", "url": "https://github.com/openequella/openEQUELLA/pull/2515#discussion_r524697921", "createdAt": "2020-11-16T22:44:45Z", "author": {"login": "edalex-ian"}, "path": "Source/Plugins/Core/com.equella.core/js/tsrc/search/components/SearchResult.tsx", "diffHunk": "@@ -141,6 +146,8 @@ export default function SearchResult({\n     viewerDetails?: OEQ.MimeType.MimeTypeViewerDetail;\n   }\n   const renderData = getRenderData();\n+  const selectionSessionData = renderData?.selectionSessionInfo;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "0d961df0b5ffd1a740ee159cbc98d0b588e08ae5"}, "originalPosition": 30}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTMzMDYwMzEx", "url": "https://github.com/openequella/openEQUELLA/pull/2515#pullrequestreview-533060311", "createdAt": "2020-11-18T02:57:58Z", "commit": {"oid": "0d961df0b5ffd1a740ee159cbc98d0b588e08ae5"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xOFQwMjo1Nzo1OFrOH1Vpsg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xOFQwMjo1Nzo1OFrOH1Vpsg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNTY5MTMxNA==", "bodyText": "This seems a bit surprising.\nWhy remove the ul list semantics from a list element?", "url": "https://github.com/openequella/openEQUELLA/pull/2515#discussion_r525691314", "createdAt": "2020-11-18T02:57:58Z", "author": {"login": "ChristianMurphy"}, "path": "Source/Plugins/Core/com.equella.core/js/tsrc/search/components/SearchResult.tsx", "diffHunk": "@@ -351,13 +387,15 @@ export default function SearchResult({\n           <AccordionSummary expandIcon={<ExpandMore />}>\n             <Grid container spacing={2} alignItems=\"center\">\n               <Grid item>{attachFileBadge(keywordFoundInAttachment)}</Grid>\n-              <Grid item>\n-                <Typography>{searchResultStrings.attachments}</Typography>\n-              </Grid>\n+              <Grid item>{accordionSummaryContent}</Grid>\n             </Grid>\n           </AccordionSummary>\n           <AccordionDetails>\n-            <List component=\"div\" disablePadding>\n+            <List\n+              component=\"div\"", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "0d961df0b5ffd1a740ee159cbc98d0b588e08ae5"}, "originalPosition": 96}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "765346aee39f4154f4d787b4811de508656476f2", "author": {"user": {"login": "PenghaiZhang", "name": null}}, "url": "https://github.com/openequella/openEQUELLA/commit/765346aee39f4154f4d787b4811de508656476f2", "committedDate": "2020-11-18T23:03:50Z", "message": "Tidy ups for ResourceSelector and SearchResult."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "bdf5f48e027fab95a009c2b82d697b104968a772", "author": {"user": {"login": "PenghaiZhang", "name": null}}, "url": "https://github.com/openequella/openEQUELLA/commit/bdf5f48e027fab95a009c2b82d697b104968a772", "committedDate": "2020-11-20T01:02:45Z", "message": "Use the default component 'ul' for the Attachment list."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "dbf1fc72047452e37701f3bc220d17c302424843", "author": {"user": {"login": "PenghaiZhang", "name": null}}, "url": "https://github.com/openequella/openEQUELLA/commit/dbf1fc72047452e37701f3bc220d17c302424843", "committedDate": "2020-11-20T05:45:18Z", "message": "Handle Selection Session info in module rather than in UI."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTM1MTQzNDU5", "url": "https://github.com/openequella/openEQUELLA/pull/2515#pullrequestreview-535143459", "createdAt": "2020-11-20T06:25:11Z", "commit": {"oid": "dbf1fc72047452e37701f3bc220d17c302424843"}, "state": "APPROVED", "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0yMFQwNjoyNToxMVrOH3BwTg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0yMFQwNjoyODoxNlrOH3B7ZA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNzQ2MjQ3OA==", "bodyText": "Nit\n\n  \n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            const isSelectionSession = (\n          \n          \n            \n            const isSelectionSessionInfo = (", "url": "https://github.com/openequella/openEQUELLA/pull/2515#discussion_r527462478", "createdAt": "2020-11-20T06:25:11Z", "author": {"login": "edalex-ian"}, "path": "Source/Plugins/Core/com.equella.core/js/tsrc/modules/SelectionSessionModule.ts", "diffHunk": "@@ -15,26 +15,48 @@\n  * See the License for the specific language governing permissions and\n  * limitations under the License.\n  */\n-import { AppConfig, SelectionSessionInfo } from \"../AppConfig\";\n+import { AppConfig, getRenderData, SelectionSessionInfo } from \"../AppConfig\";\n+\n+const selectionSessionInfo:\n+  | SelectionSessionInfo\n+  | undefined\n+  | null = getRenderData()?.selectionSessionInfo;\n+\n+/**\n+ * Type guard to check whether an object is of type SelectionSessionInfo.\n+ * @param data The data to be checked\n+ */\n+const isSelectionSession = (", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "dbf1fc72047452e37701f3bc220d17c302424843"}, "originalPosition": 16}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNzQ2NDMxMw==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n             * Build a Selection Session specific ItemSummary Link.\n          \n          \n            \n             * Build a Selection Session specific ItemSummary Link. Recommended to first call `inSelectionSession()`\n          \n          \n            \n             * before use.", "url": "https://github.com/openequella/openEQUELLA/pull/2515#discussion_r527464313", "createdAt": "2020-11-20T06:27:04Z", "author": {"login": "edalex-ian"}, "path": "Source/Plugins/Core/com.equella.core/js/tsrc/modules/SelectionSessionModule.ts", "diffHunk": "@@ -15,26 +15,48 @@\n  * See the License for the specific language governing permissions and\n  * limitations under the License.\n  */\n-import { AppConfig, SelectionSessionInfo } from \"../AppConfig\";\n+import { AppConfig, getRenderData, SelectionSessionInfo } from \"../AppConfig\";\n+\n+const selectionSessionInfo:\n+  | SelectionSessionInfo\n+  | undefined\n+  | null = getRenderData()?.selectionSessionInfo;\n+\n+/**\n+ * Type guard to check whether an object is of type SelectionSessionInfo.\n+ * @param data The data to be checked\n+ */\n+const isSelectionSession = (\n+  data: unknown\n+): data is { [K in keyof SelectionSessionInfo]: unknown } =>\n+  typeof data === \"object\" && data !== null && \"stateId\" in data;\n+\n+/**\n+ * True if the Selection Session info provided by renderData is neither null nor undefined.\n+ */\n+export const inSelectionSession = isSelectionSession(selectionSessionInfo);\n+\n /**\n  * Build a Selection Session specific ItemSummary Link.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "dbf1fc72047452e37701f3bc220d17c302424843"}, "originalPosition": 27}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNzQ2NTMxNg==", "bodyText": "Be good to force the issue here - also for the sake of doco:\n\n  \n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            export const inSelectionSession = isSelectionSession(selectionSessionInfo);\n          \n          \n            \n            export const inSelectionSession: boolean = isSelectionSession(selectionSessionInfo);", "url": "https://github.com/openequella/openEQUELLA/pull/2515#discussion_r527465316", "createdAt": "2020-11-20T06:28:16Z", "author": {"login": "edalex-ian"}, "path": "Source/Plugins/Core/com.equella.core/js/tsrc/modules/SelectionSessionModule.ts", "diffHunk": "@@ -15,26 +15,48 @@\n  * See the License for the specific language governing permissions and\n  * limitations under the License.\n  */\n-import { AppConfig, SelectionSessionInfo } from \"../AppConfig\";\n+import { AppConfig, getRenderData, SelectionSessionInfo } from \"../AppConfig\";\n+\n+const selectionSessionInfo:\n+  | SelectionSessionInfo\n+  | undefined\n+  | null = getRenderData()?.selectionSessionInfo;\n+\n+/**\n+ * Type guard to check whether an object is of type SelectionSessionInfo.\n+ * @param data The data to be checked\n+ */\n+const isSelectionSession = (\n+  data: unknown\n+): data is { [K in keyof SelectionSessionInfo]: unknown } =>\n+  typeof data === \"object\" && data !== null && \"stateId\" in data;\n+\n+/**\n+ * True if the Selection Session info provided by renderData is neither null nor undefined.\n+ */\n+export const inSelectionSession = isSelectionSession(selectionSessionInfo);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "dbf1fc72047452e37701f3bc220d17c302424843"}, "originalPosition": 24}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "fc06f1dc1f3acddc3d4ad402a58fd404a0dfcbef", "author": {"user": {"login": "PenghaiZhang", "name": null}}, "url": "https://github.com/openequella/openEQUELLA/commit/fc06f1dc1f3acddc3d4ad402a58fd404a0dfcbef", "committedDate": "2020-11-23T01:36:19Z", "message": "Mock renderData in SelectionSessionModule test."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ec0695fcc14d6cc13380c166a11135c3af17f345", "author": {"user": {"login": "PenghaiZhang", "name": null}}, "url": "https://github.com/openequella/openEQUELLA/commit/ec0695fcc14d6cc13380c166a11135c3af17f345", "committedDate": "2020-11-23T01:41:17Z", "message": "Tweaks for SelectionSessionModule and SearchResult\n\n1. Remove the const for selectionSessionInfo retrieved from\nrenderData.\n2. Use a function instead of a const so that tests can mock\nthe function."}}]}}}, "rateLimit": {"limit": 5000, "remaining": 348, "cost": 1, "resetAt": "2021-11-01T16:19:10Z"}}}