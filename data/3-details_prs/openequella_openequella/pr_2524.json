{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTIyMTgzOTE4", "number": 2524, "title": "Feature - REST API to list remote searches", "bodyText": "Checklist\n\n\n the contributor license agreement is signed\n commit message follows commit guidelines\n tests are included\n\nDescription of change\n\nJust another simple endpoint, this time to get a list of Remote Searches.\nThis is very similar to #2512 , and as a result includes a degree of refactoring to keep things DRY and pave the way for any future BaseEntity work we do. To some degree there is a whole framework on the Java side for this, however on this side we're attempting to keep it more concrete and explicit.\nAlso snuck in a minor refactor to sort the list of properties in LegacyGuice. (One day we probably want to sit down and consider if this approach is really what we want to be doing - one big bag for all the DI.)", "createdAt": "2020-11-17T06:49:20Z", "url": "https://github.com/openequella/openEQUELLA/pull/2524", "merged": true, "mergeCommit": {"oid": "0bdb2da89cab0d2fa63b526de4edbf47ee6d580c"}, "closed": true, "closedAt": "2020-11-18T02:30:33Z", "author": {"login": "edalex-ian"}, "timelineItems": {"totalCount": 9, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABddSqukAH2gAyNTIyMTgzOTE4OjU3YzdmNDQzNGQ5ODU0MThmZDUwYjlmNjc1OGM0ZjgzOTgzYzIwODE=", "endCursor": "Y3Vyc29yOnYyOpPPAAABddksvAgFqTUzMjkzMjQxOQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "57c7f4434d985418fd50b9f6758c4f83983c2081", "author": {"user": {"login": "edalex-ian", "name": null}}, "url": "https://github.com/openequella/openEQUELLA/commit/57c7f4434d985418fd50b9f6758c4f83983c2081", "committedDate": "2020-11-17T05:26:00Z", "message": "chore(server): Sort properties of LegacyGuice\n\nThere's a lot in there now, so we need to make sure they're easy to browse and add to."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a67f5b54455d74f8a3b6dc2b73fed0cd6d2dbf36", "author": {"user": {"login": "edalex-ian", "name": null}}, "url": "https://github.com/openequella/openEQUELLA/commit/a67f5b54455d74f8a3b6dc2b73fed0cd6d2dbf36", "committedDate": "2020-11-17T06:07:24Z", "message": "feat(server): Add endpoint to list Remote Searches"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "328758ae5e27abb3e53f7f2606a1e971a72113ce", "author": {"user": {"login": "edalex-ian", "name": null}}, "url": "https://github.com/openequella/openEQUELLA/commit/328758ae5e27abb3e53f7f2606a1e971a72113ce", "committedDate": "2020-11-17T06:23:34Z", "message": "refactor(server): Modify Advanced Search endpoint to use new BaseEntitySummary"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "201e27f9e6a437fe3cb97911545e58c4ebbdea85", "author": {"user": {"login": "edalex-ian", "name": null}}, "url": "https://github.com/openequella/openEQUELLA/commit/201e27f9e6a437fe3cb97911545e58c4ebbdea85", "committedDate": "2020-11-17T06:31:45Z", "message": "refactor(oeq-ts-rest-api): Modify Advanced Search function to use new BaseEntitySummary"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "5702b0fc99ffe76ef13cc8988049259c41f666a9", "author": {"user": {"login": "edalex-ian", "name": null}}, "url": "https://github.com/openequella/openEQUELLA/commit/5702b0fc99ffe76ef13cc8988049259c41f666a9", "committedDate": "2020-11-17T06:35:09Z", "message": "refactor(autotest): Modify Advanced Search endpoint test to use new BaseEntitySummary"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d00dc73b5b3800f6de9fd5178461892d06c409a9", "author": {"user": {"login": "edalex-ian", "name": null}}, "url": "https://github.com/openequella/openEQUELLA/commit/d00dc73b5b3800f6de9fd5178461892d06c409a9", "committedDate": "2020-11-17T06:43:16Z", "message": "test(autotest): Add test for new Remote Search endpoint"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTMyMDYxODk0", "url": "https://github.com/openequella/openEQUELLA/pull/2524#pullrequestreview-532061894", "createdAt": "2020-11-17T06:50:00Z", "commit": {"oid": "d00dc73b5b3800f6de9fd5178461892d06c409a9"}, "state": "COMMENTED", "comments": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xN1QwNjo1MDowMFrOH0mevw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xN1QwNjo1MjoxNFrOH0miCA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNDkxODQ2Mw==", "bodyText": "This is the key work of this PR.", "url": "https://github.com/openequella/openEQUELLA/pull/2524#discussion_r524918463", "createdAt": "2020-11-17T06:50:00Z", "author": {"login": "edalex-ian"}, "path": "Source/Plugins/Core/com.equella.core/scalasrc/com/tle/web/api/settings/RemoteSearchResource.scala", "diffHunk": "@@ -0,0 +1,32 @@\n+package com.tle.web.api.settings\n+\n+import com.tle.legacy.LegacyGuice\n+import com.tle.web.api.entity.BaseEntitySummary\n+import io.swagger.annotations.{Api, ApiOperation}\n+import javax.ws.rs.core.Response\n+import javax.ws.rs.{GET, Path, Produces}\n+\n+import scala.collection.JavaConverters.collectionAsScalaIterableConverter\n+\n+@Path(\"settings/remotesearch/\")\n+@Produces(value = Array(\"application/json\"))\n+@Api(value = \"Settings\")\n+class RemoteSearchResource {\n+  private val federatedSearchService = LegacyGuice.federatedSearchService\n+\n+  @GET\n+  @ApiOperation(\n+    value = \"List available Remote (Federated) Searches\",\n+    notes =\n+      \"This endpoint is used to retrieve available Remote Searches and is secured by SEARCH_FEDERATED_SEARCH\",\n+    response = classOf[BaseEntitySummary],\n+    responseContainer = \"List\"\n+  )\n+  def getAll: Response =", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d00dc73b5b3800f6de9fd5178461892d06c409a9"}, "originalPosition": 25}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNDkxODc2MA==", "bodyText": "Following a pattern I saw used for Remote Searches to centralise the string literals for privileges.", "url": "https://github.com/openequella/openEQUELLA/pull/2524#discussion_r524918760", "createdAt": "2020-11-17T06:50:47Z", "author": {"login": "edalex-ian"}, "path": "Source/Plugins/Core/com.equella.core/src/com/tle/core/powersearch/PowerSearchPrivileges.java", "diffHunk": "@@ -0,0 +1,10 @@\n+package com.tle.core.powersearch;\n+\n+public final class PowerSearchPrivileges {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d00dc73b5b3800f6de9fd5178461892d06c409a9"}, "originalPosition": 3}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNDkxOTExNQ==", "bodyText": "It is handy (and DB efficient) to be able to get straight at the Base Entities. I saw this was done and secured with Remote Searches, and it nice supports the refactor for BaseEntitySummary.", "url": "https://github.com/openequella/openEQUELLA/pull/2524#discussion_r524919115", "createdAt": "2020-11-17T06:51:41Z", "author": {"login": "edalex-ian"}, "path": "Source/Plugins/Core/com.equella.core/src/com/tle/core/powersearch/PowerSearchService.java", "diffHunk": "@@ -40,4 +40,11 @@\n   List<BaseEntityLabel> listAllForSchema(long schemaId);\n \n   List<BaseEntityLabel> listAllForSchema(Schema schema);\n+\n+  /**\n+   * List all available Power Searches (Advanced Searches) assuming 'SEARCH_POWER_SEARCH' ACL.\n+   *\n+   * @return available power searches\n+   */\n+  List<PowerSearch> enumerateSearchable();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d00dc73b5b3800f6de9fd5178461892d06c409a9"}, "originalPosition": 10}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNDkxOTMwNA==", "bodyText": "Here's the sort I mentioned. In there I have also added FederatedSearchService.", "url": "https://github.com/openequella/openEQUELLA/pull/2524#discussion_r524919304", "createdAt": "2020-11-17T06:52:14Z", "author": {"login": "edalex-ian"}, "path": "Source/Plugins/Core/com.equella.core/src/com/tle/legacy/LegacyGuice.java", "diffHunk": "@@ -96,149 +97,151 @@\n \n public class LegacyGuice extends AbstractModule {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d00dc73b5b3800f6de9fd5178461892d06c409a9"}, "originalPosition": 10}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "3fcb4a376325fde853097451934e22997ebb163c", "author": {"user": {"login": "edalex-ian", "name": null}}, "url": "https://github.com/openequella/openEQUELLA/commit/3fcb4a376325fde853097451934e22997ebb163c", "committedDate": "2020-11-17T21:38:28Z", "message": "chore(server): Add missing license headers"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTMyOTMyNDE5", "url": "https://github.com/openequella/openEQUELLA/pull/2524#pullrequestreview-532932419", "createdAt": "2020-11-18T00:54:17Z", "commit": {"oid": "3fcb4a376325fde853097451934e22997ebb163c"}, "state": "APPROVED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xOFQwMTowNDowMFrOH1Rvfw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xOFQwMTowNDowMFrOH1Rvfw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNTYyNzI2Mw==", "bodyText": "I am a bit surprised that this annotation works. I used to do this for the search2 test which also extends AbstractRestApiTest but it always runs against rest.", "url": "https://github.com/openequella/openEQUELLA/pull/2524#discussion_r525627263", "createdAt": "2020-11-18T01:04:00Z", "author": {"login": "PenghaiZhang"}, "path": "autotest/OldTests/src/test/java/io/github/openequella/rest/RemoteSearchApiTest.java", "diffHunk": "@@ -0,0 +1,44 @@\n+package io.github.openequella.rest;\n+\n+import static org.junit.Assert.assertEquals;\n+\n+import com.tle.webtests.framework.TestConfig;\n+import com.tle.webtests.framework.TestInstitution;\n+import io.github.openequella.rest.models.BaseEntitySummary;\n+import java.io.IOException;\n+import java.util.List;\n+import org.apache.commons.httpclient.HttpMethod;\n+import org.apache.commons.httpclient.HttpStatus;\n+import org.apache.commons.httpclient.methods.GetMethod;\n+import org.codehaus.jackson.type.TypeReference;\n+import org.testng.annotations.Test;\n+\n+@TestInstitution(\"vanilla\")", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "3fcb4a376325fde853097451934e22997ebb163c"}, "originalPosition": 16}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 352, "cost": 1, "resetAt": "2021-11-01T16:19:10Z"}}}