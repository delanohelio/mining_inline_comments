{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDgxMDcyMDQ3", "number": 2258, "title": "Add support to REST Module for new Search term highlights ", "bodyText": "Checklist\n\n\n the contributor license agreement is signed\n commit message follows commit guidelines\n tests are included\n\nDescription of change\n\nThis mainly adds support to oeq-ts-rest-api to support the new highlight array which comes back from the search2 endpoint. In doing this though I noticed the return type for search was the Common.PagedResult<T> which does not match the server - and even has the resumptionToken which search2 does not use.\nSo inline with the Server definition I also created a specialised interface (SearchResult), one that didn't have a resumptionToken and instead does have a highlight[]. I could have looked at changing PagedResult to have a base class without resumptionToken and build from there, however server side these are not related so it made no sense to build in that relationship this side of the fence.\nOnce that was also done I tweaked the front-end to use it. Interestingly, because the types structurally are very similar TS was happy and everything still worked. However if these diverge further in the future we want to make sure things line up. And to further support this I changed the mocked data to TS with types.", "createdAt": "2020-09-07T05:58:47Z", "url": "https://github.com/openequella/openEQUELLA/pull/2258", "merged": true, "mergeCommit": {"oid": "5fa7c226573af0c4b1b5d63d5854c396f1859a13"}, "closed": true, "closedAt": "2020-09-09T03:45:30Z", "author": {"login": "edalex-ian"}, "timelineItems": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdGccnrgH2gAyNDgxMDcyMDQ3OmQxOTZjNDAzM2M3ZTMxNjY1NTE2YmI5MjMwMzJjMjc5ZmI3NWJhODQ=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdHCFbvgH2gAyNDgxMDcyMDQ3OmJmNGUwYjYxZTI0Mzc5ZWYyZGYxOGU4Y2RhM2RjODI4NTUzZjZkM2U=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "d196c4033c7e31665516bb923032c279fb75ba84", "author": {"user": {"login": "edalex-ian", "name": null}}, "url": "https://github.com/openequella/openEQUELLA/commit/d196c4033c7e31665516bb923032c279fb75ba84", "committedDate": "2020-09-07T05:49:23Z", "message": "oeq-ts-rest-api: Add support for Search highlight terms\n\nIncludes defining an interface for the returned results. The one being used was not actually what was being used on the server side. It was similar, but different - especially in that it included the pagination token stuff."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "5110f4d675a71abf0c84e532ac4f5621cf07bbb5", "author": {"user": {"login": "edalex-ian", "name": null}}, "url": "https://github.com/openequella/openEQUELLA/commit/5110f4d675a71abf0c84e532ac4f5621cf07bbb5", "committedDate": "2020-09-07T05:50:40Z", "message": "front-end: Update interaction with Search for new interface\n\nInterface was changed in oeq-ts-rest-api to support the new `hightlight` property in the result model."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDgzNzI0ODkx", "url": "https://github.com/openequella/openEQUELLA/pull/2258#pullrequestreview-483724891", "createdAt": "2020-09-07T23:21:11Z", "commit": {"oid": "5110f4d675a71abf0c84e532ac4f5621cf07bbb5"}, "state": "APPROVED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wN1QyMzoyMToxMlrOHOIr5g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wN1QyMzo0Mjo1MlrOHOI24w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NDU4NDQyMg==", "bodyText": "I wonder if highlight can be optional or not because a search may not have a query.", "url": "https://github.com/openequella/openEQUELLA/pull/2258#discussion_r484584422", "createdAt": "2020-09-07T23:21:12Z", "author": {"login": "PenghaiZhang"}, "path": "Source/Plugins/Core/com.equella.core/js/tsrc/modules/SearchModule.ts", "diffHunk": "@@ -102,11 +102,12 @@ export const defaultSearchOptions: SearchOptions = {\n   searchAttachments: true,\n };\n \n-export const defaultPagedSearchResult: OEQ.Common.PagedResult<OEQ.Search.SearchResultItem> = {\n+export const defaultPagedSearchResult: OEQ.Search.SearchResult<OEQ.Search.SearchResultItem> = {\n   start: 0,\n   length: 10,\n   available: 10,\n   results: [],\n+  highlight: [],", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "5110f4d675a71abf0c84e532ac4f5621cf07bbb5"}, "originalPosition": 10}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NDU4NzIzNQ==", "bodyText": "As mentioned above, can hightlight be optional ?", "url": "https://github.com/openequella/openEQUELLA/pull/2258#discussion_r484587235", "createdAt": "2020-09-07T23:42:52Z", "author": {"login": "PenghaiZhang"}, "path": "oeq-ts-rest-api/src/Search.ts", "diffHunk": "@@ -240,6 +240,32 @@ export interface SearchResultItem {\n   };\n }\n \n+/**\n+ * Represents the results for a search query.\n+ */\n+export interface SearchResult<T> {\n+  /**\n+   * The starting offset into the total search results\n+   */\n+  start: number;\n+  /**\n+   * How many results can be found in `results`\n+   */\n+  length: number;\n+  /**\n+   * The maximum number of results available for paging\n+   */\n+  available: number;\n+  /**\n+   * The individual items which match the search\n+   */\n+  results: T[];\n+  /**\n+   * List of words to use to highlight when displaying the results\n+   */\n+  highlight: string[];", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "5110f4d675a71abf0c84e532ac4f5621cf07bbb5"}, "originalPosition": 27}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDg0MTMxMzMz", "url": "https://github.com/openequella/openEQUELLA/pull/2258#pullrequestreview-484131333", "createdAt": "2020-09-08T13:20:23Z", "commit": {"oid": "5110f4d675a71abf0c84e532ac4f5621cf07bbb5"}, "state": "APPROVED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wOFQxMzoyMDoyM1rOHOchPw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wOFQxMzoyMDoyM1rOHOchPw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NDkwOTM3NQ==", "bodyText": "is all of lodash needed in this scope?\nWould\n\n  \n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            import * as _ from \"lodash\";\n          \n          \n            \n            import { range } from \"lodash\";\n          \n      \n    \n    \n  \n\nwork? (would also need a change from _.range to range below, on line 312)", "url": "https://github.com/openequella/openEQUELLA/pull/2258#discussion_r484909375", "createdAt": "2020-09-08T13:20:23Z", "author": {"login": "ChristianMurphy"}, "path": "Source/Plugins/Core/com.equella.core/js/__mocks__/SearchResult.mock.ts", "diffHunk": "@@ -16,15 +16,19 @@\n  * See the License for the specific language governing permissions and\n  * limitations under the License.\n  */\n+import * as OEQ from \"@openequella/rest-api-client\";\n+import * as _ from \"lodash\";", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "5110f4d675a71abf0c84e532ac4f5621cf07bbb5"}, "originalPosition": 5}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "bf4e0b61e24379ef2df18e8cda3dc828553f6d3e", "author": {"user": {"login": "edalex-ian", "name": null}}, "url": "https://github.com/openequella/openEQUELLA/commit/bf4e0b61e24379ef2df18e8cda3dc828553f6d3e", "committedDate": "2020-09-09T01:40:27Z", "message": "front-end: Only import range for SearchResult.mock.ts"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 445, "cost": 1, "resetAt": "2021-11-01T16:19:10Z"}}}