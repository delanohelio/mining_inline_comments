{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTM1NjgyNzIw", "number": 2594, "title": "Properly check whether thumbnail generation is timeout or not.", "bodyText": "Checklist\n\n the [contributor license agreement][] is signed\n commit message follows [commit guidelines][]\n tests are included\n screenshots are included showing significant UI changes\n documentation is changed or added\n\nDescription of change\nSince the Java method waitFor returns a boolean to indicate whether the process is finished or not, we should use this boolean rather than using StreamReader.isFinished().  With this change, I no longer have errors like kill and pgrep calls and Error generating thumbnail locally.\nIn terms of why StreamReader.isFinished() is not working reliably, I think we need to dig into its run.", "createdAt": "2020-12-10T06:04:29Z", "url": "https://github.com/openequella/openEQUELLA/pull/2594", "merged": true, "mergeCommit": {"oid": "58f0d8418517143246231a90b8d582008aea620f"}, "closed": true, "closedAt": "2020-12-14T04:03:00Z", "author": {"login": "PenghaiZhang"}, "timelineItems": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdks76FAH2gAyNTM1NjgyNzIwOjUzZTE0OTBmMThlMjcyY2Y3N2M0NzBjMjE2NDMxNjA5ZjQ0ZDhkM2Q=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdl7v4iAH2gAyNTM1NjgyNzIwOjlhMWRlNmQ3ZDY4MjE4MTEzMGFhMWE0ZWFkMWM4MGZiNzE5NDk2OTY=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "53e1490f18e272cf77c470c216431609f44d8d3d", "author": {"user": {"login": "PenghaiZhang", "name": null}}, "url": "https://github.com/openequella/openEQUELLA/commit/53e1490f18e272cf77c470c216431609f44d8d3d", "committedDate": "2020-12-10T05:59:46Z", "message": "Properly check whether thumbnail generation is timeout or not."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTQ5NzQyNjQ1", "url": "https://github.com/openequella/openEQUELLA/pull/2594#pullrequestreview-549742645", "createdAt": "2020-12-11T01:41:07Z", "commit": {"oid": "53e1490f18e272cf77c470c216431609f44d8d3d"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTUwOTY2MzEw", "url": "https://github.com/openequella/openEQUELLA/pull/2594#pullrequestreview-550966310", "createdAt": "2020-12-13T22:13:58Z", "commit": {"oid": "53e1490f18e272cf77c470c216431609f44d8d3d"}, "state": "APPROVED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xM1QyMjoxMzo1OFrOIE6HuA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xM1QyMjoxMzo1OFrOIE6HuA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MjAxNzQ2NA==", "bodyText": "This could probably be used directly in the if, rather being set to a boolean isFinished since it never gets referred to again after that.", "url": "https://github.com/openequella/openEQUELLA/pull/2594#discussion_r542017464", "createdAt": "2020-12-13T22:13:58Z", "author": {"login": "SammyIsConfused"}, "path": "Platform/Plugins/com.tle.platform.common/src/com/tle/common/util/ExecUtils.java", "diffHunk": "@@ -257,8 +261,8 @@ public static ExecResult execWithTimeLimit(\n       int pid = getPidOfProcess(proc).orElse(0);\n       final StreamReader stdOut = cp.getSecond();\n       final StreamReader stdErr = cp.getThird();\n-      proc.waitFor(durationInSeconds, TimeUnit.SECONDS);\n-      if (!stdErr.isFinished() || !stdOut.isFinished()) {\n+      boolean isFinished = proc.waitFor(durationInSeconds, TimeUnit.SECONDS);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "53e1490f18e272cf77c470c216431609f44d8d3d"}, "originalPosition": 29}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTUwOTgwOTg0", "url": "https://github.com/openequella/openEQUELLA/pull/2594#pullrequestreview-550980984", "createdAt": "2020-12-14T00:24:14Z", "commit": {"oid": "53e1490f18e272cf77c470c216431609f44d8d3d"}, "state": "APPROVED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xNFQwMDoyNDoxNFrOIE7j_g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xNFQwMDozMDo0MlrOIE7pBg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MjA0MTA4Ng==", "bodyText": "Why would it be empty? Is it simply a normal situation, in that there were no child PIDs? Or it is always due to an error situation from going into the else block on line 89?\nI'm just wondering if this needs a companion else block to either log the situation, or to throw an exception. \ud83e\udd14 Or if it's just normal - i.e. there may be no child PIDs sometimes - then this is just a guard against this processing. Maybe a comment in this case would highlight the assumption. \ud83e\udd14", "url": "https://github.com/openequella/openEQUELLA/pull/2594#discussion_r542041086", "createdAt": "2020-12-14T00:24:14Z", "author": {"login": "edalex-ian"}, "path": "Platform/Plugins/com.tle.platform.common/src/com/tle/common/util/ExecUtils.java", "diffHunk": "@@ -92,12 +92,16 @@ public static void killLinuxProcessTree(int pid) {\n         LOGGER.debug(\"getChildPid function did not run properly.\\n\" + errorOutput);\n       }\n       getChildPid.destroy();\n-      // convert string to array of ints\n-      pids =\n-          Optional.of(\n-              Arrays.stream(childPid.toString().replaceAll(\"\\n\", \" \").split(\" \"))\n-                  .mapToInt(Integer::parseInt)\n-                  .toArray());\n+\n+      String childPidInfo = childPid.toString();\n+      if (!childPidInfo.isEmpty()) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "53e1490f18e272cf77c470c216431609f44d8d3d"}, "originalPosition": 12}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MjA0MjM3NA==", "bodyText": "I see this as aiding doco. I would say though, doco could be further assisted with something completely underlining the intent:\nfinal boolean timeout = !proc.waitFor(...);\nif (timeout) {\n  // ...\n}", "url": "https://github.com/openequella/openEQUELLA/pull/2594#discussion_r542042374", "createdAt": "2020-12-14T00:30:42Z", "author": {"login": "edalex-ian"}, "path": "Platform/Plugins/com.tle.platform.common/src/com/tle/common/util/ExecUtils.java", "diffHunk": "@@ -257,8 +261,8 @@ public static ExecResult execWithTimeLimit(\n       int pid = getPidOfProcess(proc).orElse(0);\n       final StreamReader stdOut = cp.getSecond();\n       final StreamReader stdErr = cp.getThird();\n-      proc.waitFor(durationInSeconds, TimeUnit.SECONDS);\n-      if (!stdErr.isFinished() || !stdOut.isFinished()) {\n+      boolean isFinished = proc.waitFor(durationInSeconds, TimeUnit.SECONDS);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MjAxNzQ2NA=="}, "originalCommit": {"oid": "53e1490f18e272cf77c470c216431609f44d8d3d"}, "originalPosition": 29}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "9a1de6d7d682181130aa1a4ead1c80fb71949696", "author": {"user": {"login": "PenghaiZhang", "name": null}}, "url": "https://github.com/openequella/openEQUELLA/commit/9a1de6d7d682181130aa1a4ead1c80fb71949696", "committedDate": "2020-12-14T01:49:08Z", "message": "A couple tweaks for ExecUtils"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 301, "cost": 1, "resetAt": "2021-11-01T16:19:10Z"}}}