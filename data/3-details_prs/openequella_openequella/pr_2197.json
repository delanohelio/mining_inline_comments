{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDY5MTc5MTAy", "number": 2197, "title": "Feature/attachment search indicator", "bodyText": "Checklist\n\n\n the contributor license agreement is signed\n commit message follows commit guidelines\n tests are included\n screenshots are included showing significant UI changes\n\nDescription of change\n\nThis feature displays a search icon in the attachment panel if the Search query was found in attachment content.\nA tooltip is also displayed to provide more explanation to the user", "createdAt": "2020-08-18T03:36:13Z", "url": "https://github.com/openequella/openEQUELLA/pull/2197", "merged": true, "mergeCommit": {"oid": "897713d1291b3cedf7fb51679b37205852eb5518"}, "closed": true, "closedAt": "2020-08-18T23:16:23Z", "author": {"login": "mrblippy"}, "timelineItems": {"totalCount": 12, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABc_n3aYAH2gAyNDY5MTc5MTAyOmJhOTA2YWE2OWM1MjUyYWFjMGFhNGY3ZWViZDk1NGI4NmU3OGEyOGI=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdABSHwAFqTQ2OTAzNDM2Mw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "ba906aa69c5252aac0aa4f7eebd954b86e78a28b", "author": {"user": {"login": "mrblippy", "name": "Nick Charles"}}, "url": "https://github.com/openequella/openEQUELLA/commit/ba906aa69c5252aac0aa4f7eebd954b86e78a28b", "committedDate": "2020-08-17T01:10:08Z", "message": "Add keywordFoundInAttachment property to SearchItemResult interface"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "940992686f3c03ec3dc03b7e94a0675b54ca6e3e", "author": {"user": {"login": "mrblippy", "name": "Nick Charles"}}, "url": "https://github.com/openequella/openEQUELLA/commit/940992686f3c03ec3dc03b7e94a0675b54ca6e3e", "committedDate": "2020-08-17T05:16:41Z", "message": "Add Badge to Attachment Expansion panel, indicating if search term was found inside item attachment"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "1e36f3eabb898a54ebc6a5651f46df6a8ddf1e81", "author": {"user": {"login": "mrblippy", "name": "Nick Charles"}}, "url": "https://github.com/openequella/openEQUELLA/commit/1e36f3eabb898a54ebc6a5651f46df6a8ddf1e81", "committedDate": "2020-08-18T00:33:18Z", "message": "Use language string for tooltip"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "447c1a57a2fa4b0a3799df7d7f67e78751baeeae", "author": {"user": {"login": "mrblippy", "name": "Nick Charles"}}, "url": "https://github.com/openequella/openEQUELLA/commit/447c1a57a2fa4b0a3799df7d7f67e78751baeeae", "committedDate": "2020-08-18T00:43:34Z", "message": "Add SearchResult tests for testing keyWordFoundInAttachment indicator"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "8f0858aa1bca58660d0ebab19723263723ea2951", "author": {"user": {"login": "mrblippy", "name": "Nick Charles"}}, "url": "https://github.com/openequella/openEQUELLA/commit/8f0858aa1bca58660d0ebab19723263723ea2951", "committedDate": "2020-08-18T01:29:03Z", "message": "Wrap SearchResult component in BrowserRouter for test"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "029c491b4e01b3d47e1f5bbf37b8185a8e4282e4", "author": {"user": {"login": "mrblippy", "name": "Nick Charles"}}, "url": "https://github.com/openequella/openEQUELLA/commit/029c491b4e01b3d47e1f5bbf37b8185a8e4282e4", "committedDate": "2020-08-18T01:53:07Z", "message": "Add some actual text for language string"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "09847a1e2e78d7202a748769225344f6d3fa3906", "author": {"user": {"login": "mrblippy", "name": "Nick Charles"}}, "url": "https://github.com/openequella/openEQUELLA/commit/09847a1e2e78d7202a748769225344f6d3fa3906", "committedDate": "2020-08-18T02:31:06Z", "message": "Update storybook, make SearchResult test use the storybook mock data"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDY4OTY5NTY0", "url": "https://github.com/openequella/openEQUELLA/pull/2197#pullrequestreview-468969564", "createdAt": "2020-08-18T03:40:11Z", "commit": {"oid": "09847a1e2e78d7202a748769225344f6d3fa3906"}, "state": "COMMENTED", "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xOFQwMzo0MDoxMVrOHCCMjg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xOFQwMzo0MjoxM1rOHCCOVA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MTg5NTE4Mg==", "bodyText": "To reduce repetition, \"keywordFoundInAttachment\" should be a constant.", "url": "https://github.com/openequella/openEQUELLA/pull/2197#discussion_r471895182", "createdAt": "2020-08-18T03:40:11Z", "author": {"login": "SammyIsConfused"}, "path": "Source/Plugins/Core/com.equella.core/js/__stories__/search/SearchResult.stories.tsx", "diffHunk": "@@ -48,6 +48,10 @@ export const BasicSearchResultComponent = () => (\n     collectionId={text(\"collection ID\", mockData.basicSearchObj.collectionId)}\n     commentCount={number(\"comment count\", mockData.basicSearchObj.commentCount)}\n     thumbnail={text(\"thumbnail\", mockData.basicSearchObj.thumbnail)}\n+    keywordFoundInAttachment={boolean(\n+      \"keywordFoundInAttachment\",", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "09847a1e2e78d7202a748769225344f6d3fa3906"}, "originalPosition": 14}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MTg5NTQ0NA==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                  //This needs to be wrapped inside a BrowserRouter, to prevent an `Invariant failed: You should not use <Link> outside a <Router>` error\n          \n          \n            \n                  //This needs to be wrapped inside a BrowserRouter, to prevent an `Invariant failed: You should not use <Link> outside a <Router>` error because of the <Link/> tag within SearchResult", "url": "https://github.com/openequella/openEQUELLA/pull/2197#discussion_r471895444", "createdAt": "2020-08-18T03:41:18Z", "author": {"login": "SammyIsConfused"}, "path": "Source/Plugins/Core/com.equella.core/js/__tests__/tsrc/search/components/SearchResult.test.tsx", "diffHunk": "@@ -0,0 +1,52 @@\n+/*\n+ * Licensed to The Apereo Foundation under one or more contributor license\n+ * agreements. See the NOTICE file distributed with this work for additional\n+ * information regarding copyright ownership.\n+ *\n+ * The Apereo Foundation licenses this file to you under the Apache License,\n+ * Version 2.0, (the \"License\"); you may not use this file except in compliance\n+ * with the License. You may obtain a copy of the License at:\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+import { render, queryByTestId } from \"@testing-library/react\";\n+import * as React from \"react\";\n+import * as mockData from \"../../../../__mocks__/searchresult_mock_data\";\n+import SearchResult from \"../../../../tsrc/search/components/SearchResult\";\n+import * as OEQ from \"@openequella/rest-api-client\";\n+\n+import \"@testing-library/jest-dom/extend-expect\";\n+import { BrowserRouter } from \"react-router-dom\";\n+\n+describe(\"<SearchResult/>\", () => {\n+  const renderSearchResult = (itemResult: OEQ.Search.SearchResultItem) => {\n+    return render(\n+      //This needs to be wrapped inside a BrowserRouter, to prevent an `Invariant failed: You should not use <Link> outside a <Router>` error", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "09847a1e2e78d7202a748769225344f6d3fa3906"}, "originalPosition": 30}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MTg5NTYzNg==", "bodyText": "String should be constant", "url": "https://github.com/openequella/openEQUELLA/pull/2197#discussion_r471895636", "createdAt": "2020-08-18T03:42:13Z", "author": {"login": "SammyIsConfused"}, "path": "Source/Plugins/Core/com.equella.core/js/__tests__/tsrc/search/components/SearchResult.test.tsx", "diffHunk": "@@ -0,0 +1,52 @@\n+/*\n+ * Licensed to The Apereo Foundation under one or more contributor license\n+ * agreements. See the NOTICE file distributed with this work for additional\n+ * information regarding copyright ownership.\n+ *\n+ * The Apereo Foundation licenses this file to you under the Apache License,\n+ * Version 2.0, (the \"License\"); you may not use this file except in compliance\n+ * with the License. You may obtain a copy of the License at:\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+import { render, queryByTestId } from \"@testing-library/react\";\n+import * as React from \"react\";\n+import * as mockData from \"../../../../__mocks__/searchresult_mock_data\";\n+import SearchResult from \"../../../../tsrc/search/components/SearchResult\";\n+import * as OEQ from \"@openequella/rest-api-client\";\n+\n+import \"@testing-library/jest-dom/extend-expect\";\n+import { BrowserRouter } from \"react-router-dom\";\n+\n+describe(\"<SearchResult/>\", () => {\n+  const renderSearchResult = (itemResult: OEQ.Search.SearchResultItem) => {\n+    return render(\n+      //This needs to be wrapped inside a BrowserRouter, to prevent an `Invariant failed: You should not use <Link> outside a <Router>` error\n+      <BrowserRouter>\n+        <SearchResult {...itemResult} key={itemResult.uuid} />\n+      </BrowserRouter>\n+    );\n+  };\n+\n+  it(\"Should show indicator in Attachment panel if keyword was found inside attachment\", () => {\n+    const itemWithSearchTermFound = mockData.keywordFoundInAttachmentObj;\n+    const { container } = renderSearchResult(itemWithSearchTermFound);\n+    expect(\n+      queryByTestId(container, \"keywordFoundInAttachment\")", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "09847a1e2e78d7202a748769225344f6d3fa3906"}, "originalPosition": 41}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDY4OTk1NDUy", "url": "https://github.com/openequella/openEQUELLA/pull/2197#pullrequestreview-468995452", "createdAt": "2020-08-18T05:13:35Z", "commit": {"oid": "09847a1e2e78d7202a748769225344f6d3fa3906"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xOFQwNToxMzozNVrOHCDnMQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xOFQwNToyMjozMVrOHCDxjg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MTkxODM4NQ==", "bodyText": "I'd prefer to avoid using these. They're minimal use when we get to selenium testing, so they end up only being for React Testing Library.\nInstead, with this gone, in your test you can use queryByLabel due to your (rather nicely) having correctly placed an aria-label above.", "url": "https://github.com/openequella/openEQUELLA/pull/2197#discussion_r471918385", "createdAt": "2020-08-18T05:13:35Z", "author": {"login": "edalex-ian"}, "path": "Source/Plugins/Core/com.equella.core/js/tsrc/search/components/SearchResult.tsx", "diffHunk": "@@ -167,8 +178,38 @@ export default function SearchResult({\n           onClick={(event) => handleAttachmentPanelClick(event)}\n         >\n           <AccordionSummary expandIcon={<ExpandMore />}>\n-            <AttachFile className={classes.attachmentIcon} />\n-            <Typography>{searchResultStrings.attachments}</Typography>\n+            <Grid container spacing={2} alignItems=\"center\">\n+              <Grid item>\n+                <Badge\n+                  anchorOrigin={{\n+                    vertical: \"bottom\",\n+                    horizontal: \"right\",\n+                  }}\n+                  overlap=\"circle\"\n+                  badgeContent={\n+                    keywordFoundInAttachment ? (\n+                      <Tooltip\n+                        title={searchResultStrings.keywordFoundInAttachment}\n+                        aria-label={\n+                          searchResultStrings.keywordFoundInAttachment\n+                        }\n+                      >\n+                        <Search\n+                          fontSize=\"small\"\n+                          className={classes.attachmentBadge}\n+                          data-testid=\"keywordFoundInAttachment\"", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "09847a1e2e78d7202a748769225344f6d3fa3906"}, "originalPosition": 72}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MTkyMTAzOA==", "bodyText": "To aid readability, could you please split the badge out into something like:\nconst attachFileBadge = (includeIndicator: boolean) => (\n  <Badge\n    anchorOrigin={{\n      vertical: \"bottom\",\n      horizontal: \"right\",\n    }}\n    overlap=\"circle\"\n    badgeContent={\n    includeIndicator ? (\n      <Tooltip\n        title={searchResultStrings.keywordFoundInAttachment}\n        aria-label={\n          searchResultStrings.keywordFoundInAttachment\n        }\n      >\n        <Search\n          fontSize=\"small\"\n          className={classes.attachmentBadge}\n        />\n      </Tooltip>\n      ) : undefined\n    }\n  >\n    <AttachFile />\n  </Badge>);", "url": "https://github.com/openequella/openEQUELLA/pull/2197#discussion_r471921038", "createdAt": "2020-08-18T05:22:31Z", "author": {"login": "edalex-ian"}, "path": "Source/Plugins/Core/com.equella.core/js/tsrc/search/components/SearchResult.tsx", "diffHunk": "@@ -167,8 +178,38 @@ export default function SearchResult({\n           onClick={(event) => handleAttachmentPanelClick(event)}\n         >\n           <AccordionSummary expandIcon={<ExpandMore />}>\n-            <AttachFile className={classes.attachmentIcon} />\n-            <Typography>{searchResultStrings.attachments}</Typography>\n+            <Grid container spacing={2} alignItems=\"center\">\n+              <Grid item>\n+                <Badge\n+                  anchorOrigin={{\n+                    vertical: \"bottom\",\n+                    horizontal: \"right\",\n+                  }}\n+                  overlap=\"circle\"\n+                  badgeContent={\n+                    keywordFoundInAttachment ? (\n+                      <Tooltip\n+                        title={searchResultStrings.keywordFoundInAttachment}\n+                        aria-label={\n+                          searchResultStrings.keywordFoundInAttachment\n+                        }\n+                      >\n+                        <Search\n+                          fontSize=\"small\"\n+                          className={classes.attachmentBadge}\n+                          data-testid=\"keywordFoundInAttachment\"\n+                        />\n+                      </Tooltip>\n+                    ) : undefined\n+                  }\n+                >\n+                  <AttachFile />\n+                </Badge>", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "09847a1e2e78d7202a748769225344f6d3fa3906"}, "originalPosition": 79}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDY5MDE1NDU0", "url": "https://github.com/openequella/openEQUELLA/pull/2197#pullrequestreview-469015454", "createdAt": "2020-08-18T06:07:42Z", "commit": {"oid": "09847a1e2e78d7202a748769225344f6d3fa3906"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xOFQwNjowNzo0MlrOHCEo4Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xOFQwNjowNzo0MlrOHCEo4Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MTkzNTIwMQ==", "bodyText": "Did you say we already have this language string in the i18n properties file?  If yes we need to remember to remove this one once we fix the language string issue.", "url": "https://github.com/openequella/openEQUELLA/pull/2197#discussion_r471935201", "createdAt": "2020-08-18T06:07:42Z", "author": {"login": "PenghaiZhang"}, "path": "Source/Plugins/Core/com.equella.core/js/tsrc/util/langstrings.ts", "diffHunk": "@@ -368,6 +368,7 @@ export const languageStrings = {\n     searchresult: {\n       attachments: \"Attachments\",\n       dateModified: \"Modified\",\n+      keywordFoundInAttachment: \"Search term found in attachment content\",", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "09847a1e2e78d7202a748769225344f6d3fa3906"}, "originalPosition": 4}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "4712242113d1aec3ef3be6b244d911e791cc79b8", "author": {"user": {"login": "mrblippy", "name": "Nick Charles"}}, "url": "https://github.com/openequella/openEQUELLA/commit/4712242113d1aec3ef3be6b244d911e791cc79b8", "committedDate": "2020-08-18T06:22:17Z", "message": "Use queryByLabelText in test instead of testid. Move AttachmentBadge in SearchResult into function, aiding in readability"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDY5MDM0MzYz", "url": "https://github.com/openequella/openEQUELLA/pull/2197#pullrequestreview-469034363", "createdAt": "2020-08-18T06:46:56Z", "commit": {"oid": "4712242113d1aec3ef3be6b244d911e791cc79b8"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 496, "cost": 1, "resetAt": "2021-11-01T16:19:10Z"}}}