{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDYzODU4ODg4", "number": 2148, "reviewThreads": {"totalCount": 11, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xMFQwNDowOTozMFrOEWpkkw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xMFQyMzo0MzoyMFrOEXAERw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjkyMTg1MjM1OnYy", "diffSide": "RIGHT", "path": "Source/Plugins/Core/com.equella.core/js/tsrc/components/DateRangeSelector.tsx", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xMFQwNDowOTozMFrOG-A5WA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xMFQwNTowNzowNVrOG-BgyA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NzY3OTU3Ng==", "bodyText": "date range is both a prop and state?\nWould it make sense to unify it to one.\nFor example prop, and making it a controlled component (https://reactjs.org/docs/forms.html#controlled-components).", "url": "https://github.com/openequella/openEQUELLA/pull/2148#discussion_r467679576", "createdAt": "2020-08-10T04:09:30Z", "author": {"login": "ChristianMurphy"}, "path": "Source/Plugins/Core/com.equella.core/js/tsrc/components/DateRangeSelector.tsx", "diffHunk": "@@ -134,24 +134,36 @@ export const DateRangeSelector = ({\n       isInitialRender.current = false;\n       return;\n     }\n+    // When state is cleared, do not proceed to avoid duplicated search.\n+    if (!stateDateRange) {\n+      return;\n+    }\n     const start = stateDateRange?.start;\n     const end = stateDateRange?.end;\n     const isStartValid = start && DateTime.fromJSDate(start).isValid;\n     const isEndValid = end && DateTime.fromJSDate(end).isValid;\n \n-    // start is undefined and end is a valid date\n+    // start is undefined and end is a valid date.\n     const openStart = !start && isEndValid;\n-    // End is undefined and start is a valid date\n+    // End is undefined and start is a valid date.\n     const openEnd = !end && isStartValid;\n-    // Both are undefined\n+    // Both are undefined.\n     const openRange = !start && !end;\n-    // Both are valid dates and start is equal or less than end\n+    // Both are valid dates and start is equal or less than end.\n     const closedRange = isStartValid && isEndValid && start! <= end!;\n-    // Call onDateRangeChange for above four cases\n+    // Call onDateRangeChange for above four cases.\n     if (openStart || openEnd || openRange || closedRange) {\n       onDateRangeChange(stateDateRange);\n     }\n   }, [stateDateRange]);\n+\n+  // Only when prop dateRange is cleared, clear stateDateRange as well.\n+  useEffect(() => {\n+    if (!dateRange) {\n+      setStateDateRange(dateRange);\n+    }\n+  }, [dateRange]);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "2954445c825d89fd85d2dbf62965bcadf192c697"}, "originalPosition": 37}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NzY4OTY3Mg==", "bodyText": "We used to have only one. We then changed to both prop and state because MUI Date picker required its valued controlled by state in order to properly validate values.\nWithout State:\n\nWtih state:\n\nI guess we can remove the prop date range \ud83e\udd14", "url": "https://github.com/openequella/openEQUELLA/pull/2148#discussion_r467689672", "createdAt": "2020-08-10T05:07:05Z", "author": {"login": "PenghaiZhang"}, "path": "Source/Plugins/Core/com.equella.core/js/tsrc/components/DateRangeSelector.tsx", "diffHunk": "@@ -134,24 +134,36 @@ export const DateRangeSelector = ({\n       isInitialRender.current = false;\n       return;\n     }\n+    // When state is cleared, do not proceed to avoid duplicated search.\n+    if (!stateDateRange) {\n+      return;\n+    }\n     const start = stateDateRange?.start;\n     const end = stateDateRange?.end;\n     const isStartValid = start && DateTime.fromJSDate(start).isValid;\n     const isEndValid = end && DateTime.fromJSDate(end).isValid;\n \n-    // start is undefined and end is a valid date\n+    // start is undefined and end is a valid date.\n     const openStart = !start && isEndValid;\n-    // End is undefined and start is a valid date\n+    // End is undefined and start is a valid date.\n     const openEnd = !end && isStartValid;\n-    // Both are undefined\n+    // Both are undefined.\n     const openRange = !start && !end;\n-    // Both are valid dates and start is equal or less than end\n+    // Both are valid dates and start is equal or less than end.\n     const closedRange = isStartValid && isEndValid && start! <= end!;\n-    // Call onDateRangeChange for above four cases\n+    // Call onDateRangeChange for above four cases.\n     if (openStart || openEnd || openRange || closedRange) {\n       onDateRangeChange(stateDateRange);\n     }\n   }, [stateDateRange]);\n+\n+  // Only when prop dateRange is cleared, clear stateDateRange as well.\n+  useEffect(() => {\n+    if (!dateRange) {\n+      setStateDateRange(dateRange);\n+    }\n+  }, [dateRange]);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NzY3OTU3Ng=="}, "originalCommit": {"oid": "2954445c825d89fd85d2dbf62965bcadf192c697"}, "originalPosition": 37}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjkyMTk4NjgyOnYy", "diffSide": "RIGHT", "path": "Source/Plugins/Core/com.equella.core/js/__tests__/tsrc/search/SearchPage.test.tsx", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xMFQwNTo0OToxNFrOG-CBkg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xMFQwNTo0OToxNFrOG-CBkg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NzY5ODA2Ng==", "bodyText": "Do we need to check that the sort order indeed changes when we request it? (We discussed and thought not. Mind you though, if it did that'd probably be in a test elsewhere for the Sort Order Selector.)", "url": "https://github.com/openequella/openEQUELLA/pull/2148#discussion_r467698066", "createdAt": "2020-08-10T05:49:14Z", "author": {"login": "edalex-ian"}, "path": "Source/Plugins/Core/com.equella.core/js/__tests__/tsrc/search/SearchPage.test.tsx", "diffHunk": "@@ -49,21 +52,86 @@ const searchPromise = mockSearch.mockImplementation(() =>\n   Promise.resolve(getSearchResult)\n );\n mockCollections.mockImplementation(() => Promise.resolve(getCollectionMap));\n+window.scrollTo = jest.fn();\n const defaultSearchPageOptions: SearchPageOptions = {\n   ...SearchModule.defaultSearchOptions,\n   sortOrder: SearchSettingsModule.SortOrder.RANK,\n   dateRangeQuickModeEnabled: true,\n };\n const defaultCollectionPrivileges = [\"SEARCH_COLLECTION\"];\n \n+describe(\"<SearchPage/> with react-testing-library\", () => {\n+  let container: HTMLElement = document.createElement(\"div\");\n+  const renderSearchPage = async () => {\n+    const { container } = render(\n+      <BrowserRouter>\n+        <SearchPage updateTemplate={jest.fn()} />\n+      </BrowserRouter>\n+    );\n+    // When Pagination shows the correct data, the render is completed.\n+    await waitFor(() =>\n+      screen.getByText(FIRST_PAGE_PAGINATION, { selector: \"p\" })\n+    );\n+    return container;\n+  };\n+\n+  beforeEach(async () => {\n+    container = await renderSearchPage();\n+  });\n+\n+  afterEach(() => {\n+    jest.clearAllMocks();\n+  });\n+\n+  it(\"should clear search options and perform a new search\", async () => {\n+    const query = \"clear query\";\n+    const queryBar = container.querySelector(\"#searchBar\");\n+    if (!queryBar) {\n+      throw new Error(\"Failed to locate the search bar, unable to continue.\");\n+    }\n+    const sortingDropdown = screen.getByDisplayValue(\n+      SearchSettingsModule.SortOrder.RANK\n+    );\n+    const newSearchButton = screen.getByText(\"New search\");\n+\n+    // We will change the debounced query so use fake timer here.\n+    jest.useFakeTimers(\"modern\");\n+    // Change search options now.\n+    fireEvent.change(queryBar, { target: { value: query } });\n+    await waitFor(() => {\n+      expect(queryBar).toHaveDisplayValue(query);\n+      jest.advanceTimersByTime(1000);\n+    });\n+    fireEvent.change(sortingDropdown, {\n+      target: { value: SearchSettingsModule.SortOrder.NAME },\n+    });\n+    await waitFor(() => {\n+      expect(sortingDropdown).toHaveValue(SearchSettingsModule.SortOrder.NAME);\n+    });", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "2954445c825d89fd85d2dbf62965bcadf192c697"}, "originalPosition": 72}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjkyMTk5MzUzOnYy", "diffSide": "RIGHT", "path": "Source/Plugins/Core/com.equella.core/js/tsrc/search/SearchPage.tsx", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xMFQwNTo1MzowMFrOG-CFIA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xMFQwNTo1MzowMFrOG-CFIA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NzY5ODk3Ng==", "bodyText": "Aaahhhh, yes. Nice. We'll probably be using them very soon to disable Refine Search controls inline with config. (Although I appreciate here you're using for something else.)", "url": "https://github.com/openequella/openEQUELLA/pull/2148#discussion_r467698976", "createdAt": "2020-08-10T05:53:00Z", "author": {"login": "edalex-ian"}, "path": "Source/Plugins/Core/com.equella.core/js/tsrc/search/SearchPage.tsx", "diffHunk": "@@ -93,6 +93,7 @@ const SearchPage = ({ updateTemplate }: TemplateUpdateProps) => {\n     // Show spinner before calling API to retrieve Search settings.\n     setShowSpinner(true);\n     getSearchSettingsFromServer().then((settings: SearchSettings) => {\n+      setSearchSettings(settings);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "2954445c825d89fd85d2dbf62965bcadf192c697"}, "originalPosition": 13}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjkyMTk5OTA3OnYy", "diffSide": "RIGHT", "path": "Source/Plugins/Core/com.equella.core/js/tsrc/search/components/SearchBar.tsx", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xMFQwNTo1NjoyM1rOG-CIFw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xMFQwNTo1NjoyM1rOG-CIFw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NzY5OTczNQ==", "bodyText": "This isn't a typo. It's 'if and only if'.", "url": "https://github.com/openequella/openEQUELLA/pull/2148#discussion_r467699735", "createdAt": "2020-08-10T05:56:23Z", "author": {"login": "edalex-ian"}, "path": "Source/Plugins/Core/com.equella.core/js/tsrc/search/components/SearchBar.tsx", "diffHunk": "@@ -92,9 +92,18 @@ export default function SearchBar({\n     doSearch,\n   ]);\n \n+  /**\n+   * Update state when search query is cleared.\n+   */\n+  useEffect(() => {\n+    if (!query) {\n+      setCurrentQuery(query);\n+    }\n+  }, [query]);\n+\n   const handleKeyDown = (event: React.KeyboardEvent<HTMLInputElement>) => {\n     if (event.keyCode === ESCAPE_KEY_CODE && currentQuery) {\n-      // iff there is a current query, clear it out and trigger a search\n+      // if there is a current query, clear it out and trigger a search", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "2954445c825d89fd85d2dbf62965bcadf192c697"}, "originalPosition": 25}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjkyMjAwNDUxOnYy", "diffSide": "RIGHT", "path": "Source/Plugins/Core/com.equella.core/js/tsrc/search/components/SearchBar.tsx", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xMFQwNTo1OTo0MVrOG-CLBw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xMFQwNTo1OTo0MVrOG-CLBw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NzcwMDQ4Nw==", "bodyText": "This doesn't need to be a JSDoc - should just be a oneliner comment. As it's not the kind of documentation that would add value standalone (i.e. in generated doco).", "url": "https://github.com/openequella/openEQUELLA/pull/2148#discussion_r467700487", "createdAt": "2020-08-10T05:59:41Z", "author": {"login": "edalex-ian"}, "path": "Source/Plugins/Core/com.equella.core/js/tsrc/search/components/SearchBar.tsx", "diffHunk": "@@ -92,9 +92,18 @@ export default function SearchBar({\n     doSearch,\n   ]);\n \n+  /**", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "2954445c825d89fd85d2dbf62965bcadf192c697"}, "originalPosition": 13}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjkyMjAwNzUzOnYy", "diffSide": "RIGHT", "path": "Source/Plugins/Core/com.equella.core/js/tsrc/search/components/SearchBar.tsx", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xMFQwNjowMTozMVrOG-CMnA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xMFQwNjowMTozMVrOG-CMnA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NzcwMDg5Mg==", "bodyText": "I feel I'm missing something as to why we need this. I'd like to avoid an effect if possible - as it definitely amps the complexity soon as a component has it. Goes from a simple component, to something a bit more involved.\nCould you elaborate as to why this is needed? I'm gathering you encountered an issue.", "url": "https://github.com/openequella/openEQUELLA/pull/2148#discussion_r467700892", "createdAt": "2020-08-10T06:01:31Z", "author": {"login": "edalex-ian"}, "path": "Source/Plugins/Core/com.equella.core/js/tsrc/search/components/SearchBar.tsx", "diffHunk": "@@ -92,9 +92,18 @@ export default function SearchBar({\n     doSearch,\n   ]);\n \n+  /**\n+   * Update state when search query is cleared.\n+   */\n+  useEffect(() => {\n+    if (!query) {\n+      setCurrentQuery(query);\n+    }\n+  }, [query]);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "2954445c825d89fd85d2dbf62965bcadf192c697"}, "originalPosition": 20}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjkyMjAwODI3OnYy", "diffSide": "LEFT", "path": "Source/Plugins/Core/com.equella.core/js/tsrc/search/components/SearchOrderSelect.tsx", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xMFQwNjowMTo1NFrOG-CM_g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xMFQwNjowMTo1NFrOG-CM_g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NzcwMDk5MA==", "bodyText": "Ha! Amazing how much discussion went into this one line. \ud83d\udc4d", "url": "https://github.com/openequella/openEQUELLA/pull/2148#discussion_r467700990", "createdAt": "2020-08-10T06:01:54Z", "author": {"login": "edalex-ian"}, "path": "Source/Plugins/Core/com.equella.core/js/tsrc/search/components/SearchOrderSelect.tsx", "diffHunk": "@@ -60,7 +60,6 @@ export const SearchOrderSelect = ({\n \n   return (\n     <Select\n-      variant=\"outlined\"", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "2954445c825d89fd85d2dbf62965bcadf192c697"}, "originalPosition": 4}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjkyMjAwOTc2OnYy", "diffSide": "RIGHT", "path": "Source/Plugins/Core/com.equella.core/js/__tests__/tsrc/search/SearchPage.test.tsx", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xMFQwNjowMjo1OFrOG-CN0Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xMFQwNjowMjo1OFrOG-CN0Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NzcwMTIwMQ==", "bodyText": "Be good to use the language string here. That way it's already in a constant, no need for us to have to maintain these.", "url": "https://github.com/openequella/openEQUELLA/pull/2148#discussion_r467701201", "createdAt": "2020-08-10T06:02:58Z", "author": {"login": "edalex-ian"}, "path": "Source/Plugins/Core/com.equella.core/js/__tests__/tsrc/search/SearchPage.test.tsx", "diffHunk": "@@ -49,21 +52,86 @@ const searchPromise = mockSearch.mockImplementation(() =>\n   Promise.resolve(getSearchResult)\n );\n mockCollections.mockImplementation(() => Promise.resolve(getCollectionMap));\n+window.scrollTo = jest.fn();\n const defaultSearchPageOptions: SearchPageOptions = {\n   ...SearchModule.defaultSearchOptions,\n   sortOrder: SearchSettingsModule.SortOrder.RANK,\n   dateRangeQuickModeEnabled: true,\n };\n const defaultCollectionPrivileges = [\"SEARCH_COLLECTION\"];\n \n+describe(\"<SearchPage/> with react-testing-library\", () => {\n+  let container: HTMLElement = document.createElement(\"div\");\n+  const renderSearchPage = async () => {\n+    const { container } = render(\n+      <BrowserRouter>\n+        <SearchPage updateTemplate={jest.fn()} />\n+      </BrowserRouter>\n+    );\n+    // When Pagination shows the correct data, the render is completed.\n+    await waitFor(() =>\n+      screen.getByText(FIRST_PAGE_PAGINATION, { selector: \"p\" })\n+    );\n+    return container;\n+  };\n+\n+  beforeEach(async () => {\n+    container = await renderSearchPage();\n+  });\n+\n+  afterEach(() => {\n+    jest.clearAllMocks();\n+  });\n+\n+  it(\"should clear search options and perform a new search\", async () => {\n+    const query = \"clear query\";\n+    const queryBar = container.querySelector(\"#searchBar\");\n+    if (!queryBar) {\n+      throw new Error(\"Failed to locate the search bar, unable to continue.\");\n+    }\n+    const sortingDropdown = screen.getByDisplayValue(\n+      SearchSettingsModule.SortOrder.RANK\n+    );\n+    const newSearchButton = screen.getByText(\"New search\");", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "2954445c825d89fd85d2dbf62965bcadf192c697"}, "originalPosition": 57}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjkyMjA1NDU4OnYy", "diffSide": "RIGHT", "path": "Source/Plugins/Core/com.equella.core/js/tsrc/search/components/SearchResultList.tsx", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xMFQwNjoyNjoyMFrOG-CmcQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xMFQyMjo1NjoyNlrOG-igmQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NzcwNzUwNQ==", "bodyText": "Is spacing of 1 the default? You might not need to specify.", "url": "https://github.com/openequella/openEQUELLA/pull/2148#discussion_r467707505", "createdAt": "2020-08-10T06:26:20Z", "author": {"login": "SammyIsConfused"}, "path": "Source/Plugins/Core/com.equella.core/js/tsrc/search/components/SearchResultList.tsx", "diffHunk": "@@ -109,10 +116,21 @@ export const SearchResultList = ({\n       <CardHeader\n         title={searchPageStrings.subtitle}\n         action={\n-          <SearchOrderSelect\n-            value={orderSelectProps.value}\n-            onChange={orderSelectProps.onChange}\n-          />\n+          <Grid container spacing={1}>", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "2954445c825d89fd85d2dbf62965bcadf192c697"}, "originalPosition": 43}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2ODIzMDI5Nw==", "bodyText": "The default spacing is 0 I reckon.", "url": "https://github.com/openequella/openEQUELLA/pull/2148#discussion_r468230297", "createdAt": "2020-08-10T22:56:26Z", "author": {"login": "PenghaiZhang"}, "path": "Source/Plugins/Core/com.equella.core/js/tsrc/search/components/SearchResultList.tsx", "diffHunk": "@@ -109,10 +116,21 @@ export const SearchResultList = ({\n       <CardHeader\n         title={searchPageStrings.subtitle}\n         action={\n-          <SearchOrderSelect\n-            value={orderSelectProps.value}\n-            onChange={orderSelectProps.onChange}\n-          />\n+          <Grid container spacing={1}>", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NzcwNzUwNQ=="}, "originalCommit": {"oid": "2954445c825d89fd85d2dbf62965bcadf192c697"}, "originalPosition": 43}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjkyMjA1OTc4OnYy", "diffSide": "RIGHT", "path": "Source/Plugins/Core/com.equella.core/js/__tests__/tsrc/search/SearchPage.test.tsx", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xMFQwNjoyOTowM1rOG-CpaA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xMFQyMjo1ODo1MVrOG-ikBw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NzcwODI2NA==", "bodyText": "I dunno if we need to specify that it uses react-testing-library here \ud83e\udd14", "url": "https://github.com/openequella/openEQUELLA/pull/2148#discussion_r467708264", "createdAt": "2020-08-10T06:29:03Z", "author": {"login": "SammyIsConfused"}, "path": "Source/Plugins/Core/com.equella.core/js/__tests__/tsrc/search/SearchPage.test.tsx", "diffHunk": "@@ -49,21 +52,86 @@ const searchPromise = mockSearch.mockImplementation(() =>\n   Promise.resolve(getSearchResult)\n );\n mockCollections.mockImplementation(() => Promise.resolve(getCollectionMap));\n+window.scrollTo = jest.fn();\n const defaultSearchPageOptions: SearchPageOptions = {\n   ...SearchModule.defaultSearchOptions,\n   sortOrder: SearchSettingsModule.SortOrder.RANK,\n   dateRangeQuickModeEnabled: true,\n };\n const defaultCollectionPrivileges = [\"SEARCH_COLLECTION\"];\n \n+describe(\"<SearchPage/> with react-testing-library\", () => {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "2954445c825d89fd85d2dbf62965bcadf192c697"}, "originalPosition": 25}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2ODIzMTE3NQ==", "bodyText": "We just specified it for a short term. When we refactor the whole test we will remove it.", "url": "https://github.com/openequella/openEQUELLA/pull/2148#discussion_r468231175", "createdAt": "2020-08-10T22:58:51Z", "author": {"login": "PenghaiZhang"}, "path": "Source/Plugins/Core/com.equella.core/js/__tests__/tsrc/search/SearchPage.test.tsx", "diffHunk": "@@ -49,21 +52,86 @@ const searchPromise = mockSearch.mockImplementation(() =>\n   Promise.resolve(getSearchResult)\n );\n mockCollections.mockImplementation(() => Promise.resolve(getCollectionMap));\n+window.scrollTo = jest.fn();\n const defaultSearchPageOptions: SearchPageOptions = {\n   ...SearchModule.defaultSearchOptions,\n   sortOrder: SearchSettingsModule.SortOrder.RANK,\n   dateRangeQuickModeEnabled: true,\n };\n const defaultCollectionPrivileges = [\"SEARCH_COLLECTION\"];\n \n+describe(\"<SearchPage/> with react-testing-library\", () => {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NzcwODI2NA=="}, "originalCommit": {"oid": "2954445c825d89fd85d2dbf62965bcadf192c697"}, "originalPosition": 25}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjkyNTUzNzk5OnYy", "diffSide": "RIGHT", "path": "Source/Plugins/Core/com.equella.core/js/tsrc/search/components/SearchBar.tsx", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xMFQyMzo0MzoyMFrOG-jaKw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xMFQyMzo0MzoyMFrOG-jaKw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2ODI0NTAzNQ==", "bodyText": "This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters. Learn more about bidirectional Unicode characters\n\n\n  \n\n\n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n              //Update state when search query is cleared.\n          \n          \n            \n              // Update state when search query is cleared.", "url": "https://github.com/openequella/openEQUELLA/pull/2148#discussion_r468245035", "createdAt": "2020-08-10T23:43:20Z", "author": {"login": "ChristianMurphy"}, "path": "Source/Plugins/Core/com.equella.core/js/tsrc/search/components/SearchBar.tsx", "diffHunk": "@@ -92,6 +92,13 @@ export default function SearchBar({\n     doSearch,\n   ]);\n \n+  //Update state when search query is cleared.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "015849ee94fd601a4e6e5ec16ab9846cfaff5824"}, "originalPosition": 13}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1201, "cost": 1, "resetAt": "2021-11-12T20:44:06Z"}}}