{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDUyODg0MjE1", "number": 2075, "title": "Created new OEQThumb component", "bodyText": "Checklist\n\n\n the contributor license agreement is signed\n commit message follows commit guidelines\n tests are included\n screenshots are included showing significant UI changes\n\nDescription of change\n\n#1306\nThis commit covers\n\noEQThumb component, which will display a real thumbnail for an attachment (if it exists). Otherwise an appropriate placeholder icon is returned.\nAdd null check inside SearchHelper.scala. If this is not performed the fileExists method can return incorrect results, when the filename parameter is null oEQ falls back to checking if the item file handle exists (which it always will exists)\nSlight modification to SearchResult component to use the oEQThumb component. We are still always using the first attachment as the display thumbnail. This will be expanded out in future PRs to reflect the SaerchResult's displayOptions.\n\nTests will be coming in a separate PR, but for now I would really like some feedback on my logic inside the OEQThumb component. I tried my best to reduce the amount of repeated code, but any suggestions further feedback would be welcome", "createdAt": "2020-07-20T00:04:23Z", "url": "https://github.com/openequella/openEQUELLA/pull/2075", "merged": true, "mergeCommit": {"oid": "39787cec204e614500f52fe2643d4ae975021654"}, "closed": true, "closedAt": "2020-07-21T10:04:04Z", "author": {"login": "mrblippy"}, "timelineItems": {"totalCount": 14, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABc2lylgAH2gAyNDUyODg0MjE1OjNjMzI4NzRlNjUyYTQyZWExYTk5NjU2OGVjZmFlYzdkMjQ0MWM5NmY=", "endCursor": "Y3Vyc29yOnYyOpPPAAABc3BqK6gH2gAyNDUyODg0MjE1OjE2ZmNhMjE0MWQzMWYyMTFhZjIxZDBiMTIzOWU5NDNkMzQ4NGY0NjU=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "3c32874e652a42ea1a996568ecfaec7d2441c96f", "author": {"user": {"login": "mrblippy", "name": "Nick Charles"}}, "url": "https://github.com/openequella/openEQUELLA/commit/3c32874e652a42ea1a996568ecfaec7d2441c96f", "committedDate": "2020-07-19T23:39:44Z", "message": "Created new OEQThumb component\n\nThis commit covers\n- oEQThumb component, which will display a real thumbnail for an attachment (if it exists). Otherwise an appropriate placeholder icon is returned\n- Add null check inside SearchHelper.scala. If this is not performed the fileExists method can return incorrect results, when the filename parameter is null oEQ falls back to checking if the item file handle exists (which it always will exists)\n- Slight modification to SearchResult component to use the oEQThumb component. We are still always using the first attachment as the display thumbnail. This will be expanded out in future PRs to reflect the SaerchResult's displayOptions"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDUxMTc4MTA0", "url": "https://github.com/openequella/openEQUELLA/pull/2075#pullrequestreview-451178104", "createdAt": "2020-07-20T00:21:37Z", "commit": {"oid": "3c32874e652a42ea1a996568ecfaec7d2441c96f"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 7, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yMFQwMDoyMTozN1rOGzzicQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yMFQwMDo0OTo1M1rOGzzwpA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1Njk3NDk2MQ==", "bodyText": "This should be before the param and return statements.", "url": "https://github.com/openequella/openEQUELLA/pull/2075#discussion_r456974961", "createdAt": "2020-07-20T00:21:37Z", "author": {"login": "edalex-ian"}, "path": "Source/Plugins/Core/com.equella.core/js/tsrc/search/components/OEQThumb.tsx", "diffHunk": "@@ -0,0 +1,131 @@\n+/*\n+ * Licensed to The Apereo Foundation under one or more contributor license\n+ * agreements. See the NOTICE file distributed with this work for additional\n+ * information regarding copyright ownership.\n+ *\n+ * The Apereo Foundation licenses this file to you under the Apache License,\n+ * Version 2.0, (the \"License\"); you may not use this file except in compliance\n+ * with the License. You may obtain a copy of the License at:\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+import * as React from \"react\";\n+import { makeStyles } from \"@material-ui/core/styles\";\n+import { Theme } from \"@material-ui/core\";\n+import * as OEQ from \"@openequella/rest-api-client\";\n+import {\n+  Link as LinkIcon,\n+  Movie as VideoIcon,\n+  Panorama as ImageIcon,\n+  InsertDriveFile as DefaultFileIcon,\n+  Language as WebIcon,\n+} from \"@material-ui/icons\";\n+\n+const useStyles = makeStyles((theme: Theme) => {\n+  return {\n+    thumbnail: {\n+      //if material UI changes such that the MuiPaper-elevation1 MuiPaper-rounded no longer map, add the rules here.\n+      marginRight: theme.spacing(2),\n+      width: \"88px\",\n+      height: \"auto\",\n+    },\n+    placeholderThumbnail: {\n+      color: theme.palette.text.secondary,\n+      opacity: 0.4,\n+      height: \"66px\",\n+    },\n+  };\n+});\n+\n+interface ThumbProps {\n+  className: string;\n+  fontSize: \"inherit\" | \"default\" | \"small\" | \"large\";\n+}\n+/**\n+ * OEQThumb component\n+ * Takes an OEQ.Search.Attachment object as a parameter.\n+ * The thumbnail will be served up from oEQ if the attachment has had a thumbnail generated (Image, video, pdf based files, Youtube, Flickr, Goodle books)\n+ * Otherwise, an appropriate Icon is returned\n+ */\n+export default function OEQThumb({\n+  mimeType,\n+  attachmentType,\n+  hasGeneratedThumb,\n+  description,\n+  links,\n+}: OEQ.Search.Attachment) {\n+  const classes = useStyles();\n+  const generalThumbStyles: ThumbProps = {\n+    className: `MuiPaper-elevation1 MuiPaper-rounded ${classes.thumbnail} ${classes.placeholderThumbnail}`,\n+    fontSize: \"large\",\n+  };\n+  let oeqThumb: React.ReactElement = (\n+    <DefaultFileIcon {...generalThumbStyles} />\n+  );\n+\n+  const oeqProvidedThumb: React.ReactElement = (\n+    <img\n+      className={`MuiPaper-elevation1 MuiPaper-rounded ${classes.thumbnail}`}\n+      src={links.thumbnail}\n+      alt={description}\n+    />\n+  );\n+  /**\n+   * @param {string} mimeType - Attachment's Mimetype. eg. image/png application/pdf\n+   * @return {ReactElement} Image, video and pdf based mimetypes are thumbnailed by oEQ.\n+   * We need to check if a thumbnail has been generated, and return a generic icon if not", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "3c32874e652a42ea1a996568ecfaec7d2441c96f"}, "originalPosition": 82}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1Njk3NjA4Ng==", "bodyText": "My eye was immediate draw to this block due to what appears to be excessive nesting. As excessive nesting can make code hard to follow/read/understand intent.\nLooking at this, I wonder why if(hasGeneratedThumb) is in the nesting. It feels as though this whole level can be replaced with an opening statement in this function of:\nif(hasGeneratedThumb) {\n  return oeqProvidedThumb;\n}\nIf that is valid, it then looks like this function could be:\nconst handleMimeType = (mimeType?: string): React.ReactElement => {\n  if (hasGeneratedThumb) {\n    return oeqProvidedThumb;\n  }\n\n  let result = <DefaultFileIcon {...generalThumbStyles} />;\n  if (mimeType?.startsWith(\"image\")) {\n    result = <ImageIcon {...generalThumbStyles} />;\n  } else if (mimeType?.startsWith(\"video\")) {\n    result = <VideoIcon {...generalThumbStyles} />;\n  }\n\n  return result;\n}", "url": "https://github.com/openequella/openEQUELLA/pull/2075#discussion_r456976086", "createdAt": "2020-07-20T00:30:56Z", "author": {"login": "edalex-ian"}, "path": "Source/Plugins/Core/com.equella.core/js/tsrc/search/components/OEQThumb.tsx", "diffHunk": "@@ -0,0 +1,131 @@\n+/*\n+ * Licensed to The Apereo Foundation under one or more contributor license\n+ * agreements. See the NOTICE file distributed with this work for additional\n+ * information regarding copyright ownership.\n+ *\n+ * The Apereo Foundation licenses this file to you under the Apache License,\n+ * Version 2.0, (the \"License\"); you may not use this file except in compliance\n+ * with the License. You may obtain a copy of the License at:\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+import * as React from \"react\";\n+import { makeStyles } from \"@material-ui/core/styles\";\n+import { Theme } from \"@material-ui/core\";\n+import * as OEQ from \"@openequella/rest-api-client\";\n+import {\n+  Link as LinkIcon,\n+  Movie as VideoIcon,\n+  Panorama as ImageIcon,\n+  InsertDriveFile as DefaultFileIcon,\n+  Language as WebIcon,\n+} from \"@material-ui/icons\";\n+\n+const useStyles = makeStyles((theme: Theme) => {\n+  return {\n+    thumbnail: {\n+      //if material UI changes such that the MuiPaper-elevation1 MuiPaper-rounded no longer map, add the rules here.\n+      marginRight: theme.spacing(2),\n+      width: \"88px\",\n+      height: \"auto\",\n+    },\n+    placeholderThumbnail: {\n+      color: theme.palette.text.secondary,\n+      opacity: 0.4,\n+      height: \"66px\",\n+    },\n+  };\n+});\n+\n+interface ThumbProps {\n+  className: string;\n+  fontSize: \"inherit\" | \"default\" | \"small\" | \"large\";\n+}\n+/**\n+ * OEQThumb component\n+ * Takes an OEQ.Search.Attachment object as a parameter.\n+ * The thumbnail will be served up from oEQ if the attachment has had a thumbnail generated (Image, video, pdf based files, Youtube, Flickr, Goodle books)\n+ * Otherwise, an appropriate Icon is returned\n+ */\n+export default function OEQThumb({\n+  mimeType,\n+  attachmentType,\n+  hasGeneratedThumb,\n+  description,\n+  links,\n+}: OEQ.Search.Attachment) {\n+  const classes = useStyles();\n+  const generalThumbStyles: ThumbProps = {\n+    className: `MuiPaper-elevation1 MuiPaper-rounded ${classes.thumbnail} ${classes.placeholderThumbnail}`,\n+    fontSize: \"large\",\n+  };\n+  let oeqThumb: React.ReactElement = (\n+    <DefaultFileIcon {...generalThumbStyles} />\n+  );\n+\n+  const oeqProvidedThumb: React.ReactElement = (\n+    <img\n+      className={`MuiPaper-elevation1 MuiPaper-rounded ${classes.thumbnail}`}\n+      src={links.thumbnail}\n+      alt={description}\n+    />\n+  );\n+  /**\n+   * @param {string} mimeType - Attachment's Mimetype. eg. image/png application/pdf\n+   * @return {ReactElement} Image, video and pdf based mimetypes are thumbnailed by oEQ.\n+   * We need to check if a thumbnail has been generated, and return a generic icon if not\n+   */\n+  const handleMimeType = (mimeType?: string): React.ReactElement => {\n+    let result = <DefaultFileIcon {...generalThumbStyles} />;\n+    if (\n+      mimeType?.startsWith(\"image\") ||\n+      mimeType?.startsWith(\"video\") ||\n+      mimeType?.endsWith(\"/pdf\")\n+    ) {\n+      if (hasGeneratedThumb) {\n+        result = oeqProvidedThumb;\n+      } else {\n+        if (mimeType?.startsWith(\"image\")) {\n+          result = <ImageIcon {...generalThumbStyles} />;\n+        } else if (mimeType?.startsWith(\"video\")) {\n+          result = <VideoIcon {...generalThumbStyles} />;\n+        }\n+      }\n+    }", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "3c32874e652a42ea1a996568ecfaec7d2441c96f"}, "originalPosition": 100}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1Njk3NjU5OQ==", "bodyText": "These should all just be a fall-through. E.g.:\n    case \"custom/flickr\":\n    case \"custom/youtube\":\n    case \"custom/googlebook\":\n      oeqThumb = oeqProvidedThumb;\n      break;\nAlso note, no need for the braces on your case statements. (Both here and in the rest of this switch.)", "url": "https://github.com/openequella/openEQUELLA/pull/2075#discussion_r456976599", "createdAt": "2020-07-20T00:34:58Z", "author": {"login": "edalex-ian"}, "path": "Source/Plugins/Core/com.equella.core/js/tsrc/search/components/OEQThumb.tsx", "diffHunk": "@@ -0,0 +1,131 @@\n+/*\n+ * Licensed to The Apereo Foundation under one or more contributor license\n+ * agreements. See the NOTICE file distributed with this work for additional\n+ * information regarding copyright ownership.\n+ *\n+ * The Apereo Foundation licenses this file to you under the Apache License,\n+ * Version 2.0, (the \"License\"); you may not use this file except in compliance\n+ * with the License. You may obtain a copy of the License at:\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+import * as React from \"react\";\n+import { makeStyles } from \"@material-ui/core/styles\";\n+import { Theme } from \"@material-ui/core\";\n+import * as OEQ from \"@openequella/rest-api-client\";\n+import {\n+  Link as LinkIcon,\n+  Movie as VideoIcon,\n+  Panorama as ImageIcon,\n+  InsertDriveFile as DefaultFileIcon,\n+  Language as WebIcon,\n+} from \"@material-ui/icons\";\n+\n+const useStyles = makeStyles((theme: Theme) => {\n+  return {\n+    thumbnail: {\n+      //if material UI changes such that the MuiPaper-elevation1 MuiPaper-rounded no longer map, add the rules here.\n+      marginRight: theme.spacing(2),\n+      width: \"88px\",\n+      height: \"auto\",\n+    },\n+    placeholderThumbnail: {\n+      color: theme.palette.text.secondary,\n+      opacity: 0.4,\n+      height: \"66px\",\n+    },\n+  };\n+});\n+\n+interface ThumbProps {\n+  className: string;\n+  fontSize: \"inherit\" | \"default\" | \"small\" | \"large\";\n+}\n+/**\n+ * OEQThumb component\n+ * Takes an OEQ.Search.Attachment object as a parameter.\n+ * The thumbnail will be served up from oEQ if the attachment has had a thumbnail generated (Image, video, pdf based files, Youtube, Flickr, Goodle books)\n+ * Otherwise, an appropriate Icon is returned\n+ */\n+export default function OEQThumb({\n+  mimeType,\n+  attachmentType,\n+  hasGeneratedThumb,\n+  description,\n+  links,\n+}: OEQ.Search.Attachment) {\n+  const classes = useStyles();\n+  const generalThumbStyles: ThumbProps = {\n+    className: `MuiPaper-elevation1 MuiPaper-rounded ${classes.thumbnail} ${classes.placeholderThumbnail}`,\n+    fontSize: \"large\",\n+  };\n+  let oeqThumb: React.ReactElement = (\n+    <DefaultFileIcon {...generalThumbStyles} />\n+  );\n+\n+  const oeqProvidedThumb: React.ReactElement = (\n+    <img\n+      className={`MuiPaper-elevation1 MuiPaper-rounded ${classes.thumbnail}`}\n+      src={links.thumbnail}\n+      alt={description}\n+    />\n+  );\n+  /**\n+   * @param {string} mimeType - Attachment's Mimetype. eg. image/png application/pdf\n+   * @return {ReactElement} Image, video and pdf based mimetypes are thumbnailed by oEQ.\n+   * We need to check if a thumbnail has been generated, and return a generic icon if not\n+   */\n+  const handleMimeType = (mimeType?: string): React.ReactElement => {\n+    let result = <DefaultFileIcon {...generalThumbStyles} />;\n+    if (\n+      mimeType?.startsWith(\"image\") ||\n+      mimeType?.startsWith(\"video\") ||\n+      mimeType?.endsWith(\"/pdf\")\n+    ) {\n+      if (hasGeneratedThumb) {\n+        result = oeqProvidedThumb;\n+      } else {\n+        if (mimeType?.startsWith(\"image\")) {\n+          result = <ImageIcon {...generalThumbStyles} />;\n+        } else if (mimeType?.startsWith(\"video\")) {\n+          result = <VideoIcon {...generalThumbStyles} />;\n+        }\n+      }\n+    }\n+    return result;\n+  };\n+\n+  switch (attachmentType) {\n+    case \"file\": {\n+      oeqThumb = handleMimeType(mimeType);\n+      break;\n+    }\n+    case \"link\": {\n+      oeqThumb = <LinkIcon {...generalThumbStyles} />;\n+      break;\n+    }\n+    case \"custom/flickr\": {\n+      oeqThumb = oeqProvidedThumb;\n+      break;\n+    }\n+    case \"custom/youtube\": {\n+      oeqThumb = oeqProvidedThumb;\n+      break;\n+    }\n+    case \"custom/googlebook\": {\n+      oeqThumb = oeqProvidedThumb;\n+      break;\n+    }", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "3c32874e652a42ea1a996568ecfaec7d2441c96f"}, "originalPosition": 124}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1Njk3Njc0Nw==", "bodyText": "Seeing this is a variable, it makes sense to keep down next to where it's changed/used - i.e. down near the switch statement.", "url": "https://github.com/openequella/openEQUELLA/pull/2075#discussion_r456976747", "createdAt": "2020-07-20T00:36:15Z", "author": {"login": "edalex-ian"}, "path": "Source/Plugins/Core/com.equella.core/js/tsrc/search/components/OEQThumb.tsx", "diffHunk": "@@ -0,0 +1,131 @@\n+/*\n+ * Licensed to The Apereo Foundation under one or more contributor license\n+ * agreements. See the NOTICE file distributed with this work for additional\n+ * information regarding copyright ownership.\n+ *\n+ * The Apereo Foundation licenses this file to you under the Apache License,\n+ * Version 2.0, (the \"License\"); you may not use this file except in compliance\n+ * with the License. You may obtain a copy of the License at:\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+import * as React from \"react\";\n+import { makeStyles } from \"@material-ui/core/styles\";\n+import { Theme } from \"@material-ui/core\";\n+import * as OEQ from \"@openequella/rest-api-client\";\n+import {\n+  Link as LinkIcon,\n+  Movie as VideoIcon,\n+  Panorama as ImageIcon,\n+  InsertDriveFile as DefaultFileIcon,\n+  Language as WebIcon,\n+} from \"@material-ui/icons\";\n+\n+const useStyles = makeStyles((theme: Theme) => {\n+  return {\n+    thumbnail: {\n+      //if material UI changes such that the MuiPaper-elevation1 MuiPaper-rounded no longer map, add the rules here.\n+      marginRight: theme.spacing(2),\n+      width: \"88px\",\n+      height: \"auto\",\n+    },\n+    placeholderThumbnail: {\n+      color: theme.palette.text.secondary,\n+      opacity: 0.4,\n+      height: \"66px\",\n+    },\n+  };\n+});\n+\n+interface ThumbProps {\n+  className: string;\n+  fontSize: \"inherit\" | \"default\" | \"small\" | \"large\";\n+}\n+/**\n+ * OEQThumb component\n+ * Takes an OEQ.Search.Attachment object as a parameter.\n+ * The thumbnail will be served up from oEQ if the attachment has had a thumbnail generated (Image, video, pdf based files, Youtube, Flickr, Goodle books)\n+ * Otherwise, an appropriate Icon is returned\n+ */\n+export default function OEQThumb({\n+  mimeType,\n+  attachmentType,\n+  hasGeneratedThumb,\n+  description,\n+  links,\n+}: OEQ.Search.Attachment) {\n+  const classes = useStyles();\n+  const generalThumbStyles: ThumbProps = {\n+    className: `MuiPaper-elevation1 MuiPaper-rounded ${classes.thumbnail} ${classes.placeholderThumbnail}`,\n+    fontSize: \"large\",\n+  };\n+  let oeqThumb: React.ReactElement = (\n+    <DefaultFileIcon {...generalThumbStyles} />\n+  );", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "3c32874e652a42ea1a996568ecfaec7d2441c96f"}, "originalPosition": 70}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1Njk3NzAxMw==", "bodyText": "So it's interesting to have this duplicated here to match the oEQThumb. Is there something that can be done about this?\nI'm kind of wondering if maybe the generation of the 'placeholder' is also part of OEQThumb.", "url": "https://github.com/openequella/openEQUELLA/pull/2075#discussion_r456977013", "createdAt": "2020-07-20T00:38:28Z", "author": {"login": "edalex-ian"}, "path": "Source/Plugins/Core/com.equella.core/js/tsrc/search/components/SearchResult.tsx", "diffHunk": "@@ -60,6 +61,8 @@ const useStyles = makeStyles((theme: Theme) => {\n     },\n     placeholderThumbnail: {\n       color: theme.palette.text.secondary,\n+      opacity: 0.4,\n+      height: \"66px\",\n     },", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "3c32874e652a42ea1a996568ecfaec7d2441c96f"}, "originalPosition": 14}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1Njk3NzU2Mg==", "bodyText": "Based on what you have here, we'd really just expect a ternary statement. Such as:\nconst thumbnail = (disableThumb: boolean): React.ReactElement =>\n  (attachments.length > 0 && !disableThumb)\n    ? <Subject\n        className={`MuiPaper-elevation1 MuiPaper-rounded ${classes.placeholderThumbnail} ${classes.thumbnail}`}\n        fontSize=\"large\"\n      />\n    : <OEQThumb {...attachments[0]} />;\nBut as noted above, maybe this functionality is simply part of OEQThumb. \ud83e\udd14", "url": "https://github.com/openequella/openEQUELLA/pull/2075#discussion_r456977562", "createdAt": "2020-07-20T00:42:28Z", "author": {"login": "edalex-ian"}, "path": "Source/Plugins/Core/com.equella.core/js/tsrc/search/components/SearchResult.tsx", "diffHunk": "@@ -116,24 +119,16 @@ export default function SearchResult({\n    * Otherwise, return a placeholder icon, to ensure a consistent layout\n    */\n   const thumbnail = (disableThumb: boolean): React.ReactElement => {\n-    let result: any;\n+    let thumb: any = (\n+      <Subject\n+        className={`MuiPaper-elevation1 MuiPaper-rounded ${classes.placeholderThumbnail} ${classes.thumbnail}`}\n+        fontSize=\"large\"\n+      />\n+    );\n     if (attachments.length > 0 && !disableThumb) {\n-      result = (\n-        <img\n-          className={`MuiPaper-elevation1 MuiPaper-rounded ${classes.thumbnail}`}\n-          src={attachments[0].links.thumbnail}\n-          alt={attachments[0].description}\n-        />\n-      );\n-    } else {\n-      result = (\n-        <Subject\n-          className={`MuiPaper-elevation1 MuiPaper-rounded ${classes.placeholderThumbnail} ${classes.thumbnail}`}\n-          fontSize=\"large\"\n-        />\n-      );\n+      thumb = <OEQThumb {...attachments[0]} />;\n     }\n-    return result;\n+    return thumb;\n   };", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "3c32874e652a42ea1a996568ecfaec7d2441c96f"}, "originalPosition": 47}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1Njk3ODU5Ng==", "bodyText": "Can you simply combine these three lines to the more pipeline approach of:\nOption(fileBean.getThumbnail).map { LegacyGuice.fileSystemService.fileExists(item.getFileHandle, _) }", "url": "https://github.com/openequella/openEQUELLA/pull/2075#discussion_r456978596", "createdAt": "2020-07-20T00:49:53Z", "author": {"login": "edalex-ian"}, "path": "Source/Plugins/Core/com.equella.core/scalasrc/com/tle/web/api/search/SearchHelper.scala", "diffHunk": "@@ -224,10 +224,13 @@ object SearchHelper {\n     * Determines if attachment contains a generated thumbnail in filestore\n     */\n   def thumbExists(itemKey: ItemIdKey, attachBean: AttachmentBean): Option[Boolean] = {\n+\n     attachBean match {\n       case fileBean: FileAttachmentBean =>\n-        val item = LegacyGuice.viewableItemFactory.createNewViewableItem(itemKey)\n-        Some(LegacyGuice.fileSystemService.fileExists(item.getFileHandle, fileBean.getThumbnail))\n+        val item  = LegacyGuice.viewableItemFactory.createNewViewableItem(itemKey)\n+        val thumb = fileBean.getThumbnail\n+        if (thumb == null) Some(false)\n+        else Some(LegacyGuice.fileSystemService.fileExists(item.getFileHandle, thumb))", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "3c32874e652a42ea1a996568ecfaec7d2441c96f"}, "originalPosition": 12}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDUxMTk1NTk1", "url": "https://github.com/openequella/openEQUELLA/pull/2075#pullrequestreview-451195595", "createdAt": "2020-07-20T01:02:33Z", "commit": {"oid": "3c32874e652a42ea1a996568ecfaec7d2441c96f"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yMFQwMTowMjozM1rOGzz33A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yMFQwMToxMjoyNVrOGzz9sA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1Njk4MDQ0NA==", "bodyText": "should this height rule be in thumbnail above? Or are true oEQ thumbnails sometimes different to that?", "url": "https://github.com/openequella/openEQUELLA/pull/2075#discussion_r456980444", "createdAt": "2020-07-20T01:02:33Z", "author": {"login": "SammyIsConfused"}, "path": "Source/Plugins/Core/com.equella.core/js/tsrc/search/components/OEQThumb.tsx", "diffHunk": "@@ -0,0 +1,131 @@\n+/*\n+ * Licensed to The Apereo Foundation under one or more contributor license\n+ * agreements. See the NOTICE file distributed with this work for additional\n+ * information regarding copyright ownership.\n+ *\n+ * The Apereo Foundation licenses this file to you under the Apache License,\n+ * Version 2.0, (the \"License\"); you may not use this file except in compliance\n+ * with the License. You may obtain a copy of the License at:\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+import * as React from \"react\";\n+import { makeStyles } from \"@material-ui/core/styles\";\n+import { Theme } from \"@material-ui/core\";\n+import * as OEQ from \"@openequella/rest-api-client\";\n+import {\n+  Link as LinkIcon,\n+  Movie as VideoIcon,\n+  Panorama as ImageIcon,\n+  InsertDriveFile as DefaultFileIcon,\n+  Language as WebIcon,\n+} from \"@material-ui/icons\";\n+\n+const useStyles = makeStyles((theme: Theme) => {\n+  return {\n+    thumbnail: {\n+      //if material UI changes such that the MuiPaper-elevation1 MuiPaper-rounded no longer map, add the rules here.\n+      marginRight: theme.spacing(2),\n+      width: \"88px\",\n+      height: \"auto\",\n+    },\n+    placeholderThumbnail: {\n+      color: theme.palette.text.secondary,\n+      opacity: 0.4,\n+      height: \"66px\",", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "3c32874e652a42ea1a996568ecfaec7d2441c96f"}, "originalPosition": 41}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1Njk4MTM0NA==", "bodyText": "This can be typed as ReactElement.", "url": "https://github.com/openequella/openEQUELLA/pull/2075#discussion_r456981344", "createdAt": "2020-07-20T01:08:48Z", "author": {"login": "SammyIsConfused"}, "path": "Source/Plugins/Core/com.equella.core/js/tsrc/search/components/SearchResult.tsx", "diffHunk": "@@ -116,24 +119,16 @@ export default function SearchResult({\n    * Otherwise, return a placeholder icon, to ensure a consistent layout\n    */\n   const thumbnail = (disableThumb: boolean): React.ReactElement => {\n-    let result: any;\n+    let thumb: any = (", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "3c32874e652a42ea1a996568ecfaec7d2441c96f"}, "originalPosition": 22}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1Njk4MTkzNg==", "bodyText": "You have a stray \"Goodle\" in here :P\n\n  \n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n             * The thumbnail will be served up from oEQ if the attachment has had a thumbnail generated (Image, video, pdf based files, Youtube, Flickr, Goodle books)\n          \n          \n            \n             * The thumbnail will be served up from oEQ if the attachment has had a thumbnail generated (Image, video, PDF based files, YouTube, Flickr, Google books)", "url": "https://github.com/openequella/openEQUELLA/pull/2075#discussion_r456981936", "createdAt": "2020-07-20T01:12:25Z", "author": {"login": "SammyIsConfused"}, "path": "Source/Plugins/Core/com.equella.core/js/tsrc/search/components/OEQThumb.tsx", "diffHunk": "@@ -0,0 +1,131 @@\n+/*\n+ * Licensed to The Apereo Foundation under one or more contributor license\n+ * agreements. See the NOTICE file distributed with this work for additional\n+ * information regarding copyright ownership.\n+ *\n+ * The Apereo Foundation licenses this file to you under the Apache License,\n+ * Version 2.0, (the \"License\"); you may not use this file except in compliance\n+ * with the License. You may obtain a copy of the License at:\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+import * as React from \"react\";\n+import { makeStyles } from \"@material-ui/core/styles\";\n+import { Theme } from \"@material-ui/core\";\n+import * as OEQ from \"@openequella/rest-api-client\";\n+import {\n+  Link as LinkIcon,\n+  Movie as VideoIcon,\n+  Panorama as ImageIcon,\n+  InsertDriveFile as DefaultFileIcon,\n+  Language as WebIcon,\n+} from \"@material-ui/icons\";\n+\n+const useStyles = makeStyles((theme: Theme) => {\n+  return {\n+    thumbnail: {\n+      //if material UI changes such that the MuiPaper-elevation1 MuiPaper-rounded no longer map, add the rules here.\n+      marginRight: theme.spacing(2),\n+      width: \"88px\",\n+      height: \"auto\",\n+    },\n+    placeholderThumbnail: {\n+      color: theme.palette.text.secondary,\n+      opacity: 0.4,\n+      height: \"66px\",\n+    },\n+  };\n+});\n+\n+interface ThumbProps {\n+  className: string;\n+  fontSize: \"inherit\" | \"default\" | \"small\" | \"large\";\n+}\n+/**\n+ * OEQThumb component\n+ * Takes an OEQ.Search.Attachment object as a parameter.\n+ * The thumbnail will be served up from oEQ if the attachment has had a thumbnail generated (Image, video, pdf based files, Youtube, Flickr, Goodle books)", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "3c32874e652a42ea1a996568ecfaec7d2441c96f"}, "originalPosition": 53}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e83e330c3a0bad0b3884d37cd382f499d178d83a", "author": {"user": {"login": "mrblippy", "name": "Nick Charles"}}, "url": "https://github.com/openequella/openEQUELLA/commit/e83e330c3a0bad0b3884d37cd382f499d178d83a", "committedDate": "2020-07-20T03:14:21Z", "message": "Map on FileAttachmentBean's thumbnail value"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDUxMjg2MzAw", "url": "https://github.com/openequella/openEQUELLA/pull/2075#pullrequestreview-451286300", "createdAt": "2020-07-20T04:20:28Z", "commit": {"oid": "3c32874e652a42ea1a996568ecfaec7d2441c96f"}, "state": "COMMENTED", "comments": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yMFQwNDoyMDoyOVrOGz3LKw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yMFQwNDoyNDo1N1rOGz3Tig==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NzAzNDUzOQ==", "bodyText": "numbers are automatically px in material ui\n\n  \n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                  width: \"88px\",\n          \n          \n            \n                  width: 88,", "url": "https://github.com/openequella/openEQUELLA/pull/2075#discussion_r457034539", "createdAt": "2020-07-20T04:20:29Z", "author": {"login": "ChristianMurphy"}, "path": "Source/Plugins/Core/com.equella.core/js/tsrc/search/components/OEQThumb.tsx", "diffHunk": "@@ -0,0 +1,131 @@\n+/*\n+ * Licensed to The Apereo Foundation under one or more contributor license\n+ * agreements. See the NOTICE file distributed with this work for additional\n+ * information regarding copyright ownership.\n+ *\n+ * The Apereo Foundation licenses this file to you under the Apache License,\n+ * Version 2.0, (the \"License\"); you may not use this file except in compliance\n+ * with the License. You may obtain a copy of the License at:\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+import * as React from \"react\";\n+import { makeStyles } from \"@material-ui/core/styles\";\n+import { Theme } from \"@material-ui/core\";\n+import * as OEQ from \"@openequella/rest-api-client\";\n+import {\n+  Link as LinkIcon,\n+  Movie as VideoIcon,\n+  Panorama as ImageIcon,\n+  InsertDriveFile as DefaultFileIcon,\n+  Language as WebIcon,\n+} from \"@material-ui/icons\";\n+\n+const useStyles = makeStyles((theme: Theme) => {\n+  return {\n+    thumbnail: {\n+      //if material UI changes such that the MuiPaper-elevation1 MuiPaper-rounded no longer map, add the rules here.\n+      marginRight: theme.spacing(2),\n+      width: \"88px\",", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "3c32874e652a42ea1a996568ecfaec7d2441c96f"}, "originalPosition": 35}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NzAzNTA1Mw==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n               * @param {string} mimeType - Attachment's Mimetype. eg. image/png application/pdf\n          \n          \n            \n               * @return {ReactElement} Image, video and pdf based mimetypes are thumbnailed by oEQ.\n          \n          \n            \n               * We need to check if a thumbnail has been generated, and return a generic icon if not\n          \n          \n            \n               * We need to check if a thumbnail has been generated, and return a generic icon if not\n          \n          \n            \n               *\n          \n          \n            \n               * @param {string} mimeType - Attachment's Mimetype. eg. image/png application/pdf\n          \n          \n            \n               * @return {ReactElement} Image, video and pdf based mimetypes are thumbnailed by oEQ.", "url": "https://github.com/openequella/openEQUELLA/pull/2075#discussion_r457035053", "createdAt": "2020-07-20T04:21:40Z", "author": {"login": "ChristianMurphy"}, "path": "Source/Plugins/Core/com.equella.core/js/tsrc/search/components/OEQThumb.tsx", "diffHunk": "@@ -0,0 +1,131 @@\n+/*\n+ * Licensed to The Apereo Foundation under one or more contributor license\n+ * agreements. See the NOTICE file distributed with this work for additional\n+ * information regarding copyright ownership.\n+ *\n+ * The Apereo Foundation licenses this file to you under the Apache License,\n+ * Version 2.0, (the \"License\"); you may not use this file except in compliance\n+ * with the License. You may obtain a copy of the License at:\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+import * as React from \"react\";\n+import { makeStyles } from \"@material-ui/core/styles\";\n+import { Theme } from \"@material-ui/core\";\n+import * as OEQ from \"@openequella/rest-api-client\";\n+import {\n+  Link as LinkIcon,\n+  Movie as VideoIcon,\n+  Panorama as ImageIcon,\n+  InsertDriveFile as DefaultFileIcon,\n+  Language as WebIcon,\n+} from \"@material-ui/icons\";\n+\n+const useStyles = makeStyles((theme: Theme) => {\n+  return {\n+    thumbnail: {\n+      //if material UI changes such that the MuiPaper-elevation1 MuiPaper-rounded no longer map, add the rules here.\n+      marginRight: theme.spacing(2),\n+      width: \"88px\",\n+      height: \"auto\",\n+    },\n+    placeholderThumbnail: {\n+      color: theme.palette.text.secondary,\n+      opacity: 0.4,\n+      height: \"66px\",\n+    },\n+  };\n+});\n+\n+interface ThumbProps {\n+  className: string;\n+  fontSize: \"inherit\" | \"default\" | \"small\" | \"large\";\n+}\n+/**\n+ * OEQThumb component\n+ * Takes an OEQ.Search.Attachment object as a parameter.\n+ * The thumbnail will be served up from oEQ if the attachment has had a thumbnail generated (Image, video, pdf based files, Youtube, Flickr, Goodle books)\n+ * Otherwise, an appropriate Icon is returned\n+ */\n+export default function OEQThumb({\n+  mimeType,\n+  attachmentType,\n+  hasGeneratedThumb,\n+  description,\n+  links,\n+}: OEQ.Search.Attachment) {\n+  const classes = useStyles();\n+  const generalThumbStyles: ThumbProps = {\n+    className: `MuiPaper-elevation1 MuiPaper-rounded ${classes.thumbnail} ${classes.placeholderThumbnail}`,\n+    fontSize: \"large\",\n+  };\n+  let oeqThumb: React.ReactElement = (\n+    <DefaultFileIcon {...generalThumbStyles} />\n+  );\n+\n+  const oeqProvidedThumb: React.ReactElement = (\n+    <img\n+      className={`MuiPaper-elevation1 MuiPaper-rounded ${classes.thumbnail}`}\n+      src={links.thumbnail}\n+      alt={description}\n+    />\n+  );\n+  /**\n+   * @param {string} mimeType - Attachment's Mimetype. eg. image/png application/pdf\n+   * @return {ReactElement} Image, video and pdf based mimetypes are thumbnailed by oEQ.\n+   * We need to check if a thumbnail has been generated, and return a generic icon if not", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "3c32874e652a42ea1a996568ecfaec7d2441c96f"}, "originalPosition": 82}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NzAzNTkwNA==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                  height: \"66px\",\n          \n          \n            \n                  height: 66,", "url": "https://github.com/openequella/openEQUELLA/pull/2075#discussion_r457035904", "createdAt": "2020-07-20T04:23:41Z", "author": {"login": "ChristianMurphy"}, "path": "Source/Plugins/Core/com.equella.core/js/tsrc/search/components/SearchResult.tsx", "diffHunk": "@@ -60,6 +61,8 @@ const useStyles = makeStyles((theme: Theme) => {\n     },\n     placeholderThumbnail: {\n       color: theme.palette.text.secondary,\n+      opacity: 0.4,\n+      height: \"66px\",", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "3c32874e652a42ea1a996568ecfaec7d2441c96f"}, "originalPosition": 13}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NzAzNjY4Mg==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                  height: \"66px\",\n          \n          \n            \n                  height: 66,", "url": "https://github.com/openequella/openEQUELLA/pull/2075#discussion_r457036682", "createdAt": "2020-07-20T04:24:57Z", "author": {"login": "ChristianMurphy"}, "path": "Source/Plugins/Core/com.equella.core/js/tsrc/search/components/OEQThumb.tsx", "diffHunk": "@@ -0,0 +1,131 @@\n+/*\n+ * Licensed to The Apereo Foundation under one or more contributor license\n+ * agreements. See the NOTICE file distributed with this work for additional\n+ * information regarding copyright ownership.\n+ *\n+ * The Apereo Foundation licenses this file to you under the Apache License,\n+ * Version 2.0, (the \"License\"); you may not use this file except in compliance\n+ * with the License. You may obtain a copy of the License at:\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+import * as React from \"react\";\n+import { makeStyles } from \"@material-ui/core/styles\";\n+import { Theme } from \"@material-ui/core\";\n+import * as OEQ from \"@openequella/rest-api-client\";\n+import {\n+  Link as LinkIcon,\n+  Movie as VideoIcon,\n+  Panorama as ImageIcon,\n+  InsertDriveFile as DefaultFileIcon,\n+  Language as WebIcon,\n+} from \"@material-ui/icons\";\n+\n+const useStyles = makeStyles((theme: Theme) => {\n+  return {\n+    thumbnail: {\n+      //if material UI changes such that the MuiPaper-elevation1 MuiPaper-rounded no longer map, add the rules here.\n+      marginRight: theme.spacing(2),\n+      width: \"88px\",\n+      height: \"auto\",\n+    },\n+    placeholderThumbnail: {\n+      color: theme.palette.text.secondary,\n+      opacity: 0.4,\n+      height: \"66px\",", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "3c32874e652a42ea1a996568ecfaec7d2441c96f"}, "originalPosition": 41}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a41ba2c62a104ee4621c48f00e222707f05b1799", "author": {"user": {"login": "mrblippy", "name": "Nick Charles"}}, "url": "https://github.com/openequella/openEQUELLA/commit/a41ba2c62a104ee4621c48f00e222707f05b1799", "committedDate": "2020-07-21T05:16:16Z", "message": "Rework logic inside of OEQThumb component\n\n- Make attachment prop optional, which allows the PlaceholderIcon to be moved from SearchResult to OEQthumb. Simplify switch statement to aid in readability\n- Fix typos in javadoc"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ec02bf01e68aec3cfceec9b060cbbf11a7c8a482", "author": {"user": {"login": "mrblippy", "name": "Nick Charles"}}, "url": "https://github.com/openequella/openEQUELLA/commit/ec02bf01e68aec3cfceec9b060cbbf11a7c8a482", "committedDate": "2020-07-21T05:36:13Z", "message": "Move OEQThumb component into regular components directory, since it makes more sense for it to live there."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "8da127c4ce62a3bd2e54d27629dd72851c473a61", "author": {"user": {"login": "mrblippy", "name": "Nick Charles"}}, "url": "https://github.com/openequella/openEQUELLA/commit/8da127c4ce62a3bd2e54d27629dd72851c473a61", "committedDate": "2020-07-21T05:55:06Z", "message": "Document OEQThumb props"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDUyMTUxNzA1", "url": "https://github.com/openequella/openEQUELLA/pull/2075#pullrequestreview-452151705", "createdAt": "2020-07-21T06:09:55Z", "commit": {"oid": "8da127c4ce62a3bd2e54d27629dd72851c473a61"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yMVQwNjowOTo1NlrOG0peMQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yMVQwNjoxODoxMVrOG0ppaA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1Nzg1ODYwOQ==", "bodyText": "Nit: can we have a blank line here please?", "url": "https://github.com/openequella/openEQUELLA/pull/2075#discussion_r457858609", "createdAt": "2020-07-21T06:09:56Z", "author": {"login": "edalex-ian"}, "path": "Source/Plugins/Core/com.equella.core/js/tsrc/components/OEQThumb.tsx", "diffHunk": "@@ -0,0 +1,144 @@\n+/*\n+ * Licensed to The Apereo Foundation under one or more contributor license\n+ * agreements. See the NOTICE file distributed with this work for additional\n+ * information regarding copyright ownership.\n+ *\n+ * The Apereo Foundation licenses this file to you under the Apache License,\n+ * Version 2.0, (the \"License\"); you may not use this file except in compliance\n+ * with the License. You may obtain a copy of the License at:\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+import * as React from \"react\";\n+import { makeStyles } from \"@material-ui/core/styles\";\n+import { Theme } from \"@material-ui/core\";\n+import * as OEQ from \"@openequella/rest-api-client\";\n+import {\n+  Link as LinkIcon,\n+  Movie as VideoIcon,\n+  Panorama as ImageIcon,\n+  InsertDriveFile as DefaultFileIcon,\n+  Language as WebIcon,\n+  Subject as PlaceholderIcon,\n+} from \"@material-ui/icons\";\n+\n+const useStyles = makeStyles((theme: Theme) => {\n+  return {\n+    thumbnail: {\n+      //if material UI changes such that the MuiPaper-elevation1 MuiPaper-rounded no longer map, add the rules here.\n+      marginRight: theme.spacing(2),\n+      width: \"88\",\n+      height: \"auto\",\n+    },\n+    placeholderThumbnail: {\n+      color: theme.palette.text.secondary,\n+      opacity: 0.4,\n+      height: \"66\",\n+    },\n+  };\n+});\n+\n+interface ThumbProps {\n+  className: string;\n+  fontSize: \"inherit\" | \"default\" | \"small\" | \"large\";\n+}\n+interface OEQThumbProps {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "8da127c4ce62a3bd2e54d27629dd72851c473a61"}, "originalPosition": 51}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1Nzg1ODcwNA==", "bodyText": "Nit: and another above here?", "url": "https://github.com/openequella/openEQUELLA/pull/2075#discussion_r457858704", "createdAt": "2020-07-21T06:10:11Z", "author": {"login": "edalex-ian"}, "path": "Source/Plugins/Core/com.equella.core/js/tsrc/components/OEQThumb.tsx", "diffHunk": "@@ -0,0 +1,144 @@\n+/*\n+ * Licensed to The Apereo Foundation under one or more contributor license\n+ * agreements. See the NOTICE file distributed with this work for additional\n+ * information regarding copyright ownership.\n+ *\n+ * The Apereo Foundation licenses this file to you under the Apache License,\n+ * Version 2.0, (the \"License\"); you may not use this file except in compliance\n+ * with the License. You may obtain a copy of the License at:\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+import * as React from \"react\";\n+import { makeStyles } from \"@material-ui/core/styles\";\n+import { Theme } from \"@material-ui/core\";\n+import * as OEQ from \"@openequella/rest-api-client\";\n+import {\n+  Link as LinkIcon,\n+  Movie as VideoIcon,\n+  Panorama as ImageIcon,\n+  InsertDriveFile as DefaultFileIcon,\n+  Language as WebIcon,\n+  Subject as PlaceholderIcon,\n+} from \"@material-ui/icons\";\n+\n+const useStyles = makeStyles((theme: Theme) => {\n+  return {\n+    thumbnail: {\n+      //if material UI changes such that the MuiPaper-elevation1 MuiPaper-rounded no longer map, add the rules here.\n+      marginRight: theme.spacing(2),\n+      width: \"88\",\n+      height: \"auto\",\n+    },\n+    placeholderThumbnail: {\n+      color: theme.palette.text.secondary,\n+      opacity: 0.4,\n+      height: \"66\",\n+    },\n+  };\n+});\n+\n+interface ThumbProps {\n+  className: string;\n+  fontSize: \"inherit\" | \"default\" | \"small\" | \"large\";\n+}\n+interface OEQThumbProps {\n+  /**\n+   * On object representing an oEQ attachment. If undefined, a placeholder icon is returned\n+   */\n+  attachment?: OEQ.Search.Attachment;\n+  /**\n+   * True indicates that a placeholder icon should be used instead of the 'real' thumbnail\n+   */\n+  showPlaceholder: boolean;\n+}\n+/**", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "8da127c4ce62a3bd2e54d27629dd72851c473a61"}, "originalPosition": 61}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1Nzg1OTU4Mw==", "bodyText": "To make things simpler later, how about here you just go with:\n\n  \n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n              if (!attachment) {\n          \n          \n            \n              if (!attachment || showPlaceholder) {", "url": "https://github.com/openequella/openEQUELLA/pull/2075#discussion_r457859583", "createdAt": "2020-07-21T06:12:50Z", "author": {"login": "edalex-ian"}, "path": "Source/Plugins/Core/com.equella.core/js/tsrc/components/OEQThumb.tsx", "diffHunk": "@@ -0,0 +1,144 @@\n+/*\n+ * Licensed to The Apereo Foundation under one or more contributor license\n+ * agreements. See the NOTICE file distributed with this work for additional\n+ * information regarding copyright ownership.\n+ *\n+ * The Apereo Foundation licenses this file to you under the Apache License,\n+ * Version 2.0, (the \"License\"); you may not use this file except in compliance\n+ * with the License. You may obtain a copy of the License at:\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+import * as React from \"react\";\n+import { makeStyles } from \"@material-ui/core/styles\";\n+import { Theme } from \"@material-ui/core\";\n+import * as OEQ from \"@openequella/rest-api-client\";\n+import {\n+  Link as LinkIcon,\n+  Movie as VideoIcon,\n+  Panorama as ImageIcon,\n+  InsertDriveFile as DefaultFileIcon,\n+  Language as WebIcon,\n+  Subject as PlaceholderIcon,\n+} from \"@material-ui/icons\";\n+\n+const useStyles = makeStyles((theme: Theme) => {\n+  return {\n+    thumbnail: {\n+      //if material UI changes such that the MuiPaper-elevation1 MuiPaper-rounded no longer map, add the rules here.\n+      marginRight: theme.spacing(2),\n+      width: \"88\",\n+      height: \"auto\",\n+    },\n+    placeholderThumbnail: {\n+      color: theme.palette.text.secondary,\n+      opacity: 0.4,\n+      height: \"66\",\n+    },\n+  };\n+});\n+\n+interface ThumbProps {\n+  className: string;\n+  fontSize: \"inherit\" | \"default\" | \"small\" | \"large\";\n+}\n+interface OEQThumbProps {\n+  /**\n+   * On object representing an oEQ attachment. If undefined, a placeholder icon is returned\n+   */\n+  attachment?: OEQ.Search.Attachment;\n+  /**\n+   * True indicates that a placeholder icon should be used instead of the 'real' thumbnail\n+   */\n+  showPlaceholder: boolean;\n+}\n+/**\n+ * OEQThumb component\n+ * Takes an OEQ.Search.Attachment object as a parameter.\n+ * The thumbnail will be served up from oEQ if the attachment has had a thumbnail generated (Image, video, pdf based files, Youtube, Flickr, Google books)\n+ * Otherwise, an appropriate Icon is returned\n+ */\n+export default function OEQThumb({\n+  attachment,\n+  showPlaceholder,\n+}: OEQThumbProps) {\n+  const classes = useStyles();\n+  const generalThumbStyles: ThumbProps = {\n+    className: `MuiPaper-elevation1 MuiPaper-rounded ${classes.thumbnail} ${classes.placeholderThumbnail}`,\n+    fontSize: \"large\",\n+  };\n+\n+  if (!attachment) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "8da127c4ce62a3bd2e54d27629dd72851c473a61"}, "originalPosition": 77}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1Nzg2MTQ4MA==", "bodyText": "Couple of things here:\n\nWith my suggestion above regarding showPlaceholder, this no longer needs the ternary; and\nYou've now repeated <DefaultFileIcon {...generalThumbStyles} />. You should just move this to a constant up above the handleMimeType function so that you can use it in there and here. (i.e. const defaultThumb = <DefaultFileIcon {...generalThumbStyles} />)\n\nWith that in mind, this block would then just be:\nlet oeqThumb = defaultThumb;", "url": "https://github.com/openequella/openEQUELLA/pull/2075#discussion_r457861480", "createdAt": "2020-07-21T06:18:11Z", "author": {"login": "edalex-ian"}, "path": "Source/Plugins/Core/com.equella.core/js/tsrc/components/OEQThumb.tsx", "diffHunk": "@@ -0,0 +1,144 @@\n+/*\n+ * Licensed to The Apereo Foundation under one or more contributor license\n+ * agreements. See the NOTICE file distributed with this work for additional\n+ * information regarding copyright ownership.\n+ *\n+ * The Apereo Foundation licenses this file to you under the Apache License,\n+ * Version 2.0, (the \"License\"); you may not use this file except in compliance\n+ * with the License. You may obtain a copy of the License at:\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+import * as React from \"react\";\n+import { makeStyles } from \"@material-ui/core/styles\";\n+import { Theme } from \"@material-ui/core\";\n+import * as OEQ from \"@openequella/rest-api-client\";\n+import {\n+  Link as LinkIcon,\n+  Movie as VideoIcon,\n+  Panorama as ImageIcon,\n+  InsertDriveFile as DefaultFileIcon,\n+  Language as WebIcon,\n+  Subject as PlaceholderIcon,\n+} from \"@material-ui/icons\";\n+\n+const useStyles = makeStyles((theme: Theme) => {\n+  return {\n+    thumbnail: {\n+      //if material UI changes such that the MuiPaper-elevation1 MuiPaper-rounded no longer map, add the rules here.\n+      marginRight: theme.spacing(2),\n+      width: \"88\",\n+      height: \"auto\",\n+    },\n+    placeholderThumbnail: {\n+      color: theme.palette.text.secondary,\n+      opacity: 0.4,\n+      height: \"66\",\n+    },\n+  };\n+});\n+\n+interface ThumbProps {\n+  className: string;\n+  fontSize: \"inherit\" | \"default\" | \"small\" | \"large\";\n+}\n+interface OEQThumbProps {\n+  /**\n+   * On object representing an oEQ attachment. If undefined, a placeholder icon is returned\n+   */\n+  attachment?: OEQ.Search.Attachment;\n+  /**\n+   * True indicates that a placeholder icon should be used instead of the 'real' thumbnail\n+   */\n+  showPlaceholder: boolean;\n+}\n+/**\n+ * OEQThumb component\n+ * Takes an OEQ.Search.Attachment object as a parameter.\n+ * The thumbnail will be served up from oEQ if the attachment has had a thumbnail generated (Image, video, pdf based files, Youtube, Flickr, Google books)\n+ * Otherwise, an appropriate Icon is returned\n+ */\n+export default function OEQThumb({\n+  attachment,\n+  showPlaceholder,\n+}: OEQThumbProps) {\n+  const classes = useStyles();\n+  const generalThumbStyles: ThumbProps = {\n+    className: `MuiPaper-elevation1 MuiPaper-rounded ${classes.thumbnail} ${classes.placeholderThumbnail}`,\n+    fontSize: \"large\",\n+  };\n+\n+  if (!attachment) {\n+    return <PlaceholderIcon {...generalThumbStyles} />;\n+  }\n+\n+  const {\n+    description,\n+    mimeType,\n+    attachmentType,\n+    hasGeneratedThumb,\n+    links,\n+  } = attachment;\n+\n+  const oeqProvidedThumb: React.ReactElement = (\n+    <img\n+      className={`MuiPaper-elevation1 MuiPaper-rounded ${classes.thumbnail}`}\n+      src={links.thumbnail}\n+      alt={description}\n+    />\n+  );\n+\n+  /**\n+   * We need to check if a thumbnail has been generated, and return a generic icon if not\n+   * @param {string} mimeType - Attachment's Mimetype. eg. image/png application/pdf\n+   * @return {ReactElement} Image, video and pdf based mimetypes are thumbnailed by oEQ.\n+   */\n+  const handleMimeType = (mimeType?: string): React.ReactElement => {\n+    if (hasGeneratedThumb) {\n+      return oeqProvidedThumb;\n+    }\n+    let result = <DefaultFileIcon {...generalThumbStyles} />;\n+    if (mimeType?.startsWith(\"image\")) {\n+      result = <ImageIcon {...generalThumbStyles} />;\n+    } else if (mimeType?.startsWith(\"video\")) {\n+      result = <VideoIcon {...generalThumbStyles} />;\n+    }\n+    return result;\n+  };\n+\n+  let oeqThumb: React.ReactElement = showPlaceholder ? (\n+    <PlaceholderIcon {...generalThumbStyles} />\n+  ) : (\n+    <DefaultFileIcon {...generalThumbStyles} />\n+  );", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "8da127c4ce62a3bd2e54d27629dd72851c473a61"}, "originalPosition": 119}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "0fea8d2b5641acf4562bedb74d0fb6dbe6a9f4b9", "author": {"user": {"login": "mrblippy", "name": "Nick Charles"}}, "url": "https://github.com/openequella/openEQUELLA/commit/0fea8d2b5641acf4562bedb74d0fb6dbe6a9f4b9", "committedDate": "2020-07-21T06:48:43Z", "message": "Simplify handling of Default and placeholder thumbnails"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "23e19414c746795dbd1d820a3e9e6c3277c948bd", "author": {"user": {"login": "mrblippy", "name": "Nick Charles"}}, "url": "https://github.com/openequella/openEQUELLA/commit/23e19414c746795dbd1d820a3e9e6c3277c948bd", "committedDate": "2020-07-21T07:30:24Z", "message": "Replace DefaultFileIcon with constant, further aiding in less repetition"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDUyMTk4OTE5", "url": "https://github.com/openequella/openEQUELLA/pull/2075#pullrequestreview-452198919", "createdAt": "2020-07-21T07:35:31Z", "commit": {"oid": "23e19414c746795dbd1d820a3e9e6c3277c948bd"}, "state": "APPROVED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yMVQwNzozNTozMVrOG0rwxQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yMVQwNzozNjoxM1rOG0ryKA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1Nzg5NjEzMw==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                  width: \"88\",\n          \n          \n            \n                  width: 88,", "url": "https://github.com/openequella/openEQUELLA/pull/2075#discussion_r457896133", "createdAt": "2020-07-21T07:35:31Z", "author": {"login": "edalex-ian"}, "path": "Source/Plugins/Core/com.equella.core/js/tsrc/components/OEQThumb.tsx", "diffHunk": "@@ -0,0 +1,144 @@\n+/*\n+ * Licensed to The Apereo Foundation under one or more contributor license\n+ * agreements. See the NOTICE file distributed with this work for additional\n+ * information regarding copyright ownership.\n+ *\n+ * The Apereo Foundation licenses this file to you under the Apache License,\n+ * Version 2.0, (the \"License\"); you may not use this file except in compliance\n+ * with the License. You may obtain a copy of the License at:\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+import * as React from \"react\";\n+import { makeStyles } from \"@material-ui/core/styles\";\n+import { Theme } from \"@material-ui/core\";\n+import * as OEQ from \"@openequella/rest-api-client\";\n+import {\n+  Link as LinkIcon,\n+  Movie as VideoIcon,\n+  Panorama as ImageIcon,\n+  InsertDriveFile as DefaultFileIcon,\n+  Language as WebIcon,\n+  Subject as PlaceholderIcon,\n+} from \"@material-ui/icons\";\n+\n+const useStyles = makeStyles((theme: Theme) => {\n+  return {\n+    thumbnail: {\n+      //if material UI changes such that the MuiPaper-elevation1 MuiPaper-rounded no longer map, add the rules here.\n+      marginRight: theme.spacing(2),\n+      width: \"88\",", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "23e19414c746795dbd1d820a3e9e6c3277c948bd"}, "originalPosition": 36}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1Nzg5NjQ4OA==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                  height: \"66\",\n          \n          \n            \n                  height: 66,", "url": "https://github.com/openequella/openEQUELLA/pull/2075#discussion_r457896488", "createdAt": "2020-07-21T07:36:13Z", "author": {"login": "edalex-ian"}, "path": "Source/Plugins/Core/com.equella.core/js/tsrc/components/OEQThumb.tsx", "diffHunk": "@@ -0,0 +1,144 @@\n+/*\n+ * Licensed to The Apereo Foundation under one or more contributor license\n+ * agreements. See the NOTICE file distributed with this work for additional\n+ * information regarding copyright ownership.\n+ *\n+ * The Apereo Foundation licenses this file to you under the Apache License,\n+ * Version 2.0, (the \"License\"); you may not use this file except in compliance\n+ * with the License. You may obtain a copy of the License at:\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+import * as React from \"react\";\n+import { makeStyles } from \"@material-ui/core/styles\";\n+import { Theme } from \"@material-ui/core\";\n+import * as OEQ from \"@openequella/rest-api-client\";\n+import {\n+  Link as LinkIcon,\n+  Movie as VideoIcon,\n+  Panorama as ImageIcon,\n+  InsertDriveFile as DefaultFileIcon,\n+  Language as WebIcon,\n+  Subject as PlaceholderIcon,\n+} from \"@material-ui/icons\";\n+\n+const useStyles = makeStyles((theme: Theme) => {\n+  return {\n+    thumbnail: {\n+      //if material UI changes such that the MuiPaper-elevation1 MuiPaper-rounded no longer map, add the rules here.\n+      marginRight: theme.spacing(2),\n+      width: \"88\",\n+      height: \"auto\",\n+    },\n+    placeholderThumbnail: {\n+      color: theme.palette.text.secondary,\n+      opacity: 0.4,\n+      height: \"66\",", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "23e19414c746795dbd1d820a3e9e6c3277c948bd"}, "originalPosition": 42}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e6b7fb7b1a1958071a69f48b40ab41d5634a3516", "author": {"user": {"login": "mrblippy", "name": "Nick Charles"}}, "url": "https://github.com/openequella/openEQUELLA/commit/e6b7fb7b1a1958071a69f48b40ab41d5634a3516", "committedDate": "2020-07-21T07:42:18Z", "message": "Make width and height styling values numbers instead of a strings"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "16fca2141d31f211af21d0b1239e943d3484f465", "author": {"user": {"login": "mrblippy", "name": "Nick Charles"}}, "url": "https://github.com/openequella/openEQUELLA/commit/16fca2141d31f211af21d0b1239e943d3484f465", "committedDate": "2020-07-21T08:07:53Z", "message": "Replace dupilcated img tag with the const that I was already using elsewhere"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4986, "cost": 1, "resetAt": "2021-11-01T16:37:27Z"}}}