{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0Mzk1NzQ4NjA4", "number": 1591, "title": "types: check typescript types during check process", "bodyText": "Checklist\n\n\n the contributor license agreement is signed\n commit message follows commit guidelines\n tests are included\n\nDescription of change\nParcel does not check types\n\nParcel performs no type checking. You can use tsc --noEmit to have typescript check your files.\n\nhttps://parceljs.org/typeScript.html\nThis sets up type checks as part of a new check:ts-types step.", "createdAt": "2020-03-30T16:04:54Z", "url": "https://github.com/openequella/openEQUELLA/pull/1591", "merged": true, "mergeCommit": {"oid": "71cc27f4b43f507e4884d20b03be0f4f143140a5"}, "closed": true, "closedAt": "2020-04-02T06:19:18Z", "author": {"login": "ChristianMurphy"}, "timelineItems": {"totalCount": 24, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcSwq7VgH2gAyMzk1NzQ4NjA4OmZiYjg0ZGIzMjgxMDk2NGZiMzA5NmFhZjAxNGY4MzMyN2I1OTU4YTk=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcThcnbAH2gAyMzk1NzQ4NjA4OjBhNGE2MWNiNGYwNGEwOTYxNTUwOWQ4OWJjOTc2YjBmODkwNDFjZTk=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "fbb84db32810964fb3096aaf014f83327b5958a9", "author": {"user": {"login": "ChristianMurphy", "name": "Christian Murphy"}}, "url": "https://github.com/openequella/openEQUELLA/commit/fbb84db32810964fb3096aaf014f83327b5958a9", "committedDate": "2020-03-30T15:59:03Z", "message": "types: check typescript types during check process"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzg0MTc4Mjc0", "url": "https://github.com/openequella/openEQUELLA/pull/1591#pullrequestreview-384178274", "createdAt": "2020-03-30T19:50:12Z", "commit": {"oid": "9d05c138ad61def1f3cba7364efa1abf6c026f10"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0zMFQxOTo1MDoxMlrOF95rQA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0zMFQxOTo1MDoxMlrOF95rQA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMDQ1MjQxNg==", "bodyText": "previously languageStrings was cast to LanguageStrings to avoid\nElement implicitly has an 'any' type because expression of type 'string' can't be used to index type\n\non line 26, but this cast caused issues elsewhere in the code.\nTo avoid the cast on languageStrings, refactored the iteration to narrow the type of key from string to keyof typeof languageString so TypeScript knows it can be safely used as an index.", "url": "https://github.com/openequella/openEQUELLA/pull/1591#discussion_r400452416", "createdAt": "2020-03-30T19:50:12Z", "author": {"login": "ChristianMurphy"}, "path": "Source/Plugins/Core/com.equella.core/js/tsrc/util/langstrings.ts", "diffHunk": "@@ -70,12 +70,14 @@ export function prepLangStrings(\n }\n \n export function initStrings() {\n-  for (const key in languageStrings) {\n+  for (const key of Object.keys(languageStrings) as Array<\n+    keyof typeof languageStrings\n+  >) {\n     prepLangStrings(key, languageStrings[key]);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "9d05c138ad61def1f3cba7364efa1abf6c026f10"}, "originalPosition": 23}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "1e21e34e3775975ab79f30fc2c3633aea88ac4c4", "author": {"user": {"login": "ChristianMurphy", "name": "Christian Murphy"}}, "url": "https://github.com/openequella/openEQUELLA/commit/1e21e34e3775975ab79f30fc2c3633aea88ac4c4", "committedDate": "2020-03-30T20:28:22Z", "message": "fix: keep literal type of language strings to allow easy access\n\nrefactor `initStrings` so `languageStrings` can be passed to `prepLanguageStrings` in a type safe manner."}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "9d05c138ad61def1f3cba7364efa1abf6c026f10", "author": {"user": {"login": "ChristianMurphy", "name": "Christian Murphy"}}, "url": "https://github.com/openequella/openEQUELLA/commit/9d05c138ad61def1f3cba7364efa1abf6c026f10", "committedDate": "2020-03-30T19:32:45Z", "message": "fix: keep literal type of language strings to allow easy access\n\nrefactor `initStrings` so `languageStrings` can be passed to `prepLanguageStrings` in a type safe manner."}, "afterCommit": {"oid": "1e21e34e3775975ab79f30fc2c3633aea88ac4c4", "author": {"user": {"login": "ChristianMurphy", "name": "Christian Murphy"}}, "url": "https://github.com/openequella/openEQUELLA/commit/1e21e34e3775975ab79f30fc2c3633aea88ac4c4", "committedDate": "2020-03-30T20:28:22Z", "message": "fix: keep literal type of language strings to allow easy access\n\nrefactor `initStrings` so `languageStrings` can be passed to `prepLanguageStrings` in a type safe manner."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a5711cbd1965291399f720f30750e505ab244fd9", "author": {"user": null}, "url": "https://github.com/openequella/openEQUELLA/commit/a5711cbd1965291399f720f30750e505ab244fd9", "committedDate": "2020-03-30T23:37:31Z", "message": "Fix types for PreLoginNoticeConfigurator.tsx"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ae3191a0f3dc3f5546f6ba8822b1b11c6537d4e5", "author": {"user": null}, "url": "https://github.com/openequella/openEQUELLA/commit/ae3191a0f3dc3f5546f6ba8822b1b11c6537d4e5", "committedDate": "2020-03-31T00:00:09Z", "message": "Fix types on store.ts"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "8315edcaedf60f3b9c8a5c4895f91b03594603c1", "author": {"user": null}, "url": "https://github.com/openequella/openEQUELLA/commit/8315edcaedf60f3b9c8a5c4895f91b03594603c1", "committedDate": "2020-03-31T00:12:52Z", "message": "Fix types for index.tsx"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "df95ce9d05cace5e10757abfc9b6fc5595b4298d", "author": {"user": {"login": "PenghaiZhang", "name": null}}, "url": "https://github.com/openequella/openEQUELLA/commit/df95ce9d05cace5e10757abfc9b6fc5595b4298d", "committedDate": "2020-03-31T01:38:52Z", "message": "Fix types for LegacyContent.tsx"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "17aaae950c77cd912e8d043239f6f9d46353ff3b", "author": {"user": {"login": "PenghaiZhang", "name": null}}, "url": "https://github.com/openequella/openEQUELLA/commit/17aaae950c77cd912e8d043239f6f9d46353ff3b", "committedDate": "2020-03-31T01:39:36Z", "message": "Merge branch 'types/check-typescript-types' of github.com:ChristianMurphy/openEquella into types/check-typescript-types"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "368555b9d520737b09719cbd27886d85cd4f8914", "author": {"user": null}, "url": "https://github.com/openequella/openEQUELLA/commit/368555b9d520737b09719cbd27886d85cd4f8914", "committedDate": "2020-03-31T01:44:54Z", "message": "Fix type for index.ts"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzg0MzQ4NTkz", "url": "https://github.com/openequella/openEQUELLA/pull/1591#pullrequestreview-384348593", "createdAt": "2020-03-31T01:45:35Z", "commit": {"oid": "17aaae950c77cd912e8d043239f6f9d46353ff3b"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0zMVQwMTo0NTozNlrOF-CWPg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0zMVQwMTo0NTozNlrOF-CWPg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMDU5NDQ5NA==", "bodyText": "Elsewhere the pattern\ndeclare global {\n  interface Window {\n    __REDUX_DEVTOOLS_EXTENSION_COMPOSE__?: typeof compose;\n  }\n}\n\nis being used, would it make sense to use that here as well?\nOr to convert the other pieces of code to use the inline window as {something} approach?", "url": "https://github.com/openequella/openEQUELLA/pull/1591#discussion_r400594494", "createdAt": "2020-03-31T01:45:36Z", "author": {"login": "ChristianMurphy"}, "path": "Source/Plugins/Core/com.equella.core/js/tsrc/legacycontent/LegacyContent.tsx", "diffHunk": "@@ -176,7 +176,7 @@ export const LegacyContent = React.memo(function LegacyContent({\n   }\n \n   React.useEffect(() => {\n-    window[\"EQ\"] = {\n+    (window as { [key: string]: any })[\"EQ\"] = {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "17aaae950c77cd912e8d043239f6f9d46353ff3b"}, "originalPosition": 5}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzg0MzQ5MjM5", "url": "https://github.com/openequella/openEQUELLA/pull/1591#pullrequestreview-384349239", "createdAt": "2020-03-31T01:47:39Z", "commit": {"oid": "368555b9d520737b09719cbd27886d85cd4f8914"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0zMVQwMTo0NzozOVrOF-CYWQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0zMVQwMTo0NzozOVrOF-CYWQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMDU5NTAzMw==", "bodyText": "Is this an any?\nWhen validationErrors is returned, it is given the type IDictionary<string>, could that be used here as well?", "url": "https://github.com/openequella/openEQUELLA/pull/1591#discussion_r400595033", "createdAt": "2020-03-31T01:47:39Z", "author": {"login": "ChristianMurphy"}, "path": "Source/Plugins/Core/com.equella.core/js/tsrc/entity/index.ts", "diffHunk": "@@ -79,7 +79,7 @@ export interface EntityState<E extends Entity> extends PartialEntityState<E> {\n }\n \n function baseValidate<E extends Entity>(entity: E): IDictionary<string> {\n-  const validationErrors = {};\n+  const validationErrors: any = {};", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "368555b9d520737b09719cbd27886d85cd4f8914"}, "originalPosition": 5}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzg0MzQ5ODQz", "url": "https://github.com/openequella/openEQUELLA/pull/1591#pullrequestreview-384349843", "createdAt": "2020-03-31T01:49:40Z", "commit": {"oid": "368555b9d520737b09719cbd27886d85cd4f8914"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0zMVQwMTo0OTo0MFrOF-Cagg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0zMVQwMTo0OTo0MFrOF-Cagg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMDU5NTU4Ng==", "bodyText": "Is the explicit <HTMLScriptElement> still needed when the initializer is new HTMLScriptElement()?", "url": "https://github.com/openequella/openEQUELLA/pull/1591#discussion_r400595586", "createdAt": "2020-03-31T01:49:40Z", "author": {"login": "ChristianMurphy"}, "path": "Source/Plugins/Core/com.equella.core/js/tsrc/legacycontent/LegacyContent.tsx", "diffHunk": "@@ -306,30 +306,33 @@ function loadMissingScripts(_scripts: string[]) {\n     const doc = window.document;\n     const head = doc.getElementsByTagName(\"head\")[0];\n     const scriptTags = doc.getElementsByTagName(\"script\");\n-    const scriptSrcs = {};\n+    const scriptSrcs: { [index: string]: boolean } = {};\n     for (let i = 0; i < scriptTags.length; i++) {\n       const scriptTag = scriptTags[i];\n       if (scriptTag.src) {\n         scriptSrcs[scriptTag.src] = true;\n       }\n     }\n-    const lastScript = scripts.reduce((lastScript, scriptUrl) => {\n-      if (scriptSrcs[scriptUrl]) {\n-        return lastScript;\n-      } else {\n-        const newScript = doc.createElement(\"script\");\n-        newScript.src = scriptUrl;\n-        newScript.async = false;\n-        head.appendChild(newScript);\n-        return newScript;\n-      }\n-    }, null);\n+    const lastScript = scripts.reduce<HTMLScriptElement>(", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "368555b9d520737b09719cbd27886d85cd4f8914"}, "originalPosition": 58}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "5e7e92b133adf04ffb9b66e2e3cdaa4bd6ca6062", "author": {"user": null}, "url": "https://github.com/openequella/openEQUELLA/commit/5e7e92b133adf04ffb9b66e2e3cdaa4bd6ca6062", "committedDate": "2020-03-31T02:25:18Z", "message": "Fix type for validationErrors"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b3fb00a7c8654bf0ed16794570aae5b17d862018", "author": {"user": {"login": "PenghaiZhang", "name": null}}, "url": "https://github.com/openequella/openEQUELLA/commit/b3fb00a7c8654bf0ed16794570aae5b17d862018", "committedDate": "2020-03-31T02:56:06Z", "message": "Add 'EQ' to the interface Window;\n\nRemove the explicit <HTMLScriptElement>;"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "06296f91627500d3bc52b1411fa3719be93bb5b5", "author": {"user": {"login": "PenghaiZhang", "name": null}}, "url": "https://github.com/openequella/openEQUELLA/commit/06296f91627500d3bc52b1411fa3719be93bb5b5", "committedDate": "2020-03-31T03:30:48Z", "message": "The type of 'lastScript' should be 'HTMLScriptElement | null'"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzg0Mzg0OTE0", "url": "https://github.com/openequella/openEQUELLA/pull/1591#pullrequestreview-384384914", "createdAt": "2020-03-31T03:52:01Z", "commit": {"oid": "06296f91627500d3bc52b1411fa3719be93bb5b5"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0zMVQwMzo1MjowMVrOF-EXCw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0zMVQwMzo1MjowMVrOF-EXCw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMDYyNzQ2Nw==", "bodyText": "Is current never null as the type implies? If so, could the null check on 265 be removed?\nIf not would current be HTMLLinkElement | null?", "url": "https://github.com/openequella/openEQUELLA/pull/1591#discussion_r400627467", "createdAt": "2020-03-31T03:52:01Z", "author": {"login": "ChristianMurphy"}, "path": "Source/Plugins/Core/com.equella.core/js/tsrc/legacycontent/LegacyContent.tsx", "diffHunk": "@@ -259,12 +260,12 @@ function updateStylesheets(\n   const doc = window.document;\n   const insertPoint = doc.getElementById(\"_dynamicInsert\")!;\n   const head = doc.getElementsByTagName(\"head\")[0];\n-  let current = insertPoint.previousElementSibling;\n-  const existingSheets = {};\n+  let current = insertPoint.previousElementSibling as HTMLLinkElement;\n+  const existingSheets: { [index: string]: HTMLLinkElement } = {};\n \n   while (current != null && current.tagName == \"LINK\") {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "06296f91627500d3bc52b1411fa3719be93bb5b5"}, "originalPosition": 26}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e9b23b48c9a3d6f4f0862fae08de6173f4e07ec4", "author": {"user": null}, "url": "https://github.com/openequella/openEQUELLA/commit/e9b23b48c9a3d6f4f0862fae08de6173f4e07ec4", "committedDate": "2020-03-31T04:13:40Z", "message": "Use any rather than object for ControlApi type\n\nUsing object causes the typechecker to break on this in the register method -\nsince it uses a generic type."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "bd9fd99fefdb09cc6197108c043e1ff585475829", "author": {"user": {"login": "PenghaiZhang", "name": null}}, "url": "https://github.com/openequella/openEQUELLA/commit/bd9fd99fefdb09cc6197108c043e1ff585475829", "committedDate": "2020-03-31T05:49:09Z", "message": "Check if 'current' is an instace of HTMLLinkElement"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "9fd46b2f0f7efe43ef1330cab740201e10b785db", "author": {"user": {"login": "ChristianMurphy", "name": "Christian Murphy"}}, "url": "https://github.com/openequella/openEQUELLA/commit/9fd46b2f0f7efe43ef1330cab740201e10b785db", "committedDate": "2020-03-31T14:52:52Z", "message": "ci: install typings before running check"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "1eab1fec29f52f8675d40f85e2d324c71403b857", "author": {"user": {"login": "ChristianMurphy", "name": "Christian Murphy"}}, "url": "https://github.com/openequella/openEQUELLA/commit/1eab1fec29f52f8675d40f85e2d324c71403b857", "committedDate": "2020-03-31T14:58:12Z", "message": "ci: use full install ci and install ci test aliases"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzg1MTUzODAw", "url": "https://github.com/openequella/openEQUELLA/pull/1591#pullrequestreview-385153800", "createdAt": "2020-03-31T22:39:11Z", "commit": {"oid": "1eab1fec29f52f8675d40f85e2d324c71403b857"}, "state": "COMMENTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0zMVQyMjozOToxMVrOF-qwhQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0zMVQyMjo1NTowNlrOF-rGUw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMTI1NjU4MQ==", "bodyText": "Does this order look a little bit better? \n    - npm install-ci\n    - npm run check       \n    - cd Source/Plugins/Core/com.equella.core/js\n    - npm install-ci\n\nMay I ask why we run npm install-ci in  Source/Plugins/Core/com.equella.core/js at this stage?", "url": "https://github.com/openequella/openEQUELLA/pull/1591#discussion_r401256581", "createdAt": "2020-03-31T22:39:11Z", "author": {"login": "PenghaiZhang"}, "path": ".travis.yml", "diffHunk": "@@ -75,7 +75,11 @@ jobs:\n   include:\n     - stage: build and check\n       script:\n-        - npm install && npm run check\n+        - cd Source/Plugins/Core/com.equella.core/js\n+        - npm install-ci\n+        - cd ../../../../..\n+        - npm install-ci\n+        - npm run check", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "1eab1fec29f52f8675d40f85e2d324c71403b857"}, "originalPosition": 9}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMTI2MjE2Mw==", "bodyText": "Does cd ../../../../.. work as same as cd - here?\nI can't remember why we used to have cd - here.  As each job runs in a fresh VM, I feel it's unnecessary to change the directory after  npm install-ci-test. But I may be wrong.", "url": "https://github.com/openequella/openEQUELLA/pull/1591#discussion_r401262163", "createdAt": "2020-03-31T22:55:06Z", "author": {"login": "PenghaiZhang"}, "path": ".travis.yml", "diffHunk": "@@ -105,7 +109,10 @@ jobs:\n       script: sbt test\n       name: Unit test\n     - stage: build and check\n-      script: cd Source/Plugins/Core/com.equella.core/js && npm install && npm test; cd -\n+      script:\n+        - cd Source/Plugins/Core/com.equella.core/js\n+        - npm install-ci-test\n+        - cd ../../../../..", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "1eab1fec29f52f8675d40f85e2d324c71403b857"}, "originalPosition": 21}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "14a337a13d5379f56eeae5838d3fa28694a5281e", "author": {"user": {"login": "ChristianMurphy", "name": "Christian Murphy"}}, "url": "https://github.com/openequella/openEQUELLA/commit/14a337a13d5379f56eeae5838d3fa28694a5281e", "committedDate": "2020-03-31T23:23:22Z", "message": "ci: use `cd -` to go to previous folder"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "0a4a61cb4f04a09615509d89bc976b0f89041ce9", "author": {"user": {"login": "PenghaiZhang", "name": null}}, "url": "https://github.com/openequella/openEQUELLA/commit/0a4a61cb4f04a09615509d89bc976b0f89041ce9", "committedDate": "2020-04-02T00:48:46Z", "message": "Merge branch 'develop' into types/check-typescript-types"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 201, "cost": 1, "resetAt": "2021-11-01T16:19:10Z"}}}