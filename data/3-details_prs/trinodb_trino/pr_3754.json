{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDE4NzM2MDQy", "number": 3754, "title": "Add join distribution type to live plan", "bodyText": "I have added the distribution type (replicated/partitioned) to the join nodes in the live plan as requested in issue -- fixes #1323\n\nCurrently I am slicing the distribution type from the details string of the node and displaying the distribution underneath the name of the node as shown in the screenshot. Would it be better to display a truncated version of the entire details string under the name and then display the full version as a tooltip when the user hovers over the node?\nLike this:\n\nThis alternate option would include other information and might look messier, but wouldn't break if the structure of the details string changes. My other concern with this alternate option is that if the structure of the details string changes so that the distribution isn't the first information displayed, users might not know that the distribution information is even there.\n@findepi @aalbu", "createdAt": "2020-05-15T18:20:59Z", "url": "https://github.com/trinodb/trino/pull/3754", "merged": true, "mergeCommit": {"oid": "c8f7a93e32a068c6858b6f72edfd645b212e24ae"}, "closed": true, "closedAt": "2020-05-22T21:11:39Z", "author": {"login": "charlesjmorgan"}, "timelineItems": {"totalCount": 10, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABchnHZzAFqTQxMjkwMzM1MA==", "endCursor": "Y3Vyc29yOnYyOpPPAAABcjz-T5gFqTQxNjk5ODQ4MQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDEyOTAzMzUw", "url": "https://github.com/trinodb/trino/pull/3754#pullrequestreview-412903350", "createdAt": "2020-05-15T19:11:35Z", "commit": null, "state": "COMMENTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xNVQxOToxMTozNVrOGWQ2kA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xNVQxOToxNjoxM1rOGWQ-Vw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNTk5Nzk2OA==", "bodyText": "Why did these versions get updated?", "url": "https://github.com/trinodb/trino/pull/3754#discussion_r425997968", "createdAt": "2020-05-15T19:11:35Z", "author": {"login": "aalbu"}, "path": "presto-main/src/main/resources/webapp/src/package.json", "diffHunk": "@@ -10,14 +10,14 @@\n     \"babel-preset-flow\": \"^6.23.0\",\n     \"babel-preset-react\": \"^6.24.1\",\n     \"flow-bin\": \"^0.85.0\",\n-    \"webpack\": \"^4.16.0\",\n+    \"webpack\": \"^4.43.0\",", "state": "SUBMITTED", "replyTo": null, "originalCommit": null, "originalPosition": 5}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNTk5OTk1OQ==", "bodyText": "I think that including the unprocessed content of the details field in the pop-up is more in line with the current UI (keeping 'business logic' out of the view).  But as you pointed out, that also has drawbacks.", "url": "https://github.com/trinodb/trino/pull/3754#discussion_r425999959", "createdAt": "2020-05-15T19:16:13Z", "author": {"login": "aalbu"}, "path": "presto-main/src/main/resources/webapp/src/components/LivePlan.jsx", "diffHunk": "@@ -125,10 +125,17 @@ class PlanNode extends React.Component<PlanNodeProps, PlanNodeState> {\n     }\n \n     render() {\n+        const details = this.props.details;\n+        if (details.includes(\"Distribution\")) {\n+            var index = details.indexOf(\"Distribution\");\n+            var distribution = details.slice(index, details.length).split(\"\\n\")[0];", "state": "SUBMITTED", "replyTo": null, "originalCommit": null, "originalPosition": 7}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": null, "afterCommit": null}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": null, "afterCommit": null}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDE0OTYwOTc2", "url": "https://github.com/trinodb/trino/pull/3754#pullrequestreview-414960976", "createdAt": "2020-05-20T03:04:51Z", "commit": null, "state": "COMMENTED", "comments": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yMFQwMzowNDo1MVrOGX5sOQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yMFQwMzoyODoxMFrOGX6BJw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNzcxNTY0MQ==", "bodyText": "Since the result should only have one row containing one column, you can use result.getOnlyValue().", "url": "https://github.com/trinodb/trino/pull/3754#discussion_r427715641", "createdAt": "2020-05-20T03:04:51Z", "author": {"login": "aalbu"}, "path": "presto-tests/src/test/java/io/prestosql/tests/AbstractTestEngineOnlyQueries.java", "diffHunk": "@@ -3391,6 +3391,18 @@ public void testLogicalExplain()\n         assertEquals(getOnlyElement(result.getOnlyColumnAsSet()), getExplainPlan(query, LOGICAL));\n     }\n \n+    @Test\n+    public void testJoinDistribution()\n+    {\n+        String query = \"SELECT c.custkey\\n\" +\n+                       \"FROM customer c JOIN nation n\\n\" +\n+                       \"  ON n.nationkey = c.nationkey\\n\" +\n+                       \"WHERE n.name = 'UNITED STATES'\\n\" +\n+                       \"LIMIT 5\";\n+        MaterializedResult result = computeActual(\"EXPLAIN (FORMAT TEXT) \" + query);\n+        assertThat(result.getMaterializedRows().get(0).toString()).matches(\"(?s).*Distribution:.*\");", "state": "SUBMITTED", "replyTo": null, "originalCommit": null, "originalPosition": 13}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNzcxNjkwNQ==", "bodyText": "Let's add a comment explaining why we're adding the test (the UI depends on the distribution type being part of the details and rendered as Distribution: <type>.  Without that context the test doesn't make much sense.", "url": "https://github.com/trinodb/trino/pull/3754#discussion_r427716905", "createdAt": "2020-05-20T03:10:15Z", "author": {"login": "aalbu"}, "path": "presto-tests/src/test/java/io/prestosql/tests/AbstractTestEngineOnlyQueries.java", "diffHunk": "@@ -3391,6 +3391,18 @@ public void testLogicalExplain()\n         assertEquals(getOnlyElement(result.getOnlyColumnAsSet()), getExplainPlan(query, LOGICAL));\n     }\n \n+    @Test\n+    public void testJoinDistribution()\n+    {\n+        String query = \"SELECT c.custkey\\n\" +\n+                       \"FROM customer c JOIN nation n\\n\" +\n+                       \"  ON n.nationkey = c.nationkey\\n\" +\n+                       \"WHERE n.name = 'UNITED STATES'\\n\" +\n+                       \"LIMIT 5\";\n+        MaterializedResult result = computeActual(\"EXPLAIN (FORMAT TEXT) \" + query);\n+        assertThat(result.getMaterializedRows().get(0).toString()).matches(\"(?s).*Distribution:.*\");", "state": "SUBMITTED", "replyTo": null, "originalCommit": null, "originalPosition": 13}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNzcxNzkwNg==", "bodyText": "We should preserve the value coming from the server and not change capitalization.", "url": "https://github.com/trinodb/trino/pull/3754#discussion_r427717906", "createdAt": "2020-05-20T03:14:40Z", "author": {"login": "aalbu"}, "path": "presto-main/src/main/resources/webapp/src/components/LivePlan.jsx", "diffHunk": "@@ -125,10 +125,19 @@ class PlanNode extends React.Component<PlanNodeProps, PlanNodeState> {\n     }\n \n     render() {\n+        const details = this.props.details;\n+        var distribution = \"\";\n+\n+        if (details.includes(\"Distribution\")) {\n+            var index = details.indexOf(\"Distribution\");\n+            var distribution = details.slice(index, details.length).split(\"\\n\")[0].split(\" \")[1];\n+            distribution = \" (\" + distribution.slice(0,1) + distribution.slice(1, distribution.length).toLowerCase() + \")\";", "state": "SUBMITTED", "replyTo": null, "originalCommit": null, "originalPosition": 10}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNzcyMDk5OQ==", "bodyText": "Perhaps you can try matching against a regex and get the distribution type from a match group.", "url": "https://github.com/trinodb/trino/pull/3754#discussion_r427720999", "createdAt": "2020-05-20T03:28:10Z", "author": {"login": "aalbu"}, "path": "presto-main/src/main/resources/webapp/src/components/LivePlan.jsx", "diffHunk": "@@ -125,10 +125,19 @@ class PlanNode extends React.Component<PlanNodeProps, PlanNodeState> {\n     }\n \n     render() {\n+        const details = this.props.details;\n+        var distribution = \"\";\n+\n+        if (details.includes(\"Distribution\")) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": null, "originalPosition": 7}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDE1ODM1NDM0", "url": "https://github.com/trinodb/trino/pull/3754#pullrequestreview-415835434", "createdAt": "2020-05-21T02:18:29Z", "commit": null, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yMVQwMjoxODoyOVrOGYkAAQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yMVQwMjoxODoyOVrOGYkAAQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyODQwODgzMw==", "bodyText": "Nice.  Use a more generic regex (something like [a-zA-Z]+) to match the distribution type (no need to hard-code the possible values).  And you can inline the regex.", "url": "https://github.com/trinodb/trino/pull/3754#discussion_r428408833", "createdAt": "2020-05-21T02:18:29Z", "author": {"login": "aalbu"}, "path": "presto-main/src/main/resources/webapp/src/components/LivePlan.jsx", "diffHunk": "@@ -125,10 +125,20 @@ class PlanNode extends React.Component<PlanNodeProps, PlanNodeState> {\n     }\n \n     render() {\n+        // get join distribution type by matching details to a regular expression\n+        const details = this.props.details;\n+        var distribution = \"\";\n+        var distributionRE = /Distribution:\\s(REPLICATED|PARTITIONED)/;", "state": "SUBMITTED", "replyTo": null, "originalCommit": null, "originalPosition": 7}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": null, "afterCommit": null}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDE2NzY3MjEy", "url": "https://github.com/trinodb/trino/pull/3754#pullrequestreview-416767212", "createdAt": "2020-05-22T09:17:24Z", "commit": null, "state": "APPROVED", "comments": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yMlQwOToxNzoyNFrOGZQZ7g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yMlQwOToyMzozNVrOGZQmSg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTEzNjM2Ng==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                public void testJoinDistribution()\n          \n          \n            \n                public void testExplainJoinDistribution()", "url": "https://github.com/trinodb/trino/pull/3754#discussion_r429136366", "createdAt": "2020-05-22T09:17:24Z", "author": {"login": "findepi"}, "path": "presto-tests/src/test/java/io/prestosql/tests/AbstractTestEngineOnlyQueries.java", "diffHunk": "@@ -3393,6 +3393,23 @@ public void testLogicalExplain()\n         assertEquals(getOnlyElement(result.getOnlyColumnAsSet()), getExplainPlan(query, LOGICAL));\n     }\n \n+    @Test\n+    public void testJoinDistribution()", "state": "SUBMITTED", "replyTo": null, "originalCommit": null, "originalPosition": 5}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTEzNzEwNA==", "bodyText": "We lean towards // comments. I am not sure there is a good reason, but worth staying consistent.\n\n  \n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                    /*\n          \n          \n            \n                        This test makes sure that the query plan includes the distribution info for joins.\n          \n          \n            \n                        The webui live plan displays the distribution type for joins, and the plan details\n          \n          \n            \n                        need to be structured like 'Distribution: <type>' for this feature to work.\n          \n          \n            \n                    */\n          \n          \n            \n                    // This test makes sure that the query plan includes the distribution info for joins.\n          \n          \n            \n                    // The webui live plan displays the distribution type for joins, and the plan details\n          \n          \n            \n                    //  need to be structured like 'Distribution: <type>' for this feature to work.", "url": "https://github.com/trinodb/trino/pull/3754#discussion_r429137104", "createdAt": "2020-05-22T09:18:39Z", "author": {"login": "findepi"}, "path": "presto-tests/src/test/java/io/prestosql/tests/AbstractTestEngineOnlyQueries.java", "diffHunk": "@@ -3393,6 +3393,23 @@ public void testLogicalExplain()\n         assertEquals(getOnlyElement(result.getOnlyColumnAsSet()), getExplainPlan(query, LOGICAL));\n     }\n \n+    @Test\n+    public void testJoinDistribution()\n+    {\n+        /*\n+            This test makes sure that the query plan includes the distribution info for joins.\n+            The webui live plan displays the distribution type for joins, and the plan details\n+            need to be structured like 'Distribution: <type>' for this feature to work.\n+        */", "state": "SUBMITTED", "replyTo": null, "originalCommit": null, "originalPosition": 11}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTEzODY4Nw==", "bodyText": "avoid \\n as they don't slightly reduce readability, use spaces instead\nalso, you can make the lines a bit longer and remove unnecessary WHERE, LIMIT\nthen you can inline the variable:\n\n  \n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                    String query = \"SELECT c.custkey\\n\" +\n          \n          \n            \n                                   \"FROM customer c JOIN nation n\\n\" +\n          \n          \n            \n                                   \"  ON n.nationkey = c.nationkey\\n\" +\n          \n          \n            \n                                   \"WHERE n.name = 'UNITED STATES'\\n\" +\n          \n          \n            \n                                   \"LIMIT 5\";\n          \n          \n            \n                    MaterializedResult result = computeActual(\"EXPLAIN (FORMAT TEXT) \" + query);\n          \n          \n            \n                    MaterializedResult result = computeActual(\"EXPLAIN (FORMAT TEXT) SELECT c.custkey FROM customer c JOIN nation n ON n.nationkey = c.nationkey\");", "url": "https://github.com/trinodb/trino/pull/3754#discussion_r429138687", "createdAt": "2020-05-22T09:21:57Z", "author": {"login": "findepi"}, "path": "presto-tests/src/test/java/io/prestosql/tests/AbstractTestEngineOnlyQueries.java", "diffHunk": "@@ -3393,6 +3393,23 @@ public void testLogicalExplain()\n         assertEquals(getOnlyElement(result.getOnlyColumnAsSet()), getExplainPlan(query, LOGICAL));\n     }\n \n+    @Test\n+    public void testJoinDistribution()\n+    {\n+        /*\n+            This test makes sure that the query plan includes the distribution info for joins.\n+            The webui live plan displays the distribution type for joins, and the plan details\n+            need to be structured like 'Distribution: <type>' for this feature to work.\n+        */\n+        String query = \"SELECT c.custkey\\n\" +\n+                       \"FROM customer c JOIN nation n\\n\" +\n+                       \"  ON n.nationkey = c.nationkey\\n\" +\n+                       \"WHERE n.name = 'UNITED STATES'\\n\" +\n+                       \"LIMIT 5\";\n+        MaterializedResult result = computeActual(\"EXPLAIN (FORMAT TEXT) \" + query);", "state": "SUBMITTED", "replyTo": null, "originalCommit": null, "originalPosition": 17}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTEzOTUzMA==", "bodyText": "avoid Object#toString, it can mask problems, use cast instead:\nassertThat((String) result.getOnlyValue()) ....", "url": "https://github.com/trinodb/trino/pull/3754#discussion_r429139530", "createdAt": "2020-05-22T09:23:35Z", "author": {"login": "findepi"}, "path": "presto-tests/src/test/java/io/prestosql/tests/AbstractTestEngineOnlyQueries.java", "diffHunk": "@@ -3393,6 +3393,23 @@ public void testLogicalExplain()\n         assertEquals(getOnlyElement(result.getOnlyColumnAsSet()), getExplainPlan(query, LOGICAL));\n     }\n \n+    @Test\n+    public void testJoinDistribution()\n+    {\n+        /*\n+            This test makes sure that the query plan includes the distribution info for joins.\n+            The webui live plan displays the distribution type for joins, and the plan details\n+            need to be structured like 'Distribution: <type>' for this feature to work.\n+        */\n+        String query = \"SELECT c.custkey\\n\" +\n+                       \"FROM customer c JOIN nation n\\n\" +\n+                       \"  ON n.nationkey = c.nationkey\\n\" +\n+                       \"WHERE n.name = 'UNITED STATES'\\n\" +\n+                       \"LIMIT 5\";\n+        MaterializedResult result = computeActual(\"EXPLAIN (FORMAT TEXT) \" + query);\n+        assertThat(result.getOnlyValue().toString()).matches(\"(?s).*Distribution:.*\");", "state": "SUBMITTED", "replyTo": null, "originalCommit": null, "originalPosition": 18}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "4705f76e777ac68ae754c28d16d63496f2c37daa", "author": {"user": {"login": "charlesjmorgan", "name": "Charles Morgan"}}, "url": "https://github.com/trinodb/trino/commit/4705f76e777ac68ae754c28d16d63496f2c37daa", "committedDate": "2020-05-22T15:22:24Z", "message": "show join distribution type in webui live plan"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": null, "afterCommit": {"oid": "4705f76e777ac68ae754c28d16d63496f2c37daa", "author": {"user": {"login": "charlesjmorgan", "name": "Charles Morgan"}}, "url": "https://github.com/trinodb/trino/commit/4705f76e777ac68ae754c28d16d63496f2c37daa", "committedDate": "2020-05-22T15:22:24Z", "message": "show join distribution type in webui live plan"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDE2OTk4NDgx", "url": "https://github.com/trinodb/trino/pull/3754#pullrequestreview-416998481", "createdAt": "2020-05-22T15:26:39Z", "commit": {"oid": "4705f76e777ac68ae754c28d16d63496f2c37daa"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1125, "cost": 1, "resetAt": "2021-10-28T19:08:13Z"}}}