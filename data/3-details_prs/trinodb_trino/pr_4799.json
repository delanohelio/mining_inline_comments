{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDY3MDc5ODU2", "number": 4799, "title": "Fix timestamp semantics", "bodyText": "Fixes #37\nFixes #3742", "createdAt": "2020-08-13T00:45:54Z", "url": "https://github.com/trinodb/trino/pull/4799", "merged": true, "mergeCommit": {"oid": "53bafb41da3b36f923f57f995b012bec9b85be4c"}, "closed": true, "closedAt": "2020-08-13T01:43:25Z", "author": {"login": "dain"}, "timelineItems": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABc-VQaNgFqTQ2NjM3MzY1NA==", "endCursor": "Y3Vyc29yOnYyOpPPAAABdQy98QAFqTUwNTUyMDIwNg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDY2MzczNjU0", "url": "https://github.com/trinodb/trino/pull/4799#pullrequestreview-466373654", "createdAt": "2020-08-13T00:55:19Z", "commit": null, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDY2MzczMzI5", "url": "https://github.com/trinodb/trino/pull/4799#pullrequestreview-466373329", "createdAt": "2020-08-13T00:54:24Z", "commit": null, "state": "COMMENTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xM1QwMDo1NDoyNFrOG_4C0w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xM1QwMDo1NDo0MFrOG_4DMw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2OTYzMTY5OQ==", "bodyText": "Same here", "url": "https://github.com/trinodb/trino/pull/4799#discussion_r469631699", "createdAt": "2020-08-13T00:54:24Z", "author": {"login": "martint"}, "path": "presto-main/src/main/java/io/prestosql/operator/scalar/timestamp/VarcharToTimestampCast.java", "diffHunk": "@@ -159,7 +114,7 @@ private static long castToShortTimestamp(int precision, String value, Function<S\n         return epochSecond * MICROSECONDS_PER_SECOND + rescale(fractionValue, actualPrecision, 6);\n     }\n \n-    private static LongTimestamp castToLongTimestamp(int precision, String value, Function<String, ZoneId> zoneId)\n+    public static LongTimestamp castToLongTimestamp(int precision, String value)", "state": "SUBMITTED", "replyTo": null, "originalCommit": null, "originalPosition": 124}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2OTYzMTc5NQ==", "bodyText": "Why public? This is supposed to be an implementation detail of this class.", "url": "https://github.com/trinodb/trino/pull/4799#discussion_r469631795", "createdAt": "2020-08-13T00:54:40Z", "author": {"login": "martint"}, "path": "presto-main/src/main/java/io/prestosql/operator/scalar/timestamp/VarcharToTimestampCast.java", "diffHunk": "@@ -71,47 +57,17 @@ public static long castToShort(@LiteralParameter(\"p\") long precision, ConnectorS\n \n     @LiteralParameters({\"x\", \"p\"})\n     @SqlType(\"timestamp(p)\")\n-    public static LongTimestamp castToLong(@LiteralParameter(\"p\") long precision, ConnectorSession session, @SqlType(\"varchar(x)\") Slice value)\n+    public static LongTimestamp castToLong(@LiteralParameter(\"p\") long precision, @SqlType(\"varchar(x)\") Slice value)\n     {\n-        // This accepts value with or without time zone\n-        if (session.isLegacyTimestamp()) {\n-            try {\n-                return castToLegacyLongTimestamp((int) precision, session.getTimeZoneKey(), trim(value).toStringUtf8());\n-            }\n-            catch (IllegalArgumentException e) {\n-                throw new PrestoException(INVALID_CAST_ARGUMENT, \"Value cannot be cast to timestamp: \" + value.toStringUtf8(), e);\n-            }\n-        }\n-\n         try {\n-            return castToLongTimestamp((int) precision, trim(value).toStringUtf8(), timezone -> ZoneOffset.UTC);\n+            return castToLongTimestamp((int) precision, trim(value).toStringUtf8());\n         }\n         catch (IllegalArgumentException e) {\n             throw new PrestoException(INVALID_CAST_ARGUMENT, \"Value cannot be cast to timestamp: \" + value.toStringUtf8(), e);\n         }\n     }\n \n-    public static long castToLegacyShortTimestamp(int precision, TimeZoneKey timeZoneKey, String value)\n-    {\n-        return castToShortTimestamp(precision, value, timezone -> {\n-            if (timezone == null) {\n-                return timeZoneKey.getZoneId();\n-            }\n-            return ZoneId.of(timezone);\n-        });\n-    }\n-\n-    private static LongTimestamp castToLegacyLongTimestamp(int precision, TimeZoneKey timeZoneKey, String value)\n-    {\n-        return castToLongTimestamp(precision, value, timezone -> {\n-            if (timezone == null) {\n-                return timeZoneKey.getZoneId();\n-            }\n-            return ZoneId.of(timezone);\n-        });\n-    }\n-\n-    private static long castToShortTimestamp(int precision, String value, Function<String, ZoneId> zoneId)\n+    public static long castToShortTimestamp(int precision, String value)", "state": "SUBMITTED", "replyTo": null, "originalCommit": null, "originalPosition": 98}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e9a6ff9b2855542df08c5a34b895b5ecfa3c8535", "author": {"user": {"login": "dain", "name": "Dain Sundstrom"}}, "url": "https://github.com/trinodb/trino/commit/e9a6ff9b2855542df08c5a34b895b5ecfa3c8535", "committedDate": "2020-08-13T01:30:42Z", "message": "Fix timestamp semantics"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": null, "afterCommit": {"oid": "e9a6ff9b2855542df08c5a34b895b5ecfa3c8535", "author": {"user": {"login": "dain", "name": "Dain Sundstrom"}}, "url": "https://github.com/trinodb/trino/commit/e9a6ff9b2855542df08c5a34b895b5ecfa3c8535", "committedDate": "2020-08-13T01:30:42Z", "message": "Fix timestamp semantics"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTA1NTIwMjA2", "url": "https://github.com/trinodb/trino/pull/4799#pullrequestreview-505520206", "createdAt": "2020-10-09T09:42:55Z", "commit": {"oid": "e9a6ff9b2855542df08c5a34b895b5ecfa3c8535"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wOVQwOTo0Mjo1NVrOHfCumQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wOVQwOTo0Mjo1NVrOHfCumQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMjMxMjYwMQ==", "bodyText": "Why this zone in particular?", "url": "https://github.com/trinodb/trino/pull/4799#discussion_r502312601", "createdAt": "2020-10-09T09:42:55Z", "author": {"login": "findepi"}, "path": "presto-hive/src/test/java/io/prestosql/plugin/hive/AbstractTestHiveLocal.java", "diffHunk": "@@ -70,7 +70,8 @@ public void initialize()\n                         .build());\n \n         HiveConfig hiveConfig = new HiveConfig()\n-                .setTimeZone(\"America/Los_Angeles\");\n+                .setParquetTimeZone(\"America/Los_Angeles\")\n+                .setRcfileTimeZone(\"America/Los_Angeles\");", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e9a6ff9b2855542df08c5a34b895b5ecfa3c8535"}, "originalPosition": 6}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4345, "cost": 1, "resetAt": "2021-10-28T20:13:43Z"}}}