{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0MzcwODc3MjIx", "number": 2728, "title": "Replace tableScan with values for empty table prefixes", "bodyText": "", "createdAt": "2020-02-04T14:46:47Z", "url": "https://github.com/trinodb/trino/pull/2728", "merged": true, "mergeCommit": {"oid": "204a86146d624d2a0c1574f836983206bfa36a69"}, "closed": true, "closedAt": "2020-02-11T09:26:46Z", "author": {"login": "Praveen2112"}, "timelineItems": {"totalCount": 14, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcBQDM1gBqjMwMDg3NjIyMzU=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcC8Y1xAFqTM1NTkwMTg2Nw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "HeadRefForcePushedEvent", "beforeCommit": null, "afterCommit": null}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": null, "afterCommit": null}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzUzMjY1NDgy", "url": "https://github.com/trinodb/trino/pull/2728#pullrequestreview-353265482", "createdAt": "2020-02-04T20:06:39Z", "commit": null, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0wNFQyMDowNjozOVrOFlhw4A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0wNFQyMDowNjozOVrOFlhw4A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NDg5NDgxNg==", "bodyText": "Can you please add a test that?", "url": "https://github.com/trinodb/trino/pull/2728#discussion_r374894816", "createdAt": "2020-02-04T20:06:39Z", "author": {"login": "kokosing"}, "path": "presto-main/src/main/java/io/prestosql/connector/informationschema/InformationSchemaMetadata.java", "diffHunk": "@@ -164,7 +165,13 @@ public boolean usesLegacyTableLayouts()\n     @Override\n     public ConnectorTableProperties getTableProperties(ConnectorSession session, ConnectorTableHandle table)\n     {\n-        return new ConnectorTableProperties();\n+        InformationSchemaTableHandle tableHandle = (InformationSchemaTableHandle) table;", "state": "SUBMITTED", "replyTo": null, "originalCommit": null, "originalPosition": 13}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": null, "afterCommit": null}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": null, "afterCommit": null}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": null, "afterCommit": null}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": null, "afterCommit": null}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzU1NDcwNTIw", "url": "https://github.com/trinodb/trino/pull/2728#pullrequestreview-355470520", "createdAt": "2020-02-07T22:18:08Z", "commit": null, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0wN1QyMjoxODowOFrOFnL56g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0wN1QyMjoxODowOFrOFnL56g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NjYzMzgzNA==", "bodyText": "I was also thinking about:\n        assertFalse(searchFrom(getQueryRunner().createPlan(getSession(), \"SELECT count(*) from test_catalog.information_schema.tables WHERE table_schema = ''\", WarningCollector.NOOP).getRoot())\n                .where(TableScanNode.class::isInstance)\n                .findFirst()\n                .isPresent());", "url": "https://github.com/trinodb/trino/pull/2728#discussion_r376633834", "createdAt": "2020-02-07T22:18:08Z", "author": {"login": "kokosing"}, "path": "presto-tests/src/test/java/io/prestosql/tests/TestInformationSchemaConnector.java", "diffHunk": "@@ -192,6 +192,12 @@ public void testMetadataCalls()\n                         .withListSchemasCount(1)\n                         .withListTablesCount(2)\n                         .withGetColumnsCount(10000));\n+        assertNoMetadataCalls(\"SELECT count(*) from test_catalog.information_schema.tables WHERE table_schema = ''\", \"VALUES 0\");", "state": "SUBMITTED", "replyTo": null, "originalCommit": null, "originalPosition": 4}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "494681a88a3a191785a903caeb69591783eb2afa", "author": {"user": {"login": "Praveen2112", "name": "Praveen Krishna"}}, "url": "https://github.com/trinodb/trino/commit/494681a88a3a191785a903caeb69591783eb2afa", "committedDate": "2020-02-09T15:05:35Z", "message": "Fix typo in method name"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": null, "afterCommit": null}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzU1ODA1Mzc4", "url": "https://github.com/trinodb/trino/pull/2728#pullrequestreview-355805378", "createdAt": "2020-02-10T09:53:58Z", "commit": null, "state": "APPROVED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xMFQwOTo1Mzo1OFrOFnf0hw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xMFQwOTo1Mzo1OFrOFnf0hw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3Njk2MDEzNQ==", "bodyText": "please extract a method assertNoTableScan(\"SELECT count(*) from test_catalog.information_schema.tables WHERE table_name = ''\")\nAlso please pass some message to assertFalse", "url": "https://github.com/trinodb/trino/pull/2728#discussion_r376960135", "createdAt": "2020-02-10T09:53:58Z", "author": {"login": "kokosing"}, "path": "presto-tests/src/test/java/io/prestosql/tests/TestInformationSchemaConnector.java", "diffHunk": "@@ -192,13 +196,20 @@ public void testMetadataCalls()\n                         .withListSchemasCount(1)\n                         .withListTablesCount(2)\n                         .withGetColumnsCount(10000));\n+        assertNoMetadataCalls(\"SELECT count(*) from test_catalog.information_schema.tables WHERE table_schema = ''\", \"VALUES 0\");\n     }\n \n     @Test\n     public void testInformationForEmptyNames()\n     {\n-        assertQuery(\"SELECT count(*) FROM test_catalog.information_schema.tables WHERE table_schema='tpch' AND table_name=''\", \"VALUES 0\");\n-        assertQuery(\"SELECT count(*) FROM test_catalog.information_schema.tables WHERE table_schema='' AND table_name='table'\", \"VALUES 0\");\n+        assertFalse(searchFrom(getQueryRunner().createPlan(getSession(), \"SELECT count(*) from test_catalog.information_schema.tables WHERE table_schema = ''\", WarningCollector.NOOP).getRoot())\n+                .where(TableScanNode.class::isInstance)\n+                .findFirst()\n+                .isPresent());\n+        assertFalse(searchFrom(getQueryRunner().createPlan(getSession(), \"SELECT count(*) from test_catalog.information_schema.tables WHERE table_name = ''\", WarningCollector.NOOP).getRoot())\n+                .where(TableScanNode.class::isInstance)\n+                .findFirst()\n+                .isPresent());", "state": "SUBMITTED", "replyTo": null, "originalCommit": null, "originalPosition": 43}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "59cec2a05c77eb7f286608128a96e230cc16c169", "author": {"user": {"login": "Praveen2112", "name": "Praveen Krishna"}}, "url": "https://github.com/trinodb/trino/commit/59cec2a05c77eb7f286608128a96e230cc16c169", "committedDate": "2020-02-10T11:49:59Z", "message": "Replace TableScan with Values for empty table prefixes"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": null, "afterCommit": {"oid": "59cec2a05c77eb7f286608128a96e230cc16c169", "author": {"user": {"login": "Praveen2112", "name": "Praveen Krishna"}}, "url": "https://github.com/trinodb/trino/commit/59cec2a05c77eb7f286608128a96e230cc16c169", "committedDate": "2020-02-10T11:49:59Z", "message": "Replace TableScan with Values for empty table prefixes"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzU1OTAxODY3", "url": "https://github.com/trinodb/trino/pull/2728#pullrequestreview-355901867", "createdAt": "2020-02-10T12:35:22Z", "commit": {"oid": "59cec2a05c77eb7f286608128a96e230cc16c169"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xMFQxMjozNToyMlrOFnkdQQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xMFQxMjozNToyMlrOFnkdQQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NzAzNjA5Nw==", "bodyText": "you lost table_schema='tpch'", "url": "https://github.com/trinodb/trino/pull/2728#discussion_r377036097", "createdAt": "2020-02-10T12:35:22Z", "author": {"login": "kokosing"}, "path": "presto-tests/src/test/java/io/prestosql/tests/TestInformationSchemaConnector.java", "diffHunk": "@@ -192,13 +196,14 @@ public void testMetadataCalls()\n                         .withListSchemasCount(1)\n                         .withListTablesCount(2)\n                         .withGetColumnsCount(10000));\n+        assertNoMetadataCalls(\"SELECT count(*) from test_catalog.information_schema.tables WHERE table_schema = ''\", \"VALUES 0\");\n     }\n \n     @Test\n     public void testInformationForEmptyNames()\n     {\n-        assertQuery(\"SELECT count(*) FROM test_catalog.information_schema.tables WHERE table_schema='tpch' AND table_name=''\", \"VALUES 0\");\n-        assertQuery(\"SELECT count(*) FROM test_catalog.information_schema.tables WHERE table_schema='' AND table_name='table'\", \"VALUES 0\");\n+        assertNoTableScan(\"SELECT count(*) from test_catalog.information_schema.tables WHERE table_schema = ''\");", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "59cec2a05c77eb7f286608128a96e230cc16c169"}, "originalPosition": 36}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1639, "cost": 1, "resetAt": "2021-10-28T20:13:43Z"}}}