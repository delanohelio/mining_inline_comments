{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0Mzg3Mjk0ODQ0", "number": 3084, "title": "Use HiveCatalogName to export S3 statistics without name conflicts", "bodyText": "This fixes the problem of conflicting JMX keys for S3 statistics\nwhen Hive and Iceberg connectors are loaded.", "createdAt": "2020-03-12T15:00:53Z", "url": "https://github.com/trinodb/trino/pull/3084", "merged": true, "mergeCommit": {"oid": "7dd3d18952f70de55d0e49afa6939f70babf80e7"}, "closed": true, "closedAt": "2020-03-17T07:50:03Z", "author": {"login": "MiguelWeezardo"}, "timelineItems": {"totalCount": 10, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcM9vMkAFqTM3MzY3NzAwNA==", "endCursor": "Y3Vyc29yOnYyOpPPAAABcOSq9PABqjMxMzQ1MzExODA=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzczNjc3MDA0", "url": "https://github.com/trinodb/trino/pull/3084#pullrequestreview-373677004", "createdAt": "2020-03-12T15:47:52Z", "commit": null, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xMlQxNTo0Nzo1MlrOF1kVaA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xMlQxNTo0ODo1MVrOF1kYFw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MTcxNDE1Mg==", "bodyText": "There is HiveCatalogName bean binded already", "url": "https://github.com/trinodb/trino/pull/3084#discussion_r391714152", "createdAt": "2020-03-12T15:47:52Z", "author": {"login": "kokosing"}, "path": "presto-hive/src/main/java/io/prestosql/plugin/hive/InternalHiveConnectorFactory.java", "diffHunk": "@@ -81,7 +81,7 @@ public static Connector createConnector(String catalogName, Map<String, String>\n                     new ConnectorObjectNameGeneratorModule(catalogName, \"io.prestosql.plugin.hive\", \"presto.plugin.hive\"),\n                     new JsonModule(),\n                     new HiveModule(),\n-                    new HiveS3Module(),\n+                    new HiveS3Module(catalogName),", "state": "SUBMITTED", "replyTo": null, "originalCommit": null, "originalPosition": 5}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MTcxNDgzOQ==", "bodyText": "You can use provider of HiveCatalogName and pass function here to generate name lazy. After guice configuration", "url": "https://github.com/trinodb/trino/pull/3084#discussion_r391714839", "createdAt": "2020-03-12T15:48:51Z", "author": {"login": "kokosing"}, "path": "presto-hive/src/main/java/io/prestosql/plugin/hive/s3/HiveS3Module.java", "diffHunk": "@@ -39,7 +47,7 @@ protected void setup(Binder binder)\n \n             binder.bind(PrestoS3FileSystemStats.class).toInstance(PrestoS3FileSystem.getFileSystemStats());\n             newExporter(binder).export(PrestoS3FileSystemStats.class)\n-                    .as(generator -> generator.generatedNameOf(PrestoS3FileSystem.class));\n+                    .as(generator -> generator.generatedNameOf(PrestoS3FileSystem.class, catalogName));", "state": "SUBMITTED", "replyTo": null, "originalCommit": null, "originalPosition": 27}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzc0NjIzMTcw", "url": "https://github.com/trinodb/trino/pull/3084#pullrequestreview-374623170", "createdAt": "2020-03-13T21:13:36Z", "commit": null, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": null, "afterCommit": null}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": null, "afterCommit": null}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzc0ODI1Nzc3", "url": "https://github.com/trinodb/trino/pull/3084#pullrequestreview-374825777", "createdAt": "2020-03-15T19:17:13Z", "commit": null, "state": "APPROVED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xNVQxOToxNzoxM1rOF2guTw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xNVQxOToxNzoyNlrOF2guYw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MjcwMzU2Nw==", "bodyText": "just catalogName?", "url": "https://github.com/trinodb/trino/pull/3084#discussion_r392703567", "createdAt": "2020-03-15T19:17:13Z", "author": {"login": "kokosing"}, "path": "presto-hive/src/main/java/io/prestosql/plugin/hive/s3/HiveS3Module.java", "diffHunk": "@@ -38,8 +41,9 @@ protected void setup(Binder binder)\n             configBinder(binder).bindConfig(HiveS3Config.class);\n \n             binder.bind(PrestoS3FileSystemStats.class).toInstance(PrestoS3FileSystem.getFileSystemStats());\n+            Provider<HiveCatalogName> catalogNameProvider = binder.getProvider(HiveCatalogName.class);", "state": "SUBMITTED", "replyTo": null, "originalCommit": null, "originalPosition": 19}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MjcwMzU4Nw==", "bodyText": "I would inline this method.", "url": "https://github.com/trinodb/trino/pull/3084#discussion_r392703587", "createdAt": "2020-03-15T19:17:26Z", "author": {"login": "kokosing"}, "path": "presto-hive/src/main/java/io/prestosql/plugin/hive/s3/HiveS3Module.java", "diffHunk": "@@ -53,6 +57,11 @@ else if (type == S3FileSystemType.HADOOP_DEFAULT) {\n         }\n     }\n \n+    private String generateStatisticNameForCatalog(Class<?> type, ObjectNameGenerator generator, Provider<HiveCatalogName> catalogNameProvider)", "state": "SUBMITTED", "replyTo": null, "originalCommit": null, "originalPosition": 30}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": null, "afterCommit": null}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzc1Mjg1NDMx", "url": "https://github.com/trinodb/trino/pull/3084#pullrequestreview-375285431", "createdAt": "2020-03-16T14:44:40Z", "commit": null, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xNlQxNDo0NDo0MVrOF23mkw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xNlQxNDo0NDo0MVrOF23mkw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MzA3ODQxOQ==", "bodyText": "formatting change is unrelated and incorrect", "url": "https://github.com/trinodb/trino/pull/3084#discussion_r393078419", "createdAt": "2020-03-16T14:44:41Z", "author": {"login": "kokosing"}, "path": "presto-hive/src/main/java/io/prestosql/plugin/hive/s3/HiveS3Module.java", "diffHunk": "@@ -38,8 +40,9 @@ protected void setup(Binder binder)\n             configBinder(binder).bindConfig(HiveS3Config.class);\n \n             binder.bind(PrestoS3FileSystemStats.class).toInstance(PrestoS3FileSystem.getFileSystemStats());\n+            Provider<HiveCatalogName> catalogName = binder.getProvider(HiveCatalogName.class);\n             newExporter(binder).export(PrestoS3FileSystemStats.class)\n-                    .as(generator -> generator.generatedNameOf(PrestoS3FileSystem.class));", "state": "SUBMITTED", "replyTo": null, "originalCommit": null, "originalPosition": 18}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": null, "afterCommit": null}, {"__typename": "PullRequestCommit", "commit": {"oid": "4520bac81d86d84b375a42ec97fad8915efa08bc", "author": {"user": {"login": "MiguelWeezardo", "name": "Micha\u0142 \u015alizak"}}, "url": "https://github.com/trinodb/trino/commit/4520bac81d86d84b375a42ec97fad8915efa08bc", "committedDate": "2020-03-16T18:46:08Z", "message": "Use catalog name in S3 statistics name\n\nThis fixes the problem of conflicting JMX keys for S3 statistics\nwhen Hive and Iceberg connectors are loaded."}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": null, "afterCommit": {"oid": "4520bac81d86d84b375a42ec97fad8915efa08bc", "author": {"user": {"login": "MiguelWeezardo", "name": "Micha\u0142 \u015alizak"}}, "url": "https://github.com/trinodb/trino/commit/4520bac81d86d84b375a42ec97fad8915efa08bc", "committedDate": "2020-03-16T18:46:08Z", "message": "Use catalog name in S3 statistics name\n\nThis fixes the problem of conflicting JMX keys for S3 statistics\nwhen Hive and Iceberg connectors are loaded."}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2183, "cost": 1, "resetAt": "2021-10-28T19:08:13Z"}}}