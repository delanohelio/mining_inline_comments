{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDcxNjU5Nzg3", "number": 4918, "title": "Pushdown domains with many ranges in Oracle connector", "bodyText": "If domain has more that 1000 ranges it is simplified, before pushdown\nattempt. Without this query would fails with:\nORA-01795: maximum number of expressions in a list is 1000", "createdAt": "2020-08-21T14:14:37Z", "url": "https://github.com/trinodb/trino/pull/4918", "merged": true, "mergeCommit": {"oid": "caa67b85e1b45ba71ddc05518e1d2227a4a42743"}, "closed": true, "closedAt": "2020-08-25T07:49:52Z", "author": {"login": "losipiuk"}, "timelineItems": {"totalCount": 9, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdBHU9HgFqTQ3MjYyNDQ4MQ==", "endCursor": "Y3Vyc29yOnYyOpPPAAABdCJUdzgBqjM2ODcyNjQ4NjU=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDcyNjI0NDgx", "url": "https://github.com/trinodb/trino/pull/4918#pullrequestreview-472624481", "createdAt": "2020-08-21T16:21:49Z", "commit": null, "state": "APPROVED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yMVQxNjoyMTo0OVrOHEzbgQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yMVQxNjoyMzoxN1rOHEzeIw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NDc5ODk3Nw==", "bodyText": "can we remove override now?", "url": "https://github.com/trinodb/trino/pull/4918#discussion_r474798977", "createdAt": "2020-08-21T16:21:49Z", "author": {"login": "findepi"}, "path": "presto-oracle/src/test/java/io/prestosql/plugin/oracle/TestOracleDistributedQueries.java", "diffHunk": "@@ -128,7 +128,7 @@ protected TestTable createTableWithDefaultColumns()\n     @Override\n     public void testLargeIn()\n     {\n-        int numberOfElements = 1000;\n+        int numberOfElements = 5000;", "state": "SUBMITTED", "replyTo": null, "originalCommit": null, "originalPosition": 5}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NDc5OTY1MQ==", "bodyText": "You eliminate a filter here. Do we have a predicate pushdown test for Oracle, like we have for postgres?", "url": "https://github.com/trinodb/trino/pull/4918#discussion_r474799651", "createdAt": "2020-08-21T16:23:17Z", "author": {"login": "findepi"}, "path": "presto-oracle/src/main/java/io/prestosql/plugin/oracle/OracleClient.java", "diffHunk": "@@ -332,6 +345,19 @@ else if (precision > Decimals.MAX_PRECISION || columnSize <= 0) {\n         return Optional.empty();\n     }\n \n+    private static PredicatePushdownController.DomainPushdownResult fullPushdownIfSupported(Domain domain)\n+    {\n+        if (domain.getValues().getRanges().getRangeCount() > ORACLE_MAX_LIST_EXPRESSIONS) {\n+            // pushdown simplified domain\n+            Domain pushedDown = domain.simplify();\n+            return new PredicatePushdownController.DomainPushdownResult(pushedDown, domain);\n+        }\n+        else {\n+            // full pushdown\n+            return new PredicatePushdownController.DomainPushdownResult(domain, Domain.all(domain.getType()));", "state": "SUBMITTED", "replyTo": null, "originalCommit": null, "originalPosition": 109}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDcyOTM3NzEx", "url": "https://github.com/trinodb/trino/pull/4918#pullrequestreview-472937711", "createdAt": "2020-08-22T16:46:11Z", "commit": null, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": null, "afterCommit": null}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": null, "afterCommit": null}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": null, "afterCommit": null}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": null, "afterCommit": null}, {"__typename": "PullRequestCommit", "commit": {"oid": "f8a33e0f13ff18f68d69547d56b6186bf10e584e", "author": {"user": {"login": "losipiuk", "name": "\u0141ukasz Osipiuk"}}, "url": "https://github.com/trinodb/trino/commit/f8a33e0f13ff18f68d69547d56b6186bf10e584e", "committedDate": "2020-08-24T21:14:09Z", "message": "Pushdown domains with many ranges in Oracle connector\n\nIf domain has more that 1000 ranges it is simplified, before pushdown\nattempt. Without this query would fails with:\nORA-01795: maximum number of expressions in a list is 1000"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "4769784dfa2371631e87eab4065629ff0e74880b", "author": {"user": {"login": "losipiuk", "name": "\u0141ukasz Osipiuk"}}, "url": "https://github.com/trinodb/trino/commit/4769784dfa2371631e87eab4065629ff0e74880b", "committedDate": "2020-08-24T21:14:11Z", "message": "Add Oracle pushdown tests"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": null, "afterCommit": {"oid": "4769784dfa2371631e87eab4065629ff0e74880b", "author": {"user": {"login": "losipiuk", "name": "\u0141ukasz Osipiuk"}}, "url": "https://github.com/trinodb/trino/commit/4769784dfa2371631e87eab4065629ff0e74880b", "committedDate": "2020-08-24T21:14:11Z", "message": "Add Oracle pushdown tests"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4055, "cost": 1, "resetAt": "2021-10-28T20:13:43Z"}}}