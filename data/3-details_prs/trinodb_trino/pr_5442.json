{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDk5MTI5NzYz", "number": 5442, "title": "Cleanups in testFilesForAbortedTransactionsIgnored", "bodyText": "", "createdAt": "2020-10-07T09:58:46Z", "url": "https://github.com/trinodb/trino/pull/5442", "merged": true, "mergeCommit": {"oid": "4bdbf7a65620576fd1a19d762795300557779ba3"}, "closed": true, "closedAt": "2020-10-07T12:33:36Z", "author": {"login": "losipiuk"}, "timelineItems": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdQJ-vfAH2gAyNDk5MTI5NzYzOjlhYTk5MWE2NjgyN2IxN2UwZDk5NTY5OTRlMWE2MWVkMGNiYTU4ZGQ=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdQKUiBAH2gAyNDk5MTI5NzYzOmEyZTE4NzExYmM0YjQ4MjkzZTFhMDRlOGU3YmNjZTljZTY2YWY4OTQ=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "9aa991a66827b17e0d9956994e1a61ed0cba58dd", "author": {"user": {"login": "losipiuk", "name": "\u0141ukasz Osipiuk"}}, "url": "https://github.com/trinodb/trino/commit/9aa991a66827b17e0d9956994e1a61ed0cba58dd", "committedDate": "2020-10-07T09:57:42Z", "message": "Cleanups in testFilesForAbortedTransactionsIgnored"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTAzNzE4Nzk5", "url": "https://github.com/trinodb/trino/pull/5442#pullrequestreview-503718799", "createdAt": "2020-10-07T10:02:09Z", "commit": {"oid": "9aa991a66827b17e0d9956994e1a61ed0cba58dd"}, "state": "APPROVED", "comments": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wN1QxMDowMjowOVrOHdr59A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wN1QxMDowNTowMlrOHdsAcg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMDg5MDEwMA==", "bodyText": "can getTablePath be smart enough for that?", "url": "https://github.com/trinodb/trino/pull/5442#discussion_r500890100", "createdAt": "2020-10-07T10:02:09Z", "author": {"login": "findepi"}, "path": "presto-product-tests/src/main/java/io/prestosql/tests/hive/TestHiveTransactionalTable.java", "diffHunk": "@@ -399,6 +394,8 @@ public void testFilesForAbortedTransactionsIgnored()\n             QueryResult onePartitionQueryResult = query(selectFromOnePartitionsSql);\n             assertThat(onePartitionQueryResult).containsExactly(row(1), row(2));\n \n+            String tableLocation = getTablePath(tableName, 1); // pass 1 to trim /delta_... suffix", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "9aa991a66827b17e0d9956994e1a61ed0cba58dd"}, "originalPosition": 48}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMDg5MDQ1Mg==", "bodyText": "why gone?", "url": "https://github.com/trinodb/trino/pull/5442#discussion_r500890452", "createdAt": "2020-10-07T10:02:41Z", "author": {"login": "findepi"}, "path": "presto-product-tests/src/main/java/io/prestosql/tests/hive/TestHiveTransactionalTable.java", "diffHunk": "@@ -407,26 +404,23 @@ public void testFilesForAbortedTransactionsIgnored()\n             client.allocateTableWriteIds(\"default\", tableName, Collections.singletonList(transaction)).get(0).getWriteId();\n             client.abortTransaction(transaction);\n \n-            String deltaA = warehouseDirectory + \"/\" + tableName + \"/delta_0000001_0000001_0000/bucket_00000\";\n-            String deltaB = warehouseDirectory + \"/\" + tableName + \"/delta_0000002_0000002_0000/bucket_00000\";\n-            String deltaC = warehouseDirectory + \"/\" + tableName + \"/delta_0000003_0000003_0000/bucket_00000\";\n+            String deltaA = tableLocation + \"/delta_0000001_0000001_0000\";\n+            String deltaB = tableLocation + \"/delta_0000002_0000002_0000\";\n+            String deltaC = tableLocation + \"/delta_0000003_0000003_0000\";\n \n             // Delete original `delta-B`, `delta-C`\n-            hdfsClient.delete(deltaB);\n-            hdfsClient.delete(deltaC);\n-\n-            ByteArrayOutputStream byteArrayOutputStream = new ByteArrayOutputStream();\n-            hdfsClient.loadFile(deltaA, byteArrayOutputStream);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "9aa991a66827b17e0d9956994e1a61ed0cba58dd"}, "originalPosition": 69}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMDg5MDk3MA==", "bodyText": "target.parent ?", "url": "https://github.com/trinodb/trino/pull/5442#discussion_r500890970", "createdAt": "2020-10-07T10:03:36Z", "author": {"login": "findepi"}, "path": "presto-product-tests/src/main/java/io/prestosql/tests/hive/TestHiveTransactionalTable.java", "diffHunk": "@@ -438,6 +432,28 @@ public void testFilesForAbortedTransactionsIgnored()\n         }\n     }\n \n+    private void hdfsDeleteAll(String directory)\n+    {\n+        if (!hdfsClient.exist(directory)) {\n+            return;\n+        }\n+        for (String file : hdfsClient.listDirectory(directory)) {\n+            hdfsClient.delete(directory + \"/\" + file);\n+        }\n+    }\n+\n+    private void hdfsCopyAll(String source, String target)\n+    {\n+        if (!hdfsClient.exist(target)) {\n+            hdfsClient.createDirectory(target);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "9aa991a66827b17e0d9956994e1a61ed0cba58dd"}, "originalPosition": 104}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMDg5MTc2Mg==", "bodyText": "folow up We should try to remove warehouse_directory_path property\ncc @wendigo", "url": "https://github.com/trinodb/trino/pull/5442#discussion_r500891762", "createdAt": "2020-10-07T10:05:02Z", "author": {"login": "findepi"}, "path": "presto-product-tests/src/main/java/io/prestosql/tests/hive/TestHiveTransactionalTable.java", "diffHunk": "@@ -71,10 +70,6 @@\n     @Inject\n     private TestHiveMetastoreClientFactory testHiveMetastoreClientFactory;\n \n-    @Inject\n-    @Named(\"databases.hive.warehouse_directory_path\")\n-    private String warehouseDirectory;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "9aa991a66827b17e0d9956994e1a61ed0cba58dd"}, "originalPosition": 30}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a2e18711bc4b48293e1a04e8e7bcce9ce66af894", "author": {"user": {"login": "losipiuk", "name": "\u0141ukasz Osipiuk"}}, "url": "https://github.com/trinodb/trino/commit/a2e18711bc4b48293e1a04e8e7bcce9ce66af894", "committedDate": "2020-10-07T10:21:30Z", "message": "Detect ACID tables in getTablePath"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3301, "cost": 1, "resetAt": "2021-10-28T20:13:43Z"}}}