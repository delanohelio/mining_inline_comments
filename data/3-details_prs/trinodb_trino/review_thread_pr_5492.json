{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTAwNTQwMDAz", "number": 5492, "reviewThreads": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wOVQxMzo0NjoxMlrOEsDgrQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wOVQxMzo1ODowNFrOEsDz0A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzE0NjMwMzE3OnYy", "diffSide": "RIGHT", "path": "presto-hive-hadoop2/src/test/java/io/prestosql/plugin/hive/TestHiveHadoop2Plugin.java", "isResolved": false, "comments": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wOVQxMzo0NjoxMlrOHfKY2Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wOVQxNTozNToyOFrOHfPAVQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMjQzODEwNQ==", "bodyText": "I am not convinced that it adds useful coverage, as we are not able to assert anything meaningful.", "url": "https://github.com/trinodb/trino/pull/5492#discussion_r502438105", "createdAt": "2020-10-09T13:46:12Z", "author": {"login": "losipiuk"}, "path": "presto-hive-hadoop2/src/test/java/io/prestosql/plugin/hive/TestHiveHadoop2Plugin.java", "diffHunk": "@@ -65,6 +67,46 @@ public void deinitializeRubix()\n         CachingFileSystem.deinitialize();\n     }\n \n+    @Test\n+    public void testCreateConnector()\n+    {\n+        Plugin plugin = new HiveHadoop2Plugin();\n+        ConnectorFactory factory = getOnlyElement(plugin.getConnectorFactories());\n+        // simplest possible configuration\n+        factory.create(\"test\", ImmutableMap.of(\"hive.metastore.uri\", \"thrift://foo:1234\"), new TestingConnectorContext()).shutdown();\n+    }\n+\n+    @Test\n+    public void testThriftMetastore()\n+    {\n+        Plugin plugin = new HiveHadoop2Plugin();\n+        ConnectorFactory factory = getOnlyElement(plugin.getConnectorFactories());\n+        factory.create(\n+                \"test\",\n+                ImmutableMap.of(\n+                        \"hive.metastore\", \"thrift\",\n+                        \"hive.metastore.uri\", \"thrift://foo:1234\"),\n+                new TestingConnectorContext())\n+                .shutdown();\n+    }\n+\n+    @Test\n+    public void testGlueMetastore()", "state": "SUBMITTED", "replyTo": null, "originalCommit": null, "originalPosition": 44}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMjQ0MDcyNw==", "bodyText": "this covers guice bindings. if not useful as a test itself, it is useful for development\n(unless i forget to run the test...)", "url": "https://github.com/trinodb/trino/pull/5492#discussion_r502440727", "createdAt": "2020-10-09T13:50:19Z", "author": {"login": "findepi"}, "path": "presto-hive-hadoop2/src/test/java/io/prestosql/plugin/hive/TestHiveHadoop2Plugin.java", "diffHunk": "@@ -65,6 +67,46 @@ public void deinitializeRubix()\n         CachingFileSystem.deinitialize();\n     }\n \n+    @Test\n+    public void testCreateConnector()\n+    {\n+        Plugin plugin = new HiveHadoop2Plugin();\n+        ConnectorFactory factory = getOnlyElement(plugin.getConnectorFactories());\n+        // simplest possible configuration\n+        factory.create(\"test\", ImmutableMap.of(\"hive.metastore.uri\", \"thrift://foo:1234\"), new TestingConnectorContext()).shutdown();\n+    }\n+\n+    @Test\n+    public void testThriftMetastore()\n+    {\n+        Plugin plugin = new HiveHadoop2Plugin();\n+        ConnectorFactory factory = getOnlyElement(plugin.getConnectorFactories());\n+        factory.create(\n+                \"test\",\n+                ImmutableMap.of(\n+                        \"hive.metastore\", \"thrift\",\n+                        \"hive.metastore.uri\", \"thrift://foo:1234\"),\n+                new TestingConnectorContext())\n+                .shutdown();\n+    }\n+\n+    @Test\n+    public void testGlueMetastore()", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMjQzODEwNQ=="}, "originalCommit": null, "originalPosition": 44}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMjQ0MTk3Mg==", "bodyText": "in fact, there is currently no other test verifying GlueMetastoreModule works, as TestHiveGlueMetastore instantiates the metastore class directly", "url": "https://github.com/trinodb/trino/pull/5492#discussion_r502441972", "createdAt": "2020-10-09T13:52:12Z", "author": {"login": "findepi"}, "path": "presto-hive-hadoop2/src/test/java/io/prestosql/plugin/hive/TestHiveHadoop2Plugin.java", "diffHunk": "@@ -65,6 +67,46 @@ public void deinitializeRubix()\n         CachingFileSystem.deinitialize();\n     }\n \n+    @Test\n+    public void testCreateConnector()\n+    {\n+        Plugin plugin = new HiveHadoop2Plugin();\n+        ConnectorFactory factory = getOnlyElement(plugin.getConnectorFactories());\n+        // simplest possible configuration\n+        factory.create(\"test\", ImmutableMap.of(\"hive.metastore.uri\", \"thrift://foo:1234\"), new TestingConnectorContext()).shutdown();\n+    }\n+\n+    @Test\n+    public void testThriftMetastore()\n+    {\n+        Plugin plugin = new HiveHadoop2Plugin();\n+        ConnectorFactory factory = getOnlyElement(plugin.getConnectorFactories());\n+        factory.create(\n+                \"test\",\n+                ImmutableMap.of(\n+                        \"hive.metastore\", \"thrift\",\n+                        \"hive.metastore.uri\", \"thrift://foo:1234\"),\n+                new TestingConnectorContext())\n+                .shutdown();\n+    }\n+\n+    @Test\n+    public void testGlueMetastore()", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMjQzODEwNQ=="}, "originalCommit": null, "originalPosition": 44}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMjQ2NDQxNw==", "bodyText": "I guess product tests which use Glue is more reasonable way of testing if GlueMetastoreModule works. Yet it is not something you want to run often during development. Feel free to leave it if you found it useful", "url": "https://github.com/trinodb/trino/pull/5492#discussion_r502464417", "createdAt": "2020-10-09T14:25:08Z", "author": {"login": "losipiuk"}, "path": "presto-hive-hadoop2/src/test/java/io/prestosql/plugin/hive/TestHiveHadoop2Plugin.java", "diffHunk": "@@ -65,6 +67,46 @@ public void deinitializeRubix()\n         CachingFileSystem.deinitialize();\n     }\n \n+    @Test\n+    public void testCreateConnector()\n+    {\n+        Plugin plugin = new HiveHadoop2Plugin();\n+        ConnectorFactory factory = getOnlyElement(plugin.getConnectorFactories());\n+        // simplest possible configuration\n+        factory.create(\"test\", ImmutableMap.of(\"hive.metastore.uri\", \"thrift://foo:1234\"), new TestingConnectorContext()).shutdown();\n+    }\n+\n+    @Test\n+    public void testThriftMetastore()\n+    {\n+        Plugin plugin = new HiveHadoop2Plugin();\n+        ConnectorFactory factory = getOnlyElement(plugin.getConnectorFactories());\n+        factory.create(\n+                \"test\",\n+                ImmutableMap.of(\n+                        \"hive.metastore\", \"thrift\",\n+                        \"hive.metastore.uri\", \"thrift://foo:1234\"),\n+                new TestingConnectorContext())\n+                .shutdown();\n+    }\n+\n+    @Test\n+    public void testGlueMetastore()", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMjQzODEwNQ=="}, "originalCommit": null, "originalPosition": 44}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMjUxMzc0OQ==", "bodyText": "i agree that we should have them -- #5426", "url": "https://github.com/trinodb/trino/pull/5492#discussion_r502513749", "createdAt": "2020-10-09T15:35:28Z", "author": {"login": "findepi"}, "path": "presto-hive-hadoop2/src/test/java/io/prestosql/plugin/hive/TestHiveHadoop2Plugin.java", "diffHunk": "@@ -65,6 +67,46 @@ public void deinitializeRubix()\n         CachingFileSystem.deinitialize();\n     }\n \n+    @Test\n+    public void testCreateConnector()\n+    {\n+        Plugin plugin = new HiveHadoop2Plugin();\n+        ConnectorFactory factory = getOnlyElement(plugin.getConnectorFactories());\n+        // simplest possible configuration\n+        factory.create(\"test\", ImmutableMap.of(\"hive.metastore.uri\", \"thrift://foo:1234\"), new TestingConnectorContext()).shutdown();\n+    }\n+\n+    @Test\n+    public void testThriftMetastore()\n+    {\n+        Plugin plugin = new HiveHadoop2Plugin();\n+        ConnectorFactory factory = getOnlyElement(plugin.getConnectorFactories());\n+        factory.create(\n+                \"test\",\n+                ImmutableMap.of(\n+                        \"hive.metastore\", \"thrift\",\n+                        \"hive.metastore.uri\", \"thrift://foo:1234\"),\n+                new TestingConnectorContext())\n+                .shutdown();\n+    }\n+\n+    @Test\n+    public void testGlueMetastore()", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMjQzODEwNQ=="}, "originalCommit": null, "originalPosition": 44}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzE0NjMyMzMyOnYy", "diffSide": "RIGHT", "path": "presto-hive/src/main/java/io/prestosql/plugin/hive/metastore/RecordingHiveMetastoreModule.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wOVQxMzo1MToxMlrOHfKlXA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wOVQxMzo1MzozNFrOHfKreQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMjQ0MTMwOA==", "bodyText": "Maybe RecordingAwareHiveMetastoreModule. Or OptionalRecordingHiveMetastoreModule. As now it has conditional logic inside.", "url": "https://github.com/trinodb/trino/pull/5492#discussion_r502441308", "createdAt": "2020-10-09T13:51:12Z", "author": {"login": "losipiuk"}, "path": "presto-hive/src/main/java/io/prestosql/plugin/hive/metastore/RecordingHiveMetastoreModule.java", "diffHunk": "@@ -28,24 +32,52 @@\n import static org.weakref.jmx.guice.ExportBinder.newExporter;\n \n public class RecordingHiveMetastoreModule", "state": "SUBMITTED", "replyTo": null, "originalCommit": null, "originalPosition": 16}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMjQ0Mjg3Mw==", "bodyText": "modelled after CachingHiveMetastoreModule -- the module is named caching even though caching can be enabled or disabled\nalso, i am biding with ForRecordingHiveMetastore and then installing the RecordingHiveMetastoreModule, so RecordingHiveMetastoreModule must fulfil the contract even if recording is disabled.", "url": "https://github.com/trinodb/trino/pull/5492#discussion_r502442873", "createdAt": "2020-10-09T13:53:34Z", "author": {"login": "findepi"}, "path": "presto-hive/src/main/java/io/prestosql/plugin/hive/metastore/RecordingHiveMetastoreModule.java", "diffHunk": "@@ -28,24 +32,52 @@\n import static org.weakref.jmx.guice.ExportBinder.newExporter;\n \n public class RecordingHiveMetastoreModule", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMjQ0MTMwOA=="}, "originalCommit": null, "originalPosition": 16}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzE0NjMzNDA0OnYy", "diffSide": "RIGHT", "path": "presto-hive/src/main/java/io/prestosql/plugin/hive/metastore/RecordingHiveMetastoreModule.java", "isResolved": false, "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wOVQxMzo1Mzo1M1rOHfKsTA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wOVQxNDowMDo1MlrOHfK-ww==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMjQ0MzA4NA==", "bodyText": "Why exactly this one is needed?", "url": "https://github.com/trinodb/trino/pull/5492#discussion_r502443084", "createdAt": "2020-10-09T13:53:53Z", "author": {"login": "losipiuk"}, "path": "presto-hive/src/main/java/io/prestosql/plugin/hive/metastore/RecordingHiveMetastoreModule.java", "diffHunk": "@@ -28,24 +32,52 @@\n import static org.weakref.jmx.guice.ExportBinder.newExporter;\n \n public class RecordingHiveMetastoreModule\n-        implements Module\n+        extends AbstractConfigurationAwareModule\n {\n     @Override\n-    public void configure(Binder binder)\n+    protected void setup(Binder binder)\n     {\n-        binder.bind(HiveMetastore.class)\n-                .annotatedWith(ForCachingHiveMetastore.class)\n-                .to(RecordingHiveMetastore.class)\n-                .in(Scopes.SINGLETON);\n-        binder.bind(RecordingHiveMetastore.class).in(Scopes.SINGLETON);\n-        binder.bind(HiveBlockEncodingSerde.class).in(Scopes.SINGLETON);\n+        if (buildConfigObject(HiveConfig.class).getRecordingPath() != null) {\n+            install(new RecordingModule());\n+        }\n+        else {\n+            install(new NoRecordingModule());\n+        }\n+    }\n+\n+    public static class RecordingModule\n+            implements Module\n+    {\n+        @Override\n+        public void configure(Binder binder)\n+        {\n+            binder.bind(HiveMetastore.class)\n+                    .annotatedWith(ForCachingHiveMetastore.class)\n+                    .to(RecordingHiveMetastore.class)\n+                    .in(Scopes.SINGLETON);\n+            binder.bind(RecordingHiveMetastore.class).in(Scopes.SINGLETON);", "state": "SUBMITTED", "replyTo": null, "originalCommit": null, "originalPosition": 48}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMjQ0Njk1Mw==", "bodyText": "it is injected into WriteHiveMetastoreRecordingProcedure", "url": "https://github.com/trinodb/trino/pull/5492#discussion_r502446953", "createdAt": "2020-10-09T13:59:31Z", "author": {"login": "findepi"}, "path": "presto-hive/src/main/java/io/prestosql/plugin/hive/metastore/RecordingHiveMetastoreModule.java", "diffHunk": "@@ -28,24 +32,52 @@\n import static org.weakref.jmx.guice.ExportBinder.newExporter;\n \n public class RecordingHiveMetastoreModule\n-        implements Module\n+        extends AbstractConfigurationAwareModule\n {\n     @Override\n-    public void configure(Binder binder)\n+    protected void setup(Binder binder)\n     {\n-        binder.bind(HiveMetastore.class)\n-                .annotatedWith(ForCachingHiveMetastore.class)\n-                .to(RecordingHiveMetastore.class)\n-                .in(Scopes.SINGLETON);\n-        binder.bind(RecordingHiveMetastore.class).in(Scopes.SINGLETON);\n-        binder.bind(HiveBlockEncodingSerde.class).in(Scopes.SINGLETON);\n+        if (buildConfigObject(HiveConfig.class).getRecordingPath() != null) {\n+            install(new RecordingModule());\n+        }\n+        else {\n+            install(new NoRecordingModule());\n+        }\n+    }\n+\n+    public static class RecordingModule\n+            implements Module\n+    {\n+        @Override\n+        public void configure(Binder binder)\n+        {\n+            binder.bind(HiveMetastore.class)\n+                    .annotatedWith(ForCachingHiveMetastore.class)\n+                    .to(RecordingHiveMetastore.class)\n+                    .in(Scopes.SINGLETON);\n+            binder.bind(RecordingHiveMetastore.class).in(Scopes.SINGLETON);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMjQ0MzA4NA=="}, "originalCommit": null, "originalPosition": 48}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMjQ0NzgxMQ==", "bodyText": "will add a test", "url": "https://github.com/trinodb/trino/pull/5492#discussion_r502447811", "createdAt": "2020-10-09T14:00:52Z", "author": {"login": "findepi"}, "path": "presto-hive/src/main/java/io/prestosql/plugin/hive/metastore/RecordingHiveMetastoreModule.java", "diffHunk": "@@ -28,24 +32,52 @@\n import static org.weakref.jmx.guice.ExportBinder.newExporter;\n \n public class RecordingHiveMetastoreModule\n-        implements Module\n+        extends AbstractConfigurationAwareModule\n {\n     @Override\n-    public void configure(Binder binder)\n+    protected void setup(Binder binder)\n     {\n-        binder.bind(HiveMetastore.class)\n-                .annotatedWith(ForCachingHiveMetastore.class)\n-                .to(RecordingHiveMetastore.class)\n-                .in(Scopes.SINGLETON);\n-        binder.bind(RecordingHiveMetastore.class).in(Scopes.SINGLETON);\n-        binder.bind(HiveBlockEncodingSerde.class).in(Scopes.SINGLETON);\n+        if (buildConfigObject(HiveConfig.class).getRecordingPath() != null) {\n+            install(new RecordingModule());\n+        }\n+        else {\n+            install(new NoRecordingModule());\n+        }\n+    }\n+\n+    public static class RecordingModule\n+            implements Module\n+    {\n+        @Override\n+        public void configure(Binder binder)\n+        {\n+            binder.bind(HiveMetastore.class)\n+                    .annotatedWith(ForCachingHiveMetastore.class)\n+                    .to(RecordingHiveMetastore.class)\n+                    .in(Scopes.SINGLETON);\n+            binder.bind(RecordingHiveMetastore.class).in(Scopes.SINGLETON);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMjQ0MzA4NA=="}, "originalCommit": null, "originalPosition": 48}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzE0NjM1MjE2OnYy", "diffSide": "RIGHT", "path": "presto-hive/src/main/java/io/prestosql/plugin/hive/metastore/glue/DefaultGlueMetastoreTableFilterProvider.java", "isResolved": false, "comments": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wOVQxMzo1ODowNFrOHfK3dg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wOVQxNTozNDo0NFrOHfO-Og==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMjQ0NTk0Mg==", "bodyText": "isnotnull check?", "url": "https://github.com/trinodb/trino/pull/5492#discussion_r502445942", "createdAt": "2020-10-09T13:58:04Z", "author": {"login": "losipiuk"}, "path": "presto-hive/src/main/java/io/prestosql/plugin/hive/metastore/glue/DefaultGlueMetastoreTableFilterProvider.java", "diffHunk": "@@ -0,0 +1,54 @@\n+/*\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+package io.prestosql.plugin.hive.metastore.glue;\n+\n+import com.amazonaws.services.glue.model.Table;\n+import io.prestosql.plugin.hive.metastore.MetastoreConfig;\n+\n+import javax.inject.Inject;\n+import javax.inject.Provider;\n+\n+import java.util.function.Predicate;\n+\n+import static io.prestosql.plugin.hive.HiveMetadata.DELTA_LAKE_PROVIDER;\n+import static io.prestosql.plugin.hive.HiveMetadata.SPARK_TABLE_PROVIDER_KEY;\n+import static java.util.Objects.requireNonNull;\n+import static java.util.function.Predicate.not;\n+\n+public class DefaultGlueMetastoreTableFilterProvider\n+        implements Provider<Predicate<Table>>\n+{\n+    private final boolean hideDeltaLakeTables;\n+\n+    @Inject\n+    public DefaultGlueMetastoreTableFilterProvider(MetastoreConfig metastoreConfig)\n+    {\n+        requireNonNull(metastoreConfig, \"metastoreConfig is null\");\n+        this.hideDeltaLakeTables = metastoreConfig.isHideDeltaLakeTables();\n+    }\n+\n+    @Override\n+    public Predicate<Table> get()\n+    {\n+        if (hideDeltaLakeTables) {\n+            return not(DefaultGlueMetastoreTableFilterProvider::isDeltaLakeTable);\n+        }\n+        return table -> true;\n+    }\n+\n+    public static boolean isDeltaLakeTable(Table table)\n+    {\n+        return table.getParameters().getOrDefault(SPARK_TABLE_PROVIDER_KEY, \"\").equalsIgnoreCase(DELTA_LAKE_PROVIDER);", "state": "SUBMITTED", "replyTo": null, "originalCommit": null, "originalPosition": 52}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMjQ0NzQ2OQ==", "bodyText": "on what? table.getParameters() cannot be null", "url": "https://github.com/trinodb/trino/pull/5492#discussion_r502447469", "createdAt": "2020-10-09T14:00:19Z", "author": {"login": "findepi"}, "path": "presto-hive/src/main/java/io/prestosql/plugin/hive/metastore/glue/DefaultGlueMetastoreTableFilterProvider.java", "diffHunk": "@@ -0,0 +1,54 @@\n+/*\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+package io.prestosql.plugin.hive.metastore.glue;\n+\n+import com.amazonaws.services.glue.model.Table;\n+import io.prestosql.plugin.hive.metastore.MetastoreConfig;\n+\n+import javax.inject.Inject;\n+import javax.inject.Provider;\n+\n+import java.util.function.Predicate;\n+\n+import static io.prestosql.plugin.hive.HiveMetadata.DELTA_LAKE_PROVIDER;\n+import static io.prestosql.plugin.hive.HiveMetadata.SPARK_TABLE_PROVIDER_KEY;\n+import static java.util.Objects.requireNonNull;\n+import static java.util.function.Predicate.not;\n+\n+public class DefaultGlueMetastoreTableFilterProvider\n+        implements Provider<Predicate<Table>>\n+{\n+    private final boolean hideDeltaLakeTables;\n+\n+    @Inject\n+    public DefaultGlueMetastoreTableFilterProvider(MetastoreConfig metastoreConfig)\n+    {\n+        requireNonNull(metastoreConfig, \"metastoreConfig is null\");\n+        this.hideDeltaLakeTables = metastoreConfig.isHideDeltaLakeTables();\n+    }\n+\n+    @Override\n+    public Predicate<Table> get()\n+    {\n+        if (hideDeltaLakeTables) {\n+            return not(DefaultGlueMetastoreTableFilterProvider::isDeltaLakeTable);\n+        }\n+        return table -> true;\n+    }\n+\n+    public static boolean isDeltaLakeTable(Table table)\n+    {\n+        return table.getParameters().getOrDefault(SPARK_TABLE_PROVIDER_KEY, \"\").equalsIgnoreCase(DELTA_LAKE_PROVIDER);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMjQ0NTk0Mg=="}, "originalCommit": null, "originalPosition": 52}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMjQ2MzczMw==", "bodyText": "on table. But feel free to skip it if it is tested down the stack", "url": "https://github.com/trinodb/trino/pull/5492#discussion_r502463733", "createdAt": "2020-10-09T14:24:06Z", "author": {"login": "losipiuk"}, "path": "presto-hive/src/main/java/io/prestosql/plugin/hive/metastore/glue/DefaultGlueMetastoreTableFilterProvider.java", "diffHunk": "@@ -0,0 +1,54 @@\n+/*\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+package io.prestosql.plugin.hive.metastore.glue;\n+\n+import com.amazonaws.services.glue.model.Table;\n+import io.prestosql.plugin.hive.metastore.MetastoreConfig;\n+\n+import javax.inject.Inject;\n+import javax.inject.Provider;\n+\n+import java.util.function.Predicate;\n+\n+import static io.prestosql.plugin.hive.HiveMetadata.DELTA_LAKE_PROVIDER;\n+import static io.prestosql.plugin.hive.HiveMetadata.SPARK_TABLE_PROVIDER_KEY;\n+import static java.util.Objects.requireNonNull;\n+import static java.util.function.Predicate.not;\n+\n+public class DefaultGlueMetastoreTableFilterProvider\n+        implements Provider<Predicate<Table>>\n+{\n+    private final boolean hideDeltaLakeTables;\n+\n+    @Inject\n+    public DefaultGlueMetastoreTableFilterProvider(MetastoreConfig metastoreConfig)\n+    {\n+        requireNonNull(metastoreConfig, \"metastoreConfig is null\");\n+        this.hideDeltaLakeTables = metastoreConfig.isHideDeltaLakeTables();\n+    }\n+\n+    @Override\n+    public Predicate<Table> get()\n+    {\n+        if (hideDeltaLakeTables) {\n+            return not(DefaultGlueMetastoreTableFilterProvider::isDeltaLakeTable);\n+        }\n+        return table -> true;\n+    }\n+\n+    public static boolean isDeltaLakeTable(Table table)\n+    {\n+        return table.getParameters().getOrDefault(SPARK_TABLE_PROVIDER_KEY, \"\").equalsIgnoreCase(DELTA_LAKE_PROVIDER);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMjQ0NTk0Mg=="}, "originalCommit": null, "originalPosition": 52}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMjUxMzIxMA==", "bodyText": "it should not be called for null table", "url": "https://github.com/trinodb/trino/pull/5492#discussion_r502513210", "createdAt": "2020-10-09T15:34:44Z", "author": {"login": "findepi"}, "path": "presto-hive/src/main/java/io/prestosql/plugin/hive/metastore/glue/DefaultGlueMetastoreTableFilterProvider.java", "diffHunk": "@@ -0,0 +1,54 @@\n+/*\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+package io.prestosql.plugin.hive.metastore.glue;\n+\n+import com.amazonaws.services.glue.model.Table;\n+import io.prestosql.plugin.hive.metastore.MetastoreConfig;\n+\n+import javax.inject.Inject;\n+import javax.inject.Provider;\n+\n+import java.util.function.Predicate;\n+\n+import static io.prestosql.plugin.hive.HiveMetadata.DELTA_LAKE_PROVIDER;\n+import static io.prestosql.plugin.hive.HiveMetadata.SPARK_TABLE_PROVIDER_KEY;\n+import static java.util.Objects.requireNonNull;\n+import static java.util.function.Predicate.not;\n+\n+public class DefaultGlueMetastoreTableFilterProvider\n+        implements Provider<Predicate<Table>>\n+{\n+    private final boolean hideDeltaLakeTables;\n+\n+    @Inject\n+    public DefaultGlueMetastoreTableFilterProvider(MetastoreConfig metastoreConfig)\n+    {\n+        requireNonNull(metastoreConfig, \"metastoreConfig is null\");\n+        this.hideDeltaLakeTables = metastoreConfig.isHideDeltaLakeTables();\n+    }\n+\n+    @Override\n+    public Predicate<Table> get()\n+    {\n+        if (hideDeltaLakeTables) {\n+            return not(DefaultGlueMetastoreTableFilterProvider::isDeltaLakeTable);\n+        }\n+        return table -> true;\n+    }\n+\n+    public static boolean isDeltaLakeTable(Table table)\n+    {\n+        return table.getParameters().getOrDefault(SPARK_TABLE_PROVIDER_KEY, \"\").equalsIgnoreCase(DELTA_LAKE_PROVIDER);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMjQ0NTk0Mg=="}, "originalCommit": null, "originalPosition": 52}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4658, "cost": 1, "resetAt": "2021-11-13T12:26:42Z"}}}