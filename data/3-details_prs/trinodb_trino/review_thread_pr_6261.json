{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTM0Njc1Mjg3", "number": 6261, "reviewThreads": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0wOFQyMDozNTo0OVrOFClWbg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0wOVQxMjo1NzoyOFrOFC6SRg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzM4MjUzNDIyOnYy", "diffSide": "RIGHT", "path": "presto-docs/src/main/sphinx/connector/hive.rst", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0wOFQyMDozNTo0OVrOIB0_JA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0wOFQyMTowNjoyNlrOIB2MwQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzODc4NzYyMA==", "bodyText": "This isn't limited to CTEs. I'm not sure we want to document this at all, since this is a deprecated property that can produce incorrect results. This is really a hidden thing for people who were using the old version and understand the consequences.", "url": "https://github.com/trinodb/trino/pull/6261#discussion_r538787620", "createdAt": "2020-12-08T20:35:49Z", "author": {"login": "electrum"}, "path": "presto-docs/src/main/sphinx/connector/hive.rst", "diffHunk": "@@ -310,6 +310,11 @@ Property Name                                      Description\n                                                    can be used to use a different location for each user.\n \n ``hive.translate-hive-views``                      Enable translation for Hive views. (experimental)            ``false``\n+\n+``hive.legacy-hive-view-translation``              Enable translation for Hive views with CTEs. Set this        ``false``", "state": "SUBMITTED", "replyTo": null, "originalCommit": null, "originalPosition": 5}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzODgwNzQ4OQ==", "bodyText": "@willmostly confirmed that the documentation is needed.", "url": "https://github.com/trinodb/trino/pull/6261#discussion_r538807489", "createdAt": "2020-12-08T21:06:26Z", "author": {"login": "m57lyra"}, "path": "presto-docs/src/main/sphinx/connector/hive.rst", "diffHunk": "@@ -310,6 +310,11 @@ Property Name                                      Description\n                                                    can be used to use a different location for each user.\n \n ``hive.translate-hive-views``                      Enable translation for Hive views. (experimental)            ``false``\n+\n+``hive.legacy-hive-view-translation``              Enable translation for Hive views with CTEs. Set this        ``false``", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzODc4NzYyMA=="}, "originalCommit": null, "originalPosition": 5}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzM4MzIzNjQ2OnYy", "diffSide": "RIGHT", "path": "presto-docs/src/main/sphinx/connector/hive.rst", "isResolved": true, "comments": {"totalCount": 6, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0wOFQyMzozNTozNVrOIB7SZA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0wOVQxNzoyMzowMlrOICgXfg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzODg5MDg1Mg==", "bodyText": "I think the descriptions of hive.translate-hive-views and hive.legacy-hive-view-translation might be confusing for new users, since we mention that the first property is as experimental itself and mention the second one as \"legacy\". Also, I think we say experimental, because there're chances that things may evolve/break.\n@electrum Can we take an approach where we fallback to the legacy behavior when coral fails? This can be placed at https://github.com/prestosql/presto/blob/master/presto-hive/src/main/java/io/prestosql/plugin/hive/ViewReaderUtil.java#L183 .", "url": "https://github.com/trinodb/trino/pull/6261#discussion_r538890852", "createdAt": "2020-12-08T23:35:35Z", "author": {"login": "phd3"}, "path": "presto-docs/src/main/sphinx/connector/hive.rst", "diffHunk": "@@ -310,6 +310,13 @@ Property Name                                      Description\n                                                    can be used to use a different location for each user.\n \n ``hive.translate-hive-views``                      Enable translation for Hive views. (experimental)            ``false``\n+\n+``hive.legacy-hive-view-translation``              Use the legacy algorithm to translate Hive views.            ``false``", "state": "SUBMITTED", "replyTo": null, "originalCommit": null, "originalPosition": 5}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzODg5MTkxMQ==", "bodyText": "cc @sopel39 @losipiuk", "url": "https://github.com/trinodb/trino/pull/6261#discussion_r538891911", "createdAt": "2020-12-08T23:38:17Z", "author": {"login": "phd3"}, "path": "presto-docs/src/main/sphinx/connector/hive.rst", "diffHunk": "@@ -310,6 +310,13 @@ Property Name                                      Description\n                                                    can be used to use a different location for each user.\n \n ``hive.translate-hive-views``                      Enable translation for Hive views. (experimental)            ``false``\n+\n+``hive.legacy-hive-view-translation``              Use the legacy algorithm to translate Hive views.            ``false``", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzODg5MDg1Mg=="}, "originalCommit": null, "originalPosition": 5}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzODg5NDQxMw==", "bodyText": "It might be even better to have one toggle only ..\nhive.translate-hive-views=false // off\nhive.translate-hive-views=full // or some other value for coral\nhive.translate-hive-views=legacy // for old one\nhive.translate-hive-views=true // would have to sort out what that defaults to .. full or legacy (legacy would be backward compatible.. but less ideal going forward", "url": "https://github.com/trinodb/trino/pull/6261#discussion_r538894413", "createdAt": "2020-12-08T23:44:30Z", "author": {"login": "mosabua"}, "path": "presto-docs/src/main/sphinx/connector/hive.rst", "diffHunk": "@@ -310,6 +310,13 @@ Property Name                                      Description\n                                                    can be used to use a different location for each user.\n \n ``hive.translate-hive-views``                      Enable translation for Hive views. (experimental)            ``false``\n+\n+``hive.legacy-hive-view-translation``              Use the legacy algorithm to translate Hive views.            ``false``", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzODg5MDg1Mg=="}, "originalCommit": null, "originalPosition": 5}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzOTE5ODM5MA==", "bodyText": "@electrum Can we take an approach where we fallback to the legacy behavior when coral fails?\n\nEven if we have this I would rather have a way to force old logic. There still can be a case when Coral logic seems to work (automatic fallback does not trigger), but generated translation is not correct.", "url": "https://github.com/trinodb/trino/pull/6261#discussion_r539198390", "createdAt": "2020-12-09T10:43:01Z", "author": {"login": "losipiuk"}, "path": "presto-docs/src/main/sphinx/connector/hive.rst", "diffHunk": "@@ -310,6 +310,13 @@ Property Name                                      Description\n                                                    can be used to use a different location for each user.\n \n ``hive.translate-hive-views``                      Enable translation for Hive views. (experimental)            ``false``\n+\n+``hive.legacy-hive-view-translation``              Use the legacy algorithm to translate Hive views.            ``false``", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzODg5MDg1Mg=="}, "originalCommit": null, "originalPosition": 5}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzOTIwMTE2MQ==", "bodyText": "Also, unless we want to change implementation before the 348 release is cut, we should document current state. And this PR is about that.", "url": "https://github.com/trinodb/trino/pull/6261#discussion_r539201161", "createdAt": "2020-12-09T10:47:12Z", "author": {"login": "losipiuk"}, "path": "presto-docs/src/main/sphinx/connector/hive.rst", "diffHunk": "@@ -310,6 +310,13 @@ Property Name                                      Description\n                                                    can be used to use a different location for each user.\n \n ``hive.translate-hive-views``                      Enable translation for Hive views. (experimental)            ``false``\n+\n+``hive.legacy-hive-view-translation``              Use the legacy algorithm to translate Hive views.            ``false``", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzODg5MDg1Mg=="}, "originalCommit": null, "originalPosition": 5}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzOTQ5ODM2Ng==", "bodyText": "Correct. Let's make sure the documentation is merged before the release.", "url": "https://github.com/trinodb/trino/pull/6261#discussion_r539498366", "createdAt": "2020-12-09T17:23:02Z", "author": {"login": "mosabua"}, "path": "presto-docs/src/main/sphinx/connector/hive.rst", "diffHunk": "@@ -310,6 +310,13 @@ Property Name                                      Description\n                                                    can be used to use a different location for each user.\n \n ``hive.translate-hive-views``                      Enable translation for Hive views. (experimental)            ``false``\n+\n+``hive.legacy-hive-view-translation``              Use the legacy algorithm to translate Hive views.            ``false``", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzODg5MDg1Mg=="}, "originalCommit": null, "originalPosition": 5}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzM4NTQxNjg5OnYy", "diffSide": "RIGHT", "path": "presto-docs/src/main/sphinx/connector/hive.rst", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0wOVQxMDo1MDowNFrOICOVlw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0wOVQxMDo1MDowNFrOICOVlw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzOTIwMjk2Nw==", "bodyText": "I would drop the Set this property to ``true`` if you encounter unhandled AST token exceptions with the new experimental algorithm. part but do not feel strongly about it.", "url": "https://github.com/trinodb/trino/pull/6261#discussion_r539202967", "createdAt": "2020-12-09T10:50:04Z", "author": {"login": "losipiuk"}, "path": "presto-docs/src/main/sphinx/connector/hive.rst", "diffHunk": "@@ -310,6 +310,13 @@ Property Name                                      Description\n                                                    can be used to use a different location for each user.\n \n ``hive.translate-hive-views``                      Enable translation for Hive views. (experimental)            ``false``\n+\n+``hive.legacy-hive-view-translation``              Use the legacy algorithm to translate Hive views.            ``false``\n+                                                   Set this property to ``true`` if you encounter unhandled ", "state": "SUBMITTED", "replyTo": null, "originalCommit": null, "originalPosition": 6}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzM4NTk2NDIyOnYy", "diffSide": "RIGHT", "path": "presto-docs/src/main/sphinx/connector/hive.rst", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0wOVQxMjo1NzoyOFrOICTT4A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0wOVQxMzowMDozNlrOICTb5w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzOTI4NDQ0OA==", "bodyText": "This is not limited to AST token expcetions (eg #6234), so\nit should be at least e.g., but i think we can remove the \"troubleshooting\" advice from here\ncc @losipiuk", "url": "https://github.com/trinodb/trino/pull/6261#discussion_r539284448", "createdAt": "2020-12-09T12:57:28Z", "author": {"login": "findepi"}, "path": "presto-docs/src/main/sphinx/connector/hive.rst", "diffHunk": "@@ -310,6 +310,13 @@ Property Name                                      Description\n                                                    can be used to use a different location for each user.\n \n ``hive.translate-hive-views``                      Enable translation for Hive views. (experimental)            ``false``\n+\n+``hive.legacy-hive-view-translation``              Use the legacy algorithm to translate Hive views.            ``false``\n+                                                   Set this property to ``true`` if you encounter unhandled \n+                                                   AST token exceptions with the new experimental algorithm. ", "state": "SUBMITTED", "replyTo": null, "originalCommit": null, "originalPosition": 7}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzOTI4NjUwMw==", "bodyText": "i see know \u0141ukasz suggested the same in #6261 (comment)", "url": "https://github.com/trinodb/trino/pull/6261#discussion_r539286503", "createdAt": "2020-12-09T13:00:36Z", "author": {"login": "findepi"}, "path": "presto-docs/src/main/sphinx/connector/hive.rst", "diffHunk": "@@ -310,6 +310,13 @@ Property Name                                      Description\n                                                    can be used to use a different location for each user.\n \n ``hive.translate-hive-views``                      Enable translation for Hive views. (experimental)            ``false``\n+\n+``hive.legacy-hive-view-translation``              Use the legacy algorithm to translate Hive views.            ``false``\n+                                                   Set this property to ``true`` if you encounter unhandled \n+                                                   AST token exceptions with the new experimental algorithm. ", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzOTI4NDQ0OA=="}, "originalCommit": null, "originalPosition": 7}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4528, "cost": 1, "resetAt": "2021-11-12T12:57:47Z"}}}