{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDY3MTczOTIx", "number": 4804, "title": "Only request client certificate when using certificate authentication", "bodyText": "Fixes #3649", "createdAt": "2020-08-13T06:17:03Z", "url": "https://github.com/trinodb/trino/pull/4804", "merged": true, "mergeCommit": {"oid": "6b6da3dcb37cdb2c5abdd3acf28cd2996a772a1a"}, "closed": true, "closedAt": "2020-08-14T02:05:58Z", "author": {"login": "dain"}, "timelineItems": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABc-aPq1AFqTQ2NjQ4MzQwOA==", "endCursor": "Y3Vyc29yOnYyOpPPAAABc-pKmEABqjM2NTQyNjY2NjA=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDY2NDgzNDA4", "url": "https://github.com/trinodb/trino/pull/4804#pullrequestreview-466483408", "createdAt": "2020-08-13T06:42:21Z", "commit": null, "state": "APPROVED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xM1QwNjo0MjoyMVrOG_-Dgw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xM1QwNjo0MzoxMlrOG_-E2A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2OTczMDE3OQ==", "bodyText": "Update before merging", "url": "https://github.com/trinodb/trino/pull/4804#discussion_r469730179", "createdAt": "2020-08-13T06:42:21Z", "author": {"login": "electrum"}, "path": "pom.xml", "diffHunk": "@@ -46,7 +46,7 @@\n         <dep.accumulo.version>1.7.4</dep.accumulo.version>\n         <dep.accumulo-hadoop.version>2.7.7-1</dep.accumulo-hadoop.version>\n         <dep.antlr.version>4.7.1</dep.antlr.version>\n-        <dep.airlift.version>0.198</dep.airlift.version>\n+        <dep.airlift.version>0.200-SNAPSHOT</dep.airlift.version>", "state": "SUBMITTED", "replyTo": null, "originalCommit": null, "originalPosition": 5}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2OTczMDUyMA==", "bodyText": "Wrong binder", "url": "https://github.com/trinodb/trino/pull/4804#discussion_r469730520", "createdAt": "2020-08-13T06:43:12Z", "author": {"login": "electrum"}, "path": "presto-main/src/main/java/io/prestosql/server/security/ServerSecurityModule.java", "diffHunk": "@@ -61,7 +63,10 @@ protected void setup(Binder binder)\n \n         authenticatorBinder(binder); // create empty map binder\n \n-        installAuthenticator(\"certificate\", CertificateAuthenticator.class, CertificateConfig.class);\n+        install(authenticatorModule(\"certificate\", CertificateAuthenticator.class, certificateBinder -> {\n+            newOptionalBinder(binder, ClientCertificate.class).setBinding().toInstance(ClientCertificate.REQUESTED);", "state": "SUBMITTED", "replyTo": null, "originalCommit": null, "originalPosition": 22}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDY2NDg0NDc4", "url": "https://github.com/trinodb/trino/pull/4804#pullrequestreview-466484478", "createdAt": "2020-08-13T06:44:36Z", "commit": null, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xM1QwNjo0NDozNlrOG_-G8A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xM1QwNjo0NDozNlrOG_-G8A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2OTczMTA1Ng==", "bodyText": "Why do we need this cast?", "url": "https://github.com/trinodb/trino/pull/4804#discussion_r469731056", "createdAt": "2020-08-13T06:44:36Z", "author": {"login": "electrum"}, "path": "presto-main/src/main/java/io/prestosql/server/security/ServerSecurityModule.java", "diffHunk": "@@ -61,7 +63,10 @@ protected void setup(Binder binder)\n \n         authenticatorBinder(binder); // create empty map binder\n \n-        installAuthenticator(\"certificate\", CertificateAuthenticator.class, CertificateConfig.class);\n+        install(authenticatorModule(\"certificate\", CertificateAuthenticator.class, certificateBinder -> {\n+            newOptionalBinder(binder, ClientCertificate.class).setBinding().toInstance(ClientCertificate.REQUESTED);\n+            configBinder(certificateBinder).bindConfig((Class<?>) CertificateConfig.class);", "state": "SUBMITTED", "replyTo": null, "originalCommit": null, "originalPosition": 23}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": null, "afterCommit": null}, {"__typename": "PullRequestCommit", "commit": {"oid": "8ec334b10eab94435af80be53134eb836ea2b6a2", "author": {"user": {"login": "dain", "name": "Dain Sundstrom"}}, "url": "https://github.com/trinodb/trino/commit/8ec334b10eab94435af80be53134eb836ea2b6a2", "committedDate": "2020-08-14T00:06:47Z", "message": "Only request client certificate when using certificate authentication"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": null, "afterCommit": {"oid": "8ec334b10eab94435af80be53134eb836ea2b6a2", "author": {"user": {"login": "dain", "name": "Dain Sundstrom"}}, "url": "https://github.com/trinodb/trino/commit/8ec334b10eab94435af80be53134eb836ea2b6a2", "committedDate": "2020-08-14T00:06:47Z", "message": "Only request client certificate when using certificate authentication"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4349, "cost": 1, "resetAt": "2021-10-28T20:13:43Z"}}}