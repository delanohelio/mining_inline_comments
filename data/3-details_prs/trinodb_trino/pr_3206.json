{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0MzkyMjc2NzQ0", "number": 3206, "title": "Stop at first LDAP match when distinguished name is not required", "bodyText": "", "createdAt": "2020-03-23T09:54:27Z", "url": "https://github.com/trinodb/trino/pull/3206", "merged": true, "mergeCommit": {"oid": "98e243372b03f4d5f70ea05d0173094551983498"}, "closed": true, "closedAt": "2020-03-26T10:01:31Z", "author": {"login": "sopel39"}, "timelineItems": {"totalCount": 9, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcQbTW1gFqTM3OTI3NzUyNw==", "endCursor": "Y3Vyc29yOnYyOpPPAAABcRJg0LgBqjMxNjQ1NzYzOTA=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzc5Mjc3NTI3", "url": "https://github.com/trinodb/trino/pull/3206#pullrequestreview-379277527", "createdAt": "2020-03-23T09:57:24Z", "commit": null, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yM1QwOTo1NzoyNFrOF5-GQQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yM1QwOTo1NzoyNFrOF5-GQQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NjMzMDU2MQ==", "bodyText": "If we're going to stop on first match, we should not return anything.\nOtherwise the returned value is misleading (should not be used for anything), error-prine.\n\nMaybe make this method return Stream\nwhere you currently firstMatch, you would just check stream is not empty\nwhere you currently !firstMatch, you'd limit 2, collect to list and throw if not singleton", "url": "https://github.com/trinodb/trino/pull/3206#discussion_r396330561", "createdAt": "2020-03-23T09:57:24Z", "author": {"login": "findepi"}, "path": "presto-password-authenticators/src/main/java/io/prestosql/plugin/password/ldap/LdapAuthenticator.java", "diffHunk": "@@ -196,7 +196,7 @@ static boolean containsSpecialCharacters(String user)\n         return SPECIAL_CHARACTERS.matchesAnyOf(user);\n     }\n \n-    private String validateGroupMembership(String user, DirContext context)\n+    private String validateGroupMembership(String user, DirContext context, boolean firstMatch)", "state": "SUBMITTED", "replyTo": null, "originalCommit": null, "originalPosition": 38}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": null, "afterCommit": null}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": null, "afterCommit": null}, {"__typename": "PullRequestCommit", "commit": {"oid": "7a0492f654d03563fcba6c5f72a3106e8b4a8361", "author": {"user": {"login": "sopel39", "name": "Karol Sobczak"}}, "url": "https://github.com/trinodb/trino/commit/7a0492f654d03563fcba6c5f72a3106e8b4a8361", "committedDate": "2020-03-23T10:24:53Z", "message": "Stop at first LDAP match when distinguished name is not required"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": null, "afterCommit": {"oid": "7a0492f654d03563fcba6c5f72a3106e8b4a8361", "author": {"user": {"login": "sopel39", "name": "Karol Sobczak"}}, "url": "https://github.com/trinodb/trino/commit/7a0492f654d03563fcba6c5f72a3106e8b4a8361", "committedDate": "2020-03-23T10:24:53Z", "message": "Stop at first LDAP match when distinguished name is not required"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzc5MzI4MDQx", "url": "https://github.com/trinodb/trino/pull/3206#pullrequestreview-379328041", "createdAt": "2020-03-23T11:07:10Z", "commit": {"oid": "7a0492f654d03563fcba6c5f72a3106e8b4a8361"}, "state": "APPROVED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yM1QxMTowNzoxMFrOF6Aj5Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yM1QxMTowNzoxMFrOF6Aj5Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NjM3MDkxNw==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                                String message = format(\"User [%s] not a member of the authorized group\", user);\n          \n          \n            \n                                String message = format(\"User [%s] not a member of an authorized group\", user);", "url": "https://github.com/trinodb/trino/pull/3206#discussion_r396370917", "createdAt": "2020-03-23T11:07:10Z", "author": {"login": "findepi"}, "path": "presto-password-authenticators/src/main/java/io/prestosql/plugin/password/ldap/LdapAuthenticator.java", "diffHunk": "@@ -180,6 +180,28 @@ private String validateGroupMembership(String user, String contextUserDistinguis\n         }\n     }\n \n+    private void checkGroupMembership(String user, String contextUserDistinguishedName, String contextPassword)\n+            throws NamingException\n+    {\n+        DirContext context = createUserDirContext(contextUserDistinguishedName, contextPassword);\n+        try {\n+            NamingEnumeration<SearchResult> search = searchGroupMembership(user, context);\n+            try {\n+                if (!search.hasMore()) {\n+                    String message = format(\"User [%s] not a member of the authorized group\", user);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "7a0492f654d03563fcba6c5f72a3106e8b4a8361"}, "originalPosition": 21}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": null, "afterCommit": null}, {"__typename": "PullRequestCommit", "commit": {"oid": "7f5c6c2c2ebc3f4c433ab055fbb852672e58fc77", "author": {"user": {"login": "sopel39", "name": "Karol Sobczak"}}, "url": "https://github.com/trinodb/trino/commit/7f5c6c2c2ebc3f4c433ab055fbb852672e58fc77", "committedDate": "2020-03-25T15:47:42Z", "message": "Fix message"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": null, "afterCommit": {"oid": "7f5c6c2c2ebc3f4c433ab055fbb852672e58fc77", "author": {"user": {"login": "sopel39", "name": "Karol Sobczak"}}, "url": "https://github.com/trinodb/trino/commit/7f5c6c2c2ebc3f4c433ab055fbb852672e58fc77", "committedDate": "2020-03-25T15:47:42Z", "message": "Fix message"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1974, "cost": 1, "resetAt": "2021-10-28T19:08:13Z"}}}