{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDQyNjQ3OTkz", "number": 4295, "title": "Use product version obtained from Hive in Hive tests", "bodyText": "", "createdAt": "2020-07-01T11:51:01Z", "url": "https://github.com/trinodb/trino/pull/4295", "merged": true, "mergeCommit": {"oid": "1dd8c82255ac2573d672cacddce764c61b1d2c15"}, "closed": true, "closedAt": "2020-07-01T19:21:10Z", "author": {"login": "losipiuk"}, "timelineItems": {"totalCount": 6, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcwpI98gFqTQ0MDgwNzY0Nw==", "endCursor": "Y3Vyc29yOnYyOpPPAAABcwsLdNgBqjM1MDMwNzY3OTY=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDQwODA3NjQ3", "url": "https://github.com/trinodb/trino/pull/4295#pullrequestreview-440807647", "createdAt": "2020-07-01T12:06:36Z", "commit": null, "state": "APPROVED", "comments": {"totalCount": 7, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wMVQxMjowNjozN1rOGrjHEg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wMVQxMjoxMDowN1rOGrjOJQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0ODMxNzIwMg==", "bodyText": "local must be on sep line, otherwise it masks exit codes\nwhat does t and d mean?\nbtw my idiom for grep+sed is\nsed -n 's/..../..../p'", "url": "https://github.com/trinodb/trino/pull/4295#discussion_r448317202", "createdAt": "2020-07-01T12:06:37Z", "author": {"login": "findepi"}, "path": "presto-hive-hadoop2/bin/common.sh", "diffHunk": "@@ -132,3 +132,12 @@ function start_hadoop_docker_containers() {\n   # wait until hadoop processes is started\n   retry check_hadoop\n }\n+\n+function get_hive_major_version() {\n+    local version=$(exec_in_hadoop_master_container hive --version 2>/dev/null | sed 's/^Hive.*[ ]\\([0-9]\\)\\..*/\\1/;t;d')", "state": "SUBMITTED", "replyTo": null, "originalCommit": null, "originalPosition": 6}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0ODMxNzI5OA==", "bodyText": ">&2", "url": "https://github.com/trinodb/trino/pull/4295#discussion_r448317298", "createdAt": "2020-07-01T12:06:48Z", "author": {"login": "findepi"}, "path": "presto-hive-hadoop2/bin/common.sh", "diffHunk": "@@ -132,3 +132,12 @@ function start_hadoop_docker_containers() {\n   # wait until hadoop processes is started\n   retry check_hadoop\n }\n+\n+function get_hive_major_version() {\n+    local version=$(exec_in_hadoop_master_container hive --version 2>/dev/null | sed 's/^Hive.*[ ]\\([0-9]\\)\\..*/\\1/;t;d')\n+    if [[ \"${version}\" == \"\" ]]; then\n+        echo \"Could not obtain Hive major version\"", "state": "SUBMITTED", "replyTo": null, "originalCommit": null, "originalPosition": 8}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0ODMxNzM1Mg==", "bodyText": "\" quote", "url": "https://github.com/trinodb/trino/pull/4295#discussion_r448317352", "createdAt": "2020-07-01T12:06:53Z", "author": {"login": "findepi"}, "path": "presto-hive-hadoop2/bin/common.sh", "diffHunk": "@@ -132,3 +132,12 @@ function start_hadoop_docker_containers() {\n   # wait until hadoop processes is started\n   retry check_hadoop\n }\n+\n+function get_hive_major_version() {\n+    local version=$(exec_in_hadoop_master_container hive --version 2>/dev/null | sed 's/^Hive.*[ ]\\([0-9]\\)\\..*/\\1/;t;d')\n+    if [[ \"${version}\" == \"\" ]]; then\n+        echo \"Could not obtain Hive major version\"\n+        return 1\n+    fi\n+    echo ${version}", "state": "SUBMITTED", "replyTo": null, "originalCommit": null, "originalPosition": 11}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0ODMxNzYwNQ==", "bodyText": "debug?", "url": "https://github.com/trinodb/trino/pull/4295#discussion_r448317605", "createdAt": "2020-07-01T12:07:26Z", "author": {"login": "findepi"}, "path": "presto-hive-hadoop2/bin/run_hive_tests.sh", "diffHunk": "@@ -7,8 +7,12 @@ set -euo pipefail -x\n cleanup_hadoop_docker_containers\n start_hadoop_docker_containers\n \n+# obtain Hive version\n+TESTS_HIVE_VERSION_MAJOR=$(get_hive_major_version)\n+\n # generate test data\n exec_in_hadoop_master_container sudo -Eu hive beeline -u jdbc:hive2://localhost:10000/default -n hive -f /docker/sql/create-test.sql\n+exec_in_hadoop_master_container sudo -Eu hive beeline -u jdbc:hive2://localhost:10000/default -n hive -f /docker/sql/create-test.sql", "state": "SUBMITTED", "replyTo": null, "originalCommit": null, "originalPosition": 9}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0ODMxODExNw==", "bodyText": "This belongs to Use product version obtained from Hive in Hive product tests commit.", "url": "https://github.com/trinodb/trino/pull/4295#discussion_r448318117", "createdAt": "2020-07-01T12:08:29Z", "author": {"login": "findepi"}, "path": "presto-product-tests/bin/product-tests-suite-8-non-generic.sh", "diffHunk": "@@ -12,7 +12,7 @@ fi\n \n suite_exit_code=0\n \n-TESTS_HIVE_VERSION_MAJOR=\"3\" TESTS_HIVE_VERSION_MINOR=\"1\" presto-product-tests-launcher/bin/run-launcher test run \\", "state": "SUBMITTED", "replyTo": null, "originalCommit": null, "originalPosition": 4}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0ODMxODY1Nw==", "bodyText": "This belongs to Use product version obtained from Hive in Hive integration tests\n(the file is used in Hive integration tests only)", "url": "https://github.com/trinodb/trino/pull/4295#discussion_r448318657", "createdAt": "2020-07-01T12:09:27Z", "author": {"login": "findepi"}, "path": "presto-product-tests/conf/product-tests-defaults.sh", "diffHunk": "@@ -1,13 +1,5 @@\n export DOCKER_IMAGES_VERSION=${DOCKER_IMAGES_VERSION:-28}\n \n-if test -v HADOOP_BASE_IMAGE; then\n-    test -v TESTS_HIVE_VERSION_MAJOR\n-    test -v TESTS_HIVE_VERSION_MINOR\n-else\n-    test ! -v TESTS_HIVE_VERSION_MAJOR\n-    test ! -v TESTS_HIVE_VERSION_MINOR\n-\n+if test ! -v HADOOP_BASE_IMAGE; then\n     export HADOOP_BASE_IMAGE=\"prestodev/hdp2.6-hive\"\n-    export TESTS_HIVE_VERSION_MAJOR=\"1\"\n-    export TESTS_HIVE_VERSION_MINOR=\"2\"", "state": "SUBMITTED", "replyTo": null, "originalCommit": null, "originalPosition": 13}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0ODMxOTAxMw==", "bodyText": "This can be now simplified to\nexport HADOOP_BASE_IMAGE=\"${HADOOP_BASE_IMAGE:-prestodev/hdp2.6-hive}\"", "url": "https://github.com/trinodb/trino/pull/4295#discussion_r448319013", "createdAt": "2020-07-01T12:10:07Z", "author": {"login": "findepi"}, "path": "presto-product-tests/conf/product-tests-defaults.sh", "diffHunk": "@@ -1,13 +1,5 @@\n export DOCKER_IMAGES_VERSION=${DOCKER_IMAGES_VERSION:-28}\n \n-if test -v HADOOP_BASE_IMAGE; then\n-    test -v TESTS_HIVE_VERSION_MAJOR\n-    test -v TESTS_HIVE_VERSION_MINOR\n-else\n-    test ! -v TESTS_HIVE_VERSION_MAJOR\n-    test ! -v TESTS_HIVE_VERSION_MINOR\n-\n+if test ! -v HADOOP_BASE_IMAGE; then", "state": "SUBMITTED", "replyTo": null, "originalCommit": null, "originalPosition": 10}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": null, "afterCommit": null}, {"__typename": "PullRequestCommit", "commit": {"oid": "f1bc131537b144527363fb7909ce8e1c067c8f25", "author": {"user": {"login": "losipiuk", "name": "\u0141ukasz Osipiuk"}}, "url": "https://github.com/trinodb/trino/commit/f1bc131537b144527363fb7909ce8e1c067c8f25", "committedDate": "2020-07-01T15:42:36Z", "message": "Use product version obtained from Hive in Hive product tests"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "401e274e84aa5828f6e2c67a3382cd739c8f9840", "author": {"user": {"login": "losipiuk", "name": "\u0141ukasz Osipiuk"}}, "url": "https://github.com/trinodb/trino/commit/401e274e84aa5828f6e2c67a3382cd739c8f9840", "committedDate": "2020-07-01T15:42:36Z", "message": "Use product version obtained from Hive in Hive integration tests"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "40051e68b162e28bf64b091318766c64d41e72c3", "author": {"user": {"login": "losipiuk", "name": "\u0141ukasz Osipiuk"}}, "url": "https://github.com/trinodb/trino/commit/40051e68b162e28bf64b091318766c64d41e72c3", "committedDate": "2020-07-01T15:42:36Z", "message": "Remove unused Hive version variable definitions"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": null, "afterCommit": {"oid": "40051e68b162e28bf64b091318766c64d41e72c3", "author": {"user": {"login": "losipiuk", "name": "\u0141ukasz Osipiuk"}}, "url": "https://github.com/trinodb/trino/commit/40051e68b162e28bf64b091318766c64d41e72c3", "committedDate": "2020-07-01T15:42:36Z", "message": "Remove unused Hive version variable definitions"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 314, "cost": 1, "resetAt": "2021-10-28T19:08:13Z"}}}