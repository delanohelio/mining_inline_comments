{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDU5ODk5Mzg4", "number": 4651, "reviewThreads": {"totalCount": 6, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0zMVQxMDowMzoyNVrOEUAKNg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0zMVQxMDoxMDoyNlrOEUARzQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjg5NDA5NTkwOnYy", "diffSide": "RIGHT", "path": "presto-parser/src/main/antlr4/io/prestosql/sql/parser/SqlBase.g4", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0zMVQxMDowMzoyNVrOG6DJ2A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0zMVQxMDowMzoyNVrOG6DJ2A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MzUyMjI2NA==", "bodyText": "This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters. Learn more about bidirectional Unicode characters\n\n\n  \n\n\n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                | ALTER TABLE (IF EXISTS)? tableName=qualifiedName\n          \n          \n            \n                    RENAME COLUMN (IF EXISTS)? from=identifier TO to=identifier                 #renameColumn\n          \n          \n            \n                | ALTER TABLE (IF EXISTS)? tableName=qualifiedName\n          \n          \n            \n                    DROP COLUMN (IF EXISTS)? column=qualifiedName                               #dropColumn\n          \n          \n            \n                | ALTER TABLE (IF EXISTS)? tableName=qualifiedName\n          \n          \n            \n                    ADD COLUMN (IF NOT EXISTS)? column=columnDefinition                             #addColumn\n          \n          \n            \n                | ANALYZE qualifiedName (WITH properties)?                         #analyze\n          \n          \n            \n                | ALTER TABLE (IF EXISTS)? tableName=qualifiedName\n          \n          \n            \n                    RENAME COLUMN (IF EXISTS)? from=identifier TO to=identifier    #renameColumn\n          \n          \n            \n                | ALTER TABLE (IF EXISTS)? tableName=qualifiedName\n          \n          \n            \n                    DROP COLUMN (IF EXISTS)? column=qualifiedName                  #dropColumn\n          \n          \n            \n                | ALTER TABLE (IF EXISTS)? tableName=qualifiedName\n          \n          \n            \n                    ADD COLUMN (IF NOT EXISTS)? column=columnDefinition            #addColumn\n          \n          \n            \n                | ANALYZE qualifiedName (WITH properties)?                         #analyze", "url": "https://github.com/trinodb/trino/pull/4651#discussion_r463522264", "createdAt": "2020-07-31T10:03:25Z", "author": {"login": "kokosing"}, "path": "presto-parser/src/main/antlr4/io/prestosql/sql/parser/SqlBase.g4", "diffHunk": "@@ -55,15 +55,15 @@ statement\n     | DROP TABLE (IF EXISTS)? qualifiedName                            #dropTable\n     | INSERT INTO qualifiedName columnAliases? query                   #insertInto\n     | DELETE FROM qualifiedName (WHERE booleanExpression)?             #delete\n-    | ALTER TABLE from=qualifiedName RENAME TO to=qualifiedName        #renameTable\n+    | ALTER TABLE (IF EXISTS)? from=qualifiedName RENAME TO to=qualifiedName        #renameTable\n     | COMMENT ON TABLE qualifiedName IS (string | NULL)                #commentTable\n     | COMMENT ON COLUMN qualifiedName IS (string | NULL)               #commentColumn\n-    | ALTER TABLE tableName=qualifiedName\n-        RENAME COLUMN from=identifier TO to=identifier                 #renameColumn\n-    | ALTER TABLE tableName=qualifiedName\n-        DROP COLUMN column=qualifiedName                               #dropColumn\n-    | ALTER TABLE tableName=qualifiedName\n-        ADD COLUMN column=columnDefinition                             #addColumn\n+    | ALTER TABLE (IF EXISTS)? tableName=qualifiedName\n+        RENAME COLUMN (IF EXISTS)? from=identifier TO to=identifier                 #renameColumn\n+    | ALTER TABLE (IF EXISTS)? tableName=qualifiedName\n+        DROP COLUMN (IF EXISTS)? column=qualifiedName                               #dropColumn\n+    | ALTER TABLE (IF EXISTS)? tableName=qualifiedName\n+        ADD COLUMN (IF NOT EXISTS)? column=columnDefinition                             #addColumn\n     | ANALYZE qualifiedName (WITH properties)?                         #analyze", "state": "SUBMITTED", "replyTo": null, "originalCommit": null, "originalPosition": 20}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjg5NDA5ODUzOnYy", "diffSide": "RIGHT", "path": "presto-parser/src/main/java/io/prestosql/sql/tree/AddColumn.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0zMVQxMDowNDoyMVrOG6DLcg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0wNFQxODozOTo0MFrOG7syJw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MzUyMjY3NA==", "bodyText": "tableExists here and in other statement classes", "url": "https://github.com/trinodb/trino/pull/4651#discussion_r463522674", "createdAt": "2020-07-31T10:04:21Z", "author": {"login": "kokosing"}, "path": "presto-parser/src/main/java/io/prestosql/sql/tree/AddColumn.java", "diffHunk": "@@ -27,22 +27,26 @@\n {\n     private final QualifiedName name;\n     private final ColumnDefinition column;\n+    private final boolean tableNameExists;", "state": "SUBMITTED", "replyTo": null, "originalCommit": null, "originalPosition": 4}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NTI1MjkwMw==", "bodyText": "fixed thanks!", "url": "https://github.com/trinodb/trino/pull/4651#discussion_r465252903", "createdAt": "2020-08-04T18:39:40Z", "author": {"login": "leetcode-1533"}, "path": "presto-parser/src/main/java/io/prestosql/sql/tree/AddColumn.java", "diffHunk": "@@ -27,22 +27,26 @@\n {\n     private final QualifiedName name;\n     private final ColumnDefinition column;\n+    private final boolean tableNameExists;", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MzUyMjY3NA=="}, "originalCommit": null, "originalPosition": 4}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjg5NDA5ODc4OnYy", "diffSide": "RIGHT", "path": "presto-parser/src/main/java/io/prestosql/sql/tree/AddColumn.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0zMVQxMDowNDoyN1rOG6DLmA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0wNFQxODozMjoxMFrOG7siig==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MzUyMjcxMg==", "bodyText": "columnNotExists here and in other statement classes\nIn other words Name is not misleading and should not be used in these variable names", "url": "https://github.com/trinodb/trino/pull/4651#discussion_r463522712", "createdAt": "2020-07-31T10:04:27Z", "author": {"login": "kokosing"}, "path": "presto-parser/src/main/java/io/prestosql/sql/tree/AddColumn.java", "diffHunk": "@@ -27,22 +27,26 @@\n {\n     private final QualifiedName name;\n     private final ColumnDefinition column;\n+    private final boolean tableNameExists;\n+    private final boolean columnNameNotExists;", "state": "SUBMITTED", "replyTo": null, "originalCommit": null, "originalPosition": 5}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NTI0ODkwNg==", "bodyText": "fixed, thanks!", "url": "https://github.com/trinodb/trino/pull/4651#discussion_r465248906", "createdAt": "2020-08-04T18:32:10Z", "author": {"login": "leetcode-1533"}, "path": "presto-parser/src/main/java/io/prestosql/sql/tree/AddColumn.java", "diffHunk": "@@ -27,22 +27,26 @@\n {\n     private final QualifiedName name;\n     private final ColumnDefinition column;\n+    private final boolean tableNameExists;\n+    private final boolean columnNameNotExists;", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MzUyMjcxMg=="}, "originalCommit": null, "originalPosition": 5}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjg5NDExMTUwOnYy", "diffSide": "RIGHT", "path": "presto-testing/src/main/java/io/prestosql/testing/AbstractTestDistributedQueries.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0zMVQxMDowOToxM1rOG6DTRQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0zMVQxMDowOToxM1rOG6DTRQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MzUyNDY3Nw==", "bodyText": "This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters. Learn more about bidirectional Unicode characters\n\n\n  \n\n\n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                    assertUpdate(\"ALTER TABLE \" + tableName + \" RENAME COLUMN x TO y\");\n          \n          \n            \n                    assertUpdate(\"ALTER TABLE \" + tableName + \" RENAME COLUMN IF EXISTS columnNotExists TO y\");\n          \n          \n            \n                    assertUpdate(\"ALTER TABLE \" + tableName + \" RENAME COLUMN x TO before_y\");\n          \n          \n            \n                    assertUpdate(\"ALTER TABLE \" + tableName + \" RENAME COLUMN IF EXISTS before_y TO y\");\n          \n          \n            \n                    assertUpdate(\"ALTER TABLE \" + tableName + \" RENAME COLUMN IF EXISTS columnNotExists TO y\");", "url": "https://github.com/trinodb/trino/pull/4651#discussion_r463524677", "createdAt": "2020-07-31T10:09:13Z", "author": {"login": "kokosing"}, "path": "presto-testing/src/main/java/io/prestosql/testing/AbstractTestDistributedQueries.java", "diffHunk": "@@ -375,6 +379,7 @@ public void testRenameColumn()\n         assertUpdate(\"CREATE TABLE \" + tableName + \" AS SELECT 'some value' x\", 1);\n \n         assertUpdate(\"ALTER TABLE \" + tableName + \" RENAME COLUMN x TO y\");\n+        assertUpdate(\"ALTER TABLE \" + tableName + \" RENAME COLUMN IF EXISTS columnNotExists TO y\");", "state": "SUBMITTED", "replyTo": null, "originalCommit": null, "originalPosition": 15}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjg5NDExMzUwOnYy", "diffSide": "RIGHT", "path": "presto-testing/src/main/java/io/prestosql/testing/AbstractTestDistributedQueries.java", "isResolved": false, "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0zMVQxMDowOTo1NVrOG6DUbA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0wNFQxOToxMzoxMlrOG7t3OQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MzUyNDk3Mg==", "bodyText": "Add test where actually column is dropped when IF EXISTS is used.", "url": "https://github.com/trinodb/trino/pull/4651#discussion_r463524972", "createdAt": "2020-07-31T10:09:55Z", "author": {"login": "kokosing"}, "path": "presto-testing/src/main/java/io/prestosql/testing/AbstractTestDistributedQueries.java", "diffHunk": "@@ -395,9 +404,17 @@ public void testDropColumn()\n         assertUpdate(\"CREATE TABLE \" + tableName + \" AS SELECT 123 x, 111 a\", 1);\n \n         assertUpdate(\"ALTER TABLE \" + tableName + \" DROP COLUMN x\");\n+        assertUpdate(\"ALTER TABLE \" + tableName + \" DROP COLUMN IF EXISTS notExistColumn\");", "state": "SUBMITTED", "replyTo": null, "originalCommit": null, "originalPosition": 34}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NTI2NTU3OQ==", "bodyText": "fixed thanks!", "url": "https://github.com/trinodb/trino/pull/4651#discussion_r465265579", "createdAt": "2020-08-04T19:03:47Z", "author": {"login": "leetcode-1533"}, "path": "presto-testing/src/main/java/io/prestosql/testing/AbstractTestDistributedQueries.java", "diffHunk": "@@ -395,9 +404,17 @@ public void testDropColumn()\n         assertUpdate(\"CREATE TABLE \" + tableName + \" AS SELECT 123 x, 111 a\", 1);\n \n         assertUpdate(\"ALTER TABLE \" + tableName + \" DROP COLUMN x\");\n+        assertUpdate(\"ALTER TABLE \" + tableName + \" DROP COLUMN IF EXISTS notExistColumn\");", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MzUyNDk3Mg=="}, "originalCommit": null, "originalPosition": 34}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NTI3MDU4NQ==", "bodyText": "updated for other test case as well.", "url": "https://github.com/trinodb/trino/pull/4651#discussion_r465270585", "createdAt": "2020-08-04T19:13:12Z", "author": {"login": "leetcode-1533"}, "path": "presto-testing/src/main/java/io/prestosql/testing/AbstractTestDistributedQueries.java", "diffHunk": "@@ -395,9 +404,17 @@ public void testDropColumn()\n         assertUpdate(\"CREATE TABLE \" + tableName + \" AS SELECT 123 x, 111 a\", 1);\n \n         assertUpdate(\"ALTER TABLE \" + tableName + \" DROP COLUMN x\");\n+        assertUpdate(\"ALTER TABLE \" + tableName + \" DROP COLUMN IF EXISTS notExistColumn\");", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MzUyNDk3Mg=="}, "originalCommit": null, "originalPosition": 34}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjg5NDExNTMzOnYy", "diffSide": "RIGHT", "path": "presto-testing/src/main/java/io/prestosql/testing/AbstractTestDistributedQueries.java", "isResolved": false, "comments": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0zMVQxMDoxMDoyNlrOG6DVcQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0wNlQxNTo1NTo1NFrOG852GA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MzUyNTIzMw==", "bodyText": "call this assertUpdate(...) twice", "url": "https://github.com/trinodb/trino/pull/4651#discussion_r463525233", "createdAt": "2020-07-31T10:10:26Z", "author": {"login": "kokosing"}, "path": "presto-testing/src/main/java/io/prestosql/testing/AbstractTestDistributedQueries.java", "diffHunk": "@@ -407,6 +424,7 @@ public void testAddColumn()\n         assertUpdate(\"CREATE TABLE \" + tableName + \" AS SELECT CAST('first' AS varchar) x\", 1);\n \n         assertQueryFails(\"ALTER TABLE \" + tableName + \" ADD COLUMN x bigint\", \".* Column 'x' already exists\");\n+        assertUpdate(\"ALTER TABLE \" + tableName + \" ADD COLUMN IF NOT EXISTS x bigint\");", "state": "SUBMITTED", "replyTo": null, "originalCommit": null, "originalPosition": 52}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NTI3MTIyMQ==", "bodyText": "updated. For knowledge purpose, can you tell me why should we call \"assertUpdate(\"ALTER TABLE \" + tableName + \" ADD COLUMN IF NOT EXISTS x bigint\");\" twice?", "url": "https://github.com/trinodb/trino/pull/4651#discussion_r465271221", "createdAt": "2020-08-04T19:14:16Z", "author": {"login": "leetcode-1533"}, "path": "presto-testing/src/main/java/io/prestosql/testing/AbstractTestDistributedQueries.java", "diffHunk": "@@ -407,6 +424,7 @@ public void testAddColumn()\n         assertUpdate(\"CREATE TABLE \" + tableName + \" AS SELECT CAST('first' AS varchar) x\", 1);\n \n         assertQueryFails(\"ALTER TABLE \" + tableName + \" ADD COLUMN x bigint\", \".* Column 'x' already exists\");\n+        assertUpdate(\"ALTER TABLE \" + tableName + \" ADD COLUMN IF NOT EXISTS x bigint\");", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MzUyNTIzMw=="}, "originalCommit": null, "originalPosition": 52}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NTY1NDE4NA==", "bodyText": "Oh my bad. My point was to run it twice so once it creates a column and then it skips column creation (suppress the error0. But here column x already exists. So to make it work here we need to use different column name than x.\nAlso it would be better to use something else than x something that would express the test case. Maybe x -> testing_add_column_if_not_exists?", "url": "https://github.com/trinodb/trino/pull/4651#discussion_r465654184", "createdAt": "2020-08-05T11:16:49Z", "author": {"login": "kokosing"}, "path": "presto-testing/src/main/java/io/prestosql/testing/AbstractTestDistributedQueries.java", "diffHunk": "@@ -407,6 +424,7 @@ public void testAddColumn()\n         assertUpdate(\"CREATE TABLE \" + tableName + \" AS SELECT CAST('first' AS varchar) x\", 1);\n \n         assertQueryFails(\"ALTER TABLE \" + tableName + \" ADD COLUMN x bigint\", \".* Column 'x' already exists\");\n+        assertUpdate(\"ALTER TABLE \" + tableName + \" ADD COLUMN IF NOT EXISTS x bigint\");", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MzUyNTIzMw=="}, "originalCommit": null, "originalPosition": 52}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NjUxNTQ4MA==", "bodyText": "updated! Already add a statement to test can add column even with \"if exists\" statement, so made a duplicate of which.", "url": "https://github.com/trinodb/trino/pull/4651#discussion_r466515480", "createdAt": "2020-08-06T15:55:54Z", "author": {"login": "leetcode-1533"}, "path": "presto-testing/src/main/java/io/prestosql/testing/AbstractTestDistributedQueries.java", "diffHunk": "@@ -407,6 +424,7 @@ public void testAddColumn()\n         assertUpdate(\"CREATE TABLE \" + tableName + \" AS SELECT CAST('first' AS varchar) x\", 1);\n \n         assertQueryFails(\"ALTER TABLE \" + tableName + \" ADD COLUMN x bigint\", \".* Column 'x' already exists\");\n+        assertUpdate(\"ALTER TABLE \" + tableName + \" ADD COLUMN IF NOT EXISTS x bigint\");", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MzUyNTIzMw=="}, "originalCommit": null, "originalPosition": 52}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3564, "cost": 1, "resetAt": "2021-11-12T12:57:47Z"}}}