{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDk4NDkzMzA0", "number": 5428, "reviewThreads": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wNlQxMjoyMzo0MFrOEqs8rw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wNlQxMjoyMzo0MFrOEqs8rw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzEzMjEyMDc5OnYy", "diffSide": "RIGHT", "path": "presto-main/src/main/java/io/prestosql/server/DynamicFilterService.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wNlQxMjoyMzo0MFrOHdDtyg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wNlQxMjoyNzo0MFrOHdD3wQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMDIzMTYyNg==", "bodyText": "Change looks ok to me.\nOne doubt, why don't we just do taskDomains.putIfAbsent and avoid this status check ?", "url": "https://github.com/trinodb/trino/pull/5428#discussion_r500231626", "createdAt": "2020-10-06T12:23:40Z", "author": {"login": "raunaqmorarka"}, "path": "presto-main/src/main/java/io/prestosql/server/DynamicFilterService.java", "diffHunk": "@@ -659,7 +659,8 @@ private void addTaskDynamicFilters(TaskId taskId, Map<DynamicFilterId, Domain> n\n                 // Narrowing down of task dynamic filter is not supported.\n                 // Currently, task dynamic filters are derived from join and semi-join,\n                 // which produce just a single version of dynamic filter.\n-                checkState(taskDomains.put(taskId, domain) == null, \"Task dynamic filter is set twice\");\n+                Domain previousDomain = taskDomains.put(taskId, domain);\n+                checkState(previousDomain == null || domain.equals(previousDomain), \"Different task domains were set\");", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "53c81eb2ace6ebcaf1bad1820161938fe5c3dc97"}, "originalPosition": 6}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMDIzNDE3Nw==", "bodyText": "One doubt, why don't we just do taskDomains.putIfAbsent and avoid this status check ?\n\nThat would mean invariant that there is one version of DF is broken somewhere. We want to enforce that invariant.", "url": "https://github.com/trinodb/trino/pull/5428#discussion_r500234177", "createdAt": "2020-10-06T12:27:40Z", "author": {"login": "sopel39"}, "path": "presto-main/src/main/java/io/prestosql/server/DynamicFilterService.java", "diffHunk": "@@ -659,7 +659,8 @@ private void addTaskDynamicFilters(TaskId taskId, Map<DynamicFilterId, Domain> n\n                 // Narrowing down of task dynamic filter is not supported.\n                 // Currently, task dynamic filters are derived from join and semi-join,\n                 // which produce just a single version of dynamic filter.\n-                checkState(taskDomains.put(taskId, domain) == null, \"Task dynamic filter is set twice\");\n+                Domain previousDomain = taskDomains.put(taskId, domain);\n+                checkState(previousDomain == null || domain.equals(previousDomain), \"Different task domains were set\");", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMDIzMTYyNg=="}, "originalCommit": {"oid": "53c81eb2ace6ebcaf1bad1820161938fe5c3dc97"}, "originalPosition": 6}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4607, "cost": 1, "resetAt": "2021-11-13T12:26:42Z"}}}