{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTIxMDY5NTQ1", "number": 5965, "title": "Add version check in file metastore", "bodyText": "File metastore implementation is tailored for testing purposes and we\nmake no backward compatibility guarantees for the internal structures\nused by it. However, this is not reflected in code behavior, as we make\nthe implementation available and selectable by the users. Prevent\naccidental usage of metadata persisted with one file metastore version\nand being read with a different version to avoid potential incorrect results.\nUsers can still opt in into previous unsafe behavior with a\nconfiguration property.\nRelates to: #5714", "createdAt": "2020-11-14T22:39:00Z", "url": "https://github.com/trinodb/trino/pull/5965", "merged": true, "mergeCommit": {"oid": "5309ce139097c16d2f1af4a7fd8560dc4932ac6a"}, "closed": true, "closedAt": "2020-11-16T15:35:08Z", "author": {"login": "findepi"}, "timelineItems": {"totalCount": 10, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdcjTekAH2gAyNTIxMDY5NTQ1OmRhYjgzZTE0ZDc4NmRkZDg2NGNhYTg1YjUwMWE2NDUzZDk4ZDIyYTU=", "endCursor": "Y3Vyc29yOnYyOpPPAAABddFHuSABqjQwMDAyNzc0NTQ=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "dab83e14d786ddd864caa85b501a6453d98d22a5", "author": {"user": {"login": "findepi", "name": "Piotr Findeisen"}}, "url": "https://github.com/trinodb/trino/commit/dab83e14d786ddd864caa85b501a6453d98d22a5", "committedDate": "2020-11-14T22:15:04Z", "message": "Remove unnecessary use of map builder\n\nIt's the called class responsibility to make an immutable defensive\ncopy."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "25309e23bcc8d360d6d17e173e638124d12e71c4", "author": {"user": {"login": "findepi", "name": "Piotr Findeisen"}}, "url": "https://github.com/trinodb/trino/commit/25309e23bcc8d360d6d17e173e638124d12e71c4", "committedDate": "2020-11-14T22:15:40Z", "message": "Remove redundant constructor"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "42adf048c22a9b7812e3aa8a4aa3a1af429a0f95", "author": {"user": {"login": "findepi", "name": "Piotr Findeisen"}}, "url": "https://github.com/trinodb/trino/commit/42adf048c22a9b7812e3aa8a4aa3a1af429a0f95", "committedDate": "2020-11-14T22:16:04Z", "message": "Pass Presto version to FileHiveMetastore"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "167932a2268155ca629b24e14ef47da0f49ffe4c", "author": {"user": {"login": "findepi", "name": "Piotr Findeisen"}}, "url": "https://github.com/trinodb/trino/commit/167932a2268155ca629b24e14ef47da0f49ffe4c", "committedDate": "2020-11-14T22:16:04Z", "message": "Add writing Presto version to database metadata\n\nRecord which Presto version database metadata was written with in the\nfile metastore."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ebdd3c8d4bce3608bef8f7d6fbf65b1ddbddcf34", "author": {"user": {"login": "findepi", "name": "Piotr Findeisen"}}, "url": "https://github.com/trinodb/trino/commit/ebdd3c8d4bce3608bef8f7d6fbf65b1ddbddcf34", "committedDate": "2020-11-14T22:18:34Z", "message": "Add writing Presto version to table metadata\n\nRecord which Presto version table metadata was written with in the\nfile metastore."}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": null, "afterCommit": null}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTMxMzIyOTMz", "url": "https://github.com/trinodb/trino/pull/5965#pullrequestreview-531322933", "createdAt": "2020-11-16T13:34:33Z", "commit": null, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xNlQxMzozNDozM1rOHz-7vA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xNlQxMzozNDozM1rOHz-7vA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNDI3MDUyNA==", "bodyText": "maybe extract readSechema+checkVersion as helper method.", "url": "https://github.com/trinodb/trino/pull/5965#discussion_r524270524", "createdAt": "2020-11-16T13:34:33Z", "author": {"login": "losipiuk"}, "path": "presto-hive/src/main/java/io/prestosql/plugin/hive/metastore/file/FileHiveMetastore.java", "diffHunk": "@@ -679,6 +693,8 @@ private void alterTable(String databaseName, String tableName, Function<TableMet\n \n         TableMetadata oldTableSchema = readSchemaFile(\"table\", tableMetadataDirectory, tableCodec)\n                 .orElseThrow(() -> new TableNotFoundException(new SchemaTableName(databaseName, tableName)));\n+        checkVersion(oldTableSchema.getWriterVersion());", "state": "SUBMITTED", "replyTo": null, "originalCommit": null, "originalPosition": 89}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTMxMzIzOTA0", "url": "https://github.com/trinodb/trino/pull/5965#pullrequestreview-531323904", "createdAt": "2020-11-16T13:35:38Z", "commit": null, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a4d7f2d6647136547202118f6a87f331fce1d364", "author": {"user": {"login": "findepi", "name": "Piotr Findeisen"}}, "url": "https://github.com/trinodb/trino/commit/a4d7f2d6647136547202118f6a87f331fce1d364", "committedDate": "2020-11-16T13:38:40Z", "message": "Add version check in file metastore\n\nFile metastore implementation is tailored for testing purposes and we\nmake no backward compatibility guarantees for the internal structures\nused by it. However, this is not reflected in code behavior, as we make\nthe implementation available and selectable by the users. Prevent\naccidental usage of metadata persisted with one file metastore version\nand being read with a different version to avoid potential incorrect results.\nUsers can still opt in into previous unsafe behavior with a\nconfiguration property."}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": null, "afterCommit": {"oid": "a4d7f2d6647136547202118f6a87f331fce1d364", "author": {"user": {"login": "findepi", "name": "Piotr Findeisen"}}, "url": "https://github.com/trinodb/trino/commit/a4d7f2d6647136547202118f6a87f331fce1d364", "committedDate": "2020-11-16T13:38:40Z", "message": "Add version check in file metastore\n\nFile metastore implementation is tailored for testing purposes and we\nmake no backward compatibility guarantees for the internal structures\nused by it. However, this is not reflected in code behavior, as we make\nthe implementation available and selectable by the users. Prevent\naccidental usage of metadata persisted with one file metastore version\nand being read with a different version to avoid potential incorrect results.\nUsers can still opt in into previous unsafe behavior with a\nconfiguration property."}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2576, "cost": 1, "resetAt": "2021-10-28T20:13:43Z"}}}