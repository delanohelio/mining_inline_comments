{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTI3Mzg2NzQ3", "number": 6090, "reviewThreads": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0yNVQxMTo0NTo0MVrOE9MQTw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0yNlQwMjoyNjo0NFrOE9dDag==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzMyNTk5Mzc1OnYy", "diffSide": "RIGHT", "path": "presto-main/src/main/java/io/prestosql/operator/OperatorStats.java", "isResolved": false, "comments": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0yNVQxMTo0NTo0MVrOH5vvLA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0yNVQxMjowOTo1OVrOH5wj0Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMDMxMzAwNA==", "bodyText": "i think we should actually throw here.", "url": "https://github.com/trinodb/trino/pull/6090#discussion_r530313004", "createdAt": "2020-11-25T11:45:41Z", "author": {"login": "findepi"}, "path": "presto-main/src/main/java/io/prestosql/operator/OperatorStats.java", "diffHunk": "@@ -521,8 +524,14 @@ public OperatorStats add(Iterable<OperatorStats> operators)\n             }\n \n             OperatorInfo info = operator.getInfo();\n-            if (base != null && info != null && base.getClass() == info.getClass()) {\n-                base = mergeInfo(base, info);\n+            if (base != null && info != null) {\n+                if (base.getClass() != info.getClass()) {\n+                    // TODO should we throw here?\n+                    log.warn(\"Cannot merge operator info: %s and %s\", base, info);", "state": "SUBMITTED", "replyTo": null, "originalCommit": null, "originalPosition": 26}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMDMxNjI0NQ==", "bodyText": "Probably, that line was from 2014, so maybe original reason for this check is no longer valid", "url": "https://github.com/trinodb/trino/pull/6090#discussion_r530316245", "createdAt": "2020-11-25T11:51:34Z", "author": {"login": "sopel39"}, "path": "presto-main/src/main/java/io/prestosql/operator/OperatorStats.java", "diffHunk": "@@ -521,8 +524,14 @@ public OperatorStats add(Iterable<OperatorStats> operators)\n             }\n \n             OperatorInfo info = operator.getInfo();\n-            if (base != null && info != null && base.getClass() == info.getClass()) {\n-                base = mergeInfo(base, info);\n+            if (base != null && info != null) {\n+                if (base.getClass() != info.getClass()) {\n+                    // TODO should we throw here?\n+                    log.warn(\"Cannot merge operator info: %s and %s\", base, info);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMDMxMzAwNA=="}, "originalCommit": null, "originalPosition": 26}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMDMxOTY3NA==", "bodyText": "I think we should throw.", "url": "https://github.com/trinodb/trino/pull/6090#discussion_r530319674", "createdAt": "2020-11-25T11:57:40Z", "author": {"login": "sopel39"}, "path": "presto-main/src/main/java/io/prestosql/operator/OperatorStats.java", "diffHunk": "@@ -521,8 +524,14 @@ public OperatorStats add(Iterable<OperatorStats> operators)\n             }\n \n             OperatorInfo info = operator.getInfo();\n-            if (base != null && info != null && base.getClass() == info.getClass()) {\n-                base = mergeInfo(base, info);\n+            if (base != null && info != null) {\n+                if (base.getClass() != info.getClass()) {\n+                    // TODO should we throw here?\n+                    log.warn(\"Cannot merge operator info: %s and %s\", base, info);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMDMxMzAwNA=="}, "originalCommit": null, "originalPosition": 26}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMDMyNjQ4MQ==", "bodyText": "i replaced this with a check", "url": "https://github.com/trinodb/trino/pull/6090#discussion_r530326481", "createdAt": "2020-11-25T12:09:59Z", "author": {"login": "findepi"}, "path": "presto-main/src/main/java/io/prestosql/operator/OperatorStats.java", "diffHunk": "@@ -521,8 +524,14 @@ public OperatorStats add(Iterable<OperatorStats> operators)\n             }\n \n             OperatorInfo info = operator.getInfo();\n-            if (base != null && info != null && base.getClass() == info.getClass()) {\n-                base = mergeInfo(base, info);\n+            if (base != null && info != null) {\n+                if (base.getClass() != info.getClass()) {\n+                    // TODO should we throw here?\n+                    log.warn(\"Cannot merge operator info: %s and %s\", base, info);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMDMxMzAwNA=="}, "originalCommit": null, "originalPosition": 26}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzMyODc0NjAyOnYy", "diffSide": "RIGHT", "path": "presto-main/src/main/java/io/prestosql/operator/OperatorStats.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0yNlQwMjoyNjo0NFrOH6Jrow==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0yNlQwMjoyNjo0NFrOH6Jrow==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMDczODA4Mw==", "bodyText": "verify() throws a more appropriate exception", "url": "https://github.com/trinodb/trino/pull/6090#discussion_r530738083", "createdAt": "2020-11-26T02:26:44Z", "author": {"login": "electrum"}, "path": "presto-main/src/main/java/io/prestosql/operator/OperatorStats.java", "diffHunk": "@@ -521,7 +522,8 @@ public OperatorStats add(Iterable<OperatorStats> operators)\n             }\n \n             OperatorInfo info = operator.getInfo();\n-            if (base != null && info != null && base.getClass() == info.getClass()) {\n+            if (base != null && info != null) {\n+                checkState(base.getClass() == info.getClass(), \"Cannot merge operator infos: %s and %s\", base, info);", "state": "SUBMITTED", "replyTo": null, "originalCommit": null, "originalPosition": 14}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4668, "cost": 1, "resetAt": "2021-11-12T12:57:47Z"}}}