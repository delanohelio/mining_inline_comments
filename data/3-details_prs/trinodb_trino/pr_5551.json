{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTAzMTk1MjI4", "number": 5551, "title": "Add sink.max-broadcast-buffer-size and set it to 200MB by default", "bodyText": "By default broadcast joins are chosen by CBO when build side\ndoes not exceed 100MB. It can happen that a build side is\ncollected from a single split (e.g dimension table). This means\nthat 32MB buffer can be fully filled on a single node and build side\ntasks become blocked. Scheduler will then force probe task-to-node\nassignments in order to continue with query execution. This\nprevnts scaling of probe side tasks to new nodes and also\nterminates lazy dynamic filters. Ideally, broadcast buffer\nshould never be overutilized.", "createdAt": "2020-10-14T08:13:40Z", "url": "https://github.com/trinodb/trino/pull/5551", "merged": true, "mergeCommit": {"oid": "70f20cc02799d03576a573ad424f1c2815b8f6b9"}, "closed": true, "closedAt": "2020-10-15T09:38:27Z", "author": {"login": "sopel39"}, "timelineItems": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdSYuZIAH2gAyNTAzMTk1MjI4OjY3MGM3ZTRlMDM2YzYxODE0ZjQxZTMxZmZjMzI5NjI3ZWUxM2I2Njk=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdSg10SgFqTUwODU4NTIyMg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "670c7e4e036c61814f41e31ffc329627ee13b669", "author": {"user": {"login": "sopel39", "name": "Karol Sobczak"}}, "url": "https://github.com/trinodb/trino/commit/670c7e4e036c61814f41e31ffc329627ee13b669", "committedDate": "2020-10-14T08:16:16Z", "message": "Add sink.max-broadcast-buffer-size and set it to 200MB by default\n\nBy default broadcast joins are chosen by CBO when build side\ndoes not exceed 100MB. It can happen that a build side is\ncollected from a single split (e.g dimension table). This means\nthat 32MB buffer can be fully filled on a single node and build side\ntasks become blocked. Scheduler will then force probe task-to-node\nassignments in order to continue with query execution. This\nprevnts scaling of probe side tasks to new nodes and also\nterminates lazy dynamic filters. Ideally, broadcast buffer\nshould never be overutilized."}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": null, "afterCommit": {"oid": "670c7e4e036c61814f41e31ffc329627ee13b669", "author": {"user": {"login": "sopel39", "name": "Karol Sobczak"}}, "url": "https://github.com/trinodb/trino/commit/670c7e4e036c61814f41e31ffc329627ee13b669", "committedDate": "2020-10-14T08:16:16Z", "message": "Add sink.max-broadcast-buffer-size and set it to 200MB by default\n\nBy default broadcast joins are chosen by CBO when build side\ndoes not exceed 100MB. It can happen that a build side is\ncollected from a single split (e.g dimension table). This means\nthat 32MB buffer can be fully filled on a single node and build side\ntasks become blocked. Scheduler will then force probe task-to-node\nassignments in order to continue with query execution. This\nprevnts scaling of probe side tasks to new nodes and also\nterminates lazy dynamic filters. Ideally, broadcast buffer\nshould never be overutilized."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTA4MTI2NzQx", "url": "https://github.com/trinodb/trino/pull/5551#pullrequestreview-508126741", "createdAt": "2020-10-14T08:47:01Z", "commit": {"oid": "670c7e4e036c61814f41e31ffc329627ee13b669"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xNFQwODo0NzowMlrOHhItGQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xNFQwODo0NzowMlrOHhItGQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNDUwNzY3Mw==", "bodyText": "is it better that we have it as max(sink.max-buffer-size, sink.max-broadcast-buffer-size)? and mention that in the documentation? so that if someone wants to bump the generic buffer size, the broadcast buffer also gets bumped up automatically.", "url": "https://github.com/trinodb/trino/pull/5551#discussion_r504507673", "createdAt": "2020-10-14T08:47:02Z", "author": {"login": "rohangarg"}, "path": "presto-main/src/main/java/io/prestosql/execution/buffer/LazyOutputBuffer.java", "diffHunk": "@@ -164,7 +167,7 @@ public void setOutputBuffers(OutputBuffers newOutputBuffers)\n                         delegate = new PartitionedOutputBuffer(taskInstanceId, state, newOutputBuffers, maxBufferSize, systemMemoryContextSupplier, executor);\n                         break;\n                     case BROADCAST:\n-                        delegate = new BroadcastOutputBuffer(taskInstanceId, state, maxBufferSize, systemMemoryContextSupplier, executor, notifyStatusChanged);\n+                        delegate = new BroadcastOutputBuffer(taskInstanceId, state, maxBroadcastBufferSize, systemMemoryContextSupplier, executor, notifyStatusChanged);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "670c7e4e036c61814f41e31ffc329627ee13b669"}, "originalPosition": 29}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTA4MzE2NjM3", "url": "https://github.com/trinodb/trino/pull/5551#pullrequestreview-508316637", "createdAt": "2020-10-14T12:58:37Z", "commit": {"oid": "670c7e4e036c61814f41e31ffc329627ee13b669"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTA4NTg1MjIy", "url": "https://github.com/trinodb/trino/pull/5551#pullrequestreview-508585222", "createdAt": "2020-10-14T17:43:37Z", "commit": {"oid": "670c7e4e036c61814f41e31ffc329627ee13b669"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3455, "cost": 1, "resetAt": "2021-10-28T20:13:43Z"}}}