{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0Mzg3Mjk0ODQ0", "number": 3084, "reviewThreads": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xMlQxNTo0Nzo1MlrODnhUZA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xNlQxNDo0NDo0MVrODoXYRQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjQyNzY2OTQ4OnYy", "diffSide": "RIGHT", "path": "presto-hive/src/main/java/io/prestosql/plugin/hive/InternalHiveConnectorFactory.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xMlQxNTo0Nzo1MlrOF1kVaA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xMlQxNTo0Nzo1MlrOF1kVaA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MTcxNDE1Mg==", "bodyText": "There is HiveCatalogName bean binded already", "url": "https://github.com/trinodb/trino/pull/3084#discussion_r391714152", "createdAt": "2020-03-12T15:47:52Z", "author": {"login": "kokosing"}, "path": "presto-hive/src/main/java/io/prestosql/plugin/hive/InternalHiveConnectorFactory.java", "diffHunk": "@@ -81,7 +81,7 @@ public static Connector createConnector(String catalogName, Map<String, String>\n                     new ConnectorObjectNameGeneratorModule(catalogName, \"io.prestosql.plugin.hive\", \"presto.plugin.hive\"),\n                     new JsonModule(),\n                     new HiveModule(),\n-                    new HiveS3Module(),\n+                    new HiveS3Module(catalogName),", "state": "SUBMITTED", "replyTo": null, "originalCommit": null, "originalPosition": 5}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjQyNzY3MzgwOnYy", "diffSide": "RIGHT", "path": "presto-hive/src/main/java/io/prestosql/plugin/hive/s3/HiveS3Module.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xMlQxNTo0ODo1MVrOF1kYFw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xM1QxNjowMzowOVrOF2JZmg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MTcxNDgzOQ==", "bodyText": "You can use provider of HiveCatalogName and pass function here to generate name lazy. After guice configuration", "url": "https://github.com/trinodb/trino/pull/3084#discussion_r391714839", "createdAt": "2020-03-12T15:48:51Z", "author": {"login": "kokosing"}, "path": "presto-hive/src/main/java/io/prestosql/plugin/hive/s3/HiveS3Module.java", "diffHunk": "@@ -39,7 +47,7 @@ protected void setup(Binder binder)\n \n             binder.bind(PrestoS3FileSystemStats.class).toInstance(PrestoS3FileSystem.getFileSystemStats());\n             newExporter(binder).export(PrestoS3FileSystemStats.class)\n-                    .as(generator -> generator.generatedNameOf(PrestoS3FileSystem.class));\n+                    .as(generator -> generator.generatedNameOf(PrestoS3FileSystem.class, catalogName));", "state": "SUBMITTED", "replyTo": null, "originalCommit": null, "originalPosition": 27}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MjMyMTQzNA==", "bodyText": "I tried to replace catalogName with binder.getProvider(HiveCatalogName.class).get().toString() but I'm getting the following error:\n2020-03-13T16:45:14.015+0100\tERROR\tmain\tio.prestosql.server.PrestoServer\tUnable to create injector, see the following errors:\n\n1) Error injecting constructor, java.lang.NullPointerException: moduleSource cannot be null.\n  at org.weakref.jmx.guice.GuiceMBeanExporter.<init>(GuiceMBeanExporter.java:40)\n  at org.weakref.jmx.guice.MBeanModule.configure(MBeanModule.java:39)\n  while locating org.weakref.jmx.guice.GuiceMBeanExporter\n\n1 error\ncom.google.inject.CreationException: Unable to create injector, see the following errors:\n\n1) Error injecting constructor, java.lang.NullPointerException: moduleSource cannot be null.\n  at org.weakref.jmx.guice.GuiceMBeanExporter.<init>(GuiceMBeanExporter.java:40)\n  at org.weakref.jmx.guice.MBeanModule.configure(MBeanModule.java:39)\n  while locating org.weakref.jmx.guice.GuiceMBeanExporter\n\n1 error\n\tat com.google.inject.internal.Errors.throwCreationExceptionIfErrorsExist(Errors.java:543)\n\tat com.google.inject.internal.InternalInjectorCreator.injectDynamically(InternalInjectorCreator.java:186)\n\tat com.google.inject.internal.InternalInjectorCreator.build(InternalInjectorCreator.java:109)\n\tat com.google.inject.Guice.createInjector(Guice.java:87)\n\tat io.airlift.bootstrap.Bootstrap.initialize(Bootstrap.java:245)\n\tat io.prestosql.plugin.hive.InternalHiveConnectorFactory.createConnector(InternalHiveConnectorFactory.java:96)\n\tat sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)\n\tat sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)\n\tat sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)\n\tat java.lang.reflect.Method.invoke(Method.java:498)\n\tat io.prestosql.plugin.hive.HiveConnectorFactory.create(HiveConnectorFactory.java:52)\n\tat io.prestosql.connector.ConnectorManager.createConnector(ConnectorManager.java:341)\n\tat io.prestosql.connector.ConnectorManager.createCatalog(ConnectorManager.java:203)\n\tat io.prestosql.connector.ConnectorManager.createCatalog(ConnectorManager.java:195)\n\tat io.prestosql.connector.ConnectorManager.createCatalog(ConnectorManager.java:181)\n\tat io.prestosql.metadata.StaticCatalogStore.loadCatalog(StaticCatalogStore.java:88)\n\tat io.prestosql.metadata.StaticCatalogStore.loadCatalogs(StaticCatalogStore.java:68)\n\tat io.prestosql.server.PrestoServer.run(PrestoServer.java:129)\n\tat io.prestosql.$gen.Presto_null____20200313_154403_1.run(Unknown Source)\n\tat io.prestosql.server.PrestoServer.main(PrestoServer.java:72)\nCaused by: java.lang.NullPointerException: moduleSource cannot be null.\n\tat com.google.common.base.Preconditions.checkNotNull(Preconditions.java:895)\n\tat com.google.inject.spi.ElementSource.<init>(ElementSource.java:94)\n\tat com.google.inject.spi.Elements$RecordingBinder.getElementSource(Elements.java:561)\n\tat com.google.inject.spi.Elements$RecordingBinder.getProvider(Elements.java:411)\n\tat com.google.inject.spi.Elements$RecordingBinder.getProvider(Elements.java:406)\n\tat com.google.inject.spi.Elements$RecordingBinder.getProvider(Elements.java:418)\n\tat io.prestosql.plugin.hive.s3.HiveS3Module.lambda$setup$0(HiveS3Module.java:43)\n\tat org.weakref.jmx.guice.Mapping.getName(Mapping.java:36)\n\tat org.weakref.jmx.guice.GuiceMBeanExporter.export(GuiceMBeanExporter.java:92)\n\tat org.weakref.jmx.guice.GuiceMBeanExporter.<init>(GuiceMBeanExporter.java:42)\n\tat org.weakref.jmx.guice.GuiceMBeanExporter$$FastClassByGuice$$6cc63b28.newInstance(<generated>)\n\tat com.google.inject.internal.DefaultConstructionProxyFactory$FastClassProxy.newInstance(DefaultConstructionProxyFactory.java:89)\n\tat com.google.inject.internal.ConstructorInjector.provision(ConstructorInjector.java:114)\n\tat com.google.inject.internal.ConstructorInjector.access$000(ConstructorInjector.java:32)\n\tat com.google.inject.internal.ConstructorInjector$1.call(ConstructorInjector.java:98)\n\tat com.google.inject.internal.ProvisionListenerStackCallback$Provision.provision(ProvisionListenerStackCallback.java:112)\n\tat io.airlift.bootstrap.LifeCycleModule.provision(LifeCycleModule.java:54)\n\tat com.google.inject.internal.ProvisionListenerStackCallback$Provision.provision(ProvisionListenerStackCallback.java:120)\n\tat com.google.inject.internal.ProvisionListenerStackCallback.provision(ProvisionListenerStackCallback.java:66)\n\tat com.google.inject.internal.ConstructorInjector.construct(ConstructorInjector.java:93)\n\tat com.google.inject.internal.ConstructorBindingImpl$Factory.get(ConstructorBindingImpl.java:306)\n\tat com.google.inject.internal.ProviderToInternalFactoryAdapter.get(ProviderToInternalFactoryAdapter.java:40)\n\tat com.google.inject.internal.SingletonScope$1.get(SingletonScope.java:168)\n\tat com.google.inject.internal.InternalFactoryToProviderAdapter.get(InternalFactoryToProviderAdapter.java:39)\n\tat com.google.inject.internal.InternalInjectorCreator.loadEagerSingletons(InternalInjectorCreator.java:211)\n\tat com.google.inject.internal.InternalInjectorCreator.injectDynamically(InternalInjectorCreator.java:182)\n\t... 18 more\n\nI'm open to suggestions, it seems the binder isn't ready to create a provider at this point (we're still during module setup).", "url": "https://github.com/trinodb/trino/pull/3084#discussion_r392321434", "createdAt": "2020-03-13T16:03:09Z", "author": {"login": "MiguelWeezardo"}, "path": "presto-hive/src/main/java/io/prestosql/plugin/hive/s3/HiveS3Module.java", "diffHunk": "@@ -39,7 +47,7 @@ protected void setup(Binder binder)\n \n             binder.bind(PrestoS3FileSystemStats.class).toInstance(PrestoS3FileSystem.getFileSystemStats());\n             newExporter(binder).export(PrestoS3FileSystemStats.class)\n-                    .as(generator -> generator.generatedNameOf(PrestoS3FileSystem.class));\n+                    .as(generator -> generator.generatedNameOf(PrestoS3FileSystem.class, catalogName));", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MTcxNDgzOQ=="}, "originalCommit": null, "originalPosition": 27}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjQzNDEyMzgzOnYy", "diffSide": "RIGHT", "path": "presto-hive/src/main/java/io/prestosql/plugin/hive/s3/HiveS3Module.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xNVQxOToxNzoxM1rOF2guTw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xNVQxOToxNzoxM1rOF2guTw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MjcwMzU2Nw==", "bodyText": "just catalogName?", "url": "https://github.com/trinodb/trino/pull/3084#discussion_r392703567", "createdAt": "2020-03-15T19:17:13Z", "author": {"login": "kokosing"}, "path": "presto-hive/src/main/java/io/prestosql/plugin/hive/s3/HiveS3Module.java", "diffHunk": "@@ -38,8 +41,9 @@ protected void setup(Binder binder)\n             configBinder(binder).bindConfig(HiveS3Config.class);\n \n             binder.bind(PrestoS3FileSystemStats.class).toInstance(PrestoS3FileSystem.getFileSystemStats());\n+            Provider<HiveCatalogName> catalogNameProvider = binder.getProvider(HiveCatalogName.class);", "state": "SUBMITTED", "replyTo": null, "originalCommit": null, "originalPosition": 19}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjQzNDEyMzk2OnYy", "diffSide": "RIGHT", "path": "presto-hive/src/main/java/io/prestosql/plugin/hive/s3/HiveS3Module.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xNVQxOToxNzoyNlrOF2guYw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xNVQxOToxNzoyNlrOF2guYw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MjcwMzU4Nw==", "bodyText": "I would inline this method.", "url": "https://github.com/trinodb/trino/pull/3084#discussion_r392703587", "createdAt": "2020-03-15T19:17:26Z", "author": {"login": "kokosing"}, "path": "presto-hive/src/main/java/io/prestosql/plugin/hive/s3/HiveS3Module.java", "diffHunk": "@@ -53,6 +57,11 @@ else if (type == S3FileSystemType.HADOOP_DEFAULT) {\n         }\n     }\n \n+    private String generateStatisticNameForCatalog(Class<?> type, ObjectNameGenerator generator, Provider<HiveCatalogName> catalogNameProvider)", "state": "SUBMITTED", "replyTo": null, "originalCommit": null, "originalPosition": 30}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjQzNjUyNjc3OnYy", "diffSide": "LEFT", "path": "presto-hive/src/main/java/io/prestosql/plugin/hive/s3/HiveS3Module.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xNlQxNDo0NDo0MVrOF23mkw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xNlQxNDo0NDo0MVrOF23mkw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MzA3ODQxOQ==", "bodyText": "formatting change is unrelated and incorrect", "url": "https://github.com/trinodb/trino/pull/3084#discussion_r393078419", "createdAt": "2020-03-16T14:44:41Z", "author": {"login": "kokosing"}, "path": "presto-hive/src/main/java/io/prestosql/plugin/hive/s3/HiveS3Module.java", "diffHunk": "@@ -38,8 +40,9 @@ protected void setup(Binder binder)\n             configBinder(binder).bindConfig(HiveS3Config.class);\n \n             binder.bind(PrestoS3FileSystemStats.class).toInstance(PrestoS3FileSystem.getFileSystemStats());\n+            Provider<HiveCatalogName> catalogName = binder.getProvider(HiveCatalogName.class);\n             newExporter(binder).export(PrestoS3FileSystemStats.class)\n-                    .as(generator -> generator.generatedNameOf(PrestoS3FileSystem.class));", "state": "SUBMITTED", "replyTo": null, "originalCommit": null, "originalPosition": 18}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 570, "cost": 1, "resetAt": "2021-11-13T12:10:21Z"}}}