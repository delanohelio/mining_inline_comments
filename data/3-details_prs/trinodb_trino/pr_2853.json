{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0Mzc2MDIyNDMy", "number": 2853, "title": "Remove redundant remote exchanges due to missing unaliasing", "bodyText": "", "createdAt": "2020-02-17T09:12:52Z", "url": "https://github.com/trinodb/trino/pull/2853", "merged": true, "mergeCommit": {"oid": "4a52b0b145732380d4a185a06617f9858a5ab6d5"}, "closed": true, "closedAt": "2020-02-21T10:47:32Z", "author": {"login": "sopel39"}, "timelineItems": {"totalCount": 6, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcFKBsKABqjMwNDI5NTM3NjM=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcGc2vvABqjMwNTk5MjkwNTI=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "HeadRefForcePushedEvent", "beforeCommit": null, "afterCommit": null}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzYyMjYxNTQ4", "url": "https://github.com/trinodb/trino/pull/2853#pullrequestreview-362261548", "createdAt": "2020-02-20T21:54:13Z", "commit": null, "state": "APPROVED", "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yMFQyMTo1NDoxM1rOFskdng==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yMFQyMTo1Njo0OFrOFskiGQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MjI3OTA3MA==", "bodyText": "This should be safe to remove (equi should be on same type), so you can extract this to a preparatory cleanup", "url": "https://github.com/trinodb/trino/pull/2853#discussion_r382279070", "createdAt": "2020-02-20T21:54:13Z", "author": {"login": "findepi"}, "path": "presto-main/src/main/java/io/prestosql/sql/planner/optimizations/UnaliasSymbolReferences.java", "diffHunk": "@@ -521,8 +521,9 @@ public PlanNode visitJoin(JoinNode node, RewriteContext<Void> context)\n \n             if (node.getType() == INNER) {\n                 canonicalCriteria.stream()\n-                        .filter(clause -> types.get(clause.getLeft()).equals(types.get(clause.getRight())))", "state": "SUBMITTED", "replyTo": null, "originalCommit": null, "originalPosition": 4}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MjI4MDE0Mg==", "bodyText": "I think this is correct except for RIGHT joins. Maybe map equi-condition symbols to left symbol for all joins except RIGHT, and map to right symbols otherwise?", "url": "https://github.com/trinodb/trino/pull/2853#discussion_r382280142", "createdAt": "2020-02-20T21:56:39Z", "author": {"login": "findepi"}, "path": "presto-main/src/main/java/io/prestosql/sql/planner/optimizations/UnaliasSymbolReferences.java", "diffHunk": "@@ -521,8 +521,9 @@ public PlanNode visitJoin(JoinNode node, RewriteContext<Void> context)\n \n             if (node.getType() == INNER) {\n                 canonicalCriteria.stream()\n-                        .filter(clause -> types.get(clause.getLeft()).equals(types.get(clause.getRight())))\n-                        .filter(clause -> node.getOutputSymbols().contains(clause.getLeft()))\n+                        // Map right equi-condition symbols to left symbols. This helps to\n+                        // reuse join node partitioning better as partitioning properties are\n+                        // only derived from probe side symbols", "state": "SUBMITTED", "replyTo": null, "originalCommit": null, "originalPosition": 8}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MjI4MDIxNw==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                                    // Map right equi-condition symbols to left symbols. This helps to\n          \n          \n            \n                                    // Map right equi-condition symbol to left symbol. This helps to", "url": "https://github.com/trinodb/trino/pull/2853#discussion_r382280217", "createdAt": "2020-02-20T21:56:48Z", "author": {"login": "findepi"}, "path": "presto-main/src/main/java/io/prestosql/sql/planner/optimizations/UnaliasSymbolReferences.java", "diffHunk": "@@ -521,8 +521,9 @@ public PlanNode visitJoin(JoinNode node, RewriteContext<Void> context)\n \n             if (node.getType() == INNER) {\n                 canonicalCriteria.stream()\n-                        .filter(clause -> types.get(clause.getLeft()).equals(types.get(clause.getRight())))\n-                        .filter(clause -> node.getOutputSymbols().contains(clause.getLeft()))\n+                        // Map right equi-condition symbols to left symbols. This helps to", "state": "SUBMITTED", "replyTo": null, "originalCommit": null, "originalPosition": 6}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b52c7afe5b2edf6633ba8af836a62b4c65861bc8", "author": {"user": {"login": "sopel39", "name": "Karol Sobczak"}}, "url": "https://github.com/trinodb/trino/commit/b52c7afe5b2edf6633ba8af836a62b4c65861bc8", "committedDate": "2020-02-21T09:12:00Z", "message": "Remove redundant type check\n\nSymbols used in equi conditions have same types always."}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": null, "afterCommit": null}, {"__typename": "PullRequestCommit", "commit": {"oid": "6f9bf1890086adb7a7b955de4e8e8556bde2c6a4", "author": {"user": {"login": "sopel39", "name": "Karol Sobczak"}}, "url": "https://github.com/trinodb/trino/commit/6f9bf1890086adb7a7b955de4e8e8556bde2c6a4", "committedDate": "2020-02-21T10:06:34Z", "message": "Remove redundant remote exchanges due to missing unaliasing"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": null, "afterCommit": {"oid": "6f9bf1890086adb7a7b955de4e8e8556bde2c6a4", "author": {"user": {"login": "sopel39", "name": "Karol Sobczak"}}, "url": "https://github.com/trinodb/trino/commit/6f9bf1890086adb7a7b955de4e8e8556bde2c6a4", "committedDate": "2020-02-21T10:06:34Z", "message": "Remove redundant remote exchanges due to missing unaliasing"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1695, "cost": 1, "resetAt": "2021-10-28T20:13:43Z"}}}