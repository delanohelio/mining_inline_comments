{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDIyMzI3MTM4", "number": 3836, "reviewThreads": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yM1QyMToxMzo1NlrOD_J_Eg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yM1QyMToxMzo1NlrOD_J_Eg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjY3NTUwNDgyOnYy", "diffSide": "RIGHT", "path": "presto-hive/src/main/java/io/prestosql/plugin/hive/rubix/RubixInitializer.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yM1QyMToxMzo1NlrOGZraTQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yNFQxOTozOToyMVrOGZw3eQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTU3ODgyOQ==", "bodyText": "Maybe catch the NPE for now?", "url": "https://github.com/trinodb/trino/pull/3836#discussion_r429578829", "createdAt": "2020-05-23T21:13:56Z", "author": {"login": "dain"}, "path": "presto-hive/src/main/java/io/prestosql/plugin/hive/rubix/RubixInitializer.java", "diffHunk": "@@ -125,7 +125,10 @@ public void stopRubix()\n     {\n         try (Closer closer = Closer.create()) {\n             closer.register(() -> {\n-                if (bookKeeperServer != null && bookKeeperServer.isServerUp()) {\n+                if (bookKeeperServer != null) {\n+                    // This might throw NPE if Thrift server hasn't started yet (it's initialized\n+                    // asynchronously from BookKeeperServer thread).\n+                    // TODO: improve stopping of BookKeeperServer server in Rubix", "state": "SUBMITTED", "replyTo": null, "originalCommit": null, "originalPosition": 8}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTY2ODIxNw==", "bodyText": "Maybe catch the NPE for now?\n\nIn production this shouldn't happen as bookKeeperServer will initialize thrift server almost immediately. Shutdown of Connector also doesn't terminate Presto.\nIn tests this NPE is used to retry stopRubix, otherwise ports would leak.", "url": "https://github.com/trinodb/trino/pull/3836#discussion_r429668217", "createdAt": "2020-05-24T19:39:21Z", "author": {"login": "sopel39"}, "path": "presto-hive/src/main/java/io/prestosql/plugin/hive/rubix/RubixInitializer.java", "diffHunk": "@@ -125,7 +125,10 @@ public void stopRubix()\n     {\n         try (Closer closer = Closer.create()) {\n             closer.register(() -> {\n-                if (bookKeeperServer != null && bookKeeperServer.isServerUp()) {\n+                if (bookKeeperServer != null) {\n+                    // This might throw NPE if Thrift server hasn't started yet (it's initialized\n+                    // asynchronously from BookKeeperServer thread).\n+                    // TODO: improve stopping of BookKeeperServer server in Rubix", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTU3ODgyOQ=="}, "originalCommit": null, "originalPosition": 8}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4932, "cost": 1, "resetAt": "2021-11-13T12:26:42Z"}}}