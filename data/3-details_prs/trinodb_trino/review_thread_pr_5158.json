{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDg2NzM3NjI0", "number": 5158, "reviewThreads": {"totalCount": 26, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yMVQxODo0MDozNFrOElyuDA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wMVQxOTozNDo1OVrOEpm1oQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzA4MDYzNzU2OnYy", "diffSide": "RIGHT", "path": "presto-main/src/main/java/io/prestosql/operator/aggregation/ApproximateLongPercentileAggregations.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yMVQxODo0MDozNFrOHVdv3Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yMVQxODo0MDozNFrOHVdv3Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MjI2OTUzMw==", "bodyText": "This should throw a proper Presto exception with INVALID_FUNCTION_ARGUMENT", "url": "https://github.com/trinodb/trino/pull/5158#discussion_r492269533", "createdAt": "2020-09-21T18:40:34Z", "author": {"login": "martint"}, "path": "presto-main/src/main/java/io/prestosql/operator/aggregation/ApproximateLongPercentileAggregations.java", "diffHunk": "@@ -35,49 +38,52 @@\n     private ApproximateLongPercentileAggregations() {}\n \n     @InputFunction\n-    public static void input(@AggregationState DigestAndPercentileState state, @SqlType(StandardTypes.BIGINT) long value, @SqlType(StandardTypes.DOUBLE) double percentile)\n+    public static void input(@AggregationState TDigestAndPercentileState state, @SqlType(StandardTypes.BIGINT) long value, @SqlType(StandardTypes.DOUBLE) double percentile)\n     {\n-        QuantileDigest digest = state.getDigest();\n-\n-        if (digest == null) {\n-            digest = new QuantileDigest(0.01);\n-            state.setDigest(digest);\n-            state.addMemoryUsage(digest.estimatedInMemorySizeInBytes());\n-        }\n-\n-        state.addMemoryUsage(-digest.estimatedInMemorySizeInBytes());\n-        digest.add(value);\n-        state.addMemoryUsage(digest.estimatedInMemorySizeInBytes());\n-\n-        // use last percentile\n-        state.setPercentile(percentile);\n+        ApproximateDoublePercentileAggregations.input(state, toDoubleExact(value), percentile);\n     }\n \n     @InputFunction\n-    public static void weightedInput(@AggregationState DigestAndPercentileState state, @SqlType(StandardTypes.BIGINT) long value, @SqlType(StandardTypes.DOUBLE) double weight, @SqlType(StandardTypes.DOUBLE) double percentile)\n+    public static void weightedInput(@AggregationState TDigestAndPercentileState state, @SqlType(StandardTypes.BIGINT) long value, @SqlType(StandardTypes.DOUBLE) double weight, @SqlType(StandardTypes.DOUBLE) double percentile)\n     {\n-        checkWeight(weight);\n+        ApproximateDoublePercentileAggregations.weightedInput(state, toDoubleExact(value), weight, percentile);\n+    }\n \n-        QuantileDigest digest = state.getDigest();\n+    @CombineFunction\n+    public static void combine(@AggregationState TDigestAndPercentileState state, TDigestAndPercentileState otherState)\n+    {\n+        ApproximateDoublePercentileAggregations.combine(state, otherState);\n+    }\n \n-        if (digest == null) {\n-            digest = new QuantileDigest(0.01);\n-            state.setDigest(digest);\n-            state.addMemoryUsage(digest.estimatedInMemorySizeInBytes());\n+    @OutputFunction(StandardTypes.BIGINT)\n+    public static void output(@AggregationState TDigestAndPercentileState state, BlockBuilder out)\n+    {\n+        TDigest digest = state.getDigest();\n+        double percentile = state.getPercentile();\n+        if (digest == null || digest.getCount() == 0.0) {\n+            out.appendNull();\n         }\n+        else {\n+            checkState(percentile != -1.0, \"Percentile is missing\");\n+            checkCondition(0 <= percentile && percentile <= 1, INVALID_FUNCTION_ARGUMENT, \"Percentile must be between 0 and 1\");\n+            BIGINT.writeLong(out, Math.round(digest.valueAt(percentile)));\n+        }\n+    }\n \n-        state.addMemoryUsage(-digest.estimatedInMemorySizeInBytes());\n-        digest.add(value, weight);\n-        state.addMemoryUsage(digest.estimatedInMemorySizeInBytes());\n-\n-        // use last percentile\n-        state.setPercentile(percentile);\n+    private static double toDoubleExact(long value)\n+    {\n+        double doubleValue = (double) value;\n+        checkState((long) doubleValue == value, \"no exact double representation for long: %s\", value);", "state": "SUBMITTED", "replyTo": null, "originalCommit": null, "originalPosition": 83}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzA4MDY1ODc4OnYy", "diffSide": "RIGHT", "path": "presto-main/src/main/java/io/prestosql/operator/aggregation/ApproximateLongPercentileArrayAggregations.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yMVQxODo0NjozM1rOHVd8uQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yMVQxODo0NjozM1rOHVd8uQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MjI3MjgyNQ==", "bodyText": "Throw proper Presto exception", "url": "https://github.com/trinodb/trino/pull/5158#discussion_r492272825", "createdAt": "2020-09-21T18:46:33Z", "author": {"login": "martint"}, "path": "presto-main/src/main/java/io/prestosql/operator/aggregation/ApproximateLongPercentileArrayAggregations.java", "diffHunk": "@@ -96,35 +68,16 @@ public static void output(@AggregationState DigestAndPercentileArrayState state,\n \n         for (int i = 0; i < percentiles.size(); i++) {\n             Double percentile = percentiles.get(i);\n-            BIGINT.writeLong(blockBuilder, digest.getQuantile(percentile));\n+            BIGINT.writeLong(blockBuilder, Math.round(digest.valueAt(percentile)));\n         }\n \n         out.closeEntry();\n     }\n \n-    private static void initializePercentilesArray(@AggregationState DigestAndPercentileArrayState state, Block percentilesArrayBlock)\n+    private static double toDoubleExact(long value)\n     {\n-        if (state.getPercentiles() == null) {\n-            ImmutableList.Builder<Double> percentilesListBuilder = ImmutableList.builder();\n-\n-            for (int i = 0; i < percentilesArrayBlock.getPositionCount(); i++) {\n-                checkCondition(!percentilesArrayBlock.isNull(i), INVALID_FUNCTION_ARGUMENT, \"Percentile cannot be null\");\n-                double percentile = DOUBLE.getDouble(percentilesArrayBlock, i);\n-                checkCondition(0 <= percentile && percentile <= 1, INVALID_FUNCTION_ARGUMENT, \"Percentile must be between 0 and 1\");\n-                percentilesListBuilder.add(percentile);\n-            }\n-\n-            state.setPercentiles(percentilesListBuilder.build());\n-        }\n-    }\n-\n-    private static void initializeDigest(@AggregationState DigestAndPercentileArrayState state)\n-    {\n-        QuantileDigest digest = state.getDigest();\n-        if (digest == null) {\n-            digest = new QuantileDigest(0.01);\n-            state.setDigest(digest);\n-            state.addMemoryUsage(digest.estimatedInMemorySizeInBytes());\n-        }\n+        double doubleValue = (double) value;\n+        checkState((long) doubleValue == value, \"no exact double representation for long: %s\", value);", "state": "SUBMITTED", "replyTo": null, "originalCommit": null, "originalPosition": 122}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzA4MDY3ODU4OnYy", "diffSide": "RIGHT", "path": "presto-spi/src/main/java/io/prestosql/spi/type/TDigestType.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yMVQxODo1MjoyNFrOHVeJIA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yMVQxODo1MjoyNFrOHVeJIA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MjI3NjAwMA==", "bodyText": "We can use TDigest as the native type instead of serializing and deserializing. See, for instance, LongTimestampType", "url": "https://github.com/trinodb/trino/pull/5158#discussion_r492276000", "createdAt": "2020-09-21T18:52:24Z", "author": {"login": "martint"}, "path": "presto-spi/src/main/java/io/prestosql/spi/type/TDigestType.java", "diffHunk": "@@ -0,0 +1,72 @@\n+/*\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+package io.prestosql.spi.type;\n+\n+import com.fasterxml.jackson.annotation.JsonCreator;\n+import io.airlift.slice.Slice;\n+import io.prestosql.spi.block.Block;\n+import io.prestosql.spi.block.BlockBuilder;\n+import io.prestosql.spi.connector.ConnectorSession;\n+\n+public class TDigestType\n+        extends AbstractVariableWidthType\n+{\n+    public static final TDigestType TDIGEST = new TDigestType();\n+\n+    @JsonCreator\n+    public TDigestType()\n+    {\n+        super(new TypeSignature(StandardTypes.TDIGEST), Slice.class);", "state": "SUBMITTED", "replyTo": null, "originalCommit": null, "originalPosition": 30}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzEwNjAwNTc0OnYy", "diffSide": "RIGHT", "path": "presto-main/src/main/java/io/prestosql/operator/aggregation/ApproximateDoublePercentileArrayAggregations.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yOFQxODozNzowNVrOHZK62Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yOFQxODozNzowNVrOHZK62Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NjE1NTM1Mw==", "bodyText": "This may be more efficient with fastutil's indirect sorting (you should give it a try). Something like:\nint[] indexes = new int[percentiles.size()];\ndouble[] sortedPercentiles = new double[percentiles.size()];\nfor (int i = 0; i < indexes.length; i++) {\n    indexes[i] = i;\n    sortedPercentiles[i] = percentiles.get(i);\n}\n\nit.unimi.dsi.fastutil.Arrays.quickSort(0, percentiles.size(), (a, b) -> Doubles.compare(sortedPercentiles[a], sortedPercentiles[b]), (a, b) -> {\n    double tempPercentile = sortedPercentiles[a];\n    sortedPercentiles[a] = sortedPercentiles[b];\n    sortedPercentiles[b] = tempPercentile;\n\n    int tempIndex = indexes[a];\n    indexes[a] = indexes[b];\n    indexes[b] = tempIndex;\n});\n\nList<Double> valuesAtPercentiles = digest.valuesAt(Doubles.asList(sortedPercentiles));\nList<Double> result = new ArrayList<>(valuesAtPercentiles.size());\nfor (int i = 0; i < valuesAtPercentiles.size(); i++) {\n    result.add(valuesAtPercentiles.get(indexes[i]));\n}\n\nreturn result;", "url": "https://github.com/trinodb/trino/pull/5158#discussion_r496155353", "createdAt": "2020-09-28T18:37:05Z", "author": {"login": "martint"}, "path": "presto-main/src/main/java/io/prestosql/operator/aggregation/ApproximateDoublePercentileArrayAggregations.java", "diffHunk": "@@ -96,14 +100,33 @@ public static void output(@AggregationState TDigestAndPercentileArrayState state\n \n         BlockBuilder blockBuilder = out.beginBlockEntry();\n \n-        for (int i = 0; i < percentiles.size(); i++) {\n-            Double percentile = percentiles.get(i);\n-            DOUBLE.writeDouble(blockBuilder, digest.valueAt(percentile));\n+        List<Double> valuesAtPercentiles = valuesAtPercentiles(digest, percentiles);\n+        for (double value : valuesAtPercentiles) {\n+            DOUBLE.writeDouble(blockBuilder, value);\n         }\n \n         out.closeEntry();\n     }\n \n+    public static List<Double> valuesAtPercentiles(TDigest digest, List<Double> percentiles)\n+    {\n+        if (Ordering.natural().isOrdered(percentiles)) {\n+            return digest.valuesAt(percentiles);\n+        }\n+        else {\n+            // TDigest requires that percentiles list be ordered. Sort the percentiles list and rearrange the output according to original percentile order.\n+            List<Double> sortedPercentiles = Ordering.natural().sortedCopy(percentiles);\n+            List<Double> valuesAtPercentiles = digest.valuesAt(sortedPercentiles);\n+            Map<Double, Double> percentilesToValues = new HashMap<>();\n+            for (int i = 0; i < sortedPercentiles.size(); i++) {\n+                percentilesToValues.put(sortedPercentiles.get(i), valuesAtPercentiles.get(i));\n+            }\n+            return percentiles.stream()\n+                    .map(percentilesToValues::get)\n+                    .collect(toImmutableList());", "state": "SUBMITTED", "replyTo": null, "originalCommit": null, "originalPosition": 50}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzExMjA4NjMyOnYy", "diffSide": "RIGHT", "path": "presto-main/src/test/java/io/prestosql/sql/query/TestTDigestFunctions.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yOVQyMjo1OTo0OVrOHaFm1A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0zMFQxOTozNjo1M1rOHase3w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NzExNjg4NA==", "bodyText": "Does WHERE false not work?", "url": "https://github.com/trinodb/trino/pull/5158#discussion_r497116884", "createdAt": "2020-09-29T22:59:49Z", "author": {"login": "martint"}, "path": "presto-main/src/test/java/io/prestosql/sql/query/TestTDigestFunctions.java", "diffHunk": "@@ -0,0 +1,147 @@\n+/*\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+package io.prestosql.sql.query;\n+\n+import io.prestosql.testing.MaterializedResult;\n+import org.testng.annotations.AfterClass;\n+import org.testng.annotations.BeforeClass;\n+import org.testng.annotations.Test;\n+\n+import java.util.ArrayList;\n+import java.util.List;\n+import java.util.Random;\n+\n+import static java.lang.Math.round;\n+import static org.assertj.core.api.Assertions.assertThat;\n+\n+public class TestTDigestFunctions\n+{\n+    private QueryAssertions assertions;\n+\n+    @BeforeClass\n+    public void init()\n+    {\n+        assertions = new QueryAssertions();\n+    }\n+\n+    @AfterClass(alwaysRun = true)\n+    public void teardown()\n+    {\n+        assertions.close();\n+        assertions = null;\n+    }\n+\n+    @Test\n+    public void testValueAtQuantile()\n+    {\n+        assertThat(assertions.query(\n+                \"SELECT value_at_quantile(tdigest_agg(d), 0.75e0) \" +\n+                        \"FROM (VALUES 0.1e0, 0.2e0, 0.3e0, 0.4e0) T(d)\"))\n+                .matches(\"VALUES 0.4e0\");\n+\n+        assertThat(assertions.query(\n+                \"SELECT value_at_quantile(tdigest_agg(d), 0.75e0) \" +\n+                        \"FROM (VALUES -0.1e0, -0.2e0, -0.3e0, -0.4e0) T(d)\"))\n+                .matches(\"VALUES -0.1e0\");\n+\n+        assertThat(assertions.query(\n+                \"SELECT value_at_quantile(tdigest_agg(d), 0.9e0) \" +\n+                        \"FROM (VALUES 0.1e0, 0.1e0, 0.1e0, 0.1e0, 10e0) T(d)\"))\n+                .matches(\"VALUES 10e0\");\n+    }\n+\n+    @Test\n+    public void testValuesAtQuantiles()\n+    {\n+        assertThat(assertions.query(\n+                \"SELECT values_at_quantiles(tdigest_agg(d), ARRAY[0.0001e0, 0.75e0, 0.85e0]) \" +\n+                        \"FROM (VALUES 0.1e0, 0.2e0, 0.3e0, 0.4e0) T(d)\"))\n+                .matches(\"VALUES ARRAY[0.1e0, 0.4e0, 0.4e0]\");\n+\n+        assertThat(assertions.query(\n+                \"SELECT values_at_quantiles(tdigest_agg(d), ARRAY[0.0001e0, 0.75e0, 0.85e0]) \" +\n+                        \"FROM (VALUES -0.1e0, -0.2e0, -0.3e0, -0.4e0) T(d)\"))\n+                .matches(\"VALUES ARRAY[-0.4e0, -0.1e0, -0.10]\");\n+\n+        assertThat(assertions.query(\n+                \"SELECT values_at_quantiles(tdigest_agg(d), ARRAY[0.0001e0, 0.75e0, 0.85e0]) \" +\n+                        \"FROM (VALUES 0.1e0, 0.1e0, 0.1e0, 0.1e0, 10e0) T(d)\"))\n+                .matches(\"VALUES ARRAY[0.1e0, 0.1e0, 10.0e0]\");\n+    }\n+\n+    @Test\n+    public void testEmptyArrayOfQuantiles()\n+    {\n+        assertThat(assertions.query(\n+                \"SELECT values_at_quantiles(tdigest_agg(d), ARRAY[]) \" +\n+                        \"FROM (VALUES 0.1e0, 0.2e0, 0.3e0, 0.4e0) T(d)\"))\n+                .matches(\"VALUES CAST(ARRAY[] AS array(double))\");\n+    }\n+\n+    @Test\n+    public void testEmptyTDigestInput()\n+    {\n+        assertThat(assertions.query(\n+                \"SELECT tdigest_agg(d) FROM (SELECT 1e0 WHERE 1 = 0) T(d)\"))", "state": "SUBMITTED", "replyTo": null, "originalCommit": null, "originalPosition": 96}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5Nzc1MzgyMw==", "bodyText": "It works. I'll change to WHERE false", "url": "https://github.com/trinodb/trino/pull/5158#discussion_r497753823", "createdAt": "2020-09-30T19:36:53Z", "author": {"login": "kasiafi"}, "path": "presto-main/src/test/java/io/prestosql/sql/query/TestTDigestFunctions.java", "diffHunk": "@@ -0,0 +1,147 @@\n+/*\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+package io.prestosql.sql.query;\n+\n+import io.prestosql.testing.MaterializedResult;\n+import org.testng.annotations.AfterClass;\n+import org.testng.annotations.BeforeClass;\n+import org.testng.annotations.Test;\n+\n+import java.util.ArrayList;\n+import java.util.List;\n+import java.util.Random;\n+\n+import static java.lang.Math.round;\n+import static org.assertj.core.api.Assertions.assertThat;\n+\n+public class TestTDigestFunctions\n+{\n+    private QueryAssertions assertions;\n+\n+    @BeforeClass\n+    public void init()\n+    {\n+        assertions = new QueryAssertions();\n+    }\n+\n+    @AfterClass(alwaysRun = true)\n+    public void teardown()\n+    {\n+        assertions.close();\n+        assertions = null;\n+    }\n+\n+    @Test\n+    public void testValueAtQuantile()\n+    {\n+        assertThat(assertions.query(\n+                \"SELECT value_at_quantile(tdigest_agg(d), 0.75e0) \" +\n+                        \"FROM (VALUES 0.1e0, 0.2e0, 0.3e0, 0.4e0) T(d)\"))\n+                .matches(\"VALUES 0.4e0\");\n+\n+        assertThat(assertions.query(\n+                \"SELECT value_at_quantile(tdigest_agg(d), 0.75e0) \" +\n+                        \"FROM (VALUES -0.1e0, -0.2e0, -0.3e0, -0.4e0) T(d)\"))\n+                .matches(\"VALUES -0.1e0\");\n+\n+        assertThat(assertions.query(\n+                \"SELECT value_at_quantile(tdigest_agg(d), 0.9e0) \" +\n+                        \"FROM (VALUES 0.1e0, 0.1e0, 0.1e0, 0.1e0, 10e0) T(d)\"))\n+                .matches(\"VALUES 10e0\");\n+    }\n+\n+    @Test\n+    public void testValuesAtQuantiles()\n+    {\n+        assertThat(assertions.query(\n+                \"SELECT values_at_quantiles(tdigest_agg(d), ARRAY[0.0001e0, 0.75e0, 0.85e0]) \" +\n+                        \"FROM (VALUES 0.1e0, 0.2e0, 0.3e0, 0.4e0) T(d)\"))\n+                .matches(\"VALUES ARRAY[0.1e0, 0.4e0, 0.4e0]\");\n+\n+        assertThat(assertions.query(\n+                \"SELECT values_at_quantiles(tdigest_agg(d), ARRAY[0.0001e0, 0.75e0, 0.85e0]) \" +\n+                        \"FROM (VALUES -0.1e0, -0.2e0, -0.3e0, -0.4e0) T(d)\"))\n+                .matches(\"VALUES ARRAY[-0.4e0, -0.1e0, -0.10]\");\n+\n+        assertThat(assertions.query(\n+                \"SELECT values_at_quantiles(tdigest_agg(d), ARRAY[0.0001e0, 0.75e0, 0.85e0]) \" +\n+                        \"FROM (VALUES 0.1e0, 0.1e0, 0.1e0, 0.1e0, 10e0) T(d)\"))\n+                .matches(\"VALUES ARRAY[0.1e0, 0.1e0, 10.0e0]\");\n+    }\n+\n+    @Test\n+    public void testEmptyArrayOfQuantiles()\n+    {\n+        assertThat(assertions.query(\n+                \"SELECT values_at_quantiles(tdigest_agg(d), ARRAY[]) \" +\n+                        \"FROM (VALUES 0.1e0, 0.2e0, 0.3e0, 0.4e0) T(d)\"))\n+                .matches(\"VALUES CAST(ARRAY[] AS array(double))\");\n+    }\n+\n+    @Test\n+    public void testEmptyTDigestInput()\n+    {\n+        assertThat(assertions.query(\n+                \"SELECT tdigest_agg(d) FROM (SELECT 1e0 WHERE 1 = 0) T(d)\"))", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NzExNjg4NA=="}, "originalCommit": null, "originalPosition": 96}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzExMjA5NzMzOnYy", "diffSide": "RIGHT", "path": "presto-docs/src/main/sphinx/functions/aggregate.rst", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yOVQyMzowMjoxNlrOHaFt6g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0zMFQxOTozNzowMFrOHasfFw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NzExODY5OA==", "bodyText": "Why noindex?", "url": "https://github.com/trinodb/trino/pull/5158#discussion_r497118698", "createdAt": "2020-09-29T23:02:16Z", "author": {"login": "martint"}, "path": "presto-docs/src/main/sphinx/functions/aggregate.rst", "diffHunk": "@@ -320,6 +309,11 @@ Approximate Aggregate Functions\n \n     See :doc:`qdigest`.\n \n+.. function:: merge(tdigest) -> tdigest\n+    :noindex:", "state": "SUBMITTED", "replyTo": null, "originalCommit": null, "originalPosition": 23}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5Nzc1Mzg3OQ==", "bodyText": "Otherwise docs won't build because there's another merge() function elsewhere.", "url": "https://github.com/trinodb/trino/pull/5158#discussion_r497753879", "createdAt": "2020-09-30T19:37:00Z", "author": {"login": "kasiafi"}, "path": "presto-docs/src/main/sphinx/functions/aggregate.rst", "diffHunk": "@@ -320,6 +309,11 @@ Approximate Aggregate Functions\n \n     See :doc:`qdigest`.\n \n+.. function:: merge(tdigest) -> tdigest\n+    :noindex:", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NzExODY5OA=="}, "originalCommit": null, "originalPosition": 23}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzExMjEwMjU0OnYy", "diffSide": "RIGHT", "path": "presto-docs/src/main/sphinx/functions/tdigest.rst", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yOVQyMzowMzozM1rOHaFxbw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yOVQyMzowMzozM1rOHaFxbw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NzExOTU5OQ==", "bodyText": "Capitalize Presto", "url": "https://github.com/trinodb/trino/pull/5158#discussion_r497119599", "createdAt": "2020-09-29T23:03:33Z", "author": {"login": "martint"}, "path": "presto-docs/src/main/sphinx/functions/tdigest.rst", "diffHunk": "@@ -0,0 +1,45 @@\n+=========================\n+T-Digest Functions\n+=========================\n+\n+Data Structures\n+---------------\n+\n+A T-digest is a data sketch which stores approximate percentile\n+information.  The presto type for this data structure is called ``tdigest``.", "state": "SUBMITTED", "replyTo": null, "originalCommit": null, "originalPosition": 9}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzExMjEwNzY0OnYy", "diffSide": "RIGHT", "path": "presto-docs/src/main/sphinx/functions/tdigest.rst", "isResolved": true, "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yOVQyMzowNDozOVrOHaF0nQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0zMFQyMDowMTo0NFrOHatSKA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NzEyMDQxMw==", "bodyText": "without losing precision -> that's not accurate. Every time an element is added to a t-digest, precision is sacrificed somewhere.", "url": "https://github.com/trinodb/trino/pull/5158#discussion_r497120413", "createdAt": "2020-09-29T23:04:39Z", "author": {"login": "martint"}, "path": "presto-docs/src/main/sphinx/functions/tdigest.rst", "diffHunk": "@@ -0,0 +1,45 @@\n+=========================\n+T-Digest Functions\n+=========================\n+\n+Data Structures\n+---------------\n+\n+A T-digest is a data sketch which stores approximate percentile\n+information.  The presto type for this data structure is called ``tdigest``.\n+T-digests may be merged without losing precision, and for storage", "state": "SUBMITTED", "replyTo": null, "originalCommit": null, "originalPosition": 10}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5Nzc1Mzk0Mw==", "bodyText": "What do you suggest?", "url": "https://github.com/trinodb/trino/pull/5158#discussion_r497753943", "createdAt": "2020-09-30T19:37:08Z", "author": {"login": "kasiafi"}, "path": "presto-docs/src/main/sphinx/functions/tdigest.rst", "diffHunk": "@@ -0,0 +1,45 @@\n+=========================\n+T-Digest Functions\n+=========================\n+\n+Data Structures\n+---------------\n+\n+A T-digest is a data sketch which stores approximate percentile\n+information.  The presto type for this data structure is called ``tdigest``.\n+T-digests may be merged without losing precision, and for storage", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NzEyMDQxMw=="}, "originalCommit": null, "originalPosition": 10}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5Nzc2Njk1Mg==", "bodyText": "I'd just remove that qualifier and leave it at \"T-digests may be merged\"", "url": "https://github.com/trinodb/trino/pull/5158#discussion_r497766952", "createdAt": "2020-09-30T20:01:44Z", "author": {"login": "martint"}, "path": "presto-docs/src/main/sphinx/functions/tdigest.rst", "diffHunk": "@@ -0,0 +1,45 @@\n+=========================\n+T-Digest Functions\n+=========================\n+\n+Data Structures\n+---------------\n+\n+A T-digest is a data sketch which stores approximate percentile\n+information.  The presto type for this data structure is called ``tdigest``.\n+T-digests may be merged without losing precision, and for storage", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NzEyMDQxMw=="}, "originalCommit": null, "originalPosition": 10}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzExMjExMTg0OnYy", "diffSide": "RIGHT", "path": "presto-docs/src/main/sphinx/functions/tdigest.rst", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yOVQyMzowNTozNFrOHaF3PA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0zMFQxOTozNzoxMlrOHasfew==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NzEyMTA4NA==", "bodyText": "Why :noindex: for all of these?", "url": "https://github.com/trinodb/trino/pull/5158#discussion_r497121084", "createdAt": "2020-09-29T23:05:34Z", "author": {"login": "martint"}, "path": "presto-docs/src/main/sphinx/functions/tdigest.rst", "diffHunk": "@@ -0,0 +1,45 @@\n+=========================\n+T-Digest Functions\n+=========================\n+\n+Data Structures\n+---------------\n+\n+A T-digest is a data sketch which stores approximate percentile\n+information.  The presto type for this data structure is called ``tdigest``.\n+T-digests may be merged without losing precision, and for storage\n+and retrieval they may be cast to/from ``VARBINARY``.\n+\n+Functions\n+---------\n+\n+.. function:: merge(tdigest) -> tdigest\n+    :noindex:", "state": "SUBMITTED", "replyTo": null, "originalCommit": null, "originalPosition": 17}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5Nzc1Mzk3OQ==", "bodyText": "This is weird. Apparently, I can remove one arbitrary :noindex: but it I remove two, it fails.", "url": "https://github.com/trinodb/trino/pull/5158#discussion_r497753979", "createdAt": "2020-09-30T19:37:12Z", "author": {"login": "kasiafi"}, "path": "presto-docs/src/main/sphinx/functions/tdigest.rst", "diffHunk": "@@ -0,0 +1,45 @@\n+=========================\n+T-Digest Functions\n+=========================\n+\n+Data Structures\n+---------------\n+\n+A T-digest is a data sketch which stores approximate percentile\n+information.  The presto type for this data structure is called ``tdigest``.\n+T-digests may be merged without losing precision, and for storage\n+and retrieval they may be cast to/from ``VARBINARY``.\n+\n+Functions\n+---------\n+\n+.. function:: merge(tdigest) -> tdigest\n+    :noindex:", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NzEyMTA4NA=="}, "originalCommit": null, "originalPosition": 17}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzExMjExNDU5OnYy", "diffSide": "RIGHT", "path": "presto-docs/src/main/sphinx/functions/tdigest.rst", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yOVQyMzowNjowOFrOHaF47Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yOVQyMzowNjowOFrOHaF47Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NzEyMTUxNw==", "bodyText": "We may want to clarify that this is an aggregation function.", "url": "https://github.com/trinodb/trino/pull/5158#discussion_r497121517", "createdAt": "2020-09-29T23:06:08Z", "author": {"login": "martint"}, "path": "presto-docs/src/main/sphinx/functions/tdigest.rst", "diffHunk": "@@ -0,0 +1,45 @@\n+=========================\n+T-Digest Functions\n+=========================\n+\n+Data Structures\n+---------------\n+\n+A T-digest is a data sketch which stores approximate percentile\n+information.  The presto type for this data structure is called ``tdigest``.\n+T-digests may be merged without losing precision, and for storage\n+and retrieval they may be cast to/from ``VARBINARY``.\n+\n+Functions\n+---------\n+\n+.. function:: merge(tdigest) -> tdigest\n+    :noindex:\n+\n+    Merges all input ``tdigest``\\ s into a single ``tdigest``.", "state": "SUBMITTED", "replyTo": null, "originalCommit": null, "originalPosition": 19}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzExMjEyNTU5OnYy", "diffSide": "RIGHT", "path": "presto-docs/src/main/sphinx/language/types.rst", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yOVQyMzowODozNlrOHaF_6g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yOVQyMzowODozNlrOHaF_6g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NzEyMzMwNg==", "bodyText": "T-digest", "url": "https://github.com/trinodb/trino/pull/5158#discussion_r497123306", "createdAt": "2020-09-29T23:08:36Z", "author": {"login": "martint"}, "path": "presto-docs/src/main/sphinx/language/types.rst", "diffHunk": "@@ -361,3 +361,20 @@ can be reused.  For example, one may be interested in a daily reading of the 99t\n percentile values that are read over the course of a week.  Instead of calculating\n the past week of data with ``approx_percentile``, ``qdigest``\\ s could be stored\n daily, and quickly merged to retrieve the 99th percentile value.\n+\n+T-Digest\n+---------------\n+\n+.. _tdigest_type:\n+\n+``TDigest``\n+^^^^^^^^^^^\n+\n+A t-digest (tdigest) is a summary structure which, similarly to qdigest, captures the", "state": "SUBMITTED", "replyTo": null, "originalCommit": null, "originalPosition": 13}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzExMjEyOTQ2OnYy", "diffSide": "RIGHT", "path": "presto-docs/src/main/sphinx/language/types.rst", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yOVQyMzowOTozNFrOHaGCaA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yOVQyMzowOTozNFrOHaGCaA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NzEyMzk0NA==", "bodyText": "Also performance and memory utilization. T-digest is more efficient to operate on that qdigest.", "url": "https://github.com/trinodb/trino/pull/5158#discussion_r497123944", "createdAt": "2020-09-29T23:09:34Z", "author": {"login": "martint"}, "path": "presto-docs/src/main/sphinx/language/types.rst", "diffHunk": "@@ -361,3 +361,20 @@ can be reused.  For example, one may be interested in a daily reading of the 99t\n percentile values that are read over the course of a week.  Instead of calculating\n the past week of data with ``approx_percentile``, ``qdigest``\\ s could be stored\n daily, and quickly merged to retrieve the 99th percentile value.\n+\n+T-Digest\n+---------------\n+\n+.. _tdigest_type:\n+\n+``TDigest``\n+^^^^^^^^^^^\n+\n+A t-digest (tdigest) is a summary structure which, similarly to qdigest, captures the\n+approximate distribution of data for a given input set, and can be queried to retrieve\n+approximate quantile values from the distribution.  The main advantage of tdigest over", "state": "SUBMITTED", "replyTo": null, "originalCommit": null, "originalPosition": 15}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzExMjEzNDEyOnYy", "diffSide": "RIGHT", "path": "presto-docs/src/main/sphinx/language/types.rst", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yOVQyMzoxMDoyOFrOHaGFNg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yOVQyMzoxMDoyOFrOHaGFNg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NzEyNDY2Mg==", "bodyText": "This is an implementation detail. We should omit it.", "url": "https://github.com/trinodb/trino/pull/5158#discussion_r497124662", "createdAt": "2020-09-29T23:10:28Z", "author": {"login": "martint"}, "path": "presto-docs/src/main/sphinx/language/types.rst", "diffHunk": "@@ -361,3 +361,20 @@ can be reused.  For example, one may be interested in a daily reading of the 99t\n percentile values that are read over the course of a week.  Instead of calculating\n the past week of data with ``approx_percentile``, ``qdigest``\\ s could be stored\n daily, and quickly merged to retrieve the 99th percentile value.\n+\n+T-Digest\n+---------------\n+\n+.. _tdigest_type:\n+\n+``TDigest``\n+^^^^^^^^^^^\n+\n+A t-digest (tdigest) is a summary structure which, similarly to qdigest, captures the\n+approximate distribution of data for a given input set, and can be queried to retrieve\n+approximate quantile values from the distribution.  The main advantage of tdigest over\n+qdigest is its higher accuracy at high and low percentiles.\n+\n+T-digests are additive, meaning they can be merged together without losing precision.\n+\n+The :func:`approx_percentile` functions use t-digest as an underlying structure.", "state": "SUBMITTED", "replyTo": null, "originalCommit": null, "originalPosition": 20}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzExMjEzNDQ4OnYy", "diffSide": "RIGHT", "path": "presto-docs/src/main/sphinx/functions/tdigest.rst", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yOVQyMzoxMDozMlrOHaGFaQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yOVQyMzoxMDozMlrOHaGFaQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NzEyNDcxMw==", "bodyText": "This is an implementation detail. We should omit it.", "url": "https://github.com/trinodb/trino/pull/5158#discussion_r497124713", "createdAt": "2020-09-29T23:10:32Z", "author": {"login": "martint"}, "path": "presto-docs/src/main/sphinx/functions/tdigest.rst", "diffHunk": "@@ -0,0 +1,45 @@\n+=========================\n+T-Digest Functions\n+=========================\n+\n+Data Structures\n+---------------\n+\n+A T-digest is a data sketch which stores approximate percentile\n+information.  The presto type for this data structure is called ``tdigest``.\n+T-digests may be merged without losing precision, and for storage\n+and retrieval they may be cast to/from ``VARBINARY``.\n+\n+Functions\n+---------\n+\n+.. function:: merge(tdigest) -> tdigest\n+    :noindex:\n+\n+    Merges all input ``tdigest``\\ s into a single ``tdigest``.\n+\n+.. function:: value_at_quantile(tdigest, quantile) -> double\n+    :noindex:\n+\n+    Returns the approximate percentile value from the T-digest given\n+    the number ``quantile`` between 0 and 1.\n+\n+.. function:: values_at_quantiles(tdigest, quantiles) -> array<double>\n+    :noindex:\n+\n+    Returns the approximate percentile values as an array given the input\n+    T-digest and array of values between 0 and 1 which\n+    represent the quantiles to return.\n+\n+.. function:: tdigest_agg(x) -> tdigest\n+\n+    Returns the ``tdigest`` which is composed of  all input values of ``x``.\n+\n+.. function:: tdigest_agg(x, w) -> tdigest\n+    :noindex:\n+\n+    Returns the ``tdigest`` which is composed of  all input values of ``x`` using\n+    the per-item weight ``w``.\n+\n+Presto implements the ``approx_percentile`` function with the T-digest", "state": "SUBMITTED", "replyTo": null, "originalCommit": null, "originalPosition": 44}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzExMjE0Mzk4OnYy", "diffSide": "RIGHT", "path": "presto-docs/src/main/sphinx/functions/qdigest.rst", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yOVQyMzoxMjozNFrOHaGLPQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yOVQyMzoxMjozNFrOHaGLPQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NzEyNjIwNQ==", "bodyText": "The canonical form for array and other structural types uses parenthesis instead of <>: array(T)", "url": "https://github.com/trinodb/trino/pull/5158#discussion_r497126205", "createdAt": "2020-09-29T23:12:34Z", "author": {"login": "martint"}, "path": "presto-docs/src/main/sphinx/functions/qdigest.rst", "diffHunk": "@@ -22,10 +22,10 @@ Functions\n \n .. function:: value_at_quantile(qdigest(T), quantile) -> T\n \n-    Returns the approximate percentile values from the quantile digest given\n+    Returns the approximate percentile value from the quantile digest given\n     the number ``quantile`` between 0 and 1.\n \n-.. function:: values_at_quantiles(qdigest(T), quantiles) -> T\n+.. function:: values_at_quantiles(qdigest(T), quantiles) -> array<T>", "state": "SUBMITTED", "replyTo": null, "originalCommit": null, "originalPosition": 9}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzEyMDYwNzgzOnYy", "diffSide": "RIGHT", "path": "presto-docs/src/main/sphinx/functions/tdigest.rst", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wMVQxOToyNTozMVrOHbX_WQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wMVQyMDowNzowMVrOHbZKjw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5ODQ2NjY0OQ==", "bodyText": "Add a introductory sentence", "url": "https://github.com/trinodb/trino/pull/5158#discussion_r498466649", "createdAt": "2020-10-01T19:25:31Z", "author": {"login": "mosabua"}, "path": "presto-docs/src/main/sphinx/functions/tdigest.rst", "diffHunk": "@@ -0,0 +1,41 @@\n+=========================\n+T-Digest Functions\n+=========================\n+", "state": "SUBMITTED", "replyTo": null, "originalCommit": null, "originalPosition": 4}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5ODQ4NTkwMw==", "bodyText": "Could you please help me with that? Isn't the data structure description enough for an introduction?", "url": "https://github.com/trinodb/trino/pull/5158#discussion_r498485903", "createdAt": "2020-10-01T20:07:01Z", "author": {"login": "kasiafi"}, "path": "presto-docs/src/main/sphinx/functions/tdigest.rst", "diffHunk": "@@ -0,0 +1,41 @@\n+=========================\n+T-Digest Functions\n+=========================\n+", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5ODQ2NjY0OQ=="}, "originalCommit": null, "originalPosition": 4}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzEyMDYxMjEyOnYy", "diffSide": "RIGHT", "path": "presto-docs/src/main/sphinx/functions/tdigest.rst", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wMVQxOToyNzowNVrOHbYCHg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wMVQxOToyNzowNVrOHbYCHg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5ODQ2NzM1OA==", "bodyText": "can instead of may ?", "url": "https://github.com/trinodb/trino/pull/5158#discussion_r498467358", "createdAt": "2020-10-01T19:27:05Z", "author": {"login": "mosabua"}, "path": "presto-docs/src/main/sphinx/functions/tdigest.rst", "diffHunk": "@@ -0,0 +1,41 @@\n+=========================\n+T-Digest Functions\n+=========================\n+\n+Data Structures\n+---------------\n+\n+A T-digest is a data sketch which stores approximate percentile\n+information.  The Presto type for this data structure is called ``tdigest``.\n+T-digests may be merged, and for storage and retrieval they may be cast", "state": "SUBMITTED", "replyTo": null, "originalCommit": null, "originalPosition": 10}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzEyMDYxMjY5OnYy", "diffSide": "RIGHT", "path": "presto-docs/src/main/sphinx/functions/tdigest.rst", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wMVQxOToyNzoxN1rOHbYCdA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wMVQxOToyNzoxN1rOHbYCdA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5ODQ2NzQ0NA==", "bodyText": "to and from", "url": "https://github.com/trinodb/trino/pull/5158#discussion_r498467444", "createdAt": "2020-10-01T19:27:17Z", "author": {"login": "mosabua"}, "path": "presto-docs/src/main/sphinx/functions/tdigest.rst", "diffHunk": "@@ -0,0 +1,41 @@\n+=========================\n+T-Digest Functions\n+=========================\n+\n+Data Structures\n+---------------\n+\n+A T-digest is a data sketch which stores approximate percentile\n+information.  The Presto type for this data structure is called ``tdigest``.\n+T-digests may be merged, and for storage and retrieval they may be cast\n+to/from ``VARBINARY``.", "state": "SUBMITTED", "replyTo": null, "originalCommit": null, "originalPosition": 11}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzEyMDYxNzI5OnYy", "diffSide": "RIGHT", "path": "presto-docs/src/main/sphinx/functions/tdigest.rst", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wMVQxOToyODo0OVrOHbYFaQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wMVQxOToyODo0OVrOHbYFaQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5ODQ2ODIwMQ==", "bodyText": "I think you can just say\nAggregates all inputs into a single ``tdigest``.", "url": "https://github.com/trinodb/trino/pull/5158#discussion_r498468201", "createdAt": "2020-10-01T19:28:49Z", "author": {"login": "mosabua"}, "path": "presto-docs/src/main/sphinx/functions/tdigest.rst", "diffHunk": "@@ -0,0 +1,41 @@\n+=========================\n+T-Digest Functions\n+=========================\n+\n+Data Structures\n+---------------\n+\n+A T-digest is a data sketch which stores approximate percentile\n+information.  The Presto type for this data structure is called ``tdigest``.\n+T-digests may be merged, and for storage and retrieval they may be cast\n+to/from ``VARBINARY``.\n+\n+Functions\n+---------\n+\n+.. function:: merge(tdigest) -> tdigest\n+    :noindex:\n+\n+    Aggregation function. Merges all input ``tdigest``\\ s into a single ``tdigest``.", "state": "SUBMITTED", "replyTo": null, "originalCommit": null, "originalPosition": 19}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzEyMDYxODg1OnYy", "diffSide": "RIGHT", "path": "presto-docs/src/main/sphinx/functions/tdigest.rst", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wMVQxOToyOToyMlrOHbYGcg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wMVQxOToyOToyMlrOHbYGcg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5ODQ2ODQ2Ng==", "bodyText": "T-digest, given", "url": "https://github.com/trinodb/trino/pull/5158#discussion_r498468466", "createdAt": "2020-10-01T19:29:22Z", "author": {"login": "mosabua"}, "path": "presto-docs/src/main/sphinx/functions/tdigest.rst", "diffHunk": "@@ -0,0 +1,41 @@\n+=========================\n+T-Digest Functions\n+=========================\n+\n+Data Structures\n+---------------\n+\n+A T-digest is a data sketch which stores approximate percentile\n+information.  The Presto type for this data structure is called ``tdigest``.\n+T-digests may be merged, and for storage and retrieval they may be cast\n+to/from ``VARBINARY``.\n+\n+Functions\n+---------\n+\n+.. function:: merge(tdigest) -> tdigest\n+    :noindex:\n+\n+    Aggregation function. Merges all input ``tdigest``\\ s into a single ``tdigest``.\n+\n+.. function:: value_at_quantile(tdigest, quantile) -> double\n+    :noindex:\n+\n+    Returns the approximate percentile value from the T-digest given", "state": "SUBMITTED", "replyTo": null, "originalCommit": null, "originalPosition": 24}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzEyMDYxOTg0OnYy", "diffSide": "RIGHT", "path": "presto-docs/src/main/sphinx/functions/tdigest.rst", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wMVQxOToyOTo0MlrOHbYHEQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wMVQxOToyOTo0MlrOHbYHEQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5ODQ2ODYyNQ==", "bodyText": "array, given", "url": "https://github.com/trinodb/trino/pull/5158#discussion_r498468625", "createdAt": "2020-10-01T19:29:42Z", "author": {"login": "mosabua"}, "path": "presto-docs/src/main/sphinx/functions/tdigest.rst", "diffHunk": "@@ -0,0 +1,41 @@\n+=========================\n+T-Digest Functions\n+=========================\n+\n+Data Structures\n+---------------\n+\n+A T-digest is a data sketch which stores approximate percentile\n+information.  The Presto type for this data structure is called ``tdigest``.\n+T-digests may be merged, and for storage and retrieval they may be cast\n+to/from ``VARBINARY``.\n+\n+Functions\n+---------\n+\n+.. function:: merge(tdigest) -> tdigest\n+    :noindex:\n+\n+    Aggregation function. Merges all input ``tdigest``\\ s into a single ``tdigest``.\n+\n+.. function:: value_at_quantile(tdigest, quantile) -> double\n+    :noindex:\n+\n+    Returns the approximate percentile value from the T-digest given\n+    the number ``quantile`` between 0 and 1.\n+\n+.. function:: values_at_quantiles(tdigest, quantiles) -> array<double>\n+    :noindex:\n+\n+    Returns the approximate percentile values as an array given the input", "state": "SUBMITTED", "replyTo": null, "originalCommit": null, "originalPosition": 30}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzEyMDYyMjY4OnYy", "diffSide": "RIGHT", "path": "presto-docs/src/main/sphinx/functions/tdigest.rst", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wMVQxOTozMDozOVrOHbYI4w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wMVQxOTozMDozOVrOHbYI4w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5ODQ2OTA5MQ==", "bodyText": "and an array of values between 0 and 1, which represent the quantiles to return.", "url": "https://github.com/trinodb/trino/pull/5158#discussion_r498469091", "createdAt": "2020-10-01T19:30:39Z", "author": {"login": "mosabua"}, "path": "presto-docs/src/main/sphinx/functions/tdigest.rst", "diffHunk": "@@ -0,0 +1,41 @@\n+=========================\n+T-Digest Functions\n+=========================\n+\n+Data Structures\n+---------------\n+\n+A T-digest is a data sketch which stores approximate percentile\n+information.  The Presto type for this data structure is called ``tdigest``.\n+T-digests may be merged, and for storage and retrieval they may be cast\n+to/from ``VARBINARY``.\n+\n+Functions\n+---------\n+\n+.. function:: merge(tdigest) -> tdigest\n+    :noindex:\n+\n+    Aggregation function. Merges all input ``tdigest``\\ s into a single ``tdigest``.\n+\n+.. function:: value_at_quantile(tdigest, quantile) -> double\n+    :noindex:\n+\n+    Returns the approximate percentile value from the T-digest given\n+    the number ``quantile`` between 0 and 1.\n+\n+.. function:: values_at_quantiles(tdigest, quantiles) -> array<double>\n+    :noindex:\n+\n+    Returns the approximate percentile values as an array given the input\n+    T-digest and array of values between 0 and 1 which", "state": "SUBMITTED", "replyTo": null, "originalCommit": null, "originalPosition": 31}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzEyMDYyNTMyOnYy", "diffSide": "RIGHT", "path": "presto-docs/src/main/sphinx/functions/tdigest.rst", "isResolved": false, "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wMVQxOTozMTo0MVrOHbYKpg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wMVQyMToxNzo1MVrOHbbIyA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5ODQ2OTU0Mg==", "bodyText": "Composes all input values of x into a T-digest.\nAnd need to add what x is...", "url": "https://github.com/trinodb/trino/pull/5158#discussion_r498469542", "createdAt": "2020-10-01T19:31:41Z", "author": {"login": "mosabua"}, "path": "presto-docs/src/main/sphinx/functions/tdigest.rst", "diffHunk": "@@ -0,0 +1,41 @@\n+=========================\n+T-Digest Functions\n+=========================\n+\n+Data Structures\n+---------------\n+\n+A T-digest is a data sketch which stores approximate percentile\n+information.  The Presto type for this data structure is called ``tdigest``.\n+T-digests may be merged, and for storage and retrieval they may be cast\n+to/from ``VARBINARY``.\n+\n+Functions\n+---------\n+\n+.. function:: merge(tdigest) -> tdigest\n+    :noindex:\n+\n+    Aggregation function. Merges all input ``tdigest``\\ s into a single ``tdigest``.\n+\n+.. function:: value_at_quantile(tdigest, quantile) -> double\n+    :noindex:\n+\n+    Returns the approximate percentile value from the T-digest given\n+    the number ``quantile`` between 0 and 1.\n+\n+.. function:: values_at_quantiles(tdigest, quantiles) -> array<double>\n+    :noindex:\n+\n+    Returns the approximate percentile values as an array given the input\n+    T-digest and array of values between 0 and 1 which\n+    represent the quantiles to return.\n+\n+.. function:: tdigest_agg(x) -> tdigest\n+\n+    Returns the ``tdigest`` which is composed of  all input values of ``x``.", "state": "SUBMITTED", "replyTo": null, "originalCommit": null, "originalPosition": 36}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5ODQ5OTc3OA==", "bodyText": "And need to add what x is...\n\nShould I say that x are numeric values? I think it's rather obvious. What else could I add here?", "url": "https://github.com/trinodb/trino/pull/5158#discussion_r498499778", "createdAt": "2020-10-01T20:37:09Z", "author": {"login": "kasiafi"}, "path": "presto-docs/src/main/sphinx/functions/tdigest.rst", "diffHunk": "@@ -0,0 +1,41 @@\n+=========================\n+T-Digest Functions\n+=========================\n+\n+Data Structures\n+---------------\n+\n+A T-digest is a data sketch which stores approximate percentile\n+information.  The Presto type for this data structure is called ``tdigest``.\n+T-digests may be merged, and for storage and retrieval they may be cast\n+to/from ``VARBINARY``.\n+\n+Functions\n+---------\n+\n+.. function:: merge(tdigest) -> tdigest\n+    :noindex:\n+\n+    Aggregation function. Merges all input ``tdigest``\\ s into a single ``tdigest``.\n+\n+.. function:: value_at_quantile(tdigest, quantile) -> double\n+    :noindex:\n+\n+    Returns the approximate percentile value from the T-digest given\n+    the number ``quantile`` between 0 and 1.\n+\n+.. function:: values_at_quantiles(tdigest, quantiles) -> array<double>\n+    :noindex:\n+\n+    Returns the approximate percentile values as an array given the input\n+    T-digest and array of values between 0 and 1 which\n+    represent the quantiles to return.\n+\n+.. function:: tdigest_agg(x) -> tdigest\n+\n+    Returns the ``tdigest`` which is composed of  all input values of ``x``.", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5ODQ2OTU0Mg=="}, "originalCommit": null, "originalPosition": 36}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5ODUxODIxNg==", "bodyText": "well... what kind of numeric types work? I assume all .. but then we should say that", "url": "https://github.com/trinodb/trino/pull/5158#discussion_r498518216", "createdAt": "2020-10-01T21:17:51Z", "author": {"login": "mosabua"}, "path": "presto-docs/src/main/sphinx/functions/tdigest.rst", "diffHunk": "@@ -0,0 +1,41 @@\n+=========================\n+T-Digest Functions\n+=========================\n+\n+Data Structures\n+---------------\n+\n+A T-digest is a data sketch which stores approximate percentile\n+information.  The Presto type for this data structure is called ``tdigest``.\n+T-digests may be merged, and for storage and retrieval they may be cast\n+to/from ``VARBINARY``.\n+\n+Functions\n+---------\n+\n+.. function:: merge(tdigest) -> tdigest\n+    :noindex:\n+\n+    Aggregation function. Merges all input ``tdigest``\\ s into a single ``tdigest``.\n+\n+.. function:: value_at_quantile(tdigest, quantile) -> double\n+    :noindex:\n+\n+    Returns the approximate percentile value from the T-digest given\n+    the number ``quantile`` between 0 and 1.\n+\n+.. function:: values_at_quantiles(tdigest, quantiles) -> array<double>\n+    :noindex:\n+\n+    Returns the approximate percentile values as an array given the input\n+    T-digest and array of values between 0 and 1 which\n+    represent the quantiles to return.\n+\n+.. function:: tdigest_agg(x) -> tdigest\n+\n+    Returns the ``tdigest`` which is composed of  all input values of ``x``.", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5ODQ2OTU0Mg=="}, "originalCommit": null, "originalPosition": 36}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzEyMDYyNjM4OnYy", "diffSide": "RIGHT", "path": "presto-docs/src/main/sphinx/functions/tdigest.rst", "isResolved": false, "comments": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wMVQxOTozMjowOVrOHbYLbA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wMlQwNjo0NTozNFrOHbipYA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5ODQ2OTc0MA==", "bodyText": "Similar to above and explain x and w", "url": "https://github.com/trinodb/trino/pull/5158#discussion_r498469740", "createdAt": "2020-10-01T19:32:09Z", "author": {"login": "mosabua"}, "path": "presto-docs/src/main/sphinx/functions/tdigest.rst", "diffHunk": "@@ -0,0 +1,41 @@\n+=========================\n+T-Digest Functions\n+=========================\n+\n+Data Structures\n+---------------\n+\n+A T-digest is a data sketch which stores approximate percentile\n+information.  The Presto type for this data structure is called ``tdigest``.\n+T-digests may be merged, and for storage and retrieval they may be cast\n+to/from ``VARBINARY``.\n+\n+Functions\n+---------\n+\n+.. function:: merge(tdigest) -> tdigest\n+    :noindex:\n+\n+    Aggregation function. Merges all input ``tdigest``\\ s into a single ``tdigest``.\n+\n+.. function:: value_at_quantile(tdigest, quantile) -> double\n+    :noindex:\n+\n+    Returns the approximate percentile value from the T-digest given\n+    the number ``quantile`` between 0 and 1.\n+\n+.. function:: values_at_quantiles(tdigest, quantiles) -> array<double>\n+    :noindex:\n+\n+    Returns the approximate percentile values as an array given the input\n+    T-digest and array of values between 0 and 1 which\n+    represent the quantiles to return.\n+\n+.. function:: tdigest_agg(x) -> tdigest\n+\n+    Returns the ``tdigest`` which is composed of  all input values of ``x``.\n+\n+.. function:: tdigest_agg(x, w) -> tdigest\n+\n+    Returns the ``tdigest`` which is composed of  all input values of ``x`` using", "state": "SUBMITTED", "replyTo": null, "originalCommit": null, "originalPosition": 40}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5ODUwMDczMw==", "bodyText": "It says per-item weight w, so I consider w explained. I added a note that w must be >= 1.", "url": "https://github.com/trinodb/trino/pull/5158#discussion_r498500733", "createdAt": "2020-10-01T20:39:24Z", "author": {"login": "kasiafi"}, "path": "presto-docs/src/main/sphinx/functions/tdigest.rst", "diffHunk": "@@ -0,0 +1,41 @@\n+=========================\n+T-Digest Functions\n+=========================\n+\n+Data Structures\n+---------------\n+\n+A T-digest is a data sketch which stores approximate percentile\n+information.  The Presto type for this data structure is called ``tdigest``.\n+T-digests may be merged, and for storage and retrieval they may be cast\n+to/from ``VARBINARY``.\n+\n+Functions\n+---------\n+\n+.. function:: merge(tdigest) -> tdigest\n+    :noindex:\n+\n+    Aggregation function. Merges all input ``tdigest``\\ s into a single ``tdigest``.\n+\n+.. function:: value_at_quantile(tdigest, quantile) -> double\n+    :noindex:\n+\n+    Returns the approximate percentile value from the T-digest given\n+    the number ``quantile`` between 0 and 1.\n+\n+.. function:: values_at_quantiles(tdigest, quantiles) -> array<double>\n+    :noindex:\n+\n+    Returns the approximate percentile values as an array given the input\n+    T-digest and array of values between 0 and 1 which\n+    represent the quantiles to return.\n+\n+.. function:: tdigest_agg(x) -> tdigest\n+\n+    Returns the ``tdigest`` which is composed of  all input values of ``x``.\n+\n+.. function:: tdigest_agg(x, w) -> tdigest\n+\n+    Returns the ``tdigest`` which is composed of  all input values of ``x`` using", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5ODQ2OTc0MA=="}, "originalCommit": null, "originalPosition": 40}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5ODUxODQ1NQ==", "bodyText": "any < restriction for w?", "url": "https://github.com/trinodb/trino/pull/5158#discussion_r498518455", "createdAt": "2020-10-01T21:18:28Z", "author": {"login": "mosabua"}, "path": "presto-docs/src/main/sphinx/functions/tdigest.rst", "diffHunk": "@@ -0,0 +1,41 @@\n+=========================\n+T-Digest Functions\n+=========================\n+\n+Data Structures\n+---------------\n+\n+A T-digest is a data sketch which stores approximate percentile\n+information.  The Presto type for this data structure is called ``tdigest``.\n+T-digests may be merged, and for storage and retrieval they may be cast\n+to/from ``VARBINARY``.\n+\n+Functions\n+---------\n+\n+.. function:: merge(tdigest) -> tdigest\n+    :noindex:\n+\n+    Aggregation function. Merges all input ``tdigest``\\ s into a single ``tdigest``.\n+\n+.. function:: value_at_quantile(tdigest, quantile) -> double\n+    :noindex:\n+\n+    Returns the approximate percentile value from the T-digest given\n+    the number ``quantile`` between 0 and 1.\n+\n+.. function:: values_at_quantiles(tdigest, quantiles) -> array<double>\n+    :noindex:\n+\n+    Returns the approximate percentile values as an array given the input\n+    T-digest and array of values between 0 and 1 which\n+    represent the quantiles to return.\n+\n+.. function:: tdigest_agg(x) -> tdigest\n+\n+    Returns the ``tdigest`` which is composed of  all input values of ``x``.\n+\n+.. function:: tdigest_agg(x, w) -> tdigest\n+\n+    Returns the ``tdigest`` which is composed of  all input values of ``x`` using", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5ODQ2OTc0MA=="}, "originalCommit": null, "originalPosition": 40}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5ODY0MTI0OA==", "bodyText": "No upper bound restriction.\nI added information that x and w can be of any numeric type.", "url": "https://github.com/trinodb/trino/pull/5158#discussion_r498641248", "createdAt": "2020-10-02T06:45:34Z", "author": {"login": "kasiafi"}, "path": "presto-docs/src/main/sphinx/functions/tdigest.rst", "diffHunk": "@@ -0,0 +1,41 @@\n+=========================\n+T-Digest Functions\n+=========================\n+\n+Data Structures\n+---------------\n+\n+A T-digest is a data sketch which stores approximate percentile\n+information.  The Presto type for this data structure is called ``tdigest``.\n+T-digests may be merged, and for storage and retrieval they may be cast\n+to/from ``VARBINARY``.\n+\n+Functions\n+---------\n+\n+.. function:: merge(tdigest) -> tdigest\n+    :noindex:\n+\n+    Aggregation function. Merges all input ``tdigest``\\ s into a single ``tdigest``.\n+\n+.. function:: value_at_quantile(tdigest, quantile) -> double\n+    :noindex:\n+\n+    Returns the approximate percentile value from the T-digest given\n+    the number ``quantile`` between 0 and 1.\n+\n+.. function:: values_at_quantiles(tdigest, quantiles) -> array<double>\n+    :noindex:\n+\n+    Returns the approximate percentile values as an array given the input\n+    T-digest and array of values between 0 and 1 which\n+    represent the quantiles to return.\n+\n+.. function:: tdigest_agg(x) -> tdigest\n+\n+    Returns the ``tdigest`` which is composed of  all input values of ``x``.\n+\n+.. function:: tdigest_agg(x, w) -> tdigest\n+\n+    Returns the ``tdigest`` which is composed of  all input values of ``x`` using", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5ODQ2OTc0MA=="}, "originalCommit": null, "originalPosition": 40}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzEyMDYyNzgxOnYy", "diffSide": "RIGHT", "path": "presto-docs/src/main/sphinx/language/types.rst", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wMVQxOTozMjo0MVrOHbYMbg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wMVQxOTozMjo0MVrOHbYMbg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5ODQ2OTk5OA==", "bodyText": "input set. It can be queried", "url": "https://github.com/trinodb/trino/pull/5158#discussion_r498469998", "createdAt": "2020-10-01T19:32:41Z", "author": {"login": "mosabua"}, "path": "presto-docs/src/main/sphinx/language/types.rst", "diffHunk": "@@ -361,3 +361,19 @@ can be reused.  For example, one may be interested in a daily reading of the 99t\n percentile values that are read over the course of a week.  Instead of calculating\n the past week of data with ``approx_percentile``, ``qdigest``\\ s could be stored\n daily, and quickly merged to retrieve the 99th percentile value.\n+\n+T-Digest\n+---------------\n+\n+.. _tdigest_type:\n+\n+``TDigest``\n+^^^^^^^^^^^\n+\n+A T-digest (tdigest) is a summary structure which, similarly to qdigest, captures the\n+approximate distribution of data for a given input set, and can be queried to retrieve", "state": "SUBMITTED", "replyTo": null, "originalCommit": null, "originalPosition": 14}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzEyMDYzMzkzOnYy", "diffSide": "RIGHT", "path": "presto-docs/src/main/sphinx/language/types.rst", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wMVQxOTozNDo1OVrOHbYQqA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wMVQxOTozNDo1OVrOHbYQqA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5ODQ3MTA4MA==", "bodyText": "TDigest has the following advantages compared to QDigest:\n\n* higher performance\n* lower memory usage\n* higher accuracy and high and low percentiles", "url": "https://github.com/trinodb/trino/pull/5158#discussion_r498471080", "createdAt": "2020-10-01T19:34:59Z", "author": {"login": "mosabua"}, "path": "presto-docs/src/main/sphinx/language/types.rst", "diffHunk": "@@ -361,3 +361,19 @@ can be reused.  For example, one may be interested in a daily reading of the 99t\n percentile values that are read over the course of a week.  Instead of calculating\n the past week of data with ``approx_percentile``, ``qdigest``\\ s could be stored\n daily, and quickly merged to retrieve the 99th percentile value.\n+\n+T-Digest\n+---------------\n+\n+.. _tdigest_type:\n+\n+``TDigest``\n+^^^^^^^^^^^\n+\n+A T-digest (tdigest) is a summary structure which, similarly to qdigest, captures the\n+approximate distribution of data for a given input set, and can be queried to retrieve\n+approximate quantile values from the distribution.  The advantages of tdigest over", "state": "SUBMITTED", "replyTo": null, "originalCommit": null, "originalPosition": 15}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3212, "cost": 1, "resetAt": "2021-11-12T12:57:47Z"}}}