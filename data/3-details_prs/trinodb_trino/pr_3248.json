{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0Mzk0MjcxMDU3", "number": 3248, "title": "Add logging in SqlFormatterUtil", "bodyText": "", "createdAt": "2020-03-26T16:16:30Z", "url": "https://github.com/trinodb/trino/pull/3248", "merged": true, "mergeCommit": {"oid": "d3eb25b15a8af7318119e48a251e6aae67f14fba"}, "closed": true, "closedAt": "2020-03-29T07:59:51Z", "author": {"login": "findepi"}, "timelineItems": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcRerOzAFqTM4MjE3NTkxOQ==", "endCursor": "Y3Vyc29yOnYyOpPPAAABcSPCM7AFqTM4MzM2MjMzOA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzgyMTc1OTE5", "url": "https://github.com/trinodb/trino/pull/3248#pullrequestreview-382175919", "createdAt": "2020-03-26T16:18:47Z", "commit": null, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yNlQxNjoxODo0N1rOF8O9nA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yNlQxNjoxODo0N1rOF8O9nA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5ODcwNDAyOA==", "bodyText": "Remove space before newline and after tab. Single tab should be sufficient:\nlog.debug(\"Formatted query does not parse:\\n\\tstatement: [%s]\\n\\tformatted: [%s]\", statement, sql);\nI'm also thinking we don't need brackets around the statement, since it will be of the form Query{...} produced by ToStringBuilder:\nlog.debug(\"Formatted query does not parse:\\n\\tstatement: %s\\n\\tformatted: [%s]\", statement, sql);", "url": "https://github.com/trinodb/trino/pull/3248#discussion_r398704028", "createdAt": "2020-03-26T16:18:47Z", "author": {"login": "electrum"}, "path": "presto-main/src/main/java/io/prestosql/sql/SqlFormatterUtil.java", "diffHunk": "@@ -37,9 +40,11 @@ public static String getFormattedSql(Statement statement, SqlParser sqlParser)\n             parsed = sqlParser.createStatement(sql, parsingOptions);\n         }\n         catch (ParsingException e) {\n-            throw new PrestoException(GENERIC_INTERNAL_ERROR, \"Formatted query does not parse: \" + statement);\n+            log.debug(\"Formatted query does not parse: \\n\\t\\t statement: [%s] \\n\\t\\t formatted: [%s]\", statement, sql);", "state": "SUBMITTED", "replyTo": null, "originalCommit": null, "originalPosition": 22}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzgyMTg2MDg2", "url": "https://github.com/trinodb/trino/pull/3248#pullrequestreview-382186086", "createdAt": "2020-03-26T16:28:53Z", "commit": null, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yNlQxNjoyODo1M1rOF8PeeA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yNlQxNjoyODo1M1rOF8PeeA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5ODcxMjQ0MA==", "bodyText": "Since statement is likely huge, it might be better to attach, which also gives us a place to put the SQL:\nPrestoException error = new PrestoException(GENERIC_INTERNAL_ERROR, \"Formatted query does not parse\", e);\nerror.addSuppressed(new RuntimeException(\"Statement: \" + statement));\nerror.addSuppressed(new RuntimeException(format(\"Formatted: [%s]\", sql)));\nthrow error;", "url": "https://github.com/trinodb/trino/pull/3248#discussion_r398712440", "createdAt": "2020-03-26T16:28:53Z", "author": {"login": "electrum"}, "path": "presto-main/src/main/java/io/prestosql/sql/SqlFormatterUtil.java", "diffHunk": "@@ -37,9 +40,11 @@ public static String getFormattedSql(Statement statement, SqlParser sqlParser)\n             parsed = sqlParser.createStatement(sql, parsingOptions);\n         }\n         catch (ParsingException e) {\n-            throw new PrestoException(GENERIC_INTERNAL_ERROR, \"Formatted query does not parse: \" + statement);\n+            log.debug(\"Formatted query does not parse: \\n\\t\\t statement: [%s] \\n\\t\\t formatted: [%s]\", statement, sql);\n+            throw new PrestoException(GENERIC_INTERNAL_ERROR, \"Formatted query does not parse: \" + statement, e);", "state": "SUBMITTED", "replyTo": null, "originalCommit": null, "originalPosition": 23}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "118ef0d118e07524a0c6760bc3f7db6d8a2c883a", "author": {"user": {"login": "findepi", "name": "Piotr Findeisen"}}, "url": "https://github.com/trinodb/trino/commit/118ef0d118e07524a0c6760bc3f7db6d8a2c883a", "committedDate": "2020-03-27T06:48:03Z", "message": "Report formatted SQL when does not parse"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": null, "afterCommit": {"oid": "118ef0d118e07524a0c6760bc3f7db6d8a2c883a", "author": {"user": {"login": "findepi", "name": "Piotr Findeisen"}}, "url": "https://github.com/trinodb/trino/commit/118ef0d118e07524a0c6760bc3f7db6d8a2c883a", "committedDate": "2020-03-27T06:48:03Z", "message": "Report formatted SQL when does not parse"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzgzMzYyMzM4", "url": "https://github.com/trinodb/trino/pull/3248#pullrequestreview-383362338", "createdAt": "2020-03-29T00:47:42Z", "commit": {"oid": "118ef0d118e07524a0c6760bc3f7db6d8a2c883a"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2053, "cost": 1, "resetAt": "2021-10-28T19:08:13Z"}}}