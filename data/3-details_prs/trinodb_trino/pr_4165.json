{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDM4MzI2Mzcx", "number": 4165, "title": "Add support for user/password auth", "bodyText": "", "createdAt": "2020-06-23T05:24:31Z", "url": "https://github.com/trinodb/trino/pull/4165", "merged": true, "mergeCommit": {"oid": "82659bcbef63d9a438f5f1ffd04e6df8084ae291"}, "closed": true, "closedAt": "2020-06-24T21:58:51Z", "author": {"login": "martint"}, "timelineItems": {"totalCount": 7, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABct_p1JgFqTQzNTQ4MjgxMA==", "endCursor": "Y3Vyc29yOnYyOpPPAAABcuhXHjgBqjM0Nzk1NDc1NDE=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDM1NDgyODEw", "url": "https://github.com/trinodb/trino/pull/4165#pullrequestreview-435482810", "createdAt": "2020-06-23T06:41:56Z", "commit": null, "state": "APPROVED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yM1QwNjo0MTo1NlrOGnbS7Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yM1QwNjo0MTo1NlrOGnbS7Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0Mzk5NDg2MQ==", "bodyText": "verify the two configs are mutually exclusive", "url": "https://github.com/trinodb/trino/pull/4165#discussion_r443994861", "createdAt": "2020-06-23T06:41:56Z", "author": {"login": "findepi"}, "path": "presto-elasticsearch/src/main/java/io/prestosql/elasticsearch/client/ElasticsearchClient.java", "diffHunk": "@@ -228,6 +239,12 @@ private static RestHighLevelClient createClient(ElasticsearchConfig config, Opti\n                 }\n             }\n \n+            passwordConfig.ifPresent(securityConfig -> {", "state": "SUBMITTED", "replyTo": null, "originalCommit": null, "originalPosition": 52}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDM1NDk1NzY5", "url": "https://github.com/trinodb/trino/pull/4165#pullrequestreview-435495769", "createdAt": "2020-06-23T07:04:06Z", "commit": null, "state": "APPROVED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yM1QwNzowNDowNlrOGnb6PQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yM1QwNzowNDowNlrOGnb6PQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NDAwNDkyNQ==", "bodyText": "add comma at the end", "url": "https://github.com/trinodb/trino/pull/4165#discussion_r444004925", "createdAt": "2020-06-23T07:04:06Z", "author": {"login": "kokosing"}, "path": "presto-elasticsearch/src/main/java/io/prestosql/elasticsearch/ElasticsearchConfig.java", "diffHunk": "@@ -49,7 +49,8 @@\n {\n     public enum Security\n     {\n-        AWS\n+        AWS,\n+        PASSWORD", "state": "SUBMITTED", "replyTo": null, "originalCommit": null, "originalPosition": 6}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": null, "afterCommit": null}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": null, "afterCommit": null}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDM2Mzc2NjQ1", "url": "https://github.com/trinodb/trino/pull/4165#pullrequestreview-436376645", "createdAt": "2020-06-24T07:04:14Z", "commit": null, "state": "APPROVED", "comments": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yNFQwNzowNDoxNFrOGoFhNQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yNFQwNzowOTowNlrOGoFpLw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NDY4NjY0NQ==", "bodyText": "will this be deleted on exit recursively?", "url": "https://github.com/trinodb/trino/pull/4165#discussion_r444686645", "createdAt": "2020-06-24T07:04:14Z", "author": {"login": "findepi"}, "path": "presto-elasticsearch/src/test/java/io/prestosql/elasticsearch/ElasticsearchServer.java", "diffHunk": "@@ -13,16 +13,42 @@\n  */\n package io.prestosql.elasticsearch;\n \n+import com.google.common.io.Files;\n import com.google.common.net.HostAndPort;\n import org.testcontainers.elasticsearch.ElasticsearchContainer;\n \n+import java.io.File;\n+import java.io.IOException;\n+import java.nio.file.Path;\n+import java.util.Map;\n+\n+import static com.google.common.io.Files.createTempDir;\n+import static java.nio.charset.StandardCharsets.UTF_8;\n+import static org.testcontainers.utility.MountableFile.forHostPath;\n+\n public class ElasticsearchServer\n {\n     private final ElasticsearchContainer container;\n \n-    public ElasticsearchServer(String version)\n+    public ElasticsearchServer(String image, Map<String, String> configuration)\n+            throws IOException\n     {\n-        container = new ElasticsearchContainer(\"docker.elastic.co/elasticsearch/elasticsearch-oss:\" + version);\n+        container = new ElasticsearchContainer(image);\n+\n+        if (!configuration.isEmpty()) {\n+            File tempDir = createTempDir();\n+            tempDir.deleteOnExit();", "state": "SUBMITTED", "replyTo": null, "originalCommit": null, "originalPosition": 30}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NDY4Njg5OA==", "bodyText": "java.nio.Files.write(path, contensts, UTF_8)", "url": "https://github.com/trinodb/trino/pull/4165#discussion_r444686898", "createdAt": "2020-06-24T07:04:48Z", "author": {"login": "findepi"}, "path": "presto-elasticsearch/src/test/java/io/prestosql/elasticsearch/ElasticsearchServer.java", "diffHunk": "@@ -13,16 +13,42 @@\n  */\n package io.prestosql.elasticsearch;\n \n+import com.google.common.io.Files;\n import com.google.common.net.HostAndPort;\n import org.testcontainers.elasticsearch.ElasticsearchContainer;\n \n+import java.io.File;\n+import java.io.IOException;\n+import java.nio.file.Path;\n+import java.util.Map;\n+\n+import static com.google.common.io.Files.createTempDir;\n+import static java.nio.charset.StandardCharsets.UTF_8;\n+import static org.testcontainers.utility.MountableFile.forHostPath;\n+\n public class ElasticsearchServer\n {\n     private final ElasticsearchContainer container;\n \n-    public ElasticsearchServer(String version)\n+    public ElasticsearchServer(String image, Map<String, String> configuration)\n+            throws IOException\n     {\n-        container = new ElasticsearchContainer(\"docker.elastic.co/elasticsearch/elasticsearch-oss:\" + version);\n+        container = new ElasticsearchContainer(image);\n+\n+        if (!configuration.isEmpty()) {\n+            File tempDir = createTempDir();\n+            tempDir.deleteOnExit();\n+\n+            for (Map.Entry<String, String> entry : configuration.entrySet()) {\n+                String name = entry.getKey();\n+                String contents = entry.getValue();\n+\n+                Path path = tempDir.toPath().resolve(name);\n+                Files.asCharSink(path.toFile(), UTF_8).write(contents);", "state": "SUBMITTED", "replyTo": null, "originalCommit": null, "originalPosition": 37}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NDY4NzU5Ng==", "bodyText": "document why you use 7.0.0 here and 7.8 in pwd test case", "url": "https://github.com/trinodb/trino/pull/4165#discussion_r444687596", "createdAt": "2020-06-24T07:06:27Z", "author": {"login": "findepi"}, "path": "presto-elasticsearch/src/test/java/io/prestosql/elasticsearch/TestElasticsearch7IntegrationSmokeTest.java", "diffHunk": "@@ -20,7 +20,7 @@\n {\n     public TestElasticsearch7IntegrationSmokeTest()\n     {\n-        super(\"7.0.0\");\n+        super(\"elasticsearch:7.0.0\");", "state": "SUBMITTED", "replyTo": null, "originalCommit": null, "originalPosition": 5}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NDY4ODM1Mw==", "bodyText": "configuration -> configurationFiles or configurationFileContents", "url": "https://github.com/trinodb/trino/pull/4165#discussion_r444688353", "createdAt": "2020-06-24T07:08:21Z", "author": {"login": "findepi"}, "path": "presto-elasticsearch/src/test/java/io/prestosql/elasticsearch/ElasticsearchServer.java", "diffHunk": "@@ -13,16 +13,42 @@\n  */\n package io.prestosql.elasticsearch;\n \n+import com.google.common.io.Files;\n import com.google.common.net.HostAndPort;\n import org.testcontainers.elasticsearch.ElasticsearchContainer;\n \n+import java.io.File;\n+import java.io.IOException;\n+import java.nio.file.Path;\n+import java.util.Map;\n+\n+import static com.google.common.io.Files.createTempDir;\n+import static java.nio.charset.StandardCharsets.UTF_8;\n+import static org.testcontainers.utility.MountableFile.forHostPath;\n+\n public class ElasticsearchServer\n {\n     private final ElasticsearchContainer container;\n \n-    public ElasticsearchServer(String version)\n+    public ElasticsearchServer(String image, Map<String, String> configuration)", "state": "SUBMITTED", "replyTo": null, "originalCommit": null, "originalPosition": 22}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NDY4ODY4Nw==", "bodyText": "can this be more easily searchable, like some_user or some_es_user?", "url": "https://github.com/trinodb/trino/pull/4165#discussion_r444688687", "createdAt": "2020-06-24T07:09:06Z", "author": {"login": "findepi"}, "path": "presto-elasticsearch/src/test/resources/users", "diffHunk": "@@ -0,0 +1 @@\n+user:$2a$10$tbO62EbOfqMezJDBDWlxbuvIleeYeNlw30F5OgWMXzi1R8aXqnVni", "state": "SUBMITTED", "replyTo": null, "originalCommit": null, "originalPosition": 1}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "82659bcbef63d9a438f5f1ffd04e6df8084ae291", "author": {"user": {"login": "martint", "name": "Martin Traverso"}}, "url": "https://github.com/trinodb/trino/commit/82659bcbef63d9a438f5f1ffd04e6df8084ae291", "committedDate": "2020-06-24T21:58:38Z", "message": "Add support for user/password auth"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": null, "afterCommit": {"oid": "82659bcbef63d9a438f5f1ffd04e6df8084ae291", "author": {"user": {"login": "martint", "name": "Martin Traverso"}}, "url": "https://github.com/trinodb/trino/commit/82659bcbef63d9a438f5f1ffd04e6df8084ae291", "committedDate": "2020-06-24T21:58:38Z", "message": "Add support for user/password auth"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 124, "cost": 1, "resetAt": "2021-10-28T19:08:13Z"}}}