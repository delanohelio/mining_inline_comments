{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0MzU5MzgyNDcy", "number": 2414, "reviewThreads": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0wNlQwNToyMjo1NFrODV48bw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0wNlQwNToyNDo0OFrODV48-w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjI0Mjc5NjYzOnYy", "diffSide": "RIGHT", "path": "presto-sqlserver/src/test/java/io/prestosql/plugin/sqlserver/TestingSqlServer.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0wNlQwNToyMjo1NVrOFaVpQg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0wNlQwNToyMjo1NVrOFaVpQg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2MzE2MTkyMg==", "bodyText": "I think this can use dockerContainer.createConnection(\"\")", "url": "https://github.com/trinodb/trino/pull/2414#discussion_r363161922", "createdAt": "2020-01-06T05:22:55Z", "author": {"login": "electrum"}, "path": "presto-sqlserver/src/test/java/io/prestosql/plugin/sqlserver/TestingSqlServer.java", "diffHunk": "@@ -13,49 +13,29 @@\n  */\n package io.prestosql.plugin.sqlserver;\n \n-import com.google.common.collect.ImmutableMap;\n-import io.prestosql.testing.docker.DockerContainer;\n-import io.prestosql.testing.docker.DockerContainer.HostPortProvider;\n+import org.testcontainers.containers.MSSQLServerContainer;\n \n import java.io.Closeable;\n import java.sql.Connection;\n import java.sql.DriverManager;\n import java.sql.Statement;\n \n-import static java.lang.String.format;\n-\n public final class TestingSqlServer\n         implements Closeable\n {\n-    private static final int SQL_SERVER_PORT = 1433;\n-\n-    public static final String USER = \"sa\";\n-    public static final String PASSWORD = \"SQLServerPass1\";\n-\n-    private final DockerContainer dockerContainer;\n+    private final MSSQLServerContainer<?> dockerContainer;\n \n     public TestingSqlServer()\n     {\n-        this.dockerContainer = DockerContainer.forImage(\"microsoft/mssql-server-linux:2017-CU13\")\n-                .setPorts(SQL_SERVER_PORT)\n-                .setEnvironment(ImmutableMap.of(\n-                        \"ACCEPT_EULA\", \"Y\",\n-                        \"SA_PASSWORD\", \"SQLServerPass1\"))\n-                .setHealthCheck(portProvider -> TestingSqlServer.execute(portProvider, \"SELECT 1\"))\n-                .start();\n+        this.dockerContainer = new MSSQLServerContainer(\"microsoft/mssql-server-linux:2017-CU13\");\n+        dockerContainer.start();\n     }\n \n     public void execute(String sql)\n     {\n-        execute(dockerContainer::getHostPort, sql);\n-    }\n-\n-    private static void execute(HostPortProvider hostPortProvider, String sql)\n-    {\n-        String jdbcUrl = getJdbcUrl(hostPortProvider.getHostPort(SQL_SERVER_PORT));\n-        try (Connection conn = DriverManager.getConnection(jdbcUrl, USER, PASSWORD);\n-                Statement stmt = conn.createStatement()) {\n-            stmt.execute(sql);\n+        try (Connection connection = DriverManager.getConnection(dockerContainer.getJdbcUrl(), dockerContainer.getUsername(), dockerContainer.getPassword());", "state": "SUBMITTED", "replyTo": null, "originalCommit": null, "originalPosition": 51}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjI0Mjc5ODAzOnYy", "diffSide": "RIGHT", "path": "presto-sqlserver/src/test/java/io/prestosql/plugin/sqlserver/TestingSqlServer.java", "isResolved": false, "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0wNlQwNToyNDo0OFrOFaVqFw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0wOFQyMTo0MTozOFrOFbksgw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2MzE2MjEzNQ==", "bodyText": "Consider removing this class. I'm not sure it provides much value compared to using MSSQLServerContainer directly. I did that in these two and it seems to work well: #2408 #2410", "url": "https://github.com/trinodb/trino/pull/2414#discussion_r363162135", "createdAt": "2020-01-06T05:24:48Z", "author": {"login": "electrum"}, "path": "presto-sqlserver/src/test/java/io/prestosql/plugin/sqlserver/TestingSqlServer.java", "diffHunk": "@@ -13,49 +13,29 @@\n  */\n package io.prestosql.plugin.sqlserver;\n \n-import com.google.common.collect.ImmutableMap;\n-import io.prestosql.testing.docker.DockerContainer;\n-import io.prestosql.testing.docker.DockerContainer.HostPortProvider;\n+import org.testcontainers.containers.MSSQLServerContainer;\n \n import java.io.Closeable;\n import java.sql.Connection;\n import java.sql.DriverManager;\n import java.sql.Statement;\n \n-import static java.lang.String.format;\n-\n public final class TestingSqlServer", "state": "SUBMITTED", "replyTo": null, "originalCommit": null, "originalPosition": 16}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2MzI2NDgwNg==", "bodyText": "I think the small benefit is we can manage the version in a single place. We will need to fix three places in SQLServer connector when we upgrade the version. (Or we could define it as a constant in somewhere)", "url": "https://github.com/trinodb/trino/pull/2414#discussion_r363264806", "createdAt": "2020-01-06T11:55:54Z", "author": {"login": "ebyhr"}, "path": "presto-sqlserver/src/test/java/io/prestosql/plugin/sqlserver/TestingSqlServer.java", "diffHunk": "@@ -13,49 +13,29 @@\n  */\n package io.prestosql.plugin.sqlserver;\n \n-import com.google.common.collect.ImmutableMap;\n-import io.prestosql.testing.docker.DockerContainer;\n-import io.prestosql.testing.docker.DockerContainer.HostPortProvider;\n+import org.testcontainers.containers.MSSQLServerContainer;\n \n import java.io.Closeable;\n import java.sql.Connection;\n import java.sql.DriverManager;\n import java.sql.Statement;\n \n-import static java.lang.String.format;\n-\n public final class TestingSqlServer", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2MzE2MjEzNQ=="}, "originalCommit": null, "originalPosition": 16}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NDQ1NzA5MQ==", "bodyText": "Agreed, I came to the same conclusion thanks to @kokosing. One approach is to make TestingSqlServer extend MSSQLServerContainer, like I did in 79b5d4f. Then you don't need getUsername(), etc.", "url": "https://github.com/trinodb/trino/pull/2414#discussion_r364457091", "createdAt": "2020-01-08T21:41:38Z", "author": {"login": "electrum"}, "path": "presto-sqlserver/src/test/java/io/prestosql/plugin/sqlserver/TestingSqlServer.java", "diffHunk": "@@ -13,49 +13,29 @@\n  */\n package io.prestosql.plugin.sqlserver;\n \n-import com.google.common.collect.ImmutableMap;\n-import io.prestosql.testing.docker.DockerContainer;\n-import io.prestosql.testing.docker.DockerContainer.HostPortProvider;\n+import org.testcontainers.containers.MSSQLServerContainer;\n \n import java.io.Closeable;\n import java.sql.Connection;\n import java.sql.DriverManager;\n import java.sql.Statement;\n \n-import static java.lang.String.format;\n-\n public final class TestingSqlServer", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2MzE2MjEzNQ=="}, "originalCommit": null, "originalPosition": 16}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1096, "cost": 1, "resetAt": "2021-11-13T14:23:39Z"}}}