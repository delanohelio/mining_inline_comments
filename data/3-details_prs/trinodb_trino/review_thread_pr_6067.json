{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTI2MDY0NzQ5", "number": 6067, "reviewThreads": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0yNFQwODoyODo0M1rOE8kiiQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0yNFQxMTozNToxN1rOE8rkZw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzMxOTQ4NjgxOnYy", "diffSide": "RIGHT", "path": "presto-base-jdbc/src/main/java/io/prestosql/plugin/jdbc/CachingJdbcClient.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0yNFQwODoyODo0M1rOH4xI1Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0yNFQwODo0NDowMVrOH4xulQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyOTI4NzM4MQ==", "bodyText": "ConnectorSession is not a good candidate for the cache key and we avoided it so far", "url": "https://github.com/trinodb/trino/pull/6067#discussion_r529287381", "createdAt": "2020-11-24T08:28:43Z", "author": {"login": "findepi"}, "path": "presto-base-jdbc/src/main/java/io/prestosql/plugin/jdbc/CachingJdbcClient.java", "diffHunk": "@@ -55,7 +55,7 @@\n     private final JdbcClient delegate;\n     private final boolean cacheMissing;\n \n-    private final LoadingCache<JdbcIdentity, Set<String>> schemaNamesCache;\n+    private final LoadingCache<ConnectorSession, Set<String>> schemaNamesCache;", "state": "SUBMITTED", "replyTo": null, "originalCommit": null, "originalPosition": 5}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyOTI5NzA0NQ==", "bodyText": "ConnectorSession has plenty runtime information. Even query id changes every single query.", "url": "https://github.com/trinodb/trino/pull/6067#discussion_r529297045", "createdAt": "2020-11-24T08:44:01Z", "author": {"login": "kokosing"}, "path": "presto-base-jdbc/src/main/java/io/prestosql/plugin/jdbc/CachingJdbcClient.java", "diffHunk": "@@ -55,7 +55,7 @@\n     private final JdbcClient delegate;\n     private final boolean cacheMissing;\n \n-    private final LoadingCache<JdbcIdentity, Set<String>> schemaNamesCache;\n+    private final LoadingCache<ConnectorSession, Set<String>> schemaNamesCache;", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyOTI4NzM4MQ=="}, "originalCommit": null, "originalPosition": 5}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzMxOTUzNjg1OnYy", "diffSide": "LEFT", "path": "presto-base-jdbc/src/main/java/io/prestosql/plugin/jdbc/BaseJdbcClient.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0yNFQwODo0MToyMFrOH4xn-Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0yNlQyMDoxMjo1OVrOH6mj2A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyOTI5NTM1Mw==", "bodyText": "Do we still need JdbcIdentity? Where it is still used besides caching?", "url": "https://github.com/trinodb/trino/pull/6067#discussion_r529295353", "createdAt": "2020-11-24T08:41:20Z", "author": {"login": "kokosing"}, "path": "presto-base-jdbc/src/main/java/io/prestosql/plugin/jdbc/BaseJdbcClient.java", "diffHunk": "@@ -259,7 +261,7 @@ protected boolean filterSchema(String schemaName)\n     @Override\n     public List<JdbcColumnHandle> getColumns(ConnectorSession session, JdbcTableHandle tableHandle)\n     {\n-        try (Connection connection = connectionFactory.openConnection(JdbcIdentity.from(session));", "state": "SUBMITTED", "replyTo": null, "originalCommit": null, "originalPosition": 42}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMTIxMTIyNA==", "bodyText": "Most probably yes. It's used somewhere in security.", "url": "https://github.com/trinodb/trino/pull/6067#discussion_r531211224", "createdAt": "2020-11-26T20:12:59Z", "author": {"login": "ssheikin"}, "path": "presto-base-jdbc/src/main/java/io/prestosql/plugin/jdbc/BaseJdbcClient.java", "diffHunk": "@@ -259,7 +261,7 @@ protected boolean filterSchema(String schemaName)\n     @Override\n     public List<JdbcColumnHandle> getColumns(ConnectorSession session, JdbcTableHandle tableHandle)\n     {\n-        try (Connection connection = connectionFactory.openConnection(JdbcIdentity.from(session));", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyOTI5NTM1Mw=="}, "originalCommit": null, "originalPosition": 42}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzMyMDYzNDY2OnYy", "diffSide": "RIGHT", "path": "presto-base-jdbc/src/main/java/io/prestosql/plugin/jdbc/CachingJdbcClient.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0yNFQxMTozNDoyNFrOH48v8Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0yNlQyMDoxNDo0NVrOH6mljg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyOTQ3NzYxNw==", "bodyText": "First of all we need to fix getColumns. Then we need to use same approach for other methods that are using cache here.\nSession contains properties that may influence the behavior of the method. We need to use them in the cache key. Please handle that in separate commit.", "url": "https://github.com/trinodb/trino/pull/6067#discussion_r529477617", "createdAt": "2020-11-24T11:34:24Z", "author": {"login": "kokosing"}, "path": "presto-base-jdbc/src/main/java/io/prestosql/plugin/jdbc/CachingJdbcClient.java", "diffHunk": "@@ -107,7 +107,7 @@ public boolean schemaExists(JdbcIdentity identity, String schema)\n             return tableHandle.getColumns().get();", "state": "SUBMITTED", "replyTo": null, "originalCommit": null, "originalPosition": 49}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMTIxMTY2Mg==", "bodyText": "I'm not sure but most probably this comment is outdated and implemented.", "url": "https://github.com/trinodb/trino/pull/6067#discussion_r531211662", "createdAt": "2020-11-26T20:14:45Z", "author": {"login": "ssheikin"}, "path": "presto-base-jdbc/src/main/java/io/prestosql/plugin/jdbc/CachingJdbcClient.java", "diffHunk": "@@ -107,7 +107,7 @@ public boolean schemaExists(JdbcIdentity identity, String schema)\n             return tableHandle.getColumns().get();", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyOTQ3NzYxNw=="}, "originalCommit": null, "originalPosition": 49}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzMyMDYzODQ3OnYy", "diffSide": "RIGHT", "path": "presto-base-jdbc/src/main/java/io/prestosql/plugin/jdbc/BaseJdbcClient.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0yNFQxMTozNToxN1rOH48yIg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0yNlQxOToyODozN1rOH6l24w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyOTQ3ODE3OA==", "bodyText": "Do you think it make sense to divide this commit into two? One for jdbc client and other for connection factory?", "url": "https://github.com/trinodb/trino/pull/6067#discussion_r529478178", "createdAt": "2020-11-24T11:35:17Z", "author": {"login": "kokosing"}, "path": "presto-base-jdbc/src/main/java/io/prestosql/plugin/jdbc/BaseJdbcClient.java", "diffHunk": "@@ -167,9 +167,9 @@ public BaseJdbcClient(\n     }", "state": "SUBMITTED", "replyTo": null, "originalCommit": null, "originalPosition": 1}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMTE5OTcxNQ==", "bodyText": "jdbc changes are addressed here:\n#6078\nhttps://github.com/zaz968m/presto/pull/2/files", "url": "https://github.com/trinodb/trino/pull/6067#discussion_r531199715", "createdAt": "2020-11-26T19:28:37Z", "author": {"login": "ssheikin"}, "path": "presto-base-jdbc/src/main/java/io/prestosql/plugin/jdbc/BaseJdbcClient.java", "diffHunk": "@@ -167,9 +167,9 @@ public BaseJdbcClient(\n     }", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyOTQ3ODE3OA=="}, "originalCommit": null, "originalPosition": 1}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4628, "cost": 1, "resetAt": "2021-11-12T12:57:47Z"}}}