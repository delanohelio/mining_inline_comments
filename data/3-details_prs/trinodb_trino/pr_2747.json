{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0MzcxODQxODQ3", "number": 2747, "title": "Keep tailing containers output in Launcher `env up`", "bodyText": "", "createdAt": "2020-02-06T11:12:17Z", "url": "https://github.com/trinodb/trino/pull/2747", "merged": true, "mergeCommit": {"oid": "2324f32bc81f8f3a363293abf940c0671543a346"}, "closed": true, "closedAt": "2020-02-10T11:16:52Z", "author": {"login": "findepi"}, "timelineItems": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcB99qXAFqTM1NTEwNjAxNg==", "endCursor": "Y3Vyc29yOnYyOpPPAAABcCvNIsgBqjMwMjA4ODIzNzQ=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzU1MTA2MDE2", "url": "https://github.com/trinodb/trino/pull/2747#pullrequestreview-355106016", "createdAt": "2020-02-07T11:51:34Z", "commit": null, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0wN1QxMTo1MTozNFrOFm6wCg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0wN1QxMTo1MTozNFrOFm6wCg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NjM1Mjc3OA==", "bodyText": "EnvironmentUpOptions", "url": "https://github.com/trinodb/trino/pull/2747#discussion_r376352778", "createdAt": "2020-02-07T11:51:34Z", "author": {"login": "findepi"}, "path": "presto-product-tests-launcher/src/main/java/io/prestosql/tests/product/launcher/cli/EnvironmentUp.java", "diffHunk": "@@ -60,21 +64,37 @@ public void run()\n                         .add(new LauncherModule())\n                         .add(new EnvironmentModule(additionalEnvironments))\n                         .add(environmentOptions.toModule())\n+                        .add(envUpOptions.toModule())\n                         .build(),\n                 EnvironmentUp.Execution.class);\n     }\n \n+    public static class EnvUpOptions", "state": "SUBMITTED", "replyTo": null, "originalCommit": null, "originalPosition": 43}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzU1MjUyODEz", "url": "https://github.com/trinodb/trino/pull/2747#pullrequestreview-355252813", "createdAt": "2020-02-07T15:52:07Z", "commit": null, "state": "APPROVED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0wN1QxNTo1MjowN1rOFnBlcQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0wN1QxNTo1MjowN1rOFnBlcQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NjQ2NDc1Mw==", "bodyText": "you didn't save much. Saving the flag would require less typing and nobody would ask for a comment ;)", "url": "https://github.com/trinodb/trino/pull/2747#discussion_r376464753", "createdAt": "2020-02-07T15:52:07Z", "author": {"login": "kokosing"}, "path": "presto-product-tests-launcher/src/main/java/io/prestosql/tests/product/launcher/cli/EnvironmentUp.java", "diffHunk": "@@ -96,13 +116,38 @@ public void run()\n             environment.start();\n             log.info(\"Environment '%s' started\", selectedEnvironmentProvider.getEnvironmentName());\n \n+            if (background) {\n+                killContainersReaperContainer();\n+                return;\n+            }\n+\n+            sleepUntilInterrupted();\n+            log.info(\"Exiting, the containers will exit too\");\n+        }\n+\n+        private void killContainersReaperContainer()\n+        {\n             try (DockerClient dockerClient = DockerClientFactory.lazyClient()) {\n                 log.info(\"Killing the testcontainers reaper container (Ryuk) so that environment can stay alive\");\n-                killContainersReaperContainer(dockerClient);\n+                TestcontainersUtil.killContainersReaperContainer(dockerClient);\n             }\n             catch (IOException e) {\n                 throw new UncheckedIOException(e);\n             }\n         }\n+\n+        private void sleepUntilInterrupted()\n+        {\n+            try {\n+                //noinspection InfiniteLoopStatement\n+                while (true) {\n+                    Thread.sleep(Long.MAX_VALUE);\n+                }\n+            }\n+            catch (InterruptedException e) {\n+                log.info(\"Interrupted\");\n+                // It's OK not to restore interrupt flag here. When we return we're exiting the process.", "state": "SUBMITTED", "replyTo": null, "originalCommit": null, "originalPosition": 108}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": null, "afterCommit": null}, {"__typename": "PullRequestCommit", "commit": {"oid": "cd226eaef57b0e65c54cc5be9b385700f1f2da11", "author": {"user": {"login": "findepi", "name": "Piotr Findeisen"}}, "url": "https://github.com/trinodb/trino/commit/cd226eaef57b0e65c54cc5be9b385700f1f2da11", "committedDate": "2020-02-09T21:13:43Z", "message": "Keep tailing containers output in Launcher `env up`"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": null, "afterCommit": {"oid": "cd226eaef57b0e65c54cc5be9b385700f1f2da11", "author": {"user": {"login": "findepi", "name": "Piotr Findeisen"}}, "url": "https://github.com/trinodb/trino/commit/cd226eaef57b0e65c54cc5be9b385700f1f2da11", "committedDate": "2020-02-09T21:13:43Z", "message": "Keep tailing containers output in Launcher `env up`"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1646, "cost": 1, "resetAt": "2021-10-28T20:13:43Z"}}}