{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0Mzg4NjI2NTcw", "number": 3100, "title": "Refactor toCompactTupleDomain to reuse Domain#simplify", "bodyText": "Changed Domain#simplify to avoid constructing new objects to get size of Ranges or DiscreteValues", "createdAt": "2020-03-15T08:25:46Z", "url": "https://github.com/trinodb/trino/pull/3100", "merged": true, "mergeCommit": {"oid": "c683e77e53435416ada5db11e3187203cb2f7951"}, "closed": true, "closedAt": "2020-03-18T13:12:24Z", "author": {"login": "raunaqmorarka"}, "timelineItems": {"totalCount": 8, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcOKyznAFqTM3NTAzOTc4Mg==", "endCursor": "Y3Vyc29yOnYyOpPPAAABcO00t6ABqjMxNDA4NjI2MDA=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzc1MDM5Nzgy", "url": "https://github.com/trinodb/trino/pull/3100#pullrequestreview-375039782", "createdAt": "2020-03-16T09:33:49Z", "commit": null, "state": "APPROVED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xNlQwOTozMzo0OVrOF2r0Hw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xNlQwOTozMzo0OVrOF2r0Hw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5Mjg4NTI3OQ==", "bodyText": "inline compactDomain", "url": "https://github.com/trinodb/trino/pull/3100#discussion_r392885279", "createdAt": "2020-03-16T09:33:49Z", "author": {"login": "sopel39"}, "path": "presto-hive/src/main/java/io/prestosql/plugin/hive/HivePartitionManager.java", "diffHunk": "@@ -243,14 +242,8 @@ public HiveTableHandle applyPartitionResult(HiveTableHandle handle, HivePartitio\n         effectivePredicate.getDomains().ifPresent(domains -> {\n             for (Map.Entry<ColumnHandle, Domain> entry : domains.entrySet()) {\n                 HiveColumnHandle hiveColumnHandle = (HiveColumnHandle) entry.getKey();\n-\n-                ValueSet values = entry.getValue().getValues();\n-                ValueSet compactValueSet = values.getValuesProcessor().<Optional<ValueSet>>transform(\n-                        ranges -> ranges.getRangeCount() > threshold ? Optional.of(ValueSet.ofRanges(ranges.getSpan())) : Optional.empty(),\n-                        discreteValues -> discreteValues.getValues().size() > threshold ? Optional.of(ValueSet.all(values.getType())) : Optional.empty(),\n-                        allOrNone -> Optional.empty())\n-                        .orElse(values);\n-                builder.put(hiveColumnHandle, Domain.create(compactValueSet, entry.getValue().isNullAllowed()));\n+                Domain compactDomain = entry.getValue().simplify(threshold);", "state": "SUBMITTED", "replyTo": null, "originalCommit": null, "originalPosition": 20}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": null, "afterCommit": null}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": null, "afterCommit": null}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzc1OTA4NDkw", "url": "https://github.com/trinodb/trino/pull/3100#pullrequestreview-375908490", "createdAt": "2020-03-17T10:29:05Z", "commit": null, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xN1QxMDoyOTowNVrOF3WMMQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xN1QxMDoyOTowNVrOF3WMMQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MzU3OTU2OQ==", "bodyText": "commit message is too long.\n\nChanged Domain#simplify to avoid constructing new objects to get size of Ranges or DiscreteValues\n\nHow do you avoid creating new objects?", "url": "https://github.com/trinodb/trino/pull/3100#discussion_r393579569", "createdAt": "2020-03-17T10:29:05Z", "author": {"login": "sopel39"}, "path": "presto-hive/src/main/java/io/prestosql/plugin/hive/HivePartitionManager.java", "diffHunk": "@@ -34,7 +34,6 @@\n import io.prestosql.spi.predicate.Domain;", "state": "SUBMITTED", "replyTo": null, "originalCommit": null, "originalPosition": 1}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": null, "afterCommit": null}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": null, "afterCommit": null}, {"__typename": "PullRequestCommit", "commit": {"oid": "c3658cc198f3324fa9bd8c1866ec1d042793c84c", "author": {"user": {"login": "raunaqmorarka", "name": "Raunaq Morarka"}}, "url": "https://github.com/trinodb/trino/commit/c3658cc198f3324fa9bd8c1866ec1d042793c84c", "committedDate": "2020-03-18T10:33:25Z", "message": "Refactor toCompactTupleDomain to reuse Domain#simplify\n\nChanged Domain#simplify to avoid copying internal structures to get size of Ranges or DiscreteValues"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": null, "afterCommit": {"oid": "c3658cc198f3324fa9bd8c1866ec1d042793c84c", "author": {"user": {"login": "raunaqmorarka", "name": "Raunaq Morarka"}}, "url": "https://github.com/trinodb/trino/commit/c3658cc198f3324fa9bd8c1866ec1d042793c84c", "committedDate": "2020-03-18T10:33:25Z", "message": "Refactor toCompactTupleDomain to reuse Domain#simplify\n\nChanged Domain#simplify to avoid copying internal structures to get size of Ranges or DiscreteValues"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1563, "cost": 1, "resetAt": "2021-10-28T20:13:43Z"}}}