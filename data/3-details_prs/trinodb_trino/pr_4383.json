{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDQ1OTUwMjQ3", "number": 4383, "title": "Fix failure for IN expression in join criteria", "bodyText": "The planner was making a decision of whether to plan the subquery on the\nleft or right depending on whether all the columns in the expression\ncould be satisfied by either side. However, it was not excluding\ncolumns in the subquery.\nFixes #4380", "createdAt": "2020-07-08T04:36:44Z", "url": "https://github.com/trinodb/trino/pull/4383", "merged": true, "mergeCommit": {"oid": "274379cd5baabf1e6139e338c31927af8f34bff5"}, "closed": true, "closedAt": "2020-07-08T14:32:49Z", "author": {"login": "martint"}, "timelineItems": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcyy1IdgH2gAyNDQ1OTUwMjQ3OmNhY2ZlMWRjZjFkMDE3YjVkYTU5MGM1OWUyMDNjYTAyNzM5ODBjZjU=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcy7WAiAFqTQ0NDgyNTU4Mw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "cacfe1dcf1d017b5da590c59e203ca0273980cf5", "author": {"user": {"login": "martint", "name": "Martin Traverso"}}, "url": "https://github.com/trinodb/trino/commit/cacfe1dcf1d017b5da590c59e203ca0273980cf5", "committedDate": "2020-07-08T04:35:35Z", "message": "Fix failure for IN expression in join criteria\n\nThe planner was making a decision of whether to plan the subquery on the\nleft or right depending on whether all the columns in the expression\ncould be satisfied by either side. However, it was not excluding\ncolumns in the subquery."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDQ0NTI1NTA2", "url": "https://github.com/trinodb/trino/pull/4383#pullrequestreview-444525506", "createdAt": "2020-07-08T08:31:43Z", "commit": {"oid": "cacfe1dcf1d017b5da590c59e203ca0273980cf5"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDQ0NTg3MzIy", "url": "https://github.com/trinodb/trino/pull/4383#pullrequestreview-444587322", "createdAt": "2020-07-08T09:50:12Z", "commit": {"oid": "cacfe1dcf1d017b5da590c59e203ca0273980cf5"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wOFQwOTo1MDoxMlrOGuglPQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wOFQwOTo1MDoxMlrOGuglPQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MTQyMTUwMQ==", "bodyText": "what if there is a reference to outer column within subquery?", "url": "https://github.com/trinodb/trino/pull/4383#discussion_r451421501", "createdAt": "2020-07-08T09:50:12Z", "author": {"login": "sopel39"}, "path": "presto-main/src/main/java/io/prestosql/sql/planner/SymbolsExtractor.java", "diffHunk": "@@ -181,5 +191,15 @@ protected Void visitIdentifier(Identifier node, ImmutableSet.Builder<QualifiedNa\n             builder.add(QualifiedName.of(node.getValue()));\n             return null;\n         }\n+\n+        @Override\n+        protected Void visitSubqueryExpression(SubqueryExpression node, ImmutableSet.Builder<QualifiedName> context)", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "cacfe1dcf1d017b5da590c59e203ca0273980cf5"}, "originalPosition": 44}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDQ0Njk2ODU4", "url": "https://github.com/trinodb/trino/pull/4383#pullrequestreview-444696858", "createdAt": "2020-07-08T12:07:13Z", "commit": {"oid": "cacfe1dcf1d017b5da590c59e203ca0273980cf5"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wOFQxMjowNzoxM1rOGuk0rg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wOFQxMjowNzoxM1rOGuk0rg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MTQ5MDk5MA==", "bodyText": "consider using io.prestosql.sql.util.AstUtils#preOrder instead of DefaultExpressionTraversalVisitor", "url": "https://github.com/trinodb/trino/pull/4383#discussion_r451490990", "createdAt": "2020-07-08T12:07:13Z", "author": {"login": "kokosing"}, "path": "presto-main/src/main/java/io/prestosql/sql/planner/SymbolsExtractor.java", "diffHunk": "@@ -124,7 +125,14 @@ private SymbolsExtractor() {}\n     public static Set<QualifiedName> extractNames(Expression expression, Set<NodeRef<Expression>> columnReferences)\n     {\n         ImmutableSet.Builder<QualifiedName> builder = ImmutableSet.builder();\n-        new QualifiedNameBuilderVisitor(columnReferences).process(expression, builder);\n+        new QualifiedNameBuilderVisitor(columnReferences, true).process(expression, builder);\n+        return builder.build();\n+    }\n+\n+    public static Set<QualifiedName> extractNamesNoSubqueries(Expression expression, Set<NodeRef<Expression>> columnReferences)\n+    {\n+        ImmutableSet.Builder<QualifiedName> builder = ImmutableSet.builder();\n+        new QualifiedNameBuilderVisitor(columnReferences, false).process(expression, builder);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "cacfe1dcf1d017b5da590c59e203ca0273980cf5"}, "originalPosition": 20}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDQ0ODI1NTgz", "url": "https://github.com/trinodb/trino/pull/4383#pullrequestreview-444825583", "createdAt": "2020-07-08T14:30:44Z", "commit": {"oid": "cacfe1dcf1d017b5da590c59e203ca0273980cf5"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 5, "cost": 1, "resetAt": "2021-10-28T19:08:13Z"}}}