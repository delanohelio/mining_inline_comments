{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDgyMjk3Nzk2", "number": 5106, "title": "Fix Iceberg temporal transforms", "bodyText": "", "createdAt": "2020-09-08T21:08:42Z", "url": "https://github.com/trinodb/trino/pull/5106", "merged": true, "mergeCommit": {"oid": "c07f0b34ed727c90bb46da28f9a9786629455082"}, "closed": true, "closedAt": "2020-09-08T23:44:36Z", "author": {"login": "electrum"}, "timelineItems": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdG-tFEAFqTQ4NDUxMTM2OA==", "endCursor": "Y3Vyc29yOnYyOpPPAAABdHAbTwABqjM3NDMyMzExNjU=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDg0NTExMzY4", "url": "https://github.com/trinodb/trino/pull/5106#pullrequestreview-484511368", "createdAt": "2020-09-08T21:40:15Z", "commit": null, "state": "APPROVED", "comments": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wOFQyMTo0MDoxNVrOHOu9Aw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wOFQyMTo0MzowNFrOHOvB2w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NTIxMTM5NQ==", "bodyText": "epochYear?", "url": "https://github.com/trinodb/trino/pull/5106#discussion_r485211395", "createdAt": "2020-09-08T21:40:15Z", "author": {"login": "martint"}, "path": "presto-iceberg/src/main/java/io/prestosql/plugin/iceberg/PartitionTransforms.java", "diffHunk": "@@ -492,6 +492,30 @@ private static Block truncateVarbinary(Block block, int max)\n         return builder.build();\n     }\n \n+    @VisibleForTesting\n+    static long yearsEpoch(long millis)", "state": "SUBMITTED", "replyTo": null, "originalCommit": null, "originalPosition": 114}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NTIxMTUwMA==", "bodyText": "epochMonth?", "url": "https://github.com/trinodb/trino/pull/5106#discussion_r485211500", "createdAt": "2020-09-08T21:40:28Z", "author": {"login": "martint"}, "path": "presto-iceberg/src/main/java/io/prestosql/plugin/iceberg/PartitionTransforms.java", "diffHunk": "@@ -492,6 +492,30 @@ private static Block truncateVarbinary(Block block, int max)\n         return builder.build();\n     }\n \n+    @VisibleForTesting\n+    static long yearsEpoch(long millis)\n+    {\n+        return YEAR_FIELD.get(millis) - 1970;\n+    }\n+\n+    @VisibleForTesting\n+    static long monthsEpoch(long millis)", "state": "SUBMITTED", "replyTo": null, "originalCommit": null, "originalPosition": 120}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NTIxMjM0NQ==", "bodyText": "epochDay?", "url": "https://github.com/trinodb/trino/pull/5106#discussion_r485212345", "createdAt": "2020-09-08T21:42:24Z", "author": {"login": "martint"}, "path": "presto-iceberg/src/main/java/io/prestosql/plugin/iceberg/PartitionTransforms.java", "diffHunk": "@@ -492,6 +492,30 @@ private static Block truncateVarbinary(Block block, int max)\n         return builder.build();\n     }\n \n+    @VisibleForTesting\n+    static long yearsEpoch(long millis)\n+    {\n+        return YEAR_FIELD.get(millis) - 1970;\n+    }\n+\n+    @VisibleForTesting\n+    static long monthsEpoch(long millis)\n+    {\n+        long year = yearsEpoch(millis);\n+        int month = MONTH_FIELD.get(millis) - 1;\n+        return (year * 12) + month;\n+    }\n+\n+    private static long daysEpoch(long millis)", "state": "SUBMITTED", "replyTo": null, "originalCommit": null, "originalPosition": 127}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NTIxMjQwMA==", "bodyText": "epochHour?", "url": "https://github.com/trinodb/trino/pull/5106#discussion_r485212400", "createdAt": "2020-09-08T21:42:31Z", "author": {"login": "martint"}, "path": "presto-iceberg/src/main/java/io/prestosql/plugin/iceberg/PartitionTransforms.java", "diffHunk": "@@ -492,6 +492,30 @@ private static Block truncateVarbinary(Block block, int max)\n         return builder.build();\n     }\n \n+    @VisibleForTesting\n+    static long yearsEpoch(long millis)\n+    {\n+        return YEAR_FIELD.get(millis) - 1970;\n+    }\n+\n+    @VisibleForTesting\n+    static long monthsEpoch(long millis)\n+    {\n+        long year = yearsEpoch(millis);\n+        int month = MONTH_FIELD.get(millis) - 1;\n+        return (year * 12) + month;\n+    }\n+\n+    private static long daysEpoch(long millis)\n+    {\n+        return floorDiv(millis, MILLISECONDS_PER_DAY);\n+    }\n+\n+    private static long hoursEpoch(long millis)", "state": "SUBMITTED", "replyTo": null, "originalCommit": null, "originalPosition": 132}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NTIxMjYzNQ==", "bodyText": "Also, I'd rename the argument to epochMilli for clarity.", "url": "https://github.com/trinodb/trino/pull/5106#discussion_r485212635", "createdAt": "2020-09-08T21:43:04Z", "author": {"login": "martint"}, "path": "presto-iceberg/src/main/java/io/prestosql/plugin/iceberg/PartitionTransforms.java", "diffHunk": "@@ -492,6 +492,30 @@ private static Block truncateVarbinary(Block block, int max)\n         return builder.build();\n     }\n \n+    @VisibleForTesting\n+    static long yearsEpoch(long millis)", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NTIxMTM5NQ=="}, "originalCommit": null, "originalPosition": 114}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "cf9ea5d5d6d94dd37c10a88c63574393189131ba", "author": {"user": {"login": "electrum", "name": "David Phillips"}}, "url": "https://github.com/trinodb/trino/commit/cf9ea5d5d6d94dd37c10a88c63574393189131ba", "committedDate": "2020-09-08T23:44:27Z", "message": "Add additional millseconds constants"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "1ec1e656c1af646ac57ac9027383285ea35cc005", "author": {"user": {"login": "electrum", "name": "David Phillips"}}, "url": "https://github.com/trinodb/trino/commit/1ec1e656c1af646ac57ac9027383285ea35cc005", "committedDate": "2020-09-08T23:44:27Z", "message": "Remove leftover debug logging"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c07f0b34ed727c90bb46da28f9a9786629455082", "author": {"user": {"login": "electrum", "name": "David Phillips"}}, "url": "https://github.com/trinodb/trino/commit/c07f0b34ed727c90bb46da28f9a9786629455082", "committedDate": "2020-09-08T23:44:28Z", "message": "Fix Iceberg temporal transforms"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": null, "afterCommit": {"oid": "c07f0b34ed727c90bb46da28f9a9786629455082", "author": {"user": {"login": "electrum", "name": "David Phillips"}}, "url": "https://github.com/trinodb/trino/commit/c07f0b34ed727c90bb46da28f9a9786629455082", "committedDate": "2020-09-08T23:44:28Z", "message": "Fix Iceberg temporal transforms"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3925, "cost": 1, "resetAt": "2021-10-28T20:13:43Z"}}}