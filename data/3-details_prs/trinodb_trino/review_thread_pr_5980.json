{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTIxNzg4MjM0", "number": 5980, "reviewThreads": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xNlQyMToxMDoyNVrOE5rkEA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xNlQyMToxMTozMlrOE5rmpg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzI4OTE4MDMyOnYy", "diffSide": "LEFT", "path": "presto-product-tests/src/main/java/io/prestosql/tests/hive/TestHiveViews.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xNlQyMToxMDoyNVrOH0SGMw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xNlQyMjoyNTo1MFrOH0XzWg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNDU4NDQ5OQ==", "bodyText": "Why do you remove it? You are using nation table so it should be somehow provisioned. I guess in your case it was provisioned for other test.", "url": "https://github.com/trinodb/trino/pull/5980#discussion_r524584499", "createdAt": "2020-11-16T21:10:25Z", "author": {"login": "kokosing"}, "path": "presto-product-tests/src/main/java/io/prestosql/tests/hive/TestHiveViews.java", "diffHunk": "@@ -13,37 +13,34 @@\n  */\n package io.prestosql.tests.hive;\n \n-import io.prestosql.tempto.Requirement;\n-import io.prestosql.tempto.RequirementsProvider;\n+import io.prestosql.tempto.Requires;\n import io.prestosql.tempto.assertions.QueryAssert;\n-import io.prestosql.tempto.configuration.Configuration;\n+import io.prestosql.tempto.fulfillment.table.hive.tpch.ImmutableTpchTablesRequirements.ImmutableNationTable;\n+import io.prestosql.tempto.fulfillment.table.hive.tpch.ImmutableTpchTablesRequirements.ImmutableOrdersTable;\n import io.prestosql.tempto.query.QueryResult;\n import org.testng.annotations.Test;\n \n import java.math.BigDecimal;\n+import java.sql.Date;\n+import java.time.LocalDate;\n import java.util.function.Consumer;\n \n import static io.prestosql.tempto.assertions.QueryAssert.Row.row;\n import static io.prestosql.tempto.assertions.QueryAssert.assertThat;\n-import static io.prestosql.tempto.fulfillment.table.TableRequirements.immutableTable;\n-import static io.prestosql.tempto.fulfillment.table.hive.tpch.TpchTableDefinitions.NATION;\n import static io.prestosql.tempto.query.QueryExecutor.query;\n import static io.prestosql.tests.TestGroups.HIVE_VIEWS;\n import static io.prestosql.tests.utils.QueryExecutors.onHive;\n import static io.prestosql.tests.utils.QueryExecutors.onPresto;\n import static java.lang.String.format;\n import static org.testng.Assert.assertEquals;\n \n+@Requires({\n+        ImmutableNationTable.class,\n+        ImmutableOrdersTable.class,\n+})\n public class TestHiveViews\n         extends HiveProductTest\n-        implements RequirementsProvider\n {\n-    @Override\n-    public Requirement getRequirements(Configuration configuration)\n-    {\n-        return immutableTable(NATION);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "be4e463119cd254a62a1e3faecade3a389172814"}, "originalPosition": 41}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNDY3Nzk3OA==", "bodyText": "it's provided with a class-level annotation now", "url": "https://github.com/trinodb/trino/pull/5980#discussion_r524677978", "createdAt": "2020-11-16T22:25:50Z", "author": {"login": "findepi"}, "path": "presto-product-tests/src/main/java/io/prestosql/tests/hive/TestHiveViews.java", "diffHunk": "@@ -13,37 +13,34 @@\n  */\n package io.prestosql.tests.hive;\n \n-import io.prestosql.tempto.Requirement;\n-import io.prestosql.tempto.RequirementsProvider;\n+import io.prestosql.tempto.Requires;\n import io.prestosql.tempto.assertions.QueryAssert;\n-import io.prestosql.tempto.configuration.Configuration;\n+import io.prestosql.tempto.fulfillment.table.hive.tpch.ImmutableTpchTablesRequirements.ImmutableNationTable;\n+import io.prestosql.tempto.fulfillment.table.hive.tpch.ImmutableTpchTablesRequirements.ImmutableOrdersTable;\n import io.prestosql.tempto.query.QueryResult;\n import org.testng.annotations.Test;\n \n import java.math.BigDecimal;\n+import java.sql.Date;\n+import java.time.LocalDate;\n import java.util.function.Consumer;\n \n import static io.prestosql.tempto.assertions.QueryAssert.Row.row;\n import static io.prestosql.tempto.assertions.QueryAssert.assertThat;\n-import static io.prestosql.tempto.fulfillment.table.TableRequirements.immutableTable;\n-import static io.prestosql.tempto.fulfillment.table.hive.tpch.TpchTableDefinitions.NATION;\n import static io.prestosql.tempto.query.QueryExecutor.query;\n import static io.prestosql.tests.TestGroups.HIVE_VIEWS;\n import static io.prestosql.tests.utils.QueryExecutors.onHive;\n import static io.prestosql.tests.utils.QueryExecutors.onPresto;\n import static java.lang.String.format;\n import static org.testng.Assert.assertEquals;\n \n+@Requires({\n+        ImmutableNationTable.class,\n+        ImmutableOrdersTable.class,\n+})\n public class TestHiveViews\n         extends HiveProductTest\n-        implements RequirementsProvider\n {\n-    @Override\n-    public Requirement getRequirements(Configuration configuration)\n-    {\n-        return immutableTable(NATION);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNDU4NDQ5OQ=="}, "originalCommit": {"oid": "be4e463119cd254a62a1e3faecade3a389172814"}, "originalPosition": 41}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzI4OTE4NDAwOnYy", "diffSide": "RIGHT", "path": "presto-product-tests/src/main/java/io/prestosql/tests/hive/TestHiveViews.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xNlQyMToxMTowMVrOH0SIpA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xNlQyMjoyNzowMlrOH0X3rg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNDU4NTEyNA==", "bodyText": "It would be nice to have #4510 implemented so we can have coverage as integration test.", "url": "https://github.com/trinodb/trino/pull/5980#discussion_r524585124", "createdAt": "2020-11-16T21:11:01Z", "author": {"login": "kokosing"}, "path": "presto-product-tests/src/main/java/io/prestosql/tests/hive/TestHiveViews.java", "diffHunk": "@@ -13,37 +13,34 @@\n  */", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "be4e463119cd254a62a1e3faecade3a389172814"}, "originalPosition": 1}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNDY3OTA4Ng==", "bodyText": "Yes, but this i'd still want to have product tests, as they allow me to cross-check results between Presto and Hive, especially because of subtleties like #5978", "url": "https://github.com/trinodb/trino/pull/5980#discussion_r524679086", "createdAt": "2020-11-16T22:27:02Z", "author": {"login": "findepi"}, "path": "presto-product-tests/src/main/java/io/prestosql/tests/hive/TestHiveViews.java", "diffHunk": "@@ -13,37 +13,34 @@\n  */", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNDU4NTEyNA=="}, "originalCommit": {"oid": "be4e463119cd254a62a1e3faecade3a389172814"}, "originalPosition": 1}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzI4OTE4Njk0OnYy", "diffSide": "RIGHT", "path": "presto-product-tests/src/main/java/io/prestosql/tests/hive/TestHiveViews.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xNlQyMToxMTozMlrOH0SKww==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xNlQyMjoyNzo0MVrOH0X6VQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNDU4NTY2Nw==", "bodyText": "same comment as previously, it would be nice to have single test per case", "url": "https://github.com/trinodb/trino/pull/5980#discussion_r524585667", "createdAt": "2020-11-16T21:11:32Z", "author": {"login": "kokosing"}, "path": "presto-product-tests/src/main/java/io/prestosql/tests/hive/TestHiveViews.java", "diffHunk": "@@ -172,19 +169,24 @@ public void testRichSqlSyntax()\n                 \"   CASE WHEN n_name = \\\"BRAZIL\\\" THEN 'is BRAZIL' WHEN n_name = \\\"ALGERIA\\\" THEN 'is ALGERIA' ELSE \\\"\\\" END is_something,\\n\" + // searched CASE, double quote string literals\n                 \"   COALESCE(IF(n_name LIKE 'A%', NULL, n_name), 'A%') AS coalesced_name, \\n\" + // coalesce\n                 \"   round(tan(n_nationkey), 3) AS rounded_tan, \\n\" + // functions\n+                \"   o_orderdate AS the_orderdate, \\n\" +\n                 \"   `n`.`n_nationkey` + `n_nationkey` + n.n_nationkey + n_nationkey + 10000 - -1 AS arithmetic--some comment without leading space \\n\" +\n-                \"FROM `default`.`nation` AS `n`\");\n+                \"FROM `default`.`nation` AS `n` \\n\" +\n+                // join, subquery\n+                \"LEFT JOIN (SELECT * FROM orders WHERE o_custkey > 1000) `o` ON `o`.`o_orderkey` = `n`.`n_nationkey` \");", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "be4e463119cd254a62a1e3faecade3a389172814"}, "originalPosition": 56}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNDY3OTc2NQ==", "bodyText": "You can give it a try. I did not because i strngly believe this would take prohibitively long time", "url": "https://github.com/trinodb/trino/pull/5980#discussion_r524679765", "createdAt": "2020-11-16T22:27:41Z", "author": {"login": "findepi"}, "path": "presto-product-tests/src/main/java/io/prestosql/tests/hive/TestHiveViews.java", "diffHunk": "@@ -172,19 +169,24 @@ public void testRichSqlSyntax()\n                 \"   CASE WHEN n_name = \\\"BRAZIL\\\" THEN 'is BRAZIL' WHEN n_name = \\\"ALGERIA\\\" THEN 'is ALGERIA' ELSE \\\"\\\" END is_something,\\n\" + // searched CASE, double quote string literals\n                 \"   COALESCE(IF(n_name LIKE 'A%', NULL, n_name), 'A%') AS coalesced_name, \\n\" + // coalesce\n                 \"   round(tan(n_nationkey), 3) AS rounded_tan, \\n\" + // functions\n+                \"   o_orderdate AS the_orderdate, \\n\" +\n                 \"   `n`.`n_nationkey` + `n_nationkey` + n.n_nationkey + n_nationkey + 10000 - -1 AS arithmetic--some comment without leading space \\n\" +\n-                \"FROM `default`.`nation` AS `n`\");\n+                \"FROM `default`.`nation` AS `n` \\n\" +\n+                // join, subquery\n+                \"LEFT JOIN (SELECT * FROM orders WHERE o_custkey > 1000) `o` ON `o`.`o_orderkey` = `n`.`n_nationkey` \");", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNDU4NTY2Nw=="}, "originalCommit": {"oid": "be4e463119cd254a62a1e3faecade3a389172814"}, "originalPosition": 56}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4798, "cost": 1, "resetAt": "2021-11-12T12:57:47Z"}}}