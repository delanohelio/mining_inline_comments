{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDg2MTMxOTYz", "number": 5150, "title": "Support pushdown for date, tinyint and smallint types in Cassandra", "bodyText": "Fixes #3763 Supersedes #3796\nUnfortunately, there was no response for a month even on Slack, but some people have waited the merging.", "createdAt": "2020-09-13T05:27:23Z", "url": "https://github.com/trinodb/trino/pull/5150", "merged": true, "mergeCommit": {"oid": "14790ce6adcabb8fe4e69bb80a111b4079c8d4ae"}, "closed": true, "closedAt": "2021-08-17T13:28:29Z", "author": {"login": "ebyhr"}, "timelineItems": {"totalCount": 6, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdIYeuvgBqjM3NjAxNDQyNzc=", "endCursor": "Y3Vyc29yOnYyOpPPAAABe0_DWsAFqTczMDg5OTczNQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "HeadRefForcePushedEvent", "beforeCommit": null, "afterCommit": null}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDg3NDk1NzI2", "url": "https://github.com/trinodb/trino/pull/5150#pullrequestreview-487495726", "createdAt": "2020-09-14T07:43:17Z", "commit": null, "state": "COMMENTED", "comments": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xNFQwNzo0MzoxN1rOHRHpEQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xNFQwNzo0ODowMlrOHRHzNA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NzcxMzA0MQ==", "bodyText": "prestoNativeValue for date will be number of days since epoch\nin the getColumnValueForCql(Row row, int position) above we use yyyy-mm-dd representation\ncan we unify the two? if not, why would i quoteStringLiteral the number?", "url": "https://github.com/trinodb/trino/pull/5150#discussion_r487713041", "createdAt": "2020-09-14T07:43:17Z", "author": {"login": "findepi"}, "path": "presto-cassandra/src/main/java/io/prestosql/plugin/cassandra/CassandraType.java", "diffHunk": "@@ -334,6 +334,7 @@ public String toCqlLiteral(Object prestoNativeValue)\n             case ASCII:\n             case TEXT:\n             case VARCHAR:\n+            case DATE:", "state": "SUBMITTED", "replyTo": null, "originalCommit": null, "originalPosition": 13}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NzcxMzU3NA==", "bodyText": "i tend to put date before timestamp (\"simpler one first\")\nalso, would be nice to put all the inteer types together (TINYINT, SMALLINT, INT, BIGINT)", "url": "https://github.com/trinodb/trino/pull/5150#discussion_r487713574", "createdAt": "2020-09-14T07:44:17Z", "author": {"login": "findepi"}, "path": "presto-cassandra/src/main/java/io/prestosql/plugin/cassandra/CassandraType.java", "diffHunk": "@@ -441,9 +442,12 @@ public boolean isSupportedPartitionKey()\n             case DOUBLE:\n             case INET:\n             case INT:\n+            case SMALLINT:\n+            case TINYINT:\n             case FLOAT:\n             case DECIMAL:\n             case TIMESTAMP:\n+            case DATE:", "state": "SUBMITTED", "replyTo": null, "originalCommit": null, "originalPosition": 26}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NzcxNDQ4MQ==", "bodyText": "split this into 3 separate cases and apply validation on the cursor.getLong result using:\n\ncom.google.common.primitives.SignedBytes#checkedCast\ncom.google.common.primitives.Shorts#checkedCast\njava.lang.Math#toIntExact", "url": "https://github.com/trinodb/trino/pull/5150#discussion_r487714481", "createdAt": "2020-09-14T07:45:56Z", "author": {"login": "findepi"}, "path": "presto-cassandra/src/test/java/io/prestosql/plugin/cassandra/TestCassandraConnector.java", "diffHunk": "@@ -213,7 +216,7 @@ private static void assertReadFields(RecordCursor cursor, List<ColumnMetadata> s\n                 if (BOOLEAN.equals(type)) {\n                     cursor.getBoolean(columnIndex);\n                 }\n-                else if (INTEGER.equals(type)) {\n+                else if (TINYINT.equals(type) || SMALLINT.equals(type) || INTEGER.equals(type)) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": null, "originalPosition": 24}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NzcxNTYzNg==", "bodyText": "Why would i call cursor.getSlice for a DATE value (backed by long, in 32-bit int range)?", "url": "https://github.com/trinodb/trino/pull/5150#discussion_r487715636", "createdAt": "2020-09-14T07:48:02Z", "author": {"login": "findepi"}, "path": "presto-cassandra/src/test/java/io/prestosql/plugin/cassandra/TestCassandraConnector.java", "diffHunk": "@@ -228,7 +231,7 @@ else if (DOUBLE.equals(type)) {\n                 else if (REAL.equals(type)) {\n                     cursor.getLong(columnIndex);\n                 }\n-                else if (isVarcharType(type) || VARBINARY.equals(type)) {\n+                else if (isVarcharType(type) || VARBINARY.equals(type) || DateType.DATE.equals(type)) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": null, "originalPosition": 33}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": null, "afterCommit": null}, {"__typename": "PullRequestCommit", "commit": {"oid": "bd42b069ae1179de4db284661d0a21e6236a0fa1", "author": {"user": {"login": "ebyhr", "name": "Yuya Ebihara"}}, "url": "https://github.com/trinodb/trino/commit/bd42b069ae1179de4db284661d0a21e6236a0fa1", "committedDate": "2021-08-16T13:10:49Z", "message": "Support pushdown for date, tinyint and smallint types in Cassandra"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": null, "afterCommit": {"oid": "bd42b069ae1179de4db284661d0a21e6236a0fa1", "author": {"user": {"login": "ebyhr", "name": "Yuya Ebihara"}}, "url": "https://github.com/trinodb/trino/commit/bd42b069ae1179de4db284661d0a21e6236a0fa1", "committedDate": "2021-08-16T13:10:49Z", "message": "Support pushdown for date, tinyint and smallint types in Cassandra"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NzMwODk5NzM1", "url": "https://github.com/trinodb/trino/pull/5150#pullrequestreview-730899735", "createdAt": "2021-08-16T16:16:17Z", "commit": {"oid": "bd42b069ae1179de4db284661d0a21e6236a0fa1"}, "state": "APPROVED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wOC0xNlQxNjoxNjoxN1rOKRudag==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wOC0xNlQxNjoxNjoxN1rOKRudag==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDY4OTY3NTYyNg==", "bodyText": "Seems like these two types already had the necessary code implemented?", "url": "https://github.com/trinodb/trino/pull/5150#discussion_r689675626", "createdAt": "2021-08-16T16:16:17Z", "author": {"login": "hashhar"}, "path": "plugin/trino-cassandra/src/main/java/io/trino/plugin/cassandra/CassandraType.java", "diffHunk": "@@ -443,8 +448,11 @@ public boolean isSupportedPartitionKey()\n             case DOUBLE:\n             case INET:\n             case INT:\n+            case TINYINT:\n+            case SMALLINT:", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "bd42b069ae1179de4db284661d0a21e6236a0fa1"}, "originalPosition": 33}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3969, "cost": 1, "resetAt": "2021-10-28T20:13:43Z"}}}