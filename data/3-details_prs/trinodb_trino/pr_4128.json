{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDM3NjIxMzI1", "number": 4128, "title": "Fix failure when aggregation contains quantified comparison", "bodyText": "The query fails with:\nQuery 20200621_235954_00000_gwqf5 failed: aggregation analysis not yet implemented for: io.prestosql.sql.tree.QuantifiedComparisonExpression\njava.lang.UnsupportedOperationException: aggregation analysis not yet implemented for: io.prestosql.sql.tree.QuantifiedComparisonExpression\n\tat io.prestosql.sql.analyzer.AggregationAnalyzer$Visitor.visitExpression(AggregationAnalyzer.java:178)\n\tat io.prestosql.sql.analyzer.AggregationAnalyzer$Visitor.visitExpression(AggregationAnalyzer.java:172)\n\tat io.prestosql.sql.tree.AstVisitor.visitQuantifiedComparisonExpression(AstVisitor.java:767)\n\tat io.prestosql.sql.tree.QuantifiedComparisonExpression.accept(QuantifiedComparisonExpression.java:81)\n\tat io.prestosql.sql.tree.AstVisitor.process(AstVisitor.java:27)\n\tat io.prestosql.sql.analyzer.AggregationAnalyzer$Visitor.process(AggregationAnalyzer.java:660)\n\tat io.prestosql.sql.analyzer.AggregationAnalyzer.analyze(AggregationAnalyzer.java:164)\n\tat io.prestosql.sql.analyzer.AggregationAnalyzer.verifySourceAggregations(AggregationAnalyzer.java:118)\n\tat io.prestosql.sql.analyzer.StatementAnalyzer$Visitor.analyzeAggregations(StatementAnalyzer.java:2377)\n\tat io.prestosql.sql.analyzer.StatementAnalyzer$Visitor.visitQuerySpecification(StatementAnalyzer.java:1329)\n\tat io.prestosql.sql.analyzer.StatementAnalyzer$Visitor.visitQuerySpecification(StatementAnalyzer.java:306)\n\tat io.prestosql.sql.tree.QuerySpecification.accept(QuerySpecification.java:144)\n\tat io.prestosql.sql.tree.AstVisitor.process(AstVisitor.java:27)\n\tat io.prestosql.sql.analyzer.StatementAnalyzer$Visitor.process(StatementAnalyzer.java:323)\n\tat io.prestosql.sql.analyzer.StatementAnalyzer$Visitor.process(StatementAnalyzer.java:333)\n\tat io.prestosql.sql.analyzer.StatementAnalyzer$Visitor.visitQuery(StatementAnalyzer.java:918)\n\tat io.prestosql.sql.analyzer.StatementAnalyzer$Visitor.visitQuery(StatementAnalyzer.java:306)\n\tat io.prestosql.sql.tree.Query.accept(Query.java:107)", "createdAt": "2020-06-22T00:15:58Z", "url": "https://github.com/trinodb/trino/pull/4128", "merged": true, "mergeCommit": {"oid": "25047be7db04153ebde1f52adbf76144e9cbe665"}, "closed": true, "closedAt": "2020-06-22T23:07:06Z", "author": {"login": "martint"}, "timelineItems": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABctrQPiAFqTQzNDY0Njk5Ng==", "endCursor": "Y3Vyc29yOnYyOpPPAAABct4BmFAFqTQzNTI5ODA0NA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDM0NjQ2OTk2", "url": "https://github.com/trinodb/trino/pull/4128#pullrequestreview-434646996", "createdAt": "2020-06-22T06:56:01Z", "commit": null, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yMlQwNjo1NjowMVrOGm0AKA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yMlQwNjo1NjowMVrOGm0AKA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MzM1MTA4MA==", "bodyText": "i think there could be a test exercising the subquery part", "url": "https://github.com/trinodb/trino/pull/4128#discussion_r443351080", "createdAt": "2020-06-22T06:56:01Z", "author": {"login": "findepi"}, "path": "presto-main/src/main/java/io/prestosql/sql/analyzer/AggregationAnalyzer.java", "diffHunk": "@@ -309,6 +310,12 @@ protected Boolean visitInPredicate(InPredicate node, Void context)\n             return process(node.getValue(), context) && process(node.getValueList(), context);\n         }\n \n+        @Override\n+        protected Boolean visitQuantifiedComparisonExpression(QuantifiedComparisonExpression node, Void context)\n+        {\n+            return process(node.getValue(), context) && process(node.getSubquery(), context);", "state": "SUBMITTED", "replyTo": null, "originalCommit": null, "originalPosition": 15}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDM0NjU5MzUx", "url": "https://github.com/trinodb/trino/pull/4128#pullrequestreview-434659351", "createdAt": "2020-06-22T07:17:59Z", "commit": null, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "0bac48e269b38e3f42fb093452f8eccecdc3af80", "author": {"user": {"login": "martint", "name": "Martin Traverso"}}, "url": "https://github.com/trinodb/trino/commit/0bac48e269b38e3f42fb093452f8eccecdc3af80", "committedDate": "2020-06-22T19:46:33Z", "message": "Fix failure when aggregation contains quantified comparison"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": null, "afterCommit": {"oid": "0bac48e269b38e3f42fb093452f8eccecdc3af80", "author": {"user": {"login": "martint", "name": "Martin Traverso"}}, "url": "https://github.com/trinodb/trino/commit/0bac48e269b38e3f42fb093452f8eccecdc3af80", "committedDate": "2020-06-22T19:46:33Z", "message": "Fix failure when aggregation contains quantified comparison"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDM1Mjk4MDQ0", "url": "https://github.com/trinodb/trino/pull/4128#pullrequestreview-435298044", "createdAt": "2020-06-22T21:49:06Z", "commit": {"oid": "0bac48e269b38e3f42fb093452f8eccecdc3af80"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 475, "cost": 1, "resetAt": "2021-10-28T19:08:13Z"}}}