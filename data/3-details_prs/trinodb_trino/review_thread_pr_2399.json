{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0MzU4OTU4MjI2", "number": 2399, "reviewThreads": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0wOVQwMDoyMjoxM1rODWtUSg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0wOVQwMDoyMjoxM1rODWtUSg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjI1MTM3NzM4OnYy", "diffSide": "RIGHT", "path": "presto-hive/src/main/java/io/prestosql/plugin/hive/s3select/S3SelectPushdown.java", "isResolved": false, "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0wOVQwMDoyMjoxM1rOFbn01w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0xMVQxNjo0Nzo0MVrOFcmOwA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NDUwODM3NQ==", "bodyText": "Maybe shorten to \"for gzip files\"\n// S3 Select supports skipping one line of headers, but it was returning incorrect results for gzip files\nOr just the file name test_table_with_header.csv.gz", "url": "https://github.com/trinodb/trino/pull/2399#discussion_r364508375", "createdAt": "2020-01-09T00:22:13Z", "author": {"login": "electrum"}, "path": "presto-hive/src/main/java/io/prestosql/plugin/hive/s3select/S3SelectPushdown.java", "diffHunk": "@@ -85,7 +87,20 @@ private static boolean isSerdeSupported(Properties schema)\n     private static boolean isInputFormatSupported(Properties schema)\n     {\n         String inputFormat = getInputFormatName(schema);\n-        return SUPPORTED_INPUT_FORMATS.contains(inputFormat);\n+\n+        if (TextInputFormat.class.getName().equals(inputFormat)) {\n+            if (!Objects.equals(schema.getProperty(SKIP_HEADER_COUNT_KEY, \"0\"), \"0\")) {\n+                // S3 Select supports skipping one line of headers, but it was returning incorrect results for presto-hive-hadoop2/conf/files/test_table_with_header.csv.gz", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "875ea00766535855f18b461182d52fc664eeb914"}, "originalPosition": 30}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NTUzMDc5Mg==", "bodyText": "I want to refer to an exact file. I checked that it works correctly some some .gz files, so it looks data-dependent.\nI will leave this as-is, and will add a TODO + link to the issue.", "url": "https://github.com/trinodb/trino/pull/2399#discussion_r365530792", "createdAt": "2020-01-11T16:47:16Z", "author": {"login": "findepi"}, "path": "presto-hive/src/main/java/io/prestosql/plugin/hive/s3select/S3SelectPushdown.java", "diffHunk": "@@ -85,7 +87,20 @@ private static boolean isSerdeSupported(Properties schema)\n     private static boolean isInputFormatSupported(Properties schema)\n     {\n         String inputFormat = getInputFormatName(schema);\n-        return SUPPORTED_INPUT_FORMATS.contains(inputFormat);\n+\n+        if (TextInputFormat.class.getName().equals(inputFormat)) {\n+            if (!Objects.equals(schema.getProperty(SKIP_HEADER_COUNT_KEY, \"0\"), \"0\")) {\n+                // S3 Select supports skipping one line of headers, but it was returning incorrect results for presto-hive-hadoop2/conf/files/test_table_with_header.csv.gz", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NDUwODM3NQ=="}, "originalCommit": {"oid": "875ea00766535855f18b461182d52fc664eeb914"}, "originalPosition": 30}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NTUzMDgxNg==", "bodyText": "I will leave this as-is,\n\n(primarily because i missed this comment earlier)", "url": "https://github.com/trinodb/trino/pull/2399#discussion_r365530816", "createdAt": "2020-01-11T16:47:41Z", "author": {"login": "findepi"}, "path": "presto-hive/src/main/java/io/prestosql/plugin/hive/s3select/S3SelectPushdown.java", "diffHunk": "@@ -85,7 +87,20 @@ private static boolean isSerdeSupported(Properties schema)\n     private static boolean isInputFormatSupported(Properties schema)\n     {\n         String inputFormat = getInputFormatName(schema);\n-        return SUPPORTED_INPUT_FORMATS.contains(inputFormat);\n+\n+        if (TextInputFormat.class.getName().equals(inputFormat)) {\n+            if (!Objects.equals(schema.getProperty(SKIP_HEADER_COUNT_KEY, \"0\"), \"0\")) {\n+                // S3 Select supports skipping one line of headers, but it was returning incorrect results for presto-hive-hadoop2/conf/files/test_table_with_header.csv.gz", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NDUwODM3NQ=="}, "originalCommit": {"oid": "875ea00766535855f18b461182d52fc664eeb914"}, "originalPosition": 30}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1087, "cost": 1, "resetAt": "2021-11-13T14:23:39Z"}}}