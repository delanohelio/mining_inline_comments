{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTAzMTkzNzI3", "number": 5550, "title": "Inject CatalogName in jdbc connectors", "bodyText": "", "createdAt": "2020-10-14T08:10:53Z", "url": "https://github.com/trinodb/trino/pull/5550", "merged": true, "mergeCommit": {"oid": "6b8019300af3d1bb5ae716743fd41dbaf4745c00"}, "closed": true, "closedAt": "2020-10-16T20:34:55Z", "author": {"login": "kokosing"}, "timelineItems": {"totalCount": 8, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdSZCE5AFqTUwODExODA4NA==", "endCursor": "Y3Vyc29yOnYyOpPPAAABdTK_7-gFqTUxMDcyMzEwNg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTA4MTE4MDg0", "url": "https://github.com/trinodb/trino/pull/5550#pullrequestreview-508118084", "createdAt": "2020-10-14T08:36:43Z", "commit": null, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xNFQwODozNjo0NFrOHhISmg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xNFQwODozNjo0NFrOHhISmg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNDUwMDg5MA==", "bodyText": "should we hide constructors (make them protected) of JdbcConnectorFactory and use static method instead? It's not obvious why module should be wrapped in withCredentialProvider and this commit changes mechanics of JdbcConnectorFactory", "url": "https://github.com/trinodb/trino/pull/5550#discussion_r504500890", "createdAt": "2020-10-14T08:36:44Z", "author": {"login": "sopel39"}, "path": "presto-base-jdbc/src/main/java/io/prestosql/plugin/jdbc/JdbcConnectorFactory.java", "diffHunk": "@@ -40,9 +40,14 @@\n \n     public JdbcConnectorFactory(String name, Module module)\n     {\n-        this(name, JdbcModuleProvider.withCredentialProvider(module));", "state": "SUBMITTED", "replyTo": null, "originalCommit": null, "originalPosition": 4}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTEwMzIyODk3", "url": "https://github.com/trinodb/trino/pull/5550#pullrequestreview-510322897", "createdAt": "2020-10-16T09:53:58Z", "commit": null, "state": "APPROVED", "comments": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xNlQwOTo1Mzo1OFrOHiyW3g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xNlQwOTo1ODozOVrOHiyrig==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNjIzODY4Ng==", "bodyText": "add /** @deprecated  and tell what to use instead.\nalso the commit message (\"Deprecate JdbcModuleProvider\") could indicate  a hint as well", "url": "https://github.com/trinodb/trino/pull/5550#discussion_r506238686", "createdAt": "2020-10-16T09:53:58Z", "author": {"login": "findepi"}, "path": "presto-base-jdbc/src/main/java/io/prestosql/plugin/jdbc/JdbcConnectorFactory.java", "diffHunk": "@@ -83,14 +88,14 @@ public Connector create(String catalogName, Map<String, String> requiredConfig,\n         return injector.getInstance(JdbcConnector.class);\n     }\n \n+    @Deprecated", "state": "SUBMITTED", "replyTo": null, "originalCommit": null, "originalPosition": 20}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNjIzODkzNA==", "bodyText": "make it into @deprecated", "url": "https://github.com/trinodb/trino/pull/5550#discussion_r506238934", "createdAt": "2020-10-16T09:54:13Z", "author": {"login": "findepi"}, "path": "presto-base-jdbc/src/main/java/io/prestosql/plugin/jdbc/JdbcConnectorFactory.java", "diffHunk": "@@ -40,9 +40,14 @@\n \n     public JdbcConnectorFactory(String name, Module module)\n     {\n-        this(name, JdbcModuleProvider.withCredentialProvider(module));\n+        this(name, catalogName -> module);\n     }\n \n+    /**\n+     * Prefer {@link JdbcConnectorFactory#JdbcConnectorFactory(String, Module)}.", "state": "SUBMITTED", "replyTo": null, "originalCommit": null, "originalPosition": 9}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNjI0MDcwOA==", "bodyText": "this is still the constructor (with the other one delegating here).\nWill we have this deprecated staying here & being used for ever?", "url": "https://github.com/trinodb/trino/pull/5550#discussion_r506240708", "createdAt": "2020-10-16T09:55:43Z", "author": {"login": "findepi"}, "path": "presto-base-jdbc/src/main/java/io/prestosql/plugin/jdbc/JdbcConnectorFactory.java", "diffHunk": "@@ -40,9 +40,14 @@\n \n     public JdbcConnectorFactory(String name, Module module)\n     {\n-        this(name, JdbcModuleProvider.withCredentialProvider(module));\n+        this(name, catalogName -> module);\n     }\n \n+    /**\n+     * Prefer {@link JdbcConnectorFactory#JdbcConnectorFactory(String, Module)}.\n+     * Notice that {@link io.prestosql.plugin.base.CatalogName} is available in guice context.\n+     */\n+    @Deprecated", "state": "SUBMITTED", "replyTo": null, "originalCommit": null, "originalPosition": 12}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNjI0MjQ4Ng==", "bodyText": "You're not maintaining compatibility (the FQN name of the method changed), so you can as well remove this method altogether (inline). I think we should rather pull CredentialProviderModule explicitly.", "url": "https://github.com/trinodb/trino/pull/5550#discussion_r506242486", "createdAt": "2020-10-16T09:57:18Z", "author": {"login": "findepi"}, "path": "presto-base-jdbc/src/main/java/io/prestosql/plugin/jdbc/JdbcConnectorFactory.java", "diffHunk": "@@ -83,14 +88,14 @@ public Connector create(String catalogName, Map<String, String> requiredConfig,\n         return injector.getInstance(JdbcConnector.class);\n     }\n \n+    @Deprecated\n     public interface JdbcModuleProvider\n     {\n         Module getModule(String catalogName);\n+    }\n \n-        static JdbcModuleProvider withCredentialProvider(Module module)\n-        {\n-            requireNonNull(module, \"module is null\");\n-            return catalogName -> combine(new CredentialProviderModule(), module);\n-        }\n+    public static Module withCredentialProvider(Module module)", "state": "SUBMITTED", "replyTo": null, "originalCommit": null, "originalPosition": 31}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNjI0Mzk3OA==", "bodyText": "Squash with Inject CatalogName in JDBC connectors?\nthe Inject CatalogName in JDBC connectors commit looks so void on its own", "url": "https://github.com/trinodb/trino/pull/5550#discussion_r506243978", "createdAt": "2020-10-16T09:58:39Z", "author": {"login": "findepi"}, "path": "presto-base-jdbc/src/main/java/io/prestosql/plugin/jdbc/JdbcDiagnosticModule.java", "diffHunk": "@@ -28,35 +30,28 @@\n \n import static com.google.common.reflect.Reflection.newProxy;\n import static java.lang.String.format;\n-import static java.util.Objects.requireNonNull;\n import static org.weakref.jmx.guice.ExportBinder.newExporter;\n \n public class JdbcDiagnosticModule\n         implements Module\n {\n-    private final String catalogName;\n-\n-    public JdbcDiagnosticModule(String catalogName)\n-    {\n-        this.catalogName = requireNonNull(catalogName, \"catalogName is null\");\n-    }\n-\n     @Override\n     public void configure(Binder binder)\n     {\n         binder.install(new MBeanServerModule());\n         binder.install(new MBeanModule());\n \n+        Provider<CatalogName> catalogName = binder.getProvider(CatalogName.class);", "state": "SUBMITTED", "replyTo": null, "originalCommit": null, "originalPosition": 35}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "12e34e7a3785655f54e00b56ba67697e63e81c6a", "author": {"user": {"login": "kokosing", "name": "Grzegorz Kokosi\u0144ski"}}, "url": "https://github.com/trinodb/trino/commit/12e34e7a3785655f54e00b56ba67697e63e81c6a", "committedDate": "2020-10-16T18:47:28Z", "message": "Avoid using deprecated method"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "94bc38824af47480f5cd59466984797ead35c8d3", "author": {"user": {"login": "kokosing", "name": "Grzegorz Kokosi\u0144ski"}}, "url": "https://github.com/trinodb/trino/commit/94bc38824af47480f5cd59466984797ead35c8d3", "committedDate": "2020-10-16T18:47:29Z", "message": "Inject CatalogName in JDBC connectors"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e7850a78be82b9fa67284e74e13ca5aa4e515b09", "author": {"user": {"login": "kokosing", "name": "Grzegorz Kokosi\u0144ski"}}, "url": "https://github.com/trinodb/trino/commit/e7850a78be82b9fa67284e74e13ca5aa4e515b09", "committedDate": "2020-10-16T18:47:30Z", "message": "Deprecate JdbcModuleProvider\n\nPrefer using JdbcConnectorFactory#JdbcConnectorFactory(String, Module)\ninstead. Notice that CatalogName is available in guice context so there\nis no point of getting that information from JdbcModuleProvider."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTEwNzE1ODUz", "url": "https://github.com/trinodb/trino/pull/5550#pullrequestreview-510715853", "createdAt": "2020-10-16T18:38:54Z", "commit": null, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xNlQxODozODo1NFrOHjL7DQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xNlQxODozODo1NFrOHjL7DQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNjY1NzU0OQ==", "bodyText": "Once we start to use the other constructor widely, we could remove this one and then we could refactor this class and remove JdbcModuleProvider.", "url": "https://github.com/trinodb/trino/pull/5550#discussion_r506657549", "createdAt": "2020-10-16T18:38:54Z", "author": {"login": "kokosing"}, "path": "presto-base-jdbc/src/main/java/io/prestosql/plugin/jdbc/JdbcConnectorFactory.java", "diffHunk": "@@ -40,9 +40,14 @@\n \n     public JdbcConnectorFactory(String name, Module module)\n     {\n-        this(name, JdbcModuleProvider.withCredentialProvider(module));\n+        this(name, catalogName -> module);\n     }\n \n+    /**\n+     * Prefer {@link JdbcConnectorFactory#JdbcConnectorFactory(String, Module)}.\n+     * Notice that {@link io.prestosql.plugin.base.CatalogName} is available in guice context.\n+     */\n+    @Deprecated", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNjI0MDcwOA=="}, "originalCommit": null, "originalPosition": 12}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": null, "afterCommit": {"oid": "e7850a78be82b9fa67284e74e13ca5aa4e515b09", "author": {"user": {"login": "kokosing", "name": "Grzegorz Kokosi\u0144ski"}}, "url": "https://github.com/trinodb/trino/commit/e7850a78be82b9fa67284e74e13ca5aa4e515b09", "committedDate": "2020-10-16T18:47:30Z", "message": "Deprecate JdbcModuleProvider\n\nPrefer using JdbcConnectorFactory#JdbcConnectorFactory(String, Module)\ninstead. Notice that CatalogName is available in guice context so there\nis no point of getting that information from JdbcModuleProvider."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTEwNzIzMTA2", "url": "https://github.com/trinodb/trino/pull/5550#pullrequestreview-510723106", "createdAt": "2020-10-16T18:50:41Z", "commit": {"oid": "e7850a78be82b9fa67284e74e13ca5aa4e515b09"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3452, "cost": 1, "resetAt": "2021-10-28T20:13:43Z"}}}