{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0MzkyMzY0Nzc1", "number": 3211, "title": "Allow debugging product tests", "bodyText": "", "createdAt": "2020-03-23T12:48:39Z", "url": "https://github.com/trinodb/trino/pull/3211", "merged": true, "mergeCommit": {"oid": "3cdd64fc367fe1d50e2de6ff45e1bc893636506a"}, "closed": true, "closedAt": "2020-03-25T15:31:01Z", "author": {"login": "findepi"}, "timelineItems": {"totalCount": 12, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcQd6jCAFqTM3OTQwNDE3NQ==", "endCursor": "Y3Vyc29yOnYyOpPPAAABcQ0-OZABqjMxNjAzMTkwMjU=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzc5NDA0MTc1", "url": "https://github.com/trinodb/trino/pull/3211#pullrequestreview-379404175", "createdAt": "2020-03-23T13:00:03Z", "commit": null, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yM1QxMzowMDowM1rOF6ERHg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yM1QxMzowMDowM1rOF6ERHg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NjQzMTY0Ng==", "bodyText": "I don't understand the description", "url": "https://github.com/trinodb/trino/pull/3211#discussion_r396431646", "createdAt": "2020-03-23T13:00:03Z", "author": {"login": "wendigo"}, "path": "presto-product-tests-launcher/src/main/java/io/prestosql/tests/product/launcher/env/EnvironmentOptions.java", "diffHunk": "@@ -32,6 +32,9 @@\n     @Option(name = \"--without-presto\", title = \"without Presto\", description = \"do not start presto-master\")\n     public boolean withoutPrestoMaster;\n \n+    @Option(name = \"--debugger\", description = \"which services a debugger port should be opened for\")", "state": "SUBMITTED", "replyTo": null, "originalCommit": null, "originalPosition": 4}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzc5NDAxMDI5", "url": "https://github.com/trinodb/trino/pull/3211#pullrequestreview-379401029", "createdAt": "2020-03-23T12:55:57Z", "commit": null, "state": "COMMENTED", "comments": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yM1QxMjo1NTo1N1rOF6EHhg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yM1QxMzowNDoxN1rOF6EbGQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NjQyOTE5MA==", "bodyText": "copyright", "url": "https://github.com/trinodb/trino/pull/3211#discussion_r396429190", "createdAt": "2020-03-23T12:55:57Z", "author": {"login": "kokosing"}, "path": "presto-product-tests-launcher/src/main/java/io/prestosql/tests/product/launcher/env/StandardDebugger.java", "diffHunk": "@@ -0,0 +1,29 @@\n+package io.prestosql.tests.product.launcher.env;", "state": "SUBMITTED", "replyTo": null, "originalCommit": null, "originalPosition": 1}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NjQyOTk1MA==", "bodyText": "Why not to expose all debug ports at once?", "url": "https://github.com/trinodb/trino/pull/3211#discussion_r396429950", "createdAt": "2020-03-23T12:57:15Z", "author": {"login": "kokosing"}, "path": "presto-product-tests-launcher/src/main/java/io/prestosql/tests/product/launcher/env/EnvironmentOptions.java", "diffHunk": "@@ -32,6 +32,9 @@\n     @Option(name = \"--without-presto\", title = \"without Presto\", description = \"do not start presto-master\")\n     public boolean withoutPrestoMaster;\n \n+    @Option(name = \"--debugger\", description = \"which services a debugger port should be opened for\")", "state": "SUBMITTED", "replyTo": null, "originalCommit": null, "originalPosition": 4}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NjQzMTc3MQ==", "bodyText": "export HADOOP_OPTS=\"-agentlib:jdwp=transport=dt_socket,server=y,suspend=n,address=5006\"\ncat /usr/lib/hive/bin/hive | grep 'exit 5' -v > x; mv -f x /usr/lib/hive/bin/hive\nsupervisorctl stop hive-metastore\nchmod +x /usr/lib/hive/bin/hive\nsu hive -c 'hive --service metastore --hiveconf hive.root.logger=DEBUG,console --hiveconf hive.log.threshold=DEBUG' -s /bin/bash", "url": "https://github.com/trinodb/trino/pull/3211#discussion_r396431771", "createdAt": "2020-03-23T13:00:16Z", "author": {"login": "kokosing"}, "path": "presto-product-tests-launcher/src/main/java/io/prestosql/tests/product/launcher/env/StandardDebugger.java", "diffHunk": "@@ -0,0 +1,29 @@\n+package io.prestosql.tests.product.launcher.env;\n+\n+import com.google.common.base.Splitter;\n+\n+import java.util.Optional;\n+\n+import static java.util.Locale.ENGLISH;\n+\n+public enum StandardDebugger\n+{\n+    PRESTO,\n+    // METASTORE, // TODO", "state": "SUBMITTED", "replyTo": null, "originalCommit": null, "originalPosition": 12}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NjQzMzA1MA==", "bodyText": "unod indentation", "url": "https://github.com/trinodb/trino/pull/3211#discussion_r396433050", "createdAt": "2020-03-23T13:02:23Z", "author": {"login": "kokosing"}, "path": "presto-product-tests-launcher/src/main/java/io/prestosql/tests/product/launcher/env/common/Standard.java", "diffHunk": "@@ -72,10 +94,14 @@ private DockerContainer createPrestoMaster()\n     {\n         DockerContainer container =\n                 createPrestoContainer(dockerFiles, pathResolver, serverPackage, \"prestodev/centos7-oj11:\" + imagesVersion)\n-                .withFileSystemBind(dockerFiles.getDockerFilesHostPath(\"common/standard/config.properties\"), CONTAINER_PRESTO_CONFIG_PROPERTIES, READ_ONLY);\n+                        .withFileSystemBind(dockerFiles.getDockerFilesHostPath(\"common/standard/config.properties\"), CONTAINER_PRESTO_CONFIG_PROPERTIES, READ_ONLY);", "state": "SUBMITTED", "replyTo": null, "originalCommit": null, "originalPosition": 64}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NjQzNDIwMQ==", "bodyText": "Doesn't launcher support to pass JVM properties? It would be much easier that this.", "url": "https://github.com/trinodb/trino/pull/3211#discussion_r396434201", "createdAt": "2020-03-23T13:04:17Z", "author": {"login": "kokosing"}, "path": "presto-product-tests-launcher/src/main/java/io/prestosql/tests/product/launcher/env/common/Standard.java", "diffHunk": "@@ -99,10 +125,47 @@ public static DockerContainer createPrestoContainer(DockerFiles dockerFiles, Pat\n     {\n         return new DockerContainer(dockerImageName)\n                 .withFileSystemBind(dockerFiles.getDockerFilesHostPath(), \"/docker/presto-product-tests\", READ_ONLY)\n+                .withFileSystemBind(dockerFiles.getDockerFilesHostPath(\"conf/presto/etc/jvm.config\"), CONTAINER_PRESTO_JVM_CONFIG, READ_ONLY)\n                 .withFileSystemBind(pathResolver.resolvePlaceholders(serverPackage).toString(), \"/docker/presto-server.tar.gz\", READ_ONLY)\n                 .withCommand(\"/docker/presto-product-tests/run-presto.sh\")\n                 .withStartupCheckStrategy(new IsRunningStartupCheckStrategy())\n                 .waitingFor(Wait.forLogMessage(\".*======== SERVER STARTED ========.*\", 1))\n                 .withStartupTimeout(Duration.ofMinutes(5));\n     }\n+\n+    private void enableDebugger(CreateContainerCmd createContainerCmd)", "state": "SUBMITTED", "replyTo": null, "originalCommit": null, "originalPosition": 97}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": null, "afterCommit": null}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": null, "afterCommit": null}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": null, "afterCommit": null}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": null, "afterCommit": null}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzgwMDcxMTMy", "url": "https://github.com/trinodb/trino/pull/3211#pullrequestreview-380071132", "createdAt": "2020-03-24T08:02:25Z", "commit": null, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "9dd84bd9644aa1d7edd9ffb07bba4e186c5ee6e3", "author": {"user": {"login": "findepi", "name": "Piotr Findeisen"}}, "url": "https://github.com/trinodb/trino/commit/9dd84bd9644aa1d7edd9ffb07bba4e186c5ee6e3", "committedDate": "2020-03-24T15:51:41Z", "message": "Fix formatting"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "63ecfeb815fda108d7de2e1cd9f467cc61281bf7", "author": {"user": {"login": "findepi", "name": "Piotr Findeisen"}}, "url": "https://github.com/trinodb/trino/commit/63ecfeb815fda108d7de2e1cd9f467cc61281bf7", "committedDate": "2020-03-24T15:51:42Z", "message": "Fix variable name"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "234591c46e946a519ca228fe68f9ddacb9c2a3e4", "author": {"user": {"login": "findepi", "name": "Piotr Findeisen"}}, "url": "https://github.com/trinodb/trino/commit/234591c46e946a519ca228fe68f9ddacb9c2a3e4", "committedDate": "2020-03-24T15:51:43Z", "message": "Fix method name"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c1904dd805827e186bc6c180cbda62c1eda06d4a", "author": {"user": {"login": "findepi", "name": "Piotr Findeisen"}}, "url": "https://github.com/trinodb/trino/commit/c1904dd805827e186bc6c180cbda62c1eda06d4a", "committedDate": "2020-03-24T15:51:44Z", "message": "Add --debug option for Launcher"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": null, "afterCommit": {"oid": "c1904dd805827e186bc6c180cbda62c1eda06d4a", "author": {"user": {"login": "findepi", "name": "Piotr Findeisen"}}, "url": "https://github.com/trinodb/trino/commit/c1904dd805827e186bc6c180cbda62c1eda06d4a", "committedDate": "2020-03-24T15:51:44Z", "message": "Add --debug option for Launcher"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1983, "cost": 1, "resetAt": "2021-10-28T19:08:13Z"}}}