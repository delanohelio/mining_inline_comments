{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDkyNjQ1Mjc5", "number": 5289, "title": "Fix potential deadlock when HttpPageBufferClient exceeds memory limit", "bodyText": "Comparable changes to prestodb/presto#15220\nPrior to this change, if the HttpPageBufferClient caused a task to exceed its memory limit inside of addPages, the exception would bubble to the root of the exchange client callback executor without ever marking the task as failed. If no other operator also saw the memory limit exceeded condition, then the task would become stuck in a deadlocked\nstate.", "createdAt": "2020-09-24T19:07:55Z", "url": "https://github.com/trinodb/trino/pull/5289", "merged": true, "mergeCommit": {"oid": "8ae60feef5e9774b7573287ecb9d3f29c69978b2"}, "closed": true, "closedAt": "2020-09-28T08:20:12Z", "author": {"login": "pettyjamesm"}, "timelineItems": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdMSgFqAFqTQ5NjI2NDU4MA==", "endCursor": "Y3Vyc29yOnYyOpPPAAABdNPLoiAFqTQ5NzI4Mzc0Mg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDk2MjY0NTgw", "url": "https://github.com/trinodb/trino/pull/5289#pullrequestreview-496264580", "createdAt": "2020-09-25T09:36:26Z", "commit": null, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yNVQwOTozNjoyNlrOHX8a_w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yNVQwOTozNjoyNlrOHX8a_w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NDg2OTI0Nw==", "bodyText": "Could we have a test in io.prestosql.operator.TestHttpPageBufferClient for this case (e.g the exception did not bubble up)?", "url": "https://github.com/trinodb/trino/pull/5289#discussion_r494869247", "createdAt": "2020-09-25T09:36:26Z", "author": {"login": "sopel39"}, "path": "presto-main/src/main/java/io/prestosql/operator/HttpPageBufferClient.java", "diffHunk": "@@ -387,26 +387,26 @@ public Void handle(Request request, Response response)\n                             }\n                         });\n                     }\n+", "state": "SUBMITTED", "replyTo": null, "originalCommit": null, "originalPosition": 4}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "22f06fa644b9a29681b2c5a324f15dbe2665d98b", "author": {"user": {"login": "pettyjamesm", "name": "James Petty"}}, "url": "https://github.com/trinodb/trino/commit/22f06fa644b9a29681b2c5a324f15dbe2665d98b", "committedDate": "2020-09-25T12:23:02Z", "message": "Fix potential deadlock when HttpPageBufferClient exceeds memory limit\n\nPrior to this change, if the HttpPageBufferClient caused a task to\nexceed its memory limit inside of addPages, the exception would bubble\nto the root of the exchange client callback executor without ever\nmarking the task as failed. If no other operator also saw the memory\nlimit exceeded condition, then the task would become stuck in a deadlocked\nstate."}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": null, "afterCommit": {"oid": "22f06fa644b9a29681b2c5a324f15dbe2665d98b", "author": {"user": {"login": "pettyjamesm", "name": "James Petty"}}, "url": "https://github.com/trinodb/trino/commit/22f06fa644b9a29681b2c5a324f15dbe2665d98b", "committedDate": "2020-09-25T12:23:02Z", "message": "Fix potential deadlock when HttpPageBufferClient exceeds memory limit\n\nPrior to this change, if the HttpPageBufferClient caused a task to\nexceed its memory limit inside of addPages, the exception would bubble\nto the root of the exchange client callback executor without ever\nmarking the task as failed. If no other operator also saw the memory\nlimit exceeded condition, then the task would become stuck in a deadlocked\nstate."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDk3MjgzNzQy", "url": "https://github.com/trinodb/trino/pull/5289#pullrequestreview-497283742", "createdAt": "2020-09-28T08:17:12Z", "commit": {"oid": "22f06fa644b9a29681b2c5a324f15dbe2665d98b"}, "state": "APPROVED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yOFQwODoxNzoxMlrOHYzFmg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yOFQwODoxNzoxMlrOHYzFmg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NTc2NDg5MA==", "bodyText": "nit: this could be separate commit", "url": "https://github.com/trinodb/trino/pull/5289#discussion_r495764890", "createdAt": "2020-09-28T08:17:12Z", "author": {"login": "sopel39"}, "path": "presto-main/src/test/java/io/prestosql/operator/TestHttpPageBufferClient.java", "diffHunk": "@@ -237,7 +244,7 @@ public void testInvalidResponses()\n                 \"localhost\",\n                 new TestingHttpClient(processor, scheduler),\n                 DataIntegrityVerification.ABORT,\n-                DataSize.of(10, Unit.MEGABYTE),", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "22f06fa644b9a29681b2c5a324f15dbe2665d98b"}, "originalPosition": 49}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3774, "cost": 1, "resetAt": "2021-10-28T20:13:43Z"}}}