{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDQ2OTAxNjEz", "number": 4403, "reviewThreads": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xMFQyMjoxMzowNVrOENbgWA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xN1QxMDowNjowNFrOEPehAw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjgyNTE3NTkyOnYy", "diffSide": "RIGHT", "path": "presto-spi/src/test/java/io/prestosql/spi/testing/InterfaceTestUtils.java", "isResolved": false, "comments": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xMFQyMjoxMzowNVrOGwHEhg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yNFQxMDo1ODo0NFrOHFfZ9w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MzEwMDY3OA==", "bodyText": "This is, in general, not safe. It's better to have explicit per-test exclusions", "url": "https://github.com/trinodb/trino/pull/4403#discussion_r453100678", "createdAt": "2020-07-10T22:13:05Z", "author": {"login": "findepi"}, "path": "presto-spi/src/test/java/io/prestosql/spi/testing/InterfaceTestUtils.java", "diffHunk": "@@ -47,6 +47,10 @@ private InterfaceTestUtils() {}\n             if (method.getDeclaringClass() == Object.class) {\n                 continue;\n             }\n+            if (method.getAnnotation(Deprecated.class) != null) {\n+                // deprecated methods in interfaces exist for backwards compatibility only; they don't have to be implemented", "state": "SUBMITTED", "replyTo": null, "originalCommit": null, "originalPosition": 5}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MzE1ODE3MA==", "bodyText": "This became de facto a 'pattern' in Presto code, other interfaces adhere to it as well.\nAlso if we use the solution from my next comment, this reflection-based check test becomes unnecessary.", "url": "https://github.com/trinodb/trino/pull/4403#discussion_r453158170", "createdAt": "2020-07-11T05:25:52Z", "author": {"login": "iirekm"}, "path": "presto-spi/src/test/java/io/prestosql/spi/testing/InterfaceTestUtils.java", "diffHunk": "@@ -47,6 +47,10 @@ private InterfaceTestUtils() {}\n             if (method.getDeclaringClass() == Object.class) {\n                 continue;\n             }\n+            if (method.getAnnotation(Deprecated.class) != null) {\n+                // deprecated methods in interfaces exist for backwards compatibility only; they don't have to be implemented", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MzEwMDY3OA=="}, "originalCommit": null, "originalPosition": 5}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NDc5MzkzMA==", "bodyText": "Please remove this one", "url": "https://github.com/trinodb/trino/pull/4403#discussion_r474793930", "createdAt": "2020-08-21T16:12:12Z", "author": {"login": "findepi"}, "path": "presto-spi/src/test/java/io/prestosql/spi/testing/InterfaceTestUtils.java", "diffHunk": "@@ -47,6 +47,10 @@ private InterfaceTestUtils() {}\n             if (method.getDeclaringClass() == Object.class) {\n                 continue;\n             }\n+            if (method.getAnnotation(Deprecated.class) != null) {\n+                // deprecated methods in interfaces exist for backwards compatibility only; they don't have to be implemented", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MzEwMDY3OA=="}, "originalCommit": null, "originalPosition": 5}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NTUxOTQ3OQ==", "bodyText": "done, but I don't like this solution\nwe should start using something else for backwards compatibility ASAP, for example something like XxxxResponse xxxx(XxxxRequest request), even if it may look exaggerated in the beginning", "url": "https://github.com/trinodb/trino/pull/4403#discussion_r475519479", "createdAt": "2020-08-24T10:58:44Z", "author": {"login": "iirekm"}, "path": "presto-spi/src/test/java/io/prestosql/spi/testing/InterfaceTestUtils.java", "diffHunk": "@@ -47,6 +47,10 @@ private InterfaceTestUtils() {}\n             if (method.getDeclaringClass() == Object.class) {\n                 continue;\n             }\n+            if (method.getAnnotation(Deprecated.class) != null) {\n+                // deprecated methods in interfaces exist for backwards compatibility only; they don't have to be implemented", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MzEwMDY3OA=="}, "originalCommit": null, "originalPosition": 5}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjgyNTE3OTQwOnYy", "diffSide": "LEFT", "path": "presto-plugin-toolkit/src/main/java/io/prestosql/plugin/base/classloader/ClassLoaderSafeConnectorPageSourceProvider.java", "isResolved": false, "comments": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xMFQyMjoxNDo1OFrOGwHGgA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xNlQyMDozNToyMlrOGy7z2w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MzEwMTE4NA==", "bodyText": "i'd prefer to keep it:\n\nit safes mental overhear required to justify not having it\nsomeone could use this class in their code and now would lose TCCL wrapping\n\nis there a benefit from removing it?", "url": "https://github.com/trinodb/trino/pull/4403#discussion_r453101184", "createdAt": "2020-07-10T22:14:58Z", "author": {"login": "findepi"}, "path": "presto-plugin-toolkit/src/main/java/io/prestosql/plugin/base/classloader/ClassLoaderSafeConnectorPageSourceProvider.java", "diffHunk": "@@ -42,14 +42,6 @@ public ClassLoaderSafeConnectorPageSourceProvider(@ForClassLoaderSafe ConnectorP\n         this.classLoader = requireNonNull(classLoader, \"classLoader is null\");\n     }\n \n-    @Override\n-    public ConnectorPageSource createPageSource(ConnectorTransactionHandle transaction, ConnectorSession session, ConnectorSplit split, ConnectorTableHandle table, List<ColumnHandle> columns)", "state": "SUBMITTED", "replyTo": null, "originalCommit": null, "originalPosition": 5}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MzE1NzkxNg==", "bodyText": "this method was never called in Presto\n\n\ncopy&paste is also bad, makes even more confusion, especially that somebody can take this class as an example for their own implementations\n\n\nthey will have to be removed at some time in future - why promote bad behavior\n\n\nthe case when somebody calls deprecated method is rare, but indeed can be serious; maybe the pattern should be modified a bit:\n\n\ninterface Xxxxx {\n  @Deprecated\n  default void xxxxx(...) {\n    try {\n      xxxxx(...);  // call non-deprecated version (if exists)\n    } catch(StackOverflowException e) { \n       throw new UnsupportedOperationException(\"xxxxx not implemented\");\n    }\n\n   void xxxxx(...) {\n      xxxxx(...); // call deprecated version (if exists)\n   }\n}\nI know this is not the most beautiful code in the world, but for @deprecated stuff, to be removed in the future, I think it's pretty acceptable.", "url": "https://github.com/trinodb/trino/pull/4403#discussion_r453157916", "createdAt": "2020-07-11T05:22:56Z", "author": {"login": "iirekm"}, "path": "presto-plugin-toolkit/src/main/java/io/prestosql/plugin/base/classloader/ClassLoaderSafeConnectorPageSourceProvider.java", "diffHunk": "@@ -42,14 +42,6 @@ public ClassLoaderSafeConnectorPageSourceProvider(@ForClassLoaderSafe ConnectorP\n         this.classLoader = requireNonNull(classLoader, \"classLoader is null\");\n     }\n \n-    @Override\n-    public ConnectorPageSource createPageSource(ConnectorTransactionHandle transaction, ConnectorSession session, ConnectorSplit split, ConnectorTableHandle table, List<ColumnHandle> columns)", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MzEwMTE4NA=="}, "originalCommit": null, "originalPosition": 5}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MzE2MDkzNQ==", "bodyText": "I suggest we leave the method, with throw Unsupported  as the implementation.\nThis way we have the safety you want, and also the readability provisions I want.\nAnd there is no need to relax the assertions in the test.", "url": "https://github.com/trinodb/trino/pull/4403#discussion_r453160935", "createdAt": "2020-07-11T06:00:46Z", "author": {"login": "findepi"}, "path": "presto-plugin-toolkit/src/main/java/io/prestosql/plugin/base/classloader/ClassLoaderSafeConnectorPageSourceProvider.java", "diffHunk": "@@ -42,14 +42,6 @@ public ClassLoaderSafeConnectorPageSourceProvider(@ForClassLoaderSafe ConnectorP\n         this.classLoader = requireNonNull(classLoader, \"classLoader is null\");\n     }\n \n-    @Override\n-    public ConnectorPageSource createPageSource(ConnectorTransactionHandle transaction, ConnectorSession session, ConnectorSplit split, ConnectorTableHandle table, List<ColumnHandle> columns)", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MzEwMTE4NA=="}, "originalCommit": null, "originalPosition": 5}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NDM0NTQ0OA==", "bodyText": "there are many more places like this, with even more serious problems, my suggestion how to solve this once and for all is here: #4448", "url": "https://github.com/trinodb/trino/pull/4403#discussion_r454345448", "createdAt": "2020-07-14T13:12:44Z", "author": {"login": "iirekm"}, "path": "presto-plugin-toolkit/src/main/java/io/prestosql/plugin/base/classloader/ClassLoaderSafeConnectorPageSourceProvider.java", "diffHunk": "@@ -42,14 +42,6 @@ public ClassLoaderSafeConnectorPageSourceProvider(@ForClassLoaderSafe ConnectorP\n         this.classLoader = requireNonNull(classLoader, \"classLoader is null\");\n     }\n \n-    @Override\n-    public ConnectorPageSource createPageSource(ConnectorTransactionHandle transaction, ConnectorSession session, ConnectorSplit split, ConnectorTableHandle table, List<ColumnHandle> columns)", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MzEwMTE4NA=="}, "originalCommit": null, "originalPosition": 5}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NjA2MTkxNQ==", "bodyText": "Thanks for linking the two together.\nI feel strongly that ClassLoaderSafe* should just dutifully implement all methods.", "url": "https://github.com/trinodb/trino/pull/4403#discussion_r456061915", "createdAt": "2020-07-16T20:35:22Z", "author": {"login": "findepi"}, "path": "presto-plugin-toolkit/src/main/java/io/prestosql/plugin/base/classloader/ClassLoaderSafeConnectorPageSourceProvider.java", "diffHunk": "@@ -42,14 +42,6 @@ public ClassLoaderSafeConnectorPageSourceProvider(@ForClassLoaderSafe ConnectorP\n         this.classLoader = requireNonNull(classLoader, \"classLoader is null\");\n     }\n \n-    @Override\n-    public ConnectorPageSource createPageSource(ConnectorTransactionHandle transaction, ConnectorSession session, ConnectorSplit split, ConnectorTableHandle table, List<ColumnHandle> columns)", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MzEwMTE4NA=="}, "originalCommit": null, "originalPosition": 5}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjg0NjY0MDY3OnYy", "diffSide": "RIGHT", "path": "presto-pinot/src/main/java/io/prestosql/pinot/PinotPageSourceProvider.java", "isResolved": false, "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xN1QxMDowNjowNFrOGzNVTA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yMVQwNzoxOTowMFrOHEey3A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NjM0OTAwNA==", "bodyText": "Maybe it instead of this pull request we should simply remove this deprecated method? How long ago was it deprecated?", "url": "https://github.com/trinodb/trino/pull/4403#discussion_r456349004", "createdAt": "2020-07-17T10:06:04Z", "author": {"login": "kokosing"}, "path": "presto-pinot/src/main/java/io/prestosql/pinot/PinotPageSourceProvider.java", "diffHunk": "@@ -25,6 +25,7 @@\n import io.prestosql.spi.connector.ConnectorSplit;", "state": "SUBMITTED", "replyTo": null, "originalCommit": null, "originalPosition": 1}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NDIzMTIwOA==", "bodyText": "I agree, we can just remove it now.", "url": "https://github.com/trinodb/trino/pull/4403#discussion_r464231208", "createdAt": "2020-08-03T07:08:39Z", "author": {"login": "electrum"}, "path": "presto-pinot/src/main/java/io/prestosql/pinot/PinotPageSourceProvider.java", "diffHunk": "@@ -25,6 +25,7 @@\n import io.prestosql.spi.connector.ConnectorSplit;", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NjM0OTAwNA=="}, "originalCommit": null, "originalPosition": 1}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NDQ2MDg5Mg==", "bodyText": "@iirekm How about it?", "url": "https://github.com/trinodb/trino/pull/4403#discussion_r474460892", "createdAt": "2020-08-21T07:19:00Z", "author": {"login": "kokosing"}, "path": "presto-pinot/src/main/java/io/prestosql/pinot/PinotPageSourceProvider.java", "diffHunk": "@@ -25,6 +25,7 @@\n import io.prestosql.spi.connector.ConnectorSplit;", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NjM0OTAwNA=="}, "originalCommit": null, "originalPosition": 1}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3859, "cost": 1, "resetAt": "2021-11-12T12:57:47Z"}}}