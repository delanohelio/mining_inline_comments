{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0MzY4MDAyMTg4", "number": 2648, "title": "Wait for running queries issued during grace period to finish", "bodyText": "Related to: #2621\nFixes one race condition between worker shutting down and issuing new queries by coordinator", "createdAt": "2020-01-28T13:03:48Z", "url": "https://github.com/trinodb/trino/pull/2648", "merged": true, "mergeCommit": {"oid": "083df41940b3428e52bf168a8d78949663b0753a"}, "closed": true, "closedAt": "2020-02-20T11:29:28Z", "author": {"login": "sopel39"}, "timelineItems": {"totalCount": 6, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABb_MRqvgFqTM1MDQxNDY3Mw==", "endCursor": "Y3Vyc29yOnYyOpPPAAABcGJblPABqjMwNTU1MTE0MjI=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzUwNDE0Njcz", "url": "https://github.com/trinodb/trino/pull/2648#pullrequestreview-350414673", "createdAt": "2020-01-29T20:50:12Z", "commit": {"oid": "c17718831d08edf891ba0c45e82258bb32a54111"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yOVQyMDo1MDoxMlrOFjXEXA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yOVQyMDo1MDoxMlrOFjXEXA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MjYyMjQyOA==", "bodyText": "We need to wait at least once.... actually, I maybe we should wait first, and then shutdown once all tasks exit.", "url": "https://github.com/trinodb/trino/pull/2648#discussion_r372622428", "createdAt": "2020-01-29T20:50:12Z", "author": {"login": "dain"}, "path": "presto-main/src/main/java/io/prestosql/server/GracefulShutdownHandler.java", "diffHunk": "@@ -109,10 +109,10 @@ public synchronized void requestShutdown()\n                 }\n \n                 activeTasks = getActiveTasks();\n-            }\n \n-            // wait for another grace period for all task states to be observed by the coordinator\n-            sleepUninterruptibly(gracePeriod.toMillis(), MILLISECONDS);\n+                // wait for another grace period for all task states and shutting down state to be observed by the coordinator\n+                sleepUninterruptibly(gracePeriod.toMillis(), MILLISECONDS);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c17718831d08edf891ba0c45e82258bb32a54111"}, "originalPosition": 9}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "c17718831d08edf891ba0c45e82258bb32a54111", "author": {"user": {"login": "sopel39", "name": "Karol Sobczak"}}, "url": "https://github.com/trinodb/trino/commit/c17718831d08edf891ba0c45e82258bb32a54111", "committedDate": "2020-01-28T13:02:23Z", "message": "Wait for running queries issued during grace period to finish"}, "afterCommit": null}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": null, "afterCommit": null}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzYxNTg4NDYw", "url": "https://github.com/trinodb/trino/pull/2648#pullrequestreview-361588460", "createdAt": "2020-02-20T01:59:47Z", "commit": null, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d19bc9a655e85ec483ef245ac8d74a6128dc6792", "author": {"user": {"login": "sopel39", "name": "Karol Sobczak"}}, "url": "https://github.com/trinodb/trino/commit/d19bc9a655e85ec483ef245ac8d74a6128dc6792", "committedDate": "2020-02-20T11:28:40Z", "message": "Wait for running queries issued during grace period to finish"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": null, "afterCommit": {"oid": "d19bc9a655e85ec483ef245ac8d74a6128dc6792", "author": {"user": {"login": "sopel39", "name": "Karol Sobczak"}}, "url": "https://github.com/trinodb/trino/commit/d19bc9a655e85ec483ef245ac8d74a6128dc6792", "committedDate": "2020-02-20T11:28:40Z", "message": "Wait for running queries issued during grace period to finish"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1708, "cost": 1, "resetAt": "2021-10-28T20:13:43Z"}}}