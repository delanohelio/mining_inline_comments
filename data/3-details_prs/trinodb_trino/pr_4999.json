{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDc0NzQyNjcy", "number": 4999, "title": "Allow to configure insert into Hive partition via configuration property", "bodyText": "Allow to set default value for hive.insert_existing_partitions_behavior property", "createdAt": "2020-08-27T14:33:22Z", "url": "https://github.com/trinodb/trino/pull/4999", "merged": true, "mergeCommit": {"oid": "6149fa2cb383f4884f136956fb4a8c4fecdf09ca"}, "closed": true, "closedAt": "2020-09-17T08:44:01Z", "author": {"login": "ssheikin"}, "timelineItems": {"totalCount": 26, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdDE0W4gFqTQ3Njk3NzM1Mw==", "endCursor": "Y3Vyc29yOnYyOpPPAAABdJkBWwgBqjM3NzUyOTc0NjA=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDc2OTc3MzUz", "url": "https://github.com/trinodb/trino/pull/4999#pullrequestreview-476977353", "createdAt": "2020-08-27T18:28:01Z", "commit": null, "state": "COMMENTED", "comments": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yN1QxODoyODowMVrOHIcSvg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yN1QxODozNTo0MlrOHIcirg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3ODYxNDIwNg==", "bodyText": "Please change commit message to:\nAllow to configure insert into Hive partition via configuration property\n\nNo need for anything more than that. Please do not mention internal references to issue tracking system.", "url": "https://github.com/trinodb/trino/pull/4999#discussion_r478614206", "createdAt": "2020-08-27T18:28:01Z", "author": {"login": "kokosing"}, "path": "presto-hive/src/main/java/io/prestosql/plugin/hive/HiveConfig.java", "diffHunk": "@@ -26,6 +26,7 @@\n import org.joda.time.DateTimeZone;", "state": "SUBMITTED", "replyTo": null, "originalCommit": null, "originalPosition": 1}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3ODYxNDMyNA==", "bodyText": "Please use enum.\nSee how hiveCompressionCodec is implemented above.\nBy default it should be set to APPEND", "url": "https://github.com/trinodb/trino/pull/4999#discussion_r478614324", "createdAt": "2020-08-27T18:28:15Z", "author": {"login": "kokosing"}, "path": "presto-hive/src/main/java/io/prestosql/plugin/hive/HiveConfig.java", "diffHunk": "@@ -79,6 +80,7 @@\n     private HiveCompressionCodec hiveCompressionCodec = HiveCompressionCodec.GZIP;\n     private boolean respectTableFormat = true;\n     private boolean immutablePartitions;\n+    private String insertExistingPartitionsBehavior;", "state": "SUBMITTED", "replyTo": null, "originalCommit": null, "originalPosition": 12}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3ODYxNzQ1Nw==", "bodyText": "Please remove immutablePartitions, notice that it has to be then added to @DefunctConfig at the top of the class, so it raise proper error message when some uses it.\nimmutablePartitions usage should be now replaced with the new property.\nPlease update TestHiveConfig", "url": "https://github.com/trinodb/trino/pull/4999#discussion_r478617457", "createdAt": "2020-08-27T18:34:10Z", "author": {"login": "kokosing"}, "path": "presto-hive/src/main/java/io/prestosql/plugin/hive/HiveConfig.java", "diffHunk": "@@ -79,6 +80,7 @@\n     private HiveCompressionCodec hiveCompressionCodec = HiveCompressionCodec.GZIP;\n     private boolean respectTableFormat = true;\n     private boolean immutablePartitions;\n+    private String insertExistingPartitionsBehavior;", "state": "SUBMITTED", "replyTo": null, "originalCommit": null, "originalPosition": 12}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3ODYxODI4Ng==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                        if (defaultValue.isEmpty()) {return immutable ? ERROR : APPEND;}\n          \n          \n            \n                        if (defaultValue.isEmpty()) {\n          \n          \n            \n                            return immutable ? ERROR : APPEND;\n          \n          \n            \n                        }\n          \n      \n    \n    \n  \n\nWe do not fold if statements. The only exception is empty method like:\nvoid method() {}\n\nOtherwise we always put curly brackets into separate lines.", "url": "https://github.com/trinodb/trino/pull/4999#discussion_r478618286", "createdAt": "2020-08-27T18:35:42Z", "author": {"login": "kokosing"}, "path": "presto-hive/src/main/java/io/prestosql/plugin/hive/HiveSessionProperties.java", "diffHunk": "@@ -110,6 +111,14 @@ public static InsertExistingPartitionsBehavior valueOf(String value, boolean imm\n \n             return enumValue;\n         }\n+\n+        public static InsertExistingPartitionsBehavior getDefaultValue(HiveConfig hiveConfig)\n+        {\n+            boolean immutable = hiveConfig.isImmutablePartitions();\n+            Optional<String> defaultValue = hiveConfig.getInsertExistingPartitionsBehavior();\n+            if (defaultValue.isEmpty()) {return immutable ? ERROR : APPEND;}", "state": "SUBMITTED", "replyTo": null, "originalCommit": null, "originalPosition": 17}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": null, "afterCommit": null}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDc3OTQyMjQz", "url": "https://github.com/trinodb/trino/pull/4999#pullrequestreview-477942243", "createdAt": "2020-08-28T18:28:31Z", "commit": null, "state": "COMMENTED", "comments": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yOFQxODoyODozMlrOHJQfOg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yOFQxODozODo0OFrOHJQw5A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3OTQ2OTM3MA==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                public void init()\n          \n          \n            \n                {\n          \n          \n            \n                    verifyDefaultValueForInsertExistingPartitionsBehaviorCouldBeAssigned();\n          \n          \n            \n                }\n          \n          \n            \n            \n          \n          \n            \n                public void verifyDefaultValueForInsertExistingPartitionsBehaviorCouldBeAssigned()\n          \n          \n            \n                {\n          \n          \n            \n                    verifyAndGet(insertExistingPartitionsBehavior, immutablePartitions);\n          \n          \n            \n                }\n          \n          \n            \n                public void validate()\n          \n          \n            \n                {\n          \n          \n            \n                            InsertExistingPartitionsBehavior.validate(...);\n          \n          \n            \n                }\n          \n      \n    \n    \n  \n\nPlease add tests for that. See io.prestosql.plugin.hive.TestHiveHadoop2Plugin#testGcsAccessTokenAndHiveCachingMutuallyExclusive", "url": "https://github.com/trinodb/trino/pull/4999#discussion_r479469370", "createdAt": "2020-08-28T18:28:32Z", "author": {"login": "kokosing"}, "path": "presto-hive/src/main/java/io/prestosql/plugin/hive/HiveConfig.java", "diffHunk": "@@ -977,4 +995,15 @@ public HiveConfig setProjectionPushdownEnabled(boolean projectionPushdownEnabled\n         this.projectionPushdownEnabled = projectionPushdownEnabled;\n         return this;\n     }\n+\n+    @PostConstruct\n+    public void init()\n+    {\n+        verifyDefaultValueForInsertExistingPartitionsBehaviorCouldBeAssigned();\n+    }\n+\n+    public void verifyDefaultValueForInsertExistingPartitionsBehaviorCouldBeAssigned()\n+    {\n+        verifyAndGet(insertExistingPartitionsBehavior, immutablePartitions);\n+    }", "state": "SUBMITTED", "replyTo": null, "originalCommit": null, "originalPosition": 63}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3OTQ3MTk2NQ==", "bodyText": "verifyAndGet is not needed here. It is already checked in getInsertExistingPartitionsBehavior", "url": "https://github.com/trinodb/trino/pull/4999#discussion_r479471965", "createdAt": "2020-08-28T18:34:32Z", "author": {"login": "kokosing"}, "path": "presto-hive/src/main/java/io/prestosql/plugin/hive/HiveWriterFactory.java", "diffHunk": "@@ -200,10 +202,7 @@ public HiveWriterFactory(\n         this.sortedWritingTempStagingPathEnabled = isTemporaryStagingDirectoryEnabled(session);\n         this.sortedWritingTempStagingPath = getTemporaryStagingDirectoryPath(session);\n         this.immutablePartitions = immutablePartitions;\n-        this.insertExistingPartitionsBehavior = HiveSessionProperties.getInsertExistingPartitionsBehavior(session);\n-        if (immutablePartitions) {\n-            checkArgument(insertExistingPartitionsBehavior != InsertExistingPartitionsBehavior.APPEND, \"insertExistingPartitionsBehavior cannot be APPEND\");\n-        }\n+        this.insertExistingPartitionsBehavior = verifyAndGet(getInsertExistingPartitionsBehavior(session), immutablePartitions);", "state": "SUBMITTED", "replyTo": null, "originalCommit": null, "originalPosition": 18}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3OTQ3MzI5MA==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                    public static InsertExistingPartitionsBehavior verifyAndGet(InsertExistingPartitionsBehavior value, boolean immutable)\n          \n          \n            \n                    public static void validate(InsertExistingPartitionsBehavior value, boolean immutablePartition)", "url": "https://github.com/trinodb/trino/pull/4999#discussion_r479473290", "createdAt": "2020-08-28T18:37:29Z", "author": {"login": "kokosing"}, "path": "presto-hive/src/main/java/io/prestosql/plugin/hive/HiveSessionProperties.java", "diffHunk": "@@ -101,14 +99,21 @@\n         OVERWRITE,\n         /**/;\n \n-        public static InsertExistingPartitionsBehavior valueOf(String value, boolean immutablePartition)\n+        public static InsertExistingPartitionsBehavior decode(String value, HiveConfig hiveConfig)\n         {\n             InsertExistingPartitionsBehavior enumValue = valueOf(value.toUpperCase(ENGLISH));\n-            if (immutablePartition) {\n-                checkArgument(enumValue != APPEND, \"Presto is configured to treat Hive partitions as immutable. %s is not allowed to be set to %s\", INSERT_EXISTING_PARTITIONS_BEHAVIOR, APPEND);\n-            }\n+            return verifyAndGet(enumValue, hiveConfig.isImmutablePartitions());\n+        }\n \n-            return enumValue;\n+        public static InsertExistingPartitionsBehavior getDefaultValue(HiveConfig hiveConfig)\n+        {\n+            return verifyAndGet(hiveConfig.getInsertExistingPartitionsBehavior(), hiveConfig.isImmutablePartitions());\n+        }\n+\n+        public static InsertExistingPartitionsBehavior verifyAndGet(InsertExistingPartitionsBehavior value, boolean immutable)", "state": "SUBMITTED", "replyTo": null, "originalCommit": null, "originalPosition": 29}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3OTQ3Mzc1Mw==", "bodyText": "please do not rename", "url": "https://github.com/trinodb/trino/pull/4999#discussion_r479473753", "createdAt": "2020-08-28T18:38:27Z", "author": {"login": "kokosing"}, "path": "presto-hive/src/main/java/io/prestosql/plugin/hive/HiveSessionProperties.java", "diffHunk": "@@ -101,14 +99,21 @@\n         OVERWRITE,\n         /**/;\n \n-        public static InsertExistingPartitionsBehavior valueOf(String value, boolean immutablePartition)\n+        public static InsertExistingPartitionsBehavior decode(String value, HiveConfig hiveConfig)", "state": "SUBMITTED", "replyTo": null, "originalCommit": null, "originalPosition": 14}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3OTQ3Mzg5Mg==", "bodyText": "please inline this method", "url": "https://github.com/trinodb/trino/pull/4999#discussion_r479473892", "createdAt": "2020-08-28T18:38:48Z", "author": {"login": "kokosing"}, "path": "presto-hive/src/main/java/io/prestosql/plugin/hive/HiveSessionProperties.java", "diffHunk": "@@ -101,14 +99,21 @@\n         OVERWRITE,\n         /**/;\n \n-        public static InsertExistingPartitionsBehavior valueOf(String value, boolean immutablePartition)\n+        public static InsertExistingPartitionsBehavior decode(String value, HiveConfig hiveConfig)\n         {\n             InsertExistingPartitionsBehavior enumValue = valueOf(value.toUpperCase(ENGLISH));\n-            if (immutablePartition) {\n-                checkArgument(enumValue != APPEND, \"Presto is configured to treat Hive partitions as immutable. %s is not allowed to be set to %s\", INSERT_EXISTING_PARTITIONS_BEHAVIOR, APPEND);\n-            }\n+            return verifyAndGet(enumValue, hiveConfig.isImmutablePartitions());\n+        }\n \n-            return enumValue;\n+        public static InsertExistingPartitionsBehavior getDefaultValue(HiveConfig hiveConfig)", "state": "SUBMITTED", "replyTo": null, "originalCommit": null, "originalPosition": 24}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDc4MzkwOTIy", "url": "https://github.com/trinodb/trino/pull/4999#pullrequestreview-478390922", "createdAt": "2020-08-31T07:45:32Z", "commit": null, "state": "COMMENTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0zMVQwNzo0NTozM1rOHJuIpg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0zMVQwODowNTo0OFrOHJuwWw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3OTk1NTExMA==", "bodyText": "You think it worth to keep code as simple as possible\n\nNo. However in this case it is self-explanatory.", "url": "https://github.com/trinodb/trino/pull/4999#discussion_r479955110", "createdAt": "2020-08-31T07:45:33Z", "author": {"login": "kokosing"}, "path": "presto-hive/src/main/java/io/prestosql/plugin/hive/HiveConfig.java", "diffHunk": "@@ -977,4 +995,15 @@ public HiveConfig setProjectionPushdownEnabled(boolean projectionPushdownEnabled\n         this.projectionPushdownEnabled = projectionPushdownEnabled;\n         return this;\n     }\n+\n+    @PostConstruct\n+    public void init()\n+    {\n+        verifyDefaultValueForInsertExistingPartitionsBehaviorCouldBeAssigned();\n+    }\n+\n+    public void verifyDefaultValueForInsertExistingPartitionsBehaviorCouldBeAssigned()\n+    {\n+        verifyAndGet(insertExistingPartitionsBehavior, immutablePartitions);\n+    }", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3OTQ2OTM3MA=="}, "originalCommit": null, "originalPosition": 63}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3OTk2NTI3NQ==", "bodyText": "please inline", "url": "https://github.com/trinodb/trino/pull/4999#discussion_r479965275", "createdAt": "2020-08-31T08:05:48Z", "author": {"login": "kokosing"}, "path": "presto-hive/src/main/java/io/prestosql/plugin/hive/HiveSessionProperties.java", "diffHunk": "@@ -136,9 +141,9 @@ public HiveSessionProperties(\n                         \"Behavior on insert existing partitions; this session property doesn't control behavior on insert existing unpartitioned table\",\n                         VARCHAR,\n                         InsertExistingPartitionsBehavior.class,\n-                        hiveConfig.isImmutablePartitions() ? ERROR : APPEND,\n+                        InsertExistingPartitionsBehavior.getDefaultValue(hiveConfig),", "state": "SUBMITTED", "replyTo": null, "originalCommit": null, "originalPosition": 41}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": null, "afterCommit": null}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": null, "afterCommit": null}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDgwNzE3NDIy", "url": "https://github.com/trinodb/trino/pull/4999#pullrequestreview-480717422", "createdAt": "2020-09-02T11:14:36Z", "commit": null, "state": "COMMENTED", "comments": {"totalCount": 6, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wMlQxMToxNDozNlrOHLqVPw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wMlQxMToxOToyMlrOHLqe1Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MTk4OTk1MQ==", "bodyText": "Please mention other possible values. Also you could shortly explain what each of these options mean.", "url": "https://github.com/trinodb/trino/pull/4999#discussion_r481989951", "createdAt": "2020-09-02T11:14:36Z", "author": {"login": "kokosing"}, "path": "presto-docs/src/main/sphinx/connector/hive.rst", "diffHunk": "@@ -216,6 +216,8 @@ Property Name                                      Description\n \n ``hive.immutable-partitions``                      Can new data be inserted into existing partitions?           ``false``\n \n+``hive.insert-existing-partitions-behavior``       Default value for insert existing partitions behavior.       ``APPEND``", "state": "SUBMITTED", "replyTo": null, "originalCommit": null, "originalPosition": 4}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MTk5MDE0MA==", "bodyText": "shutdown won't be called anyway.", "url": "https://github.com/trinodb/trino/pull/4999#discussion_r481990140", "createdAt": "2020-09-02T11:14:56Z", "author": {"login": "kokosing"}, "path": "presto-hive-hadoop2/src/test/java/io/prestosql/plugin/hive/TestHiveHadoop2Plugin.java", "diffHunk": "@@ -99,6 +99,24 @@ public void testGcsAccessTokenAndHiveCachingMutuallyExclusive()\n                 .hasMessageContaining(\"Use of GCS access token is not compatible with Hive caching\");\n     }\n \n+    @Test\n+    public void testImmutablePartitionsAndInsertOverwriteMutuallyExclusive()\n+    {\n+        Plugin plugin = new HiveHadoop2Plugin();\n+        ConnectorFactory connectorFactory = Iterables.getOnlyElement(plugin.getConnectorFactories());\n+\n+        assertThatThrownBy(() -> connectorFactory.create(\n+                \"test\",\n+                ImmutableMap.<String, String>builder()\n+                        .put(\"hive.insert-existing-partitions-behavior\", \"APPEND\")\n+                        .put(\"hive.immutable-partitions\", \"true\")\n+                        .put(\"hive.metastore.uri\", \"thrift://foo:1234\")\n+                        .build(),\n+                new TestingConnectorContext())\n+                .shutdown())", "state": "SUBMITTED", "replyTo": null, "originalCommit": null, "originalPosition": 18}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MTk5MDg5Nw==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                    this.insertExistingPartitionsBehavior = insertExistingPartitionsBehavior;\n          \n          \n            \n                    this.insertExistingPartitionsBehavior = requireNonNull(insertExistingPartitionsBehavior, \"insertExistingPartitionsBehavior is null\");", "url": "https://github.com/trinodb/trino/pull/4999#discussion_r481990897", "createdAt": "2020-09-02T11:16:28Z", "author": {"login": "kokosing"}, "path": "presto-hive/src/main/java/io/prestosql/plugin/hive/HiveConfig.java", "diffHunk": "@@ -451,6 +455,19 @@ public HiveConfig setImmutablePartitions(boolean immutablePartitions)\n         return this;\n     }\n \n+    public InsertExistingPartitionsBehavior getInsertExistingPartitionsBehavior()\n+    {\n+        return insertExistingPartitionsBehavior;\n+    }\n+\n+    @Config(\"hive.insert-existing-partitions-behavior\")\n+    @ConfigDescription(\"Default value for insert existing partitions behavior\")\n+    public HiveConfig setInsertExistingPartitionsBehavior(InsertExistingPartitionsBehavior insertExistingPartitionsBehavior)\n+    {\n+        this.insertExistingPartitionsBehavior = insertExistingPartitionsBehavior;", "state": "SUBMITTED", "replyTo": null, "originalCommit": null, "originalPosition": 41}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MTk5MTgyNA==", "bodyText": "undo, this is just defensive programming.", "url": "https://github.com/trinodb/trino/pull/4999#discussion_r481991824", "createdAt": "2020-09-02T11:18:17Z", "author": {"login": "kokosing"}, "path": "presto-hive/src/main/java/io/prestosql/plugin/hive/HiveWriterFactory.java", "diffHunk": "@@ -353,7 +348,6 @@ public HiveWriter createWriter(Page partitionColumns, int position, OptionalInt\n                 else {\n                     switch (insertExistingPartitionsBehavior) {\n                         case APPEND:\n-                            checkState(!immutablePartitions);", "state": "SUBMITTED", "replyTo": null, "originalCommit": null, "originalPosition": 41}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MTk5MTg0MQ==", "bodyText": "undo, this is just defensive programming.", "url": "https://github.com/trinodb/trino/pull/4999#discussion_r481991841", "createdAt": "2020-09-02T11:18:19Z", "author": {"login": "kokosing"}, "path": "presto-hive/src/main/java/io/prestosql/plugin/hive/HiveWriterFactory.java", "diffHunk": "@@ -384,7 +378,6 @@ public HiveWriter createWriter(Page partitionColumns, int position, OptionalInt\n             // Write to: an existing partition in an existing partitioned table\n             if (insertExistingPartitionsBehavior == InsertExistingPartitionsBehavior.APPEND) {\n                 // Append to an existing partition\n-                checkState(!immutablePartitions);", "state": "SUBMITTED", "replyTo": null, "originalCommit": null, "originalPosition": 49}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MTk5MjQwNQ==", "bodyText": "do we call validate in getInsertExistingPartitionsBehavior? if not then we should", "url": "https://github.com/trinodb/trino/pull/4999#discussion_r481992405", "createdAt": "2020-09-02T11:19:22Z", "author": {"login": "kokosing"}, "path": "presto-hive/src/main/java/io/prestosql/plugin/hive/HiveWriterFactory.java", "diffHunk": "@@ -199,11 +198,7 @@ public HiveWriterFactory(\n         this.maxOpenSortFiles = maxOpenSortFiles;\n         this.sortedWritingTempStagingPathEnabled = isTemporaryStagingDirectoryEnabled(session);\n         this.sortedWritingTempStagingPath = getTemporaryStagingDirectoryPath(session);\n-        this.immutablePartitions = immutablePartitions;\n-        this.insertExistingPartitionsBehavior = HiveSessionProperties.getInsertExistingPartitionsBehavior(session);\n-        if (immutablePartitions) {\n-            checkArgument(insertExistingPartitionsBehavior != InsertExistingPartitionsBehavior.APPEND, \"insertExistingPartitionsBehavior cannot be APPEND\");\n-        }\n+        this.insertExistingPartitionsBehavior = getInsertExistingPartitionsBehavior(session);", "state": "SUBMITTED", "replyTo": null, "originalCommit": null, "originalPosition": 33}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDgwOTMxOTk3", "url": "https://github.com/trinodb/trino/pull/4999#pullrequestreview-480931997", "createdAt": "2020-09-02T15:18:07Z", "commit": null, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wMlQxNToxODowN1rOHL0Z-A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wMlQxNToxODowN1rOHL0Z-A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MjE1NTAwMA==", "bodyText": "Will we deprecate immutable partitions property?", "url": "https://github.com/trinodb/trino/pull/4999#discussion_r482155000", "createdAt": "2020-09-02T15:18:07Z", "author": {"login": "findepi"}, "path": "presto-hive/src/main/java/io/prestosql/plugin/hive/HiveConfig.java", "diffHunk": "@@ -977,4 +994,10 @@ public HiveConfig setProjectionPushdownEnabled(boolean projectionPushdownEnabled\n         this.projectionPushdownEnabled = projectionPushdownEnabled;\n         return this;\n     }\n+\n+    @PostConstruct\n+    public void validate()\n+    {\n+        InsertExistingPartitionsBehavior.validate(insertExistingPartitionsBehavior, immutablePartitions);", "state": "SUBMITTED", "replyTo": null, "originalCommit": null, "originalPosition": 56}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": null, "afterCommit": null}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": null, "afterCommit": {"oid": "9f6c3163e6e230b83d64dca01486447ae5135a97", "author": {"user": {"login": "tinkerrrr", "name": null}}, "url": "https://github.com/trinodb/trino/commit/9f6c3163e6e230b83d64dca01486447ae5135a97", "committedDate": "2020-09-07T14:34:41Z", "message": "Set HDFS user/group to match destination's when writing"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": null, "afterCommit": null}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDg1ODUwNzU3", "url": "https://github.com/trinodb/trino/pull/4999#pullrequestreview-485850757", "createdAt": "2020-09-10T11:52:34Z", "commit": null, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xMFQxMTo1MjozNFrOHPv62w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xMFQxMTo1MjozNFrOHPv62w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NjI3NTgwMw==", "bodyText": "Why is @PostConstruct validation not enough", "url": "https://github.com/trinodb/trino/pull/4999#discussion_r486275803", "createdAt": "2020-09-10T11:52:34Z", "author": {"login": "losipiuk"}, "path": "presto-hive/src/main/java/io/prestosql/plugin/hive/HiveSessionProperties.java", "diffHunk": "@@ -123,6 +123,9 @@ public HiveSessionProperties(\n             ParquetReaderConfig parquetReaderConfig,\n             ParquetWriterConfig parquetWriterConfig)\n     {\n+        InsertExistingPartitionsBehavior insertExistingPartitionsBehavior = hiveConfig.getInsertExistingPartitionsBehavior();\n+        InsertExistingPartitionsBehavior.validate(insertExistingPartitionsBehavior, hiveConfig.isImmutablePartitions());", "state": "SUBMITTED", "replyTo": null, "originalCommit": null, "originalPosition": 37}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDg1ODYxMjMz", "url": "https://github.com/trinodb/trino/pull/4999#pullrequestreview-485861233", "createdAt": "2020-09-10T12:07:59Z", "commit": null, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xMFQxMjowNzo1OVrOHPwatA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xMFQxMjowNzo1OVrOHPwatA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NjI4Mzk1Ng==", "bodyText": "can not\nOr\nIf ``true`` setting ``hive.insert-existing-partitions-behavior`` to ``APPEND`` is not allowed.", "url": "https://github.com/trinodb/trino/pull/4999#discussion_r486283956", "createdAt": "2020-09-10T12:07:59Z", "author": {"login": "losipiuk"}, "path": "presto-docs/src/main/sphinx/connector/hive.rst", "diffHunk": "@@ -217,6 +217,16 @@ Property Name                                      Description\n                                                    format or the default Presto format?\n \n ``hive.immutable-partitions``                      Can new data be inserted into existing partitions?           ``false``\n+                                                   If ``true`` then\n+                                                   ``hive.insert-existing-partitions-behavior`` could not be", "state": "SUBMITTED", "replyTo": null, "originalCommit": null, "originalPosition": 5}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDg1ODYxNjQ1", "url": "https://github.com/trinodb/trino/pull/4999#pullrequestreview-485861645", "createdAt": "2020-09-10T12:08:35Z", "commit": null, "state": "DISMISSED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": null, "afterCommit": null}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDg2OTY0NDQ2", "url": "https://github.com/trinodb/trino/pull/4999#pullrequestreview-486964446", "createdAt": "2020-09-11T16:46:50Z", "commit": null, "state": "COMMENTED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": null, "afterCommit": null}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDg4NzY5NTY0", "url": "https://github.com/trinodb/trino/pull/4999#pullrequestreview-488769564", "createdAt": "2020-09-15T14:52:23Z", "commit": null, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xNVQxNDo1MjoyM1rOHSF1xg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xNVQxNDo1MjoyM1rOHSF1xg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4ODczMjEwMg==", "bodyText": "nit: you can use concrete type here", "url": "https://github.com/trinodb/trino/pull/4999#discussion_r488732102", "createdAt": "2020-09-15T14:52:23Z", "author": {"login": "losipiuk"}, "path": "presto-hive-hadoop2/src/test/java/io/prestosql/plugin/hive/TestHiveHadoop2Plugin.java", "diffHunk": "@@ -99,6 +103,69 @@ public void testGcsAccessTokenAndHiveCachingMutuallyExclusive()\n                 .hasMessageContaining(\"Use of GCS access token is not compatible with Hive caching\");\n     }\n \n+    @Test\n+    public void testImmutablePartitionsAndInsertOverwriteMutuallyExclusive()\n+    {\n+        Plugin plugin = new HiveHadoop2Plugin();\n+        ConnectorFactory connectorFactory = Iterables.getOnlyElement(plugin.getConnectorFactories());\n+\n+        assertThatThrownBy(() -> connectorFactory.create(\n+                \"test\",\n+                ImmutableMap.<String, String>builder()\n+                        .put(\"hive.insert-existing-partitions-behavior\", \"APPEND\")\n+                        .put(\"hive.immutable-partitions\", \"true\")\n+                        .put(\"hive.metastore.uri\", \"thrift://foo:1234\")\n+                        .build(),\n+                new TestingConnectorContext()))\n+                .hasMessageContaining(\"Presto is configured to treat Hive partitions as immutable. insert_existing_partitions_behavior is not allowed to be set to APPEND\");\n+    }\n+\n+    @Test\n+    public void testInsertOverwriteIsSetToErrorWhenImmutablePartitionsIsTrue()\n+    {\n+        Plugin plugin = new HiveHadoop2Plugin();\n+        ConnectorFactory connectorFactory = Iterables.getOnlyElement(plugin.getConnectorFactories());\n+\n+        Connector connector = connectorFactory.create(\n+                \"test\",\n+                ImmutableMap.<String, String>builder()\n+                        .put(\"hive.immutable-partitions\", \"true\")\n+                        .put(\"hive.metastore.uri\", \"thrift://foo:1234\")\n+                        .build(),\n+                new TestingConnectorContext());\n+\n+        Object actual = getDefaultValueInsertExistingPartitionsBehavior(connector);\n+\n+        assertEquals(ERROR, actual);\n+    }\n+\n+    @Test\n+    public void testInsertOverwriteIsSetToAppendWhenImmutablePartitionsIsFalseByDefault()\n+    {\n+        Plugin plugin = new HiveHadoop2Plugin();\n+        ConnectorFactory connectorFactory = Iterables.getOnlyElement(plugin.getConnectorFactories());\n+\n+        Connector connector = connectorFactory.create(\n+                \"test\",\n+                ImmutableMap.<String, String>builder()\n+                        .put(\"hive.metastore.uri\", \"thrift://foo:1234\")\n+                        .build(),\n+                new TestingConnectorContext());\n+\n+        Object actual = getDefaultValueInsertExistingPartitionsBehavior(connector);\n+\n+        assertEquals(APPEND, actual);\n+    }\n+\n+    private Object getDefaultValueInsertExistingPartitionsBehavior(Connector connector)", "state": "SUBMITTED", "replyTo": null, "originalCommit": null, "originalPosition": 78}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDg4NzcwOTE5", "url": "https://github.com/trinodb/trino/pull/4999#pullrequestreview-488770919", "createdAt": "2020-09-15T14:53:43Z", "commit": null, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDg5MDE0NjI5", "url": "https://github.com/trinodb/trino/pull/4999#pullrequestreview-489014629", "createdAt": "2020-09-15T19:43:35Z", "commit": null, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 6, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xNVQxOTo0MzozNVrOHSR5Mw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xNVQxOTo1OTozOFrOHSScDg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4ODkyOTU4Nw==", "bodyText": "Setters for config beans need to allow null. If null is passed, it should reset to the default value.", "url": "https://github.com/trinodb/trino/pull/4999#discussion_r488929587", "createdAt": "2020-09-15T19:43:35Z", "author": {"login": "electrum"}, "path": "presto-hive/src/main/java/io/prestosql/plugin/hive/HiveConfig.java", "diffHunk": "@@ -452,6 +458,19 @@ public HiveConfig setImmutablePartitions(boolean immutablePartitions)\n         return this;\n     }\n \n+    public InsertExistingPartitionsBehavior getInsertExistingPartitionsBehavior()\n+    {\n+        return insertExistingPartitionsBehavior.orElse(immutablePartitions ? ERROR : APPEND);\n+    }\n+\n+    @Config(\"hive.insert-existing-partitions-behavior\")\n+    @ConfigDescription(\"Default value for insert existing partitions behavior\")\n+    public HiveConfig setInsertExistingPartitionsBehavior(InsertExistingPartitionsBehavior insertExistingPartitionsBehavior)\n+    {\n+        this.insertExistingPartitionsBehavior = Optional.of(requireNonNull(insertExistingPartitionsBehavior, \"insertExistingPartitionsBehavior is null\"));", "state": "SUBMITTED", "replyTo": null, "originalCommit": null, "originalPosition": 43}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4ODkyOTg4Mw==", "bodyText": "This also affects the session property", "url": "https://github.com/trinodb/trino/pull/4999#discussion_r488929883", "createdAt": "2020-09-15T19:44:09Z", "author": {"login": "electrum"}, "path": "presto-docs/src/main/sphinx/connector/hive.rst", "diffHunk": "@@ -217,6 +217,16 @@ Property Name                                      Description\n                                                    format or the default Presto format?\n \n ``hive.immutable-partitions``                      Can new data be inserted into existing partitions?           ``false``\n+                                                   If ``true`` then setting\n+                                                   ``hive.insert-existing-partitions-behavior`` to ``APPEND``", "state": "SUBMITTED", "replyTo": null, "originalCommit": null, "originalPosition": 5}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4ODkzMDI2NQ==", "bodyText": "modifying existing partitions is not allowed", "url": "https://github.com/trinodb/trino/pull/4999#discussion_r488930265", "createdAt": "2020-09-15T19:44:50Z", "author": {"login": "electrum"}, "path": "presto-docs/src/main/sphinx/connector/hive.rst", "diffHunk": "@@ -217,6 +217,16 @@ Property Name                                      Description\n                                                    format or the default Presto format?\n \n ``hive.immutable-partitions``                      Can new data be inserted into existing partitions?           ``false``\n+                                                   If ``true`` then setting\n+                                                   ``hive.insert-existing-partitions-behavior`` to ``APPEND``\n+                                                   is not allowed.\n+\n+``hive.insert-existing-partitions-behavior``       Default value for insert existing partitions behavior.       ``APPEND``\n+                                                   Possible values are\n+\n+                                                   * ``APPEND`` - appends data to existing partitions\n+                                                   * ``OVERWRITE`` - overwrites existing partitions\n+                                                   * ``ERROR``- does not allow to insert data", "state": "SUBMITTED", "replyTo": null, "originalCommit": null, "originalPosition": 13}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4ODkzMTM4MQ==", "bodyText": "While many config properties are technically defaults for session properties, we don't describe them in terms of being a default value. Instead, we say what the config does (as if the session property is unmodified).\n\nWhen happens when data is inserted into an existing partition?", "url": "https://github.com/trinodb/trino/pull/4999#discussion_r488931381", "createdAt": "2020-09-15T19:46:55Z", "author": {"login": "electrum"}, "path": "presto-docs/src/main/sphinx/connector/hive.rst", "diffHunk": "@@ -217,6 +217,16 @@ Property Name                                      Description\n                                                    format or the default Presto format?\n \n ``hive.immutable-partitions``                      Can new data be inserted into existing partitions?           ``false``\n+                                                   If ``true`` then setting\n+                                                   ``hive.insert-existing-partitions-behavior`` to ``APPEND``\n+                                                   is not allowed.\n+\n+``hive.insert-existing-partitions-behavior``       Default value for insert existing partitions behavior.       ``APPEND``", "state": "SUBMITTED", "replyTo": null, "originalCommit": null, "originalPosition": 8}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4ODkzMzY2NQ==", "bodyText": "These arguments are in the wrong order for TestNG. actual comes first. It's easier to read if we inline this\nassertEquals(getDefaultValueInsertExistingPartitionsBehavior(connector), ERROR);\nOr use AssertJ\nassertThat(getDefaultValueInsertExistingPartitionsBehavior(connector)).isEqualTo(ERROR);", "url": "https://github.com/trinodb/trino/pull/4999#discussion_r488933665", "createdAt": "2020-09-15T19:50:42Z", "author": {"login": "electrum"}, "path": "presto-hive-hadoop2/src/test/java/io/prestosql/plugin/hive/TestHiveHadoop2Plugin.java", "diffHunk": "@@ -99,6 +103,69 @@ public void testGcsAccessTokenAndHiveCachingMutuallyExclusive()\n                 .hasMessageContaining(\"Use of GCS access token is not compatible with Hive caching\");\n     }\n \n+    @Test\n+    public void testImmutablePartitionsAndInsertOverwriteMutuallyExclusive()\n+    {\n+        Plugin plugin = new HiveHadoop2Plugin();\n+        ConnectorFactory connectorFactory = Iterables.getOnlyElement(plugin.getConnectorFactories());\n+\n+        assertThatThrownBy(() -> connectorFactory.create(\n+                \"test\",\n+                ImmutableMap.<String, String>builder()\n+                        .put(\"hive.insert-existing-partitions-behavior\", \"APPEND\")\n+                        .put(\"hive.immutable-partitions\", \"true\")\n+                        .put(\"hive.metastore.uri\", \"thrift://foo:1234\")\n+                        .build(),\n+                new TestingConnectorContext()))\n+                .hasMessageContaining(\"Presto is configured to treat Hive partitions as immutable. insert_existing_partitions_behavior is not allowed to be set to APPEND\");\n+    }\n+\n+    @Test\n+    public void testInsertOverwriteIsSetToErrorWhenImmutablePartitionsIsTrue()\n+    {\n+        Plugin plugin = new HiveHadoop2Plugin();\n+        ConnectorFactory connectorFactory = Iterables.getOnlyElement(plugin.getConnectorFactories());\n+\n+        Connector connector = connectorFactory.create(\n+                \"test\",\n+                ImmutableMap.<String, String>builder()\n+                        .put(\"hive.immutable-partitions\", \"true\")\n+                        .put(\"hive.metastore.uri\", \"thrift://foo:1234\")\n+                        .build(),\n+                new TestingConnectorContext());\n+\n+        Object actual = getDefaultValueInsertExistingPartitionsBehavior(connector);\n+\n+        assertEquals(ERROR, actual);", "state": "SUBMITTED", "replyTo": null, "originalCommit": null, "originalPosition": 57}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4ODkzODUxMA==", "bodyText": "This should use bean validation so that the config framework throws a proper error message. You can do this like\n@AssertTrue(message = \"insert-existing-partitions-behavior cannot be APPEND when immutable-partitions is true\")\npublic boolean isInsertExistingPartitionsBehaviorValid()\n{\n    return !immutablePartitions || !insertExistingPartitionsBehavior.equals(Optional.of(APPEND));\n}", "url": "https://github.com/trinodb/trino/pull/4999#discussion_r488938510", "createdAt": "2020-09-15T19:59:38Z", "author": {"login": "electrum"}, "path": "presto-hive/src/main/java/io/prestosql/plugin/hive/HiveConfig.java", "diffHunk": "@@ -980,4 +999,10 @@ public HiveConfig setDynamicFilteringProbeBlockingTimeout(Duration dynamicFilter\n         this.dynamicFilteringProbeBlockingTimeout = dynamicFilteringProbeBlockingTimeout;\n         return this;\n     }\n+\n+    @PostConstruct", "state": "SUBMITTED", "replyTo": null, "originalCommit": null, "originalPosition": 55}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": null, "afterCommit": null}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": null, "afterCommit": null}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDkwMDM0ODI1", "url": "https://github.com/trinodb/trino/pull/4999#pullrequestreview-490034825", "createdAt": "2020-09-16T21:30:31Z", "commit": null, "state": "APPROVED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xNlQyMTozMDozMVrOHTE75w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xNlQyMTozMDozMVrOHTE75w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4OTc2NTg2Mw==", "bodyText": "Missing word \"the\". Let's also expand the note\n\nThis also affects the xxx session property in the same way.\n\nApologies, I should have provided the exact text before.", "url": "https://github.com/trinodb/trino/pull/4999#discussion_r489765863", "createdAt": "2020-09-16T21:30:31Z", "author": {"login": "electrum"}, "path": "presto-docs/src/main/sphinx/connector/hive.rst", "diffHunk": "@@ -217,6 +217,19 @@ Property Name                                      Description\n                                                    format or the default Presto format?\n \n ``hive.immutable-partitions``                      Can new data be inserted into existing partitions?           ``false``\n+                                                   If ``true`` then setting\n+                                                   ``hive.insert-existing-partitions-behavior`` to ``APPEND``\n+                                                   is not allowed.\n+                                                   This also affects ``insert_existing_partitions_behavior``", "state": "SUBMITTED", "replyTo": null, "originalCommit": null, "originalPosition": 7}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "362552c65a1bdaa33f07e939442c21541969d215", "author": {"user": {"login": "ssheikin", "name": "Sasha Sheikin"}}, "url": "https://github.com/trinodb/trino/commit/362552c65a1bdaa33f07e939442c21541969d215", "committedDate": "2020-09-16T22:20:10Z", "message": "Allow to configure insert into Hive partition via configuration property"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "5534628e6bf621f8f04ecc008fdea5e3ca0373cd", "author": {"user": {"login": "ssheikin", "name": "Sasha Sheikin"}}, "url": "https://github.com/trinodb/trino/commit/5534628e6bf621f8f04ecc008fdea5e3ca0373cd", "committedDate": "2020-09-16T22:20:10Z", "message": "Remove unnecessary variable propagation"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": null, "afterCommit": {"oid": "5534628e6bf621f8f04ecc008fdea5e3ca0373cd", "author": {"user": {"login": "ssheikin", "name": "Sasha Sheikin"}}, "url": "https://github.com/trinodb/trino/commit/5534628e6bf621f8f04ecc008fdea5e3ca0373cd", "committedDate": "2020-09-16T22:20:10Z", "message": "Remove unnecessary variable propagation"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4229, "cost": 1, "resetAt": "2021-10-28T20:13:43Z"}}}