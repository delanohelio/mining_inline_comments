{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDcwMTI2NTc0", "number": 4887, "title": "Fix unauthorized error by the benchmark driver", "bodyText": "Although Presto coordinator requires X-Presto-User header for the default authentication, BenchmarkDriver fails to send the header when it gets the list of URIs even a user name is specified by the option.\n$ ./presto-benchmark-driver-341-SNAPSHOT-executable.jar --debug --catalog tpch --user \"a\"\nException in thread \"main\" UnexpectedResponseException{request=Request{uri=http://localhost:8080/v1/service/presto, method=GET, headers={}, bodyGenerator=null, followRedirects=true, preserveAuthorizationOnRedirect=false}, statusCode=401, headers={WWW-Authenticate=[Basic realm=\"Presto\"], Content-Length=[50], Date=[Wed, 19 Aug 2020 06:38:19 GMT], Content-Type=[text/plain;charset=UTF-8]}}\n\tat io.airlift.http.client.JsonResponseHandler.handle(JsonResponseHandler.java:71)\n\tat io.airlift.http.client.jetty.JettyHttpClient.execute(JettyHttpClient.java:549)\n\tat io.prestosql.benchmark.driver.BenchmarkQueryRunner.getAllNodes(BenchmarkQueryRunner.java:278)\n\tat io.prestosql.benchmark.driver.BenchmarkQueryRunner.<init>(BenchmarkQueryRunner.java:98)\n\tat io.prestosql.benchmark.driver.BenchmarkDriver.<init>(BenchmarkDriver.java:50)\n\tat io.prestosql.benchmark.driver.PrestoBenchmarkDriver.run(PrestoBenchmarkDriver.java:111)\n\tat io.prestosql.benchmark.driver.PrestoBenchmarkDriver.main(PrestoBenchmarkDriver.java:52)\n\nFixes #4923", "createdAt": "2020-08-19T12:18:13Z", "url": "https://github.com/trinodb/trino/pull/4887", "merged": true, "mergeCommit": {"oid": "391f98bb48147f2d0e60b196fbf0652b6012ae35"}, "closed": true, "closedAt": "2020-08-26T13:31:42Z", "author": {"login": "Lewuathe"}, "timelineItems": {"totalCount": 6, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdAxi6XgFqTQ3MTcwMzE4Mw==", "endCursor": "Y3Vyc29yOnYyOpPPAAABdCpyptgBqjM2OTQyNjMyNTY=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDcxNzAzMTgz", "url": "https://github.com/trinodb/trino/pull/4887#pullrequestreview-471703183", "createdAt": "2020-08-20T15:00:21Z", "commit": null, "state": "COMMENTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yMFQxNTowMDoyMVrOHEFukw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yMFQxNTowMDozNlrOHEFvQg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NDA1MDE5NQ==", "bodyText": "use requireNonNull(user, \"user is null\")", "url": "https://github.com/trinodb/trino/pull/4887#discussion_r474050195", "createdAt": "2020-08-20T15:00:21Z", "author": {"login": "sopel39"}, "path": "presto-benchmark-driver/src/main/java/io/prestosql/benchmark/driver/BenchmarkQueryRunner.java", "diffHunk": "@@ -95,7 +96,7 @@ public BenchmarkQueryRunner(int warm, int runs, boolean debug, int maxFailures,\n         setupSocksProxy(builder, socksProxy);\n         this.okHttpClient = builder.build();\n \n-        nodes = getAllNodes(requireNonNull(serverUri, \"serverUri is null\"));\n+        nodes = getAllNodes(requireNonNull(serverUri, \"serverUri is null\"), user);", "state": "SUBMITTED", "replyTo": null, "originalCommit": null, "originalPosition": 22}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NDA1MDM3MA==", "bodyText": "can we use dummy user instead of actual user name? I think any username will do in benchmarks", "url": "https://github.com/trinodb/trino/pull/4887#discussion_r474050370", "createdAt": "2020-08-20T15:00:36Z", "author": {"login": "sopel39"}, "path": "presto-benchmark-driver/src/main/java/io/prestosql/benchmark/driver/BenchmarkQueryRunner.java", "diffHunk": "@@ -271,9 +272,9 @@ private long getTotalCpuTime()\n         return TimeUnit.NANOSECONDS.toNanos(totalCpuTime);\n     }\n \n-    private List<URI> getAllNodes(URI server)\n+    private List<URI> getAllNodes(URI server, String user)\n     {\n-        Request request = prepareGet().setUri(uriBuilderFrom(server).replacePath(\"/v1/service/presto\").build()).build();\n+        Request request = prepareGet().setHeader(PrestoHeaders.PRESTO_USER, user).setUri(uriBuilderFrom(server).replacePath(\"/v1/service/presto\").build()).build();", "state": "SUBMITTED", "replyTo": null, "originalCommit": null, "originalPosition": 34}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDcyMjk0ODg3", "url": "https://github.com/trinodb/trino/pull/4887#pullrequestreview-472294887", "createdAt": "2020-08-21T08:16:57Z", "commit": null, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": null, "afterCommit": null}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDczMjI0NjQ1", "url": "https://github.com/trinodb/trino/pull/4887#pullrequestreview-473224645", "createdAt": "2020-08-24T08:32:04Z", "commit": null, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yNFQwODozMjowNFrOHFZxUg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yNFQwODozMjowNFrOHFZxUg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NTQyNzE1NA==", "bodyText": "make it requireNonNull(user, \"user is null\")", "url": "https://github.com/trinodb/trino/pull/4887#discussion_r475427154", "createdAt": "2020-08-24T08:32:04Z", "author": {"login": "sopel39"}, "path": "presto-benchmark-driver/src/main/java/io/prestosql/benchmark/driver/BenchmarkQueryRunner.java", "diffHunk": "@@ -95,7 +96,7 @@ public BenchmarkQueryRunner(int warm, int runs, boolean debug, int maxFailures,\n         setupSocksProxy(builder, socksProxy);\n         this.okHttpClient = builder.build();\n \n-        nodes = getAllNodes(requireNonNull(serverUri, \"serverUri is null\"));\n+        nodes = getAllNodes(requireNonNull(serverUri, \"serverUri is null\"), requireNonNull(user));", "state": "SUBMITTED", "replyTo": null, "originalCommit": null, "originalPosition": 22}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "860c070a59fe05fe2a90f574afafb0cb7e1cd267", "author": {"user": {"login": "Lewuathe", "name": "Kai Sasaki"}}, "url": "https://github.com/trinodb/trino/commit/860c070a59fe05fe2a90f574afafb0cb7e1cd267", "committedDate": "2020-08-26T11:06:16Z", "message": "Fix unauthorized error by the benchmark driver\n\nAlthough Presto coordinator requires X-Presto-User header for the\ndefault authentication, BenchmarkDriver fails to send the header to get\nthe list of URIs."}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": null, "afterCommit": {"oid": "860c070a59fe05fe2a90f574afafb0cb7e1cd267", "author": {"user": {"login": "Lewuathe", "name": "Kai Sasaki"}}, "url": "https://github.com/trinodb/trino/commit/860c070a59fe05fe2a90f574afafb0cb7e1cd267", "committedDate": "2020-08-26T11:06:16Z", "message": "Fix unauthorized error by the benchmark driver\n\nAlthough Presto coordinator requires X-Presto-User header for the\ndefault authentication, BenchmarkDriver fails to send the header to get\nthe list of URIs."}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4453, "cost": 1, "resetAt": "2021-10-28T20:13:43Z"}}}