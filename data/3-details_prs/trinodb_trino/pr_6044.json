{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTI1MjMxNjY2", "number": 6044, "title": "Add documentation for subnet based topology", "bodyText": "Fix #5923 .", "createdAt": "2020-11-22T05:05:51Z", "url": "https://github.com/trinodb/trino/pull/6044", "merged": true, "mergeCommit": {"oid": "fcb565a6bb85f6719f344a714388ec02c97aff2d"}, "closed": true, "closedAt": "2020-12-07T22:48:53Z", "author": {"login": "phd3"}, "timelineItems": {"totalCount": 9, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdfbwVTgFqTUzNjg0MjU0NQ==", "endCursor": "Y3Vyc29yOnYyOpPPAAABdfxR4ZABqjQwMzUwMzQxMzE=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTM2ODQyNTQ1", "url": "https://github.com/trinodb/trino/pull/6044#pullrequestreview-536842545", "createdAt": "2020-11-23T21:02:35Z", "commit": null, "state": "APPROVED", "comments": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0yM1QyMTowMjozNVrOH4fNjQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0yM1QyMTowODo1NlrOH4fZFA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyODk5MzY3Nw==", "bodyText": "Maybe make this a list", "url": "https://github.com/trinodb/trino/pull/6044#discussion_r528993677", "createdAt": "2020-11-23T21:02:35Z", "author": {"login": "electrum"}, "path": "presto-docs/src/main/sphinx/admin/properties-node-scheduler.rst", "diffHunk": "@@ -76,12 +76,22 @@ For example, setting ``region,rack,machine`` means a network location contains t\n ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n \n * **Type:** ``string``\n-* **Allowed values:** ``flat``, ``file``\n+* **Allowed values:** ``flat``, ``file``, ``subnet``\n * **Default value:** ``flat``\n \n-Sets the network topology type. To use this option, ``node-scheduler.policy`` must be set to\n-``topology``. ``flat`` has only one segment, with one value for each machine.\n-``file`` loads the topology from a file as described below.\n+Sets the network topology type. To use this option, ``node-scheduler.policy``\n+must be set to ``topology``.\n+\n+``flat`` : the topology has only one segment, with one value for each machine.", "state": "SUBMITTED", "replyTo": null, "originalCommit": null, "originalPosition": 14}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyODk5NTk0Ng==", "bodyText": "This is fine, but we could simplify it a bit if we add new sections. Then we don't need to mention properties here, or mention the type in the properties descriptions below.\nNetwork topology\n----------------\n\n...\n\n``file`` network topology\n-------------------------\n\n...\n\n``subnet`` network topology\n---------------------------\n\n...", "url": "https://github.com/trinodb/trino/pull/6044#discussion_r528995946", "createdAt": "2020-11-23T21:07:24Z", "author": {"login": "electrum"}, "path": "presto-docs/src/main/sphinx/admin/properties-node-scheduler.rst", "diffHunk": "@@ -76,12 +76,22 @@ For example, setting ``region,rack,machine`` means a network location contains t\n ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n \n * **Type:** ``string``\n-* **Allowed values:** ``flat``, ``file``\n+* **Allowed values:** ``flat``, ``file``, ``subnet``\n * **Default value:** ``flat``\n \n-Sets the network topology type. To use this option, ``node-scheduler.policy`` must be set to\n-``topology``. ``flat`` has only one segment, with one value for each machine.\n-``file`` loads the topology from a file as described below.\n+Sets the network topology type. To use this option, ``node-scheduler.policy``\n+must be set to ``topology``.\n+\n+``flat`` : the topology has only one segment, with one value for each machine.\n+\n+``file``: the topology is loaded from a file using", "state": "SUBMITTED", "replyTo": null, "originalCommit": null, "originalPosition": 16}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyODk5NjIyOQ==", "bodyText": "Remove \"expected\" word", "url": "https://github.com/trinodb/trino/pull/6044#discussion_r528996229", "createdAt": "2020-11-23T21:08:02Z", "author": {"login": "electrum"}, "path": "presto-docs/src/main/sphinx/admin/properties-node-scheduler.rst", "diffHunk": "@@ -108,3 +118,28 @@ network location, separated by whitespace. Network location must begin with a le\n \n Controls how often the network topology file is reloaded.  To use this option,\n ``node-scheduler.network-topology.type`` must be set to ``file``.\n+\n+``node-scheduler.network-topology.subnet.ip-address-protocol``\n+^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n+\n+* **Type:** ``string``\n+* **Allowed values:** ``IPv4``, ``IPv6``\n+* **Default value:** ``IPv4``\n+\n+Sets the expected IP address protocol to be used for computing subnet based", "state": "SUBMITTED", "replyTo": null, "originalCommit": null, "originalPosition": 39}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyODk5NjQ1MQ==", "bodyText": "Remove \"expects\"\n\nA comma-separated list of ...", "url": "https://github.com/trinodb/trino/pull/6044#discussion_r528996451", "createdAt": "2020-11-23T21:08:33Z", "author": {"login": "electrum"}, "path": "presto-docs/src/main/sphinx/admin/properties-node-scheduler.rst", "diffHunk": "@@ -108,3 +118,28 @@ network location, separated by whitespace. Network location must begin with a le\n \n Controls how often the network topology file is reloaded.  To use this option,\n ``node-scheduler.network-topology.type`` must be set to ``file``.\n+\n+``node-scheduler.network-topology.subnet.ip-address-protocol``\n+^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n+\n+* **Type:** ``string``\n+* **Allowed values:** ``IPv4``, ``IPv6``\n+* **Default value:** ``IPv4``\n+\n+Sets the expected IP address protocol to be used for computing subnet based\n+topology.  To use this option, ``node-scheduler.network-topology.type`` must\n+be set to ``subnet``.\n+\n+``node-scheduler.network-topology.subnet.cidr-prefix-lengths``\n+^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n+\n+Expects a comma-separated list of integers defining CIDR prefix lengths for", "state": "SUBMITTED", "replyTo": null, "originalCommit": null, "originalPosition": 46}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyODk5NjYyOA==", "bodyText": "Capitalize IP", "url": "https://github.com/trinodb/trino/pull/6044#discussion_r528996628", "createdAt": "2020-11-23T21:08:56Z", "author": {"login": "electrum"}, "path": "presto-docs/src/main/sphinx/admin/properties-node-scheduler.rst", "diffHunk": "@@ -108,3 +118,28 @@ network location, separated by whitespace. Network location must begin with a le\n \n Controls how often the network topology file is reloaded.  To use this option,\n ``node-scheduler.network-topology.type`` must be set to ``file``.\n+\n+``node-scheduler.network-topology.subnet.ip-address-protocol``\n+^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n+\n+* **Type:** ``string``\n+* **Allowed values:** ``IPv4``, ``IPv6``\n+* **Default value:** ``IPv4``\n+\n+Sets the expected IP address protocol to be used for computing subnet based\n+topology.  To use this option, ``node-scheduler.network-topology.type`` must\n+be set to ``subnet``.\n+\n+``node-scheduler.network-topology.subnet.cidr-prefix-lengths``\n+^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n+\n+Expects a comma-separated list of integers defining CIDR prefix lengths for\n+subnet masks. The prefix lengths must be in increasing order. The maximum prefix\n+length values for IPv4 and IPv6 protocols are 32 and 128 respectively. To use\n+this option, ``node-scheduler.network-topology.type`` must be set to ``subnet``.\n+\n+For example, the value ``24,25,27`` for this property with IPv4 protocol means\n+that masks applied on the ip address to compute location segments would be", "state": "SUBMITTED", "replyTo": null, "originalCommit": null, "originalPosition": 52}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTM2ODg5MjA3", "url": "https://github.com/trinodb/trino/pull/6044#pullrequestreview-536889207", "createdAt": "2020-11-23T22:18:34Z", "commit": null, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0yM1QyMjoxODozNFrOH4hkZQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0yM1QyMjoxODozNFrOH4hkZQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyOTAzMjI5Mw==", "bodyText": "\"are\" instead of \"would be\"", "url": "https://github.com/trinodb/trino/pull/6044#discussion_r529032293", "createdAt": "2020-11-23T22:18:34Z", "author": {"login": "mosabua"}, "path": "presto-docs/src/main/sphinx/admin/properties-node-scheduler.rst", "diffHunk": "@@ -108,3 +118,28 @@ network location, separated by whitespace. Network location must begin with a le\n \n Controls how often the network topology file is reloaded.  To use this option,\n ``node-scheduler.network-topology.type`` must be set to ``file``.\n+\n+``node-scheduler.network-topology.subnet.ip-address-protocol``\n+^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n+\n+* **Type:** ``string``\n+* **Allowed values:** ``IPv4``, ``IPv6``\n+* **Default value:** ``IPv4``\n+\n+Sets the expected IP address protocol to be used for computing subnet based\n+topology.  To use this option, ``node-scheduler.network-topology.type`` must\n+be set to ``subnet``.\n+\n+``node-scheduler.network-topology.subnet.cidr-prefix-lengths``\n+^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n+\n+Expects a comma-separated list of integers defining CIDR prefix lengths for\n+subnet masks. The prefix lengths must be in increasing order. The maximum prefix\n+length values for IPv4 and IPv6 protocols are 32 and 128 respectively. To use\n+this option, ``node-scheduler.network-topology.type`` must be set to ``subnet``.\n+\n+For example, the value ``24,25,27`` for this property with IPv4 protocol means\n+that masks applied on the ip address to compute location segments would be\n+``255.255.255.0``, ``255.255.255.192`` and ``255.255.255.224``. So the segments\n+created for an address ``192.168.0.172`` would be ``[192.168.0.0, 192.168.0.128,", "state": "SUBMITTED", "replyTo": null, "originalCommit": null, "originalPosition": 54}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTM2ODg5NDE4", "url": "https://github.com/trinodb/trino/pull/6044#pullrequestreview-536889418", "createdAt": "2020-11-23T22:18:55Z", "commit": null, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0yM1QyMjoxODo1NVrOH4hk_g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0yM1QyMjoxODo1NVrOH4hk_g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyOTAzMjQ0Ng==", "bodyText": "described in the following sections.", "url": "https://github.com/trinodb/trino/pull/6044#discussion_r529032446", "createdAt": "2020-11-23T22:18:55Z", "author": {"login": "mosabua"}, "path": "presto-docs/src/main/sphinx/admin/properties-node-scheduler.rst", "diffHunk": "@@ -76,12 +76,22 @@ For example, setting ``region,rack,machine`` means a network location contains t\n ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n \n * **Type:** ``string``\n-* **Allowed values:** ``flat``, ``file``\n+* **Allowed values:** ``flat``, ``file``, ``subnet``\n * **Default value:** ``flat``\n \n-Sets the network topology type. To use this option, ``node-scheduler.policy`` must be set to\n-``topology``. ``flat`` has only one segment, with one value for each machine.\n-``file`` loads the topology from a file as described below.\n+Sets the network topology type. To use this option, ``node-scheduler.policy``\n+must be set to ``topology``.\n+\n+``flat`` : the topology has only one segment, with one value for each machine.\n+\n+``file``: the topology is loaded from a file using\n+``node-scheduler.network-topology.file`` and\n+``node-scheduler.network-topology.refresh-period`` properties described below.\n+\n+``subnet``: the topology is derived based on subnet configuration provided\n+through properties ``node-scheduler.network-topology.subnet.cidr-prefix-lengths``\n+and ``node-scheduler.network-topology.subnet.ip-address-protocol`` described\n+below.", "state": "SUBMITTED", "replyTo": null, "originalCommit": null, "originalPosition": 23}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTM2ODkwNzgx", "url": "https://github.com/trinodb/trino/pull/6044#pullrequestreview-536890781", "createdAt": "2020-11-23T22:21:14Z", "commit": null, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": null, "afterCommit": null}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTM3Nzk0MDU0", "url": "https://github.com/trinodb/trino/pull/6044#pullrequestreview-537794054", "createdAt": "2020-11-24T18:27:59Z", "commit": null, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0yNFQxODoyODowMFrOH5P3RA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0yNFQxODoyODowMFrOH5P3RA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyOTc5MDc4OA==", "bodyText": "This makes the section header have the same \"level\" as the properties above. Instead, add a new header at the top\nSplits\n------\n\nLeave the properties with the ^^^ header, and use --- for the other headers:\nNetwork topology\n----------------\n\nThis will keep everything consistent", "url": "https://github.com/trinodb/trino/pull/6044#discussion_r529790788", "createdAt": "2020-11-24T18:28:00Z", "author": {"login": "electrum"}, "path": "presto-docs/src/main/sphinx/admin/properties-node-scheduler.rst", "diffHunk": "@@ -63,8 +63,11 @@ distribution across all hosts. ``topology`` tries to schedule splits according t\n the topology distance between nodes and splits. It is recommended to use ``uniform``\n for clusters where distributed storage runs on the same nodes as Presto workers.\n \n+Network topology\n+^^^^^^^^^^^^^^^^", "state": "SUBMITTED", "replyTo": null, "originalCommit": null, "originalPosition": 5}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": null, "afterCommit": null}, {"__typename": "PullRequestCommit", "commit": {"oid": "9a6ff8eafc83cf388478fd96c1cc2989b6b7f7b6", "author": {"user": {"login": "phd3", "name": "Pratham"}}, "url": "https://github.com/trinodb/trino/commit/9a6ff8eafc83cf388478fd96c1cc2989b6b7f7b6", "committedDate": "2020-11-24T22:13:40Z", "message": "Add documentation for subnet based topology"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": null, "afterCommit": {"oid": "9a6ff8eafc83cf388478fd96c1cc2989b6b7f7b6", "author": {"user": {"login": "phd3", "name": "Pratham"}}, "url": "https://github.com/trinodb/trino/commit/9a6ff8eafc83cf388478fd96c1cc2989b6b7f7b6", "committedDate": "2020-11-24T22:13:40Z", "message": "Add documentation for subnet based topology"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2228, "cost": 1, "resetAt": "2021-10-28T20:13:43Z"}}}