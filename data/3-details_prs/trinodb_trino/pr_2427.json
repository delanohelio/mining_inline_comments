{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0MzU5OTAxNjY2", "number": 2427, "title": "Allow to convert to varchar an unsupported type in Phoenix", "bodyText": "Allow to convert to varchar an unsupported type in Phoenix", "createdAt": "2020-01-07T09:31:50Z", "url": "https://github.com/trinodb/trino/pull/2427", "merged": true, "mergeCommit": {"oid": "02f9903b26565a97e5322aa594d4761134bf4ea9"}, "closed": true, "closedAt": "2020-01-08T19:30:50Z", "author": {"login": "kokosing"}, "timelineItems": {"totalCount": 17, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABb3-I2ugBqjI5MjcxMzgyNDk=", "endCursor": "Y3Vyc29yOnYyOpPPAAABb4XhWgAFqTMzOTk2NDM5OA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "HeadRefForcePushedEvent", "beforeCommit": null, "afterCommit": null}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": null, "afterCommit": null}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": null, "afterCommit": null}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzM5NjEwODY3", "url": "https://github.com/trinodb/trino/pull/2427#pullrequestreview-339610867", "createdAt": "2020-01-08T01:55:37Z", "commit": null, "state": "COMMENTED", "comments": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0wOFQwMTo1NTozN1rOFbK6sw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0wOFQwMjoyMTozMVrOFbLNkw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NDAzNDczOQ==", "bodyText": "We should remove setUnsupportedTypeHandling instead of setJdbcTypesMappedToVarchar", "url": "https://github.com/trinodb/trino/pull/2427#discussion_r364034739", "createdAt": "2020-01-08T01:55:37Z", "author": {"login": "ebyhr"}, "path": "presto-base-jdbc/src/test/java/io/prestosql/plugin/jdbc/TestBaseJdbcConfig.java", "diffHunk": "@@ -36,7 +36,6 @@ public void testDefaults()\n                 .setConnectionUrl(null)\n                 .setCaseInsensitiveNameMatching(false)\n                 .setCaseInsensitiveNameMatchingCacheTtl(new Duration(1, MINUTES))\n-                .setJdbcTypesMappedToVarchar(null)\n                 .setUnsupportedTypeHandling(UnsupportedTypeHandling.IGNORE)", "state": "SUBMITTED", "replyTo": null, "originalCommit": null, "originalPosition": 5}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NDAzNTUwMQ==", "bodyText": "Revert (other properties have @ConfigDescription)\nAlso, we can remove unused unsupportedTypeHandling variable.", "url": "https://github.com/trinodb/trino/pull/2427#discussion_r364035501", "createdAt": "2020-01-08T01:59:44Z", "author": {"login": "ebyhr"}, "path": "presto-base-jdbc/src/main/java/io/prestosql/plugin/jdbc/BaseJdbcConfig.java", "diffHunk": "@@ -16,7 +16,6 @@\n import com.google.common.base.Splitter;\n import com.google.common.collect.ImmutableSet;\n import io.airlift.configuration.Config;\n-import io.airlift.configuration.ConfigDescription;", "state": "SUBMITTED", "replyTo": null, "originalCommit": null, "originalPosition": 4}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NDAzOTE0OA==", "bodyText": "PostgreSqlClient also has the same logic.", "url": "https://github.com/trinodb/trino/pull/2427#discussion_r364039148", "createdAt": "2020-01-08T02:19:17Z", "author": {"login": "ebyhr"}, "path": "presto-base-jdbc/src/main/java/io/prestosql/plugin/jdbc/BaseJdbcClient.java", "diffHunk": "@@ -272,7 +272,10 @@ public BaseJdbcClient(\n                             .setComment(comment)\n                             .build());\n                 }\n-                verify(columnMapping.isPresent() || getUnsupportedTypeHandling(session) == IGNORE, \"Unsupported type handling is set to %s, but toPrestoType() returned empty\");", "state": "SUBMITTED", "replyTo": null, "originalCommit": null, "originalPosition": 20}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NDAzOTU3MQ==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                    executeInPhoenix(\"DROP TABLE tpch.test_timestamp\");\n          \n          \n            \n                    assertUpdate(\"DROP TABLE test_timestamp\");", "url": "https://github.com/trinodb/trino/pull/2427#discussion_r364039571", "createdAt": "2020-01-08T02:21:31Z", "author": {"login": "ebyhr"}, "path": "presto-phoenix/src/test/java/io/prestosql/plugin/phoenix/TestPhoenixIntegrationSmokeTest.java", "diffHunk": "@@ -73,6 +76,36 @@ public void testMultipleSomeColumnsRangesPredicate()\n         assertQuery(\"SELECT orderkey, shippriority, clerk, totalprice, custkey FROM orders WHERE orderkey BETWEEN 10 AND 50 OR orderkey BETWEEN 100 AND 150\");\n     }\n \n+    @Test\n+    public void testUnsupportedType()\n+            throws Exception\n+    {\n+        executeInPhoenix(\"CREATE TABLE tpch.test_timestamp (pk bigint primary key, val1 timestamp)\");\n+        executeInPhoenix(\"UPSERT INTO tpch.test_timestamp (pk, val1) VALUES (1, null)\");\n+        executeInPhoenix(\"UPSERT INTO tpch.test_timestamp (pk, val1) VALUES (2, '2002-05-30T09:30:10.5')\");\n+        assertUpdate(\"INSERT INTO test_timestamp VALUES (3)\", 1);\n+        assertQuery(\"SELECT * FROM test_timestamp\", \"VALUES 1, 2, 3\");\n+        assertQuery(\n+                withUnsupportedType(CONVERT_TO_VARCHAR),\n+                \"SELECT * FROM test_timestamp\",\n+                \"VALUES \" +\n+                        \"(1, null), \" +\n+                        \"(2, '2002-05-30 09:30:10.500'), \" +\n+                        \"(3, null)\");\n+        assertQueryFails(\n+                withUnsupportedType(CONVERT_TO_VARCHAR),\n+                \"INSERT INTO test_timestamp VALUES (4, '2002-05-30 09:30:10.500')\",\n+                \"Underlying type that is mapped to VARCHAR is not supported for INSERT: TIMESTAMP\");\n+        executeInPhoenix(\"DROP TABLE tpch.test_timestamp\");", "state": "SUBMITTED", "replyTo": null, "originalCommit": null, "originalPosition": 47}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": null, "afterCommit": null}, {"__typename": "PullRequestCommit", "commit": {"oid": "955bbdffd66f822726ce3e6fd214ab354084db99", "author": {"user": {"login": "kokosing", "name": "Grzegorz Kokosi\u0144ski"}}, "url": "https://github.com/trinodb/trino/commit/955bbdffd66f822726ce3e6fd214ab354084db99", "committedDate": "2020-01-08T12:14:29Z", "message": "Remove extra annotations"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": null, "afterCommit": null}, {"__typename": "PullRequestCommit", "commit": {"oid": "94a535ecc59ee65247e3f669519260715e5a9167", "author": {"user": {"login": "kokosing", "name": "Grzegorz Kokosi\u0144ski"}}, "url": "https://github.com/trinodb/trino/commit/94a535ecc59ee65247e3f669519260715e5a9167", "committedDate": "2020-01-08T13:53:44Z", "message": "Extract TypeHandlingJdbcConfig from BaseJdbcConfig"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "cc803d1395f0889e351f47402f41ca9293d43ff8", "author": {"user": {"login": "kokosing", "name": "Grzegorz Kokosi\u0144ski"}}, "url": "https://github.com/trinodb/trino/commit/cc803d1395f0889e351f47402f41ca9293d43ff8", "committedDate": "2020-01-08T13:53:44Z", "message": "Rename BaseJdbcPropertiesProvider to TypeHandlingJdbcPropertiesProvider"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "3213d094461a450ff99e2fc601588864e12698de", "author": {"user": {"login": "kokosing", "name": "Grzegorz Kokosi\u0144ski"}}, "url": "https://github.com/trinodb/trino/commit/3213d094461a450ff99e2fc601588864e12698de", "committedDate": "2020-01-08T13:53:44Z", "message": "Fix error message\n\nSessions properties are registered per catalog (an instance of\nconnector)."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "614ab80ce63f75d70c6dca89cb310f74aea3d12a", "author": {"user": {"login": "kokosing", "name": "Grzegorz Kokosi\u0144ski"}}, "url": "https://github.com/trinodb/trino/commit/614ab80ce63f75d70c6dca89cb310f74aea3d12a", "committedDate": "2020-01-08T13:53:44Z", "message": "Remove unused variable"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a6f310505edf9aa23eec5cf658e6b9dcd9f3cba9", "author": {"user": {"login": "kokosing", "name": "Grzegorz Kokosi\u0144ski"}}, "url": "https://github.com/trinodb/trino/commit/a6f310505edf9aa23eec5cf658e6b9dcd9f3cba9", "committedDate": "2020-01-08T13:53:44Z", "message": "Remove unused class"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "adc2e4070f92be0a54fc2fb4bd00c62ec213f19d", "author": {"user": {"login": "kokosing", "name": "Grzegorz Kokosi\u0144ski"}}, "url": "https://github.com/trinodb/trino/commit/adc2e4070f92be0a54fc2fb4bd00c62ec213f19d", "committedDate": "2020-01-08T13:53:45Z", "message": "Add missing argument to an verify message"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a374cf7044cac87bd04b164c9cc6fc86e620c95b", "author": {"user": {"login": "kokosing", "name": "Grzegorz Kokosi\u0144ski"}}, "url": "https://github.com/trinodb/trino/commit/a374cf7044cac87bd04b164c9cc6fc86e620c95b", "committedDate": "2020-01-08T13:53:45Z", "message": "Break switch instead of copying code"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c49faf8a12765a259638f9f16922dd3878da1db7", "author": {"user": {"login": "kokosing", "name": "Grzegorz Kokosi\u0144ski"}}, "url": "https://github.com/trinodb/trino/commit/c49faf8a12765a259638f9f16922dd3878da1db7", "committedDate": "2020-01-08T13:53:45Z", "message": "Allow to convert to varchar an unsupported type in Phoenix"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": null, "afterCommit": {"oid": "c49faf8a12765a259638f9f16922dd3878da1db7", "author": {"user": {"login": "kokosing", "name": "Grzegorz Kokosi\u0144ski"}}, "url": "https://github.com/trinodb/trino/commit/c49faf8a12765a259638f9f16922dd3878da1db7", "committedDate": "2020-01-08T13:53:45Z", "message": "Allow to convert to varchar an unsupported type in Phoenix"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzM5OTY0Mzk4", "url": "https://github.com/trinodb/trino/pull/2427#pullrequestreview-339964398", "createdAt": "2020-01-08T15:58:56Z", "commit": {"oid": "c49faf8a12765a259638f9f16922dd3878da1db7"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1043, "cost": 1, "resetAt": "2021-10-28T19:08:13Z"}}}