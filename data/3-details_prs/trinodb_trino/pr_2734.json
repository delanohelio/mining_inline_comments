{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0MzcxMjU4MTkw", "number": 2734, "title": "Remove getTable call from updatePartitionStatistics", "bodyText": "", "createdAt": "2020-02-05T09:08:27Z", "url": "https://github.com/trinodb/trino/pull/2734", "merged": true, "mergeCommit": {"oid": "219e86b9fb274e851a4eaa6df76b6eb1bb4cfe8b"}, "closed": true, "closedAt": "2020-02-17T08:56:45Z", "author": {"login": "rohangarg"}, "timelineItems": {"totalCount": 13, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcBSmSVgFqTM1MzU2MzI0MA==", "endCursor": "Y3Vyc29yOnYyOpPPAAABcFJc0yAFqTM1OTU3MTA3NA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzUzNTYzMjQw", "url": "https://github.com/trinodb/trino/pull/2734#pullrequestreview-353563240", "createdAt": "2020-02-05T09:17:33Z", "commit": null, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0wNVQwOToxNzozM1rOFlwkTA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0wNVQwOToxNzozM1rOFlwkTA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NTEzNzM1Ng==", "bodyText": "use HiveMetastoreClousure here", "url": "https://github.com/trinodb/trino/pull/2734#discussion_r375137356", "createdAt": "2020-02-05T09:17:33Z", "author": {"login": "sopel39"}, "path": "presto-hive/src/main/java/io/prestosql/plugin/hive/DropStatsProcedure.java", "diffHunk": "@@ -97,6 +99,8 @@ private void doDropStats(ConnectorSession session, String schema, String table,\n                 .filter(HiveColumnHandle::isPartitionKey)\n                 .map(HiveColumnHandle::getName)\n                 .collect(toImmutableList());\n+        Table tableMetadata = metastore.getTable(new HiveIdentity(session.getIdentity()), schema, table)", "state": "SUBMITTED", "replyTo": null, "originalCommit": null, "originalPosition": 18}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": null, "afterCommit": null}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": null, "afterCommit": null}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": null, "afterCommit": null}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzU1ODE3OTcx", "url": "https://github.com/trinodb/trino/pull/2734#pullrequestreview-355817971", "createdAt": "2020-02-10T10:12:37Z", "commit": null, "state": "COMMENTED", "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xMFQxMDoxMjozN1rOFngbtA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xMFQxMDoyMDo0N1rOFngrvA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3Njk3MDE2NA==", "bodyText": "the methods here are either not implement (throw) or implemented.", "url": "https://github.com/trinodb/trino/pull/2734#discussion_r376970164", "createdAt": "2020-02-10T10:12:37Z", "author": {"login": "findepi"}, "path": "presto-hive/src/test/java/io/prestosql/plugin/hive/metastore/thrift/MockThriftMetastoreClient.java", "diffHunk": "@@ -218,7 +218,8 @@ public void deleteTableColumnStatistics(String databaseName, String tableName, S\n     @Override\n     public void setPartitionColumnStatistics(String databaseName, String tableName, String partitionName, List<ColumnStatisticsObj> statistics)\n     {\n-        throw new UnsupportedOperationException();\n+        accessCount.incrementAndGet();\n+        // No-op", "state": "SUBMITTED", "replyTo": null, "originalCommit": null, "originalPosition": 6}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3Njk3MDE5OQ==", "bodyText": "as above", "url": "https://github.com/trinodb/trino/pull/2734#discussion_r376970199", "createdAt": "2020-02-10T10:12:42Z", "author": {"login": "findepi"}, "path": "presto-hive/src/test/java/io/prestosql/plugin/hive/metastore/thrift/MockThriftMetastoreClient.java", "diffHunk": "@@ -346,7 +347,8 @@ public boolean dropPartition(String databaseName, String tableName, List<String>\n     @Override\n     public void alterPartition(String databaseName, String tableName, Partition partition)\n     {\n-        throw new UnsupportedOperationException();\n+        accessCount.incrementAndGet();\n+        // No-op", "state": "SUBMITTED", "replyTo": null, "originalCommit": null, "originalPosition": 16}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3Njk3NDI2OA==", "bodyText": "@sopel39 @electrum what about replacing MockThriftMetastoreClient with InMemoryThriftMetastore (+ access counting wrapper) in TestCachingHiveMetastore?", "url": "https://github.com/trinodb/trino/pull/2734#discussion_r376974268", "createdAt": "2020-02-10T10:20:47Z", "author": {"login": "findepi"}, "path": "presto-hive/src/test/java/io/prestosql/plugin/hive/metastore/thrift/MockThriftMetastoreClient.java", "diffHunk": "@@ -218,7 +218,8 @@ public void deleteTableColumnStatistics(String databaseName, String tableName, S\n     @Override\n     public void setPartitionColumnStatistics(String databaseName, String tableName, String partitionName, List<ColumnStatisticsObj> statistics)\n     {\n-        throw new UnsupportedOperationException();\n+        accessCount.incrementAndGet();\n+        // No-op", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3Njk3MDE2NA=="}, "originalCommit": null, "originalPosition": 6}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzU2NjAxMzcw", "url": "https://github.com/trinodb/trino/pull/2734#pullrequestreview-356601370", "createdAt": "2020-02-11T12:00:48Z", "commit": null, "state": "COMMENTED", "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xMVQxMjowMDo0OFrOFoGaJw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xMVQxMjowMzoxNFrOFoGd4Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NzU5MjM1OQ==", "bodyText": "just make metastore field a HiveMetastoreClosure", "url": "https://github.com/trinodb/trino/pull/2734#discussion_r377592359", "createdAt": "2020-02-11T12:00:48Z", "author": {"login": "sopel39"}, "path": "presto-hive/src/main/java/io/prestosql/plugin/hive/DropStatsProcedure.java", "diffHunk": "@@ -97,6 +97,7 @@ private void doDropStats(ConnectorSession session, String schema, String table,\n                 .filter(HiveColumnHandle::isPartitionKey)\n                 .map(HiveColumnHandle::getName)\n                 .collect(toImmutableList());\n+        HiveMetastoreClosure hiveMetastore = new HiveMetastoreClosure(metastore);", "state": "SUBMITTED", "replyTo": null, "originalCommit": null, "originalPosition": 4}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NzU5MjgwNA==", "bodyText": "add a commit that adds this test as a first commit.\nThen you will be able to show improvement with Remove getTable ... commit", "url": "https://github.com/trinodb/trino/pull/2734#discussion_r377592804", "createdAt": "2020-02-11T12:01:56Z", "author": {"login": "sopel39"}, "path": "presto-hive/src/test/java/io/prestosql/plugin/hive/metastore/cache/TestCachingHiveMetastore.java", "diffHunk": "@@ -285,6 +286,18 @@ public void testGetPartitionStatistics()\n         assertEquals(mockClient.getAccessCount(), 3);\n     }\n \n+    @Test\n+    public void testUpdatePartitionStatistics()", "state": "SUBMITTED", "replyTo": null, "originalCommit": null, "originalPosition": 13}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NzU5MzMxMw==", "bodyText": "@sopel39 @electrum what about replacing MockThriftMetastoreClient with InMemoryThriftMetastore (+ access counting wrapper) in TestCachingHiveMetastore?\n\nIt seems like a good idea. I don't think MockThriftMetastoreClient correctly mocks thrift metastore. I would say this could be a follow up PR though.", "url": "https://github.com/trinodb/trino/pull/2734#discussion_r377593313", "createdAt": "2020-02-11T12:03:14Z", "author": {"login": "sopel39"}, "path": "presto-hive/src/test/java/io/prestosql/plugin/hive/metastore/thrift/MockThriftMetastoreClient.java", "diffHunk": "@@ -218,7 +218,8 @@ public void deleteTableColumnStatistics(String databaseName, String tableName, S\n     @Override\n     public void setPartitionColumnStatistics(String databaseName, String tableName, String partitionName, List<ColumnStatisticsObj> statistics)\n     {\n-        throw new UnsupportedOperationException();\n+        accessCount.incrementAndGet();\n+        // No-op", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3Njk3MDE2NA=="}, "originalCommit": null, "originalPosition": 6}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": null, "afterCommit": null}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": null, "afterCommit": null}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": null, "afterCommit": null}, {"__typename": "PullRequestCommit", "commit": {"oid": "b635cddcfb1323fe5178dd2b0da53861b7537c65", "author": {"user": {"login": "rohangarg", "name": "Rohan Garg"}}, "url": "https://github.com/trinodb/trino/commit/b635cddcfb1323fe5178dd2b0da53861b7537c65", "committedDate": "2020-02-13T10:18:23Z", "message": "Test CachingHiveMetastore update partition statistics"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "1c45b21dcacbcb9b37d9aa4643f214c4dda42b6b", "author": {"user": {"login": "rohangarg", "name": "Rohan Garg"}}, "url": "https://github.com/trinodb/trino/commit/1c45b21dcacbcb9b37d9aa4643f214c4dda42b6b", "committedDate": "2020-02-13T10:52:43Z", "message": "Remove getTable call from updatePartitionStatistics"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": null, "afterCommit": {"oid": "1c45b21dcacbcb9b37d9aa4643f214c4dda42b6b", "author": {"user": {"login": "rohangarg", "name": "Rohan Garg"}}, "url": "https://github.com/trinodb/trino/commit/1c45b21dcacbcb9b37d9aa4643f214c4dda42b6b", "committedDate": "2020-02-13T10:52:43Z", "message": "Remove getTable call from updatePartitionStatistics"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzU5NTcxMDc0", "url": "https://github.com/trinodb/trino/pull/2734#pullrequestreview-359571074", "createdAt": "2020-02-17T08:56:20Z", "commit": {"oid": "1c45b21dcacbcb9b37d9aa4643f214c4dda42b6b"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1641, "cost": 1, "resetAt": "2021-10-28T20:13:43Z"}}}