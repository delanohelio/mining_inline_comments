{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDU3MjYzNDY2", "number": 4601, "title": "Support parameter in FETCH FIRST and OFFSET clauses", "bodyText": "", "createdAt": "2020-07-27T16:14:16Z", "url": "https://github.com/trinodb/trino/pull/4601", "merged": true, "mergeCommit": {"oid": "36c4fb8fa3814659a821a4b827a5c6e4b30ab2e7"}, "closed": true, "closedAt": "2020-07-28T18:35:14Z", "author": {"login": "kasiafi"}, "timelineItems": {"totalCount": 10, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABc5ACr9AH2gAyNDU3MjYzNDY2OmQzZWRiNjA4NDMwYWJjNDUxZmE5Yjk5NjcxNGI3ZDI4YjRiM2MyYjQ=", "endCursor": "Y3Vyc29yOnYyOpPPAAABc5Wj0YABqjM1OTQzOTYyMzU=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "d3edb608430abc451fa9b996714b7d28b4b3c2b4", "author": {"user": {"login": "kasiafi", "name": null}}, "url": "https://github.com/trinodb/trino/commit/d3edb608430abc451fa9b996714b7d28b4b3c2b4", "committedDate": "2020-07-27T11:22:42Z", "message": "Add test for type mismatch in LIMIT parameter"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a396fe82f244d5611580fd8d23af1dd96b0f399b", "author": {"user": {"login": "kasiafi", "name": null}}, "url": "https://github.com/trinodb/trino/commit/a396fe82f244d5611580fd8d23af1dd96b0f399b", "committedDate": "2020-07-27T11:22:42Z", "message": "Fix formatting"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "179524322ae69581d0c8da3cb3b0f2773baeba06", "author": {"user": {"login": "kasiafi", "name": null}}, "url": "https://github.com/trinodb/trino/commit/179524322ae69581d0c8da3cb3b0f2773baeba06", "committedDate": "2020-07-27T11:22:43Z", "message": "Extract parser rule for rowCount"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "01385457a4936d80a46b133ae79f812767b99533", "author": {"user": {"login": "kasiafi", "name": null}}, "url": "https://github.com/trinodb/trino/commit/01385457a4936d80a46b133ae79f812767b99533", "committedDate": "2020-07-27T11:22:43Z", "message": "Extract method for analyzing parameter as row count"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDU2MTQyMzc5", "url": "https://github.com/trinodb/trino/pull/4601#pullrequestreview-456142379", "createdAt": "2020-07-27T21:17:58Z", "commit": null, "state": "COMMENTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yN1QyMToxNzo1OFrOG3z7_A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yN1QyMToyMzoyOVrOG30GSQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MTE3NTgwNA==", "bodyText": "nonConstantErrorContext isn't defined anywhere in this commit or prior to it, so this will produce a compile-time error.", "url": "https://github.com/trinodb/trino/pull/4601#discussion_r461175804", "createdAt": "2020-07-27T21:17:58Z", "author": {"login": "martint"}, "path": "presto-main/src/main/java/io/prestosql/sql/analyzer/StatementAnalyzer.java", "diffHunk": "@@ -2747,18 +2747,23 @@ private OptionalLong analyzeParameterAsRowCount(Parameter parameter, Scope scope\n                 // validate parameter index\n                 analyzeExpression(parameter, scope);\n                 Expression providedValue = analysis.getParameters().get(NodeRef.of(parameter));\n+                Object value;\n                 try {\n-                    return OptionalLong.of((long) ExpressionInterpreter.evaluateConstantExpression(\n+                    value = ExpressionInterpreter.evaluateConstantExpression(\n                             providedValue,\n                             BIGINT,\n                             metadata,\n                             session,\n                             accessControl,\n-                            analysis.getParameters()));\n+                            analysis.getParameters());\n                 }\n                 catch (VerifyException e) {\n                     throw semanticException(INVALID_ARGUMENTS, parameter, \"Non constant parameter value for LIMIT: %s\", providedValue);\n                 }\n+                if (value == null) {\n+                    throw semanticException(INVALID_ARGUMENTS, parameter, \"Parameter value provided for %s is NULL: %s\", nonConstantErrorContext, providedValue);", "state": "SUBMITTED", "replyTo": null, "originalCommit": null, "originalPosition": 20}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MTE3ODQ0MQ==", "bodyText": "What does \"non constant\" refer to in nonConstantErrorContext?", "url": "https://github.com/trinodb/trino/pull/4601#discussion_r461178441", "createdAt": "2020-07-27T21:23:29Z", "author": {"login": "martint"}, "path": "presto-main/src/main/java/io/prestosql/sql/analyzer/StatementAnalyzer.java", "diffHunk": "@@ -2736,7 +2738,7 @@ else if (node.getRowCount() instanceof LongLiteral) {\n             return false;\n         }\n \n-        private OptionalLong analyzeParameterAsRowCount(Parameter parameter, Scope scope)\n+        private OptionalLong analyzeParameterAsRowCount(Parameter parameter, Scope scope, String nonConstantErrorContext)", "state": "SUBMITTED", "replyTo": null, "originalCommit": null, "originalPosition": 63}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "41e31bc2e060c479412e48039f02bf303fc45570", "author": {"user": {"login": "kasiafi", "name": null}}, "url": "https://github.com/trinodb/trino/commit/41e31bc2e060c479412e48039f02bf303fc45570", "committedDate": "2020-07-28T13:23:30Z", "message": "Handle null passed for parameter in LIMIT"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "95e0fc2a23c2779e7568d50e3682de1e2359c82a", "author": {"user": {"login": "kasiafi", "name": null}}, "url": "https://github.com/trinodb/trino/commit/95e0fc2a23c2779e7568d50e3682de1e2359c82a", "committedDate": "2020-07-28T13:30:05Z", "message": "Support parameter in FETCH FIRST clause"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "11eb3f2aa38a0bf5e41d7d0eca9e772fa10208c6", "author": {"user": {"login": "kasiafi", "name": null}}, "url": "https://github.com/trinodb/trino/commit/11eb3f2aa38a0bf5e41d7d0eca9e772fa10208c6", "committedDate": "2020-07-28T13:30:16Z", "message": "Support parameter in OFFSET clause"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "6814888999d177d4b75c6bd00e9ee8393cd48dba", "author": {"user": {"login": "kasiafi", "name": null}}, "url": "https://github.com/trinodb/trino/commit/6814888999d177d4b75c6bd00e9ee8393cd48dba", "committedDate": "2020-07-28T13:30:16Z", "message": "Add parser label for LIMIT value"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": null, "afterCommit": {"oid": "6814888999d177d4b75c6bd00e9ee8393cd48dba", "author": {"user": {"login": "kasiafi", "name": null}}, "url": "https://github.com/trinodb/trino/commit/6814888999d177d4b75c6bd00e9ee8393cd48dba", "committedDate": "2020-07-28T13:30:16Z", "message": "Add parser label for LIMIT value"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4489, "cost": 1, "resetAt": "2021-10-28T20:13:43Z"}}}