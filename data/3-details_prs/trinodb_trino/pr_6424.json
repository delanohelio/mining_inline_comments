{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTQ0MTY2MjY4", "number": 6424, "title": "Add test coverage for querying views referencing Hive tables with timestamp columns", "bodyText": "", "createdAt": "2020-12-22T14:42:34Z", "url": "https://github.com/trinodb/trino/pull/6424", "merged": true, "mergeCommit": {"oid": "6264f214d471727aa26e2cd82d85d4e552d2d087"}, "closed": true, "closedAt": "2021-01-05T09:15:33Z", "author": {"login": "losipiuk"}, "timelineItems": {"totalCount": 19, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdornSPABqjQxNDA0Mjk2OTg=", "endCursor": "Y3Vyc29yOnYyOpPPAAABds4qcmgH2gAyNTQ0MTY2MjY4OjhlNTAxNGY3MTc3ODMzNTRhOGUzYzlhZjA3NzczMTFhY2VmZGE1M2I=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "HeadRefForcePushedEvent", "beforeCommit": null, "afterCommit": null}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTU3MTQwNTQ2", "url": "https://github.com/trinodb/trino/pull/6424#pullrequestreview-557140546", "createdAt": "2020-12-22T14:58:14Z", "commit": null, "state": "DISMISSED", "comments": {"totalCount": 7, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0yMlQxNDo1ODoxNFrOIJ-Byg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0yMlQxNToxMTo0NFrOIJ-fZw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NzMyNDM2Mg==", "bodyText": "Are this not relevant? Most of it?", "url": "https://github.com/trinodb/trino/pull/6424#discussion_r547324362", "createdAt": "2020-12-22T14:58:14Z", "author": {"login": "findepi"}, "path": "presto-product-tests-launcher/src/main/resources/docker/presto-product-tests/common/hadoop/hive_timestamp_nanos.properties", "diffHunk": "@@ -0,0 +1,16 @@\n+connector.name=hive-hadoop2\n+hive.metastore.uri=thrift://hadoop-master:9083\n+hive.config.resources=/docker/presto-product-tests/conf/presto/etc/hive-default-fs-site.xml\n+hive.allow-add-column=true\n+hive.allow-drop-column=true\n+hive.allow-rename-column=true\n+hive.allow-comment-table=true\n+hive.allow-comment-column=true\n+hive.allow-drop-table=true\n+hive.allow-rename-table=true\n+hive.allow-register-partition-procedure=true\n+hive.metastore-cache-ttl=0s\n+hive.fs.cache.max-size=10\n+hive.max-partitions-per-scan=100", "state": "SUBMITTED", "replyTo": null, "originalCommit": null, "originalPosition": 14}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NzMyNTEwMQ==", "bodyText": "\"not set\" \"UNSET\" -- choose one\nBTW we could explicitly reset session property here with RESET SESSION\nhttps://prestosql.io/docs/current/sql/reset-session.html", "url": "https://github.com/trinodb/trino/pull/6424#discussion_r547325101", "createdAt": "2020-12-22T14:59:32Z", "author": {"login": "findepi"}, "path": "presto-product-tests/src/main/java/io/prestosql/tests/hive/TestHiveViews.java", "diffHunk": "@@ -295,6 +297,40 @@ public void testSelectFromHiveViewWithoutDefaultCatalogAndSchema()\n                 .containsExactly(row(1L));\n     }\n \n+    @Test\n+    public void testTimestampHiveView() {\n+        onHive().executeQuery(\"DROP TABLE IF EXISTS timestamp_hive_table\");\n+        onHive().executeQuery(\"CREATE TABLE timestamp_hive_table AS SELECT cast('1990-01-02 12:13:14.123456789' AS timestamp) ts\");\n+        onHive().executeQuery(\"DROP VIEW IF EXISTS timestamp_hive_view\");\n+        onHive().executeQuery(\"CREATE VIEW timestamp_hive_view AS SELECT * FROM timestamp_hive_table\");\n+\n+        // timestamp_precision not set UNSET", "state": "SUBMITTED", "replyTo": null, "originalCommit": null, "originalPosition": 27}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NzMyNTkxOA==", "bodyText": "as -> AS\nVARCHAR -> varchar\n(we tend to write SQL keywords in uppercase and identifiers in lowercase)", "url": "https://github.com/trinodb/trino/pull/6424#discussion_r547325918", "createdAt": "2020-12-22T15:01:01Z", "author": {"login": "findepi"}, "path": "presto-product-tests/src/main/java/io/prestosql/tests/hive/TestHiveViews.java", "diffHunk": "@@ -295,6 +297,40 @@ public void testSelectFromHiveViewWithoutDefaultCatalogAndSchema()\n                 .containsExactly(row(1L));\n     }\n \n+    @Test\n+    public void testTimestampHiveView() {\n+        onHive().executeQuery(\"DROP TABLE IF EXISTS timestamp_hive_table\");\n+        onHive().executeQuery(\"CREATE TABLE timestamp_hive_table AS SELECT cast('1990-01-02 12:13:14.123456789' AS timestamp) ts\");\n+        onHive().executeQuery(\"DROP VIEW IF EXISTS timestamp_hive_view\");\n+        onHive().executeQuery(\"CREATE VIEW timestamp_hive_view AS SELECT * FROM timestamp_hive_table\");\n+\n+        // timestamp_precision not set UNSET\n+        assertThat(query(\"SELECT CAST(ts as VARCHAR) FROM timestamp_hive_view\")).containsExactly(row(\"1990-01-02 12:13:14.123\"));", "state": "SUBMITTED", "replyTo": null, "originalCommit": null, "originalPosition": 28}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NzMyNzk3MA==", "bodyText": "#6295 is worded as an enhancement (\"support this with that\"), but the failure looks more like a bug. Maybe we do not need to create separate bug issue, but would be worth adding a comment in this issue, sth like \"Currently this fails: \u00abstacktrace\u00bb\"", "url": "https://github.com/trinodb/trino/pull/6424#discussion_r547327970", "createdAt": "2020-12-22T15:04:39Z", "author": {"login": "findepi"}, "path": "presto-product-tests/src/main/java/io/prestosql/tests/hive/TestHiveViews.java", "diffHunk": "@@ -295,6 +297,40 @@ public void testSelectFromHiveViewWithoutDefaultCatalogAndSchema()\n                 .containsExactly(row(1L));\n     }\n \n+    @Test\n+    public void testTimestampHiveView() {\n+        onHive().executeQuery(\"DROP TABLE IF EXISTS timestamp_hive_table\");\n+        onHive().executeQuery(\"CREATE TABLE timestamp_hive_table AS SELECT cast('1990-01-02 12:13:14.123456789' AS timestamp) ts\");\n+        onHive().executeQuery(\"DROP VIEW IF EXISTS timestamp_hive_view\");\n+        onHive().executeQuery(\"CREATE VIEW timestamp_hive_view AS SELECT * FROM timestamp_hive_table\");\n+\n+        // timestamp_precision not set UNSET\n+        assertThat(query(\"SELECT CAST(ts as VARCHAR) FROM timestamp_hive_view\")).containsExactly(row(\"1990-01-02 12:13:14.123\"));\n+        assertThatThrownBy(\n+                // TODO it is not possible to query Hive view with timestamps if hive.timestamp-precision=NANOSECONDS\n+                () -> assertThat(query(\"SELECT CAST(ts as VARCHAR) FROM hive_timestamp_nanos.default.timestamp_hive_view\")).containsExactly(row(\"1990-01-02 12:13:14.123456789\"))\n+        ).hasMessageContaining(\"timestamp(9) projected from query view at position 0 cannot be coerced to column [ts] of type timestamp(3) stored in view definition\");", "state": "SUBMITTED", "replyTo": null, "originalCommit": null, "originalPosition": 32}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NzMyOTA5Ng==", "bodyText": "link to #6295 ?", "url": "https://github.com/trinodb/trino/pull/6424#discussion_r547329096", "createdAt": "2020-12-22T15:06:35Z", "author": {"login": "findepi"}, "path": "presto-product-tests/src/main/java/io/prestosql/tests/hive/TestHiveViews.java", "diffHunk": "@@ -295,6 +297,40 @@ public void testSelectFromHiveViewWithoutDefaultCatalogAndSchema()\n                 .containsExactly(row(1L));\n     }\n \n+    @Test\n+    public void testTimestampHiveView() {\n+        onHive().executeQuery(\"DROP TABLE IF EXISTS timestamp_hive_table\");\n+        onHive().executeQuery(\"CREATE TABLE timestamp_hive_table AS SELECT cast('1990-01-02 12:13:14.123456789' AS timestamp) ts\");\n+        onHive().executeQuery(\"DROP VIEW IF EXISTS timestamp_hive_view\");\n+        onHive().executeQuery(\"CREATE VIEW timestamp_hive_view AS SELECT * FROM timestamp_hive_table\");\n+\n+        // timestamp_precision not set UNSET\n+        assertThat(query(\"SELECT CAST(ts as VARCHAR) FROM timestamp_hive_view\")).containsExactly(row(\"1990-01-02 12:13:14.123\"));\n+        assertThatThrownBy(\n+                // TODO it is not possible to query Hive view with timestamps if hive.timestamp-precision=NANOSECONDS", "state": "SUBMITTED", "replyTo": null, "originalCommit": null, "originalPosition": 30}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NzMyOTk1OA==", "bodyText": "include both \"actual\" and \"expect\" in this message.\nor, change to plan not-nested asssertion and use the actual wrong value in assertion, and put the expected value in a TODO comment", "url": "https://github.com/trinodb/trino/pull/6424#discussion_r547329958", "createdAt": "2020-12-22T15:08:11Z", "author": {"login": "findepi"}, "path": "presto-product-tests/src/main/java/io/prestosql/tests/hive/TestHiveViews.java", "diffHunk": "@@ -295,6 +297,40 @@ public void testSelectFromHiveViewWithoutDefaultCatalogAndSchema()\n                 .containsExactly(row(1L));\n     }\n \n+    @Test\n+    public void testTimestampHiveView() {\n+        onHive().executeQuery(\"DROP TABLE IF EXISTS timestamp_hive_table\");\n+        onHive().executeQuery(\"CREATE TABLE timestamp_hive_table AS SELECT cast('1990-01-02 12:13:14.123456789' AS timestamp) ts\");\n+        onHive().executeQuery(\"DROP VIEW IF EXISTS timestamp_hive_view\");\n+        onHive().executeQuery(\"CREATE VIEW timestamp_hive_view AS SELECT * FROM timestamp_hive_table\");\n+\n+        // timestamp_precision not set UNSET\n+        assertThat(query(\"SELECT CAST(ts as VARCHAR) FROM timestamp_hive_view\")).containsExactly(row(\"1990-01-02 12:13:14.123\"));\n+        assertThatThrownBy(\n+                // TODO it is not possible to query Hive view with timestamps if hive.timestamp-precision=NANOSECONDS\n+                () -> assertThat(query(\"SELECT CAST(ts as VARCHAR) FROM hive_timestamp_nanos.default.timestamp_hive_view\")).containsExactly(row(\"1990-01-02 12:13:14.123456789\"))\n+        ).hasMessageContaining(\"timestamp(9) projected from query view at position 0 cannot be coerced to column [ts] of type timestamp(3) stored in view definition\");\n+\n+        setSessionProperty(\"hive.timestamp_precision\", \"'MILLISECONDS'\");\n+        setSessionProperty(\"hive_timestamp_nanos.timestamp_precision\", \"'MILLISECONDS'\");\n+        assertThat(query(\"SELECT CAST(ts as VARCHAR) FROM timestamp_hive_view\")).containsExactly(row(\"1990-01-02 12:13:14.123\"));\n+        assertThatThrownBy(\n+                // TODO it is not possible to query Hive view with timestamps if hive.timestamp-precision=NANOSECONDS\n+                () -> assertThat(query(\"SELECT CAST(ts as VARCHAR) FROM hive_timestamp_nanos.default.timestamp_hive_view\")).containsExactly(row(\"1990-01-02 12:13:14.123\"))\n+        ).hasMessageContaining(\"timestamp(9) projected from query view at position 0 cannot be coerced to column [ts] of type timestamp(3) stored in view definition\");\n+\n+        setSessionProperty(\"hive.timestamp_precision\", \"'NANOSECONDS'\");\n+        setSessionProperty(\"hive_timestamp_nanos.timestamp_precision\", \"'NANOSECONDS'\");\n+        assertThatThrownBy(\n+                // TODO timestamp_precision has no effect on Hive views\n+                () -> assertThat(query(\"SELECT CAST(ts as VARCHAR) FROM timestamp_hive_view\")).containsExactly(row(\"1990-01-02 12:13:14.123456789\"))\n+        ).hasMessageContaining(\"0 - actual:   1990-01-02 12:13:14.123|\");", "state": "SUBMITTED", "replyTo": null, "originalCommit": null, "originalPosition": 47}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NzMzMTk0Mw==", "bodyText": "Is the behavior exactly the same for both legacy and non-legacy?", "url": "https://github.com/trinodb/trino/pull/6424#discussion_r547331943", "createdAt": "2020-12-22T15:11:44Z", "author": {"login": "findepi"}, "path": "presto-product-tests/src/main/java/io/prestosql/tests/hive/TestHiveViewsLegacy.java", "diffHunk": "@@ -241,6 +243,40 @@ public void testSelectFromHiveViewWithoutDefaultCatalogAndSchema()\n                 .containsExactly(row(1L));\n     }\n \n+    @Test\n+    public void testTimestampHiveView() {", "state": "SUBMITTED", "replyTo": null, "originalCommit": null, "originalPosition": 21}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTU3MTUyMTcy", "url": "https://github.com/trinodb/trino/pull/6424#pullrequestreview-557152172", "createdAt": "2020-12-22T15:13:45Z", "commit": null, "state": "COMMENTED", "comments": {"totalCount": 13, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0yMlQxNToxMzo0NVrOIJ-jvA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0yMlQxNToyNTowOFrOIJ-8ZQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NzMzMzA1Mg==", "bodyText": "Is the bucketed catalog guaranteed to always exist?\nMaybe, instead, apply the necessary setup within the test where you need this?", "url": "https://github.com/trinodb/trino/pull/6424#discussion_r547333052", "createdAt": "2020-12-22T15:13:45Z", "author": {"login": "findepi"}, "path": "presto-hive/src/test/java/io/prestosql/plugin/hive/HiveQueryRunner.java", "diffHunk": "@@ -226,7 +226,9 @@ private static Session createSession(Optional<SelectedRole> role)\n     {\n         return testSessionBuilder()\n                 .setIdentity(Identity.forUser(\"hive\")\n-                        .withRoles(role.map(selectedRole -> ImmutableMap.of(\"hive\", selectedRole))\n+                        .withRoles(role.map(selectedRole -> ImmutableMap.of(\n+                                HIVE_CATALOG, selectedRole,\n+                                HIVE_BUCKETED_CATALOG, selectedRole))", "state": "SUBMITTED", "replyTo": null, "originalCommit": null, "originalPosition": 7}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NzMzNDU3Mw==", "bodyText": "good catch;\nthere is a  problem though that this is not actually \"hive connector's name\" (the latter being hive-hadoop2). It's TestingHiveConnectorFactory's name.\nyou can inline the constant avoiding the naming problem", "url": "https://github.com/trinodb/trino/pull/6424#discussion_r547334573", "createdAt": "2020-12-22T15:16:19Z", "author": {"login": "findepi"}, "path": "presto-hive/src/test/java/io/prestosql/plugin/hive/HiveQueryRunner.java", "diffHunk": "@@ -177,8 +178,8 @@ public DistributedQueryRunner build()\n                         .put(\"hive.storage-format\", \"TEXTFILE\") // so that there's no minimum split size for the file\n                         .put(\"hive.compression-codec\", \"NONE\") // so that the file is splittable\n                         .build();\n-                queryRunner.createCatalog(HIVE_CATALOG, HIVE_CATALOG, hiveProperties);\n-                queryRunner.createCatalog(HIVE_BUCKETED_CATALOG, HIVE_CATALOG, hiveBucketedProperties);\n+                queryRunner.createCatalog(HIVE_CATALOG, HIVE_CONNECTOR_NAME, hiveProperties);", "state": "SUBMITTED", "replyTo": null, "originalCommit": null, "originalPosition": 14}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NzMzNTIzMQ==", "bodyText": "It would be better to create this catalog only in these tests where it's used.", "url": "https://github.com/trinodb/trino/pull/6424#discussion_r547335231", "createdAt": "2020-12-22T15:17:31Z", "author": {"login": "findepi"}, "path": "presto-hive/src/test/java/io/prestosql/plugin/hive/HiveQueryRunner.java", "diffHunk": "@@ -178,8 +179,14 @@ public DistributedQueryRunner build()\n                         .put(\"hive.storage-format\", \"TEXTFILE\") // so that there's no minimum split size for the file\n                         .put(\"hive.compression-codec\", \"NONE\") // so that the file is splittable\n                         .build();\n+\n+                Map<String, String> hiveTimestampNanosProperties = ImmutableMap.<String, String>builder()\n+                        .putAll(hiveProperties)\n+                        .put(\"hive.timestamp-precision\", \"NANOSECONDS\")\n+                        .build();\n                 queryRunner.createCatalog(HIVE_CATALOG, HIVE_CONNECTOR_NAME, hiveProperties);\n                 queryRunner.createCatalog(HIVE_BUCKETED_CATALOG, HIVE_CONNECTOR_NAME, hiveBucketedProperties);\n+                queryRunner.createCatalog(HIVE_TIMESTAMP_NANOS_CATALOG, HIVE_CONNECTOR_NAME, hiveTimestampNanosProperties);", "state": "SUBMITTED", "replyTo": null, "originalCommit": null, "originalPosition": 19}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NzMzNTM2Mw==", "bodyText": "100 -> 1", "url": "https://github.com/trinodb/trino/pull/6424#discussion_r547335363", "createdAt": "2020-12-22T15:17:47Z", "author": {"login": "findepi"}, "path": "presto-hive/src/test/java/io/prestosql/plugin/hive/TestHiveIntegrationSmokeTest.java", "diffHunk": "@@ -7549,6 +7549,80 @@ public void testSelectFromViewWithoutDefaultCatalogAndSchema()\n         assertQuery(sessionNoCatalog, \"SELECT count(*) FROM hive.tpch.\" + viewName, \"VALUES 1\");\n     }\n \n+    @Test(invocationCount = 100)", "state": "SUBMITTED", "replyTo": null, "originalCommit": null, "originalPosition": 4}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NzMzNTQzMw==", "bodyText": "{ next line", "url": "https://github.com/trinodb/trino/pull/6424#discussion_r547335433", "createdAt": "2020-12-22T15:17:56Z", "author": {"login": "findepi"}, "path": "presto-hive/src/test/java/io/prestosql/plugin/hive/TestHiveIntegrationSmokeTest.java", "diffHunk": "@@ -7549,6 +7549,80 @@ public void testSelectFromViewWithoutDefaultCatalogAndSchema()\n         assertQuery(sessionNoCatalog, \"SELECT count(*) FROM hive.tpch.\" + viewName, \"VALUES 1\");\n     }\n \n+    @Test(invocationCount = 100)\n+    public void testSelectFromPrestoViewReferencingHiveTableWithTimestamps() {", "state": "SUBMITTED", "replyTo": null, "originalCommit": null, "originalPosition": 5}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NzMzNTc3NA==", "bodyText": "hiveTableName -> tableName\nselect_from_presto_view_hive_table_timestamps_table_ -> table_with_timestamp ?", "url": "https://github.com/trinodb/trino/pull/6424#discussion_r547335774", "createdAt": "2020-12-22T15:18:35Z", "author": {"login": "findepi"}, "path": "presto-hive/src/test/java/io/prestosql/plugin/hive/TestHiveIntegrationSmokeTest.java", "diffHunk": "@@ -7549,6 +7549,80 @@ public void testSelectFromViewWithoutDefaultCatalogAndSchema()\n         assertQuery(sessionNoCatalog, \"SELECT count(*) FROM hive.tpch.\" + viewName, \"VALUES 1\");\n     }\n \n+    @Test(invocationCount = 100)\n+    public void testSelectFromPrestoViewReferencingHiveTableWithTimestamps() {\n+        // Hive views tests covered in TestHiveViews.testTimestampHiveView and TestHiveViesLegacy.testTimestampHiveView\n+        String hiveTableName = \"select_from_presto_view_hive_table_timestamps_table_\" + randomTableSuffix();", "state": "SUBMITTED", "replyTo": null, "originalCommit": null, "originalPosition": 7}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NzMzNjg4Ng==", "bodyText": "getSession -> defaultSession (decared below)", "url": "https://github.com/trinodb/trino/pull/6424#discussion_r547336886", "createdAt": "2020-12-22T15:20:34Z", "author": {"login": "findepi"}, "path": "presto-hive/src/test/java/io/prestosql/plugin/hive/TestHiveIntegrationSmokeTest.java", "diffHunk": "@@ -7549,6 +7549,80 @@ public void testSelectFromViewWithoutDefaultCatalogAndSchema()\n         assertQuery(sessionNoCatalog, \"SELECT count(*) FROM hive.tpch.\" + viewName, \"VALUES 1\");\n     }\n \n+    @Test(invocationCount = 100)\n+    public void testSelectFromPrestoViewReferencingHiveTableWithTimestamps() {\n+        // Hive views tests covered in TestHiveViews.testTimestampHiveView and TestHiveViesLegacy.testTimestampHiveView\n+        String hiveTableName = \"select_from_presto_view_hive_table_timestamps_table_\" + randomTableSuffix();\n+        assertUpdate(\n+                withTimestampPrecision(getSession(), HiveTimestampPrecision.NANOSECONDS),", "state": "SUBMITTED", "replyTo": null, "originalCommit": null, "originalPosition": 9}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NzMzNzAzNA==", "bodyText": "defaultSession -> defaultSession\n(& below)", "url": "https://github.com/trinodb/trino/pull/6424#discussion_r547337034", "createdAt": "2020-12-22T15:20:51Z", "author": {"login": "findepi"}, "path": "presto-hive/src/test/java/io/prestosql/plugin/hive/TestHiveIntegrationSmokeTest.java", "diffHunk": "@@ -7549,6 +7549,80 @@ public void testSelectFromViewWithoutDefaultCatalogAndSchema()\n         assertQuery(sessionNoCatalog, \"SELECT count(*) FROM hive.tpch.\" + viewName, \"VALUES 1\");\n     }\n \n+    @Test(invocationCount = 100)\n+    public void testSelectFromPrestoViewReferencingHiveTableWithTimestamps() {\n+        // Hive views tests covered in TestHiveViews.testTimestampHiveView and TestHiveViesLegacy.testTimestampHiveView\n+        String hiveTableName = \"select_from_presto_view_hive_table_timestamps_table_\" + randomTableSuffix();\n+        assertUpdate(\n+                withTimestampPrecision(getSession(), HiveTimestampPrecision.NANOSECONDS),\n+                \"CREATE TABLE \" + hiveTableName + \" AS SELECT TIMESTAMP '1990-01-02 12:13:14.123456789' ts\",\n+                1);\n+\n+        Session defaultSession = getSession();\n+        Session millisSession = Session.builder(getSession())", "state": "SUBMITTED", "replyTo": null, "originalCommit": null, "originalPosition": 14}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NzMzNzUyNQ==", "bodyText": "select_from_presto_view_hive_table_timestamps_default_view_ -> presto_view_ts_default ?", "url": "https://github.com/trinodb/trino/pull/6424#discussion_r547337525", "createdAt": "2020-12-22T15:21:49Z", "author": {"login": "findepi"}, "path": "presto-hive/src/test/java/io/prestosql/plugin/hive/TestHiveIntegrationSmokeTest.java", "diffHunk": "@@ -7549,6 +7549,80 @@ public void testSelectFromViewWithoutDefaultCatalogAndSchema()\n         assertQuery(sessionNoCatalog, \"SELECT count(*) FROM hive.tpch.\" + viewName, \"VALUES 1\");\n     }\n \n+    @Test(invocationCount = 100)\n+    public void testSelectFromPrestoViewReferencingHiveTableWithTimestamps() {\n+        // Hive views tests covered in TestHiveViews.testTimestampHiveView and TestHiveViesLegacy.testTimestampHiveView\n+        String hiveTableName = \"select_from_presto_view_hive_table_timestamps_table_\" + randomTableSuffix();\n+        assertUpdate(\n+                withTimestampPrecision(getSession(), HiveTimestampPrecision.NANOSECONDS),\n+                \"CREATE TABLE \" + hiveTableName + \" AS SELECT TIMESTAMP '1990-01-02 12:13:14.123456789' ts\",\n+                1);\n+\n+        Session defaultSession = getSession();\n+        Session millisSession = Session.builder(getSession())\n+                .setCatalogSessionProperty(\"hive\", \"timestamp_precision\", \"MILLISECONDS\")\n+                .setCatalogSessionProperty(\"hive_timestamp_nanos\", \"timestamp_precision\", \"MILLISECONDS\")\n+                .build();\n+        Session nanosSessions = Session.builder(getSession())\n+                .setCatalogSessionProperty(\"hive\", \"timestamp_precision\", \"NANOSECONDS\")\n+                .setCatalogSessionProperty(\"hive_timestamp_nanos\", \"timestamp_precision\", \"NANOSECONDS\")\n+                .build();\n+\n+        // Presto view created with config property set to MILLIS and session property not set\n+        String prestoViewNameDefault = \"select_from_presto_view_hive_table_timestamps_default_view_\" + randomTableSuffix();", "state": "SUBMITTED", "replyTo": null, "originalCommit": null, "originalPosition": 24}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NzMzODM2Nw==", "bodyText": "if you use assertThat(query(...))  you become free of H2 and then you can use TIMESTAMP literals in the expected query. This would avoid need for CAST AS varchar) altogether.\n(here we don't have JDBC, and we have more trust implicit trust in our internal APIs; all engine timestamp tests depend on them anyway)", "url": "https://github.com/trinodb/trino/pull/6424#discussion_r547338367", "createdAt": "2020-12-22T15:23:30Z", "author": {"login": "findepi"}, "path": "presto-hive/src/test/java/io/prestosql/plugin/hive/TestHiveIntegrationSmokeTest.java", "diffHunk": "@@ -7549,6 +7549,80 @@ public void testSelectFromViewWithoutDefaultCatalogAndSchema()\n         assertQuery(sessionNoCatalog, \"SELECT count(*) FROM hive.tpch.\" + viewName, \"VALUES 1\");\n     }\n \n+    @Test(invocationCount = 100)\n+    public void testSelectFromPrestoViewReferencingHiveTableWithTimestamps() {\n+        // Hive views tests covered in TestHiveViews.testTimestampHiveView and TestHiveViesLegacy.testTimestampHiveView\n+        String hiveTableName = \"select_from_presto_view_hive_table_timestamps_table_\" + randomTableSuffix();\n+        assertUpdate(\n+                withTimestampPrecision(getSession(), HiveTimestampPrecision.NANOSECONDS),\n+                \"CREATE TABLE \" + hiveTableName + \" AS SELECT TIMESTAMP '1990-01-02 12:13:14.123456789' ts\",\n+                1);\n+\n+        Session defaultSession = getSession();\n+        Session millisSession = Session.builder(getSession())\n+                .setCatalogSessionProperty(\"hive\", \"timestamp_precision\", \"MILLISECONDS\")\n+                .setCatalogSessionProperty(\"hive_timestamp_nanos\", \"timestamp_precision\", \"MILLISECONDS\")\n+                .build();\n+        Session nanosSessions = Session.builder(getSession())\n+                .setCatalogSessionProperty(\"hive\", \"timestamp_precision\", \"NANOSECONDS\")\n+                .setCatalogSessionProperty(\"hive_timestamp_nanos\", \"timestamp_precision\", \"NANOSECONDS\")\n+                .build();\n+\n+        // Presto view created with config property set to MILLIS and session property not set\n+        String prestoViewNameDefault = \"select_from_presto_view_hive_table_timestamps_default_view_\" + randomTableSuffix();\n+        assertUpdate(defaultSession, \"CREATE VIEW \" + prestoViewNameDefault + \" AS SELECT *  FROM \" + hiveTableName);\n+\n+        assertQuery(defaultSession, \"SELECT CAST(ts as VARCHAR) FROM \" + prestoViewNameDefault, \"VALUES ('1990-01-02 12:13:14.123')\");", "state": "SUBMITTED", "replyTo": null, "originalCommit": null, "originalPosition": 27}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NzMzODU1Mw==", "bodyText": "nit: no space after arrow (did checkstyle catch this?)", "url": "https://github.com/trinodb/trino/pull/6424#discussion_r547338553", "createdAt": "2020-12-22T15:23:48Z", "author": {"login": "findepi"}, "path": "presto-hive/src/test/java/io/prestosql/plugin/hive/TestHiveIntegrationSmokeTest.java", "diffHunk": "@@ -7549,6 +7549,80 @@ public void testSelectFromViewWithoutDefaultCatalogAndSchema()\n         assertQuery(sessionNoCatalog, \"SELECT count(*) FROM hive.tpch.\" + viewName, \"VALUES 1\");\n     }\n \n+    @Test(invocationCount = 100)\n+    public void testSelectFromPrestoViewReferencingHiveTableWithTimestamps() {\n+        // Hive views tests covered in TestHiveViews.testTimestampHiveView and TestHiveViesLegacy.testTimestampHiveView\n+        String hiveTableName = \"select_from_presto_view_hive_table_timestamps_table_\" + randomTableSuffix();\n+        assertUpdate(\n+                withTimestampPrecision(getSession(), HiveTimestampPrecision.NANOSECONDS),\n+                \"CREATE TABLE \" + hiveTableName + \" AS SELECT TIMESTAMP '1990-01-02 12:13:14.123456789' ts\",\n+                1);\n+\n+        Session defaultSession = getSession();\n+        Session millisSession = Session.builder(getSession())\n+                .setCatalogSessionProperty(\"hive\", \"timestamp_precision\", \"MILLISECONDS\")\n+                .setCatalogSessionProperty(\"hive_timestamp_nanos\", \"timestamp_precision\", \"MILLISECONDS\")\n+                .build();\n+        Session nanosSessions = Session.builder(getSession())\n+                .setCatalogSessionProperty(\"hive\", \"timestamp_precision\", \"NANOSECONDS\")\n+                .setCatalogSessionProperty(\"hive_timestamp_nanos\", \"timestamp_precision\", \"NANOSECONDS\")\n+                .build();\n+\n+        // Presto view created with config property set to MILLIS and session property not set\n+        String prestoViewNameDefault = \"select_from_presto_view_hive_table_timestamps_default_view_\" + randomTableSuffix();\n+        assertUpdate(defaultSession, \"CREATE VIEW \" + prestoViewNameDefault + \" AS SELECT *  FROM \" + hiveTableName);\n+\n+        assertQuery(defaultSession, \"SELECT CAST(ts as VARCHAR) FROM \" + prestoViewNameDefault, \"VALUES ('1990-01-02 12:13:14.123')\");\n+        assertThatThrownBy(\n+                // TODO Presto view schema is fixed on creation\n+                () ->assertQuery(defaultSession, \"SELECT CAST(ts as VARCHAR) FROM hive_timestamp_nanos.tpch.\" + prestoViewNameDefault, \"VALUES ('1990-01-02 12:13:14.123456789')\")", "state": "SUBMITTED", "replyTo": null, "originalCommit": null, "originalPosition": 30}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NzMzODcwMA==", "bodyText": "link to an issue", "url": "https://github.com/trinodb/trino/pull/6424#discussion_r547338700", "createdAt": "2020-12-22T15:24:03Z", "author": {"login": "findepi"}, "path": "presto-hive/src/test/java/io/prestosql/plugin/hive/TestHiveIntegrationSmokeTest.java", "diffHunk": "@@ -7549,6 +7549,80 @@ public void testSelectFromViewWithoutDefaultCatalogAndSchema()\n         assertQuery(sessionNoCatalog, \"SELECT count(*) FROM hive.tpch.\" + viewName, \"VALUES 1\");\n     }\n \n+    @Test(invocationCount = 100)\n+    public void testSelectFromPrestoViewReferencingHiveTableWithTimestamps() {\n+        // Hive views tests covered in TestHiveViews.testTimestampHiveView and TestHiveViesLegacy.testTimestampHiveView\n+        String hiveTableName = \"select_from_presto_view_hive_table_timestamps_table_\" + randomTableSuffix();\n+        assertUpdate(\n+                withTimestampPrecision(getSession(), HiveTimestampPrecision.NANOSECONDS),\n+                \"CREATE TABLE \" + hiveTableName + \" AS SELECT TIMESTAMP '1990-01-02 12:13:14.123456789' ts\",\n+                1);\n+\n+        Session defaultSession = getSession();\n+        Session millisSession = Session.builder(getSession())\n+                .setCatalogSessionProperty(\"hive\", \"timestamp_precision\", \"MILLISECONDS\")\n+                .setCatalogSessionProperty(\"hive_timestamp_nanos\", \"timestamp_precision\", \"MILLISECONDS\")\n+                .build();\n+        Session nanosSessions = Session.builder(getSession())\n+                .setCatalogSessionProperty(\"hive\", \"timestamp_precision\", \"NANOSECONDS\")\n+                .setCatalogSessionProperty(\"hive_timestamp_nanos\", \"timestamp_precision\", \"NANOSECONDS\")\n+                .build();\n+\n+        // Presto view created with config property set to MILLIS and session property not set\n+        String prestoViewNameDefault = \"select_from_presto_view_hive_table_timestamps_default_view_\" + randomTableSuffix();\n+        assertUpdate(defaultSession, \"CREATE VIEW \" + prestoViewNameDefault + \" AS SELECT *  FROM \" + hiveTableName);\n+\n+        assertQuery(defaultSession, \"SELECT CAST(ts as VARCHAR) FROM \" + prestoViewNameDefault, \"VALUES ('1990-01-02 12:13:14.123')\");\n+        assertThatThrownBy(\n+                // TODO Presto view schema is fixed on creation\n+                () ->assertQuery(defaultSession, \"SELECT CAST(ts as VARCHAR) FROM hive_timestamp_nanos.tpch.\" + prestoViewNameDefault, \"VALUES ('1990-01-02 12:13:14.123456789')\")\n+        ).hasMessageContaining(\"Actual rows (up to 100 of 1 extra rows shown, 1 rows in total):\\n    [1990-01-02 12:13:14.123]\");\n+\n+        assertQuery(millisSession, \"SELECT CAST(ts as VARCHAR) FROM \" + prestoViewNameDefault, \"VALUES ('1990-01-02 12:13:14.123')\");\n+        assertQuery(millisSession, \"SELECT CAST(ts as VARCHAR) FROM hive_timestamp_nanos.tpch.\" + prestoViewNameDefault, \"VALUES ('1990-01-02 12:13:14.123')\");\n+\n+        assertThatThrownBy(\n+                // TODO Presto view schema is fixed on creation\n+                () -> assertQuery(nanosSessions, \"SELECT CAST(ts as VARCHAR) FROM \" + prestoViewNameDefault, \"VALUES ('1990-01-02 12:13:14.123456789')\")\n+        ).hasMessageContaining(\"Actual rows (up to 100 of 1 extra rows shown, 1 rows in total):\\n    [1990-01-02 12:13:14.123]\");\n+\n+        assertThatThrownBy(\n+                // TODO Presto view schema is fixed on creation\n+                () -> assertQuery(nanosSessions, \"SELECT CAST(ts as VARCHAR) FROM hive_timestamp_nanos.tpch.\" + prestoViewNameDefault, \"VALUES ('1990-01-02 12:13:14.123456789')\")\n+        ).hasMessageContaining(\"Actual rows (up to 100 of 1 extra rows shown, 1 rows in total):\\n    [1990-01-02 12:13:14.123]\");\n+\n+        // Presto view created with config property set to MILLIS and session property set to NANOS\n+        String prestoViewNameNanos = \"select_from_presto_view_hive_table_timestamps_millis_view_\" + randomTableSuffix();\n+        assertUpdate(nanosSessions, \"CREATE VIEW \" + prestoViewNameNanos + \" AS SELECT *  FROM \" + hiveTableName);\n+\n+        assertThatThrownBy(\n+                // TODO Presto view schema is fixed on creation\n+                () -> assertQuery(defaultSession, \"SELECT CAST(ts as VARCHAR) FROM \" + prestoViewNameNanos, \"VALUES ('1990-01-02 12:13:14.123')\")\n+        ).hasMessageContaining(\"Actual rows (up to 100 of 1 extra rows shown, 1 rows in total):\\n    [1990-01-02 12:13:14.123000000]\");\n+        assertThatThrownBy(\n+                // TODO Presto view schema is fixed on creation", "state": "SUBMITTED", "replyTo": null, "originalCommit": null, "originalPosition": 55}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NzMzOTM2NQ==", "bodyText": "Quote both expected and actual within hasMessageContaining\nor, use the actual wrong value in assertion and put the correct value in a TODO comment", "url": "https://github.com/trinodb/trino/pull/6424#discussion_r547339365", "createdAt": "2020-12-22T15:25:08Z", "author": {"login": "findepi"}, "path": "presto-hive/src/test/java/io/prestosql/plugin/hive/TestHiveIntegrationSmokeTest.java", "diffHunk": "@@ -7549,6 +7549,80 @@ public void testSelectFromViewWithoutDefaultCatalogAndSchema()\n         assertQuery(sessionNoCatalog, \"SELECT count(*) FROM hive.tpch.\" + viewName, \"VALUES 1\");\n     }\n \n+    @Test(invocationCount = 100)\n+    public void testSelectFromPrestoViewReferencingHiveTableWithTimestamps() {\n+        // Hive views tests covered in TestHiveViews.testTimestampHiveView and TestHiveViesLegacy.testTimestampHiveView\n+        String hiveTableName = \"select_from_presto_view_hive_table_timestamps_table_\" + randomTableSuffix();\n+        assertUpdate(\n+                withTimestampPrecision(getSession(), HiveTimestampPrecision.NANOSECONDS),\n+                \"CREATE TABLE \" + hiveTableName + \" AS SELECT TIMESTAMP '1990-01-02 12:13:14.123456789' ts\",\n+                1);\n+\n+        Session defaultSession = getSession();\n+        Session millisSession = Session.builder(getSession())\n+                .setCatalogSessionProperty(\"hive\", \"timestamp_precision\", \"MILLISECONDS\")\n+                .setCatalogSessionProperty(\"hive_timestamp_nanos\", \"timestamp_precision\", \"MILLISECONDS\")\n+                .build();\n+        Session nanosSessions = Session.builder(getSession())\n+                .setCatalogSessionProperty(\"hive\", \"timestamp_precision\", \"NANOSECONDS\")\n+                .setCatalogSessionProperty(\"hive_timestamp_nanos\", \"timestamp_precision\", \"NANOSECONDS\")\n+                .build();\n+\n+        // Presto view created with config property set to MILLIS and session property not set\n+        String prestoViewNameDefault = \"select_from_presto_view_hive_table_timestamps_default_view_\" + randomTableSuffix();\n+        assertUpdate(defaultSession, \"CREATE VIEW \" + prestoViewNameDefault + \" AS SELECT *  FROM \" + hiveTableName);\n+\n+        assertQuery(defaultSession, \"SELECT CAST(ts as VARCHAR) FROM \" + prestoViewNameDefault, \"VALUES ('1990-01-02 12:13:14.123')\");\n+        assertThatThrownBy(\n+                // TODO Presto view schema is fixed on creation\n+                () ->assertQuery(defaultSession, \"SELECT CAST(ts as VARCHAR) FROM hive_timestamp_nanos.tpch.\" + prestoViewNameDefault, \"VALUES ('1990-01-02 12:13:14.123456789')\")\n+        ).hasMessageContaining(\"Actual rows (up to 100 of 1 extra rows shown, 1 rows in total):\\n    [1990-01-02 12:13:14.123]\");\n+\n+        assertQuery(millisSession, \"SELECT CAST(ts as VARCHAR) FROM \" + prestoViewNameDefault, \"VALUES ('1990-01-02 12:13:14.123')\");\n+        assertQuery(millisSession, \"SELECT CAST(ts as VARCHAR) FROM hive_timestamp_nanos.tpch.\" + prestoViewNameDefault, \"VALUES ('1990-01-02 12:13:14.123')\");\n+\n+        assertThatThrownBy(\n+                // TODO Presto view schema is fixed on creation\n+                () -> assertQuery(nanosSessions, \"SELECT CAST(ts as VARCHAR) FROM \" + prestoViewNameDefault, \"VALUES ('1990-01-02 12:13:14.123456789')\")\n+        ).hasMessageContaining(\"Actual rows (up to 100 of 1 extra rows shown, 1 rows in total):\\n    [1990-01-02 12:13:14.123]\");\n+\n+        assertThatThrownBy(\n+                // TODO Presto view schema is fixed on creation\n+                () -> assertQuery(nanosSessions, \"SELECT CAST(ts as VARCHAR) FROM hive_timestamp_nanos.tpch.\" + prestoViewNameDefault, \"VALUES ('1990-01-02 12:13:14.123456789')\")\n+        ).hasMessageContaining(\"Actual rows (up to 100 of 1 extra rows shown, 1 rows in total):\\n    [1990-01-02 12:13:14.123]\");\n+\n+        // Presto view created with config property set to MILLIS and session property set to NANOS\n+        String prestoViewNameNanos = \"select_from_presto_view_hive_table_timestamps_millis_view_\" + randomTableSuffix();\n+        assertUpdate(nanosSessions, \"CREATE VIEW \" + prestoViewNameNanos + \" AS SELECT *  FROM \" + hiveTableName);\n+\n+        assertThatThrownBy(\n+                // TODO Presto view schema is fixed on creation\n+                () -> assertQuery(defaultSession, \"SELECT CAST(ts as VARCHAR) FROM \" + prestoViewNameNanos, \"VALUES ('1990-01-02 12:13:14.123')\")\n+        ).hasMessageContaining(\"Actual rows (up to 100 of 1 extra rows shown, 1 rows in total):\\n    [1990-01-02 12:13:14.123000000]\");\n+        assertThatThrownBy(\n+                // TODO Presto view schema is fixed on creation\n+                () ->assertQuery(defaultSession, \"SELECT CAST(ts as VARCHAR) FROM hive_timestamp_nanos.tpch.\" + prestoViewNameNanos, \"VALUES ('1990-01-02 12:13:14.123456789')\")\n+        ).hasMessageContaining(\"Actual rows (up to 100 of 1 extra rows shown, 1 rows in total):\\n    [1990-01-02 12:13:14.123000000]\");", "state": "SUBMITTED", "replyTo": null, "originalCommit": null, "originalPosition": 57}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": null, "afterCommit": null}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": null, "afterCommit": null}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": null, "afterCommit": null}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": null, "afterCommit": null}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": null, "afterCommit": null}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTU3NDA2MDIx", "url": "https://github.com/trinodb/trino/pull/6424#pullrequestreview-557406021", "createdAt": "2020-12-22T22:36:14Z", "commit": null, "state": "APPROVED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0yMlQyMjozNjoxNVrOIKLM3A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0yMlQyMjozNzozOFrOIKLOmQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NzU0MDE4OA==", "bodyText": "i guess code style (& checkstyle) expects ) to be on prev line", "url": "https://github.com/trinodb/trino/pull/6424#discussion_r547540188", "createdAt": "2020-12-22T22:36:15Z", "author": {"login": "findepi"}, "path": "presto-product-tests/src/main/java/io/prestosql/tests/hive/TestHiveViews.java", "diffHunk": "@@ -295,6 +297,45 @@ public void testSelectFromHiveViewWithoutDefaultCatalogAndSchema()\n                 .containsExactly(row(1L));\n     }\n \n+    @Test\n+    public void testTimestampHiveView()\n+    {\n+        onHive().executeQuery(\"DROP TABLE IF EXISTS timestamp_hive_table\");\n+        onHive().executeQuery(\"CREATE TABLE timestamp_hive_table AS SELECT cast('1990-01-02 12:13:14.123456789' AS timestamp) ts\");\n+        onHive().executeQuery(\"DROP VIEW IF EXISTS timestamp_hive_view\");\n+        onHive().executeQuery(\"CREATE VIEW timestamp_hive_view AS SELECT * FROM timestamp_hive_table\");\n+\n+        // timestamp_precision not set\n+        unsetSessionProperty(\"hive.timestamp_precision\");\n+        unsetSessionProperty(\"hive_timestamp_nanos.timestamp_precision\");\n+\n+        assertThat(query(\"SELECT CAST(ts AS varchar) FROM timestamp_hive_view\")).containsExactly(row(\"1990-01-02 12:13:14.123\"));\n+        assertThatThrownBy(\n+                // TODO(https://github.com/prestosql/presto/issues/6295) it is not possible to query Hive view with timestamps if hive.timestamp-precision=NANOSECONDS\n+                () -> assertThat(query(\"SELECT CAST(ts AS varchar) FROM hive_timestamp_nanos.default.timestamp_hive_view\")).containsExactly(row(\"1990-01-02 12:13:14.123456789\"))\n+        ).hasMessageContaining(\"timestamp(9) projected from query view at position 0 cannot be coerced to column [ts] of type timestamp(3) stored in view definition\");\n+\n+        setSessionProperty(\"hive.timestamp_precision\", \"'MILLISECONDS'\");\n+        setSessionProperty(\"hive_timestamp_nanos.timestamp_precision\", \"'MILLISECONDS'\");\n+\n+        assertThat(query(\"SELECT CAST(ts AS varchar) FROM timestamp_hive_view\")).containsExactly(row(\"1990-01-02 12:13:14.123\"));\n+        assertThatThrownBy(\n+                // TODO(https://github.com/prestosql/presto/issues/6295) it is not possible to query Hive view with timestamps if hive.timestamp-precision=NANOSECONDS\n+                () -> assertThat(query(\"SELECT CAST(ts AS varchar) FROM hive_timestamp_nanos.default.timestamp_hive_view\")).containsExactly(row(\"1990-01-02 12:13:14.123\"))\n+        ).hasMessageContaining(\"timestamp(9) projected from query view at position 0 cannot be coerced to column [ts] of type timestamp(3) stored in view definition\");", "state": "SUBMITTED", "replyTo": null, "originalCommit": null, "originalPosition": 45}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NzU0MDYzMw==", "bodyText": "I changed that. The catalog is now defined in test class.\n\nit is still here, right?\n(that's OK, i just don't understand)", "url": "https://github.com/trinodb/trino/pull/6424#discussion_r547540633", "createdAt": "2020-12-22T22:37:38Z", "author": {"login": "findepi"}, "path": "presto-product-tests-launcher/src/main/resources/docker/presto-product-tests/common/hadoop/hive_timestamp_nanos.properties", "diffHunk": "@@ -0,0 +1,16 @@\n+connector.name=hive-hadoop2\n+hive.metastore.uri=thrift://hadoop-master:9083\n+hive.config.resources=/docker/presto-product-tests/conf/presto/etc/hive-default-fs-site.xml\n+hive.allow-add-column=true\n+hive.allow-drop-column=true\n+hive.allow-rename-column=true\n+hive.allow-comment-table=true\n+hive.allow-comment-column=true\n+hive.allow-drop-table=true\n+hive.allow-rename-table=true\n+hive.allow-register-partition-procedure=true\n+hive.metastore-cache-ttl=0s\n+hive.fs.cache.max-size=10\n+hive.max-partitions-per-scan=100", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NzMyNDM2Mg=="}, "originalCommit": null, "originalPosition": 14}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": null, "afterCommit": null}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTU5MTI2OTE0", "url": "https://github.com/trinodb/trino/pull/6424#pullrequestreview-559126914", "createdAt": "2020-12-28T12:34:21Z", "commit": null, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "877594a9564ba15563c591efa3b1ba6270b4d946", "author": {"user": {"login": "losipiuk", "name": "\u0141ukasz Osipiuk"}}, "url": "https://github.com/trinodb/trino/commit/877594a9564ba15563c591efa3b1ba6270b4d946", "committedDate": "2021-01-04T11:44:17Z", "message": "Add hive_timestamp_nanos catalog to product tests"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "9c9fa488b3d70b3c107fd0717a8ffac92977c589", "author": {"user": {"login": "losipiuk", "name": "\u0141ukasz Osipiuk"}}, "url": "https://github.com/trinodb/trino/commit/9c9fa488b3d70b3c107fd0717a8ffac92977c589", "committedDate": "2021-01-04T11:58:49Z", "message": "Extract method"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a9700be8c2338e947bed992bccf7b50b99ab6ced", "author": {"user": {"login": "losipiuk", "name": "\u0141ukasz Osipiuk"}}, "url": "https://github.com/trinodb/trino/commit/a9700be8c2338e947bed992bccf7b50b99ab6ced", "committedDate": "2021-01-04T11:59:20Z", "message": "Add tests for querying Hive views with timestamps"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e1c2edce17504a1f226d31b7ada949ab72bc8403", "author": {"user": {"login": "losipiuk", "name": "\u0141ukasz Osipiuk"}}, "url": "https://github.com/trinodb/trino/commit/e1c2edce17504a1f226d31b7ada949ab72bc8403", "committedDate": "2021-01-04T11:59:45Z", "message": "Select role for all catalogs"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f1598777851d975d89356cde5d2f6030a95471c7", "author": {"user": {"login": "losipiuk", "name": "\u0141ukasz Osipiuk"}}, "url": "https://github.com/trinodb/trino/commit/f1598777851d975d89356cde5d2f6030a95471c7", "committedDate": "2021-01-04T12:00:13Z", "message": "Drop improper contant use"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ec85bf063198ce5c4d3124a8a750630962f11c1b", "author": {"user": {"login": "losipiuk", "name": "\u0141ukasz Osipiuk"}}, "url": "https://github.com/trinodb/trino/commit/ec85bf063198ce5c4d3124a8a750630962f11c1b", "committedDate": "2021-01-04T12:00:38Z", "message": "Add test for querying Presto view referencing Hive table with timestamps"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": null, "afterCommit": {"oid": "ec85bf063198ce5c4d3124a8a750630962f11c1b", "author": {"user": {"login": "losipiuk", "name": "\u0141ukasz Osipiuk"}}, "url": "https://github.com/trinodb/trino/commit/ec85bf063198ce5c4d3124a8a750630962f11c1b", "committedDate": "2021-01-04T12:00:38Z", "message": "Add test for querying Presto view referencing Hive table with timestamps"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "8e5014f717783354a8e3c9af0777311acefda53b", "author": {"user": {"login": "losipiuk", "name": "\u0141ukasz Osipiuk"}}, "url": "https://github.com/trinodb/trino/commit/8e5014f717783354a8e3c9af0777311acefda53b", "committedDate": "2021-01-04T16:10:57Z", "message": "empty"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1910, "cost": 1, "resetAt": "2021-10-28T20:13:43Z"}}}