{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTQwMTIwMDkz", "number": 6343, "reviewThreads": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xNVQxMjoxOTo1MVrOFFjw8A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xNVQxMjoyMzo0OFrOFFj3Ow==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzQxMzczMTY4OnYy", "diffSide": "RIGHT", "path": "presto-base-jdbc/src/test/java/io/prestosql/plugin/jdbc/TestJdbcQueryBuilder.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xNVQxMjoxOTo1MVrOIGIIJg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xNVQxMjozMTowNVrOIGIifQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MzI5NTUyNg==", "bodyText": "I don't like this assertion it is very detailed and so it it will be fragile to changes", "url": "https://github.com/trinodb/trino/pull/6343#discussion_r543295526", "createdAt": "2020-12-15T12:19:51Z", "author": {"login": "kokosing"}, "path": "presto-base-jdbc/src/test/java/io/prestosql/plugin/jdbc/TestJdbcQueryBuilder.java", "diffHunk": "@@ -237,11 +236,22 @@ public void testNormalBuildSql()\n                 .build());\n \n         Connection connection = database.getConnection();\n-        try (PreparedStatement preparedStatement = new QueryBuilder(jdbcClient).buildSql(SESSION, connection, TEST_TABLE, Optional.empty(), columns, tupleDomain, Optional.empty(), identity());\n-                ResultSet resultSet = preparedStatement.executeQuery()) {\n+        try (PreparedStatement preparedStatement = new QueryBuilder(jdbcClient).buildSql(SESSION, connection, TEST_TABLE, Optional.empty(), columns, tupleDomain, Optional.empty(), identity())) {\n+            assertThat(lastQuery).isEqualTo(\"\" +\n+                    \"SELECT \\\"col_0\\\" AS \\\"col_0\\\", \\\"col_1\\\" AS \\\"col_1\\\", \\\"col_2\\\" AS \\\"col_2\\\", \\\"col_3\\\" AS \\\"col_3\\\", \\\"col_4\\\" AS \\\"col_4\\\", \\\"col_5\\\" AS \\\"col_5\\\", \" +\n+                    \"\\\"col_6\\\" AS \\\"col_6\\\", \\\"col_7\\\" AS \\\"col_7\\\", \\\"col_8\\\" AS \\\"col_8\\\", \\\"col_9\\\" AS \\\"col_9\\\", \\\"col_10\\\" AS \\\"col_10\\\", \\\"col_11\\\" AS \\\"col_11\\\" \" +\n+                    \"FROM \\\"test_table\\\" \" +\n+                    \"WHERE ((\\\"col_0\\\" < ?) OR (\\\"col_0\\\" >= ? AND \\\"col_0\\\" <= ?) OR (\\\"col_0\\\" > ?) OR \\\"col_0\\\" IN (?,?)) \" +\n+                    \"AND ((\\\"col_1\\\" >= ? AND \\\"col_1\\\" <= ?) OR (\\\"col_1\\\" >= ? AND \\\"col_1\\\" <= ?) OR \\\"col_1\\\" IN (?,?,?,?)) \" +\n+                    \"AND ((\\\"col_7\\\" >= ? AND \\\"col_7\\\" < ?) OR (\\\"col_7\\\" >= ? AND \\\"col_7\\\" < ?)) \" +\n+                    \"AND ((\\\"col_8\\\" >= ? AND \\\"col_8\\\" < ?) OR (\\\"col_8\\\" >= ? AND \\\"col_8\\\" <= ?)) \" +\n+                    \"AND ((\\\"col_9\\\" < ?) OR \\\"col_9\\\" IN (?,?)) \" +\n+                    \"AND (\\\"col_2\\\" = ?)\");", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "528f574978fcaa5676627b747b913099ffab71ad"}, "originalPosition": 24}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MzMwMjI2OQ==", "bodyText": "It is required to visualize the changes and this is the only place where we test queries output to remote system.\nAlso, the structure of output queries changes very very rarely, so expected maint cost is low.", "url": "https://github.com/trinodb/trino/pull/6343#discussion_r543302269", "createdAt": "2020-12-15T12:31:05Z", "author": {"login": "findepi"}, "path": "presto-base-jdbc/src/test/java/io/prestosql/plugin/jdbc/TestJdbcQueryBuilder.java", "diffHunk": "@@ -237,11 +236,22 @@ public void testNormalBuildSql()\n                 .build());\n \n         Connection connection = database.getConnection();\n-        try (PreparedStatement preparedStatement = new QueryBuilder(jdbcClient).buildSql(SESSION, connection, TEST_TABLE, Optional.empty(), columns, tupleDomain, Optional.empty(), identity());\n-                ResultSet resultSet = preparedStatement.executeQuery()) {\n+        try (PreparedStatement preparedStatement = new QueryBuilder(jdbcClient).buildSql(SESSION, connection, TEST_TABLE, Optional.empty(), columns, tupleDomain, Optional.empty(), identity())) {\n+            assertThat(lastQuery).isEqualTo(\"\" +\n+                    \"SELECT \\\"col_0\\\" AS \\\"col_0\\\", \\\"col_1\\\" AS \\\"col_1\\\", \\\"col_2\\\" AS \\\"col_2\\\", \\\"col_3\\\" AS \\\"col_3\\\", \\\"col_4\\\" AS \\\"col_4\\\", \\\"col_5\\\" AS \\\"col_5\\\", \" +\n+                    \"\\\"col_6\\\" AS \\\"col_6\\\", \\\"col_7\\\" AS \\\"col_7\\\", \\\"col_8\\\" AS \\\"col_8\\\", \\\"col_9\\\" AS \\\"col_9\\\", \\\"col_10\\\" AS \\\"col_10\\\", \\\"col_11\\\" AS \\\"col_11\\\" \" +\n+                    \"FROM \\\"test_table\\\" \" +\n+                    \"WHERE ((\\\"col_0\\\" < ?) OR (\\\"col_0\\\" >= ? AND \\\"col_0\\\" <= ?) OR (\\\"col_0\\\" > ?) OR \\\"col_0\\\" IN (?,?)) \" +\n+                    \"AND ((\\\"col_1\\\" >= ? AND \\\"col_1\\\" <= ?) OR (\\\"col_1\\\" >= ? AND \\\"col_1\\\" <= ?) OR \\\"col_1\\\" IN (?,?,?,?)) \" +\n+                    \"AND ((\\\"col_7\\\" >= ? AND \\\"col_7\\\" < ?) OR (\\\"col_7\\\" >= ? AND \\\"col_7\\\" < ?)) \" +\n+                    \"AND ((\\\"col_8\\\" >= ? AND \\\"col_8\\\" < ?) OR (\\\"col_8\\\" >= ? AND \\\"col_8\\\" <= ?)) \" +\n+                    \"AND ((\\\"col_9\\\" < ?) OR \\\"col_9\\\" IN (?,?)) \" +\n+                    \"AND (\\\"col_2\\\" = ?)\");", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MzI5NTUyNg=="}, "originalCommit": {"oid": "528f574978fcaa5676627b747b913099ffab71ad"}, "originalPosition": 24}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzQxMzc0MjA3OnYy", "diffSide": "RIGHT", "path": "presto-spi/src/main/java/io/prestosql/spi/predicate/Utils.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xNVQxMjoyMjoyMlrOIGIOQA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xNVQxMjoyMjoyMlrOIGIOQA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MzI5NzA4OA==", "bodyText": "Optional (separate commit)?", "url": "https://github.com/trinodb/trino/pull/6343#discussion_r543297088", "createdAt": "2020-12-15T12:22:22Z", "author": {"login": "kokosing"}, "path": "presto-spi/src/main/java/io/prestosql/spi/predicate/Utils.java", "diffHunk": "@@ -31,10 +33,13 @@ private Utils() {}\n     // just for this use case.\n     static final TypeOperators TUPLE_DOMAIN_TYPE_OPERATORS = new TypeOperators();\n \n-    public static Block nativeValueToBlock(Type type, Object object)\n+    public static Block nativeValueToBlock(Type type, @Nullable Object object)", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ecd3ed6ae45a52d23ac0235b56c4ea28ff666c25"}, "originalPosition": 14}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzQxMzc0Nzc5OnYy", "diffSide": "RIGHT", "path": "presto-base-jdbc/src/test/java/io/prestosql/plugin/jdbc/TestJdbcQueryBuilder.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xNVQxMjoyMzo0OFrOIGIRiw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xNVQxMjozMTo1OVrOIGIkjA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MzI5NzkzMQ==", "bodyText": "Do we have query in ATDQ to trigger this pushdown?", "url": "https://github.com/trinodb/trino/pull/6343#discussion_r543297931", "createdAt": "2020-12-15T12:23:48Z", "author": {"login": "kokosing"}, "path": "presto-base-jdbc/src/test/java/io/prestosql/plugin/jdbc/TestJdbcQueryBuilder.java", "diffHunk": "@@ -290,8 +290,8 @@ public void testBuildSqlWithDomainComplement()\n             assertThat(lastQuery).isEqualTo(\"\" +", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "baf22ef4125f33ba0a07cb100e6628f88cafc2c2"}, "originalPosition": 1}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MzMwMjc5Ng==", "bodyText": "yes, for example here\nhttps://github.com/prestosql/presto/blob/8573d76f676b4535de6aaa29d3d739f114f3348b/presto-testing/src/main/java/io/prestosql/testing/AbstractTestQueries.java#L1647", "url": "https://github.com/trinodb/trino/pull/6343#discussion_r543302796", "createdAt": "2020-12-15T12:31:59Z", "author": {"login": "findepi"}, "path": "presto-base-jdbc/src/test/java/io/prestosql/plugin/jdbc/TestJdbcQueryBuilder.java", "diffHunk": "@@ -290,8 +290,8 @@ public void testBuildSqlWithDomainComplement()\n             assertThat(lastQuery).isEqualTo(\"\" +", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MzI5NzkzMQ=="}, "originalCommit": {"oid": "baf22ef4125f33ba0a07cb100e6628f88cafc2c2"}, "originalPosition": 1}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4347, "cost": 1, "resetAt": "2021-11-12T12:57:47Z"}}}