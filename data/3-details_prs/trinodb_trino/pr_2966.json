{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0MzgxMzgwNzY5", "number": 2966, "title": "Elasticsearch name clash: omit conflicting keys.", "bodyText": "Fixes #2965", "createdAt": "2020-02-28T13:06:33Z", "url": "https://github.com/trinodb/trino/pull/2966", "merged": true, "mergeCommit": {"oid": "82ce6881124879d6706a75bae44261a6314106cc"}, "closed": true, "closedAt": "2020-02-29T23:48:31Z", "author": {"login": "msosnicki"}, "timelineItems": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcI1ZHugFqTM2NjY0MzQ1Mw==", "endCursor": "Y3Vyc29yOnYyOpPPAAABcJNZ0XAFqTM2NjgyNjE4OQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzY2NjQzNDUz", "url": "https://github.com/trinodb/trino/pull/2966#pullrequestreview-366643453", "createdAt": "2020-02-28T19:47:19Z", "commit": null, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yOFQxOTo0NzoyMFrOFwAyQg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yOFQxOTo0NzoyNFrOFwAyYQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NTg4ODgzNA==", "bodyText": "This will make the chosen local sensitive to what the JVM is configured to use. Let's use Locale.ENGLISH like we do everywhere else.\nAlso, storing it in a field is unnecessary, so just inline it where it's used.", "url": "https://github.com/trinodb/trino/pull/2966#discussion_r385888834", "createdAt": "2020-02-28T19:47:20Z", "author": {"login": "martint"}, "path": "presto-elasticsearch/src/main/java/io/prestosql/elasticsearch/ElasticsearchMetadata.java", "diffHunk": "@@ -69,6 +71,8 @@\n     private final ElasticsearchClient client;\n     private final String schemaName;\n \n+    private final Locale locale = Locale.getDefault();", "state": "SUBMITTED", "replyTo": null, "originalCommit": null, "originalPosition": 16}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NTg4ODg2NQ==", "bodyText": "Let's format it as follows:\n\n  \n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                    Map<String, Long> counts = metadata.getSchema().getFields().stream()\n          \n          \n            \n                            .collect(Collectors.groupingBy(f -> f.getName().toLowerCase(locale), Collectors.counting()));\n          \n          \n            \n                    Map<String, Long> counts = metadata.getSchema()\n          \n          \n            \n                            .getFields().stream()\n          \n          \n            \n                            .collect(Collectors.groupingBy(field -> field.getName().toLowerCase(locale), Collectors.counting()));", "url": "https://github.com/trinodb/trino/pull/2966#discussion_r385888865", "createdAt": "2020-02-28T19:47:24Z", "author": {"login": "martint"}, "path": "presto-elasticsearch/src/main/java/io/prestosql/elasticsearch/ElasticsearchMetadata.java", "diffHunk": "@@ -129,9 +133,12 @@ private ConnectorTableMetadata getTableMetadata(String schemaName, String tableN\n         result.add(BuiltinColumns.SOURCE.getMetadata());\n         result.add(BuiltinColumns.SCORE.getMetadata());\n \n+        Map<String, Long> counts = metadata.getSchema().getFields().stream()\n+                .collect(Collectors.groupingBy(f -> f.getName().toLowerCase(locale), Collectors.counting()));", "state": "SUBMITTED", "replyTo": null, "originalCommit": null, "originalPosition": 26}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "68e7117f77b8845058fcafde2ecc8d33b927e415", "author": {"user": {"login": "msosnicki", "name": null}}, "url": "https://github.com/trinodb/trino/commit/68e7117f77b8845058fcafde2ecc8d33b927e415", "committedDate": "2020-02-28T20:23:09Z", "message": "#2965 Omit case-insensitive duplicate fields in Elasticsearch"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": null, "afterCommit": {"oid": "68e7117f77b8845058fcafde2ecc8d33b927e415", "author": {"user": {"login": "msosnicki", "name": null}}, "url": "https://github.com/trinodb/trino/commit/68e7117f77b8845058fcafde2ecc8d33b927e415", "committedDate": "2020-02-28T20:23:09Z", "message": "#2965 Omit case-insensitive duplicate fields in Elasticsearch"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzY2ODI2MTg5", "url": "https://github.com/trinodb/trino/pull/2966#pullrequestreview-366826189", "createdAt": "2020-02-29T23:48:22Z", "commit": {"oid": "68e7117f77b8845058fcafde2ecc8d33b927e415"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1617, "cost": 1, "resetAt": "2021-10-28T20:13:43Z"}}}