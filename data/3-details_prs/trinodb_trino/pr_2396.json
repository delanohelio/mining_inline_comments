{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0MzU4ODE2MjI4", "number": 2396, "title": "Remove TestTablePartitioningInsertInto", "bodyText": "The test does not provide much additional value. The functionality is\ntested by TestHiveIntegrationSmokeTest#testPartitionPerScanLimit() as\nwell.\nFixes #2278", "createdAt": "2020-01-02T22:30:45Z", "url": "https://github.com/trinodb/trino/pull/2396", "merged": true, "mergeCommit": {"oid": "ced0253574b406947672f1b2e6961a6b846a0c11"}, "closed": true, "closedAt": "2020-01-03T11:27:50Z", "author": {"login": "findepi"}, "timelineItems": {"totalCount": 7, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABb2qcaOgFqTMzNzk4ODk3NA==", "endCursor": "Y3Vyc29yOnYyOpPPAAABb2ryFoABqjI5MTk4NjQ3Nzk=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzM3OTg4OTc0", "url": "https://github.com/trinodb/trino/pull/2396#pullrequestreview-337988974", "createdAt": "2020-01-03T08:53:53Z", "commit": null, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0wM1QwODo1Mzo1M1rOFZ7vkg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0wM1QwODo1Mzo1M1rOFZ7vkg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2MjczNzU1NA==", "bodyText": "I guess it does not solve the problem completely. I would suspect that every test that is using QueryStatsClient is vulnerable of being flaky.", "url": "https://github.com/trinodb/trino/pull/2396#discussion_r362737554", "createdAt": "2020-01-03T08:53:53Z", "author": {"login": "kokosing"}, "path": "presto-product-tests/src/main/java/io/prestosql/tests/hive/BaseHivePartitioningTest.java", "diffHunk": "@@ -1,55 +0,0 @@\n-/*\n- * Licensed under the Apache License, Version 2.0 (the \"License\");\n- * you may not use this file except in compliance with the License.\n- * You may obtain a copy of the License at\n- *\n- *     http://www.apache.org/licenses/LICENSE-2.0\n- *\n- * Unless required by applicable law or agreed to in writing, software\n- * distributed under the License is distributed on an \"AS IS\" BASIS,\n- * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n- * See the License for the specific language governing permissions and\n- * limitations under the License.\n- */\n-package io.prestosql.tests.hive;\n-\n-import io.prestosql.jdbc.PrestoResultSet;\n-import io.prestosql.tempto.BeforeTestWithContext;\n-import io.prestosql.tempto.ProductTest;\n-import io.prestosql.tempto.query.QueryResult;\n-import io.prestosql.tests.querystats.QueryStatsClient;\n-\n-import javax.inject.Inject;\n-\n-import java.sql.SQLException;\n-\n-import static io.prestosql.tempto.query.QueryExecutor.query;\n-import static java.lang.String.format;\n-\n-public abstract class BaseHivePartitioningTest\n-        extends ProductTest\n-{\n-    private QueryStatsClient queryStatsClient;\n-\n-    @Inject\n-    @BeforeTestWithContext\n-    public void setUp(QueryStatsClient queryStatsClient)\n-    {\n-        this.queryStatsClient = queryStatsClient;", "state": "SUBMITTED", "replyTo": null, "originalCommit": null, "originalPosition": 38}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzM3OTkwMjkw", "url": "https://github.com/trinodb/trino/pull/2396#pullrequestreview-337990290", "createdAt": "2020-01-03T08:58:10Z", "commit": null, "state": "COMMENTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0wM1QwODo1ODoxMFrOFZ7zRA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0wM1QwODo1OToxN1rOFZ70RQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2MjczODUwMA==", "bodyText": "Luckily this is the only test that it was using this, so please remove QueryStatsClient and friends as well.", "url": "https://github.com/trinodb/trino/pull/2396#discussion_r362738500", "createdAt": "2020-01-03T08:58:10Z", "author": {"login": "kokosing"}, "path": "presto-product-tests/src/main/java/io/prestosql/tests/hive/BaseHivePartitioningTest.java", "diffHunk": "@@ -1,55 +0,0 @@\n-/*\n- * Licensed under the Apache License, Version 2.0 (the \"License\");\n- * you may not use this file except in compliance with the License.\n- * You may obtain a copy of the License at\n- *\n- *     http://www.apache.org/licenses/LICENSE-2.0\n- *\n- * Unless required by applicable law or agreed to in writing, software\n- * distributed under the License is distributed on an \"AS IS\" BASIS,\n- * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n- * See the License for the specific language governing permissions and\n- * limitations under the License.\n- */\n-package io.prestosql.tests.hive;\n-\n-import io.prestosql.jdbc.PrestoResultSet;\n-import io.prestosql.tempto.BeforeTestWithContext;\n-import io.prestosql.tempto.ProductTest;\n-import io.prestosql.tempto.query.QueryResult;\n-import io.prestosql.tests.querystats.QueryStatsClient;\n-\n-import javax.inject.Inject;\n-\n-import java.sql.SQLException;\n-\n-import static io.prestosql.tempto.query.QueryExecutor.query;\n-import static java.lang.String.format;\n-\n-public abstract class BaseHivePartitioningTest\n-        extends ProductTest\n-{\n-    private QueryStatsClient queryStatsClient;\n-\n-    @Inject\n-    @BeforeTestWithContext\n-    public void setUp(QueryStatsClient queryStatsClient)\n-    {\n-        this.queryStatsClient = queryStatsClient;", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2MjczNzU1NA=="}, "originalCommit": null, "originalPosition": 38}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2MjczODc1Nw==", "bodyText": "Do we have a test coverage partitioning is working effectively (end-to-end) somewhere else? Even though test was... it provided some value that I would like no to lose.", "url": "https://github.com/trinodb/trino/pull/2396#discussion_r362738757", "createdAt": "2020-01-03T08:59:17Z", "author": {"login": "kokosing"}, "path": "presto-product-tests/src/main/java/io/prestosql/tests/hive/TestTablePartitioningInsertInto.java", "diffHunk": "@@ -1,86 +0,0 @@\n-/*\n- * Licensed under the Apache License, Version 2.0 (the \"License\");\n- * you may not use this file except in compliance with the License.\n- * You may obtain a copy of the License at\n- *\n- *     http://www.apache.org/licenses/LICENSE-2.0\n- *\n- * Unless required by applicable law or agreed to in writing, software\n- * distributed under the License is distributed on an \"AS IS\" BASIS,\n- * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n- * See the License for the specific language governing permissions and\n- * limitations under the License.\n- */\n-package io.prestosql.tests.hive;\n-\n-import io.prestosql.tempto.Requirement;\n-import io.prestosql.tempto.RequirementsProvider;\n-import io.prestosql.tempto.configuration.Configuration;\n-import io.prestosql.tempto.query.QueryResult;\n-import org.testng.annotations.Test;\n-\n-import static io.prestosql.tempto.Requirements.compose;\n-import static io.prestosql.tempto.fulfillment.table.MutableTableRequirement.State.CREATED;\n-import static io.prestosql.tempto.fulfillment.table.MutableTablesState.mutableTablesState;\n-import static io.prestosql.tempto.fulfillment.table.TableRequirements.mutableTable;\n-import static io.prestosql.tempto.fulfillment.table.hive.tpch.TpchTableDefinitions.NATION;\n-import static io.prestosql.tempto.query.QueryExecutor.query;\n-import static io.prestosql.tests.TestGroups.SMOKE;\n-import static io.prestosql.tests.hive.HiveTableDefinitions.NATION_PARTITIONED_BY_BIGINT_REGIONKEY;\n-import static io.prestosql.tests.hive.HiveTableDefinitions.NATION_PARTITIONED_BY_REGIONKEY_NUMBER_OF_LINES_PER_SPLIT;\n-import static java.lang.String.format;\n-import static org.assertj.core.api.Assertions.assertThat;\n-\n-public class TestTablePartitioningInsertInto\n-        extends BaseHivePartitioningTest\n-        implements RequirementsProvider\n-{\n-    private static final String TARGET_NATION_NAME = \"target_nation_test\";\n-\n-    @Override\n-    public Requirement getRequirements(Configuration configuration)\n-    {\n-        return compose(\n-                mutableTable(NATION_PARTITIONED_BY_BIGINT_REGIONKEY),\n-                mutableTable(NATION, TARGET_NATION_NAME, CREATED));\n-    }\n-\n-    @Test(groups = SMOKE)\n-    public void selectFromPartitionedNation()\n-            throws Exception\n-    {\n-        // read all data\n-        testQuerySplitsNumber(\"p_nationkey < 40\", 3);\n-\n-        // read no partitions\n-        testQuerySplitsNumber(\"p_regionkey = 42\", 0);\n-\n-        // read one partition\n-        testQuerySplitsNumber(\"p_regionkey = 2 AND p_nationkey < 40\", 1);\n-        // read two partitions\n-        testQuerySplitsNumber(\"p_regionkey = 2 AND p_nationkey < 40 or p_regionkey = 3\", 2);", "state": "SUBMITTED", "replyTo": null, "originalCommit": null, "originalPosition": 61}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": null, "afterCommit": null}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": null, "afterCommit": null}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzM4MDE3MTAx", "url": "https://github.com/trinodb/trino/pull/2396#pullrequestreview-338017101", "createdAt": "2020-01-03T10:15:35Z", "commit": null, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "fe606fa32ccb5997cf5d8c8aa25a01f709b1f686", "author": {"user": {"login": "findepi", "name": "Piotr Findeisen"}}, "url": "https://github.com/trinodb/trino/commit/fe606fa32ccb5997cf5d8c8aa25a01f709b1f686", "committedDate": "2020-01-03T10:25:44Z", "message": "Remove TestTablePartitioningInsertInto\n\nThe test does not provide much additional value. The functionality is\ntested by `TestHiveIntegrationSmokeTest#testPartitionPerScanLimit()` as\nwell."}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": null, "afterCommit": {"oid": "fe606fa32ccb5997cf5d8c8aa25a01f709b1f686", "author": {"user": {"login": "findepi", "name": "Piotr Findeisen"}}, "url": "https://github.com/trinodb/trino/commit/fe606fa32ccb5997cf5d8c8aa25a01f709b1f686", "committedDate": "2020-01-03T10:25:44Z", "message": "Remove TestTablePartitioningInsertInto\n\nThe test does not provide much additional value. The functionality is\ntested by `TestHiveIntegrationSmokeTest#testPartitionPerScanLimit()` as\nwell."}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1005, "cost": 1, "resetAt": "2021-10-28T19:08:13Z"}}}