{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTI3Mzg2NzQ3", "number": 6090, "title": "Ensure no operator info is ignored", "bodyText": "Ensure the operator infos can be merged, rather than ignoring the\ninconsistencies and returning a \"random\" one.", "createdAt": "2020-11-25T11:45:26Z", "url": "https://github.com/trinodb/trino/pull/6090", "merged": true, "mergeCommit": {"oid": "e300ae8ec99767c5579721d86057ca4f10084124"}, "closed": true, "closedAt": "2020-11-26T12:02:30Z", "author": {"login": "findepi"}, "timelineItems": {"totalCount": 6, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdf85PlgFqTUzODQxNDYyMg==", "endCursor": "Y3Vyc29yOnYyOpPPAAABdgRu0OABqjQwNDIyMTk0MDQ=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTM4NDE0NjIy", "url": "https://github.com/trinodb/trino/pull/6090#pullrequestreview-538414622", "createdAt": "2020-11-25T11:45:41Z", "commit": null, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0yNVQxMTo0NTo0MVrOH5vvLA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0yNVQxMTo0NTo0MVrOH5vvLA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMDMxMzAwNA==", "bodyText": "i think we should actually throw here.", "url": "https://github.com/trinodb/trino/pull/6090#discussion_r530313004", "createdAt": "2020-11-25T11:45:41Z", "author": {"login": "findepi"}, "path": "presto-main/src/main/java/io/prestosql/operator/OperatorStats.java", "diffHunk": "@@ -521,8 +524,14 @@ public OperatorStats add(Iterable<OperatorStats> operators)\n             }\n \n             OperatorInfo info = operator.getInfo();\n-            if (base != null && info != null && base.getClass() == info.getClass()) {\n-                base = mergeInfo(base, info);\n+            if (base != null && info != null) {\n+                if (base.getClass() != info.getClass()) {\n+                    // TODO should we throw here?\n+                    log.warn(\"Cannot merge operator info: %s and %s\", base, info);", "state": "SUBMITTED", "replyTo": null, "originalCommit": null, "originalPosition": 26}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTM4NDE3OTk3", "url": "https://github.com/trinodb/trino/pull/6090#pullrequestreview-538417997", "createdAt": "2020-11-25T11:50:29Z", "commit": null, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": null, "afterCommit": null}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTM4OTUyODg2", "url": "https://github.com/trinodb/trino/pull/6090#pullrequestreview-538952886", "createdAt": "2020-11-26T02:26:43Z", "commit": null, "state": "APPROVED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0yNlQwMjoyNjo0NFrOH6Jrow==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0yNlQwMjoyNjo0NFrOH6Jrow==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMDczODA4Mw==", "bodyText": "verify() throws a more appropriate exception", "url": "https://github.com/trinodb/trino/pull/6090#discussion_r530738083", "createdAt": "2020-11-26T02:26:44Z", "author": {"login": "electrum"}, "path": "presto-main/src/main/java/io/prestosql/operator/OperatorStats.java", "diffHunk": "@@ -521,7 +522,8 @@ public OperatorStats add(Iterable<OperatorStats> operators)\n             }\n \n             OperatorInfo info = operator.getInfo();\n-            if (base != null && info != null && base.getClass() == info.getClass()) {\n+            if (base != null && info != null) {\n+                checkState(base.getClass() == info.getClass(), \"Cannot merge operator infos: %s and %s\", base, info);", "state": "SUBMITTED", "replyTo": null, "originalCommit": null, "originalPosition": 14}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "46236b923e10f6873cdca62bc86a1eed86111563", "author": {"user": {"login": "findepi", "name": "Piotr Findeisen"}}, "url": "https://github.com/trinodb/trino/commit/46236b923e10f6873cdca62bc86a1eed86111563", "committedDate": "2020-11-26T12:02:09Z", "message": "Ensure no operator info is ignored\n\nEnsure the operator infos can be merged, rather than ignoring the\ninconsistencies and returning a \"random\" one."}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": null, "afterCommit": {"oid": "46236b923e10f6873cdca62bc86a1eed86111563", "author": {"user": {"login": "findepi", "name": "Piotr Findeisen"}}, "url": "https://github.com/trinodb/trino/commit/46236b923e10f6873cdca62bc86a1eed86111563", "committedDate": "2020-11-26T12:02:09Z", "message": "Ensure no operator info is ignored\n\nEnsure the operator infos can be merged, rather than ignoring the\ninconsistencies and returning a \"random\" one."}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2335, "cost": 1, "resetAt": "2021-10-28T20:13:43Z"}}}