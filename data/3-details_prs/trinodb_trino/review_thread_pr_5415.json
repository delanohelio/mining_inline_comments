{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDk3ODE0MDQy", "number": 5415, "reviewThreads": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wNVQxMjo0MDo0OVrOEqTKyA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wNVQxOToxOTowMVrOEqcvow==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzEyNzg5NzA0OnYy", "diffSide": "RIGHT", "path": "presto-product-tests-launcher/src/main/java/io/prestosql/tests/product/launcher/env/Environment.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wNVQxMjo0MDo0OVrOHcbL8w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wNVQxMjo0NDoxNFrOHcbTrA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5OTU2NzYwMw==", "bodyText": "does it relly solve Could not attach tests to unhealthy environment xxxxxxx???\nnothing was stopped at my machine, containers were still working as expected, the problem was somewhere in allCOntainersHealthy probably", "url": "https://github.com/trinodb/trino/pull/5415#discussion_r499567603", "createdAt": "2020-10-05T12:40:49Z", "author": {"login": "iirekm"}, "path": "presto-product-tests-launcher/src/main/java/io/prestosql/tests/product/launcher/env/Environment.java", "diffHunk": "@@ -150,6 +157,11 @@ private Environment tryStart()\n \n     public void stop()\n     {\n+        if (attached) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": null, "originalPosition": 27}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5OTU2OTU4MA==", "bodyText": "I removed that in eed10ac", "url": "https://github.com/trinodb/trino/pull/5415#discussion_r499569580", "createdAt": "2020-10-05T12:44:14Z", "author": {"login": "kokosing"}, "path": "presto-product-tests-launcher/src/main/java/io/prestosql/tests/product/launcher/env/Environment.java", "diffHunk": "@@ -150,6 +157,11 @@ private Environment tryStart()\n \n     public void stop()\n     {\n+        if (attached) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5OTU2NzYwMw=="}, "originalCommit": null, "originalPosition": 27}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzEyODQwMzE4OnYy", "diffSide": "RIGHT", "path": "presto-product-tests-launcher/src/main/java/io/prestosql/tests/product/launcher/env/Environment.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wNVQxNDozNzoyNFrOHcgEYw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wNVQxNDozNzoyNFrOHcgEYw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5OTY0NzU4Nw==", "bodyText": "unrelated", "url": "https://github.com/trinodb/trino/pull/5415#discussion_r499647587", "createdAt": "2020-10-05T14:37:24Z", "author": {"login": "findepi"}, "path": "presto-product-tests-launcher/src/main/java/io/prestosql/tests/product/launcher/env/Environment.java", "diffHunk": "@@ -383,10 +395,10 @@ private static void setContainerAutoRemove(CreateContainerCmd createContainerCmd\n         private static List<Ulimit> standardUlimits()\n         {\n             return ImmutableList.of(\n-                // Number of open file descriptors\n-                new Ulimit(\"nofile\", 65535L, 65535L),\n-                // Number of processes\n-                new Ulimit(\"nproc\", 8096L, 8096L));\n+                    // Number of open file descriptors\n+                    new Ulimit(\"nofile\", 65535L, 65535L),", "state": "SUBMITTED", "replyTo": null, "originalCommit": null, "originalPosition": 44}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzEyODQxMTkzOnYy", "diffSide": "RIGHT", "path": "presto-product-tests-launcher/src/main/java/io/prestosql/tests/product/launcher/env/Environment.java", "isResolved": false, "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wNVQxNDozOToxNlrOHcgJ0A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wNVQyMDowMzo0OVrOHcr2DA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5OTY0ODk3Ng==", "bodyText": "The fact that stop does not stop is not intuitive.\nperhaps, make it throw illegal state and update  test attach not to call stop, if there is nothing to stop.\nor, just change the test attach flow and then no changes needed in Env clas\nalso, can the test container leak in test attach mode?\n(i hope it's controller by ryuk and \"safe to leak\")", "url": "https://github.com/trinodb/trino/pull/5415#discussion_r499648976", "createdAt": "2020-10-05T14:39:16Z", "author": {"login": "findepi"}, "path": "presto-product-tests-launcher/src/main/java/io/prestosql/tests/product/launcher/env/Environment.java", "diffHunk": "@@ -150,6 +157,11 @@ private Environment tryStart()\n \n     public void stop()\n     {\n+        if (attached) {\n+            // do not stop attached, externally controlled environment", "state": "SUBMITTED", "replyTo": null, "originalCommit": null, "originalPosition": 28}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5OTc4Nzk0MA==", "bodyText": "The fact that stop does not stop is not intuitive.\n\nFact. I will move this if to close method and throw in  stop\n\nalso, can the test container leak in test attach mode?\n\nI tested it and it was cleared. I will test it more with interruptions.", "url": "https://github.com/trinodb/trino/pull/5415#discussion_r499787940", "createdAt": "2020-10-05T18:23:04Z", "author": {"login": "kokosing"}, "path": "presto-product-tests-launcher/src/main/java/io/prestosql/tests/product/launcher/env/Environment.java", "diffHunk": "@@ -150,6 +157,11 @@ private Environment tryStart()\n \n     public void stop()\n     {\n+        if (attached) {\n+            // do not stop attached, externally controlled environment", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5OTY0ODk3Ng=="}, "originalCommit": null, "originalPosition": 28}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5OTg0MDUyNA==", "bodyText": "I tested it and it was cleared. I will test it more with interruptions.\n\nIt works as expected.", "url": "https://github.com/trinodb/trino/pull/5415#discussion_r499840524", "createdAt": "2020-10-05T20:03:49Z", "author": {"login": "kokosing"}, "path": "presto-product-tests-launcher/src/main/java/io/prestosql/tests/product/launcher/env/Environment.java", "diffHunk": "@@ -150,6 +157,11 @@ private Environment tryStart()\n \n     public void stop()\n     {\n+        if (attached) {\n+            // do not stop attached, externally controlled environment", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5OTY0ODk3Ng=="}, "originalCommit": null, "originalPosition": 28}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzEyOTQ2NTk1OnYy", "diffSide": "RIGHT", "path": "presto-product-tests-launcher/src/main/java/io/prestosql/tests/product/launcher/cli/EnvironmentUp.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wNVQxOToxOTowMVrOHcqcfw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wNVQxOToxOTowMVrOHcqcfw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5OTgxNzU5OQ==", "bodyText": "can you add .setAttached() method to Builder instead?", "url": "https://github.com/trinodb/trino/pull/5415#discussion_r499817599", "createdAt": "2020-10-05T19:19:01Z", "author": {"login": "wendigo"}, "path": "presto-product-tests-launcher/src/main/java/io/prestosql/tests/product/launcher/cli/EnvironmentUp.java", "diffHunk": "@@ -144,7 +144,7 @@ public Integer call()\n                 builder.configureContainers(Standard::enablePrestoJavaDebugger);\n             }\n \n-            Environment environment = builder.build(getStandardListeners(environmentLogPath));\n+            Environment environment = builder.build(getStandardListeners(environmentLogPath), false);", "state": "SUBMITTED", "replyTo": null, "originalCommit": null, "originalPosition": 5}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4591, "cost": 1, "resetAt": "2021-11-13T12:26:42Z"}}}