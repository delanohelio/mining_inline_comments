{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTI0NTcwMzcy", "number": 6027, "title": "Use eventual assertion with query stats", "bodyText": "Use eventual assertion with query stats\nIt is possible that retrieved query stats might not collect all\ninformation, so running eventual assertion to make tests more reliable.", "createdAt": "2020-11-20T09:26:13Z", "url": "https://github.com/trinodb/trino/pull/6027", "merged": true, "mergeCommit": {"oid": "c07f87a69edea8288f1e8e1f8b5fc8c1fd71bbda"}, "closed": true, "closedAt": "2021-01-15T13:08:17Z", "author": {"login": "kokosing"}, "timelineItems": {"totalCount": 8, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdeT_g4AFqTUzNTI2MzkwOA==", "endCursor": "Y3Vyc29yOnYyOpPPAAABdwYn7YABqjQyMTEwNzkzMzE=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTM1MjYzOTA4", "url": "https://github.com/trinodb/trino/pull/6027#pullrequestreview-535263908", "createdAt": "2020-11-20T09:32:32Z", "commit": null, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0yMFQwOTozMjozMlrOH3H7QA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0yMFQwOTozMjozMlrOH3H7QA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNzU2MzU4NA==", "bodyText": "This doesn't work. Final stats are set once. If they are wrong, they will stay wrong.", "url": "https://github.com/trinodb/trino/pull/6027#discussion_r527563584", "createdAt": "2020-11-20T09:32:32Z", "author": {"login": "sopel39"}, "path": "presto-kafka/src/test/java/io/prestosql/plugin/kafka/TestKafkaIntegrationPushDown.java", "diffHunk": "@@ -105,38 +106,36 @@ public void stopKafka()\n     }\n \n     @Test\n-    public void testPartitionPushDown() throws ExecutionException, InterruptedException\n+    public void testPartitionPushDown()\n+            throws ExecutionException, InterruptedException\n     {\n         createMessages(topicNamePartition);\n         String sql = format(\"SELECT count(*) FROM default.%s WHERE _partition_id=1\", topicNamePartition);\n \n         ResultWithQueryId<MaterializedResult> queryResult = getDistributedQueryRunner().executeWithQueryId(getSession(), sql);\n-        assertEquals(getQueryInfo(getDistributedQueryRunner(), queryResult).getQueryStats().getProcessedInputPositions(), MESSAGE_NUM / 2);\n+        assertEventually(() -> assertEquals(getQueryInfo(getDistributedQueryRunner(), queryResult).getQueryStats().getProcessedInputPositions(), MESSAGE_NUM / 2));", "state": "SUBMITTED", "replyTo": null, "originalCommit": null, "originalPosition": 21}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": null, "afterCommit": null}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": null, "afterCommit": null}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTYxNjQ0NzQw", "url": "https://github.com/trinodb/trino/pull/6027#pullrequestreview-561644740", "createdAt": "2021-01-05T09:43:39Z", "commit": null, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": null, "afterCommit": null}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTYxNzg0MjM3", "url": "https://github.com/trinodb/trino/pull/6027#pullrequestreview-561784237", "createdAt": "2021-01-05T13:25:45Z", "commit": null, "state": "APPROVED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMS0wNVQxMzoyNTo0NVrOIOXGqw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMS0wNVQxMzoyNTo0NVrOIOXGqw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1MTkyOTUxNQ==", "bodyText": "static import", "url": "https://github.com/trinodb/trino/pull/6027#discussion_r551929515", "createdAt": "2021-01-05T13:25:45Z", "author": {"login": "skrzypo987"}, "path": "core/trino-main/src/main/java/io/trino/testing/assertions/Assert.java", "diffHunk": "@@ -50,6 +52,11 @@ public static void assertEquals(Iterable<?> actual, Iterable<?> expected, String\n         }\n     }\n \n+    public static void assertEventually(Runnable assertion)\n+    {\n+        assertEventually(new Duration(30, TimeUnit.SECONDS), assertion);", "state": "SUBMITTED", "replyTo": null, "originalCommit": null, "originalPosition": 15}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "5153cf9064ef7534d77757481fb057028a7a05b6", "author": {"user": {"login": "kokosing", "name": "Grzegorz Kokosi\u0144ski"}}, "url": "https://github.com/trinodb/trino/commit/5153cf9064ef7534d77757481fb057028a7a05b6", "committedDate": "2021-01-15T13:06:22Z", "message": "Use eventual assertion with query stats\n\nIt is possible that retrieved query stats might not collect all\ninformation, so running eventual assertion to make tests more reliable."}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": null, "afterCommit": {"oid": "5153cf9064ef7534d77757481fb057028a7a05b6", "author": {"user": {"login": "kokosing", "name": "Grzegorz Kokosi\u0144ski"}}, "url": "https://github.com/trinodb/trino/commit/5153cf9064ef7534d77757481fb057028a7a05b6", "committedDate": "2021-01-15T13:06:22Z", "message": "Use eventual assertion with query stats\n\nIt is possible that retrieved query stats might not collect all\ninformation, so running eventual assertion to make tests more reliable."}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2674, "cost": 1, "resetAt": "2021-10-28T20:13:43Z"}}}