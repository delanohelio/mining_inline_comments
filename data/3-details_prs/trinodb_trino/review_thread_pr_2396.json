{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0MzU4ODE2MjI4", "number": 2396, "reviewThreads": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0wM1QwODo1Mzo1M1rODVnOoQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0wM1QwODo1OToxN1rODVnRrA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjIzOTg5NDA5OnYy", "diffSide": "LEFT", "path": "presto-product-tests/src/main/java/io/prestosql/tests/hive/BaseHivePartitioningTest.java", "isResolved": false, "comments": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0wM1QwODo1Mzo1M1rOFZ7vkg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0wM1QxMDoxMzozN1rOFZ9EVA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2MjczNzU1NA==", "bodyText": "I guess it does not solve the problem completely. I would suspect that every test that is using QueryStatsClient is vulnerable of being flaky.", "url": "https://github.com/trinodb/trino/pull/2396#discussion_r362737554", "createdAt": "2020-01-03T08:53:53Z", "author": {"login": "kokosing"}, "path": "presto-product-tests/src/main/java/io/prestosql/tests/hive/BaseHivePartitioningTest.java", "diffHunk": "@@ -1,55 +0,0 @@\n-/*\n- * Licensed under the Apache License, Version 2.0 (the \"License\");\n- * you may not use this file except in compliance with the License.\n- * You may obtain a copy of the License at\n- *\n- *     http://www.apache.org/licenses/LICENSE-2.0\n- *\n- * Unless required by applicable law or agreed to in writing, software\n- * distributed under the License is distributed on an \"AS IS\" BASIS,\n- * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n- * See the License for the specific language governing permissions and\n- * limitations under the License.\n- */\n-package io.prestosql.tests.hive;\n-\n-import io.prestosql.jdbc.PrestoResultSet;\n-import io.prestosql.tempto.BeforeTestWithContext;\n-import io.prestosql.tempto.ProductTest;\n-import io.prestosql.tempto.query.QueryResult;\n-import io.prestosql.tests.querystats.QueryStatsClient;\n-\n-import javax.inject.Inject;\n-\n-import java.sql.SQLException;\n-\n-import static io.prestosql.tempto.query.QueryExecutor.query;\n-import static java.lang.String.format;\n-\n-public abstract class BaseHivePartitioningTest\n-        extends ProductTest\n-{\n-    private QueryStatsClient queryStatsClient;\n-\n-    @Inject\n-    @BeforeTestWithContext\n-    public void setUp(QueryStatsClient queryStatsClient)\n-    {\n-        this.queryStatsClient = queryStatsClient;", "state": "SUBMITTED", "replyTo": null, "originalCommit": null, "originalPosition": 38}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2MjczODUwMA==", "bodyText": "Luckily this is the only test that it was using this, so please remove QueryStatsClient and friends as well.", "url": "https://github.com/trinodb/trino/pull/2396#discussion_r362738500", "createdAt": "2020-01-03T08:58:10Z", "author": {"login": "kokosing"}, "path": "presto-product-tests/src/main/java/io/prestosql/tests/hive/BaseHivePartitioningTest.java", "diffHunk": "@@ -1,55 +0,0 @@\n-/*\n- * Licensed under the Apache License, Version 2.0 (the \"License\");\n- * you may not use this file except in compliance with the License.\n- * You may obtain a copy of the License at\n- *\n- *     http://www.apache.org/licenses/LICENSE-2.0\n- *\n- * Unless required by applicable law or agreed to in writing, software\n- * distributed under the License is distributed on an \"AS IS\" BASIS,\n- * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n- * See the License for the specific language governing permissions and\n- * limitations under the License.\n- */\n-package io.prestosql.tests.hive;\n-\n-import io.prestosql.jdbc.PrestoResultSet;\n-import io.prestosql.tempto.BeforeTestWithContext;\n-import io.prestosql.tempto.ProductTest;\n-import io.prestosql.tempto.query.QueryResult;\n-import io.prestosql.tests.querystats.QueryStatsClient;\n-\n-import javax.inject.Inject;\n-\n-import java.sql.SQLException;\n-\n-import static io.prestosql.tempto.query.QueryExecutor.query;\n-import static java.lang.String.format;\n-\n-public abstract class BaseHivePartitioningTest\n-        extends ProductTest\n-{\n-    private QueryStatsClient queryStatsClient;\n-\n-    @Inject\n-    @BeforeTestWithContext\n-    public void setUp(QueryStatsClient queryStatsClient)\n-    {\n-        this.queryStatsClient = queryStatsClient;", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2MjczNzU1NA=="}, "originalCommit": null, "originalPosition": 38}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2Mjc0NzQ2Ng==", "bodyText": "I'm hesitant. It's not QueryStatsClient's fault and i think QueryStatsClient might be valuable.\nI want to leave #2382 open.\nI will still remove this class as we should test #2382 with engine \"unit\" tests, not product tests though.", "url": "https://github.com/trinodb/trino/pull/2396#discussion_r362747466", "createdAt": "2020-01-03T09:31:45Z", "author": {"login": "findepi"}, "path": "presto-product-tests/src/main/java/io/prestosql/tests/hive/BaseHivePartitioningTest.java", "diffHunk": "@@ -1,55 +0,0 @@\n-/*\n- * Licensed under the Apache License, Version 2.0 (the \"License\");\n- * you may not use this file except in compliance with the License.\n- * You may obtain a copy of the License at\n- *\n- *     http://www.apache.org/licenses/LICENSE-2.0\n- *\n- * Unless required by applicable law or agreed to in writing, software\n- * distributed under the License is distributed on an \"AS IS\" BASIS,\n- * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n- * See the License for the specific language governing permissions and\n- * limitations under the License.\n- */\n-package io.prestosql.tests.hive;\n-\n-import io.prestosql.jdbc.PrestoResultSet;\n-import io.prestosql.tempto.BeforeTestWithContext;\n-import io.prestosql.tempto.ProductTest;\n-import io.prestosql.tempto.query.QueryResult;\n-import io.prestosql.tests.querystats.QueryStatsClient;\n-\n-import javax.inject.Inject;\n-\n-import java.sql.SQLException;\n-\n-import static io.prestosql.tempto.query.QueryExecutor.query;\n-import static java.lang.String.format;\n-\n-public abstract class BaseHivePartitioningTest\n-        extends ProductTest\n-{\n-    private QueryStatsClient queryStatsClient;\n-\n-    @Inject\n-    @BeforeTestWithContext\n-    public void setUp(QueryStatsClient queryStatsClient)\n-    {\n-        this.queryStatsClient = queryStatsClient;", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2MjczNzU1NA=="}, "originalCommit": null, "originalPosition": 38}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2Mjc1OTI1Mg==", "bodyText": "QueryStatsClient might be valuable.\n\nCorrect, but if it is not used then then it a risk that it become broken at some point.", "url": "https://github.com/trinodb/trino/pull/2396#discussion_r362759252", "createdAt": "2020-01-03T10:13:37Z", "author": {"login": "kokosing"}, "path": "presto-product-tests/src/main/java/io/prestosql/tests/hive/BaseHivePartitioningTest.java", "diffHunk": "@@ -1,55 +0,0 @@\n-/*\n- * Licensed under the Apache License, Version 2.0 (the \"License\");\n- * you may not use this file except in compliance with the License.\n- * You may obtain a copy of the License at\n- *\n- *     http://www.apache.org/licenses/LICENSE-2.0\n- *\n- * Unless required by applicable law or agreed to in writing, software\n- * distributed under the License is distributed on an \"AS IS\" BASIS,\n- * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n- * See the License for the specific language governing permissions and\n- * limitations under the License.\n- */\n-package io.prestosql.tests.hive;\n-\n-import io.prestosql.jdbc.PrestoResultSet;\n-import io.prestosql.tempto.BeforeTestWithContext;\n-import io.prestosql.tempto.ProductTest;\n-import io.prestosql.tempto.query.QueryResult;\n-import io.prestosql.tests.querystats.QueryStatsClient;\n-\n-import javax.inject.Inject;\n-\n-import java.sql.SQLException;\n-\n-import static io.prestosql.tempto.query.QueryExecutor.query;\n-import static java.lang.String.format;\n-\n-public abstract class BaseHivePartitioningTest\n-        extends ProductTest\n-{\n-    private QueryStatsClient queryStatsClient;\n-\n-    @Inject\n-    @BeforeTestWithContext\n-    public void setUp(QueryStatsClient queryStatsClient)\n-    {\n-        this.queryStatsClient = queryStatsClient;", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2MjczNzU1NA=="}, "originalCommit": null, "originalPosition": 38}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjIzOTkwMTg4OnYy", "diffSide": "LEFT", "path": "presto-product-tests/src/main/java/io/prestosql/tests/hive/TestTablePartitioningInsertInto.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0wM1QwODo1OToxN1rOFZ70RQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0wM1QwOTozNDo0NVrOFZ8ZsQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2MjczODc1Nw==", "bodyText": "Do we have a test coverage partitioning is working effectively (end-to-end) somewhere else? Even though test was... it provided some value that I would like no to lose.", "url": "https://github.com/trinodb/trino/pull/2396#discussion_r362738757", "createdAt": "2020-01-03T08:59:17Z", "author": {"login": "kokosing"}, "path": "presto-product-tests/src/main/java/io/prestosql/tests/hive/TestTablePartitioningInsertInto.java", "diffHunk": "@@ -1,86 +0,0 @@\n-/*\n- * Licensed under the Apache License, Version 2.0 (the \"License\");\n- * you may not use this file except in compliance with the License.\n- * You may obtain a copy of the License at\n- *\n- *     http://www.apache.org/licenses/LICENSE-2.0\n- *\n- * Unless required by applicable law or agreed to in writing, software\n- * distributed under the License is distributed on an \"AS IS\" BASIS,\n- * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n- * See the License for the specific language governing permissions and\n- * limitations under the License.\n- */\n-package io.prestosql.tests.hive;\n-\n-import io.prestosql.tempto.Requirement;\n-import io.prestosql.tempto.RequirementsProvider;\n-import io.prestosql.tempto.configuration.Configuration;\n-import io.prestosql.tempto.query.QueryResult;\n-import org.testng.annotations.Test;\n-\n-import static io.prestosql.tempto.Requirements.compose;\n-import static io.prestosql.tempto.fulfillment.table.MutableTableRequirement.State.CREATED;\n-import static io.prestosql.tempto.fulfillment.table.MutableTablesState.mutableTablesState;\n-import static io.prestosql.tempto.fulfillment.table.TableRequirements.mutableTable;\n-import static io.prestosql.tempto.fulfillment.table.hive.tpch.TpchTableDefinitions.NATION;\n-import static io.prestosql.tempto.query.QueryExecutor.query;\n-import static io.prestosql.tests.TestGroups.SMOKE;\n-import static io.prestosql.tests.hive.HiveTableDefinitions.NATION_PARTITIONED_BY_BIGINT_REGIONKEY;\n-import static io.prestosql.tests.hive.HiveTableDefinitions.NATION_PARTITIONED_BY_REGIONKEY_NUMBER_OF_LINES_PER_SPLIT;\n-import static java.lang.String.format;\n-import static org.assertj.core.api.Assertions.assertThat;\n-\n-public class TestTablePartitioningInsertInto\n-        extends BaseHivePartitioningTest\n-        implements RequirementsProvider\n-{\n-    private static final String TARGET_NATION_NAME = \"target_nation_test\";\n-\n-    @Override\n-    public Requirement getRequirements(Configuration configuration)\n-    {\n-        return compose(\n-                mutableTable(NATION_PARTITIONED_BY_BIGINT_REGIONKEY),\n-                mutableTable(NATION, TARGET_NATION_NAME, CREATED));\n-    }\n-\n-    @Test(groups = SMOKE)\n-    public void selectFromPartitionedNation()\n-            throws Exception\n-    {\n-        // read all data\n-        testQuerySplitsNumber(\"p_nationkey < 40\", 3);\n-\n-        // read no partitions\n-        testQuerySplitsNumber(\"p_regionkey = 42\", 0);\n-\n-        // read one partition\n-        testQuerySplitsNumber(\"p_regionkey = 2 AND p_nationkey < 40\", 1);\n-        // read two partitions\n-        testQuerySplitsNumber(\"p_regionkey = 2 AND p_nationkey < 40 or p_regionkey = 3\", 2);", "state": "SUBMITTED", "replyTo": null, "originalCommit": null, "originalPosition": 61}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2Mjc0ODMzNw==", "bodyText": "Yes, we have io.prestosql.plugin.hive.TestHiveIntegrationSmokeTest#testPartitionPerScanLimit()", "url": "https://github.com/trinodb/trino/pull/2396#discussion_r362748337", "createdAt": "2020-01-03T09:34:45Z", "author": {"login": "findepi"}, "path": "presto-product-tests/src/main/java/io/prestosql/tests/hive/TestTablePartitioningInsertInto.java", "diffHunk": "@@ -1,86 +0,0 @@\n-/*\n- * Licensed under the Apache License, Version 2.0 (the \"License\");\n- * you may not use this file except in compliance with the License.\n- * You may obtain a copy of the License at\n- *\n- *     http://www.apache.org/licenses/LICENSE-2.0\n- *\n- * Unless required by applicable law or agreed to in writing, software\n- * distributed under the License is distributed on an \"AS IS\" BASIS,\n- * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n- * See the License for the specific language governing permissions and\n- * limitations under the License.\n- */\n-package io.prestosql.tests.hive;\n-\n-import io.prestosql.tempto.Requirement;\n-import io.prestosql.tempto.RequirementsProvider;\n-import io.prestosql.tempto.configuration.Configuration;\n-import io.prestosql.tempto.query.QueryResult;\n-import org.testng.annotations.Test;\n-\n-import static io.prestosql.tempto.Requirements.compose;\n-import static io.prestosql.tempto.fulfillment.table.MutableTableRequirement.State.CREATED;\n-import static io.prestosql.tempto.fulfillment.table.MutableTablesState.mutableTablesState;\n-import static io.prestosql.tempto.fulfillment.table.TableRequirements.mutableTable;\n-import static io.prestosql.tempto.fulfillment.table.hive.tpch.TpchTableDefinitions.NATION;\n-import static io.prestosql.tempto.query.QueryExecutor.query;\n-import static io.prestosql.tests.TestGroups.SMOKE;\n-import static io.prestosql.tests.hive.HiveTableDefinitions.NATION_PARTITIONED_BY_BIGINT_REGIONKEY;\n-import static io.prestosql.tests.hive.HiveTableDefinitions.NATION_PARTITIONED_BY_REGIONKEY_NUMBER_OF_LINES_PER_SPLIT;\n-import static java.lang.String.format;\n-import static org.assertj.core.api.Assertions.assertThat;\n-\n-public class TestTablePartitioningInsertInto\n-        extends BaseHivePartitioningTest\n-        implements RequirementsProvider\n-{\n-    private static final String TARGET_NATION_NAME = \"target_nation_test\";\n-\n-    @Override\n-    public Requirement getRequirements(Configuration configuration)\n-    {\n-        return compose(\n-                mutableTable(NATION_PARTITIONED_BY_BIGINT_REGIONKEY),\n-                mutableTable(NATION, TARGET_NATION_NAME, CREATED));\n-    }\n-\n-    @Test(groups = SMOKE)\n-    public void selectFromPartitionedNation()\n-            throws Exception\n-    {\n-        // read all data\n-        testQuerySplitsNumber(\"p_nationkey < 40\", 3);\n-\n-        // read no partitions\n-        testQuerySplitsNumber(\"p_regionkey = 42\", 0);\n-\n-        // read one partition\n-        testQuerySplitsNumber(\"p_regionkey = 2 AND p_nationkey < 40\", 1);\n-        // read two partitions\n-        testQuerySplitsNumber(\"p_regionkey = 2 AND p_nationkey < 40 or p_regionkey = 3\", 2);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2MjczODc1Nw=="}, "originalCommit": null, "originalPosition": 61}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1085, "cost": 1, "resetAt": "2021-11-13T14:23:39Z"}}}