{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0Mzk1Njc1NjA2", "number": 3284, "title": "Base JDBC code cleanup", "bodyText": "", "createdAt": "2020-03-30T14:07:13Z", "url": "https://github.com/trinodb/trino/pull/3284", "merged": true, "mergeCommit": {"oid": "ebb87a2b622c1cf47f568aed2d161a1cabd1838e"}, "closed": true, "closedAt": "2020-03-31T12:38:47Z", "author": {"login": "findepi"}, "timelineItems": {"totalCount": 11, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcSvYHiABqjMxNzg5MTM4NDc=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcS2usuABqjMxODA4MjMxMzA=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "HeadRefForcePushedEvent", "beforeCommit": null, "afterCommit": null}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": null, "afterCommit": null}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzg0MTExNzA4", "url": "https://github.com/trinodb/trino/pull/3284#pullrequestreview-384111708", "createdAt": "2020-03-30T18:16:10Z", "commit": null, "state": "APPROVED", "comments": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0zMFQxODoxNjoxMFrOF92Sqw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0zMFQxODozMTozMFrOF923Hg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMDM5Njk3MQ==", "bodyText": "Where execute is defined?", "url": "https://github.com/trinodb/trino/pull/3284#discussion_r400396971", "createdAt": "2020-03-30T18:16:10Z", "author": {"login": "kokosing"}, "path": "presto-base-jdbc/src/main/java/io/prestosql/plugin/jdbc/BaseJdbcClient.java", "diffHunk": "@@ -622,29 +621,18 @@ public void renameColumn(JdbcIdentity identity, JdbcTableHandle handle, JdbcColu\n     @Override\n     public void dropColumn(JdbcIdentity identity, JdbcTableHandle handle, JdbcColumnHandle column)\n     {\n-        try (Connection connection = connectionFactory.openConnection(identity)) {\n-            String sql = format(\n-                    \"ALTER TABLE %s DROP COLUMN %s\",\n-                    quoted(handle.getCatalogName(), handle.getSchemaName(), handle.getTableName()),\n-                    column.getColumnName());\n-            execute(connection, sql);\n-        }\n-        catch (SQLException e) {\n-            throw new PrestoException(JDBC_ERROR, e);\n-        }\n+        String sql = format(\n+                \"ALTER TABLE %s DROP COLUMN %s\",\n+                quoted(handle.getCatalogName(), handle.getSchemaName(), handle.getTableName()),\n+                column.getColumnName());\n+        execute(identity, sql);", "state": "SUBMITTED", "replyTo": null, "originalCommit": null, "originalPosition": 26}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMDM5NzY0Nw==", "bodyText": "Maybe add logging to execute method so it could log all queries.", "url": "https://github.com/trinodb/trino/pull/3284#discussion_r400397647", "createdAt": "2020-03-30T18:17:18Z", "author": {"login": "kokosing"}, "path": "presto-base-jdbc/src/main/java/io/prestosql/plugin/jdbc/BaseJdbcClient.java", "diffHunk": "@@ -622,29 +621,18 @@ public void renameColumn(JdbcIdentity identity, JdbcTableHandle handle, JdbcColu\n     @Override\n     public void dropColumn(JdbcIdentity identity, JdbcTableHandle handle, JdbcColumnHandle column)\n     {\n-        try (Connection connection = connectionFactory.openConnection(identity)) {\n-            String sql = format(\n-                    \"ALTER TABLE %s DROP COLUMN %s\",\n-                    quoted(handle.getCatalogName(), handle.getSchemaName(), handle.getTableName()),\n-                    column.getColumnName());\n-            execute(connection, sql);\n-        }\n-        catch (SQLException e) {\n-            throw new PrestoException(JDBC_ERROR, e);\n-        }\n+        String sql = format(", "state": "SUBMITTED", "replyTo": null, "originalCommit": null, "originalPosition": 22}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMDQwNTk3MA==", "bodyText": "Undo?", "url": "https://github.com/trinodb/trino/pull/3284#discussion_r400405970", "createdAt": "2020-03-30T18:30:57Z", "author": {"login": "kokosing"}, "path": "presto-redshift/src/main/java/io/prestosql/plugin/redshift/RedshiftClient.java", "diffHunk": "@@ -44,7 +44,7 @@ public RedshiftClient(BaseJdbcConfig config, ConnectionFactory connectionFactory\n     protected void renameTable(JdbcIdentity identity, String catalogName, String schemaName, String tableName, SchemaTableName newTable)\n     {\n         if (!schemaName.equals(newTable.getSchemaName())) {\n-            throw new PrestoException(NOT_SUPPORTED, \"Table rename across schemas is not supported in Redshift\");", "state": "SUBMITTED", "replyTo": null, "originalCommit": null, "originalPosition": 4}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMDQwNjMwMg==", "bodyText": "Separate commit, test?", "url": "https://github.com/trinodb/trino/pull/3284#discussion_r400406302", "createdAt": "2020-03-30T18:31:30Z", "author": {"login": "kokosing"}, "path": "presto-sqlserver/src/main/java/io/prestosql/plugin/sqlserver/SqlServerClient.java", "diffHunk": "@@ -72,6 +74,10 @@ public SqlServerClient(BaseJdbcConfig config, ConnectionFactory connectionFactor\n     @Override\n     protected void renameTable(JdbcIdentity identity, String catalogName, String schemaName, String tableName, SchemaTableName newTable)\n     {\n+        if (!schemaName.equals(newTable.getSchemaName())) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": null, "originalPosition": 20}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": null, "afterCommit": null}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": null, "afterCommit": null}, {"__typename": "PullRequestCommit", "commit": {"oid": "73c1a98cd8ffa5807bdfbf3db8c8b7c94fb20821", "author": {"user": {"login": "findepi", "name": "Piotr Findeisen"}}, "url": "https://github.com/trinodb/trino/commit/73c1a98cd8ffa5807bdfbf3db8c8b7c94fb20821", "committedDate": "2020-03-30T23:02:09Z", "message": "Report actual query when DDL fails"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "21f47345fb8399429b2936f040bd96b2f8643c5f", "author": {"user": {"login": "findepi", "name": "Piotr Findeisen"}}, "url": "https://github.com/trinodb/trino/commit/21f47345fb8399429b2936f040bd96b2f8643c5f", "committedDate": "2020-03-30T23:02:10Z", "message": "Extract short-hand execute() method"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "9aa102abb149833430e1ca5844db9f4fa79477a1", "author": {"user": {"login": "findepi", "name": "Piotr Findeisen"}}, "url": "https://github.com/trinodb/trino/commit/9aa102abb149833430e1ca5844db9f4fa79477a1", "committedDate": "2020-03-30T23:02:11Z", "message": "Reject impossible rename"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "097c2d396bd499546fbb242d5c2c0db45bc62e84", "author": {"user": {"login": "findepi", "name": "Piotr Findeisen"}}, "url": "https://github.com/trinodb/trino/commit/097c2d396bd499546fbb242d5c2c0db45bc62e84", "committedDate": "2020-03-30T23:02:12Z", "message": "Extract charReadFunction"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "5138b2d2784c85c69ccb1f0c2806d303206b0869", "author": {"user": {"login": "findepi", "name": "Piotr Findeisen"}}, "url": "https://github.com/trinodb/trino/commit/5138b2d2784c85c69ccb1f0c2806d303206b0869", "committedDate": "2020-03-30T23:02:13Z", "message": "Simplify test"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": null, "afterCommit": {"oid": "5138b2d2784c85c69ccb1f0c2806d303206b0869", "author": {"user": {"login": "findepi", "name": "Piotr Findeisen"}}, "url": "https://github.com/trinodb/trino/commit/5138b2d2784c85c69ccb1f0c2806d303206b0869", "committedDate": "2020-03-30T23:02:13Z", "message": "Simplify test"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2095, "cost": 1, "resetAt": "2021-10-28T19:08:13Z"}}}