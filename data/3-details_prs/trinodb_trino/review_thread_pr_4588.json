{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDU2Nzk5OTYy", "number": 4588, "reviewThreads": {"totalCount": 9, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yN1QwNzoyMDowNFrOESQ8vQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0yNVQxODoyOTozMFrOE9WTMQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjg3NTg3NTE3OnYy", "diffSide": "RIGHT", "path": "presto-client/src/main/java/io/prestosql/client/RowField.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yN1QwNzoyMDowNFrOG3WbEA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yN1QwNzoyMDowNFrOG3WbEA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MDY5MjI0MA==", "bodyText": "copyright", "url": "https://github.com/trinodb/trino/pull/4588#discussion_r460692240", "createdAt": "2020-07-27T07:20:04Z", "author": {"login": "kokosing"}, "path": "presto-client/src/main/java/io/prestosql/client/RowField.java", "diffHunk": "@@ -0,0 +1,59 @@\n+package io.prestosql.client;", "state": "SUBMITTED", "replyTo": null, "originalCommit": null, "originalPosition": 1}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjg3NTg3Njc5OnYy", "diffSide": "RIGHT", "path": "presto-cli/src/main/java/io/prestosql/cli/AlignedTablePrinter.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yN1QwNzoyMDo0MFrOG3WcDQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0yOVQxOTowNTo1OFrOH7mE5w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MDY5MjQ5Mw==", "bodyText": "do you need to add product tests for cli for that?", "url": "https://github.com/trinodb/trino/pull/4588#discussion_r460692493", "createdAt": "2020-07-27T07:20:40Z", "author": {"login": "kokosing"}, "path": "presto-cli/src/main/java/io/prestosql/cli/AlignedTablePrinter.java", "diffHunk": "@@ -18,6 +18,7 @@\n import com.google.common.collect.ImmutableList;", "state": "SUBMITTED", "replyTo": null, "originalCommit": null, "originalPosition": 1}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMjI1MTg3OQ==", "bodyText": "do you need to add product tests for cli for that?\n\ni do not feel this is necessary, why?", "url": "https://github.com/trinodb/trino/pull/4588#discussion_r532251879", "createdAt": "2020-11-29T19:05:58Z", "author": {"login": "findepi"}, "path": "presto-cli/src/main/java/io/prestosql/cli/AlignedTablePrinter.java", "diffHunk": "@@ -18,6 +18,7 @@\n import com.google.common.collect.ImmutableList;", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MDY5MjQ5Mw=="}, "originalCommit": null, "originalPosition": 1}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjk1MDk0NDYzOnYy", "diffSide": "RIGHT", "path": "presto-client/src/main/java/io/prestosql/client/RowField.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xOFQxMTowNjoyNVrOHCOefg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xOFQxMTowNjoyNVrOHCOefg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MjA5NjM4Mg==", "bodyText": "nit: @Nullable?", "url": "https://github.com/trinodb/trino/pull/4588#discussion_r472096382", "createdAt": "2020-08-18T11:06:25Z", "author": {"login": "losipiuk"}, "path": "presto-client/src/main/java/io/prestosql/client/RowField.java", "diffHunk": "@@ -0,0 +1,72 @@\n+/*\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+package io.prestosql.client;\n+\n+import javax.annotation.Nullable;\n+\n+import java.util.Objects;\n+import java.util.Optional;\n+\n+import static java.util.Objects.requireNonNull;\n+\n+public class RowField\n+{\n+    private final int ordinal;\n+    private final Optional<String> name;\n+    private final Object value;", "state": "SUBMITTED", "replyTo": null, "originalCommit": null, "originalPosition": 27}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjk1MDk1NjU5OnYy", "diffSide": "RIGHT", "path": "presto-jdbc/src/test/java/io/prestosql/jdbc/TestJdbcResultSet.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xOFQxMToxMDoxN1rOHCOl4w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yM1QyMjoyNzo0NlrOHFQecw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MjA5ODI3NQ==", "bodyText": "Do we need that?", "url": "https://github.com/trinodb/trino/pull/4588#discussion_r472098275", "createdAt": "2020-08-18T11:10:17Z", "author": {"login": "losipiuk"}, "path": "presto-jdbc/src/test/java/io/prestosql/jdbc/TestJdbcResultSet.java", "diffHunk": "@@ -315,27 +316,38 @@ public void testRow()\n     {\n         // named row\n         checkRepresentation(\"CAST(ROW(42, 'Presto') AS ROW(a_bigint bigint, a_varchar varchar(17)))\", Types.JAVA_OBJECT, (rs, column) -> {\n-            assertEquals(rs.getObject(column), ImmutableMap.of(\"a_bigint\", 42L, \"a_varchar\", \"Presto\"));\n-            assertEquals(rs.getObject(column, Map.class), ImmutableMap.of(\"a_bigint\", 42L, \"a_varchar\", \"Presto\"));\n+            assertEquals(rs.getObject(column), Row.builder()\n+                    .addField(\"a_bigint\", 42L)\n+                    .addField(\"a_varchar\", \"Presto\")\n+                    .build());\n+            // TODO assertEquals(rs.getObject(column, Map.class), ImmutableMap.of(\"a_bigint\", 42L, \"a_varchar\", \"Presto\"));", "state": "SUBMITTED", "replyTo": null, "originalCommit": null, "originalPosition": 18}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NTI3NDg2Nw==", "bodyText": "May be convenient.", "url": "https://github.com/trinodb/trino/pull/4588#discussion_r475274867", "createdAt": "2020-08-23T22:27:46Z", "author": {"login": "findepi"}, "path": "presto-jdbc/src/test/java/io/prestosql/jdbc/TestJdbcResultSet.java", "diffHunk": "@@ -315,27 +316,38 @@ public void testRow()\n     {\n         // named row\n         checkRepresentation(\"CAST(ROW(42, 'Presto') AS ROW(a_bigint bigint, a_varchar varchar(17)))\", Types.JAVA_OBJECT, (rs, column) -> {\n-            assertEquals(rs.getObject(column), ImmutableMap.of(\"a_bigint\", 42L, \"a_varchar\", \"Presto\"));\n-            assertEquals(rs.getObject(column, Map.class), ImmutableMap.of(\"a_bigint\", 42L, \"a_varchar\", \"Presto\"));\n+            assertEquals(rs.getObject(column), Row.builder()\n+                    .addField(\"a_bigint\", 42L)\n+                    .addField(\"a_varchar\", \"Presto\")\n+                    .build());\n+            // TODO assertEquals(rs.getObject(column, Map.class), ImmutableMap.of(\"a_bigint\", 42L, \"a_varchar\", \"Presto\"));", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MjA5ODI3NQ=="}, "originalCommit": null, "originalPosition": 18}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzMyNzU4Mzc1OnYy", "diffSide": "RIGHT", "path": "presto-client/src/main/java/io/prestosql/client/Row.java", "isResolved": true, "comments": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0yNVQxODoxMTo0NFrOH5--ng==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0yNlQxMjowMzo1N1rOH6YnEQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMDU2MjcxOA==", "bodyText": "rnn not needed (done by copyOf)", "url": "https://github.com/trinodb/trino/pull/4588#discussion_r530562718", "createdAt": "2020-11-25T18:11:44Z", "author": {"login": "losipiuk"}, "path": "presto-client/src/main/java/io/prestosql/client/Row.java", "diffHunk": "@@ -0,0 +1,108 @@\n+/*\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+package io.prestosql.client;\n+\n+import com.google.common.collect.ImmutableList;\n+\n+import javax.annotation.Nullable;\n+\n+import java.util.ArrayList;\n+import java.util.List;\n+import java.util.Objects;\n+import java.util.Optional;\n+\n+import static java.lang.String.format;\n+import static java.util.Objects.requireNonNull;\n+import static java.util.stream.Collectors.joining;\n+\n+public final class Row\n+{\n+    private final List<RowField> fields;\n+\n+    private Row(List<RowField> fields)\n+    {\n+        this.fields = ImmutableList.copyOf(requireNonNull(fields, \"fields is null\"));", "state": "SUBMITTED", "replyTo": null, "originalCommit": null, "originalPosition": 35}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMDY0MTE2OQ==", "bodyText": "i have a nicer message, as i say what param is null (here there is only one, but you i do not want to change this line, if i add annother one)", "url": "https://github.com/trinodb/trino/pull/4588#discussion_r530641169", "createdAt": "2020-11-25T21:02:56Z", "author": {"login": "findepi"}, "path": "presto-client/src/main/java/io/prestosql/client/Row.java", "diffHunk": "@@ -0,0 +1,108 @@\n+/*\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+package io.prestosql.client;\n+\n+import com.google.common.collect.ImmutableList;\n+\n+import javax.annotation.Nullable;\n+\n+import java.util.ArrayList;\n+import java.util.List;\n+import java.util.Objects;\n+import java.util.Optional;\n+\n+import static java.lang.String.format;\n+import static java.util.Objects.requireNonNull;\n+import static java.util.stream.Collectors.joining;\n+\n+public final class Row\n+{\n+    private final List<RowField> fields;\n+\n+    private Row(List<RowField> fields)\n+    {\n+        this.fields = ImmutableList.copyOf(requireNonNull(fields, \"fields is null\"));", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMDU2MjcxOA=="}, "originalCommit": null, "originalPosition": 35}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMDkzMDc0OQ==", "bodyText": "True. I put a comment here mostly because we typically not do rnn if there is copyOf already.", "url": "https://github.com/trinodb/trino/pull/4588#discussion_r530930749", "createdAt": "2020-11-26T10:34:31Z", "author": {"login": "losipiuk"}, "path": "presto-client/src/main/java/io/prestosql/client/Row.java", "diffHunk": "@@ -0,0 +1,108 @@\n+/*\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+package io.prestosql.client;\n+\n+import com.google.common.collect.ImmutableList;\n+\n+import javax.annotation.Nullable;\n+\n+import java.util.ArrayList;\n+import java.util.List;\n+import java.util.Objects;\n+import java.util.Optional;\n+\n+import static java.lang.String.format;\n+import static java.util.Objects.requireNonNull;\n+import static java.util.stream.Collectors.joining;\n+\n+public final class Row\n+{\n+    private final List<RowField> fields;\n+\n+    private Row(List<RowField> fields)\n+    {\n+        this.fields = ImmutableList.copyOf(requireNonNull(fields, \"fields is null\"));", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMDU2MjcxOA=="}, "originalCommit": null, "originalPosition": 35}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMDk4MjY3Mw==", "bodyText": "I think this depends on \"we\" :)", "url": "https://github.com/trinodb/trino/pull/4588#discussion_r530982673", "createdAt": "2020-11-26T12:03:57Z", "author": {"login": "findepi"}, "path": "presto-client/src/main/java/io/prestosql/client/Row.java", "diffHunk": "@@ -0,0 +1,108 @@\n+/*\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+package io.prestosql.client;\n+\n+import com.google.common.collect.ImmutableList;\n+\n+import javax.annotation.Nullable;\n+\n+import java.util.ArrayList;\n+import java.util.List;\n+import java.util.Objects;\n+import java.util.Optional;\n+\n+import static java.lang.String.format;\n+import static java.util.Objects.requireNonNull;\n+import static java.util.stream.Collectors.joining;\n+\n+public final class Row\n+{\n+    private final List<RowField> fields;\n+\n+    private Row(List<RowField> fields)\n+    {\n+        this.fields = ImmutableList.copyOf(requireNonNull(fields, \"fields is null\"));", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMDU2MjcxOA=="}, "originalCommit": null, "originalPosition": 35}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzMyNzYxMjM5OnYy", "diffSide": "LEFT", "path": "presto-jdbc/src/main/java/io/prestosql/jdbc/AbstractPrestoResultSet.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0yNVQxODoyMDozN1rOH5_QLw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0yNVQyMToyMDo1N1rOH6ENDA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMDU2NzIxNQ==", "bodyText": "extract commit?", "url": "https://github.com/trinodb/trino/pull/4588#discussion_r530567215", "createdAt": "2020-11-25T18:20:37Z", "author": {"login": "losipiuk"}, "path": "presto-jdbc/src/main/java/io/prestosql/jdbc/AbstractPrestoResultSet.java", "diffHunk": "@@ -1654,17 +1743,23 @@ public void updateNClob(String columnLabel, Reader reader)\n         }\n         Object object = getObject(columnIndex);\n         if (object == null || type.isInstance(object)) {\n-            //noinspection unchecked\n-            return (T) object;\n+            return type.cast(object);\n+        }\n+        try {\n+            T converted = TYPE_CONVERSIONS.convert(object, type);\n+            verify(converted != null, \"Conversion cannot return null for non-null input, as this breask wasNull()\");\n+            return converted;\n+        }\n+        catch (NoConversionRegisteredException e) {\n+            throw new SQLException(format(\"Cannot convert an instance of %s to %s\", object.getClass(), type));\n         }\n-        throw new SQLException(format(\"Cannot convert an instance of %s to %s\", object.getClass(), type));\n     }\n \n     @Override\n     public <T> T getObject(String columnLabel, Class<T> type)\n             throws SQLException\n     {\n-        throw new SQLFeatureNotSupportedException(\"getObject\");", "state": "SUBMITTED", "replyTo": null, "originalCommit": null, "originalPosition": 182}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMDY0ODMzMg==", "bodyText": "i didn't separate it because i did not see a clean separation, as the getObject(Class) is pointless without other changes. i can still try to do it, if you want", "url": "https://github.com/trinodb/trino/pull/4588#discussion_r530648332", "createdAt": "2020-11-25T21:20:57Z", "author": {"login": "findepi"}, "path": "presto-jdbc/src/main/java/io/prestosql/jdbc/AbstractPrestoResultSet.java", "diffHunk": "@@ -1654,17 +1743,23 @@ public void updateNClob(String columnLabel, Reader reader)\n         }\n         Object object = getObject(columnIndex);\n         if (object == null || type.isInstance(object)) {\n-            //noinspection unchecked\n-            return (T) object;\n+            return type.cast(object);\n+        }\n+        try {\n+            T converted = TYPE_CONVERSIONS.convert(object, type);\n+            verify(converted != null, \"Conversion cannot return null for non-null input, as this breask wasNull()\");\n+            return converted;\n+        }\n+        catch (NoConversionRegisteredException e) {\n+            throw new SQLException(format(\"Cannot convert an instance of %s to %s\", object.getClass(), type));\n         }\n-        throw new SQLException(format(\"Cannot convert an instance of %s to %s\", object.getClass(), type));\n     }\n \n     @Override\n     public <T> T getObject(String columnLabel, Class<T> type)\n             throws SQLException\n     {\n-        throw new SQLFeatureNotSupportedException(\"getObject\");", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMDU2NzIxNQ=="}, "originalCommit": null, "originalPosition": 182}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzMyNzYxMzk3OnYy", "diffSide": "RIGHT", "path": "presto-jdbc/src/main/java/io/prestosql/jdbc/AbstractPrestoResultSet.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0yNVQxODoyMToxMFrOH5_RHw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0yNVQxODoyMToxMFrOH5_RHw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMDU2NzQ1NQ==", "bodyText": "first mapping is kinda unrelated. Extract commit?", "url": "https://github.com/trinodb/trino/pull/4588#discussion_r530567455", "createdAt": "2020-11-25T18:21:10Z", "author": {"login": "losipiuk"}, "path": "presto-jdbc/src/main/java/io/prestosql/jdbc/AbstractPrestoResultSet.java", "diffHunk": "@@ -118,6 +125,23 @@\n     // Since January 1, 1900 UTC is still December 31, 1899 in other zones, we are adding a 1 year margin.\n     private static final long START_OF_MODERN_ERA = new LocalDate(1901, 1, 1).toDateTimeAtStartOfDay(UTC).getMillis();\n \n+    private static final TypeConversions TYPE_CONVERSIONS =\n+            TypeConversions.builder()\n+                    .add(PrestoArray.class, List.class, array -> asList((Object[]) array.getArray()))", "state": "SUBMITTED", "replyTo": null, "originalCommit": null, "originalPosition": 40}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzMyNzYyNjM3OnYy", "diffSide": "RIGHT", "path": "presto-jdbc/src/test/java/io/prestosql/jdbc/BaseTestJdbcResultSet.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0yNVQxODoyNToyM1rOH5_Yvg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0yNVQyMToyMTo0M1rOH6EORw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMDU2OTQwNg==", "bodyText": "any guards using getTestedPrestoServerVersion needed?", "url": "https://github.com/trinodb/trino/pull/4588#discussion_r530569406", "createdAt": "2020-11-25T18:25:23Z", "author": {"login": "losipiuk"}, "path": "presto-jdbc/src/test/java/io/prestosql/jdbc/BaseTestJdbcResultSet.java", "diffHunk": "@@ -541,6 +547,28 @@ public void testArray()\n     {\n         try (ConnectedStatement connectedStatement = newStatement()) {\n             checkRepresentation(connectedStatement.getStatement(), \"ARRAY[1, 2]\", Types.ARRAY, (rs, column) -> assertEquals(rs.getArray(column).getArray(), new int[] {1, 2}));\n+\n+            // array of map", "state": "SUBMITTED", "replyTo": null, "originalCommit": null, "originalPosition": 34}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMDY0ODY0Nw==", "bodyText": "no, as this is client-side change only", "url": "https://github.com/trinodb/trino/pull/4588#discussion_r530648647", "createdAt": "2020-11-25T21:21:43Z", "author": {"login": "findepi"}, "path": "presto-jdbc/src/test/java/io/prestosql/jdbc/BaseTestJdbcResultSet.java", "diffHunk": "@@ -541,6 +547,28 @@ public void testArray()\n     {\n         try (ConnectedStatement connectedStatement = newStatement()) {\n             checkRepresentation(connectedStatement.getStatement(), \"ARRAY[1, 2]\", Types.ARRAY, (rs, column) -> assertEquals(rs.getArray(column).getArray(), new int[] {1, 2}));\n+\n+            // array of map", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMDU2OTQwNg=="}, "originalCommit": null, "originalPosition": 34}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzMyNzYzOTUzOnYy", "diffSide": "RIGHT", "path": "presto-test-jdbc-compatibility-old-driver/src/test/java/io/prestosql/TestJdbcCompatibility.java", "isResolved": true, "comments": {"totalCount": 6, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0yNVQxODoyOTozMFrOH5_g2Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0yNlQxMDozMjoxMlrOH6VWjg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMDU3MTQ4MQ==", "bodyText": "I do not fully get this test class. How does it relate to TestJdbcResultSetCompatibilityOldServer?", "url": "https://github.com/trinodb/trino/pull/4588#discussion_r530571481", "createdAt": "2020-11-25T18:29:30Z", "author": {"login": "losipiuk"}, "path": "presto-test-jdbc-compatibility-old-driver/src/test/java/io/prestosql/TestJdbcCompatibility.java", "diffHunk": "@@ -330,7 +330,7 @@ public void testSelectRow()\n     {\n         String query = \"SELECT CAST(ROW(1, 2e0) AS ROW(x BIGINT, y DOUBLE))\";\n         checkRepresentation(query, JAVA_OBJECT, (rs, column) -> {\n-            Map<String, Object> values = (Map<String, Object>) rs.getObject(column);\n+            Map<String, Object> values = getRowAsMap(rs, column);", "state": "SUBMITTED", "replyTo": null, "originalCommit": null, "originalPosition": 5}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMDY0OTAwNw==", "bodyText": "TestJdbcCompatibility tests all driver (using the old version of tests) against current server\nTestJdbcResultSetCompatibilityOldServer tests current driver against old server", "url": "https://github.com/trinodb/trino/pull/4588#discussion_r530649007", "createdAt": "2020-11-25T21:22:35Z", "author": {"login": "findepi"}, "path": "presto-test-jdbc-compatibility-old-driver/src/test/java/io/prestosql/TestJdbcCompatibility.java", "diffHunk": "@@ -330,7 +330,7 @@ public void testSelectRow()\n     {\n         String query = \"SELECT CAST(ROW(1, 2e0) AS ROW(x BIGINT, y DOUBLE))\";\n         checkRepresentation(query, JAVA_OBJECT, (rs, column) -> {\n-            Map<String, Object> values = (Map<String, Object>) rs.getObject(column);\n+            Map<String, Object> values = getRowAsMap(rs, column);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMDU3MTQ4MQ=="}, "originalCommit": null, "originalPosition": 5}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMDY2Nzk3Mg==", "bodyText": "Yeah - I meant TestJdbcResultSetCompatibilityOldDriver which also tests current server vs old driver", "url": "https://github.com/trinodb/trino/pull/4588#discussion_r530667972", "createdAt": "2020-11-25T22:10:42Z", "author": {"login": "losipiuk"}, "path": "presto-test-jdbc-compatibility-old-driver/src/test/java/io/prestosql/TestJdbcCompatibility.java", "diffHunk": "@@ -330,7 +330,7 @@ public void testSelectRow()\n     {\n         String query = \"SELECT CAST(ROW(1, 2e0) AS ROW(x BIGINT, y DOUBLE))\";\n         checkRepresentation(query, JAVA_OBJECT, (rs, column) -> {\n-            Map<String, Object> values = (Map<String, Object>) rs.getObject(column);\n+            Map<String, Object> values = getRowAsMap(rs, column);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMDU3MTQ4MQ=="}, "originalCommit": null, "originalPosition": 5}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMDY2ODUxNQ==", "bodyText": "Actually what you wrote about TestJdbcCompatibilty, is claimed to be done by TJRSCOD.\nQuoting javadoc on that from TestJdbcCompatibility:\n * {@link TestJdbcResultSetCompatibilityOldDriver} in that regard is responsible for testing forward compatibility\n * as it's using old test code and old JDBC client against current server implementation.", "url": "https://github.com/trinodb/trino/pull/4588#discussion_r530668515", "createdAt": "2020-11-25T22:12:25Z", "author": {"login": "losipiuk"}, "path": "presto-test-jdbc-compatibility-old-driver/src/test/java/io/prestosql/TestJdbcCompatibility.java", "diffHunk": "@@ -330,7 +330,7 @@ public void testSelectRow()\n     {\n         String query = \"SELECT CAST(ROW(1, 2e0) AS ROW(x BIGINT, y DOUBLE))\";\n         checkRepresentation(query, JAVA_OBJECT, (rs, column) -> {\n-            Map<String, Object> values = (Map<String, Object>) rs.getObject(column);\n+            Map<String, Object> values = getRowAsMap(rs, column);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMDU3MTQ4MQ=="}, "originalCommit": null, "originalPosition": 5}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMDY2OTUwNQ==", "bodyText": "I am not sure i understand... do you want me to do a change here?", "url": "https://github.com/trinodb/trino/pull/4588#discussion_r530669505", "createdAt": "2020-11-25T22:15:15Z", "author": {"login": "findepi"}, "path": "presto-test-jdbc-compatibility-old-driver/src/test/java/io/prestosql/TestJdbcCompatibility.java", "diffHunk": "@@ -330,7 +330,7 @@ public void testSelectRow()\n     {\n         String query = \"SELECT CAST(ROW(1, 2e0) AS ROW(x BIGINT, y DOUBLE))\";\n         checkRepresentation(query, JAVA_OBJECT, (rs, column) -> {\n-            Map<String, Object> values = (Map<String, Object>) rs.getObject(column);\n+            Map<String, Object> values = getRowAsMap(rs, column);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMDU3MTQ4MQ=="}, "originalCommit": null, "originalPosition": 5}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMDkyOTI5NA==", "bodyText": "No. Just thinking loudly.", "url": "https://github.com/trinodb/trino/pull/4588#discussion_r530929294", "createdAt": "2020-11-26T10:32:12Z", "author": {"login": "losipiuk"}, "path": "presto-test-jdbc-compatibility-old-driver/src/test/java/io/prestosql/TestJdbcCompatibility.java", "diffHunk": "@@ -330,7 +330,7 @@ public void testSelectRow()\n     {\n         String query = \"SELECT CAST(ROW(1, 2e0) AS ROW(x BIGINT, y DOUBLE))\";\n         checkRepresentation(query, JAVA_OBJECT, (rs, column) -> {\n-            Map<String, Object> values = (Map<String, Object>) rs.getObject(column);\n+            Map<String, Object> values = getRowAsMap(rs, column);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMDU3MTQ4MQ=="}, "originalCommit": null, "originalPosition": 5}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3519, "cost": 1, "resetAt": "2021-11-12T12:57:47Z"}}}