{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDg3MzU5ODA5", "number": 5171, "reviewThreads": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xNVQxNTowMzoxMFrOEjovaQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xNlQxODowMzowNFrOEkKnvw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzA1ODAzMTEzOnYy", "diffSide": "RIGHT", "path": "presto-product-tests-launcher/src/main/java/io/prestosql/tests/product/launcher/env/Environments.java", "isResolved": true, "comments": {"totalCount": 6, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xNVQxNTowMzoxMFrOHSGXNw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xNlQwOTowODo1NFrOHSni8g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4ODc0MDY2Mw==", "bodyText": "i often use the fact that the containers have fixed, easy name\nsee #4834 (comment)", "url": "https://github.com/trinodb/trino/pull/5171#discussion_r488740663", "createdAt": "2020-09-15T15:03:10Z", "author": {"login": "findepi"}, "path": "presto-product-tests-launcher/src/main/java/io/prestosql/tests/product/launcher/env/Environments.java", "diffHunk": "@@ -109,4 +158,45 @@ public static String nameForConfigClass(Class<? extends EnvironmentConfig> clazz\n     {\n         return CaseFormat.UPPER_CAMEL.to(CaseFormat.LOWER_HYPHEN, clazz.getSimpleName());\n     }\n+\n+    public static String networkName(String environmentName)\n+    {\n+        return format(\"%s.%s\", environmentName, PRODUCT_TEST_ENVIRONMENT);\n+    }\n+\n+    public static String containerId(String environmentName, String containerName)\n+    {\n+        return format(\"%s-%s\", environmentName, containerName);", "state": "SUBMITTED", "replyTo": null, "originalCommit": null, "originalPosition": 136}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4ODc1MTg0NQ==", "bodyText": "I've zsh function for that. Is it a big deal for you?", "url": "https://github.com/trinodb/trino/pull/5171#discussion_r488751845", "createdAt": "2020-09-15T15:17:38Z", "author": {"login": "wendigo"}, "path": "presto-product-tests-launcher/src/main/java/io/prestosql/tests/product/launcher/env/Environments.java", "diffHunk": "@@ -109,4 +158,45 @@ public static String nameForConfigClass(Class<? extends EnvironmentConfig> clazz\n     {\n         return CaseFormat.UPPER_CAMEL.to(CaseFormat.LOWER_HYPHEN, clazz.getSimpleName());\n     }\n+\n+    public static String networkName(String environmentName)\n+    {\n+        return format(\"%s.%s\", environmentName, PRODUCT_TEST_ENVIRONMENT);\n+    }\n+\n+    public static String containerId(String environmentName, String containerName)\n+    {\n+        return format(\"%s-%s\", environmentName, containerName);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4ODc0MDY2Mw=="}, "originalCommit": null, "originalPosition": 136}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4ODc2OTY5OQ==", "bodyText": "I can reverse the name (containerName-environmentName) which will make it easier to autocomplete", "url": "https://github.com/trinodb/trino/pull/5171#discussion_r488769699", "createdAt": "2020-09-15T15:41:54Z", "author": {"login": "wendigo"}, "path": "presto-product-tests-launcher/src/main/java/io/prestosql/tests/product/launcher/env/Environments.java", "diffHunk": "@@ -109,4 +158,45 @@ public static String nameForConfigClass(Class<? extends EnvironmentConfig> clazz\n     {\n         return CaseFormat.UPPER_CAMEL.to(CaseFormat.LOWER_HYPHEN, clazz.getSimpleName());\n     }\n+\n+    public static String networkName(String environmentName)\n+    {\n+        return format(\"%s.%s\", environmentName, PRODUCT_TEST_ENVIRONMENT);\n+    }\n+\n+    public static String containerId(String environmentName, String containerName)\n+    {\n+        return format(\"%s-%s\", environmentName, containerName);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4ODc0MDY2Mw=="}, "originalCommit": null, "originalPosition": 136}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4OTI4MDE4Ng==", "bodyText": "Would it help me to run docker exec -it ptl-hadoop-master bash -l easily?\noften in a different shell than the one that was starting the environment?", "url": "https://github.com/trinodb/trino/pull/5171#discussion_r489280186", "createdAt": "2020-09-16T09:02:07Z", "author": {"login": "findepi"}, "path": "presto-product-tests-launcher/src/main/java/io/prestosql/tests/product/launcher/env/Environments.java", "diffHunk": "@@ -109,4 +158,45 @@ public static String nameForConfigClass(Class<? extends EnvironmentConfig> clazz\n     {\n         return CaseFormat.UPPER_CAMEL.to(CaseFormat.LOWER_HYPHEN, clazz.getSimpleName());\n     }\n+\n+    public static String networkName(String environmentName)\n+    {\n+        return format(\"%s.%s\", environmentName, PRODUCT_TEST_ENVIRONMENT);\n+    }\n+\n+    public static String containerId(String environmentName, String containerName)\n+    {\n+        return format(\"%s-%s\", environmentName, containerName);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4ODc0MDY2Mw=="}, "originalCommit": null, "originalPosition": 136}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4OTI4Mzk3OQ==", "bodyText": "I can reverse the name (containerName-environmentName) which will make it easier to autocomplete\n\ninteresting idea!\nfwiw, i am heavy history user (ctrl+r in bash)", "url": "https://github.com/trinodb/trino/pull/5171#discussion_r489283979", "createdAt": "2020-09-16T09:08:17Z", "author": {"login": "findepi"}, "path": "presto-product-tests-launcher/src/main/java/io/prestosql/tests/product/launcher/env/Environments.java", "diffHunk": "@@ -109,4 +158,45 @@ public static String nameForConfigClass(Class<? extends EnvironmentConfig> clazz\n     {\n         return CaseFormat.UPPER_CAMEL.to(CaseFormat.LOWER_HYPHEN, clazz.getSimpleName());\n     }\n+\n+    public static String networkName(String environmentName)\n+    {\n+        return format(\"%s.%s\", environmentName, PRODUCT_TEST_ENVIRONMENT);\n+    }\n+\n+    public static String containerId(String environmentName, String containerName)\n+    {\n+        return format(\"%s-%s\", environmentName, containerName);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4ODc0MDY2Mw=="}, "originalCommit": null, "originalPosition": 136}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4OTI4NDMzOA==", "bodyText": "Also, if i had 2 envs running side by side, i'd prefer env name to be prefix", "url": "https://github.com/trinodb/trino/pull/5171#discussion_r489284338", "createdAt": "2020-09-16T09:08:54Z", "author": {"login": "findepi"}, "path": "presto-product-tests-launcher/src/main/java/io/prestosql/tests/product/launcher/env/Environments.java", "diffHunk": "@@ -109,4 +158,45 @@ public static String nameForConfigClass(Class<? extends EnvironmentConfig> clazz\n     {\n         return CaseFormat.UPPER_CAMEL.to(CaseFormat.LOWER_HYPHEN, clazz.getSimpleName());\n     }\n+\n+    public static String networkName(String environmentName)\n+    {\n+        return format(\"%s.%s\", environmentName, PRODUCT_TEST_ENVIRONMENT);\n+    }\n+\n+    public static String containerId(String environmentName, String containerName)\n+    {\n+        return format(\"%s-%s\", environmentName, containerName);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4ODc0MDY2Mw=="}, "originalCommit": null, "originalPosition": 136}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzA2MTY5NzM3OnYy", "diffSide": "RIGHT", "path": "presto-product-tests-launcher/src/main/java/io/prestosql/tests/product/launcher/env/Environment.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xNlQxMDoxMTo1MVrOHSp8OA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xNlQxMDoxMTo1MVrOHSp8OA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4OTMyMzU3Ng==", "bodyText": "nit: constant?", "url": "https://github.com/trinodb/trino/pull/5171#discussion_r489323576", "createdAt": "2020-09-16T10:11:51Z", "author": {"login": "losipiuk"}, "path": "presto-product-tests-launcher/src/main/java/io/prestosql/tests/product/launcher/env/Environment.java", "diffHunk": "@@ -195,20 +197,30 @@ public void close()\n         stop();\n     }\n \n-    public static class Builder\n+    private static void attachNetwork(Collection<DockerContainer> values, Network network)\n     {\n-        private final String name;\n-        private DockerContainer.OutputMode outputMode;\n-        private int startupRetries = 1;\n+        values.forEach(container -> container.withNetwork(network));\n+    }\n \n-        @SuppressWarnings(\"resource\")\n-        private Network network = Network.builder()\n+    private static Network createNetwork(String environmentName)\n+    {\n+        Network network = Network.builder()\n                 .createNetworkCmdModifier(createNetworkCmd ->\n                         createNetworkCmd\n                                 .withName(PRODUCT_TEST_LAUNCHER_NETWORK)\n-                                .withLabels(ImmutableMap.of(PRODUCT_TEST_LAUNCHER_STARTED_LABEL_NAME, PRODUCT_TEST_LAUNCHER_STARTED_LABEL_VALUE)))\n+                                .withLabels(ImmutableMap.of(\n+                                        PRODUCT_TEST_LAUNCHER_STARTED_LABEL_NAME, PRODUCT_TEST_LAUNCHER_STARTED_LABEL_VALUE,\n+                                        \"ptl.environment.name\", environmentName)))", "state": "SUBMITTED", "replyTo": null, "originalCommit": null, "originalPosition": 50}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzA2MzU4MjA3OnYy", "diffSide": "RIGHT", "path": "presto-product-tests-launcher/src/main/java/io/prestosql/tests/product/launcher/env/EnvironmentListener.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xNlQxODowMzowNFrOHS8Pgw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xNlQxODowMzowNFrOHS8Pgw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4OTYyMzQyNw==", "bodyText": "Shouldn't we warn also in case when Optional is empty?", "url": "https://github.com/trinodb/trino/pull/5171#discussion_r489623427", "createdAt": "2020-09-16T18:03:04Z", "author": {"login": "losipiuk"}, "path": "presto-product-tests-launcher/src/main/java/io/prestosql/tests/product/launcher/env/EnvironmentListener.java", "diffHunk": "@@ -188,12 +188,14 @@ static EnvironmentListener statsPrintingListener()\n             @Override\n             public void containerStopping(DockerContainer container, InspectContainerResponse response)\n             {\n-                try {\n-                    log.info(\"Container %s stats: %s\", container, mapper.writeValueAsString(container.getStats()));\n-                }\n-                catch (JsonProcessingException e) {\n-                    log.warn(\"Could not display container %s stats: %s\", container, e);\n-                }\n+                container.getStats().ifPresent(statistics -> {\n+                    try {\n+                        log.info(\"Container %s stats: %s\", container, mapper.writeValueAsString(statistics));\n+                    }\n+                    catch (JsonProcessingException e) {\n+                        log.warn(\"Could not display container %s stats: %s\", container, e);", "state": "SUBMITTED", "replyTo": null, "originalCommit": null, "originalPosition": 15}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3222, "cost": 1, "resetAt": "2021-11-12T12:57:47Z"}}}