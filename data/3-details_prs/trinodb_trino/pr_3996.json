{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDMyODA2NDY3", "number": 3996, "title": "Fix flaky TestEventListener", "bodyText": "peakTaskTotalMemory and peakTotalNonRevocableMemoryBytes in QueryStatistics\nmust be derived from QueryStats correctly.\nSee: https://github.com/prestosql/presto/blob/37c74ad15f5f0c9c770c2aa491e49ffe5146d4b1/presto-main/src/main/java/io/prestosql/event/QueryMonitor.java#L243\nhttps://github.com/prestosql/presto/blob/37c74ad15f5f0c9c770c2aa491e49ffe5146d4b1/presto-main/src/main/java/io/prestosql/event/QueryMonitor.java#L245\nIt fixes the issue in #3943 (comment)", "createdAt": "2020-06-11T02:50:03Z", "url": "https://github.com/trinodb/trino/pull/3996", "merged": true, "mergeCommit": {"oid": "392d10be4a8ec5e8281b7de109c8a524476161b6"}, "closed": true, "closedAt": "2020-06-22T08:37:43Z", "author": {"login": "Lewuathe"}, "timelineItems": {"totalCount": 7, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcqGPZcgBqjM0MzIzNjY5MjY=", "endCursor": "Y3Vyc29yOnYyOpPPAAABctss5OAFqTQzNDcxNTAwMQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "HeadRefForcePushedEvent", "beforeCommit": null, "afterCommit": null}, {"__typename": "PullRequestCommit", "commit": {"oid": "1656560a3eabc4fe39658b6482013c86153541c3", "author": {"user": {"login": "Lewuathe", "name": "Kai Sasaki"}}, "url": "https://github.com/trinodb/trino/commit/1656560a3eabc4fe39658b6482013c86153541c3", "committedDate": "2020-06-15T00:03:43Z", "message": "Fix flaky TestEventListener\n\npeakTaskTotalMemory and peakTotalNonRevocableMemoryBytes in QueryStatistics\nmust be derived from QueryStats correctly."}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": null, "afterCommit": {"oid": "1656560a3eabc4fe39658b6482013c86153541c3", "author": {"user": {"login": "Lewuathe", "name": "Kai Sasaki"}}, "url": "https://github.com/trinodb/trino/commit/1656560a3eabc4fe39658b6482013c86153541c3", "committedDate": "2020-06-15T00:03:43Z", "message": "Fix flaky TestEventListener\n\npeakTaskTotalMemory and peakTotalNonRevocableMemoryBytes in QueryStatistics\nmust be derived from QueryStats correctly."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDMwNDkxNTA1", "url": "https://github.com/trinodb/trino/pull/3996#pullrequestreview-430491505", "createdAt": "2020-06-15T09:53:43Z", "commit": {"oid": "1656560a3eabc4fe39658b6482013c86153541c3"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xNVQwOTo1Mzo0M1rOGjrOfw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xNVQwOTo1Mzo0M1rOGjrOfw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MDA2MTU2Nw==", "bodyText": "see: io/prestosql/execution/QueryStateMachine.java:120\n    // peak of the user + system + revocable memory reservation\n\nso getPeakTotalNonRevocableMemoryBytes() != getPeakTotalMemoryReservation\nWe don't track PeakTotalNonRevocableMemoryBytes in QueryStateMachine", "url": "https://github.com/trinodb/trino/pull/3996#discussion_r440061567", "createdAt": "2020-06-15T09:53:43Z", "author": {"login": "sopel39"}, "path": "presto-tests/src/test/java/io/prestosql/execution/TestEventListener.java", "diffHunk": "@@ -377,8 +377,8 @@ public void testOutputStats()\n         assertEquals(statistics.getAnalysisTime().get().toMillis(), queryStats.getAnalysisTime().toMillis());\n         assertEquals(statistics.getExecutionTime().get().toMillis(), queryStats.getExecutionTime().toMillis());\n         assertEquals(statistics.getPeakUserMemoryBytes(), queryStats.getPeakUserMemoryReservation().toBytes());\n-        assertEquals(statistics.getPeakTotalNonRevocableMemoryBytes(), queryStats.getPeakTaskUserMemory().toBytes());\n-        assertEquals(statistics.getPeakTaskTotalMemory(), queryStats.getPeakTaskUserMemory().toBytes());\n+        assertEquals(statistics.getPeakTotalNonRevocableMemoryBytes(), queryStats.getPeakTotalMemoryReservation().toBytes());", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "1656560a3eabc4fe39658b6482013c86153541c3"}, "originalPosition": 6}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "dbf97e5a7e317b4a928a5fa86d3ca463962a40d9", "author": {"user": {"login": "Lewuathe", "name": "Kai Sasaki"}}, "url": "https://github.com/trinodb/trino/commit/dbf97e5a7e317b4a928a5fa86d3ca463962a40d9", "committedDate": "2020-06-22T01:20:22Z", "message": "Disable non-revocable memory reservation check"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": null, "afterCommit": {"oid": "dbf97e5a7e317b4a928a5fa86d3ca463962a40d9", "author": {"user": {"login": "Lewuathe", "name": "Kai Sasaki"}}, "url": "https://github.com/trinodb/trino/commit/dbf97e5a7e317b4a928a5fa86d3ca463962a40d9", "committedDate": "2020-06-22T01:20:22Z", "message": "Disable non-revocable memory reservation check"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDM0NzE1MDAx", "url": "https://github.com/trinodb/trino/pull/3996#pullrequestreview-434715001", "createdAt": "2020-06-22T08:37:32Z", "commit": {"oid": "dbf97e5a7e317b4a928a5fa86d3ca463962a40d9"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 643, "cost": 1, "resetAt": "2021-10-28T19:08:13Z"}}}