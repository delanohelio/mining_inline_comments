{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0MzkyMjc2NzQ0", "number": 3206, "reviewThreads": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yM1QwOTo1NzoyNFrODqTnrQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yM1QxMTowNzoxMFrODqVJUw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjQ1Njg4MjM3OnYy", "diffSide": "RIGHT", "path": "presto-password-authenticators/src/main/java/io/prestosql/plugin/password/ldap/LdapAuthenticator.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yM1QwOTo1NzoyNFrOF5-GQQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yM1QwOTo1NzoyNFrOF5-GQQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NjMzMDU2MQ==", "bodyText": "If we're going to stop on first match, we should not return anything.\nOtherwise the returned value is misleading (should not be used for anything), error-prine.\n\nMaybe make this method return Stream\nwhere you currently firstMatch, you would just check stream is not empty\nwhere you currently !firstMatch, you'd limit 2, collect to list and throw if not singleton", "url": "https://github.com/trinodb/trino/pull/3206#discussion_r396330561", "createdAt": "2020-03-23T09:57:24Z", "author": {"login": "findepi"}, "path": "presto-password-authenticators/src/main/java/io/prestosql/plugin/password/ldap/LdapAuthenticator.java", "diffHunk": "@@ -196,7 +196,7 @@ static boolean containsSpecialCharacters(String user)\n         return SPECIAL_CHARACTERS.matchesAnyOf(user);\n     }\n \n-    private String validateGroupMembership(String user, DirContext context)\n+    private String validateGroupMembership(String user, DirContext context, boolean firstMatch)", "state": "SUBMITTED", "replyTo": null, "originalCommit": null, "originalPosition": 38}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjQ1NzEzMjM1OnYy", "diffSide": "RIGHT", "path": "presto-password-authenticators/src/main/java/io/prestosql/plugin/password/ldap/LdapAuthenticator.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yM1QxMTowNzoxMFrOF6Aj5Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yM1QxMTowNzoxMFrOF6Aj5Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NjM3MDkxNw==", "bodyText": "This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters. Learn more about bidirectional Unicode characters\n\n\n  \n\n\n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                                String message = format(\"User [%s] not a member of the authorized group\", user);\n          \n          \n            \n                                String message = format(\"User [%s] not a member of an authorized group\", user);", "url": "https://github.com/trinodb/trino/pull/3206#discussion_r396370917", "createdAt": "2020-03-23T11:07:10Z", "author": {"login": "findepi"}, "path": "presto-password-authenticators/src/main/java/io/prestosql/plugin/password/ldap/LdapAuthenticator.java", "diffHunk": "@@ -180,6 +180,28 @@ private String validateGroupMembership(String user, String contextUserDistinguis\n         }\n     }\n \n+    private void checkGroupMembership(String user, String contextUserDistinguishedName, String contextPassword)\n+            throws NamingException\n+    {\n+        DirContext context = createUserDirContext(contextUserDistinguishedName, contextPassword);\n+        try {\n+            NamingEnumeration<SearchResult> search = searchGroupMembership(user, context);\n+            try {\n+                if (!search.hasMore()) {\n+                    String message = format(\"User [%s] not a member of the authorized group\", user);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "7a0492f654d03563fcba6c5f72a3106e8b4a8361"}, "originalPosition": 21}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 459, "cost": 1, "resetAt": "2021-11-13T12:10:21Z"}}}