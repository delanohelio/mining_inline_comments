{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDA5NzQ1MjIy", "number": 3562, "title": "Add random suffix to all tables in TestDistributedQueries", "bodyText": "Many of the tests were doing this already, but this updates the few that were missed.", "createdAt": "2020-04-27T21:02:01Z", "url": "https://github.com/trinodb/trino/pull/3562", "merged": true, "mergeCommit": {"oid": "5bee68799867689ae2d88e4b09eeb1ea8537b402"}, "closed": true, "closedAt": "2020-04-28T19:15:21Z", "author": {"login": "alexjo2144"}, "timelineItems": {"totalCount": 7, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcb2HPOgFqTQwMTMzNjc2NA==", "endCursor": "Y3Vyc29yOnYyOpPPAAABccH_goABqjMyODE1NDkxNzQ=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDAxMzM2NzY0", "url": "https://github.com/trinodb/trino/pull/3562#pullrequestreview-401336764", "createdAt": "2020-04-27T21:22:51Z", "commit": null, "state": "COMMENTED", "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yN1QyMToyMjo1MVrOGM4R8Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yN1QyMToyNDo0N1rOGM4Wkw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNjE1ODE5Mw==", "bodyText": "Actually, do we need to pass any argument here? Maybe we could have only getUniqueTableName() or just getUniqueName()?", "url": "https://github.com/trinodb/trino/pull/3562#discussion_r416158193", "createdAt": "2020-04-27T21:22:51Z", "author": {"login": "kokosing"}, "path": "presto-testing/src/main/java/io/prestosql/testing/sql/TestTable.java", "diffHunk": "@@ -66,6 +66,11 @@ public void close()\n         sqlExecutor.execute(\"DROP TABLE \" + name);\n     }\n \n+    public static String getTestTableName(String baseTableName)", "state": "SUBMITTED", "replyTo": null, "originalCommit": null, "originalPosition": 4}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNjE1ODU4NQ==", "bodyText": "This test is missing DROP", "url": "https://github.com/trinodb/trino/pull/3562#discussion_r416158585", "createdAt": "2020-04-27T21:23:28Z", "author": {"login": "kokosing"}, "path": "presto-testing/src/main/java/io/prestosql/testing/AbstractTestDistributedQueries.java", "diffHunk": "@@ -349,94 +354,101 @@ protected void assertCreateTableAsSelect(Session session, @Language(\"SQL\") Strin\n     @Test\n     public void testRenameTable()\n     {\n-        assertUpdate(\"CREATE TABLE test_rename AS SELECT 123 x\", 1);\n+        String tableName = getTestTableName(\"test_rename\");\n+        assertUpdate(\"CREATE TABLE \" + tableName + \" AS SELECT 123 x\", 1);\n \n-        assertUpdate(\"ALTER TABLE test_rename RENAME TO test_rename_new\");\n-        assertQuery(\"SELECT x FROM test_rename_new\", \"VALUES 123\");\n+        String renamedTable = getTestTableName(\"test_rename_new\");\n+        assertUpdate(\"ALTER TABLE \" + tableName + \" RENAME TO \" + renamedTable);\n+        assertQuery(\"SELECT x FROM \" + renamedTable, \"VALUES 123\");\n \n-        assertUpdate(\"ALTER TABLE test_rename_new RENAME TO TEST_RENAME\"); // 'TEST_RENAME' is upper-case, not delimited\n+        String uppercaseName = getTestTableName(\"TEST_RENAME\");\n+        assertUpdate(\"ALTER TABLE \" + renamedTable + \" RENAME TO \" + uppercaseName); // 'TEST_RENAME' is upper-case, not delimited\n         assertQuery(\n-                \"SELECT x FROM test_rename\", // 'test_rename' is lower-case, not delimited\n+                \"SELECT x FROM \" + uppercaseName.toLowerCase(ENGLISH), // 'test_rename' is lower-case, not delimited\n                 \"VALUES 123\");\n \n-        assertUpdate(\"DROP TABLE test_rename\");\n+        assertUpdate(\"DROP TABLE \" + uppercaseName);\n \n-        assertFalse(getQueryRunner().tableExists(getSession(), \"test_rename\"));\n-        assertFalse(getQueryRunner().tableExists(getSession(), \"test_rename_new\"));\n+        assertFalse(getQueryRunner().tableExists(getSession(), tableName));\n+        assertFalse(getQueryRunner().tableExists(getSession(), renamedTable));\n     }\n \n     @Test\n     public void testCommentTable()\n     {\n-        assertUpdate(\"CREATE TABLE test_comment(id integer)\");\n+        String tableName = getTestTableName(\"test_comment\");\n+        assertUpdate(\"CREATE TABLE \" + tableName + \"(id integer)\");\n \n-        assertUpdate(\"COMMENT ON TABLE test_comment IS 'new comment'\");\n-        MaterializedResult materializedRows = computeActual(\"SHOW CREATE TABLE test_comment\");\n+        assertUpdate(\"COMMENT ON TABLE \" + tableName + \" IS 'new comment'\");\n+        MaterializedResult materializedRows = computeActual(\"SHOW CREATE TABLE \" + tableName);\n         assertTrue(materializedRows.getMaterializedRows().get(0).getField(0).toString().contains(\"COMMENT 'new comment'\"));\n \n-        assertUpdate(\"COMMENT ON TABLE test_comment IS ''\");\n-        materializedRows = computeActual(\"SHOW CREATE TABLE test_comment\");\n+        assertUpdate(\"COMMENT ON TABLE \" + tableName + \" IS ''\");\n+        materializedRows = computeActual(\"SHOW CREATE TABLE \" + tableName);\n         assertTrue(materializedRows.getMaterializedRows().get(0).getField(0).toString().contains(\"COMMENT ''\"));\n \n-        assertUpdate(\"COMMENT ON TABLE test_comment IS NULL\");\n-        materializedRows = computeActual(\"SHOW CREATE TABLE test_comment\");\n+        assertUpdate(\"COMMENT ON TABLE \" + tableName + \" IS NULL\");\n+        materializedRows = computeActual(\"SHOW CREATE TABLE \" + tableName);\n         assertFalse(materializedRows.getMaterializedRows().get(0).getField(0).toString().contains(\"COMMENT\"));\n \n-        assertUpdate(\"DROP TABLE test_comment\");\n+        assertUpdate(\"DROP TABLE \" + tableName);\n     }\n \n     @Test\n     public void testRenameColumn()\n     {\n-        assertUpdate(\"CREATE TABLE test_rename_column AS SELECT 'some value' x\", 1);\n+        String tableName = getTestTableName(\"test_rename_column\");\n+        assertUpdate(\"CREATE TABLE \" + tableName + \" AS SELECT 'some value' x\", 1);\n \n-        assertUpdate(\"ALTER TABLE test_rename_column RENAME COLUMN x TO y\");\n-        assertQuery(\"SELECT y FROM test_rename_column\", \"VALUES 'some value'\");\n+        assertUpdate(\"ALTER TABLE \" + tableName + \" RENAME COLUMN x TO y\");\n+        assertQuery(\"SELECT y FROM \" + tableName, \"VALUES 'some value'\");\n \n-        assertUpdate(\"ALTER TABLE test_rename_column RENAME COLUMN y TO Z\"); // 'Z' is upper-case, not delimited\n+        assertUpdate(\"ALTER TABLE \" + tableName + \" RENAME COLUMN y TO Z\"); // 'Z' is upper-case, not delimited\n         assertQuery(\n-                \"SELECT z FROM test_rename_column\", // 'z' is lower-case, not delimited\n+                \"SELECT z FROM \" + tableName, // 'z' is lower-case, not delimited\n                 \"VALUES 'some value'\");\n \n         // There should be exactly one column\n-        assertQuery(\"SELECT * FROM test_rename_column\", \"VALUES 'some value'\");\n+        assertQuery(\"SELECT * FROM \" + tableName, \"VALUES 'some value'\");\n \n-        assertUpdate(\"DROP TABLE test_rename_column\");\n+        assertUpdate(\"DROP TABLE \" + tableName);\n     }\n \n     @Test\n     public void testDropColumn()\n     {\n-        assertUpdate(\"CREATE TABLE test_drop_column AS SELECT 123 x, 111 a\", 1);\n+        String tableName = getTestTableName(\"test_drop_column\");\n+        assertUpdate(\"CREATE TABLE \" + tableName + \" AS SELECT 123 x, 111 a\", 1);\n \n-        assertUpdate(\"ALTER TABLE test_drop_column DROP COLUMN x\");\n-        assertQueryFails(\"SELECT x FROM test_drop_column\", \".* Column 'x' cannot be resolved\");\n+        assertUpdate(\"ALTER TABLE \" + tableName + \" DROP COLUMN x\");\n+        assertQueryFails(\"SELECT x FROM \" + tableName, \".* Column 'x' cannot be resolved\");\n \n-        assertQueryFails(\"ALTER TABLE test_drop_column DROP COLUMN a\", \".* Cannot drop the only column in a table\");\n+        assertQueryFails(\"ALTER TABLE \" + tableName + \" DROP COLUMN a\", \".* Cannot drop the only column in a table\");", "state": "SUBMITTED", "replyTo": null, "originalCommit": null, "originalPosition": 179}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNjE1OTM3OQ==", "bodyText": "It looks like only few tests left... so maybe let's continue the convention from other tests.", "url": "https://github.com/trinodb/trino/pull/3562#discussion_r416159379", "createdAt": "2020-04-27T21:24:47Z", "author": {"login": "kokosing"}, "path": "presto-testing/src/main/java/io/prestosql/testing/AbstractTestDistributedQueries.java", "diffHunk": "@@ -154,41 +155,45 @@ public void testResetSession()\n     @Test\n     public void testCreateTable()\n     {\n-        assertUpdate(\"CREATE TABLE test_create (a bigint, b double, c varchar)\");\n-        assertTrue(getQueryRunner().tableExists(getSession(), \"test_create\"));\n-        assertTableColumnNames(\"test_create\", \"a\", \"b\", \"c\");\n+        String tableName = getTestTableName(\"test_create\");", "state": "SUBMITTED", "replyTo": null, "originalCommit": null, "originalPosition": 15}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": null, "afterCommit": null}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": null, "afterCommit": null}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": null, "afterCommit": null}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDAyMDczNjM1", "url": "https://github.com/trinodb/trino/pull/3562#pullrequestreview-402073635", "createdAt": "2020-04-28T17:49:34Z", "commit": null, "state": "APPROVED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yOFQxNzo0OTozNFrOGNf68g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yOFQxNzo0OTozNFrOGNf68g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNjgwNzY2Ng==", "bodyText": "update the comment", "url": "https://github.com/trinodb/trino/pull/3562#discussion_r416807666", "createdAt": "2020-04-28T17:49:34Z", "author": {"login": "findepi"}, "path": "presto-testing/src/main/java/io/prestosql/testing/AbstractTestDistributedQueries.java", "diffHunk": "@@ -349,94 +353,101 @@ protected void assertCreateTableAsSelect(Session session, @Language(\"SQL\") Strin\n     @Test\n     public void testRenameTable()\n     {\n-        assertUpdate(\"CREATE TABLE test_rename AS SELECT 123 x\", 1);\n+        String tableName = \"test_rename_\" + randomTableSuffix();\n+        assertUpdate(\"CREATE TABLE \" + tableName + \" AS SELECT 123 x\", 1);\n \n-        assertUpdate(\"ALTER TABLE test_rename RENAME TO test_rename_new\");\n-        assertQuery(\"SELECT x FROM test_rename_new\", \"VALUES 123\");\n+        String renamedTable = \"test_rename_new_\" + randomTableSuffix();\n+        assertUpdate(\"ALTER TABLE \" + tableName + \" RENAME TO \" + renamedTable);\n+        assertQuery(\"SELECT x FROM \" + renamedTable, \"VALUES 123\");\n \n-        assertUpdate(\"ALTER TABLE test_rename_new RENAME TO TEST_RENAME\"); // 'TEST_RENAME' is upper-case, not delimited\n+        String uppercaseName = \"TEST_RENAME_\" + randomTableSuffix();\n+        assertUpdate(\"ALTER TABLE \" + renamedTable + \" RENAME TO \" + uppercaseName); // 'TEST_RENAME' is upper-case, not delimited\n         assertQuery(\n-                \"SELECT x FROM test_rename\", // 'test_rename' is lower-case, not delimited\n+                \"SELECT x FROM \" + uppercaseName.toLowerCase(ENGLISH), // 'test_rename' is lower-case, not delimited", "state": "SUBMITTED", "replyTo": null, "originalCommit": null, "originalPosition": 90}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f01751bec02d10f686018dba2a5b156a6f6f1cd3", "author": {"user": {"login": "alexjo2144", "name": "Alexander Jo"}}, "url": "https://github.com/trinodb/trino/commit/f01751bec02d10f686018dba2a5b156a6f6f1cd3", "committedDate": "2020-04-28T18:14:02Z", "message": "Add random suffix to all tables in TestDistributedQueries"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": null, "afterCommit": {"oid": "f01751bec02d10f686018dba2a5b156a6f6f1cd3", "author": {"user": {"login": "alexjo2144", "name": "Alexander Jo"}}, "url": "https://github.com/trinodb/trino/commit/f01751bec02d10f686018dba2a5b156a6f6f1cd3", "committedDate": "2020-04-28T18:14:02Z", "message": "Add random suffix to all tables in TestDistributedQueries"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1301, "cost": 1, "resetAt": "2021-10-28T19:08:13Z"}}}