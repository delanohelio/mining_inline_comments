{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDA0MzEzODY1", "number": 3453, "title": "Support case insensitive identifiers in MongoDB", "bodyText": "Supersedes #1915 and fixes #1102\nRecently, we've received this request several times.", "createdAt": "2020-04-16T11:56:39Z", "url": "https://github.com/trinodb/trino/pull/3453", "merged": true, "mergeCommit": {"oid": "43b55cba71bc7345977f292f91b1a082ada72fdf"}, "closed": true, "closedAt": "2020-05-05T11:08:45Z", "author": {"login": "ebyhr"}, "timelineItems": {"totalCount": 10, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcc8_lZgBqjMyOTI1MTY1NTA=", "endCursor": "Y3Vyc29yOnYyOpPPAAABceQhq0ABqjMzMDMzNjQ2MDQ=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "HeadRefForcePushedEvent", "beforeCommit": null, "afterCommit": null}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": null, "afterCommit": null}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDA0NTE4MDM4", "url": "https://github.com/trinodb/trino/pull/3453#pullrequestreview-404518038", "createdAt": "2020-05-02T10:40:59Z", "commit": null, "state": "COMMENTED", "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wMlQxMDo0MDo1OVrOGPiOnw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wMlQxMDo0MzozM1rOGPiPew==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxODk0MjYyMw==", "bodyText": "Please extract refactoring (\"Make table wider\") to a preparatory commit", "url": "https://github.com/trinodb/trino/pull/3453#discussion_r418942623", "createdAt": "2020-05-02T10:40:59Z", "author": {"login": "findepi"}, "path": "presto-docs/src/main/sphinx/connector/mongodb.rst", "diffHunk": "@@ -34,24 +34,25 @@ Configuration Properties\n \n The following configuration properties are available:\n \n-===================================== ==============================================================\n-Property Name                         Description\n-===================================== ==============================================================\n-``mongodb.seeds``                     List of all MongoDB servers\n-``mongodb.schema-collection``         A collection which contains schema information\n-``mongodb.credentials``               List of credentials\n-``mongodb.min-connections-per-host``  The minimum size of the connection pool per host\n-``mongodb.connections-per-host``      The maximum size of the connection pool per host\n-``mongodb.max-wait-time``             The maximum wait time\n-``mongodb.connection-timeout``        The socket connect timeout\n-``mongodb.socket-timeout``            The socket timeout\n-``mongodb.socket-keep-alive``         Whether keep-alive is enabled on each socket\n-``mongodb.ssl.enabled``               Use TLS/SSL for connections to mongod/mongos\n-``mongodb.read-preference``           The read preference\n-``mongodb.write-concern``             The write concern\n-``mongodb.required-replica-set``      The required replica set name\n-``mongodb.cursor-batch-size``         The number of elements to return in a batch\n-===================================== ==============================================================\n+========================================== ==============================================================\n+Property Name                              Description\n+========================================== ==============================================================\n+``mongodb.seeds``                          List of all MongoDB servers", "state": "SUBMITTED", "replyTo": null, "originalCommit": null, "originalPosition": 25}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxODk0Mjc1Nw==", "bodyText": "How expensive is this? how often is it called during planing of a query?\n(in JDBC we have caching for this, so question, if we need one here)", "url": "https://github.com/trinodb/trino/pull/3453#discussion_r418942757", "createdAt": "2020-05-02T10:42:35Z", "author": {"login": "findepi"}, "path": "presto-mongodb/src/main/java/io/prestosql/plugin/mongodb/MongoSession.java", "diffHunk": "@@ -606,6 +611,32 @@ else if (value instanceof Document) {\n         return Optional.ofNullable(typeSignature);\n     }\n \n+    private String toRemoteSchemaName(String schemaName)\n+    {\n+        if (!caseInsensitiveNameMatching) {\n+            return schemaName;\n+        }\n+        for (String remoteSchemaName : client.listDatabaseNames()) {\n+            if (schemaName.equals(remoteSchemaName.toLowerCase(ENGLISH))) {\n+                return remoteSchemaName;", "state": "SUBMITTED", "replyTo": null, "originalCommit": null, "originalPosition": 111}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxODk0Mjg0Mw==", "bodyText": "How expensive is this? how often is it called during planing of a query?\n(in JDBC we have caching for this, so question, if we need one here)", "url": "https://github.com/trinodb/trino/pull/3453#discussion_r418942843", "createdAt": "2020-05-02T10:43:33Z", "author": {"login": "findepi"}, "path": "presto-mongodb/src/main/java/io/prestosql/plugin/mongodb/MongoSession.java", "diffHunk": "@@ -606,6 +611,32 @@ else if (value instanceof Document) {\n         return Optional.ofNullable(typeSignature);\n     }\n \n+    private String toRemoteSchemaName(String schemaName)\n+    {\n+        if (!caseInsensitiveNameMatching) {\n+            return schemaName;\n+        }\n+        for (String remoteSchemaName : client.listDatabaseNames()) {\n+            if (schemaName.equals(remoteSchemaName.toLowerCase(ENGLISH))) {\n+                return remoteSchemaName;\n+            }\n+        }\n+        return schemaName;\n+    }\n+\n+    private String toRemoteTableName(String schemaName, String tableName)\n+    {\n+        if (!caseInsensitiveNameMatching) {\n+            return tableName;\n+        }\n+        for (String remoteTableName : client.getDatabase(schemaName).listCollectionNames()) {\n+            if (tableName.equals(remoteTableName.toLowerCase(ENGLISH))) {\n+                return remoteTableName;", "state": "SUBMITTED", "replyTo": null, "originalCommit": null, "originalPosition": 124}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "09675b90fc81be835b0ee0369c25ad8326069232", "author": {"user": {"login": "ebyhr", "name": "Yuya Ebihara"}}, "url": "https://github.com/trinodb/trino/commit/09675b90fc81be835b0ee0369c25ad8326069232", "committedDate": "2020-05-02T14:34:53Z", "message": "Make table wider in MongoDB document"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": null, "afterCommit": null}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDA0ODUyMTA3", "url": "https://github.com/trinodb/trino/pull/3453#pullrequestreview-404852107", "createdAt": "2020-05-04T10:00:37Z", "commit": null, "state": "APPROVED", "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wNFQxMDowMDozN1rOGP53CQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wNFQxMDowMzoxNFrOGP579g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxOTMyOTgwMQ==", "bodyText": "ImmutableList.copyOf is redundant", "url": "https://github.com/trinodb/trino/pull/3453#discussion_r419329801", "createdAt": "2020-05-04T10:00:37Z", "author": {"login": "findepi"}, "path": "presto-mongodb/src/main/java/io/prestosql/plugin/mongodb/MongoSession.java", "diffHunk": "@@ -141,15 +144,18 @@ public void shutdown()\n \n     public List<String> getAllSchemas()\n     {\n-        return ImmutableList.copyOf(client.listDatabaseNames());\n+        return ImmutableList.copyOf(client.listDatabaseNames()).stream()", "state": "SUBMITTED", "replyTo": null, "originalCommit": null, "originalPosition": 29}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxOTMzMDkxNQ==", "bodyText": "add\nverify(schemaName.equals(schemaName.toLowerCase(ENGLISH)), \"schemaName not in lower-case: %s\", schemaName);\n\nat the top of the method", "url": "https://github.com/trinodb/trino/pull/3453#discussion_r419330915", "createdAt": "2020-05-04T10:02:57Z", "author": {"login": "findepi"}, "path": "presto-mongodb/src/main/java/io/prestosql/plugin/mongodb/MongoSession.java", "diffHunk": "@@ -606,6 +611,32 @@ else if (value instanceof Document) {\n         return Optional.ofNullable(typeSignature);\n     }\n \n+    private String toRemoteSchemaName(String schemaName)\n+    {\n+        if (!caseInsensitiveNameMatching) {\n+            return schemaName;\n+        }\n+        for (String remoteSchemaName : client.listDatabaseNames()) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": null, "originalPosition": 109}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxOTMzMTA2Mg==", "bodyText": "same in the table mapping method", "url": "https://github.com/trinodb/trino/pull/3453#discussion_r419331062", "createdAt": "2020-05-04T10:03:14Z", "author": {"login": "findepi"}, "path": "presto-mongodb/src/main/java/io/prestosql/plugin/mongodb/MongoSession.java", "diffHunk": "@@ -606,6 +611,32 @@ else if (value instanceof Document) {\n         return Optional.ofNullable(typeSignature);\n     }\n \n+    private String toRemoteSchemaName(String schemaName)\n+    {\n+        if (!caseInsensitiveNameMatching) {\n+            return schemaName;\n+        }\n+        for (String remoteSchemaName : client.listDatabaseNames()) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxOTMzMDkxNQ=="}, "originalCommit": null, "originalPosition": 109}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": null, "afterCommit": null}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": null, "afterCommit": null}, {"__typename": "PullRequestCommit", "commit": {"oid": "b0cd70ae37f8836c15296232721744c055f34535", "author": {"user": {"login": "ebyhr", "name": "Yuya Ebihara"}}, "url": "https://github.com/trinodb/trino/commit/b0cd70ae37f8836c15296232721744c055f34535", "committedDate": "2020-05-05T09:18:52Z", "message": "Support case insensitive identifiers in MongoDB"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": null, "afterCommit": {"oid": "b0cd70ae37f8836c15296232721744c055f34535", "author": {"user": {"login": "ebyhr", "name": "Yuya Ebihara"}}, "url": "https://github.com/trinodb/trino/commit/b0cd70ae37f8836c15296232721744c055f34535", "committedDate": "2020-05-05T09:18:52Z", "message": "Support case insensitive identifiers in MongoDB"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1549, "cost": 1, "resetAt": "2021-10-28T19:08:13Z"}}}