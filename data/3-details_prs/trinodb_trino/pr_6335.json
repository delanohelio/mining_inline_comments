{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTM5NDU0OTc5", "number": 6335, "title": "Use node reference comparison to dermine if table is delete target", "bodyText": "", "createdAt": "2020-12-14T13:32:32Z", "url": "https://github.com/trinodb/trino/pull/6335", "merged": true, "mergeCommit": {"oid": "b51b6da507927f04b8e61d49fd537a68b60042fc"}, "closed": true, "closedAt": "2020-12-14T21:41:47Z", "author": {"login": "losipiuk"}, "timelineItems": {"totalCount": 6, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdmHPDUAFqTU1MTQ2MzYyMQ==", "endCursor": "Y3Vyc29yOnYyOpPPAAABdmMPtxgFqTU1MTg4OTg4Mg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTUxNDYzNjIx", "url": "https://github.com/trinodb/trino/pull/6335#pullrequestreview-551463621", "createdAt": "2020-12-14T15:12:08Z", "commit": null, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xNFQxNToxMjowOFrOIFVKLQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xNFQxNToxMjowOFrOIFVKLQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MjQ2MDQ2MQ==", "bodyText": "the target should be set at this point and should contain a table, so\nreturn \"DELETE\".equals(updateType) &&\n  target.orElseThrow(...)\n     .getTable().orElseThrow(...) == table; // intentional comparison by reference", "url": "https://github.com/trinodb/trino/pull/6335#discussion_r542460461", "createdAt": "2020-12-14T15:12:08Z", "author": {"login": "findepi"}, "path": "presto-main/src/main/java/io/prestosql/sql/analyzer/Analysis.java", "diffHunk": "@@ -222,8 +224,8 @@ public void resetUpdateType()\n \n     public boolean isDeleteTarget(Table table)\n     {\n-        QualifiedObjectName name = tables.get(NodeRef.of(table)).getName();\n-        return \"DELETE\".equals(updateType) && Optional.of(name).equals(target);\n+        NodeRef<Table> tableRef = NodeRef.of(table);\n+        return \"DELETE\".equals(updateType) && Optional.of(tableRef).equals(target.flatMap(UpdateTarget::getTable));", "state": "SUBMITTED", "replyTo": null, "originalCommit": null, "originalPosition": 37}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTUxNDY0NTI3", "url": "https://github.com/trinodb/trino/pull/6335#pullrequestreview-551464527", "createdAt": "2020-12-14T15:13:04Z", "commit": null, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTUxNDc0MzU3", "url": "https://github.com/trinodb/trino/pull/6335#pullrequestreview-551474357", "createdAt": "2020-12-14T15:22:41Z", "commit": null, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c4ffd880aa38d4235d1622b4d4686ce3230415f6", "author": {"user": {"login": "losipiuk", "name": "\u0141ukasz Osipiuk"}}, "url": "https://github.com/trinodb/trino/commit/c4ffd880aa38d4235d1622b4d4686ce3230415f6", "committedDate": "2020-12-14T17:29:09Z", "message": "Use node reference comparison to dermine if table is delete target"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": null, "afterCommit": {"oid": "c4ffd880aa38d4235d1622b4d4686ce3230415f6", "author": {"user": {"login": "losipiuk", "name": "\u0141ukasz Osipiuk"}}, "url": "https://github.com/trinodb/trino/commit/c4ffd880aa38d4235d1622b4d4686ce3230415f6", "committedDate": "2020-12-14T17:29:09Z", "message": "Use node reference comparison to dermine if table is delete target"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTUxODg5ODgy", "url": "https://github.com/trinodb/trino/pull/6335#pullrequestreview-551889882", "createdAt": "2020-12-14T21:02:23Z", "commit": {"oid": "c4ffd880aa38d4235d1622b4d4686ce3230415f6"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1827, "cost": 1, "resetAt": "2021-10-28T20:13:43Z"}}}