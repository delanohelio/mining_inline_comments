{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDY4MTgyNTIw", "number": 4839, "reviewThreads": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xOFQxOTozNjo1MlrOEZn_lw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xOVQwMDo1MTo0OFrOEZtanw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjk1MzA1MTExOnYy", "diffSide": "RIGHT", "path": "docker/container-test.sh", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xOFQxOTozNjo1MlrOHCjGkQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xOFQyMzo1NjoxNFrOHCqmBQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MjQzNDMyMQ==", "bodyText": "Do we need to override the entry point? It seems like running the command directly works:\ndocker run --rm \"${CONTAINER_NAME}\" /bin/bash -c '$JAVA_HOME/bin/java -version' &> /dev/null\n\nIf we use ' instead of \" we don't need to escape the $ in the argument.", "url": "https://github.com/trinodb/trino/pull/4839#discussion_r472434321", "createdAt": "2020-08-18T19:36:52Z", "author": {"login": "electrum"}, "path": "docker/container-test.sh", "diffHunk": "@@ -33,3 +33,10 @@ function test_container {\n     # Return proper exit code.\n     [[ ${RESULT} == '\"success\"' ]]\n }\n+\n+function test_javahome {\n+    # Check if JAVA_HOME works\n+    docker run --rm --entrypoint /bin/bash \"${CONTAINER_NAME}\" -c \"\\$JAVA_HOME/bin/java -version\" &> /dev/null", "state": "SUBMITTED", "replyTo": null, "originalCommit": null, "originalPosition": 7}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MjU1NzA2MQ==", "bodyText": "no need to override the entrypoint since I saw it uses CMD instruction only in Dockerfile.", "url": "https://github.com/trinodb/trino/pull/4839#discussion_r472557061", "createdAt": "2020-08-18T23:56:14Z", "author": {"login": "shawnzhu"}, "path": "docker/container-test.sh", "diffHunk": "@@ -33,3 +33,10 @@ function test_container {\n     # Return proper exit code.\n     [[ ${RESULT} == '\"success\"' ]]\n }\n+\n+function test_javahome {\n+    # Check if JAVA_HOME works\n+    docker run --rm --entrypoint /bin/bash \"${CONTAINER_NAME}\" -c \"\\$JAVA_HOME/bin/java -version\" &> /dev/null", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MjQzNDMyMQ=="}, "originalCommit": null, "originalPosition": 7}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjk1MzA1NjE5OnYy", "diffSide": "RIGHT", "path": "docker/container-test.sh", "isResolved": true, "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xOFQxOTozODoyNVrOHCjJsw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xOFQyMTo0ODozM1rOHCn4bQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MjQzNTEyMw==", "bodyText": "This needs to be called from the two build-* scripts. Alternatively, is it possible to integrate this into the above test_container method so all the tests are in one function?", "url": "https://github.com/trinodb/trino/pull/4839#discussion_r472435123", "createdAt": "2020-08-18T19:38:25Z", "author": {"login": "electrum"}, "path": "docker/container-test.sh", "diffHunk": "@@ -33,3 +33,10 @@ function test_container {\n     # Return proper exit code.\n     [[ ${RESULT} == '\"success\"' ]]\n }\n+\n+function test_javahome {", "state": "SUBMITTED", "replyTo": null, "originalCommit": null, "originalPosition": 5}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MjQ1Mjg2Nw==", "bodyText": "it can certainly be included into the function test_container(). I usually put one test case per function.", "url": "https://github.com/trinodb/trino/pull/4839#discussion_r472452867", "createdAt": "2020-08-18T20:08:42Z", "author": {"login": "shawnzhu"}, "path": "docker/container-test.sh", "diffHunk": "@@ -33,3 +33,10 @@ function test_container {\n     # Return proper exit code.\n     [[ ${RESULT} == '\"success\"' ]]\n }\n+\n+function test_javahome {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MjQzNTEyMw=="}, "originalCommit": null, "originalPosition": 5}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MjUxMjYyMQ==", "bodyText": "We could rename test_container to test_presto_starts, then create a new one that runs all the tests\nfunction test_container {\n    test_javahome && test_presto_starts\n}", "url": "https://github.com/trinodb/trino/pull/4839#discussion_r472512621", "createdAt": "2020-08-18T21:48:33Z", "author": {"login": "electrum"}, "path": "docker/container-test.sh", "diffHunk": "@@ -33,3 +33,10 @@ function test_container {\n     # Return proper exit code.\n     [[ ${RESULT} == '\"success\"' ]]\n }\n+\n+function test_javahome {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MjQzNTEyMw=="}, "originalCommit": null, "originalPosition": 5}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjk1MzkzOTUxOnYy", "diffSide": "RIGHT", "path": "docker/container-test.sh", "isResolved": true, "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xOVQwMDo1MTo0OFrOHCriIA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xOVQxNDozNDoyOVrOHDKXKA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MjU3MjQ0OA==", "bodyText": "The variable is CONTAINER_ID", "url": "https://github.com/trinodb/trino/pull/4839#discussion_r472572448", "createdAt": "2020-08-19T00:51:48Z", "author": {"login": "electrum"}, "path": "docker/container-test.sh", "diffHunk": "@@ -33,3 +33,14 @@ function test_container {\n     # Return proper exit code.\n     [[ ${RESULT} == '\"success\"' ]]\n }\n+\n+function test_javahome {\n+    # Check if JAVA_HOME works\n+    docker run --rm \"${CONTAINER_NAME}\" /bin/bash -c '$JAVA_HOME/bin/java -version' &> /dev/null", "state": "SUBMITTED", "replyTo": null, "originalCommit": null, "originalPosition": 16}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MzA2MDEzNQ==", "bodyText": "the container instance with $CONTAINER_ID will be stopped right before test_presto_starts() is executed. this command here is creating a new container and remove it immediately after docker command execution.\nIf you suggest running two tests test_javahome and test_presto_starts within a single container instance, I can refactor it later.", "url": "https://github.com/trinodb/trino/pull/4839#discussion_r473060135", "createdAt": "2020-08-19T14:11:53Z", "author": {"login": "shawnzhu"}, "path": "docker/container-test.sh", "diffHunk": "@@ -33,3 +33,14 @@ function test_container {\n     # Return proper exit code.\n     [[ ${RESULT} == '\"success\"' ]]\n }\n+\n+function test_javahome {\n+    # Check if JAVA_HOME works\n+    docker run --rm \"${CONTAINER_NAME}\" /bin/bash -c '$JAVA_HOME/bin/java -version' &> /dev/null", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MjU3MjQ0OA=="}, "originalCommit": null, "originalPosition": 16}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MzA3NzU0NA==", "bodyText": "Sorry, I saw an error that the variable wasn\u2019t set and got it mixed up. Your fix is correct.", "url": "https://github.com/trinodb/trino/pull/4839#discussion_r473077544", "createdAt": "2020-08-19T14:34:29Z", "author": {"login": "electrum"}, "path": "docker/container-test.sh", "diffHunk": "@@ -33,3 +33,14 @@ function test_container {\n     # Return proper exit code.\n     [[ ${RESULT} == '\"success\"' ]]\n }\n+\n+function test_javahome {\n+    # Check if JAVA_HOME works\n+    docker run --rm \"${CONTAINER_NAME}\" /bin/bash -c '$JAVA_HOME/bin/java -version' &> /dev/null", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MjU3MjQ0OA=="}, "originalCommit": null, "originalPosition": 16}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3464, "cost": 1, "resetAt": "2021-11-12T12:57:47Z"}}}