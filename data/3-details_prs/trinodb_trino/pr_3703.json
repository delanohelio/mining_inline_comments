{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDE2NDM4OTkz", "number": 3703, "title": "Build server for Java 11", "bodyText": "", "createdAt": "2020-05-12T01:56:36Z", "url": "https://github.com/trinodb/trino/pull/3703", "merged": true, "mergeCommit": {"oid": "e7eeeedcc9751c022ffb9df648ee5442cd421c32"}, "closed": true, "closedAt": "2020-05-14T20:12:02Z", "author": {"login": "electrum"}, "timelineItems": {"totalCount": 18, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcgh1E7AFqTQwOTkxMjkxMg==", "endCursor": "Y3Vyc29yOnYyOpPPAAABchR8psgBqjMzMzc5MzM4NzA=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDA5OTEyOTEy", "url": "https://github.com/trinodb/trino/pull/3703#pullrequestreview-409912912", "createdAt": "2020-05-12T10:36:29Z", "commit": null, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xMlQxMDozNjoyOVrOGUAiAw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xMlQxMDozNjoyOVrOGUAiAw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMzYzMzQxMQ==", "bodyText": "Let's run this in a separate PR to get feedback (if any) on this.", "url": "https://github.com/trinodb/trino/pull/3703#discussion_r423633411", "createdAt": "2020-05-12T10:36:29Z", "author": {"login": "findepi"}, "path": "presto-main/src/main/java/io/prestosql/server/ServerConfig.java", "diffHunk": "@@ -16,14 +16,11 @@\n import io.airlift.configuration.Config;\n import io.airlift.units.Duration;\n \n-import javax.validation.constraints.NotNull;\n-\n import static java.util.concurrent.TimeUnit.MINUTES;\n \n public class ServerConfig\n {\n     private boolean coordinator = true;\n-    private String prestoVersion = getClass().getPackage().getImplementationVersion();", "state": "SUBMITTED", "replyTo": null, "originalCommit": null, "originalPosition": 11}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDA5OTE1MDg4", "url": "https://github.com/trinodb/trino/pull/3703#pullrequestreview-409915088", "createdAt": "2020-05-12T10:39:48Z", "commit": null, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xMlQxMDozOTo0OFrOGUAoyw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xMlQxMDozOTo0OFrOGUAoyw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMzYzNTE0Nw==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                    Class<?> generatedClass = createClass(format(\"Presto_%s_\", version));\n          \n          \n            \n                    Class<?> generatedClass = createClass(format(\"Presto_%s___\", version));\n          \n      \n    \n    \n  \n\n-- that was intentional, to visually separate version string (which may be short or longer) from the timestamp digits unconditionally appended to the class name later on.", "url": "https://github.com/trinodb/trino/pull/3703#discussion_r423635147", "createdAt": "2020-05-12T10:39:48Z", "author": {"login": "findepi"}, "path": "presto-main/src/main/java/io/prestosql/version/EmbedVersion.java", "diffHunk": "@@ -47,18 +46,23 @@\n     private final MethodHandle callableConstructor;\n \n     @Inject\n-    public EmbedVersion(ServerConfig serverConfig)\n+    public EmbedVersion(NodeVersion version)\n     {\n-        Class<?> generatedClass = createClass(serverConfig);\n+        this(version.getVersion());\n+    }\n+\n+    public EmbedVersion(String version)\n+    {\n+        Class<?> generatedClass = createClass(format(\"Presto_%s_\", version));", "state": "SUBMITTED", "replyTo": null, "originalCommit": null, "originalPosition": 28}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDA5OTE2MDM2", "url": "https://github.com/trinodb/trino/pull/3703#pullrequestreview-409916036", "createdAt": "2020-05-12T10:41:09Z", "commit": null, "state": "COMMENTED", "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xMlQxMDo0MTowOVrOGUArrQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xMlQxMDo0NTo0NVrOGUA1fg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMzYzNTg4NQ==", "bodyText": "remove redundant braces", "url": "https://github.com/trinodb/trino/pull/3703#discussion_r423635885", "createdAt": "2020-05-12T10:41:09Z", "author": {"login": "findepi"}, "path": "presto-server-main/src/main/java/io/prestosql/server/PrestoServer.java", "diffHunk": "@@ -0,0 +1,36 @@\n+/*\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+package io.prestosql.server;\n+\n+import com.google.common.base.StandardSystemProperty;\n+import com.google.common.primitives.Ints;\n+\n+import static com.google.common.base.MoreObjects.firstNonNull;\n+import static java.lang.String.format;\n+\n+public final class PrestoServer\n+{\n+    public static void main(String[] args)\n+    {\n+        String javaVersion = firstNonNull(StandardSystemProperty.JAVA_VERSION.value(), \"null\");\n+        Integer major = Ints.tryParse(javaVersion);\n+        if ((major == null) || (major < 11)) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": null, "originalPosition": 28}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMzYzNjE3Mg==", "bodyText": "revert the rename, this is going to be annoyance for developers within the community (all the saved launch configurations...)\ncall the new class simply Main", "url": "https://github.com/trinodb/trino/pull/3703#discussion_r423636172", "createdAt": "2020-05-12T10:41:43Z", "author": {"login": "findepi"}, "path": "README.md", "diffHunk": "@@ -39,7 +39,7 @@ After opening the project in IntelliJ, double check that the Java SDK is properl\n \n Presto comes with sample configuration that should work out-of-the-box for development. Use the following options to create a run configuration:\n \n-* Main Class: `io.prestosql.server.PrestoServer`\n+* Main Class: `io.prestosql.server.Server`", "state": "SUBMITTED", "replyTo": null, "originalCommit": null, "originalPosition": 5}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMzYzODM5OA==", "bodyText": "add some summary of changes (and purpose) to the Run PrestoServer main on Java 8 for version check commit, or split it up, as the purpose is hard to infer from the diff.", "url": "https://github.com/trinodb/trino/pull/3703#discussion_r423638398", "createdAt": "2020-05-12T10:45:45Z", "author": {"login": "findepi"}, "path": "README.md", "diffHunk": "@@ -39,7 +39,7 @@ After opening the project in IntelliJ, double check that the Java SDK is properl\n \n Presto comes with sample configuration that should work out-of-the-box for development. Use the following options to create a run configuration:\n \n-* Main Class: `io.prestosql.server.PrestoServer`\n+* Main Class: `io.prestosql.server.Server`", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMzYzNjE3Mg=="}, "originalCommit": null, "originalPosition": 5}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": null, "afterCommit": null}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": null, "afterCommit": null}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": null, "afterCommit": null}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": null, "afterCommit": null}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDEwNzA4MjU4", "url": "https://github.com/trinodb/trino/pull/3703#pullrequestreview-410708258", "createdAt": "2020-05-13T08:37:43Z", "commit": null, "state": "APPROVED", "comments": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xM1QwODozNzo0M1rOGUnTpQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xM1QwODo0NTowOVrOGUnmxA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNDI2ODcwOQ==", "bodyText": "Build server for Java 11\n\nMaybe add to cmt msg some hint that requiring Java 11+ for compilation (of every module) is conscious choice.", "url": "https://github.com/trinodb/trino/pull/3703#discussion_r424268709", "createdAt": "2020-05-13T08:37:43Z", "author": {"login": "findepi"}, "path": "pom.xml", "diffHunk": "@@ -5,7 +5,7 @@\n     <parent>\n         <groupId>io.airlift</groupId>\n         <artifactId>airbase</artifactId>\n-        <version>100</version>\n+        <version>101</version>", "state": "SUBMITTED", "replyTo": null, "originalCommit": null, "originalPosition": 5}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNDI2OTYzMg==", "bodyText": "needed?", "url": "https://github.com/trinodb/trino/pull/3703#discussion_r424269632", "createdAt": "2020-05-13T08:39:10Z", "author": {"login": "findepi"}, "path": "presto-server-main/pom.xml", "diffHunk": "@@ -0,0 +1,31 @@\n+<?xml version=\"1.0\" encoding=\"UTF-8\"?>\n+<project xmlns=\"http://maven.apache.org/POM/4.0.0\" xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\" xsi:schemaLocation=\"http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd\">\n+    <modelVersion>4.0.0</modelVersion>\n+\n+    <parent>\n+        <groupId>io.prestosql</groupId>\n+        <artifactId>presto-root</artifactId>\n+        <version>334-SNAPSHOT</version>\n+    </parent>\n+\n+    <artifactId>presto-server-main</artifactId>\n+    <name>presto-server-main</name>\n+\n+    <properties>\n+        <air.main.basedir>${project.parent.basedir}</air.main.basedir>\n+        <air.check.skip-enforcer>true</air.check.skip-enforcer>", "state": "SUBMITTED", "replyTo": null, "originalCommit": null, "originalPosition": 16}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNDI3MDU1Ng==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                    String javaVersion = firstNonNull(StandardSystemProperty.JAVA_VERSION.value(), \"null\");\n          \n          \n            \n                    String javaVersion = Strings.nullToEmpty(StandardSystemProperty.JAVA_VERSION.value());", "url": "https://github.com/trinodb/trino/pull/3703#discussion_r424270556", "createdAt": "2020-05-13T08:40:36Z", "author": {"login": "findepi"}, "path": "presto-server-main/src/main/java/io/prestosql/server/PrestoServer.java", "diffHunk": "@@ -0,0 +1,38 @@\n+/*\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+package io.prestosql.server;\n+\n+import com.google.common.base.StandardSystemProperty;\n+import com.google.common.primitives.Ints;\n+\n+import static com.google.common.base.MoreObjects.firstNonNull;\n+import static java.lang.String.format;\n+\n+public final class PrestoServer\n+{\n+    private PrestoServer() {}\n+\n+    public static void main(String[] args)\n+    {\n+        String javaVersion = firstNonNull(StandardSystemProperty.JAVA_VERSION.value(), \"null\");", "state": "SUBMITTED", "replyTo": null, "originalCommit": null, "originalPosition": 28}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNDI3MjAyNQ==", "bodyText": "Can the sys prop return sth like 11.0.3?\n(then we would get null here)", "url": "https://github.com/trinodb/trino/pull/3703#discussion_r424272025", "createdAt": "2020-05-13T08:42:46Z", "author": {"login": "findepi"}, "path": "presto-server-main/src/main/java/io/prestosql/server/PrestoServer.java", "diffHunk": "@@ -0,0 +1,38 @@\n+/*\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+package io.prestosql.server;\n+\n+import com.google.common.base.StandardSystemProperty;\n+import com.google.common.primitives.Ints;\n+\n+import static com.google.common.base.MoreObjects.firstNonNull;\n+import static java.lang.String.format;\n+\n+public final class PrestoServer\n+{\n+    private PrestoServer() {}\n+\n+    public static void main(String[] args)\n+    {\n+        String javaVersion = firstNonNull(StandardSystemProperty.JAVA_VERSION.value(), \"null\");\n+        Integer major = Ints.tryParse(javaVersion);", "state": "SUBMITTED", "replyTo": null, "originalCommit": null, "originalPosition": 29}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNDI3MzYwNA==", "bodyText": "Add a comment that this main method is for developers' only.\nIn fact, maybe we remove this method at all?\nWe could change README -- instead of changing the class name, you could change the module name to use the new module.", "url": "https://github.com/trinodb/trino/pull/3703#discussion_r424273604", "createdAt": "2020-05-13T08:45:09Z", "author": {"login": "findepi"}, "path": "presto-main/src/main/java/io/prestosql/server/Server.java", "diffHunk": "@@ -55,20 +55,18 @@\n import java.nio.file.Paths;\n import java.util.Set;\n \n-import static com.google.common.base.MoreObjects.firstNonNull;\n import static com.google.common.collect.ImmutableSet.toImmutableSet;\n import static io.airlift.discovery.client.ServiceAnnouncement.ServiceAnnouncementBuilder;\n import static io.airlift.discovery.client.ServiceAnnouncement.serviceAnnouncement;\n import static io.prestosql.server.PrestoSystemRequirements.verifyJvmRequirements;\n import static io.prestosql.server.PrestoSystemRequirements.verifySystemTimeIsReasonable;\n import static java.nio.file.LinkOption.NOFOLLOW_LINKS;\n \n-public class PrestoServer\n+public class Server\n {\n     public static void main(String[] args)\n     {\n-        String version = PrestoServer.class.getPackage().getImplementationVersion();\n-        new PrestoServer().start(firstNonNull(version, \"unknown\"));\n+        new Server().start(\"testversion\");", "state": "SUBMITTED", "replyTo": null, "originalCommit": null, "originalPosition": 19}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": null, "afterCommit": null}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": null, "afterCommit": null}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": null, "afterCommit": null}, {"__typename": "PullRequestCommit", "commit": {"oid": "892eeb9b69f54f26f0eb52b6826fc2af74524819", "author": {"user": {"login": "electrum", "name": "David Phillips"}}, "url": "https://github.com/trinodb/trino/commit/892eeb9b69f54f26f0eb52b6826fc2af74524819", "committedDate": "2020-05-14T00:05:51Z", "message": "Update TestJmxHistoricalData for newer Java versions"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": null, "afterCommit": null}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": null, "afterCommit": null}, {"__typename": "PullRequestCommit", "commit": {"oid": "3bbc3c9eef75948d89d7760fb6d88569130b8a28", "author": {"user": {"login": "electrum", "name": "David Phillips"}}, "url": "https://github.com/trinodb/trino/commit/3bbc3c9eef75948d89d7760fb6d88569130b8a28", "committedDate": "2020-05-14T18:34:31Z", "message": "Build server for Java 11\n\nAll modules, except for CLI, JDBC, and their dependencies, now\nrequire Java 11+ for compilation and can take advantage of such\nlanguage and JDK features."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "005984eece64edb525d08d2147c766e99572f501", "author": {"user": {"login": "electrum", "name": "David Phillips"}}, "url": "https://github.com/trinodb/trino/commit/005984eece64edb525d08d2147c766e99572f501", "committedDate": "2020-05-14T18:34:40Z", "message": "Run PrestoServer main on Java 8 for version check\n\nThis allows failing with a proper error message if run using Java 8\nrather than the JVM failing with \"unsupported class file version\"."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b7bfd1e989fd53ec8243f867db5d7ace4a51bd82", "author": {"user": {"login": "electrum", "name": "David Phillips"}}, "url": "https://github.com/trinodb/trino/commit/b7bfd1e989fd53ec8243f867db5d7ace4a51bd82", "committedDate": "2020-05-14T18:34:40Z", "message": "Replace JavaVersion with JDK API"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": null, "afterCommit": {"oid": "b7bfd1e989fd53ec8243f867db5d7ace4a51bd82", "author": {"user": {"login": "electrum", "name": "David Phillips"}}, "url": "https://github.com/trinodb/trino/commit/b7bfd1e989fd53ec8243f867db5d7ace4a51bd82", "committedDate": "2020-05-14T18:34:40Z", "message": "Replace JavaVersion with JDK API"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1476, "cost": 1, "resetAt": "2021-10-28T19:08:13Z"}}}