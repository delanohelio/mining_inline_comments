{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDM3OTUyMDcz", "number": 4143, "title": "Extend null_format support to Rctext and Sequencefile formats", "bodyText": "", "createdAt": "2020-06-22T13:41:39Z", "url": "https://github.com/trinodb/trino/pull/4143", "merged": true, "mergeCommit": {"oid": "1c5b4a7d787f5491d77c76039916d29ea2dd3f02"}, "closed": true, "closedAt": "2020-06-24T08:52:08Z", "author": {"login": "jirassimok"}, "timelineItems": {"totalCount": 8, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABctxGOGgBqjM0Njg0Mzc1NDk=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcuNcvAgBqjM0NzUwODk4ODY=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "HeadRefForcePushedEvent", "beforeCommit": null, "afterCommit": null}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDM1MjIxNzgx", "url": "https://github.com/trinodb/trino/pull/4143#pullrequestreview-435221781", "createdAt": "2020-06-22T19:44:33Z", "commit": null, "state": "COMMENTED", "comments": {"totalCount": 6, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yMlQxOTo0NDozM1rOGnOh1g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yMlQxOTo1OTo1N1rOGnO-Ew==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0Mzc4NTY4Ng==", "bodyText": "wrap on each comma or keep it single line.", "url": "https://github.com/trinodb/trino/pull/4143#discussion_r443785686", "createdAt": "2020-06-22T19:44:33Z", "author": {"login": "losipiuk"}, "path": "presto-product-tests/src/main/java/io/prestosql/tests/hive/TestHiveStorageFormats.java", "diffHunk": "@@ -299,12 +299,13 @@ private static StorageFormat storageFormat(String name)\n \n     private static StorageFormat storageFormat(String name, Map<String, String> sessionProperties)\n     {\n-        return new StorageFormat(name, ImmutableMap.of(), sessionProperties);\n+        return new StorageFormat(name, sessionProperties, ImmutableMap.of());\n     }\n \n-    private static StorageFormat storageFormat(String name, Map<String, String> properties, Map<String, String> sessionProperties)\n+    private static StorageFormat storageFormat(\n+            String name, Map<String, String> sessionProperties, Map<String, String> properties)", "state": "SUBMITTED", "replyTo": null, "originalCommit": null, "originalPosition": 19}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0Mzc4NTczNg==", "bodyText": "wrap on each comma or keep it single line.", "url": "https://github.com/trinodb/trino/pull/4143#discussion_r443785736", "createdAt": "2020-06-22T19:44:41Z", "author": {"login": "losipiuk"}, "path": "presto-product-tests/src/main/java/io/prestosql/tests/hive/TestHiveStorageFormats.java", "diffHunk": "@@ -313,7 +314,8 @@ private static StorageFormat storageFormat(String name, Map<String, String> prop\n         private final Map<String, String> properties;\n         private final Map<String, String> sessionProperties;\n \n-        private StorageFormat(String name, Map<String, String> properties, Map<String, String> sessionProperties)\n+        private StorageFormat(\n+                String name, Map<String, String> sessionProperties, Map<String, String> properties)", "state": "SUBMITTED", "replyTo": null, "originalCommit": null, "originalPosition": 32}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0Mzc5MTU3Ng==", "bodyText": "interesting. I though it would be escaped :)", "url": "https://github.com/trinodb/trino/pull/4143#discussion_r443791576", "createdAt": "2020-06-22T19:57:15Z", "author": {"login": "losipiuk"}, "path": "presto-product-tests/src/main/java/io/prestosql/tests/hive/TestHiveStorageFormats.java", "diffHunk": "@@ -185,6 +200,37 @@ public void testInsertIntoPartitionedTable(StorageFormat storageFormat)\n         query(format(\"DROP TABLE %s\", tableName));\n     }\n \n+    @Test(dataProvider = \"storage_formats_with_null_format\", groups = STORAGE_FORMATS)\n+    public void testInsertIntoTableWithNullFormat(StorageFormat storageFormat)\n+    {\n+        String tableName = format(\"storage_format_%s_with_null_format\", storageFormat.getName());\n+        String nullFormat = \"null_value\";\n+\n+        query(format(\"CREATE TABLE %s (name VARCHAR) \" +\n+                        \"WITH (format = '%s', null_format = '%s')\",\n+                tableName,\n+                storageFormat.getName(),\n+                nullFormat));\n+\n+        // \\N is the default null format\n+        String[] values = new String[] {nullFormat, null, \"non-null\", \"\", \"\\\\N\"};\n+\n+        Row[] storedValues = Arrays.stream(values).map(Row::row).toArray(Row[]::new);\n+        // If you try to put the null format in a table, it will come out as null.", "state": "SUBMITTED", "replyTo": null, "originalCommit": null, "originalPosition": 64}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0Mzc5MjAxNw==", "bodyText": "put this one in finally", "url": "https://github.com/trinodb/trino/pull/4143#discussion_r443792017", "createdAt": "2020-06-22T19:58:05Z", "author": {"login": "losipiuk"}, "path": "presto-product-tests/src/main/java/io/prestosql/tests/hive/TestHiveStorageFormats.java", "diffHunk": "@@ -185,6 +200,37 @@ public void testInsertIntoPartitionedTable(StorageFormat storageFormat)\n         query(format(\"DROP TABLE %s\", tableName));\n     }\n \n+    @Test(dataProvider = \"storage_formats_with_null_format\", groups = STORAGE_FORMATS)\n+    public void testInsertIntoTableWithNullFormat(StorageFormat storageFormat)\n+    {\n+        String tableName = format(\"storage_format_%s_with_null_format\", storageFormat.getName());\n+        String nullFormat = \"null_value\";\n+\n+        query(format(\"CREATE TABLE %s (name VARCHAR) \" +\n+                        \"WITH (format = '%s', null_format = '%s')\",\n+                tableName,\n+                storageFormat.getName(),\n+                nullFormat));\n+\n+        // \\N is the default null format\n+        String[] values = new String[] {nullFormat, null, \"non-null\", \"\", \"\\\\N\"};\n+\n+        Row[] storedValues = Arrays.stream(values).map(Row::row).toArray(Row[]::new);\n+        // If you try to put the null format in a table, it will come out as null.\n+        storedValues[0] = row((Object) null);\n+\n+        String placeholders = String.join(\", \", Collections.nCopies(values.length, \"(?)\"));\n+\n+        query(format(\"INSERT INTO %s VALUES %s\", tableName, placeholders),\n+                Arrays.stream(values)\n+                        .map(value -> param(JDBCType.VARCHAR, value))\n+                        .toArray(QueryParam[]::new));\n+\n+        assertThat(query(format(\"SELECT * FROM %s\", tableName))).containsOnly(storedValues);\n+\n+        onHive().executeQuery(format(\"DROP TABLE %s\", tableName));", "state": "SUBMITTED", "replyTo": null, "originalCommit": null, "originalPosition": 76}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0Mzc5MjU3Ng==", "bodyText": "can you also add another test which inserts using hive (or extend this one)?", "url": "https://github.com/trinodb/trino/pull/4143#discussion_r443792576", "createdAt": "2020-06-22T19:59:16Z", "author": {"login": "losipiuk"}, "path": "presto-product-tests/src/main/java/io/prestosql/tests/hive/TestHiveStorageFormats.java", "diffHunk": "@@ -185,6 +200,37 @@ public void testInsertIntoPartitionedTable(StorageFormat storageFormat)\n         query(format(\"DROP TABLE %s\", tableName));\n     }\n \n+    @Test(dataProvider = \"storage_formats_with_null_format\", groups = STORAGE_FORMATS)\n+    public void testInsertIntoTableWithNullFormat(StorageFormat storageFormat)\n+    {\n+        String tableName = format(\"storage_format_%s_with_null_format\", storageFormat.getName());\n+        String nullFormat = \"null_value\";\n+\n+        query(format(\"CREATE TABLE %s (name VARCHAR) \" +\n+                        \"WITH (format = '%s', null_format = '%s')\",\n+                tableName,\n+                storageFormat.getName(),\n+                nullFormat));\n+\n+        // \\N is the default null format\n+        String[] values = new String[] {nullFormat, null, \"non-null\", \"\", \"\\\\N\"};\n+\n+        Row[] storedValues = Arrays.stream(values).map(Row::row).toArray(Row[]::new);\n+        // If you try to put the null format in a table, it will come out as null.\n+        storedValues[0] = row((Object) null);\n+\n+        String placeholders = String.join(\", \", Collections.nCopies(values.length, \"(?)\"));\n+\n+        query(format(\"INSERT INTO %s VALUES %s\", tableName, placeholders),", "state": "SUBMITTED", "replyTo": null, "originalCommit": null, "originalPosition": 69}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0Mzc5MjkxNQ==", "bodyText": "squash this commit with commit which introduces functionality (Allow null_format for ...)", "url": "https://github.com/trinodb/trino/pull/4143#discussion_r443792915", "createdAt": "2020-06-22T19:59:57Z", "author": {"login": "losipiuk"}, "path": "presto-product-tests/src/main/java/io/prestosql/tests/hive/TestHiveStorageFormats.java", "diffHunk": "@@ -185,6 +200,37 @@ public void testInsertIntoPartitionedTable(StorageFormat storageFormat)\n         query(format(\"DROP TABLE %s\", tableName));\n     }\n \n+    @Test(dataProvider = \"storage_formats_with_null_format\", groups = STORAGE_FORMATS)\n+    public void testInsertIntoTableWithNullFormat(StorageFormat storageFormat)", "state": "SUBMITTED", "replyTo": null, "originalCommit": null, "originalPosition": 49}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d132854f601a591941c5fe85b42cce5b0f904f1a", "author": {"user": {"login": "jirassimok", "name": "Jacob Ilias Komissar"}}, "url": "https://github.com/trinodb/trino/commit/d132854f601a591941c5fe85b42cce5b0f904f1a", "committedDate": "2020-06-23T14:46:15Z", "message": "Change parameter order for declaring storage formats in Hive tests\n\nThis gives the overloads of storageFormat a consistent parameter order."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "76576fe98b0de8cdfc64a3f9053b508d4717c87c", "author": {"user": {"login": "jirassimok", "name": "Jacob Ilias Komissar"}}, "url": "https://github.com/trinodb/trino/commit/76576fe98b0de8cdfc64a3f9053b508d4717c87c", "committedDate": "2020-06-23T14:46:27Z", "message": "Rename TestHiveStorageFormats.assertSelect to be more descriptive\n\nAlso add a brief documentation comment."}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": null, "afterCommit": null}, {"__typename": "PullRequestCommit", "commit": {"oid": "766880f541a75381922afa3b4451079664942b97", "author": {"user": {"login": "jirassimok", "name": "Jacob Ilias Komissar"}}, "url": "https://github.com/trinodb/trino/commit/766880f541a75381922afa3b4451079664942b97", "committedDate": "2020-06-23T22:46:02Z", "message": "Allow null_format for rctext and sequencefile formats"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a64a2ff08e47f8269bb57038f776aa9c9e4e4d46", "author": {"user": {"login": "jirassimok", "name": "Jacob Ilias Komissar"}}, "url": "https://github.com/trinodb/trino/commit/a64a2ff08e47f8269bb57038f776aa9c9e4e4d46", "committedDate": "2020-06-23T22:46:05Z", "message": "Add default null format to Hive integration tests"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": null, "afterCommit": {"oid": "a64a2ff08e47f8269bb57038f776aa9c9e4e4d46", "author": {"user": {"login": "jirassimok", "name": "Jacob Ilias Komissar"}}, "url": "https://github.com/trinodb/trino/commit/a64a2ff08e47f8269bb57038f776aa9c9e4e4d46", "committedDate": "2020-06-23T22:46:05Z", "message": "Add default null format to Hive integration tests"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 487, "cost": 1, "resetAt": "2021-10-28T19:08:13Z"}}}