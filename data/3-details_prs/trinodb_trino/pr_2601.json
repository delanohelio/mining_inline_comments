{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0MzY2NTg4ODU5", "number": 2601, "title": "Add support for money type in PostgreSQL connector", "bodyText": "Previously, money values were mapped as double and reading would fail\nfor values great or equal to one thousand.\nRelates to pgjdbc/pgjdbc#425", "createdAt": "2020-01-23T22:02:51Z", "url": "https://github.com/trinodb/trino/pull/2601", "merged": true, "mergeCommit": {"oid": "ce363b78fd1861ea6e7284cc567f1ac8ccef71d7"}, "closed": true, "closedAt": "2020-01-26T21:56:42Z", "author": {"login": "findepi"}, "timelineItems": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABb9RoHpgH2gAyMzY2NTg4ODU5Ojk3YTZhMDQ3NmYyMGJkOGI3YWIwNDc2MDYzNDEzN2I1MzJiYzk0YmE=", "endCursor": "Y3Vyc29yOnYyOpPPAAABb91ftngBqjI5NzkzNzMxNjY=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "97a6a0476f20bd8b7ab04760634137b532bc94ba", "author": {"user": {"login": "findepi", "name": "Piotr Findeisen"}}, "url": "https://github.com/trinodb/trino/commit/97a6a0476f20bd8b7ab04760634137b532bc94ba", "committedDate": "2020-01-23T21:56:31Z", "message": "Remove unused field"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": null, "afterCommit": null}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzQ4MDI5MzY2", "url": "https://github.com/trinodb/trino/pull/2601#pullrequestreview-348029366", "createdAt": "2020-01-24T15:27:25Z", "commit": null, "state": "APPROVED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yNFQxNToyNzoyNVrOFhhPyQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yNFQxNToyNzoyNVrOFhhPyQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MDY5MjA0MQ==", "bodyText": "Did you consider the following funciton? (It might be misleading though)\ntypedVarcharWriteFunction(\"money\"),", "url": "https://github.com/trinodb/trino/pull/2601#discussion_r370692041", "createdAt": "2020-01-24T15:27:25Z", "author": {"login": "ebyhr"}, "path": "presto-postgresql/src/main/java/io/prestosql/plugin/postgresql/PostgreSqlClient.java", "diffHunk": "@@ -661,6 +663,35 @@ private static SliceWriteFunction typedVarcharWriteFunction(String jdbcTypeName)\n         };\n     }\n \n+    private static ColumnMapping moneyColumnMapping()\n+    {\n+        // Money mapping can be improved when PostgreSQL gains explicit money type support.\n+        // See https://github.com/pgjdbc/pgjdbc/issues/425 for more information.\n+        return ColumnMapping.sliceMapping(\n+                VARCHAR,\n+                new SliceReadFunction()\n+                {\n+                    @Override\n+                    public boolean isNull(ResultSet resultSet, int columnIndex)\n+                            throws SQLException\n+                    {\n+                        // In PostgreSQL JDBC, money is mapped as double.\n+                        // .getObject() calls .getDouble and it fails to parse the money value.\n+                        resultSet.getString(columnIndex);\n+                        return resultSet.wasNull();\n+                    }\n+\n+                    @Override\n+                    public Slice readSlice(ResultSet resultSet, int columnIndex)\n+                            throws SQLException\n+                    {\n+                        return utf8Slice(resultSet.getString(columnIndex));\n+                    }\n+                },\n+                (statement, index, value) -> { throw new PrestoException(NOT_SUPPORTED, \"Money type is not supported for INSERT\"); },", "state": "SUBMITTED", "replyTo": null, "originalCommit": null, "originalPosition": 38}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "27503945b07ec6e8e47252a40303a6a5486db7b4", "author": {"user": {"login": "findepi", "name": "Piotr Findeisen"}}, "url": "https://github.com/trinodb/trino/commit/27503945b07ec6e8e47252a40303a6a5486db7b4", "committedDate": "2020-01-25T15:43:46Z", "message": "Add support for money type in PostgreSQL\n\nPreviously, money values were mapped as double and reading would fail\nfor values great or equal to one thousand."}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": null, "afterCommit": {"oid": "27503945b07ec6e8e47252a40303a6a5486db7b4", "author": {"user": {"login": "findepi", "name": "Piotr Findeisen"}}, "url": "https://github.com/trinodb/trino/commit/27503945b07ec6e8e47252a40303a6a5486db7b4", "committedDate": "2020-01-25T15:43:46Z", "message": "Add support for money type in PostgreSQL\n\nPreviously, money values were mapped as double and reading would fail\nfor values great or equal to one thousand."}}]}}}, "rateLimit": {"limit": 5000, "remaining": 980, "cost": 1, "resetAt": "2021-10-28T19:08:13Z"}}}