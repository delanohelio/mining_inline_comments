{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDc1OTU1NDgx", "number": 5028, "title": "File group provider", "bodyText": "", "createdAt": "2020-08-30T19:52:29Z", "url": "https://github.com/trinodb/trino/pull/5028", "merged": true, "mergeCommit": {"oid": "2fa13052208f32b981248fe4c91a36b6b37f5e2d"}, "closed": true, "closedAt": "2020-09-28T21:29:18Z", "author": {"login": "dain"}, "timelineItems": {"totalCount": 11, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdENvs2AFqTQ3ODM4MDk1OA==", "endCursor": "Y3Vyc29yOnYyOpPPAAABdNIf9cABqjM4MTIxNjM4NTI=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDc4MzgwOTU4", "url": "https://github.com/trinodb/trino/pull/5028#pullrequestreview-478380958", "createdAt": "2020-08-31T07:29:24Z", "commit": null, "state": "COMMENTED", "comments": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0zMVQwNzoyOToyNFrOHJtpCw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0zMVQwNzozMzo0NFrOHJtxkQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3OTk0NzAxOQ==", "bodyText": "txt? We usually use json. I think using json make sense here because:\n\nit is coherent with other file based configuration files\nit is much easier to extend it in future\nthere is less parsing code", "url": "https://github.com/trinodb/trino/pull/5028#discussion_r479947019", "createdAt": "2020-08-31T07:29:24Z", "author": {"login": "kokosing"}, "path": "presto-docs/src/main/sphinx/security/group-file.rst", "diffHunk": "@@ -0,0 +1,42 @@\n+==========\n+Group File\n+==========\n+\n+Presto can map user names onto groups for easier access control and\n+resource group management. Group file resolves group membership using\n+a file on the coordinator.\n+\n+Group File Configuration\n+------------------------\n+\n+Enable group file by creating an ``etc/group-provider.properties``\n+file on the coordinator:\n+\n+.. code-block:: none\n+\n+    group-provider.name=file\n+    file.group-file=/path/to/group.txt", "state": "SUBMITTED", "replyTo": null, "originalCommit": null, "originalPosition": 18}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3OTk0NzQxMg==", "bodyText": "I guess by default it shouldn't refresh, like it is implemented for cases like that.", "url": "https://github.com/trinodb/trino/pull/5028#discussion_r479947412", "createdAt": "2020-08-31T07:30:11Z", "author": {"login": "kokosing"}, "path": "presto-docs/src/main/sphinx/security/group-file.rst", "diffHunk": "@@ -0,0 +1,42 @@\n+==========\n+Group File\n+==========\n+\n+Presto can map user names onto groups for easier access control and\n+resource group management. Group file resolves group membership using\n+a file on the coordinator.\n+\n+Group File Configuration\n+------------------------\n+\n+Enable group file by creating an ``etc/group-provider.properties``\n+file on the coordinator:\n+\n+.. code-block:: none\n+\n+    group-provider.name=file\n+    file.group-file=/path/to/group.txt\n+\n+The following configuration properties are available:\n+\n+==================================== ==============================================\n+Property                             Description\n+==================================== ==============================================\n+``file.group-file``                  Path of the group file.\n+\n+``file.refresh-period``              How often to reload the group file.\n+                                     Defaults to ``1m``.", "state": "SUBMITTED", "replyTo": null, "originalCommit": null, "originalPosition": 28}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3OTk0Nzc1OQ==", "bodyText": "@NotNull", "url": "https://github.com/trinodb/trino/pull/5028#discussion_r479947759", "createdAt": "2020-08-31T07:30:38Z", "author": {"login": "kokosing"}, "path": "presto-password-authenticators/src/main/java/io/prestosql/plugin/password/file/FileGroupConfig.java", "diffHunk": "@@ -0,0 +1,58 @@\n+/*\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+package io.prestosql.plugin.password.file;\n+\n+import io.airlift.configuration.Config;\n+import io.airlift.configuration.ConfigDescription;\n+import io.airlift.configuration.validation.FileExists;\n+import io.airlift.units.Duration;\n+import io.airlift.units.MinDuration;\n+\n+import java.io.File;\n+\n+import static java.util.concurrent.TimeUnit.SECONDS;\n+\n+public class FileGroupConfig\n+{\n+    private File groupFile;\n+    private Duration refreshPeriod = new Duration(5, SECONDS);\n+\n+    @FileExists\n+    public File getGroupFile()\n+    {\n+        return groupFile;\n+    }\n+\n+    @Config(\"file.group-file\")\n+    @ConfigDescription(\"Location of the file that provides user group membership\")\n+    public FileGroupConfig setGroupFile(File groupFile)\n+    {\n+        this.groupFile = groupFile;\n+        return this;\n+    }\n+\n+    @MinDuration(\"1ms\")", "state": "SUBMITTED", "replyTo": null, "originalCommit": null, "originalPosition": 45}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3OTk0ODA1MQ==", "bodyText": "I docs you mentioned 1 minute", "url": "https://github.com/trinodb/trino/pull/5028#discussion_r479948051", "createdAt": "2020-08-31T07:31:12Z", "author": {"login": "kokosing"}, "path": "presto-password-authenticators/src/main/java/io/prestosql/plugin/password/file/FileGroupConfig.java", "diffHunk": "@@ -0,0 +1,58 @@\n+/*\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+package io.prestosql.plugin.password.file;\n+\n+import io.airlift.configuration.Config;\n+import io.airlift.configuration.ConfigDescription;\n+import io.airlift.configuration.validation.FileExists;\n+import io.airlift.units.Duration;\n+import io.airlift.units.MinDuration;\n+\n+import java.io.File;\n+\n+import static java.util.concurrent.TimeUnit.SECONDS;\n+\n+public class FileGroupConfig\n+{\n+    private File groupFile;\n+    private Duration refreshPeriod = new Duration(5, SECONDS);", "state": "SUBMITTED", "replyTo": null, "originalCommit": null, "originalPosition": 29}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3OTk0OTIwMQ==", "bodyText": "Oh. So this is where the default came from. Should we consider changing file based access rules to have this default set as well?", "url": "https://github.com/trinodb/trino/pull/5028#discussion_r479949201", "createdAt": "2020-08-31T07:33:44Z", "author": {"login": "kokosing"}, "path": "presto-docs/src/main/sphinx/security/password-file.rst", "diffHunk": "@@ -27,7 +27,7 @@ The following configuration properties are available:\n ==================================== ==============================================\n Property                             Description\n ==================================== ==============================================\n-``file.password``                    Path of the password file.\n+``file.password-file``                    Path of the password file.\n \n ``file.refresh-period``              How often to reload the password file.\n                                      Defaults to ``1m``.", "state": "SUBMITTED", "replyTo": null, "originalCommit": null, "originalPosition": 8}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": null, "afterCommit": null}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDgxNDI3MDU1", "url": "https://github.com/trinodb/trino/pull/5028#pullrequestreview-481427055", "createdAt": "2020-09-03T01:46:19Z", "commit": null, "state": "COMMENTED", "comments": {"totalCount": 9, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wM1QwMTo0NjoxOVrOHMSPjQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wM1QwNDowNjo1MVrOHMVHOg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MjY0Mzg1Mw==", "bodyText": "nit: user_3 for uniformity?", "url": "https://github.com/trinodb/trino/pull/5028#discussion_r482643853", "createdAt": "2020-09-03T01:46:19Z", "author": {"login": "phd3"}, "path": "presto-docs/src/main/sphinx/security/group-file.rst", "diffHunk": "@@ -0,0 +1,42 @@\n+==========\n+Group File\n+==========\n+\n+Presto can map user names onto groups for easier access control and\n+resource group management. Group file resolves group membership using\n+a file on the coordinator.\n+\n+Group File Configuration\n+------------------------\n+\n+Enable group file by creating an ``etc/group-provider.properties``\n+file on the coordinator:\n+\n+.. code-block:: none\n+\n+    group-provider.name=file\n+    file.group-file=/path/to/group.txt\n+\n+The following configuration properties are available:\n+\n+==================================== ==============================================\n+Property                             Description\n+==================================== ==============================================\n+``file.group-file``                  Path of the group file.\n+\n+``file.refresh-period``              How often to reload the group file.\n+                                     Defaults to ``1m``.\n+==================================== ==============================================\n+\n+Group Files\n+-----------\n+\n+File Format\n+^^^^^^^^^^^\n+\n+The group file contains a list of groups and members, one per line,\n+separated by a colon. Users are separated by a space.\n+\n+.. code-block:: none\n+\n+    group_name: user_1 user_2 user3", "state": "SUBMITTED", "replyTo": null, "originalCommit": null, "originalPosition": 42}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MjY0NDQ0NQ==", "bodyText": "nit: indent for the 2nd column", "url": "https://github.com/trinodb/trino/pull/5028#discussion_r482644445", "createdAt": "2020-09-03T01:48:39Z", "author": {"login": "phd3"}, "path": "presto-docs/src/main/sphinx/security/password-file.rst", "diffHunk": "@@ -27,7 +27,7 @@ The following configuration properties are available:\n ==================================== ==============================================\n Property                             Description\n ==================================== ==============================================\n-``file.password``                    Path of the password file.\n+``file.password-file``                    Path of the password file.", "state": "SUBMITTED", "replyTo": null, "originalCommit": null, "originalPosition": 5}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MjY0ODM4NQ==", "bodyText": "The title \"Group File\" seems a bit confusing to describe the feature. Something like \"File Based Group Provider\" might be more descriptive?", "url": "https://github.com/trinodb/trino/pull/5028#discussion_r482648385", "createdAt": "2020-09-03T02:03:10Z", "author": {"login": "phd3"}, "path": "presto-docs/src/main/sphinx/security/group-file.rst", "diffHunk": "@@ -0,0 +1,42 @@\n+==========\n+Group File", "state": "SUBMITTED", "replyTo": null, "originalCommit": null, "originalPosition": 2}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MjY2MDk1MQ==", "bodyText": "\"user and groups\" --> \"users and group\" ?\n(ignore if it's being converted to json parsing)", "url": "https://github.com/trinodb/trino/pull/5028#discussion_r482660951", "createdAt": "2020-09-03T02:26:13Z", "author": {"login": "phd3"}, "path": "presto-password-authenticators/src/main/java/io/prestosql/plugin/password/file/FileGroupProvider.java", "diffHunk": "@@ -0,0 +1,110 @@\n+/*\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+package io.prestosql.plugin.password.file;\n+\n+import com.google.common.base.Splitter;\n+import com.google.common.collect.HashMultimap;\n+import com.google.common.collect.ImmutableSet;\n+import com.google.common.collect.Multimap;\n+import io.prestosql.spi.PrestoException;\n+import io.prestosql.spi.security.GroupProvider;\n+\n+import javax.inject.Inject;\n+\n+import java.io.File;\n+import java.io.IOException;\n+import java.nio.file.Files;\n+import java.util.List;\n+import java.util.Map;\n+import java.util.Map.Entry;\n+import java.util.Set;\n+import java.util.function.Function;\n+import java.util.function.Supplier;\n+\n+import static com.google.common.base.Suppliers.memoizeWithExpiration;\n+import static com.google.common.collect.ImmutableMap.toImmutableMap;\n+import static io.prestosql.spi.StandardErrorCode.CONFIGURATION_INVALID;\n+import static io.prestosql.spi.StandardErrorCode.CONFIGURATION_UNAVAILABLE;\n+import static java.lang.String.format;\n+import static java.util.Objects.requireNonNull;\n+import static java.util.concurrent.TimeUnit.MILLISECONDS;\n+\n+public class FileGroupProvider\n+        implements GroupProvider\n+{\n+    private static final Splitter LINE_SPLITTER = Splitter.on(\":\").limit(2).trimResults();\n+    private static final Splitter GROUP_SPLITTER = Splitter.on(\" \").trimResults();\n+\n+    private final Supplier<Function<String, Set<String>>> userGroupSupplier;\n+\n+    @Inject\n+    public FileGroupProvider(FileGroupConfig config)\n+    {\n+        File file = config.getGroupFile();\n+\n+        userGroupSupplier = memoizeWithExpiration(\n+                () -> loadGroupFile(file),\n+                config.getRefreshPeriod().toMillis(),\n+                MILLISECONDS);\n+    }\n+\n+    @Override\n+    public Set<String> getGroups(String user)\n+    {\n+        requireNonNull(user, \"user is null\");\n+        return userGroupSupplier.get().apply(user);\n+    }\n+\n+    private static Function<String, Set<String>> loadGroupFile(File file)\n+    {\n+        Map<String, Set<String>> groups = loadGroupFile(readGroupFile(file));\n+        return user -> groups.getOrDefault(user, ImmutableSet.of());\n+    }\n+\n+    private static Map<String, Set<String>> loadGroupFile(List<String> lines)\n+    {\n+        Multimap<String, String> userGroups = HashMultimap.create();\n+        for (int lineNumber = 1; lineNumber <= lines.size(); lineNumber++) {\n+            String line = lines.get(lineNumber - 1).trim();\n+            if (line.isEmpty() || line.startsWith(\"#\")) {\n+                continue;\n+            }\n+\n+            List<String> parts = LINE_SPLITTER.splitToList(line);\n+            if (parts.size() != 2) {\n+                throw invalidFile(lineNumber, \"Expected two parts for user and groups\", null);", "state": "SUBMITTED", "replyTo": null, "originalCommit": null, "originalPosition": 86}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MjY2Njk3Ng==", "bodyText": "is there a reason to put a GroupProvider implementation in this package? this feature seems to be independent to the password authenticators. Should we create a separate package (or even module like other plugin implementations)?", "url": "https://github.com/trinodb/trino/pull/5028#discussion_r482666976", "createdAt": "2020-09-03T02:33:36Z", "author": {"login": "phd3"}, "path": "presto-password-authenticators/src/main/java/io/prestosql/plugin/password/file/FileGroupProvider.java", "diffHunk": "@@ -0,0 +1,110 @@\n+/*\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+package io.prestosql.plugin.password.file;", "state": "SUBMITTED", "replyTo": null, "originalCommit": null, "originalPosition": 14}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MjY2ODUxMw==", "bodyText": "passwordFile --> groupFile", "url": "https://github.com/trinodb/trino/pull/5028#discussion_r482668513", "createdAt": "2020-09-03T02:39:25Z", "author": {"login": "phd3"}, "path": "presto-password-authenticators/src/test/java/io/prestosql/plugin/password/file/TestFileGroupConfig.java", "diffHunk": "@@ -0,0 +1,58 @@\n+\n+/*\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+package io.prestosql.plugin.password.file;\n+\n+import com.google.common.collect.ImmutableMap;\n+import io.airlift.units.Duration;\n+import org.testng.annotations.Test;\n+\n+import java.io.IOException;\n+import java.nio.file.Files;\n+import java.nio.file.Path;\n+import java.util.Map;\n+\n+import static io.airlift.configuration.testing.ConfigAssertions.assertFullMapping;\n+import static io.airlift.configuration.testing.ConfigAssertions.assertRecordedDefaults;\n+import static io.airlift.configuration.testing.ConfigAssertions.recordDefaults;\n+import static java.util.concurrent.TimeUnit.SECONDS;\n+\n+public class TestFileGroupConfig\n+{\n+    @Test\n+    public void testDefault()\n+    {\n+        assertRecordedDefaults(recordDefaults(FileGroupConfig.class)\n+                .setGroupFile(null)\n+                .setRefreshPeriod(new Duration(5, SECONDS)));\n+    }\n+\n+    @Test\n+    public void testExplicitConfig()\n+            throws IOException\n+    {\n+        Path passwordFile = Files.createTempFile(null, null);", "state": "SUBMITTED", "replyTo": null, "originalCommit": null, "originalPosition": 45}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MjY3MDMxNw==", "bodyText": "testGroupProviderFactory? Guice sounds like implementation detail", "url": "https://github.com/trinodb/trino/pull/5028#discussion_r482670317", "createdAt": "2020-09-03T02:46:12Z", "author": {"login": "phd3"}, "path": "presto-password-authenticators/src/test/java/io/prestosql/plugin/password/file/TestFileGroupProvider.java", "diffHunk": "@@ -0,0 +1,54 @@\n+/*\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+package io.prestosql.plugin.password.file;\n+\n+import com.google.common.collect.ImmutableMap;\n+import com.google.common.collect.ImmutableSet;\n+import com.google.common.io.Resources;\n+import io.prestosql.spi.security.GroupProvider;\n+import org.testng.annotations.Test;\n+\n+import java.io.File;\n+\n+import static org.testng.Assert.assertEquals;\n+\n+public class TestFileGroupProvider\n+{\n+    @Test\n+    public void test()\n+            throws Exception\n+    {\n+        File groupFile = new File(Resources.getResource(\"group.txt\").toURI().getPath());\n+        GroupProvider groupProvider = new FileGroupProvider(new FileGroupConfig().setGroupFile(groupFile));\n+        assertGroupProvider(groupProvider);\n+    }\n+\n+    @Test\n+    public void testGuice()", "state": "SUBMITTED", "replyTo": null, "originalCommit": null, "originalPosition": 38}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MjY4NTY5NA==", "bodyText": "Should we also add a corresponding plugin class? or are the users expected to write their own plugin that returns this factory?", "url": "https://github.com/trinodb/trino/pull/5028#discussion_r482685694", "createdAt": "2020-09-03T03:46:12Z", "author": {"login": "phd3"}, "path": "presto-password-authenticators/src/main/java/io/prestosql/plugin/password/file/FileGroupProviderFactory.java", "diffHunk": "@@ -0,0 +1,52 @@\n+/*\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+package io.prestosql.plugin.password.file;\n+\n+import com.google.inject.Injector;\n+import com.google.inject.Scopes;\n+import io.airlift.bootstrap.Bootstrap;\n+import io.prestosql.spi.security.GroupProvider;\n+import io.prestosql.spi.security.GroupProviderFactory;\n+\n+import java.util.Map;\n+\n+import static io.airlift.configuration.ConfigBinder.configBinder;\n+\n+public class FileGroupProviderFactory", "state": "SUBMITTED", "replyTo": null, "originalCommit": null, "originalPosition": 26}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MjY5MDg3NA==", "bodyText": "we can add omitEmptyStrings to avoid creating mapping for \"empty\" user in case of multiple spaces", "url": "https://github.com/trinodb/trino/pull/5028#discussion_r482690874", "createdAt": "2020-09-03T04:06:51Z", "author": {"login": "phd3"}, "path": "presto-password-authenticators/src/main/java/io/prestosql/plugin/password/file/FileGroupProvider.java", "diffHunk": "@@ -0,0 +1,110 @@\n+/*\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+package io.prestosql.plugin.password.file;\n+\n+import com.google.common.base.Splitter;\n+import com.google.common.collect.HashMultimap;\n+import com.google.common.collect.ImmutableSet;\n+import com.google.common.collect.Multimap;\n+import io.prestosql.spi.PrestoException;\n+import io.prestosql.spi.security.GroupProvider;\n+\n+import javax.inject.Inject;\n+\n+import java.io.File;\n+import java.io.IOException;\n+import java.nio.file.Files;\n+import java.util.List;\n+import java.util.Map;\n+import java.util.Map.Entry;\n+import java.util.Set;\n+import java.util.function.Function;\n+import java.util.function.Supplier;\n+\n+import static com.google.common.base.Suppliers.memoizeWithExpiration;\n+import static com.google.common.collect.ImmutableMap.toImmutableMap;\n+import static io.prestosql.spi.StandardErrorCode.CONFIGURATION_INVALID;\n+import static io.prestosql.spi.StandardErrorCode.CONFIGURATION_UNAVAILABLE;\n+import static java.lang.String.format;\n+import static java.util.Objects.requireNonNull;\n+import static java.util.concurrent.TimeUnit.MILLISECONDS;\n+\n+public class FileGroupProvider\n+        implements GroupProvider\n+{\n+    private static final Splitter LINE_SPLITTER = Splitter.on(\":\").limit(2).trimResults();\n+    private static final Splitter GROUP_SPLITTER = Splitter.on(\" \").trimResults();", "state": "SUBMITTED", "replyTo": null, "originalCommit": null, "originalPosition": 47}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": null, "afterCommit": null}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": null, "afterCommit": null}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": null, "afterCommit": null}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": null, "afterCommit": null}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDk2ODc4NzY1", "url": "https://github.com/trinodb/trino/pull/5028#pullrequestreview-496878765", "createdAt": "2020-09-25T21:38:22Z", "commit": null, "state": "APPROVED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yNVQyMTozODoyMlrOHYTxgA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yNVQyMTo0NjozNFrOHYUHTA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NTI1MTg0MA==", "bodyText": "nit: password --> group in the description", "url": "https://github.com/trinodb/trino/pull/5028#discussion_r495251840", "createdAt": "2020-09-25T21:38:22Z", "author": {"login": "phd3"}, "path": "presto-password-authenticators/src/main/java/io/prestosql/plugin/password/file/FileGroupConfig.java", "diffHunk": "@@ -0,0 +1,62 @@\n+/*\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+package io.prestosql.plugin.password.file;\n+\n+import io.airlift.configuration.Config;\n+import io.airlift.configuration.ConfigDescription;\n+import io.airlift.configuration.validation.FileExists;\n+import io.airlift.units.Duration;\n+import io.airlift.units.MinDuration;\n+\n+import javax.validation.constraints.NotNull;\n+\n+import java.io.File;\n+\n+import static java.util.concurrent.TimeUnit.SECONDS;\n+\n+public class FileGroupConfig\n+{\n+    private File groupFile;\n+    private Duration refreshPeriod = new Duration(5, SECONDS);\n+\n+    @NotNull\n+    @FileExists\n+    public File getGroupFile()\n+    {\n+        return groupFile;\n+    }\n+\n+    @Config(\"file.group-file\")\n+    @ConfigDescription(\"Location of the file that provides user group membership\")\n+    public FileGroupConfig setGroupFile(File groupFile)\n+    {\n+        this.groupFile = groupFile;\n+        return this;\n+    }\n+\n+    @NotNull\n+    @MinDuration(\"1ms\")\n+    public Duration getRefreshPeriod()\n+    {\n+        return refreshPeriod;\n+    }\n+\n+    @Config(\"file.refresh-period\")\n+    @ConfigDescription(\"How often to reload the password file\")", "state": "SUBMITTED", "replyTo": null, "originalCommit": null, "originalPosition": 56}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NTI1NzQyMA==", "bodyText": "space --> comma (based on the update)", "url": "https://github.com/trinodb/trino/pull/5028#discussion_r495257420", "createdAt": "2020-09-25T21:46:34Z", "author": {"login": "phd3"}, "path": "presto-docs/src/main/sphinx/security/group-file.rst", "diffHunk": "@@ -0,0 +1,42 @@\n+=========================\n+File Based Group Provider\n+=========================\n+\n+Presto can map user names onto groups for easier access control and\n+resource group management. Group file resolves group membership using\n+a file on the coordinator.\n+\n+Group File Configuration\n+------------------------\n+\n+Enable group file by creating an ``etc/group-provider.properties``\n+file on the coordinator:\n+\n+.. code-block:: none\n+\n+    group-provider.name=file\n+    file.group-file=/path/to/group.txt\n+\n+The following configuration properties are available:\n+\n+==================================== ==============================================\n+Property                             Description\n+==================================== ==============================================\n+``file.group-file``                  Path of the group file.\n+\n+``file.refresh-period``              How often to reload the group file.\n+                                     Defaults to ``5s``.\n+==================================== ==============================================\n+\n+Group Files\n+-----------\n+\n+File Format\n+^^^^^^^^^^^\n+\n+The group file contains a list of groups and members, one per line,\n+separated by a colon. Users are separated by a space.", "state": "SUBMITTED", "replyTo": null, "originalCommit": null, "originalPosition": 38}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "4657403ed2bb1930286b53e904c482ebca1f386e", "author": {"user": {"login": "dain", "name": "Dain Sundstrom"}}, "url": "https://github.com/trinodb/trino/commit/4657403ed2bb1930286b53e904c482ebca1f386e", "committedDate": "2020-09-28T00:28:10Z", "message": "Add file group provider"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "4379cbdb2fea0c1c9d1dc5aee1f2996cc08d2f94", "author": {"user": {"login": "dain", "name": "Dain Sundstrom"}}, "url": "https://github.com/trinodb/trino/commit/4379cbdb2fea0c1c9d1dc5aee1f2996cc08d2f94", "committedDate": "2020-09-28T00:28:12Z", "message": "Cleanup file based password authenticator\n\nFix property name in password file docs\nAdd missing config null checks"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": null, "afterCommit": {"oid": "4379cbdb2fea0c1c9d1dc5aee1f2996cc08d2f94", "author": {"user": {"login": "dain", "name": "Dain Sundstrom"}}, "url": "https://github.com/trinodb/trino/commit/4379cbdb2fea0c1c9d1dc5aee1f2996cc08d2f94", "committedDate": "2020-09-28T00:28:12Z", "message": "Cleanup file based password authenticator\n\nFix property name in password file docs\nAdd missing config null checks"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3806, "cost": 1, "resetAt": "2021-10-28T20:13:43Z"}}}