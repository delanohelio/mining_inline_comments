{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0MzY3NTk3NzYx", "number": 2642, "title": "Refactor of deprecated DataSize methods", "bodyText": "This is a refactor to replace all usages of the deprecated DataSize methods with their corresponding precise bytes versions. (airlift/units#16)\nThe first commit contains replacements where a manual change was required. The second commit  contains automated replacements done with intellij structural replace tool.\nI've also added violations to prevent future usage of the deprecated methods.", "createdAt": "2020-01-27T16:54:27Z", "url": "https://github.com/trinodb/trino/pull/2642", "merged": true, "mergeCommit": {"oid": "6a53550134f4dfd4563a3b9a8d9afa8b6b3c9411"}, "closed": true, "closedAt": "2020-02-06T23:48:23Z", "author": {"login": "nccanter"}, "timelineItems": {"totalCount": 6, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABb_0mtRABqjI5OTgzMDYzMzQ=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcBedwyABqjMwMTE5MzQ5MjE=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "HeadRefForcePushedEvent", "beforeCommit": null, "afterCommit": null}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzUzMzkwMzE4", "url": "https://github.com/trinodb/trino/pull/2642#pullrequestreview-353390318", "createdAt": "2020-02-05T00:07:34Z", "commit": null, "state": "APPROVED", "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0wNVQwMDowNzozNFrOFln2qg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0wNVQwMDozNzo0OFrOFloVpA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NDk5NDYwMg==", "bodyText": "Let's put the rounding in the caller. I'd prefer to keep this returning double.", "url": "https://github.com/trinodb/trino/pull/2642#discussion_r374994602", "createdAt": "2020-02-05T00:07:34Z", "author": {"login": "electrum"}, "path": "presto-benchmark/src/main/java/io/prestosql/benchmark/AverageBenchmarkResults.java", "diffHunk": "@@ -44,9 +44,9 @@ public BenchmarkResultHook addResults(Map<String, Long> results)\n         return this;\n     }\n \n-    public Map<String, Double> getAverageResultsValues()\n+    public Map<String, Long> getAverageResultsValues()\n     {\n-        return Maps.transformValues(resultsSum, input -> 1.0 * input / resultsCount);\n+        return Maps.transformValues(resultsSum, input -> Math.round(((double) input) / resultsCount));", "state": "SUBMITTED", "replyTo": null, "originalCommit": null, "originalPosition": 8}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NDk5NTM3OQ==", "bodyText": "This needs to stay as a double so that the NaN / infinity check below works (or restructure the code to account for the cases where divisor and possibly dividend is zero).", "url": "https://github.com/trinodb/trino/pull/2642#discussion_r374995379", "createdAt": "2020-02-05T00:10:51Z", "author": {"login": "electrum"}, "path": "presto-cli/src/main/java/io/prestosql/cli/FormatUtils.java", "diffHunk": "@@ -114,7 +114,7 @@ else if (longForm) {\n \n     public static String formatDataRate(DataSize dataSize, Duration duration, boolean longForm)\n     {\n-        double rate = dataSize.toBytes() / duration.getValue(SECONDS);\n+        long rate = Math.round(dataSize.toBytes() / duration.getValue(SECONDS));", "state": "SUBMITTED", "replyTo": null, "originalCommit": null, "originalPosition": 5}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NTAwMjUzMg==", "bodyText": "Add a -- before \"note\" to separate the two sentences", "url": "https://github.com/trinodb/trino/pull/2642#discussion_r375002532", "createdAt": "2020-02-05T00:37:48Z", "author": {"login": "electrum"}, "path": "src/modernizer/violations.xml", "diffHunk": "@@ -59,4 +59,46 @@\n         <version>1.6</version>\n         <comment>Prefer OGCGeometry.Equals(OGCGeometry)</comment>\n     </violation>\n+\n+    <violation>\n+        <name>io/airlift/units/DataSize.\"&lt;init&gt;\":(DLio/airlift/units/DataSize$Unit;)V</name>\n+        <version>1.8</version>\n+        <comment>Use io.airlift.units.DataSize.of(long, DataSize.Unit)</comment>\n+    </violation>\n+\n+    <violation>\n+        <name>io/airlift/units/DataSize.succinctDataSize:(DLio/airlift/units/DataSize$Unit;)Lio/airlift/units/DataSize;</name>\n+        <version>1.8</version>\n+        <comment>Use io.airlift.units.DataSize.of(long, DataSize.Unit).succinct() Note that succinct conversion only affects toString() results</comment>", "state": "SUBMITTED", "replyTo": null, "originalCommit": null, "originalPosition": 14}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": null, "afterCommit": null}, {"__typename": "PullRequestCommit", "commit": {"oid": "1d730f6e99048a0e9509f59e5e4b260d1eeac685", "author": {"user": {"login": "nccanter", "name": "Nathan Canterbury"}}, "url": "https://github.com/trinodb/trino/commit/1d730f6e99048a0e9509f59e5e4b260d1eeac685", "committedDate": "2020-02-05T22:58:35Z", "message": "Edge case refactor of deprecated DataSize methods"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "491b9b0f223ca0b13ae67903f258ac31e42661db", "author": {"user": {"login": "nccanter", "name": "Nathan Canterbury"}}, "url": "https://github.com/trinodb/trino/commit/491b9b0f223ca0b13ae67903f258ac31e42661db", "committedDate": "2020-02-05T22:58:36Z", "message": "Automated refactor of deprecated DataSize methods"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": null, "afterCommit": {"oid": "491b9b0f223ca0b13ae67903f258ac31e42661db", "author": {"user": {"login": "nccanter", "name": "Nathan Canterbury"}}, "url": "https://github.com/trinodb/trino/commit/491b9b0f223ca0b13ae67903f258ac31e42661db", "committedDate": "2020-02-05T22:58:36Z", "message": "Automated refactor of deprecated DataSize methods"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1706, "cost": 1, "resetAt": "2021-10-28T20:13:43Z"}}}