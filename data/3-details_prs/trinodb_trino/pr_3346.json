{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0Mzk5MTk0MDA5", "number": 3346, "title": "Use unique table names in distributed tests", "bodyText": "Use unique table names in distributed tests", "createdAt": "2020-04-05T18:26:02Z", "url": "https://github.com/trinodb/trino/pull/3346", "merged": true, "mergeCommit": {"oid": "a2b30a92c2b501a7fe87cb68264bd7f3865953bb"}, "closed": true, "closedAt": "2020-04-06T09:28:20Z", "author": {"login": "kokosing"}, "timelineItems": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcUv2WMAFqTM4Nzg1NTgyOQ==", "endCursor": "Y3Vyc29yOnYyOpPPAAABcU6E7vgFqTM4ODAxNDM3Nw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzg3ODU1ODI5", "url": "https://github.com/trinodb/trino/pull/3346#pullrequestreview-387855829", "createdAt": "2020-04-05T20:06:55Z", "commit": null, "state": "APPROVED", "comments": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wNVQyMDowNjo1NlrOGBC-EQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wNVQyMDowOToyMlrOGBC_MQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMzc1MDQxNw==", "bodyText": "\"\" + tableName doesn't make sense", "url": "https://github.com/trinodb/trino/pull/3346#discussion_r403750417", "createdAt": "2020-04-05T20:06:56Z", "author": {"login": "sopel39"}, "path": "presto-testing/src/main/java/io/prestosql/testing/AbstractTestDistributedQueries.java", "diffHunk": "@@ -195,63 +195,55 @@ public void testCreateTable()\n     @Test\n     public void testCreateTableAsSelect()\n     {\n-        assertUpdate(\"CREATE TABLE IF NOT EXISTS test_ctas AS SELECT name, regionkey FROM nation\", \"SELECT count(*) FROM nation\");\n-        assertTableColumnNames(\"test_ctas\", \"name\", \"regionkey\");\n-        assertUpdate(\"DROP TABLE test_ctas\");\n+        String tableName = \"test_ctas\" + randomTableSuffix();\n+        assertUpdate(\"CREATE TABLE IF NOT EXISTS \" + tableName + \" AS SELECT name, regionkey FROM nation\", \"SELECT count(*) FROM nation\");\n+        assertTableColumnNames(\"\" + tableName, \"name\", \"regionkey\");", "state": "SUBMITTED", "replyTo": null, "originalCommit": null, "originalPosition": 9}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMzc1MDQzMQ==", "bodyText": "consider using String.format instead", "url": "https://github.com/trinodb/trino/pull/3346#discussion_r403750431", "createdAt": "2020-04-05T20:07:09Z", "author": {"login": "sopel39"}, "path": "presto-testing/src/main/java/io/prestosql/testing/AbstractTestDistributedQueries.java", "diffHunk": "@@ -195,63 +195,55 @@ public void testCreateTable()\n     @Test\n     public void testCreateTableAsSelect()\n     {\n-        assertUpdate(\"CREATE TABLE IF NOT EXISTS test_ctas AS SELECT name, regionkey FROM nation\", \"SELECT count(*) FROM nation\");\n-        assertTableColumnNames(\"test_ctas\", \"name\", \"regionkey\");\n-        assertUpdate(\"DROP TABLE test_ctas\");\n+        String tableName = \"test_ctas\" + randomTableSuffix();\n+        assertUpdate(\"CREATE TABLE IF NOT EXISTS \" + tableName + \" AS SELECT name, regionkey FROM nation\", \"SELECT count(*) FROM nation\");", "state": "SUBMITTED", "replyTo": null, "originalCommit": null, "originalPosition": 8}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMzc1MDU1MA==", "bodyText": "I don't think it's needed anymore", "url": "https://github.com/trinodb/trino/pull/3346#discussion_r403750550", "createdAt": "2020-04-05T20:08:09Z", "author": {"login": "sopel39"}, "path": "presto-testing/src/main/java/io/prestosql/testing/AbstractTestDistributedQueries.java", "diffHunk": "@@ -527,171 +519,176 @@ public void testInsertWithCoercion()\n     @Test\n     public void testInsertUnicode()\n     {\n-        assertUpdate(\"DROP TABLE IF EXISTS test_insert_unicode\");\n+        String tableName = \"test_insert_unicode_\" + randomTableSuffix();\n+\n+        assertUpdate(\"DROP TABLE IF EXISTS \" + tableName);", "state": "SUBMITTED", "replyTo": null, "originalCommit": null, "originalPosition": 120}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMzc1MDY4OA==", "bodyText": "\"\" + viewName doesn't make sense", "url": "https://github.com/trinodb/trino/pull/3346#discussion_r403750688", "createdAt": "2020-04-05T20:09:07Z", "author": {"login": "sopel39"}, "path": "presto-testing/src/main/java/io/prestosql/testing/AbstractTestDistributedQueries.java", "diffHunk": "@@ -801,7 +814,7 @@ public void testViewMetadata()\n         MaterializedResult expected = resultBuilder(getSession(), actual.getTypes())\n                 .row(\"customer\", \"BASE TABLE\")\n                 .row(\"lineitem\", \"BASE TABLE\")\n-                .row(\"meta_test_view\", \"VIEW\")\n+                .row(\"\" + viewName, \"VIEW\")", "state": "SUBMITTED", "replyTo": null, "originalCommit": null, "originalPosition": 516}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMzc1MDcwNQ==", "bodyText": "ditto", "url": "https://github.com/trinodb/trino/pull/3346#discussion_r403750705", "createdAt": "2020-04-05T20:09:22Z", "author": {"login": "sopel39"}, "path": "presto-testing/src/main/java/io/prestosql/testing/AbstractTestDistributedQueries.java", "diffHunk": "@@ -829,13 +842,13 @@ public void testViewMetadata()\n                 getSession().getSchema().get()));\n \n         expected = resultBuilder(getSession(), actual.getTypes())\n-                .row(\"meta_test_view\", formatSqlText(query))\n+                .row(\"\" + viewName, formatSqlText(query))", "state": "SUBMITTED", "replyTo": null, "originalCommit": null, "originalPosition": 525}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "05f5cebcac2905c2761c1ac69e3e65fa10ed060c", "author": {"user": {"login": "kokosing", "name": "Grzegorz Kokosi\u0144ski"}}, "url": "https://github.com/trinodb/trino/commit/05f5cebcac2905c2761c1ac69e3e65fa10ed060c", "committedDate": "2020-04-06T08:03:43Z", "message": "Use unique table names in distributed tests"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": null, "afterCommit": {"oid": "05f5cebcac2905c2761c1ac69e3e65fa10ed060c", "author": {"user": {"login": "kokosing", "name": "Grzegorz Kokosi\u0144ski"}}, "url": "https://github.com/trinodb/trino/commit/05f5cebcac2905c2761c1ac69e3e65fa10ed060c", "committedDate": "2020-04-06T08:03:43Z", "message": "Use unique table names in distributed tests"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzg4MDE0Mzc3", "url": "https://github.com/trinodb/trino/pull/3346#pullrequestreview-388014377", "createdAt": "2020-04-06T08:01:14Z", "commit": null, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wNlQwODowMToxNFrOGBMAhw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wNlQwODowMToxNFrOGBMAhw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMzg5ODUwMw==", "bodyText": "Also, I refactored this code with some search-and-replace methods. Using format would be much harder to make it automatically.", "url": "https://github.com/trinodb/trino/pull/3346#discussion_r403898503", "createdAt": "2020-04-06T08:01:14Z", "author": {"login": "kokosing"}, "path": "presto-testing/src/main/java/io/prestosql/testing/AbstractTestDistributedQueries.java", "diffHunk": "@@ -195,63 +195,55 @@ public void testCreateTable()\n     @Test\n     public void testCreateTableAsSelect()\n     {\n-        assertUpdate(\"CREATE TABLE IF NOT EXISTS test_ctas AS SELECT name, regionkey FROM nation\", \"SELECT count(*) FROM nation\");\n-        assertTableColumnNames(\"test_ctas\", \"name\", \"regionkey\");\n-        assertUpdate(\"DROP TABLE test_ctas\");\n+        String tableName = \"test_ctas\" + randomTableSuffix();\n+        assertUpdate(\"CREATE TABLE IF NOT EXISTS \" + tableName + \" AS SELECT name, regionkey FROM nation\", \"SELECT count(*) FROM nation\");", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMzc1MDQzMQ=="}, "originalCommit": null, "originalPosition": 8}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1771, "cost": 1, "resetAt": "2021-10-28T19:08:13Z"}}}