{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDI5NjE4MTMw", "number": 3946, "title": "Fix incorrect cast from timestamp to time", "bodyText": "When the offset of the session timezone on the current day\ndiffers from the offset during the epoch due to, say, daylight\nsavings, the result of the cast would be wrong.\nFixes #3848", "createdAt": "2020-06-07T02:07:12Z", "url": "https://github.com/trinodb/trino/pull/3946", "merged": true, "mergeCommit": {"oid": "a00432f62e3e967b346488351f0c10fd8dff0134"}, "closed": true, "closedAt": "2020-06-09T17:58:03Z", "author": {"login": "martint"}, "timelineItems": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABco7wQxAFqTQyNTgxOTQzMA==", "endCursor": "Y3Vyc29yOnYyOpPPAAABcpfBU6gBqjM0MjMyMjgyODM=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDI1ODE5NDMw", "url": "https://github.com/trinodb/trino/pull/3946#pullrequestreview-425819430", "createdAt": "2020-06-07T13:18:55Z", "commit": null, "state": "APPROVED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wN1QxMzoxODo1NVrOGgJdEA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wN1QxMzoyMDowNlrOGgJdfQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNjM2MjUxMg==", "bodyText": "nit: We usually use Kathmandu for this.", "url": "https://github.com/trinodb/trino/pull/3946#discussion_r436362512", "createdAt": "2020-06-07T13:18:55Z", "author": {"login": "findepi"}, "path": "presto-main/src/test/java/io/prestosql/operator/scalar/timestamp/TestTimestampLegacy.java", "diffHunk": "@@ -13,11 +13,41 @@\n  */\n package io.prestosql.operator.scalar.timestamp;\n \n+import io.prestosql.Session;\n+import org.testng.annotations.Test;\n+\n+import static io.prestosql.spi.type.TimeZoneKey.getTimeZoneKey;\n+import static org.assertj.core.api.Assertions.assertThat;\n+\n public class TestTimestampLegacy\n         extends BaseTestTimestamp\n {\n     protected TestTimestampLegacy()\n     {\n         super(true);\n     }\n+\n+    @Test\n+    public void testCastToTimeWithDaylightSavings()\n+    {\n+        // The number of seconds since the beginning of the day for the America/Los_Angeles in 2020 doesn't match\n+        // that of 1970, the year of the epoch. Make sure the proper corrections are being performed.\n+        Session session = assertions.sessionBuilder()\n+                .setTimeZoneKey(getTimeZoneKey(\"America/Los_Angeles\"))", "state": "SUBMITTED", "replyTo": null, "originalCommit": null, "originalPosition": 24}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNjM2MjYyMQ==", "bodyText": "This could go into BaseTestTimestamp, to cover the new semantics (even though it was not broken)", "url": "https://github.com/trinodb/trino/pull/3946#discussion_r436362621", "createdAt": "2020-06-07T13:20:06Z", "author": {"login": "findepi"}, "path": "presto-main/src/test/java/io/prestosql/operator/scalar/timestamp/TestTimestampLegacy.java", "diffHunk": "@@ -13,11 +13,41 @@\n  */\n package io.prestosql.operator.scalar.timestamp;\n \n+import io.prestosql.Session;\n+import org.testng.annotations.Test;\n+\n+import static io.prestosql.spi.type.TimeZoneKey.getTimeZoneKey;\n+import static org.assertj.core.api.Assertions.assertThat;\n+\n public class TestTimestampLegacy\n         extends BaseTestTimestamp\n {\n     protected TestTimestampLegacy()\n     {\n         super(true);\n     }\n+\n+    @Test\n+    public void testCastToTimeWithDaylightSavings()", "state": "SUBMITTED", "replyTo": null, "originalCommit": null, "originalPosition": 19}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "87c5e75a7ce60b834e10c0ce3b44b96ba4fddc53", "author": {"user": {"login": "martint", "name": "Martin Traverso"}}, "url": "https://github.com/trinodb/trino/commit/87c5e75a7ce60b834e10c0ce3b44b96ba4fddc53", "committedDate": "2020-06-09T06:24:55Z", "message": "Fix incorrect cast from timestamp to time\n\nWhen the offset of the session timezone on the current day\ndiffers from the offset during the epoch due to, say, daylight\nsavings, the result of the cast would be wrong."}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": null, "afterCommit": {"oid": "87c5e75a7ce60b834e10c0ce3b44b96ba4fddc53", "author": {"user": {"login": "martint", "name": "Martin Traverso"}}, "url": "https://github.com/trinodb/trino/commit/87c5e75a7ce60b834e10c0ce3b44b96ba4fddc53", "committedDate": "2020-06-09T06:24:55Z", "message": "Fix incorrect cast from timestamp to time\n\nWhen the offset of the session timezone on the current day\ndiffers from the offset during the epoch due to, say, daylight\nsavings, the result of the cast would be wrong."}}]}}}, "rateLimit": {"limit": 5000, "remaining": 597, "cost": 1, "resetAt": "2021-10-28T19:08:13Z"}}}