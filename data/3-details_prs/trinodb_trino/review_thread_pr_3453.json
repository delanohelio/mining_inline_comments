{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDA0MzEzODY1", "number": 3453, "reviewThreads": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wMlQxMDo0MDo1OVrOD4pQXw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wNFQxMDowMjo1N1rOD47K2Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjYwNzIyNzgzOnYy", "diffSide": "RIGHT", "path": "presto-docs/src/main/sphinx/connector/mongodb.rst", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wMlQxMDo0MDo1OVrOGPiOnw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wMlQxMDo0MDo1OVrOGPiOnw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxODk0MjYyMw==", "bodyText": "Please extract refactoring (\"Make table wider\") to a preparatory commit", "url": "https://github.com/trinodb/trino/pull/3453#discussion_r418942623", "createdAt": "2020-05-02T10:40:59Z", "author": {"login": "findepi"}, "path": "presto-docs/src/main/sphinx/connector/mongodb.rst", "diffHunk": "@@ -34,24 +34,25 @@ Configuration Properties\n \n The following configuration properties are available:\n \n-===================================== ==============================================================\n-Property Name                         Description\n-===================================== ==============================================================\n-``mongodb.seeds``                     List of all MongoDB servers\n-``mongodb.schema-collection``         A collection which contains schema information\n-``mongodb.credentials``               List of credentials\n-``mongodb.min-connections-per-host``  The minimum size of the connection pool per host\n-``mongodb.connections-per-host``      The maximum size of the connection pool per host\n-``mongodb.max-wait-time``             The maximum wait time\n-``mongodb.connection-timeout``        The socket connect timeout\n-``mongodb.socket-timeout``            The socket timeout\n-``mongodb.socket-keep-alive``         Whether keep-alive is enabled on each socket\n-``mongodb.ssl.enabled``               Use TLS/SSL for connections to mongod/mongos\n-``mongodb.read-preference``           The read preference\n-``mongodb.write-concern``             The write concern\n-``mongodb.required-replica-set``      The required replica set name\n-``mongodb.cursor-batch-size``         The number of elements to return in a batch\n-===================================== ==============================================================\n+========================================== ==============================================================\n+Property Name                              Description\n+========================================== ==============================================================\n+``mongodb.seeds``                          List of all MongoDB servers", "state": "SUBMITTED", "replyTo": null, "originalCommit": null, "originalPosition": 25}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjYwNzIyODk4OnYy", "diffSide": "RIGHT", "path": "presto-mongodb/src/main/java/io/prestosql/plugin/mongodb/MongoSession.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wMlQxMDo0MjozNVrOGPiPJQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wM1QwMTowMzowMVrOGPngcQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxODk0Mjc1Nw==", "bodyText": "How expensive is this? how often is it called during planing of a query?\n(in JDBC we have caching for this, so question, if we need one here)", "url": "https://github.com/trinodb/trino/pull/3453#discussion_r418942757", "createdAt": "2020-05-02T10:42:35Z", "author": {"login": "findepi"}, "path": "presto-mongodb/src/main/java/io/prestosql/plugin/mongodb/MongoSession.java", "diffHunk": "@@ -606,6 +611,32 @@ else if (value instanceof Document) {\n         return Optional.ofNullable(typeSignature);\n     }\n \n+    private String toRemoteSchemaName(String schemaName)\n+    {\n+        if (!caseInsensitiveNameMatching) {\n+            return schemaName;\n+        }\n+        for (String remoteSchemaName : client.listDatabaseNames()) {\n+            if (schemaName.equals(remoteSchemaName.toLowerCase(ENGLISH))) {\n+                return remoteSchemaName;", "state": "SUBMITTED", "replyTo": null, "originalCommit": null, "originalPosition": 111}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxOTAyOTEwNQ==", "bodyText": "The first attempt is 3 times and subsequent attempts are only once.\nFinding the last schema takes:\n\n~70 msec / 1,000 schemas\n~700 msec / 10,000 schemas", "url": "https://github.com/trinodb/trino/pull/3453#discussion_r419029105", "createdAt": "2020-05-03T01:03:01Z", "author": {"login": "ebyhr"}, "path": "presto-mongodb/src/main/java/io/prestosql/plugin/mongodb/MongoSession.java", "diffHunk": "@@ -606,6 +611,32 @@ else if (value instanceof Document) {\n         return Optional.ofNullable(typeSignature);\n     }\n \n+    private String toRemoteSchemaName(String schemaName)\n+    {\n+        if (!caseInsensitiveNameMatching) {\n+            return schemaName;\n+        }\n+        for (String remoteSchemaName : client.listDatabaseNames()) {\n+            if (schemaName.equals(remoteSchemaName.toLowerCase(ENGLISH))) {\n+                return remoteSchemaName;", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxODk0Mjc1Nw=="}, "originalCommit": null, "originalPosition": 111}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjYwNzIyOTcxOnYy", "diffSide": "RIGHT", "path": "presto-mongodb/src/main/java/io/prestosql/plugin/mongodb/MongoSession.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wMlQxMDo0MzozM1rOGPiPew==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wM1QwMTowMzowMlrOGPngdA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxODk0Mjg0Mw==", "bodyText": "How expensive is this? how often is it called during planing of a query?\n(in JDBC we have caching for this, so question, if we need one here)", "url": "https://github.com/trinodb/trino/pull/3453#discussion_r418942843", "createdAt": "2020-05-02T10:43:33Z", "author": {"login": "findepi"}, "path": "presto-mongodb/src/main/java/io/prestosql/plugin/mongodb/MongoSession.java", "diffHunk": "@@ -606,6 +611,32 @@ else if (value instanceof Document) {\n         return Optional.ofNullable(typeSignature);\n     }\n \n+    private String toRemoteSchemaName(String schemaName)\n+    {\n+        if (!caseInsensitiveNameMatching) {\n+            return schemaName;\n+        }\n+        for (String remoteSchemaName : client.listDatabaseNames()) {\n+            if (schemaName.equals(remoteSchemaName.toLowerCase(ENGLISH))) {\n+                return remoteSchemaName;\n+            }\n+        }\n+        return schemaName;\n+    }\n+\n+    private String toRemoteTableName(String schemaName, String tableName)\n+    {\n+        if (!caseInsensitiveNameMatching) {\n+            return tableName;\n+        }\n+        for (String remoteTableName : client.getDatabase(schemaName).listCollectionNames()) {\n+            if (tableName.equals(remoteTableName.toLowerCase(ENGLISH))) {\n+                return remoteTableName;", "state": "SUBMITTED", "replyTo": null, "originalCommit": null, "originalPosition": 124}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxOTAyOTEwOA==", "bodyText": "The first attempt is 3 times and subsequent attempts are only once.\nFinding the last table takes:\n\n~30 msec / 1,000 tables\n~300 msec / 10,000 tables", "url": "https://github.com/trinodb/trino/pull/3453#discussion_r419029108", "createdAt": "2020-05-03T01:03:02Z", "author": {"login": "ebyhr"}, "path": "presto-mongodb/src/main/java/io/prestosql/plugin/mongodb/MongoSession.java", "diffHunk": "@@ -606,6 +611,32 @@ else if (value instanceof Document) {\n         return Optional.ofNullable(typeSignature);\n     }\n \n+    private String toRemoteSchemaName(String schemaName)\n+    {\n+        if (!caseInsensitiveNameMatching) {\n+            return schemaName;\n+        }\n+        for (String remoteSchemaName : client.listDatabaseNames()) {\n+            if (schemaName.equals(remoteSchemaName.toLowerCase(ENGLISH))) {\n+                return remoteSchemaName;\n+            }\n+        }\n+        return schemaName;\n+    }\n+\n+    private String toRemoteTableName(String schemaName, String tableName)\n+    {\n+        if (!caseInsensitiveNameMatching) {\n+            return tableName;\n+        }\n+        for (String remoteTableName : client.getDatabase(schemaName).listCollectionNames()) {\n+            if (tableName.equals(remoteTableName.toLowerCase(ENGLISH))) {\n+                return remoteTableName;", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxODk0Mjg0Mw=="}, "originalCommit": null, "originalPosition": 124}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjYxMDE1NTk4OnYy", "diffSide": "RIGHT", "path": "presto-mongodb/src/main/java/io/prestosql/plugin/mongodb/MongoSession.java", "isResolved": true, "comments": {"totalCount": 7, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wNFQxMDowMDozN1rOGP53CQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xN1QwOTo0NDozN1rOHBhxgA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxOTMyOTgwMQ==", "bodyText": "ImmutableList.copyOf is redundant", "url": "https://github.com/trinodb/trino/pull/3453#discussion_r419329801", "createdAt": "2020-05-04T10:00:37Z", "author": {"login": "findepi"}, "path": "presto-mongodb/src/main/java/io/prestosql/plugin/mongodb/MongoSession.java", "diffHunk": "@@ -141,15 +144,18 @@ public void shutdown()\n \n     public List<String> getAllSchemas()\n     {\n-        return ImmutableList.copyOf(client.listDatabaseNames());\n+        return ImmutableList.copyOf(client.listDatabaseNames()).stream()", "state": "SUBMITTED", "replyTo": null, "originalCommit": null, "originalPosition": 29}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxOTQ0NzYzNg==", "bodyText": "client.listDatabaseNames() returns MongoIterable<String> (\u2260List<String>).", "url": "https://github.com/trinodb/trino/pull/3453#discussion_r419447636", "createdAt": "2020-05-04T13:45:44Z", "author": {"login": "ebyhr"}, "path": "presto-mongodb/src/main/java/io/prestosql/plugin/mongodb/MongoSession.java", "diffHunk": "@@ -141,15 +144,18 @@ public void shutdown()\n \n     public List<String> getAllSchemas()\n     {\n-        return ImmutableList.copyOf(client.listDatabaseNames());\n+        return ImmutableList.copyOf(client.listDatabaseNames()).stream()", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxOTMyOTgwMQ=="}, "originalCommit": null, "originalPosition": 29}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxOTUwMDQ5NQ==", "bodyText": "you have ImmutableList.copyOf and collect(toImmutableList())", "url": "https://github.com/trinodb/trino/pull/3453#discussion_r419500495", "createdAt": "2020-05-04T14:57:54Z", "author": {"login": "findepi"}, "path": "presto-mongodb/src/main/java/io/prestosql/plugin/mongodb/MongoSession.java", "diffHunk": "@@ -141,15 +144,18 @@ public void shutdown()\n \n     public List<String> getAllSchemas()\n     {\n-        return ImmutableList.copyOf(client.listDatabaseNames());\n+        return ImmutableList.copyOf(client.listDatabaseNames()).stream()", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxOTMyOTgwMQ=="}, "originalCommit": null, "originalPosition": 29}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxOTgzNzk3Mw==", "bodyText": "Replaced with toList(). Please let me know if my understanding is wrong.", "url": "https://github.com/trinodb/trino/pull/3453#discussion_r419837973", "createdAt": "2020-05-05T02:54:45Z", "author": {"login": "ebyhr"}, "path": "presto-mongodb/src/main/java/io/prestosql/plugin/mongodb/MongoSession.java", "diffHunk": "@@ -141,15 +144,18 @@ public void shutdown()\n \n     public List<String> getAllSchemas()\n     {\n-        return ImmutableList.copyOf(client.listDatabaseNames());\n+        return ImmutableList.copyOf(client.listDatabaseNames()).stream()", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxOTMyOTgwMQ=="}, "originalCommit": null, "originalPosition": 29}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MTMyNTc0OA==", "bodyText": "Was this change saved? I still see collect(toImmutableList())", "url": "https://github.com/trinodb/trino/pull/3453#discussion_r471325748", "createdAt": "2020-08-17T08:34:26Z", "author": {"login": "sajjoseph"}, "path": "presto-mongodb/src/main/java/io/prestosql/plugin/mongodb/MongoSession.java", "diffHunk": "@@ -141,15 +144,18 @@ public void shutdown()\n \n     public List<String> getAllSchemas()\n     {\n-        return ImmutableList.copyOf(client.listDatabaseNames());\n+        return ImmutableList.copyOf(client.listDatabaseNames()).stream()", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxOTMyOTgwMQ=="}, "originalCommit": null, "originalPosition": 29}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MTMyODczNA==", "bodyText": "@sajjoseph Though I'm not sure about the intention of your question, collect(toImmutableList()) is the expected code. There was conversation on Slack.", "url": "https://github.com/trinodb/trino/pull/3453#discussion_r471328734", "createdAt": "2020-08-17T08:40:01Z", "author": {"login": "ebyhr"}, "path": "presto-mongodb/src/main/java/io/prestosql/plugin/mongodb/MongoSession.java", "diffHunk": "@@ -141,15 +144,18 @@ public void shutdown()\n \n     public List<String> getAllSchemas()\n     {\n-        return ImmutableList.copyOf(client.listDatabaseNames());\n+        return ImmutableList.copyOf(client.listDatabaseNames()).stream()", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxOTMyOTgwMQ=="}, "originalCommit": null, "originalPosition": 29}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MTM2Mzk2OA==", "bodyText": "Thanks @ebyhr . I am referring to your comment earlier where you said that you replaced with toList(). I don't see that change.", "url": "https://github.com/trinodb/trino/pull/3453#discussion_r471363968", "createdAt": "2020-08-17T09:44:37Z", "author": {"login": "sajjoseph"}, "path": "presto-mongodb/src/main/java/io/prestosql/plugin/mongodb/MongoSession.java", "diffHunk": "@@ -141,15 +144,18 @@ public void shutdown()\n \n     public List<String> getAllSchemas()\n     {\n-        return ImmutableList.copyOf(client.listDatabaseNames());\n+        return ImmutableList.copyOf(client.listDatabaseNames()).stream()", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxOTMyOTgwMQ=="}, "originalCommit": null, "originalPosition": 29}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjYxMDE2MjgxOnYy", "diffSide": "RIGHT", "path": "presto-mongodb/src/main/java/io/prestosql/plugin/mongodb/MongoSession.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wNFQxMDowMjo1N1rOGP57Yw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wNFQxMDowMzoxNFrOGP579g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxOTMzMDkxNQ==", "bodyText": "add\nverify(schemaName.equals(schemaName.toLowerCase(ENGLISH)), \"schemaName not in lower-case: %s\", schemaName);\n\nat the top of the method", "url": "https://github.com/trinodb/trino/pull/3453#discussion_r419330915", "createdAt": "2020-05-04T10:02:57Z", "author": {"login": "findepi"}, "path": "presto-mongodb/src/main/java/io/prestosql/plugin/mongodb/MongoSession.java", "diffHunk": "@@ -606,6 +611,32 @@ else if (value instanceof Document) {\n         return Optional.ofNullable(typeSignature);\n     }\n \n+    private String toRemoteSchemaName(String schemaName)\n+    {\n+        if (!caseInsensitiveNameMatching) {\n+            return schemaName;\n+        }\n+        for (String remoteSchemaName : client.listDatabaseNames()) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": null, "originalPosition": 109}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxOTMzMTA2Mg==", "bodyText": "same in the table mapping method", "url": "https://github.com/trinodb/trino/pull/3453#discussion_r419331062", "createdAt": "2020-05-04T10:03:14Z", "author": {"login": "findepi"}, "path": "presto-mongodb/src/main/java/io/prestosql/plugin/mongodb/MongoSession.java", "diffHunk": "@@ -606,6 +611,32 @@ else if (value instanceof Document) {\n         return Optional.ofNullable(typeSignature);\n     }\n \n+    private String toRemoteSchemaName(String schemaName)\n+    {\n+        if (!caseInsensitiveNameMatching) {\n+            return schemaName;\n+        }\n+        for (String remoteSchemaName : client.listDatabaseNames()) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxOTMzMDkxNQ=="}, "originalCommit": null, "originalPosition": 109}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 164, "cost": 1, "resetAt": "2021-11-13T12:10:21Z"}}}