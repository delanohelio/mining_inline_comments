{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDY5Mzc2Njk3", "number": 4869, "reviewThreads": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xOFQxMDozNjozN1rOEZakGg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xOFQxNTozMDoyNlrOEZiZIQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjk1MDg1MDgyOnYy", "diffSide": "RIGHT", "path": "presto-docs/src/main/sphinx/connector/hive-caching.rst", "isResolved": false, "comments": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xOFQxMDozNjozN1rOHCNkiQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xOFQxNTozMjoyOVrOHCaKlg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MjA4MTU0NQ==", "bodyText": "this is only valid for read-though mode, for async mode, we still need to account for jmx.current.\"metrics:name=rubix.bookkeeper.count.async_downloaded_mb\" \nqubole/rubix#438 will introduce total_system_source_mb_read global metrics", "url": "https://github.com/trinodb/trino/pull/4869#discussion_r472081545", "createdAt": "2020-08-18T10:36:37Z", "author": {"login": "sopel39"}, "path": "presto-docs/src/main/sphinx/connector/hive-caching.rst", "diffHunk": "@@ -177,16 +177,17 @@ The implementation of the cache exposes a `number of metrics\n :doc:`inspect these and other metrics directly in Presto with the JMX connector\n or in external tools </admin/jmx>`.\n \n-The following example query returns the total amount of data fetched by the\n-BookKeeper on the coordinator and all the separate nodes on the workers in the\n-default async mode:\n+If you are using JMX connector, basic caching statistics are exposed via\n+``jmx.current.\"rubix:catalog=<catalog_name>,name=stats\"`` table.\n+You can read more detailed statistics by querying ``jmx.current.\"rubix:catalog=<catalog_name>,name=stats``.\n+You need to replace ``<catalog_name>`` with name of you Hive catalog.\n+\n+The following example query returns the total amount of data fetched from source\n+filesystem by all Presto nodes:\n \n .. code-block:: sql\n \n-  SELECT fs.readfromremote + async_downloaded_mb.count\n-  FROM jmx.current.\"rubix:catalog=hive,name=stats\" fs,\n-       jmx.current.\"metrics:name=rubix.bookkeeper.count.async_downloaded_mb\" async_downloaded_mb\n-  WHERE fs.node = async_downloaded_mb.node;\n+  SELECT sum(mb_read_from_source) FROM jmx.current.\"rubix:catalog=hive,name=stats\";", "state": "SUBMITTED", "replyTo": null, "originalCommit": null, "originalPosition": 21}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MjA4NzA2Mg==", "bodyText": "Thanks. I chaned the example query to return average cache hit. I would rather not mix-in metrics:name=rubix.bookkeeper.count.async_downloaded_mb into example as it does not play well with presto (no catalog name in key).", "url": "https://github.com/trinodb/trino/pull/4869#discussion_r472087062", "createdAt": "2020-08-18T10:47:36Z", "author": {"login": "losipiuk"}, "path": "presto-docs/src/main/sphinx/connector/hive-caching.rst", "diffHunk": "@@ -177,16 +177,17 @@ The implementation of the cache exposes a `number of metrics\n :doc:`inspect these and other metrics directly in Presto with the JMX connector\n or in external tools </admin/jmx>`.\n \n-The following example query returns the total amount of data fetched by the\n-BookKeeper on the coordinator and all the separate nodes on the workers in the\n-default async mode:\n+If you are using JMX connector, basic caching statistics are exposed via\n+``jmx.current.\"rubix:catalog=<catalog_name>,name=stats\"`` table.\n+You can read more detailed statistics by querying ``jmx.current.\"rubix:catalog=<catalog_name>,name=stats``.\n+You need to replace ``<catalog_name>`` with name of you Hive catalog.\n+\n+The following example query returns the total amount of data fetched from source\n+filesystem by all Presto nodes:\n \n .. code-block:: sql\n \n-  SELECT fs.readfromremote + async_downloaded_mb.count\n-  FROM jmx.current.\"rubix:catalog=hive,name=stats\" fs,\n-       jmx.current.\"metrics:name=rubix.bookkeeper.count.async_downloaded_mb\" async_downloaded_mb\n-  WHERE fs.node = async_downloaded_mb.node;\n+  SELECT sum(mb_read_from_source) FROM jmx.current.\"rubix:catalog=hive,name=stats\";", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MjA4MTU0NQ=="}, "originalCommit": null, "originalPosition": 21}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MjA5MTQyMw==", "bodyText": "I would rather not mix-in metrics:name=rubix.bookkeeper.count.async_downloaded_mb into example as it does not play well with presto (no catalog name in key).\n\nRight, cache_hit is fine, yet it doesn't tell the whole story. How do you know if Presto is not going directly to data source?", "url": "https://github.com/trinodb/trino/pull/4869#discussion_r472091423", "createdAt": "2020-08-18T10:56:18Z", "author": {"login": "sopel39"}, "path": "presto-docs/src/main/sphinx/connector/hive-caching.rst", "diffHunk": "@@ -177,16 +177,17 @@ The implementation of the cache exposes a `number of metrics\n :doc:`inspect these and other metrics directly in Presto with the JMX connector\n or in external tools </admin/jmx>`.\n \n-The following example query returns the total amount of data fetched by the\n-BookKeeper on the coordinator and all the separate nodes on the workers in the\n-default async mode:\n+If you are using JMX connector, basic caching statistics are exposed via\n+``jmx.current.\"rubix:catalog=<catalog_name>,name=stats\"`` table.\n+You can read more detailed statistics by querying ``jmx.current.\"rubix:catalog=<catalog_name>,name=stats``.\n+You need to replace ``<catalog_name>`` with name of you Hive catalog.\n+\n+The following example query returns the total amount of data fetched from source\n+filesystem by all Presto nodes:\n \n .. code-block:: sql\n \n-  SELECT fs.readfromremote + async_downloaded_mb.count\n-  FROM jmx.current.\"rubix:catalog=hive,name=stats\" fs,\n-       jmx.current.\"metrics:name=rubix.bookkeeper.count.async_downloaded_mb\" async_downloaded_mb\n-  WHERE fs.node = async_downloaded_mb.node;\n+  SELECT sum(mb_read_from_source) FROM jmx.current.\"rubix:catalog=hive,name=stats\";", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MjA4MTU0NQ=="}, "originalCommit": null, "originalPosition": 21}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MjA5MzQ1NA==", "bodyText": "We do not. But I think the bottom line is that we just cannot reasonably provide this information until qubole/rubix#438.\nWell we can as long as only single connector uses caching, but I do not want to elaborate too much about that in the documentation.\nI would rather push qubole/rubix#438 and update the documentation with example regarding \"data read from source\" as it gets merged and we update rubix.", "url": "https://github.com/trinodb/trino/pull/4869#discussion_r472093454", "createdAt": "2020-08-18T11:00:21Z", "author": {"login": "losipiuk"}, "path": "presto-docs/src/main/sphinx/connector/hive-caching.rst", "diffHunk": "@@ -177,16 +177,17 @@ The implementation of the cache exposes a `number of metrics\n :doc:`inspect these and other metrics directly in Presto with the JMX connector\n or in external tools </admin/jmx>`.\n \n-The following example query returns the total amount of data fetched by the\n-BookKeeper on the coordinator and all the separate nodes on the workers in the\n-default async mode:\n+If you are using JMX connector, basic caching statistics are exposed via\n+``jmx.current.\"rubix:catalog=<catalog_name>,name=stats\"`` table.\n+You can read more detailed statistics by querying ``jmx.current.\"rubix:catalog=<catalog_name>,name=stats``.\n+You need to replace ``<catalog_name>`` with name of you Hive catalog.\n+\n+The following example query returns the total amount of data fetched from source\n+filesystem by all Presto nodes:\n \n .. code-block:: sql\n \n-  SELECT fs.readfromremote + async_downloaded_mb.count\n-  FROM jmx.current.\"rubix:catalog=hive,name=stats\" fs,\n-       jmx.current.\"metrics:name=rubix.bookkeeper.count.async_downloaded_mb\" async_downloaded_mb\n-  WHERE fs.node = async_downloaded_mb.node;\n+  SELECT sum(mb_read_from_source) FROM jmx.current.\"rubix:catalog=hive,name=stats\";", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MjA4MTU0NQ=="}, "originalCommit": null, "originalPosition": 21}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MjI4Nzg5NA==", "bodyText": "That sounds reasonable to me.", "url": "https://github.com/trinodb/trino/pull/4869#discussion_r472287894", "createdAt": "2020-08-18T15:32:29Z", "author": {"login": "mosabua"}, "path": "presto-docs/src/main/sphinx/connector/hive-caching.rst", "diffHunk": "@@ -177,16 +177,17 @@ The implementation of the cache exposes a `number of metrics\n :doc:`inspect these and other metrics directly in Presto with the JMX connector\n or in external tools </admin/jmx>`.\n \n-The following example query returns the total amount of data fetched by the\n-BookKeeper on the coordinator and all the separate nodes on the workers in the\n-default async mode:\n+If you are using JMX connector, basic caching statistics are exposed via\n+``jmx.current.\"rubix:catalog=<catalog_name>,name=stats\"`` table.\n+You can read more detailed statistics by querying ``jmx.current.\"rubix:catalog=<catalog_name>,name=stats``.\n+You need to replace ``<catalog_name>`` with name of you Hive catalog.\n+\n+The following example query returns the total amount of data fetched from source\n+filesystem by all Presto nodes:\n \n .. code-block:: sql\n \n-  SELECT fs.readfromremote + async_downloaded_mb.count\n-  FROM jmx.current.\"rubix:catalog=hive,name=stats\" fs,\n-       jmx.current.\"metrics:name=rubix.bookkeeper.count.async_downloaded_mb\" async_downloaded_mb\n-  WHERE fs.node = async_downloaded_mb.node;\n+  SELECT sum(mb_read_from_source) FROM jmx.current.\"rubix:catalog=hive,name=stats\";", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MjA4MTU0NQ=="}, "originalCommit": null, "originalPosition": 21}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjk1MjEwMjcxOnYy", "diffSide": "RIGHT", "path": "presto-docs/src/main/sphinx/connector/hive-caching.rst", "isResolved": false, "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xOFQxNToyNDowN1rOHCZxxg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yMFQwMDo1MzoyMFrOHDja3Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MjI4MTU0Mg==", "bodyText": "Remove \"If you are using JXM connector\" sins this is already said earlier.\nBasic caching statistics for the catalog are available in the ``jmx.current.\"rubix:catalog=<catalog_name>,name=stats\"`` table. The table ``jmx.current.\"rubix:catalog=<catalog_name>,name=stats`` contains more detailed statistics.\n\nUse the above for the whole paragraph.", "url": "https://github.com/trinodb/trino/pull/4869#discussion_r472281542", "createdAt": "2020-08-18T15:24:07Z", "author": {"login": "mosabua"}, "path": "presto-docs/src/main/sphinx/connector/hive-caching.rst", "diffHunk": "@@ -177,16 +177,16 @@ The implementation of the cache exposes a `number of metrics\n :doc:`inspect these and other metrics directly in Presto with the JMX connector\n or in external tools </admin/jmx>`.\n \n-The following example query returns the total amount of data fetched by the\n-BookKeeper on the coordinator and all the separate nodes on the workers in the\n-default async mode:\n+If you are using JMX connector, basic caching statistics are exposed via", "state": "SUBMITTED", "replyTo": null, "originalCommit": null, "originalPosition": 7}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MjMwNDY0Mg==", "bodyText": "Should it be\nThe table ``jmx.current.\"rubix:catalog=<catalog_name>,name=stats`` \n\nOr\nThe ``jmx.current.\"rubix:catalog=<catalog_name>,name=stats`` table\n\nLatter sound more proper to me, but I may be very wrong here :)", "url": "https://github.com/trinodb/trino/pull/4869#discussion_r472304642", "createdAt": "2020-08-18T15:56:25Z", "author": {"login": "losipiuk"}, "path": "presto-docs/src/main/sphinx/connector/hive-caching.rst", "diffHunk": "@@ -177,16 +177,16 @@ The implementation of the cache exposes a `number of metrics\n :doc:`inspect these and other metrics directly in Presto with the JMX connector\n or in external tools </admin/jmx>`.\n \n-The following example query returns the total amount of data fetched by the\n-BookKeeper on the coordinator and all the separate nodes on the workers in the\n-default async mode:\n+If you are using JMX connector, basic caching statistics are exposed via", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MjI4MTU0Mg=="}, "originalCommit": null, "originalPosition": 7}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MzQ4ODA5Mw==", "bodyText": "either is fine", "url": "https://github.com/trinodb/trino/pull/4869#discussion_r473488093", "createdAt": "2020-08-20T00:53:20Z", "author": {"login": "mosabua"}, "path": "presto-docs/src/main/sphinx/connector/hive-caching.rst", "diffHunk": "@@ -177,16 +177,16 @@ The implementation of the cache exposes a `number of metrics\n :doc:`inspect these and other metrics directly in Presto with the JMX connector\n or in external tools </admin/jmx>`.\n \n-The following example query returns the total amount of data fetched by the\n-BookKeeper on the coordinator and all the separate nodes on the workers in the\n-default async mode:\n+If you are using JMX connector, basic caching statistics are exposed via", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MjI4MTU0Mg=="}, "originalCommit": null, "originalPosition": 7}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjk1MjEyNzgxOnYy", "diffSide": "RIGHT", "path": "presto-docs/src/main/sphinx/connector/hive-caching.rst", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xOFQxNToyOToxM1rOHCaBSw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xOFQxNjowMDowN1rOHCbVww==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MjI4NTUxNQ==", "bodyText": "The following example query returns the average cache hit ratio for the ``hive`` catalog:", "url": "https://github.com/trinodb/trino/pull/4869#discussion_r472285515", "createdAt": "2020-08-18T15:29:13Z", "author": {"login": "mosabua"}, "path": "presto-docs/src/main/sphinx/connector/hive-caching.rst", "diffHunk": "@@ -177,16 +177,16 @@ The implementation of the cache exposes a `number of metrics\n :doc:`inspect these and other metrics directly in Presto with the JMX connector\n or in external tools </admin/jmx>`.\n \n-The following example query returns the total amount of data fetched by the\n-BookKeeper on the coordinator and all the separate nodes on the workers in the\n-default async mode:\n+If you are using JMX connector, basic caching statistics are exposed via\n+``jmx.current.\"rubix:catalog=<catalog_name>,name=stats\"`` table.\n+You can read more detailed statistics by querying ``jmx.current.\"rubix:catalog=<catalog_name>,name=stats``.\n+You need to replace ``<catalog_name>`` with name of you Hive catalog.\n+\n+The following example query returns average cache hit ratio for given Hive catalog.", "state": "SUBMITTED", "replyTo": null, "originalCommit": null, "originalPosition": 12}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MjMwNzEzOQ==", "bodyText": "A hint @mosabua:\nIf you are suggesting rewording of whole paragraphs you can use suggestion mechanism of Github code review.\nTo do so:\n\nmark the lines for which you want to suggest alternative.\nclick comment\nclick +/- button in the comment editor\nprovide suggestion.\n\nScreenshot:", "url": "https://github.com/trinodb/trino/pull/4869#discussion_r472307139", "createdAt": "2020-08-18T16:00:07Z", "author": {"login": "losipiuk"}, "path": "presto-docs/src/main/sphinx/connector/hive-caching.rst", "diffHunk": "@@ -177,16 +177,16 @@ The implementation of the cache exposes a `number of metrics\n :doc:`inspect these and other metrics directly in Presto with the JMX connector\n or in external tools </admin/jmx>`.\n \n-The following example query returns the total amount of data fetched by the\n-BookKeeper on the coordinator and all the separate nodes on the workers in the\n-default async mode:\n+If you are using JMX connector, basic caching statistics are exposed via\n+``jmx.current.\"rubix:catalog=<catalog_name>,name=stats\"`` table.\n+You can read more detailed statistics by querying ``jmx.current.\"rubix:catalog=<catalog_name>,name=stats``.\n+You need to replace ``<catalog_name>`` with name of you Hive catalog.\n+\n+The following example query returns average cache hit ratio for given Hive catalog.", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MjI4NTUxNQ=="}, "originalCommit": null, "originalPosition": 12}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjk1MjEzMzQ1OnYy", "diffSide": "RIGHT", "path": "presto-docs/src/main/sphinx/connector/hive-caching.rst", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xOFQxNTozMDoyNlrOHCaEwQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xOFQxNTozMDoyNlrOHCaEwQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MjI4NjQwMQ==", "bodyText": "SELECT avg(cache_hit) \nFROM jmx.current.\"rubix:catalog=hive,name=stats\" \nWHERE NOT is_nan(cache_hit);", "url": "https://github.com/trinodb/trino/pull/4869#discussion_r472286401", "createdAt": "2020-08-18T15:30:26Z", "author": {"login": "mosabua"}, "path": "presto-docs/src/main/sphinx/connector/hive-caching.rst", "diffHunk": "@@ -177,16 +177,16 @@ The implementation of the cache exposes a `number of metrics\n :doc:`inspect these and other metrics directly in Presto with the JMX connector\n or in external tools </admin/jmx>`.\n \n-The following example query returns the total amount of data fetched by the\n-BookKeeper on the coordinator and all the separate nodes on the workers in the\n-default async mode:\n+If you are using JMX connector, basic caching statistics are exposed via\n+``jmx.current.\"rubix:catalog=<catalog_name>,name=stats\"`` table.\n+You can read more detailed statistics by querying ``jmx.current.\"rubix:catalog=<catalog_name>,name=stats``.\n+You need to replace ``<catalog_name>`` with name of you Hive catalog.\n+\n+The following example query returns average cache hit ratio for given Hive catalog.\n \n .. code-block:: sql\n \n-  SELECT fs.readfromremote + async_downloaded_mb.count\n-  FROM jmx.current.\"rubix:catalog=hive,name=stats\" fs,\n-       jmx.current.\"metrics:name=rubix.bookkeeper.count.async_downloaded_mb\" async_downloaded_mb\n-  WHERE fs.node = async_downloaded_mb.node;\n+  SELECT avg(cache_hit) FROM jmx.current.\"rubix:catalog=hive,name=stats\" where not is_nan(cache_hit);", "state": "SUBMITTED", "replyTo": null, "originalCommit": null, "originalPosition": 20}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3497, "cost": 1, "resetAt": "2021-11-12T12:57:47Z"}}}