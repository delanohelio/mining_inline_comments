{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDA0MDU2OTUx", "number": 3445, "reviewThreads": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yMFQyMDowMDoyMFrODz5f_Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yMFQyMDowMDoyMFrODz5f_Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjU1NzQ2MDQ1OnYy", "diffSide": "RIGHT", "path": "presto-orc/src/main/java/io/prestosql/orc/reader/StructColumnReader.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yMFQyMDowMDoyMFrOGIlS6A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yMVQwMjoyNDoxNVrOGIvjXg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMTY1Mjg0MA==", "bodyText": "Why do we need this branch? If I'm reading things correctly, readLayout.getFieldLayout(fieldName) already does the check internally and knows to return fullyProjectedLayout().", "url": "https://github.com/trinodb/trino/pull/3445#discussion_r411652840", "createdAt": "2020-04-20T20:00:20Z", "author": {"login": "martint"}, "path": "presto-orc/src/main/java/io/prestosql/orc/reader/StructColumnReader.java", "diffHunk": "@@ -96,8 +98,17 @@\n             fieldNames.add(fieldName);\n \n             OrcColumn fieldStream = nestedColumns.get(fieldName);\n+\n             if (fieldStream != null) {\n-                structFields.put(fieldName, createColumnReader(field.getType(), fieldStream, systemMemoryContext, blockFactory));\n+                if (readLayout.isFullyProjected()) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": null, "originalPosition": 32}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMTgyMDg5NA==", "bodyText": "Good catch! you're totally right. Earlier I was split on whether,\nwhen ProjectedLayout::fieldLayouts is empty\n(1) have getFieldLayout return a fullyProjectedLayout OR\n(2) throw an exception, since we may not want to return fullyProjectedLayout for any random field name.\n(i.e. invoking getFieldLayout(z) for a fully projected layout of a, where a has only two fields x and y.)\nBut since we only use this method after the fieldStream != null check, I think (1) should be okay.\nRemoved the check and the isFullyProjected method.", "url": "https://github.com/trinodb/trino/pull/3445#discussion_r411820894", "createdAt": "2020-04-21T02:24:15Z", "author": {"login": "phd3"}, "path": "presto-orc/src/main/java/io/prestosql/orc/reader/StructColumnReader.java", "diffHunk": "@@ -96,8 +98,17 @@\n             fieldNames.add(fieldName);\n \n             OrcColumn fieldStream = nestedColumns.get(fieldName);\n+\n             if (fieldStream != null) {\n-                structFields.put(fieldName, createColumnReader(field.getType(), fieldStream, systemMemoryContext, blockFactory));\n+                if (readLayout.isFullyProjected()) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMTY1Mjg0MA=="}, "originalCommit": null, "originalPosition": 32}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 151, "cost": 1, "resetAt": "2021-11-13T12:10:21Z"}}}