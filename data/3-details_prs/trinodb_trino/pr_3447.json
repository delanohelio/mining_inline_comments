{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDA0MTYzOTk5", "number": 3447, "title": "Support composite publish_address in Elasticsearch", "bodyText": "Starting with version 7.x, the publish_address field can contain\naddresses of the following form:\ncname/ip:port\nip:port\n\nIf the CNAME is present, the connector will now use the CNAME and port.\nOtherwise, it will use the IP and port.", "createdAt": "2020-04-16T07:18:04Z", "url": "https://github.com/trinodb/trino/pull/3447", "merged": true, "mergeCommit": {"oid": "68c939223f65d4b50fcae332611688b4f3802954"}, "closed": true, "closedAt": "2020-04-21T01:41:32Z", "author": {"login": "martint"}, "timelineItems": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcY7CK3AFqTM5NTk0Mzc0Nw==", "endCursor": "Y3Vyc29yOnYyOpPPAAABcZkTWBABqjMyNTMyNTYzNTU=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzk1OTQzNzQ3", "url": "https://github.com/trinodb/trino/pull/3447#pullrequestreview-395943747", "createdAt": "2020-04-18T19:24:39Z", "commit": null, "state": "COMMENTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xOFQxOToyNDozOVrOGHtljw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xOFQxOToyNjoyMlrOGHtmLg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMDc0MDExMQ==", "bodyText": "the ^ and $ are redundant", "url": "https://github.com/trinodb/trino/pull/3447#discussion_r410740111", "createdAt": "2020-04-18T19:24:39Z", "author": {"login": "findepi"}, "path": "presto-elasticsearch/src/main/java/io/prestosql/elasticsearch/client/ElasticsearchClient.java", "diffHunk": "@@ -108,6 +111,8 @@\n     private static final JsonCodec<NodesResponse> NODES_RESPONSE_CODEC = jsonCodec(NodesResponse.class);\n     private static final ObjectMapper OBJECT_MAPPER = new ObjectMapperProvider().get();\n \n+    private static final Pattern ADDRESS_PATTERN = Pattern.compile(\"^((?<cname>[^/]+)/)?(?<ip>.+):(?<port>\\\\d+)$\");", "state": "SUBMITTED", "replyTo": null, "originalCommit": null, "originalPosition": 21}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMDc0MDI3MA==", "bodyText": "previously if the address was eg <ip> (no port), it would still be accepted\ni understand this is conscious not to accept it (perhaps impossible), but could be good to mention in cmt msg, or even splits commits into\n\nvalidate address pattern\nadd support for hostname/", "url": "https://github.com/trinodb/trino/pull/3447#discussion_r410740270", "createdAt": "2020-04-18T19:26:22Z", "author": {"login": "findepi"}, "path": "presto-elasticsearch/src/main/java/io/prestosql/elasticsearch/client/ElasticsearchClient.java", "diffHunk": "@@ -657,6 +665,26 @@ public TimeStat getNextPageStats()\n         return handler.process(body);\n     }\n \n+    @VisibleForTesting\n+    static Optional<String> extractAddress(String address)\n+    {\n+        Matcher matcher = ADDRESS_PATTERN.matcher(address);\n+\n+        if (!matcher.matches()) {\n+            return Optional.empty();", "state": "SUBMITTED", "replyTo": null, "originalCommit": null, "originalPosition": 48}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": null, "afterCommit": null}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzk2MTg2MjY5", "url": "https://github.com/trinodb/trino/pull/3447#pullrequestreview-396186269", "createdAt": "2020-04-20T07:00:26Z", "commit": null, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e69fa6bd72e63d1019fb59a3121170b41c889403", "author": {"user": {"login": "martint", "name": "Martin Traverso"}}, "url": "https://github.com/trinodb/trino/commit/e69fa6bd72e63d1019fb59a3121170b41c889403", "committedDate": "2020-04-20T19:31:44Z", "message": "Support composite publish_address in Elasticsearch\n\nStarting with version 7.x, the publish_address field can contain\naddresses of the following form:\n\n    cname/ip:port\n    ip:port\n\nIf the CNAME is present, the connector will now use the CNAME and port.\nOtherwise, it will use the IP and port.\n\nThis change also validates that the address matches one of the above formats."}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": null, "afterCommit": {"oid": "e69fa6bd72e63d1019fb59a3121170b41c889403", "author": {"user": {"login": "martint", "name": "Martin Traverso"}}, "url": "https://github.com/trinodb/trino/commit/e69fa6bd72e63d1019fb59a3121170b41c889403", "committedDate": "2020-04-20T19:31:44Z", "message": "Support composite publish_address in Elasticsearch\n\nStarting with version 7.x, the publish_address field can contain\naddresses of the following form:\n\n    cname/ip:port\n    ip:port\n\nIf the CNAME is present, the connector will now use the CNAME and port.\nOtherwise, it will use the IP and port.\n\nThis change also validates that the address matches one of the above formats."}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1538, "cost": 1, "resetAt": "2021-10-28T19:08:13Z"}}}