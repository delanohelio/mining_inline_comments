{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDE0MjQ4NzIz", "number": 3651, "title": "Move delete analysis to the analyzer", "bodyText": "The derivation of the row id field was being done during planning\ninstead of analysis. This also resulted in having to special-case\nthe planning of the source table plan.", "createdAt": "2020-05-06T18:03:03Z", "url": "https://github.com/trinodb/trino/pull/3651", "merged": true, "mergeCommit": {"oid": "7c090491a3682640af4c932b9cffb813d5ad480a"}, "closed": true, "closedAt": "2020-05-08T01:44:14Z", "author": {"login": "martint"}, "timelineItems": {"totalCount": 8, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcetArqgBqjMzMDk3NTgyMjg=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcfHlcTAFqTQwNzkzMzcxNw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "HeadRefForcePushedEvent", "beforeCommit": null, "afterCommit": null}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": null, "afterCommit": null}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": null, "afterCommit": null}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDA3MDg2MDA5", "url": "https://github.com/trinodb/trino/pull/3651#pullrequestreview-407086009", "createdAt": "2020-05-07T01:05:53Z", "commit": null, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wN1QwMTowNTo1M1rOGRqxow==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wN1QwMTowNTo1M1rOGRqxow==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMTE3OTgxMQ==", "bodyText": "TPCH connector doesn't support DELETE", "url": "https://github.com/trinodb/trino/pull/3651#discussion_r421179811", "createdAt": "2020-05-07T01:05:53Z", "author": {"login": "martint"}, "path": "presto-tests/src/test/java/io/prestosql/tests/AbstractTestEngineOnlyQueries.java", "diffHunk": "@@ -800,7 +800,6 @@ public void testDescribeOutputNamedAndUnnamed()\n     public void testDescribeOutputNonSelect()\n     {\n         assertDescribeOutputRowCount(\"CREATE TABLE foo AS SELECT * FROM nation\");\n-        assertDescribeOutputRowCount(\"DELETE FROM orders\");", "state": "SUBMITTED", "replyTo": null, "originalCommit": null, "originalPosition": 4}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDA3MjMyNTYx", "url": "https://github.com/trinodb/trino/pull/3651#pullrequestreview-407232561", "createdAt": "2020-05-07T07:56:56Z", "commit": null, "state": "APPROVED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wN1QwNzo1Njo1NlrOGRyyVA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wN1QwNzo1Njo1NlrOGRyyVA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMTMxMTA2MA==", "bodyText": "Why that happened? Does it deserve a comment in the code?", "url": "https://github.com/trinodb/trino/pull/3651#discussion_r421311060", "createdAt": "2020-05-07T07:56:56Z", "author": {"login": "kokosing"}, "path": "presto-main/src/main/java/io/prestosql/sql/analyzer/Analysis.java", "diffHunk": "@@ -783,6 +787,7 @@ public void addColumnMask(Table table, String column, Expression mask)\n                     NodeRef<Table> table = entry.getKey();\n \n                     List<ColumnInfo> columns = referencedFields.get(table).stream()\n+                            .filter(field -> field.getName().isPresent())", "state": "SUBMITTED", "replyTo": null, "originalCommit": null, "originalPosition": 22}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "52dd92eef6175093c1ab63a689a5a42448176eac", "author": {"user": {"login": "martint", "name": "Martin Traverso"}}, "url": "https://github.com/trinodb/trino/commit/52dd92eef6175093c1ab63a689a5a42448176eac", "committedDate": "2020-05-07T16:53:36Z", "message": "Move delete analysis to the analyzer\n\nThe derivation of the row id field was being done during planning\ninstead of analysis. This also resulted in having to special-case\nthe planning of the source table plan."}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": null, "afterCommit": {"oid": "52dd92eef6175093c1ab63a689a5a42448176eac", "author": {"user": {"login": "martint", "name": "Martin Traverso"}}, "url": "https://github.com/trinodb/trino/commit/52dd92eef6175093c1ab63a689a5a42448176eac", "committedDate": "2020-05-07T16:53:36Z", "message": "Move delete analysis to the analyzer\n\nThe derivation of the row id field was being done during planning\ninstead of analysis. This also resulted in having to special-case\nthe planning of the source table plan."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDA3OTMzNzE3", "url": "https://github.com/trinodb/trino/pull/3651#pullrequestreview-407933717", "createdAt": "2020-05-08T01:06:04Z", "commit": {"oid": "52dd92eef6175093c1ab63a689a5a42448176eac"}, "state": "APPROVED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wOFQwMTowNjowNFrOGSVeJw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wOFQwMTowNjowNFrOGSVeJw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMTg3OTMzNQ==", "bodyText": "Should we add a check afterwards that the count matches unless it is a delete query?", "url": "https://github.com/trinodb/trino/pull/3651#discussion_r421879335", "createdAt": "2020-05-08T01:06:04Z", "author": {"login": "dain"}, "path": "presto-main/src/main/java/io/prestosql/sql/analyzer/Analysis.java", "diffHunk": "@@ -783,6 +787,7 @@ public void addColumnMask(Table table, String column, Expression mask)\n                     NodeRef<Table> table = entry.getKey();\n \n                     List<ColumnInfo> columns = referencedFields.get(table).stream()\n+                            .filter(field -> field.getName().isPresent()) // For DELETE queries, the synthetic column for row id doesn't have a name", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "52dd92eef6175093c1ab63a689a5a42448176eac"}, "originalPosition": 22}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1416, "cost": 1, "resetAt": "2021-10-28T19:08:13Z"}}}