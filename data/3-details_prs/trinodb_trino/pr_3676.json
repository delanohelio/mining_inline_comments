{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDE1NDg2MTAx", "number": 3676, "title": "Clean up planning of set operations", "bodyText": "", "createdAt": "2020-05-09T00:33:16Z", "url": "https://github.com/trinodb/trino/pull/3676", "merged": true, "mergeCommit": {"oid": "f96475f2274e3de3d7c99c062ae3ccbccfb7a3f6"}, "closed": true, "closedAt": "2020-07-11T01:11:32Z", "author": {"login": "martint"}, "timelineItems": {"totalCount": 13, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcfgS7JABqjMzMTkwNTE2MDc=", "endCursor": "Y3Vyc29yOnYyOpPPAAABczttTjABqjM1MzU4NDI5MzE=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "HeadRefForcePushedEvent", "beforeCommit": null, "afterCommit": null}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": null, "afterCommit": null}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": null, "afterCommit": null}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": null, "afterCommit": null}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": null, "afterCommit": null}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": null, "afterCommit": null}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDQ2MzYyOTI0", "url": "https://github.com/trinodb/trino/pull/3676#pullrequestreview-446362924", "createdAt": "2020-07-10T12:32:55Z", "commit": null, "state": "APPROVED", "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xMFQxMjozMjo1NlrOGv1kKw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xMFQxMjo0NjozOFrOGv1-JQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MjgxMzg2Nw==", "bodyText": "should you use: io.prestosql.sql.analyzer.Analysis#getTypeOnlyCoercions here?", "url": "https://github.com/trinodb/trino/pull/3676#discussion_r452813867", "createdAt": "2020-07-10T12:32:56Z", "author": {"login": "sopel39"}, "path": "presto-main/src/main/java/io/prestosql/sql/planner/QueryPlanner.java", "diffHunk": "@@ -797,6 +797,38 @@ public static Expression coerceIfNecessary(Analysis analysis, Expression origina\n                 analysis.isTypeOnlyCoercion(original));\n     }\n \n+    public static NodeAndMappings coerce(PlanNode node, List<Symbol> fields, List<Type> types, SymbolAllocator symbolAllocator, PlanNodeIdAllocator idAllocator)\n+    {\n+        Assignments.Builder assignments = Assignments.builder();\n+\n+        ImmutableList.Builder<Symbol> mappings = ImmutableList.builder();\n+        for (int i = 0; i < types.size(); i++) {\n+            Symbol input = fields.get(i);\n+            Type type = types.get(i);\n+\n+            if (!symbolAllocator.getTypes().get(input).equals(type)) {\n+                Symbol coerced = symbolAllocator.newSymbol(input.getName(), type);\n+                assignments.put(coerced, new Cast(input.toSymbolReference(), toSqlType(type)));", "state": "SUBMITTED", "replyTo": null, "originalCommit": null, "originalPosition": 15}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MjgxNTEzMQ==", "bodyText": "check argument that types.size() == fields.size()", "url": "https://github.com/trinodb/trino/pull/3676#discussion_r452815131", "createdAt": "2020-07-10T12:35:32Z", "author": {"login": "sopel39"}, "path": "presto-main/src/main/java/io/prestosql/sql/planner/QueryPlanner.java", "diffHunk": "@@ -797,6 +797,38 @@ public static Expression coerceIfNecessary(Analysis analysis, Expression origina\n                 analysis.isTypeOnlyCoercion(original));\n     }\n \n+    public static NodeAndMappings coerce(PlanNode node, List<Symbol> fields, List<Type> types, SymbolAllocator symbolAllocator, PlanNodeIdAllocator idAllocator)\n+    {\n+        Assignments.Builder assignments = Assignments.builder();\n+\n+        ImmutableList.Builder<Symbol> mappings = ImmutableList.builder();\n+        for (int i = 0; i < types.size(); i++) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": null, "originalPosition": 9}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MjgyMDUxNw==", "bodyText": "preserve processAndCoerceIfNecessary name. It was more accurate.", "url": "https://github.com/trinodb/trino/pull/3676#discussion_r452820517", "createdAt": "2020-07-10T12:46:38Z", "author": {"login": "sopel39"}, "path": "presto-main/src/main/java/io/prestosql/sql/planner/QueryPlanner.java", "diffHunk": "@@ -797,6 +797,38 @@ public static Expression coerceIfNecessary(Analysis analysis, Expression origina\n                 analysis.isTypeOnlyCoercion(original));\n     }\n \n+    public static NodeAndMappings coerce(PlanNode node, List<Symbol> fields, List<Type> types, SymbolAllocator symbolAllocator, PlanNodeIdAllocator idAllocator)", "state": "SUBMITTED", "replyTo": null, "originalCommit": null, "originalPosition": 4}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": null, "afterCommit": null}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": null, "afterCommit": null}, {"__typename": "PullRequestCommit", "commit": {"oid": "865589b12a774d3acc63400c2510c4e9e323d601", "author": {"user": {"login": "martint", "name": "Martin Traverso"}}, "url": "https://github.com/trinodb/trino/commit/865589b12a774d3acc63400c2510c4e9e323d601", "committedDate": "2020-07-11T01:11:19Z", "message": "Fix formatting"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "3c92ab1566a2d1d1c84f95eb3bd6649a6ba7658c", "author": {"user": {"login": "martint", "name": "Martin Traverso"}}, "url": "https://github.com/trinodb/trino/commit/3c92ab1566a2d1d1c84f95eb3bd6649a6ba7658c", "committedDate": "2020-07-11T01:11:19Z", "message": "Use List instead of array"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f96475f2274e3de3d7c99c062ae3ccbccfb7a3f6", "author": {"user": {"login": "martint", "name": "Martin Traverso"}}, "url": "https://github.com/trinodb/trino/commit/f96475f2274e3de3d7c99c062ae3ccbccfb7a3f6", "committedDate": "2020-07-11T01:11:19Z", "message": "Clean up set operation planning"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": null, "afterCommit": {"oid": "f96475f2274e3de3d7c99c062ae3ccbccfb7a3f6", "author": {"user": {"login": "martint", "name": "Martin Traverso"}}, "url": "https://github.com/trinodb/trino/commit/f96475f2274e3de3d7c99c062ae3ccbccfb7a3f6", "committedDate": "2020-07-11T01:11:19Z", "message": "Clean up set operation planning"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1434, "cost": 1, "resetAt": "2021-10-28T19:08:13Z"}}}