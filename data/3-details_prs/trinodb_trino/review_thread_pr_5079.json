{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDc5NTUzNjQw", "number": 5079, "reviewThreads": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wNlQyMTo0NDoxMVrOEgvBzQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wNlQyMjoyODozMVrOEgvOcA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzAyNzYwMzk3OnYy", "diffSide": "RIGHT", "path": "presto-benchmark-driver/src/main/java/io/prestosql/benchmark/driver/BenchmarkQueryRunner.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wNlQyMTo0NDoxMVrOHNsKvA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wNlQyMTo0NDoxMVrOHNsKvA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NDExNzE4MA==", "bodyText": "since we store user as a member variable in the class, we could just use that in this non-static method directly instead of passing it over from execute.", "url": "https://github.com/trinodb/trino/pull/5079#discussion_r484117180", "createdAt": "2020-09-06T21:44:11Z", "author": {"login": "phd3"}, "path": "presto-benchmark-driver/src/main/java/io/prestosql/benchmark/driver/BenchmarkQueryRunner.java", "diffHunk": "@@ -261,12 +262,12 @@ public void handleFailure(Exception e)\n         }\n     }\n \n-    private long getTotalCpuTime()\n+    private long getTotalCpuTime(String user)", "state": "SUBMITTED", "replyTo": null, "originalCommit": null, "originalPosition": 40}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzAyNzYxNjk0OnYy", "diffSide": "RIGHT", "path": "presto-benchmark-driver/src/main/java/io/prestosql/benchmark/driver/BenchmarkQueryRunner.java", "isResolved": false, "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wNlQyMjowMToyNlrOHNsQrA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wOVQwMDoyNjowNlrOHOyUig==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NDExODcwMA==", "bodyText": "wondering about using session.getUser() here as opposed to a new member variable user.\nI think having this new member variable user makes sense, since getting cpu time is like a monitoring request, as opposed to a benchmark query fired by the session user.\nIn future, we can probably provide a different pre-configured \"super-user\"  in this constructor invocation from BenchmarkDriver, instead of clientSession.getUser.", "url": "https://github.com/trinodb/trino/pull/5079#discussion_r484118700", "createdAt": "2020-09-06T22:01:26Z", "author": {"login": "phd3"}, "path": "presto-benchmark-driver/src/main/java/io/prestosql/benchmark/driver/BenchmarkQueryRunner.java", "diffHunk": "@@ -122,13 +123,13 @@ public BenchmarkQueryResult execute(Suite suite, ClientSession session, Benchmar\n         double[] queryCpuTimeNanos = new double[runs];\n         for (int i = 0; i < runs; ) {\n             try {\n-                long startCpuTime = getTotalCpuTime();\n+                long startCpuTime = getTotalCpuTime(user);", "state": "SUBMITTED", "replyTo": null, "originalCommit": null, "originalPosition": 24}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NDU3NDIzNA==", "bodyText": "BenchmarkQueryRunner does not have the clientSession inside. Do you mean we can pass the clientSession to BenchmarkQueryRunner instead of passing server and user configuration respectively?", "url": "https://github.com/trinodb/trino/pull/5079#discussion_r484574234", "createdAt": "2020-09-07T21:58:27Z", "author": {"login": "Lewuathe"}, "path": "presto-benchmark-driver/src/main/java/io/prestosql/benchmark/driver/BenchmarkQueryRunner.java", "diffHunk": "@@ -122,13 +123,13 @@ public BenchmarkQueryResult execute(Suite suite, ClientSession session, Benchmar\n         double[] queryCpuTimeNanos = new double[runs];\n         for (int i = 0; i < runs; ) {\n             try {\n-                long startCpuTime = getTotalCpuTime();\n+                long startCpuTime = getTotalCpuTime(user);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NDExODcwMA=="}, "originalCommit": null, "originalPosition": 24}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NTI2NjU3MA==", "bodyText": "wondering about using session.getUser() here as opposed to a new member variable user.\n\n^ for this, I just meant getting session.getUser in the execute method.\n\nIn future, we can probably provide a different pre-configured \"super-user\" in this constructor invocation from BenchmarkDriver, instead of clientSession.getUser.\n\n^ for this, I meant passing in a different user in BenchmarkQueryRunner constructor.", "url": "https://github.com/trinodb/trino/pull/5079#discussion_r485266570", "createdAt": "2020-09-09T00:26:06Z", "author": {"login": "phd3"}, "path": "presto-benchmark-driver/src/main/java/io/prestosql/benchmark/driver/BenchmarkQueryRunner.java", "diffHunk": "@@ -122,13 +123,13 @@ public BenchmarkQueryResult execute(Suite suite, ClientSession session, Benchmar\n         double[] queryCpuTimeNanos = new double[runs];\n         for (int i = 0; i < runs; ) {\n             try {\n-                long startCpuTime = getTotalCpuTime();\n+                long startCpuTime = getTotalCpuTime(user);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NDExODcwMA=="}, "originalCommit": null, "originalPosition": 24}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzAyNzYzNjMyOnYy", "diffSide": "RIGHT", "path": "presto-benchmark-driver/src/main/java/io/prestosql/benchmark/driver/BenchmarkQueryRunner.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wNlQyMjoyODozMVrOHNsZ5g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wNlQyMjoyODozMVrOHNsZ5g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NDEyMTA2Mg==", "bodyText": "this might be easier to read with multi-line formatting, and extracting out request preparation.\n            Request request = prepareGet()\n                    .setHeader(PrestoHeaders.PRESTO_USER, user)\n                    .setUri(uriBuilderFrom(server)\n                            .replacePath(\"/v1/jmx/mbean/java.lang:type=OperatingSystem/ProcessCpuTime\")\n                            .build())\n                    .build();\n            String data = httpClient.execute(request, createStringResponseHandler()).getBody();", "url": "https://github.com/trinodb/trino/pull/5079#discussion_r484121062", "createdAt": "2020-09-06T22:28:31Z", "author": {"login": "phd3"}, "path": "presto-benchmark-driver/src/main/java/io/prestosql/benchmark/driver/BenchmarkQueryRunner.java", "diffHunk": "@@ -261,12 +262,12 @@ public void handleFailure(Exception e)\n         }\n     }\n \n-    private long getTotalCpuTime()\n+    private long getTotalCpuTime(String user)\n     {\n         long totalCpuTime = 0;\n         for (URI server : nodes) {\n             URI addressUri = uriBuilderFrom(server).replacePath(\"/v1/jmx/mbean/java.lang:type=OperatingSystem/ProcessCpuTime\").build();\n-            String data = httpClient.execute(prepareGet().setUri(addressUri).build(), createStringResponseHandler()).getBody();\n+            String data = httpClient.execute(prepareGet().setHeader(PrestoHeaders.PRESTO_USER, user).setUri(addressUri).build(), createStringResponseHandler()).getBody();", "state": "SUBMITTED", "replyTo": null, "originalCommit": null, "originalPosition": 46}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3139, "cost": 1, "resetAt": "2021-11-12T12:57:47Z"}}}