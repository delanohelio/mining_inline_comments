{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDUxMzE4ODgy", "number": 4483, "title": "Add max idle time as a configurable property for the mongodb connector", "bodyText": "There is an issue present when connecting to MongoDB hosted in Azure Cosmos DB.\nConnections made to Cosmos DB are dropped after 10 minutes without any communication back to the client. This causes Presto to fail queries with a timeout exception during queries to the mongo catalog when idle for 10 minutes after the previously succeeded query.\nIn Cosmos DB, the default connection string given to users has a config maxIdleTimeMS=120000. Allowing this property in the Presto mongodb connector will close connections after the configured time. This will prevent the timeout exceptions from happening.\nThis PR adds the maxConnectionIdleTime to the list of configurable properties in the mongodb connector.", "createdAt": "2020-07-17T17:56:48Z", "url": "https://github.com/trinodb/trino/pull/4483", "merged": true, "mergeCommit": {"oid": "a29e29575c56c2c8a740ec6a493e70c6e658cec6"}, "closed": true, "closedAt": "2020-07-22T02:25:48Z", "author": {"login": "jerroldlaw"}, "timelineItems": {"totalCount": 11, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABc2CFpLAFqTQ1MTAzNDAxNw==", "endCursor": "Y3Vyc29yOnYyOpPPAAABc3Fs1mgBqjM1NzEwOTkzNTE=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDUxMDM0MDE3", "url": "https://github.com/trinodb/trino/pull/4483#pullrequestreview-451034017", "createdAt": "2020-07-18T05:47:12Z", "commit": null, "state": "COMMENTED", "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xOFQwNTo0NzoxMlrOGzmBcw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xOFQwNTo1ODoxMVrOGzmEow==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1Njc1MzUyMw==", "bodyText": "nit: Let's move to under the maxWaitTime since it's timeout value (thus we can minimize the diff).", "url": "https://github.com/trinodb/trino/pull/4483#discussion_r456753523", "createdAt": "2020-07-18T05:47:12Z", "author": {"login": "ebyhr"}, "path": "presto-mongodb/src/main/java/io/prestosql/plugin/mongodb/MongoClientModule.java", "diffHunk": "@@ -56,7 +56,8 @@ public static MongoSession createMongoSession(TypeManager typeManager, MongoClie\n                 .maxWaitTime(config.getMaxWaitTime())\n                 .minConnectionsPerHost(config.getMinConnectionsPerHost())\n                 .readPreference(config.getReadPreference().getReadPreference())\n-                .writeConcern(config.getWriteConcern().getWriteConcern());\n+                .writeConcern(config.getWriteConcern().getWriteConcern())\n+                .maxConnectionIdleTime(config.getMaxConnectionIdleTime());", "state": "SUBMITTED", "replyTo": null, "originalCommit": null, "originalPosition": 6}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1Njc1Mzc2Nw==", "bodyText": "Please add @Min(0) annotation.", "url": "https://github.com/trinodb/trino/pull/4483#discussion_r456753767", "createdAt": "2020-07-18T05:50:25Z", "author": {"login": "ebyhr"}, "path": "presto-mongodb/src/main/java/io/prestosql/plugin/mongodb/MongoClientConfig.java", "diffHunk": "@@ -307,4 +308,16 @@ public MongoClientConfig setSslEnabled(boolean sslEnabled)\n         this.sslEnabled = sslEnabled;\n         return this;\n     }\n+\n+    public int getMaxConnectionIdleTime()", "state": "SUBMITTED", "replyTo": null, "originalCommit": null, "originalPosition": 13}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1Njc1NDMzOQ==", "bodyText": "Could you update mongodb.rst in presto-docs module?\n\n  \n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                @Config(\"mongodb.max-connection-idle-time-ms\")\n          \n          \n            \n                @Config(\"mongodb.max-connection-idle-time\")\n          \n      \n    \n    \n  \n\n(Basically, we should use Duration type for this property, but understood the existing property in this connector are using int now)", "url": "https://github.com/trinodb/trino/pull/4483#discussion_r456754339", "createdAt": "2020-07-18T05:58:11Z", "author": {"login": "ebyhr"}, "path": "presto-mongodb/src/main/java/io/prestosql/plugin/mongodb/MongoClientConfig.java", "diffHunk": "@@ -307,4 +308,16 @@ public MongoClientConfig setSslEnabled(boolean sslEnabled)\n         this.sslEnabled = sslEnabled;\n         return this;\n     }\n+\n+    public int getMaxConnectionIdleTime()\n+    {\n+        return maxConnectionIdleTime;\n+    }\n+\n+    @Config(\"mongodb.max-connection-idle-time-ms\")", "state": "SUBMITTED", "replyTo": null, "originalCommit": null, "originalPosition": 18}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": null, "afterCommit": null}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": null, "afterCommit": null}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDUxMjkxMDcz", "url": "https://github.com/trinodb/trino/pull/4483#pullrequestreview-451291073", "createdAt": "2020-07-20T04:40:08Z", "commit": null, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": null, "afterCommit": null}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": null, "afterCommit": null}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": null, "afterCommit": null}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": null, "afterCommit": null}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": null, "afterCommit": null}, {"__typename": "PullRequestCommit", "commit": {"oid": "9541058241fa38a174411ec553b7f57de1b8479d", "author": {"user": {"login": "jerroldlaw", "name": "Jerrold Law"}}, "url": "https://github.com/trinodb/trino/commit/9541058241fa38a174411ec553b7f57de1b8479d", "committedDate": "2020-07-21T12:50:16Z", "message": "Add max idle time configuration in MongoDB connector"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": null, "afterCommit": {"oid": "9541058241fa38a174411ec553b7f57de1b8479d", "author": {"user": {"login": "jerroldlaw", "name": "Jerrold Law"}}, "url": "https://github.com/trinodb/trino/commit/9541058241fa38a174411ec553b7f57de1b8479d", "committedDate": "2020-07-21T12:50:16Z", "message": "Add max idle time configuration in MongoDB connector"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4755, "cost": 1, "resetAt": "2021-10-28T20:13:43Z"}}}