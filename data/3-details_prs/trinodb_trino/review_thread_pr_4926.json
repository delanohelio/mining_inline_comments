{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDcxODA0NTg1", "number": 4926, "reviewThreads": {"totalCount": 6, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yMVQyMTo0NDozOFrOEbI1TQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yNFQxMTowNDozMVrOEbhITA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjk2ODkxNzI1OnYy", "diffSide": "RIGHT", "path": "presto-testng-services/src/main/java/io/prestosql/testng/services/ReportUnannotatedMethods.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yMVQyMTo0NDozOFrOHE-qSg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yMVQyMTo0NDozOFrOHE-qSg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NDk4Mjk4Ng==", "bodyText": "This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters. Learn more about bidirectional Unicode characters\n\n\n  \n\n\n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                    if (superclass == null) {\n          \n          \n            \n                    if (method.getDeclaringClass().isInterface()) {", "url": "https://github.com/trinodb/trino/pull/4926#discussion_r474982986", "createdAt": "2020-08-21T21:44:38Z", "author": {"login": "findepi"}, "path": "presto-testng-services/src/main/java/io/prestosql/testng/services/ReportUnannotatedMethods.java", "diffHunk": "@@ -78,6 +78,10 @@ private static boolean isTestMethod(Method method)\n             return true;\n         }\n         Class<?> superclass = method.getDeclaringClass().getSuperclass();\n+        if (superclass == null) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": null, "originalPosition": 4}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjk3Mjg2ODYwOnYy", "diffSide": "RIGHT", "path": "presto-testng-services/src/main/java/io/prestosql/testng/services/ReportUnannotatedMethods.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yNFQxMDo1NDozOFrOHFfSkA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yNFQxMDo1NjozNVrOHFfWTg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NTUxNzU4NA==", "bodyText": "Please see #4951 for my take on this.", "url": "https://github.com/trinodb/trino/pull/4926#discussion_r475517584", "createdAt": "2020-08-24T10:54:38Z", "author": {"login": "findepi"}, "path": "presto-testng-services/src/main/java/io/prestosql/testng/services/ReportUnannotatedMethods.java", "diffHunk": "@@ -129,4 +130,18 @@ public static boolean isTemptoClass(Class<?> aClass)\n     {\n         return aClass.getPackage().getName().startsWith(\"io.prestosql.tempto\");\n     }\n+\n+    private static void forceTestngFailure(Runnable runnable)", "state": "SUBMITTED", "replyTo": null, "originalCommit": null, "originalPosition": 32}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NTUxODU0Mg==", "bodyText": "I guess #4951 is more robust as it covers more listeners.", "url": "https://github.com/trinodb/trino/pull/4926#discussion_r475518542", "createdAt": "2020-08-24T10:56:35Z", "author": {"login": "wendigo"}, "path": "presto-testng-services/src/main/java/io/prestosql/testng/services/ReportUnannotatedMethods.java", "diffHunk": "@@ -129,4 +130,18 @@ public static boolean isTemptoClass(Class<?> aClass)\n     {\n         return aClass.getPackage().getName().startsWith(\"io.prestosql.tempto\");\n     }\n+\n+    private static void forceTestngFailure(Runnable runnable)", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NTUxNzU4NA=="}, "originalCommit": null, "originalPosition": 32}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjk3Mjg4NTgxOnYy", "diffSide": "RIGHT", "path": "presto-testng-services/src/main/java/io/prestosql/testng/services/ReportUnannotatedMethods.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yNFQxMTowMDoyMVrOHFfc9g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yNFQxMTowMDoyMVrOHFfc9g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NTUyMDI0Ng==", "bodyText": "BTW Maybe we can deprecate & remove this interfaces?\nAlso, this should not match eg io.prestosql.temptomat -- you need to prefix match with a dot at the end.", "url": "https://github.com/trinodb/trino/pull/4926#discussion_r475520246", "createdAt": "2020-08-24T11:00:21Z", "author": {"login": "findepi"}, "path": "presto-testng-services/src/main/java/io/prestosql/testng/services/ReportUnannotatedMethods.java", "diffHunk": "@@ -140,6 +140,6 @@ private static boolean overrides(Method first, Method second)\n \n     public static boolean isTemptoClass(Class<?> aClass)\n     {\n-        return \"io.prestosql.tempto\".equals(aClass.getPackage().getName());\n+        return aClass.getPackage().getName().startsWith(\"io.prestosql.tempto\");", "state": "SUBMITTED", "replyTo": null, "originalCommit": null, "originalPosition": 5}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjk3Mjg5MTE3OnYy", "diffSide": "RIGHT", "path": "presto-testng-services/src/main/java/io/prestosql/testng/services/ReportUnannotatedMethods.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yNFQxMTowMjowOVrOHFfgOQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yNFQxMTowMjowOVrOHFfgOQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NTUyMTA4MQ==", "bodyText": "you should not exit early if this is an interface, but not tempto related\n\n  \n    \n  \n    \n\n  \n  This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters. Learn more about bidirectional Unicode characters\n\n\n  \n\n\n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                    if (method.getDeclaringClass().isInterface()) {\n          \n          \n            \n                        return isTemptoClass(method.getDeclaringClass());\n          \n          \n            \n                    if (method.getDeclaringClass().isInterface() && isTemptoClass(method.getDeclaringClass())) {\n          \n          \n            \n                        return true;", "url": "https://github.com/trinodb/trino/pull/4926#discussion_r475521081", "createdAt": "2020-08-24T11:02:09Z", "author": {"login": "findepi"}, "path": "presto-testng-services/src/main/java/io/prestosql/testng/services/ReportUnannotatedMethods.java", "diffHunk": "@@ -77,17 +76,33 @@ private static boolean isTestMethod(Method method)\n         if (method.getDeclaringClass() == Object.class) {\n             return true;\n         }\n-        Class<?> superclass = method.getDeclaringClass().getSuperclass();\n-        Method overridden;\n+        if (method.getDeclaringClass().isInterface()) {\n+            return isTemptoClass(method.getDeclaringClass());", "state": "SUBMITTED", "replyTo": null, "originalCommit": null, "originalPosition": 38}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjk3Mjg5NDM2OnYy", "diffSide": "RIGHT", "path": "presto-testng-services/src/main/java/io/prestosql/testng/services/ReportUnannotatedMethods.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yNFQxMTowMzoxN1rOHFfiIw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yNFQxMTo1MDoxMVrOHFg4eQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NTUyMTU3MQ==", "bodyText": "Does this disable ReportUnannotatedMethods for any class that happens to implement a tempto interface?", "url": "https://github.com/trinodb/trino/pull/4926#discussion_r475521571", "createdAt": "2020-08-24T11:03:17Z", "author": {"login": "findepi"}, "path": "presto-testng-services/src/main/java/io/prestosql/testng/services/ReportUnannotatedMethods.java", "diffHunk": "@@ -77,17 +76,33 @@ private static boolean isTestMethod(Method method)\n         if (method.getDeclaringClass() == Object.class) {\n             return true;\n         }\n-        Class<?> superclass = method.getDeclaringClass().getSuperclass();\n-        Method overridden;\n+        if (method.getDeclaringClass().isInterface()) {\n+            return isTemptoClass(method.getDeclaringClass());\n+        }\n+        for (Class<?> interfaceClass : method.getDeclaringClass().getInterfaces()) {\n+            if (isTemptoClass(interfaceClass)) {\n+                return true;", "state": "SUBMITTED", "replyTo": null, "originalCommit": null, "originalPosition": 42}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NTU0MzY3Mw==", "bodyText": "Good catch", "url": "https://github.com/trinodb/trino/pull/4926#discussion_r475543673", "createdAt": "2020-08-24T11:50:11Z", "author": {"login": "kokosing"}, "path": "presto-testng-services/src/main/java/io/prestosql/testng/services/ReportUnannotatedMethods.java", "diffHunk": "@@ -77,17 +76,33 @@ private static boolean isTestMethod(Method method)\n         if (method.getDeclaringClass() == Object.class) {\n             return true;\n         }\n-        Class<?> superclass = method.getDeclaringClass().getSuperclass();\n-        Method overridden;\n+        if (method.getDeclaringClass().isInterface()) {\n+            return isTemptoClass(method.getDeclaringClass());\n+        }\n+        for (Class<?> interfaceClass : method.getDeclaringClass().getInterfaces()) {\n+            if (isTemptoClass(interfaceClass)) {\n+                return true;", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NTUyMTU3MQ=="}, "originalCommit": null, "originalPosition": 42}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjk3Mjg5ODA0OnYy", "diffSide": "LEFT", "path": "presto-testng-services/src/main/java/io/prestosql/testng/services/ReportUnannotatedMethods.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yNFQxMTowNDozMVrOHFfkeg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yNFQxMTo0MjoyMVrOHFgrPg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NTUyMjE3MA==", "bodyText": "You apparently removed recursion from here.\neg what if A.test overrides B.test and B.test overrides C.test and C.test is @Test annotated?", "url": "https://github.com/trinodb/trino/pull/4926#discussion_r475522170", "createdAt": "2020-08-24T11:04:31Z", "author": {"login": "findepi"}, "path": "presto-testng-services/src/main/java/io/prestosql/testng/services/ReportUnannotatedMethods.java", "diffHunk": "@@ -77,17 +76,33 @@ private static boolean isTestMethod(Method method)\n         if (method.getDeclaringClass() == Object.class) {\n             return true;\n         }\n-        Class<?> superclass = method.getDeclaringClass().getSuperclass();\n-        Method overridden;\n+        if (method.getDeclaringClass().isInterface()) {\n+            return isTemptoClass(method.getDeclaringClass());\n+        }\n+        for (Class<?> interfaceClass : method.getDeclaringClass().getInterfaces()) {\n+            if (isTemptoClass(interfaceClass)) {\n+                return true;\n+            }\n+            Optional<Method> overridden = getOverridden(method, interfaceClass);\n+            if (overridden.isPresent()) {\n+                return true;\n+            }\n+        }\n+\n+        return getOverridden(method, method.getDeclaringClass().getSuperclass())\n+                .map(ReportUnannotatedMethods::isAllowedPublicMethodInTest)\n+                .orElse(false);\n+    }\n+\n+    private static Optional<Method> getOverridden(Method method, Class<?> base)\n+    {\n         try {\n             // Simplistic override detection\n-            overridden = superclass.getMethod(method.getName(), method.getParameterTypes());\n+            return Optional.of(base.getMethod(method.getName(), method.getParameterTypes()));\n         }\n         catch (NoSuchMethodException ignored) {\n-            return false;\n+            return Optional.empty();\n         }\n-\n-        return isTestMethod(overridden);", "state": "SUBMITTED", "replyTo": null, "originalCommit": null, "originalPosition": 67}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NTU0MDI4Ng==", "bodyText": "No it is moved, see\n                .map(ReportUnannotatedMethods::isAllowedPublicMethodInTest)\n\nI will add test for that.", "url": "https://github.com/trinodb/trino/pull/4926#discussion_r475540286", "createdAt": "2020-08-24T11:42:21Z", "author": {"login": "kokosing"}, "path": "presto-testng-services/src/main/java/io/prestosql/testng/services/ReportUnannotatedMethods.java", "diffHunk": "@@ -77,17 +76,33 @@ private static boolean isTestMethod(Method method)\n         if (method.getDeclaringClass() == Object.class) {\n             return true;\n         }\n-        Class<?> superclass = method.getDeclaringClass().getSuperclass();\n-        Method overridden;\n+        if (method.getDeclaringClass().isInterface()) {\n+            return isTemptoClass(method.getDeclaringClass());\n+        }\n+        for (Class<?> interfaceClass : method.getDeclaringClass().getInterfaces()) {\n+            if (isTemptoClass(interfaceClass)) {\n+                return true;\n+            }\n+            Optional<Method> overridden = getOverridden(method, interfaceClass);\n+            if (overridden.isPresent()) {\n+                return true;\n+            }\n+        }\n+\n+        return getOverridden(method, method.getDeclaringClass().getSuperclass())\n+                .map(ReportUnannotatedMethods::isAllowedPublicMethodInTest)\n+                .orElse(false);\n+    }\n+\n+    private static Optional<Method> getOverridden(Method method, Class<?> base)\n+    {\n         try {\n             // Simplistic override detection\n-            overridden = superclass.getMethod(method.getName(), method.getParameterTypes());\n+            return Optional.of(base.getMethod(method.getName(), method.getParameterTypes()));\n         }\n         catch (NoSuchMethodException ignored) {\n-            return false;\n+            return Optional.empty();\n         }\n-\n-        return isTestMethod(overridden);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NTUyMjE3MA=="}, "originalCommit": null, "originalPosition": 67}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3244, "cost": 1, "resetAt": "2021-11-12T12:57:47Z"}}}