{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTE3MzEzNzYy", "number": 5870, "title": "Add support for limit pushdown in MongoDB", "bodyText": "Supersedes #3229", "createdAt": "2020-11-08T14:27:40Z", "url": "https://github.com/trinodb/trino/pull/5870", "merged": true, "mergeCommit": {"oid": "85110dd421fd2bd5ef94cfe26ebeb734be8325b4"}, "closed": true, "closedAt": "2020-11-11T14:42:36Z", "author": {"login": "ebyhr"}, "timelineItems": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdbYWdxgFqTUyNzkwNjk0Mw==", "endCursor": "Y3Vyc29yOnYyOpPPAAABdbdLwsgBqjM5ODM2MzQzMDY=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTI3OTA2OTQz", "url": "https://github.com/trinodb/trino/pull/5870#pullrequestreview-527906943", "createdAt": "2020-11-11T06:54:49Z", "commit": null, "state": "APPROVED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xMVQwNjo1NDo0OVrOHxAlSA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xMVQwNjo1NDo0OVrOHxAlSA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMTE1MTgxNg==", "bodyText": "The documentation in https://docs.mongodb.com/manual/reference/method/cursor.limit/#cursor.limit mentions that\n\nA limit() value of 0 (i.e. .limit(0)) is equivalent to setting no limit.\n\nIs this true for the API iterable.limit(0) being used here as well?\nGenerally speaking the engine should optimize the LIMIT 0 clause, but the mongodb behavior seems counterintuitive to me. If that is indeed the case, then should we encode/document that special case here?", "url": "https://github.com/trinodb/trino/pull/5870#discussion_r521151816", "createdAt": "2020-11-11T06:54:49Z", "author": {"login": "phd3"}, "path": "presto-mongodb/src/main/java/io/prestosql/plugin/mongodb/MongoMetadata.java", "diffHunk": "@@ -250,6 +252,25 @@ public ConnectorTableProperties getTableProperties(ConnectorSession session, Con\n                 localProperties.build());\n     }\n \n+    @Override\n+    public Optional<LimitApplicationResult<ConnectorTableHandle>> applyLimit(ConnectorSession session, ConnectorTableHandle table, long limit)\n+    {\n+        MongoTableHandle handle = (MongoTableHandle) table;\n+\n+        // MongoDB doesn't support limit number greater than integer max\n+        if (limit > Integer.MAX_VALUE) {\n+            return Optional.empty();\n+        }\n+\n+        if (handle.getLimit().isPresent() && handle.getLimit().getAsLong() <= limit) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": null, "originalPosition": 30}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": null, "afterCommit": null}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTI4MTExNDc0", "url": "https://github.com/trinodb/trino/pull/5870#pullrequestreview-528111474", "createdAt": "2020-11-11T12:03:45Z", "commit": null, "state": "APPROVED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xMVQxMjowMzo0NVrOHxKTLw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xMVQxMjowMzo0NVrOHxKTLw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMTMxMTAyMw==", "bodyText": "Can we maintain it as OptionalInt as we won't pushdown  limit if is beyond Integer range.", "url": "https://github.com/trinodb/trino/pull/5870#discussion_r521311023", "createdAt": "2020-11-11T12:03:45Z", "author": {"login": "Praveen2112"}, "path": "presto-mongodb/src/main/java/io/prestosql/plugin/mongodb/MongoTableHandle.java", "diffHunk": "@@ -29,19 +30,22 @@\n {\n     private final SchemaTableName schemaTableName;\n     private final TupleDomain<ColumnHandle> constraint;\n+    private final OptionalLong limit;", "state": "SUBMITTED", "replyTo": null, "originalCommit": null, "originalPosition": 12}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "5ac3fd46193f6a32afbf760c37bd009066b7d8fd", "author": {"user": {"login": "ebyhr", "name": "Yuya Ebihara"}}, "url": "https://github.com/trinodb/trino/commit/5ac3fd46193f6a32afbf760c37bd009066b7d8fd", "committedDate": "2020-11-11T12:29:50Z", "message": "Add support for limit pushdown in MongoDB"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": null, "afterCommit": {"oid": "5ac3fd46193f6a32afbf760c37bd009066b7d8fd", "author": {"user": {"login": "ebyhr", "name": "Yuya Ebihara"}}, "url": "https://github.com/trinodb/trino/commit/5ac3fd46193f6a32afbf760c37bd009066b7d8fd", "committedDate": "2020-11-11T12:29:50Z", "message": "Add support for limit pushdown in MongoDB"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2913, "cost": 1, "resetAt": "2021-10-28T20:13:43Z"}}}