{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTE1NDU4MzY3", "number": 5818, "title": "Make query result HTTP compression configurable", "bodyText": "Adapted changes from prestodb/presto#15393\nBefore this change, query result JSON responses were generally compressed (assuming the response met the minimum size threshold and passed the user agent checks), so that behavior is still the default. However, disabling GZIP compression can significantly improve throughput of sending query results, especially over localhost links where the overhead of compressing the response and then uncompressing it again on the client side is never worth the bandwidth savings.\nClients are allowed to opt-out of compression, but not request compression from a server which has decided to disable compressed query result responses. Both sides ultimately negotiate the result based on their Accept-Encoding or Content-Encoding headers and the way that the gzip compression middleware interprets them.\nFor queries that are bound only by result processing throughput (eg: SELECT * FROM <large table>) execution time can reduced by 20-50% when submitted over a localhost connection with compression disabled.", "createdAt": "2020-11-04T15:25:30Z", "url": "https://github.com/trinodb/trino/pull/5818", "merged": true, "mergeCommit": {"oid": "50db49581a9dd6697cc2f4fb5341e1f054602d30"}, "closed": true, "closedAt": "2020-11-16T23:35:25Z", "author": {"login": "pettyjamesm"}, "timelineItems": {"totalCount": 6, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdcL8jwgFqTUzMDI4MjgzMg==", "endCursor": "Y3Vyc29yOnYyOpPPAAABddLwshgFqTUzMTc5MDU4Mw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTMwMjgyODMy", "url": "https://github.com/trinodb/trino/pull/5818#pullrequestreview-530282832", "createdAt": "2020-11-13T17:54:05Z", "commit": null, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xM1QxNzo1NDowNlrOHy5D5A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xM1QxNzo1NDowNlrOHy5D5A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMzEyNTczMg==", "bodyText": "Let's go with Disable compression of query results for all of these descriptions", "url": "https://github.com/trinodb/trino/pull/5818#discussion_r523125732", "createdAt": "2020-11-13T17:54:06Z", "author": {"login": "dain"}, "path": "presto-benchmark-driver/src/main/java/io/prestosql/benchmark/driver/BenchmarkDriverOptions.java", "diffHunk": "@@ -94,6 +94,9 @@\n     @Option(names = \"--client-request-timeout\", paramLabel = \"<timeout>\", defaultValue = \"2m\", description = \"Client request timeout \" + DEFAULT_VALUE)\n     public Duration clientRequestTimeout;\n \n+    @Option(names = \"--disable-compression\", description = \"Requests that the server not compress query result responses\")", "state": "SUBMITTED", "replyTo": null, "originalCommit": null, "originalPosition": 4}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": null, "afterCommit": null}, {"__typename": "PullRequestCommit", "commit": {"oid": "dc1a62186afcfda55f92fa858c55493572bf0221", "author": {"user": {"login": "pettyjamesm", "name": "James Petty"}}, "url": "https://github.com/trinodb/trino/commit/dc1a62186afcfda55f92fa858c55493572bf0221", "committedDate": "2020-11-16T20:51:15Z", "message": "Make query result HTTP compression client configurable\n\nBy default, presto will GZIP query result JSON payloads sent to the\nclient. However, especially when the client is connected to the\ncoordinator over localhost, the added overhead of compressing the\nresponse and then uncompressing it on the client is a losing\nproposition.\n\nFor queries that are bound only by result processing throughput (eg:\nSELECT * FROM <large table>) execution time can reduced by 20-50%\nwhen submitted over a localhost connection with compression disabled."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "7a1b15a2bbdc66577c8ea8dbce0ab1f8d0a3ea9a", "author": {"user": {"login": "pettyjamesm", "name": "James Petty"}}, "url": "https://github.com/trinodb/trino/commit/7a1b15a2bbdc66577c8ea8dbce0ab1f8d0a3ea9a", "committedDate": "2020-11-16T20:51:15Z", "message": "Make query result HTTP compression server configurable\n\nAllows configuring HTTP response compression for the query results\nendpoints at the server level, regardless of client configuration."}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": null, "afterCommit": {"oid": "7a1b15a2bbdc66577c8ea8dbce0ab1f8d0a3ea9a", "author": {"user": {"login": "pettyjamesm", "name": "James Petty"}}, "url": "https://github.com/trinodb/trino/commit/7a1b15a2bbdc66577c8ea8dbce0ab1f8d0a3ea9a", "committedDate": "2020-11-16T20:51:15Z", "message": "Make query result HTTP compression server configurable\n\nAllows configuring HTTP response compression for the query results\nendpoints at the server level, regardless of client configuration."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTMxNzkwNTgz", "url": "https://github.com/trinodb/trino/pull/5818#pullrequestreview-531790583", "createdAt": "2020-11-16T21:23:11Z", "commit": {"oid": "7a1b15a2bbdc66577c8ea8dbce0ab1f8d0a3ea9a"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2824, "cost": 1, "resetAt": "2021-10-28T20:13:43Z"}}}