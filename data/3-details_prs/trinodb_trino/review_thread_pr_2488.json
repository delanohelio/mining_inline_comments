{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0MzYyMTA1ODIy", "number": 2488, "reviewThreads": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0xM1QxNDo0NToyN1rODXiz9A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0xNFQwNTozOTo0N1rODXvNCQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjI2MDE0MTk2OnYy", "diffSide": "RIGHT", "path": "presto-main/src/main/java/io/prestosql/connector/informationschema/InformationSchemaPageSourceProvider.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0xM1QxNDo0NToyN1rOFc5NeQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0xM1QxNDo0NToyN1rOFc5NeQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NTg0MTc4NQ==", "bodyText": "can we simply log informationSchemaTableHandle?", "url": "https://github.com/trinodb/trino/pull/2488#discussion_r365841785", "createdAt": "2020-01-13T14:45:27Z", "author": {"login": "kokosing"}, "path": "presto-main/src/main/java/io/prestosql/connector/informationschema/InformationSchemaPageSourceProvider.java", "diffHunk": "@@ -48,6 +51,15 @@ public ConnectorPageSource createPageSource(\n             ConnectorTableHandle tableHandle,\n             List<ColumnHandle> columns)\n     {\n+        InformationSchemaTableHandle informationSchemaTableHandle = (InformationSchemaTableHandle) tableHandle;\n+        log.debug(\n+                \"Building information schema table (queryId=%s; catalog=%s; table=%s; prefixes=%s, limit=%s)\",\n+                session.getQueryId(),\n+                informationSchemaTableHandle.getCatalogName(),", "state": "SUBMITTED", "replyTo": null, "originalCommit": null, "originalPosition": 25}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjI2MDE0NDA3OnYy", "diffSide": "RIGHT", "path": "presto-main/src/main/java/io/prestosql/connector/informationschema/InformationSchemaPageSourceProvider.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0xM1QxNDo0NjowMFrOFc5OrQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0xNFQxMjowNjoyNlrOFdVSiQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NTg0MjA5Mw==", "bodyText": "cmt msg:\nAdd logging...\n\n?", "url": "https://github.com/trinodb/trino/pull/2488#discussion_r365842093", "createdAt": "2020-01-13T14:46:00Z", "author": {"login": "kokosing"}, "path": "presto-main/src/main/java/io/prestosql/connector/informationschema/InformationSchemaPageSourceProvider.java", "diffHunk": "@@ -13,6 +13,7 @@\n  */", "state": "SUBMITTED", "replyTo": null, "originalCommit": null, "originalPosition": 1}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NjMwMTgzMw==", "bodyText": "It was removed previously", "url": "https://github.com/trinodb/trino/pull/2488#discussion_r366301833", "createdAt": "2020-01-14T12:06:26Z", "author": {"login": "sopel39"}, "path": "presto-main/src/main/java/io/prestosql/connector/informationschema/InformationSchemaPageSourceProvider.java", "diffHunk": "@@ -13,6 +13,7 @@\n  */", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NTg0MjA5Mw=="}, "originalCommit": null, "originalPosition": 1}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjI2MDE2NzE0OnYy", "diffSide": "RIGHT", "path": "presto-main/src/main/java/io/prestosql/connector/informationschema/InformationSchemaPageSource.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0xM1QxNDo1MjoyNVrOFc5ctQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0xM1QxNDo1MjoyNVrOFc5ctQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NTg0NTY4NQ==", "bodyText": "undo", "url": "https://github.com/trinodb/trino/pull/2488#discussion_r365845685", "createdAt": "2020-01-13T14:52:25Z", "author": {"login": "kokosing"}, "path": "presto-main/src/main/java/io/prestosql/connector/informationschema/InformationSchemaPageSource.java", "diffHunk": "@@ -111,6 +116,7 @@ public InformationSchemaPageSource(\n             else {\n                 checkArgument(prefixes.equals(defaultPrefixes(catalogName)), \"Catalog-wise tables have prefixes other than the default one\");\n             }\n+", "state": "SUBMITTED", "replyTo": null, "originalCommit": null, "originalPosition": 16}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjI2MjE3MjI1OnYy", "diffSide": "RIGHT", "path": "presto-main/src/main/java/io/prestosql/connector/informationschema/InformationSchemaPageSource.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0xNFQwNTozOTo0N1rOFdMoIw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0xNFQxMTo0MDoyNlrOFdUpvA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NjE1OTkwNw==", "bodyText": "Listing schemas explicitly here also helps return results to client sooner. And with respect to Hive Connector, it doesn't really increase the number of metadata calls to HMS. Having said that, I think it's fine to make the change as it may help in case of other connectors.", "url": "https://github.com/trinodb/trino/pull/2488#discussion_r366159907", "createdAt": "2020-01-14T05:39:47Z", "author": {"login": "lxynov"}, "path": "presto-main/src/main/java/io/prestosql/connector/informationschema/InformationSchemaPageSource.java", "diffHunk": "@@ -101,6 +101,11 @@ public InformationSchemaPageSource(\n         table = tableHandle.getTable();\n         prefixIterator = Suppliers.memoize(() -> {\n             Set<QualifiedTablePrefix> prefixes = tableHandle.getPrefixes();\n+            if (!tableHandle.getLimit().isPresent()) {\n+                // no limit is used, therefore it doesn't make sense to split information schema query into smaller ones", "state": "SUBMITTED", "replyTo": null, "originalCommit": null, "originalPosition": 5}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NjI5MTM4OA==", "bodyText": "And with respect to Hive Connector, it doesn't really increase the number of metadata calls to HMS. Having said that, I think it's fine to make the change as it may help in case of other connectors.\n\nJDBC connectors can take advantage of single query. For example, they can query their own information_schema, so instead of X requests you get one", "url": "https://github.com/trinodb/trino/pull/2488#discussion_r366291388", "createdAt": "2020-01-14T11:40:26Z", "author": {"login": "sopel39"}, "path": "presto-main/src/main/java/io/prestosql/connector/informationschema/InformationSchemaPageSource.java", "diffHunk": "@@ -101,6 +101,11 @@ public InformationSchemaPageSource(\n         table = tableHandle.getTable();\n         prefixIterator = Suppliers.memoize(() -> {\n             Set<QualifiedTablePrefix> prefixes = tableHandle.getPrefixes();\n+            if (!tableHandle.getLimit().isPresent()) {\n+                // no limit is used, therefore it doesn't make sense to split information schema query into smaller ones", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NjE1OTkwNw=="}, "originalCommit": null, "originalPosition": 5}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1013, "cost": 1, "resetAt": "2021-11-13T14:23:39Z"}}}