{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDg3ODUxMjAy", "number": 5184, "title": "Remove flaky assertions in DF test", "bodyText": "Fixes: #5120", "createdAt": "2020-09-16T09:20:53Z", "url": "https://github.com/trinodb/trino/pull/5184", "merged": true, "mergeCommit": {"oid": "9faddbe9adb5d2a34a93536aa3774ffca2ae6da9"}, "closed": true, "closedAt": "2020-09-16T15:33:49Z", "author": {"login": "raunaqmorarka"}, "timelineItems": {"totalCount": 11, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdJZiOnAFqTQ4OTQ3Mjk5MQ==", "endCursor": "Y3Vyc29yOnYyOpPPAAABfJzgyjAFqTc4NDE3Nzk4OA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDg5NDcyOTkx", "url": "https://github.com/trinodb/trino/pull/5184#pullrequestreview-489472991", "createdAt": "2020-09-16T10:07:33Z", "commit": null, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xNlQxMDowNzozM1rOHSpzOg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xNlQxMDowNzozM1rOHSpzOg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4OTMyMTI3NA==", "bodyText": "Instead of commenting can we remove those lines ? We can add a TODO to point to the commit which has these changes ?", "url": "https://github.com/trinodb/trino/pull/5184#discussion_r489321274", "createdAt": "2020-09-16T10:07:33Z", "author": {"login": "Praveen2112"}, "path": "presto-hive/src/test/java/io/prestosql/plugin/hive/TestHiveDynamicPartitionPruning.java", "diffHunk": "@@ -152,11 +153,12 @@ public void testJoinWithNonSelectiveBuildSide()\n                 \"SELECT * FROM partitioned_lineitem JOIN supplier ON partitioned_lineitem.suppkey = supplier.suppkey\");\n         assertEquals(result.getResult().getRowCount(), LINEITEM_COUNT);\n \n+        /* Commented due to https://github.com/prestosql/presto/issues/5120", "state": "SUBMITTED", "replyTo": null, "originalCommit": null, "originalPosition": 47}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": null, "afterCommit": null}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDg5NDk1OTMz", "url": "https://github.com/trinodb/trino/pull/5184#pullrequestreview-489495933", "createdAt": "2020-09-16T10:38:33Z", "commit": null, "state": "APPROVED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xNlQxMDozODozM1rOHSq2zg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xNlQxMDozODozM1rOHSq2zg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4OTMzODU3NA==", "bodyText": "You can remove assertEventually(new Duration(5, SECONDS), operatorStatsSupplier::get); altogether", "url": "https://github.com/trinodb/trino/pull/5184#discussion_r489338574", "createdAt": "2020-09-16T10:38:33Z", "author": {"login": "sopel39"}, "path": "presto-testing/src/main/java/io/prestosql/testing/AbstractTestQueryFramework.java", "diffHunk": "@@ -461,7 +461,7 @@ protected OperatorStats searchScanFilterAndProjectOperatorStats(QueryId queryId,\n                 .stream()\n                 .filter(summary -> nodeId.equals(summary.getPlanNodeId()) && summary.getOperatorType().equals(\"ScanFilterAndProjectOperator\"))\n                 .collect(MoreCollectors.onlyElement());\n-        assertEventually(new Duration(5, SECONDS), operatorStatsSupplier::get);\n+        assertEventually(new Duration(5, SECONDS), () -> assertThat(operatorStatsSupplier.get()).isNotNull());", "state": "SUBMITTED", "replyTo": null, "originalCommit": null, "originalPosition": 5}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": null, "afterCommit": null}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": null, "afterCommit": null}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": null, "afterCommit": null}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDg5NjAwMjEz", "url": "https://github.com/trinodb/trino/pull/5184#pullrequestreview-489600213", "createdAt": "2020-09-16T13:02:27Z", "commit": null, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xNlQxMzowMjoyN1rOHSvv1A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xNlQxMzowMjoyN1rOHSvv1A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4OTQxODcwOA==", "bodyText": "please remove this commit", "url": "https://github.com/trinodb/trino/pull/5184#discussion_r489418708", "createdAt": "2020-09-16T13:02:27Z", "author": {"login": "sopel39"}, "path": "presto-hive/src/test/java/io/prestosql/plugin/hive/TestHiveDynamicPartitionPruning.java", "diffHunk": "@@ -34,7 +34,6 @@\n import static com.google.common.collect.Iterables.getOnlyElement;", "state": "SUBMITTED", "replyTo": null, "originalCommit": null, "originalPosition": 1}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "5a9fe02cf019006805c60cf76cf9b5de2c313a45", "author": {"user": {"login": "raunaqmorarka", "name": "Raunaq Morarka"}}, "url": "https://github.com/trinodb/trino/commit/5a9fe02cf019006805c60cf76cf9b5de2c313a45", "committedDate": "2020-09-16T13:16:19Z", "message": "Remove OperatorStats related flaky assertions"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": null, "afterCommit": {"oid": "5a9fe02cf019006805c60cf76cf9b5de2c313a45", "author": {"user": {"login": "raunaqmorarka", "name": "Raunaq Morarka"}}, "url": "https://github.com/trinodb/trino/commit/5a9fe02cf019006805c60cf76cf9b5de2c313a45", "committedDate": "2020-09-16T13:16:19Z", "message": "Remove OperatorStats related flaky assertions"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDg5Njg5MzUy", "url": "https://github.com/trinodb/trino/pull/5184#pullrequestreview-489689352", "createdAt": "2020-09-16T14:32:29Z", "commit": {"oid": "5a9fe02cf019006805c60cf76cf9b5de2c313a45"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "PRR_kwDOCezRTs4uvZtE", "url": "https://github.com/trinodb/trino/pull/5184#pullrequestreview-784177988", "createdAt": "2021-10-20T08:45:49Z", "commit": {"oid": "5a9fe02cf019006805c60cf76cf9b5de2c313a45"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMS0xMC0yMFQwODo0NTo0OVrOK6nMcQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMS0xMC0yMFQwODo0NTo0OVrOK6nMcQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "PRRC_kwDOCezRTs4rqcxx", "bodyText": "@raunaqmorarka would you like to re-enable this?\n(or at least re-link to #5172?)\n#5120 is closed. #5172 isn't solved, but we have developed ways to deal with that in tests", "url": "https://github.com/trinodb/trino/pull/5184#discussion_r732548209", "createdAt": "2021-10-20T08:45:49Z", "author": {"login": "findepi"}, "path": "presto-hive/src/test/java/io/prestosql/plugin/hive/TestHiveDynamicPartitionPruning.java", "diffHunk": "@@ -99,9 +97,8 @@ public void testJoinWithEmptyBuildSide()\n                 \"SELECT * FROM partitioned_lineitem JOIN supplier ON partitioned_lineitem.suppkey = supplier.suppkey AND supplier.name = 'abc'\");\n         assertEquals(result.getResult().getRowCount(), 0);\n \n-        OperatorStats probeStats = searchScanFilterAndProjectOperatorStats(result.getQueryId(), \"tpch:\" + PARTITIONED_LINEITEM);\n-        assertEquals(probeStats.getInputPositions(), 0L);\n-        assertEquals(probeStats.getDynamicFilterSplitsProcessed(), 0L);\n+        // TODO bring back OperatorStats assertions from https://github.com/prestosql/presto/commit/1feaa0f928a02f577c8ac9ef6cc0c8ec2008a46d\n+        // after https://github.com/prestosql/presto/issues/5120 is fixed", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "5a9fe02cf019006805c60cf76cf9b5de2c313a45"}, "originalPosition": 24}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3613, "cost": 1, "resetAt": "2021-10-28T20:13:43Z"}}}