{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0MzU5MjQwMzE1", "number": 2405, "title": "Use testcontainers for Mysql Connector tests", "bodyText": "Use testcontainers for Mysql Connector tests\nAdditionally:\n\nfixed scope of method\ndo not allocate resources in test constructors\nmove execute method to TestingMySqlServer\nuse user and password explicitly", "createdAt": "2020-01-04T19:26:40Z", "url": "https://github.com/trinodb/trino/pull/2405", "merged": true, "mergeCommit": {"oid": "42c6ee198c79f3c43c27619176c0f21fb29b3abb"}, "closed": true, "closedAt": "2020-01-09T13:51:21Z", "author": {"login": "kokosing"}, "timelineItems": {"totalCount": 17, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABb3MShFgFqTMzODM3NTE4Mg==", "endCursor": "Y3Vyc29yOnYyOpPPAAABb4nj9oABqjI5MzQ0NTMzNDk=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzM4Mzc1MTgy", "url": "https://github.com/trinodb/trino/pull/2405#pullrequestreview-338375182", "createdAt": "2020-01-05T00:12:55Z", "commit": null, "state": "APPROVED", "comments": {"totalCount": 6, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0wNVQwMDoxMjo1NlrOFaPiIA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0wNVQwMDoxNzo0NVrOFaPipQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2MzA2MTc5Mg==", "bodyText": "@electrum are we going to archive this project now?", "url": "https://github.com/trinodb/trino/pull/2405#discussion_r363061792", "createdAt": "2020-01-05T00:12:56Z", "author": {"login": "findepi"}, "path": "presto-mysql/pom.xml", "diffHunk": "@@ -141,14 +141,8 @@\n         </dependency>\n \n         <dependency>\n-            <groupId>io.airlift</groupId>\n-            <artifactId>testing-mysql-server</artifactId>", "state": "SUBMITTED", "replyTo": null, "originalCommit": null, "originalPosition": 5}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2MzA2MTgyMg==", "bodyText": "since server is provided in arg, you shouldn't close it.\n(we were doing things like this because we're calling this in ctor code, where we couldn't try-with-resources)", "url": "https://github.com/trinodb/trino/pull/2405#discussion_r363061822", "createdAt": "2020-01-05T00:14:26Z", "author": {"login": "findepi"}, "path": "presto-mysql/src/test/java/io/prestosql/plugin/mysql/MySqlQueryRunner.java", "diffHunk": "@@ -46,42 +45,38 @@ public static QueryRunner createMySqlQueryRunner(TestingMySqlServer server, Map<\n             throws Exception\n     {\n         try {\n-            return createMySqlQueryRunner(server.getJdbcUrl(), connectorProperties, tables);\n-        }\n-        catch (Throwable e) {\n-            closeAllSuppress(e, server);\n-            throw e;\n-        }\n-    }\n+            DistributedQueryRunner queryRunner = null;\n+            try {\n+                queryRunner = new DistributedQueryRunner(createSession(), 3);\n \n-    public static QueryRunner createMySqlQueryRunner(String jdbcUrl, Map<String, String> connectorProperties, Iterable<TpchTable<?>> tables)\n-            throws Exception\n-    {\n-        DistributedQueryRunner queryRunner = null;\n-        try {\n-            queryRunner = new DistributedQueryRunner(createSession(), 3);\n+                queryRunner.installPlugin(new TpchPlugin());\n+                queryRunner.createCatalog(\"tpch\", \"tpch\");\n \n-            queryRunner.installPlugin(new TpchPlugin());\n-            queryRunner.createCatalog(\"tpch\", \"tpch\");\n+                connectorProperties = new HashMap<>(ImmutableMap.copyOf(connectorProperties));\n+                connectorProperties.putIfAbsent(\"connection-url\", server.getJdbcUrl());\n+                connectorProperties.putIfAbsent(\"allow-drop-table\", \"true\");\n+                connectorProperties.putIfAbsent(\"connection-user\", server.getUser());\n+                connectorProperties.putIfAbsent(\"connection-password\", server.getPassword());\n \n-            connectorProperties = new HashMap<>(ImmutableMap.copyOf(connectorProperties));\n-            connectorProperties.putIfAbsent(\"connection-url\", jdbcUrl);\n-            connectorProperties.putIfAbsent(\"allow-drop-table\", \"true\");\n+                queryRunner.installPlugin(new MySqlPlugin());\n+                queryRunner.createCatalog(\"mysql\", \"mysql\", connectorProperties);\n \n-            queryRunner.installPlugin(new MySqlPlugin());\n-            queryRunner.createCatalog(\"mysql\", \"mysql\", connectorProperties);\n+                copyTpchTables(queryRunner, \"tpch\", TINY_SCHEMA_NAME, createSession(), tables);\n \n-            copyTpchTables(queryRunner, \"tpch\", TINY_SCHEMA_NAME, createSession(), tables);\n-\n-            return queryRunner;\n+                return queryRunner;\n+            }\n+            catch (Throwable e) {\n+                closeAllSuppress(e, queryRunner);\n+                throw e;\n+            }\n         }\n         catch (Throwable e) {\n-            closeAllSuppress(e, queryRunner);\n+            closeAllSuppress(e, server);", "state": "SUBMITTED", "replyTo": null, "originalCommit": null, "originalPosition": 62}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2MzA2MTgzNQ==", "bodyText": "move the init before try (the catch clause is pointless as long as queryRunner is null)", "url": "https://github.com/trinodb/trino/pull/2405#discussion_r363061835", "createdAt": "2020-01-05T00:15:12Z", "author": {"login": "findepi"}, "path": "presto-mysql/src/test/java/io/prestosql/plugin/mysql/MySqlQueryRunner.java", "diffHunk": "@@ -46,42 +45,38 @@ public static QueryRunner createMySqlQueryRunner(TestingMySqlServer server, Map<\n             throws Exception\n     {\n         try {\n-            return createMySqlQueryRunner(server.getJdbcUrl(), connectorProperties, tables);\n-        }\n-        catch (Throwable e) {\n-            closeAllSuppress(e, server);\n-            throw e;\n-        }\n-    }\n+            DistributedQueryRunner queryRunner = null;\n+            try {\n+                queryRunner = new DistributedQueryRunner(createSession(), 3);", "state": "SUBMITTED", "replyTo": null, "originalCommit": null, "originalPosition": 21}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2MzA2MTg3NA==", "bodyText": "this belongs to BeforeClass, should not be in test ctor", "url": "https://github.com/trinodb/trino/pull/2405#discussion_r363061874", "createdAt": "2020-01-05T00:15:53Z", "author": {"login": "findepi"}, "path": "presto-mysql/src/test/java/io/prestosql/plugin/mysql/TestCredentialPassThrough.java", "diffHunk": "@@ -25,36 +24,34 @@\n \n import static io.airlift.testing.Closeables.closeAllSuppress;\n import static io.prestosql.testing.TestingSession.testSessionBuilder;\n-import static java.lang.String.format;\n \n-public class TestCredentialPassthrough\n+public class TestCredentialPassThrough\n {\n-    private static final String TEST_SCHEMA = \"test_database\";\n     private final TestingMySqlServer mysqlServer;\n     private final QueryRunner mySqlQueryRunner;\n \n-    public TestCredentialPassthrough()\n+    public TestCredentialPassThrough()\n             throws Exception\n     {\n-        mysqlServer = new TestingMySqlServer(\"testuser\", \"testpass\", TEST_SCHEMA);\n+        mysqlServer = new TestingMySqlServer();", "state": "SUBMITTED", "replyTo": null, "originalCommit": null, "originalPosition": 26}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2MzA2MTg3OQ==", "bodyText": "i think we treat \"passthrough\" as a single word, so lowercase t", "url": "https://github.com/trinodb/trino/pull/2405#discussion_r363061879", "createdAt": "2020-01-05T00:16:15Z", "author": {"login": "findepi"}, "path": "presto-mysql/src/test/java/io/prestosql/plugin/mysql/TestCredentialPassThrough.java", "diffHunk": "@@ -25,36 +24,34 @@\n \n import static io.airlift.testing.Closeables.closeAllSuppress;\n import static io.prestosql.testing.TestingSession.testSessionBuilder;\n-import static java.lang.String.format;\n \n-public class TestCredentialPassthrough\n+public class TestCredentialPassThrough\n {\n-    private static final String TEST_SCHEMA = \"test_database\";\n     private final TestingMySqlServer mysqlServer;\n     private final QueryRunner mySqlQueryRunner;\n \n-    public TestCredentialPassthrough()\n+    public TestCredentialPassThrough()\n             throws Exception\n     {\n-        mysqlServer = new TestingMySqlServer(\"testuser\", \"testpass\", TEST_SCHEMA);\n+        mysqlServer = new TestingMySqlServer();\n         mySqlQueryRunner = createQueryRunner(mysqlServer);\n     }\n \n     @Test\n-    public void testCredentialPassthrough()\n+    public void testCredentialPassThrough()", "state": "SUBMITTED", "replyTo": null, "originalCommit": null, "originalPosition": 32}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2MzA2MTkyNQ==", "bodyText": "same in class name", "url": "https://github.com/trinodb/trino/pull/2405#discussion_r363061925", "createdAt": "2020-01-05T00:17:45Z", "author": {"login": "findepi"}, "path": "presto-mysql/src/test/java/io/prestosql/plugin/mysql/TestCredentialPassThrough.java", "diffHunk": "@@ -25,36 +24,34 @@\n \n import static io.airlift.testing.Closeables.closeAllSuppress;\n import static io.prestosql.testing.TestingSession.testSessionBuilder;\n-import static java.lang.String.format;\n \n-public class TestCredentialPassthrough\n+public class TestCredentialPassThrough\n {\n-    private static final String TEST_SCHEMA = \"test_database\";\n     private final TestingMySqlServer mysqlServer;\n     private final QueryRunner mySqlQueryRunner;\n \n-    public TestCredentialPassthrough()\n+    public TestCredentialPassThrough()\n             throws Exception\n     {\n-        mysqlServer = new TestingMySqlServer(\"testuser\", \"testpass\", TEST_SCHEMA);\n+        mysqlServer = new TestingMySqlServer();\n         mySqlQueryRunner = createQueryRunner(mysqlServer);\n     }\n \n     @Test\n-    public void testCredentialPassthrough()\n+    public void testCredentialPassThrough()", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2MzA2MTg3OQ=="}, "originalCommit": null, "originalPosition": 32}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzM4Mzc2NjUz", "url": "https://github.com/trinodb/trino/pull/2405#pullrequestreview-338376653", "createdAt": "2020-01-05T01:23:14Z", "commit": null, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0wNVQwMToyMzoxNFrOFaPp4A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0wNVQwMToyMzoxNFrOFaPp4A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2MzA2Mzc3Ng==", "bodyText": "The original MySQL version was 8.0.12.\nhttps://github.com/airlift/testing-mysql-server/blob/master/repack-mysql.sh#L5\nCan we use the same version or mention it in the commit description?", "url": "https://github.com/trinodb/trino/pull/2405#discussion_r363063776", "createdAt": "2020-01-05T01:23:14Z", "author": {"login": "ebyhr"}, "path": "presto-mysql/src/test/java/io/prestosql/plugin/mysql/TestingMySqlServer.java", "diffHunk": "@@ -0,0 +1,88 @@\n+/*\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+package io.prestosql.plugin.mysql;\n+\n+import org.testcontainers.containers.MySQLContainer;\n+\n+import java.io.Closeable;\n+import java.sql.Connection;\n+import java.sql.DriverManager;\n+import java.sql.SQLException;\n+import java.sql.Statement;\n+import java.util.Properties;\n+\n+import static java.lang.String.format;\n+import static org.testcontainers.containers.MySQLContainer.MYSQL_PORT;\n+\n+public class TestingMySqlServer\n+        implements Closeable\n+{\n+    private final MySQLContainer<?> dockerContainer;\n+\n+    public TestingMySqlServer()\n+    {\n+        this.dockerContainer = new MySQLContainer<>(\"mysql:8.0.15\");", "state": "SUBMITTED", "replyTo": null, "originalCommit": null, "originalPosition": 35}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzM4Mzc2NjU2", "url": "https://github.com/trinodb/trino/pull/2405#pullrequestreview-338376656", "createdAt": "2020-01-05T01:23:17Z", "commit": null, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzM4Mzg0NzA4", "url": "https://github.com/trinodb/trino/pull/2405#pullrequestreview-338384708", "createdAt": "2020-01-05T07:32:09Z", "commit": null, "state": "COMMENTED", "comments": {"totalCount": 8, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0wNVQwNzozMjowOVrOFaQUmg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0wNVQwNzo0MDo0NVrOFaQV-w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2MzA3NDcxNA==", "bodyText": "Let's leave the execute method, at least for now, as it makes the diff easier to read.", "url": "https://github.com/trinodb/trino/pull/2405#discussion_r363074714", "createdAt": "2020-01-05T07:32:09Z", "author": {"login": "electrum"}, "path": "presto-mysql/src/test/java/io/prestosql/plugin/mysql/TestMySqlIntegrationSmokeTest.java", "diffHunk": "@@ -94,28 +85,25 @@ public void testDropTable()\n \n     @Test\n     public void testViews()\n-            throws SQLException\n     {\n-        execute(\"CREATE OR REPLACE VIEW tpch.test_view AS SELECT * FROM tpch.orders\");\n+        mysqlServer.execute(\"CREATE OR REPLACE VIEW tpch.test_view AS SELECT * FROM tpch.orders\");", "state": "SUBMITTED", "replyTo": null, "originalCommit": null, "originalPosition": 56}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2MzA3NDc2Ng==", "bodyText": "We should close the container here if this throws.", "url": "https://github.com/trinodb/trino/pull/2405#discussion_r363074766", "createdAt": "2020-01-05T07:33:23Z", "author": {"login": "electrum"}, "path": "presto-mysql/src/test/java/io/prestosql/plugin/mysql/TestingMySqlServer.java", "diffHunk": "@@ -0,0 +1,88 @@\n+/*\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+package io.prestosql.plugin.mysql;\n+\n+import org.testcontainers.containers.MySQLContainer;\n+\n+import java.io.Closeable;\n+import java.sql.Connection;\n+import java.sql.DriverManager;\n+import java.sql.SQLException;\n+import java.sql.Statement;\n+import java.util.Properties;\n+\n+import static java.lang.String.format;\n+import static org.testcontainers.containers.MySQLContainer.MYSQL_PORT;\n+\n+public class TestingMySqlServer\n+        implements Closeable\n+{\n+    private final MySQLContainer<?> dockerContainer;\n+\n+    public TestingMySqlServer()\n+    {\n+        this.dockerContainer = new MySQLContainer<>(\"mysql:8.0.15\");\n+        dockerContainer.withDatabaseName(\"tpch\");\n+        dockerContainer.start();\n+        execute(format(\"GRANT ALL PRIVILEGES ON *.* TO '%s'\", dockerContainer.getUsername()), \"root\", dockerContainer.getPassword());", "state": "SUBMITTED", "replyTo": null, "originalCommit": null, "originalPosition": 38}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2MzA3NDgwMQ==", "bodyText": "Let's write this like the PostgreSQL one:\ndockerContainer = new MySQLContainer<>(\"mysql:8.0.15\")\n        .withDatabaseName(\"tpch\");\ndockerContainer.start();", "url": "https://github.com/trinodb/trino/pull/2405#discussion_r363074801", "createdAt": "2020-01-05T07:34:37Z", "author": {"login": "electrum"}, "path": "presto-mysql/src/test/java/io/prestosql/plugin/mysql/TestingMySqlServer.java", "diffHunk": "@@ -0,0 +1,88 @@\n+/*\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+package io.prestosql.plugin.mysql;\n+\n+import org.testcontainers.containers.MySQLContainer;\n+\n+import java.io.Closeable;\n+import java.sql.Connection;\n+import java.sql.DriverManager;\n+import java.sql.SQLException;\n+import java.sql.Statement;\n+import java.util.Properties;\n+\n+import static java.lang.String.format;\n+import static org.testcontainers.containers.MySQLContainer.MYSQL_PORT;\n+\n+public class TestingMySqlServer\n+        implements Closeable\n+{\n+    private final MySQLContainer<?> dockerContainer;\n+\n+    public TestingMySqlServer()\n+    {\n+        this.dockerContainer = new MySQLContainer<>(\"mysql:8.0.15\");", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2MzA2Mzc3Ng=="}, "originalCommit": null, "originalPosition": 35}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2MzA3NDg0MA==", "bodyText": "Use getJdbcUrl() from MySQLContainer which already adds these options", "url": "https://github.com/trinodb/trino/pull/2405#discussion_r363074840", "createdAt": "2020-01-05T07:35:57Z", "author": {"login": "electrum"}, "path": "presto-mysql/src/test/java/io/prestosql/plugin/mysql/TestingMySqlServer.java", "diffHunk": "@@ -0,0 +1,88 @@\n+/*\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+package io.prestosql.plugin.mysql;\n+\n+import org.testcontainers.containers.MySQLContainer;\n+\n+import java.io.Closeable;\n+import java.sql.Connection;\n+import java.sql.DriverManager;\n+import java.sql.SQLException;\n+import java.sql.Statement;\n+import java.util.Properties;\n+\n+import static java.lang.String.format;\n+import static org.testcontainers.containers.MySQLContainer.MYSQL_PORT;\n+\n+public class TestingMySqlServer\n+        implements Closeable\n+{\n+    private final MySQLContainer<?> dockerContainer;\n+\n+    public TestingMySqlServer()\n+    {\n+        this.dockerContainer = new MySQLContainer<>(\"mysql:8.0.15\");\n+        dockerContainer.withDatabaseName(\"tpch\");\n+        dockerContainer.start();\n+        execute(format(\"GRANT ALL PRIVILEGES ON *.* TO '%s'\", dockerContainer.getUsername()), \"root\", dockerContainer.getPassword());\n+    }\n+\n+    public String getJdbcUrl()\n+    {\n+        return format(\"jdbc:mysql://%s:%s?useSSL=false&allowPublicKeyRetrieval=true\", dockerContainer.getContainerIpAddress(), dockerContainer.getMappedPort(MYSQL_PORT));", "state": "SUBMITTED", "replyTo": null, "originalCommit": null, "originalPosition": 43}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2MzA3NDkxMQ==", "bodyText": "Why not\nDriverManager.getConnection(jdbc, user, password);", "url": "https://github.com/trinodb/trino/pull/2405#discussion_r363074911", "createdAt": "2020-01-05T07:37:06Z", "author": {"login": "electrum"}, "path": "presto-mysql/src/test/java/io/prestosql/plugin/mysql/TestingMySqlServer.java", "diffHunk": "@@ -0,0 +1,88 @@\n+/*\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+package io.prestosql.plugin.mysql;\n+\n+import org.testcontainers.containers.MySQLContainer;\n+\n+import java.io.Closeable;\n+import java.sql.Connection;\n+import java.sql.DriverManager;\n+import java.sql.SQLException;\n+import java.sql.Statement;\n+import java.util.Properties;\n+\n+import static java.lang.String.format;\n+import static org.testcontainers.containers.MySQLContainer.MYSQL_PORT;\n+\n+public class TestingMySqlServer\n+        implements Closeable\n+{\n+    private final MySQLContainer<?> dockerContainer;\n+\n+    public TestingMySqlServer()\n+    {\n+        this.dockerContainer = new MySQLContainer<>(\"mysql:8.0.15\");\n+        dockerContainer.withDatabaseName(\"tpch\");\n+        dockerContainer.start();\n+        execute(format(\"GRANT ALL PRIVILEGES ON *.* TO '%s'\", dockerContainer.getUsername()), \"root\", dockerContainer.getPassword());\n+    }\n+\n+    public String getJdbcUrl()\n+    {\n+        return format(\"jdbc:mysql://%s:%s?useSSL=false&allowPublicKeyRetrieval=true\", dockerContainer.getContainerIpAddress(), dockerContainer.getMappedPort(MYSQL_PORT));\n+    }\n+\n+    public String getUser()\n+    {\n+        return dockerContainer.getUsername();\n+    }\n+\n+    public String getPassword()\n+    {\n+        return dockerContainer.getPassword();\n+    }\n+\n+    public String getDatabase()\n+    {\n+        return dockerContainer.getDatabaseName();\n+    }\n+\n+    public void execute(String sql)\n+    {\n+        execute(sql, getUser(), getPassword());\n+    }\n+\n+    private void execute(String sql, String user, String password)\n+    {\n+        String jdbc = getJdbcUrl();\n+\n+        Properties properties = new Properties();\n+        properties.setProperty(\"user\", user);\n+        properties.setProperty(\"password\", password);\n+\n+        try (Connection connection = DriverManager.getConnection(jdbc, properties);", "state": "SUBMITTED", "replyTo": null, "originalCommit": null, "originalPosition": 74}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2MzA3NDk4OA==", "bodyText": "I'd prefer to avoid wrapping here. It's very common for test methods to throw checked exceptions.", "url": "https://github.com/trinodb/trino/pull/2405#discussion_r363074988", "createdAt": "2020-01-05T07:39:11Z", "author": {"login": "electrum"}, "path": "presto-mysql/src/test/java/io/prestosql/plugin/mysql/TestingMySqlServer.java", "diffHunk": "@@ -0,0 +1,88 @@\n+/*\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+package io.prestosql.plugin.mysql;\n+\n+import org.testcontainers.containers.MySQLContainer;\n+\n+import java.io.Closeable;\n+import java.sql.Connection;\n+import java.sql.DriverManager;\n+import java.sql.SQLException;\n+import java.sql.Statement;\n+import java.util.Properties;\n+\n+import static java.lang.String.format;\n+import static org.testcontainers.containers.MySQLContainer.MYSQL_PORT;\n+\n+public class TestingMySqlServer\n+        implements Closeable\n+{\n+    private final MySQLContainer<?> dockerContainer;\n+\n+    public TestingMySqlServer()\n+    {\n+        this.dockerContainer = new MySQLContainer<>(\"mysql:8.0.15\");\n+        dockerContainer.withDatabaseName(\"tpch\");\n+        dockerContainer.start();\n+        execute(format(\"GRANT ALL PRIVILEGES ON *.* TO '%s'\", dockerContainer.getUsername()), \"root\", dockerContainer.getPassword());\n+    }\n+\n+    public String getJdbcUrl()\n+    {\n+        return format(\"jdbc:mysql://%s:%s?useSSL=false&allowPublicKeyRetrieval=true\", dockerContainer.getContainerIpAddress(), dockerContainer.getMappedPort(MYSQL_PORT));\n+    }\n+\n+    public String getUser()\n+    {\n+        return dockerContainer.getUsername();\n+    }\n+\n+    public String getPassword()\n+    {\n+        return dockerContainer.getPassword();\n+    }\n+\n+    public String getDatabase()\n+    {\n+        return dockerContainer.getDatabaseName();\n+    }\n+\n+    public void execute(String sql)\n+    {\n+        execute(sql, getUser(), getPassword());\n+    }\n+\n+    private void execute(String sql, String user, String password)\n+    {\n+        String jdbc = getJdbcUrl();\n+\n+        Properties properties = new Properties();\n+        properties.setProperty(\"user\", user);\n+        properties.setProperty(\"password\", password);\n+\n+        try (Connection connection = DriverManager.getConnection(jdbc, properties);\n+                Statement statement = connection.createStatement()) {\n+            statement.execute(sql);\n+        }\n+        catch (SQLException e) {\n+            throw new RuntimeException(e);", "state": "SUBMITTED", "replyTo": null, "originalCommit": null, "originalPosition": 79}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2MzA3NTAwMg==", "bodyText": "Same comment as TestMySqlIntegrationSmokeTest. Let's keep the execute method for now.", "url": "https://github.com/trinodb/trino/pull/2405#discussion_r363075002", "createdAt": "2020-01-05T07:39:50Z", "author": {"login": "electrum"}, "path": "presto-mysql/src/test/java/io/prestosql/plugin/mysql/TestMySqlCaseInsensitiveMapping.java", "diffHunk": "@@ -100,7 +74,7 @@ public void testNonLowerCaseTableName()\n         try (AutoCloseable ignore1 = withSchema(\"SomeSchema\");\n                 AutoCloseable ignore2 = withTable(\n                         \"SomeSchema.NonLowerCaseTable\", \"(lower_case_name varchar(10), Mixed_Case_Name varchar(10), UPPER_CASE_NAME varchar(10))\")) {\n-            execute(\"INSERT INTO SomeSchema.NonLowerCaseTable VALUES ('a', 'b', 'c')\");\n+            mySqlServer.execute(\"INSERT INTO SomeSchema.NonLowerCaseTable VALUES ('a', 'b', 'c')\");", "state": "SUBMITTED", "replyTo": null, "originalCommit": null, "originalPosition": 68}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2MzA3NTA2Nw==", "bodyText": "Agreed, plus if we were to change it, that should be a separate commit.", "url": "https://github.com/trinodb/trino/pull/2405#discussion_r363075067", "createdAt": "2020-01-05T07:40:45Z", "author": {"login": "electrum"}, "path": "presto-mysql/src/test/java/io/prestosql/plugin/mysql/TestCredentialPassThrough.java", "diffHunk": "@@ -25,36 +24,34 @@\n \n import static io.airlift.testing.Closeables.closeAllSuppress;\n import static io.prestosql.testing.TestingSession.testSessionBuilder;\n-import static java.lang.String.format;\n \n-public class TestCredentialPassthrough\n+public class TestCredentialPassThrough\n {\n-    private static final String TEST_SCHEMA = \"test_database\";\n     private final TestingMySqlServer mysqlServer;\n     private final QueryRunner mySqlQueryRunner;\n \n-    public TestCredentialPassthrough()\n+    public TestCredentialPassThrough()\n             throws Exception\n     {\n-        mysqlServer = new TestingMySqlServer(\"testuser\", \"testpass\", TEST_SCHEMA);\n+        mysqlServer = new TestingMySqlServer();\n         mySqlQueryRunner = createQueryRunner(mysqlServer);\n     }\n \n     @Test\n-    public void testCredentialPassthrough()\n+    public void testCredentialPassThrough()", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2MzA2MTg3OQ=="}, "originalCommit": null, "originalPosition": 32}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": null, "afterCommit": null}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzM5MjQzNzIw", "url": "https://github.com/trinodb/trino/pull/2405#pullrequestreview-339243720", "createdAt": "2020-01-07T13:46:59Z", "commit": null, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0wN1QxMzo0Njo1OVrOFa5yOg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0wN1QxMzo0Njo1OVrOFa5yOg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2Mzc1NDA0Mg==", "bodyText": "It is needed so user can create or drop schema. Notice that org.testcontainers.containers.MySQLContainer#getUsername do not return root user. Alternatively I could use root user in tests.", "url": "https://github.com/trinodb/trino/pull/2405#discussion_r363754042", "createdAt": "2020-01-07T13:46:59Z", "author": {"login": "kokosing"}, "path": "presto-mysql/src/test/java/io/prestosql/plugin/mysql/TestingMySqlServer.java", "diffHunk": "@@ -0,0 +1,88 @@\n+/*\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+package io.prestosql.plugin.mysql;\n+\n+import org.testcontainers.containers.MySQLContainer;\n+\n+import java.io.Closeable;\n+import java.sql.Connection;\n+import java.sql.DriverManager;\n+import java.sql.SQLException;\n+import java.sql.Statement;\n+import java.util.Properties;\n+\n+import static java.lang.String.format;\n+import static org.testcontainers.containers.MySQLContainer.MYSQL_PORT;\n+\n+public class TestingMySqlServer\n+        implements Closeable\n+{\n+    private final MySQLContainer<?> dockerContainer;\n+\n+    public TestingMySqlServer()\n+    {\n+        this.dockerContainer = new MySQLContainer<>(\"mysql:8.0.15\");\n+        dockerContainer.withDatabaseName(\"tpch\");\n+        dockerContainer.start();\n+        execute(format(\"GRANT ALL PRIVILEGES ON *.* TO '%s'\", dockerContainer.getUsername()), \"root\", dockerContainer.getPassword());", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2MzA3NDc2Ng=="}, "originalCommit": null, "originalPosition": 38}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": null, "afterCommit": null}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": null, "afterCommit": null}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzQwMTY2ODYz", "url": "https://github.com/trinodb/trino/pull/2405#pullrequestreview-340166863", "createdAt": "2020-01-08T21:48:36Z", "commit": null, "state": "APPROVED", "comments": {"totalCount": 6, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0wOFQyMTo0ODozN1rOFbk3ZA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0wOFQyMTo1MToyM1rOFbk7eQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NDQ1OTg3Ng==", "bodyText": "Are we missing a dependency on the testcontainers artifact?", "url": "https://github.com/trinodb/trino/pull/2405#discussion_r364459876", "createdAt": "2020-01-08T21:48:37Z", "author": {"login": "electrum"}, "path": "presto-mysql/pom.xml", "diffHunk": "@@ -141,14 +141,8 @@\n         </dependency>\n \n         <dependency>\n-            <groupId>io.airlift</groupId>\n-            <artifactId>testing-mysql-server</artifactId>\n-            <scope>test</scope>\n-        </dependency>\n-\n-        <dependency>", "state": "SUBMITTED", "replyTo": null, "originalCommit": null, "originalPosition": 9}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NDQ2MDAwNA==", "bodyText": "Let's move this so all of the connection- properties are together", "url": "https://github.com/trinodb/trino/pull/2405#discussion_r364460004", "createdAt": "2020-01-08T21:48:58Z", "author": {"login": "electrum"}, "path": "presto-mysql/src/test/java/io/prestosql/plugin/mysql/MySqlQueryRunner.java", "diffHunk": "@@ -45,28 +44,16 @@ public static QueryRunner createMySqlQueryRunner(TestingMySqlServer server, Tpch\n     public static QueryRunner createMySqlQueryRunner(TestingMySqlServer server, Map<String, String> connectorProperties, Iterable<TpchTable<?>> tables)\n             throws Exception\n     {\n+        DistributedQueryRunner queryRunner = DistributedQueryRunner.builder(createSession()).build();\n         try {\n-            return createMySqlQueryRunner(server.getJdbcUrl(), connectorProperties, tables);\n-        }\n-        catch (Throwable e) {\n-            closeAllSuppress(e, server);\n-            throw e;\n-        }\n-    }\n-\n-    public static QueryRunner createMySqlQueryRunner(String jdbcUrl, Map<String, String> connectorProperties, Iterable<TpchTable<?>> tables)\n-            throws Exception\n-    {\n-        DistributedQueryRunner queryRunner = null;\n-        try {\n-            queryRunner = DistributedQueryRunner.builder(createSession()).build();\n-\n             queryRunner.installPlugin(new TpchPlugin());\n             queryRunner.createCatalog(\"tpch\", \"tpch\");\n \n             connectorProperties = new HashMap<>(ImmutableMap.copyOf(connectorProperties));\n-            connectorProperties.putIfAbsent(\"connection-url\", jdbcUrl);\n+            connectorProperties.putIfAbsent(\"connection-url\", server.getJdbcUrl());", "state": "SUBMITTED", "replyTo": null, "originalCommit": null, "originalPosition": 34}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NDQ2MDIxMw==", "bodyText": "This can be inlined", "url": "https://github.com/trinodb/trino/pull/2405#discussion_r364460213", "createdAt": "2020-01-08T21:49:31Z", "author": {"login": "electrum"}, "path": "presto-mysql/src/test/java/io/prestosql/plugin/mysql/TestMySqlIntegrationSmokeTest.java", "diffHunk": "@@ -227,10 +219,11 @@ protected boolean canDropSchema()\n \n     @Override\n     protected void cleanUpSchemas(List<String> schemaNames)\n-            throws SQLException\n+            throws Exception\n     {\n         for (String schemaName : schemaNames) {\n-            execute(\"DROP SCHEMA \" + schemaName);\n+            String sql = \"DROP SCHEMA \" + schemaName;\n+            execute(sql);", "state": "SUBMITTED", "replyTo": null, "originalCommit": null, "originalPosition": 73}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NDQ2MDMwNw==", "bodyText": "Why change this? Exception is good for @Test method but I'd prefer if helper methods throw the correct exception type.", "url": "https://github.com/trinodb/trino/pull/2405#discussion_r364460307", "createdAt": "2020-01-08T21:49:44Z", "author": {"login": "electrum"}, "path": "presto-mysql/src/test/java/io/prestosql/plugin/mysql/TestMySqlIntegrationSmokeTest.java", "diffHunk": "@@ -248,11 +241,8 @@ public void testColumnComment()\n     }\n \n     private void execute(String sql)\n-            throws SQLException\n+            throws Exception", "state": "SUBMITTED", "replyTo": null, "originalCommit": null, "originalPosition": 82}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NDQ2MDM4OA==", "bodyText": "See comment for execute", "url": "https://github.com/trinodb/trino/pull/2405#discussion_r364460388", "createdAt": "2020-01-08T21:49:57Z", "author": {"login": "electrum"}, "path": "presto-mysql/src/test/java/io/prestosql/plugin/mysql/TestMySqlIntegrationSmokeTest.java", "diffHunk": "@@ -227,10 +219,11 @@ protected boolean canDropSchema()\n \n     @Override\n     protected void cleanUpSchemas(List<String> schemaNames)\n-            throws SQLException\n+            throws Exception", "state": "SUBMITTED", "replyTo": null, "originalCommit": null, "originalPosition": 68}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NDQ2MDkyMQ==", "bodyText": "Consider making this extend MySQLContainer like I did in 79b5d4f. That avoids needing all of the pass-through methods.", "url": "https://github.com/trinodb/trino/pull/2405#discussion_r364460921", "createdAt": "2020-01-08T21:51:23Z", "author": {"login": "electrum"}, "path": "presto-mysql/src/test/java/io/prestosql/plugin/mysql/TestingMySqlServer.java", "diffHunk": "@@ -0,0 +1,81 @@\n+/*\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+package io.prestosql.plugin.mysql;\n+\n+import org.testcontainers.containers.MySQLContainer;\n+\n+import java.io.Closeable;\n+import java.sql.Connection;\n+import java.sql.DriverManager;\n+import java.sql.SQLException;\n+import java.sql.Statement;\n+\n+import static java.lang.String.format;\n+import static org.testcontainers.containers.MySQLContainer.MYSQL_PORT;\n+\n+public class TestingMySqlServer", "state": "SUBMITTED", "replyTo": null, "originalCommit": null, "originalPosition": 27}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "30097a466cee573c17d7af45f9c17daa03abe011", "author": {"user": {"login": "kokosing", "name": "Grzegorz Kokosi\u0144ski"}}, "url": "https://github.com/trinodb/trino/commit/30097a466cee573c17d7af45f9c17daa03abe011", "committedDate": "2020-01-09T06:25:33Z", "message": "Do not leak resources in TestCredentialPassthrough"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d0bfae942c6ebb1e6bbd9cf479b86ed83b9b04fd", "author": {"user": {"login": "kokosing", "name": "Grzegorz Kokosi\u0144ski"}}, "url": "https://github.com/trinodb/trino/commit/d0bfae942c6ebb1e6bbd9cf479b86ed83b9b04fd", "committedDate": "2020-01-09T06:25:33Z", "message": "Generalize exception thrown in tests"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "09942314b00915e6e9685e3eb0176121e26940c6", "author": {"user": {"login": "kokosing", "name": "Grzegorz Kokosi\u0144ski"}}, "url": "https://github.com/trinodb/trino/commit/09942314b00915e6e9685e3eb0176121e26940c6", "committedDate": "2020-01-09T06:25:33Z", "message": "Remove extra annotations"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "14130b0babd785a4cbb90cebf15eda948aa44af1", "author": {"user": {"login": "kokosing", "name": "Grzegorz Kokosi\u0144ski"}}, "url": "https://github.com/trinodb/trino/commit/14130b0babd785a4cbb90cebf15eda948aa44af1", "committedDate": "2020-01-09T06:25:33Z", "message": "Do not swallow exception when closing TestTable"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": null, "afterCommit": null}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzQwMzEwMDMw", "url": "https://github.com/trinodb/trino/pull/2405#pullrequestreview-340310030", "createdAt": "2020-01-09T06:27:09Z", "commit": null, "state": "COMMENTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0wOVQwNjoyNzowOVrOFbr8Zw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0wOVQwNjo0NTo0N1rOFbsLoA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NDU3NTg0Nw==", "bodyText": "Is this needed? Maven didn't complain. Notice that I am using org.testcontainers:mysql, it looks to be enough. I don't use anything else from testcontainers other than mysql container.", "url": "https://github.com/trinodb/trino/pull/2405#discussion_r364575847", "createdAt": "2020-01-09T06:27:09Z", "author": {"login": "kokosing"}, "path": "presto-mysql/pom.xml", "diffHunk": "@@ -141,14 +141,8 @@\n         </dependency>\n \n         <dependency>\n-            <groupId>io.airlift</groupId>\n-            <artifactId>testing-mysql-server</artifactId>\n-            <scope>test</scope>\n-        </dependency>\n-\n-        <dependency>", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NDQ1OTg3Ng=="}, "originalCommit": null, "originalPosition": 9}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NDU3OTc0NA==", "bodyText": "@electrum WRT: I am going to not declare exception here. It propagates to all other places. The entire smelly commit 2d70587 was because of this.\nWhen I applied https://github.com/prestosql/presto/pull/2405/files#r364460921, then start method has to handle this exception anyway which was ugly.", "url": "https://github.com/trinodb/trino/pull/2405#discussion_r364579744", "createdAt": "2020-01-09T06:45:47Z", "author": {"login": "kokosing"}, "path": "presto-mysql/src/test/java/io/prestosql/plugin/mysql/TestingMySqlServer.java", "diffHunk": "@@ -0,0 +1,81 @@\n+/*\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+package io.prestosql.plugin.mysql;\n+\n+import org.testcontainers.containers.MySQLContainer;\n+\n+import java.io.Closeable;\n+import java.sql.Connection;\n+import java.sql.DriverManager;\n+import java.sql.SQLException;\n+import java.sql.Statement;\n+\n+import static java.lang.String.format;\n+import static org.testcontainers.containers.MySQLContainer.MYSQL_PORT;\n+\n+public class TestingMySqlServer\n+        implements Closeable\n+{\n+    private final MySQLContainer<?> dockerContainer;\n+\n+    public TestingMySqlServer()\n+            throws Exception\n+    {\n+        this.dockerContainer = new MySQLContainer<>(\"mysql:8.0.12\")\n+                .withDatabaseName(\"tpch\");\n+        dockerContainer.start();\n+        execute(format(\"GRANT ALL PRIVILEGES ON *.* TO '%s'\", dockerContainer.getUsername()), \"root\", dockerContainer.getPassword());\n+    }\n+\n+    public String getJdbcUrl()\n+    {\n+        return format(\"jdbc:mysql://%s:%s?useSSL=false&allowPublicKeyRetrieval=true\", dockerContainer.getContainerIpAddress(), dockerContainer.getMappedPort(MYSQL_PORT));\n+    }\n+\n+    public String getUser()\n+    {\n+        return dockerContainer.getUsername();\n+    }\n+\n+    public String getPassword()\n+    {\n+        return dockerContainer.getPassword();\n+    }\n+\n+    public String getDatabase()\n+    {\n+        return dockerContainer.getDatabaseName();\n+    }\n+\n+    public void execute(String sql)\n+            throws SQLException\n+    {\n+        execute(sql, getUser(), getPassword());\n+    }\n+\n+    public void execute(String sql, String user, String password)", "state": "SUBMITTED", "replyTo": null, "originalCommit": null, "originalPosition": 67}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "09d86bb0c11e6094946b8c12d0884ddd9bfa2017", "author": {"user": {"login": "kokosing", "name": "Grzegorz Kokosi\u0144ski"}}, "url": "https://github.com/trinodb/trino/commit/09d86bb0c11e6094946b8c12d0884ddd9bfa2017", "committedDate": "2020-01-09T10:39:55Z", "message": "Use testcontainers for Mysql Connector tests\n\nAdditionally:\n- fixed scope of method\n- do not allocate resources in test constructors\n- move execute method to TestingMySqlServer\n- use user and password explicitly"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": null, "afterCommit": {"oid": "09d86bb0c11e6094946b8c12d0884ddd9bfa2017", "author": {"user": {"login": "kokosing", "name": "Grzegorz Kokosi\u0144ski"}}, "url": "https://github.com/trinodb/trino/commit/09d86bb0c11e6094946b8c12d0884ddd9bfa2017", "committedDate": "2020-01-09T10:39:55Z", "message": "Use testcontainers for Mysql Connector tests\n\nAdditionally:\n- fixed scope of method\n- do not allocate resources in test constructors\n- move execute method to TestingMySqlServer\n- use user and password explicitly"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1015, "cost": 1, "resetAt": "2021-10-28T19:08:13Z"}}}