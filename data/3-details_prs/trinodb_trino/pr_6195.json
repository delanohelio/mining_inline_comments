{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTMxOTgyMTIx", "number": 6195, "title": "Allow using legacy Hive view translation logic", "bodyText": "", "createdAt": "2020-12-03T18:16:24Z", "url": "https://github.com/trinodb/trino/pull/6195", "merged": true, "mergeCommit": {"oid": "16c38d05a82de0a3f60e643ecde4b555072ad745"}, "closed": true, "closedAt": "2020-12-03T22:06:44Z", "author": {"login": "losipiuk"}, "timelineItems": {"totalCount": 6, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdimuSugH2gAyNTMxOTgyMTIxOjkxMjFmOTdjY2YyMTE4YWMzN2RjOTk3ZmRjOTExZWJiMDY5MzcwYjY=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdioe9qgBqjQwNjkzNDEzMzk=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "9121f97ccf2118ac37dc997fdc911ebb069370b6", "author": {"user": {"login": "losipiuk", "name": "\u0141ukasz Osipiuk"}}, "url": "https://github.com/trinodb/trino/commit/9121f97ccf2118ac37dc997fdc911ebb069370b6", "committedDate": "2020-12-03T17:37:37Z", "message": "Pass session to view reader factory"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTQ0MjQ4NDY1", "url": "https://github.com/trinodb/trino/pull/6195#pullrequestreview-544248465", "createdAt": "2020-12-03T18:18:04Z", "commit": null, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0wM1QxODoxODowNFrOH-qnpg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0wM1QxODoxODowNFrOH-qnpg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNTQ3MjAzOA==", "bodyText": "I am not super convinced that we need this base class.\nMaybe just leave TestHiveViews as is, and use it for testing default configuration (with Coral).\nAnd add TestHiveViewsLegacy based on how TestHiveViews looked before Coral was introduced.", "url": "https://github.com/trinodb/trino/pull/6195#discussion_r535472038", "createdAt": "2020-12-03T18:18:04Z", "author": {"login": "losipiuk"}, "path": "presto-product-tests/src/main/java/io/prestosql/tests/hive/BaseTestHiveViews.java", "diffHunk": "@@ -38,7 +38,7 @@\n         ImmutableNationTable.class,\n         ImmutableOrdersTable.class,\n })\n-public class TestHiveViews\n+public abstract class BaseTestHiveViews", "state": "SUBMITTED", "replyTo": null, "originalCommit": null, "originalPosition": 5}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": null, "afterCommit": null}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTQ0MjcyMzMz", "url": "https://github.com/trinodb/trino/pull/6195#pullrequestreview-544272333", "createdAt": "2020-12-03T18:49:04Z", "commit": null, "state": "APPROVED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0wM1QxODo0OTowNFrOH-r5VQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0wM1QxODo1MDoyMFrOH-r8eQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNTQ5Mjk0OQ==", "bodyText": "static import", "url": "https://github.com/trinodb/trino/pull/6195#discussion_r535492949", "createdAt": "2020-12-03T18:49:04Z", "author": {"login": "findepi"}, "path": "presto-hive/src/main/java/io/prestosql/plugin/hive/ViewReaderUtil.java", "diffHunk": "@@ -65,6 +68,10 @@ public static ViewReader createViewReader(SemiTransactionalHiveMetastore metasto\n         if (isPrestoView(table)) {\n             return new PrestoViewReader();\n         }\n+        if (HiveSessionProperties.isLegacyHiveViewTranslation(session)) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": null, "originalPosition": 24}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNTQ5Mzc1Mw==", "bodyText": "Did you mean to inherit these tests from the base class?", "url": "https://github.com/trinodb/trino/pull/6195#discussion_r535493753", "createdAt": "2020-12-03T18:50:20Z", "author": {"login": "findepi"}, "path": "presto-product-tests/src/main/java/io/prestosql/tests/hive/TestHiveViewsLegacy.java", "diffHunk": "@@ -0,0 +1,108 @@\n+/*\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+package io.prestosql.tests.hive;\n+\n+import io.prestosql.tempto.BeforeTestWithContext;\n+import io.prestosql.tests.utils.QueryExecutors;\n+import org.testng.annotations.Test;\n+\n+import java.math.BigDecimal;\n+\n+import static io.prestosql.tempto.assertions.QueryAssert.Row.row;\n+import static io.prestosql.tempto.assertions.QueryAssert.assertThat;\n+import static io.prestosql.tempto.query.QueryExecutor.query;\n+import static io.prestosql.tests.TestGroups.HIVE_VIEWS;\n+import static io.prestosql.tests.utils.QueryExecutors.onHive;\n+import static io.prestosql.tests.utils.QueryExecutors.onPresto;\n+\n+public class TestHiveViewsLegacy\n+        extends BaseTestHiveViews\n+{\n+    @BeforeTestWithContext\n+    public void setup()\n+    {\n+        // We need to setup sessions for both \"presto\" and \"default\" executors in tempto\n+        onPresto().executeQuery(\"SET SESSION hive.legacy_hive_view_translation = true\");\n+        query(\"SET SESSION hive.legacy_hive_view_translation = true\");\n+    }\n+\n+    @Test(groups = HIVE_VIEWS)\n+    public void testShowCreateView()", "state": "SUBMITTED", "replyTo": null, "originalCommit": null, "originalPosition": 41}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "1883af4b6151d66657746fe40e0fee4ab378164a", "author": {"user": {"login": "losipiuk", "name": "\u0141ukasz Osipiuk"}}, "url": "https://github.com/trinodb/trino/commit/1883af4b6151d66657746fe40e0fee4ab378164a", "committedDate": "2020-12-03T19:37:05Z", "message": "Allow using legacy Hive view translation logic"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": null, "afterCommit": {"oid": "1883af4b6151d66657746fe40e0fee4ab378164a", "author": {"user": {"login": "losipiuk", "name": "\u0141ukasz Osipiuk"}}, "url": "https://github.com/trinodb/trino/commit/1883af4b6151d66657746fe40e0fee4ab378164a", "committedDate": "2020-12-03T19:37:05Z", "message": "Allow using legacy Hive view translation logic"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2026, "cost": 1, "resetAt": "2021-10-28T20:13:43Z"}}}