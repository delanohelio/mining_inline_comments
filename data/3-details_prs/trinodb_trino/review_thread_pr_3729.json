{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDE3OTIwMzg1", "number": 3729, "reviewThreads": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xNFQxMToxMTowOFrOD8bn5A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xNFQxMjo1ODoxNFrOD8d1Qw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjY0NjkzNzMyOnYy", "diffSide": "RIGHT", "path": "presto-hive/src/main/java/io/prestosql/plugin/hive/rubix/RubixConfigurationInitializer.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xNFQxMToxMTowOFrOGVXZxw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xNFQxMTo1NToyNFrOGVYyIg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNTA1NjcxMQ==", "bodyText": "Are we in control over ordering of DynamicConfigurationProviders. This check makes sense only if we know RubixConfigurationInitializer will run last. Right?", "url": "https://github.com/trinodb/trino/pull/3729#discussion_r425056711", "createdAt": "2020-05-14T11:11:08Z", "author": {"login": "losipiuk"}, "path": "presto-hive/src/main/java/io/prestosql/plugin/hive/rubix/RubixConfigurationInitializer.java", "diffHunk": "@@ -69,17 +74,20 @@ public RubixConfigurationInitializer(RubixConfig config)\n     }\n \n     @Override\n-    public void initializeConfiguration(Configuration config)\n+    public void updateConfiguration(Configuration config, HdfsContext context, URI uri)\n     {\n+        checkState(getCacheKey(config) == null, \"Rubix does not support dynamic FileSystems\");", "state": "SUBMITTED", "replyTo": null, "originalCommit": null, "originalPosition": 37}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNTA3OTMzMA==", "bodyText": "Are we in control over ordering of DynamicConfigurationProviders. This check makes sense only if we know RubixConfigurationInitializer will run last. Right?\n\nYes. This is best effort check.\nI've removed this test for now since it might be confusing", "url": "https://github.com/trinodb/trino/pull/3729#discussion_r425079330", "createdAt": "2020-05-14T11:55:24Z", "author": {"login": "sopel39"}, "path": "presto-hive/src/main/java/io/prestosql/plugin/hive/rubix/RubixConfigurationInitializer.java", "diffHunk": "@@ -69,17 +74,20 @@ public RubixConfigurationInitializer(RubixConfig config)\n     }\n \n     @Override\n-    public void initializeConfiguration(Configuration config)\n+    public void updateConfiguration(Configuration config, HdfsContext context, URI uri)\n     {\n+        checkState(getCacheKey(config) == null, \"Rubix does not support dynamic FileSystems\");", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNTA1NjcxMQ=="}, "originalCommit": null, "originalPosition": 37}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjY0Njk0NTI1OnYy", "diffSide": "RIGHT", "path": "presto-hive/src/main/java/io/prestosql/plugin/hive/rubix/RubixConfigurationInitializer.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xNFQxMToxMzozNlrOGVXekw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xNFQxMjowODoyMVrOGVZL6g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNTA1NzkzOQ==", "bodyText": "private", "url": "https://github.com/trinodb/trino/pull/3729#discussion_r425057939", "createdAt": "2020-05-14T11:13:36Z", "author": {"login": "losipiuk"}, "path": "presto-hive/src/main/java/io/prestosql/plugin/hive/rubix/RubixConfigurationInitializer.java", "diffHunk": "@@ -69,17 +74,20 @@ public RubixConfigurationInitializer(RubixConfig config)\n     }\n \n     @Override\n-    public void initializeConfiguration(Configuration config)\n+    public void updateConfiguration(Configuration config, HdfsContext context, URI uri)\n     {\n+        checkState(getCacheKey(config) == null, \"Rubix does not support dynamic FileSystems\");\n+\n         if (!cacheReady) {\n             setCacheDataEnabled(config, false);\n+            setCacheKey(config, \"rubix_disabled\");\n             return;\n         }\n \n         updateConfiguration(config);\n     }\n \n-    public Configuration updateConfiguration(Configuration config)\n+    public void updateConfiguration(Configuration config)", "state": "SUBMITTED", "replyTo": null, "originalCommit": null, "originalPosition": 49}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNTA4NTkzMA==", "bodyText": "This needs to stay package-private as it's accessed from RubixInitializer", "url": "https://github.com/trinodb/trino/pull/3729#discussion_r425085930", "createdAt": "2020-05-14T12:08:21Z", "author": {"login": "sopel39"}, "path": "presto-hive/src/main/java/io/prestosql/plugin/hive/rubix/RubixConfigurationInitializer.java", "diffHunk": "@@ -69,17 +74,20 @@ public RubixConfigurationInitializer(RubixConfig config)\n     }\n \n     @Override\n-    public void initializeConfiguration(Configuration config)\n+    public void updateConfiguration(Configuration config, HdfsContext context, URI uri)\n     {\n+        checkState(getCacheKey(config) == null, \"Rubix does not support dynamic FileSystems\");\n+\n         if (!cacheReady) {\n             setCacheDataEnabled(config, false);\n+            setCacheKey(config, \"rubix_disabled\");\n             return;\n         }\n \n         updateConfiguration(config);\n     }\n \n-    public Configuration updateConfiguration(Configuration config)\n+    public void updateConfiguration(Configuration config)", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNTA1NzkzOQ=="}, "originalCommit": null, "originalPosition": 49}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjY0NzI5OTIzOnYy", "diffSide": "RIGHT", "path": "presto-hive/src/main/java/io/prestosql/plugin/hive/DynamicConfigurationProvider.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xNFQxMjo1ODoxNFrOGVa9hQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xNFQxMjo1ODoxNFrOGVa9hQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNTExNTAxMw==", "bodyText": "not needed any more", "url": "https://github.com/trinodb/trino/pull/3729#discussion_r425115013", "createdAt": "2020-05-14T12:58:14Z", "author": {"login": "losipiuk"}, "path": "presto-hive/src/main/java/io/prestosql/plugin/hive/DynamicConfigurationProvider.java", "diffHunk": "@@ -24,6 +24,11 @@\n {\n     void updateConfiguration(Configuration configuration, HdfsContext context, URI uri);\n \n+    static String getCacheKey(Configuration configuration)", "state": "SUBMITTED", "replyTo": null, "originalCommit": null, "originalPosition": 4}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4812, "cost": 1, "resetAt": "2021-11-13T12:26:42Z"}}}