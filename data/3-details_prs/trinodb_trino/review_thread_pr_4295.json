{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDQyNjQ3OTkz", "number": 4295, "reviewThreads": {"totalCount": 7, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wMVQxMjowNjozN1rOEKe8ow==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wMVQxMjoxMDowN1rOEKfBRg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjc5NDI4MjU5OnYy", "diffSide": "RIGHT", "path": "presto-hive-hadoop2/bin/common.sh", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wMVQxMjowNjozN1rOGrjHEg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wMVQxMzowODo1N1rOGrlJxQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0ODMxNzIwMg==", "bodyText": "local must be on sep line, otherwise it masks exit codes\nwhat does t and d mean?\nbtw my idiom for grep+sed is\nsed -n 's/..../..../p'", "url": "https://github.com/trinodb/trino/pull/4295#discussion_r448317202", "createdAt": "2020-07-01T12:06:37Z", "author": {"login": "findepi"}, "path": "presto-hive-hadoop2/bin/common.sh", "diffHunk": "@@ -132,3 +132,12 @@ function start_hadoop_docker_containers() {\n   # wait until hadoop processes is started\n   retry check_hadoop\n }\n+\n+function get_hive_major_version() {\n+    local version=$(exec_in_hadoop_master_container hive --version 2>/dev/null | sed 's/^Hive.*[ ]\\([0-9]\\)\\..*/\\1/;t;d')", "state": "SUBMITTED", "replyTo": null, "originalCommit": null, "originalPosition": 6}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0ODM1MDY2MQ==", "bodyText": "https://stackoverflow.com/a/1665662.\nDIfferent method. Same result.", "url": "https://github.com/trinodb/trino/pull/4295#discussion_r448350661", "createdAt": "2020-07-01T13:08:57Z", "author": {"login": "losipiuk"}, "path": "presto-hive-hadoop2/bin/common.sh", "diffHunk": "@@ -132,3 +132,12 @@ function start_hadoop_docker_containers() {\n   # wait until hadoop processes is started\n   retry check_hadoop\n }\n+\n+function get_hive_major_version() {\n+    local version=$(exec_in_hadoop_master_container hive --version 2>/dev/null | sed 's/^Hive.*[ ]\\([0-9]\\)\\..*/\\1/;t;d')", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0ODMxNzIwMg=="}, "originalCommit": null, "originalPosition": 6}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjc5NDI4MzE4OnYy", "diffSide": "RIGHT", "path": "presto-hive-hadoop2/bin/common.sh", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wMVQxMjowNjo0OFrOGrjHcg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wMVQxMjowNjo0OFrOGrjHcg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0ODMxNzI5OA==", "bodyText": ">&2", "url": "https://github.com/trinodb/trino/pull/4295#discussion_r448317298", "createdAt": "2020-07-01T12:06:48Z", "author": {"login": "findepi"}, "path": "presto-hive-hadoop2/bin/common.sh", "diffHunk": "@@ -132,3 +132,12 @@ function start_hadoop_docker_containers() {\n   # wait until hadoop processes is started\n   retry check_hadoop\n }\n+\n+function get_hive_major_version() {\n+    local version=$(exec_in_hadoop_master_container hive --version 2>/dev/null | sed 's/^Hive.*[ ]\\([0-9]\\)\\..*/\\1/;t;d')\n+    if [[ \"${version}\" == \"\" ]]; then\n+        echo \"Could not obtain Hive major version\"", "state": "SUBMITTED", "replyTo": null, "originalCommit": null, "originalPosition": 8}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjc5NDI4MzQ5OnYy", "diffSide": "RIGHT", "path": "presto-hive-hadoop2/bin/common.sh", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wMVQxMjowNjo1M1rOGrjHqA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wMVQxMjowNjo1M1rOGrjHqA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0ODMxNzM1Mg==", "bodyText": "\" quote", "url": "https://github.com/trinodb/trino/pull/4295#discussion_r448317352", "createdAt": "2020-07-01T12:06:53Z", "author": {"login": "findepi"}, "path": "presto-hive-hadoop2/bin/common.sh", "diffHunk": "@@ -132,3 +132,12 @@ function start_hadoop_docker_containers() {\n   # wait until hadoop processes is started\n   retry check_hadoop\n }\n+\n+function get_hive_major_version() {\n+    local version=$(exec_in_hadoop_master_container hive --version 2>/dev/null | sed 's/^Hive.*[ ]\\([0-9]\\)\\..*/\\1/;t;d')\n+    if [[ \"${version}\" == \"\" ]]; then\n+        echo \"Could not obtain Hive major version\"\n+        return 1\n+    fi\n+    echo ${version}", "state": "SUBMITTED", "replyTo": null, "originalCommit": null, "originalPosition": 11}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjc5NDI4NTIwOnYy", "diffSide": "RIGHT", "path": "presto-hive-hadoop2/bin/run_hive_tests.sh", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wMVQxMjowNzoyNlrOGrjIpQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wMVQxMjowNzoyNlrOGrjIpQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0ODMxNzYwNQ==", "bodyText": "debug?", "url": "https://github.com/trinodb/trino/pull/4295#discussion_r448317605", "createdAt": "2020-07-01T12:07:26Z", "author": {"login": "findepi"}, "path": "presto-hive-hadoop2/bin/run_hive_tests.sh", "diffHunk": "@@ -7,8 +7,12 @@ set -euo pipefail -x\n cleanup_hadoop_docker_containers\n start_hadoop_docker_containers\n \n+# obtain Hive version\n+TESTS_HIVE_VERSION_MAJOR=$(get_hive_major_version)\n+\n # generate test data\n exec_in_hadoop_master_container sudo -Eu hive beeline -u jdbc:hive2://localhost:10000/default -n hive -f /docker/sql/create-test.sql\n+exec_in_hadoop_master_container sudo -Eu hive beeline -u jdbc:hive2://localhost:10000/default -n hive -f /docker/sql/create-test.sql", "state": "SUBMITTED", "replyTo": null, "originalCommit": null, "originalPosition": 9}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjc5NDI4ODQ2OnYy", "diffSide": "LEFT", "path": "presto-product-tests/bin/product-tests-suite-8-non-generic.sh", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wMVQxMjowODoyOVrOGrjKpQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wMVQxMjowODoyOVrOGrjKpQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0ODMxODExNw==", "bodyText": "This belongs to Use product version obtained from Hive in Hive product tests commit.", "url": "https://github.com/trinodb/trino/pull/4295#discussion_r448318117", "createdAt": "2020-07-01T12:08:29Z", "author": {"login": "findepi"}, "path": "presto-product-tests/bin/product-tests-suite-8-non-generic.sh", "diffHunk": "@@ -12,7 +12,7 @@ fi\n \n suite_exit_code=0\n \n-TESTS_HIVE_VERSION_MAJOR=\"3\" TESTS_HIVE_VERSION_MINOR=\"1\" presto-product-tests-launcher/bin/run-launcher test run \\", "state": "SUBMITTED", "replyTo": null, "originalCommit": null, "originalPosition": 4}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjc5NDI5MjA2OnYy", "diffSide": "LEFT", "path": "presto-product-tests/conf/product-tests-defaults.sh", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wMVQxMjowOToyN1rOGrjMwQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wMVQxMjowOToyN1rOGrjMwQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0ODMxODY1Nw==", "bodyText": "This belongs to Use product version obtained from Hive in Hive integration tests\n(the file is used in Hive integration tests only)", "url": "https://github.com/trinodb/trino/pull/4295#discussion_r448318657", "createdAt": "2020-07-01T12:09:27Z", "author": {"login": "findepi"}, "path": "presto-product-tests/conf/product-tests-defaults.sh", "diffHunk": "@@ -1,13 +1,5 @@\n export DOCKER_IMAGES_VERSION=${DOCKER_IMAGES_VERSION:-28}\n \n-if test -v HADOOP_BASE_IMAGE; then\n-    test -v TESTS_HIVE_VERSION_MAJOR\n-    test -v TESTS_HIVE_VERSION_MINOR\n-else\n-    test ! -v TESTS_HIVE_VERSION_MAJOR\n-    test ! -v TESTS_HIVE_VERSION_MINOR\n-\n+if test ! -v HADOOP_BASE_IMAGE; then\n     export HADOOP_BASE_IMAGE=\"prestodev/hdp2.6-hive\"\n-    export TESTS_HIVE_VERSION_MAJOR=\"1\"\n-    export TESTS_HIVE_VERSION_MINOR=\"2\"", "state": "SUBMITTED", "replyTo": null, "originalCommit": null, "originalPosition": 13}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjc5NDI5NDQ2OnYy", "diffSide": "RIGHT", "path": "presto-product-tests/conf/product-tests-defaults.sh", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wMVQxMjoxMDowN1rOGrjOJQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wMVQxMjoxMDowN1rOGrjOJQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0ODMxOTAxMw==", "bodyText": "This can be now simplified to\nexport HADOOP_BASE_IMAGE=\"${HADOOP_BASE_IMAGE:-prestodev/hdp2.6-hive}\"", "url": "https://github.com/trinodb/trino/pull/4295#discussion_r448319013", "createdAt": "2020-07-01T12:10:07Z", "author": {"login": "findepi"}, "path": "presto-product-tests/conf/product-tests-defaults.sh", "diffHunk": "@@ -1,13 +1,5 @@\n export DOCKER_IMAGES_VERSION=${DOCKER_IMAGES_VERSION:-28}\n \n-if test -v HADOOP_BASE_IMAGE; then\n-    test -v TESTS_HIVE_VERSION_MAJOR\n-    test -v TESTS_HIVE_VERSION_MINOR\n-else\n-    test ! -v TESTS_HIVE_VERSION_MAJOR\n-    test ! -v TESTS_HIVE_VERSION_MINOR\n-\n+if test ! -v HADOOP_BASE_IMAGE; then", "state": "SUBMITTED", "replyTo": null, "originalCommit": null, "originalPosition": 10}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4031, "cost": 1, "resetAt": "2021-11-12T12:57:47Z"}}}