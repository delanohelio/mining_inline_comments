{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0MzY2NzkxMTY4", "number": 2613, "title": "Convert multinode-tls-* to Launcher", "bodyText": "", "createdAt": "2020-01-24T11:22:34Z", "url": "https://github.com/trinodb/trino/pull/2613", "merged": true, "mergeCommit": {"oid": "d047f22f3801eaf60042921e089c5758898b6d9d"}, "closed": true, "closedAt": "2020-01-25T23:40:11Z", "author": {"login": "findepi"}, "timelineItems": {"totalCount": 13, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABb9eDygABqjI5NzcwNjExMzQ=", "endCursor": "Y3Vyc29yOnYyOpPPAAABb97a6LAFqTM0ODM0ODk2MA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "HeadRefForcePushedEvent", "beforeCommit": null, "afterCommit": null}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzQ4MzM5MTM0", "url": "https://github.com/trinodb/trino/pull/2613#pullrequestreview-348339134", "createdAt": "2020-01-25T18:39:56Z", "commit": null, "state": "APPROVED", "comments": {"totalCount": 6, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yNVQxODozOTo1N1rOFhw6jg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yNVQxODo0NzoyMVrOFhw8PQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MDk0ODc1MA==", "bodyText": "Not specific to this PR, but this pattern is strange. Why do we call an empty super method in the abstract parent class (which is designed for subclasses to implement)?", "url": "https://github.com/trinodb/trino/pull/2613#discussion_r370948750", "createdAt": "2020-01-25T18:39:57Z", "author": {"login": "electrum"}, "path": "presto-product-tests-launcher/src/main/java/io/prestosql/tests/product/launcher/env/environment/MultinodeTlsKerberos.java", "diffHunk": "@@ -0,0 +1,101 @@\n+/*\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+package io.prestosql.tests.product.launcher.env.environment;\n+\n+import com.google.common.collect.ImmutableList;\n+import io.prestosql.tests.product.launcher.PathResolver;\n+import io.prestosql.tests.product.launcher.docker.DockerFiles;\n+import io.prestosql.tests.product.launcher.env.DockerContainer;\n+import io.prestosql.tests.product.launcher.env.Environment;\n+import io.prestosql.tests.product.launcher.env.EnvironmentOptions;\n+import io.prestosql.tests.product.launcher.env.common.AbstractEnvironmentProvider;\n+import io.prestosql.tests.product.launcher.env.common.Hadoop;\n+import io.prestosql.tests.product.launcher.env.common.Kerberos;\n+import io.prestosql.tests.product.launcher.env.common.Standard;\n+import org.testcontainers.containers.startupcheck.IsRunningStartupCheckStrategy;\n+import org.testcontainers.containers.wait.strategy.Wait;\n+\n+import javax.inject.Inject;\n+\n+import java.io.File;\n+import java.time.Duration;\n+import java.util.Objects;\n+\n+import static com.google.common.base.Verify.verify;\n+import static io.prestosql.tests.product.launcher.env.common.Hadoop.CONTAINER_PRESTO_HIVE_PROPERTIES;\n+import static io.prestosql.tests.product.launcher.env.common.Standard.CONTAINER_PRESTO_CONFIG_PROPERTIES;\n+import static java.util.Objects.requireNonNull;\n+import static org.testcontainers.containers.BindMode.READ_ONLY;\n+\n+public class MultinodeTlsKerberos\n+        extends AbstractEnvironmentProvider\n+{\n+    private final PathResolver pathResolver;\n+    private final DockerFiles dockerFiles;\n+\n+    private final String prestoDockerImageName;\n+    private final File serverPackage;\n+\n+    @Inject\n+    public MultinodeTlsKerberos(\n+            PathResolver pathResolver,\n+            DockerFiles dockerFiles,\n+            Standard standard,\n+            Hadoop hadoop,\n+            Kerberos kerberos,\n+            EnvironmentOptions environmentOptions)\n+    {\n+        super(ImmutableList.of(standard, hadoop, kerberos));\n+        this.pathResolver = requireNonNull(pathResolver, \"pathResolver is null\");\n+        this.dockerFiles = requireNonNull(dockerFiles, \"dockerFiles is null\");\n+        String hadoopBaseImage = requireNonNull(environmentOptions.hadoopBaseImage, \"environmentOptions.hadoopBaseImage is null\");\n+        String imagesVersion = requireNonNull(environmentOptions.imagesVersion, \"environmentOptions.imagesVersion is null\");\n+        prestoDockerImageName = hadoopBaseImage + \"-kerberized:\" + imagesVersion;\n+        serverPackage = requireNonNull(environmentOptions.serverPackage, \"environmentOptions.serverPackage is null\");\n+    }\n+\n+    @Override\n+    @SuppressWarnings(\"resource\")\n+    protected void extendEnvironment(Environment.Builder builder)\n+    {\n+        super.extendEnvironment(builder);", "state": "SUBMITTED", "replyTo": null, "originalCommit": null, "originalPosition": 72}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MDk0ODgyMA==", "bodyText": "Use prestoDockerImageName.equals(...) since we know this isn't null. (otherwise the reader wonders why it is done this way)", "url": "https://github.com/trinodb/trino/pull/2613#discussion_r370948820", "createdAt": "2020-01-25T18:40:53Z", "author": {"login": "electrum"}, "path": "presto-product-tests-launcher/src/main/java/io/prestosql/tests/product/launcher/env/environment/MultinodeTlsKerberos.java", "diffHunk": "@@ -0,0 +1,101 @@\n+/*\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+package io.prestosql.tests.product.launcher.env.environment;\n+\n+import com.google.common.collect.ImmutableList;\n+import io.prestosql.tests.product.launcher.PathResolver;\n+import io.prestosql.tests.product.launcher.docker.DockerFiles;\n+import io.prestosql.tests.product.launcher.env.DockerContainer;\n+import io.prestosql.tests.product.launcher.env.Environment;\n+import io.prestosql.tests.product.launcher.env.EnvironmentOptions;\n+import io.prestosql.tests.product.launcher.env.common.AbstractEnvironmentProvider;\n+import io.prestosql.tests.product.launcher.env.common.Hadoop;\n+import io.prestosql.tests.product.launcher.env.common.Kerberos;\n+import io.prestosql.tests.product.launcher.env.common.Standard;\n+import org.testcontainers.containers.startupcheck.IsRunningStartupCheckStrategy;\n+import org.testcontainers.containers.wait.strategy.Wait;\n+\n+import javax.inject.Inject;\n+\n+import java.io.File;\n+import java.time.Duration;\n+import java.util.Objects;\n+\n+import static com.google.common.base.Verify.verify;\n+import static io.prestosql.tests.product.launcher.env.common.Hadoop.CONTAINER_PRESTO_HIVE_PROPERTIES;\n+import static io.prestosql.tests.product.launcher.env.common.Standard.CONTAINER_PRESTO_CONFIG_PROPERTIES;\n+import static java.util.Objects.requireNonNull;\n+import static org.testcontainers.containers.BindMode.READ_ONLY;\n+\n+public class MultinodeTlsKerberos\n+        extends AbstractEnvironmentProvider\n+{\n+    private final PathResolver pathResolver;\n+    private final DockerFiles dockerFiles;\n+\n+    private final String prestoDockerImageName;\n+    private final File serverPackage;\n+\n+    @Inject\n+    public MultinodeTlsKerberos(\n+            PathResolver pathResolver,\n+            DockerFiles dockerFiles,\n+            Standard standard,\n+            Hadoop hadoop,\n+            Kerberos kerberos,\n+            EnvironmentOptions environmentOptions)\n+    {\n+        super(ImmutableList.of(standard, hadoop, kerberos));\n+        this.pathResolver = requireNonNull(pathResolver, \"pathResolver is null\");\n+        this.dockerFiles = requireNonNull(dockerFiles, \"dockerFiles is null\");\n+        String hadoopBaseImage = requireNonNull(environmentOptions.hadoopBaseImage, \"environmentOptions.hadoopBaseImage is null\");\n+        String imagesVersion = requireNonNull(environmentOptions.imagesVersion, \"environmentOptions.imagesVersion is null\");\n+        prestoDockerImageName = hadoopBaseImage + \"-kerberized:\" + imagesVersion;\n+        serverPackage = requireNonNull(environmentOptions.serverPackage, \"environmentOptions.serverPackage is null\");\n+    }\n+\n+    @Override\n+    @SuppressWarnings(\"resource\")\n+    protected void extendEnvironment(Environment.Builder builder)\n+    {\n+        super.extendEnvironment(builder);\n+\n+        builder.configureContainer(\"presto-master\", container -> {\n+            verify(Objects.equals(container.getDockerImageName(), prestoDockerImageName), \"Expected image '%s', but is '%s'\", prestoDockerImageName, container.getDockerImageName());", "state": "SUBMITTED", "replyTo": null, "originalCommit": null, "originalPosition": 75}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MDk0ODkyNA==", "bodyText": "Also, why do we need this check? I don't see it in the others", "url": "https://github.com/trinodb/trino/pull/2613#discussion_r370948924", "createdAt": "2020-01-25T18:42:31Z", "author": {"login": "electrum"}, "path": "presto-product-tests-launcher/src/main/java/io/prestosql/tests/product/launcher/env/environment/MultinodeTlsKerberos.java", "diffHunk": "@@ -0,0 +1,101 @@\n+/*\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+package io.prestosql.tests.product.launcher.env.environment;\n+\n+import com.google.common.collect.ImmutableList;\n+import io.prestosql.tests.product.launcher.PathResolver;\n+import io.prestosql.tests.product.launcher.docker.DockerFiles;\n+import io.prestosql.tests.product.launcher.env.DockerContainer;\n+import io.prestosql.tests.product.launcher.env.Environment;\n+import io.prestosql.tests.product.launcher.env.EnvironmentOptions;\n+import io.prestosql.tests.product.launcher.env.common.AbstractEnvironmentProvider;\n+import io.prestosql.tests.product.launcher.env.common.Hadoop;\n+import io.prestosql.tests.product.launcher.env.common.Kerberos;\n+import io.prestosql.tests.product.launcher.env.common.Standard;\n+import org.testcontainers.containers.startupcheck.IsRunningStartupCheckStrategy;\n+import org.testcontainers.containers.wait.strategy.Wait;\n+\n+import javax.inject.Inject;\n+\n+import java.io.File;\n+import java.time.Duration;\n+import java.util.Objects;\n+\n+import static com.google.common.base.Verify.verify;\n+import static io.prestosql.tests.product.launcher.env.common.Hadoop.CONTAINER_PRESTO_HIVE_PROPERTIES;\n+import static io.prestosql.tests.product.launcher.env.common.Standard.CONTAINER_PRESTO_CONFIG_PROPERTIES;\n+import static java.util.Objects.requireNonNull;\n+import static org.testcontainers.containers.BindMode.READ_ONLY;\n+\n+public class MultinodeTlsKerberos\n+        extends AbstractEnvironmentProvider\n+{\n+    private final PathResolver pathResolver;\n+    private final DockerFiles dockerFiles;\n+\n+    private final String prestoDockerImageName;\n+    private final File serverPackage;\n+\n+    @Inject\n+    public MultinodeTlsKerberos(\n+            PathResolver pathResolver,\n+            DockerFiles dockerFiles,\n+            Standard standard,\n+            Hadoop hadoop,\n+            Kerberos kerberos,\n+            EnvironmentOptions environmentOptions)\n+    {\n+        super(ImmutableList.of(standard, hadoop, kerberos));\n+        this.pathResolver = requireNonNull(pathResolver, \"pathResolver is null\");\n+        this.dockerFiles = requireNonNull(dockerFiles, \"dockerFiles is null\");\n+        String hadoopBaseImage = requireNonNull(environmentOptions.hadoopBaseImage, \"environmentOptions.hadoopBaseImage is null\");\n+        String imagesVersion = requireNonNull(environmentOptions.imagesVersion, \"environmentOptions.imagesVersion is null\");\n+        prestoDockerImageName = hadoopBaseImage + \"-kerberized:\" + imagesVersion;\n+        serverPackage = requireNonNull(environmentOptions.serverPackage, \"environmentOptions.serverPackage is null\");\n+    }\n+\n+    @Override\n+    @SuppressWarnings(\"resource\")\n+    protected void extendEnvironment(Environment.Builder builder)\n+    {\n+        super.extendEnvironment(builder);\n+\n+        builder.configureContainer(\"presto-master\", container -> {\n+            verify(Objects.equals(container.getDockerImageName(), prestoDockerImageName), \"Expected image '%s', but is '%s'\", prestoDockerImageName, container.getDockerImageName());", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MDk0ODgyMA=="}, "originalCommit": null, "originalPosition": 75}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MDk0ODk5Ng==", "bodyText": "Should this be final? Most implementations are", "url": "https://github.com/trinodb/trino/pull/2613#discussion_r370948996", "createdAt": "2020-01-25T18:43:40Z", "author": {"login": "electrum"}, "path": "presto-product-tests-launcher/src/main/java/io/prestosql/tests/product/launcher/env/environment/MultinodeTlsKerberos.java", "diffHunk": "@@ -0,0 +1,101 @@\n+/*\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+package io.prestosql.tests.product.launcher.env.environment;\n+\n+import com.google.common.collect.ImmutableList;\n+import io.prestosql.tests.product.launcher.PathResolver;\n+import io.prestosql.tests.product.launcher.docker.DockerFiles;\n+import io.prestosql.tests.product.launcher.env.DockerContainer;\n+import io.prestosql.tests.product.launcher.env.Environment;\n+import io.prestosql.tests.product.launcher.env.EnvironmentOptions;\n+import io.prestosql.tests.product.launcher.env.common.AbstractEnvironmentProvider;\n+import io.prestosql.tests.product.launcher.env.common.Hadoop;\n+import io.prestosql.tests.product.launcher.env.common.Kerberos;\n+import io.prestosql.tests.product.launcher.env.common.Standard;\n+import org.testcontainers.containers.startupcheck.IsRunningStartupCheckStrategy;\n+import org.testcontainers.containers.wait.strategy.Wait;\n+\n+import javax.inject.Inject;\n+\n+import java.io.File;\n+import java.time.Duration;\n+import java.util.Objects;\n+\n+import static com.google.common.base.Verify.verify;\n+import static io.prestosql.tests.product.launcher.env.common.Hadoop.CONTAINER_PRESTO_HIVE_PROPERTIES;\n+import static io.prestosql.tests.product.launcher.env.common.Standard.CONTAINER_PRESTO_CONFIG_PROPERTIES;\n+import static java.util.Objects.requireNonNull;\n+import static org.testcontainers.containers.BindMode.READ_ONLY;\n+\n+public class MultinodeTlsKerberos", "state": "SUBMITTED", "replyTo": null, "originalCommit": null, "originalPosition": 41}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MDk0OTEwMw==", "bodyText": "It'd be helpful to extract a constant for the config prefix (perhaps clean this up separately in all of the launchers)", "url": "https://github.com/trinodb/trino/pull/2613#discussion_r370949103", "createdAt": "2020-01-25T18:45:50Z", "author": {"login": "electrum"}, "path": "presto-product-tests-launcher/src/main/java/io/prestosql/tests/product/launcher/env/environment/MultinodeTlsKerberos.java", "diffHunk": "@@ -0,0 +1,101 @@\n+/*\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+package io.prestosql.tests.product.launcher.env.environment;\n+\n+import com.google.common.collect.ImmutableList;\n+import io.prestosql.tests.product.launcher.PathResolver;\n+import io.prestosql.tests.product.launcher.docker.DockerFiles;\n+import io.prestosql.tests.product.launcher.env.DockerContainer;\n+import io.prestosql.tests.product.launcher.env.Environment;\n+import io.prestosql.tests.product.launcher.env.EnvironmentOptions;\n+import io.prestosql.tests.product.launcher.env.common.AbstractEnvironmentProvider;\n+import io.prestosql.tests.product.launcher.env.common.Hadoop;\n+import io.prestosql.tests.product.launcher.env.common.Kerberos;\n+import io.prestosql.tests.product.launcher.env.common.Standard;\n+import org.testcontainers.containers.startupcheck.IsRunningStartupCheckStrategy;\n+import org.testcontainers.containers.wait.strategy.Wait;\n+\n+import javax.inject.Inject;\n+\n+import java.io.File;\n+import java.time.Duration;\n+import java.util.Objects;\n+\n+import static com.google.common.base.Verify.verify;\n+import static io.prestosql.tests.product.launcher.env.common.Hadoop.CONTAINER_PRESTO_HIVE_PROPERTIES;\n+import static io.prestosql.tests.product.launcher.env.common.Standard.CONTAINER_PRESTO_CONFIG_PROPERTIES;\n+import static java.util.Objects.requireNonNull;\n+import static org.testcontainers.containers.BindMode.READ_ONLY;\n+\n+public class MultinodeTlsKerberos\n+        extends AbstractEnvironmentProvider\n+{\n+    private final PathResolver pathResolver;\n+    private final DockerFiles dockerFiles;\n+\n+    private final String prestoDockerImageName;\n+    private final File serverPackage;\n+\n+    @Inject\n+    public MultinodeTlsKerberos(\n+            PathResolver pathResolver,\n+            DockerFiles dockerFiles,\n+            Standard standard,\n+            Hadoop hadoop,\n+            Kerberos kerberos,\n+            EnvironmentOptions environmentOptions)\n+    {\n+        super(ImmutableList.of(standard, hadoop, kerberos));\n+        this.pathResolver = requireNonNull(pathResolver, \"pathResolver is null\");\n+        this.dockerFiles = requireNonNull(dockerFiles, \"dockerFiles is null\");\n+        String hadoopBaseImage = requireNonNull(environmentOptions.hadoopBaseImage, \"environmentOptions.hadoopBaseImage is null\");\n+        String imagesVersion = requireNonNull(environmentOptions.imagesVersion, \"environmentOptions.imagesVersion is null\");\n+        prestoDockerImageName = hadoopBaseImage + \"-kerberized:\" + imagesVersion;\n+        serverPackage = requireNonNull(environmentOptions.serverPackage, \"environmentOptions.serverPackage is null\");\n+    }\n+\n+    @Override\n+    @SuppressWarnings(\"resource\")\n+    protected void extendEnvironment(Environment.Builder builder)\n+    {\n+        super.extendEnvironment(builder);\n+\n+        builder.configureContainer(\"presto-master\", container -> {\n+            verify(Objects.equals(container.getDockerImageName(), prestoDockerImageName), \"Expected image '%s', but is '%s'\", prestoDockerImageName, container.getDockerImageName());\n+            container\n+                    .withFileSystemBind(dockerFiles.getDockerFilesHostPath(\"conf/environment/multinode-tls-kerberos/config-master.properties\"), CONTAINER_PRESTO_CONFIG_PROPERTIES, READ_ONLY)", "state": "SUBMITTED", "replyTo": null, "originalCommit": null, "originalPosition": 77}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MDk0OTE4MQ==", "bodyText": "Maybe add a shared helper for this", "url": "https://github.com/trinodb/trino/pull/2613#discussion_r370949181", "createdAt": "2020-01-25T18:47:21Z", "author": {"login": "electrum"}, "path": "presto-product-tests-launcher/src/main/java/io/prestosql/tests/product/launcher/env/environment/MultinodeTlsKerberos.java", "diffHunk": "@@ -0,0 +1,101 @@\n+/*\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+package io.prestosql.tests.product.launcher.env.environment;\n+\n+import com.google.common.collect.ImmutableList;\n+import io.prestosql.tests.product.launcher.PathResolver;\n+import io.prestosql.tests.product.launcher.docker.DockerFiles;\n+import io.prestosql.tests.product.launcher.env.DockerContainer;\n+import io.prestosql.tests.product.launcher.env.Environment;\n+import io.prestosql.tests.product.launcher.env.EnvironmentOptions;\n+import io.prestosql.tests.product.launcher.env.common.AbstractEnvironmentProvider;\n+import io.prestosql.tests.product.launcher.env.common.Hadoop;\n+import io.prestosql.tests.product.launcher.env.common.Kerberos;\n+import io.prestosql.tests.product.launcher.env.common.Standard;\n+import org.testcontainers.containers.startupcheck.IsRunningStartupCheckStrategy;\n+import org.testcontainers.containers.wait.strategy.Wait;\n+\n+import javax.inject.Inject;\n+\n+import java.io.File;\n+import java.time.Duration;\n+import java.util.Objects;\n+\n+import static com.google.common.base.Verify.verify;\n+import static io.prestosql.tests.product.launcher.env.common.Hadoop.CONTAINER_PRESTO_HIVE_PROPERTIES;\n+import static io.prestosql.tests.product.launcher.env.common.Standard.CONTAINER_PRESTO_CONFIG_PROPERTIES;\n+import static java.util.Objects.requireNonNull;\n+import static org.testcontainers.containers.BindMode.READ_ONLY;\n+\n+public class MultinodeTlsKerberos\n+        extends AbstractEnvironmentProvider\n+{\n+    private final PathResolver pathResolver;\n+    private final DockerFiles dockerFiles;\n+\n+    private final String prestoDockerImageName;\n+    private final File serverPackage;\n+\n+    @Inject\n+    public MultinodeTlsKerberos(\n+            PathResolver pathResolver,\n+            DockerFiles dockerFiles,\n+            Standard standard,\n+            Hadoop hadoop,\n+            Kerberos kerberos,\n+            EnvironmentOptions environmentOptions)\n+    {\n+        super(ImmutableList.of(standard, hadoop, kerberos));\n+        this.pathResolver = requireNonNull(pathResolver, \"pathResolver is null\");\n+        this.dockerFiles = requireNonNull(dockerFiles, \"dockerFiles is null\");\n+        String hadoopBaseImage = requireNonNull(environmentOptions.hadoopBaseImage, \"environmentOptions.hadoopBaseImage is null\");\n+        String imagesVersion = requireNonNull(environmentOptions.imagesVersion, \"environmentOptions.imagesVersion is null\");\n+        prestoDockerImageName = hadoopBaseImage + \"-kerberized:\" + imagesVersion;\n+        serverPackage = requireNonNull(environmentOptions.serverPackage, \"environmentOptions.serverPackage is null\");\n+    }\n+\n+    @Override\n+    @SuppressWarnings(\"resource\")\n+    protected void extendEnvironment(Environment.Builder builder)\n+    {\n+        super.extendEnvironment(builder);\n+\n+        builder.configureContainer(\"presto-master\", container -> {\n+            verify(Objects.equals(container.getDockerImageName(), prestoDockerImageName), \"Expected image '%s', but is '%s'\", prestoDockerImageName, container.getDockerImageName());\n+            container\n+                    .withFileSystemBind(dockerFiles.getDockerFilesHostPath(\"conf/environment/multinode-tls-kerberos/config-master.properties\"), CONTAINER_PRESTO_CONFIG_PROPERTIES, READ_ONLY)\n+                    .withFileSystemBind(dockerFiles.getDockerFilesHostPath(\"conf/environment/multinode-tls-kerberos/hive.properties\"), CONTAINER_PRESTO_HIVE_PROPERTIES, READ_ONLY);\n+        });\n+\n+        addPrestoWorker(builder, \"presto-worker-1\");\n+        addPrestoWorker(builder, \"presto-worker-2\");\n+    }\n+\n+    private void addPrestoWorker(Environment.Builder builder, String workerName)\n+    {\n+        DockerContainer container = new DockerContainer(prestoDockerImageName)\n+                .withCreateContainerCmdModifier(createContainerCmd -> createContainerCmd.withDomainName(\"docker.cluster\"))\n+                .withNetworkAliases(workerName + \".docker.cluster\")\n+                .withFileSystemBind(dockerFiles.getDockerFilesHostPath(), \"/docker/presto-product-tests\", READ_ONLY)\n+                .withFileSystemBind(pathResolver.resolvePlaceholders(serverPackage).toString(), \"/docker/presto-server.tar.gz\", READ_ONLY)\n+                .withFileSystemBind(dockerFiles.getDockerFilesHostPath(\"conf/environment/multinode-tls-kerberos/config-worker.properties\"), CONTAINER_PRESTO_CONFIG_PROPERTIES, READ_ONLY)\n+                .withFileSystemBind(dockerFiles.getDockerFilesHostPath(\"conf/environment/multinode-tls-kerberos/hive.properties\"), CONTAINER_PRESTO_HIVE_PROPERTIES, READ_ONLY)\n+                .withCommand(\"/docker/presto-product-tests/run-presto.sh\")\n+                .withStartupCheckStrategy(new IsRunningStartupCheckStrategy())\n+                .waitingFor(Wait.forLogMessage(\".*======== SERVER STARTED ========.*\", 1))", "state": "SUBMITTED", "replyTo": null, "originalCommit": null, "originalPosition": 96}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": null, "afterCommit": null}, {"__typename": "PullRequestCommit", "commit": {"oid": "b4a3a1e666f3999fa3f94bef6b2fef5e8015505b", "author": {"user": {"login": "findepi", "name": "Piotr Findeisen"}}, "url": "https://github.com/trinodb/trino/commit/b4a3a1e666f3999fa3f94bef6b2fef5e8015505b", "committedDate": "2020-01-25T22:09:42Z", "message": "Remove redundant call to super"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "eeda9b54e3fb6b7b23484dddc2adeb78d0f4efd5", "author": {"user": {"login": "findepi", "name": "Piotr Findeisen"}}, "url": "https://github.com/trinodb/trino/commit/eeda9b54e3fb6b7b23484dddc2adeb78d0f4efd5", "committedDate": "2020-01-25T22:10:02Z", "message": "Make extendEnvironment abstract\n\nDefault empty implementation is practically useless."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a7b01e8ef7449e8754cd947692ded0aae0f8ac54", "author": {"user": {"login": "findepi", "name": "Piotr Findeisen"}}, "url": "https://github.com/trinodb/trino/commit/a7b01e8ef7449e8754cd947692ded0aae0f8ac54", "committedDate": "2020-01-25T22:11:14Z", "message": "Add convenience Launcher's launcher script\n\nThis improves developer's experience when launcher jar has not yet been\ncreated and they attempt to execute a product tests invocation copied\nfrom a product tests suite file.\n\nThe script has been tested with Bash 4.4 and Bash 3.2.57."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "498ec6ac0e39eaa67f3875701951047091622500", "author": {"user": {"login": "findepi", "name": "Piotr Findeisen"}}, "url": "https://github.com/trinodb/trino/commit/498ec6ac0e39eaa67f3875701951047091622500", "committedDate": "2020-01-25T22:11:14Z", "message": "Mark environment implementations as final"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": null, "afterCommit": null}, {"__typename": "PullRequestCommit", "commit": {"oid": "5f727b3cf3e3edad664ee5e6455fdb2fa4c596c1", "author": {"user": {"login": "findepi", "name": "Piotr Findeisen"}}, "url": "https://github.com/trinodb/trino/commit/5f727b3cf3e3edad664ee5e6455fdb2fa4c596c1", "committedDate": "2020-01-25T22:30:11Z", "message": "Introduce helper for Presto container"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f74397bd45f7fc1d83fec44f533e0b123293dbcc", "author": {"user": {"login": "findepi", "name": "Piotr Findeisen"}}, "url": "https://github.com/trinodb/trino/commit/f74397bd45f7fc1d83fec44f533e0b123293dbcc", "committedDate": "2020-01-25T22:32:42Z", "message": "Convert multinode-tls-kerberos environment to Launcher"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "1ff30d47957ce9a721c1257c4cf98b995864162e", "author": {"user": {"login": "findepi", "name": "Piotr Findeisen"}}, "url": "https://github.com/trinodb/trino/commit/1ff30d47957ce9a721c1257c4cf98b995864162e", "committedDate": "2020-01-25T22:32:42Z", "message": "Convert multinode-tls environment to Launcher"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": null, "afterCommit": {"oid": "1ff30d47957ce9a721c1257c4cf98b995864162e", "author": {"user": {"login": "findepi", "name": "Piotr Findeisen"}}, "url": "https://github.com/trinodb/trino/commit/1ff30d47957ce9a721c1257c4cf98b995864162e", "committedDate": "2020-01-25T22:32:42Z", "message": "Convert multinode-tls environment to Launcher"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzQ4MzQ4OTYw", "url": "https://github.com/trinodb/trino/pull/2613#pullrequestreview-348348960", "createdAt": "2020-01-25T22:38:06Z", "commit": {"oid": "1ff30d47957ce9a721c1257c4cf98b995864162e"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 987, "cost": 1, "resetAt": "2021-10-28T19:08:13Z"}}}