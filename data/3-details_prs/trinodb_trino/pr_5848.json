{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTE2MzM0NjAz", "number": 5848, "title": "Update to testcontainers to fix running tests on Mac", "bodyText": "The RC2 version contains a fix for\ntestcontainers/testcontainers-java#3166.\nThe update requires changes due to testcontainers/testcontainers-java@1c97b97", "createdAt": "2020-11-05T20:58:00Z", "url": "https://github.com/trinodb/trino/pull/5848", "merged": true, "mergeCommit": {"oid": "82e1eb8932ce825ac76334e7a84a8e5aac542646"}, "closed": true, "closedAt": "2020-11-06T15:58:55Z", "author": {"login": "findepi"}, "timelineItems": {"totalCount": 25, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdZqVKOABqjM5NjQ3MDk3NDE=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdZ4xbigFqTUyNTI2MjExNA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "HeadRefForcePushedEvent", "beforeCommit": null, "afterCommit": null}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": null, "afterCommit": null}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": null, "afterCommit": null}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": null, "afterCommit": null}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": null, "afterCommit": null}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": null, "afterCommit": null}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": null, "afterCommit": null}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": null, "afterCommit": null}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": null, "afterCommit": null}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTI0ODc3MDI2", "url": "https://github.com/trinodb/trino/pull/5848#pullrequestreview-524877026", "createdAt": "2020-11-06T06:05:15Z", "commit": null, "state": "COMMENTED", "comments": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wNlQwNjowNToxNVrOHuhOkQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wNlQwNjowODoyMlrOHuhRwQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxODU0MDk0NQ==", "bodyText": "Is this a known issue for testcontainers?", "url": "https://github.com/trinodb/trino/pull/5848#discussion_r518540945", "createdAt": "2020-11-06T06:05:15Z", "author": {"login": "kokosing"}, "path": "pom.xml", "diffHunk": "@@ -1289,11 +1290,25 @@\n             <dependency>\n                 <groupId>org.testcontainers</groupId>\n                 <artifactId>testcontainers-bom</artifactId>\n-                <version>1.14.3</version>\n+                <!-- TODO update to released version. The update to RC was urgently needed due to https://github.com/testcontainers/testcontainers-java/issues/3166 -->\n+                <version>${dep.testcontainers.version}</version>\n                 <type>pom</type>\n                 <scope>import</scope>\n             </dependency>\n \n+            <dependency>\n+                <groupId>org.testcontainers</groupId>\n+                <artifactId>testcontainers</artifactId>\n+                <version>${dep.testcontainers.version}</version>\n+            </dependency>\n+\n+            <dependency>\n+                <!-- org.testcontainers:testcontainer's dependencies pull two different versions of this artifact and this is to negotiate the version -->", "state": "SUBMITTED", "replyTo": null, "originalCommit": null, "originalPosition": 26}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxODU0MTI4Mw==", "bodyText": "method reference?", "url": "https://github.com/trinodb/trino/pull/5848#discussion_r518541283", "createdAt": "2020-11-06T06:06:33Z", "author": {"login": "kokosing"}, "path": "presto-elasticsearch/src/test/java/io/prestosql/elasticsearch/TestPasswordAuthentication.java", "diffHunk": "@@ -79,9 +82,14 @@ public TestPasswordAuthentication()\n     public final void destroy()\n             throws IOException\n     {\n-        assertions.close();\n-        elasticsearch.stop();\n-        client.close();\n+        Closeables.closeAll(\n+                () -> assertions.close(),", "state": "SUBMITTED", "replyTo": null, "originalCommit": null, "originalPosition": 41}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxODU0MTMxMA==", "bodyText": "static import", "url": "https://github.com/trinodb/trino/pull/5848#discussion_r518541310", "createdAt": "2020-11-06T06:06:38Z", "author": {"login": "kokosing"}, "path": "presto-elasticsearch/src/test/java/io/prestosql/elasticsearch/TestPasswordAuthentication.java", "diffHunk": "@@ -79,9 +82,14 @@ public TestPasswordAuthentication()\n     public final void destroy()\n             throws IOException\n     {\n-        assertions.close();\n-        elasticsearch.stop();\n-        client.close();\n+        Closeables.closeAll(", "state": "SUBMITTED", "replyTo": null, "originalCommit": null, "originalPosition": 40}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxODU0MTY4OQ==", "bodyText": "shouldn't this be squashed with previous commit?", "url": "https://github.com/trinodb/trino/pull/5848#discussion_r518541689", "createdAt": "2020-11-06T06:08:07Z", "author": {"login": "kokosing"}, "path": "presto-atop/src/test/java/io/prestosql/plugin/atop/TestAtopSecurity.java", "diffHunk": "@@ -36,10 +36,10 @@\n \n     @BeforeClass\n     public void setUp()\n-            throws IOException\n+            throws Exception\n     {\n         Path atopExecutable = Files.createTempFile(null, null);\n-        String path = Resources.getResource(getClass(), \"security.json\").getPath();\n+        String path = new File(Resources.getResource(getClass(), \"security.json\").toURI()).getPath();", "state": "SUBMITTED", "replyTo": null, "originalCommit": null, "originalPosition": 18}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxODU0MTc2MQ==", "bodyText": "why it changed?", "url": "https://github.com/trinodb/trino/pull/5848#discussion_r518541761", "createdAt": "2020-11-06T06:08:22Z", "author": {"login": "kokosing"}, "path": "presto-elasticsearch/src/test/java/io/prestosql/elasticsearch/TestElasticsearch7IntegrationSmokeTest.java", "diffHunk": "@@ -20,7 +20,7 @@\n {\n     public TestElasticsearch7IntegrationSmokeTest()\n     {\n-        super(\"elasticsearch:7.0.0\");\n+        super(\"docker.elastic.co/elasticsearch/elasticsearch:7.0.0\");", "state": "SUBMITTED", "replyTo": null, "originalCommit": null, "originalPosition": 5}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTI0ODk5MjIz", "url": "https://github.com/trinodb/trino/pull/5848#pullrequestreview-524899223", "createdAt": "2020-11-06T07:06:58Z", "commit": null, "state": "COMMENTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wNlQwNzowNjo1OFrOHuiUzg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wNlQwNzoxMDoyN1rOHuiZeQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxODU1ODkyNg==", "bodyText": "\"Move resource allocation out of test constructor\"\n\nWhy?", "url": "https://github.com/trinodb/trino/pull/5848#discussion_r518558926", "createdAt": "2020-11-06T07:06:58Z", "author": {"login": "martint"}, "path": "presto-elasticsearch/src/test/java/io/prestosql/elasticsearch/TestPasswordAuthentication.java", "diffHunk": "@@ -19,6 +19,7 @@\n import com.google.common.collect.ImmutableMap;", "state": "SUBMITTED", "replyTo": null, "originalCommit": null, "originalPosition": 1}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxODU2MDEyMQ==", "bodyText": "Indeed. If I recall correctly, the images from docker.elastic.co are the commercial images, so the choice to use the official docker images from dockerhub was intentional.", "url": "https://github.com/trinodb/trino/pull/5848#discussion_r518560121", "createdAt": "2020-11-06T07:10:27Z", "author": {"login": "martint"}, "path": "presto-elasticsearch/src/test/java/io/prestosql/elasticsearch/TestElasticsearch7IntegrationSmokeTest.java", "diffHunk": "@@ -20,7 +20,7 @@\n {\n     public TestElasticsearch7IntegrationSmokeTest()\n     {\n-        super(\"elasticsearch:7.0.0\");\n+        super(\"docker.elastic.co/elasticsearch/elasticsearch:7.0.0\");", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxODU0MTc2MQ=="}, "originalCommit": null, "originalPosition": 5}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": null, "afterCommit": null}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": null, "afterCommit": null}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": null, "afterCommit": null}, {"__typename": "PullRequestCommit", "commit": {"oid": "954eedde0ad828bb5703b338b004eb147b0bc932", "author": {"user": {"login": "findepi", "name": "Piotr Findeisen"}}, "url": "https://github.com/trinodb/trino/commit/954eedde0ad828bb5703b338b004eb147b0bc932", "committedDate": "2020-11-06T15:00:49Z", "message": "Do not allocate resources within test constructor\n\nMaven surefire plugin does not report full exception when it happens\nduring test class constructor call."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "2f68e750a383ff76215aec28b70ad362aa9ae545", "author": {"user": {"login": "findepi", "name": "Piotr Findeisen"}}, "url": "https://github.com/trinodb/trino/commit/2f68e750a383ff76215aec28b70ad362aa9ae545", "committedDate": "2020-11-06T15:00:54Z", "message": "Report resource name when missing"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "9f819dacd918c523282ee31461a95a6a1e1e91b4", "author": {"user": {"login": "findepi", "name": "Piotr Findeisen"}}, "url": "https://github.com/trinodb/trino/commit/9f819dacd918c523282ee31461a95a6a1e1e91b4", "committedDate": "2020-11-06T15:00:54Z", "message": "Fix resource URI to file system path conversion"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ed4d9a2d691a992988b7d4157684e794c2c91905", "author": {"user": {"login": "findepi", "name": "Piotr Findeisen"}}, "url": "https://github.com/trinodb/trino/commit/ed4d9a2d691a992988b7d4157684e794c2c91905", "committedDate": "2020-11-06T15:00:54Z", "message": "Flatten unnecessary packages\n\n`TestDynamicTable` was in separate package for no apparent, important reason.\n`util` package did not contain e.g. `MetadataUtil` class."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "07e7ca73442f077c0d9699588d599231fe3758a1", "author": {"user": {"login": "findepi", "name": "Piotr Findeisen"}}, "url": "https://github.com/trinodb/trino/commit/07e7ca73442f077c0d9699588d599231fe3758a1", "committedDate": "2020-11-06T15:00:54Z", "message": "Adjusts CI timeouts\n\nMaven checks can legitimately take 30 minutes.\nAssumption is that same applies to Error Prone checks."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "276458bb0e303292048c068985d02c0e464ed281", "author": {"user": {"login": "findepi", "name": "Piotr Findeisen"}}, "url": "https://github.com/trinodb/trino/commit/276458bb0e303292048c068985d02c0e464ed281", "committedDate": "2020-11-06T15:00:54Z", "message": "Do not close DockerClientFactory.lazyClient()\n\n`DockerClientFactory.lazyClient` is a singleton, does not need to be\nclosed. Currently, the `close()` is delegated and eventually ignored in\n`com.github.dockerjava.okhttp.OkHttpDockerCmdExecFactory`. `close()` will be\nexplicitly rejected in future testcontainers version."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ae2be0cc5b281c11051c098c513f5c01b86a40bd", "author": {"user": {"login": "findepi", "name": "Piotr Findeisen"}}, "url": "https://github.com/trinodb/trino/commit/ae2be0cc5b281c11051c098c513f5c01b86a40bd", "committedDate": "2020-11-06T15:00:54Z", "message": "Declare shared network explicitly\n\nPinot tests (`TestMinimalFunctionality`) depend on the fact that Kafka\ncontainer created by `TestingKafka` and Pinot container created by\n`TestingPinotCluster` are on the same network. This is currently\nimplicitly the case, as `KafkaContainer` sets `Network.SHARED` in its\nconstructor, but it won't be so in a future version of testcontainers."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "3defb197f8a76ccd5c190b83162544d0e8dcfce2", "author": {"user": {"login": "findepi", "name": "Piotr Findeisen"}}, "url": "https://github.com/trinodb/trino/commit/3defb197f8a76ccd5c190b83162544d0e8dcfce2", "committedDate": "2020-11-06T15:00:54Z", "message": "Update to testcontainers to fix running tests on Mac\n\nThe RC2 version contains a fix for\nhttps://github.com/testcontainers/testcontainers-java/issues/3166."}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": null, "afterCommit": {"oid": "3defb197f8a76ccd5c190b83162544d0e8dcfce2", "author": {"user": {"login": "findepi", "name": "Piotr Findeisen"}}, "url": "https://github.com/trinodb/trino/commit/3defb197f8a76ccd5c190b83162544d0e8dcfce2", "committedDate": "2020-11-06T15:00:54Z", "message": "Update to testcontainers to fix running tests on Mac\n\nThe RC2 version contains a fix for\nhttps://github.com/testcontainers/testcontainers-java/issues/3166."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTI1MjUzOTE3", "url": "https://github.com/trinodb/trino/pull/5848#pullrequestreview-525253917", "createdAt": "2020-11-06T15:24:39Z", "commit": {"oid": "3defb197f8a76ccd5c190b83162544d0e8dcfce2"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTI1MjYyMTE0", "url": "https://github.com/trinodb/trino/pull/5848#pullrequestreview-525262114", "createdAt": "2020-11-06T15:34:00Z", "commit": {"oid": "3defb197f8a76ccd5c190b83162544d0e8dcfce2"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wNlQxNTozNDowMVrOHuyz5w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wNlQxNTozNDowMVrOHuyz5w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxODgyOTAzMQ==", "bodyText": "What\u2019s this?", "url": "https://github.com/trinodb/trino/pull/5848#discussion_r518829031", "createdAt": "2020-11-06T15:34:01Z", "author": {"login": "martint"}, "path": "presto-elasticsearch/src/test/java/io/prestosql/elasticsearch/ElasticsearchServer.java", "diffHunk": "@@ -35,7 +36,8 @@\n     public ElasticsearchServer(String image, Map<String, String> configurationFiles)\n             throws IOException\n     {\n-        container = new ElasticsearchContainer(image);\n+        DockerImageName dockerImageName = DockerImageName.parse(image).asCompatibleSubstituteFor(\"docker.elastic.co/elasticsearch/elasticsearch\");", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "3defb197f8a76ccd5c190b83162544d0e8dcfce2"}, "originalPosition": 13}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2868, "cost": 1, "resetAt": "2021-10-28T20:13:43Z"}}}