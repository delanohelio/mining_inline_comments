{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDc4NzQxNDA5", "number": 5066, "title": "Adding ulimits guidance to deployment doc", "bodyText": "balanced comments regarding modern linux systems and field observations\nexplicit that the ulimit is for the user that the presto process runs as", "createdAt": "2020-09-03T16:13:01Z", "url": "https://github.com/trinodb/trino/pull/5066", "merged": true, "mergeCommit": {"oid": "c2217b7892a46120c93c273bf367354f86a4f640"}, "closed": true, "closedAt": "2020-09-24T19:38:41Z", "author": {"login": "m57lyra"}, "timelineItems": {"totalCount": 11, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdFUlk0AFqTQ4MjA3OTc4NA==", "endCursor": "Y3Vyc29yOnYyOpPPAAABdMGfXagFqTQ5NTg5Mzk3NQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDgyMDc5Nzg0", "url": "https://github.com/trinodb/trino/pull/5066#pullrequestreview-482079784", "createdAt": "2020-09-03T18:03:02Z", "commit": null, "state": "COMMENTED", "comments": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wM1QxODowMzowMlrOHMxyxg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wM1QxODowNTo1M1rOHMx4iA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MzE2MDc3NA==", "bodyText": "See if you can avoid ending the sentence in a preposition", "url": "https://github.com/trinodb/trino/pull/5066#discussion_r483160774", "createdAt": "2020-09-03T18:03:02Z", "author": {"login": "electrum"}, "path": "presto-docs/src/main/sphinx/installation/deployment.rst", "diffHunk": "@@ -10,6 +10,26 @@ Linux Operating System\n \n * 64-bit required\n * newer release preferred, especially when running on containers\n+* adequate ulimits for the user that the Presto process runs as. Currently, ", "state": "SUBMITTED", "replyTo": null, "originalCommit": null, "originalPosition": 4}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MzE2MDg4Nw==", "bodyText": "Capitalize Linux", "url": "https://github.com/trinodb/trino/pull/5066#discussion_r483160887", "createdAt": "2020-09-03T18:03:14Z", "author": {"login": "electrum"}, "path": "presto-docs/src/main/sphinx/installation/deployment.rst", "diffHunk": "@@ -10,6 +10,26 @@ Linux Operating System\n \n * 64-bit required\n * newer release preferred, especially when running on containers\n+* adequate ulimits for the user that the Presto process runs as. Currently, \n+  Presto requires a minimum of 4096 open file descriptors, and strongly \n+  recommends at least 8192 when it runs. Many modern linux systems built to ", "state": "SUBMITTED", "replyTo": null, "originalCommit": null, "originalPosition": 6}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MzE2MTI0Mg==", "bodyText": "I believe this requirement can be higher -- IIRC we've needed 100k at times. @dain do you remember?", "url": "https://github.com/trinodb/trino/pull/5066#discussion_r483161242", "createdAt": "2020-09-03T18:04:00Z", "author": {"login": "electrum"}, "path": "presto-docs/src/main/sphinx/installation/deployment.rst", "diffHunk": "@@ -10,6 +10,26 @@ Linux Operating System\n \n * 64-bit required\n * newer release preferred, especially when running on containers\n+* adequate ulimits for the user that the Presto process runs as. Currently, \n+  Presto requires a minimum of 4096 open file descriptors, and strongly \n+  recommends at least 8192 when it runs. Many modern linux systems built to \n+  host large applications such as Presto are expected to support much larger \n+  values, on the order of 32k open files descriptors and above, to ensure that", "state": "SUBMITTED", "replyTo": null, "originalCommit": null, "originalPosition": 8}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MzE2MjA0OA==", "bodyText": "It should be clear that this is an example if Presto is running as the presto user. Also, this may be Linux distribution specific and depend on how Presto is run. For example, in Kubernetes, the limits are likely set in an entirely different way.\n@jvanzyl any suggestions here?", "url": "https://github.com/trinodb/trino/pull/5066#discussion_r483162048", "createdAt": "2020-09-03T18:05:31Z", "author": {"login": "electrum"}, "path": "presto-docs/src/main/sphinx/installation/deployment.rst", "diffHunk": "@@ -10,6 +10,26 @@ Linux Operating System\n \n * 64-bit required\n * newer release preferred, especially when running on containers\n+* adequate ulimits for the user that the Presto process runs as. Currently, \n+  Presto requires a minimum of 4096 open file descriptors, and strongly \n+  recommends at least 8192 when it runs. Many modern linux systems built to \n+  host large applications such as Presto are expected to support much larger \n+  values, on the order of 32k open files descriptors and above, to ensure that\n+  these limits are never hit. These limits are set in ", "state": "SUBMITTED", "replyTo": null, "originalCommit": null, "originalPosition": 9}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MzE2MjI0OA==", "bodyText": "Capitalize Presto so it's clear we are saying \"the user Presto runs as\" and not the presto user.", "url": "https://github.com/trinodb/trino/pull/5066#discussion_r483162248", "createdAt": "2020-09-03T18:05:53Z", "author": {"login": "electrum"}, "path": "presto-docs/src/main/sphinx/installation/deployment.rst", "diffHunk": "@@ -10,6 +10,26 @@ Linux Operating System\n \n * 64-bit required\n * newer release preferred, especially when running on containers\n+* adequate ulimits for the user that the Presto process runs as. Currently, \n+  Presto requires a minimum of 4096 open file descriptors, and strongly \n+  recommends at least 8192 when it runs. Many modern linux systems built to \n+  host large applications such as Presto are expected to support much larger \n+  values, on the order of 32k open files descriptors and above, to ensure that\n+  these limits are never hit. These limits are set in \n+  ``/etc/security/limits.conf``:\n+\n+.. code-block:: none\n+\n+  presto soft nofile 32768\n+  presto hard nofile 65536\n+  presto soft nproc 32768\n+  presto hard nproc 65536\n+\n+.. note::\n+\n+  The root user will often have different ulimits set than do other users.\n+  If you see error messages regarding the number of open files, please be \n+  sure that you are changing the values for the presto user and not root.", "state": "SUBMITTED", "replyTo": null, "originalCommit": null, "originalPosition": 23}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": null, "afterCommit": null}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": null, "afterCommit": null}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDg2MjcxODMw", "url": "https://github.com/trinodb/trino/pull/5066#pullrequestreview-486271830", "createdAt": "2020-09-10T20:07:01Z", "commit": null, "state": "COMMENTED", "comments": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xMFQyMDowNzowMlrOHQD6aw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xMFQyMDoxMzozNVrOHQEGzA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NjYwMzM3MQ==", "bodyText": "We can remove the \"when it runs\". I also think it's strange to say \"Presto recommends\" since it's software. we are the ones recommending.\nDo we need to mention both 4096 and 8192? Seems better to just give a single recommended minimum to avoid confusion.", "url": "https://github.com/trinodb/trino/pull/5066#discussion_r486603371", "createdAt": "2020-09-10T20:07:02Z", "author": {"login": "electrum"}, "path": "presto-docs/src/main/sphinx/installation/deployment.rst", "diffHunk": "@@ -10,6 +10,30 @@ Linux Operating System\n \n * 64-bit required\n * newer release preferred, especially when running on containers\n+* adequate ulimits for the user that runs the Presto process. These limits \n+  may depend on the specific Linux distribution you are using. Currently,\n+  Presto requires a minimum of 4096 open file descriptors, and strongly\n+  recommends at least 8192 when it runs. However, the number of open file", "state": "SUBMITTED", "replyTo": null, "originalCommit": null, "originalPosition": 7}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NjYwNDYwNQ==", "bodyText": "number of machines^2 is hard to read (normally there would be a space between operators, or it would be a single word). Also, it's not clear what workload means. I think we could simplify this\n\nas roughly as the square of the machine count, times some factor depending on the workload", "url": "https://github.com/trinodb/trino/pull/5066#discussion_r486604605", "createdAt": "2020-09-10T20:09:37Z", "author": {"login": "electrum"}, "path": "presto-docs/src/main/sphinx/installation/deployment.rst", "diffHunk": "@@ -10,6 +10,30 @@ Linux Operating System\n \n * 64-bit required\n * newer release preferred, especially when running on containers\n+* adequate ulimits for the user that runs the Presto process. These limits \n+  may depend on the specific Linux distribution you are using. Currently,\n+  Presto requires a minimum of 4096 open file descriptors, and strongly\n+  recommends at least 8192 when it runs. However, the number of open file\n+  descriptors needed for a particular Presto instance scales with the number\n+  of machines in the cluster as roughly ``number of machines^2 * workload``.", "state": "SUBMITTED", "replyTo": null, "originalCommit": null, "originalPosition": 9}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NjYwNTc3MA==", "bodyText": "This seems needlessly verbose, and is confusing. We mention 32k here, then show completely different numbers below. Also, it's not clear why we would set a soft limit different than the hard limit. I think it's better to simply tell people exactly what to put.\n\nWe recommend using a much higher limit, which can typically be set in /etc/security/limits.conf:", "url": "https://github.com/trinodb/trino/pull/5066#discussion_r486605770", "createdAt": "2020-09-10T20:11:58Z", "author": {"login": "electrum"}, "path": "presto-docs/src/main/sphinx/installation/deployment.rst", "diffHunk": "@@ -10,6 +10,30 @@ Linux Operating System\n \n * 64-bit required\n * newer release preferred, especially when running on containers\n+* adequate ulimits for the user that runs the Presto process. These limits \n+  may depend on the specific Linux distribution you are using. Currently,\n+  Presto requires a minimum of 4096 open file descriptors, and strongly\n+  recommends at least 8192 when it runs. However, the number of open file\n+  descriptors needed for a particular Presto instance scales with the number\n+  of machines in the cluster as roughly ``number of machines^2 * workload``.\n+  Many modern Linux systems built to host large applications such as Presto", "state": "SUBMITTED", "replyTo": null, "originalCommit": null, "originalPosition": 10}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NjYwNTg5Nw==", "bodyText": "Code blocks and note content needs to be indented", "url": "https://github.com/trinodb/trino/pull/5066#discussion_r486605897", "createdAt": "2020-09-10T20:12:14Z", "author": {"login": "electrum"}, "path": "presto-docs/src/main/sphinx/installation/deployment.rst", "diffHunk": "@@ -10,6 +10,30 @@ Linux Operating System\n \n * 64-bit required\n * newer release preferred, especially when running on containers\n+* adequate ulimits for the user that runs the Presto process. These limits \n+  may depend on the specific Linux distribution you are using. Currently,\n+  Presto requires a minimum of 4096 open file descriptors, and strongly\n+  recommends at least 8192 when it runs. However, the number of open file\n+  descriptors needed for a particular Presto instance scales with the number\n+  of machines in the cluster as roughly ``number of machines^2 * workload``.\n+  Many modern Linux systems built to host large applications such as Presto\n+  are expected to support much larger values, on the order of 32k open files\n+  descriptors and above, to ensure that these limits are never hit. These \n+  limits are set in ``/etc/security/limits.conf``:\n+\n+.. code-block:: none", "state": "SUBMITTED", "replyTo": null, "originalCommit": null, "originalPosition": 15}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NjYwNjU0MA==", "bodyText": "We can simplify\n\nThe root user will often have different ulimits than other users. Please be sure you are setting the ulimits for the user the Presto process runs as.", "url": "https://github.com/trinodb/trino/pull/5066#discussion_r486606540", "createdAt": "2020-09-10T20:13:35Z", "author": {"login": "electrum"}, "path": "presto-docs/src/main/sphinx/installation/deployment.rst", "diffHunk": "@@ -10,6 +10,30 @@ Linux Operating System\n \n * 64-bit required\n * newer release preferred, especially when running on containers\n+* adequate ulimits for the user that runs the Presto process. These limits \n+  may depend on the specific Linux distribution you are using. Currently,\n+  Presto requires a minimum of 4096 open file descriptors, and strongly\n+  recommends at least 8192 when it runs. However, the number of open file\n+  descriptors needed for a particular Presto instance scales with the number\n+  of machines in the cluster as roughly ``number of machines^2 * workload``.\n+  Many modern Linux systems built to host large applications such as Presto\n+  are expected to support much larger values, on the order of 32k open files\n+  descriptors and above, to ensure that these limits are never hit. These \n+  limits are set in ``/etc/security/limits.conf``:\n+\n+.. code-block:: none\n+\n+  presto soft nofile 131072\n+  presto hard nofile 262144\n+  presto soft nproc 131072\n+  presto hard nproc 262144\n+\n+.. note::\n+\n+  The root user will often have different ulimits set than do other users.", "state": "SUBMITTED", "replyTo": null, "originalCommit": null, "originalPosition": 24}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": null, "afterCommit": null}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDg4MDc2OTY1", "url": "https://github.com/trinodb/trino/pull/5066#pullrequestreview-488076965", "createdAt": "2020-09-14T19:28:25Z", "commit": null, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xNFQxOToyODoyNVrOHRjhyQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xNFQxOToyODoyNVrOHRjhyQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4ODE2OTkyOQ==", "bodyText": "user often has different ulimits ..", "url": "https://github.com/trinodb/trino/pull/5066#discussion_r488169929", "createdAt": "2020-09-14T19:28:25Z", "author": {"login": "mosabua"}, "path": "presto-docs/src/main/sphinx/installation/deployment.rst", "diffHunk": "@@ -10,6 +10,25 @@ Linux Operating System\n \n * 64-bit required\n * newer release preferred, especially when running on containers\n+* adequate ulimits for the user that runs the Presto process. These limits\n+  may depend on the specific Linux distribution you are using. The number\n+  of open file descriptors needed for a particular Presto instance scales\n+  as roughly the number of machines in the cluster, times some factor \n+  depending on the workload. We recommend the following limits, which can \n+  typically be set in ``/etc/security/limits.conf``:\n+\n+.. code-block:: none\n+\n+    presto soft nofile 131072\n+    presto hard nofile 262144\n+    presto soft nproc 131072\n+    presto hard nproc 262144\n+\n+.. note::\n+\n+    The ``root`` user will often have different ulimits than other users. Be", "state": "SUBMITTED", "replyTo": null, "originalCommit": null, "originalPosition": 20}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDkwODQxMDY4", "url": "https://github.com/trinodb/trino/pull/5066#pullrequestreview-490841068", "createdAt": "2020-09-17T17:42:02Z", "commit": null, "state": "COMMENTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xN1QxNzo0NTozN1rOHTuZQA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xN1QxNzo0NTo1OFrOHTuaDA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MDQ0NTEyMA==", "bodyText": "Let's remove this note. The ulimit part is already long, and we don't want to further distract from the rest of the installation instructions. The above example shows the presto user, so I think it's sufficient.", "url": "https://github.com/trinodb/trino/pull/5066#discussion_r490445120", "createdAt": "2020-09-17T17:45:37Z", "author": {"login": "electrum"}, "path": "presto-docs/src/main/sphinx/installation/deployment.rst", "diffHunk": "@@ -10,6 +10,25 @@ Linux Operating System\n \n * 64-bit required\n * newer release preferred, especially when running on containers\n+* adequate ulimits for the user that runs the Presto process. These limits\n+  may depend on the specific Linux distribution you are using. The number\n+  of open file descriptors needed for a particular Presto instance scales\n+  as roughly the number of machines in the cluster, times some factor \n+  depending on the workload. We recommend the following limits, which can \n+  typically be set in ``/etc/security/limits.conf``:\n+\n+.. code-block:: none\n+\n+    presto soft nofile 131072\n+    presto hard nofile 262144\n+    presto soft nproc 131072\n+    presto hard nproc 262144\n+\n+.. note::", "state": "SUBMITTED", "replyTo": null, "originalCommit": null, "originalPosition": 18}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MDQ0NTMyNA==", "bodyText": "Make the soft and hard limits the same. I don't see a reason to make them different.", "url": "https://github.com/trinodb/trino/pull/5066#discussion_r490445324", "createdAt": "2020-09-17T17:45:58Z", "author": {"login": "electrum"}, "path": "presto-docs/src/main/sphinx/installation/deployment.rst", "diffHunk": "@@ -10,6 +10,25 @@ Linux Operating System\n \n * 64-bit required\n * newer release preferred, especially when running on containers\n+* adequate ulimits for the user that runs the Presto process. These limits\n+  may depend on the specific Linux distribution you are using. The number\n+  of open file descriptors needed for a particular Presto instance scales\n+  as roughly the number of machines in the cluster, times some factor \n+  depending on the workload. We recommend the following limits, which can \n+  typically be set in ``/etc/security/limits.conf``:\n+\n+.. code-block:: none\n+\n+    presto soft nofile 131072", "state": "SUBMITTED", "replyTo": null, "originalCommit": null, "originalPosition": 13}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c94663ed94421cb4c6b7199204035418c873a255", "author": {"user": {"login": "m57lyra", "name": "Annie Elliott"}}, "url": "https://github.com/trinodb/trino/commit/c94663ed94421cb4c6b7199204035418c873a255", "committedDate": "2020-09-18T04:45:38Z", "message": "Adding ulimits guidance to deployment doc"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": null, "afterCommit": {"oid": "c94663ed94421cb4c6b7199204035418c873a255", "author": {"user": {"login": "m57lyra", "name": "Annie Elliott"}}, "url": "https://github.com/trinodb/trino/commit/c94663ed94421cb4c6b7199204035418c873a255", "committedDate": "2020-09-18T04:45:38Z", "message": "Adding ulimits guidance to deployment doc"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDkxNTYxOTAx", "url": "https://github.com/trinodb/trino/pull/5066#pullrequestreview-491561901", "createdAt": "2020-09-18T15:19:33Z", "commit": {"oid": "c94663ed94421cb4c6b7199204035418c873a255"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDk1ODkzOTc1", "url": "https://github.com/trinodb/trino/pull/5066#pullrequestreview-495893975", "createdAt": "2020-09-24T19:38:01Z", "commit": {"oid": "c94663ed94421cb4c6b7199204035418c873a255"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3865, "cost": 1, "resetAt": "2021-10-28T20:13:43Z"}}}