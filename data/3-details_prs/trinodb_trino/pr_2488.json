{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0MzYyMTA1ODIy", "number": 2488, "title": "Information schema fixups", "bodyText": "", "createdAt": "2020-01-13T13:03:16Z", "url": "https://github.com/trinodb/trino/pull/2488", "merged": true, "mergeCommit": {"oid": "b0db0ec31fe071f9e3e0de551d0a6a1df21f0504"}, "closed": true, "closedAt": "2020-01-14T12:14:19Z", "author": {"login": "sopel39"}, "timelineItems": {"totalCount": 8, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABb563mPAH2gAyMzYyMTA1ODIyOjMzMWUxZmVjODE3MDAyNzI4NDhiZWY0NGMxNzVjYjVmZDU3MTIxMDM=", "endCursor": "Y3Vyc29yOnYyOpPPAAABb6P4-ugBqjI5NDY4MTUzMDY=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "331e1fec81700272848bef44c175cb5fd5712103", "author": {"user": {"login": "sopel39", "name": "Karol Sobczak"}}, "url": "https://github.com/trinodb/trino/commit/331e1fec81700272848bef44c175cb5fd5712103", "committedDate": "2020-01-13T11:43:50Z", "message": "Remove unused variable"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzQxODkzODg2", "url": "https://github.com/trinodb/trino/pull/2488#pullrequestreview-341893886", "createdAt": "2020-01-13T14:45:27Z", "commit": null, "state": "APPROVED", "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0xM1QxNDo0NToyN1rOFc5NeQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0xM1QxNDo1MjoyNVrOFc5ctQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NTg0MTc4NQ==", "bodyText": "can we simply log informationSchemaTableHandle?", "url": "https://github.com/trinodb/trino/pull/2488#discussion_r365841785", "createdAt": "2020-01-13T14:45:27Z", "author": {"login": "kokosing"}, "path": "presto-main/src/main/java/io/prestosql/connector/informationschema/InformationSchemaPageSourceProvider.java", "diffHunk": "@@ -48,6 +51,15 @@ public ConnectorPageSource createPageSource(\n             ConnectorTableHandle tableHandle,\n             List<ColumnHandle> columns)\n     {\n+        InformationSchemaTableHandle informationSchemaTableHandle = (InformationSchemaTableHandle) tableHandle;\n+        log.debug(\n+                \"Building information schema table (queryId=%s; catalog=%s; table=%s; prefixes=%s, limit=%s)\",\n+                session.getQueryId(),\n+                informationSchemaTableHandle.getCatalogName(),", "state": "SUBMITTED", "replyTo": null, "originalCommit": null, "originalPosition": 25}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NTg0MjA5Mw==", "bodyText": "cmt msg:\nAdd logging...\n\n?", "url": "https://github.com/trinodb/trino/pull/2488#discussion_r365842093", "createdAt": "2020-01-13T14:46:00Z", "author": {"login": "kokosing"}, "path": "presto-main/src/main/java/io/prestosql/connector/informationschema/InformationSchemaPageSourceProvider.java", "diffHunk": "@@ -13,6 +13,7 @@\n  */", "state": "SUBMITTED", "replyTo": null, "originalCommit": null, "originalPosition": 1}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NTg0NTY4NQ==", "bodyText": "undo", "url": "https://github.com/trinodb/trino/pull/2488#discussion_r365845685", "createdAt": "2020-01-13T14:52:25Z", "author": {"login": "kokosing"}, "path": "presto-main/src/main/java/io/prestosql/connector/informationschema/InformationSchemaPageSource.java", "diffHunk": "@@ -111,6 +116,7 @@ public InformationSchemaPageSource(\n             else {\n                 checkArgument(prefixes.equals(defaultPrefixes(catalogName)), \"Catalog-wise tables have prefixes other than the default one\");\n             }\n+", "state": "SUBMITTED", "replyTo": null, "originalCommit": null, "originalPosition": 16}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzQyMzAwMjkx", "url": "https://github.com/trinodb/trino/pull/2488#pullrequestreview-342300291", "createdAt": "2020-01-14T05:39:47Z", "commit": null, "state": "APPROVED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0xNFQwNTozOTo0N1rOFdMoIw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0xNFQwNTozOTo0N1rOFdMoIw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NjE1OTkwNw==", "bodyText": "Listing schemas explicitly here also helps return results to client sooner. And with respect to Hive Connector, it doesn't really increase the number of metadata calls to HMS. Having said that, I think it's fine to make the change as it may help in case of other connectors.", "url": "https://github.com/trinodb/trino/pull/2488#discussion_r366159907", "createdAt": "2020-01-14T05:39:47Z", "author": {"login": "lxynov"}, "path": "presto-main/src/main/java/io/prestosql/connector/informationschema/InformationSchemaPageSource.java", "diffHunk": "@@ -101,6 +101,11 @@ public InformationSchemaPageSource(\n         table = tableHandle.getTable();\n         prefixIterator = Suppliers.memoize(() -> {\n             Set<QualifiedTablePrefix> prefixes = tableHandle.getPrefixes();\n+            if (!tableHandle.getLimit().isPresent()) {\n+                // no limit is used, therefore it doesn't make sense to split information schema query into smaller ones", "state": "SUBMITTED", "replyTo": null, "originalCommit": null, "originalPosition": 5}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "31dd7a45f88aa0be0a05d56ebb977b1198c345ee", "author": {"user": {"login": "sopel39", "name": "Karol Sobczak"}}, "url": "https://github.com/trinodb/trino/commit/31dd7a45f88aa0be0a05d56ebb977b1198c345ee", "committedDate": "2020-01-14T12:04:51Z", "message": "Improve InformationSchemaTableHandle#toString"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "4f1d79be63737bc89ad7153c43a78f38e9b1ee64", "author": {"user": {"login": "sopel39", "name": "Karol Sobczak"}}, "url": "https://github.com/trinodb/trino/commit/4f1d79be63737bc89ad7153c43a78f38e9b1ee64", "committedDate": "2020-01-14T12:04:51Z", "message": "Mock connector should not return information schema tables"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "52c5bac4a861d497518b4c1532cbd8a0cf92c8f4", "author": {"user": {"login": "sopel39", "name": "Karol Sobczak"}}, "url": "https://github.com/trinodb/trino/commit/52c5bac4a861d497518b4c1532cbd8a0cf92c8f4", "committedDate": "2020-01-14T12:04:51Z", "message": "Restore prefix logging"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "3958333fdb318552ec0d5a19bd52569e9465043a", "author": {"user": {"login": "sopel39", "name": "Karol Sobczak"}}, "url": "https://github.com/trinodb/trino/commit/3958333fdb318552ec0d5a19bd52569e9465043a", "committedDate": "2020-01-14T12:06:09Z", "message": "Do not list schemas explicitly when limit is not set\n\nWhen limit is not used, then listing schemas explicitly\ncauses additional connector metadata queries. However,\nsince all metadata rows need to be read, it doesn't make\nsense to do so."}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": null, "afterCommit": {"oid": "3958333fdb318552ec0d5a19bd52569e9465043a", "author": {"user": {"login": "sopel39", "name": "Karol Sobczak"}}, "url": "https://github.com/trinodb/trino/commit/3958333fdb318552ec0d5a19bd52569e9465043a", "committedDate": "2020-01-14T12:06:09Z", "message": "Do not list schemas explicitly when limit is not set\n\nWhen limit is not used, then listing schemas explicitly\ncauses additional connector metadata queries. However,\nsince all metadata rows need to be read, it doesn't make\nsense to do so."}}]}}}, "rateLimit": {"limit": 5000, "remaining": 845, "cost": 1, "resetAt": "2021-10-28T19:08:13Z"}}}