{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDA0MDU2OTUx", "number": 3445, "title": "Pushdown dereferences in ORC Reader", "bodyText": "Adding projection and predicate pushdown of dereference expressions in ORC Reader.\n(1) OrcPageSource commits to providing base columns for the required projected columns, and expects HivePageSource to adapt.  But information about projected columns is propagated to the OrcReader using \"ProjectedLayout\".  StructColumnReader returns null blocks for fields that are not in the layout. The pruning works only for a series of dereferences, Map and List readers don't use this information right now.\n(2) Predicate pushdown is implemented by using domains on all projected columns instead of just the base column. No other changes are required, because stats used for predicate-based filtering are always read for all the columns anyway.\n(3) Added a test for reading dereferenced fields in case of null rows, which was missing during the first pass of #1720.", "createdAt": "2020-04-16T00:43:23Z", "url": "https://github.com/trinodb/trino/pull/3445", "merged": true, "mergeCommit": {"oid": "5069a55252dfc0958e68c140a4c49313096e9003"}, "closed": true, "closedAt": "2020-04-23T00:02:31Z", "author": {"login": "phd3"}, "timelineItems": {"totalCount": 7, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcYI3sKABqjMyMzg5MDQyMzk=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcaMmP0gBqjMyNjE4OTQxNTk=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "HeadRefForcePushedEvent", "beforeCommit": null, "afterCommit": null}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzk2NzY5Mzc0", "url": "https://github.com/trinodb/trino/pull/3445#pullrequestreview-396769374", "createdAt": "2020-04-20T20:00:20Z", "commit": null, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yMFQyMDowMDoyMFrOGIlS6A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yMFQyMDowMDoyMFrOGIlS6A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMTY1Mjg0MA==", "bodyText": "Why do we need this branch? If I'm reading things correctly, readLayout.getFieldLayout(fieldName) already does the check internally and knows to return fullyProjectedLayout().", "url": "https://github.com/trinodb/trino/pull/3445#discussion_r411652840", "createdAt": "2020-04-20T20:00:20Z", "author": {"login": "martint"}, "path": "presto-orc/src/main/java/io/prestosql/orc/reader/StructColumnReader.java", "diffHunk": "@@ -96,8 +98,17 @@\n             fieldNames.add(fieldName);\n \n             OrcColumn fieldStream = nestedColumns.get(fieldName);\n+\n             if (fieldStream != null) {\n-                structFields.put(fieldName, createColumnReader(field.getType(), fieldStream, systemMemoryContext, blockFactory));\n+                if (readLayout.isFullyProjected()) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": null, "originalPosition": 32}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": null, "afterCommit": null}, {"__typename": "PullRequestCommit", "commit": {"oid": "71306218bb55be80535d67c41ffa5672ae3d9ad5", "author": {"user": {"login": "phd3", "name": "Pratham"}}, "url": "https://github.com/trinodb/trino/commit/71306218bb55be80535d67c41ffa5672ae3d9ad5", "committedDate": "2020-04-22T18:28:32Z", "message": "Add test for dereferences on data containing null rows"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "cfc6df17179c17e1877fe886c0bee82f34a74b82", "author": {"user": {"login": "phd3", "name": "Pratham"}}, "url": "https://github.com/trinodb/trino/commit/cfc6df17179c17e1877fe886c0bee82f34a74b82", "committedDate": "2020-04-22T18:28:32Z", "message": "Pushdown dereference projections in ORC reader"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "83b3d5221f1a2f25fdb4d548affe0ad580b992d5", "author": {"user": {"login": "phd3", "name": "Pratham"}}, "url": "https://github.com/trinodb/trino/commit/83b3d5221f1a2f25fdb4d548affe0ad580b992d5", "committedDate": "2020-04-22T18:28:32Z", "message": "Implement predicate pushdown for nested columns in ORC reader"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": null, "afterCommit": {"oid": "83b3d5221f1a2f25fdb4d548affe0ad580b992d5", "author": {"user": {"login": "phd3", "name": "Pratham"}}, "url": "https://github.com/trinodb/trino/commit/83b3d5221f1a2f25fdb4d548affe0ad580b992d5", "committedDate": "2020-04-22T18:28:32Z", "message": "Implement predicate pushdown for nested columns in ORC reader"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1534, "cost": 1, "resetAt": "2021-10-28T19:08:13Z"}}}