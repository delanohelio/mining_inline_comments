{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0MzY1MDEyNTk4", "number": 2563, "title": "Add error message for MethodTooLargeException", "bodyText": "Add appropriate error message for caught MethodTooLargeException.", "createdAt": "2020-01-20T21:44:06Z", "url": "https://github.com/trinodb/trino/pull/2563", "merged": true, "mergeCommit": {"oid": "9819790310bb1d5057f6d01d4642c5f5a06a4b87"}, "closed": true, "closedAt": "2020-01-22T21:45:06Z", "author": {"login": "nccanter"}, "timelineItems": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABb8WfiwgFqTM0NTU4NzUwOA==", "endCursor": "Y3Vyc29yOnYyOpPPAAABb8pxH-gBqjI5NjgxNjY3ODE=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzQ1NTg3NTA4", "url": "https://github.com/trinodb/trino/pull/2563#pullrequestreview-345587508", "createdAt": "2020-01-21T00:59:10Z", "commit": null, "state": "COMMENTED", "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yMVQwMDo1OToxMVrOFfsARQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yMVQwMTowMTo1NlrOFfsCIA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2ODc3MTE0MQ==", "bodyText": "This can be replaced with getRootCause() from Guava's Throwables", "url": "https://github.com/trinodb/trino/pull/2563#discussion_r368771141", "createdAt": "2020-01-21T00:59:11Z", "author": {"login": "electrum"}, "path": "presto-main/src/main/java/io/prestosql/sql/planner/LocalExecutionPlanner.java", "diffHunk": "@@ -2830,6 +2839,16 @@ private OperatorFactory createHashAggregationOperatorFactory(\n         }\n     }\n \n+    private static Throwable getExceptionRootCause(Throwable throwable)", "state": "SUBMITTED", "replyTo": null, "originalCommit": null, "originalPosition": 34}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2ODc3MTQ5MA==", "bodyText": "We can shorten this a bit by only checking the start of the message. Also, we would prefer to format each of the checks on separate lines for readability\n.hasErrorCode(supplier)\n.hasMessageStartingWith(\"Query exceeded maximum columns or filters\")", "url": "https://github.com/trinodb/trino/pull/2563#discussion_r368771490", "createdAt": "2020-01-21T01:01:20Z", "author": {"login": "electrum"}, "path": "presto-main/src/test/java/io/prestosql/sql/planner/TestLocalExecutionPlanner.java", "diffHunk": "@@ -56,6 +56,7 @@ public void testCompilerFailure()\n     private void assertFails(@Language(\"SQL\") String sql, ErrorCodeSupplier supplier)\n     {\n         assertPrestoExceptionThrownBy(() -> runner.execute(sql))\n-                .hasErrorCode(supplier);\n+                .hasErrorCode(supplier).hasMessage(\"Query exceeded maximum columns or filters. \" +", "state": "SUBMITTED", "replyTo": null, "originalCommit": null, "originalPosition": 5}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2ODc3MTYxNg==", "bodyText": "Nit: the second sentence should also say \"columns or filters\" as the user might not need to reduce both", "url": "https://github.com/trinodb/trino/pull/2563#discussion_r368771616", "createdAt": "2020-01-21T01:01:56Z", "author": {"login": "electrum"}, "path": "presto-main/src/main/java/io/prestosql/sql/planner/LocalExecutionPlanner.java", "diffHunk": "@@ -1305,6 +1307,13 @@ else if (sourceNode instanceof SampleNode) {\n                     return new PhysicalOperation(operatorFactory, outputMappings, context, source);\n                 }\n             }\n+            catch (PrestoException e) {\n+                if (e.getErrorCode() == COMPILER_ERROR.toErrorCode() && getExceptionRootCause(e) instanceof MethodTooLargeException) {\n+                    throw new PrestoException(COMPILER_ERROR,\n+                        \"Query exceeded maximum columns or filters. Please reduce the number of columns and filters referenced and re-run the query.\", e);", "state": "SUBMITTED", "replyTo": null, "originalCommit": null, "originalPosition": 23}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzQ1NTg5MzAw", "url": "https://github.com/trinodb/trino/pull/2563#pullrequestreview-345589300", "createdAt": "2020-01-21T01:08:31Z", "commit": null, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yMVQwMTowODozMVrOFfsGeg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yMVQwMTowODozMVrOFfsGeg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2ODc3MjczMA==", "bodyText": "This comparison should use equals() instead of == since we don't want to rely on the identity of the ErrorCode object. (even though they are singletons today and that is likely to be true in the future, it's not enforced or specified anywhere)\nWe do have some places that use == by calling getCode() on both sides, but that's more verbose and not needed when equals works.", "url": "https://github.com/trinodb/trino/pull/2563#discussion_r368772730", "createdAt": "2020-01-21T01:08:31Z", "author": {"login": "electrum"}, "path": "presto-main/src/main/java/io/prestosql/sql/planner/LocalExecutionPlanner.java", "diffHunk": "@@ -1305,6 +1307,13 @@ else if (sourceNode instanceof SampleNode) {\n                     return new PhysicalOperation(operatorFactory, outputMappings, context, source);\n                 }\n             }\n+            catch (PrestoException e) {\n+                if (e.getErrorCode() == COMPILER_ERROR.toErrorCode() && getExceptionRootCause(e) instanceof MethodTooLargeException) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": null, "originalPosition": 21}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": null, "afterCommit": null}, {"__typename": "PullRequestCommit", "commit": {"oid": "76e484f55432a4ea44f959a4304f8e0e05855b4e", "author": {"user": {"login": "nccanter", "name": "Nathan Canterbury"}}, "url": "https://github.com/trinodb/trino/commit/76e484f55432a4ea44f959a4304f8e0e05855b4e", "committedDate": "2020-01-21T23:29:51Z", "message": "Add error message for MethodTooLargeException"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": null, "afterCommit": {"oid": "76e484f55432a4ea44f959a4304f8e0e05855b4e", "author": {"user": {"login": "nccanter", "name": "Nathan Canterbury"}}, "url": "https://github.com/trinodb/trino/commit/76e484f55432a4ea44f959a4304f8e0e05855b4e", "committedDate": "2020-01-21T23:29:51Z", "message": "Add error message for MethodTooLargeException"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 949, "cost": 1, "resetAt": "2021-10-28T19:08:13Z"}}}