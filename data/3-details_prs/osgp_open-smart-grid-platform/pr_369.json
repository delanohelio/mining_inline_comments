{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDQ2NjM2NTE0", "number": 369, "title": "Feature/oc 578 peak shaving cucumber tests mqtt device", "bodyText": "[@PeakShaving]", "createdAt": "2020-07-09T05:58:21Z", "url": "https://github.com/OSGP/open-smart-grid-platform/pull/369", "merged": true, "mergeCommit": {"oid": "81f2d5af90adf9084cd565f384e954ad77d48a23"}, "closed": true, "closedAt": "2020-07-09T16:49:46Z", "author": {"login": "robindenadel"}, "timelineItems": {"totalCount": 20, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcjyxlvgH2gAyNDQ2NjM2NTE0OjhmNDI3ODlhOTgzNThhNjQzMGViNDA5ZjllMGMzMDcxYzQ4NWM1Zjk=", "endCursor": "Y3Vyc29yOnYyOpPPAAABczR60TgFqTQ0NTc5NTU2Nw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "8f42789a98358a6430eb409f9e0c3071c485c5f9", "author": {"user": {"login": "robindenadel", "name": "Robin den Adel"}}, "url": "https://github.com/OSGP/open-smart-grid-platform/commit/8f42789a98358a6430eb409f9e0c3071c485c5f9", "committedDate": "2020-05-22T14:02:51Z", "message": "OC-578: Provides a way to call the mqtt simulator."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "fd5cbf16878b5c09127393df53e0b2c0e615af98", "author": {"user": {"login": "bvdzwet", "name": "Bart van der Zwet"}}, "url": "https://github.com/OSGP/open-smart-grid-platform/commit/fd5cbf16878b5c09127393df53e0b2c0e615af98", "committedDate": "2020-07-02T16:19:08Z", "message": "OC-578 ~ Adds MQTT to osgp_core protocol_info\n\nAdds MQTT 3.1.1 as protocol in the OSGP core database.\n\nChanges startup of the MQTT simulator application, not to start an\nembedded servlet container. There should be no need for Tomcat on 8080\nas the simulator functionality is offered through a broker on a separate\nport."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "8924e22515b0f6fa33d8a5d6b0eec28be0e28060", "author": {"user": {"login": "bvdzwet", "name": "Bart van der Zwet"}}, "url": "https://github.com/OSGP/open-smart-grid-platform/commit/8924e22515b0f6fa33d8a5d6b0eec28be0e28060", "committedDate": "2020-07-03T12:27:30Z", "message": "Merges branch 'feature/OC-578_enable_mock_server_for_MQTT_simulator' into feature/OC-578-peak-shaving-cucumber-tests-mqtt-device"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "829c42c46747452dcab32805203b62184b0201a3", "author": {"user": {"login": "bvdzwet", "name": "Bart van der Zwet"}}, "url": "https://github.com/OSGP/open-smart-grid-platform/commit/829c42c46747452dcab32805203b62184b0201a3", "committedDate": "2020-07-03T12:28:18Z", "message": "Merges branch 'development' into feature/OC-578-peak-shaving-cucumber-tests-mqtt-device"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "46737bc52088bb29bfb8f5270d00d0325ca3f6c0", "author": {"user": {"login": "bvdzwet", "name": "Bart van der Zwet"}}, "url": "https://github.com/OSGP/open-smart-grid-platform/commit/46737bc52088bb29bfb8f5270d00d0325ca3f6c0", "committedDate": "2020-07-03T15:34:45Z", "message": "OC-578 ~ Updates some code towards MQTT peak shaving Cucumber tests\n\nAdds some not yet implemented steps to the peak shaving feature\nscenario.\n\nMoves version number for Cucumber dependency to the MQTT simulator to\nthe integration tests parent POM.\n\nAdds the device identification in the step to send a measurement report\nso it can be used as part of the topic name.\n\nAdds PAYLOAD to PlatformDistributionAutomationKeys.\n\nAdds mqtt.simulator.startClient to the MQTT simulator properties.\n\nRemoves some empty lines from the simulator spec JSON file.\n\nRefactors Broker to get rid of a Sonar issue modifying the static value\nof running from an instance method.\n\nRenames LnaClient to SimulatorSpecPublishingClient."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "cdc2e3cc29e82bd021c76413c87ef4913f321311", "author": {"user": {"login": "robindenadel", "name": "Robin den Adel"}}, "url": "https://github.com/OSGP/open-smart-grid-platform/commit/cdc2e3cc29e82bd021c76413c87ef4913f321311", "committedDate": "2020-07-07T14:29:35Z", "message": "OC-578: Stores the mqtt device in the database, triggers the mqtt\nsimulator and listens to the kafka topic."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "227f7f7062bd6b1bc4137ad01d6df0e600a6edd2", "author": {"user": {"login": "robindenadel", "name": "Robin den Adel"}}, "url": "https://github.com/OSGP/open-smart-grid-platform/commit/227f7f7062bd6b1bc4137ad01d6df0e600a6edd2", "committedDate": "2020-07-07T14:30:36Z", "message": "OC-578: Changes the scenario."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "aeb1007a9fb2a10e56e892b4bf24358b4a203c83", "author": {"user": {"login": "smvdheijden", "name": "Sander van der Heijden"}}, "url": "https://github.com/OSGP/open-smart-grid-platform/commit/aeb1007a9fb2a10e56e892b4bf24358b4a203c83", "committedDate": "2020-07-08T14:43:00Z", "message": "OC-578 ~ Adds default last communication time in the past\n\nEnsures communication restore task is trying to reconnect sooner."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "3ecc8adeaa9cc91be24a897de5deeea4c9487b0c", "author": {"user": {"login": "smvdheijden", "name": "Sander van der Heijden"}}, "url": "https://github.com/OSGP/open-smart-grid-platform/commit/3ecc8adeaa9cc91be24a897de5deeea4c9487b0c", "committedDate": "2020-07-08T14:44:20Z", "message": "OC-578 ~ Updates while loop in message check\n\nEnsures while loop is left when a consumer record is set."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b397a93c3d5529015ce567df3fdff32232b44f7e", "author": {"user": {"login": "smvdheijden", "name": "Sander van der Heijden"}}, "url": "https://github.com/OSGP/open-smart-grid-platform/commit/b397a93c3d5529015ce567df3fdff32232b44f7e", "committedDate": "2020-07-08T14:46:07Z", "message": "OC-578 ~ Updates communication monitoring frequency\n\nEnsures task runs every minute."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "0a16ae4ed0c3e4d105c56e36acb0c79e00c7e17e", "author": {"user": {"login": "robindenadel", "name": "Robin den Adel"}}, "url": "https://github.com/OSGP/open-smart-grid-platform/commit/0a16ae4ed0c3e4d105c56e36acb0c79e00c7e17e", "committedDate": "2020-07-09T05:55:26Z", "message": "OC-578: Adds tags."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d2a88ba9a0e93b7f8d3e42c7237506b29e9c0aaa", "author": {"user": {"login": "smvdheijden", "name": "Sander van der Heijden"}}, "url": "https://github.com/OSGP/open-smart-grid-platform/commit/d2a88ba9a0e93b7f8d3e42c7237506b29e9c0aaa", "committedDate": "2020-07-09T07:31:02Z", "message": "OC-578 ~ Attempts to fix MQTT simulator startup"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a556b97442b314545549e6be5669269f60338809", "author": {"user": {"login": "smvdheijden", "name": "Sander van der Heijden"}}, "url": "https://github.com/OSGP/open-smart-grid-platform/commit/a556b97442b314545549e6be5669269f60338809", "committedDate": "2020-07-09T07:33:06Z", "message": "Merge branch 'feature/OC-578-peak-shaving-cucumber-tests-mqtt-device' of github.com:OSGP/open-smart-grid-platform into feature/OC-578-peak-shaving-cucumber-tests-mqtt-device"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "5d61a564ac6b24616b941bf02a642186a3455932", "author": {"user": {"login": "smvdheijden", "name": "Sander van der Heijden"}}, "url": "https://github.com/OSGP/open-smart-grid-platform/commit/5d61a564ac6b24616b941bf02a642186a3455932", "committedDate": "2020-07-09T11:04:37Z", "message": "OC-578 ~ Temporarily disables destroying AWS EC2"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a8a473afa7f6f5ff42f309f964d4f31dc4871abd", "author": {"user": {"login": "smvdheijden", "name": "Sander van der Heijden"}}, "url": "https://github.com/OSGP/open-smart-grid-platform/commit/a8a473afa7f6f5ff42f309f964d4f31dc4871abd", "committedDate": "2020-07-09T14:13:06Z", "message": "OC-578 ~ Reenables destroying AWS system at end of pipeline"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "af755fae76d70e1b79d053b2c0918f448a5d876b", "author": {"user": {"login": "smvdheijden", "name": "Sander van der Heijden"}}, "url": "https://github.com/OSGP/open-smart-grid-platform/commit/af755fae76d70e1b79d053b2c0918f448a5d876b", "committedDate": "2020-07-09T14:14:49Z", "message": "OC-578 ~ Fixes alignment in pom"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDQ1NzI2Nzc3", "url": "https://github.com/OSGP/open-smart-grid-platform/pull/369#pullrequestreview-445726777", "createdAt": "2020-07-09T15:26:04Z", "commit": {"oid": "af755fae76d70e1b79d053b2c0918f448a5d876b"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wOVQxNToyNjowNFrOGvWUPA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wOVQxNTozMDowNVrOGvWfdA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MjMwMTg4NA==", "bodyText": "2020", "url": "https://github.com/OSGP/open-smart-grid-platform/pull/369#discussion_r452301884", "createdAt": "2020-07-09T15:26:04Z", "author": {"login": "smvdheijden"}, "path": "integration-tests/cucumber-tests-platform-distributionautomation/src/test/java/org/opensmartgridplatform/cucumber/platform/distributionautomation/config/AdapterProtocolMqttPersistenceConfig.java", "diffHunk": "@@ -0,0 +1,83 @@\n+/**\n+ * Copyright 2019 Smart Society Services B.V.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "af755fae76d70e1b79d053b2c0918f448a5d876b"}, "originalPosition": 2}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MjMwNDc1Ng==", "bodyText": "received", "url": "https://github.com/OSGP/open-smart-grid-platform/pull/369#discussion_r452304756", "createdAt": "2020-07-09T15:30:05Z", "author": {"login": "smvdheijden"}, "path": "integration-tests/cucumber-tests-platform-distributionautomation/src/test/java/org/opensmartgridplatform/cucumber/platform/distributionautomation/glue/kafka/in/PeakShavingConsumer.java", "diffHunk": "@@ -0,0 +1,47 @@\n+/**\n+ * Copyright 2020 Smart Society Services B.V.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\"); you may not use this file except in compliance with the License.  You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ */\n+package org.opensmartgridplatform.cucumber.platform.distributionautomation.glue.kafka.in;\n+\n+import static org.assertj.core.api.Assertions.assertThat;\n+\n+import org.apache.kafka.clients.consumer.ConsumerRecord;\n+import org.slf4j.Logger;\n+import org.slf4j.LoggerFactory;\n+import org.springframework.beans.factory.annotation.Value;\n+import org.springframework.kafka.annotation.KafkaListener;\n+import org.springframework.stereotype.Component;\n+\n+@Component\n+public class PeakShavingConsumer {\n+\n+    private static final Logger LOGGER = LoggerFactory.getLogger(PeakShavingConsumer.class);\n+\n+    @Value(\"${peakshaving.kafka.consumer.wait.fail.duration:90000}\")\n+    private long waitFailMillis;\n+\n+    private ConsumerRecord<String, String> consumerRecord;\n+\n+    @KafkaListener(containerFactory = \"peakShavingKafkaListenerContainerFactory\", topics = \"${peakshaving.kafka.topic}\")\n+    public void listen(final ConsumerRecord<String, String> consumerRecord) {\n+        LOGGER.info(\"recevied consumerRecord\");", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "af755fae76d70e1b79d053b2c0918f448a5d876b"}, "originalPosition": 31}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "be49793508a235d8f08f04c1bcd6fbb7cc2f73a2", "author": {"user": {"login": "smvdheijden", "name": "Sander van der Heijden"}}, "url": "https://github.com/OSGP/open-smart-grid-platform/commit/be49793508a235d8f08f04c1bcd6fbb7cc2f73a2", "committedDate": "2020-07-09T16:20:37Z", "message": "OC-578 ~ Fixes year in license header"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "580882a6ca7fe8a3ab1e91fce760b1a83c631b93", "author": {"user": {"login": "smvdheijden", "name": "Sander van der Heijden"}}, "url": "https://github.com/OSGP/open-smart-grid-platform/commit/580882a6ca7fe8a3ab1e91fce760b1a83c631b93", "committedDate": "2020-07-09T16:21:03Z", "message": "OC-578 ~ Fixes typo in logging"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDQ1Nzk1NTY3", "url": "https://github.com/OSGP/open-smart-grid-platform/pull/369#pullrequestreview-445795567", "createdAt": "2020-07-09T16:48:51Z", "commit": {"oid": "580882a6ca7fe8a3ab1e91fce760b1a83c631b93"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3790, "cost": 1, "resetAt": "2021-11-01T16:19:10Z"}}}