{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTE4MzM3OTU0", "number": 497, "reviewThreads": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xMFQxMDoxMToxMlrOE3J2ag==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xMFQxNDoyMTowNFrOE3P4xQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzI2MjY4NTIyOnYy", "diffSide": "RIGHT", "path": "integration-tests/cucumber-tests-platform-publiclighting/src/test/java/org/opensmartgridplatform/cucumber/platform/publiclighting/mocks/oslpdevice/MockOslpChannelHandler.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xMFQxMDoxMToxMlrOHwVSyA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xMFQxMDoxMToxMlrOHwVSyA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMDQ0MjU2OA==", "bodyText": "Default timestamp =\"now\", but cannot be parsed by OSGP. What is the correct timestamp format? (new Date() doesn't work) The former cucumber scenario also didn't add the timestamp to the notification.", "url": "https://github.com/OSGP/open-smart-grid-platform/pull/497#discussion_r520442568", "createdAt": "2020-11-10T10:11:12Z", "author": {"login": "joostknapen"}, "path": "integration-tests/cucumber-tests-platform-publiclighting/src/test/java/org/opensmartgridplatform/cucumber/platform/publiclighting/mocks/oslpdevice/MockOslpChannelHandler.java", "diffHunk": "@@ -262,6 +220,51 @@ public void channelRead0(final ChannelHandlerContext ctx, final OslpEnvelope mes\n         }\n     }\n \n+\n+    private void sendNotifications(final InetSocketAddress inetAddress, final OslpEnvelope message,\n+            final String deviceUid, final DeviceState deviceState) throws DeviceSimulatorException, IOException {\n+\n+        final MessageType messageType = this.getMessageType(message.getPayloadMessage());\n+\n+        if (MessageType.SET_LIGHT == messageType) {\n+            final List<Oslp.LightValue> lightValueList = message.getPayloadMessage()\n+                    .getSetLightRequest()\n+                    .getValuesList();\n+            for (final Oslp.LightValue lightValue : lightValueList) {\n+                final Oslp.Event event = lightValue.getOn() ? Oslp.Event.LIGHT_EVENTS_LIGHT_ON\n+                        : Oslp.Event.LIGHT_EVENTS_LIGHT_OFF;\n+                final OslpEnvelope notification = buildNotification(message, deviceUid, deviceState, event,\n+                        lightValue.getIndex());\n+                this.send(inetAddress, notification, deviceUid);\n+            }\n+        }\n+    }\n+\n+\n+    private OslpEnvelope buildNotification(final OslpEnvelope message, final String deviceUid,\n+            final DeviceState deviceState, final Oslp.Event event, final ByteString index) {\n+        this.devicesContext.getDeviceState(deviceUid).incrementSequenceNumber();\n+\n+        final Oslp.EventNotification.Builder eventNotificationBuilder = Oslp.EventNotification.newBuilder()\n+                .setEvent(event)\n+                .setDescription(event.name())\n+                //.setTimestamp(PlatformDefaults.TIMESTAMP)", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ef5413124ed19304e4337ea78a133951409c1086"}, "originalPosition": 173}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzI2MzY3NDI5OnYy", "diffSide": "RIGHT", "path": "integration-tests/cucumber-tests-platform-publiclighting/src/test/java/org/opensmartgridplatform/cucumber/platform/publiclighting/mocks/oslpdevice/MockOslpChannelHandler.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xMFQxNDoyMTowNFrOHweyOQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xNlQwODozMzoxNFrOHzsk5A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMDU5ODA3Mw==", "bodyText": "Why not call the SequenceNumberUtils class directly here and for convertByteArrayToInteger a few lines later?", "url": "https://github.com/OSGP/open-smart-grid-platform/pull/497#discussion_r520598073", "createdAt": "2020-11-10T14:21:04Z", "author": {"login": "rlemmers"}, "path": "integration-tests/cucumber-tests-platform-publiclighting/src/test/java/org/opensmartgridplatform/cucumber/platform/publiclighting/mocks/oslpdevice/MockOslpChannelHandler.java", "diffHunk": "@@ -142,6 +78,23 @@ public MockOslpChannelHandler(final String oslpSignature, final String oslpSigna\n         this.receivedResponses = receivedResponses;\n     }\n \n+    private static byte[] convertIntegerToByteArray(final Integer value) {\n+        // See: platform.service.SequenceNumberUtils", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ef5413124ed19304e4337ea78a133951409c1086"}, "originalPosition": 110}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMzk2OTc2NA==", "bodyText": "We'll leave it in, to limit the coupling.", "url": "https://github.com/OSGP/open-smart-grid-platform/pull/497#discussion_r523969764", "createdAt": "2020-11-16T08:33:14Z", "author": {"login": "rlemmers"}, "path": "integration-tests/cucumber-tests-platform-publiclighting/src/test/java/org/opensmartgridplatform/cucumber/platform/publiclighting/mocks/oslpdevice/MockOslpChannelHandler.java", "diffHunk": "@@ -142,6 +78,23 @@ public MockOslpChannelHandler(final String oslpSignature, final String oslpSigna\n         this.receivedResponses = receivedResponses;\n     }\n \n+    private static byte[] convertIntegerToByteArray(final Integer value) {\n+        // See: platform.service.SequenceNumberUtils", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMDU5ODA3Mw=="}, "originalCommit": {"oid": "ef5413124ed19304e4337ea78a133951409c1086"}, "originalPosition": 110}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3584, "cost": 1, "resetAt": "2021-11-12T12:57:47Z"}}}