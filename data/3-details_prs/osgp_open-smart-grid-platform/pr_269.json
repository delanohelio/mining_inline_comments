{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0Mzk5NDk4NTk1", "number": 269, "title": "DevicetodeviceMapper will now check for existing Manufacturer & Model\u2026", "bodyText": "\u2026Code combination, also changed deviceinstallation.xsd to force ModelCode and delete Metered and Descirption attributes", "createdAt": "2020-04-06T09:16:51Z", "url": "https://github.com/OSGP/open-smart-grid-platform/pull/269", "merged": true, "mergeCommit": {"oid": "2886ba532a835c447fa63debd8e70492e653d078"}, "closed": true, "closedAt": "2020-04-14T11:01:52Z", "author": {"login": "vsombroek"}, "timelineItems": {"totalCount": 8, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcU6bbMgH2gAyMzk5NDk4NTk1OmJlMGNkODNmZDUxNjg0NDVhZmM2ZWZmZjQxMmZlNTk3NDIxZTgxYjI=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcXg46cAFqTM5Mjc5NzgzNw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "be0cd83fd5168445afc6efff412fe597421e81b2", "author": {"user": {"login": "vsombroek", "name": "Vincent Sombroek"}}, "url": "https://github.com/OSGP/open-smart-grid-platform/commit/be0cd83fd5168445afc6efff412fe597421e81b2", "committedDate": "2020-04-06T08:29:01Z", "message": "DevicetodeviceMapper will now check for existing Manufacturer & ModelCode combination, also changed deviceinstallation.xsd to force ModelCode and delete Metered and Descirption attributes"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "bdd468466b75bbc216409ccd19d1d0283d775581", "author": {"user": {"login": "vsombroek", "name": "Vincent Sombroek"}}, "url": "https://github.com/OSGP/open-smart-grid-platform/commit/bdd468466b75bbc216409ccd19d1d0283d775581", "committedDate": "2020-04-06T09:52:59Z", "message": "FLEX-3161: Remoded setMetered and setDescription from cucumber CreateDeviceSteps"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "0541402432f7620d06a714043cb7dfc025b71b47", "author": {"user": {"login": "vsombroek", "name": "Vincent Sombroek"}}, "url": "https://github.com/OSGP/open-smart-grid-platform/commit/0541402432f7620d06a714043cb7dfc025b71b47", "committedDate": "2020-04-06T12:06:54Z", "message": "/FLEX-3161: adapted existing AddDevice features not to use Metered and Description attributes"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "27de12a6f540fda2d37afd9bb22b00287c9dafad", "author": {"user": {"login": "vsombroek", "name": "Vincent Sombroek"}}, "url": "https://github.com/OSGP/open-smart-grid-platform/commit/27de12a6f540fda2d37afd9bb22b00287c9dafad", "committedDate": "2020-04-07T07:59:43Z", "message": "FLEX-3161: Adapted cucumber scenario in AddDevice.feature to include Manufacturer code"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a7ce3cfa557856de3a043a5d14ee844a633ea945", "author": {"user": {"login": "vsombroek", "name": "Vincent Sombroek"}}, "url": "https://github.com/OSGP/open-smart-grid-platform/commit/a7ce3cfa557856de3a043a5d14ee844a633ea945", "committedDate": "2020-04-09T11:58:18Z", "message": "FLEX-3161 Added cucumbertest to test this functionality"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzkwOTIwNzYz", "url": "https://github.com/OSGP/open-smart-grid-platform/pull/269#pullrequestreview-390920763", "createdAt": "2020-04-09T15:54:01Z", "commit": {"oid": "a7ce3cfa557856de3a043a5d14ee844a633ea945"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 6, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wOVQxNTo1NDowMlrOGDe7eg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xMFQwNzoyNjoxNVrOGDzRRg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNjMwNTY1OA==", "bodyText": "Remove this line.", "url": "https://github.com/OSGP/open-smart-grid-platform/pull/269#discussion_r406305658", "createdAt": "2020-04-09T15:54:02Z", "author": {"login": "rlemmers"}, "path": "integration-tests/cucumber-tests-platform-common/src/test/java/org/opensmartgridplatform/cucumber/platform/common/glue/steps/ws/core/deviceinstallation/CreateDeviceSteps.java", "diffHunk": "@@ -62,6 +62,28 @@ public void receivingAnAddDeviceRequestWithAnUnknownOrganization(final Map<Strin\n         this.receivingAnAddDeviceRequest(settings);\n     }\n \n+    @When(\"^receiving an add device request with an unknown manufacturer and device model combination$\")\n+    public void receivingAnAddDeviceRequestWithAnUnknownManufacturerAndDeviceModelCombination(\n+            final Map<String, String> settings) {\n+\n+        System.out.println(\"HELP\");", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a7ce3cfa557856de3a043a5d14ee844a633ea945"}, "originalPosition": 8}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNjYyOTE3MQ==", "bodyText": "To get rid of code duplication, add the device model fields (manufacturer and model code) to the map and then call the existing method receivingAnAddDeviceRequest(..).", "url": "https://github.com/OSGP/open-smart-grid-platform/pull/269#discussion_r406629171", "createdAt": "2020-04-10T06:54:23Z", "author": {"login": "rlemmers"}, "path": "integration-tests/cucumber-tests-platform-common/src/test/java/org/opensmartgridplatform/cucumber/platform/common/glue/steps/ws/core/deviceinstallation/CreateDeviceSteps.java", "diffHunk": "@@ -62,6 +62,28 @@ public void receivingAnAddDeviceRequestWithAnUnknownOrganization(final Map<Strin\n         this.receivingAnAddDeviceRequest(settings);\n     }\n \n+    @When(\"^receiving an add device request with an unknown manufacturer and device model combination$\")\n+    public void receivingAnAddDeviceRequestWithAnUnknownManufacturerAndDeviceModelCombination(\n+            final Map<String, String> settings) {\n+\n+        System.out.println(\"HELP\");\n+        final AddDeviceRequest request = new AddDeviceRequest();\n+        final Device device = this.createDevice(settings);\n+\n+        final DeviceModel deviceModel = new DeviceModel();\n+        deviceModel.setManufacturer(getString(settings, PlatformKeys.KEY_DEVICE_MODEL_MANUFACTURER,\n+                PlatformCommonDefaults.DEFAULT_DEVICE_MODEL_MANUFACTURER));\n+        deviceModel.setModelCode(getString(settings, PlatformKeys.KEY_DEVICE_MODEL_MODELCODE, \"nonexistingmodel\"));\n+        device.setDeviceModel(deviceModel);\n+        request.setDevice(device);\n+\n+        try {\n+            ScenarioContext.current().put(PlatformKeys.RESPONSE, this.client.addDevice(request));\n+        } catch (final Exception ex) {\n+            ScenarioContext.current().put(PlatformKeys.RESPONSE, ex);\n+        }\n+    }\n+", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a7ce3cfa557856de3a043a5d14ee844a633ea945"}, "originalPosition": 25}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNjYzMDI4Ng==", "bodyText": "Also specify the manufacturer code (now we've stated the manufacturer code and code define the device model). Add the manufacturer code to the device models in the other scenarios as well.", "url": "https://github.com/OSGP/open-smart-grid-platform/pull/269#discussion_r406630286", "createdAt": "2020-04-10T06:58:13Z", "author": {"login": "rlemmers"}, "path": "integration-tests/cucumber-tests-platform-common/src/test/resources/features/common/osgp-adapter-ws-core/DeviceInstallation/AddDevice.feature", "diffHunk": "@@ -7,7 +7,6 @@ Feature: CoreDeviceInstallation Device Creating\n   Scenario Outline: Add New Device\n     Given a device model\n       | ModelCode | <ModelCode> |", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a7ce3cfa557856de3a043a5d14ee844a633ea945"}, "originalPosition": 3}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNjYzNzMzOQ==", "bodyText": "Why is this needed? The default \"add device\" step should create a valid device, when specifying just a device identification (so scenarios can focus on the parts that are relevant for them).\nWhat manufacturer is used by default in \"add device\"? Perhaps we should set that one to \"Test\"?", "url": "https://github.com/OSGP/open-smart-grid-platform/pull/269#discussion_r406637339", "createdAt": "2020-04-10T07:21:30Z", "author": {"login": "rlemmers"}, "path": "integration-tests/cucumber-tests-platform-common/src/test/resources/features/common/osgp-adapter-ws-core/DeviceInstallation/AddDevice.feature", "diffHunk": "@@ -139,24 +129,23 @@ Feature: CoreDeviceInstallation Device Creating\n       | PublicKeyPresent       | <PublicKeyPresent>      |\n       | Manufacturer           | <Manufacturer>          |\n       | DeviceModelCode        | <ModelCode>             |\n-      | DeviceModelDescription | <Description>           |\n-      | Metered                | <Metered>               |\n     Then the add device response contains soap fault\n       | FaultCode        | SOAP-ENV:Client                                                                                                                                                                                                                             |\n       | FaultString      | Validation error                                                                                                                                                                                                                            |\n       | ValidationErrors | cvc-pattern-valid: Value '<DeviceIdentification>' is not facet-valid with respect to pattern '[^ ]{0,40}' for type 'Identification'.;cvc-type.3.1.3: The value '<DeviceIdentification>' of element 'ns2:DeviceIdentification' is not valid. |\n \n     Examples: \n-      | DeviceUid  | DeviceIdentification   | Alias | Owner    | ContainerPostalCode | ContainerCity | ContainerStreet | ContainerNumber | ContainerMunicipality | GpsLatitude | GpsLongitude | Activated | HasSchedule | PublicKeyPresent | Manufacturer | ModelCode  | Description | Metered |\n-      | 1234567890 | \"                    \" |       | test-org | 1234AA              | Maastricht    | Stationsstraat  |              12 |                       |           0 |            0 | false     | false       | false            | Test         | Test Model | Test        | true    |\n+      | DeviceUid  | DeviceIdentification   | Alias | Owner    | ContainerPostalCode | ContainerCity | ContainerStreet | ContainerNumber | ContainerMunicipality | GpsLatitude | GpsLongitude | Activated | HasSchedule | PublicKeyPresent | Manufacturer | ModelCode  |\n+      | 1234567890 | \"                    \" |       | test-org | 1234AA              | Maastricht    | Stationsstraat  |              12 |                       |           0 |            0 | false     | false       | false            | Test         | Test Model |\n \n   Scenario: Add New Device With Unknown Owner Organization\n     Given a device model\n       | ModelCode | Test Model |\n-      | Metered   | true       |\n+      | Manufacturer | Test |\n     When receiving an add device request with an unknown organization\n       | DeviceIdentification | TEST1024000000001 |\n       | Owner                | org-test          |\n+      | Manufacturer         | Test              |", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a7ce3cfa557856de3a043a5d14ee844a633ea945"}, "originalPosition": 110}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNjYzODMzNA==", "bodyText": "Slightly shorter:\nGiven an ssld device\n| DeviceIdentification | TEST1024000000001 |", "url": "https://github.com/OSGP/open-smart-grid-platform/pull/269#discussion_r406638334", "createdAt": "2020-04-10T07:24:27Z", "author": {"login": "rlemmers"}, "path": "integration-tests/cucumber-tests-platform-common/src/test/resources/features/common/osgp-adapter-ws-core/DeviceInstallation/AddDevice.feature", "diffHunk": "@@ -234,5 +221,21 @@ Feature: CoreDeviceInstallation Device Creating\n       | Enabled                    | false    |\n     When receiving an add device request\n       | DeviceIdentification | TEST1024000000001 |\n+      | Manufacturer         | Test              |\n     Then the add device response contains soap fault\n       | Message | DISABLED_ORGANISATION |\n+       \n+  Scenario: Add a device with incorrect Model and Manufacturer combination\n+    Given a device\n+      | DeviceIdentification | TEST1024000000001 |\n+      | DeviceType           | SSLD              |", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a7ce3cfa557856de3a043a5d14ee844a633ea945"}, "originalPosition": 150}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNjYzODkxOA==", "bodyText": "\"Kaif\" as device identification?", "url": "https://github.com/OSGP/open-smart-grid-platform/pull/269#discussion_r406638918", "createdAt": "2020-04-10T07:26:15Z", "author": {"login": "rlemmers"}, "path": "integration-tests/cucumber-tests-platform-common/src/test/resources/features/common/osgp-adapter-ws-core/DeviceInstallation/AddDevice.feature", "diffHunk": "@@ -234,5 +221,21 @@ Feature: CoreDeviceInstallation Device Creating\n       | Enabled                    | false    |\n     When receiving an add device request\n       | DeviceIdentification | TEST1024000000001 |\n+      | Manufacturer         | Test              |\n     Then the add device response contains soap fault\n       | Message | DISABLED_ORGANISATION |\n+       \n+  Scenario: Add a device with incorrect Model and Manufacturer combination\n+    Given a device\n+      | DeviceIdentification | TEST1024000000001 |\n+      | DeviceType           | SSLD              |\n+    When receiving an add device request with an unknown manufacturer and device model combination\n+      | DeviceIdentification | Kaif             |", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a7ce3cfa557856de3a043a5d14ee844a633ea945"}, "originalPosition": 152}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d26dae6f089d61876879ab42fa390b9abd33b617", "author": {"user": {"login": "vsombroek", "name": "Vincent Sombroek"}}, "url": "https://github.com/OSGP/open-smart-grid-platform/commit/d26dae6f089d61876879ab42fa390b9abd33b617", "committedDate": "2020-04-14T10:00:00Z", "message": "changes that arised from the review comments are now implemented\n\nhttps://github.com/OSGP/open-smart-grid-platform/pull/269"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzkyNzk3ODM3", "url": "https://github.com/OSGP/open-smart-grid-platform/pull/269#pullrequestreview-392797837", "createdAt": "2020-04-14T10:25:28Z", "commit": {"oid": "d26dae6f089d61876879ab42fa390b9abd33b617"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3849, "cost": 1, "resetAt": "2021-11-01T16:19:10Z"}}}