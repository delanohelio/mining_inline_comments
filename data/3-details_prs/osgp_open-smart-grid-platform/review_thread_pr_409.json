{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDc1NDY5Njk5", "number": 409, "reviewThreads": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xN1QwOTo1NjoxM1rOEkdZLQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xNVQwNzo1NDo0NVrOEt2Z_Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzA2NjY1NzczOnYy", "diffSide": "RIGHT", "path": "osgp/platform/osgp-domain-core/src/main/java/org/opensmartgridplatform/domain/core/entities/DeviceModel.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xN1QwOTo1NjoxM1rOHTajvQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xN1QwOTo1NjoxM1rOHTajvQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MDEyMDEyNQ==", "bodyText": "Wouldn't it be better when using constructor chaining, if the constructor with the least number of parameters calls a constructor with a larger number of parameters, providing sane defaults for the missing arguments?\nOr consider using a builder pattern...", "url": "https://github.com/OSGP/open-smart-grid-platform/pull/409#discussion_r490120125", "createdAt": "2020-09-17T09:56:13Z", "author": {"login": "smvdheijden"}, "path": "osgp/platform/osgp-domain-core/src/main/java/org/opensmartgridplatform/domain/core/entities/DeviceModel.java", "diffHunk": "@@ -46,19 +46,22 @@ public DeviceModel() {\n \n     public DeviceModel(final Manufacturer manufacturer, final String modelCode, final String description,\n             final boolean metered) {\n-        this.manufacturer = manufacturer;\n-        this.modelCode = modelCode;\n+        this(manufacturer, modelCode);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f130ad346140a0c09bdd8514f81edefe10afcc0b"}, "originalPosition": 6}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzA2NzE3MTkxOnYy", "diffSide": "RIGHT", "path": "osgp/platform/osgp-adapter-ws-core/src/main/java/org/opensmartgridplatform/adapter/ws/core/application/mapping/DeviceConverterHelper.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xN1QxMjoyMDowN1rOHTfWlw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xN1QxMjoyMDowN1rOHTfWlw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MDE5ODY3OQ==", "bodyText": "This seems like an improvement of the previous code, where it looks like the deviceModel is never set on the destination Device object. Could this potentially lead to unexpected side effects?", "url": "https://github.com/OSGP/open-smart-grid-platform/pull/409#discussion_r490198679", "createdAt": "2020-09-17T12:20:07Z", "author": {"login": "smvdheijden"}, "path": "osgp/platform/osgp-adapter-ws-core/src/main/java/org/opensmartgridplatform/adapter/ws/core/application/mapping/DeviceConverterHelper.java", "diffHunk": "@@ -82,9 +83,10 @@ T initEntity(final Device source) {\n                     source.getTechnicalInstallationDate().toGregorianCalendar().getTime());\n         }\n \n-        if (source.getDeviceModel() != null) {\n-            final DeviceModel deviceModel = new DeviceModel();\n-            deviceModel.setModelCode(source.getDeviceModel().getModelCode());\n+        if (source instanceof Device) {\n+            final Device sourceDevice = (Device) source;\n+            destination.setDeviceModel(this.mapper.map(sourceDevice.getDeviceModel(),", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f130ad346140a0c09bdd8514f81edefe10afcc0b"}, "originalPosition": 26}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzE1MzAyNjc0OnYy", "diffSide": "RIGHT", "path": "osgp/shared/osgp-ws-core/src/main/resources/schemas/devicemanagement-ws-core.xsd", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xMlQxNjoxNTowMFrOHgFD9g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xMlQxNjoxNTowMFrOHgFD9g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMzM5OTQxNA==", "bodyText": "I was wondering, now that some fields that are not to be updated have been removed, why the device identification is part of UpdatedDevice.\nA quick look into the code leads me to believe that this might lead to an undesirable outcome of some requests to update a device.\nIf the UpdateDeviceRequest has device identification A and the UpdatedDevice in that same request has a device identification B (not equal to A) this could lead to the DeviceManagementEndpoint logging it has received an update request for device A while it will go on to update device B instead (or not find a device B and throw an exception that the device does not exist).\nYou would expect (if one may change the identification at all) that device A would be updated to have identification B (if not used with another device already).\nPerhaps the device identification should be removed from UpdatedDevice to avoid these issues.\nPerhaps the code should be changed to do the correct update (if that should be possible).\nAn alternative could be to throw an exception if device identification A is not equal to B.", "url": "https://github.com/OSGP/open-smart-grid-platform/pull/409#discussion_r503399414", "createdAt": "2020-10-12T16:15:00Z", "author": {"login": "bvdzwet"}, "path": "osgp/shared/osgp-ws-core/src/main/resources/schemas/devicemanagement-ws-core.xsd", "diffHunk": "@@ -434,6 +434,21 @@\n       <xsd:element name=\"LastCommunicationTime\" type=\"xsd:dateTime\" minOccurs=\"0\" />\n     </xsd:sequence>\n   </xsd:complexType>\n+\n+  <xsd:complexType name=\"UpdatedDevice\">\n+    <xsd:sequence>\n+      <xsd:element name=\"DeviceIdentification\" type=\"common:Identification\" />", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "2dd16cab70e9a9e8ac059b44278ed2a2a87aaee7"}, "originalPosition": 16}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzE2NTA4MzU3OnYy", "diffSide": "RIGHT", "path": "osgp/platform/osgp-adapter-ws-core/src/main/java/org/opensmartgridplatform/adapter/ws/core/application/mapping/SsldConverter.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xNVQwNzo0ODoxMFrOHh4SOQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xNVQwNzo0ODoxMFrOHh4SOQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNTI4NzIyNQ==", "bodyText": "Is this canConvert update related to earlier changes with a BaseDevice - Device hierarchy that has been removed with the addition of UpdatedDevice (in which case it seems this would be no longer needed) or does it stand on its own?", "url": "https://github.com/OSGP/open-smart-grid-platform/pull/409#discussion_r505287225", "createdAt": "2020-10-15T07:48:10Z", "author": {"login": "bvdzwet"}, "path": "osgp/platform/osgp-adapter-ws-core/src/main/java/org/opensmartgridplatform/adapter/ws/core/application/mapping/SsldConverter.java", "diffHunk": "@@ -181,4 +182,13 @@ public boolean equals(final Object obj) {\n                 && Objects.equals(this.ssldRepository, ((SsldConverter) obj).ssldRepository);\n     }\n \n+    @Override\n+    public boolean canConvert(final Type<?> sourceType, final Type<?> destinationType) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c5f664d085bdcccd92f545d872f4badb5481718b"}, "originalPosition": 13}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzE2NTEyNzY1OnYy", "diffSide": "LEFT", "path": "osgp/shared/osgp-ws-core/src/main/resources/schemas/devicemanagement-ws-core.xsd", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xNVQwNzo1NDo0NVrOHh4wrA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xNVQwNzo1NDo0NVrOHh4wrA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNTI5NTAyMA==", "bodyText": "I am surprised to see DeviceIdentification removed at this location in the XSD, after our conversation about my earlier review comments.\nI thought things should be interpreted as follows:\nUpdateDeviceRequest  ->  the request to update a device\nDeviceIdentification  ->  the identification of the device to update\nUpdatedDevice  ->  holder containing values to set while updating the device\nSince the device identification should not be changed, I'd expect it not to be among the elements of UpdatedDevice any longer. (If it should ever need to be changed, that could only work with the new value in UpdatedDevice and the device identification for the device that needs to be changed in the UpdateDeviceRequest for lookup.)\nDidn't we understand each other in our earlier chat, or did you come to a different understanding, leading to this change instead of what I expected?", "url": "https://github.com/OSGP/open-smart-grid-platform/pull/409#discussion_r505295020", "createdAt": "2020-10-15T07:54:45Z", "author": {"login": "bvdzwet"}, "path": "osgp/shared/osgp-ws-core/src/main/resources/schemas/devicemanagement-ws-core.xsd", "diffHunk": "@@ -183,8 +183,7 @@\n   <xsd:element name=\"UpdateDeviceRequest\">\n     <xsd:complexType>\n       <xsd:sequence>\n-        <xsd:element name=\"DeviceIdentification\" type=\"common:Identification\" />", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c5f664d085bdcccd92f545d872f4badb5481718b"}, "originalPosition": 4}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3659, "cost": 1, "resetAt": "2021-11-12T12:57:47Z"}}}