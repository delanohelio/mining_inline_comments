{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTEwMzA4OTcx", "number": 475, "reviewThreads": {"totalCount": 12, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0zMFQxMToxNDozMlrOEzvwPQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0zMFQxMzoyMjozOFrOEzykOw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzIyNjk1MjI5OnYy", "diffSide": "RIGHT", "path": "integration-tests/cucumber-tests-platform/src/test/java/org/opensmartgridplatform/cucumber/platform/glue/steps/database/core/EventSteps.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0zMFQxMToxNDozMlrOHrKkeA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0zMFQxNjozNTowN1rOHrW9KQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNTAyMzk5Mg==", "bodyText": "Also remove the Autowired DeviceRepository field, as it seems it is no longer used...", "url": "https://github.com/OSGP/open-smart-grid-platform/pull/475#discussion_r515023992", "createdAt": "2020-10-30T11:14:32Z", "author": {"login": "smvdheijden"}, "path": "integration-tests/cucumber-tests-platform/src/test/java/org/opensmartgridplatform/cucumber/platform/glue/steps/database/core/EventSteps.java", "diffHunk": "@@ -48,10 +47,10 @@\n \n     @Given(\"^an event$\")\n     public void anEvent(final Map<String, String> data) {\n-        final Device device = this.deviceRepository\n-                .findByDeviceIdentification(getString(data, PlatformKeys.KEY_DEVICE_IDENTIFICATION));\n+        final String deviceIdentification = getString(data, PlatformKeys.KEY_DEVICE_IDENTIFICATION);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "cd31855dc7663caedbaf173994f01d30814be80e"}, "originalPosition": 14}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNTIyNjkyMQ==", "bodyText": "Done.", "url": "https://github.com/OSGP/open-smart-grid-platform/pull/475#discussion_r515226921", "createdAt": "2020-10-30T16:35:07Z", "author": {"login": "rlemmers"}, "path": "integration-tests/cucumber-tests-platform/src/test/java/org/opensmartgridplatform/cucumber/platform/glue/steps/database/core/EventSteps.java", "diffHunk": "@@ -48,10 +47,10 @@\n \n     @Given(\"^an event$\")\n     public void anEvent(final Map<String, String> data) {\n-        final Device device = this.deviceRepository\n-                .findByDeviceIdentification(getString(data, PlatformKeys.KEY_DEVICE_IDENTIFICATION));\n+        final String deviceIdentification = getString(data, PlatformKeys.KEY_DEVICE_IDENTIFICATION);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNTAyMzk5Mg=="}, "originalCommit": {"oid": "cd31855dc7663caedbaf173994f01d30814be80e"}, "originalPosition": 14}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzIyNzI0Njc1OnYy", "diffSide": "RIGHT", "path": "osgp/platform/osgp-adapter-domain-core/src/main/java/org/opensmartgridplatform/adapter/domain/core/application/services/TransactionalDeviceLogItemService.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0zMFQxMjozNDo1OFrOHrNJ2A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0zMFQxNjozNDo1OVrOHrW83w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNTA2NjMyOA==", "bodyText": "Consider making this an autowired configurable property.", "url": "https://github.com/OSGP/open-smart-grid-platform/pull/475#discussion_r515066328", "createdAt": "2020-10-30T12:34:58Z", "author": {"login": "smvdheijden"}, "path": "osgp/platform/osgp-adapter-domain-core/src/main/java/org/opensmartgridplatform/adapter/domain/core/application/services/TransactionalDeviceLogItemService.java", "diffHunk": "@@ -30,14 +31,16 @@\n @Transactional(transactionManager = \"domainLoggingTransactionManager\")\n public class TransactionalDeviceLogItemService {\n \n+    private static final int PAGE_SIZE = 500;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "cd31855dc7663caedbaf173994f01d30814be80e"}, "originalPosition": 12}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNTIyNjg0Nw==", "bodyText": "Discussed this and decided not to implement this, because it's very unlikely we will use this page size for tweaking.", "url": "https://github.com/OSGP/open-smart-grid-platform/pull/475#discussion_r515226847", "createdAt": "2020-10-30T16:34:59Z", "author": {"login": "rlemmers"}, "path": "osgp/platform/osgp-adapter-domain-core/src/main/java/org/opensmartgridplatform/adapter/domain/core/application/services/TransactionalDeviceLogItemService.java", "diffHunk": "@@ -30,14 +31,16 @@\n @Transactional(transactionManager = \"domainLoggingTransactionManager\")\n public class TransactionalDeviceLogItemService {\n \n+    private static final int PAGE_SIZE = 500;", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNTA2NjMyOA=="}, "originalCommit": {"oid": "cd31855dc7663caedbaf173994f01d30814be80e"}, "originalPosition": 12}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzIyNzI0NzEzOnYy", "diffSide": "RIGHT", "path": "osgp/platform/osgp-adapter-domain-core/src/main/java/org/opensmartgridplatform/adapter/domain/core/application/services/TransactionalEventService.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0zMFQxMjozNTowNFrOHrNKFQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0zMFQxNjozNDo1NFrOHrW8sw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNTA2NjM4OQ==", "bodyText": "Consider making this an autowired configurable property.", "url": "https://github.com/OSGP/open-smart-grid-platform/pull/475#discussion_r515066389", "createdAt": "2020-10-30T12:35:04Z", "author": {"login": "smvdheijden"}, "path": "osgp/platform/osgp-adapter-domain-core/src/main/java/org/opensmartgridplatform/adapter/domain/core/application/services/TransactionalEventService.java", "diffHunk": "@@ -30,13 +31,15 @@\n @Transactional(transactionManager = \"transactionManager\")\n public class TransactionalEventService {\n \n+    private static final int PAGE_SIZE = 500;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "cd31855dc7663caedbaf173994f01d30814be80e"}, "originalPosition": 12}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNTIyNjgwMw==", "bodyText": "Discussed this and decided not to implement this, because it's very unlikely we will use this page size for tweaking.", "url": "https://github.com/OSGP/open-smart-grid-platform/pull/475#discussion_r515226803", "createdAt": "2020-10-30T16:34:54Z", "author": {"login": "rlemmers"}, "path": "osgp/platform/osgp-adapter-domain-core/src/main/java/org/opensmartgridplatform/adapter/domain/core/application/services/TransactionalEventService.java", "diffHunk": "@@ -30,13 +31,15 @@\n @Transactional(transactionManager = \"transactionManager\")\n public class TransactionalEventService {\n \n+    private static final int PAGE_SIZE = 500;", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNTA2NjM4OQ=="}, "originalCommit": {"oid": "cd31855dc7663caedbaf173994f01d30814be80e"}, "originalPosition": 12}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzIyNzMwOTgwOnYy", "diffSide": "RIGHT", "path": "osgp/platform/osgp-core/src/main/java/org/opensmartgridplatform/core/application/services/EventNotificationMessageService.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0zMFQxMjo1NDozM1rOHrNv0w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0zMFQxNjozMjozOFrOHrW3eg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNTA3NjA1MQ==", "bodyText": "Move the line above the comment, to keep the comment closer to the if statement.", "url": "https://github.com/OSGP/open-smart-grid-platform/pull/475#discussion_r515076051", "createdAt": "2020-10-30T12:54:33Z", "author": {"login": "smvdheijden"}, "path": "osgp/platform/osgp-core/src/main/java/org/opensmartgridplatform/core/application/services/EventNotificationMessageService.java", "diffHunk": "@@ -218,47 +219,45 @@ private void createRelayStatus(final Device device, final Event switchingEvent,\n         }\n     }\n \n-    private void handleSwitchingEvent(final Device device, final Date dateTime, final EventType eventType,\n+    private void handleSwitchingEvent(final String deviceIdentification, final Date dateTime, final EventType eventType,\n             final int index) throws UnknownEntityException {\n \n         // If the index == 0 handle all LIGHT relays, otherwise just handle the\n         // index.\n+        final Ssld ssld = this.eventNotificationHelperService.findSsld(deviceIdentification);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "cd31855dc7663caedbaf173994f01d30814be80e"}, "originalPosition": 54}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNTIyNTQ2Ng==", "bodyText": "Done.", "url": "https://github.com/OSGP/open-smart-grid-platform/pull/475#discussion_r515225466", "createdAt": "2020-10-30T16:32:38Z", "author": {"login": "rlemmers"}, "path": "osgp/platform/osgp-core/src/main/java/org/opensmartgridplatform/core/application/services/EventNotificationMessageService.java", "diffHunk": "@@ -218,47 +219,45 @@ private void createRelayStatus(final Device device, final Event switchingEvent,\n         }\n     }\n \n-    private void handleSwitchingEvent(final Device device, final Date dateTime, final EventType eventType,\n+    private void handleSwitchingEvent(final String deviceIdentification, final Date dateTime, final EventType eventType,\n             final int index) throws UnknownEntityException {\n \n         // If the index == 0 handle all LIGHT relays, otherwise just handle the\n         // index.\n+        final Ssld ssld = this.eventNotificationHelperService.findSsld(deviceIdentification);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNTA3NjA1MQ=="}, "originalCommit": {"oid": "cd31855dc7663caedbaf173994f01d30814be80e"}, "originalPosition": 54}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzIyNzMxNDc3OnYy", "diffSide": "RIGHT", "path": "osgp/platform/osgp-core/src/main/java/org/opensmartgridplatform/core/application/services/EventNotificationMessageService.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0zMFQxMjo1NTo1OFrOHrNy7g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0zMFQxMjo1NTo1OFrOHrNy7g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNTA3Njg0Ng==", "bodyText": "\ud83d\udc4d", "url": "https://github.com/OSGP/open-smart-grid-platform/pull/475#discussion_r515076846", "createdAt": "2020-10-30T12:55:58Z", "author": {"login": "smvdheijden"}, "path": "osgp/platform/osgp-core/src/main/java/org/opensmartgridplatform/core/application/services/EventNotificationMessageService.java", "diffHunk": "@@ -329,8 +328,8 @@ private void printRelayIndexes(final Set<Integer> indexesLightRelays, final Set<\n     private void printRelayStatuses(final Map<Integer, RelayStatus> lastRelayStatusPerIndex,\n             final String deviceIdentification) {\n         LOGGER.info(\"print relay statuses for device: {}\", deviceIdentification);\n-        for (final Integer key : lastRelayStatusPerIndex.keySet()) {\n-            LOGGER.info(\"key: {}, value: {}\", key, lastRelayStatusPerIndex.get(key));\n+        for (final Entry<Integer, RelayStatus> entry : lastRelayStatusPerIndex.entrySet()) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "cd31855dc7663caedbaf173994f01d30814be80e"}, "originalPosition": 108}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzIyNzMzNDQxOnYy", "diffSide": "RIGHT", "path": "osgp/platform/osgp-core/src/main/resources/db/migration/V20201027172100000__Replaces_Event_deviceId_by_deviceIdentification.sql", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0zMFQxMzowMTo0NVrOHrN_Iw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0zMFQxNjozMjowNVrOHrW2Gw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNTA3OTk3MQ==", "bodyText": "Shouldn't a NOT NULL constraint be added once the column is filled with data?", "url": "https://github.com/OSGP/open-smart-grid-platform/pull/475#discussion_r515079971", "createdAt": "2020-10-30T13:01:45Z", "author": {"login": "smvdheijden"}, "path": "osgp/platform/osgp-core/src/main/resources/db/migration/V20201027172100000__Replaces_Event_deviceId_by_deviceIdentification.sql", "diffHunk": "@@ -0,0 +1,21 @@\n+DO\n+$$\n+BEGIN\n+\n+  IF NOT EXISTS(SELECT 1 FROM information_schema.columns\n+                WHERE table_schema = current_schema AND table_name = 'event' AND column_name = 'device_identification')\n+  THEN\n+    ALTER TABLE event ADD COLUMN device_identification CHARACTER VARYING(40),", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "cd31855dc7663caedbaf173994f01d30814be80e"}, "originalPosition": 8}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNTIyNTExNQ==", "bodyText": "The original \"device\" did not have one, therefore not added here, to be on the safe side.", "url": "https://github.com/OSGP/open-smart-grid-platform/pull/475#discussion_r515225115", "createdAt": "2020-10-30T16:32:05Z", "author": {"login": "rlemmers"}, "path": "osgp/platform/osgp-core/src/main/resources/db/migration/V20201027172100000__Replaces_Event_deviceId_by_deviceIdentification.sql", "diffHunk": "@@ -0,0 +1,21 @@\n+DO\n+$$\n+BEGIN\n+\n+  IF NOT EXISTS(SELECT 1 FROM information_schema.columns\n+                WHERE table_schema = current_schema AND table_name = 'event' AND column_name = 'device_identification')\n+  THEN\n+    ALTER TABLE event ADD COLUMN device_identification CHARACTER VARYING(40),", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNTA3OTk3MQ=="}, "originalCommit": {"oid": "cd31855dc7663caedbaf173994f01d30814be80e"}, "originalPosition": 8}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzIyNzMzNjI0OnYy", "diffSide": "RIGHT", "path": "osgp/platform/osgp-domain-core/src/main/java/org/opensmartgridplatform/domain/core/entities/Event.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0zMFQxMzowMjoyMVrOHrOAYQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0zMFQxNjozMjoyOVrOHrW3Cw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNTA4MDI4OQ==", "bodyText": "Isn't @Column(nullable = false) needed here?", "url": "https://github.com/OSGP/open-smart-grid-platform/pull/475#discussion_r515080289", "createdAt": "2020-10-30T13:02:21Z", "author": {"login": "smvdheijden"}, "path": "osgp/platform/osgp-domain-core/src/main/java/org/opensmartgridplatform/domain/core/entities/Event.java", "diffHunk": "@@ -27,9 +25,7 @@\n      */\n     private static final long serialVersionUID = 5987663923796632312L;\n \n-    @ManyToOne()\n-    @JoinColumn(name = \"device\")\n-    private Device device;\n+    private String deviceIdentification;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "cd31855dc7663caedbaf173994f01d30814be80e"}, "originalPosition": 16}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNTIyNTM1NQ==", "bodyText": "Not added to stay in line with the old code, to be on the safe side.", "url": "https://github.com/OSGP/open-smart-grid-platform/pull/475#discussion_r515225355", "createdAt": "2020-10-30T16:32:29Z", "author": {"login": "rlemmers"}, "path": "osgp/platform/osgp-domain-core/src/main/java/org/opensmartgridplatform/domain/core/entities/Event.java", "diffHunk": "@@ -27,9 +25,7 @@\n      */\n     private static final long serialVersionUID = 5987663923796632312L;\n \n-    @ManyToOne()\n-    @JoinColumn(name = \"device\")\n-    private Device device;\n+    private String deviceIdentification;", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNTA4MDI4OQ=="}, "originalCommit": {"oid": "cd31855dc7663caedbaf173994f01d30814be80e"}, "originalPosition": 16}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzIyNzM0OTE5OnYy", "diffSide": "RIGHT", "path": "osgp/platform/osgp-core/src/main/java/org/opensmartgridplatform/core/application/services/EventNotificationMessageService.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0zMFQxMzowNjoxNlrOHrOIUg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0zMFQxNjozMToyOVrOHrW0wA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNTA4MjMyMg==", "bodyText": "Is this check really needed?", "url": "https://github.com/OSGP/open-smart-grid-platform/pull/475#discussion_r515082322", "createdAt": "2020-10-30T13:06:16Z", "author": {"login": "smvdheijden"}, "path": "osgp/platform/osgp-core/src/main/java/org/opensmartgridplatform/core/application/services/EventNotificationMessageService.java", "diffHunk": "@@ -58,18 +59,17 @@\n     public void handleEvent(final String deviceIdentification, final Date dateTime, final EventType eventType,\n             final String description, final Integer index) throws UnknownEntityException {\n \n-        // Lookup device\n-        final Device device = this.eventNotificationHelperService.findDevice(deviceIdentification);\n-        // If the event belongs to an existing device, then save it,\n-        // otherwise don't.\n-        this.eventNotificationHelperService.saveEvent(new Event(device,\n+        // Check if the event belongs to an existing device\n+        this.eventNotificationHelperService.findDevice(deviceIdentification);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "cd31855dc7663caedbaf173994f01d30814be80e"}, "originalPosition": 18}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNTIyNDc2OA==", "bodyText": "Check removed.", "url": "https://github.com/OSGP/open-smart-grid-platform/pull/475#discussion_r515224768", "createdAt": "2020-10-30T16:31:29Z", "author": {"login": "rlemmers"}, "path": "osgp/platform/osgp-core/src/main/java/org/opensmartgridplatform/core/application/services/EventNotificationMessageService.java", "diffHunk": "@@ -58,18 +59,17 @@\n     public void handleEvent(final String deviceIdentification, final Date dateTime, final EventType eventType,\n             final String description, final Integer index) throws UnknownEntityException {\n \n-        // Lookup device\n-        final Device device = this.eventNotificationHelperService.findDevice(deviceIdentification);\n-        // If the event belongs to an existing device, then save it,\n-        // otherwise don't.\n-        this.eventNotificationHelperService.saveEvent(new Event(device,\n+        // Check if the event belongs to an existing device\n+        this.eventNotificationHelperService.findDevice(deviceIdentification);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNTA4MjMyMg=="}, "originalCommit": {"oid": "cd31855dc7663caedbaf173994f01d30814be80e"}, "originalPosition": 18}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzIyNzM1OTY5OnYy", "diffSide": "RIGHT", "path": "osgp/platform/osgp-core/src/main/java/org/opensmartgridplatform/core/application/services/EventNotificationHelperService.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0zMFQxMzowOToxNlrOHrOOxg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0zMFQxNjozMToxOVrOHrW0UQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNTA4Mzk3NA==", "bodyText": "Not in scope for this story, but it would be nice if the findByDeviceIdentification call is modified to return an Optional<Ssld>...", "url": "https://github.com/OSGP/open-smart-grid-platform/pull/475#discussion_r515083974", "createdAt": "2020-10-30T13:09:16Z", "author": {"login": "smvdheijden"}, "path": "osgp/platform/osgp-core/src/main/java/org/opensmartgridplatform/core/application/services/EventNotificationHelperService.java", "diffHunk": "@@ -63,6 +63,14 @@ public Ssld findSsld(final Long id) throws UnknownEntityException {\n         return ssld.get();\n     }\n \n+    public Ssld findSsld(final String deviceIdentification) throws UnknownEntityException {\n+        final Ssld ssld = this.ssldRepository.findByDeviceIdentification(deviceIdentification);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "cd31855dc7663caedbaf173994f01d30814be80e"}, "originalPosition": 5}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNTIyNDY1Nw==", "bodyText": "Agreed to look into this some other time.", "url": "https://github.com/OSGP/open-smart-grid-platform/pull/475#discussion_r515224657", "createdAt": "2020-10-30T16:31:19Z", "author": {"login": "rlemmers"}, "path": "osgp/platform/osgp-core/src/main/java/org/opensmartgridplatform/core/application/services/EventNotificationHelperService.java", "diffHunk": "@@ -63,6 +63,14 @@ public Ssld findSsld(final Long id) throws UnknownEntityException {\n         return ssld.get();\n     }\n \n+    public Ssld findSsld(final String deviceIdentification) throws UnknownEntityException {\n+        final Ssld ssld = this.ssldRepository.findByDeviceIdentification(deviceIdentification);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNTA4Mzk3NA=="}, "originalCommit": {"oid": "cd31855dc7663caedbaf173994f01d30814be80e"}, "originalPosition": 5}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzIyNzM2NzkwOnYy", "diffSide": "RIGHT", "path": "osgp/platform/osgp-core/src/main/java/org/opensmartgridplatform/core/application/services/EventNotificationMessageService.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0zMFQxMzoxMTozMlrOHrOTxg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0zMFQxNjozMDo0OVrOHrWzIA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNTA4NTI1NA==", "bodyText": "Not in scope for this story, but this could easily be refactored to a isSwitchingEvent method, making the comment unnecessary...", "url": "https://github.com/OSGP/open-smart-grid-platform/pull/475#discussion_r515085254", "createdAt": "2020-10-30T13:11:32Z", "author": {"login": "smvdheijden"}, "path": "osgp/platform/osgp-core/src/main/java/org/opensmartgridplatform/core/application/services/EventNotificationMessageService.java", "diffHunk": "@@ -58,18 +59,17 @@\n     public void handleEvent(final String deviceIdentification, final Date dateTime, final EventType eventType,\n             final String description, final Integer index) throws UnknownEntityException {\n \n-        // Lookup device\n-        final Device device = this.eventNotificationHelperService.findDevice(deviceIdentification);\n-        // If the event belongs to an existing device, then save it,\n-        // otherwise don't.\n-        this.eventNotificationHelperService.saveEvent(new Event(device,\n+        // Check if the event belongs to an existing device\n+        this.eventNotificationHelperService.findDevice(deviceIdentification);\n+\n+        this.eventNotificationHelperService.saveEvent(new Event(deviceIdentification,\n                 dateTime != null ? dateTime : DateTime.now().toDate(), eventType, description, index));\n \n         // Check if it was a switching event.\n         if (eventType.equals(EventType.LIGHT_EVENTS_LIGHT_ON) || eventType.equals(EventType.LIGHT_EVENTS_LIGHT_OFF)\n                 || eventType.equals(EventType.TARIFF_EVENTS_TARIFF_ON)\n                 || eventType.equals(EventType.TARIFF_EVENTS_TARIFF_OFF)) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "cd31855dc7663caedbaf173994f01d30814be80e"}, "originalPosition": 26}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNTIyNDM1Mg==", "bodyText": "Done (and Eclipse also replaced the code at a second place in this file, when I refactored this).", "url": "https://github.com/OSGP/open-smart-grid-platform/pull/475#discussion_r515224352", "createdAt": "2020-10-30T16:30:49Z", "author": {"login": "rlemmers"}, "path": "osgp/platform/osgp-core/src/main/java/org/opensmartgridplatform/core/application/services/EventNotificationMessageService.java", "diffHunk": "@@ -58,18 +59,17 @@\n     public void handleEvent(final String deviceIdentification, final Date dateTime, final EventType eventType,\n             final String description, final Integer index) throws UnknownEntityException {\n \n-        // Lookup device\n-        final Device device = this.eventNotificationHelperService.findDevice(deviceIdentification);\n-        // If the event belongs to an existing device, then save it,\n-        // otherwise don't.\n-        this.eventNotificationHelperService.saveEvent(new Event(device,\n+        // Check if the event belongs to an existing device\n+        this.eventNotificationHelperService.findDevice(deviceIdentification);\n+\n+        this.eventNotificationHelperService.saveEvent(new Event(deviceIdentification,\n                 dateTime != null ? dateTime : DateTime.now().toDate(), eventType, description, index));\n \n         // Check if it was a switching event.\n         if (eventType.equals(EventType.LIGHT_EVENTS_LIGHT_ON) || eventType.equals(EventType.LIGHT_EVENTS_LIGHT_OFF)\n                 || eventType.equals(EventType.TARIFF_EVENTS_TARIFF_ON)\n                 || eventType.equals(EventType.TARIFF_EVENTS_TARIFF_OFF)) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNTA4NTI1NA=="}, "originalCommit": {"oid": "cd31855dc7663caedbaf173994f01d30814be80e"}, "originalPosition": 26}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzIyNzM3MDEzOnYy", "diffSide": "RIGHT", "path": "osgp/platform/osgp-adapter-ws-publiclighting/src/main/java/org/opensmartgridplatform/adapter/ws/publiclighting/infra/jms/messageprocessor/DomainResponseMessageProcessor.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0zMFQxMzoxMjoxMlrOHrOVGA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0zMFQxMzoxMjoxMlrOHrOVGA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNTA4NTU5Mg==", "bodyText": "\ud83d\udc4d", "url": "https://github.com/OSGP/open-smart-grid-platform/pull/475#discussion_r515085592", "createdAt": "2020-10-30T13:12:12Z", "author": {"login": "smvdheijden"}, "path": "osgp/platform/osgp-adapter-ws-publiclighting/src/main/java/org/opensmartgridplatform/adapter/ws/publiclighting/infra/jms/messageprocessor/DomainResponseMessageProcessor.java", "diffHunk": "@@ -76,7 +76,7 @@ public void init() {\n \n     @Override\n     public void processMessage(final ObjectMessage message) {\n-        LOGGER.debug(\"Processing smart metering response message\");\n+        LOGGER.debug(\"Processing public lighting response message\");", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "cd31855dc7663caedbaf173994f01d30814be80e"}, "originalPosition": 5}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzIyNzQxMzA3OnYy", "diffSide": "RIGHT", "path": "osgp/platform/osgp-adapter-domain-publiclighting/src/main/java/org/opensmartgridplatform/adapter/domain/publiclighting/application/services/AdHocManagementService.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0zMFQxMzoyMjozOFrOHrOvQA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0zMFQxMzoyMjozOFrOHrOvQA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNTA5MjI4OA==", "bodyText": "\ud83e\udd14\n\ud83d\udc4d", "url": "https://github.com/OSGP/open-smart-grid-platform/pull/475#discussion_r515092288", "createdAt": "2020-10-30T13:22:38Z", "author": {"login": "smvdheijden"}, "path": "osgp/platform/osgp-adapter-domain-publiclighting/src/main/java/org/opensmartgridplatform/adapter/domain/publiclighting/application/services/AdHocManagementService.java", "diffHunk": "@@ -390,18 +390,15 @@ private LightMeasurementDevice updateLmdLastCommunicationTime(final LightMeasure\n     }\n \n     private boolean isDuplicateEvent(final Event event, final LightMeasurementDevice lmd) {\n-        final List<Event> events = this.eventRepository.findTop2ByDeviceOrderByDateTimeDesc(lmd);\n-        for (final Event e : events) {\n-            if (event.getDateTime().equals(e.getDateTime())) {\n-                // Exact match found, skip this event of the result set.\n-                continue;\n-            } else if (event.getEventType().equals(e.getEventType())) {\n-                // If second event has same type, duplicate event has been\n-                // detected.\n-                return true;\n-            }\n-        }\n-        return false;\n+        final List<Event> events = this.eventRepository\n+                .findTop2ByDeviceIdentificationOrderByDateTimeDesc(lmd.getDeviceIdentification());\n+\n+        // Returns true if one of the events differs in date/time and has the\n+        // same event type\n+        return events.stream()", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "cd31855dc7663caedbaf173994f01d30814be80e"}, "originalPosition": 21}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3561, "cost": 1, "resetAt": "2021-11-12T12:57:47Z"}}}