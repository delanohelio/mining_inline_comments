{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDM1ODA4MDY1", "number": 354, "reviewThreads": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yMlQwNzo1MToxMFrOEHdqmg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yM1QxNDo0NTo1MVrOEIAOSA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjc2MjYxNTMwOnYy", "diffSide": "RIGHT", "path": "osgp/platform/osgp-adapter-ws-core/src/main/java/org/opensmartgridplatform/adapter/ws/core/application/services/DeviceManagementService.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yMlQwNzo1MToxMVrOGm1jZw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yMlQwNzo1MToxMVrOGm1jZw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MzM3NjQ4Nw==", "bodyText": "A number of criteria, like this one, are not updated correctly yet:\n\ndoes not escape \"_\"\nadds \"%\" at the end. Remove those, because we don't want an implicit wildcard at the end of the string.", "url": "https://github.com/OSGP/open-smart-grid-platform/pull/354#discussion_r443376487", "createdAt": "2020-06-22T07:51:11Z", "author": {"login": "rlemmers"}, "path": "osgp/platform/osgp-adapter-ws-core/src/main/java/org/opensmartgridplatform/adapter/ws/core/application/services/DeviceManagementService.java", "diffHunk": "@@ -497,32 +500,32 @@ public Organisation findOrganisation(@Identification final String organisationId\n             Specification<Device> specification) throws ArgumentNullOrEmptyException {\n         if (!StringUtils.isEmpty(deviceFilter.getCity())) {\n             specification = specification\n-                    .and(this.deviceSpecifications.hasCity(deviceFilter.getCity().replaceAll(WILDCARD, \"%\") + \"%\"));\n+                    .and(this.deviceSpecifications.hasCity(deviceFilter.getCity().replaceAll(WILDCARD_ALL, \"%\") + \"%\"));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "73d0c6d638bb77ee9e2f1493eec4fddfdb2fc56b"}, "originalPosition": 61}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjc2MjcxMTg1OnYy", "diffSide": "RIGHT", "path": "osgp/platform/osgp-adapter-ws-core/src/main/java/org/opensmartgridplatform/adapter/ws/core/application/services/DeviceManagementService.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yMlQwODoyMDo1MVrOGm2gAQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yMlQwODoyMDo1MVrOGm2gAQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MzM5MjAwMQ==", "bodyText": "Put this in a separate utility class for searching. It reduces the complexity of DeviceManagementService and it enables reuse.", "url": "https://github.com/OSGP/open-smart-grid-platform/pull/354#discussion_r443392001", "createdAt": "2020-06-22T08:20:51Z", "author": {"login": "rlemmers"}, "path": "osgp/platform/osgp-adapter-ws-core/src/main/java/org/opensmartgridplatform/adapter/ws/core/application/services/DeviceManagementService.java", "diffHunk": "@@ -902,4 +905,21 @@ public String enqueueUpdateDeviceCdmaSettingsRequest(final String organisationId\n     public ResponseMessage dequeueUpdateDeviceCdmaSettingsResponse(final String correlationUid) throws OsgpException {\n         return this.commonResponseMessageFinder.findMessage(correlationUid);\n     }\n+\n+    /**\n+     * This method replaces normal wilcards for Postgres wildcards and escapes\n+     * Postgres wildcards that were already present.\n+     * \n+     * @param input\n+     *            String\n+     * @return an output String containing the correct wildcards.\n+     */\n+    private String replaceWildcards(String input) {\n+        return input.replace(ESCAPE, ESCAPE + ESCAPE)\n+                .replace(WILDCARD_ALL_REPLACEMENT, ESCAPE + WILDCARD_ALL_REPLACEMENT)\n+                .replace(WILDCARD_SINGLE_REPLACEMENT, ESCAPE + WILDCARD_SINGLE_REPLACEMENT)\n+                .replace(WILDCARD_ALL, WILDCARD_ALL_REPLACEMENT)\n+                .replace(WILDCARD_SINGLE, WILDCARD_SINGLE_REPLACEMENT)\n+                .toUpperCase();\n+    }", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "73d0c6d638bb77ee9e2f1493eec4fddfdb2fc56b"}, "originalPosition": 127}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjc2MjcxNzg4OnYy", "diffSide": "RIGHT", "path": "osgp/platform/osgp-adapter-ws-core/src/main/java/org/opensmartgridplatform/adapter/ws/core/application/services/DeviceManagementService.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yMlQwODoyMjozNlrOGm2jvA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yMlQwODoyMjozNlrOGm2jvA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MzM5Mjk1Ng==", "bodyText": "Remove the text \"This method\"\nwilcards => wildcards\nfor => by\nPostgres => SQL", "url": "https://github.com/OSGP/open-smart-grid-platform/pull/354#discussion_r443392956", "createdAt": "2020-06-22T08:22:36Z", "author": {"login": "rlemmers"}, "path": "osgp/platform/osgp-adapter-ws-core/src/main/java/org/opensmartgridplatform/adapter/ws/core/application/services/DeviceManagementService.java", "diffHunk": "@@ -902,4 +905,21 @@ public String enqueueUpdateDeviceCdmaSettingsRequest(final String organisationId\n     public ResponseMessage dequeueUpdateDeviceCdmaSettingsResponse(final String correlationUid) throws OsgpException {\n         return this.commonResponseMessageFinder.findMessage(correlationUid);\n     }\n+\n+    /**\n+     * This method replaces normal wilcards for Postgres wildcards and escapes\n+     * Postgres wildcards that were already present.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "73d0c6d638bb77ee9e2f1493eec4fddfdb2fc56b"}, "originalPosition": 114}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjc2ODI3NDEyOnYy", "diffSide": "RIGHT", "path": "osgp/platform/osgp-adapter-ws-core/src/main/java/org/opensmartgridplatform/adapter/ws/core/application/utility/WildcardUtil.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yM1QxNDo0NToxNlrOGnsxmQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yM1QxNDo0NToxNlrOGnsxmQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NDI4MTI0MQ==", "bodyText": "License header is missing.", "url": "https://github.com/OSGP/open-smart-grid-platform/pull/354#discussion_r444281241", "createdAt": "2020-06-23T14:45:16Z", "author": {"login": "rlemmers"}, "path": "osgp/platform/osgp-adapter-ws-core/src/main/java/org/opensmartgridplatform/adapter/ws/core/application/utility/WildcardUtil.java", "diffHunk": "@@ -0,0 +1,33 @@\n+package org.opensmartgridplatform.adapter.ws.core.application.utility;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d3e5459e2a18414be7fe5c35763e95632c0d3f0a"}, "originalPosition": 1}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjc2ODI3NzIwOnYy", "diffSide": "RIGHT", "path": "osgp/platform/osgp-adapter-ws-core/src/main/java/org/opensmartgridplatform/adapter/ws/core/application/services/DeviceManagementService.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yM1QxNDo0NTo1MVrOGnszdA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yM1QxNDo0NTo1MVrOGnszdA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NDI4MTcxNg==", "bodyText": "In other places, we use a \"static import\" to save some characters.", "url": "https://github.com/OSGP/open-smart-grid-platform/pull/354#discussion_r444281716", "createdAt": "2020-06-23T14:45:51Z", "author": {"login": "rlemmers"}, "path": "osgp/platform/osgp-adapter-ws-core/src/main/java/org/opensmartgridplatform/adapter/ws/core/application/services/DeviceManagementService.java", "diffHunk": "@@ -416,7 +410,7 @@ public Organisation findOrganisation(@Identification final String organisationId\n             Specification<Device> specification) throws ArgumentNullOrEmptyException {\n         if (!StringUtils.isEmpty(deviceFilter.getFirmwareModuleVersion())) {\n             specification = specification.and(this.deviceSpecifications.forFirmwareModuleVersion(\n-                    deviceFilter.getFirmwareModuleType(), replaceWildcards(deviceFilter.getFirmwareModuleVersion())));\n+                    deviceFilter.getFirmwareModuleType(), WildcardUtil.replaceWildcards(deviceFilter.getFirmwareModuleVersion())));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d3e5459e2a18414be7fe5c35763e95632c0d3f0a"}, "originalPosition": 27}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3615, "cost": 1, "resetAt": "2021-11-12T12:57:47Z"}}}