{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTAyMDQ1OTc2", "number": 456, "title": "Feature/oc 667 peakshaving update kafka", "bodyText": "[@DistributionAutomation]", "createdAt": "2020-10-13T07:06:23Z", "url": "https://github.com/OSGP/open-smart-grid-platform/pull/456", "merged": true, "mergeCommit": {"oid": "a0a12e15853af7d0c179583801fd18ecdf8cd308"}, "closed": true, "closedAt": "2020-10-15T12:57:39Z", "author": {"login": "robindenadel"}, "timelineItems": {"totalCount": 8, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdSCs--gH2gAyNTAyMDQ1OTc2OjE1NGI4NGZkOTA0ZTMzNmQxNjFkMmZhNGE3NGIwNzZhNGJkZmJiZjY=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdSv4OCgFqTUwOTI2ODk2OA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "154b84fd904e336d161d2fa4a74b076a4bdfbbf6", "author": {"user": {"login": "robindenadel", "name": "Robin den Adel"}}, "url": "https://github.com/OSGP/open-smart-grid-platform/commit/154b84fd904e336d161d2fa4a74b076a4bdfbbf6", "committedDate": "2020-10-13T06:36:49Z", "message": "OC-887: Updates code to new Avro schema."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "369bd3ce30bb813b24190ce4f81985a54f79b3f4", "author": {"user": {"login": "robindenadel", "name": "Robin den Adel"}}, "url": "https://github.com/OSGP/open-smart-grid-platform/commit/369bd3ce30bb813b24190ce4f81985a54f79b3f4", "committedDate": "2020-10-13T07:01:11Z", "message": "OC-667: Adapts cucumber scenario to new avro schema."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "395df1d887ce32cf5a770347cd446b8c3d6c3465", "author": {"user": {"login": "robindenadel", "name": "Robin den Adel"}}, "url": "https://github.com/OSGP/open-smart-grid-platform/commit/395df1d887ce32cf5a770347cd446b8c3d6c3465", "committedDate": "2020-10-13T07:03:22Z", "message": "OC-667: Removes unnecessary code."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTA3MTM0OTcz", "url": "https://github.com/OSGP/open-smart-grid-platform/pull/456#pullrequestreview-507134973", "createdAt": "2020-10-13T07:20:11Z", "commit": {"oid": "395df1d887ce32cf5a770347cd446b8c3d6c3465"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xM1QwNzoyMDoxMVrOHgYpVg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xM1QwNzoyMDoxMVrOHgYpVg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMzcyMDI3OA==", "bodyText": "Override the \"equals\" method in this class.", "url": "https://github.com/OSGP/open-smart-grid-platform/pull/456#discussion_r503720278", "createdAt": "2020-10-13T07:20:11Z", "author": {"login": "jenkins-ip-10-4-24-184"}, "path": "osgp/platform/osgp-adapter-kafka-distributionautomation/src/main/java/org/opensmartgridplatform/adapter/kafka/da/application/mapping/ScadaMeasurementPublishedEventConverter.java", "diffHunk": "@@ -42,15 +42,15 @@\n  * ls peak shaving measurement: ean_code + the values of\n  * LsPeakShavingMeasurementType seperated by semicolons.\n  */\n-public class GridMeasurementPublishedEventConverter extends CustomConverter<String, GridMeasurementPublishedEvent> {\n+public class ScadaMeasurementPublishedEventConverter extends CustomConverter<String, ScadaMeasurementPublishedEvent> {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "395df1d887ce32cf5a770347cd446b8c3d6c3465"}, "originalPosition": 36}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTA3Nzc4NjIy", "url": "https://github.com/OSGP/open-smart-grid-platform/pull/456#pullrequestreview-507778622", "createdAt": "2020-10-13T19:54:29Z", "commit": {"oid": "395df1d887ce32cf5a770347cd446b8c3d6c3465"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xM1QxOTo1NDozMFrOHg2_jA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xM1QyMDoxNjozNlrOHg3tYQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNDIxNzQ4NA==", "bodyText": "I think the \"Arrays.toString\" is needed for readable output.", "url": "https://github.com/OSGP/open-smart-grid-platform/pull/456#discussion_r504217484", "createdAt": "2020-10-13T19:54:30Z", "author": {"login": "rlemmers"}, "path": "osgp/platform/osgp-adapter-kafka-distributionautomation/src/main/java/org/opensmartgridplatform/adapter/kafka/da/application/mapping/ScadaMeasurementPublishedEventConverter.java", "diffHunk": "@@ -64,8 +64,7 @@ public GridMeasurementPublishedEvent convert(final String source,\n             final Payload payload = payloads[0];\n \n             final String[] measurementValues = (payload.gisnr + \", \" + String.join(\", \", payload.data)).split(\", \");\n-            LOGGER.debug(\"Values length: {} and values: {}\", measurementValues.length,\n-                    Arrays.toString(measurementValues));\n+            LOGGER.debug(\"Values length: {} and values: {}\", measurementValues.length, measurementValues);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "395df1d887ce32cf5a770347cd446b8c3d6c3465"}, "originalPosition": 58}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNDIyMDY4MQ==", "bodyText": "Why was this changed from false to true?", "url": "https://github.com/OSGP/open-smart-grid-platform/pull/456#discussion_r504220681", "createdAt": "2020-10-13T20:00:07Z", "author": {"login": "rlemmers"}, "path": "osgp/platform/osgp-adapter-kafka-logging/src/main/resources/osgp-adapter-kafka-logging.properties", "diffHunk": "@@ -20,16 +20,16 @@ peakshaving.kafka.consumer.auto.offset.reset=latest\n # KAFKA CONFIG GRID MEASUREMENT PUBLISHED EVENT LOGGING CONSUMER\n # ==================================================================\n \n-grid.measurement.published.event.kafka.logging.enabled=false\n+scada.measurement.published.event.kafka.logging.enabled=true", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "395df1d887ce32cf5a770347cd446b8c3d6c3465"}, "originalPosition": 5}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNDIyNDgyNQ==", "bodyText": "Does this mean the ScadaMeasurementPublishedEvent record is only temporary and will be replaced by GridMeasurementPublishedEvent at a certain point in time?", "url": "https://github.com/OSGP/open-smart-grid-platform/pull/456#discussion_r504224825", "createdAt": "2020-10-13T20:07:58Z", "author": {"login": "rlemmers"}, "path": "osgp/shared/osgp-kafka-distributionautomation/src/main/resources/ScadaMeasurementPublishedEventMessage.avsc", "diffHunk": "@@ -0,0 +1,195 @@\n+{\n+  \"type\" : \"record\",\n+  \"name\" : \"Message\",\n+  \"namespace\" : \"com.alliander.data.scadameasurementpublishedevent\",\n+  \"doc\" : \"default message format for Alliander Messaging*\",\n+  \"fields\" : [ {\n+    \"name\" : \"messageId\",\n+    \"type\" : {\n+      \"type\" : \"fixed\",\n+      \"name\" : \"MessageId\",\n+      \"namespace\" : \"com.alliander.messaging\",\n+      \"size\" : 16\n+    },\n+    \"doc\" : \"contains a version 4 UUID generated by the process constructing the message\"\n+  }, {\n+    \"name\" : \"createdDateTime\",\n+    \"type\" : \"long\",\n+    \"doc\" : \"the timestamp at which the message is created in the message creating process as the number of milliseconds from the unix epoch, 1 January 1970 00:00:00.000 UTC\"\n+  }, {\n+    \"name\" : \"producerId\",\n+    \"type\" : \"string\",\n+    \"doc\" : \"identifier of the message producing process*\"\n+  }, {\n+    \"name\" : \"signature\",\n+    \"type\" : [ \"null\", \"bytes\" ],\n+    \"doc\" : \"2048bits RSA encrypted SHA-256 hash over the avro binary representation of the complete message assuming the signature field is set to null\"\n+  }, {\n+    \"name\" : \"payload\",\n+    \"type\" : {\n+      \"type\" : \"record\",\n+      \"name\" : \"ScadaMeasurementPublishedEvent\",\n+      \"doc\" : \"measurement data as published by the SCADA system. This class (and its topic in Kafka) will be replaced by GridMeasurementPublishedEvent\",", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "395df1d887ce32cf5a770347cd446b8c3d6c3465"}, "originalPosition": 32}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNDIyOTIxNw==", "bodyText": "Do we need a similar catch in the ScadaMeasurementPublishedEventProducer?", "url": "https://github.com/OSGP/open-smart-grid-platform/pull/456#discussion_r504229217", "createdAt": "2020-10-13T20:16:36Z", "author": {"login": "rlemmers"}, "path": "osgp/platform/osgp-adapter-kafka-distributionautomation/src/main/java/org/opensmartgridplatform/adapter/kafka/da/infra/kafka/out/PeakShavingProducer.java", "diffHunk": "@@ -1,39 +0,0 @@\n-/**\n- * Copyright 2020 Smart Society Services B.V.\n- *\n- * Licensed under the Apache License, Version 2.0 (the \"License\"); you may not use this file except in compliance with the License.  You may obtain a copy of the License at\n- *\n- *     http://www.apache.org/licenses/LICENSE-2.0\n- */\n-package org.opensmartgridplatform.adapter.kafka.da.infra.kafka.out;\n-\n-import org.slf4j.Logger;\n-import org.slf4j.LoggerFactory;\n-import org.springframework.beans.factory.annotation.Autowired;\n-import org.springframework.beans.factory.annotation.Qualifier;\n-import org.springframework.kafka.core.KafkaTemplate;\n-import org.springframework.stereotype.Service;\n-\n-@Service\n-public class PeakShavingProducer {\n-\n-    private static final Logger LOGGER = LoggerFactory.getLogger(PeakShavingProducer.class);\n-\n-    private final KafkaTemplate<String, String> kafkaTemplate;\n-\n-    @Autowired\n-    public PeakShavingProducer(\n-            @Qualifier(\"peakShavingKafkaTemplate\") final KafkaTemplate<String, String> kafkaTemplate) {\n-        this.kafkaTemplate = kafkaTemplate;\n-    }\n-\n-    public void send(final String message) {\n-\n-        try {\n-            this.kafkaTemplate.sendDefault(message);\n-        } catch (final RuntimeException e) {\n-            LOGGER.error(\"Sending message {} failed\", message, e);\n-        }", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "395df1d887ce32cf5a770347cd446b8c3d6c3465"}, "originalPosition": 36}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "0d27fe29750d306ec041dde9f4d2f7f558866c41", "author": {"user": {"login": "robindenadel", "name": "Robin den Adel"}}, "url": "https://github.com/OSGP/open-smart-grid-platform/commit/0d27fe29750d306ec041dde9f4d2f7f558866c41", "committedDate": "2020-10-15T06:08:08Z", "message": "OC-667: Addresses review comments."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "7aff590b084b4ae46bd458a918c3202ce44fde08", "author": {"user": {"login": "rlemmers", "name": "Ruud Lemmers"}}, "url": "https://github.com/OSGP/open-smart-grid-platform/commit/7aff590b084b4ae46bd458a918c3202ce44fde08", "committedDate": "2020-10-15T11:10:22Z", "message": "OC-667 ~ Reactivates xml validation"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTA5MjY4OTY4", "url": "https://github.com/OSGP/open-smart-grid-platform/pull/456#pullrequestreview-509268968", "createdAt": "2020-10-15T11:14:49Z", "commit": {"oid": "7aff590b084b4ae46bd458a918c3202ce44fde08"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3671, "cost": 1, "resetAt": "2021-11-01T16:19:10Z"}}}