{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0Mzk2OTAwNzE2", "number": 263, "title": "OC-537 MQTT webservices", "bodyText": "SOAP Endpoint to add an RtuDevice, which can be used for MQTT communication.", "createdAt": "2020-04-01T10:20:51Z", "url": "https://github.com/OSGP/open-smart-grid-platform/pull/263", "merged": true, "mergeCommit": {"oid": "8e3c5c0ea029bb09a1fd69afdc7deefd1f57b3a0"}, "closed": true, "closedAt": "2020-05-06T14:08:32Z", "author": {"login": "akoster"}, "timelineItems": {"totalCount": 9, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcTF3rXgH2gAyMzk2OTAwNzE2OjU2ODExNjdhM2ExNjQxMTcwN2I1NjFjODJmMzI5Mzk5MDJhZGQ4YzA=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcepPjDAFqTQwNjY0ODQ2Nw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "5681167a3a16411707b561c82f32939902add8c0", "author": {"user": {"login": "akoster", "name": "Adriaan Koster"}}, "url": "https://github.com/OSGP/open-smart-grid-platform/commit/5681167a3a16411707b561c82f32939902add8c0", "committedDate": "2020-03-31T16:40:59Z", "message": "OC-537 AddRtuDevice endpoint"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "201a40eadf446ef6878969375cae2daae79f2889", "author": {"user": {"login": "akoster", "name": "Adriaan Koster"}}, "url": "https://github.com/OSGP/open-smart-grid-platform/commit/201a40eadf446ef6878969375cae2daae79f2889", "committedDate": "2020-04-01T10:18:13Z", "message": "OC-537 Clean up"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e92c53456e415b294bef8424d9e735f0801d4b7a", "author": {"user": {"login": "akoster", "name": "Adriaan Koster"}}, "url": "https://github.com/OSGP/open-smart-grid-platform/commit/e92c53456e415b294bef8424d9e735f0801d4b7a", "committedDate": "2020-04-03T10:22:11Z", "message": "OC-537 Remove unused variable"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzkwMTM0MTg5", "url": "https://github.com/OSGP/open-smart-grid-platform/pull/263#pullrequestreview-390134189", "createdAt": "2020-04-08T16:24:16Z", "commit": {"oid": "e92c53456e415b294bef8424d9e735f0801d4b7a"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 6, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wOFQxNjoyNDoxNlrOGC3Bsw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wOFQxNjozMTowMlrOGC3TYA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNTY1MTg5MQ==", "bodyText": "Rename the element name to DeviceIdentification.", "url": "https://github.com/OSGP/open-smart-grid-platform/pull/263#discussion_r405651891", "createdAt": "2020-04-08T16:24:16Z", "author": {"login": "kevinsmeets"}, "path": "osgp/shared/osgp-ws-distributionautomation/src/main/resources/schemas/distributionautomation.xsd", "diffHunk": "@@ -187,6 +187,62 @@\n         </xsd:complexContent>\n     </xsd:complexType>\n \n+\n+    <!--\n+    Types for device management\n+    -->\n+\n+    <xsd:complexType name=\"RtuDevice\">\n+        <xsd:sequence>\n+            <xsd:element name=\"Device_Identification\" minOccurs=\"0\" type=\"common:DeviceIdentification\" />", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e92c53456e415b294bef8424d9e735f0801d4b7a"}, "originalPosition": 33}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNTY1MjA2NQ==", "bodyText": "Rename the element name to ProtocolName.", "url": "https://github.com/OSGP/open-smart-grid-platform/pull/263#discussion_r405652065", "createdAt": "2020-04-08T16:24:33Z", "author": {"login": "kevinsmeets"}, "path": "osgp/shared/osgp-ws-distributionautomation/src/main/resources/schemas/distributionautomation.xsd", "diffHunk": "@@ -187,6 +187,62 @@\n         </xsd:complexContent>\n     </xsd:complexType>\n \n+\n+    <!--\n+    Types for device management\n+    -->\n+\n+    <xsd:complexType name=\"RtuDevice\">\n+        <xsd:sequence>\n+            <xsd:element name=\"Device_Identification\" minOccurs=\"0\" type=\"common:DeviceIdentification\" />\n+\n+            <xsd:element name=\"protocolName\" minOccurs=\"0\">", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e92c53456e415b294bef8424d9e735f0801d4b7a"}, "originalPosition": 35}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNTY1MjE3NQ==", "bodyText": "Rename the element name to ProtocolVersion.", "url": "https://github.com/OSGP/open-smart-grid-platform/pull/263#discussion_r405652175", "createdAt": "2020-04-08T16:24:44Z", "author": {"login": "kevinsmeets"}, "path": "osgp/shared/osgp-ws-distributionautomation/src/main/resources/schemas/distributionautomation.xsd", "diffHunk": "@@ -187,6 +187,62 @@\n         </xsd:complexContent>\n     </xsd:complexType>\n \n+\n+    <!--\n+    Types for device management\n+    -->\n+\n+    <xsd:complexType name=\"RtuDevice\">\n+        <xsd:sequence>\n+            <xsd:element name=\"Device_Identification\" minOccurs=\"0\" type=\"common:DeviceIdentification\" />\n+\n+            <xsd:element name=\"protocolName\" minOccurs=\"0\">\n+                <xsd:simpleType>\n+                    <xsd:restriction base=\"xsd:string\">\n+                        <xsd:maxLength value=\"10\" />\n+                    </xsd:restriction>\n+                </xsd:simpleType>\n+            </xsd:element>\n+\n+            <xsd:element name=\"protocolVersion\" minOccurs=\"0\">", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e92c53456e415b294bef8424d9e735f0801d4b7a"}, "originalPosition": 43}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNTY1MjMyNg==", "bodyText": "Rename the element name to NetworkAddress.", "url": "https://github.com/OSGP/open-smart-grid-platform/pull/263#discussion_r405652326", "createdAt": "2020-04-08T16:24:58Z", "author": {"login": "kevinsmeets"}, "path": "osgp/shared/osgp-ws-distributionautomation/src/main/resources/schemas/distributionautomation.xsd", "diffHunk": "@@ -187,6 +187,62 @@\n         </xsd:complexContent>\n     </xsd:complexType>\n \n+\n+    <!--\n+    Types for device management\n+    -->\n+\n+    <xsd:complexType name=\"RtuDevice\">\n+        <xsd:sequence>\n+            <xsd:element name=\"Device_Identification\" minOccurs=\"0\" type=\"common:DeviceIdentification\" />\n+\n+            <xsd:element name=\"protocolName\" minOccurs=\"0\">\n+                <xsd:simpleType>\n+                    <xsd:restriction base=\"xsd:string\">\n+                        <xsd:maxLength value=\"10\" />\n+                    </xsd:restriction>\n+                </xsd:simpleType>\n+            </xsd:element>\n+\n+            <xsd:element name=\"protocolVersion\" minOccurs=\"0\">\n+                <xsd:simpleType>\n+                    <xsd:restriction base=\"xsd:string\">\n+                        <xsd:maxLength value=\"10\" />\n+                    </xsd:restriction>\n+                </xsd:simpleType>\n+            </xsd:element>\n+\n+            <xsd:element name=\"Network_Address\" minOccurs=\"0\">", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e92c53456e415b294bef8424d9e735f0801d4b7a"}, "originalPosition": 51}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNTY1NDc1OQ==", "bodyText": "Rename this function to addRtu and update the logging message.", "url": "https://github.com/OSGP/open-smart-grid-platform/pull/263#discussion_r405654759", "createdAt": "2020-04-08T16:28:36Z", "author": {"login": "kevinsmeets"}, "path": "osgp/platform/osgp-adapter-domain-distributionautomation/src/main/java/org/opensmartgridplatform/adapter/domain/da/application/services/DeviceManagementService.java", "diffHunk": "@@ -86,10 +89,25 @@ public void handleHealthStatusResponse(final GetHealthStatusResponseDto getHealt\n             exception = this.ensureOsgpException(e, \"Exception occurred while getting Health Status Response Data\");\n         }\n \n-        ResponseMessage responseMessage = ResponseMessage.newResponseMessageBuilder()\n-                .withCorrelationUid(correlationUid).withOrganisationIdentification(organisationIdentification)\n-                .withDeviceIdentification(deviceIdentification).withResult(result).withOsgpException(exception)\n-                .withDataObject(getHealthStatusResponse).build();\n+        final ResponseMessage responseMessage = ResponseMessage.newResponseMessageBuilder()\n+                .withCorrelationUid(correlationUid)\n+                .withOrganisationIdentification(organisationIdentification)\n+                .withDeviceIdentification(deviceIdentification)\n+                .withResult(result)\n+                .withOsgpException(exception)\n+                .withDataObject(getHealthStatusResponse)\n+                .build();\n         this.webServiceResponseMessageSender.send(responseMessage, messageType);\n     }\n+\n+    public void addMeter(final DeviceMessageMetadata deviceMessageMetadata,", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e92c53456e415b294bef8424d9e735f0801d4b7a"}, "originalPosition": 65}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNTY1NjQxNg==", "bodyText": "Include this section in the README.md. In case somebody wants to add a device using these statements instead of the web-service.", "url": "https://github.com/OSGP/open-smart-grid-platform/pull/263#discussion_r405656416", "createdAt": "2020-04-08T16:31:02Z", "author": {"login": "kevinsmeets"}, "path": "osgp/protocol-adapter-mqtt/osgp-protocol-simulator-mqtt/README.md", "diffHunk": "@@ -38,55 +40,46 @@ Tail the logs:\n docker logs -f CONTAINER\n ```\n \n-## Add MQTT RTU Device in the DB", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e92c53456e415b294bef8424d9e735f0801d4b7a"}, "originalPosition": 13}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzkwNzE0MjAx", "url": "https://github.com/OSGP/open-smart-grid-platform/pull/263#pullrequestreview-390714201", "createdAt": "2020-04-09T11:35:57Z", "commit": {"oid": "e92c53456e415b294bef8424d9e735f0801d4b7a"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 7, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wOVQxMTozNTo1N1rOGDU8_A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wOVQxMTo1NzozOFrOGDVl6A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNjE0MjIwNA==", "bodyText": "Ssld.SSLD_TYPE?", "url": "https://github.com/OSGP/open-smart-grid-platform/pull/263#discussion_r406142204", "createdAt": "2020-04-09T11:35:57Z", "author": {"login": "smvdheijden"}, "path": "osgp/platform/osgp-adapter-domain-distributionautomation/src/main/java/org/opensmartgridplatform/adapter/domain/da/application/services/RtuDeviceService.java", "diffHunk": "@@ -0,0 +1,128 @@\n+/**\n+ * Copyright 2020 Smart Society Services B.V.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\"); you may not use this file except in compliance\n+ * with the License.  You may obtain a copy of the License at\n+ *\n+ * http://www.apache.org/licenses/LICENSE-2.0\n+ */\n+package org.opensmartgridplatform.adapter.domain.da.application.services;\n+\n+import java.net.InetAddress;\n+import java.net.UnknownHostException;\n+\n+import org.opensmartgridplatform.domain.core.entities.DeviceAuthorization;\n+import org.opensmartgridplatform.domain.core.entities.DeviceModel;\n+import org.opensmartgridplatform.domain.core.entities.Manufacturer;\n+import org.opensmartgridplatform.domain.core.entities.Organisation;\n+import org.opensmartgridplatform.domain.core.entities.ProtocolInfo;\n+import org.opensmartgridplatform.domain.core.entities.Ssld;\n+import org.opensmartgridplatform.domain.core.repositories.DeviceAuthorizationRepository;\n+import org.opensmartgridplatform.domain.core.repositories.DeviceModelRepository;\n+import org.opensmartgridplatform.domain.core.repositories.ManufacturerRepository;\n+import org.opensmartgridplatform.domain.core.repositories.OrganisationRepository;\n+import org.opensmartgridplatform.domain.core.repositories.ProtocolInfoRepository;\n+import org.opensmartgridplatform.domain.core.repositories.RtuDeviceRepository;\n+import org.opensmartgridplatform.domain.core.valueobjects.AddRtuDeviceRequest;\n+import org.opensmartgridplatform.domain.core.valueobjects.DeviceFunctionGroup;\n+import org.opensmartgridplatform.domain.core.valueobjects.RtuDevice;\n+import org.opensmartgridplatform.shared.exceptionhandling.ComponentType;\n+import org.opensmartgridplatform.shared.exceptionhandling.FunctionalException;\n+import org.opensmartgridplatform.shared.exceptionhandling.FunctionalExceptionType;\n+import org.springframework.beans.factory.annotation.Autowired;\n+import org.springframework.stereotype.Service;\n+import org.springframework.transaction.annotation.Transactional;\n+\n+@Service(value = \"domainDistributionAutomationRtuDeviceService\")\n+@Transactional(value = \"transactionManager\")\n+public class RtuDeviceService {\n+\n+    private static final String LOCAL_HOST = \"127.0.0.1\";\n+\n+    @Autowired\n+    private RtuDeviceRepository rtuDeviceRepository;\n+\n+    @Autowired\n+    private ManufacturerRepository manufacturerRepository;\n+\n+    @Autowired\n+    private DeviceModelRepository deviceModelRepository;\n+\n+    @Autowired\n+    private ProtocolInfoRepository protocolInfoRepository;\n+\n+    @Autowired\n+    private OrganisationRepository organisationRepository;\n+\n+    @Autowired\n+    private DeviceAuthorizationRepository deviceAuthorizationRepository;\n+\n+    public void storeRtuDevice(final String organisationIdentification, final AddRtuDeviceRequest addRtuDeviceRequest)\n+            throws FunctionalException {\n+        this.throwExceptionOnExistingDevice(addRtuDeviceRequest);\n+        final RtuDevice rtuDevice = addRtuDeviceRequest.getRtuDevice();\n+        org.opensmartgridplatform.domain.core.entities.RtuDevice rtuDeviceEntity =\n+                new org.opensmartgridplatform.domain.core.entities.RtuDevice(\n+                rtuDevice.getDeviceIdentification());\n+        this.addProtocolInfo(rtuDevice, rtuDeviceEntity);\n+        this.addRegistrationData(rtuDevice, rtuDeviceEntity);\n+        this.addDeviceModel(addRtuDeviceRequest.getDeviceModel(), rtuDeviceEntity);\n+        rtuDeviceEntity = this.rtuDeviceRepository.save(rtuDeviceEntity);\n+        this.storeAuthorization(organisationIdentification, rtuDeviceEntity);\n+    }\n+\n+    private void throwExceptionOnExistingDevice(final AddRtuDeviceRequest addRtuDeviceRequest)\n+            throws FunctionalException {\n+        if (this.rtuDeviceRepository.findByDeviceIdentification(\n+                addRtuDeviceRequest.getRtuDevice().getDeviceIdentification()) != null) {\n+            throw new FunctionalException(FunctionalExceptionType.EXISTING_DEVICE,\n+                    ComponentType.DOMAIN_DISTRIBUTION_AUTOMATION);\n+        }\n+    }\n+\n+    private void addRegistrationData(final RtuDevice rtuDevice,\n+            final org.opensmartgridplatform.domain.core.entities.RtuDevice rtuDeviceEntity) throws FunctionalException {\n+        final String networkAddress = rtuDevice.getNetworkAddress();\n+        final InetAddress inetAddress;\n+        try {\n+            inetAddress = LOCAL_HOST.equals(networkAddress) ? InetAddress.getLoopbackAddress() : InetAddress.getByName(\n+                    networkAddress);\n+        } catch (final UnknownHostException e) {\n+            throw new FunctionalException(FunctionalExceptionType.INVALID_IP_ADDRESS,\n+                    ComponentType.DOMAIN_DISTRIBUTION_AUTOMATION, e);\n+        }\n+        rtuDeviceEntity.updateRegistrationData(inetAddress, Ssld.SSLD_TYPE);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e92c53456e415b294bef8424d9e735f0801d4b7a"}, "originalPosition": 94}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNjE0MzM1MA==", "bodyText": "MessageType.ADD_METER?", "url": "https://github.com/OSGP/open-smart-grid-platform/pull/263#discussion_r406143350", "createdAt": "2020-04-09T11:38:25Z", "author": {"login": "smvdheijden"}, "path": "osgp/platform/osgp-adapter-domain-distributionautomation/src/main/java/org/opensmartgridplatform/adapter/domain/da/infra/jms/ws/messageprocessors/AddDeviceRequestMessageProcessor.java", "diffHunk": "@@ -0,0 +1,56 @@\n+/**\n+ * Copyright 2020 Smart Society Services B.V.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ * http://www.apache.org/licenses/LICENSE-2.0\n+ */\n+package org.opensmartgridplatform.adapter.domain.da.infra.jms.ws.messageprocessors;\n+\n+import javax.jms.JMSException;\n+import javax.jms.ObjectMessage;\n+\n+import org.opensmartgridplatform.adapter.domain.da.application.services.DeviceManagementService;\n+import org.opensmartgridplatform.domain.core.valueobjects.AddRtuDeviceRequest;\n+import org.opensmartgridplatform.shared.exceptionhandling.FunctionalException;\n+import org.opensmartgridplatform.shared.infra.jms.BaseNotificationMessageProcessor;\n+import org.opensmartgridplatform.shared.infra.jms.DeviceMessageMetadata;\n+import org.opensmartgridplatform.shared.infra.jms.MessageProcessorMap;\n+import org.opensmartgridplatform.shared.infra.jms.MessageType;\n+import org.opensmartgridplatform.shared.infra.jms.NotificationResponseMessageSender;\n+import org.springframework.beans.factory.annotation.Autowired;\n+import org.springframework.beans.factory.annotation.Qualifier;\n+import org.springframework.stereotype.Component;\n+\n+@Component(\"domainDistributionAutomationAddDeviceRequestMessageProcessor\")\n+public class AddDeviceRequestMessageProcessor extends BaseNotificationMessageProcessor {\n+\n+    @Autowired\n+    @Qualifier(\"domainDistributionAutomationDeviceManagementService\")\n+    private DeviceManagementService deviceManagementService;\n+\n+    @Autowired\n+    public AddDeviceRequestMessageProcessor(final NotificationResponseMessageSender responseMessageSender,\n+            @Qualifier(\"domainDistributionAutomationInboundWebServiceRequestsMessageProcessorMap\") final MessageProcessorMap messageProcessorMap) {\n+        super(responseMessageSender, messageProcessorMap, MessageType.ADD_METER);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e92c53456e415b294bef8424d9e735f0801d4b7a"}, "originalPosition": 37}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNjE0MzY0OQ==", "bodyText": "addMeter?", "url": "https://github.com/OSGP/open-smart-grid-platform/pull/263#discussion_r406143649", "createdAt": "2020-04-09T11:39:01Z", "author": {"login": "smvdheijden"}, "path": "osgp/platform/osgp-adapter-domain-distributionautomation/src/main/java/org/opensmartgridplatform/adapter/domain/da/infra/jms/ws/messageprocessors/AddDeviceRequestMessageProcessor.java", "diffHunk": "@@ -0,0 +1,56 @@\n+/**\n+ * Copyright 2020 Smart Society Services B.V.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ * http://www.apache.org/licenses/LICENSE-2.0\n+ */\n+package org.opensmartgridplatform.adapter.domain.da.infra.jms.ws.messageprocessors;\n+\n+import javax.jms.JMSException;\n+import javax.jms.ObjectMessage;\n+\n+import org.opensmartgridplatform.adapter.domain.da.application.services.DeviceManagementService;\n+import org.opensmartgridplatform.domain.core.valueobjects.AddRtuDeviceRequest;\n+import org.opensmartgridplatform.shared.exceptionhandling.FunctionalException;\n+import org.opensmartgridplatform.shared.infra.jms.BaseNotificationMessageProcessor;\n+import org.opensmartgridplatform.shared.infra.jms.DeviceMessageMetadata;\n+import org.opensmartgridplatform.shared.infra.jms.MessageProcessorMap;\n+import org.opensmartgridplatform.shared.infra.jms.MessageType;\n+import org.opensmartgridplatform.shared.infra.jms.NotificationResponseMessageSender;\n+import org.springframework.beans.factory.annotation.Autowired;\n+import org.springframework.beans.factory.annotation.Qualifier;\n+import org.springframework.stereotype.Component;\n+\n+@Component(\"domainDistributionAutomationAddDeviceRequestMessageProcessor\")\n+public class AddDeviceRequestMessageProcessor extends BaseNotificationMessageProcessor {\n+\n+    @Autowired\n+    @Qualifier(\"domainDistributionAutomationDeviceManagementService\")\n+    private DeviceManagementService deviceManagementService;\n+\n+    @Autowired\n+    public AddDeviceRequestMessageProcessor(final NotificationResponseMessageSender responseMessageSender,\n+            @Qualifier(\"domainDistributionAutomationInboundWebServiceRequestsMessageProcessorMap\") final MessageProcessorMap messageProcessorMap) {\n+        super(responseMessageSender, messageProcessorMap, MessageType.ADD_METER);\n+    }\n+\n+    @Override\n+    public void processMessage(final ObjectMessage message) throws JMSException {\n+\n+        final DeviceMessageMetadata deviceMessageMetadata = new DeviceMessageMetadata(message);\n+\n+        final AddRtuDeviceRequest addRtuDeviceRequest = (AddRtuDeviceRequest) message.getObject();\n+\n+        try {\n+            this.deviceManagementService.addMeter(deviceMessageMetadata, addRtuDeviceRequest);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e92c53456e415b294bef8424d9e735f0801d4b7a"}, "originalPosition": 48}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNjE0NDMzOQ==", "bodyText": "ADD_METER?", "url": "https://github.com/OSGP/open-smart-grid-platform/pull/263#discussion_r406144339", "createdAt": "2020-04-09T11:40:31Z", "author": {"login": "smvdheijden"}, "path": "osgp/platform/osgp-adapter-ws-distributionautomation/src/main/java/org/opensmartgridplatform/adapter/ws/da/application/services/DistributionAutomationService.java", "diffHunk": "@@ -137,6 +139,34 @@ public MeasurementReport dequeueMeasurementReport(final String correlationUid) t\n         return (MeasurementReport) this.processResponse(correlationUid);\n     }\n \n+    public ResponseData dequeueResponseData(final String correlationUid) throws OsgpException {\n+        LOGGER.debug(\"dequeueResponseData called with correlation uid {}\", correlationUid);\n+        return (ResponseData) this.processResponse(correlationUid);\n+    }\n+\n+    public String enqueueAddRtuDeviceRequest(@Identification final String organisationIdentification,\n+            @Identification final String deviceIdentification, final AddRtuDeviceRequest addRtuDeviceRequest)\n+            throws OsgpException {\n+\n+        LOGGER.debug(\"enqueueAddRtuDeviceRequest called with organisation {} and device {}\", organisationIdentification,\n+                deviceIdentification);\n+\n+        final String correlationUid = this.correlationIdProviderService.getCorrelationId(organisationIdentification,\n+                deviceIdentification);\n+\n+        final DistributionAutomationRequestMessage message = new DistributionAutomationRequestMessage(\n+                MessageType.ADD_METER, correlationUid, organisationIdentification, deviceIdentification,", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e92c53456e415b294bef8424d9e735f0801d4b7a"}, "originalPosition": 41}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNjE0NTg3Mg==", "bodyText": "Build de -> Build the", "url": "https://github.com/OSGP/open-smart-grid-platform/pull/263#discussion_r406145872", "createdAt": "2020-04-09T11:43:38Z", "author": {"login": "smvdheijden"}, "path": "osgp/protocol-adapter-mqtt/README.md", "diffHunk": "@@ -4,28 +4,26 @@ To run a demonstration follow the steps below.\n \n Build de following modules:", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e92c53456e415b294bef8424d9e735f0801d4b7a"}, "originalPosition": 2}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNjE1MDQxMg==", "bodyText": "Why 17? I believe other device identification fields have a length of 40?", "url": "https://github.com/OSGP/open-smart-grid-platform/pull/263#discussion_r406150412", "createdAt": "2020-04-09T11:53:05Z", "author": {"login": "smvdheijden"}, "path": "osgp/shared/osgp-ws-distributionautomation/src/main/resources/schemas/common.xsd", "diffHunk": "@@ -18,6 +18,18 @@\n     </xsd:restriction>\n   </xsd:simpleType>\n \n+  <xsd:simpleType name=\"DeviceIdentification\">\n+    <xsd:restriction base=\"tns:AlphaNumericType\">\n+      <xsd:length value=\"17\" />", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e92c53456e415b294bef8424d9e735f0801d4b7a"}, "originalPosition": 6}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNjE1MjY4MA==", "bodyText": "minOccurs=\"0\" makes it an optional field, shouldn't the device identification always be set?\nSame applies to protocol name, protocol version and network address...", "url": "https://github.com/OSGP/open-smart-grid-platform/pull/263#discussion_r406152680", "createdAt": "2020-04-09T11:57:38Z", "author": {"login": "smvdheijden"}, "path": "osgp/shared/osgp-ws-distributionautomation/src/main/resources/schemas/distributionautomation.xsd", "diffHunk": "@@ -187,6 +187,62 @@\n         </xsd:complexContent>\n     </xsd:complexType>\n \n+\n+    <!--\n+    Types for device management\n+    -->\n+\n+    <xsd:complexType name=\"RtuDevice\">\n+        <xsd:sequence>\n+            <xsd:element name=\"Device_Identification\" minOccurs=\"0\" type=\"common:DeviceIdentification\" />", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNTY1MTg5MQ=="}, "originalCommit": {"oid": "e92c53456e415b294bef8424d9e735f0801d4b7a"}, "originalPosition": 33}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "477327c07eca6c5f4658f85f867e5220fa586a98", "author": {"user": {"login": "kevinsmeets", "name": "Kevin Smeets"}}, "url": "https://github.com/OSGP/open-smart-grid-platform/commit/477327c07eca6c5f4658f85f867e5220fa586a98", "committedDate": "2020-05-05T20:32:07Z", "message": "OC-537 ~ Processes review comments."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDA2MzgyNDM1", "url": "https://github.com/OSGP/open-smart-grid-platform/pull/263#pullrequestreview-406382435", "createdAt": "2020-05-06T08:01:33Z", "commit": {"oid": "477327c07eca6c5f4658f85f867e5220fa586a98"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wNlQwODowMTozM1rOGRIAug==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wNlQwODoxMzo1MVrOGRIYkQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMDYxMDIzNA==", "bodyText": "Update end tag to match start tag.", "url": "https://github.com/OSGP/open-smart-grid-platform/pull/263#discussion_r420610234", "createdAt": "2020-05-06T08:01:33Z", "author": {"login": "smvdheijden"}, "path": "osgp/protocol-adapter-mqtt/osgp-protocol-simulator-mqtt/README.md", "diffHunk": "@@ -68,10 +68,10 @@ A test request could look like this:\n    <soapenv:Body>\n       <ns:AddRtuDeviceRequest>\n          <ns:RtuDevice>\n-            <ns:Device_Identification>TST-01</ns:Device_Identification>\n-            <ns:protocolName>MQTT</ns:protocolName>\n-            <ns:protocolVersion>3</ns:protocolVersion>\n-            <ns:Network_Address>127.0.0.1</ns:Network_Address> \n+            <ns:DeviceIdentification>TST-01</ns:Device_Identification>", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "477327c07eca6c5f4658f85f867e5220fa586a98"}, "originalPosition": 8}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMDYxMDgzOA==", "bodyText": "Devicetype SSLD?", "url": "https://github.com/OSGP/open-smart-grid-platform/pull/263#discussion_r420610838", "createdAt": "2020-05-06T08:02:52Z", "author": {"login": "smvdheijden"}, "path": "osgp/protocol-adapter-mqtt/osgp-protocol-simulator-mqtt/README.md", "diffHunk": "@@ -82,4 +82,51 @@ A test request could look like this:\n </soapenv:Envelope>\n ```\n \n-The RtuDevice will be inserted in the osgp-core database and picked up by the communication monitoring task.\n\\ No newline at end of file\n+The RtuDevice will be inserted in the osgp-core database and picked up by the communication monitoring task.\n+\n+## Add MQTT RTU Device in the DB\n+Alternative way to add RTU device.\n+\n+```\n+INSERT INTO public.protocol_info(\n+            creation_time, modification_time, version, protocol, protocol_version, \n+            outgoing_requests_property_prefix, incoming_responses_property_prefix, \n+            incoming_requests_property_prefix, outgoing_responses_property_prefix, \n+            parallel_requests_allowed)\n+    VALUES ('2020-02-24 00:00:00', '2020-02-24 00:00:00', 0, 'MQTT', '3', \n+    'jms.protocol.mqtt.outgoing.requests', 'jms.protocol.mqtt.incoming.responses',\n+    'jms.protocol.mqtt.incoming.requests', 'jms.protocol.mqtt.outgoing.responses',TRUE\n+    );\n+```\n+protocol_info.id is auto generated\n+\n+```    \n+INSERT INTO public.device(\n+            creation_time, modification_time, version, device_identification, \n+            device_type, is_activated,                 \n+            protocol_info_id, network_address,  \n+            in_maintenance, technical_installation_date, \n+            device_model, device_lifecycle_status)\n+    VALUES ('2020-01-01 12:34', '2020-01-01 12:34', 0, 'TST-1', \n+\t    'SSLD', true, ", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "477327c07eca6c5f4658f85f867e5220fa586a98"}, "originalPosition": 47}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMDYxMTcxMQ==", "bodyText": "I would prefer something like NOW() over a fixed datetime.\nSame applies to SQL statements below.", "url": "https://github.com/OSGP/open-smart-grid-platform/pull/263#discussion_r420611711", "createdAt": "2020-05-06T08:04:32Z", "author": {"login": "smvdheijden"}, "path": "osgp/protocol-adapter-mqtt/osgp-protocol-simulator-mqtt/README.md", "diffHunk": "@@ -82,4 +82,51 @@ A test request could look like this:\n </soapenv:Envelope>\n ```\n \n-The RtuDevice will be inserted in the osgp-core database and picked up by the communication monitoring task.\n\\ No newline at end of file\n+The RtuDevice will be inserted in the osgp-core database and picked up by the communication monitoring task.\n+\n+## Add MQTT RTU Device in the DB\n+Alternative way to add RTU device.\n+\n+```\n+INSERT INTO public.protocol_info(\n+            creation_time, modification_time, version, protocol, protocol_version, \n+            outgoing_requests_property_prefix, incoming_responses_property_prefix, \n+            incoming_requests_property_prefix, outgoing_responses_property_prefix, \n+            parallel_requests_allowed)\n+    VALUES ('2020-02-24 00:00:00', '2020-02-24 00:00:00', 0, 'MQTT', '3', \n+    'jms.protocol.mqtt.outgoing.requests', 'jms.protocol.mqtt.incoming.responses',\n+    'jms.protocol.mqtt.incoming.requests', 'jms.protocol.mqtt.outgoing.responses',TRUE\n+    );\n+```\n+protocol_info.id is auto generated\n+\n+```    \n+INSERT INTO public.device(\n+            creation_time, modification_time, version, device_identification, \n+            device_type, is_activated,                 \n+            protocol_info_id, network_address,  \n+            in_maintenance, technical_installation_date, \n+            device_model, device_lifecycle_status)\n+    VALUES ('2020-01-01 12:34', '2020-01-01 12:34', 0, 'TST-1', ", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "477327c07eca6c5f4658f85f867e5220fa586a98"}, "originalPosition": 46}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMDYxNTIzNA==", "bodyText": "Is model code a required field for the RTU devices? Do we already have a model code available for these kind of devices?", "url": "https://github.com/OSGP/open-smart-grid-platform/pull/263#discussion_r420615234", "createdAt": "2020-05-06T08:11:41Z", "author": {"login": "smvdheijden"}, "path": "osgp/shared/osgp-ws-distributionautomation/src/main/resources/schemas/distributionautomation.xsd", "diffHunk": "@@ -233,7 +233,7 @@\n                     </xsd:restriction>\n                 </xsd:simpleType>\n             </xsd:element>\n-            <xsd:element name=\"ModelCode\" minOccurs=\"0\" maxOccurs=\"1\">\n+            <xsd:element name=\"ModelCode\" minOccurs=\"1\">", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "477327c07eca6c5f4658f85f867e5220fa586a98"}, "originalPosition": 35}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMDYxNjMzNw==", "bodyText": "For now this will probably sufficient, but I think we should have a look at how to handle all different kind of RTU device types in the future.", "url": "https://github.com/OSGP/open-smart-grid-platform/pull/263#discussion_r420616337", "createdAt": "2020-05-06T08:13:51Z", "author": {"login": "smvdheijden"}, "path": "osgp/platform/osgp-domain-core/src/main/java/org/opensmartgridplatform/domain/core/valueobjects/RtuDevice.java", "diffHunk": "@@ -14,6 +14,11 @@\n \n     private static final long serialVersionUID = -6133164707489276802L;\n \n+    /**\n+     * Device type indicator for Peak Shaving Device\n+     */\n+    public static final String PSD_TYPE = \"PSD\";", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "477327c07eca6c5f4658f85f867e5220fa586a98"}, "originalPosition": 7}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b894560229fca703a1e108456ffe5b124867e6be", "author": {"user": {"login": "kevinsmeets", "name": "Kevin Smeets"}}, "url": "https://github.com/OSGP/open-smart-grid-platform/commit/b894560229fca703a1e108456ffe5b124867e6be", "committedDate": "2020-05-06T11:54:51Z", "message": "OC-537 ~ Processes review comments."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDA2NjQ4NDY3", "url": "https://github.com/OSGP/open-smart-grid-platform/pull/263#pullrequestreview-406648467", "createdAt": "2020-05-06T14:06:54Z", "commit": {"oid": "b894560229fca703a1e108456ffe5b124867e6be"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3846, "cost": 1, "resetAt": "2021-11-01T16:19:10Z"}}}