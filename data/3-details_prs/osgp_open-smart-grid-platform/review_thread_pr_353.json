{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDM0NTMxNzI5", "number": 353, "reviewThreads": {"totalCount": 7, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xNlQxMjo1NTo0N1rOEF7K3w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xNlQxMjo1OTozNVrOEF7Qag==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjc0NjQ3Nzc1OnYy", "diffSide": "RIGHT", "path": "osgp/platform/osgp-adapter-kafka-logging/src/main/java/org/opensmartgridplatform/adapter/kafka/logging/config/DistributionAutomationLoggingEnabled.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xNlQxMjo1NTo0N1rOGkZ80w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xNlQxNDowMTozM1rOGkc4Uw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MDgyNzA5MQ==", "bodyText": "this file can be removed", "url": "https://github.com/OSGP/open-smart-grid-platform/pull/353#discussion_r440827091", "createdAt": "2020-06-16T12:55:47Z", "author": {"login": "robindenadel"}, "path": "osgp/platform/osgp-adapter-kafka-logging/src/main/java/org/opensmartgridplatform/adapter/kafka/logging/config/DistributionAutomationLoggingEnabled.java", "diffHunk": "@@ -0,0 +1,22 @@\n+/**", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f70e988183faf10635bf2dd292b2446dcd4d53a6"}, "originalPosition": 1}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MDg3NTA5MQ==", "bodyText": "removed", "url": "https://github.com/OSGP/open-smart-grid-platform/pull/353#discussion_r440875091", "createdAt": "2020-06-16T14:01:33Z", "author": {"login": "bvdzwet"}, "path": "osgp/platform/osgp-adapter-kafka-logging/src/main/java/org/opensmartgridplatform/adapter/kafka/logging/config/DistributionAutomationLoggingEnabled.java", "diffHunk": "@@ -0,0 +1,22 @@\n+/**", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MDgyNzA5MQ=="}, "originalCommit": {"oid": "f70e988183faf10635bf2dd292b2446dcd4d53a6"}, "originalPosition": 1}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjc0NjQ3OTE0OnYy", "diffSide": "RIGHT", "path": "osgp/platform/osgp-adapter-kafka-logging/src/main/java/org/opensmartgridplatform/adapter/kafka/logging/config/KafkaDistributionAutomationConsumerConfig.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xNlQxMjo1NjowNlrOGkZ9rQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xNlQxNDowMToxN1rOGkc3nQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MDgyNzMwOQ==", "bodyText": "this file can be removed", "url": "https://github.com/OSGP/open-smart-grid-platform/pull/353#discussion_r440827309", "createdAt": "2020-06-16T12:56:06Z", "author": {"login": "robindenadel"}, "path": "osgp/platform/osgp-adapter-kafka-logging/src/main/java/org/opensmartgridplatform/adapter/kafka/logging/config/KafkaDistributionAutomationConsumerConfig.java", "diffHunk": "@@ -0,0 +1,45 @@\n+/**", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f70e988183faf10635bf2dd292b2446dcd4d53a6"}, "originalPosition": 1}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MDg3NDkwOQ==", "bodyText": "removed", "url": "https://github.com/OSGP/open-smart-grid-platform/pull/353#discussion_r440874909", "createdAt": "2020-06-16T14:01:17Z", "author": {"login": "bvdzwet"}, "path": "osgp/platform/osgp-adapter-kafka-logging/src/main/java/org/opensmartgridplatform/adapter/kafka/logging/config/KafkaDistributionAutomationConsumerConfig.java", "diffHunk": "@@ -0,0 +1,45 @@\n+/**", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MDgyNzMwOQ=="}, "originalCommit": {"oid": "f70e988183faf10635bf2dd292b2446dcd4d53a6"}, "originalPosition": 1}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjc0NjQ4MDM3OnYy", "diffSide": "RIGHT", "path": "osgp/platform/osgp-adapter-kafka-logging/src/main/java/org/opensmartgridplatform/adapter/kafka/logging/infra/kafka/in/MeterReadingConsumer.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xNlQxMjo1NjoyNVrOGkZ-aw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xNlQxNDowMjoxOFrOGkc6aA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MDgyNzQ5OQ==", "bodyText": "this file can be removed", "url": "https://github.com/OSGP/open-smart-grid-platform/pull/353#discussion_r440827499", "createdAt": "2020-06-16T12:56:25Z", "author": {"login": "robindenadel"}, "path": "osgp/platform/osgp-adapter-kafka-logging/src/main/java/org/opensmartgridplatform/adapter/kafka/logging/infra/kafka/in/MeterReadingConsumer.java", "diffHunk": "@@ -0,0 +1,32 @@\n+/**", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f70e988183faf10635bf2dd292b2446dcd4d53a6"}, "originalPosition": 1}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MDg3NTYyNA==", "bodyText": "removed", "url": "https://github.com/OSGP/open-smart-grid-platform/pull/353#discussion_r440875624", "createdAt": "2020-06-16T14:02:18Z", "author": {"login": "bvdzwet"}, "path": "osgp/platform/osgp-adapter-kafka-logging/src/main/java/org/opensmartgridplatform/adapter/kafka/logging/infra/kafka/in/MeterReadingConsumer.java", "diffHunk": "@@ -0,0 +1,32 @@\n+/**", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MDgyNzQ5OQ=="}, "originalCommit": {"oid": "f70e988183faf10635bf2dd292b2446dcd4d53a6"}, "originalPosition": 1}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjc0NjQ4MjY4OnYy", "diffSide": "RIGHT", "path": "osgp/platform/osgp-adapter-kafka-logging/src/main/resources/osgp-adapter-kafka-logging.properties", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xNlQxMjo1NzowMlrOGkZ_4A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xNlQxNDowMzoxMVrOGkc82g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MDgyNzg3Mg==", "bodyText": "this section can be removed", "url": "https://github.com/OSGP/open-smart-grid-platform/pull/353#discussion_r440827872", "createdAt": "2020-06-16T12:57:02Z", "author": {"login": "robindenadel"}, "path": "osgp/platform/osgp-adapter-kafka-logging/src/main/resources/osgp-adapter-kafka-logging.properties", "diffHunk": "@@ -0,0 +1,35 @@\n+# =========================================================\n+# KAFKA CONFIG DISTRIBUTIONAUTOMATION LOGGING CONSUMER\n+# =========================================================\n+\n+distributionautomation.kafka.logging.enabled=false\n+\n+distributionautomation.kafka.common.properties.prefix=distributionautomation.kafka\n+distributionautomation.kafka.bootstrap.servers=localhost:9092\n+distributionautomation.kafka.topic=g_osgp_distributionautomation_monitoring_dev\n+\n+distributionautomation.kafka.consumer.key.deserializer=org.apache.kafka.common.serialization.StringDeserializer\n+distributionautomation.kafka.consumer.value.deserializer=org.opensmartgridplatform.adapter.kafka.da.serialization.MeterReadingDeserializer\n+distributionautomation.kafka.consumer.group.id=DistributionAutomationLoggingConsumer\n+distributionautomation.kafka.consumer.enable.auto.commit=true\n+distributionautomation.kafka.consumer.poll.timeout=3000\n+distributionautomation.kafka.consumer.concurrency=1\n+distributionautomation.kafka.consumer.auto.offset.reset=latest\n+", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f70e988183faf10635bf2dd292b2446dcd4d53a6"}, "originalPosition": 18}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MDg3NjI1MA==", "bodyText": "removed", "url": "https://github.com/OSGP/open-smart-grid-platform/pull/353#discussion_r440876250", "createdAt": "2020-06-16T14:03:11Z", "author": {"login": "bvdzwet"}, "path": "osgp/platform/osgp-adapter-kafka-logging/src/main/resources/osgp-adapter-kafka-logging.properties", "diffHunk": "@@ -0,0 +1,35 @@\n+# =========================================================\n+# KAFKA CONFIG DISTRIBUTIONAUTOMATION LOGGING CONSUMER\n+# =========================================================\n+\n+distributionautomation.kafka.logging.enabled=false\n+\n+distributionautomation.kafka.common.properties.prefix=distributionautomation.kafka\n+distributionautomation.kafka.bootstrap.servers=localhost:9092\n+distributionautomation.kafka.topic=g_osgp_distributionautomation_monitoring_dev\n+\n+distributionautomation.kafka.consumer.key.deserializer=org.apache.kafka.common.serialization.StringDeserializer\n+distributionautomation.kafka.consumer.value.deserializer=org.opensmartgridplatform.adapter.kafka.da.serialization.MeterReadingDeserializer\n+distributionautomation.kafka.consumer.group.id=DistributionAutomationLoggingConsumer\n+distributionautomation.kafka.consumer.enable.auto.commit=true\n+distributionautomation.kafka.consumer.poll.timeout=3000\n+distributionautomation.kafka.consumer.concurrency=1\n+distributionautomation.kafka.consumer.auto.offset.reset=latest\n+", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MDgyNzg3Mg=="}, "originalCommit": {"oid": "f70e988183faf10635bf2dd292b2446dcd4d53a6"}, "originalPosition": 18}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjc0NjQ4NDk3OnYy", "diffSide": "RIGHT", "path": "osgp/platform/osgp-adapter-kafka-logging/src/test/java/org/opensmartgridplatform/adapter/kafka/logging/infra/kafka/in/MeterReadingConsumerTest.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xNlQxMjo1Nzo0MFrOGkaBYw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xNlQxNDowNDoxNlrOGkc_uQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MDgyODI1OQ==", "bodyText": "this file can be removed", "url": "https://github.com/OSGP/open-smart-grid-platform/pull/353#discussion_r440828259", "createdAt": "2020-06-16T12:57:40Z", "author": {"login": "robindenadel"}, "path": "osgp/platform/osgp-adapter-kafka-logging/src/test/java/org/opensmartgridplatform/adapter/kafka/logging/infra/kafka/in/MeterReadingConsumerTest.java", "diffHunk": "@@ -0,0 +1,148 @@\n+/**", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f70e988183faf10635bf2dd292b2446dcd4d53a6"}, "originalPosition": 1}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MDg3Njk4NQ==", "bodyText": "removed", "url": "https://github.com/OSGP/open-smart-grid-platform/pull/353#discussion_r440876985", "createdAt": "2020-06-16T14:04:16Z", "author": {"login": "bvdzwet"}, "path": "osgp/platform/osgp-adapter-kafka-logging/src/test/java/org/opensmartgridplatform/adapter/kafka/logging/infra/kafka/in/MeterReadingConsumerTest.java", "diffHunk": "@@ -0,0 +1,148 @@\n+/**", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MDgyODI1OQ=="}, "originalCommit": {"oid": "f70e988183faf10635bf2dd292b2446dcd4d53a6"}, "originalPosition": 1}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjc0NjQ4OTA3OnYy", "diffSide": "RIGHT", "path": "osgp/platform/osgp-adapter-kafka-logging/src/test/java/org/opensmartgridplatform/adapter/kafka/logging/infra/kafka/in/PeakShavingConsumerTest.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xNlQxMjo1ODo0NlrOGkaD6w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xNlQxMjo1ODo0NlrOGkaD6w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MDgyODkwNw==", "bodyText": "very nice!", "url": "https://github.com/OSGP/open-smart-grid-platform/pull/353#discussion_r440828907", "createdAt": "2020-06-16T12:58:46Z", "author": {"login": "robindenadel"}, "path": "osgp/platform/osgp-adapter-kafka-logging/src/test/java/org/opensmartgridplatform/adapter/kafka/logging/infra/kafka/in/PeakShavingConsumerTest.java", "diffHunk": "@@ -0,0 +1,109 @@\n+/**\n+ * Copyright 2020 Smart Society Services B.V.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\"); you may not use this file except in compliance with the License.  You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ */\n+package org.opensmartgridplatform.adapter.kafka.logging.infra.kafka.in;\n+\n+import static org.assertj.core.api.Assertions.assertThat;\n+\n+import java.time.LocalDateTime;\n+import java.util.Map;\n+import java.util.concurrent.CountDownLatch;\n+import java.util.concurrent.TimeUnit;\n+\n+import org.apache.kafka.common.serialization.StringSerializer;\n+import org.junit.jupiter.api.Test;\n+import org.opensmartgridplatform.adapter.kafka.logging.config.ApplicationContext;\n+import org.opensmartgridplatform.adapter.kafka.logging.config.PeakShavingLoggingEnabled;\n+import org.opensmartgridplatform.adapter.kafka.logging.infra.kafka.in.PeakShavingConsumerTest.TestConfig;\n+import org.opensmartgridplatform.kafka.logging.CountDownKafkaLogger;\n+import org.opensmartgridplatform.kafka.logging.KafkaLogger;\n+import org.springframework.beans.factory.annotation.Autowired;\n+import org.springframework.beans.factory.annotation.Value;\n+import org.springframework.context.annotation.Bean;\n+import org.springframework.context.annotation.Conditional;\n+import org.springframework.context.annotation.Configuration;\n+import org.springframework.context.annotation.Import;\n+import org.springframework.kafka.core.DefaultKafkaProducerFactory;\n+import org.springframework.kafka.core.KafkaTemplate;\n+import org.springframework.kafka.core.ProducerFactory;\n+import org.springframework.kafka.test.EmbeddedKafkaBroker;\n+import org.springframework.kafka.test.context.EmbeddedKafka;\n+import org.springframework.kafka.test.utils.KafkaTestUtils;\n+import org.springframework.test.annotation.DirtiesContext;\n+import org.springframework.test.context.TestPropertySource;\n+import org.springframework.test.context.junit.jupiter.SpringJUnitConfig;\n+\n+@SpringJUnitConfig(TestConfig.class)\n+@TestPropertySource(\"classpath:osgp-adapter-kafka-logging-test-peakshaving.properties\")\n+@EmbeddedKafka(partitions = 1,\n+        topics = { \"${peakshaving.kafka.topic}\" },\n+        brokerProperties = { \"listeners=PLAINTEXT://${peakshaving.kafka.bootstrap.servers}\",\n+                \"log.dirs=target/kafka-logs-peakshaving\", \"auto.create.topics.enable=true\" })\n+@DirtiesContext\n+public class PeakShavingConsumerTest {\n+\n+    /**\n+     * Spring test context configuration setting up the CountDownKafkaLogger to\n+     * be used to verify sending peak shaving data leads to it being logged.\n+     *\n+     * @see CountDownKafkaLogger\n+     */\n+    @Configuration\n+    @Import(ApplicationContext.class)\n+    @Conditional(PeakShavingLoggingEnabled.class)\n+    public static class TestConfig {\n+\n+        @Bean\n+        public CountDownLatch countDownLatch() {\n+            return new CountDownLatch(1);\n+        }\n+\n+        @Bean\n+        public KafkaLogger kafkaLogger(final CountDownLatch countDownLatch, final String peakShavingData) {\n+            return new CountDownKafkaLogger(countDownLatch, peakShavingData);\n+        }\n+\n+        @Bean\n+        public String peakShavingData() {\n+            return \"TST-01; 220.1; 220.2; 220.3; 5.1; 5.2; 5.3; 7.1; 7.2; 7.3;\";\n+        }\n+    }\n+\n+    @Value(\"${peakshaving.kafka.topic}\")\n+    private String topic;\n+\n+    @Autowired\n+    private CountDownLatch countDownLatch;\n+\n+    @Autowired\n+    private String peakShavingData;\n+\n+    @Autowired\n+    private EmbeddedKafkaBroker broker;\n+\n+    @Test\n+    void logsMessagesPostedToThePeakShavingTopic() throws Exception {\n+        this.whenPeakShavingDataIsSentToTheTopic();\n+        this.theKafkaLoggerLogsThePeakShavingData();\n+    }", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f70e988183faf10635bf2dd292b2446dcd4d53a6"}, "originalPosition": 92}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjc0NjQ5MTk0OnYy", "diffSide": "RIGHT", "path": "osgp/platform/osgp-adapter-kafka-logging/src/test/resources/osgp-adapter-kafka-logging-test-distributionautomation.properties", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xNlQxMjo1OTozNVrOGkaF3A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xNlQxNDowNTowMlrOGkdBxA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MDgyOTQwNA==", "bodyText": "this file can be removed", "url": "https://github.com/OSGP/open-smart-grid-platform/pull/353#discussion_r440829404", "createdAt": "2020-06-16T12:59:35Z", "author": {"login": "robindenadel"}, "path": "osgp/platform/osgp-adapter-kafka-logging/src/test/resources/osgp-adapter-kafka-logging-test-distributionautomation.properties", "diffHunk": "@@ -0,0 +1,9 @@\n+# =========================================================", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f70e988183faf10635bf2dd292b2446dcd4d53a6"}, "originalPosition": 1}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MDg3NzUwOA==", "bodyText": "removed", "url": "https://github.com/OSGP/open-smart-grid-platform/pull/353#discussion_r440877508", "createdAt": "2020-06-16T14:05:02Z", "author": {"login": "bvdzwet"}, "path": "osgp/platform/osgp-adapter-kafka-logging/src/test/resources/osgp-adapter-kafka-logging-test-distributionautomation.properties", "diffHunk": "@@ -0,0 +1,9 @@\n+# =========================================================", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MDgyOTQwNA=="}, "originalCommit": {"oid": "f70e988183faf10635bf2dd292b2446dcd4d53a6"}, "originalPosition": 1}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3614, "cost": 1, "resetAt": "2021-11-12T12:57:47Z"}}}