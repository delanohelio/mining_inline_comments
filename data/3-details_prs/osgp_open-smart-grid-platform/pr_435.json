{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDk0NjA2NTM5", "number": 435, "title": "Code quality/increase coverage of device management service", "bodyText": "", "createdAt": "2020-09-29T07:02:49Z", "url": "https://github.com/OSGP/open-smart-grid-platform/pull/435", "merged": true, "mergeCommit": {"oid": "f9ba4d80ac81b91a667a3250073f8a396c8ab8f3"}, "closed": true, "closedAt": "2020-11-26T07:46:00Z", "author": {"login": "MithraicMagic"}, "timelineItems": {"totalCount": 12, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdLTPG5AH2gAyNDk0NjA2NTM5OjJlYmVmM2MxNDNhMGFlZThhYzdmNzgzMWJiZjJkZTIyZjAxYjZiNGY=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdgOD-7AFqTUzOTA1ODkzNA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "2ebef3c143a0aee8ac7f7831bbf2de22f01b6b4f", "author": {"user": {"login": "MithraicMagic", "name": "Nick Walraven"}}, "url": "https://github.com/OSGP/open-smart-grid-platform/commit/2ebef3c143a0aee8ac7f7831bbf2de22f01b6b4f", "committedDate": "2020-09-22T07:55:06Z", "message": "Added tests for the DeviceManagementService class\n\nIncreased coverage to 100%"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "6370dfb388a411a4cca050e131eaa048d19bb432", "author": {"user": {"login": "MithraicMagic", "name": "Nick Walraven"}}, "url": "https://github.com/OSGP/open-smart-grid-platform/commit/6370dfb388a411a4cca050e131eaa048d19bb432", "committedDate": "2020-09-24T13:52:47Z", "message": "- Using AssertJ\n- Rewrote all tests to verify parameters better"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "0ad2c7ec342bfc7c3ab13d9ff43d93c21a0cb1c0", "author": {"user": {"login": "MithraicMagic", "name": "Nick Walraven"}}, "url": "https://github.com/OSGP/open-smart-grid-platform/commit/0ad2c7ec342bfc7c3ab13d9ff43d93c21a0cb1c0", "committedDate": "2020-09-24T13:59:50Z", "message": "- verify(never()) -> verifyNoInteractions()"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c3900672f9c686e691bffcbe9a2e055044e2c22e", "author": {"user": {"login": "MithraicMagic", "name": "Nick Walraven"}}, "url": "https://github.com/OSGP/open-smart-grid-platform/commit/c3900672f9c686e691bffcbe9a2e055044e2c22e", "committedDate": "2020-09-24T14:24:16Z", "message": "- Added variables of expected Response- and RequestMessages instead of inline variables."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTAyNjgxNzMx", "url": "https://github.com/OSGP/open-smart-grid-platform/pull/435#pullrequestreview-502681731", "createdAt": "2020-10-06T08:05:17Z", "commit": {"oid": "c3900672f9c686e691bffcbe9a2e055044e2c22e"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "042bc2f3426827e05795a38d7afd4c2be234dc35", "author": {"user": {"login": "MithraicMagic", "name": "Nick Walraven"}}, "url": "https://github.com/OSGP/open-smart-grid-platform/commit/042bc2f3426827e05795a38d7afd4c2be234dc35", "committedDate": "2020-10-08T08:35:59Z", "message": "- Fixed NullPointer Exceptions"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTA2MzI5ODM1", "url": "https://github.com/OSGP/open-smart-grid-platform/pull/435#pullrequestreview-506329835", "createdAt": "2020-10-12T06:41:28Z", "commit": {"oid": "042bc2f3426827e05795a38d7afd4c2be234dc35"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 9, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xMlQwNjo0MToyOVrOHfw53g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xMlQwNjo0OTowMFrOHfxFKQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMzA2OTE1MA==", "bodyText": "add licence header", "url": "https://github.com/OSGP/open-smart-grid-platform/pull/435#discussion_r503069150", "createdAt": "2020-10-12T06:41:29Z", "author": {"login": "robindenadel"}, "path": "osgp/platform/osgp-adapter-domain-core/src/test/java/org/opensmartgridplatform/adapter/domain/core/application/services/DeviceManagementServiceTest.java", "diffHunk": "@@ -0,0 +1,217 @@\n+package org.opensmartgridplatform.adapter.domain.core.application.services;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "042bc2f3426827e05795a38d7afd4c2be234dc35"}, "originalPosition": 1}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMzA2OTYxOQ==", "bodyText": "Remove this line", "url": "https://github.com/OSGP/open-smart-grid-platform/pull/435#discussion_r503069619", "createdAt": "2020-10-12T06:42:33Z", "author": {"login": "robindenadel"}, "path": "osgp/platform/osgp-adapter-domain-core/src/test/java/org/opensmartgridplatform/adapter/domain/core/application/services/DeviceManagementServiceTest.java", "diffHunk": "@@ -0,0 +1,217 @@\n+package org.opensmartgridplatform.adapter.domain.core.application.services;\n+\n+import static org.assertj.core.api.Assertions.assertThat;\n+import static org.mockito.ArgumentMatchers.any;\n+import static org.mockito.Mockito.mock;\n+import static org.mockito.Mockito.verify;\n+import static org.mockito.Mockito.verifyNoInteractions;\n+import static org.mockito.Mockito.when;\n+\n+import java.util.Arrays;\n+import java.util.List;\n+\n+import org.junit.jupiter.api.BeforeEach;\n+import org.junit.jupiter.api.Test;\n+import org.junit.jupiter.api.extension.ExtendWith;\n+import org.mockito.ArgumentCaptor;\n+import org.mockito.Captor;\n+import org.mockito.InjectMocks;\n+import org.mockito.Mock;\n+import org.mockito.junit.jupiter.MockitoExtension;\n+import org.mockito.junit.jupiter.MockitoSettings;\n+import org.mockito.quality.Strictness;\n+import org.opensmartgridplatform.adapter.domain.core.application.mapping.DomainCoreMapper;\n+import org.opensmartgridplatform.adapter.domain.core.infra.jms.core.OsgpCoreRequestMessageSender;\n+import org.opensmartgridplatform.adapter.domain.core.infra.jms.ws.WebServiceResponseMessageSender;\n+import org.opensmartgridplatform.domain.core.entities.Device;\n+import org.opensmartgridplatform.domain.core.entities.Organisation;\n+import org.opensmartgridplatform.domain.core.exceptions.UnknownEntityException;\n+import org.opensmartgridplatform.domain.core.services.DeviceDomainService;\n+import org.opensmartgridplatform.domain.core.services.OrganisationDomainService;\n+import org.opensmartgridplatform.domain.core.valueobjects.CdmaSettings;\n+import org.opensmartgridplatform.domain.core.valueobjects.Certification;\n+import org.opensmartgridplatform.domain.core.valueobjects.DeviceLifecycleStatus;\n+import org.opensmartgridplatform.domain.core.valueobjects.EventNotificationType;\n+import org.opensmartgridplatform.dto.valueobjects.EventNotificationMessageDataContainerDto;\n+import org.opensmartgridplatform.shared.exceptionhandling.ComponentType;\n+import org.opensmartgridplatform.shared.exceptionhandling.FunctionalException;\n+import org.opensmartgridplatform.shared.infra.jms.RequestMessage;\n+import org.opensmartgridplatform.shared.infra.jms.ResponseMessage;\n+import org.opensmartgridplatform.shared.infra.jms.ResponseMessageResultType;\n+\n+@ExtendWith(MockitoExtension.class)\n+@MockitoSettings(strictness = Strictness.LENIENT)", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "042bc2f3426827e05795a38d7afd4c2be234dc35"}, "originalPosition": 43}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMzA2OTg2Mg==", "bodyText": "rename the field to argumentRequestMessage", "url": "https://github.com/OSGP/open-smart-grid-platform/pull/435#discussion_r503069862", "createdAt": "2020-10-12T06:43:18Z", "author": {"login": "robindenadel"}, "path": "osgp/platform/osgp-adapter-domain-core/src/test/java/org/opensmartgridplatform/adapter/domain/core/application/services/DeviceManagementServiceTest.java", "diffHunk": "@@ -0,0 +1,217 @@\n+package org.opensmartgridplatform.adapter.domain.core.application.services;\n+\n+import static org.assertj.core.api.Assertions.assertThat;\n+import static org.mockito.ArgumentMatchers.any;\n+import static org.mockito.Mockito.mock;\n+import static org.mockito.Mockito.verify;\n+import static org.mockito.Mockito.verifyNoInteractions;\n+import static org.mockito.Mockito.when;\n+\n+import java.util.Arrays;\n+import java.util.List;\n+\n+import org.junit.jupiter.api.BeforeEach;\n+import org.junit.jupiter.api.Test;\n+import org.junit.jupiter.api.extension.ExtendWith;\n+import org.mockito.ArgumentCaptor;\n+import org.mockito.Captor;\n+import org.mockito.InjectMocks;\n+import org.mockito.Mock;\n+import org.mockito.junit.jupiter.MockitoExtension;\n+import org.mockito.junit.jupiter.MockitoSettings;\n+import org.mockito.quality.Strictness;\n+import org.opensmartgridplatform.adapter.domain.core.application.mapping.DomainCoreMapper;\n+import org.opensmartgridplatform.adapter.domain.core.infra.jms.core.OsgpCoreRequestMessageSender;\n+import org.opensmartgridplatform.adapter.domain.core.infra.jms.ws.WebServiceResponseMessageSender;\n+import org.opensmartgridplatform.domain.core.entities.Device;\n+import org.opensmartgridplatform.domain.core.entities.Organisation;\n+import org.opensmartgridplatform.domain.core.exceptions.UnknownEntityException;\n+import org.opensmartgridplatform.domain.core.services.DeviceDomainService;\n+import org.opensmartgridplatform.domain.core.services.OrganisationDomainService;\n+import org.opensmartgridplatform.domain.core.valueobjects.CdmaSettings;\n+import org.opensmartgridplatform.domain.core.valueobjects.Certification;\n+import org.opensmartgridplatform.domain.core.valueobjects.DeviceLifecycleStatus;\n+import org.opensmartgridplatform.domain.core.valueobjects.EventNotificationType;\n+import org.opensmartgridplatform.dto.valueobjects.EventNotificationMessageDataContainerDto;\n+import org.opensmartgridplatform.shared.exceptionhandling.ComponentType;\n+import org.opensmartgridplatform.shared.exceptionhandling.FunctionalException;\n+import org.opensmartgridplatform.shared.infra.jms.RequestMessage;\n+import org.opensmartgridplatform.shared.infra.jms.ResponseMessage;\n+import org.opensmartgridplatform.shared.infra.jms.ResponseMessageResultType;\n+\n+@ExtendWith(MockitoExtension.class)\n+@MockitoSettings(strictness = Strictness.LENIENT)\n+public class DeviceManagementServiceTest {\n+\t\n+\t@Mock\n+\tprivate TransactionalDeviceService transactionalDeviceService;\n+\t\n+\t@Mock\n+\tprivate DeviceDomainService deviceDomainService;\n+\t\n+\t@Mock\n+\tprivate DomainCoreMapper domainCoreMapper;\n+\t\n+\t@Mock\n+\tprivate OsgpCoreRequestMessageSender osgpCoreRequestManager;\n+\t\n+\t@Mock\n+\tprivate WebServiceResponseMessageSender webServiceResponseMessageSender;\n+\n+\t@Mock\n+\tprivate OrganisationDomainService organisationDomainService;\n+\t\n+\t@InjectMocks\n+\tprivate DeviceManagementService deviceManagementService;\n+\n+\t@Captor\n+\tprivate ArgumentCaptor<RequestMessage> argumentReqM;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "042bc2f3426827e05795a38d7afd4c2be234dc35"}, "originalPosition": 68}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMzA2OTk0Nw==", "bodyText": "rename the field to argumentResponseMessage", "url": "https://github.com/OSGP/open-smart-grid-platform/pull/435#discussion_r503069947", "createdAt": "2020-10-12T06:43:31Z", "author": {"login": "robindenadel"}, "path": "osgp/platform/osgp-adapter-domain-core/src/test/java/org/opensmartgridplatform/adapter/domain/core/application/services/DeviceManagementServiceTest.java", "diffHunk": "@@ -0,0 +1,217 @@\n+package org.opensmartgridplatform.adapter.domain.core.application.services;\n+\n+import static org.assertj.core.api.Assertions.assertThat;\n+import static org.mockito.ArgumentMatchers.any;\n+import static org.mockito.Mockito.mock;\n+import static org.mockito.Mockito.verify;\n+import static org.mockito.Mockito.verifyNoInteractions;\n+import static org.mockito.Mockito.when;\n+\n+import java.util.Arrays;\n+import java.util.List;\n+\n+import org.junit.jupiter.api.BeforeEach;\n+import org.junit.jupiter.api.Test;\n+import org.junit.jupiter.api.extension.ExtendWith;\n+import org.mockito.ArgumentCaptor;\n+import org.mockito.Captor;\n+import org.mockito.InjectMocks;\n+import org.mockito.Mock;\n+import org.mockito.junit.jupiter.MockitoExtension;\n+import org.mockito.junit.jupiter.MockitoSettings;\n+import org.mockito.quality.Strictness;\n+import org.opensmartgridplatform.adapter.domain.core.application.mapping.DomainCoreMapper;\n+import org.opensmartgridplatform.adapter.domain.core.infra.jms.core.OsgpCoreRequestMessageSender;\n+import org.opensmartgridplatform.adapter.domain.core.infra.jms.ws.WebServiceResponseMessageSender;\n+import org.opensmartgridplatform.domain.core.entities.Device;\n+import org.opensmartgridplatform.domain.core.entities.Organisation;\n+import org.opensmartgridplatform.domain.core.exceptions.UnknownEntityException;\n+import org.opensmartgridplatform.domain.core.services.DeviceDomainService;\n+import org.opensmartgridplatform.domain.core.services.OrganisationDomainService;\n+import org.opensmartgridplatform.domain.core.valueobjects.CdmaSettings;\n+import org.opensmartgridplatform.domain.core.valueobjects.Certification;\n+import org.opensmartgridplatform.domain.core.valueobjects.DeviceLifecycleStatus;\n+import org.opensmartgridplatform.domain.core.valueobjects.EventNotificationType;\n+import org.opensmartgridplatform.dto.valueobjects.EventNotificationMessageDataContainerDto;\n+import org.opensmartgridplatform.shared.exceptionhandling.ComponentType;\n+import org.opensmartgridplatform.shared.exceptionhandling.FunctionalException;\n+import org.opensmartgridplatform.shared.infra.jms.RequestMessage;\n+import org.opensmartgridplatform.shared.infra.jms.ResponseMessage;\n+import org.opensmartgridplatform.shared.infra.jms.ResponseMessageResultType;\n+\n+@ExtendWith(MockitoExtension.class)\n+@MockitoSettings(strictness = Strictness.LENIENT)\n+public class DeviceManagementServiceTest {\n+\t\n+\t@Mock\n+\tprivate TransactionalDeviceService transactionalDeviceService;\n+\t\n+\t@Mock\n+\tprivate DeviceDomainService deviceDomainService;\n+\t\n+\t@Mock\n+\tprivate DomainCoreMapper domainCoreMapper;\n+\t\n+\t@Mock\n+\tprivate OsgpCoreRequestMessageSender osgpCoreRequestManager;\n+\t\n+\t@Mock\n+\tprivate WebServiceResponseMessageSender webServiceResponseMessageSender;\n+\n+\t@Mock\n+\tprivate OrganisationDomainService organisationDomainService;\n+\t\n+\t@InjectMocks\n+\tprivate DeviceManagementService deviceManagementService;\n+\n+\t@Captor\n+\tprivate ArgumentCaptor<RequestMessage> argumentReqM;\n+\n+\t@Captor\n+\tprivate ArgumentCaptor<ResponseMessage> argumentResM;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "042bc2f3426827e05795a38d7afd4c2be234dc35"}, "originalPosition": 71}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMzA3MDA1NA==", "bodyText": "give this field a descriptive name like argumentMessageType", "url": "https://github.com/OSGP/open-smart-grid-platform/pull/435#discussion_r503070054", "createdAt": "2020-10-12T06:43:55Z", "author": {"login": "robindenadel"}, "path": "osgp/platform/osgp-adapter-domain-core/src/test/java/org/opensmartgridplatform/adapter/domain/core/application/services/DeviceManagementServiceTest.java", "diffHunk": "@@ -0,0 +1,217 @@\n+package org.opensmartgridplatform.adapter.domain.core.application.services;\n+\n+import static org.assertj.core.api.Assertions.assertThat;\n+import static org.mockito.ArgumentMatchers.any;\n+import static org.mockito.Mockito.mock;\n+import static org.mockito.Mockito.verify;\n+import static org.mockito.Mockito.verifyNoInteractions;\n+import static org.mockito.Mockito.when;\n+\n+import java.util.Arrays;\n+import java.util.List;\n+\n+import org.junit.jupiter.api.BeforeEach;\n+import org.junit.jupiter.api.Test;\n+import org.junit.jupiter.api.extension.ExtendWith;\n+import org.mockito.ArgumentCaptor;\n+import org.mockito.Captor;\n+import org.mockito.InjectMocks;\n+import org.mockito.Mock;\n+import org.mockito.junit.jupiter.MockitoExtension;\n+import org.mockito.junit.jupiter.MockitoSettings;\n+import org.mockito.quality.Strictness;\n+import org.opensmartgridplatform.adapter.domain.core.application.mapping.DomainCoreMapper;\n+import org.opensmartgridplatform.adapter.domain.core.infra.jms.core.OsgpCoreRequestMessageSender;\n+import org.opensmartgridplatform.adapter.domain.core.infra.jms.ws.WebServiceResponseMessageSender;\n+import org.opensmartgridplatform.domain.core.entities.Device;\n+import org.opensmartgridplatform.domain.core.entities.Organisation;\n+import org.opensmartgridplatform.domain.core.exceptions.UnknownEntityException;\n+import org.opensmartgridplatform.domain.core.services.DeviceDomainService;\n+import org.opensmartgridplatform.domain.core.services.OrganisationDomainService;\n+import org.opensmartgridplatform.domain.core.valueobjects.CdmaSettings;\n+import org.opensmartgridplatform.domain.core.valueobjects.Certification;\n+import org.opensmartgridplatform.domain.core.valueobjects.DeviceLifecycleStatus;\n+import org.opensmartgridplatform.domain.core.valueobjects.EventNotificationType;\n+import org.opensmartgridplatform.dto.valueobjects.EventNotificationMessageDataContainerDto;\n+import org.opensmartgridplatform.shared.exceptionhandling.ComponentType;\n+import org.opensmartgridplatform.shared.exceptionhandling.FunctionalException;\n+import org.opensmartgridplatform.shared.infra.jms.RequestMessage;\n+import org.opensmartgridplatform.shared.infra.jms.ResponseMessage;\n+import org.opensmartgridplatform.shared.infra.jms.ResponseMessageResultType;\n+\n+@ExtendWith(MockitoExtension.class)\n+@MockitoSettings(strictness = Strictness.LENIENT)\n+public class DeviceManagementServiceTest {\n+\t\n+\t@Mock\n+\tprivate TransactionalDeviceService transactionalDeviceService;\n+\t\n+\t@Mock\n+\tprivate DeviceDomainService deviceDomainService;\n+\t\n+\t@Mock\n+\tprivate DomainCoreMapper domainCoreMapper;\n+\t\n+\t@Mock\n+\tprivate OsgpCoreRequestMessageSender osgpCoreRequestManager;\n+\t\n+\t@Mock\n+\tprivate WebServiceResponseMessageSender webServiceResponseMessageSender;\n+\n+\t@Mock\n+\tprivate OrganisationDomainService organisationDomainService;\n+\t\n+\t@InjectMocks\n+\tprivate DeviceManagementService deviceManagementService;\n+\n+\t@Captor\n+\tprivate ArgumentCaptor<RequestMessage> argumentReqM;\n+\n+\t@Captor\n+\tprivate ArgumentCaptor<ResponseMessage> argumentResM;\n+\n+\t@Captor\n+\tprivate ArgumentCaptor<String> argumentStringOne;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "042bc2f3426827e05795a38d7afd4c2be234dc35"}, "originalPosition": 74}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMzA3MDQwOQ==", "bodyText": "give this field a descriptive name like argumentIpAddress", "url": "https://github.com/OSGP/open-smart-grid-platform/pull/435#discussion_r503070409", "createdAt": "2020-10-12T06:44:48Z", "author": {"login": "robindenadel"}, "path": "osgp/platform/osgp-adapter-domain-core/src/test/java/org/opensmartgridplatform/adapter/domain/core/application/services/DeviceManagementServiceTest.java", "diffHunk": "@@ -0,0 +1,217 @@\n+package org.opensmartgridplatform.adapter.domain.core.application.services;\n+\n+import static org.assertj.core.api.Assertions.assertThat;\n+import static org.mockito.ArgumentMatchers.any;\n+import static org.mockito.Mockito.mock;\n+import static org.mockito.Mockito.verify;\n+import static org.mockito.Mockito.verifyNoInteractions;\n+import static org.mockito.Mockito.when;\n+\n+import java.util.Arrays;\n+import java.util.List;\n+\n+import org.junit.jupiter.api.BeforeEach;\n+import org.junit.jupiter.api.Test;\n+import org.junit.jupiter.api.extension.ExtendWith;\n+import org.mockito.ArgumentCaptor;\n+import org.mockito.Captor;\n+import org.mockito.InjectMocks;\n+import org.mockito.Mock;\n+import org.mockito.junit.jupiter.MockitoExtension;\n+import org.mockito.junit.jupiter.MockitoSettings;\n+import org.mockito.quality.Strictness;\n+import org.opensmartgridplatform.adapter.domain.core.application.mapping.DomainCoreMapper;\n+import org.opensmartgridplatform.adapter.domain.core.infra.jms.core.OsgpCoreRequestMessageSender;\n+import org.opensmartgridplatform.adapter.domain.core.infra.jms.ws.WebServiceResponseMessageSender;\n+import org.opensmartgridplatform.domain.core.entities.Device;\n+import org.opensmartgridplatform.domain.core.entities.Organisation;\n+import org.opensmartgridplatform.domain.core.exceptions.UnknownEntityException;\n+import org.opensmartgridplatform.domain.core.services.DeviceDomainService;\n+import org.opensmartgridplatform.domain.core.services.OrganisationDomainService;\n+import org.opensmartgridplatform.domain.core.valueobjects.CdmaSettings;\n+import org.opensmartgridplatform.domain.core.valueobjects.Certification;\n+import org.opensmartgridplatform.domain.core.valueobjects.DeviceLifecycleStatus;\n+import org.opensmartgridplatform.domain.core.valueobjects.EventNotificationType;\n+import org.opensmartgridplatform.dto.valueobjects.EventNotificationMessageDataContainerDto;\n+import org.opensmartgridplatform.shared.exceptionhandling.ComponentType;\n+import org.opensmartgridplatform.shared.exceptionhandling.FunctionalException;\n+import org.opensmartgridplatform.shared.infra.jms.RequestMessage;\n+import org.opensmartgridplatform.shared.infra.jms.ResponseMessage;\n+import org.opensmartgridplatform.shared.infra.jms.ResponseMessageResultType;\n+\n+@ExtendWith(MockitoExtension.class)\n+@MockitoSettings(strictness = Strictness.LENIENT)\n+public class DeviceManagementServiceTest {\n+\t\n+\t@Mock\n+\tprivate TransactionalDeviceService transactionalDeviceService;\n+\t\n+\t@Mock\n+\tprivate DeviceDomainService deviceDomainService;\n+\t\n+\t@Mock\n+\tprivate DomainCoreMapper domainCoreMapper;\n+\t\n+\t@Mock\n+\tprivate OsgpCoreRequestMessageSender osgpCoreRequestManager;\n+\t\n+\t@Mock\n+\tprivate WebServiceResponseMessageSender webServiceResponseMessageSender;\n+\n+\t@Mock\n+\tprivate OrganisationDomainService organisationDomainService;\n+\t\n+\t@InjectMocks\n+\tprivate DeviceManagementService deviceManagementService;\n+\n+\t@Captor\n+\tprivate ArgumentCaptor<RequestMessage> argumentReqM;\n+\n+\t@Captor\n+\tprivate ArgumentCaptor<ResponseMessage> argumentResM;\n+\n+\t@Captor\n+\tprivate ArgumentCaptor<String> argumentStringOne;\n+\n+\t@Captor\n+\tprivate ArgumentCaptor<String> argumentStringTwo;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "042bc2f3426827e05795a38d7afd4c2be234dc35"}, "originalPosition": 77}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMzA3MDUwMw==", "bodyText": "give this field a descriptive name like argumentPriority", "url": "https://github.com/OSGP/open-smart-grid-platform/pull/435#discussion_r503070503", "createdAt": "2020-10-12T06:45:00Z", "author": {"login": "robindenadel"}, "path": "osgp/platform/osgp-adapter-domain-core/src/test/java/org/opensmartgridplatform/adapter/domain/core/application/services/DeviceManagementServiceTest.java", "diffHunk": "@@ -0,0 +1,217 @@\n+package org.opensmartgridplatform.adapter.domain.core.application.services;\n+\n+import static org.assertj.core.api.Assertions.assertThat;\n+import static org.mockito.ArgumentMatchers.any;\n+import static org.mockito.Mockito.mock;\n+import static org.mockito.Mockito.verify;\n+import static org.mockito.Mockito.verifyNoInteractions;\n+import static org.mockito.Mockito.when;\n+\n+import java.util.Arrays;\n+import java.util.List;\n+\n+import org.junit.jupiter.api.BeforeEach;\n+import org.junit.jupiter.api.Test;\n+import org.junit.jupiter.api.extension.ExtendWith;\n+import org.mockito.ArgumentCaptor;\n+import org.mockito.Captor;\n+import org.mockito.InjectMocks;\n+import org.mockito.Mock;\n+import org.mockito.junit.jupiter.MockitoExtension;\n+import org.mockito.junit.jupiter.MockitoSettings;\n+import org.mockito.quality.Strictness;\n+import org.opensmartgridplatform.adapter.domain.core.application.mapping.DomainCoreMapper;\n+import org.opensmartgridplatform.adapter.domain.core.infra.jms.core.OsgpCoreRequestMessageSender;\n+import org.opensmartgridplatform.adapter.domain.core.infra.jms.ws.WebServiceResponseMessageSender;\n+import org.opensmartgridplatform.domain.core.entities.Device;\n+import org.opensmartgridplatform.domain.core.entities.Organisation;\n+import org.opensmartgridplatform.domain.core.exceptions.UnknownEntityException;\n+import org.opensmartgridplatform.domain.core.services.DeviceDomainService;\n+import org.opensmartgridplatform.domain.core.services.OrganisationDomainService;\n+import org.opensmartgridplatform.domain.core.valueobjects.CdmaSettings;\n+import org.opensmartgridplatform.domain.core.valueobjects.Certification;\n+import org.opensmartgridplatform.domain.core.valueobjects.DeviceLifecycleStatus;\n+import org.opensmartgridplatform.domain.core.valueobjects.EventNotificationType;\n+import org.opensmartgridplatform.dto.valueobjects.EventNotificationMessageDataContainerDto;\n+import org.opensmartgridplatform.shared.exceptionhandling.ComponentType;\n+import org.opensmartgridplatform.shared.exceptionhandling.FunctionalException;\n+import org.opensmartgridplatform.shared.infra.jms.RequestMessage;\n+import org.opensmartgridplatform.shared.infra.jms.ResponseMessage;\n+import org.opensmartgridplatform.shared.infra.jms.ResponseMessageResultType;\n+\n+@ExtendWith(MockitoExtension.class)\n+@MockitoSettings(strictness = Strictness.LENIENT)\n+public class DeviceManagementServiceTest {\n+\t\n+\t@Mock\n+\tprivate TransactionalDeviceService transactionalDeviceService;\n+\t\n+\t@Mock\n+\tprivate DeviceDomainService deviceDomainService;\n+\t\n+\t@Mock\n+\tprivate DomainCoreMapper domainCoreMapper;\n+\t\n+\t@Mock\n+\tprivate OsgpCoreRequestMessageSender osgpCoreRequestManager;\n+\t\n+\t@Mock\n+\tprivate WebServiceResponseMessageSender webServiceResponseMessageSender;\n+\n+\t@Mock\n+\tprivate OrganisationDomainService organisationDomainService;\n+\t\n+\t@InjectMocks\n+\tprivate DeviceManagementService deviceManagementService;\n+\n+\t@Captor\n+\tprivate ArgumentCaptor<RequestMessage> argumentReqM;\n+\n+\t@Captor\n+\tprivate ArgumentCaptor<ResponseMessage> argumentResM;\n+\n+\t@Captor\n+\tprivate ArgumentCaptor<String> argumentStringOne;\n+\n+\t@Captor\n+\tprivate ArgumentCaptor<String> argumentStringTwo;\n+\n+\t@Captor\n+\tprivate ArgumentCaptor<Integer> argumentInt;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "042bc2f3426827e05795a38d7afd4c2be234dc35"}, "originalPosition": 80}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMzA3MTQ2Mg==", "bodyText": "rename expectedRM to expectedRequestMessage (also in other tests)\nrefactor the creation of a request message to a method, so it can be used in other tests as well", "url": "https://github.com/OSGP/open-smart-grid-platform/pull/435#discussion_r503071462", "createdAt": "2020-10-12T06:47:23Z", "author": {"login": "robindenadel"}, "path": "osgp/platform/osgp-adapter-domain-core/src/test/java/org/opensmartgridplatform/adapter/domain/core/application/services/DeviceManagementServiceTest.java", "diffHunk": "@@ -0,0 +1,217 @@\n+package org.opensmartgridplatform.adapter.domain.core.application.services;\n+\n+import static org.assertj.core.api.Assertions.assertThat;\n+import static org.mockito.ArgumentMatchers.any;\n+import static org.mockito.Mockito.mock;\n+import static org.mockito.Mockito.verify;\n+import static org.mockito.Mockito.verifyNoInteractions;\n+import static org.mockito.Mockito.when;\n+\n+import java.util.Arrays;\n+import java.util.List;\n+\n+import org.junit.jupiter.api.BeforeEach;\n+import org.junit.jupiter.api.Test;\n+import org.junit.jupiter.api.extension.ExtendWith;\n+import org.mockito.ArgumentCaptor;\n+import org.mockito.Captor;\n+import org.mockito.InjectMocks;\n+import org.mockito.Mock;\n+import org.mockito.junit.jupiter.MockitoExtension;\n+import org.mockito.junit.jupiter.MockitoSettings;\n+import org.mockito.quality.Strictness;\n+import org.opensmartgridplatform.adapter.domain.core.application.mapping.DomainCoreMapper;\n+import org.opensmartgridplatform.adapter.domain.core.infra.jms.core.OsgpCoreRequestMessageSender;\n+import org.opensmartgridplatform.adapter.domain.core.infra.jms.ws.WebServiceResponseMessageSender;\n+import org.opensmartgridplatform.domain.core.entities.Device;\n+import org.opensmartgridplatform.domain.core.entities.Organisation;\n+import org.opensmartgridplatform.domain.core.exceptions.UnknownEntityException;\n+import org.opensmartgridplatform.domain.core.services.DeviceDomainService;\n+import org.opensmartgridplatform.domain.core.services.OrganisationDomainService;\n+import org.opensmartgridplatform.domain.core.valueobjects.CdmaSettings;\n+import org.opensmartgridplatform.domain.core.valueobjects.Certification;\n+import org.opensmartgridplatform.domain.core.valueobjects.DeviceLifecycleStatus;\n+import org.opensmartgridplatform.domain.core.valueobjects.EventNotificationType;\n+import org.opensmartgridplatform.dto.valueobjects.EventNotificationMessageDataContainerDto;\n+import org.opensmartgridplatform.shared.exceptionhandling.ComponentType;\n+import org.opensmartgridplatform.shared.exceptionhandling.FunctionalException;\n+import org.opensmartgridplatform.shared.infra.jms.RequestMessage;\n+import org.opensmartgridplatform.shared.infra.jms.ResponseMessage;\n+import org.opensmartgridplatform.shared.infra.jms.ResponseMessageResultType;\n+\n+@ExtendWith(MockitoExtension.class)\n+@MockitoSettings(strictness = Strictness.LENIENT)\n+public class DeviceManagementServiceTest {\n+\t\n+\t@Mock\n+\tprivate TransactionalDeviceService transactionalDeviceService;\n+\t\n+\t@Mock\n+\tprivate DeviceDomainService deviceDomainService;\n+\t\n+\t@Mock\n+\tprivate DomainCoreMapper domainCoreMapper;\n+\t\n+\t@Mock\n+\tprivate OsgpCoreRequestMessageSender osgpCoreRequestManager;\n+\t\n+\t@Mock\n+\tprivate WebServiceResponseMessageSender webServiceResponseMessageSender;\n+\n+\t@Mock\n+\tprivate OrganisationDomainService organisationDomainService;\n+\t\n+\t@InjectMocks\n+\tprivate DeviceManagementService deviceManagementService;\n+\n+\t@Captor\n+\tprivate ArgumentCaptor<RequestMessage> argumentReqM;\n+\n+\t@Captor\n+\tprivate ArgumentCaptor<ResponseMessage> argumentResM;\n+\n+\t@Captor\n+\tprivate ArgumentCaptor<String> argumentStringOne;\n+\n+\t@Captor\n+\tprivate ArgumentCaptor<String> argumentStringTwo;\n+\n+\t@Captor\n+\tprivate ArgumentCaptor<Integer> argumentInt;\n+\n+\t@BeforeEach\n+\tpublic void init() throws UnknownEntityException {\n+\t\twhen(this.organisationDomainService.searchOrganisation(any())).thenReturn(new Organisation());\n+\t}\n+\t\n+\t@Test\n+\tpublic void testSetEventNotifications() throws FunctionalException {\n+\t\tfinal List<EventNotificationType> eventNotifications = Arrays.asList(\n+\t\t\t\tEventNotificationType.COMM_EVENTS,\n+\t\t\t\tEventNotificationType.DIAG_EVENTS);\n+\t\tfinal Device device = mock(Device.class);\n+\t\twhen(device.getIpAddress()).thenReturn(\"testIp\");\n+\t\twhen(this.deviceDomainService.searchActiveDevice(\"testDevice\", ComponentType.DOMAIN_CORE)).thenReturn(device);\n+\t\t\n+\t\tthis.deviceManagementService.setEventNotifications(\"testOrganisation\", \"testDevice\", \"testUid\",\n+\t\t\t\teventNotifications, \"testMessageType\", 1);\n+\n+\t\tverify(this.osgpCoreRequestManager).send(this.argumentReqM.capture(), this.argumentStringOne.capture(),\n+\t\t\t\tthis.argumentInt.capture(), this.argumentStringTwo.capture());\n+\n+\t\tfinal RequestMessage expectedRM = new RequestMessage(\"testUid\", \"testOrganisation\", \"testDevice\",\n+\t\t\t\tnew EventNotificationMessageDataContainerDto(this.domainCoreMapper.mapAsList(eventNotifications,\n+\t\t\t\t\t\torg.opensmartgridplatform.dto.valueobjects.EventNotificationTypeDto.class)));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "042bc2f3426827e05795a38d7afd4c2be234dc35"}, "originalPosition": 104}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMzA3MjA0MQ==", "bodyText": "refactor values you are going to check on in the assert part of the tests to constants", "url": "https://github.com/OSGP/open-smart-grid-platform/pull/435#discussion_r503072041", "createdAt": "2020-10-12T06:49:00Z", "author": {"login": "robindenadel"}, "path": "osgp/platform/osgp-adapter-domain-core/src/test/java/org/opensmartgridplatform/adapter/domain/core/application/services/DeviceManagementServiceTest.java", "diffHunk": "@@ -0,0 +1,217 @@\n+package org.opensmartgridplatform.adapter.domain.core.application.services;\n+\n+import static org.assertj.core.api.Assertions.assertThat;\n+import static org.mockito.ArgumentMatchers.any;\n+import static org.mockito.Mockito.mock;\n+import static org.mockito.Mockito.verify;\n+import static org.mockito.Mockito.verifyNoInteractions;\n+import static org.mockito.Mockito.when;\n+\n+import java.util.Arrays;\n+import java.util.List;\n+\n+import org.junit.jupiter.api.BeforeEach;\n+import org.junit.jupiter.api.Test;\n+import org.junit.jupiter.api.extension.ExtendWith;\n+import org.mockito.ArgumentCaptor;\n+import org.mockito.Captor;\n+import org.mockito.InjectMocks;\n+import org.mockito.Mock;\n+import org.mockito.junit.jupiter.MockitoExtension;\n+import org.mockito.junit.jupiter.MockitoSettings;\n+import org.mockito.quality.Strictness;\n+import org.opensmartgridplatform.adapter.domain.core.application.mapping.DomainCoreMapper;\n+import org.opensmartgridplatform.adapter.domain.core.infra.jms.core.OsgpCoreRequestMessageSender;\n+import org.opensmartgridplatform.adapter.domain.core.infra.jms.ws.WebServiceResponseMessageSender;\n+import org.opensmartgridplatform.domain.core.entities.Device;\n+import org.opensmartgridplatform.domain.core.entities.Organisation;\n+import org.opensmartgridplatform.domain.core.exceptions.UnknownEntityException;\n+import org.opensmartgridplatform.domain.core.services.DeviceDomainService;\n+import org.opensmartgridplatform.domain.core.services.OrganisationDomainService;\n+import org.opensmartgridplatform.domain.core.valueobjects.CdmaSettings;\n+import org.opensmartgridplatform.domain.core.valueobjects.Certification;\n+import org.opensmartgridplatform.domain.core.valueobjects.DeviceLifecycleStatus;\n+import org.opensmartgridplatform.domain.core.valueobjects.EventNotificationType;\n+import org.opensmartgridplatform.dto.valueobjects.EventNotificationMessageDataContainerDto;\n+import org.opensmartgridplatform.shared.exceptionhandling.ComponentType;\n+import org.opensmartgridplatform.shared.exceptionhandling.FunctionalException;\n+import org.opensmartgridplatform.shared.infra.jms.RequestMessage;\n+import org.opensmartgridplatform.shared.infra.jms.ResponseMessage;\n+import org.opensmartgridplatform.shared.infra.jms.ResponseMessageResultType;\n+\n+@ExtendWith(MockitoExtension.class)\n+@MockitoSettings(strictness = Strictness.LENIENT)\n+public class DeviceManagementServiceTest {\n+\t\n+\t@Mock\n+\tprivate TransactionalDeviceService transactionalDeviceService;\n+\t\n+\t@Mock\n+\tprivate DeviceDomainService deviceDomainService;\n+\t\n+\t@Mock\n+\tprivate DomainCoreMapper domainCoreMapper;\n+\t\n+\t@Mock\n+\tprivate OsgpCoreRequestMessageSender osgpCoreRequestManager;\n+\t\n+\t@Mock\n+\tprivate WebServiceResponseMessageSender webServiceResponseMessageSender;\n+\n+\t@Mock\n+\tprivate OrganisationDomainService organisationDomainService;\n+\t\n+\t@InjectMocks\n+\tprivate DeviceManagementService deviceManagementService;\n+\n+\t@Captor\n+\tprivate ArgumentCaptor<RequestMessage> argumentReqM;\n+\n+\t@Captor\n+\tprivate ArgumentCaptor<ResponseMessage> argumentResM;\n+\n+\t@Captor\n+\tprivate ArgumentCaptor<String> argumentStringOne;\n+\n+\t@Captor\n+\tprivate ArgumentCaptor<String> argumentStringTwo;\n+\n+\t@Captor\n+\tprivate ArgumentCaptor<Integer> argumentInt;\n+\n+\t@BeforeEach\n+\tpublic void init() throws UnknownEntityException {\n+\t\twhen(this.organisationDomainService.searchOrganisation(any())).thenReturn(new Organisation());\n+\t}\n+\t\n+\t@Test\n+\tpublic void testSetEventNotifications() throws FunctionalException {\n+\t\tfinal List<EventNotificationType> eventNotifications = Arrays.asList(\n+\t\t\t\tEventNotificationType.COMM_EVENTS,\n+\t\t\t\tEventNotificationType.DIAG_EVENTS);\n+\t\tfinal Device device = mock(Device.class);\n+\t\twhen(device.getIpAddress()).thenReturn(\"testIp\");\n+\t\twhen(this.deviceDomainService.searchActiveDevice(\"testDevice\", ComponentType.DOMAIN_CORE)).thenReturn(device);\n+\t\t\n+\t\tthis.deviceManagementService.setEventNotifications(\"testOrganisation\", \"testDevice\", \"testUid\",\n+\t\t\t\teventNotifications, \"testMessageType\", 1);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "042bc2f3426827e05795a38d7afd4c2be234dc35"}, "originalPosition": 97}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f55fc92905535fe980310db71a46bfe40f21259a", "author": {"user": {"login": "MithraicMagic", "name": "Nick Walraven"}}, "url": "https://github.com/OSGP/open-smart-grid-platform/commit/f55fc92905535fe980310db71a46bfe40f21259a", "committedDate": "2020-10-13T07:53:52Z", "message": "- Added License Header\n- Renamed some fields\n- Added request message creation method\n- Refactored some strings into constants"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTE1MzgxMzU4", "url": "https://github.com/OSGP/open-smart-grid-platform/pull/435#pullrequestreview-515381358", "createdAt": "2020-10-23T06:37:52Z", "commit": {"oid": "f55fc92905535fe980310db71a46bfe40f21259a"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 12, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yM1QwNjo1MTo0OVrOHnA4_w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yM1QwNzowNToyOFrOHnBQFQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMDY3MTEwMw==", "bodyText": "Formatting is not ok, check your settings.", "url": "https://github.com/OSGP/open-smart-grid-platform/pull/435#discussion_r510671103", "createdAt": "2020-10-23T06:51:49Z", "author": {"login": "robindenadel"}, "path": "osgp/platform/osgp-adapter-domain-core/src/test/java/org/opensmartgridplatform/adapter/domain/core/application/services/DeviceManagementServiceTest.java", "diffHunk": "@@ -0,0 +1,231 @@\n+package org.opensmartgridplatform.adapter.domain.core.application.services;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f55fc92905535fe980310db71a46bfe40f21259a"}, "originalPosition": 1}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMDY3MTM1Nw==", "bodyText": "Move the licence header to the top of the file", "url": "https://github.com/OSGP/open-smart-grid-platform/pull/435#discussion_r510671357", "createdAt": "2020-10-23T06:52:23Z", "author": {"login": "robindenadel"}, "path": "osgp/platform/osgp-adapter-domain-core/src/test/java/org/opensmartgridplatform/adapter/domain/core/application/services/DeviceManagementServiceTest.java", "diffHunk": "@@ -0,0 +1,217 @@\n+package org.opensmartgridplatform.adapter.domain.core.application.services;", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMzA2OTE1MA=="}, "originalCommit": {"oid": "042bc2f3426827e05795a38d7afd4c2be234dc35"}, "originalPosition": 1}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMDY3NTA0Nw==", "bodyText": "import EventNotificationTypeDto so you don't need to give the package name here", "url": "https://github.com/OSGP/open-smart-grid-platform/pull/435#discussion_r510675047", "createdAt": "2020-10-23T07:01:00Z", "author": {"login": "robindenadel"}, "path": "osgp/platform/osgp-adapter-domain-core/src/test/java/org/opensmartgridplatform/adapter/domain/core/application/services/DeviceManagementServiceTest.java", "diffHunk": "@@ -0,0 +1,231 @@\n+package org.opensmartgridplatform.adapter.domain.core.application.services;\n+\n+import static org.assertj.core.api.Assertions.assertThat;\n+import static org.mockito.ArgumentMatchers.any;\n+import static org.mockito.Mockito.mock;\n+import static org.mockito.Mockito.verify;\n+import static org.mockito.Mockito.verifyNoInteractions;\n+import static org.mockito.Mockito.when;\n+\n+import java.io.Serializable;\n+import java.util.Arrays;\n+import java.util.List;\n+\n+import org.junit.jupiter.api.BeforeEach;\n+import org.junit.jupiter.api.Test;\n+import org.junit.jupiter.api.extension.ExtendWith;\n+import org.mockito.ArgumentCaptor;\n+import org.mockito.Captor;\n+import org.mockito.InjectMocks;\n+import org.mockito.Mock;\n+import org.mockito.junit.jupiter.MockitoExtension;\n+import org.opensmartgridplatform.adapter.domain.core.application.mapping.DomainCoreMapper;\n+import org.opensmartgridplatform.adapter.domain.core.infra.jms.core.OsgpCoreRequestMessageSender;\n+import org.opensmartgridplatform.adapter.domain.core.infra.jms.ws.WebServiceResponseMessageSender;\n+import org.opensmartgridplatform.domain.core.entities.Device;\n+import org.opensmartgridplatform.domain.core.entities.Organisation;\n+import org.opensmartgridplatform.domain.core.exceptions.UnknownEntityException;\n+import org.opensmartgridplatform.domain.core.services.DeviceDomainService;\n+import org.opensmartgridplatform.domain.core.services.OrganisationDomainService;\n+import org.opensmartgridplatform.domain.core.valueobjects.CdmaSettings;\n+import org.opensmartgridplatform.domain.core.valueobjects.Certification;\n+import org.opensmartgridplatform.domain.core.valueobjects.DeviceLifecycleStatus;\n+import org.opensmartgridplatform.domain.core.valueobjects.EventNotificationType;\n+import org.opensmartgridplatform.dto.valueobjects.EventNotificationMessageDataContainerDto;\n+import org.opensmartgridplatform.shared.exceptionhandling.ComponentType;\n+import org.opensmartgridplatform.shared.exceptionhandling.FunctionalException;\n+import org.opensmartgridplatform.shared.infra.jms.RequestMessage;\n+import org.opensmartgridplatform.shared.infra.jms.ResponseMessage;\n+import org.opensmartgridplatform.shared.infra.jms.ResponseMessageResultType;\n+\n+/**\n+ * Copyright 2020 Alliander N.V.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\"); you may not use this file except in compliance\n+ * with the License.  You may obtain a copy of the License at\n+ *\n+ * http://www.apache.org/licenses/LICENSE-2.0\n+ */\n+\n+@ExtendWith(MockitoExtension.class)\n+public class DeviceManagementServiceTest {\n+\n+    private static final String TEST_ORGANISATION = \"testOrganisation\";\n+    private static final String TEST_DEVICE = \"testDevice\";\n+    private static final String TEST_IP = \"testIp\";\n+    private static final String TEST_UID = \"testUid\";\n+    private static final String TEST_MESSAGE_TYPE = \"testMessageType\";\n+\n+    @Mock\n+    private TransactionalDeviceService transactionalDeviceService;\n+\n+    @Mock\n+    private DeviceDomainService deviceDomainService;\n+\n+    @Mock\n+    private DomainCoreMapper domainCoreMapper;\n+\n+    @Mock\n+    private OsgpCoreRequestMessageSender osgpCoreRequestManager;\n+\n+    @Mock\n+    private WebServiceResponseMessageSender webServiceResponseMessageSender;\n+\n+    @Mock\n+    private OrganisationDomainService organisationDomainService;\n+\n+    @InjectMocks\n+    private DeviceManagementService deviceManagementService;\n+\n+    @Captor\n+    private ArgumentCaptor<RequestMessage> argumentRequestMessage;\n+\n+    @Captor\n+    private ArgumentCaptor<ResponseMessage> argumentResponseMessage;\n+\n+    @Captor\n+    private ArgumentCaptor<String> argumentMessageType;\n+\n+    @Captor\n+    private ArgumentCaptor<String> argumentIpAddress;\n+\n+    @Captor\n+    private ArgumentCaptor<String> argumentDeviceIdentification;\n+\n+    @Captor\n+    private ArgumentCaptor<Integer> argumentPriority;\n+\n+    @BeforeEach\n+    public void init() throws UnknownEntityException {\n+        when(this.organisationDomainService.searchOrganisation(any())).thenReturn(new Organisation());\n+    }\n+\n+    @Test\n+    public void testSetEventNotifications() throws FunctionalException {\n+        final List<EventNotificationType> eventNotifications = Arrays.asList(EventNotificationType.COMM_EVENTS,\n+                EventNotificationType.DIAG_EVENTS);\n+        final Device device = mock(Device.class);\n+        when(device.getIpAddress()).thenReturn(TEST_IP);\n+        when(this.deviceDomainService.searchActiveDevice(TEST_DEVICE, ComponentType.DOMAIN_CORE)).thenReturn(device);\n+\n+        this.deviceManagementService.setEventNotifications(TEST_ORGANISATION, TEST_DEVICE, TEST_UID,\n+                eventNotifications, TEST_MESSAGE_TYPE, 1);\n+\n+        verify(this.osgpCoreRequestManager).send(this.argumentRequestMessage.capture(),\n+                this.argumentMessageType.capture(), this.argumentPriority.capture(), this.argumentIpAddress.capture());\n+\n+        final RequestMessage expectedRequestMessage = this.createNewRequestMessage(\n+                new EventNotificationMessageDataContainerDto(this.domainCoreMapper.mapAsList(eventNotifications,\n+                        org.opensmartgridplatform.dto.valueobjects.EventNotificationTypeDto.class)));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f55fc92905535fe980310db71a46bfe40f21259a"}, "originalPosition": 119}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMDY3NTQ2OA==", "bodyText": "Refactor 1 to a constant TEST_PRIORITY", "url": "https://github.com/OSGP/open-smart-grid-platform/pull/435#discussion_r510675468", "createdAt": "2020-10-23T07:01:57Z", "author": {"login": "robindenadel"}, "path": "osgp/platform/osgp-adapter-domain-core/src/test/java/org/opensmartgridplatform/adapter/domain/core/application/services/DeviceManagementServiceTest.java", "diffHunk": "@@ -0,0 +1,231 @@\n+package org.opensmartgridplatform.adapter.domain.core.application.services;\n+\n+import static org.assertj.core.api.Assertions.assertThat;\n+import static org.mockito.ArgumentMatchers.any;\n+import static org.mockito.Mockito.mock;\n+import static org.mockito.Mockito.verify;\n+import static org.mockito.Mockito.verifyNoInteractions;\n+import static org.mockito.Mockito.when;\n+\n+import java.io.Serializable;\n+import java.util.Arrays;\n+import java.util.List;\n+\n+import org.junit.jupiter.api.BeforeEach;\n+import org.junit.jupiter.api.Test;\n+import org.junit.jupiter.api.extension.ExtendWith;\n+import org.mockito.ArgumentCaptor;\n+import org.mockito.Captor;\n+import org.mockito.InjectMocks;\n+import org.mockito.Mock;\n+import org.mockito.junit.jupiter.MockitoExtension;\n+import org.opensmartgridplatform.adapter.domain.core.application.mapping.DomainCoreMapper;\n+import org.opensmartgridplatform.adapter.domain.core.infra.jms.core.OsgpCoreRequestMessageSender;\n+import org.opensmartgridplatform.adapter.domain.core.infra.jms.ws.WebServiceResponseMessageSender;\n+import org.opensmartgridplatform.domain.core.entities.Device;\n+import org.opensmartgridplatform.domain.core.entities.Organisation;\n+import org.opensmartgridplatform.domain.core.exceptions.UnknownEntityException;\n+import org.opensmartgridplatform.domain.core.services.DeviceDomainService;\n+import org.opensmartgridplatform.domain.core.services.OrganisationDomainService;\n+import org.opensmartgridplatform.domain.core.valueobjects.CdmaSettings;\n+import org.opensmartgridplatform.domain.core.valueobjects.Certification;\n+import org.opensmartgridplatform.domain.core.valueobjects.DeviceLifecycleStatus;\n+import org.opensmartgridplatform.domain.core.valueobjects.EventNotificationType;\n+import org.opensmartgridplatform.dto.valueobjects.EventNotificationMessageDataContainerDto;\n+import org.opensmartgridplatform.shared.exceptionhandling.ComponentType;\n+import org.opensmartgridplatform.shared.exceptionhandling.FunctionalException;\n+import org.opensmartgridplatform.shared.infra.jms.RequestMessage;\n+import org.opensmartgridplatform.shared.infra.jms.ResponseMessage;\n+import org.opensmartgridplatform.shared.infra.jms.ResponseMessageResultType;\n+\n+/**\n+ * Copyright 2020 Alliander N.V.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\"); you may not use this file except in compliance\n+ * with the License.  You may obtain a copy of the License at\n+ *\n+ * http://www.apache.org/licenses/LICENSE-2.0\n+ */\n+\n+@ExtendWith(MockitoExtension.class)\n+public class DeviceManagementServiceTest {\n+\n+    private static final String TEST_ORGANISATION = \"testOrganisation\";\n+    private static final String TEST_DEVICE = \"testDevice\";\n+    private static final String TEST_IP = \"testIp\";\n+    private static final String TEST_UID = \"testUid\";\n+    private static final String TEST_MESSAGE_TYPE = \"testMessageType\";\n+\n+    @Mock\n+    private TransactionalDeviceService transactionalDeviceService;\n+\n+    @Mock\n+    private DeviceDomainService deviceDomainService;\n+\n+    @Mock\n+    private DomainCoreMapper domainCoreMapper;\n+\n+    @Mock\n+    private OsgpCoreRequestMessageSender osgpCoreRequestManager;\n+\n+    @Mock\n+    private WebServiceResponseMessageSender webServiceResponseMessageSender;\n+\n+    @Mock\n+    private OrganisationDomainService organisationDomainService;\n+\n+    @InjectMocks\n+    private DeviceManagementService deviceManagementService;\n+\n+    @Captor\n+    private ArgumentCaptor<RequestMessage> argumentRequestMessage;\n+\n+    @Captor\n+    private ArgumentCaptor<ResponseMessage> argumentResponseMessage;\n+\n+    @Captor\n+    private ArgumentCaptor<String> argumentMessageType;\n+\n+    @Captor\n+    private ArgumentCaptor<String> argumentIpAddress;\n+\n+    @Captor\n+    private ArgumentCaptor<String> argumentDeviceIdentification;\n+\n+    @Captor\n+    private ArgumentCaptor<Integer> argumentPriority;\n+\n+    @BeforeEach\n+    public void init() throws UnknownEntityException {\n+        when(this.organisationDomainService.searchOrganisation(any())).thenReturn(new Organisation());\n+    }\n+\n+    @Test\n+    public void testSetEventNotifications() throws FunctionalException {\n+        final List<EventNotificationType> eventNotifications = Arrays.asList(EventNotificationType.COMM_EVENTS,\n+                EventNotificationType.DIAG_EVENTS);\n+        final Device device = mock(Device.class);\n+        when(device.getIpAddress()).thenReturn(TEST_IP);\n+        when(this.deviceDomainService.searchActiveDevice(TEST_DEVICE, ComponentType.DOMAIN_CORE)).thenReturn(device);\n+\n+        this.deviceManagementService.setEventNotifications(TEST_ORGANISATION, TEST_DEVICE, TEST_UID,\n+                eventNotifications, TEST_MESSAGE_TYPE, 1);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f55fc92905535fe980310db71a46bfe40f21259a"}, "originalPosition": 112}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMDY3NTkwOA==", "bodyText": "use TEST_PRIORITY here", "url": "https://github.com/OSGP/open-smart-grid-platform/pull/435#discussion_r510675908", "createdAt": "2020-10-23T07:03:04Z", "author": {"login": "robindenadel"}, "path": "osgp/platform/osgp-adapter-domain-core/src/test/java/org/opensmartgridplatform/adapter/domain/core/application/services/DeviceManagementServiceTest.java", "diffHunk": "@@ -0,0 +1,231 @@\n+package org.opensmartgridplatform.adapter.domain.core.application.services;\n+\n+import static org.assertj.core.api.Assertions.assertThat;\n+import static org.mockito.ArgumentMatchers.any;\n+import static org.mockito.Mockito.mock;\n+import static org.mockito.Mockito.verify;\n+import static org.mockito.Mockito.verifyNoInteractions;\n+import static org.mockito.Mockito.when;\n+\n+import java.io.Serializable;\n+import java.util.Arrays;\n+import java.util.List;\n+\n+import org.junit.jupiter.api.BeforeEach;\n+import org.junit.jupiter.api.Test;\n+import org.junit.jupiter.api.extension.ExtendWith;\n+import org.mockito.ArgumentCaptor;\n+import org.mockito.Captor;\n+import org.mockito.InjectMocks;\n+import org.mockito.Mock;\n+import org.mockito.junit.jupiter.MockitoExtension;\n+import org.opensmartgridplatform.adapter.domain.core.application.mapping.DomainCoreMapper;\n+import org.opensmartgridplatform.adapter.domain.core.infra.jms.core.OsgpCoreRequestMessageSender;\n+import org.opensmartgridplatform.adapter.domain.core.infra.jms.ws.WebServiceResponseMessageSender;\n+import org.opensmartgridplatform.domain.core.entities.Device;\n+import org.opensmartgridplatform.domain.core.entities.Organisation;\n+import org.opensmartgridplatform.domain.core.exceptions.UnknownEntityException;\n+import org.opensmartgridplatform.domain.core.services.DeviceDomainService;\n+import org.opensmartgridplatform.domain.core.services.OrganisationDomainService;\n+import org.opensmartgridplatform.domain.core.valueobjects.CdmaSettings;\n+import org.opensmartgridplatform.domain.core.valueobjects.Certification;\n+import org.opensmartgridplatform.domain.core.valueobjects.DeviceLifecycleStatus;\n+import org.opensmartgridplatform.domain.core.valueobjects.EventNotificationType;\n+import org.opensmartgridplatform.dto.valueobjects.EventNotificationMessageDataContainerDto;\n+import org.opensmartgridplatform.shared.exceptionhandling.ComponentType;\n+import org.opensmartgridplatform.shared.exceptionhandling.FunctionalException;\n+import org.opensmartgridplatform.shared.infra.jms.RequestMessage;\n+import org.opensmartgridplatform.shared.infra.jms.ResponseMessage;\n+import org.opensmartgridplatform.shared.infra.jms.ResponseMessageResultType;\n+\n+/**\n+ * Copyright 2020 Alliander N.V.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\"); you may not use this file except in compliance\n+ * with the License.  You may obtain a copy of the License at\n+ *\n+ * http://www.apache.org/licenses/LICENSE-2.0\n+ */\n+\n+@ExtendWith(MockitoExtension.class)\n+public class DeviceManagementServiceTest {\n+\n+    private static final String TEST_ORGANISATION = \"testOrganisation\";\n+    private static final String TEST_DEVICE = \"testDevice\";\n+    private static final String TEST_IP = \"testIp\";\n+    private static final String TEST_UID = \"testUid\";\n+    private static final String TEST_MESSAGE_TYPE = \"testMessageType\";\n+\n+    @Mock\n+    private TransactionalDeviceService transactionalDeviceService;\n+\n+    @Mock\n+    private DeviceDomainService deviceDomainService;\n+\n+    @Mock\n+    private DomainCoreMapper domainCoreMapper;\n+\n+    @Mock\n+    private OsgpCoreRequestMessageSender osgpCoreRequestManager;\n+\n+    @Mock\n+    private WebServiceResponseMessageSender webServiceResponseMessageSender;\n+\n+    @Mock\n+    private OrganisationDomainService organisationDomainService;\n+\n+    @InjectMocks\n+    private DeviceManagementService deviceManagementService;\n+\n+    @Captor\n+    private ArgumentCaptor<RequestMessage> argumentRequestMessage;\n+\n+    @Captor\n+    private ArgumentCaptor<ResponseMessage> argumentResponseMessage;\n+\n+    @Captor\n+    private ArgumentCaptor<String> argumentMessageType;\n+\n+    @Captor\n+    private ArgumentCaptor<String> argumentIpAddress;\n+\n+    @Captor\n+    private ArgumentCaptor<String> argumentDeviceIdentification;\n+\n+    @Captor\n+    private ArgumentCaptor<Integer> argumentPriority;\n+\n+    @BeforeEach\n+    public void init() throws UnknownEntityException {\n+        when(this.organisationDomainService.searchOrganisation(any())).thenReturn(new Organisation());\n+    }\n+\n+    @Test\n+    public void testSetEventNotifications() throws FunctionalException {\n+        final List<EventNotificationType> eventNotifications = Arrays.asList(EventNotificationType.COMM_EVENTS,\n+                EventNotificationType.DIAG_EVENTS);\n+        final Device device = mock(Device.class);\n+        when(device.getIpAddress()).thenReturn(TEST_IP);\n+        when(this.deviceDomainService.searchActiveDevice(TEST_DEVICE, ComponentType.DOMAIN_CORE)).thenReturn(device);\n+\n+        this.deviceManagementService.setEventNotifications(TEST_ORGANISATION, TEST_DEVICE, TEST_UID,\n+                eventNotifications, TEST_MESSAGE_TYPE, 1);\n+\n+        verify(this.osgpCoreRequestManager).send(this.argumentRequestMessage.capture(),\n+                this.argumentMessageType.capture(), this.argumentPriority.capture(), this.argumentIpAddress.capture());\n+\n+        final RequestMessage expectedRequestMessage = this.createNewRequestMessage(\n+                new EventNotificationMessageDataContainerDto(this.domainCoreMapper.mapAsList(eventNotifications,\n+                        org.opensmartgridplatform.dto.valueobjects.EventNotificationTypeDto.class)));\n+\n+        assertThat(this.argumentRequestMessage.getValue()).usingRecursiveComparison().isEqualTo(expectedRequestMessage);\n+        assertThat(this.argumentMessageType.getValue()).isEqualTo(TEST_MESSAGE_TYPE);\n+        assertThat(this.argumentPriority.getValue()).isEqualTo(1);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f55fc92905535fe980310db71a46bfe40f21259a"}, "originalPosition": 123}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMDY3NTk3NA==", "bodyText": "use TEST_PRIORITY here", "url": "https://github.com/OSGP/open-smart-grid-platform/pull/435#discussion_r510675974", "createdAt": "2020-10-23T07:03:13Z", "author": {"login": "robindenadel"}, "path": "osgp/platform/osgp-adapter-domain-core/src/test/java/org/opensmartgridplatform/adapter/domain/core/application/services/DeviceManagementServiceTest.java", "diffHunk": "@@ -0,0 +1,231 @@\n+package org.opensmartgridplatform.adapter.domain.core.application.services;\n+\n+import static org.assertj.core.api.Assertions.assertThat;\n+import static org.mockito.ArgumentMatchers.any;\n+import static org.mockito.Mockito.mock;\n+import static org.mockito.Mockito.verify;\n+import static org.mockito.Mockito.verifyNoInteractions;\n+import static org.mockito.Mockito.when;\n+\n+import java.io.Serializable;\n+import java.util.Arrays;\n+import java.util.List;\n+\n+import org.junit.jupiter.api.BeforeEach;\n+import org.junit.jupiter.api.Test;\n+import org.junit.jupiter.api.extension.ExtendWith;\n+import org.mockito.ArgumentCaptor;\n+import org.mockito.Captor;\n+import org.mockito.InjectMocks;\n+import org.mockito.Mock;\n+import org.mockito.junit.jupiter.MockitoExtension;\n+import org.opensmartgridplatform.adapter.domain.core.application.mapping.DomainCoreMapper;\n+import org.opensmartgridplatform.adapter.domain.core.infra.jms.core.OsgpCoreRequestMessageSender;\n+import org.opensmartgridplatform.adapter.domain.core.infra.jms.ws.WebServiceResponseMessageSender;\n+import org.opensmartgridplatform.domain.core.entities.Device;\n+import org.opensmartgridplatform.domain.core.entities.Organisation;\n+import org.opensmartgridplatform.domain.core.exceptions.UnknownEntityException;\n+import org.opensmartgridplatform.domain.core.services.DeviceDomainService;\n+import org.opensmartgridplatform.domain.core.services.OrganisationDomainService;\n+import org.opensmartgridplatform.domain.core.valueobjects.CdmaSettings;\n+import org.opensmartgridplatform.domain.core.valueobjects.Certification;\n+import org.opensmartgridplatform.domain.core.valueobjects.DeviceLifecycleStatus;\n+import org.opensmartgridplatform.domain.core.valueobjects.EventNotificationType;\n+import org.opensmartgridplatform.dto.valueobjects.EventNotificationMessageDataContainerDto;\n+import org.opensmartgridplatform.shared.exceptionhandling.ComponentType;\n+import org.opensmartgridplatform.shared.exceptionhandling.FunctionalException;\n+import org.opensmartgridplatform.shared.infra.jms.RequestMessage;\n+import org.opensmartgridplatform.shared.infra.jms.ResponseMessage;\n+import org.opensmartgridplatform.shared.infra.jms.ResponseMessageResultType;\n+\n+/**\n+ * Copyright 2020 Alliander N.V.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\"); you may not use this file except in compliance\n+ * with the License.  You may obtain a copy of the License at\n+ *\n+ * http://www.apache.org/licenses/LICENSE-2.0\n+ */\n+\n+@ExtendWith(MockitoExtension.class)\n+public class DeviceManagementServiceTest {\n+\n+    private static final String TEST_ORGANISATION = \"testOrganisation\";\n+    private static final String TEST_DEVICE = \"testDevice\";\n+    private static final String TEST_IP = \"testIp\";\n+    private static final String TEST_UID = \"testUid\";\n+    private static final String TEST_MESSAGE_TYPE = \"testMessageType\";\n+\n+    @Mock\n+    private TransactionalDeviceService transactionalDeviceService;\n+\n+    @Mock\n+    private DeviceDomainService deviceDomainService;\n+\n+    @Mock\n+    private DomainCoreMapper domainCoreMapper;\n+\n+    @Mock\n+    private OsgpCoreRequestMessageSender osgpCoreRequestManager;\n+\n+    @Mock\n+    private WebServiceResponseMessageSender webServiceResponseMessageSender;\n+\n+    @Mock\n+    private OrganisationDomainService organisationDomainService;\n+\n+    @InjectMocks\n+    private DeviceManagementService deviceManagementService;\n+\n+    @Captor\n+    private ArgumentCaptor<RequestMessage> argumentRequestMessage;\n+\n+    @Captor\n+    private ArgumentCaptor<ResponseMessage> argumentResponseMessage;\n+\n+    @Captor\n+    private ArgumentCaptor<String> argumentMessageType;\n+\n+    @Captor\n+    private ArgumentCaptor<String> argumentIpAddress;\n+\n+    @Captor\n+    private ArgumentCaptor<String> argumentDeviceIdentification;\n+\n+    @Captor\n+    private ArgumentCaptor<Integer> argumentPriority;\n+\n+    @BeforeEach\n+    public void init() throws UnknownEntityException {\n+        when(this.organisationDomainService.searchOrganisation(any())).thenReturn(new Organisation());\n+    }\n+\n+    @Test\n+    public void testSetEventNotifications() throws FunctionalException {\n+        final List<EventNotificationType> eventNotifications = Arrays.asList(EventNotificationType.COMM_EVENTS,\n+                EventNotificationType.DIAG_EVENTS);\n+        final Device device = mock(Device.class);\n+        when(device.getIpAddress()).thenReturn(TEST_IP);\n+        when(this.deviceDomainService.searchActiveDevice(TEST_DEVICE, ComponentType.DOMAIN_CORE)).thenReturn(device);\n+\n+        this.deviceManagementService.setEventNotifications(TEST_ORGANISATION, TEST_DEVICE, TEST_UID,\n+                eventNotifications, TEST_MESSAGE_TYPE, 1);\n+\n+        verify(this.osgpCoreRequestManager).send(this.argumentRequestMessage.capture(),\n+                this.argumentMessageType.capture(), this.argumentPriority.capture(), this.argumentIpAddress.capture());\n+\n+        final RequestMessage expectedRequestMessage = this.createNewRequestMessage(\n+                new EventNotificationMessageDataContainerDto(this.domainCoreMapper.mapAsList(eventNotifications,\n+                        org.opensmartgridplatform.dto.valueobjects.EventNotificationTypeDto.class)));\n+\n+        assertThat(this.argumentRequestMessage.getValue()).usingRecursiveComparison().isEqualTo(expectedRequestMessage);\n+        assertThat(this.argumentMessageType.getValue()).isEqualTo(TEST_MESSAGE_TYPE);\n+        assertThat(this.argumentPriority.getValue()).isEqualTo(1);\n+        assertThat(this.argumentIpAddress.getValue()).isEqualTo(TEST_IP);\n+    }\n+\n+    @Test\n+    public void testUpdateDeviceSslCertificationIsNull() throws FunctionalException {\n+        this.deviceManagementService.updateDeviceSslCertification(TEST_ORGANISATION, TEST_DEVICE, TEST_UID, null,\n+                TEST_MESSAGE_TYPE, 1);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f55fc92905535fe980310db71a46bfe40f21259a"}, "originalPosition": 130}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMDY3NjA2Mg==", "bodyText": "use TEST_PRIORITY here", "url": "https://github.com/OSGP/open-smart-grid-platform/pull/435#discussion_r510676062", "createdAt": "2020-10-23T07:03:26Z", "author": {"login": "robindenadel"}, "path": "osgp/platform/osgp-adapter-domain-core/src/test/java/org/opensmartgridplatform/adapter/domain/core/application/services/DeviceManagementServiceTest.java", "diffHunk": "@@ -0,0 +1,231 @@\n+package org.opensmartgridplatform.adapter.domain.core.application.services;\n+\n+import static org.assertj.core.api.Assertions.assertThat;\n+import static org.mockito.ArgumentMatchers.any;\n+import static org.mockito.Mockito.mock;\n+import static org.mockito.Mockito.verify;\n+import static org.mockito.Mockito.verifyNoInteractions;\n+import static org.mockito.Mockito.when;\n+\n+import java.io.Serializable;\n+import java.util.Arrays;\n+import java.util.List;\n+\n+import org.junit.jupiter.api.BeforeEach;\n+import org.junit.jupiter.api.Test;\n+import org.junit.jupiter.api.extension.ExtendWith;\n+import org.mockito.ArgumentCaptor;\n+import org.mockito.Captor;\n+import org.mockito.InjectMocks;\n+import org.mockito.Mock;\n+import org.mockito.junit.jupiter.MockitoExtension;\n+import org.opensmartgridplatform.adapter.domain.core.application.mapping.DomainCoreMapper;\n+import org.opensmartgridplatform.adapter.domain.core.infra.jms.core.OsgpCoreRequestMessageSender;\n+import org.opensmartgridplatform.adapter.domain.core.infra.jms.ws.WebServiceResponseMessageSender;\n+import org.opensmartgridplatform.domain.core.entities.Device;\n+import org.opensmartgridplatform.domain.core.entities.Organisation;\n+import org.opensmartgridplatform.domain.core.exceptions.UnknownEntityException;\n+import org.opensmartgridplatform.domain.core.services.DeviceDomainService;\n+import org.opensmartgridplatform.domain.core.services.OrganisationDomainService;\n+import org.opensmartgridplatform.domain.core.valueobjects.CdmaSettings;\n+import org.opensmartgridplatform.domain.core.valueobjects.Certification;\n+import org.opensmartgridplatform.domain.core.valueobjects.DeviceLifecycleStatus;\n+import org.opensmartgridplatform.domain.core.valueobjects.EventNotificationType;\n+import org.opensmartgridplatform.dto.valueobjects.EventNotificationMessageDataContainerDto;\n+import org.opensmartgridplatform.shared.exceptionhandling.ComponentType;\n+import org.opensmartgridplatform.shared.exceptionhandling.FunctionalException;\n+import org.opensmartgridplatform.shared.infra.jms.RequestMessage;\n+import org.opensmartgridplatform.shared.infra.jms.ResponseMessage;\n+import org.opensmartgridplatform.shared.infra.jms.ResponseMessageResultType;\n+\n+/**\n+ * Copyright 2020 Alliander N.V.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\"); you may not use this file except in compliance\n+ * with the License.  You may obtain a copy of the License at\n+ *\n+ * http://www.apache.org/licenses/LICENSE-2.0\n+ */\n+\n+@ExtendWith(MockitoExtension.class)\n+public class DeviceManagementServiceTest {\n+\n+    private static final String TEST_ORGANISATION = \"testOrganisation\";\n+    private static final String TEST_DEVICE = \"testDevice\";\n+    private static final String TEST_IP = \"testIp\";\n+    private static final String TEST_UID = \"testUid\";\n+    private static final String TEST_MESSAGE_TYPE = \"testMessageType\";\n+\n+    @Mock\n+    private TransactionalDeviceService transactionalDeviceService;\n+\n+    @Mock\n+    private DeviceDomainService deviceDomainService;\n+\n+    @Mock\n+    private DomainCoreMapper domainCoreMapper;\n+\n+    @Mock\n+    private OsgpCoreRequestMessageSender osgpCoreRequestManager;\n+\n+    @Mock\n+    private WebServiceResponseMessageSender webServiceResponseMessageSender;\n+\n+    @Mock\n+    private OrganisationDomainService organisationDomainService;\n+\n+    @InjectMocks\n+    private DeviceManagementService deviceManagementService;\n+\n+    @Captor\n+    private ArgumentCaptor<RequestMessage> argumentRequestMessage;\n+\n+    @Captor\n+    private ArgumentCaptor<ResponseMessage> argumentResponseMessage;\n+\n+    @Captor\n+    private ArgumentCaptor<String> argumentMessageType;\n+\n+    @Captor\n+    private ArgumentCaptor<String> argumentIpAddress;\n+\n+    @Captor\n+    private ArgumentCaptor<String> argumentDeviceIdentification;\n+\n+    @Captor\n+    private ArgumentCaptor<Integer> argumentPriority;\n+\n+    @BeforeEach\n+    public void init() throws UnknownEntityException {\n+        when(this.organisationDomainService.searchOrganisation(any())).thenReturn(new Organisation());\n+    }\n+\n+    @Test\n+    public void testSetEventNotifications() throws FunctionalException {\n+        final List<EventNotificationType> eventNotifications = Arrays.asList(EventNotificationType.COMM_EVENTS,\n+                EventNotificationType.DIAG_EVENTS);\n+        final Device device = mock(Device.class);\n+        when(device.getIpAddress()).thenReturn(TEST_IP);\n+        when(this.deviceDomainService.searchActiveDevice(TEST_DEVICE, ComponentType.DOMAIN_CORE)).thenReturn(device);\n+\n+        this.deviceManagementService.setEventNotifications(TEST_ORGANISATION, TEST_DEVICE, TEST_UID,\n+                eventNotifications, TEST_MESSAGE_TYPE, 1);\n+\n+        verify(this.osgpCoreRequestManager).send(this.argumentRequestMessage.capture(),\n+                this.argumentMessageType.capture(), this.argumentPriority.capture(), this.argumentIpAddress.capture());\n+\n+        final RequestMessage expectedRequestMessage = this.createNewRequestMessage(\n+                new EventNotificationMessageDataContainerDto(this.domainCoreMapper.mapAsList(eventNotifications,\n+                        org.opensmartgridplatform.dto.valueobjects.EventNotificationTypeDto.class)));\n+\n+        assertThat(this.argumentRequestMessage.getValue()).usingRecursiveComparison().isEqualTo(expectedRequestMessage);\n+        assertThat(this.argumentMessageType.getValue()).isEqualTo(TEST_MESSAGE_TYPE);\n+        assertThat(this.argumentPriority.getValue()).isEqualTo(1);\n+        assertThat(this.argumentIpAddress.getValue()).isEqualTo(TEST_IP);\n+    }\n+\n+    @Test\n+    public void testUpdateDeviceSslCertificationIsNull() throws FunctionalException {\n+        this.deviceManagementService.updateDeviceSslCertification(TEST_ORGANISATION, TEST_DEVICE, TEST_UID, null,\n+                TEST_MESSAGE_TYPE, 1);\n+\n+        //This method is not called since it comes after the check of the certificate\n+        verifyNoInteractions(this.domainCoreMapper);\n+    }\n+\n+    @Test\n+    public void testUpdateDeviceSslCertification() throws FunctionalException {\n+        final Device device = mock(Device.class);\n+        when(device.getIpAddress()).thenReturn(TEST_IP);\n+        when(this.deviceDomainService.searchActiveDevice(TEST_DEVICE, ComponentType.DOMAIN_CORE)).thenReturn(device);\n+        final Certification certification = new Certification(\"testUrl\", \"testDomain\");\n+\n+        this.deviceManagementService.updateDeviceSslCertification(TEST_ORGANISATION, TEST_DEVICE, TEST_UID,\n+                certification, TEST_MESSAGE_TYPE, 1);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f55fc92905535fe980310db71a46bfe40f21259a"}, "originalPosition": 144}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMDY3NjE0Mw==", "bodyText": "use TEST_PRIORITY here", "url": "https://github.com/OSGP/open-smart-grid-platform/pull/435#discussion_r510676143", "createdAt": "2020-10-23T07:03:39Z", "author": {"login": "robindenadel"}, "path": "osgp/platform/osgp-adapter-domain-core/src/test/java/org/opensmartgridplatform/adapter/domain/core/application/services/DeviceManagementServiceTest.java", "diffHunk": "@@ -0,0 +1,231 @@\n+package org.opensmartgridplatform.adapter.domain.core.application.services;\n+\n+import static org.assertj.core.api.Assertions.assertThat;\n+import static org.mockito.ArgumentMatchers.any;\n+import static org.mockito.Mockito.mock;\n+import static org.mockito.Mockito.verify;\n+import static org.mockito.Mockito.verifyNoInteractions;\n+import static org.mockito.Mockito.when;\n+\n+import java.io.Serializable;\n+import java.util.Arrays;\n+import java.util.List;\n+\n+import org.junit.jupiter.api.BeforeEach;\n+import org.junit.jupiter.api.Test;\n+import org.junit.jupiter.api.extension.ExtendWith;\n+import org.mockito.ArgumentCaptor;\n+import org.mockito.Captor;\n+import org.mockito.InjectMocks;\n+import org.mockito.Mock;\n+import org.mockito.junit.jupiter.MockitoExtension;\n+import org.opensmartgridplatform.adapter.domain.core.application.mapping.DomainCoreMapper;\n+import org.opensmartgridplatform.adapter.domain.core.infra.jms.core.OsgpCoreRequestMessageSender;\n+import org.opensmartgridplatform.adapter.domain.core.infra.jms.ws.WebServiceResponseMessageSender;\n+import org.opensmartgridplatform.domain.core.entities.Device;\n+import org.opensmartgridplatform.domain.core.entities.Organisation;\n+import org.opensmartgridplatform.domain.core.exceptions.UnknownEntityException;\n+import org.opensmartgridplatform.domain.core.services.DeviceDomainService;\n+import org.opensmartgridplatform.domain.core.services.OrganisationDomainService;\n+import org.opensmartgridplatform.domain.core.valueobjects.CdmaSettings;\n+import org.opensmartgridplatform.domain.core.valueobjects.Certification;\n+import org.opensmartgridplatform.domain.core.valueobjects.DeviceLifecycleStatus;\n+import org.opensmartgridplatform.domain.core.valueobjects.EventNotificationType;\n+import org.opensmartgridplatform.dto.valueobjects.EventNotificationMessageDataContainerDto;\n+import org.opensmartgridplatform.shared.exceptionhandling.ComponentType;\n+import org.opensmartgridplatform.shared.exceptionhandling.FunctionalException;\n+import org.opensmartgridplatform.shared.infra.jms.RequestMessage;\n+import org.opensmartgridplatform.shared.infra.jms.ResponseMessage;\n+import org.opensmartgridplatform.shared.infra.jms.ResponseMessageResultType;\n+\n+/**\n+ * Copyright 2020 Alliander N.V.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\"); you may not use this file except in compliance\n+ * with the License.  You may obtain a copy of the License at\n+ *\n+ * http://www.apache.org/licenses/LICENSE-2.0\n+ */\n+\n+@ExtendWith(MockitoExtension.class)\n+public class DeviceManagementServiceTest {\n+\n+    private static final String TEST_ORGANISATION = \"testOrganisation\";\n+    private static final String TEST_DEVICE = \"testDevice\";\n+    private static final String TEST_IP = \"testIp\";\n+    private static final String TEST_UID = \"testUid\";\n+    private static final String TEST_MESSAGE_TYPE = \"testMessageType\";\n+\n+    @Mock\n+    private TransactionalDeviceService transactionalDeviceService;\n+\n+    @Mock\n+    private DeviceDomainService deviceDomainService;\n+\n+    @Mock\n+    private DomainCoreMapper domainCoreMapper;\n+\n+    @Mock\n+    private OsgpCoreRequestMessageSender osgpCoreRequestManager;\n+\n+    @Mock\n+    private WebServiceResponseMessageSender webServiceResponseMessageSender;\n+\n+    @Mock\n+    private OrganisationDomainService organisationDomainService;\n+\n+    @InjectMocks\n+    private DeviceManagementService deviceManagementService;\n+\n+    @Captor\n+    private ArgumentCaptor<RequestMessage> argumentRequestMessage;\n+\n+    @Captor\n+    private ArgumentCaptor<ResponseMessage> argumentResponseMessage;\n+\n+    @Captor\n+    private ArgumentCaptor<String> argumentMessageType;\n+\n+    @Captor\n+    private ArgumentCaptor<String> argumentIpAddress;\n+\n+    @Captor\n+    private ArgumentCaptor<String> argumentDeviceIdentification;\n+\n+    @Captor\n+    private ArgumentCaptor<Integer> argumentPriority;\n+\n+    @BeforeEach\n+    public void init() throws UnknownEntityException {\n+        when(this.organisationDomainService.searchOrganisation(any())).thenReturn(new Organisation());\n+    }\n+\n+    @Test\n+    public void testSetEventNotifications() throws FunctionalException {\n+        final List<EventNotificationType> eventNotifications = Arrays.asList(EventNotificationType.COMM_EVENTS,\n+                EventNotificationType.DIAG_EVENTS);\n+        final Device device = mock(Device.class);\n+        when(device.getIpAddress()).thenReturn(TEST_IP);\n+        when(this.deviceDomainService.searchActiveDevice(TEST_DEVICE, ComponentType.DOMAIN_CORE)).thenReturn(device);\n+\n+        this.deviceManagementService.setEventNotifications(TEST_ORGANISATION, TEST_DEVICE, TEST_UID,\n+                eventNotifications, TEST_MESSAGE_TYPE, 1);\n+\n+        verify(this.osgpCoreRequestManager).send(this.argumentRequestMessage.capture(),\n+                this.argumentMessageType.capture(), this.argumentPriority.capture(), this.argumentIpAddress.capture());\n+\n+        final RequestMessage expectedRequestMessage = this.createNewRequestMessage(\n+                new EventNotificationMessageDataContainerDto(this.domainCoreMapper.mapAsList(eventNotifications,\n+                        org.opensmartgridplatform.dto.valueobjects.EventNotificationTypeDto.class)));\n+\n+        assertThat(this.argumentRequestMessage.getValue()).usingRecursiveComparison().isEqualTo(expectedRequestMessage);\n+        assertThat(this.argumentMessageType.getValue()).isEqualTo(TEST_MESSAGE_TYPE);\n+        assertThat(this.argumentPriority.getValue()).isEqualTo(1);\n+        assertThat(this.argumentIpAddress.getValue()).isEqualTo(TEST_IP);\n+    }\n+\n+    @Test\n+    public void testUpdateDeviceSslCertificationIsNull() throws FunctionalException {\n+        this.deviceManagementService.updateDeviceSslCertification(TEST_ORGANISATION, TEST_DEVICE, TEST_UID, null,\n+                TEST_MESSAGE_TYPE, 1);\n+\n+        //This method is not called since it comes after the check of the certificate\n+        verifyNoInteractions(this.domainCoreMapper);\n+    }\n+\n+    @Test\n+    public void testUpdateDeviceSslCertification() throws FunctionalException {\n+        final Device device = mock(Device.class);\n+        when(device.getIpAddress()).thenReturn(TEST_IP);\n+        when(this.deviceDomainService.searchActiveDevice(TEST_DEVICE, ComponentType.DOMAIN_CORE)).thenReturn(device);\n+        final Certification certification = new Certification(\"testUrl\", \"testDomain\");\n+\n+        this.deviceManagementService.updateDeviceSslCertification(TEST_ORGANISATION, TEST_DEVICE, TEST_UID,\n+                certification, TEST_MESSAGE_TYPE, 1);\n+\n+        verify(this.osgpCoreRequestManager).send(this.argumentRequestMessage.capture(),\n+                this.argumentMessageType.capture(), this.argumentPriority.capture(), this.argumentIpAddress.capture());\n+\n+        final RequestMessage expectedRequestMessage = this.createNewRequestMessage(this.domainCoreMapper.map(certification,\n+                org.opensmartgridplatform.dto.valueobjects.CertificationDto.class));\n+\n+        assertThat(this.argumentRequestMessage.getValue()).usingRecursiveComparison().isEqualTo(expectedRequestMessage);\n+        assertThat(this.argumentMessageType.getValue()).isEqualTo(TEST_MESSAGE_TYPE);\n+        assertThat(this.argumentPriority.getValue()).isEqualTo(1);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f55fc92905535fe980310db71a46bfe40f21259a"}, "originalPosition": 154}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMDY3NjIxNw==", "bodyText": "use TEST_PRIORITY here", "url": "https://github.com/OSGP/open-smart-grid-platform/pull/435#discussion_r510676217", "createdAt": "2020-10-23T07:03:48Z", "author": {"login": "robindenadel"}, "path": "osgp/platform/osgp-adapter-domain-core/src/test/java/org/opensmartgridplatform/adapter/domain/core/application/services/DeviceManagementServiceTest.java", "diffHunk": "@@ -0,0 +1,231 @@\n+package org.opensmartgridplatform.adapter.domain.core.application.services;\n+\n+import static org.assertj.core.api.Assertions.assertThat;\n+import static org.mockito.ArgumentMatchers.any;\n+import static org.mockito.Mockito.mock;\n+import static org.mockito.Mockito.verify;\n+import static org.mockito.Mockito.verifyNoInteractions;\n+import static org.mockito.Mockito.when;\n+\n+import java.io.Serializable;\n+import java.util.Arrays;\n+import java.util.List;\n+\n+import org.junit.jupiter.api.BeforeEach;\n+import org.junit.jupiter.api.Test;\n+import org.junit.jupiter.api.extension.ExtendWith;\n+import org.mockito.ArgumentCaptor;\n+import org.mockito.Captor;\n+import org.mockito.InjectMocks;\n+import org.mockito.Mock;\n+import org.mockito.junit.jupiter.MockitoExtension;\n+import org.opensmartgridplatform.adapter.domain.core.application.mapping.DomainCoreMapper;\n+import org.opensmartgridplatform.adapter.domain.core.infra.jms.core.OsgpCoreRequestMessageSender;\n+import org.opensmartgridplatform.adapter.domain.core.infra.jms.ws.WebServiceResponseMessageSender;\n+import org.opensmartgridplatform.domain.core.entities.Device;\n+import org.opensmartgridplatform.domain.core.entities.Organisation;\n+import org.opensmartgridplatform.domain.core.exceptions.UnknownEntityException;\n+import org.opensmartgridplatform.domain.core.services.DeviceDomainService;\n+import org.opensmartgridplatform.domain.core.services.OrganisationDomainService;\n+import org.opensmartgridplatform.domain.core.valueobjects.CdmaSettings;\n+import org.opensmartgridplatform.domain.core.valueobjects.Certification;\n+import org.opensmartgridplatform.domain.core.valueobjects.DeviceLifecycleStatus;\n+import org.opensmartgridplatform.domain.core.valueobjects.EventNotificationType;\n+import org.opensmartgridplatform.dto.valueobjects.EventNotificationMessageDataContainerDto;\n+import org.opensmartgridplatform.shared.exceptionhandling.ComponentType;\n+import org.opensmartgridplatform.shared.exceptionhandling.FunctionalException;\n+import org.opensmartgridplatform.shared.infra.jms.RequestMessage;\n+import org.opensmartgridplatform.shared.infra.jms.ResponseMessage;\n+import org.opensmartgridplatform.shared.infra.jms.ResponseMessageResultType;\n+\n+/**\n+ * Copyright 2020 Alliander N.V.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\"); you may not use this file except in compliance\n+ * with the License.  You may obtain a copy of the License at\n+ *\n+ * http://www.apache.org/licenses/LICENSE-2.0\n+ */\n+\n+@ExtendWith(MockitoExtension.class)\n+public class DeviceManagementServiceTest {\n+\n+    private static final String TEST_ORGANISATION = \"testOrganisation\";\n+    private static final String TEST_DEVICE = \"testDevice\";\n+    private static final String TEST_IP = \"testIp\";\n+    private static final String TEST_UID = \"testUid\";\n+    private static final String TEST_MESSAGE_TYPE = \"testMessageType\";\n+\n+    @Mock\n+    private TransactionalDeviceService transactionalDeviceService;\n+\n+    @Mock\n+    private DeviceDomainService deviceDomainService;\n+\n+    @Mock\n+    private DomainCoreMapper domainCoreMapper;\n+\n+    @Mock\n+    private OsgpCoreRequestMessageSender osgpCoreRequestManager;\n+\n+    @Mock\n+    private WebServiceResponseMessageSender webServiceResponseMessageSender;\n+\n+    @Mock\n+    private OrganisationDomainService organisationDomainService;\n+\n+    @InjectMocks\n+    private DeviceManagementService deviceManagementService;\n+\n+    @Captor\n+    private ArgumentCaptor<RequestMessage> argumentRequestMessage;\n+\n+    @Captor\n+    private ArgumentCaptor<ResponseMessage> argumentResponseMessage;\n+\n+    @Captor\n+    private ArgumentCaptor<String> argumentMessageType;\n+\n+    @Captor\n+    private ArgumentCaptor<String> argumentIpAddress;\n+\n+    @Captor\n+    private ArgumentCaptor<String> argumentDeviceIdentification;\n+\n+    @Captor\n+    private ArgumentCaptor<Integer> argumentPriority;\n+\n+    @BeforeEach\n+    public void init() throws UnknownEntityException {\n+        when(this.organisationDomainService.searchOrganisation(any())).thenReturn(new Organisation());\n+    }\n+\n+    @Test\n+    public void testSetEventNotifications() throws FunctionalException {\n+        final List<EventNotificationType> eventNotifications = Arrays.asList(EventNotificationType.COMM_EVENTS,\n+                EventNotificationType.DIAG_EVENTS);\n+        final Device device = mock(Device.class);\n+        when(device.getIpAddress()).thenReturn(TEST_IP);\n+        when(this.deviceDomainService.searchActiveDevice(TEST_DEVICE, ComponentType.DOMAIN_CORE)).thenReturn(device);\n+\n+        this.deviceManagementService.setEventNotifications(TEST_ORGANISATION, TEST_DEVICE, TEST_UID,\n+                eventNotifications, TEST_MESSAGE_TYPE, 1);\n+\n+        verify(this.osgpCoreRequestManager).send(this.argumentRequestMessage.capture(),\n+                this.argumentMessageType.capture(), this.argumentPriority.capture(), this.argumentIpAddress.capture());\n+\n+        final RequestMessage expectedRequestMessage = this.createNewRequestMessage(\n+                new EventNotificationMessageDataContainerDto(this.domainCoreMapper.mapAsList(eventNotifications,\n+                        org.opensmartgridplatform.dto.valueobjects.EventNotificationTypeDto.class)));\n+\n+        assertThat(this.argumentRequestMessage.getValue()).usingRecursiveComparison().isEqualTo(expectedRequestMessage);\n+        assertThat(this.argumentMessageType.getValue()).isEqualTo(TEST_MESSAGE_TYPE);\n+        assertThat(this.argumentPriority.getValue()).isEqualTo(1);\n+        assertThat(this.argumentIpAddress.getValue()).isEqualTo(TEST_IP);\n+    }\n+\n+    @Test\n+    public void testUpdateDeviceSslCertificationIsNull() throws FunctionalException {\n+        this.deviceManagementService.updateDeviceSslCertification(TEST_ORGANISATION, TEST_DEVICE, TEST_UID, null,\n+                TEST_MESSAGE_TYPE, 1);\n+\n+        //This method is not called since it comes after the check of the certificate\n+        verifyNoInteractions(this.domainCoreMapper);\n+    }\n+\n+    @Test\n+    public void testUpdateDeviceSslCertification() throws FunctionalException {\n+        final Device device = mock(Device.class);\n+        when(device.getIpAddress()).thenReturn(TEST_IP);\n+        when(this.deviceDomainService.searchActiveDevice(TEST_DEVICE, ComponentType.DOMAIN_CORE)).thenReturn(device);\n+        final Certification certification = new Certification(\"testUrl\", \"testDomain\");\n+\n+        this.deviceManagementService.updateDeviceSslCertification(TEST_ORGANISATION, TEST_DEVICE, TEST_UID,\n+                certification, TEST_MESSAGE_TYPE, 1);\n+\n+        verify(this.osgpCoreRequestManager).send(this.argumentRequestMessage.capture(),\n+                this.argumentMessageType.capture(), this.argumentPriority.capture(), this.argumentIpAddress.capture());\n+\n+        final RequestMessage expectedRequestMessage = this.createNewRequestMessage(this.domainCoreMapper.map(certification,\n+                org.opensmartgridplatform.dto.valueobjects.CertificationDto.class));\n+\n+        assertThat(this.argumentRequestMessage.getValue()).usingRecursiveComparison().isEqualTo(expectedRequestMessage);\n+        assertThat(this.argumentMessageType.getValue()).isEqualTo(TEST_MESSAGE_TYPE);\n+        assertThat(this.argumentPriority.getValue()).isEqualTo(1);\n+        assertThat(this.argumentIpAddress.getValue()).isEqualTo(TEST_IP);\n+    }\n+\n+    @Test\n+    public void testSetDeviceVerificationKeyIsNull() throws FunctionalException {\n+        this.deviceManagementService.setDeviceVerificationKey(TEST_ORGANISATION, TEST_DEVICE, TEST_UID, null,\n+                TEST_MESSAGE_TYPE, 1);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f55fc92905535fe980310db71a46bfe40f21259a"}, "originalPosition": 161}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMDY3NjI5Mw==", "bodyText": "use TEST_PRIORITY here", "url": "https://github.com/OSGP/open-smart-grid-platform/pull/435#discussion_r510676293", "createdAt": "2020-10-23T07:03:59Z", "author": {"login": "robindenadel"}, "path": "osgp/platform/osgp-adapter-domain-core/src/test/java/org/opensmartgridplatform/adapter/domain/core/application/services/DeviceManagementServiceTest.java", "diffHunk": "@@ -0,0 +1,231 @@\n+package org.opensmartgridplatform.adapter.domain.core.application.services;\n+\n+import static org.assertj.core.api.Assertions.assertThat;\n+import static org.mockito.ArgumentMatchers.any;\n+import static org.mockito.Mockito.mock;\n+import static org.mockito.Mockito.verify;\n+import static org.mockito.Mockito.verifyNoInteractions;\n+import static org.mockito.Mockito.when;\n+\n+import java.io.Serializable;\n+import java.util.Arrays;\n+import java.util.List;\n+\n+import org.junit.jupiter.api.BeforeEach;\n+import org.junit.jupiter.api.Test;\n+import org.junit.jupiter.api.extension.ExtendWith;\n+import org.mockito.ArgumentCaptor;\n+import org.mockito.Captor;\n+import org.mockito.InjectMocks;\n+import org.mockito.Mock;\n+import org.mockito.junit.jupiter.MockitoExtension;\n+import org.opensmartgridplatform.adapter.domain.core.application.mapping.DomainCoreMapper;\n+import org.opensmartgridplatform.adapter.domain.core.infra.jms.core.OsgpCoreRequestMessageSender;\n+import org.opensmartgridplatform.adapter.domain.core.infra.jms.ws.WebServiceResponseMessageSender;\n+import org.opensmartgridplatform.domain.core.entities.Device;\n+import org.opensmartgridplatform.domain.core.entities.Organisation;\n+import org.opensmartgridplatform.domain.core.exceptions.UnknownEntityException;\n+import org.opensmartgridplatform.domain.core.services.DeviceDomainService;\n+import org.opensmartgridplatform.domain.core.services.OrganisationDomainService;\n+import org.opensmartgridplatform.domain.core.valueobjects.CdmaSettings;\n+import org.opensmartgridplatform.domain.core.valueobjects.Certification;\n+import org.opensmartgridplatform.domain.core.valueobjects.DeviceLifecycleStatus;\n+import org.opensmartgridplatform.domain.core.valueobjects.EventNotificationType;\n+import org.opensmartgridplatform.dto.valueobjects.EventNotificationMessageDataContainerDto;\n+import org.opensmartgridplatform.shared.exceptionhandling.ComponentType;\n+import org.opensmartgridplatform.shared.exceptionhandling.FunctionalException;\n+import org.opensmartgridplatform.shared.infra.jms.RequestMessage;\n+import org.opensmartgridplatform.shared.infra.jms.ResponseMessage;\n+import org.opensmartgridplatform.shared.infra.jms.ResponseMessageResultType;\n+\n+/**\n+ * Copyright 2020 Alliander N.V.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\"); you may not use this file except in compliance\n+ * with the License.  You may obtain a copy of the License at\n+ *\n+ * http://www.apache.org/licenses/LICENSE-2.0\n+ */\n+\n+@ExtendWith(MockitoExtension.class)\n+public class DeviceManagementServiceTest {\n+\n+    private static final String TEST_ORGANISATION = \"testOrganisation\";\n+    private static final String TEST_DEVICE = \"testDevice\";\n+    private static final String TEST_IP = \"testIp\";\n+    private static final String TEST_UID = \"testUid\";\n+    private static final String TEST_MESSAGE_TYPE = \"testMessageType\";\n+\n+    @Mock\n+    private TransactionalDeviceService transactionalDeviceService;\n+\n+    @Mock\n+    private DeviceDomainService deviceDomainService;\n+\n+    @Mock\n+    private DomainCoreMapper domainCoreMapper;\n+\n+    @Mock\n+    private OsgpCoreRequestMessageSender osgpCoreRequestManager;\n+\n+    @Mock\n+    private WebServiceResponseMessageSender webServiceResponseMessageSender;\n+\n+    @Mock\n+    private OrganisationDomainService organisationDomainService;\n+\n+    @InjectMocks\n+    private DeviceManagementService deviceManagementService;\n+\n+    @Captor\n+    private ArgumentCaptor<RequestMessage> argumentRequestMessage;\n+\n+    @Captor\n+    private ArgumentCaptor<ResponseMessage> argumentResponseMessage;\n+\n+    @Captor\n+    private ArgumentCaptor<String> argumentMessageType;\n+\n+    @Captor\n+    private ArgumentCaptor<String> argumentIpAddress;\n+\n+    @Captor\n+    private ArgumentCaptor<String> argumentDeviceIdentification;\n+\n+    @Captor\n+    private ArgumentCaptor<Integer> argumentPriority;\n+\n+    @BeforeEach\n+    public void init() throws UnknownEntityException {\n+        when(this.organisationDomainService.searchOrganisation(any())).thenReturn(new Organisation());\n+    }\n+\n+    @Test\n+    public void testSetEventNotifications() throws FunctionalException {\n+        final List<EventNotificationType> eventNotifications = Arrays.asList(EventNotificationType.COMM_EVENTS,\n+                EventNotificationType.DIAG_EVENTS);\n+        final Device device = mock(Device.class);\n+        when(device.getIpAddress()).thenReturn(TEST_IP);\n+        when(this.deviceDomainService.searchActiveDevice(TEST_DEVICE, ComponentType.DOMAIN_CORE)).thenReturn(device);\n+\n+        this.deviceManagementService.setEventNotifications(TEST_ORGANISATION, TEST_DEVICE, TEST_UID,\n+                eventNotifications, TEST_MESSAGE_TYPE, 1);\n+\n+        verify(this.osgpCoreRequestManager).send(this.argumentRequestMessage.capture(),\n+                this.argumentMessageType.capture(), this.argumentPriority.capture(), this.argumentIpAddress.capture());\n+\n+        final RequestMessage expectedRequestMessage = this.createNewRequestMessage(\n+                new EventNotificationMessageDataContainerDto(this.domainCoreMapper.mapAsList(eventNotifications,\n+                        org.opensmartgridplatform.dto.valueobjects.EventNotificationTypeDto.class)));\n+\n+        assertThat(this.argumentRequestMessage.getValue()).usingRecursiveComparison().isEqualTo(expectedRequestMessage);\n+        assertThat(this.argumentMessageType.getValue()).isEqualTo(TEST_MESSAGE_TYPE);\n+        assertThat(this.argumentPriority.getValue()).isEqualTo(1);\n+        assertThat(this.argumentIpAddress.getValue()).isEqualTo(TEST_IP);\n+    }\n+\n+    @Test\n+    public void testUpdateDeviceSslCertificationIsNull() throws FunctionalException {\n+        this.deviceManagementService.updateDeviceSslCertification(TEST_ORGANISATION, TEST_DEVICE, TEST_UID, null,\n+                TEST_MESSAGE_TYPE, 1);\n+\n+        //This method is not called since it comes after the check of the certificate\n+        verifyNoInteractions(this.domainCoreMapper);\n+    }\n+\n+    @Test\n+    public void testUpdateDeviceSslCertification() throws FunctionalException {\n+        final Device device = mock(Device.class);\n+        when(device.getIpAddress()).thenReturn(TEST_IP);\n+        when(this.deviceDomainService.searchActiveDevice(TEST_DEVICE, ComponentType.DOMAIN_CORE)).thenReturn(device);\n+        final Certification certification = new Certification(\"testUrl\", \"testDomain\");\n+\n+        this.deviceManagementService.updateDeviceSslCertification(TEST_ORGANISATION, TEST_DEVICE, TEST_UID,\n+                certification, TEST_MESSAGE_TYPE, 1);\n+\n+        verify(this.osgpCoreRequestManager).send(this.argumentRequestMessage.capture(),\n+                this.argumentMessageType.capture(), this.argumentPriority.capture(), this.argumentIpAddress.capture());\n+\n+        final RequestMessage expectedRequestMessage = this.createNewRequestMessage(this.domainCoreMapper.map(certification,\n+                org.opensmartgridplatform.dto.valueobjects.CertificationDto.class));\n+\n+        assertThat(this.argumentRequestMessage.getValue()).usingRecursiveComparison().isEqualTo(expectedRequestMessage);\n+        assertThat(this.argumentMessageType.getValue()).isEqualTo(TEST_MESSAGE_TYPE);\n+        assertThat(this.argumentPriority.getValue()).isEqualTo(1);\n+        assertThat(this.argumentIpAddress.getValue()).isEqualTo(TEST_IP);\n+    }\n+\n+    @Test\n+    public void testSetDeviceVerificationKeyIsNull() throws FunctionalException {\n+        this.deviceManagementService.setDeviceVerificationKey(TEST_ORGANISATION, TEST_DEVICE, TEST_UID, null,\n+                TEST_MESSAGE_TYPE, 1);\n+\n+        //This method is not called since it comes after the check of the verification\n+        verifyNoInteractions(this.osgpCoreRequestManager);\n+    }\n+\n+    @Test\n+    public void testSetDeviceVerificationKey() throws FunctionalException {\n+        final Device device = mock(Device.class);\n+        when(device.getIpAddress()).thenReturn(TEST_IP);\n+        when(this.deviceDomainService.searchActiveDevice(TEST_DEVICE, ComponentType.DOMAIN_CORE)).thenReturn(device);\n+        this.deviceManagementService.setDeviceVerificationKey(TEST_ORGANISATION, TEST_DEVICE, TEST_UID, \"testKey\",\n+                TEST_MESSAGE_TYPE, 1);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f55fc92905535fe980310db71a46bfe40f21259a"}, "originalPosition": 173}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMDY3NjM2Nw==", "bodyText": "use TEST_PRIORITY here", "url": "https://github.com/OSGP/open-smart-grid-platform/pull/435#discussion_r510676367", "createdAt": "2020-10-23T07:04:08Z", "author": {"login": "robindenadel"}, "path": "osgp/platform/osgp-adapter-domain-core/src/test/java/org/opensmartgridplatform/adapter/domain/core/application/services/DeviceManagementServiceTest.java", "diffHunk": "@@ -0,0 +1,231 @@\n+package org.opensmartgridplatform.adapter.domain.core.application.services;\n+\n+import static org.assertj.core.api.Assertions.assertThat;\n+import static org.mockito.ArgumentMatchers.any;\n+import static org.mockito.Mockito.mock;\n+import static org.mockito.Mockito.verify;\n+import static org.mockito.Mockito.verifyNoInteractions;\n+import static org.mockito.Mockito.when;\n+\n+import java.io.Serializable;\n+import java.util.Arrays;\n+import java.util.List;\n+\n+import org.junit.jupiter.api.BeforeEach;\n+import org.junit.jupiter.api.Test;\n+import org.junit.jupiter.api.extension.ExtendWith;\n+import org.mockito.ArgumentCaptor;\n+import org.mockito.Captor;\n+import org.mockito.InjectMocks;\n+import org.mockito.Mock;\n+import org.mockito.junit.jupiter.MockitoExtension;\n+import org.opensmartgridplatform.adapter.domain.core.application.mapping.DomainCoreMapper;\n+import org.opensmartgridplatform.adapter.domain.core.infra.jms.core.OsgpCoreRequestMessageSender;\n+import org.opensmartgridplatform.adapter.domain.core.infra.jms.ws.WebServiceResponseMessageSender;\n+import org.opensmartgridplatform.domain.core.entities.Device;\n+import org.opensmartgridplatform.domain.core.entities.Organisation;\n+import org.opensmartgridplatform.domain.core.exceptions.UnknownEntityException;\n+import org.opensmartgridplatform.domain.core.services.DeviceDomainService;\n+import org.opensmartgridplatform.domain.core.services.OrganisationDomainService;\n+import org.opensmartgridplatform.domain.core.valueobjects.CdmaSettings;\n+import org.opensmartgridplatform.domain.core.valueobjects.Certification;\n+import org.opensmartgridplatform.domain.core.valueobjects.DeviceLifecycleStatus;\n+import org.opensmartgridplatform.domain.core.valueobjects.EventNotificationType;\n+import org.opensmartgridplatform.dto.valueobjects.EventNotificationMessageDataContainerDto;\n+import org.opensmartgridplatform.shared.exceptionhandling.ComponentType;\n+import org.opensmartgridplatform.shared.exceptionhandling.FunctionalException;\n+import org.opensmartgridplatform.shared.infra.jms.RequestMessage;\n+import org.opensmartgridplatform.shared.infra.jms.ResponseMessage;\n+import org.opensmartgridplatform.shared.infra.jms.ResponseMessageResultType;\n+\n+/**\n+ * Copyright 2020 Alliander N.V.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\"); you may not use this file except in compliance\n+ * with the License.  You may obtain a copy of the License at\n+ *\n+ * http://www.apache.org/licenses/LICENSE-2.0\n+ */\n+\n+@ExtendWith(MockitoExtension.class)\n+public class DeviceManagementServiceTest {\n+\n+    private static final String TEST_ORGANISATION = \"testOrganisation\";\n+    private static final String TEST_DEVICE = \"testDevice\";\n+    private static final String TEST_IP = \"testIp\";\n+    private static final String TEST_UID = \"testUid\";\n+    private static final String TEST_MESSAGE_TYPE = \"testMessageType\";\n+\n+    @Mock\n+    private TransactionalDeviceService transactionalDeviceService;\n+\n+    @Mock\n+    private DeviceDomainService deviceDomainService;\n+\n+    @Mock\n+    private DomainCoreMapper domainCoreMapper;\n+\n+    @Mock\n+    private OsgpCoreRequestMessageSender osgpCoreRequestManager;\n+\n+    @Mock\n+    private WebServiceResponseMessageSender webServiceResponseMessageSender;\n+\n+    @Mock\n+    private OrganisationDomainService organisationDomainService;\n+\n+    @InjectMocks\n+    private DeviceManagementService deviceManagementService;\n+\n+    @Captor\n+    private ArgumentCaptor<RequestMessage> argumentRequestMessage;\n+\n+    @Captor\n+    private ArgumentCaptor<ResponseMessage> argumentResponseMessage;\n+\n+    @Captor\n+    private ArgumentCaptor<String> argumentMessageType;\n+\n+    @Captor\n+    private ArgumentCaptor<String> argumentIpAddress;\n+\n+    @Captor\n+    private ArgumentCaptor<String> argumentDeviceIdentification;\n+\n+    @Captor\n+    private ArgumentCaptor<Integer> argumentPriority;\n+\n+    @BeforeEach\n+    public void init() throws UnknownEntityException {\n+        when(this.organisationDomainService.searchOrganisation(any())).thenReturn(new Organisation());\n+    }\n+\n+    @Test\n+    public void testSetEventNotifications() throws FunctionalException {\n+        final List<EventNotificationType> eventNotifications = Arrays.asList(EventNotificationType.COMM_EVENTS,\n+                EventNotificationType.DIAG_EVENTS);\n+        final Device device = mock(Device.class);\n+        when(device.getIpAddress()).thenReturn(TEST_IP);\n+        when(this.deviceDomainService.searchActiveDevice(TEST_DEVICE, ComponentType.DOMAIN_CORE)).thenReturn(device);\n+\n+        this.deviceManagementService.setEventNotifications(TEST_ORGANISATION, TEST_DEVICE, TEST_UID,\n+                eventNotifications, TEST_MESSAGE_TYPE, 1);\n+\n+        verify(this.osgpCoreRequestManager).send(this.argumentRequestMessage.capture(),\n+                this.argumentMessageType.capture(), this.argumentPriority.capture(), this.argumentIpAddress.capture());\n+\n+        final RequestMessage expectedRequestMessage = this.createNewRequestMessage(\n+                new EventNotificationMessageDataContainerDto(this.domainCoreMapper.mapAsList(eventNotifications,\n+                        org.opensmartgridplatform.dto.valueobjects.EventNotificationTypeDto.class)));\n+\n+        assertThat(this.argumentRequestMessage.getValue()).usingRecursiveComparison().isEqualTo(expectedRequestMessage);\n+        assertThat(this.argumentMessageType.getValue()).isEqualTo(TEST_MESSAGE_TYPE);\n+        assertThat(this.argumentPriority.getValue()).isEqualTo(1);\n+        assertThat(this.argumentIpAddress.getValue()).isEqualTo(TEST_IP);\n+    }\n+\n+    @Test\n+    public void testUpdateDeviceSslCertificationIsNull() throws FunctionalException {\n+        this.deviceManagementService.updateDeviceSslCertification(TEST_ORGANISATION, TEST_DEVICE, TEST_UID, null,\n+                TEST_MESSAGE_TYPE, 1);\n+\n+        //This method is not called since it comes after the check of the certificate\n+        verifyNoInteractions(this.domainCoreMapper);\n+    }\n+\n+    @Test\n+    public void testUpdateDeviceSslCertification() throws FunctionalException {\n+        final Device device = mock(Device.class);\n+        when(device.getIpAddress()).thenReturn(TEST_IP);\n+        when(this.deviceDomainService.searchActiveDevice(TEST_DEVICE, ComponentType.DOMAIN_CORE)).thenReturn(device);\n+        final Certification certification = new Certification(\"testUrl\", \"testDomain\");\n+\n+        this.deviceManagementService.updateDeviceSslCertification(TEST_ORGANISATION, TEST_DEVICE, TEST_UID,\n+                certification, TEST_MESSAGE_TYPE, 1);\n+\n+        verify(this.osgpCoreRequestManager).send(this.argumentRequestMessage.capture(),\n+                this.argumentMessageType.capture(), this.argumentPriority.capture(), this.argumentIpAddress.capture());\n+\n+        final RequestMessage expectedRequestMessage = this.createNewRequestMessage(this.domainCoreMapper.map(certification,\n+                org.opensmartgridplatform.dto.valueobjects.CertificationDto.class));\n+\n+        assertThat(this.argumentRequestMessage.getValue()).usingRecursiveComparison().isEqualTo(expectedRequestMessage);\n+        assertThat(this.argumentMessageType.getValue()).isEqualTo(TEST_MESSAGE_TYPE);\n+        assertThat(this.argumentPriority.getValue()).isEqualTo(1);\n+        assertThat(this.argumentIpAddress.getValue()).isEqualTo(TEST_IP);\n+    }\n+\n+    @Test\n+    public void testSetDeviceVerificationKeyIsNull() throws FunctionalException {\n+        this.deviceManagementService.setDeviceVerificationKey(TEST_ORGANISATION, TEST_DEVICE, TEST_UID, null,\n+                TEST_MESSAGE_TYPE, 1);\n+\n+        //This method is not called since it comes after the check of the verification\n+        verifyNoInteractions(this.osgpCoreRequestManager);\n+    }\n+\n+    @Test\n+    public void testSetDeviceVerificationKey() throws FunctionalException {\n+        final Device device = mock(Device.class);\n+        when(device.getIpAddress()).thenReturn(TEST_IP);\n+        when(this.deviceDomainService.searchActiveDevice(TEST_DEVICE, ComponentType.DOMAIN_CORE)).thenReturn(device);\n+        this.deviceManagementService.setDeviceVerificationKey(TEST_ORGANISATION, TEST_DEVICE, TEST_UID, \"testKey\",\n+                TEST_MESSAGE_TYPE, 1);\n+\n+        verify(this.osgpCoreRequestManager).send(this.argumentRequestMessage.capture(),\n+                this.argumentMessageType.capture(), this.argumentPriority.capture(), this.argumentIpAddress.capture());\n+\n+        final RequestMessage expectedRequestMessage = this.createNewRequestMessage(\"testKey\");\n+\n+        assertThat(this.argumentRequestMessage.getValue()).usingRecursiveComparison().isEqualTo(expectedRequestMessage);\n+        assertThat(this.argumentMessageType.getValue()).isEqualTo(TEST_MESSAGE_TYPE);\n+        assertThat(this.argumentPriority.getValue()).isEqualTo(1);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f55fc92905535fe980310db71a46bfe40f21259a"}, "originalPosition": 182}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMDY3NzAxMw==", "bodyText": "import CertificationDto so you don't need to give the package name here", "url": "https://github.com/OSGP/open-smart-grid-platform/pull/435#discussion_r510677013", "createdAt": "2020-10-23T07:05:28Z", "author": {"login": "robindenadel"}, "path": "osgp/platform/osgp-adapter-domain-core/src/test/java/org/opensmartgridplatform/adapter/domain/core/application/services/DeviceManagementServiceTest.java", "diffHunk": "@@ -0,0 +1,231 @@\n+package org.opensmartgridplatform.adapter.domain.core.application.services;\n+\n+import static org.assertj.core.api.Assertions.assertThat;\n+import static org.mockito.ArgumentMatchers.any;\n+import static org.mockito.Mockito.mock;\n+import static org.mockito.Mockito.verify;\n+import static org.mockito.Mockito.verifyNoInteractions;\n+import static org.mockito.Mockito.when;\n+\n+import java.io.Serializable;\n+import java.util.Arrays;\n+import java.util.List;\n+\n+import org.junit.jupiter.api.BeforeEach;\n+import org.junit.jupiter.api.Test;\n+import org.junit.jupiter.api.extension.ExtendWith;\n+import org.mockito.ArgumentCaptor;\n+import org.mockito.Captor;\n+import org.mockito.InjectMocks;\n+import org.mockito.Mock;\n+import org.mockito.junit.jupiter.MockitoExtension;\n+import org.opensmartgridplatform.adapter.domain.core.application.mapping.DomainCoreMapper;\n+import org.opensmartgridplatform.adapter.domain.core.infra.jms.core.OsgpCoreRequestMessageSender;\n+import org.opensmartgridplatform.adapter.domain.core.infra.jms.ws.WebServiceResponseMessageSender;\n+import org.opensmartgridplatform.domain.core.entities.Device;\n+import org.opensmartgridplatform.domain.core.entities.Organisation;\n+import org.opensmartgridplatform.domain.core.exceptions.UnknownEntityException;\n+import org.opensmartgridplatform.domain.core.services.DeviceDomainService;\n+import org.opensmartgridplatform.domain.core.services.OrganisationDomainService;\n+import org.opensmartgridplatform.domain.core.valueobjects.CdmaSettings;\n+import org.opensmartgridplatform.domain.core.valueobjects.Certification;\n+import org.opensmartgridplatform.domain.core.valueobjects.DeviceLifecycleStatus;\n+import org.opensmartgridplatform.domain.core.valueobjects.EventNotificationType;\n+import org.opensmartgridplatform.dto.valueobjects.EventNotificationMessageDataContainerDto;\n+import org.opensmartgridplatform.shared.exceptionhandling.ComponentType;\n+import org.opensmartgridplatform.shared.exceptionhandling.FunctionalException;\n+import org.opensmartgridplatform.shared.infra.jms.RequestMessage;\n+import org.opensmartgridplatform.shared.infra.jms.ResponseMessage;\n+import org.opensmartgridplatform.shared.infra.jms.ResponseMessageResultType;\n+\n+/**\n+ * Copyright 2020 Alliander N.V.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\"); you may not use this file except in compliance\n+ * with the License.  You may obtain a copy of the License at\n+ *\n+ * http://www.apache.org/licenses/LICENSE-2.0\n+ */\n+\n+@ExtendWith(MockitoExtension.class)\n+public class DeviceManagementServiceTest {\n+\n+    private static final String TEST_ORGANISATION = \"testOrganisation\";\n+    private static final String TEST_DEVICE = \"testDevice\";\n+    private static final String TEST_IP = \"testIp\";\n+    private static final String TEST_UID = \"testUid\";\n+    private static final String TEST_MESSAGE_TYPE = \"testMessageType\";\n+\n+    @Mock\n+    private TransactionalDeviceService transactionalDeviceService;\n+\n+    @Mock\n+    private DeviceDomainService deviceDomainService;\n+\n+    @Mock\n+    private DomainCoreMapper domainCoreMapper;\n+\n+    @Mock\n+    private OsgpCoreRequestMessageSender osgpCoreRequestManager;\n+\n+    @Mock\n+    private WebServiceResponseMessageSender webServiceResponseMessageSender;\n+\n+    @Mock\n+    private OrganisationDomainService organisationDomainService;\n+\n+    @InjectMocks\n+    private DeviceManagementService deviceManagementService;\n+\n+    @Captor\n+    private ArgumentCaptor<RequestMessage> argumentRequestMessage;\n+\n+    @Captor\n+    private ArgumentCaptor<ResponseMessage> argumentResponseMessage;\n+\n+    @Captor\n+    private ArgumentCaptor<String> argumentMessageType;\n+\n+    @Captor\n+    private ArgumentCaptor<String> argumentIpAddress;\n+\n+    @Captor\n+    private ArgumentCaptor<String> argumentDeviceIdentification;\n+\n+    @Captor\n+    private ArgumentCaptor<Integer> argumentPriority;\n+\n+    @BeforeEach\n+    public void init() throws UnknownEntityException {\n+        when(this.organisationDomainService.searchOrganisation(any())).thenReturn(new Organisation());\n+    }\n+\n+    @Test\n+    public void testSetEventNotifications() throws FunctionalException {\n+        final List<EventNotificationType> eventNotifications = Arrays.asList(EventNotificationType.COMM_EVENTS,\n+                EventNotificationType.DIAG_EVENTS);\n+        final Device device = mock(Device.class);\n+        when(device.getIpAddress()).thenReturn(TEST_IP);\n+        when(this.deviceDomainService.searchActiveDevice(TEST_DEVICE, ComponentType.DOMAIN_CORE)).thenReturn(device);\n+\n+        this.deviceManagementService.setEventNotifications(TEST_ORGANISATION, TEST_DEVICE, TEST_UID,\n+                eventNotifications, TEST_MESSAGE_TYPE, 1);\n+\n+        verify(this.osgpCoreRequestManager).send(this.argumentRequestMessage.capture(),\n+                this.argumentMessageType.capture(), this.argumentPriority.capture(), this.argumentIpAddress.capture());\n+\n+        final RequestMessage expectedRequestMessage = this.createNewRequestMessage(\n+                new EventNotificationMessageDataContainerDto(this.domainCoreMapper.mapAsList(eventNotifications,\n+                        org.opensmartgridplatform.dto.valueobjects.EventNotificationTypeDto.class)));\n+\n+        assertThat(this.argumentRequestMessage.getValue()).usingRecursiveComparison().isEqualTo(expectedRequestMessage);\n+        assertThat(this.argumentMessageType.getValue()).isEqualTo(TEST_MESSAGE_TYPE);\n+        assertThat(this.argumentPriority.getValue()).isEqualTo(1);\n+        assertThat(this.argumentIpAddress.getValue()).isEqualTo(TEST_IP);\n+    }\n+\n+    @Test\n+    public void testUpdateDeviceSslCertificationIsNull() throws FunctionalException {\n+        this.deviceManagementService.updateDeviceSslCertification(TEST_ORGANISATION, TEST_DEVICE, TEST_UID, null,\n+                TEST_MESSAGE_TYPE, 1);\n+\n+        //This method is not called since it comes after the check of the certificate\n+        verifyNoInteractions(this.domainCoreMapper);\n+    }\n+\n+    @Test\n+    public void testUpdateDeviceSslCertification() throws FunctionalException {\n+        final Device device = mock(Device.class);\n+        when(device.getIpAddress()).thenReturn(TEST_IP);\n+        when(this.deviceDomainService.searchActiveDevice(TEST_DEVICE, ComponentType.DOMAIN_CORE)).thenReturn(device);\n+        final Certification certification = new Certification(\"testUrl\", \"testDomain\");\n+\n+        this.deviceManagementService.updateDeviceSslCertification(TEST_ORGANISATION, TEST_DEVICE, TEST_UID,\n+                certification, TEST_MESSAGE_TYPE, 1);\n+\n+        verify(this.osgpCoreRequestManager).send(this.argumentRequestMessage.capture(),\n+                this.argumentMessageType.capture(), this.argumentPriority.capture(), this.argumentIpAddress.capture());\n+\n+        final RequestMessage expectedRequestMessage = this.createNewRequestMessage(this.domainCoreMapper.map(certification,\n+                org.opensmartgridplatform.dto.valueobjects.CertificationDto.class));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f55fc92905535fe980310db71a46bfe40f21259a"}, "originalPosition": 150}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "8fe7091a2d72025c19bcc7960b649aac7f7323ef", "author": {"user": {"login": "MithraicMagic", "name": "Nick Walraven"}}, "url": "https://github.com/OSGP/open-smart-grid-platform/commit/8fe7091a2d72025c19bcc7960b649aac7f7323ef", "committedDate": "2020-10-27T15:22:27Z", "message": "- Moving License Header to top\n- Adding imports\n- Adding a new constant to replace 1 as test priority"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e72c5fabbad2661d3125c03323447275ee8ae3a9", "author": {"user": {"login": "MithraicMagic", "name": "Nick Walraven"}}, "url": "https://github.com/OSGP/open-smart-grid-platform/commit/e72c5fabbad2661d3125c03323447275ee8ae3a9", "committedDate": "2020-11-17T14:25:54Z", "message": "- Formatting code using Eclipse config"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTM5MDU4OTM0", "url": "https://github.com/OSGP/open-smart-grid-platform/pull/435#pullrequestreview-539058934", "createdAt": "2020-11-26T07:45:50Z", "commit": {"oid": "e72c5fabbad2661d3125c03323447275ee8ae3a9"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3638, "cost": 1, "resetAt": "2021-11-01T16:19:10Z"}}}