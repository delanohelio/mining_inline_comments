{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDkxMDEzMzUw", "number": 427, "title": "OC-648 Peakshaving: adapt the chain so the output given by a MQTT device is handled correctly", "bodyText": "", "createdAt": "2020-09-22T15:13:30Z", "url": "https://github.com/OSGP/open-smart-grid-platform/pull/427", "merged": true, "mergeCommit": {"oid": "f24b239e1d98bb5ef39614ffe18b0e1bffdfe589"}, "closed": true, "closedAt": "2020-09-30T14:01:44Z", "author": {"login": "JelleHoffman"}, "timelineItems": {"totalCount": 13, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdLTnfcAH2gAyNDkxMDEzMzUwOmJjZDQ1MzU1ZDY1MGFkNzFlYjFjMTljMWMwY2FhYTY5YmI5MWUzMzY=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdN4gcHAH2gAyNDkxMDEzMzUwOjczYTllMWFlZTRkZmM3ODg2YTc5NTQwMmMyYWU2MDljMjY3NmRhZWQ=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "bcd45355d650ad71eb1c19c1c0caaa69bb91e336", "author": {"user": {"login": "JelleHoffman", "name": "Jelle Hoffman"}}, "url": "https://github.com/OSGP/open-smart-grid-platform/commit/bcd45355d650ad71eb1c19c1c0caaa69bb91e336", "committedDate": "2020-09-22T08:21:44Z", "message": "Working Peakshaving test"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e299f02aa85f6e4470c183dfe05e46099d5e3c60", "author": {"user": {"login": "JelleHoffman", "name": "Jelle Hoffman"}}, "url": "https://github.com/OSGP/open-smart-grid-platform/commit/e299f02aa85f6e4470c183dfe05e46099d5e3c60", "committedDate": "2020-09-22T10:36:47Z", "message": "Jackson objectmapper"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "77e227edc3ef813cbc26712c9b8799c7faa64cf6", "author": {"user": {"login": "JelleHoffman", "name": "Jelle Hoffman"}}, "url": "https://github.com/OSGP/open-smart-grid-platform/commit/77e227edc3ef813cbc26712c9b8799c7faa64cf6", "committedDate": "2020-09-22T15:11:33Z", "message": "MQTT simulator"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ac890e63b659653a68ec1c9a3678cc30b018faaf", "author": {"user": {"login": "JelleHoffman", "name": "Jelle Hoffman"}}, "url": "https://github.com/OSGP/open-smart-grid-platform/commit/ac890e63b659653a68ec1c9a3678cc30b018faaf", "committedDate": "2020-09-22T15:12:00Z", "message": "Merge remote-tracking branch 'origin/development' into feature/OC-648-mqtt-device-peak-shaving"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e775a48652c46547e5a936e47ea0baedb2949739", "author": {"user": {"login": "JelleHoffman", "name": "Jelle Hoffman"}}, "url": "https://github.com/OSGP/open-smart-grid-platform/commit/e775a48652c46547e5a936e47ea0baedb2949739", "committedDate": "2020-09-23T08:01:49Z", "message": "Not starting the MQTT simulator on the jenkins server"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "46313ae5701d6a8c67a87cf0c11f894785bcdf68", "author": {"user": {"login": "JelleHoffman", "name": "Jelle Hoffman"}}, "url": "https://github.com/OSGP/open-smart-grid-platform/commit/46313ae5701d6a8c67a87cf0c11f894785bcdf68", "committedDate": "2020-09-23T13:26:00Z", "message": "Proper error throwing and removal off unused code"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e59bf1fb9ff161b2b6503fca0021f7cbacc5a154", "author": {"user": {"login": "JelleHoffman", "name": "Jelle Hoffman"}}, "url": "https://github.com/OSGP/open-smart-grid-platform/commit/e59bf1fb9ff161b2b6503fca0021f7cbacc5a154", "committedDate": "2020-09-24T13:15:04Z", "message": "Using a date converter to use the date of the created message"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ddad5dfedb3cf08243b1e179a12f4245dec3ee29", "author": {"user": {"login": "JelleHoffman", "name": "Jelle Hoffman"}}, "url": "https://github.com/OSGP/open-smart-grid-platform/commit/ddad5dfedb3cf08243b1e179a12f4245dec3ee29", "committedDate": "2020-09-24T15:20:10Z", "message": "Removal of simple messages"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDk4MjU4OTMx", "url": "https://github.com/OSGP/open-smart-grid-platform/pull/427#pullrequestreview-498258931", "createdAt": "2020-09-29T09:01:47Z", "commit": {"oid": "ddad5dfedb3cf08243b1e179a12f4245dec3ee29"}, "state": "COMMENTED", "comments": {"totalCount": 10, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yOVQwOTowMTo0N1rOHZjXXg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yOVQxMDo1NDowOVrOHZnhLA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NjU1NTg3MA==", "bodyText": "change in .getLogger(MqttDeviceSteps.class)", "url": "https://github.com/OSGP/open-smart-grid-platform/pull/427#discussion_r496555870", "createdAt": "2020-09-29T09:01:47Z", "author": {"login": "joostknapen"}, "path": "integration-tests/cucumber-tests-platform-distributionautomation/src/test/java/org/opensmartgridplatform/cucumber/platform/distributionautomation/glue/steps/MqttDeviceSteps.java", "diffHunk": "@@ -51,6 +53,8 @@\n     @Autowired\n     private PeakShavingConsumer consumer;\n \n+    private static final Logger LOGGER = LoggerFactory.getLogger(SimulatorSpecPublishingClient.class);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ddad5dfedb3cf08243b1e179a12f4245dec3ee29"}, "originalPosition": 13}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NjYwNjE2MQ==", "bodyText": "In case there is no 0'th element, a nullpointer exception will be thrown. Add a check for this.", "url": "https://github.com/OSGP/open-smart-grid-platform/pull/427#discussion_r496606161", "createdAt": "2020-09-29T10:21:16Z", "author": {"login": "joostknapen"}, "path": "osgp/platform/osgp-adapter-kafka-distributionautomation/src/main/java/org/opensmartgridplatform/adapter/kafka/da/application/mapping/GridMeasurementPublishedEventConverter.java", "diffHunk": "@@ -36,30 +45,84 @@\n \n     private static final Logger LOGGER = LoggerFactory.getLogger(GridMeasurementPublishedEventConverter.class);\n \n-    private static final int SIMPLE_END_INDEX = 10;\n+    private ObjectMapper objectMapper = new ObjectMapper();\n \n     @Override\n     public GridMeasurementPublishedEvent convert(final String source,\n             final Type<? extends GridMeasurementPublishedEvent> destinationType, final MappingContext mappingContext) {\n \n-        StringArrayToAnalogList stringArrayToAnalogList = null;\n-        final String[] values = source.split(\";\");\n-        if (values.length == SIMPLE_END_INDEX) {\n-            stringArrayToAnalogList = new SimpleStringToAnalogList();\n-        } else if (values.length == LsPeakShavingMeasurementType.getNumberOfElements() + 1) {\n-            stringArrayToAnalogList = new LsMeasurementMessageToAnalogList();\n-        } else {\n-            LOGGER.error(\"String '{}' does not have the expected amount of fields, abandoning conversion\", source);\n+        LsMeasurementMessageToAnalogList stringArrayToAnalogList = null;\n+        LOGGER.info(\"Source string: {}\", source);\n+\n+        try {\n+            final Payload payload = this.objectMapper.readValue(source, Payload[].class)[0];", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ddad5dfedb3cf08243b1e179a12f4245dec3ee29"}, "originalPosition": 47}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NjYwNjQ5Mg==", "bodyText": "change to .getLogger(MqttDeviceSteps.class);", "url": "https://github.com/OSGP/open-smart-grid-platform/pull/427#discussion_r496606492", "createdAt": "2020-09-29T10:21:54Z", "author": {"login": "joostknapen"}, "path": "integration-tests/cucumber-tests-platform-distributionautomation/src/test/java/org/opensmartgridplatform/cucumber/platform/distributionautomation/glue/steps/MqttDeviceSteps.java", "diffHunk": "@@ -51,6 +53,8 @@\n     @Autowired\n     private PeakShavingConsumer consumer;\n \n+    private static final Logger LOGGER = LoggerFactory.getLogger(SimulatorSpecPublishingClient.class);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ddad5dfedb3cf08243b1e179a12f4245dec3ee29"}, "originalPosition": 13}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NjYxMDU4Nw==", "bodyText": "I would make this a debug message instead of info, or even remove the message", "url": "https://github.com/OSGP/open-smart-grid-platform/pull/427#discussion_r496610587", "createdAt": "2020-09-29T10:29:15Z", "author": {"login": "joostknapen"}, "path": "osgp/platform/osgp-adapter-kafka-distributionautomation/src/main/java/org/opensmartgridplatform/adapter/kafka/da/application/mapping/GridMeasurementPublishedEventConverter.java", "diffHunk": "@@ -36,30 +45,84 @@\n \n     private static final Logger LOGGER = LoggerFactory.getLogger(GridMeasurementPublishedEventConverter.class);\n \n-    private static final int SIMPLE_END_INDEX = 10;\n+    private ObjectMapper objectMapper = new ObjectMapper();\n \n     @Override\n     public GridMeasurementPublishedEvent convert(final String source,\n             final Type<? extends GridMeasurementPublishedEvent> destinationType, final MappingContext mappingContext) {\n \n-        StringArrayToAnalogList stringArrayToAnalogList = null;\n-        final String[] values = source.split(\";\");\n-        if (values.length == SIMPLE_END_INDEX) {\n-            stringArrayToAnalogList = new SimpleStringToAnalogList();\n-        } else if (values.length == LsPeakShavingMeasurementType.getNumberOfElements() + 1) {\n-            stringArrayToAnalogList = new LsMeasurementMessageToAnalogList();\n-        } else {\n-            LOGGER.error(\"String '{}' does not have the expected amount of fields, abandoning conversion\", source);\n+        LsMeasurementMessageToAnalogList stringArrayToAnalogList = null;\n+        LOGGER.info(\"Source string: {}\", source);\n+\n+        try {\n+            final Payload payload = this.objectMapper.readValue(source, Payload[].class)[0];\n+\n+            final String[] values = (payload.gisnr + \", \" + String.join(\", \", payload.data)).split(\", \");\n+            LOGGER.info(\"Values length: {} and values: {}\", values.length, Arrays.toString(values));\n+\n+            if (values.length == LsPeakShavingMeasurementType.getNumberOfElements() + 1) {\n+                stringArrayToAnalogList = new LsMeasurementMessageToAnalogList();\n+            } else {\n+                LOGGER.error(\"String '{}' does not have the expected amount of fields, abandoning conversion\", source);\n+                return null;\n+            }\n+\n+            final String eanCode = values[0];\n+            final PowerSystemResource powerSystemResource = new PowerSystemResource(eanCode,\n+                    UUID.randomUUID().toString(), new ArrayList<Name>());\n+            final SimpleDateFormat dateFormat = new SimpleDateFormat(\"yyyy-mm-dd HH:mm:ss\");\n+            final Date date = dateFormat.parse(payload.date);\n+            final long createdDateTime = date.getTime();\n+            LOGGER.info(\"CreatedDateTime: {}\", createdDateTime);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ddad5dfedb3cf08243b1e179a12f4245dec3ee29"}, "originalPosition": 65}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NjYxMjMwOQ==", "bodyText": "I would make this a debug message instead of info. Also without knowing the java code the message is unclear. The only thing this messsage makes clear is that there is (or is not) a bug in the code, since  a few lines above, the Source string is already logged. In general, I think you should remove log messages that are only added to the code to make development itself easier", "url": "https://github.com/OSGP/open-smart-grid-platform/pull/427#discussion_r496612309", "createdAt": "2020-09-29T10:32:15Z", "author": {"login": "joostknapen"}, "path": "osgp/platform/osgp-adapter-kafka-distributionautomation/src/main/java/org/opensmartgridplatform/adapter/kafka/da/application/mapping/GridMeasurementPublishedEventConverter.java", "diffHunk": "@@ -36,30 +45,84 @@\n \n     private static final Logger LOGGER = LoggerFactory.getLogger(GridMeasurementPublishedEventConverter.class);\n \n-    private static final int SIMPLE_END_INDEX = 10;\n+    private ObjectMapper objectMapper = new ObjectMapper();\n \n     @Override\n     public GridMeasurementPublishedEvent convert(final String source,\n             final Type<? extends GridMeasurementPublishedEvent> destinationType, final MappingContext mappingContext) {\n \n-        StringArrayToAnalogList stringArrayToAnalogList = null;\n-        final String[] values = source.split(\";\");\n-        if (values.length == SIMPLE_END_INDEX) {\n-            stringArrayToAnalogList = new SimpleStringToAnalogList();\n-        } else if (values.length == LsPeakShavingMeasurementType.getNumberOfElements() + 1) {\n-            stringArrayToAnalogList = new LsMeasurementMessageToAnalogList();\n-        } else {\n-            LOGGER.error(\"String '{}' does not have the expected amount of fields, abandoning conversion\", source);\n+        LsMeasurementMessageToAnalogList stringArrayToAnalogList = null;\n+        LOGGER.info(\"Source string: {}\", source);\n+\n+        try {\n+            final Payload payload = this.objectMapper.readValue(source, Payload[].class)[0];\n+\n+            final String[] values = (payload.gisnr + \", \" + String.join(\", \", payload.data)).split(\", \");\n+            LOGGER.info(\"Values length: {} and values: {}\", values.length, Arrays.toString(values));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ddad5dfedb3cf08243b1e179a12f4245dec3ee29"}, "originalPosition": 50}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NjYxMjk4NA==", "bodyText": "In general, I prefer to return an Optional.empty, instead of null. But I noticed that many (if not all) converters are already returning null in case of a failed conversion", "url": "https://github.com/OSGP/open-smart-grid-platform/pull/427#discussion_r496612984", "createdAt": "2020-09-29T10:33:28Z", "author": {"login": "joostknapen"}, "path": "osgp/platform/osgp-adapter-kafka-distributionautomation/src/main/java/org/opensmartgridplatform/adapter/kafka/da/application/mapping/GridMeasurementPublishedEventConverter.java", "diffHunk": "@@ -36,30 +45,84 @@\n \n     private static final Logger LOGGER = LoggerFactory.getLogger(GridMeasurementPublishedEventConverter.class);\n \n-    private static final int SIMPLE_END_INDEX = 10;\n+    private ObjectMapper objectMapper = new ObjectMapper();\n \n     @Override\n     public GridMeasurementPublishedEvent convert(final String source,\n             final Type<? extends GridMeasurementPublishedEvent> destinationType, final MappingContext mappingContext) {\n \n-        StringArrayToAnalogList stringArrayToAnalogList = null;\n-        final String[] values = source.split(\";\");\n-        if (values.length == SIMPLE_END_INDEX) {\n-            stringArrayToAnalogList = new SimpleStringToAnalogList();\n-        } else if (values.length == LsPeakShavingMeasurementType.getNumberOfElements() + 1) {\n-            stringArrayToAnalogList = new LsMeasurementMessageToAnalogList();\n-        } else {\n-            LOGGER.error(\"String '{}' does not have the expected amount of fields, abandoning conversion\", source);\n+        LsMeasurementMessageToAnalogList stringArrayToAnalogList = null;\n+        LOGGER.info(\"Source string: {}\", source);\n+\n+        try {\n+            final Payload payload = this.objectMapper.readValue(source, Payload[].class)[0];\n+\n+            final String[] values = (payload.gisnr + \", \" + String.join(\", \", payload.data)).split(\", \");\n+            LOGGER.info(\"Values length: {} and values: {}\", values.length, Arrays.toString(values));\n+\n+            if (values.length == LsPeakShavingMeasurementType.getNumberOfElements() + 1) {\n+                stringArrayToAnalogList = new LsMeasurementMessageToAnalogList();\n+            } else {\n+                LOGGER.error(\"String '{}' does not have the expected amount of fields, abandoning conversion\", source);\n+                return null;\n+            }\n+\n+            final String eanCode = values[0];\n+            final PowerSystemResource powerSystemResource = new PowerSystemResource(eanCode,\n+                    UUID.randomUUID().toString(), new ArrayList<Name>());\n+            final SimpleDateFormat dateFormat = new SimpleDateFormat(\"yyyy-mm-dd HH:mm:ss\");\n+            final Date date = dateFormat.parse(payload.date);\n+            final long createdDateTime = date.getTime();\n+            LOGGER.info(\"CreatedDateTime: {}\", createdDateTime);\n+            return new GridMeasurementPublishedEvent(createdDateTime, eanCode, UUID.randomUUID().toString(),\n+                    \"GridMeasurementPublishedEvent\", new ArrayList<Name>(), powerSystemResource,\n+                    stringArrayToAnalogList.convertToAnalogList(values));\n+        } catch (final JsonMappingException e) {\n+            LOGGER.error(\"Caught an error mapping a JSON string to Payload. {}\", source, e);\n+            return null;\n+        } catch (final JsonProcessingException e) {\n+            LOGGER.error(\"Caught an error processing a JSON string to Payload. {}\", source, e);\n+            return null;\n+        } catch (final ParseException e) {\n+            LOGGER.error(\"Date could not be parsed corrrectly. Date format is: yyyy-mm-dd HH:mm:ss, \"\n+                    + \"however the provided date was not the correct format. {}\", source, e);\n             return null;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ddad5dfedb3cf08243b1e179a12f4245dec3ee29"}, "originalPosition": 78}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NjYxNDAzMQ==", "bodyText": "Give values a more meaningful name", "url": "https://github.com/OSGP/open-smart-grid-platform/pull/427#discussion_r496614031", "createdAt": "2020-09-29T10:35:21Z", "author": {"login": "joostknapen"}, "path": "osgp/platform/osgp-adapter-kafka-distributionautomation/src/main/java/org/opensmartgridplatform/adapter/kafka/da/application/mapping/GridMeasurementPublishedEventConverter.java", "diffHunk": "@@ -36,30 +45,84 @@\n \n     private static final Logger LOGGER = LoggerFactory.getLogger(GridMeasurementPublishedEventConverter.class);\n \n-    private static final int SIMPLE_END_INDEX = 10;\n+    private ObjectMapper objectMapper = new ObjectMapper();\n \n     @Override\n     public GridMeasurementPublishedEvent convert(final String source,\n             final Type<? extends GridMeasurementPublishedEvent> destinationType, final MappingContext mappingContext) {\n \n-        StringArrayToAnalogList stringArrayToAnalogList = null;\n-        final String[] values = source.split(\";\");\n-        if (values.length == SIMPLE_END_INDEX) {\n-            stringArrayToAnalogList = new SimpleStringToAnalogList();\n-        } else if (values.length == LsPeakShavingMeasurementType.getNumberOfElements() + 1) {\n-            stringArrayToAnalogList = new LsMeasurementMessageToAnalogList();\n-        } else {\n-            LOGGER.error(\"String '{}' does not have the expected amount of fields, abandoning conversion\", source);\n+        LsMeasurementMessageToAnalogList stringArrayToAnalogList = null;\n+        LOGGER.info(\"Source string: {}\", source);\n+\n+        try {\n+            final Payload payload = this.objectMapper.readValue(source, Payload[].class)[0];\n+\n+            final String[] values = (payload.gisnr + \", \" + String.join(\", \", payload.data)).split(\", \");", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ddad5dfedb3cf08243b1e179a12f4245dec3ee29"}, "originalPosition": 49}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NjYxOTI1MA==", "bodyText": "This class has no super class; remove super()", "url": "https://github.com/OSGP/open-smart-grid-platform/pull/427#discussion_r496619250", "createdAt": "2020-09-29T10:45:16Z", "author": {"login": "joostknapen"}, "path": "osgp/platform/osgp-adapter-kafka-distributionautomation/src/main/java/org/opensmartgridplatform/adapter/kafka/da/application/mapping/GridMeasurementPublishedEventConverter.java", "diffHunk": "@@ -36,30 +45,84 @@\n \n     private static final Logger LOGGER = LoggerFactory.getLogger(GridMeasurementPublishedEventConverter.class);\n \n-    private static final int SIMPLE_END_INDEX = 10;\n+    private ObjectMapper objectMapper = new ObjectMapper();\n \n     @Override\n     public GridMeasurementPublishedEvent convert(final String source,\n             final Type<? extends GridMeasurementPublishedEvent> destinationType, final MappingContext mappingContext) {\n \n-        StringArrayToAnalogList stringArrayToAnalogList = null;\n-        final String[] values = source.split(\";\");\n-        if (values.length == SIMPLE_END_INDEX) {\n-            stringArrayToAnalogList = new SimpleStringToAnalogList();\n-        } else if (values.length == LsPeakShavingMeasurementType.getNumberOfElements() + 1) {\n-            stringArrayToAnalogList = new LsMeasurementMessageToAnalogList();\n-        } else {\n-            LOGGER.error(\"String '{}' does not have the expected amount of fields, abandoning conversion\", source);\n+        LsMeasurementMessageToAnalogList stringArrayToAnalogList = null;\n+        LOGGER.info(\"Source string: {}\", source);\n+\n+        try {\n+            final Payload payload = this.objectMapper.readValue(source, Payload[].class)[0];\n+\n+            final String[] values = (payload.gisnr + \", \" + String.join(\", \", payload.data)).split(\", \");\n+            LOGGER.info(\"Values length: {} and values: {}\", values.length, Arrays.toString(values));\n+\n+            if (values.length == LsPeakShavingMeasurementType.getNumberOfElements() + 1) {\n+                stringArrayToAnalogList = new LsMeasurementMessageToAnalogList();\n+            } else {\n+                LOGGER.error(\"String '{}' does not have the expected amount of fields, abandoning conversion\", source);\n+                return null;\n+            }\n+\n+            final String eanCode = values[0];\n+            final PowerSystemResource powerSystemResource = new PowerSystemResource(eanCode,\n+                    UUID.randomUUID().toString(), new ArrayList<Name>());\n+            final SimpleDateFormat dateFormat = new SimpleDateFormat(\"yyyy-mm-dd HH:mm:ss\");\n+            final Date date = dateFormat.parse(payload.date);\n+            final long createdDateTime = date.getTime();\n+            LOGGER.info(\"CreatedDateTime: {}\", createdDateTime);\n+            return new GridMeasurementPublishedEvent(createdDateTime, eanCode, UUID.randomUUID().toString(),\n+                    \"GridMeasurementPublishedEvent\", new ArrayList<Name>(), powerSystemResource,\n+                    stringArrayToAnalogList.convertToAnalogList(values));\n+        } catch (final JsonMappingException e) {\n+            LOGGER.error(\"Caught an error mapping a JSON string to Payload. {}\", source, e);\n+            return null;\n+        } catch (final JsonProcessingException e) {\n+            LOGGER.error(\"Caught an error processing a JSON string to Payload. {}\", source, e);\n+            return null;\n+        } catch (final ParseException e) {\n+            LOGGER.error(\"Date could not be parsed corrrectly. Date format is: yyyy-mm-dd HH:mm:ss, \"\n+                    + \"however the provided date was not the correct format. {}\", source, e);\n             return null;\n         }\n-\n-        final String eanCode = values[0];\n-        final PowerSystemResource powerSystemResource = new PowerSystemResource(eanCode, UUID.randomUUID().toString(),\n-                new ArrayList<Name>());\n-        final long createdDateTime = System.currentTimeMillis();\n-        return new GridMeasurementPublishedEvent(createdDateTime, eanCode, UUID.randomUUID().toString(),\n-                \"GridMeasurementPublishedEvent\", new ArrayList<Name>(), powerSystemResource,\n-                stringArrayToAnalogList.convertToAnalogList(values));\n     }\n \n+    private static class Payload {\n+\n+        private String gisnr;\n+        private String feeder;\n+        @JsonAlias({ \"D\" })\n+        private String date;\n+        private String[] data;\n+\n+        public Payload() {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ddad5dfedb3cf08243b1e179a12f4245dec3ee29"}, "originalPosition": 98}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NjYyMTM0Nw==", "bodyText": "Maybe add in the error message below the number of elements of 'value' and the number of expected elements", "url": "https://github.com/OSGP/open-smart-grid-platform/pull/427#discussion_r496621347", "createdAt": "2020-09-29T10:49:12Z", "author": {"login": "joostknapen"}, "path": "osgp/platform/osgp-adapter-kafka-distributionautomation/src/main/java/org/opensmartgridplatform/adapter/kafka/da/application/mapping/GridMeasurementPublishedEventConverter.java", "diffHunk": "@@ -36,30 +45,84 @@\n \n     private static final Logger LOGGER = LoggerFactory.getLogger(GridMeasurementPublishedEventConverter.class);\n \n-    private static final int SIMPLE_END_INDEX = 10;\n+    private ObjectMapper objectMapper = new ObjectMapper();\n \n     @Override\n     public GridMeasurementPublishedEvent convert(final String source,\n             final Type<? extends GridMeasurementPublishedEvent> destinationType, final MappingContext mappingContext) {\n \n-        StringArrayToAnalogList stringArrayToAnalogList = null;\n-        final String[] values = source.split(\";\");\n-        if (values.length == SIMPLE_END_INDEX) {\n-            stringArrayToAnalogList = new SimpleStringToAnalogList();\n-        } else if (values.length == LsPeakShavingMeasurementType.getNumberOfElements() + 1) {\n-            stringArrayToAnalogList = new LsMeasurementMessageToAnalogList();\n-        } else {\n-            LOGGER.error(\"String '{}' does not have the expected amount of fields, abandoning conversion\", source);\n+        LsMeasurementMessageToAnalogList stringArrayToAnalogList = null;\n+        LOGGER.info(\"Source string: {}\", source);\n+\n+        try {\n+            final Payload payload = this.objectMapper.readValue(source, Payload[].class)[0];\n+\n+            final String[] values = (payload.gisnr + \", \" + String.join(\", \", payload.data)).split(\", \");\n+            LOGGER.info(\"Values length: {} and values: {}\", values.length, Arrays.toString(values));", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NjYxMjMwOQ=="}, "originalCommit": {"oid": "ddad5dfedb3cf08243b1e179a12f4245dec3ee29"}, "originalPosition": 50}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NjYyMzkxNg==", "bodyText": "typo :-)", "url": "https://github.com/OSGP/open-smart-grid-platform/pull/427#discussion_r496623916", "createdAt": "2020-09-29T10:54:09Z", "author": {"login": "joostknapen"}, "path": "osgp/platform/osgp-adapter-kafka-distributionautomation/src/main/java/org/opensmartgridplatform/adapter/kafka/da/application/mapping/GridMeasurementPublishedEventConverter.java", "diffHunk": "@@ -36,30 +45,84 @@\n \n     private static final Logger LOGGER = LoggerFactory.getLogger(GridMeasurementPublishedEventConverter.class);\n \n-    private static final int SIMPLE_END_INDEX = 10;\n+    private ObjectMapper objectMapper = new ObjectMapper();\n \n     @Override\n     public GridMeasurementPublishedEvent convert(final String source,\n             final Type<? extends GridMeasurementPublishedEvent> destinationType, final MappingContext mappingContext) {\n \n-        StringArrayToAnalogList stringArrayToAnalogList = null;\n-        final String[] values = source.split(\";\");\n-        if (values.length == SIMPLE_END_INDEX) {\n-            stringArrayToAnalogList = new SimpleStringToAnalogList();\n-        } else if (values.length == LsPeakShavingMeasurementType.getNumberOfElements() + 1) {\n-            stringArrayToAnalogList = new LsMeasurementMessageToAnalogList();\n-        } else {\n-            LOGGER.error(\"String '{}' does not have the expected amount of fields, abandoning conversion\", source);\n+        LsMeasurementMessageToAnalogList stringArrayToAnalogList = null;\n+        LOGGER.info(\"Source string: {}\", source);\n+\n+        try {\n+            final Payload payload = this.objectMapper.readValue(source, Payload[].class)[0];\n+\n+            final String[] values = (payload.gisnr + \", \" + String.join(\", \", payload.data)).split(\", \");\n+            LOGGER.info(\"Values length: {} and values: {}\", values.length, Arrays.toString(values));\n+\n+            if (values.length == LsPeakShavingMeasurementType.getNumberOfElements() + 1) {\n+                stringArrayToAnalogList = new LsMeasurementMessageToAnalogList();\n+            } else {\n+                LOGGER.error(\"String '{}' does not have the expected amount of fields, abandoning conversion\", source);\n+                return null;\n+            }\n+\n+            final String eanCode = values[0];\n+            final PowerSystemResource powerSystemResource = new PowerSystemResource(eanCode,\n+                    UUID.randomUUID().toString(), new ArrayList<Name>());\n+            final SimpleDateFormat dateFormat = new SimpleDateFormat(\"yyyy-mm-dd HH:mm:ss\");\n+            final Date date = dateFormat.parse(payload.date);\n+            final long createdDateTime = date.getTime();\n+            LOGGER.info(\"CreatedDateTime: {}\", createdDateTime);\n+            return new GridMeasurementPublishedEvent(createdDateTime, eanCode, UUID.randomUUID().toString(),\n+                    \"GridMeasurementPublishedEvent\", new ArrayList<Name>(), powerSystemResource,\n+                    stringArrayToAnalogList.convertToAnalogList(values));\n+        } catch (final JsonMappingException e) {\n+            LOGGER.error(\"Caught an error mapping a JSON string to Payload. {}\", source, e);\n+            return null;\n+        } catch (final JsonProcessingException e) {\n+            LOGGER.error(\"Caught an error processing a JSON string to Payload. {}\", source, e);\n+            return null;\n+        } catch (final ParseException e) {\n+            LOGGER.error(\"Date could not be parsed corrrectly. Date format is: yyyy-mm-dd HH:mm:ss, \"\n+                    + \"however the provided date was not the correct format. {}\", source, e);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ddad5dfedb3cf08243b1e179a12f4245dec3ee29"}, "originalPosition": 77}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "496e0cfa5ae21076ddd56eebb8c6073440447f13", "author": {"user": {"login": "JelleHoffman", "name": "Jelle Hoffman"}}, "url": "https://github.com/OSGP/open-smart-grid-platform/commit/496e0cfa5ae21076ddd56eebb8c6073440447f13", "committedDate": "2020-09-29T12:31:43Z", "message": "Merge branch 'development' into feature/OC-648-mqtt-device-peak-shaving"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "35620f5cf96e573484b9052869909b7313399632", "author": {"user": {"login": "JelleHoffman", "name": "Jelle Hoffman"}}, "url": "https://github.com/OSGP/open-smart-grid-platform/commit/35620f5cf96e573484b9052869909b7313399632", "committedDate": "2020-09-29T15:49:17Z", "message": "Revisions based on comments Joost"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDk5MTM2NDI4", "url": "https://github.com/OSGP/open-smart-grid-platform/pull/427#pullrequestreview-499136428", "createdAt": "2020-09-30T07:03:19Z", "commit": {"oid": "35620f5cf96e573484b9052869909b7313399632"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0zMFQwNzowMzoxOVrOHaP2Rw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0zMFQwNzowMzoxOVrOHaP2Rw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NzI4NDY3OQ==", "bodyText": "I meant the case where payloads.length == 0, that would result in the null pointer. You can't call equals on an array element with a null value. Since in that case, payload[0] references to null.", "url": "https://github.com/OSGP/open-smart-grid-platform/pull/427#discussion_r497284679", "createdAt": "2020-09-30T07:03:19Z", "author": {"login": "joostknapen"}, "path": "osgp/platform/osgp-adapter-kafka-distributionautomation/src/main/java/org/opensmartgridplatform/adapter/kafka/da/application/mapping/GridMeasurementPublishedEventConverter.java", "diffHunk": "@@ -36,30 +46,95 @@\n \n     private static final Logger LOGGER = LoggerFactory.getLogger(GridMeasurementPublishedEventConverter.class);\n \n-    private static final int SIMPLE_END_INDEX = 10;\n+    private ObjectMapper objectMapper = new ObjectMapper();\n \n     @Override\n     public GridMeasurementPublishedEvent convert(final String source,\n             final Type<? extends GridMeasurementPublishedEvent> destinationType, final MappingContext mappingContext) {\n \n-        StringArrayToAnalogList stringArrayToAnalogList = null;\n-        final String[] values = source.split(\";\");\n-        if (values.length == SIMPLE_END_INDEX) {\n-            stringArrayToAnalogList = new SimpleStringToAnalogList();\n-        } else if (values.length == LsPeakShavingMeasurementType.getNumberOfElements() + 1) {\n-            stringArrayToAnalogList = new LsMeasurementMessageToAnalogList();\n-        } else {\n-            LOGGER.error(\"String '{}' does not have the expected amount of fields, abandoning conversion\", source);\n+        LsMeasurementMessageToAnalogList stringArrayToAnalogList = null;\n+        LOGGER.debug(\"Source string: {}\", source);\n+\n+        try {\n+            final Payload[] payloads = this.objectMapper.readValue(source, Payload[].class);\n+            if (payloads[0].equals(null)) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "35620f5cf96e573484b9052869909b7313399632"}, "originalPosition": 49}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "73a9e1aee4dfc7886a795402c2ae609c2676daed", "author": {"user": {"login": "JelleHoffman", "name": "Jelle Hoffman"}}, "url": "https://github.com/OSGP/open-smart-grid-platform/commit/73a9e1aee4dfc7886a795402c2ae609c2676daed", "committedDate": "2020-09-30T08:28:22Z", "message": "Added test and fixed typo"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3622, "cost": 1, "resetAt": "2021-11-01T16:19:10Z"}}}