{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDc0NzgwODgx", "number": 254, "title": "HTTP API changes to support recording options", "bodyText": "Fixes #250", "createdAt": "2020-08-27T15:27:54Z", "url": "https://github.com/cryostatio/cryostat/pull/254", "merged": true, "mergeCommit": {"oid": "b15c3610079d8bc457f5fa6e1bc2015d6122787a"}, "closed": true, "closedAt": "2020-09-10T21:15:51Z", "author": {"login": "Alexjsenn"}, "timelineItems": {"totalCount": 45, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdFUw6ZgH2gAyNDc0NzgwODgxOjJlZjQzYzYwYjcxN2IyNDgwNTZlODlkMTcwN2ZmMzA1YzBiZjdiZWI=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdHnU8qgFqTQ4NjMwODg5OA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "2ef43c60b717b248056e89d1707ff305c0bf7beb", "author": {"user": {"login": "Alexjsenn", "name": "Alex Senn"}}, "url": "https://github.com/cryostatio/cryostat/commit/2ef43c60b717b248056e89d1707ff305c0bf7beb", "committedDate": "2020-09-03T18:18:23Z", "message": "Create RecordingOptionsPutHandler, not fully functional"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b71cf20a44e2ed32b61aca84c16fe883fb422bea", "author": {"user": {"login": "Alexjsenn", "name": "Alex Senn"}}, "url": "https://github.com/cryostatio/cryostat/commit/b71cf20a44e2ed32b61aca84c16fe883fb422bea", "committedDate": "2020-09-03T18:18:23Z", "message": "Initial changes to TargetRecordingsPostHandler.java"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "929f5033963fd7fe1d289b9a16c65e25f241352b", "author": {"user": {"login": "Alexjsenn", "name": "Alex Senn"}}, "url": "https://github.com/cryostatio/cryostat/commit/929f5033963fd7fe1d289b9a16c65e25f241352b", "committedDate": "2020-09-03T18:18:23Z", "message": "Create TargetRecordingPostHandler"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "6a2050f36f8498826887a3da37f1da7ec5d0291b", "author": {"user": {"login": "Alexjsenn", "name": "Alex Senn"}}, "url": "https://github.com/cryostatio/cryostat/commit/6a2050f36f8498826887a3da37f1da7ec5d0291b", "committedDate": "2020-09-03T18:25:01Z", "message": "Add new handlers to RequestHandlerModule"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "72e2a28f0f0fbb15ced8e6c3b553081a94993820", "author": {"user": {"login": "Alexjsenn", "name": "Alex Senn"}}, "url": "https://github.com/cryostatio/cryostat/commit/72e2a28f0f0fbb15ced8e6c3b553081a94993820", "committedDate": "2020-09-03T18:25:01Z", "message": "Fix formatting"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "af2465875d8efd3323e75dd64d0d6b83e50317ad", "author": {"user": {"login": "Alexjsenn", "name": "Alex Senn"}}, "url": "https://github.com/cryostatio/cryostat/commit/af2465875d8efd3323e75dd64d0d6b83e50317ad", "committedDate": "2020-09-03T18:25:01Z", "message": "Create unit tests for recordingOptionsGetHandler (still needs more tests)"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "1f11f3c8f618e82cc6fb39a48032d50da47ed56b", "author": {"user": {"login": "Alexjsenn", "name": "Alex Senn"}}, "url": "https://github.com/cryostatio/cryostat/commit/1f11f3c8f618e82cc6fb39a48032d50da47ed56b", "committedDate": "2020-09-03T18:25:01Z", "message": "Add more tests for RecordingOptionsGetHandler"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "fe17350f18da75b4b494f606b75ef2cf495fbfc8", "author": {"user": {"login": "Alexjsenn", "name": "Alex Senn"}}, "url": "https://github.com/cryostatio/cryostat/commit/fe17350f18da75b4b494f606b75ef2cf495fbfc8", "committedDate": "2020-09-03T18:25:01Z", "message": "Add unit tests for RecordingOptionsPutHandler"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "988f15b5eceb6c59b5236e1447c6afde532b6636", "author": {"user": {"login": "Alexjsenn", "name": "Alex Senn"}}, "url": "https://github.com/cryostatio/cryostat/commit/988f15b5eceb6c59b5236e1447c6afde532b6636", "committedDate": "2020-09-03T18:25:01Z", "message": "Initial changes to TargetRecordingsPostHadlerTest"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "dafe4acddbbfe5464c83b6f60c52218ec4619219", "author": {"user": {"login": "Alexjsenn", "name": "Alex Senn"}}, "url": "https://github.com/cryostatio/cryostat/commit/dafe4acddbbfe5464c83b6f60c52218ec4619219", "committedDate": "2020-09-03T18:25:01Z", "message": "Finish changes to unit test for targetRecordingsPostHandler"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "6d544d4616ab3808d84146e3530bacc51638d1b3", "author": {"user": {"login": "Alexjsenn", "name": "Alex Senn"}}, "url": "https://github.com/cryostatio/cryostat/commit/6d544d4616ab3808d84146e3530bacc51638d1b3", "committedDate": "2020-09-03T18:25:01Z", "message": "RecordingOptionsGetHandler first checks if there are system wide RecordingOptions, if not gets target JVM specific defaults"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "6c185a54f4f8de54fd00415a76f8306b0c918c4a", "author": {"user": {"login": "Alexjsenn", "name": "Alex Senn"}}, "url": "https://github.com/cryostatio/cryostat/commit/6c185a54f4f8de54fd00415a76f8306b0c918c4a", "committedDate": "2020-09-03T18:25:01Z", "message": "Allow RecordingOptionsPutHandler to accept incomplete options list"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d1d83d265175e1857a5f6f2d6b3b4d0a840cacc3", "author": {"user": {"login": "Alexjsenn", "name": "Alex Senn"}}, "url": "https://github.com/cryostatio/cryostat/commit/d1d83d265175e1857a5f6f2d6b3b4d0a840cacc3", "committedDate": "2020-09-03T18:40:23Z", "message": "Rebase and fix errors"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "71cf68a66b169cc12ba83ad1973cbfa9fb0d28b8", "author": {"user": {"login": "Alexjsenn", "name": "Alex Senn"}}, "url": "https://github.com/cryostatio/cryostat/commit/71cf68a66b169cc12ba83ad1973cbfa9fb0d28b8", "committedDate": "2020-09-02T21:22:17Z", "message": "Allow RecordingOptionsPutHandler to accept incomplete options list"}, "afterCommit": {"oid": "d1d83d265175e1857a5f6f2d6b3b4d0a840cacc3", "author": {"user": {"login": "Alexjsenn", "name": "Alex Senn"}}, "url": "https://github.com/cryostatio/cryostat/commit/d1d83d265175e1857a5f6f2d6b3b4d0a840cacc3", "committedDate": "2020-09-03T18:40:23Z", "message": "Rebase and fix errors"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "08c84a50cd5434140257cb40309266b1bfd89ef9", "author": {"user": {"login": "Alexjsenn", "name": "Alex Senn"}}, "url": "https://github.com/cryostatio/cryostat/commit/08c84a50cd5434140257cb40309266b1bfd89ef9", "committedDate": "2020-09-03T18:54:18Z", "message": "Remove debugging statements"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b8bc0f27346068deb36a3ad8b4c2a22d25f853a4", "author": {"user": {"login": "Alexjsenn", "name": "Alex Senn"}}, "url": "https://github.com/cryostatio/cryostat/commit/b8bc0f27346068deb36a3ad8b4c2a22d25f853a4", "committedDate": "2020-09-03T20:01:31Z", "message": "Fix formatting and milisecond conversion error"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "76d35c49794efae6d4f77daf6d1c49e8bbe5df5a", "author": {"user": {"login": "Alexjsenn", "name": "Alex Senn"}}, "url": "https://github.com/cryostatio/cryostat/commit/76d35c49794efae6d4f77daf6d1c49e8bbe5df5a", "committedDate": "2020-09-04T15:06:15Z", "message": "Change recordingOptions to Patch, add body handler"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "0fe5f1126a51561a297d4e30f420561621089521", "author": {"user": {"login": "Alexjsenn", "name": "Alex Senn"}}, "url": "https://github.com/cryostatio/cryostat/commit/0fe5f1126a51561a297d4e30f420561621089521", "committedDate": "2020-09-04T16:51:15Z", "message": "Modify patch test and other small fixes"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "7eb021723ba2fbafa00c8dbaf0a59f1c918c4ab1", "author": {"user": {"login": "Alexjsenn", "name": "Alex Senn"}}, "url": "https://github.com/cryostatio/cryostat/commit/7eb021723ba2fbafa00c8dbaf0a59f1c918c4ab1", "committedDate": "2020-09-04T16:52:07Z", "message": "Remove units when retrieving recordingOptions in getHandler"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDgyODI1NzUy", "url": "https://github.com/cryostatio/cryostat/pull/254#pullrequestreview-482825752", "createdAt": "2020-09-04T17:13:58Z", "commit": {"oid": "7eb021723ba2fbafa00c8dbaf0a59f1c918c4ab1"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wNFQxNzoxMzo1OFrOHNWAvQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wNFQxNzoxMzo1OFrOHNWAvQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4Mzc1NDE3Mw==", "bodyText": "Can these three if/elses be refactored into a loop over a set of keys? And rather than using constant strings like toDisk, could these use the RecordingOptionsCustomizer.OptionKeys?", "url": "https://github.com/cryostatio/cryostat/pull/254#discussion_r483754173", "createdAt": "2020-09-04T17:13:58Z", "author": {"login": "andrewazores"}, "path": "src/main/java/com/redhat/rhjmc/containerjfr/net/web/handlers/RecordingOptionsGetHandler.java", "diffHunk": "@@ -0,0 +1,150 @@\n+/*-\n+ * #%L\n+ * Container JFR\n+ * %%\n+ * Copyright (C) 2020 Red Hat, Inc.\n+ * %%\n+ * The Universal Permissive License (UPL), Version 1.0\n+ *\n+ * Subject to the condition set forth below, permission is hereby granted to any\n+ * person obtaining a copy of this software, associated documentation and/or data\n+ * (collectively the \"Software\"), free of charge and under any and all copyright\n+ * rights in the Software, and any and all patent rights owned or freely\n+ * licensable by each licensor hereunder covering either (i) the unmodified\n+ * Software as contributed to or provided by such licensor, or (ii) the Larger\n+ * Works (as defined below), to deal in both\n+ *\n+ * (a) the Software, and\n+ * (b) any piece of software and/or hardware listed in the lrgrwrks.txt file if\n+ * one is included with the Software (each a \"Larger Work\" to which the Software\n+ * is contributed by such licensors),\n+ *\n+ * without restriction, including without limitation the rights to copy, create\n+ * derivative works of, display, perform, and distribute the Software and make,\n+ * use, sell, offer for sale, import, export, have made, and have sold the\n+ * Software and the Larger Work(s), and to sublicense the foregoing rights on\n+ * either these or other terms.\n+ *\n+ * This license is subject to the following condition:\n+ * The above copyright notice and either this complete permission notice or at\n+ * a minimum a reference to the UPL must be included in all copies or\n+ * substantial portions of the Software.\n+ *\n+ * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n+ * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n+ * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n+ * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n+ * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n+ * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE\n+ * SOFTWARE.\n+ * #L%\n+ */\n+package com.redhat.rhjmc.containerjfr.net.web.handlers;\n+\n+import java.util.HashMap;\n+import java.util.Map;\n+import java.util.regex.Matcher;\n+import java.util.regex.Pattern;\n+\n+import javax.inject.Inject;\n+\n+import org.openjdk.jmc.common.unit.IConstrainedMap;\n+import org.openjdk.jmc.common.unit.IOptionDescriptor;\n+import org.openjdk.jmc.flightrecorder.configuration.recording.RecordingOptionsBuilder;\n+\n+import com.google.gson.Gson;\n+\n+import com.redhat.rhjmc.containerjfr.commands.internal.RecordingOptionsBuilderFactory;\n+import com.redhat.rhjmc.containerjfr.net.AuthManager;\n+import com.redhat.rhjmc.containerjfr.net.TargetConnectionManager;\n+\n+import io.vertx.core.http.HttpMethod;\n+import io.vertx.ext.web.RoutingContext;\n+\n+public class RecordingOptionsGetHandler extends AbstractAuthenticatedRequestHandler {\n+\n+    static final String PATH = \"/api/v1/targets/:targetId/recordingOptions\";\n+    protected final TargetConnectionManager connectionManager;\n+    private final RecordingOptionsBuilderFactory recordingOptionsBuilderFactory;\n+    private final Gson gson;\n+    private static final Pattern NUMBER_PATTERN = Pattern.compile(\"\\\\d+\");\n+\n+    @Inject\n+    RecordingOptionsGetHandler(\n+            AuthManager auth,\n+            TargetConnectionManager connectionManager,\n+            RecordingOptionsBuilderFactory recordingOptionsBuilderFactory,\n+            Gson gson) {\n+        super(auth);\n+        this.connectionManager = connectionManager;\n+        this.recordingOptionsBuilderFactory = recordingOptionsBuilderFactory;\n+        this.gson = gson;\n+    }\n+\n+    @Override\n+    public HttpMethod httpMethod() {\n+        return HttpMethod.GET;\n+    }\n+\n+    @Override\n+    public String path() {\n+        return PATH;\n+    }\n+\n+    @Override\n+    public boolean isAsync() {\n+        return false;\n+    }\n+\n+    @Override\n+    void handleAuthenticated(RoutingContext ctx) throws Exception {\n+        Map<String, String> optionMap =\n+                connectionManager.executeConnectedTask(\n+                        getConnectionDescriptorFromContext(ctx),\n+                        connection -> {\n+                            RecordingOptionsBuilder builder =\n+                                    recordingOptionsBuilderFactory.create(connection.getService());\n+                            IConstrainedMap<String> recordingOptions = builder.build();\n+\n+                            Map<String, IOptionDescriptor<?>> TargetRecordingOptions =\n+                                    connection.getService().getAvailableRecordingOptions();\n+\n+                            Map<String, String> map = new HashMap<String, String>();\n+\n+                            if (recordingOptions.get(\"toDisk\") != null) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "7eb021723ba2fbafa00c8dbaf0a59f1c918c4ab1"}, "originalPosition": 114}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDgyODI5MzE0", "url": "https://github.com/cryostatio/cryostat/pull/254#pullrequestreview-482829314", "createdAt": "2020-09-04T17:20:28Z", "commit": {"oid": "7eb021723ba2fbafa00c8dbaf0a59f1c918c4ab1"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wNFQxNzoyMDoyOFrOHNWLmA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wNFQxNzoyMDoyOFrOHNWLmA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4Mzc1Njk1Mg==", "bodyText": "Does the recordingOptions have a method like .containsKey()? If so, it would be better to use that than .get() != null.", "url": "https://github.com/cryostatio/cryostat/pull/254#discussion_r483756952", "createdAt": "2020-09-04T17:20:28Z", "author": {"login": "andrewazores"}, "path": "src/main/java/com/redhat/rhjmc/containerjfr/net/web/handlers/RecordingOptionsGetHandler.java", "diffHunk": "@@ -0,0 +1,150 @@\n+/*-\n+ * #%L\n+ * Container JFR\n+ * %%\n+ * Copyright (C) 2020 Red Hat, Inc.\n+ * %%\n+ * The Universal Permissive License (UPL), Version 1.0\n+ *\n+ * Subject to the condition set forth below, permission is hereby granted to any\n+ * person obtaining a copy of this software, associated documentation and/or data\n+ * (collectively the \"Software\"), free of charge and under any and all copyright\n+ * rights in the Software, and any and all patent rights owned or freely\n+ * licensable by each licensor hereunder covering either (i) the unmodified\n+ * Software as contributed to or provided by such licensor, or (ii) the Larger\n+ * Works (as defined below), to deal in both\n+ *\n+ * (a) the Software, and\n+ * (b) any piece of software and/or hardware listed in the lrgrwrks.txt file if\n+ * one is included with the Software (each a \"Larger Work\" to which the Software\n+ * is contributed by such licensors),\n+ *\n+ * without restriction, including without limitation the rights to copy, create\n+ * derivative works of, display, perform, and distribute the Software and make,\n+ * use, sell, offer for sale, import, export, have made, and have sold the\n+ * Software and the Larger Work(s), and to sublicense the foregoing rights on\n+ * either these or other terms.\n+ *\n+ * This license is subject to the following condition:\n+ * The above copyright notice and either this complete permission notice or at\n+ * a minimum a reference to the UPL must be included in all copies or\n+ * substantial portions of the Software.\n+ *\n+ * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n+ * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n+ * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n+ * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n+ * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n+ * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE\n+ * SOFTWARE.\n+ * #L%\n+ */\n+package com.redhat.rhjmc.containerjfr.net.web.handlers;\n+\n+import java.util.HashMap;\n+import java.util.Map;\n+import java.util.regex.Matcher;\n+import java.util.regex.Pattern;\n+\n+import javax.inject.Inject;\n+\n+import org.openjdk.jmc.common.unit.IConstrainedMap;\n+import org.openjdk.jmc.common.unit.IOptionDescriptor;\n+import org.openjdk.jmc.flightrecorder.configuration.recording.RecordingOptionsBuilder;\n+\n+import com.google.gson.Gson;\n+\n+import com.redhat.rhjmc.containerjfr.commands.internal.RecordingOptionsBuilderFactory;\n+import com.redhat.rhjmc.containerjfr.net.AuthManager;\n+import com.redhat.rhjmc.containerjfr.net.TargetConnectionManager;\n+\n+import io.vertx.core.http.HttpMethod;\n+import io.vertx.ext.web.RoutingContext;\n+\n+public class RecordingOptionsGetHandler extends AbstractAuthenticatedRequestHandler {\n+\n+    static final String PATH = \"/api/v1/targets/:targetId/recordingOptions\";\n+    protected final TargetConnectionManager connectionManager;\n+    private final RecordingOptionsBuilderFactory recordingOptionsBuilderFactory;\n+    private final Gson gson;\n+    private static final Pattern NUMBER_PATTERN = Pattern.compile(\"\\\\d+\");\n+\n+    @Inject\n+    RecordingOptionsGetHandler(\n+            AuthManager auth,\n+            TargetConnectionManager connectionManager,\n+            RecordingOptionsBuilderFactory recordingOptionsBuilderFactory,\n+            Gson gson) {\n+        super(auth);\n+        this.connectionManager = connectionManager;\n+        this.recordingOptionsBuilderFactory = recordingOptionsBuilderFactory;\n+        this.gson = gson;\n+    }\n+\n+    @Override\n+    public HttpMethod httpMethod() {\n+        return HttpMethod.GET;\n+    }\n+\n+    @Override\n+    public String path() {\n+        return PATH;\n+    }\n+\n+    @Override\n+    public boolean isAsync() {\n+        return false;\n+    }\n+\n+    @Override\n+    void handleAuthenticated(RoutingContext ctx) throws Exception {\n+        Map<String, String> optionMap =\n+                connectionManager.executeConnectedTask(\n+                        getConnectionDescriptorFromContext(ctx),\n+                        connection -> {\n+                            RecordingOptionsBuilder builder =\n+                                    recordingOptionsBuilderFactory.create(connection.getService());\n+                            IConstrainedMap<String> recordingOptions = builder.build();\n+\n+                            Map<String, IOptionDescriptor<?>> TargetRecordingOptions =\n+                                    connection.getService().getAvailableRecordingOptions();\n+\n+                            Map<String, String> map = new HashMap<String, String>();\n+\n+                            if (recordingOptions.get(\"toDisk\") != null) {\n+                                map.put(\"toDisk\", recordingOptions.get(\"toDisk\").toString());\n+                            } else {\n+                                map.put(\n+                                        \"toDisk\",\n+                                        TargetRecordingOptions.get(\"disk\").getDefault().toString());\n+                            }\n+\n+                            String maxAge;\n+                            if (recordingOptions.get(\"maxAge\") != null) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "7eb021723ba2fbafa00c8dbaf0a59f1c918c4ab1"}, "originalPosition": 123}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDgyODI5OTM5", "url": "https://github.com/cryostatio/cryostat/pull/254#pullrequestreview-482829939", "createdAt": "2020-09-04T17:21:41Z", "commit": {"oid": "7eb021723ba2fbafa00c8dbaf0a59f1c918c4ab1"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wNFQxNzoyMTo0MlrOHNWNhw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wNFQxNzoyMTo0MlrOHNWNhw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4Mzc1NzQ0Nw==", "bodyText": "This should be renamed targetRecordingOptions (camelCase, not PascalCase)", "url": "https://github.com/cryostatio/cryostat/pull/254#discussion_r483757447", "createdAt": "2020-09-04T17:21:42Z", "author": {"login": "andrewazores"}, "path": "src/main/java/com/redhat/rhjmc/containerjfr/net/web/handlers/RecordingOptionsGetHandler.java", "diffHunk": "@@ -0,0 +1,150 @@\n+/*-\n+ * #%L\n+ * Container JFR\n+ * %%\n+ * Copyright (C) 2020 Red Hat, Inc.\n+ * %%\n+ * The Universal Permissive License (UPL), Version 1.0\n+ *\n+ * Subject to the condition set forth below, permission is hereby granted to any\n+ * person obtaining a copy of this software, associated documentation and/or data\n+ * (collectively the \"Software\"), free of charge and under any and all copyright\n+ * rights in the Software, and any and all patent rights owned or freely\n+ * licensable by each licensor hereunder covering either (i) the unmodified\n+ * Software as contributed to or provided by such licensor, or (ii) the Larger\n+ * Works (as defined below), to deal in both\n+ *\n+ * (a) the Software, and\n+ * (b) any piece of software and/or hardware listed in the lrgrwrks.txt file if\n+ * one is included with the Software (each a \"Larger Work\" to which the Software\n+ * is contributed by such licensors),\n+ *\n+ * without restriction, including without limitation the rights to copy, create\n+ * derivative works of, display, perform, and distribute the Software and make,\n+ * use, sell, offer for sale, import, export, have made, and have sold the\n+ * Software and the Larger Work(s), and to sublicense the foregoing rights on\n+ * either these or other terms.\n+ *\n+ * This license is subject to the following condition:\n+ * The above copyright notice and either this complete permission notice or at\n+ * a minimum a reference to the UPL must be included in all copies or\n+ * substantial portions of the Software.\n+ *\n+ * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n+ * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n+ * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n+ * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n+ * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n+ * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE\n+ * SOFTWARE.\n+ * #L%\n+ */\n+package com.redhat.rhjmc.containerjfr.net.web.handlers;\n+\n+import java.util.HashMap;\n+import java.util.Map;\n+import java.util.regex.Matcher;\n+import java.util.regex.Pattern;\n+\n+import javax.inject.Inject;\n+\n+import org.openjdk.jmc.common.unit.IConstrainedMap;\n+import org.openjdk.jmc.common.unit.IOptionDescriptor;\n+import org.openjdk.jmc.flightrecorder.configuration.recording.RecordingOptionsBuilder;\n+\n+import com.google.gson.Gson;\n+\n+import com.redhat.rhjmc.containerjfr.commands.internal.RecordingOptionsBuilderFactory;\n+import com.redhat.rhjmc.containerjfr.net.AuthManager;\n+import com.redhat.rhjmc.containerjfr.net.TargetConnectionManager;\n+\n+import io.vertx.core.http.HttpMethod;\n+import io.vertx.ext.web.RoutingContext;\n+\n+public class RecordingOptionsGetHandler extends AbstractAuthenticatedRequestHandler {\n+\n+    static final String PATH = \"/api/v1/targets/:targetId/recordingOptions\";\n+    protected final TargetConnectionManager connectionManager;\n+    private final RecordingOptionsBuilderFactory recordingOptionsBuilderFactory;\n+    private final Gson gson;\n+    private static final Pattern NUMBER_PATTERN = Pattern.compile(\"\\\\d+\");\n+\n+    @Inject\n+    RecordingOptionsGetHandler(\n+            AuthManager auth,\n+            TargetConnectionManager connectionManager,\n+            RecordingOptionsBuilderFactory recordingOptionsBuilderFactory,\n+            Gson gson) {\n+        super(auth);\n+        this.connectionManager = connectionManager;\n+        this.recordingOptionsBuilderFactory = recordingOptionsBuilderFactory;\n+        this.gson = gson;\n+    }\n+\n+    @Override\n+    public HttpMethod httpMethod() {\n+        return HttpMethod.GET;\n+    }\n+\n+    @Override\n+    public String path() {\n+        return PATH;\n+    }\n+\n+    @Override\n+    public boolean isAsync() {\n+        return false;\n+    }\n+\n+    @Override\n+    void handleAuthenticated(RoutingContext ctx) throws Exception {\n+        Map<String, String> optionMap =\n+                connectionManager.executeConnectedTask(\n+                        getConnectionDescriptorFromContext(ctx),\n+                        connection -> {\n+                            RecordingOptionsBuilder builder =\n+                                    recordingOptionsBuilderFactory.create(connection.getService());\n+                            IConstrainedMap<String> recordingOptions = builder.build();\n+\n+                            Map<String, IOptionDescriptor<?>> TargetRecordingOptions =", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "7eb021723ba2fbafa00c8dbaf0a59f1c918c4ab1"}, "originalPosition": 109}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDgyODMwNjQ0", "url": "https://github.com/cryostatio/cryostat/pull/254#pullrequestreview-482830644", "createdAt": "2020-09-04T17:22:58Z", "commit": {"oid": "7eb021723ba2fbafa00c8dbaf0a59f1c918c4ab1"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wNFQxNzoyMjo1OFrOHNWPnQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wNFQxNzoyMjo1OFrOHNWPnQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4Mzc1Nzk4MQ==", "bodyText": "This is duplicated from the GET handler, isn't it? One of them should probably reference the other's path here.", "url": "https://github.com/cryostatio/cryostat/pull/254#discussion_r483757981", "createdAt": "2020-09-04T17:22:58Z", "author": {"login": "andrewazores"}, "path": "src/main/java/com/redhat/rhjmc/containerjfr/net/web/handlers/RecordingOptionsPatchHandler.java", "diffHunk": "@@ -0,0 +1,99 @@\n+/*-\n+ * #%L\n+ * Container JFR\n+ * %%\n+ * Copyright (C) 2020 Red Hat, Inc.\n+ * %%\n+ * The Universal Permissive License (UPL), Version 1.0\n+ *\n+ * Subject to the condition set forth below, permission is hereby granted to any\n+ * person obtaining a copy of this software, associated documentation and/or data\n+ * (collectively the \"Software\"), free of charge and under any and all copyright\n+ * rights in the Software, and any and all patent rights owned or freely\n+ * licensable by each licensor hereunder covering either (i) the unmodified\n+ * Software as contributed to or provided by such licensor, or (ii) the Larger\n+ * Works (as defined below), to deal in both\n+ *\n+ * (a) the Software, and\n+ * (b) any piece of software and/or hardware listed in the lrgrwrks.txt file if\n+ * one is included with the Software (each a \"Larger Work\" to which the Software\n+ * is contributed by such licensors),\n+ *\n+ * without restriction, including without limitation the rights to copy, create\n+ * derivative works of, display, perform, and distribute the Software and make,\n+ * use, sell, offer for sale, import, export, have made, and have sold the\n+ * Software and the Larger Work(s), and to sublicense the foregoing rights on\n+ * either these or other terms.\n+ *\n+ * This license is subject to the following condition:\n+ * The above copyright notice and either this complete permission notice or at\n+ * a minimum a reference to the UPL must be included in all copies or\n+ * substantial portions of the Software.\n+ *\n+ * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n+ * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n+ * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n+ * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n+ * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n+ * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE\n+ * SOFTWARE.\n+ * #L%\n+ */\n+package com.redhat.rhjmc.containerjfr.net.web.handlers;\n+\n+import javax.inject.Inject;\n+\n+import com.redhat.rhjmc.containerjfr.core.RecordingOptionsCustomizer;\n+import com.redhat.rhjmc.containerjfr.core.RecordingOptionsCustomizer.OptionKey;\n+import com.redhat.rhjmc.containerjfr.net.AuthManager;\n+\n+import io.vertx.core.MultiMap;\n+import io.vertx.core.http.HttpMethod;\n+import io.vertx.ext.web.RoutingContext;\n+\n+class RecordingOptionsPatchHandler extends AbstractAuthenticatedRequestHandler {\n+\n+    static final String PATH = \"/api/v1/targets/:targetId/recordingOptions\";", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "7eb021723ba2fbafa00c8dbaf0a59f1c918c4ab1"}, "originalPosition": 56}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDgyODMwODQw", "url": "https://github.com/cryostatio/cryostat/pull/254#pullrequestreview-482830840", "createdAt": "2020-09-04T17:23:18Z", "commit": {"oid": "7eb021723ba2fbafa00c8dbaf0a59f1c918c4ab1"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wNFQxNzoyMzoxOFrOHNWQLQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wNFQxNzoyMzoxOFrOHNWQLQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4Mzc1ODEyNQ==", "bodyText": "The handleAuthenticated here is non-blocking so I think this can be omitted.", "url": "https://github.com/cryostatio/cryostat/pull/254#discussion_r483758125", "createdAt": "2020-09-04T17:23:18Z", "author": {"login": "andrewazores"}, "path": "src/main/java/com/redhat/rhjmc/containerjfr/net/web/handlers/RecordingOptionsPatchHandler.java", "diffHunk": "@@ -0,0 +1,99 @@\n+/*-\n+ * #%L\n+ * Container JFR\n+ * %%\n+ * Copyright (C) 2020 Red Hat, Inc.\n+ * %%\n+ * The Universal Permissive License (UPL), Version 1.0\n+ *\n+ * Subject to the condition set forth below, permission is hereby granted to any\n+ * person obtaining a copy of this software, associated documentation and/or data\n+ * (collectively the \"Software\"), free of charge and under any and all copyright\n+ * rights in the Software, and any and all patent rights owned or freely\n+ * licensable by each licensor hereunder covering either (i) the unmodified\n+ * Software as contributed to or provided by such licensor, or (ii) the Larger\n+ * Works (as defined below), to deal in both\n+ *\n+ * (a) the Software, and\n+ * (b) any piece of software and/or hardware listed in the lrgrwrks.txt file if\n+ * one is included with the Software (each a \"Larger Work\" to which the Software\n+ * is contributed by such licensors),\n+ *\n+ * without restriction, including without limitation the rights to copy, create\n+ * derivative works of, display, perform, and distribute the Software and make,\n+ * use, sell, offer for sale, import, export, have made, and have sold the\n+ * Software and the Larger Work(s), and to sublicense the foregoing rights on\n+ * either these or other terms.\n+ *\n+ * This license is subject to the following condition:\n+ * The above copyright notice and either this complete permission notice or at\n+ * a minimum a reference to the UPL must be included in all copies or\n+ * substantial portions of the Software.\n+ *\n+ * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n+ * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n+ * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n+ * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n+ * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n+ * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE\n+ * SOFTWARE.\n+ * #L%\n+ */\n+package com.redhat.rhjmc.containerjfr.net.web.handlers;\n+\n+import javax.inject.Inject;\n+\n+import com.redhat.rhjmc.containerjfr.core.RecordingOptionsCustomizer;\n+import com.redhat.rhjmc.containerjfr.core.RecordingOptionsCustomizer.OptionKey;\n+import com.redhat.rhjmc.containerjfr.net.AuthManager;\n+\n+import io.vertx.core.MultiMap;\n+import io.vertx.core.http.HttpMethod;\n+import io.vertx.ext.web.RoutingContext;\n+\n+class RecordingOptionsPatchHandler extends AbstractAuthenticatedRequestHandler {\n+\n+    static final String PATH = \"/api/v1/targets/:targetId/recordingOptions\";\n+    private final RecordingOptionsCustomizer customizer;\n+\n+    @Inject\n+    RecordingOptionsPatchHandler(AuthManager auth, RecordingOptionsCustomizer customizer) {\n+        super(auth);\n+        this.customizer = customizer;\n+    }\n+\n+    @Override\n+    public HttpMethod httpMethod() {\n+        return HttpMethod.PATCH;\n+    }\n+\n+    @Override\n+    public String path() {\n+        return PATH;\n+    }\n+\n+    @Override\n+    public boolean isAsync() {\n+        return false;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "7eb021723ba2fbafa00c8dbaf0a59f1c918c4ab1"}, "originalPosition": 77}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDgyODMxNDA3", "url": "https://github.com/cryostatio/cryostat/pull/254#pullrequestreview-482831407", "createdAt": "2020-09-04T17:24:21Z", "commit": {"oid": "7eb021723ba2fbafa00c8dbaf0a59f1c918c4ab1"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wNFQxNzoyNDoyMVrOHNWR2Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wNFQxNzoyNDoyMVrOHNWR2Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4Mzc1ODU1Mw==", "bodyText": "I wonder if it would make sense to respond with 200 and then send back the updated map, or respond 204 and no response body? If the client doesn't care about the updated value then they can simply ignore it.", "url": "https://github.com/cryostatio/cryostat/pull/254#discussion_r483758553", "createdAt": "2020-09-04T17:24:21Z", "author": {"login": "andrewazores"}, "path": "src/main/java/com/redhat/rhjmc/containerjfr/net/web/handlers/RecordingOptionsPatchHandler.java", "diffHunk": "@@ -0,0 +1,99 @@\n+/*-\n+ * #%L\n+ * Container JFR\n+ * %%\n+ * Copyright (C) 2020 Red Hat, Inc.\n+ * %%\n+ * The Universal Permissive License (UPL), Version 1.0\n+ *\n+ * Subject to the condition set forth below, permission is hereby granted to any\n+ * person obtaining a copy of this software, associated documentation and/or data\n+ * (collectively the \"Software\"), free of charge and under any and all copyright\n+ * rights in the Software, and any and all patent rights owned or freely\n+ * licensable by each licensor hereunder covering either (i) the unmodified\n+ * Software as contributed to or provided by such licensor, or (ii) the Larger\n+ * Works (as defined below), to deal in both\n+ *\n+ * (a) the Software, and\n+ * (b) any piece of software and/or hardware listed in the lrgrwrks.txt file if\n+ * one is included with the Software (each a \"Larger Work\" to which the Software\n+ * is contributed by such licensors),\n+ *\n+ * without restriction, including without limitation the rights to copy, create\n+ * derivative works of, display, perform, and distribute the Software and make,\n+ * use, sell, offer for sale, import, export, have made, and have sold the\n+ * Software and the Larger Work(s), and to sublicense the foregoing rights on\n+ * either these or other terms.\n+ *\n+ * This license is subject to the following condition:\n+ * The above copyright notice and either this complete permission notice or at\n+ * a minimum a reference to the UPL must be included in all copies or\n+ * substantial portions of the Software.\n+ *\n+ * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n+ * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n+ * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n+ * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n+ * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n+ * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE\n+ * SOFTWARE.\n+ * #L%\n+ */\n+package com.redhat.rhjmc.containerjfr.net.web.handlers;\n+\n+import javax.inject.Inject;\n+\n+import com.redhat.rhjmc.containerjfr.core.RecordingOptionsCustomizer;\n+import com.redhat.rhjmc.containerjfr.core.RecordingOptionsCustomizer.OptionKey;\n+import com.redhat.rhjmc.containerjfr.net.AuthManager;\n+\n+import io.vertx.core.MultiMap;\n+import io.vertx.core.http.HttpMethod;\n+import io.vertx.ext.web.RoutingContext;\n+\n+class RecordingOptionsPatchHandler extends AbstractAuthenticatedRequestHandler {\n+\n+    static final String PATH = \"/api/v1/targets/:targetId/recordingOptions\";\n+    private final RecordingOptionsCustomizer customizer;\n+\n+    @Inject\n+    RecordingOptionsPatchHandler(AuthManager auth, RecordingOptionsCustomizer customizer) {\n+        super(auth);\n+        this.customizer = customizer;\n+    }\n+\n+    @Override\n+    public HttpMethod httpMethod() {\n+        return HttpMethod.PATCH;\n+    }\n+\n+    @Override\n+    public String path() {\n+        return PATH;\n+    }\n+\n+    @Override\n+    public boolean isAsync() {\n+        return false;\n+    }\n+\n+    @Override\n+    void handleAuthenticated(RoutingContext ctx) throws Exception {\n+        MultiMap attrs = ctx.request().formAttributes();\n+\n+        if (attrs.contains(\"toDisk\")) {\n+            OptionKey.fromOptionName(\"toDisk\")\n+                    .ifPresent(key -> customizer.set(key, attrs.get(\"toDisk\")));\n+        }\n+        if (attrs.contains(\"maxAge\")) {\n+            OptionKey.fromOptionName(\"maxAge\")\n+                    .ifPresent(key -> customizer.set(key, attrs.get(\"maxAge\")));\n+        }\n+        if (attrs.contains(\"maxSize\")) {\n+            OptionKey.fromOptionName(\"maxSize\")\n+                    .ifPresent(key -> customizer.set(key, attrs.get(\"maxSize\")));\n+        }\n+        ctx.response().setStatusCode(200);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "7eb021723ba2fbafa00c8dbaf0a59f1c918c4ab1"}, "originalPosition": 96}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "0b0f279ec809e7f6e2f0d19ec2839e90c21b3e76", "author": {"user": {"login": "Alexjsenn", "name": "Alex Senn"}}, "url": "https://github.com/cryostatio/cryostat/commit/0b0f279ec809e7f6e2f0d19ec2839e90c21b3e76", "committedDate": "2020-09-04T20:25:46Z", "message": "Patch endpoint returns map with updated values"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDgyOTI2ODAx", "url": "https://github.com/cryostatio/cryostat/pull/254#pullrequestreview-482926801", "createdAt": "2020-09-04T20:35:54Z", "commit": {"oid": "0b0f279ec809e7f6e2f0d19ec2839e90c21b3e76"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wNFQyMDozNTo1NFrOHNa4CQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wNFQyMDozNTo1NFrOHNa4CQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MzgzMzg2NQ==", "bodyText": "I think this can be private, too.", "url": "https://github.com/cryostatio/cryostat/pull/254#discussion_r483833865", "createdAt": "2020-09-04T20:35:54Z", "author": {"login": "andrewazores"}, "path": "src/main/java/com/redhat/rhjmc/containerjfr/net/web/handlers/RecordingOptionsGetHandler.java", "diffHunk": "@@ -0,0 +1,148 @@\n+/*-\n+ * #%L\n+ * Container JFR\n+ * %%\n+ * Copyright (C) 2020 Red Hat, Inc.\n+ * %%\n+ * The Universal Permissive License (UPL), Version 1.0\n+ *\n+ * Subject to the condition set forth below, permission is hereby granted to any\n+ * person obtaining a copy of this software, associated documentation and/or data\n+ * (collectively the \"Software\"), free of charge and under any and all copyright\n+ * rights in the Software, and any and all patent rights owned or freely\n+ * licensable by each licensor hereunder covering either (i) the unmodified\n+ * Software as contributed to or provided by such licensor, or (ii) the Larger\n+ * Works (as defined below), to deal in both\n+ *\n+ * (a) the Software, and\n+ * (b) any piece of software and/or hardware listed in the lrgrwrks.txt file if\n+ * one is included with the Software (each a \"Larger Work\" to which the Software\n+ * is contributed by such licensors),\n+ *\n+ * without restriction, including without limitation the rights to copy, create\n+ * derivative works of, display, perform, and distribute the Software and make,\n+ * use, sell, offer for sale, import, export, have made, and have sold the\n+ * Software and the Larger Work(s), and to sublicense the foregoing rights on\n+ * either these or other terms.\n+ *\n+ * This license is subject to the following condition:\n+ * The above copyright notice and either this complete permission notice or at\n+ * a minimum a reference to the UPL must be included in all copies or\n+ * substantial portions of the Software.\n+ *\n+ * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n+ * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n+ * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n+ * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n+ * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n+ * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE\n+ * SOFTWARE.\n+ * #L%\n+ */\n+package com.redhat.rhjmc.containerjfr.net.web.handlers;\n+\n+import java.util.HashMap;\n+import java.util.Map;\n+import java.util.regex.Matcher;\n+import java.util.regex.Pattern;\n+\n+import javax.inject.Inject;\n+\n+import org.openjdk.jmc.common.unit.IConstrainedMap;\n+import org.openjdk.jmc.common.unit.IOptionDescriptor;\n+import org.openjdk.jmc.flightrecorder.configuration.recording.RecordingOptionsBuilder;\n+import org.openjdk.jmc.rjmx.services.jfr.IFlightRecorderService;\n+\n+import com.google.gson.Gson;\n+\n+import com.redhat.rhjmc.containerjfr.commands.internal.RecordingOptionsBuilderFactory;\n+import com.redhat.rhjmc.containerjfr.net.AuthManager;\n+import com.redhat.rhjmc.containerjfr.net.TargetConnectionManager;\n+\n+import io.vertx.core.http.HttpMethod;\n+import io.vertx.ext.web.RoutingContext;\n+\n+public class RecordingOptionsGetHandler extends AbstractAuthenticatedRequestHandler {\n+\n+    static final String PATH = \"/api/v1/targets/:targetId/recordingOptions\";\n+    protected final TargetConnectionManager connectionManager;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "0b0f279ec809e7f6e2f0d19ec2839e90c21b3e76"}, "originalPosition": 68}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDgyOTI3NjE2", "url": "https://github.com/cryostatio/cryostat/pull/254#pullrequestreview-482927616", "createdAt": "2020-09-04T20:37:59Z", "commit": {"oid": "0b0f279ec809e7f6e2f0d19ec2839e90c21b3e76"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wNFQyMDozNzo1OVrOHNa6ug==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wNFQyMDozNzo1OVrOHNa6ug==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MzgzNDU1NA==", "bodyText": "private here too", "url": "https://github.com/cryostatio/cryostat/pull/254#discussion_r483834554", "createdAt": "2020-09-04T20:37:59Z", "author": {"login": "andrewazores"}, "path": "src/main/java/com/redhat/rhjmc/containerjfr/net/web/handlers/RecordingOptionsPatchHandler.java", "diffHunk": "@@ -0,0 +1,123 @@\n+/*-\n+ * #%L\n+ * Container JFR\n+ * %%\n+ * Copyright (C) 2020 Red Hat, Inc.\n+ * %%\n+ * The Universal Permissive License (UPL), Version 1.0\n+ *\n+ * Subject to the condition set forth below, permission is hereby granted to any\n+ * person obtaining a copy of this software, associated documentation and/or data\n+ * (collectively the \"Software\"), free of charge and under any and all copyright\n+ * rights in the Software, and any and all patent rights owned or freely\n+ * licensable by each licensor hereunder covering either (i) the unmodified\n+ * Software as contributed to or provided by such licensor, or (ii) the Larger\n+ * Works (as defined below), to deal in both\n+ *\n+ * (a) the Software, and\n+ * (b) any piece of software and/or hardware listed in the lrgrwrks.txt file if\n+ * one is included with the Software (each a \"Larger Work\" to which the Software\n+ * is contributed by such licensors),\n+ *\n+ * without restriction, including without limitation the rights to copy, create\n+ * derivative works of, display, perform, and distribute the Software and make,\n+ * use, sell, offer for sale, import, export, have made, and have sold the\n+ * Software and the Larger Work(s), and to sublicense the foregoing rights on\n+ * either these or other terms.\n+ *\n+ * This license is subject to the following condition:\n+ * The above copyright notice and either this complete permission notice or at\n+ * a minimum a reference to the UPL must be included in all copies or\n+ * substantial portions of the Software.\n+ *\n+ * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n+ * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n+ * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n+ * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n+ * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n+ * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE\n+ * SOFTWARE.\n+ * #L%\n+ */\n+package com.redhat.rhjmc.containerjfr.net.web.handlers;\n+\n+import java.util.Map;\n+\n+import javax.inject.Inject;\n+\n+import org.openjdk.jmc.flightrecorder.configuration.recording.RecordingOptionsBuilder;\n+\n+import com.google.gson.Gson;\n+\n+import com.redhat.rhjmc.containerjfr.commands.internal.RecordingOptionsBuilderFactory;\n+import com.redhat.rhjmc.containerjfr.core.RecordingOptionsCustomizer;\n+import com.redhat.rhjmc.containerjfr.core.RecordingOptionsCustomizer.OptionKey;\n+import com.redhat.rhjmc.containerjfr.net.AuthManager;\n+import com.redhat.rhjmc.containerjfr.net.TargetConnectionManager;\n+\n+import io.vertx.core.MultiMap;\n+import io.vertx.core.http.HttpMethod;\n+import io.vertx.ext.web.RoutingContext;\n+\n+class RecordingOptionsPatchHandler extends AbstractAuthenticatedRequestHandler {\n+\n+    static final String PATH = RecordingOptionsGetHandler.PATH;\n+    private final RecordingOptionsCustomizer customizer;\n+    protected final TargetConnectionManager connectionManager;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "0b0f279ec809e7f6e2f0d19ec2839e90c21b3e76"}, "originalPosition": 66}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDgyOTI4Nzky", "url": "https://github.com/cryostatio/cryostat/pull/254#pullrequestreview-482928792", "createdAt": "2020-09-04T20:40:59Z", "commit": {"oid": "0b0f279ec809e7f6e2f0d19ec2839e90c21b3e76"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wNFQyMDo0MDo1OVrOHNa-Yw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wNFQyMDo0MDo1OVrOHNa-Yw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MzgzNTQ5MQ==", "bodyText": "should be requestAttrs", "url": "https://github.com/cryostatio/cryostat/pull/254#discussion_r483835491", "createdAt": "2020-09-04T20:40:59Z", "author": {"login": "andrewazores"}, "path": "src/test/java/com/redhat/rhjmc/containerjfr/net/web/handlers/RecordingOptionsPatchHandlerTest.java", "diffHunk": "@@ -0,0 +1,152 @@\n+/*-\n+ * #%L\n+ * Container JFR\n+ * %%\n+ * Copyright (C) 2020 Red Hat, Inc.\n+ * %%\n+ * The Universal Permissive License (UPL), Version 1.0\n+ *\n+ * Subject to the condition set forth below, permission is hereby granted to any\n+ * person obtaining a copy of this software, associated documentation and/or data\n+ * (collectively the \"Software\"), free of charge and under any and all copyright\n+ * rights in the Software, and any and all patent rights owned or freely\n+ * licensable by each licensor hereunder covering either (i) the unmodified\n+ * Software as contributed to or provided by such licensor, or (ii) the Larger\n+ * Works (as defined below), to deal in both\n+ *\n+ * (a) the Software, and\n+ * (b) any piece of software and/or hardware listed in the lrgrwrks.txt file if\n+ * one is included with the Software (each a \"Larger Work\" to which the Software\n+ * is contributed by such licensors),\n+ *\n+ * without restriction, including without limitation the rights to copy, create\n+ * derivative works of, display, perform, and distribute the Software and make,\n+ * use, sell, offer for sale, import, export, have made, and have sold the\n+ * Software and the Larger Work(s), and to sublicense the foregoing rights on\n+ * either these or other terms.\n+ *\n+ * This license is subject to the following condition:\n+ * The above copyright notice and either this complete permission notice or at\n+ * a minimum a reference to the UPL must be included in all copies or\n+ * substantial portions of the Software.\n+ *\n+ * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n+ * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n+ * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n+ * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n+ * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n+ * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE\n+ * SOFTWARE.\n+ * #L%\n+ */\n+package com.redhat.rhjmc.containerjfr.net.web.handlers;\n+\n+import java.util.Map;\n+\n+import org.hamcrest.MatcherAssert;\n+import org.hamcrest.Matchers;\n+import org.junit.jupiter.api.BeforeEach;\n+import org.junit.jupiter.api.Test;\n+import org.junit.jupiter.api.extension.ExtendWith;\n+import org.mockito.Mock;\n+import org.mockito.Mockito;\n+import org.mockito.invocation.InvocationOnMock;\n+import org.mockito.junit.jupiter.MockitoExtension;\n+import org.mockito.stubbing.Answer;\n+\n+import org.openjdk.jmc.common.unit.IConstrainedMap;\n+import org.openjdk.jmc.flightrecorder.configuration.recording.RecordingOptionsBuilder;\n+import org.openjdk.jmc.rjmx.services.jfr.IFlightRecorderService;\n+\n+import com.google.gson.Gson;\n+\n+import com.redhat.rhjmc.containerjfr.commands.internal.RecordingOptionsBuilderFactory;\n+import com.redhat.rhjmc.containerjfr.core.RecordingOptionsCustomizer;\n+import com.redhat.rhjmc.containerjfr.core.RecordingOptionsCustomizer.OptionKey;\n+import com.redhat.rhjmc.containerjfr.core.net.JFRConnection;\n+import com.redhat.rhjmc.containerjfr.net.AuthManager;\n+import com.redhat.rhjmc.containerjfr.net.ConnectionDescriptor;\n+import com.redhat.rhjmc.containerjfr.net.TargetConnectionManager;\n+import com.redhat.rhjmc.containerjfr.net.TargetConnectionManager.ConnectedTask;\n+\n+import io.vertx.core.MultiMap;\n+import io.vertx.core.http.HttpMethod;\n+import io.vertx.core.http.HttpServerRequest;\n+import io.vertx.core.http.HttpServerResponse;\n+import io.vertx.ext.web.RoutingContext;\n+\n+@ExtendWith(MockitoExtension.class)\n+class RecordingOptionsPatchHandlerTest {\n+\n+    RecordingOptionsPatchHandler handler;\n+    @Mock AuthManager auth;\n+    @Mock RecordingOptionsCustomizer customizer;\n+    @Mock TargetConnectionManager connectionManager;\n+    @Mock RecordingOptionsBuilderFactory recordingOptionsBuilderFactory;\n+    @Mock RecordingOptionsBuilder builder;\n+    @Mock IConstrainedMap<String> recordingOptions;\n+    @Mock JFRConnection jfrConnection;\n+    @Mock Gson gson;\n+\n+    @BeforeEach\n+    void setup() {\n+        this.handler =\n+                new RecordingOptionsPatchHandler(\n+                        auth, customizer, connectionManager, recordingOptionsBuilderFactory, gson);\n+    }\n+\n+    @Test\n+    void shouldHandleGETRequest() {\n+        MatcherAssert.assertThat(handler.httpMethod(), Matchers.equalTo(HttpMethod.PATCH));\n+    }\n+\n+    @Test\n+    void shouldHandleCorrectPath() {\n+        MatcherAssert.assertThat(\n+                handler.path(), Matchers.equalTo(\"/api/v1/targets/:targetId/recordingOptions\"));\n+    }\n+\n+    @Test\n+    void shouldSetRecordingOptions() throws Exception {\n+        Map<String, String> defaultValues =\n+                Map.of(\"toDisk\", \"true\", \"maxAge\", \"50\", \"maxSize\", \"32\");\n+        Mockito.when(recordingOptionsBuilderFactory.create(Mockito.any())).thenReturn(builder);\n+        Mockito.when(builder.build()).thenReturn(recordingOptions);\n+        Mockito.when(recordingOptions.get(\"toDisk\")).thenReturn(defaultValues.get(\"toDisk\"));\n+        Mockito.when(recordingOptions.get(\"maxAge\")).thenReturn(defaultValues.get(\"maxAge\"));\n+        Mockito.when(recordingOptions.get(\"maxSize\")).thenReturn(defaultValues.get(\"maxSize\"));\n+\n+        MultiMap RequestAttrs = MultiMap.caseInsensitiveMultiMap();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "0b0f279ec809e7f6e2f0d19ec2839e90c21b3e76"}, "originalPosition": 119}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "9eb12c41a0cbb10bd5c17a1ff01127d66a9b80ef", "author": {"user": {"login": "Alexjsenn", "name": "Alex Senn"}}, "url": "https://github.com/cryostatio/cryostat/commit/9eb12c41a0cbb10bd5c17a1ff01127d66a9b80ef", "committedDate": "2020-09-04T21:06:58Z", "message": "Formatting changes"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDgyOTQxMDQx", "url": "https://github.com/cryostatio/cryostat/pull/254#pullrequestreview-482941041", "createdAt": "2020-09-04T21:11:19Z", "commit": {"oid": "9eb12c41a0cbb10bd5c17a1ff01127d66a9b80ef"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wNFQyMToxMToyMFrOHNblZA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wNFQyMToxMToyMFrOHNblZA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4Mzg0NTQ3Ng==", "bodyText": "keys can be inlined since it isn't used anywhere lower down in the scope. Or, to be extra fancy, you could do:\nArrays.asList(\"toDisk\", \"maxAge\", \"maxSize\").forEach(key -> {\n  if (attrs.contains(key)) {\n  ...\n  }\n...\n});", "url": "https://github.com/cryostatio/cryostat/pull/254#discussion_r483845476", "createdAt": "2020-09-04T21:11:20Z", "author": {"login": "andrewazores"}, "path": "src/main/java/com/redhat/rhjmc/containerjfr/net/web/handlers/RecordingOptionsPatchHandler.java", "diffHunk": "@@ -98,19 +98,17 @@ void handleAuthenticated(RoutingContext ctx) throws Exception {\n                         getConnectionDescriptorFromContext(ctx),\n                         connection -> {\n                             MultiMap attrs = ctx.request().formAttributes();\n-                            if (attrs.contains(\"toDisk\")) {\n-                                OptionKey.fromOptionName(\"toDisk\")\n-                                        .ifPresent(key -> customizer.set(key, attrs.get(\"toDisk\")));\n-                            }\n-                            if (attrs.contains(\"maxAge\")) {\n-                                OptionKey.fromOptionName(\"maxAge\")\n-                                        .ifPresent(key -> customizer.set(key, attrs.get(\"maxAge\")));\n-                            }\n-                            if (attrs.contains(\"maxSize\")) {\n-                                OptionKey.fromOptionName(\"maxSize\")\n-                                        .ifPresent(\n-                                                key -> customizer.set(key, attrs.get(\"maxSize\")));\n+                            String[] keys = {\"toDisk\", \"maxAge\", \"maxSize\"};\n+                            for (String key : keys) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "9eb12c41a0cbb10bd5c17a1ff01127d66a9b80ef"}, "originalPosition": 26}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "33b5ddb8a1f190a167c782373775274de7168151", "author": {"user": {"login": "Alexjsenn", "name": "Alex Senn"}}, "url": "https://github.com/cryostatio/cryostat/commit/33b5ddb8a1f190a167c782373775274de7168151", "committedDate": "2020-09-08T15:38:03Z", "message": "Create helper function"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDg0Mjk5MTk5", "url": "https://github.com/cryostatio/cryostat/pull/254#pullrequestreview-484299199", "createdAt": "2020-09-08T16:17:20Z", "commit": {"oid": "33b5ddb8a1f190a167c782373775274de7168151"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wOFQxNjoxNzoyMFrOHOkpfg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wOFQxNjoxNzoyMFrOHOkpfg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NTA0MjU1OA==", "bodyText": "Ah, now that the path includes the targetId portion, these handlers should be renamed like TargetRecordingOptionsVerbHandler.", "url": "https://github.com/cryostatio/cryostat/pull/254#discussion_r485042558", "createdAt": "2020-09-08T16:17:20Z", "author": {"login": "andrewazores"}, "path": "src/main/java/com/redhat/rhjmc/containerjfr/net/web/handlers/RecordingOptionsGetHandler.java", "diffHunk": "@@ -0,0 +1,147 @@\n+/*-\n+ * #%L\n+ * Container JFR\n+ * %%\n+ * Copyright (C) 2020 Red Hat, Inc.\n+ * %%\n+ * The Universal Permissive License (UPL), Version 1.0\n+ *\n+ * Subject to the condition set forth below, permission is hereby granted to any\n+ * person obtaining a copy of this software, associated documentation and/or data\n+ * (collectively the \"Software\"), free of charge and under any and all copyright\n+ * rights in the Software, and any and all patent rights owned or freely\n+ * licensable by each licensor hereunder covering either (i) the unmodified\n+ * Software as contributed to or provided by such licensor, or (ii) the Larger\n+ * Works (as defined below), to deal in both\n+ *\n+ * (a) the Software, and\n+ * (b) any piece of software and/or hardware listed in the lrgrwrks.txt file if\n+ * one is included with the Software (each a \"Larger Work\" to which the Software\n+ * is contributed by such licensors),\n+ *\n+ * without restriction, including without limitation the rights to copy, create\n+ * derivative works of, display, perform, and distribute the Software and make,\n+ * use, sell, offer for sale, import, export, have made, and have sold the\n+ * Software and the Larger Work(s), and to sublicense the foregoing rights on\n+ * either these or other terms.\n+ *\n+ * This license is subject to the following condition:\n+ * The above copyright notice and either this complete permission notice or at\n+ * a minimum a reference to the UPL must be included in all copies or\n+ * substantial portions of the Software.\n+ *\n+ * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n+ * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n+ * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n+ * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n+ * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n+ * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE\n+ * SOFTWARE.\n+ * #L%\n+ */\n+package com.redhat.rhjmc.containerjfr.net.web.handlers;\n+\n+import java.util.HashMap;\n+import java.util.Map;\n+import java.util.regex.Matcher;\n+import java.util.regex.Pattern;\n+\n+import javax.inject.Inject;\n+\n+import org.openjdk.jmc.common.unit.IConstrainedMap;\n+import org.openjdk.jmc.common.unit.IOptionDescriptor;\n+import org.openjdk.jmc.flightrecorder.configuration.recording.RecordingOptionsBuilder;\n+import org.openjdk.jmc.rjmx.services.jfr.IFlightRecorderService;\n+\n+import com.google.gson.Gson;\n+\n+import com.redhat.rhjmc.containerjfr.commands.internal.RecordingOptionsBuilderFactory;\n+import com.redhat.rhjmc.containerjfr.net.AuthManager;\n+import com.redhat.rhjmc.containerjfr.net.TargetConnectionManager;\n+\n+import io.vertx.core.http.HttpMethod;\n+import io.vertx.ext.web.RoutingContext;\n+\n+class RecordingOptionsGetHandler extends AbstractAuthenticatedRequestHandler {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "33b5ddb8a1f190a167c782373775274de7168151"}, "originalPosition": 65}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "11d891efe3e7752e58d050b275b894f030874a82", "author": {"user": {"login": "Alexjsenn", "name": "Alex Senn"}}, "url": "https://github.com/cryostatio/cryostat/commit/11d891efe3e7752e58d050b275b894f030874a82", "committedDate": "2020-09-08T16:41:03Z", "message": "rename APIs with Target prefix"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDg1MjAwMDg3", "url": "https://github.com/cryostatio/cryostat/pull/254#pullrequestreview-485200087", "createdAt": "2020-09-09T16:34:36Z", "commit": {"oid": "11d891efe3e7752e58d050b275b894f030874a82"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wOVQxNjozNDozNlrOHPQOlQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wOVQxNjozNDozNlrOHPQOlQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NTc1NjU2NQ==", "bodyText": "Last thing:\n$ curl -vk -X PATCH -d \"maxAge=no&toDisk=123\" -H \"X-JMX-Authorization: Basic $(echo -n user:pass | base64)\" https://0.0.0.0:8181/api/v1/targets/localhost/recordingOptions\n*   Trying 0.0.0.0:8181...\n* TCP_NODELAY set\n* Connected to 0.0.0.0 (127.0.0.1) port 8181 (#0)\n* ALPN, offering h2\n* ALPN, offering http/1.1\n* successfully set certificate verify locations:\n*   CAfile: /etc/pki/tls/certs/ca-bundle.crt\n  CApath: none\n* TLSv1.3 (OUT), TLS handshake, Client hello (1):\n* TLSv1.3 (IN), TLS handshake, Server hello (2):\n* TLSv1.2 (IN), TLS handshake, Certificate (11):\n* TLSv1.2 (IN), TLS handshake, Server key exchange (12):\n* TLSv1.2 (IN), TLS handshake, Server finished (14):\n* TLSv1.2 (OUT), TLS handshake, Client key exchange (16):\n* TLSv1.2 (OUT), TLS change cipher, Change cipher spec (1):\n* TLSv1.2 (OUT), TLS handshake, Finished (20):\n* TLSv1.2 (IN), TLS handshake, Finished (20):\n* SSL connection using TLSv1.2 / ECDHE-RSA-AES256-GCM-SHA384\n* ALPN, server did not agree to a protocol\n* Server certificate:\n*  subject: C=US; O=Red Hat; CN=container-jfr\n*  start date: Sep  9 16:27:38 2020 GMT\n*  expire date: Mar  8 16:27:38 2021 GMT\n*  issuer: C=US; O=Red Hat; CN=container-jfr\n*  SSL certificate verify result: self signed certificate (18), continuing anyway.\n> PATCH /api/v1/targets/localhost/recordingOptions HTTP/1.1\n> Host: 0.0.0.0:8181\n> User-Agent: curl/7.66.0\n> Accept: */*\n> X-JMX-Authorization: Basic dXNlcjpwYXNz\n> Content-Length: 20\n> Content-Type: application/x-www-form-urlencoded\n> \n* upload completely sent off: 20 out of 20 bytes\n* Mark bundle as not supporting multiuse\n< HTTP/1.1 200 OK\n< content-length: 45\n< \n* Connection #0 to host 0.0.0.0 left intact\n{\"maxAge\":\"0\",\"toDisk\":\"false\",\"maxSize\":\"0\"}\n\nThe options I set are invalid, and the ContainerJFR logs do reflect that, but the response sent is still a 200 OK. The Customizer needs refactoring to throw exceptions when its validations fail instead of simply logging them, however, that refactor should probably wait until the Command equivalent to this handler is removed so that the Customizer doesn't need to support both cases.\nSo, for now, please add some basic validations for these three attributes, and if the validation fails respond with some 4xx status code.", "url": "https://github.com/cryostatio/cryostat/pull/254#discussion_r485756565", "createdAt": "2020-09-09T16:34:36Z", "author": {"login": "andrewazores"}, "path": "src/main/java/com/redhat/rhjmc/containerjfr/net/web/handlers/TargetRecordingOptionsPatchHandler.java", "diffHunk": "@@ -0,0 +1,125 @@\n+/*-\n+ * #%L\n+ * Container JFR\n+ * %%\n+ * Copyright (C) 2020 Red Hat, Inc.\n+ * %%\n+ * The Universal Permissive License (UPL), Version 1.0\n+ *\n+ * Subject to the condition set forth below, permission is hereby granted to any\n+ * person obtaining a copy of this software, associated documentation and/or data\n+ * (collectively the \"Software\"), free of charge and under any and all copyright\n+ * rights in the Software, and any and all patent rights owned or freely\n+ * licensable by each licensor hereunder covering either (i) the unmodified\n+ * Software as contributed to or provided by such licensor, or (ii) the Larger\n+ * Works (as defined below), to deal in both\n+ *\n+ * (a) the Software, and\n+ * (b) any piece of software and/or hardware listed in the lrgrwrks.txt file if\n+ * one is included with the Software (each a \"Larger Work\" to which the Software\n+ * is contributed by such licensors),\n+ *\n+ * without restriction, including without limitation the rights to copy, create\n+ * derivative works of, display, perform, and distribute the Software and make,\n+ * use, sell, offer for sale, import, export, have made, and have sold the\n+ * Software and the Larger Work(s), and to sublicense the foregoing rights on\n+ * either these or other terms.\n+ *\n+ * This license is subject to the following condition:\n+ * The above copyright notice and either this complete permission notice or at\n+ * a minimum a reference to the UPL must be included in all copies or\n+ * substantial portions of the Software.\n+ *\n+ * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n+ * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n+ * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n+ * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n+ * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n+ * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE\n+ * SOFTWARE.\n+ * #L%\n+ */\n+package com.redhat.rhjmc.containerjfr.net.web.handlers;\n+\n+import java.util.Arrays;\n+import java.util.Map;\n+\n+import javax.inject.Inject;\n+\n+import org.openjdk.jmc.flightrecorder.configuration.recording.RecordingOptionsBuilder;\n+\n+import com.google.gson.Gson;\n+\n+import com.redhat.rhjmc.containerjfr.commands.internal.RecordingOptionsBuilderFactory;\n+import com.redhat.rhjmc.containerjfr.core.RecordingOptionsCustomizer;\n+import com.redhat.rhjmc.containerjfr.core.RecordingOptionsCustomizer.OptionKey;\n+import com.redhat.rhjmc.containerjfr.net.AuthManager;\n+import com.redhat.rhjmc.containerjfr.net.TargetConnectionManager;\n+\n+import io.vertx.core.MultiMap;\n+import io.vertx.core.http.HttpMethod;\n+import io.vertx.ext.web.RoutingContext;\n+\n+class TargetRecordingOptionsPatchHandler extends AbstractAuthenticatedRequestHandler {\n+\n+    static final String PATH = TargetRecordingOptionsGetHandler.PATH;\n+    private final RecordingOptionsCustomizer customizer;\n+    private final TargetConnectionManager connectionManager;\n+    private final RecordingOptionsBuilderFactory recordingOptionsBuilderFactory;\n+    private final Gson gson;\n+\n+    @Inject\n+    TargetRecordingOptionsPatchHandler(\n+            AuthManager auth,\n+            RecordingOptionsCustomizer customizer,\n+            TargetConnectionManager connectionManager,\n+            RecordingOptionsBuilderFactory recordingOptionsBuilderFactory,\n+            Gson gson) {\n+        super(auth);\n+        this.customizer = customizer;\n+        this.connectionManager = connectionManager;\n+        this.recordingOptionsBuilderFactory = recordingOptionsBuilderFactory;\n+        this.gson = gson;\n+    }\n+\n+    @Override\n+    public HttpMethod httpMethod() {\n+        return HttpMethod.PATCH;\n+    }\n+\n+    @Override\n+    public String path() {\n+        return PATH;\n+    }\n+\n+    @Override\n+    void handleAuthenticated(RoutingContext ctx) throws Exception {\n+        Map<String, String> updatedMap =\n+                connectionManager.executeConnectedTask(\n+                        getConnectionDescriptorFromContext(ctx),\n+                        connection -> {\n+                            MultiMap attrs = ctx.request().formAttributes();\n+                            Arrays.asList(\"toDisk\", \"maxAge\", \"maxSize\")\n+                                    .forEach(\n+                                            key -> {\n+                                                if (attrs.contains(key)) {\n+                                                    OptionKey.fromOptionName(key)\n+                                                            .ifPresent(\n+                                                                    optionKey ->\n+                                                                            customizer.set(\n+                                                                                    optionKey,\n+                                                                                    attrs.get(", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "11d891efe3e7752e58d050b275b894f030874a82"}, "originalPosition": 111}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b8f08571acdc719401cb79d6ca74ae6772fb9a5d", "author": {"user": {"login": "Alexjsenn", "name": "Alex Senn"}}, "url": "https://github.com/cryostatio/cryostat/commit/b8f08571acdc719401cb79d6ca74ae6772fb9a5d", "committedDate": "2020-09-09T19:11:26Z", "message": "check for invalid PATCH attributes"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDg1MzQ0MDAx", "url": "https://github.com/cryostatio/cryostat/pull/254#pullrequestreview-485344001", "createdAt": "2020-09-09T19:34:30Z", "commit": {"oid": "b8f08571acdc719401cb79d6ca74ae6772fb9a5d"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wOVQxOTozNDozMFrOHPW2NQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wOVQxOTozNDozMFrOHPW2NQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NTg2NTAxMw==", "bodyText": "This doesn't quite work as intended - parseBoolean is true if the input string is \"true\", case insensitive, and false for all other inputs. It doesn't throw.\nOn a related note, it would be good to exercise these validations with unit tests.", "url": "https://github.com/cryostatio/cryostat/pull/254#discussion_r485865013", "createdAt": "2020-09-09T19:34:30Z", "author": {"login": "andrewazores"}, "path": "src/main/java/com/redhat/rhjmc/containerjfr/net/web/handlers/TargetRecordingOptionsPatchHandler.java", "diffHunk": "@@ -0,0 +1,144 @@\n+/*-\n+ * #%L\n+ * Container JFR\n+ * %%\n+ * Copyright (C) 2020 Red Hat, Inc.\n+ * %%\n+ * The Universal Permissive License (UPL), Version 1.0\n+ *\n+ * Subject to the condition set forth below, permission is hereby granted to any\n+ * person obtaining a copy of this software, associated documentation and/or data\n+ * (collectively the \"Software\"), free of charge and under any and all copyright\n+ * rights in the Software, and any and all patent rights owned or freely\n+ * licensable by each licensor hereunder covering either (i) the unmodified\n+ * Software as contributed to or provided by such licensor, or (ii) the Larger\n+ * Works (as defined below), to deal in both\n+ *\n+ * (a) the Software, and\n+ * (b) any piece of software and/or hardware listed in the lrgrwrks.txt file if\n+ * one is included with the Software (each a \"Larger Work\" to which the Software\n+ * is contributed by such licensors),\n+ *\n+ * without restriction, including without limitation the rights to copy, create\n+ * derivative works of, display, perform, and distribute the Software and make,\n+ * use, sell, offer for sale, import, export, have made, and have sold the\n+ * Software and the Larger Work(s), and to sublicense the foregoing rights on\n+ * either these or other terms.\n+ *\n+ * This license is subject to the following condition:\n+ * The above copyright notice and either this complete permission notice or at\n+ * a minimum a reference to the UPL must be included in all copies or\n+ * substantial portions of the Software.\n+ *\n+ * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n+ * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n+ * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n+ * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n+ * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n+ * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE\n+ * SOFTWARE.\n+ * #L%\n+ */\n+package com.redhat.rhjmc.containerjfr.net.web.handlers;\n+\n+import java.util.Arrays;\n+import java.util.Map;\n+\n+import javax.inject.Inject;\n+\n+import org.openjdk.jmc.flightrecorder.configuration.recording.RecordingOptionsBuilder;\n+\n+import com.google.gson.Gson;\n+\n+import com.redhat.rhjmc.containerjfr.commands.internal.RecordingOptionsBuilderFactory;\n+import com.redhat.rhjmc.containerjfr.core.RecordingOptionsCustomizer;\n+import com.redhat.rhjmc.containerjfr.core.RecordingOptionsCustomizer.OptionKey;\n+import com.redhat.rhjmc.containerjfr.net.AuthManager;\n+import com.redhat.rhjmc.containerjfr.net.TargetConnectionManager;\n+\n+import io.vertx.core.MultiMap;\n+import io.vertx.core.http.HttpMethod;\n+import io.vertx.ext.web.RoutingContext;\n+import io.vertx.ext.web.handler.impl.HttpStatusException;\n+\n+class TargetRecordingOptionsPatchHandler extends AbstractAuthenticatedRequestHandler {\n+\n+    static final String PATH = TargetRecordingOptionsGetHandler.PATH;\n+    private final RecordingOptionsCustomizer customizer;\n+    private final TargetConnectionManager connectionManager;\n+    private final RecordingOptionsBuilderFactory recordingOptionsBuilderFactory;\n+    private final Gson gson;\n+\n+    @Inject\n+    TargetRecordingOptionsPatchHandler(\n+            AuthManager auth,\n+            RecordingOptionsCustomizer customizer,\n+            TargetConnectionManager connectionManager,\n+            RecordingOptionsBuilderFactory recordingOptionsBuilderFactory,\n+            Gson gson) {\n+        super(auth);\n+        this.customizer = customizer;\n+        this.connectionManager = connectionManager;\n+        this.recordingOptionsBuilderFactory = recordingOptionsBuilderFactory;\n+        this.gson = gson;\n+    }\n+\n+    @Override\n+    public HttpMethod httpMethod() {\n+        return HttpMethod.PATCH;\n+    }\n+\n+    @Override\n+    public String path() {\n+        return PATH;\n+    }\n+\n+    @Override\n+    void handleAuthenticated(RoutingContext ctx) throws Exception {\n+        MultiMap attrs = ctx.request().formAttributes();\n+        if (attrs.contains(\"toDisk\")) {\n+            try {\n+                Boolean.parseBoolean(attrs.get(\"toDisk\"));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b8f08571acdc719401cb79d6ca74ae6772fb9a5d"}, "originalPosition": 101}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "bb13f57ef191baac3ebb30a054b0b925f594e3cd", "author": {"user": {"login": "Alexjsenn", "name": "Alex Senn"}}, "url": "https://github.com/cryostatio/cryostat/commit/bb13f57ef191baac3ebb30a054b0b925f594e3cd", "committedDate": "2020-09-09T20:04:55Z", "message": "fix boolean check"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "0e8b05fccb77d20ba37a91105fcd4a407417df94", "author": {"user": {"login": "Alexjsenn", "name": "Alex Senn"}}, "url": "https://github.com/cryostatio/cryostat/commit/0e8b05fccb77d20ba37a91105fcd4a407417df94", "committedDate": "2020-09-10T15:07:26Z", "message": "add unit test for invalid arguments to PATCH request"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDg2MDgyMjU2", "url": "https://github.com/cryostatio/cryostat/pull/254#pullrequestreview-486082256", "createdAt": "2020-09-10T15:55:58Z", "commit": {"oid": "0e8b05fccb77d20ba37a91105fcd4a407417df94"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xMFQxNTo1NTo1OFrOHP61pA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xMFQxNTo1NTo1OFrOHP61pA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NjQ1NDY5Mg==", "bodyText": "I'd like to see a few more cases covered here - toDisk: '', maxAge: '', toDisk: null, toDisk: T, maxAge: 0.5, maxAge: 1e3 for example. And since both this handler and the TargetRecordingsPostHandler share similar validation implementations, that handler should also have tests similar to this one.", "url": "https://github.com/cryostatio/cryostat/pull/254#discussion_r486454692", "createdAt": "2020-09-10T15:55:58Z", "author": {"login": "andrewazores"}, "path": "src/test/java/com/redhat/rhjmc/containerjfr/net/web/handlers/TargetRecordingOptionsPatchHandlerTest.java", "diffHunk": "@@ -0,0 +1,178 @@\n+/*-\n+ * #%L\n+ * Container JFR\n+ * %%\n+ * Copyright (C) 2020 Red Hat, Inc.\n+ * %%\n+ * The Universal Permissive License (UPL), Version 1.0\n+ *\n+ * Subject to the condition set forth below, permission is hereby granted to any\n+ * person obtaining a copy of this software, associated documentation and/or data\n+ * (collectively the \"Software\"), free of charge and under any and all copyright\n+ * rights in the Software, and any and all patent rights owned or freely\n+ * licensable by each licensor hereunder covering either (i) the unmodified\n+ * Software as contributed to or provided by such licensor, or (ii) the Larger\n+ * Works (as defined below), to deal in both\n+ *\n+ * (a) the Software, and\n+ * (b) any piece of software and/or hardware listed in the lrgrwrks.txt file if\n+ * one is included with the Software (each a \"Larger Work\" to which the Software\n+ * is contributed by such licensors),\n+ *\n+ * without restriction, including without limitation the rights to copy, create\n+ * derivative works of, display, perform, and distribute the Software and make,\n+ * use, sell, offer for sale, import, export, have made, and have sold the\n+ * Software and the Larger Work(s), and to sublicense the foregoing rights on\n+ * either these or other terms.\n+ *\n+ * This license is subject to the following condition:\n+ * The above copyright notice and either this complete permission notice or at\n+ * a minimum a reference to the UPL must be included in all copies or\n+ * substantial portions of the Software.\n+ *\n+ * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n+ * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n+ * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n+ * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n+ * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n+ * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE\n+ * SOFTWARE.\n+ * #L%\n+ */\n+package com.redhat.rhjmc.containerjfr.net.web.handlers;\n+\n+import java.util.Map;\n+import java.util.stream.Stream;\n+\n+import org.hamcrest.MatcherAssert;\n+import org.hamcrest.Matchers;\n+import org.junit.jupiter.api.Assertions;\n+import org.junit.jupiter.api.BeforeEach;\n+import org.junit.jupiter.api.Test;\n+import org.junit.jupiter.api.extension.ExtendWith;\n+import org.junit.jupiter.params.ParameterizedTest;\n+import org.junit.jupiter.params.provider.MethodSource;\n+import org.mockito.Mock;\n+import org.mockito.Mockito;\n+import org.mockito.invocation.InvocationOnMock;\n+import org.mockito.junit.jupiter.MockitoExtension;\n+import org.mockito.stubbing.Answer;\n+\n+import org.openjdk.jmc.common.unit.IConstrainedMap;\n+import org.openjdk.jmc.flightrecorder.configuration.recording.RecordingOptionsBuilder;\n+import org.openjdk.jmc.rjmx.services.jfr.IFlightRecorderService;\n+\n+import com.google.gson.Gson;\n+\n+import com.redhat.rhjmc.containerjfr.commands.internal.RecordingOptionsBuilderFactory;\n+import com.redhat.rhjmc.containerjfr.core.RecordingOptionsCustomizer;\n+import com.redhat.rhjmc.containerjfr.core.RecordingOptionsCustomizer.OptionKey;\n+import com.redhat.rhjmc.containerjfr.core.net.JFRConnection;\n+import com.redhat.rhjmc.containerjfr.net.AuthManager;\n+import com.redhat.rhjmc.containerjfr.net.ConnectionDescriptor;\n+import com.redhat.rhjmc.containerjfr.net.TargetConnectionManager;\n+import com.redhat.rhjmc.containerjfr.net.TargetConnectionManager.ConnectedTask;\n+\n+import io.vertx.core.MultiMap;\n+import io.vertx.core.http.HttpMethod;\n+import io.vertx.core.http.HttpServerRequest;\n+import io.vertx.core.http.HttpServerResponse;\n+import io.vertx.ext.web.RoutingContext;\n+import io.vertx.ext.web.handler.impl.HttpStatusException;\n+\n+@ExtendWith(MockitoExtension.class)\n+class TargetRecordingOptionsPatchHandlerTest {\n+\n+    TargetRecordingOptionsPatchHandler handler;\n+    @Mock AuthManager auth;\n+    @Mock RecordingOptionsCustomizer customizer;\n+    @Mock TargetConnectionManager connectionManager;\n+    @Mock RecordingOptionsBuilderFactory recordingOptionsBuilderFactory;\n+    @Mock RecordingOptionsBuilder builder;\n+    @Mock IConstrainedMap<String> recordingOptions;\n+    @Mock JFRConnection jfrConnection;\n+    @Mock Gson gson;\n+\n+    @BeforeEach\n+    void setup() {\n+        this.handler =\n+                new TargetRecordingOptionsPatchHandler(\n+                        auth, customizer, connectionManager, recordingOptionsBuilderFactory, gson);\n+    }\n+\n+    @Test\n+    void shouldHandleGETRequest() {\n+        MatcherAssert.assertThat(handler.httpMethod(), Matchers.equalTo(HttpMethod.PATCH));\n+    }\n+\n+    @Test\n+    void shouldHandleCorrectPath() {\n+        MatcherAssert.assertThat(\n+                handler.path(), Matchers.equalTo(\"/api/v1/targets/:targetId/recordingOptions\"));\n+    }\n+\n+    @Test\n+    void shouldSetRecordingOptions() throws Exception {\n+        Map<String, String> defaultValues =\n+                Map.of(\"toDisk\", \"true\", \"maxAge\", \"50\", \"maxSize\", \"32\");\n+        Mockito.when(recordingOptionsBuilderFactory.create(Mockito.any())).thenReturn(builder);\n+        Mockito.when(builder.build()).thenReturn(recordingOptions);\n+        Mockito.when(recordingOptions.get(\"toDisk\")).thenReturn(defaultValues.get(\"toDisk\"));\n+        Mockito.when(recordingOptions.get(\"maxAge\")).thenReturn(defaultValues.get(\"maxAge\"));\n+        Mockito.when(recordingOptions.get(\"maxSize\")).thenReturn(defaultValues.get(\"maxSize\"));\n+\n+        MultiMap requestAttrs = MultiMap.caseInsensitiveMultiMap();\n+        requestAttrs.addAll(defaultValues);\n+\n+        Mockito.when(\n+                        connectionManager.executeConnectedTask(\n+                                Mockito.any(ConnectionDescriptor.class), Mockito.any()))\n+                .thenAnswer(\n+                        new Answer<>() {\n+                            @Override\n+                            public Map answer(InvocationOnMock args) throws Throwable {\n+                                ConnectedTask ct = (ConnectedTask) args.getArguments()[1];\n+                                return (Map) ct.execute(jfrConnection);\n+                            }\n+                        });\n+\n+        RoutingContext ctx = Mockito.mock(RoutingContext.class);\n+        Mockito.when(ctx.pathParam(\"targetId\")).thenReturn(\"foo:9091\");\n+        HttpServerRequest req = Mockito.mock(HttpServerRequest.class);\n+        Mockito.when(ctx.request()).thenReturn(req);\n+        Mockito.when(req.headers()).thenReturn(MultiMap.caseInsensitiveMultiMap());\n+        Mockito.when(req.formAttributes()).thenReturn(requestAttrs);\n+        HttpServerResponse resp = Mockito.mock(HttpServerResponse.class);\n+        Mockito.when(ctx.response()).thenReturn(resp);\n+        IFlightRecorderService service = Mockito.mock(IFlightRecorderService.class);\n+        Mockito.when(jfrConnection.getService()).thenReturn(service);\n+\n+        handler.handleAuthenticated(ctx);\n+\n+        for (var entry : requestAttrs.entries()) {\n+            var key = OptionKey.fromOptionName(entry.getKey());\n+            Mockito.verify(customizer).set(key.get(), entry.getValue());\n+        }\n+    }\n+\n+    @ParameterizedTest\n+    @MethodSource(\"getRequestMaps\")\n+    void shouldThrowInvalidOptionException(Map<String, String> defaultValues) throws Exception {\n+        MultiMap requestAttrs = MultiMap.caseInsensitiveMultiMap();\n+        requestAttrs.addAll(defaultValues);\n+\n+        RoutingContext ctx = Mockito.mock(RoutingContext.class);\n+        HttpServerRequest req = Mockito.mock(HttpServerRequest.class);\n+        Mockito.when(ctx.request()).thenReturn(req);\n+        Mockito.when(req.formAttributes()).thenReturn(requestAttrs);\n+        HttpStatusException ex =\n+                Assertions.assertThrows(\n+                        HttpStatusException.class, () -> handler.handleAuthenticated(ctx));\n+        MatcherAssert.assertThat(ex.getStatusCode(), Matchers.equalTo(400));\n+    }\n+\n+    private static Stream<Map<String, String>> getRequestMaps() {\n+        return Stream.of(\n+                Map.of(\"toDisk\", \"5\"), Map.of(\"maxAge\", \"true\"), Map.of(\"maxSize\", \"false\"));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "0e8b05fccb77d20ba37a91105fcd4a407417df94"}, "originalPosition": 176}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "98767d8cb0f728017b31e1b9d235ce1607269577", "author": {"user": {"login": "Alexjsenn", "name": "Alex Senn"}}, "url": "https://github.com/cryostatio/cryostat/commit/98767d8cb0f728017b31e1b9d235ce1607269577", "committedDate": "2020-09-10T17:41:49Z", "message": "add test cases for invalid recording options"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDg2MjA1MTUx", "url": "https://github.com/cryostatio/cryostat/pull/254#pullrequestreview-486205151", "createdAt": "2020-09-10T18:28:31Z", "commit": {"oid": "98767d8cb0f728017b31e1b9d235ce1607269577"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xMFQxODoyODozMVrOHQAsxA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xMFQxODoyODozMVrOHQAsxA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NjU1MDcyNA==", "bodyText": "The other handler looks like it directly throws an HttpStatusException, but this one is still a NumberFormatException - they should probably be consistent with each other", "url": "https://github.com/cryostatio/cryostat/pull/254#discussion_r486550724", "createdAt": "2020-09-10T18:28:31Z", "author": {"login": "andrewazores"}, "path": "src/main/java/com/redhat/rhjmc/containerjfr/net/web/handlers/TargetRecordingsPostHandler.java", "diffHunk": "@@ -162,6 +162,22 @@ void handleAuthenticated(RoutingContext ctx) throws Exception {\n                                                     TimeUnit.SECONDS.toMillis(\n                                                             Long.parseLong(attrs.get(\"duration\"))));\n                                 }\n+                                if (attrs.contains(\"toDisk\")) {\n+                                    Pattern bool = Pattern.compile(\"true|false\");\n+                                    Matcher m = bool.matcher(attrs.get(\"toDisk\"));\n+                                    if (!m.find())\n+                                        throw new NumberFormatException(", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "98767d8cb0f728017b31e1b9d235ce1607269577"}, "originalPosition": 8}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "715491a8a859bacecc760fcdd6dea1db8af63717", "author": {"user": {"login": "Alexjsenn", "name": "Alex Senn"}}, "url": "https://github.com/cryostatio/cryostat/commit/715491a8a859bacecc760fcdd6dea1db8af63717", "committedDate": "2020-09-10T19:24:33Z", "message": "add exception catch block in patch handler"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "cfcc1033938af17610ce5a6907307797aeeb983f", "author": {"user": {"login": "Alexjsenn", "name": "Alex Senn"}}, "url": "https://github.com/cryostatio/cryostat/commit/cfcc1033938af17610ce5a6907307797aeeb983f", "committedDate": "2020-09-10T20:09:08Z", "message": "modify exeption format"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDg2MzA4ODk4", "url": "https://github.com/cryostatio/cryostat/pull/254#pullrequestreview-486308898", "createdAt": "2020-09-10T21:03:53Z", "commit": {"oid": "cfcc1033938af17610ce5a6907307797aeeb983f"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3206, "cost": 1, "resetAt": "2021-11-01T13:51:04Z"}}}