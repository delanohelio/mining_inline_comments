{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDQ5MTAzNjY0", "number": 206, "title": "Change Response Message from `validate()`", "bodyText": "Fixes #195.\nIn commands, validate() is now a void method which throws FailedValidationException. If the validation fails, then the method prints the error message with its ClientWriter, and then throws a FailedValidationException which contains the same error message. If the validation is successful, the method simply returns.\nIn command registries, the validate() method has been to match Command.validate().\nIn WsCommandExecutor, the ResponseMessage from a failed validation has its payload changed to say that the command could not be validated, and includes the error message from the validate() call (obtained via the caught exception). Previously the response just said that the given arguments were invalid.\n{command:list}\n{\"id\":null,\"commandName\":\"list\",\"status\":-1,\"payload\":\"Could not validate \\\"list\\\" command; Expected one argument: hostname:port, ip:port, or JMX service URL\"}\n\nIn the AbstractCommandExecutor, validateCommands() has been changed to output a more generic error message upon a failed validation; it now just says that the validation failed, whereas previously it specified that the arguments passed in were invalid. It prints a generic error message instead of the specific error message from the caught exception, because the validate() method in the commands will have already printed the specific error message.\n> list\nExpected one argument: hostname:port, ip:port, or JMX service URL\n\tCommand \"list\" could not be validated\n\nAdditional, somewhat unrelated things of note: I did some light refactoring as I was working on the *CommandTest tests, like adding a check for the error message when there wasn't before, and changing argc validation test names to be more consistent. The connect and disconnect in BatchModeExecutorTest were changed to existing commands. Also I made a small fix to COMMANDS.md.\nEdit: The commit, \"Change tests to reflect the re-added cw.println() in validate()\" should really just be, \"Change Command unit tests to work with new validate()\"; the unit tests for commands weren't actually ever modified before that commit.", "createdAt": "2020-07-14T20:42:13Z", "url": "https://github.com/cryostatio/cryostat/pull/206", "merged": true, "mergeCommit": {"oid": "7cd5d2b17e2b75c167377dac83d15d9e144dd906"}, "closed": true, "closedAt": "2020-07-20T21:02:33Z", "author": {"login": "vic-ma"}, "timelineItems": {"totalCount": 26, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABc08oLaABqjM1NDU5Mzc4NTQ=", "endCursor": "Y3Vyc29yOnYyOpPPAAABc23TNOgFqTQ1MTkxOTE5NA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "59d7699926dd6468c3195f87fcc382dad4aad844", "author": {"user": {"login": "vic-ma", "name": "Victor Ma"}}, "url": "https://github.com/cryostatio/cryostat/commit/59d7699926dd6468c3195f87fcc382dad4aad844", "committedDate": "2020-07-14T18:58:46Z", "message": "Make small final fixes"}, "afterCommit": {"oid": "34aa0813954c4d19e2e2bb0d59209472672f7532", "author": {"user": {"login": "vic-ma", "name": "Victor Ma"}}, "url": "https://github.com/cryostatio/cryostat/commit/34aa0813954c4d19e2e2bb0d59209472672f7532", "committedDate": "2020-07-14T21:01:15Z", "message": "Make small final fixes"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDQ4NDc3NTgz", "url": "https://github.com/cryostatio/cryostat/pull/206#pullrequestreview-448477583", "createdAt": "2020-07-14T21:25:16Z", "commit": {"oid": "34aa0813954c4d19e2e2bb0d59209472672f7532"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xNFQyMToyNToxNlrOGxl6nw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xNFQyMToyNToxNlrOGxl6nw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NDY1NDYyMw==", "bodyText": "Typo: s/targedId/targetId/", "url": "https://github.com/cryostatio/cryostat/pull/206#discussion_r454654623", "createdAt": "2020-07-14T21:25:16Z", "author": {"login": "andrewazores"}, "path": "COMMANDS.md", "diffHunk": "@@ -275,11 +275,11 @@ formatted as a JSON response.\n \n * #### `wait-for`\n     ###### usage\n-    `wait-for foo`\n+    `wait-for targedId foo`", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "34aa0813954c4d19e2e2bb0d59209472672f7532"}, "originalPosition": 14}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDQ4NDgyMjgw", "url": "https://github.com/cryostatio/cryostat/pull/206#pullrequestreview-448482280", "createdAt": "2020-07-14T21:33:07Z", "commit": {"oid": "34aa0813954c4d19e2e2bb0d59209472672f7532"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xNFQyMTozMzowN1rOGxmJsA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xNFQyMTozMzowN1rOGxmJsA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NDY1ODQ4MA==", "bodyText": "In this kind of scenario where there are multiple validation checks that can fail, beyond the most basic \"wrong number of arguments\" failure, how about performing all of the checks and constructing a message informing the client about all of the failures, rather than just the \"first\" in the arbitrary implementation order?", "url": "https://github.com/cryostatio/cryostat/pull/206#discussion_r454658480", "createdAt": "2020-07-14T21:33:07Z", "author": {"login": "andrewazores"}, "path": "src/main/java/com/redhat/rhjmc/containerjfr/commands/internal/StartRecordingCommand.java", "diffHunk": "@@ -135,33 +135,34 @@ public void execute(String[] args) throws Exception {\n     }\n \n     @Override\n-    public boolean validate(String[] args) {\n+    public void validate(String[] args) throws FailedValidationException {\n         if (args.length != 3) {\n-            cw.println(\n-                    \"Expected three arguments: target (host:port, ip:port, or JMX service URL), recording name, and event types\");\n-            return false;\n+            String errorMessage =\n+                    \"Expected three arguments: target (host:port, ip:port, or JMX service URL), recording name, and event types\";\n+            cw.println(errorMessage);\n+            throw new FailedValidationException(errorMessage);\n         }\n \n         String targetId = args[0];\n         String name = args[1];\n         String events = args[2];\n \n-        boolean isValidTargetId = validateTargetId(targetId);\n-        boolean isValidName = validateRecordingName(name);\n-        boolean isValidEvents = validateEvents(events);\n-\n-        if (!isValidTargetId) {\n-            cw.println(String.format(\"%s is an invalid connection specifier\", args[0]));\n+        if (!validateTargetId(targetId)) {\n+            String errorMessage = \"%s is an invalid connection specifier\";", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "34aa0813954c4d19e2e2bb0d59209472672f7532"}, "originalPosition": 27}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDQ4NDg0NTU4", "url": "https://github.com/cryostatio/cryostat/pull/206#pullrequestreview-448484558", "createdAt": "2020-07-14T21:37:07Z", "commit": {"oid": "34aa0813954c4d19e2e2bb0d59209472672f7532"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xNFQyMTozNzowN1rOGxmRdA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xNFQyMTozNzowN1rOGxmRdA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NDY2MDQ2OA==", "bodyText": "The return is implicit for a void method, so you can just have an empty method body between the curly braces.", "url": "https://github.com/cryostatio/cryostat/pull/206#discussion_r454660468", "createdAt": "2020-07-14T21:37:07Z", "author": {"login": "andrewazores"}, "path": "src/test/java/com/redhat/rhjmc/containerjfr/commands/internal/AbstractConnectedCommandTest.java", "diffHunk": "@@ -141,8 +141,8 @@ public String getName() {\n         public void execute(String[] args) {}\n \n         @Override\n-        public boolean validate(String[] args) {\n-            return true;\n+        public void validate(String[] args) throws FailedValidationException {\n+            return;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "34aa0813954c4d19e2e2bb0d59209472672f7532"}, "originalPosition": 7}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDQ4NDg0Njgy", "url": "https://github.com/cryostatio/cryostat/pull/206#pullrequestreview-448484682", "createdAt": "2020-07-14T21:37:22Z", "commit": {"oid": "34aa0813954c4d19e2e2bb0d59209472672f7532"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xNFQyMTozNzoyMlrOGxmRyA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xNFQyMTozNzoyMlrOGxmRyA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NDY2MDU1Mg==", "bodyText": "Same here re: empty method body/implicit return", "url": "https://github.com/cryostatio/cryostat/pull/206#discussion_r454660552", "createdAt": "2020-07-14T21:37:22Z", "author": {"login": "andrewazores"}, "path": "src/test/java/com/redhat/rhjmc/containerjfr/commands/internal/AbstractRecordingCommandTest.java", "diffHunk": "@@ -217,8 +217,8 @@ public String getName() {\n         }\n \n         @Override\n-        public boolean validate(String[] args) {\n-            return true;\n+        public void validate(String[] args) throws FailedValidationException {\n+            return;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "34aa0813954c4d19e2e2bb0d59209472672f7532"}, "originalPosition": 7}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "2949ed1b65c458626b80d834178d5307d43bd061", "author": {"user": {"login": "vic-ma", "name": "Victor Ma"}}, "url": "https://github.com/cryostatio/cryostat/commit/2949ed1b65c458626b80d834178d5307d43bd061", "committedDate": "2020-07-15T15:25:51Z", "message": "Use implicit return in empty `validate()` methods"}, "afterCommit": {"oid": "c2586cc3dc53275f920572ab5c02fa37a71577cf", "author": {"user": {"login": "vic-ma", "name": "Victor Ma"}}, "url": "https://github.com/cryostatio/cryostat/commit/c2586cc3dc53275f920572ab5c02fa37a71577cf", "committedDate": "2020-07-16T19:22:18Z", "message": "Fix short-circuiting behaviour in `validate()`"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d0dac39ba6a3188af698d26bc0883f19958028eb", "author": {"user": {"login": "vic-ma", "name": "Victor Ma"}}, "url": "https://github.com/cryostatio/cryostat/commit/d0dac39ba6a3188af698d26bc0883f19958028eb", "committedDate": "2020-07-17T14:36:21Z", "message": "Create FailedValidationException class"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "db56021aa9b967abc08638a5205567fcfd603634", "author": {"user": {"login": "vic-ma", "name": "Victor Ma"}}, "url": "https://github.com/cryostatio/cryostat/commit/db56021aa9b967abc08638a5205567fcfd603634", "committedDate": "2020-07-17T14:36:21Z", "message": "Change validate methods to be void and throw FailedValidationException"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "4ebf50d1d5a196edb0877b151f8fcde6b7f3c49b", "author": {"user": {"login": "vic-ma", "name": "Victor Ma"}}, "url": "https://github.com/cryostatio/cryostat/commit/4ebf50d1d5a196edb0877b151f8fcde6b7f3c49b", "committedDate": "2020-07-17T14:36:21Z", "message": "Make changes to validate methods in registry implementations"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "69060e6a27e831a436f423337d89c407858a68a6", "author": {"user": {"login": "vic-ma", "name": "Victor Ma"}}, "url": "https://github.com/cryostatio/cryostat/commit/69060e6a27e831a436f423337d89c407858a68a6", "committedDate": "2020-07-17T14:36:21Z", "message": "Change command executors to work with changes to validate"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f101f80c1fd62174c724fe71112d9604843af471", "author": {"user": {"login": "vic-ma", "name": "Victor Ma"}}, "url": "https://github.com/cryostatio/cryostat/commit/f101f80c1fd62174c724fe71112d9604843af471", "committedDate": "2020-07-17T14:36:21Z", "message": "Make small change to CommandRegistryImpl validate()\n\nPreviously, if the command was found to not be registered, the thrown\nexception would not contain an `errorMessage` (i.e. it would use\nthe empty constructor). I did this because the method used to check\nfor a command's registration (`isCommandAvailable()`) already outputs\nan error message when returning false.\n\nBut rethinking it, it probably makes more sense to have the validate\nmethod to just always include an error message, even if it is a bit\nredundant. We could also change AbstractCommandExecutor to work more\nlike WsCommandExecutor by having it check for registration and\navailability of commands before validating them, though that is\nprobably a lot of work for not much gain."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "53856f62c45eae30be74691cd77637391f9b4d4a", "author": {"user": {"login": "vic-ma", "name": "Victor Ma"}}, "url": "https://github.com/cryostatio/cryostat/commit/53856f62c45eae30be74691cd77637391f9b4d4a", "committedDate": "2020-07-17T14:36:21Z", "message": "Modify unit tests for executors to work with new validate"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "040807b2bf48530a9b18404993d19c7bf72652d0", "author": {"user": {"login": "vic-ma", "name": "Victor Ma"}}, "url": "https://github.com/cryostatio/cryostat/commit/040807b2bf48530a9b18404993d19c7bf72652d0", "committedDate": "2020-07-17T14:36:21Z", "message": "Modify unit tests for registry implementations"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "19a4a8553cef7c7c61b213e7cb4533b1b6e376a7", "author": {"user": {"login": "vic-ma", "name": "Victor Ma"}}, "url": "https://github.com/cryostatio/cryostat/commit/19a4a8553cef7c7c61b213e7cb4533b1b6e376a7", "committedDate": "2020-07-17T14:36:21Z", "message": "In Command.validate(), add back in ClientWriter printing error messages"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "7adcbb19db17900be24bfab4ad8385258c41498b", "author": {"user": {"login": "vic-ma", "name": "Victor Ma"}}, "url": "https://github.com/cryostatio/cryostat/commit/7adcbb19db17900be24bfab4ad8385258c41498b", "committedDate": "2020-07-17T14:36:21Z", "message": "Change tests to reflect the re-added cw.println() in validate()"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e37c8c35d3b62a9b9150de7e3c4573c76f292256", "author": {"user": {"login": "vic-ma", "name": "Victor Ma"}}, "url": "https://github.com/cryostatio/cryostat/commit/e37c8c35d3b62a9b9150de7e3c4573c76f292256", "committedDate": "2020-07-17T14:36:21Z", "message": "Make naming for validate argc tests more consistent"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "99610209173f05b04f904bcc6b70324fd0b3564f", "author": {"user": {"login": "vic-ma", "name": "Victor Ma"}}, "url": "https://github.com/cryostatio/cryostat/commit/99610209173f05b04f904bcc6b70324fd0b3564f", "committedDate": "2020-07-17T14:36:21Z", "message": "Small fix to COMMANDS.md\n\nThe `wait-for` command was missing a `targetId` parameter.\n\nChanged the `target` parameter in the `list` command to be `targetId`,\nto be more consistent."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "6b700adeb431d7f9deac5d0510f996ed755b799b", "author": {"user": {"login": "vic-ma", "name": "Victor Ma"}}, "url": "https://github.com/cryostatio/cryostat/commit/6b700adeb431d7f9deac5d0510f996ed755b799b", "committedDate": "2020-07-17T14:36:21Z", "message": "Change example commands in BatchModeExecutorTest to existing commands"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "802b62d38b8a23ad61bc4e467d6727845a77a901", "author": {"user": {"login": "vic-ma", "name": "Victor Ma"}}, "url": "https://github.com/cryostatio/cryostat/commit/802b62d38b8a23ad61bc4e467d6727845a77a901", "committedDate": "2020-07-17T14:36:21Z", "message": "Make small final fixes"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ccbbf1963692616a94742ee36e0a034a1737bb91", "author": {"user": {"login": "vic-ma", "name": "Victor Ma"}}, "url": "https://github.com/cryostatio/cryostat/commit/ccbbf1963692616a94742ee36e0a034a1737bb91", "committedDate": "2020-07-17T14:36:21Z", "message": "Fix typo in COMMANDS.md"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "55a9e2fae024aa255613dc4ace494e062a44dbb5", "author": {"user": {"login": "vic-ma", "name": "Victor Ma"}}, "url": "https://github.com/cryostatio/cryostat/commit/55a9e2fae024aa255613dc4ace494e062a44dbb5", "committedDate": "2020-07-17T14:36:21Z", "message": "Use implicit return in empty `validate()` methods"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "75084912f5e9759d631f5af89436a82ec272a89c", "author": {"user": {"login": "vic-ma", "name": "Victor Ma"}}, "url": "https://github.com/cryostatio/cryostat/commit/75084912f5e9759d631f5af89436a82ec272a89c", "committedDate": "2020-07-17T14:36:21Z", "message": "Fix short-circuiting behaviour in `validate()`"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b73912359f687006b2b48bb3005236e0cf638a32", "author": {"user": {"login": "vic-ma", "name": "Victor Ma"}}, "url": "https://github.com/cryostatio/cryostat/commit/b73912359f687006b2b48bb3005236e0cf638a32", "committedDate": "2020-07-17T14:36:21Z", "message": "Remove print statement from `validateEvents()`"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "7d9a21bd37decfdccb13e6486f9d84012fa5d291", "author": {"user": {"login": "vic-ma", "name": "Victor Ma"}}, "url": "https://github.com/cryostatio/cryostat/commit/7d9a21bd37decfdccb13e6486f9d84012fa5d291", "committedDate": "2020-07-20T15:08:08Z", "message": "Use StringJoiner instead of manual delimiters"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "c2586cc3dc53275f920572ab5c02fa37a71577cf", "author": {"user": {"login": "vic-ma", "name": "Victor Ma"}}, "url": "https://github.com/cryostatio/cryostat/commit/c2586cc3dc53275f920572ab5c02fa37a71577cf", "committedDate": "2020-07-16T19:22:18Z", "message": "Fix short-circuiting behaviour in `validate()`"}, "afterCommit": {"oid": "7d9a21bd37decfdccb13e6486f9d84012fa5d291", "author": {"user": {"login": "vic-ma", "name": "Victor Ma"}}, "url": "https://github.com/cryostatio/cryostat/commit/7d9a21bd37decfdccb13e6486f9d84012fa5d291", "committedDate": "2020-07-20T15:08:08Z", "message": "Use StringJoiner instead of manual delimiters"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDUxOTE5MTk0", "url": "https://github.com/cryostatio/cryostat/pull/206#pullrequestreview-451919194", "createdAt": "2020-07-20T20:03:45Z", "commit": {"oid": "7d9a21bd37decfdccb13e6486f9d84012fa5d291"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3171, "cost": 1, "resetAt": "2021-11-01T13:51:04Z"}}}