{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDc0MjIwMTQ0", "number": 253, "title": "Use autogenerated SSL cert for WebServer", "bodyText": "Fixes #249", "createdAt": "2020-08-26T22:06:45Z", "url": "https://github.com/cryostatio/cryostat/pull/253", "merged": true, "mergeCommit": {"oid": "69daf9c18136f8c240a21bac3e35fb5bf04192a8"}, "closed": true, "closedAt": "2020-08-31T20:52:29Z", "author": {"login": "andrewazores"}, "timelineItems": {"totalCount": 13, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdCdYN9gH2gAyNDc0MjIwMTQ0OmE1NDBiZTc1NDQ0YTJhMGZkY2ZmNTE0MmMyNTU3ZjYwZWJkZjk0ZDM=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdEZIbhAFqTQ3ODk0NDUxMA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "a540be75444a2a0fdcff5142c2557f60ebdf94d3", "author": {"user": {"login": "andrewazores", "name": "Andrew Azores"}}, "url": "https://github.com/cryostatio/cryostat/commit/a540be75444a2a0fdcff5142c2557f60ebdf94d3", "committedDate": "2020-08-25T20:38:47Z", "message": "Use autogenerated self-signed cert for HTTPS/WSS"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "62b027691c3e6d17db499435a578ccb4a3c6f2b2", "author": {"user": {"login": "andrewazores", "name": "Andrew Azores"}}, "url": "https://github.com/cryostatio/cryostat/commit/62b027691c3e6d17db499435a578ccb4a3c6f2b2", "committedDate": "2020-08-25T20:49:21Z", "message": "Allow user to explicitly disable HTTPS"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "585c003cbbd9d2e778a04aa6c34baaa7c61d20a0", "author": {"user": {"login": "andrewazores", "name": "Andrew Azores"}}, "url": "https://github.com/cryostatio/cryostat/commit/585c003cbbd9d2e778a04aa6c34baaa7c61d20a0", "committedDate": "2020-08-25T21:05:17Z", "message": "Update README"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "3439a98a7821c0f7ec30818c32cd1c3e88bc97da", "author": {"user": {"login": "andrewazores", "name": "Andrew Azores"}}, "url": "https://github.com/cryostatio/cryostat/commit/3439a98a7821c0f7ec30818c32cd1c3e88bc97da", "committedDate": "2020-08-25T21:47:32Z", "message": "Disable HTTPS for itests"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "959e553376afecbaedadc291c011db33cd05836f", "author": {"user": {"login": "andrewazores", "name": "Andrew Azores"}}, "url": "https://github.com/cryostatio/cryostat/commit/959e553376afecbaedadc291c011db33cd05836f", "committedDate": "2020-08-26T22:06:19Z", "message": "Replace JMX_AUTH and DISABLE_HTTPS with FORCE_INSECURE\n\nCONTAINER_JFR_FORCE_INSECURE environment variable disables SSL\ncertificate generation, which in turn disables JMX SSL as well as\nWebServer HTTPS/WSS, as well as JMX auth credential generation, if the\nvariable is set to \"true\". Otherwise, or if CONTAINER_JFR_RJMX_USER or\nCONTAINER_JFR_RJMX_PASS are set to non-empty values, JMX auth\ncredentials are enabled (and generated if necessary) and SSL is enabled.\nIf the user has not specified an SSL keystore/pass an SSL self-signed\ncertificate is generated, and either way the certificate is used for securing JMX\nas well as HTTPS/WSS."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f5bad56879979a9eb2c881df3b662d7b78f46013", "author": {"user": {"login": "andrewazores", "name": "Andrew Azores"}}, "url": "https://github.com/cryostatio/cryostat/commit/f5bad56879979a9eb2c881df3b662d7b78f46013", "committedDate": "2020-08-27T15:55:45Z", "message": "Remove set -x\n\nReduce verbosity of startup logging"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f6e672dbde1cc61847751d681bd6a86255f40830", "author": {"user": {"login": "andrewazores", "name": "Andrew Azores"}}, "url": "https://github.com/cryostatio/cryostat/commit/f6e672dbde1cc61847751d681bd6a86255f40830", "committedDate": "2020-08-27T15:55:59Z", "message": "Add high-visibility banner when self-signed or no SSL is used"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "526c7330616c4019574fef35e6e6decc58b75392", "author": {"user": {"login": "andrewazores", "name": "Andrew Azores"}}, "url": "https://github.com/cryostatio/cryostat/commit/526c7330616c4019574fef35e6e6decc58b75392", "committedDate": "2020-08-27T16:03:41Z", "message": "Formatting"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "07d975adf0d445e48388f86327ebc7770fbc4de3", "author": {"user": {"login": "andrewazores", "name": "Andrew Azores"}}, "url": "https://github.com/cryostatio/cryostat/commit/07d975adf0d445e48388f86327ebc7770fbc4de3", "committedDate": "2020-08-28T19:49:30Z", "message": "Remove FORCE_INSECURE, re-add DISABLE vars\n\nReintroduce separated CONTAINER_JFR_DISABLE_SSL and CONTAINER_JFR_DISABLE_JMX_AUTH env vars rather than merged FORCE_INSECURE env var, allowing more flexibility for deployment ex. when relying on an SSL proxy"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "3e3cfd2dc5c36af63be24a845e6f3995ffbf92b1", "author": {"user": {"login": "andrewazores", "name": "Andrew Azores"}}, "url": "https://github.com/cryostatio/cryostat/commit/3e3cfd2dc5c36af63be24a845e6f3995ffbf92b1", "committedDate": "2020-08-28T19:45:53Z", "message": "Remove FORCE_INSECURE, re-add DISABLE vars\n\nReintroduce separated CONTAINER_JFR_DISABLE_SSL and CONTAINER_JFR_DISABLE_JMX_AUTH env vars rather than merged FORCE_INSECURE env var, allowing more flexibility for deployment ex. when relying on an SSL proxy"}, "afterCommit": {"oid": "07d975adf0d445e48388f86327ebc7770fbc4de3", "author": {"user": {"login": "andrewazores", "name": "Andrew Azores"}}, "url": "https://github.com/cryostatio/cryostat/commit/07d975adf0d445e48388f86327ebc7770fbc4de3", "committedDate": "2020-08-28T19:49:30Z", "message": "Remove FORCE_INSECURE, re-add DISABLE vars\n\nReintroduce separated CONTAINER_JFR_DISABLE_SSL and CONTAINER_JFR_DISABLE_JMX_AUTH env vars rather than merged FORCE_INSECURE env var, allowing more flexibility for deployment ex. when relying on an SSL proxy"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDc4OTI0ODcx", "url": "https://github.com/cryostatio/cryostat/pull/253#pullrequestreview-478924871", "createdAt": "2020-08-31T20:18:56Z", "commit": {"oid": "07d975adf0d445e48388f86327ebc7770fbc4de3"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0zMVQyMDoxODo1NlrOHKH0zA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0zMVQyMDoxODo1NlrOHKH0zA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MDM3NjAxMg==", "bodyText": "Should these be set to KEYSTORE_PATH and KEYSTORE_PASS?", "url": "https://github.com/cryostatio/cryostat/pull/253#discussion_r480376012", "createdAt": "2020-08-31T20:18:56Z", "author": {"login": "ebaron"}, "path": "src/main/extras/app/entrypoint.sh", "diffHunk": "@@ -108,35 +117,45 @@ FLAGS=(\n     \"-Dcom.sun.management.jmxremote.rmi.port=$CONTAINER_JFR_RMI_PORT\"\n     \"-Djavax.net.ssl.trustStore=$SSL_TRUSTSTORE\"\n     \"-Djavax.net.ssl.trustStorePassword=$SSL_TRUSTSTORE_PASS\"\n-    \"-Djavax.net.ssl.keyStore=$SSL_KEYSTORE\"\n-    \"-Djavax.net.ssl.keyStorePassword=$SSL_KEY_PASS\"\n )\n \n-if [ -z \"$CONTAINER_JFR_RJMX_AUTH\" ]; then\n-    # default to true. This should never be disabled in production deployments\n-    CONTAINER_JFR_RJMX_AUTH=true\n-fi\n-\n createSslStores\n importTrustStores\n-generateSslCert\n-if [ \"$CONTAINER_JFR_RJMX_AUTH\" = \"true\" ] || [ -n \"$CONTAINER_JFR_RJMX_USER\" ] ||\n-    [ -n \"$CONTAINER_JFR_RJMX_PASS\" ]; then\n-    createJmxCredentials\n \n+if [ \"$CONTAINER_JFR_DISABLE_JMX_AUTH\" = \"true\" ]; then\n+    banner \"JMX Auth Disabled\"\n+    FLAGS+=(\"-Dcom.sun.management.jmxremote.authenticate=false\")\n+else\n+    createJmxCredentials\n     FLAGS+=(\"-Dcom.sun.management.jmxremote.authenticate=true\")\n     FLAGS+=(\"-Dcom.sun.management.jmxremote.password.file=$PWFILE\")\n     FLAGS+=(\"-Dcom.sun.management.jmxremote.access.file=$USRFILE\")\n-    FLAGS+=(\"-Dcom.sun.management.jmxremote.ssl=true\")\n-    FLAGS+=(\"-Dcom.sun.management.jmxremote.registry.ssl=true\")\n-    FLAGS+=(\"-Dcom.sun.management.jmxremote.ssl.need.client.auth=true\")\n-else\n-    FLAGS+=(\"-Dcom.sun.management.jmxremote.authenticate=false\")\n+fi\n+\n+if [ \"$CONTAINER_JFR_DISABLE_SSL\" = \"true\" ]; then\n+    banner \"SSL Disabled\"\n     FLAGS+=(\"-Dcom.sun.management.jmxremote.ssl=false\")\n     FLAGS+=(\"-Dcom.sun.management.jmxremote.registry.ssl=false\")\n+else\n+    FLAGS+=(\"-Dcom.sun.management.jmxremote.ssl.need.client.auth=true\")\n+\n+    if [ -z \"$KEYSTORE_PATH\" ] || [ -z \"$KEYSTORE_PASS\" ]; then\n+        generateSslCert\n+        banner \"Using self-signed SSL certificate\"\n+\n+        KEYSTORE_PATH=\"$SSL_KEYSTORE\"\n+        KEYSTORE_PASS=\"$SSL_KEY_PASS\"\n+    fi\n+\n+    FLAGS+=(\"-Djavax.net.ssl.keyStore=$SSL_KEYSTORE\")\n+    FLAGS+=(\"-Djavax.net.ssl.keyStorePassword=$SSL_KEY_PASS\")", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "07d975adf0d445e48388f86327ebc7770fbc4de3"}, "originalPosition": 109}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "5d5f8cc8dba5f52814df3f18e6aa9370b042a8f5", "author": {"user": {"login": "andrewazores", "name": "Andrew Azores"}}, "url": "https://github.com/cryostatio/cryostat/commit/5d5f8cc8dba5f52814df3f18e6aa9370b042a8f5", "committedDate": "2020-08-31T20:44:05Z", "message": "Correct flags"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDc4OTQ0NTEw", "url": "https://github.com/cryostatio/cryostat/pull/253#pullrequestreview-478944510", "createdAt": "2020-08-31T20:49:47Z", "commit": {"oid": "5d5f8cc8dba5f52814df3f18e6aa9370b042a8f5"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3202, "cost": 1, "resetAt": "2021-11-01T13:51:04Z"}}}