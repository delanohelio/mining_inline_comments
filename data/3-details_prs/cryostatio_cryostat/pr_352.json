{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTMxOTQ4MzQy", "number": 352, "title": "V2 Response API Format", "bodyText": "Fixes #317\nThis PR introduces a new AbstractV2RequestHandler class, similar to the existing AbstractAuthenticatedRequestHandler, for all V2 API handlers to extend. Rather than passing in a Vertx RoutingContext directly to the handler and having it directly write to the context response, subclasses of this new abstract handler receive a RequestParams object which abstracts out the read-only request properties that the handler may require (such as path parameters, headers, query parameters). Rather than writing to the response directly (which is no longer available through the RequestParams), subclasses return an instance of IntermediateResponse, which encapsulates the response result body as well as an optional status code (default 200), additional headers, and optional metadata status message. This overall structure is reminiscent of how Command Channel (Serializable)Commands are implemented, with the Command/Handler returning a data structure representing their response, and a higher-level class wrapping this response into some metadata, serializing it, and writing out the final representation to the network.\nThis structure allows all V2 handlers to maintain a consistent overall response format with each other without each needing to implement it individually, including any additions or changes to the overall response format. This also allows for more information about failures to be provided to clients through the metadata fields, without necessarily having to use custom HTTP status codes and messages.\nThe WebServer failureHandler is also modified to handle the new ApiException type in such a way that responses generated from this exception type being thrown follow the same response format as the V2 handlers, but with the metadata, data, and HTTP status code/message set to indicate that this is a failure response. The response body contains a JSON object formatted in the same way as a successful response, allowing clients to parse responses in a uniform way in either case.\nThis does not affect any V1 handlers, which continue to directly receive a RoutingContext and write responses directly, and which do not throw the new ApiException type (and so the failure behaviour implemented in the WebServer is unchanged).", "createdAt": "2020-12-03T17:25:07Z", "url": "https://github.com/cryostatio/cryostat/pull/352", "merged": true, "mergeCommit": {"oid": "827cc1563c05a25add947133d1480be985540a66"}, "closed": true, "closedAt": "2020-12-08T14:29:55Z", "author": {"login": "andrewazores"}, "timelineItems": {"totalCount": 19, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdiB8zrgH2gAyNTMxOTQ4MzQyOjg1YzdhZjEyNTY3ODJkZThlYmU3ZTg5NDI5ZGE3Yjc3YTg1YTNhNDM=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdkKxvCgFqTU0NzI2OTY4MA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "85c7af1256782de8ebe7e89429da7b77a85a3a43", "author": {"user": {"login": "andrewazores", "name": "Andrew Azores"}}, "url": "https://github.com/cryostatio/cryostat/commit/85c7af1256782de8ebe7e89429da7b77a85a3a43", "committedDate": "2020-12-01T22:46:59Z", "message": "Roughing out internal API"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ea74436fcd2a50bd16f1d0303c7996eb9d56fcdd", "author": {"user": {"login": "andrewazores", "name": "Andrew Azores"}}, "url": "https://github.com/cryostatio/cryostat/commit/ea74436fcd2a50bd16f1d0303c7996eb9d56fcdd", "committedDate": "2020-12-01T22:46:59Z", "message": "Test V2 response format API with events search handler"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "6c6b85919ebb0c0b9a3d0e9501af7fc10f67a953", "author": {"user": {"login": "andrewazores", "name": "Andrew Azores"}}, "url": "https://github.com/cryostatio/cryostat/commit/6c6b85919ebb0c0b9a3d0e9501af7fc10f67a953", "committedDate": "2020-12-01T22:46:59Z", "message": "Add ApiException for V2 error response handling"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "12af9165e1b24000121d7a7298d04c6e2220bb4a", "author": {"user": {"login": "andrewazores", "name": "Andrew Azores"}}, "url": "https://github.com/cryostatio/cryostat/commit/12af9165e1b24000121d7a7298d04c6e2220bb4a", "committedDate": "2020-12-01T22:46:59Z", "message": "Add tests and make some adjustments"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "29973b0fa3a127cfb42b5520d2ed95c423f7d4e2", "author": {"user": {"login": "andrewazores", "name": "Andrew Azores"}}, "url": "https://github.com/cryostatio/cryostat/commit/29973b0fa3a127cfb42b5520d2ed95c423f7d4e2", "committedDate": "2020-12-02T16:40:05Z", "message": "Replace roughed-out Map structure with classes\n\nAlso apply formatting"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e63391602d0a521e31ef3a9ef7fcb374291eddcc", "author": {"user": {"login": "andrewazores", "name": "Andrew Azores"}}, "url": "https://github.com/cryostatio/cryostat/commit/e63391602d0a521e31ef3a9ef7fcb374291eddcc", "committedDate": "2020-12-02T16:45:08Z", "message": "Extract/move classes"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "2551657ca853b2f3e27663809dcfd7b3f23ed361", "author": {"user": {"login": "andrewazores", "name": "Andrew Azores"}}, "url": "https://github.com/cryostatio/cryostat/commit/2551657ca853b2f3e27663809dcfd7b3f23ed361", "committedDate": "2020-12-02T16:52:51Z", "message": "Replace roughed-out map structures with classes"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e7114a8c7af277812ab8cdb50943e0987bd0951f", "author": {"user": {"login": "andrewazores", "name": "Andrew Azores"}}, "url": "https://github.com/cryostatio/cryostat/commit/e7114a8c7af277812ab8cdb50943e0987bd0951f", "committedDate": "2020-12-02T16:59:19Z", "message": "Add getters, make fields private"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "5383ff980d79fb53c19a365424e51c5b757f713a", "author": {"user": {"login": "andrewazores", "name": "Andrew Azores"}}, "url": "https://github.com/cryostatio/cryostat/commit/5383ff980d79fb53c19a365424e51c5b757f713a", "committedDate": "2020-12-02T17:03:20Z", "message": "Don't wrap field in Optional\n\nSerializes with additional unwanted and unnecessary wrapping layer"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "04df6394d27f528cd1c18c17f04e1daa313805db", "author": {"user": {"login": "andrewazores", "name": "Andrew Azores"}}, "url": "https://github.com/cryostatio/cryostat/commit/04df6394d27f528cd1c18c17f04e1daa313805db", "committedDate": "2020-12-02T22:46:33Z", "message": "More refactoring and cleanup"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c5b199d35e3a6d4c900f109664e6b96534f8d440", "author": {"user": {"login": "andrewazores", "name": "Andrew Azores"}}, "url": "https://github.com/cryostatio/cryostat/commit/c5b199d35e3a6d4c900f109664e6b96534f8d440", "committedDate": "2020-12-03T16:30:38Z", "message": "Include API status messages for custom error codes"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "48cfa7ca5eb1c035b968ac549137a5275efc4e8f", "author": {"user": {"login": "andrewazores", "name": "Andrew Azores"}}, "url": "https://github.com/cryostatio/cryostat/commit/48cfa7ca5eb1c035b968ac549137a5275efc4e8f", "committedDate": "2020-12-03T16:31:03Z", "message": "Update HTTP_API.md\n\nExplain general format of V2 responses and update two handlers"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "4712f792fb08ce39d8b41c149b190f4a49e2057c", "author": {"user": {"login": "andrewazores", "name": "Andrew Azores"}}, "url": "https://github.com/cryostatio/cryostat/commit/4712f792fb08ce39d8b41c149b190f4a49e2057c", "committedDate": "2020-12-03T16:55:10Z", "message": "Migrate V2 snapshot handler"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "1bc5a5471349273de1e9c60cc94b5a8b1c4fa02d", "author": {"user": {"login": "andrewazores", "name": "Andrew Azores"}}, "url": "https://github.com/cryostatio/cryostat/commit/1bc5a5471349273de1e9c60cc94b5a8b1c4fa02d", "committedDate": "2020-12-03T17:06:42Z", "message": "Migrate V2 recording list options handler"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "6fdb43799a56fcd4352d37603fa8a61c0462fd6c", "author": {"user": {"login": "andrewazores", "name": "Andrew Azores"}}, "url": "https://github.com/cryostatio/cryostat/commit/6fdb43799a56fcd4352d37603fa8a61c0462fd6c", "committedDate": "2020-12-03T17:08:52Z", "message": "Apply formatting"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "34ae93d2fb1cd1b405dadca1fa63d176350a95f6", "author": {"user": {"login": "andrewazores", "name": "Andrew Azores"}}, "url": "https://github.com/cryostatio/cryostat/commit/34ae93d2fb1cd1b405dadca1fa63d176350a95f6", "committedDate": "2020-12-04T15:22:52Z", "message": "Rename RequestParams -> RequestParameters"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTQ2NTcwMzMz", "url": "https://github.com/cryostatio/cryostat/pull/352#pullrequestreview-546570333", "createdAt": "2020-12-07T21:56:00Z", "commit": {"oid": "34ae93d2fb1cd1b405dadca1fa63d176350a95f6"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0wN1QyMTo1NjowMFrOIA8hCA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0wN1QyMTo1NjowMFrOIA8hCA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNzg2MjQwOA==", "bodyText": "The \"status\":\"OK\" here should be \"status\":\"Created\". Also it looks like the markdown code formatting for this example broke.", "url": "https://github.com/cryostatio/cryostat/pull/352#discussion_r537862408", "createdAt": "2020-12-07T21:56:00Z", "author": {"login": "vic-ma"}, "path": "HTTP_API.md", "diffHunk": "@@ -1335,7 +1370,7 @@\n     ###### example\n     ```\n     $ curl -X POST localhost:8181/api/v2/targets/localhost/snapshot\n-    {\"downloadUrl\":\"http://192.168.0.109:8181/api/v1/targets/service:jmx:rmi:%2F%2F%2Fjndi%2Frmi:%2F%2Flocalhost:9091%2Fjmxrmi/recordings/snapshot-1\",\"reportUrl\":\"http://192.168.0.109:8181/api/v1/targets/service:jmx:rmi:%2F%2F%2Fjndi%2Frmi:%2F%2Flocalhost:9091%2Fjmxrmi/reports/snapshot-1\",\"id\":1,\"name\":\"snapshot-1\",\"state\":\"STOPPED\",\"startTime\":1601998841300,\"duration\":0,\"continuous\":true,\"toDisk\":true,\"maxSize\":0,\"maxAge\":0}\n+{\"meta\":{\"status\":\"OK\",\"type\":\"application/json\"},\"data\":{\"result\":{\"downloadUrl\":\"http://192.168.0.109:8181/api/v1/targets/service:jmx:rmi:%2F%2F%2Fjndi%2Frmi:%2F%2Flocalhost:9091%2Fjmxrmi/recordings/snapshot-1\",\"reportUrl\":\"http://192.168.0.109:8181/api/v1/targets/service:jmx:rmi:%2F%2F%2Fjndi%2Frmi:%2F%2Flocalhost:9091%2Fjmxrmi/reports/snapshot-1\",\"id\":1,\"name\":\"snapshot-1\",\"state\":\"STOPPED\",\"startTime\":1601998841300,\"duration\":0,\"continuous\":true,\"toDisk\":true,\"maxSize\":0,\"maxAge\":0}}}", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "34ae93d2fb1cd1b405dadca1fa63d176350a95f6"}, "originalPosition": 149}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c19203c19e396ded0eb8cfb4e6c35d5a296d2bc8", "author": {"user": {"login": "andrewazores", "name": "Andrew Azores"}}, "url": "https://github.com/cryostatio/cryostat/commit/c19203c19e396ded0eb8cfb4e6c35d5a296d2bc8", "committedDate": "2020-12-07T22:24:37Z", "message": "Correct status message and formatting"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTQ3MjY5Njgw", "url": "https://github.com/cryostatio/cryostat/pull/352#pullrequestreview-547269680", "createdAt": "2020-12-08T14:11:53Z", "commit": {"oid": "c19203c19e396ded0eb8cfb4e6c35d5a296d2bc8"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3100, "cost": 1, "resetAt": "2021-11-01T13:51:04Z"}}}