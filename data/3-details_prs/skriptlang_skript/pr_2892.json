{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0Mzk1MDY0MzE1", "number": 2892, "title": "ThrownPotionData - fix syntax not working", "bodyText": "Description\nThis PR fixes ThrownPotionData not working. When attempting to spawn a thrown potion it would throw errors. This was first due to the lang file being incorrect.\nAfter fixing that, had to do a whole whack-a-doodle of fixes to make this work properly.\nThere are some bugs in 1.12.2 and below that throw errors when attempting to use a thrown potion. Silly Bukkit. The API states you can use a thrown potion, but I think someone did some errors in CB.\nAt the same time I also fixed a lang issue with dropped item, this small fix allows you to spawn a dropped item of any time (kinda useless, can use the drop item effect, but figured I should fix it anyways, whilst I'm at it)\nNOTE:\nThe failure is due to precious stones, Im guessing their repo is down.\n\nTarget Minecraft Versions: any\nRequirements: none\nRelated Issues: #2891", "createdAt": "2020-03-28T08:21:35Z", "url": "https://github.com/SkriptLang/Skript/pull/2892", "merged": true, "mergeCommit": {"oid": "42b6cf1ef30b8bd4de29d3f55a246fa46dcf452e"}, "closed": true, "closedAt": "2020-07-09T19:21:05Z", "author": {"login": "ShaneBeee"}, "timelineItems": {"totalCount": 6, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcSA4ZPgH2gAyMzk1MDY0MzE1OjZhMzVlMGM1NmZlOGExOTBhZWUxNDU5ZGUxZWFlOWNjOGIyM2IzYjY=", "endCursor": "Y3Vyc29yOnYyOpPPAAABczUFmJAFqTQ0NTkwMTg4MQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "6a35e0c56fe8a190aee1459de1eae9cc8b23b3b6", "author": {"user": {"login": "ShaneBeee", "name": "Shane Bee"}}, "url": "https://github.com/SkriptLang/Skript/commit/6a35e0c56fe8a190aee1459de1eae9cc8b23b3b6", "committedDate": "2020-03-28T08:18:19Z", "message": "ThrownPotionData - fix syntax not working"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDA3NTQ4NDA4", "url": "https://github.com/SkriptLang/Skript/pull/2892#pullrequestreview-407548408", "createdAt": "2020-05-07T14:47:50Z", "commit": {"oid": "6a35e0c56fe8a190aee1459de1eae9cc8b23b3b6"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wN1QxNDo0Nzo1MFrOGSCQYQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wN1QxNDo0ODoyOVrOGSCSWw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMTU2NDUxMw==", "bodyText": "Don't do Material checks, put the corresponding alias in a constant through Aliases#javaItemtype instead.", "url": "https://github.com/SkriptLang/Skript/pull/2892#discussion_r421564513", "createdAt": "2020-05-07T14:47:50Z", "author": {"login": "SnowPyon"}, "path": "src/main/java/ch/njol/skript/entity/ThrownPotionData.java", "diffHunk": "@@ -46,34 +47,33 @@\n \t\tEntityData.register(ThrownPotionData.class, \"thrown potion\", ThrownPotion.class, \"thrown potion\");\r\n \t}\r\n \t\r\n-\tprivate final static Adjective m_adjective = new Adjective(\"entities.thrown potion.adjective\");\r\n+\tprivate static final Adjective m_adjective = new Adjective(\"entities.thrown potion.adjective\");\r\n+\tprivate static final boolean RUNNING_LEGACY = !Skript.isRunningMinecraft(1, 13);\r\n \t\r\n \t@Nullable\r\n \tprivate ItemType[] types;\r\n \t\r\n \t@Override\r\n \tprotected boolean init(final Literal<?>[] exprs, final int matchedPattern, final ParseResult parseResult) {\r\n \t\tif (exprs.length > 0 && exprs[0] != null) {\r\n-\t\t\tif ((Converters.convert((ItemType[]) exprs[0].getAll(), ItemType.class, new Converter<ItemType, ItemType>() {\r\n-\t\t\t\t@Override\r\n-\t\t\t\t@Nullable\r\n-\t\t\t\tpublic ItemType convert(final ItemType t) {\r\n-\t\t\t\t\tItemType r = null;\r\n-\t\t\t\t\tfor (final ItemData d : t.getTypes()) {\r\n-\t\t\t\t\t\tif (d.getType() == Material.POTION) {\r\n-\t\t\t\t\t\t\tif (r == null)\r\n-\t\t\t\t\t\t\t\tr = new ItemType(d);\r\n-\t\t\t\t\t\t\telse\r\n-\t\t\t\t\t\t\t\tr.add(d);\r\n-\t\t\t\t\t\t}\r\n-\t\t\t\t\t}\r\n-\t\t\t\t\treturn r;\r\n+\t\t\treturn (types = Converters.convert((ItemType[]) exprs[0].getAll(), ItemType.class, t -> {\r\n+\t\t\t\tMaterial type = t.getMaterial();\r\n+\t\t\t\t// If the itemtype is a potion, lets make it a splash potion (required by Bukkit)\r\n+\t\t\t\t// Due to an issue with 1.12.2 and below, we have to force a lingering potion to be a splash potion\r\n+\t\t\t\tif (type == Material.POTION || (type == Material.LINGERING_POTION && RUNNING_LEGACY)) {\r", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "6a35e0c56fe8a190aee1459de1eae9cc8b23b3b6"}, "originalPosition": 50}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMTU2NTAxOQ==", "bodyText": "Same goes here, get the ItemType through Aliases#javaItemtype", "url": "https://github.com/SkriptLang/Skript/pull/2892#discussion_r421565019", "createdAt": "2020-05-07T14:48:29Z", "author": {"login": "SnowPyon"}, "path": "src/main/java/ch/njol/skript/entity/ThrownPotionData.java", "diffHunk": "@@ -46,34 +47,33 @@\n \t\tEntityData.register(ThrownPotionData.class, \"thrown potion\", ThrownPotion.class, \"thrown potion\");\r\n \t}\r\n \t\r\n-\tprivate final static Adjective m_adjective = new Adjective(\"entities.thrown potion.adjective\");\r\n+\tprivate static final Adjective m_adjective = new Adjective(\"entities.thrown potion.adjective\");\r\n+\tprivate static final boolean RUNNING_LEGACY = !Skript.isRunningMinecraft(1, 13);\r\n \t\r\n \t@Nullable\r\n \tprivate ItemType[] types;\r\n \t\r\n \t@Override\r\n \tprotected boolean init(final Literal<?>[] exprs, final int matchedPattern, final ParseResult parseResult) {\r\n \t\tif (exprs.length > 0 && exprs[0] != null) {\r\n-\t\t\tif ((Converters.convert((ItemType[]) exprs[0].getAll(), ItemType.class, new Converter<ItemType, ItemType>() {\r\n-\t\t\t\t@Override\r\n-\t\t\t\t@Nullable\r\n-\t\t\t\tpublic ItemType convert(final ItemType t) {\r\n-\t\t\t\t\tItemType r = null;\r\n-\t\t\t\t\tfor (final ItemData d : t.getTypes()) {\r\n-\t\t\t\t\t\tif (d.getType() == Material.POTION) {\r\n-\t\t\t\t\t\t\tif (r == null)\r\n-\t\t\t\t\t\t\t\tr = new ItemType(d);\r\n-\t\t\t\t\t\t\telse\r\n-\t\t\t\t\t\t\t\tr.add(d);\r\n-\t\t\t\t\t\t}\r\n-\t\t\t\t\t}\r\n-\t\t\t\t\treturn r;\r\n+\t\t\treturn (types = Converters.convert((ItemType[]) exprs[0].getAll(), ItemType.class, t -> {\r\n+\t\t\t\tMaterial type = t.getMaterial();\r\n+\t\t\t\t// If the itemtype is a potion, lets make it a splash potion (required by Bukkit)\r\n+\t\t\t\t// Due to an issue with 1.12.2 and below, we have to force a lingering potion to be a splash potion\r\n+\t\t\t\tif (type == Material.POTION || (type == Material.LINGERING_POTION && RUNNING_LEGACY)) {\r\n+\t\t\t\t\tItemMeta meta = t.getItemMeta();\r\n+\t\t\t\t\tItemType itemType = new ItemType(Material.SPLASH_POTION);\r", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "6a35e0c56fe8a190aee1459de1eae9cc8b23b3b6"}, "originalPosition": 52}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "069bb787579996fdf0faceb86846868648ecd177", "author": {"user": {"login": "ShaneBeee", "name": "Shane Bee"}}, "url": "https://github.com/SkriptLang/Skript/commit/069bb787579996fdf0faceb86846868648ecd177", "committedDate": "2020-05-07T20:54:17Z", "message": "ThrownPotionData - remove material checks"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDA3ODk5NjY2", "url": "https://github.com/SkriptLang/Skript/pull/2892#pullrequestreview-407899666", "createdAt": "2020-05-07T23:18:04Z", "commit": {"oid": "069bb787579996fdf0faceb86846868648ecd177"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "92813cd646e00813957c4f878c1a03696adb3bd2", "author": {"user": {"login": "ShaneBeee", "name": "Shane Bee"}}, "url": "https://github.com/SkriptLang/Skript/commit/92813cd646e00813957c4f878c1a03696adb3bd2", "committedDate": "2020-07-09T19:13:01Z", "message": "Merge branch 'master' into fix/throw-potion"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDQ1OTAxODgx", "url": "https://github.com/SkriptLang/Skript/pull/2892#pullrequestreview-445901881", "createdAt": "2020-07-09T19:20:26Z", "commit": {"oid": "92813cd646e00813957c4f878c1a03696adb3bd2"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3170, "cost": 1, "resetAt": "2021-11-02T10:47:05Z"}}}