{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDM3NTczNDI0", "number": 3066, "title": "Add more preload functionality", "bodyText": "Description\nThis PR adds the PostStructureCreateEvent, which is very similar to the PreScriptLoadEvent, but the PostStructureCreateEvent is called after the structure of a script is created, which happens before any of the scripts are loaded.\nWith this PR, addon developers can add their own preload functionality, similar to how function signatures are created before any of the scripts are loaded.\nQuick test plugin: TestPlugin-1.0-SNAPSHOT.jar (source)\nOutput:\n\n\nTarget Minecraft Versions: Any\nRequirements: None\nRelated Issues: None", "createdAt": "2020-06-21T17:14:45Z", "url": "https://github.com/SkriptLang/Skript/pull/3066", "merged": true, "mergeCommit": {"oid": "63d75c0cafc7f658cc2de3bac7bfbe34ccafad15"}, "closed": true, "closedAt": "2020-07-15T17:59:34Z", "author": {"login": "TPGamesNL"}, "timelineItems": {"totalCount": 30, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcte94YgH2gAyNDM3NTczNDI0OjNhMDI5YjU5MTA0NTNiNDMxNGEyMGFmYzk0MzBhNTE3NTcwZWQyM2E=", "endCursor": "Y3Vyc29yOnYyOpPPAAABc1OdjQgFqTQ0OTE5ODEwNg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "3a029b5910453b4314a20afc9430a517570ed23a", "author": {"user": {"login": "TPGamesNL", "name": null}}, "url": "https://github.com/SkriptLang/Skript/commit/3a029b5910453b4314a20afc9430a517570ed23a", "committedDate": "2020-06-21T16:37:25Z", "message": "Add PostStructureCreateEvent"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDM0NTE4MzQy", "url": "https://github.com/SkriptLang/Skript/pull/3066#pullrequestreview-434518342", "createdAt": "2020-06-21T17:18:42Z", "commit": {"oid": "3a029b5910453b4314a20afc9430a517570ed23a"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e76f496f5173a618eb4e4bdc5a80021b61699851", "author": {"user": {"login": "TPGamesNL", "name": null}}, "url": "https://github.com/SkriptLang/Skript/commit/e76f496f5173a618eb4e4bdc5a80021b61699851", "committedDate": "2020-06-21T17:42:58Z", "message": "Fix line endings 1/2"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c4a755af60418e4eb61b9ac6080dacace0005f12", "author": {"user": {"login": "TPGamesNL", "name": null}}, "url": "https://github.com/SkriptLang/Skript/commit/c4a755af60418e4eb61b9ac6080dacace0005f12", "committedDate": "2020-06-21T17:43:30Z", "message": "Fix line endings 2/2"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "807d59f66f94f3b4828183cadf62369ab1ae9d71", "author": {"user": {"login": "TPGamesNL", "name": null}}, "url": "https://github.com/SkriptLang/Skript/commit/807d59f66f94f3b4828183cadf62369ab1ae9d71", "committedDate": "2020-06-21T17:46:11Z", "message": "Fix line endings 3/4"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a81c8693866b8a8c12640a6eca5925b0f8a503ac", "author": {"user": {"login": "TPGamesNL", "name": null}}, "url": "https://github.com/SkriptLang/Skript/commit/a81c8693866b8a8c12640a6eca5925b0f8a503ac", "committedDate": "2020-06-21T17:48:17Z", "message": "Fix line endings 4/4\ndid you really think I was gonna be able to do this in one try"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "5d56bd35782c385b7e63b0dca51dadbb77c6adfe", "author": {"user": {"login": "TPGamesNL", "name": null}}, "url": "https://github.com/SkriptLang/Skript/commit/5d56bd35782c385b7e63b0dca51dadbb77c6adfe", "committedDate": "2020-06-21T18:14:11Z", "message": "5/6\nplease, git, please"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "016ec364fe9cbe9824654f32bf8862662f44421b", "author": {"user": {"login": "TPGamesNL", "name": null}}, "url": "https://github.com/SkriptLang/Skript/commit/016ec364fe9cbe9824654f32bf8862662f44421b", "committedDate": "2020-06-21T18:15:04Z", "message": "6/6"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f455bbb22ef53aeead6aa6b8c9d2167d8a74cdeb", "author": {"user": {"login": "TPGamesNL", "name": null}}, "url": "https://github.com/SkriptLang/Skript/commit/f455bbb22ef53aeead6aa6b8c9d2167d8a74cdeb", "committedDate": "2020-06-21T18:18:23Z", "message": "revert"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "6fdd640820bdee6120d0e8b8825271db9465af65", "author": {"user": {"login": "TPGamesNL", "name": null}}, "url": "https://github.com/SkriptLang/Skript/commit/6fdd640820bdee6120d0e8b8825271db9465af65", "committedDate": "2020-06-21T18:18:28Z", "message": "Revert \"5/6 please, git, please\"\n\nThis reverts commit 5d56bd35"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "92d984fe92344ed73a7c0d95b7fbbc0019b90062", "author": {"user": {"login": "TPGamesNL", "name": null}}, "url": "https://github.com/SkriptLang/Skript/commit/92d984fe92344ed73a7c0d95b7fbbc0019b90062", "committedDate": "2020-06-21T18:18:33Z", "message": "Revert \"Fix line endings 4/4 did you really think I was gonna be able to do this in one try\"\n\nThis reverts commit a81c8693"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "764afcf6f143064de7b25eac73be475de371be57", "author": {"user": {"login": "TPGamesNL", "name": null}}, "url": "https://github.com/SkriptLang/Skript/commit/764afcf6f143064de7b25eac73be475de371be57", "committedDate": "2020-06-21T18:18:37Z", "message": "Revert \"Fix line endings 3/4\"\n\nThis reverts commit 807d59f6"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ceade6ec727af1b1750fd775998331212413ebef", "author": {"user": {"login": "TPGamesNL", "name": null}}, "url": "https://github.com/SkriptLang/Skript/commit/ceade6ec727af1b1750fd775998331212413ebef", "committedDate": "2020-06-21T18:18:41Z", "message": "Revert \"Fix line endings 2/2\"\n\nThis reverts commit c4a755af"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "06a2adefdd5e91cbad52a5094167c099a751cadc", "author": {"user": {"login": "TPGamesNL", "name": null}}, "url": "https://github.com/SkriptLang/Skript/commit/06a2adefdd5e91cbad52a5094167c099a751cadc", "committedDate": "2020-06-21T18:18:45Z", "message": "Revert \"Fix line endings 1/2\"\n\nThis reverts commit e76f496f"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "5ff59d24772b5d56319f075aa5a322ac5aab4b17", "author": {"user": {"login": "TPGamesNL", "name": null}}, "url": "https://github.com/SkriptLang/Skript/commit/5ff59d24772b5d56319f075aa5a322ac5aab4b17", "committedDate": "2020-06-21T18:18:49Z", "message": "Revert \"Add PostStructureCreateEvent\"\n\nThis reverts commit 3a029b59"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "234f181222ad6dc6e801f2de738abd6c0964f060", "author": {"user": {"login": "TPGamesNL", "name": null}}, "url": "https://github.com/SkriptLang/Skript/commit/234f181222ad6dc6e801f2de738abd6c0964f060", "committedDate": "2020-06-21T18:21:42Z", "message": "Update ScriptLoader.java"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "0ef9d70f97dae0b74420b7d103984a5e3763cc43", "author": {"user": {"login": "TPGamesNL", "name": null}}, "url": "https://github.com/SkriptLang/Skript/commit/0ef9d70f97dae0b74420b7d103984a5e3763cc43", "committedDate": "2020-06-21T18:22:34Z", "message": "Create PostStructureCreateEvent.java"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDM0NTIyNTUy", "url": "https://github.com/SkriptLang/Skript/pull/3066#pullrequestreview-434522552", "createdAt": "2020-06-21T18:28:15Z", "commit": {"oid": "0ef9d70f97dae0b74420b7d103984a5e3763cc43"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yMVQxODoyODoxNVrOGmtf0Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yMVQxODozNDoyMVrOGmthxQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MzI0NDQ5Nw==", "bodyText": "Use brackets for codestyle", "url": "https://github.com/SkriptLang/Skript/pull/3066#discussion_r443244497", "createdAt": "2020-06-21T18:28:15Z", "author": {"login": "JRoy"}, "path": "src/main/java/ch/njol/skript/ScriptLoader.java", "diffHunk": "@@ -939,6 +984,9 @@ public String run(final Matcher m) {\n \t\t\t\t\t}\r\n \t\t\t\t}\r\n \t\t\t\t\r\n+\t\t\t\tif (callPostStructureEvent)\r\n+\t\t\t\t\tBukkit.getPluginManager().callEvent(new PostStructureCreateEvent(config));\r\n+\t\t\t\t\r", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "0ef9d70f97dae0b74420b7d103984a5e3763cc43"}, "originalPosition": 65}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MzI0NDUxMg==", "bodyText": "brackets", "url": "https://github.com/SkriptLang/Skript/pull/3066#discussion_r443244512", "createdAt": "2020-06-21T18:28:31Z", "author": {"login": "JRoy"}, "path": "src/main/java/ch/njol/skript/ScriptLoader.java", "diffHunk": "@@ -158,6 +159,50 @@ public static boolean getCallPreloadEvent() {\n \tpublic static Set<SkriptAddon> getPreloadListeners() {\r\n \t\treturn Collections.unmodifiableSet(preloadListeners);\r\n \t}\r\n+\t\r\n+\t/**\r\n+\t * If true, a {@link PostStructureCreateEvent} will be called\r\n+\t * right after the structure of a script is generated,\r\n+\t * but before the script is parsed.\r\n+\t */\r\n+\tprivate static boolean callPostStructureEvent;\r\n+\r\n+\t/**\r\n+\t * A set of all the SkriptAddons that have called\r\n+\t * {@link ScriptLoader#setCallPostStructureEvent(boolean, SkriptAddon)}\r\n+\t * with true.\r\n+\t */\r\n+\tprivate static Set<SkriptAddon> postStructureListeners = new HashSet<>();\r\n+\r\n+\t/**\r\n+\t * Sets {@link ScriptLoader#callPostStructureEvent} to the provided boolean,\r\n+\t * and adds/removes the provided SkriptAddon from {@link ScriptLoader#postStructureListeners}\r\n+\t * depending on the provided boolean (true adds, false removes).\r\n+\t * @param state The new value for {@link ScriptLoader#postStructureListeners}\r\n+\t * @param addon A non-null SkriptAddon\r\n+\t */\r\n+\tpublic static void setCallPostStructureEvent(boolean state, SkriptAddon addon) {\r\n+\t\tValidate.notNull(addon);\r\n+\t\tcallPostStructureEvent = state;\r\n+\t\tif (state)\r\n+\t\t\tpostStructureListeners.add(addon);\r\n+\t\telse\r\n+\t\t\tpostStructureListeners.remove(addon);\r", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "0ef9d70f97dae0b74420b7d103984a5e3763cc43"}, "originalPosition": 40}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MzI0NDk5Nw==", "bodyText": "I don't understand the use case for this here, why not always call the event. If nobody is listening to it, there's very little overhead anyway (especially on Paper). The Set of addons seems kind of pointless since they're really not useful.", "url": "https://github.com/SkriptLang/Skript/pull/3066#discussion_r443244997", "createdAt": "2020-06-21T18:34:21Z", "author": {"login": "JRoy"}, "path": "src/main/java/ch/njol/skript/ScriptLoader.java", "diffHunk": "@@ -158,6 +159,50 @@ public static boolean getCallPreloadEvent() {\n \tpublic static Set<SkriptAddon> getPreloadListeners() {\r\n \t\treturn Collections.unmodifiableSet(preloadListeners);\r\n \t}\r\n+\t\r\n+\t/**\r\n+\t * If true, a {@link PostStructureCreateEvent} will be called\r\n+\t * right after the structure of a script is generated,\r\n+\t * but before the script is parsed.\r\n+\t */\r\n+\tprivate static boolean callPostStructureEvent;\r\n+\r\n+\t/**\r\n+\t * A set of all the SkriptAddons that have called\r\n+\t * {@link ScriptLoader#setCallPostStructureEvent(boolean, SkriptAddon)}\r\n+\t * with true.\r\n+\t */\r\n+\tprivate static Set<SkriptAddon> postStructureListeners = new HashSet<>();\r\n+\r\n+\t/**\r\n+\t * Sets {@link ScriptLoader#callPostStructureEvent} to the provided boolean,\r\n+\t * and adds/removes the provided SkriptAddon from {@link ScriptLoader#postStructureListeners}\r\n+\t * depending on the provided boolean (true adds, false removes).\r\n+\t * @param state The new value for {@link ScriptLoader#postStructureListeners}\r\n+\t * @param addon A non-null SkriptAddon\r\n+\t */\r\n+\tpublic static void setCallPostStructureEvent(boolean state, SkriptAddon addon) {\r\n+\t\tValidate.notNull(addon);\r\n+\t\tcallPostStructureEvent = state;\r\n+\t\tif (state)\r\n+\t\t\tpostStructureListeners.add(addon);\r\n+\t\telse\r\n+\t\t\tpostStructureListeners.remove(addon);\r\n+\t}\r\n+\r\n+\tpublic static boolean getCallPostStructureEvent() {\r\n+\t\treturn callPostStructureEvent;\r\n+\t}\r\n+\r\n+\t/**\r\n+\t * Returns an unmodifiable list of all the addons\r\n+\t * that have called {@link ScriptLoader#setCallPostStructureEvent(boolean, SkriptAddon)}\r\n+\t * with true.\r\n+\t */\r\n+\t@SuppressWarnings(\"null\")\r\n+\tpublic static Set<SkriptAddon> getPostStructureListeners() {\r\n+\t\treturn Collections.unmodifiableSet(postStructureListeners);\r\n+\t}\r", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "0ef9d70f97dae0b74420b7d103984a5e3763cc43"}, "originalPosition": 55}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "0b2667b78bfec60feecfebf1bab6d62025727775", "author": {"user": {"login": "TPGamesNL", "name": null}}, "url": "https://github.com/SkriptLang/Skript/commit/0b2667b78bfec60feecfebf1bab6d62025727775", "committedDate": "2020-06-29T15:29:10Z", "message": "Merge branch 'master' into master"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "bf89231fbe5d9ade7f8f53671d85b39c0643d379", "author": {"user": {"login": "TPGamesNL", "name": null}}, "url": "https://github.com/SkriptLang/Skript/commit/bf89231fbe5d9ade7f8f53671d85b39c0643d379", "committedDate": "2020-06-29T15:31:00Z", "message": "Delete PostStructureCreateEvent.java"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a672c6611dcb6eaef225d42320af5c8ce5a8e788", "author": {"user": {"login": "TPGamesNL", "name": null}}, "url": "https://github.com/SkriptLang/Skript/commit/a672c6611dcb6eaef225d42320af5c8ce5a8e788", "committedDate": "2020-06-29T15:31:25Z", "message": "Update PreScriptLoadEvent.java"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "2912f23f3e0d6fce9fa0cfd73743ab9cd0d766eb", "author": {"user": {"login": "TPGamesNL", "name": null}}, "url": "https://github.com/SkriptLang/Skript/commit/2912f23f3e0d6fce9fa0cfd73743ab9cd0d766eb", "committedDate": "2020-06-29T15:31:48Z", "message": "Update ScriptLoader.java"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDM5MjkxMTk1", "url": "https://github.com/SkriptLang/Skript/pull/3066#pullrequestreview-439291195", "createdAt": "2020-06-29T16:03:19Z", "commit": {"oid": "2912f23f3e0d6fce9fa0cfd73743ab9cd0d766eb"}, "state": "DISMISSED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDQwMjcxNDEx", "url": "https://github.com/SkriptLang/Skript/pull/3066#pullrequestreview-440271411", "createdAt": "2020-06-30T18:15:39Z", "commit": {"oid": "2912f23f3e0d6fce9fa0cfd73743ab9cd0d766eb"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "be604898481b8e934ddb0df6a82e2dc0cc4169ac", "author": {"user": {"login": "TPGamesNL", "name": null}}, "url": "https://github.com/SkriptLang/Skript/commit/be604898481b8e934ddb0df6a82e2dc0cc4169ac", "committedDate": "2020-06-30T18:29:08Z", "message": "Update ScriptLoader.java"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "2abdb06ecc1062c106894029f259020f7b7b2f03", "author": {"user": {"login": "TPGamesNL", "name": null}}, "url": "https://github.com/SkriptLang/Skript/commit/2abdb06ecc1062c106894029f259020f7b7b2f03", "committedDate": "2020-07-03T14:23:39Z", "message": "Merge branch 'master' into master"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "dba7a9bb459e900ff7e7b0babaf84a5b5e876021", "author": {"user": {"login": "TPGamesNL", "name": null}}, "url": "https://github.com/SkriptLang/Skript/commit/dba7a9bb459e900ff7e7b0babaf84a5b5e876021", "committedDate": "2020-07-10T09:00:19Z", "message": "Merge branch 'master' into master"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDQ5MTg3Mjg1", "url": "https://github.com/SkriptLang/Skript/pull/3066#pullrequestreview-449187285", "createdAt": "2020-07-15T17:39:51Z", "commit": {"oid": "dba7a9bb459e900ff7e7b0babaf84a5b5e876021"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "7231525119d5054bfa0a4fbe754411cbda7bd9a8", "author": {"user": {"login": "ShaneBeee", "name": "Shane Bee"}}, "url": "https://github.com/SkriptLang/Skript/commit/7231525119d5054bfa0a4fbe754411cbda7bd9a8", "committedDate": "2020-07-15T17:40:04Z", "message": "Merge branch 'master' into master"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDQ5MTk4MTA2", "url": "https://github.com/SkriptLang/Skript/pull/3066#pullrequestreview-449198106", "createdAt": "2020-07-15T17:55:01Z", "commit": {"oid": "7231525119d5054bfa0a4fbe754411cbda7bd9a8"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3025, "cost": 1, "resetAt": "2021-11-02T10:47:05Z"}}}