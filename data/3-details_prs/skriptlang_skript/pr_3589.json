{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTI5NDM5Mjg4", "number": 3589, "title": "Feature/xp block break event", "bodyText": "Description\nThis PR aims to add support for experience drops in the block break event.\n\nTarget Minecraft Versions: any\nRequirements: none\nRelated Issues: none", "createdAt": "2020-11-30T10:11:21Z", "url": "https://github.com/SkriptLang/Skript/pull/3589", "merged": true, "mergeCommit": {"oid": "81326694cf35101ce8de3eb6fd5aa5e996d8c907"}, "closed": true, "closedAt": "2020-12-04T19:08:51Z", "author": {"login": "ShaneBeee"}, "timelineItems": {"totalCount": 9, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdhif8cAH2gAyNTI5NDM5Mjg4OjI3OGFjNmIxMWM5M2QxNzgyM2NjZTdiZTJlMzBhN2RkMWJmZjIzZjg=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdi8jJKgH2gAyNTI5NDM5Mjg4OmM5YTM2ODVmZjdmM2U2MzE3OWNkNjIzZjE5YjNmOTZmMGE4ZmYwYjk=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "278ac6b11c93d17823cce7be2e30a7dd1bff23f8", "author": {"user": {"login": "ShaneBeee", "name": "Shane Bee"}}, "url": "https://github.com/SkriptLang/Skript/commit/278ac6b11c93d17823cce7be2e30a7dd1bff23f8", "committedDate": "2020-11-30T10:08:24Z", "message": "ExprExperience - add support for XP dropped in block break event"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "85783015a1f5d09059ea97a3af57270ba162f404", "author": {"user": {"login": "ShaneBeee", "name": "Shane Bee"}}, "url": "https://github.com/SkriptLang/Skript/commit/85783015a1f5d09059ea97a3af57270ba162f404", "committedDate": "2020-11-30T10:10:10Z", "message": "ExprExperience - tab docs in 1 more"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTQxMzYwNjI4", "url": "https://github.com/SkriptLang/Skript/pull/3589#pullrequestreview-541360628", "createdAt": "2020-11-30T22:55:05Z", "commit": {"oid": "85783015a1f5d09059ea97a3af57270ba162f404"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0zMFQyMjo1NTowNVrOH8RGww==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0zMFQyMzowNDozOVrOH8RWAQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMjk1Njg2Nw==", "bodyText": "the acceptChange method supports the DELETE case currently", "url": "https://github.com/SkriptLang/Skript/pull/3589#discussion_r532956867", "createdAt": "2020-11-30T22:55:05Z", "author": {"login": "APickledWalrus"}, "path": "src/main/java/ch/njol/skript/expressions/ExprExperience.java", "diffHunk": "@@ -87,31 +96,41 @@ public boolean init(final Expression<?>[] exprs, final int matchedPattern, final\n \t\n \t@Override\n \tpublic void change(final Event e, final @Nullable Object[] delta, final ChangeMode mode) {\n-\t\tif (!(e instanceof ExperienceSpawnEvent))\n+\t\tdouble d;\n+\t\tif (e instanceof ExperienceSpawnEvent)\n+\t\t\td = ((ExperienceSpawnEvent) e).getSpawnedXP();\n+\t\telse if (e instanceof BlockBreakEvent)\n+\t\t\td = ((BlockBreakEvent) e).getExpToDrop();\n+\t\telse\n \t\t\treturn;\n-\t\tif (delta == null) {\n-\t\t\t((ExperienceSpawnEvent) e).setSpawnedXP(0);\n-\t\t\treturn;\n-\t\t}\n-\t\tdouble d = 0;\n-\t\tfor (final Object o : delta) {\n-\t\t\tfinal double v = o instanceof Experience ? ((Experience) o).getXP() : ((Number) o).doubleValue();\n-\t\t\tswitch (mode) {\n-\t\t\t\tcase ADD:\n-\t\t\t\tcase SET:\n-\t\t\t\t\td += v;\n-\t\t\t\t\tbreak;\n-\t\t\t\tcase REMOVE:\n-\t\t\t\tcase REMOVE_ALL:\n-\t\t\t\t\td -= v;\n-\t\t\t\t\tbreak;\n-\t\t\t\tcase RESET:\n-\t\t\t\tcase DELETE:\n-\t\t\t\t\tassert false;\n-\t\t\t\t\tbreak;\n+\t\t\n+\t\tif (delta != null)\n+\t\t\tfor (final Object o : delta) {\n+\t\t\t\tfinal double v = o instanceof Experience ? ((Experience) o).getXP() : ((Number) o).doubleValue();\n+\t\t\t\tswitch (mode) {\n+\t\t\t\t\tcase ADD:\n+\t\t\t\t\t\td += v;\n+\t\t\t\t\t\tbreak;\n+\t\t\t\t\tcase SET:\n+\t\t\t\t\t\td = v;\n+\t\t\t\t\t\tbreak;\n+\t\t\t\t\tcase REMOVE:\n+\t\t\t\t\tcase REMOVE_ALL:\n+\t\t\t\t\t\td -= v;\n+\t\t\t\t\t\tbreak;\n+\t\t\t\t\tcase RESET:\n+\t\t\t\t\tcase DELETE:", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "85783015a1f5d09059ea97a3af57270ba162f404"}, "originalPosition": 103}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMjk2MDM0MA==", "bodyText": "I think REMOVE_ALL should be removed here? I don't think it's appropriate usage of it.", "url": "https://github.com/SkriptLang/Skript/pull/3589#discussion_r532960340", "createdAt": "2020-11-30T23:03:32Z", "author": {"login": "APickledWalrus"}, "path": "src/main/java/ch/njol/skript/expressions/ExprExperience.java", "diffHunk": "@@ -87,31 +96,41 @@ public boolean init(final Expression<?>[] exprs, final int matchedPattern, final\n \t\n \t@Override\n \tpublic void change(final Event e, final @Nullable Object[] delta, final ChangeMode mode) {\n-\t\tif (!(e instanceof ExperienceSpawnEvent))\n+\t\tdouble d;\n+\t\tif (e instanceof ExperienceSpawnEvent)\n+\t\t\td = ((ExperienceSpawnEvent) e).getSpawnedXP();\n+\t\telse if (e instanceof BlockBreakEvent)\n+\t\t\td = ((BlockBreakEvent) e).getExpToDrop();\n+\t\telse\n \t\t\treturn;\n-\t\tif (delta == null) {\n-\t\t\t((ExperienceSpawnEvent) e).setSpawnedXP(0);\n-\t\t\treturn;\n-\t\t}\n-\t\tdouble d = 0;\n-\t\tfor (final Object o : delta) {\n-\t\t\tfinal double v = o instanceof Experience ? ((Experience) o).getXP() : ((Number) o).doubleValue();\n-\t\t\tswitch (mode) {\n-\t\t\t\tcase ADD:\n-\t\t\t\tcase SET:\n-\t\t\t\t\td += v;\n-\t\t\t\t\tbreak;\n-\t\t\t\tcase REMOVE:\n-\t\t\t\tcase REMOVE_ALL:\n-\t\t\t\t\td -= v;\n-\t\t\t\t\tbreak;\n-\t\t\t\tcase RESET:\n-\t\t\t\tcase DELETE:\n-\t\t\t\t\tassert false;\n-\t\t\t\t\tbreak;\n+\t\t\n+\t\tif (delta != null)\n+\t\t\tfor (final Object o : delta) {\n+\t\t\t\tfinal double v = o instanceof Experience ? ((Experience) o).getXP() : ((Number) o).doubleValue();\n+\t\t\t\tswitch (mode) {\n+\t\t\t\t\tcase ADD:\n+\t\t\t\t\t\td += v;\n+\t\t\t\t\t\tbreak;\n+\t\t\t\t\tcase SET:\n+\t\t\t\t\t\td = v;\n+\t\t\t\t\t\tbreak;\n+\t\t\t\t\tcase REMOVE:\n+\t\t\t\t\tcase REMOVE_ALL:", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "85783015a1f5d09059ea97a3af57270ba162f404"}, "originalPosition": 99}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMjk2MDc2OQ==", "bodyText": "Is it okay for experience to be negative? You removed the Math#max check that was originally here ;D", "url": "https://github.com/SkriptLang/Skript/pull/3589#discussion_r532960769", "createdAt": "2020-11-30T23:04:39Z", "author": {"login": "APickledWalrus"}, "path": "src/main/java/ch/njol/skript/expressions/ExprExperience.java", "diffHunk": "@@ -87,31 +96,41 @@ public boolean init(final Expression<?>[] exprs, final int matchedPattern, final\n \t\n \t@Override\n \tpublic void change(final Event e, final @Nullable Object[] delta, final ChangeMode mode) {\n-\t\tif (!(e instanceof ExperienceSpawnEvent))\n+\t\tdouble d;\n+\t\tif (e instanceof ExperienceSpawnEvent)\n+\t\t\td = ((ExperienceSpawnEvent) e).getSpawnedXP();\n+\t\telse if (e instanceof BlockBreakEvent)\n+\t\t\td = ((BlockBreakEvent) e).getExpToDrop();\n+\t\telse\n \t\t\treturn;\n-\t\tif (delta == null) {\n-\t\t\t((ExperienceSpawnEvent) e).setSpawnedXP(0);\n-\t\t\treturn;\n-\t\t}\n-\t\tdouble d = 0;\n-\t\tfor (final Object o : delta) {\n-\t\t\tfinal double v = o instanceof Experience ? ((Experience) o).getXP() : ((Number) o).doubleValue();\n-\t\t\tswitch (mode) {\n-\t\t\t\tcase ADD:\n-\t\t\t\tcase SET:\n-\t\t\t\t\td += v;\n-\t\t\t\t\tbreak;\n-\t\t\t\tcase REMOVE:\n-\t\t\t\tcase REMOVE_ALL:\n-\t\t\t\t\td -= v;\n-\t\t\t\t\tbreak;\n-\t\t\t\tcase RESET:\n-\t\t\t\tcase DELETE:\n-\t\t\t\t\tassert false;\n-\t\t\t\t\tbreak;\n+\t\t\n+\t\tif (delta != null)\n+\t\t\tfor (final Object o : delta) {\n+\t\t\t\tfinal double v = o instanceof Experience ? ((Experience) o).getXP() : ((Number) o).doubleValue();\n+\t\t\t\tswitch (mode) {\n+\t\t\t\t\tcase ADD:\n+\t\t\t\t\t\td += v;\n+\t\t\t\t\t\tbreak;\n+\t\t\t\t\tcase SET:\n+\t\t\t\t\t\td = v;\n+\t\t\t\t\t\tbreak;\n+\t\t\t\t\tcase REMOVE:\n+\t\t\t\t\tcase REMOVE_ALL:\n+\t\t\t\t\t\td -= v;\n+\t\t\t\t\t\tbreak;\n+\t\t\t\t\tcase RESET:\n+\t\t\t\t\tcase DELETE:\n+\t\t\t\t\t\tassert false;\n+\t\t\t\t\t\tbreak;\n+\t\t\t\t}\n \t\t\t}\n-\t\t}\n-\t\t((ExperienceSpawnEvent) e).setSpawnedXP(Math.max(0, (int) Math.round(((ExperienceSpawnEvent) e).getSpawnedXP() + d)));\n+\t\telse\n+\t\t\td = 0;\n+\t\t\n+\t\tif (e instanceof ExperienceSpawnEvent)\n+\t\t\t((ExperienceSpawnEvent) e).setSpawnedXP((int) Math.round(d));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "85783015a1f5d09059ea97a3af57270ba162f404"}, "originalPosition": 114}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f583879bd1703f2d2d90f2d6aca13e009a644e0a", "author": {"user": {"login": "ShaneBeee", "name": "Shane Bee"}}, "url": "https://github.com/SkriptLang/Skript/commit/f583879bd1703f2d2d90f2d6aca13e009a644e0a", "committedDate": "2020-11-30T23:11:01Z", "message": "ExprExperience - put back Math.max i accidentally removed\n- also removed unneeded REMOVE_ALL"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ccacd4f4bd95f30f752ca12cbbfff65afc08331b", "author": {"user": {"login": "ShaneBeee", "name": "Shane Bee"}}, "url": "https://github.com/SkriptLang/Skript/commit/ccacd4f4bd95f30f752ca12cbbfff65afc08331b", "committedDate": "2020-11-30T23:23:52Z", "message": "ExprExperience - remove REMOVE_ALL from acceptChange"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTQxMzc0ODI1", "url": "https://github.com/SkriptLang/Skript/pull/3589#pullrequestreview-541374825", "createdAt": "2020-11-30T23:25:07Z", "commit": {"oid": "ccacd4f4bd95f30f752ca12cbbfff65afc08331b"}, "state": "DISMISSED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "785a13f740efd4cb4f96a9fdae1e8bcf8838d77b", "author": {"user": {"login": "ShaneBeee", "name": "Shane Bee"}}, "url": "https://github.com/SkriptLang/Skript/commit/785a13f740efd4cb4f96a9fdae1e8bcf8838d77b", "committedDate": "2020-11-30T23:38:32Z", "message": "ExprExperience - adding REMOVE_ALL back in"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTQxMzgxMDY0", "url": "https://github.com/SkriptLang/Skript/pull/3589#pullrequestreview-541381064", "createdAt": "2020-11-30T23:39:02Z", "commit": {"oid": "785a13f740efd4cb4f96a9fdae1e8bcf8838d77b"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c9a3685ff7f3e63179cd623f19b3f96f0a8ff0b9", "author": {"user": {"login": "ShaneBeee", "name": "Shane Bee"}}, "url": "https://github.com/SkriptLang/Skript/commit/c9a3685ff7f3e63179cd623f19b3f96f0a8ff0b9", "committedDate": "2020-12-04T19:03:21Z", "message": "Merge branch 'dev-2.5' into feature/xp-block-break-event"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2944, "cost": 1, "resetAt": "2021-11-02T10:47:05Z"}}}