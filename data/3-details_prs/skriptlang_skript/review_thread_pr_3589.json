{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTI5NDM5Mjg4", "number": 3589, "reviewThreads": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0zMFQyMjo1NTowNVrOE-3-tw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0zMFQyMzowNDozOVrOE-4JAA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzM0MzY0MzQzOnYy", "diffSide": "RIGHT", "path": "src/main/java/ch/njol/skript/expressions/ExprExperience.java", "isResolved": true, "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0zMFQyMjo1NTowNVrOH8RGww==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0zMFQyMzoyMjowNlrOH8RyBQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMjk1Njg2Nw==", "bodyText": "the acceptChange method supports the DELETE case currently", "url": "https://github.com/SkriptLang/Skript/pull/3589#discussion_r532956867", "createdAt": "2020-11-30T22:55:05Z", "author": {"login": "APickledWalrus"}, "path": "src/main/java/ch/njol/skript/expressions/ExprExperience.java", "diffHunk": "@@ -87,31 +96,41 @@ public boolean init(final Expression<?>[] exprs, final int matchedPattern, final\n \t\n \t@Override\n \tpublic void change(final Event e, final @Nullable Object[] delta, final ChangeMode mode) {\n-\t\tif (!(e instanceof ExperienceSpawnEvent))\n+\t\tdouble d;\n+\t\tif (e instanceof ExperienceSpawnEvent)\n+\t\t\td = ((ExperienceSpawnEvent) e).getSpawnedXP();\n+\t\telse if (e instanceof BlockBreakEvent)\n+\t\t\td = ((BlockBreakEvent) e).getExpToDrop();\n+\t\telse\n \t\t\treturn;\n-\t\tif (delta == null) {\n-\t\t\t((ExperienceSpawnEvent) e).setSpawnedXP(0);\n-\t\t\treturn;\n-\t\t}\n-\t\tdouble d = 0;\n-\t\tfor (final Object o : delta) {\n-\t\t\tfinal double v = o instanceof Experience ? ((Experience) o).getXP() : ((Number) o).doubleValue();\n-\t\t\tswitch (mode) {\n-\t\t\t\tcase ADD:\n-\t\t\t\tcase SET:\n-\t\t\t\t\td += v;\n-\t\t\t\t\tbreak;\n-\t\t\t\tcase REMOVE:\n-\t\t\t\tcase REMOVE_ALL:\n-\t\t\t\t\td -= v;\n-\t\t\t\t\tbreak;\n-\t\t\t\tcase RESET:\n-\t\t\t\tcase DELETE:\n-\t\t\t\t\tassert false;\n-\t\t\t\t\tbreak;\n+\t\t\n+\t\tif (delta != null)\n+\t\t\tfor (final Object o : delta) {\n+\t\t\t\tfinal double v = o instanceof Experience ? ((Experience) o).getXP() : ((Number) o).doubleValue();\n+\t\t\t\tswitch (mode) {\n+\t\t\t\t\tcase ADD:\n+\t\t\t\t\t\td += v;\n+\t\t\t\t\t\tbreak;\n+\t\t\t\t\tcase SET:\n+\t\t\t\t\t\td = v;\n+\t\t\t\t\t\tbreak;\n+\t\t\t\t\tcase REMOVE:\n+\t\t\t\t\tcase REMOVE_ALL:\n+\t\t\t\t\t\td -= v;\n+\t\t\t\t\t\tbreak;\n+\t\t\t\t\tcase RESET:\n+\t\t\t\t\tcase DELETE:", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "85783015a1f5d09059ea97a3af57270ba162f404"}, "originalPosition": 103}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMjk2NDE5MQ==", "bodyText": "Since delta would be null in this case, that won't even run,\nthe else would be used in this case.", "url": "https://github.com/SkriptLang/Skript/pull/3589#discussion_r532964191", "createdAt": "2020-11-30T23:12:49Z", "author": {"login": "ShaneBeee"}, "path": "src/main/java/ch/njol/skript/expressions/ExprExperience.java", "diffHunk": "@@ -87,31 +96,41 @@ public boolean init(final Expression<?>[] exprs, final int matchedPattern, final\n \t\n \t@Override\n \tpublic void change(final Event e, final @Nullable Object[] delta, final ChangeMode mode) {\n-\t\tif (!(e instanceof ExperienceSpawnEvent))\n+\t\tdouble d;\n+\t\tif (e instanceof ExperienceSpawnEvent)\n+\t\t\td = ((ExperienceSpawnEvent) e).getSpawnedXP();\n+\t\telse if (e instanceof BlockBreakEvent)\n+\t\t\td = ((BlockBreakEvent) e).getExpToDrop();\n+\t\telse\n \t\t\treturn;\n-\t\tif (delta == null) {\n-\t\t\t((ExperienceSpawnEvent) e).setSpawnedXP(0);\n-\t\t\treturn;\n-\t\t}\n-\t\tdouble d = 0;\n-\t\tfor (final Object o : delta) {\n-\t\t\tfinal double v = o instanceof Experience ? ((Experience) o).getXP() : ((Number) o).doubleValue();\n-\t\t\tswitch (mode) {\n-\t\t\t\tcase ADD:\n-\t\t\t\tcase SET:\n-\t\t\t\t\td += v;\n-\t\t\t\t\tbreak;\n-\t\t\t\tcase REMOVE:\n-\t\t\t\tcase REMOVE_ALL:\n-\t\t\t\t\td -= v;\n-\t\t\t\t\tbreak;\n-\t\t\t\tcase RESET:\n-\t\t\t\tcase DELETE:\n-\t\t\t\t\tassert false;\n-\t\t\t\t\tbreak;\n+\t\t\n+\t\tif (delta != null)\n+\t\t\tfor (final Object o : delta) {\n+\t\t\t\tfinal double v = o instanceof Experience ? ((Experience) o).getXP() : ((Number) o).doubleValue();\n+\t\t\t\tswitch (mode) {\n+\t\t\t\t\tcase ADD:\n+\t\t\t\t\t\td += v;\n+\t\t\t\t\t\tbreak;\n+\t\t\t\t\tcase SET:\n+\t\t\t\t\t\td = v;\n+\t\t\t\t\t\tbreak;\n+\t\t\t\t\tcase REMOVE:\n+\t\t\t\t\tcase REMOVE_ALL:\n+\t\t\t\t\t\td -= v;\n+\t\t\t\t\t\tbreak;\n+\t\t\t\t\tcase RESET:\n+\t\t\t\t\tcase DELETE:", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMjk1Njg2Nw=="}, "originalCommit": {"oid": "85783015a1f5d09059ea97a3af57270ba162f404"}, "originalPosition": 103}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMjk2Nzk0MQ==", "bodyText": "whoops I missed that haha", "url": "https://github.com/SkriptLang/Skript/pull/3589#discussion_r532967941", "createdAt": "2020-11-30T23:22:06Z", "author": {"login": "APickledWalrus"}, "path": "src/main/java/ch/njol/skript/expressions/ExprExperience.java", "diffHunk": "@@ -87,31 +96,41 @@ public boolean init(final Expression<?>[] exprs, final int matchedPattern, final\n \t\n \t@Override\n \tpublic void change(final Event e, final @Nullable Object[] delta, final ChangeMode mode) {\n-\t\tif (!(e instanceof ExperienceSpawnEvent))\n+\t\tdouble d;\n+\t\tif (e instanceof ExperienceSpawnEvent)\n+\t\t\td = ((ExperienceSpawnEvent) e).getSpawnedXP();\n+\t\telse if (e instanceof BlockBreakEvent)\n+\t\t\td = ((BlockBreakEvent) e).getExpToDrop();\n+\t\telse\n \t\t\treturn;\n-\t\tif (delta == null) {\n-\t\t\t((ExperienceSpawnEvent) e).setSpawnedXP(0);\n-\t\t\treturn;\n-\t\t}\n-\t\tdouble d = 0;\n-\t\tfor (final Object o : delta) {\n-\t\t\tfinal double v = o instanceof Experience ? ((Experience) o).getXP() : ((Number) o).doubleValue();\n-\t\t\tswitch (mode) {\n-\t\t\t\tcase ADD:\n-\t\t\t\tcase SET:\n-\t\t\t\t\td += v;\n-\t\t\t\t\tbreak;\n-\t\t\t\tcase REMOVE:\n-\t\t\t\tcase REMOVE_ALL:\n-\t\t\t\t\td -= v;\n-\t\t\t\t\tbreak;\n-\t\t\t\tcase RESET:\n-\t\t\t\tcase DELETE:\n-\t\t\t\t\tassert false;\n-\t\t\t\t\tbreak;\n+\t\t\n+\t\tif (delta != null)\n+\t\t\tfor (final Object o : delta) {\n+\t\t\t\tfinal double v = o instanceof Experience ? ((Experience) o).getXP() : ((Number) o).doubleValue();\n+\t\t\t\tswitch (mode) {\n+\t\t\t\t\tcase ADD:\n+\t\t\t\t\t\td += v;\n+\t\t\t\t\t\tbreak;\n+\t\t\t\t\tcase SET:\n+\t\t\t\t\t\td = v;\n+\t\t\t\t\t\tbreak;\n+\t\t\t\t\tcase REMOVE:\n+\t\t\t\t\tcase REMOVE_ALL:\n+\t\t\t\t\t\td -= v;\n+\t\t\t\t\t\tbreak;\n+\t\t\t\t\tcase RESET:\n+\t\t\t\t\tcase DELETE:", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMjk1Njg2Nw=="}, "originalCommit": {"oid": "85783015a1f5d09059ea97a3af57270ba162f404"}, "originalPosition": 103}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzM0MzY2Njk1OnYy", "diffSide": "RIGHT", "path": "src/main/java/ch/njol/skript/expressions/ExprExperience.java", "isResolved": true, "comments": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0zMFQyMzowMzozMlrOH8RUVA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0zMFQyMzoyNDoxM1rOH8R1QQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMjk2MDM0MA==", "bodyText": "I think REMOVE_ALL should be removed here? I don't think it's appropriate usage of it.", "url": "https://github.com/SkriptLang/Skript/pull/3589#discussion_r532960340", "createdAt": "2020-11-30T23:03:32Z", "author": {"login": "APickledWalrus"}, "path": "src/main/java/ch/njol/skript/expressions/ExprExperience.java", "diffHunk": "@@ -87,31 +96,41 @@ public boolean init(final Expression<?>[] exprs, final int matchedPattern, final\n \t\n \t@Override\n \tpublic void change(final Event e, final @Nullable Object[] delta, final ChangeMode mode) {\n-\t\tif (!(e instanceof ExperienceSpawnEvent))\n+\t\tdouble d;\n+\t\tif (e instanceof ExperienceSpawnEvent)\n+\t\t\td = ((ExperienceSpawnEvent) e).getSpawnedXP();\n+\t\telse if (e instanceof BlockBreakEvent)\n+\t\t\td = ((BlockBreakEvent) e).getExpToDrop();\n+\t\telse\n \t\t\treturn;\n-\t\tif (delta == null) {\n-\t\t\t((ExperienceSpawnEvent) e).setSpawnedXP(0);\n-\t\t\treturn;\n-\t\t}\n-\t\tdouble d = 0;\n-\t\tfor (final Object o : delta) {\n-\t\t\tfinal double v = o instanceof Experience ? ((Experience) o).getXP() : ((Number) o).doubleValue();\n-\t\t\tswitch (mode) {\n-\t\t\t\tcase ADD:\n-\t\t\t\tcase SET:\n-\t\t\t\t\td += v;\n-\t\t\t\t\tbreak;\n-\t\t\t\tcase REMOVE:\n-\t\t\t\tcase REMOVE_ALL:\n-\t\t\t\t\td -= v;\n-\t\t\t\t\tbreak;\n-\t\t\t\tcase RESET:\n-\t\t\t\tcase DELETE:\n-\t\t\t\t\tassert false;\n-\t\t\t\t\tbreak;\n+\t\t\n+\t\tif (delta != null)\n+\t\t\tfor (final Object o : delta) {\n+\t\t\t\tfinal double v = o instanceof Experience ? ((Experience) o).getXP() : ((Number) o).doubleValue();\n+\t\t\t\tswitch (mode) {\n+\t\t\t\t\tcase ADD:\n+\t\t\t\t\t\td += v;\n+\t\t\t\t\t\tbreak;\n+\t\t\t\t\tcase SET:\n+\t\t\t\t\t\td = v;\n+\t\t\t\t\t\tbreak;\n+\t\t\t\t\tcase REMOVE:\n+\t\t\t\t\tcase REMOVE_ALL:", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "85783015a1f5d09059ea97a3af57270ba162f404"}, "originalPosition": 99}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMjk2MzY4NA==", "bodyText": "good call, I removed it.", "url": "https://github.com/SkriptLang/Skript/pull/3589#discussion_r532963684", "createdAt": "2020-11-30T23:11:35Z", "author": {"login": "ShaneBeee"}, "path": "src/main/java/ch/njol/skript/expressions/ExprExperience.java", "diffHunk": "@@ -87,31 +96,41 @@ public boolean init(final Expression<?>[] exprs, final int matchedPattern, final\n \t\n \t@Override\n \tpublic void change(final Event e, final @Nullable Object[] delta, final ChangeMode mode) {\n-\t\tif (!(e instanceof ExperienceSpawnEvent))\n+\t\tdouble d;\n+\t\tif (e instanceof ExperienceSpawnEvent)\n+\t\t\td = ((ExperienceSpawnEvent) e).getSpawnedXP();\n+\t\telse if (e instanceof BlockBreakEvent)\n+\t\t\td = ((BlockBreakEvent) e).getExpToDrop();\n+\t\telse\n \t\t\treturn;\n-\t\tif (delta == null) {\n-\t\t\t((ExperienceSpawnEvent) e).setSpawnedXP(0);\n-\t\t\treturn;\n-\t\t}\n-\t\tdouble d = 0;\n-\t\tfor (final Object o : delta) {\n-\t\t\tfinal double v = o instanceof Experience ? ((Experience) o).getXP() : ((Number) o).doubleValue();\n-\t\t\tswitch (mode) {\n-\t\t\t\tcase ADD:\n-\t\t\t\tcase SET:\n-\t\t\t\t\td += v;\n-\t\t\t\t\tbreak;\n-\t\t\t\tcase REMOVE:\n-\t\t\t\tcase REMOVE_ALL:\n-\t\t\t\t\td -= v;\n-\t\t\t\t\tbreak;\n-\t\t\t\tcase RESET:\n-\t\t\t\tcase DELETE:\n-\t\t\t\t\tassert false;\n-\t\t\t\t\tbreak;\n+\t\t\n+\t\tif (delta != null)\n+\t\t\tfor (final Object o : delta) {\n+\t\t\t\tfinal double v = o instanceof Experience ? ((Experience) o).getXP() : ((Number) o).doubleValue();\n+\t\t\t\tswitch (mode) {\n+\t\t\t\t\tcase ADD:\n+\t\t\t\t\t\td += v;\n+\t\t\t\t\t\tbreak;\n+\t\t\t\t\tcase SET:\n+\t\t\t\t\t\td = v;\n+\t\t\t\t\t\tbreak;\n+\t\t\t\t\tcase REMOVE:\n+\t\t\t\t\tcase REMOVE_ALL:", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMjk2MDM0MA=="}, "originalCommit": {"oid": "85783015a1f5d09059ea97a3af57270ba162f404"}, "originalPosition": 99}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMjk2ODM2Ng==", "bodyText": "needs removed from acceptChange too ;D", "url": "https://github.com/SkriptLang/Skript/pull/3589#discussion_r532968366", "createdAt": "2020-11-30T23:23:13Z", "author": {"login": "APickledWalrus"}, "path": "src/main/java/ch/njol/skript/expressions/ExprExperience.java", "diffHunk": "@@ -87,31 +96,41 @@ public boolean init(final Expression<?>[] exprs, final int matchedPattern, final\n \t\n \t@Override\n \tpublic void change(final Event e, final @Nullable Object[] delta, final ChangeMode mode) {\n-\t\tif (!(e instanceof ExperienceSpawnEvent))\n+\t\tdouble d;\n+\t\tif (e instanceof ExperienceSpawnEvent)\n+\t\t\td = ((ExperienceSpawnEvent) e).getSpawnedXP();\n+\t\telse if (e instanceof BlockBreakEvent)\n+\t\t\td = ((BlockBreakEvent) e).getExpToDrop();\n+\t\telse\n \t\t\treturn;\n-\t\tif (delta == null) {\n-\t\t\t((ExperienceSpawnEvent) e).setSpawnedXP(0);\n-\t\t\treturn;\n-\t\t}\n-\t\tdouble d = 0;\n-\t\tfor (final Object o : delta) {\n-\t\t\tfinal double v = o instanceof Experience ? ((Experience) o).getXP() : ((Number) o).doubleValue();\n-\t\t\tswitch (mode) {\n-\t\t\t\tcase ADD:\n-\t\t\t\tcase SET:\n-\t\t\t\t\td += v;\n-\t\t\t\t\tbreak;\n-\t\t\t\tcase REMOVE:\n-\t\t\t\tcase REMOVE_ALL:\n-\t\t\t\t\td -= v;\n-\t\t\t\t\tbreak;\n-\t\t\t\tcase RESET:\n-\t\t\t\tcase DELETE:\n-\t\t\t\t\tassert false;\n-\t\t\t\t\tbreak;\n+\t\t\n+\t\tif (delta != null)\n+\t\t\tfor (final Object o : delta) {\n+\t\t\t\tfinal double v = o instanceof Experience ? ((Experience) o).getXP() : ((Number) o).doubleValue();\n+\t\t\t\tswitch (mode) {\n+\t\t\t\t\tcase ADD:\n+\t\t\t\t\t\td += v;\n+\t\t\t\t\t\tbreak;\n+\t\t\t\t\tcase SET:\n+\t\t\t\t\t\td = v;\n+\t\t\t\t\t\tbreak;\n+\t\t\t\t\tcase REMOVE:\n+\t\t\t\t\tcase REMOVE_ALL:", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMjk2MDM0MA=="}, "originalCommit": {"oid": "85783015a1f5d09059ea97a3af57270ba162f404"}, "originalPosition": 99}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMjk2ODc2OQ==", "bodyText": "you're so needy ;) haha, jk jk... ok its been removed.!", "url": "https://github.com/SkriptLang/Skript/pull/3589#discussion_r532968769", "createdAt": "2020-11-30T23:24:13Z", "author": {"login": "ShaneBeee"}, "path": "src/main/java/ch/njol/skript/expressions/ExprExperience.java", "diffHunk": "@@ -87,31 +96,41 @@ public boolean init(final Expression<?>[] exprs, final int matchedPattern, final\n \t\n \t@Override\n \tpublic void change(final Event e, final @Nullable Object[] delta, final ChangeMode mode) {\n-\t\tif (!(e instanceof ExperienceSpawnEvent))\n+\t\tdouble d;\n+\t\tif (e instanceof ExperienceSpawnEvent)\n+\t\t\td = ((ExperienceSpawnEvent) e).getSpawnedXP();\n+\t\telse if (e instanceof BlockBreakEvent)\n+\t\t\td = ((BlockBreakEvent) e).getExpToDrop();\n+\t\telse\n \t\t\treturn;\n-\t\tif (delta == null) {\n-\t\t\t((ExperienceSpawnEvent) e).setSpawnedXP(0);\n-\t\t\treturn;\n-\t\t}\n-\t\tdouble d = 0;\n-\t\tfor (final Object o : delta) {\n-\t\t\tfinal double v = o instanceof Experience ? ((Experience) o).getXP() : ((Number) o).doubleValue();\n-\t\t\tswitch (mode) {\n-\t\t\t\tcase ADD:\n-\t\t\t\tcase SET:\n-\t\t\t\t\td += v;\n-\t\t\t\t\tbreak;\n-\t\t\t\tcase REMOVE:\n-\t\t\t\tcase REMOVE_ALL:\n-\t\t\t\t\td -= v;\n-\t\t\t\t\tbreak;\n-\t\t\t\tcase RESET:\n-\t\t\t\tcase DELETE:\n-\t\t\t\t\tassert false;\n-\t\t\t\t\tbreak;\n+\t\t\n+\t\tif (delta != null)\n+\t\t\tfor (final Object o : delta) {\n+\t\t\t\tfinal double v = o instanceof Experience ? ((Experience) o).getXP() : ((Number) o).doubleValue();\n+\t\t\t\tswitch (mode) {\n+\t\t\t\t\tcase ADD:\n+\t\t\t\t\t\td += v;\n+\t\t\t\t\t\tbreak;\n+\t\t\t\t\tcase SET:\n+\t\t\t\t\t\td = v;\n+\t\t\t\t\t\tbreak;\n+\t\t\t\t\tcase REMOVE:\n+\t\t\t\t\tcase REMOVE_ALL:", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMjk2MDM0MA=="}, "originalCommit": {"oid": "85783015a1f5d09059ea97a3af57270ba162f404"}, "originalPosition": 99}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzM0MzY2OTc2OnYy", "diffSide": "RIGHT", "path": "src/main/java/ch/njol/skript/expressions/ExprExperience.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0zMFQyMzowNDozOVrOH8RWAQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0zMFQyMzoxMTo1MVrOH8Rh1g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMjk2MDc2OQ==", "bodyText": "Is it okay for experience to be negative? You removed the Math#max check that was originally here ;D", "url": "https://github.com/SkriptLang/Skript/pull/3589#discussion_r532960769", "createdAt": "2020-11-30T23:04:39Z", "author": {"login": "APickledWalrus"}, "path": "src/main/java/ch/njol/skript/expressions/ExprExperience.java", "diffHunk": "@@ -87,31 +96,41 @@ public boolean init(final Expression<?>[] exprs, final int matchedPattern, final\n \t\n \t@Override\n \tpublic void change(final Event e, final @Nullable Object[] delta, final ChangeMode mode) {\n-\t\tif (!(e instanceof ExperienceSpawnEvent))\n+\t\tdouble d;\n+\t\tif (e instanceof ExperienceSpawnEvent)\n+\t\t\td = ((ExperienceSpawnEvent) e).getSpawnedXP();\n+\t\telse if (e instanceof BlockBreakEvent)\n+\t\t\td = ((BlockBreakEvent) e).getExpToDrop();\n+\t\telse\n \t\t\treturn;\n-\t\tif (delta == null) {\n-\t\t\t((ExperienceSpawnEvent) e).setSpawnedXP(0);\n-\t\t\treturn;\n-\t\t}\n-\t\tdouble d = 0;\n-\t\tfor (final Object o : delta) {\n-\t\t\tfinal double v = o instanceof Experience ? ((Experience) o).getXP() : ((Number) o).doubleValue();\n-\t\t\tswitch (mode) {\n-\t\t\t\tcase ADD:\n-\t\t\t\tcase SET:\n-\t\t\t\t\td += v;\n-\t\t\t\t\tbreak;\n-\t\t\t\tcase REMOVE:\n-\t\t\t\tcase REMOVE_ALL:\n-\t\t\t\t\td -= v;\n-\t\t\t\t\tbreak;\n-\t\t\t\tcase RESET:\n-\t\t\t\tcase DELETE:\n-\t\t\t\t\tassert false;\n-\t\t\t\t\tbreak;\n+\t\t\n+\t\tif (delta != null)\n+\t\t\tfor (final Object o : delta) {\n+\t\t\t\tfinal double v = o instanceof Experience ? ((Experience) o).getXP() : ((Number) o).doubleValue();\n+\t\t\t\tswitch (mode) {\n+\t\t\t\t\tcase ADD:\n+\t\t\t\t\t\td += v;\n+\t\t\t\t\t\tbreak;\n+\t\t\t\t\tcase SET:\n+\t\t\t\t\t\td = v;\n+\t\t\t\t\t\tbreak;\n+\t\t\t\t\tcase REMOVE:\n+\t\t\t\t\tcase REMOVE_ALL:\n+\t\t\t\t\t\td -= v;\n+\t\t\t\t\t\tbreak;\n+\t\t\t\t\tcase RESET:\n+\t\t\t\t\tcase DELETE:\n+\t\t\t\t\t\tassert false;\n+\t\t\t\t\t\tbreak;\n+\t\t\t\t}\n \t\t\t}\n-\t\t}\n-\t\t((ExperienceSpawnEvent) e).setSpawnedXP(Math.max(0, (int) Math.round(((ExperienceSpawnEvent) e).getSpawnedXP() + d)));\n+\t\telse\n+\t\t\td = 0;\n+\t\t\n+\t\tif (e instanceof ExperienceSpawnEvent)\n+\t\t\t((ExperienceSpawnEvent) e).setSpawnedXP((int) Math.round(d));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "85783015a1f5d09059ea97a3af57270ba162f404"}, "originalPosition": 114}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMjk2Mzc5OA==", "bodyText": "WOOPS, my mistake. Good catch. I have added it back in.", "url": "https://github.com/SkriptLang/Skript/pull/3589#discussion_r532963798", "createdAt": "2020-11-30T23:11:51Z", "author": {"login": "ShaneBeee"}, "path": "src/main/java/ch/njol/skript/expressions/ExprExperience.java", "diffHunk": "@@ -87,31 +96,41 @@ public boolean init(final Expression<?>[] exprs, final int matchedPattern, final\n \t\n \t@Override\n \tpublic void change(final Event e, final @Nullable Object[] delta, final ChangeMode mode) {\n-\t\tif (!(e instanceof ExperienceSpawnEvent))\n+\t\tdouble d;\n+\t\tif (e instanceof ExperienceSpawnEvent)\n+\t\t\td = ((ExperienceSpawnEvent) e).getSpawnedXP();\n+\t\telse if (e instanceof BlockBreakEvent)\n+\t\t\td = ((BlockBreakEvent) e).getExpToDrop();\n+\t\telse\n \t\t\treturn;\n-\t\tif (delta == null) {\n-\t\t\t((ExperienceSpawnEvent) e).setSpawnedXP(0);\n-\t\t\treturn;\n-\t\t}\n-\t\tdouble d = 0;\n-\t\tfor (final Object o : delta) {\n-\t\t\tfinal double v = o instanceof Experience ? ((Experience) o).getXP() : ((Number) o).doubleValue();\n-\t\t\tswitch (mode) {\n-\t\t\t\tcase ADD:\n-\t\t\t\tcase SET:\n-\t\t\t\t\td += v;\n-\t\t\t\t\tbreak;\n-\t\t\t\tcase REMOVE:\n-\t\t\t\tcase REMOVE_ALL:\n-\t\t\t\t\td -= v;\n-\t\t\t\t\tbreak;\n-\t\t\t\tcase RESET:\n-\t\t\t\tcase DELETE:\n-\t\t\t\t\tassert false;\n-\t\t\t\t\tbreak;\n+\t\t\n+\t\tif (delta != null)\n+\t\t\tfor (final Object o : delta) {\n+\t\t\t\tfinal double v = o instanceof Experience ? ((Experience) o).getXP() : ((Number) o).doubleValue();\n+\t\t\t\tswitch (mode) {\n+\t\t\t\t\tcase ADD:\n+\t\t\t\t\t\td += v;\n+\t\t\t\t\t\tbreak;\n+\t\t\t\t\tcase SET:\n+\t\t\t\t\t\td = v;\n+\t\t\t\t\t\tbreak;\n+\t\t\t\t\tcase REMOVE:\n+\t\t\t\t\tcase REMOVE_ALL:\n+\t\t\t\t\t\td -= v;\n+\t\t\t\t\t\tbreak;\n+\t\t\t\t\tcase RESET:\n+\t\t\t\t\tcase DELETE:\n+\t\t\t\t\t\tassert false;\n+\t\t\t\t\t\tbreak;\n+\t\t\t\t}\n \t\t\t}\n-\t\t}\n-\t\t((ExperienceSpawnEvent) e).setSpawnedXP(Math.max(0, (int) Math.round(((ExperienceSpawnEvent) e).getSpawnedXP() + d)));\n+\t\telse\n+\t\t\td = 0;\n+\t\t\n+\t\tif (e instanceof ExperienceSpawnEvent)\n+\t\t\t((ExperienceSpawnEvent) e).setSpawnedXP((int) Math.round(d));", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMjk2MDc2OQ=="}, "originalCommit": {"oid": "85783015a1f5d09059ea97a3af57270ba162f404"}, "originalPosition": 114}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 974, "cost": 1, "resetAt": "2021-11-12T12:57:47Z"}}}