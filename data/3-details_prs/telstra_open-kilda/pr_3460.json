{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDE2NTc2MDgx", "number": 3460, "title": "Document solutions for migration to another data storage", "bodyText": "Related to #940", "createdAt": "2020-05-12T08:40:24Z", "url": "https://github.com/telstra/open-kilda/pull/3460", "merged": true, "mergeCommit": {"oid": "ba063bd76316359fd0733ef7f3ce324760d8cbc5"}, "closed": true, "closedAt": "2020-09-24T18:19:23Z", "author": {"login": "sergii-iakovenko"}, "timelineItems": {"totalCount": 13, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcggTXBAH2gAyNDE2NTc2MDgxOmZhM2Q1ZmFiOTRlOGZkODU2YWFjZGMxM2ZiOTc1OGI1ZTgzNWM1NzA=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcl8qcwgFqTQyMDY4OTA4OQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "fa3d5fab94e8fd856aacdc13fb9758b5e835c570", "author": {"user": {"login": "sergii-iakovenko", "name": "Sergii Iakovenko"}}, "url": "https://github.com/telstra/open-kilda/commit/fa3d5fab94e8fd856aacdc13fb9758b5e835c570", "committedDate": "2020-05-12T08:49:46Z", "message": "Add the Data Storage V2 representation."}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "d03b0d7dc398dfdf6c0ad39b0eabbc88ffbbf8de", "author": {"user": {"login": "sergii-iakovenko", "name": "Sergii Iakovenko"}}, "url": "https://github.com/telstra/open-kilda/commit/d03b0d7dc398dfdf6c0ad39b0eabbc88ffbbf8de", "committedDate": "2020-05-12T08:34:23Z", "message": "Add the Data Storage V2 representation."}, "afterCommit": {"oid": "fa3d5fab94e8fd856aacdc13fb9758b5e835c570", "author": {"user": {"login": "sergii-iakovenko", "name": "Sergii Iakovenko"}}, "url": "https://github.com/telstra/open-kilda/commit/fa3d5fab94e8fd856aacdc13fb9758b5e835c570", "committedDate": "2020-05-12T08:49:46Z", "message": "Add the Data Storage V2 representation."}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "edb95b231a3167496da0b02aee147b6e1db95073", "author": {"user": {"login": "sergii-iakovenko", "name": "Sergii Iakovenko"}}, "url": "https://github.com/telstra/open-kilda/commit/edb95b231a3167496da0b02aee147b6e1db95073", "committedDate": "2020-05-13T02:42:17Z", "message": "Add the Data Storage V2 representation - address the review findings."}, "afterCommit": {"oid": "5420f292cc14fcff14429c02159f5b580830d4b6", "author": {"user": {"login": "sergii-iakovenko", "name": "Sergii Iakovenko"}}, "url": "https://github.com/telstra/open-kilda/commit/5420f292cc14fcff14429c02159f5b580830d4b6", "committedDate": "2020-05-13T02:46:25Z", "message": "Add the Data Storage V2 representation - address the review findings."}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "5420f292cc14fcff14429c02159f5b580830d4b6", "author": {"user": {"login": "sergii-iakovenko", "name": "Sergii Iakovenko"}}, "url": "https://github.com/telstra/open-kilda/commit/5420f292cc14fcff14429c02159f5b580830d4b6", "committedDate": "2020-05-13T02:46:25Z", "message": "Add the Data Storage V2 representation - address the review findings."}, "afterCommit": {"oid": "db1828047c5228e29177681a962193e5ae699fc8", "author": {"user": {"login": "sergii-iakovenko", "name": "Sergii Iakovenko"}}, "url": "https://github.com/telstra/open-kilda/commit/db1828047c5228e29177681a962193e5ae699fc8", "committedDate": "2020-05-13T02:58:34Z", "message": "Add the Data Storage V2 representation - address the review findings."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b42b4bd140fdde949b99ecf453f5ed6df60dc69c", "author": {"user": {"login": "sergii-iakovenko", "name": "Sergii Iakovenko"}}, "url": "https://github.com/telstra/open-kilda/commit/b42b4bd140fdde949b99ecf453f5ed6df60dc69c", "committedDate": "2020-05-13T09:12:03Z", "message": "Add the Data Storage V2 representation - address the review findings."}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "db1828047c5228e29177681a962193e5ae699fc8", "author": {"user": {"login": "sergii-iakovenko", "name": "Sergii Iakovenko"}}, "url": "https://github.com/telstra/open-kilda/commit/db1828047c5228e29177681a962193e5ae699fc8", "committedDate": "2020-05-13T02:58:34Z", "message": "Add the Data Storage V2 representation - address the review findings."}, "afterCommit": {"oid": "b42b4bd140fdde949b99ecf453f5ed6df60dc69c", "author": {"user": {"login": "sergii-iakovenko", "name": "Sergii Iakovenko"}}, "url": "https://github.com/telstra/open-kilda/commit/b42b4bd140fdde949b99ecf453f5ed6df60dc69c", "committedDate": "2020-05-13T09:12:03Z", "message": "Add the Data Storage V2 representation - address the review findings."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDExMTgzODgw", "url": "https://github.com/telstra/open-kilda/pull/3460#pullrequestreview-411183880", "createdAt": "2020-05-13T18:19:33Z", "commit": {"oid": "b42b4bd140fdde949b99ecf453f5ed6df60dc69c"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "426a4e87b43af50f0c7b99b6164c196e7be56dd0", "author": {"user": {"login": "sergii-iakovenko", "name": "Sergii Iakovenko"}}, "url": "https://github.com/telstra/open-kilda/commit/426a4e87b43af50f0c7b99b6164c196e7be56dd0", "committedDate": "2020-05-14T00:39:10Z", "message": "Add diagrams for the implementation overview."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDEyNTQ2MjQ4", "url": "https://github.com/telstra/open-kilda/pull/3460#pullrequestreview-412546248", "createdAt": "2020-05-15T10:56:08Z", "commit": {"oid": "426a4e87b43af50f0c7b99b6164c196e7be56dd0"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDE0MjAyOTQ2", "url": "https://github.com/telstra/open-kilda/pull/3460#pullrequestreview-414202946", "createdAt": "2020-05-19T08:11:23Z", "commit": {"oid": "426a4e87b43af50f0c7b99b6164c196e7be56dd0"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDE4MjY1MjUz", "url": "https://github.com/telstra/open-kilda/pull/3460#pullrequestreview-418265253", "createdAt": "2020-05-26T12:52:09Z", "commit": {"oid": "426a4e87b43af50f0c7b99b6164c196e7be56dd0"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDE5OTQ2MTQ0", "url": "https://github.com/telstra/open-kilda/pull/3460#pullrequestreview-419946144", "createdAt": "2020-05-28T09:44:38Z", "commit": {"oid": "426a4e87b43af50f0c7b99b6164c196e7be56dd0"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDIwNjg5MDg5", "url": "https://github.com/telstra/open-kilda/pull/3460#pullrequestreview-420689089", "createdAt": "2020-05-29T06:41:52Z", "commit": {"oid": "426a4e87b43af50f0c7b99b6164c196e7be56dd0"}, "state": "APPROVED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yOVQwNjo0MTo1MlrOGcQkDw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yOVQwNjo0MTo1MlrOGcQkDw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMjI4NDY4Nw==", "bodyText": "no pros at all?:-p", "url": "https://github.com/telstra/open-kilda/pull/3460#discussion_r432284687", "createdAt": "2020-05-29T06:41:52Z", "author": {"login": "timofei-durakov"}, "path": "docs/design/solutions/data-storage-v2/data-storage-v2-options.md", "diffHunk": "@@ -0,0 +1,141 @@\n+# Kilda Data storage V2\n+\n+## Overview\n+This doc describes the proposed solutions for migration OpenKilda from Neo4j to another data storage(s).\n+\n+## Goals\n+The goal is to implement a data storage solution that satisfies the system requirements.\n+\n+Currently, Kilda uses [Neo4j](https://neo4j.com/) as a persistent storage for its [data model](../domain-model/domain-model.md),\n+and [Neo4j-OGM](https://github.com/neo4j/neo4j-ogm) as the mapping library in the persistence layer.\n+\n+Since the persistence layer was introduced, we faced multiple issues related to it: \n+Neo4j-OGM performance on concurrent updates (https://github.com/telstra/open-kilda/pull/2747),\n+missed changes in persistent objects (https://github.com/telstra/open-kilda/issues/3064), \n+improper handling of data types and converters (https://github.com/telstra/open-kilda/issues/3166).\n+\n+Considering the above mentioned along with a lack of high-availability configuration and online backups in the Neo4j community edition, \n+it was decided that Neo4j along with Neo4j-OGM doesn't correspond to the current and emerging system requirements -\n+https://github.com/telstra/open-kilda/issues/940. \n+\n+## Requirements for Data storage\n+Kilda architecture among other requirements to the data storage, expects flexibility in choice of the storage options:\n+from a single instance deployed on a developer's workstation, up to scalable and distributed, which provides high-availability.\n+\n+A dedicated storage for specific data may have own requirements, but all of them share the following:\n+- Durable writes with strong or eventual consistency.\n+- Support configuration with high availability and failover.\n+- Support online or incremental backups.\n+- Minimal overhead introduced by the persistence layer on CPU and memory resources.\n+\n+## Data groups\n+The data model consists of elements which can be split into several groups by their purpose,\n+specific use cases and requirements to storage:\n+- Network topology: switches and links (ISLs)\n+- Flows (each one contains multiple Flow paths and corresponding Path segments)\n+- History records (flow events, port status changes, etc)\n+- Resources pools (flow encapsulation, meter, etc) \n+\n+## The solutions\n+Each data group has own and specific use cases, so we evaluate it separately from others:\n+\n+#### Network topology, flow data\n+_Use cases:_\n+- Transactional CRUD operations on entities that represent the network.\n+- Find a path between nodes (via PCE).\n+- Find related entities (flows by an ISL or by a switch)\n+- Visualize as a graph model on GUI / web application.\n+- Analyze connectivity in the network, and identify required backup links\n+- Execute custom traversals over the network structure for ad-hoc investigations.\n+\n+_The solution:_ \n+- The data is stored in a graph database ([OrientDB](https://orientdb.com/) or [JanusGraph](https://janusgraph.org/)) \n+which has a complete implementation of [Tinkerpop Graph API](http://tinkerpop.apache.org/docs/3.4.6/reference/#graph).\n+- The persistence layer utilizes a one of existing OGM for data mapping: [Tinkerpop](https://tinkerpop.apache.org/) / [Ferma](http://syncleus.com/Ferma/).\n+- PCE utilizes graph traversal on the database side.\n+\n+_Known issues / problems:_\n+- The planned 2-step migration (via Neo4j + Tinkerpop) can't be implemented due to [a fundamental performance issue \n+in neo4j-gremlin-bolt](#neo4j).\n+- No exising options for schema versioning: [Liquigraph](https://www.liquigraph.org/) supports Neo4j only.\n+\n+_Alternative solutions:_\n+- Use a graph database which supports [Gremlin](https://tinkerpop.apache.org/gremlin.html) traversal language,\n+but doesn't have a complete implementation of Tinkerpop Graph API: [Amazon Neptune](https://aws.amazon.com/neptune/), \n+[Azure Cosmos DB](https://azure.microsoft.com/services/cosmos-db/). This requires custom data mapping to be coded in the persistence layer.\n+- Use a relational database. In this case, persistent data kept in a way that differs from how the business sees it. This may complicate future integrations", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "426a4e87b43af50f0c7b99b6164c196e7be56dd0"}, "originalPosition": 66}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3644, "cost": 1, "resetAt": "2021-11-02T12:20:56Z"}}}