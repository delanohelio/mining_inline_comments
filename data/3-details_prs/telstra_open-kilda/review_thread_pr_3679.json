{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDY1OTUzNTgz", "number": 3679, "reviewThreads": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yMVQxMTo0ODo1NVrOEa7-jQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yMVQxMjowMTozNFrOEa8L8A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjk2NjgxMTAxOnYy", "diffSide": "RIGHT", "path": "src-java/flowhs-topology/flowhs-storm-topology/src/main/java/org/openkilda/wfm/topology/flowhs/fsm/reroute/actions/AllocatePrimaryResourcesAction.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yMVQxMTo0ODo1NVrOHEqMaA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yMVQxMTo0ODo1NVrOHEqMaA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NDY0NzY1Ng==", "bodyText": "em... as far as I saw the code of PathComputer - in this case, it will use flow.getPathComputationStrategy() twice. First time as a \"normal\" strategy, second time as a \"backup\" strategy.", "url": "https://github.com/telstra/open-kilda/pull/3679#discussion_r474647656", "createdAt": "2020-08-21T11:48:55Z", "author": {"login": "surabujin"}, "path": "src-java/flowhs-topology/flowhs-storm-topology/src/main/java/org/openkilda/wfm/topology/flowhs/fsm/reroute/actions/AllocatePrimaryResourcesAction.java", "diffHunk": "@@ -70,15 +70,18 @@ protected void allocate(FlowRerouteFsm stateMachine)\n \n         log.debug(\"Finding a new primary path for flow {}\", flowId);\n \n-        PathPair potentialPath;\n+        GetPathsResult potentialPath;\n         if (stateMachine.isIgnoreBandwidth()) {\n             boolean originalIgnoreBandwidth = flow.isIgnoreBandwidth();\n             flow.setIgnoreBandwidth(true);\n-            potentialPath = pathComputer.getPath(flow);\n+            potentialPath = pathComputer.getPath(flow, getBackUpStrategies(flow.getPathComputationStrategy()));\n             flow.setIgnoreBandwidth(originalIgnoreBandwidth);\n         } else {\n-            potentialPath = pathComputer.getPath(flow, flow.getFlowPathIds());\n+            potentialPath = pathComputer.getPath(\n+                    flow, flow.getFlowPathIds(), getBackUpStrategies(flow.getPathComputationStrategy()));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e4a7d5b814e8acfbebf8b4bc17101189f10178c8"}, "originalPosition": 25}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjk2Njg0NTI4OnYy", "diffSide": "RIGHT", "path": "src-java/kilda-pce/src/main/java/org/openkilda/pce/PathComputer.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yMVQxMjowMTozNFrOHEqhMA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yMVQxMjowMTozNFrOHEqhMA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NDY1Mjk3Ng==", "bodyText": "Bad/unhandy API...\nAdd one mandatory strategy argument and raise an obvious exception in case of failure. In this case caller will be responsible for loop over required strategies and will alway know with strategy was used (no need to pass it via response).", "url": "https://github.com/telstra/open-kilda/pull/3679#discussion_r474652976", "createdAt": "2020-08-21T12:01:34Z", "author": {"login": "surabujin"}, "path": "src-java/kilda-pce/src/main/java/org/openkilda/pce/PathComputer.java", "diffHunk": "@@ -38,8 +38,9 @@\n      * @param flow the {@link Flow} instance\n      * @return {@link PathPair} instances\n      */\n-    default PathPair getPath(Flow flow) throws UnroutableFlowException, RecoverableException {\n-        return getPath(flow, Collections.emptyList());\n+    default GetPathsResult getPath(Flow flow, PathComputationStrategy... backUpStrategies)", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e4a7d5b814e8acfbebf8b4bc17101189f10178c8"}, "originalPosition": 6}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1796, "cost": 1, "resetAt": "2021-11-13T14:23:39Z"}}}