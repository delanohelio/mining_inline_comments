{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDgwNzY3NzAy", "number": 3712, "reviewThreads": {"totalCount": 18, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wOVQxNDoyMToxNVrOEhsnlQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wMlQwNjoyMzo1MFrOEps-0Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzAzNzY5NDkzOnYy", "diffSide": "RIGHT", "path": "src-java/nbworker-topology/nbworker-storm-topology/src/main/java/org/openkilda/wfm/topology/nbworker/services/LinkOperationsService.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wOVQxNDoyMToxNVrOHPJzLg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yMlQxNjozOToyNlrOHWDESA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NTY1MTI0Ng==", "bodyText": "As for me readBfdProperties and writeBfdProperties is better methods naming.", "url": "https://github.com/telstra/open-kilda/pull/3712#discussion_r485651246", "createdAt": "2020-09-09T14:21:15Z", "author": {"login": "rozdy"}, "path": "src-java/nbworker-topology/nbworker-storm-topology/src/main/java/org/openkilda/wfm/topology/nbworker/services/LinkOperationsService.java", "diffHunk": "@@ -150,44 +157,75 @@ public LinkOperationsService(ILinkOperationsServiceCarrier carrier,\n         return isls;\n     }\n \n+    /**\n+     * Read ISL bfd properties.\n+     */\n+    public BfdPropertiesResponse bfdPropertiesRead(Endpoint source, Endpoint destination) throws IslNotFoundException {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "2c662bd120dc6cda374384efa70492539bd4e7cd"}, "originalPosition": 51}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5Mjg4MDk2OA==", "bodyText": "The proposed named schema provide one handy \"feature\" - it provides natural method grouping - into alphabetically ordered lists you will always have methods working with the same object placed together. Also, the targeted object is more important than the action being applied to it. That why bfdPropertiesRead is handier than readBfdProperties at least for me.\nRenaming...", "url": "https://github.com/telstra/open-kilda/pull/3712#discussion_r492880968", "createdAt": "2020-09-22T16:39:26Z", "author": {"login": "surabujin"}, "path": "src-java/nbworker-topology/nbworker-storm-topology/src/main/java/org/openkilda/wfm/topology/nbworker/services/LinkOperationsService.java", "diffHunk": "@@ -150,44 +157,75 @@ public LinkOperationsService(ILinkOperationsServiceCarrier carrier,\n         return isls;\n     }\n \n+    /**\n+     * Read ISL bfd properties.\n+     */\n+    public BfdPropertiesResponse bfdPropertiesRead(Endpoint source, Endpoint destination) throws IslNotFoundException {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NTY1MTI0Ng=="}, "originalCommit": {"oid": "2c662bd120dc6cda374384efa70492539bd4e7cd"}, "originalPosition": 51}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzAzNzY5Nzg5OnYy", "diffSide": "RIGHT", "path": "src-java/nbworker-topology/nbworker-storm-topology/src/main/java/org/openkilda/wfm/topology/nbworker/services/LinkOperationsService.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wOVQxNDoyMTo1MVrOHPJ1CQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yMlQxNjo0Mzo0NVrOHWDPUg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NTY1MTcyMQ==", "bodyText": "Please update javadoc.", "url": "https://github.com/telstra/open-kilda/pull/3712#discussion_r485651721", "createdAt": "2020-09-09T14:21:51Z", "author": {"login": "rozdy"}, "path": "src-java/nbworker-topology/nbworker-storm-topology/src/main/java/org/openkilda/wfm/topology/nbworker/services/LinkOperationsService.java", "diffHunk": "@@ -150,44 +157,75 @@ public LinkOperationsService(ILinkOperationsServiceCarrier carrier,\n         return isls;\n     }\n \n+    /**\n+     * Read ISL bfd properties.\n+     */\n+    public BfdPropertiesResponse bfdPropertiesRead(Endpoint source, Endpoint destination) throws IslNotFoundException {\n+        Isl link = findIsl(source, destination);\n+        return LinkMapper.INSTANCE.responseMap(\n+                link, bfdPropertiesReadEffective(source), bfdPropertiesReadEffective(destination));\n+    }\n+\n     /**\n      * Update the \"Under maintenance\" flag in ISL.\n      *\n      * @throws IslNotFoundException if there is no isl with these parameters.\n      */\n-    public Collection<Isl> updateEnableBfdFlag(Endpoint source, Endpoint destination, boolean flagValue)\n-            throws IslNotFoundException {\n-        return transactionManager.doInTransaction(() -> {\n-            List<Isl> processed = new ArrayList<>(2);\n-            boolean madeChange;\n-            madeChange = updateUniIslEnableBfdFlag(source, destination, flagValue, processed);\n-            madeChange |= updateUniIslEnableBfdFlag(destination, source, flagValue, processed);\n+    public BfdPropertiesResponse bfdPropertiesWrite(", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "2c662bd120dc6cda374384efa70492539bd4e7cd"}, "originalPosition": 69}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5Mjg4Mzc5NA==", "bodyText": "done", "url": "https://github.com/telstra/open-kilda/pull/3712#discussion_r492883794", "createdAt": "2020-09-22T16:43:45Z", "author": {"login": "surabujin"}, "path": "src-java/nbworker-topology/nbworker-storm-topology/src/main/java/org/openkilda/wfm/topology/nbworker/services/LinkOperationsService.java", "diffHunk": "@@ -150,44 +157,75 @@ public LinkOperationsService(ILinkOperationsServiceCarrier carrier,\n         return isls;\n     }\n \n+    /**\n+     * Read ISL bfd properties.\n+     */\n+    public BfdPropertiesResponse bfdPropertiesRead(Endpoint source, Endpoint destination) throws IslNotFoundException {\n+        Isl link = findIsl(source, destination);\n+        return LinkMapper.INSTANCE.responseMap(\n+                link, bfdPropertiesReadEffective(source), bfdPropertiesReadEffective(destination));\n+    }\n+\n     /**\n      * Update the \"Under maintenance\" flag in ISL.\n      *\n      * @throws IslNotFoundException if there is no isl with these parameters.\n      */\n-    public Collection<Isl> updateEnableBfdFlag(Endpoint source, Endpoint destination, boolean flagValue)\n-            throws IslNotFoundException {\n-        return transactionManager.doInTransaction(() -> {\n-            List<Isl> processed = new ArrayList<>(2);\n-            boolean madeChange;\n-            madeChange = updateUniIslEnableBfdFlag(source, destination, flagValue, processed);\n-            madeChange |= updateUniIslEnableBfdFlag(destination, source, flagValue, processed);\n+    public BfdPropertiesResponse bfdPropertiesWrite(", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NTY1MTcyMQ=="}, "originalCommit": {"oid": "2c662bd120dc6cda374384efa70492539bd4e7cd"}, "originalPosition": 69}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzAzNzcwOTA0OnYy", "diffSide": "RIGHT", "path": "src-java/nbworker-topology/nbworker-storm-topology/src/main/java/org/openkilda/wfm/share/mappers/LinkMapper.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wOVQxNDoyNDoxMlrOHPJ8Eg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yMlQxNjo0ODoyNVrOHWDacg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NTY1MzUyMg==", "bodyText": "Rename responseMap to mapResponse.", "url": "https://github.com/telstra/open-kilda/pull/3712#discussion_r485653522", "createdAt": "2020-09-09T14:24:12Z", "author": {"login": "rozdy"}, "path": "src-java/nbworker-topology/nbworker-storm-topology/src/main/java/org/openkilda/wfm/share/mappers/LinkMapper.java", "diffHunk": "@@ -0,0 +1,49 @@\n+/* Copyright 2020 Telstra Open Source\n+ *\n+ *   Licensed under the Apache License, Version 2.0 (the \"License\");\n+ *   you may not use this file except in compliance with the License.\n+ *   You may obtain a copy of the License at\n+ *\n+ *       http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ *   Unless required by applicable law or agreed to in writing, software\n+ *   distributed under the License is distributed on an \"AS IS\" BASIS,\n+ *   WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ *   See the License for the specific language governing permissions and\n+ *   limitations under the License.\n+ */\n+\n+package org.openkilda.wfm.share.mappers;\n+\n+import org.openkilda.messaging.model.NetworkEndpoint;\n+import org.openkilda.messaging.nbtopology.response.BfdPropertiesResponse;\n+import org.openkilda.model.BfdProperties;\n+import org.openkilda.model.Isl;\n+\n+import org.mapstruct.Mapper;\n+import org.mapstruct.Mapping;\n+import org.mapstruct.factory.Mappers;\n+\n+@Mapper\n+public abstract class LinkMapper {\n+    public static final LinkMapper INSTANCE = Mappers.getMapper(LinkMapper.class);\n+\n+    /**\n+     * Convert {@link Isl} into {@link BfdPropertiesResponse}.\n+     */\n+    public BfdPropertiesResponse responseMap(", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "2c662bd120dc6cda374384efa70492539bd4e7cd"}, "originalPosition": 34}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5Mjg4NjY0Mg==", "bodyText": "done", "url": "https://github.com/telstra/open-kilda/pull/3712#discussion_r492886642", "createdAt": "2020-09-22T16:48:25Z", "author": {"login": "surabujin"}, "path": "src-java/nbworker-topology/nbworker-storm-topology/src/main/java/org/openkilda/wfm/share/mappers/LinkMapper.java", "diffHunk": "@@ -0,0 +1,49 @@\n+/* Copyright 2020 Telstra Open Source\n+ *\n+ *   Licensed under the Apache License, Version 2.0 (the \"License\");\n+ *   you may not use this file except in compliance with the License.\n+ *   You may obtain a copy of the License at\n+ *\n+ *       http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ *   Unless required by applicable law or agreed to in writing, software\n+ *   distributed under the License is distributed on an \"AS IS\" BASIS,\n+ *   WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ *   See the License for the specific language governing permissions and\n+ *   limitations under the License.\n+ */\n+\n+package org.openkilda.wfm.share.mappers;\n+\n+import org.openkilda.messaging.model.NetworkEndpoint;\n+import org.openkilda.messaging.nbtopology.response.BfdPropertiesResponse;\n+import org.openkilda.model.BfdProperties;\n+import org.openkilda.model.Isl;\n+\n+import org.mapstruct.Mapper;\n+import org.mapstruct.Mapping;\n+import org.mapstruct.factory.Mappers;\n+\n+@Mapper\n+public abstract class LinkMapper {\n+    public static final LinkMapper INSTANCE = Mappers.getMapper(LinkMapper.class);\n+\n+    /**\n+     * Convert {@link Isl} into {@link BfdPropertiesResponse}.\n+     */\n+    public BfdPropertiesResponse responseMap(", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NTY1MzUyMg=="}, "originalCommit": {"oid": "2c662bd120dc6cda374384efa70492539bd4e7cd"}, "originalPosition": 34}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzAzNzcyNzI4OnYy", "diffSide": "RIGHT", "path": "src-java/nbworker-topology/nbworker-storm-topology/src/main/java/org/openkilda/wfm/topology/nbworker/services/LinkOperationsService.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wOVQxNDoyNzo1NFrOHPKHYg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yMlQxNjo1MDo0N1rOHWDgLg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NTY1NjQxOA==", "bodyText": "Rename bfdPropertiesReadEffective -> readBfdPropertiesByEndpoint.", "url": "https://github.com/telstra/open-kilda/pull/3712#discussion_r485656418", "createdAt": "2020-09-09T14:27:54Z", "author": {"login": "rozdy"}, "path": "src-java/nbworker-topology/nbworker-storm-topology/src/main/java/org/openkilda/wfm/topology/nbworker/services/LinkOperationsService.java", "diffHunk": "@@ -150,44 +157,75 @@ public LinkOperationsService(ILinkOperationsServiceCarrier carrier,\n         return isls;\n     }\n \n+    /**\n+     * Read ISL bfd properties.\n+     */\n+    public BfdPropertiesResponse bfdPropertiesRead(Endpoint source, Endpoint destination) throws IslNotFoundException {\n+        Isl link = findIsl(source, destination);\n+        return LinkMapper.INSTANCE.responseMap(\n+                link, bfdPropertiesReadEffective(source), bfdPropertiesReadEffective(destination));\n+    }\n+\n     /**\n      * Update the \"Under maintenance\" flag in ISL.\n      *\n      * @throws IslNotFoundException if there is no isl with these parameters.\n      */\n-    public Collection<Isl> updateEnableBfdFlag(Endpoint source, Endpoint destination, boolean flagValue)\n-            throws IslNotFoundException {\n-        return transactionManager.doInTransaction(() -> {\n-            List<Isl> processed = new ArrayList<>(2);\n-            boolean madeChange;\n-            madeChange = updateUniIslEnableBfdFlag(source, destination, flagValue, processed);\n-            madeChange |= updateUniIslEnableBfdFlag(destination, source, flagValue, processed);\n+    public BfdPropertiesResponse bfdPropertiesWrite(\n+            Endpoint source, Endpoint destination, BfdProperties properties) throws IslNotFoundException {\n+        Isl link = transactionManager.doInTransaction(() -> bfdPropertiesWriteGoal(\n+                source, destination, properties));\n+        return LinkMapper.INSTANCE.responseMap(\n+                link, bfdPropertiesReadEffective(source), bfdPropertiesReadEffective(destination));\n+    }\n \n-            if (processed.size() != 2) {\n-                throw new IslNotFoundException(source, destination);\n-            }\n-            if (madeChange) {\n-                carrier.islBfdFlagChanged(processed.get(0));\n-            }\n+    private Isl findIsl(Endpoint leftEnd, Endpoint rightEnd) throws IslNotFoundException {\n+        return islRepository.findByEndpoints(\n+                leftEnd.getDatapath(), leftEnd.getPortNumber(), rightEnd.getDatapath(), rightEnd.getPortNumber())\n+                .orElseThrow(() -> new IslNotFoundException(leftEnd, rightEnd));\n+    }\n \n-            return processed;\n-        });\n+    private BfdProperties bfdPropertiesReadEffective(Endpoint endpoint) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "2c662bd120dc6cda374384efa70492539bd4e7cd"}, "originalPosition": 91}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5Mjg4ODExMA==", "bodyText": "no. It reads effective value stored into bfd_session collection, not \"goal\" value stored into isl collections.", "url": "https://github.com/telstra/open-kilda/pull/3712#discussion_r492888110", "createdAt": "2020-09-22T16:50:47Z", "author": {"login": "surabujin"}, "path": "src-java/nbworker-topology/nbworker-storm-topology/src/main/java/org/openkilda/wfm/topology/nbworker/services/LinkOperationsService.java", "diffHunk": "@@ -150,44 +157,75 @@ public LinkOperationsService(ILinkOperationsServiceCarrier carrier,\n         return isls;\n     }\n \n+    /**\n+     * Read ISL bfd properties.\n+     */\n+    public BfdPropertiesResponse bfdPropertiesRead(Endpoint source, Endpoint destination) throws IslNotFoundException {\n+        Isl link = findIsl(source, destination);\n+        return LinkMapper.INSTANCE.responseMap(\n+                link, bfdPropertiesReadEffective(source), bfdPropertiesReadEffective(destination));\n+    }\n+\n     /**\n      * Update the \"Under maintenance\" flag in ISL.\n      *\n      * @throws IslNotFoundException if there is no isl with these parameters.\n      */\n-    public Collection<Isl> updateEnableBfdFlag(Endpoint source, Endpoint destination, boolean flagValue)\n-            throws IslNotFoundException {\n-        return transactionManager.doInTransaction(() -> {\n-            List<Isl> processed = new ArrayList<>(2);\n-            boolean madeChange;\n-            madeChange = updateUniIslEnableBfdFlag(source, destination, flagValue, processed);\n-            madeChange |= updateUniIslEnableBfdFlag(destination, source, flagValue, processed);\n+    public BfdPropertiesResponse bfdPropertiesWrite(\n+            Endpoint source, Endpoint destination, BfdProperties properties) throws IslNotFoundException {\n+        Isl link = transactionManager.doInTransaction(() -> bfdPropertiesWriteGoal(\n+                source, destination, properties));\n+        return LinkMapper.INSTANCE.responseMap(\n+                link, bfdPropertiesReadEffective(source), bfdPropertiesReadEffective(destination));\n+    }\n \n-            if (processed.size() != 2) {\n-                throw new IslNotFoundException(source, destination);\n-            }\n-            if (madeChange) {\n-                carrier.islBfdFlagChanged(processed.get(0));\n-            }\n+    private Isl findIsl(Endpoint leftEnd, Endpoint rightEnd) throws IslNotFoundException {\n+        return islRepository.findByEndpoints(\n+                leftEnd.getDatapath(), leftEnd.getPortNumber(), rightEnd.getDatapath(), rightEnd.getPortNumber())\n+                .orElseThrow(() -> new IslNotFoundException(leftEnd, rightEnd));\n+    }\n \n-            return processed;\n-        });\n+    private BfdProperties bfdPropertiesReadEffective(Endpoint endpoint) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NTY1NjQxOA=="}, "originalCommit": {"oid": "2c662bd120dc6cda374384efa70492539bd4e7cd"}, "originalPosition": 91}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzAzNzc0NzMxOnYy", "diffSide": "RIGHT", "path": "src-java/nbworker-topology/nbworker-storm-topology/src/main/java/org/openkilda/wfm/topology/nbworker/services/LinkOperationsService.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wOVQxNDozMTo1NFrOHPKT2Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yMlQxNzowMjowOVrOHWD8Pg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NTY1OTYwOQ==", "bodyText": "Rename bfdPropertiesWriteGoal to writeBfdPropertiesGoal.", "url": "https://github.com/telstra/open-kilda/pull/3712#discussion_r485659609", "createdAt": "2020-09-09T14:31:54Z", "author": {"login": "rozdy"}, "path": "src-java/nbworker-topology/nbworker-storm-topology/src/main/java/org/openkilda/wfm/topology/nbworker/services/LinkOperationsService.java", "diffHunk": "@@ -150,44 +157,75 @@ public LinkOperationsService(ILinkOperationsServiceCarrier carrier,\n         return isls;\n     }\n \n+    /**\n+     * Read ISL bfd properties.\n+     */\n+    public BfdPropertiesResponse bfdPropertiesRead(Endpoint source, Endpoint destination) throws IslNotFoundException {\n+        Isl link = findIsl(source, destination);\n+        return LinkMapper.INSTANCE.responseMap(\n+                link, bfdPropertiesReadEffective(source), bfdPropertiesReadEffective(destination));\n+    }\n+\n     /**\n      * Update the \"Under maintenance\" flag in ISL.\n      *\n      * @throws IslNotFoundException if there is no isl with these parameters.\n      */\n-    public Collection<Isl> updateEnableBfdFlag(Endpoint source, Endpoint destination, boolean flagValue)\n-            throws IslNotFoundException {\n-        return transactionManager.doInTransaction(() -> {\n-            List<Isl> processed = new ArrayList<>(2);\n-            boolean madeChange;\n-            madeChange = updateUniIslEnableBfdFlag(source, destination, flagValue, processed);\n-            madeChange |= updateUniIslEnableBfdFlag(destination, source, flagValue, processed);\n+    public BfdPropertiesResponse bfdPropertiesWrite(\n+            Endpoint source, Endpoint destination, BfdProperties properties) throws IslNotFoundException {\n+        Isl link = transactionManager.doInTransaction(() -> bfdPropertiesWriteGoal(\n+                source, destination, properties));\n+        return LinkMapper.INSTANCE.responseMap(\n+                link, bfdPropertiesReadEffective(source), bfdPropertiesReadEffective(destination));\n+    }\n \n-            if (processed.size() != 2) {\n-                throw new IslNotFoundException(source, destination);\n-            }\n-            if (madeChange) {\n-                carrier.islBfdFlagChanged(processed.get(0));\n-            }\n+    private Isl findIsl(Endpoint leftEnd, Endpoint rightEnd) throws IslNotFoundException {\n+        return islRepository.findByEndpoints(\n+                leftEnd.getDatapath(), leftEnd.getPortNumber(), rightEnd.getDatapath(), rightEnd.getPortNumber())\n+                .orElseThrow(() -> new IslNotFoundException(leftEnd, rightEnd));\n+    }\n \n-            return processed;\n-        });\n+    private BfdProperties bfdPropertiesReadEffective(Endpoint endpoint) {\n+        return bfdSessionRepository.findBySwitchIdAndPhysicalPort(endpoint.getDatapath(), endpoint.getPortNumber())\n+                .map(IslMapper.INSTANCE::readBfdProperties)\n+                .orElse(new BfdProperties());\n     }\n \n-    private boolean updateUniIslEnableBfdFlag(\n-            Endpoint leftEnd, Endpoint rightEnd, boolean flagValue, List<Isl> processed) {\n+    private Isl bfdPropertiesWriteGoal(", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "2c662bd120dc6cda374384efa70492539bd4e7cd"}, "originalPosition": 99}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5Mjg5NTI5NA==", "bodyText": "done, mostly", "url": "https://github.com/telstra/open-kilda/pull/3712#discussion_r492895294", "createdAt": "2020-09-22T17:02:09Z", "author": {"login": "surabujin"}, "path": "src-java/nbworker-topology/nbworker-storm-topology/src/main/java/org/openkilda/wfm/topology/nbworker/services/LinkOperationsService.java", "diffHunk": "@@ -150,44 +157,75 @@ public LinkOperationsService(ILinkOperationsServiceCarrier carrier,\n         return isls;\n     }\n \n+    /**\n+     * Read ISL bfd properties.\n+     */\n+    public BfdPropertiesResponse bfdPropertiesRead(Endpoint source, Endpoint destination) throws IslNotFoundException {\n+        Isl link = findIsl(source, destination);\n+        return LinkMapper.INSTANCE.responseMap(\n+                link, bfdPropertiesReadEffective(source), bfdPropertiesReadEffective(destination));\n+    }\n+\n     /**\n      * Update the \"Under maintenance\" flag in ISL.\n      *\n      * @throws IslNotFoundException if there is no isl with these parameters.\n      */\n-    public Collection<Isl> updateEnableBfdFlag(Endpoint source, Endpoint destination, boolean flagValue)\n-            throws IslNotFoundException {\n-        return transactionManager.doInTransaction(() -> {\n-            List<Isl> processed = new ArrayList<>(2);\n-            boolean madeChange;\n-            madeChange = updateUniIslEnableBfdFlag(source, destination, flagValue, processed);\n-            madeChange |= updateUniIslEnableBfdFlag(destination, source, flagValue, processed);\n+    public BfdPropertiesResponse bfdPropertiesWrite(\n+            Endpoint source, Endpoint destination, BfdProperties properties) throws IslNotFoundException {\n+        Isl link = transactionManager.doInTransaction(() -> bfdPropertiesWriteGoal(\n+                source, destination, properties));\n+        return LinkMapper.INSTANCE.responseMap(\n+                link, bfdPropertiesReadEffective(source), bfdPropertiesReadEffective(destination));\n+    }\n \n-            if (processed.size() != 2) {\n-                throw new IslNotFoundException(source, destination);\n-            }\n-            if (madeChange) {\n-                carrier.islBfdFlagChanged(processed.get(0));\n-            }\n+    private Isl findIsl(Endpoint leftEnd, Endpoint rightEnd) throws IslNotFoundException {\n+        return islRepository.findByEndpoints(\n+                leftEnd.getDatapath(), leftEnd.getPortNumber(), rightEnd.getDatapath(), rightEnd.getPortNumber())\n+                .orElseThrow(() -> new IslNotFoundException(leftEnd, rightEnd));\n+    }\n \n-            return processed;\n-        });\n+    private BfdProperties bfdPropertiesReadEffective(Endpoint endpoint) {\n+        return bfdSessionRepository.findBySwitchIdAndPhysicalPort(endpoint.getDatapath(), endpoint.getPortNumber())\n+                .map(IslMapper.INSTANCE::readBfdProperties)\n+                .orElse(new BfdProperties());\n     }\n \n-    private boolean updateUniIslEnableBfdFlag(\n-            Endpoint leftEnd, Endpoint rightEnd, boolean flagValue, List<Isl> processed) {\n+    private Isl bfdPropertiesWriteGoal(", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NTY1OTYwOQ=="}, "originalCommit": {"oid": "2c662bd120dc6cda374384efa70492539bd4e7cd"}, "originalPosition": 99}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzAzNzc1MjY3OnYy", "diffSide": "RIGHT", "path": "src-java/nbworker-topology/nbworker-storm-topology/src/main/java/org/openkilda/wfm/topology/nbworker/services/LinkOperationsService.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wOVQxNDozMzowMlrOHPKXQg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yMlQxNzowMjozNlrOHWD9OQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NTY2MDQ4Mg==", "bodyText": "And here.", "url": "https://github.com/telstra/open-kilda/pull/3712#discussion_r485660482", "createdAt": "2020-09-09T14:33:02Z", "author": {"login": "rozdy"}, "path": "src-java/nbworker-topology/nbworker-storm-topology/src/main/java/org/openkilda/wfm/topology/nbworker/services/LinkOperationsService.java", "diffHunk": "@@ -150,44 +157,75 @@ public LinkOperationsService(ILinkOperationsServiceCarrier carrier,\n         return isls;\n     }\n \n+    /**\n+     * Read ISL bfd properties.\n+     */\n+    public BfdPropertiesResponse bfdPropertiesRead(Endpoint source, Endpoint destination) throws IslNotFoundException {\n+        Isl link = findIsl(source, destination);\n+        return LinkMapper.INSTANCE.responseMap(\n+                link, bfdPropertiesReadEffective(source), bfdPropertiesReadEffective(destination));\n+    }\n+\n     /**\n      * Update the \"Under maintenance\" flag in ISL.\n      *\n      * @throws IslNotFoundException if there is no isl with these parameters.\n      */\n-    public Collection<Isl> updateEnableBfdFlag(Endpoint source, Endpoint destination, boolean flagValue)\n-            throws IslNotFoundException {\n-        return transactionManager.doInTransaction(() -> {\n-            List<Isl> processed = new ArrayList<>(2);\n-            boolean madeChange;\n-            madeChange = updateUniIslEnableBfdFlag(source, destination, flagValue, processed);\n-            madeChange |= updateUniIslEnableBfdFlag(destination, source, flagValue, processed);\n+    public BfdPropertiesResponse bfdPropertiesWrite(\n+            Endpoint source, Endpoint destination, BfdProperties properties) throws IslNotFoundException {\n+        Isl link = transactionManager.doInTransaction(() -> bfdPropertiesWriteGoal(\n+                source, destination, properties));\n+        return LinkMapper.INSTANCE.responseMap(\n+                link, bfdPropertiesReadEffective(source), bfdPropertiesReadEffective(destination));\n+    }\n \n-            if (processed.size() != 2) {\n-                throw new IslNotFoundException(source, destination);\n-            }\n-            if (madeChange) {\n-                carrier.islBfdFlagChanged(processed.get(0));\n-            }\n+    private Isl findIsl(Endpoint leftEnd, Endpoint rightEnd) throws IslNotFoundException {\n+        return islRepository.findByEndpoints(\n+                leftEnd.getDatapath(), leftEnd.getPortNumber(), rightEnd.getDatapath(), rightEnd.getPortNumber())\n+                .orElseThrow(() -> new IslNotFoundException(leftEnd, rightEnd));\n+    }\n \n-            return processed;\n-        });\n+    private BfdProperties bfdPropertiesReadEffective(Endpoint endpoint) {\n+        return bfdSessionRepository.findBySwitchIdAndPhysicalPort(endpoint.getDatapath(), endpoint.getPortNumber())\n+                .map(IslMapper.INSTANCE::readBfdProperties)\n+                .orElse(new BfdProperties());\n     }\n \n-    private boolean updateUniIslEnableBfdFlag(\n-            Endpoint leftEnd, Endpoint rightEnd, boolean flagValue, List<Isl> processed) {\n+    private Isl bfdPropertiesWriteGoal(\n+            Endpoint source, Endpoint destination, BfdProperties properties) throws IslNotFoundException {\n+        List<Isl> processed = new ArrayList<>(2);\n+        boolean madeChange;\n+        madeChange = bfdPropertiesWriteGoal(source, destination, properties, processed);\n+        madeChange |= bfdPropertiesWriteGoal(destination, source, properties, processed);\n+\n+        if (processed.size() != 2) {\n+            throw new IslNotFoundException(source, destination);\n+        }\n+        if (madeChange) {\n+            carrier.islBfdPropertiesChanged(source, destination);\n+        }\n+\n+        return processed.get(0);\n+    }\n+\n+    private boolean bfdPropertiesWriteGoal(", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "2c662bd120dc6cda374384efa70492539bd4e7cd"}, "originalPosition": 116}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5Mjg5NTU0NQ==", "bodyText": "done", "url": "https://github.com/telstra/open-kilda/pull/3712#discussion_r492895545", "createdAt": "2020-09-22T17:02:36Z", "author": {"login": "surabujin"}, "path": "src-java/nbworker-topology/nbworker-storm-topology/src/main/java/org/openkilda/wfm/topology/nbworker/services/LinkOperationsService.java", "diffHunk": "@@ -150,44 +157,75 @@ public LinkOperationsService(ILinkOperationsServiceCarrier carrier,\n         return isls;\n     }\n \n+    /**\n+     * Read ISL bfd properties.\n+     */\n+    public BfdPropertiesResponse bfdPropertiesRead(Endpoint source, Endpoint destination) throws IslNotFoundException {\n+        Isl link = findIsl(source, destination);\n+        return LinkMapper.INSTANCE.responseMap(\n+                link, bfdPropertiesReadEffective(source), bfdPropertiesReadEffective(destination));\n+    }\n+\n     /**\n      * Update the \"Under maintenance\" flag in ISL.\n      *\n      * @throws IslNotFoundException if there is no isl with these parameters.\n      */\n-    public Collection<Isl> updateEnableBfdFlag(Endpoint source, Endpoint destination, boolean flagValue)\n-            throws IslNotFoundException {\n-        return transactionManager.doInTransaction(() -> {\n-            List<Isl> processed = new ArrayList<>(2);\n-            boolean madeChange;\n-            madeChange = updateUniIslEnableBfdFlag(source, destination, flagValue, processed);\n-            madeChange |= updateUniIslEnableBfdFlag(destination, source, flagValue, processed);\n+    public BfdPropertiesResponse bfdPropertiesWrite(\n+            Endpoint source, Endpoint destination, BfdProperties properties) throws IslNotFoundException {\n+        Isl link = transactionManager.doInTransaction(() -> bfdPropertiesWriteGoal(\n+                source, destination, properties));\n+        return LinkMapper.INSTANCE.responseMap(\n+                link, bfdPropertiesReadEffective(source), bfdPropertiesReadEffective(destination));\n+    }\n \n-            if (processed.size() != 2) {\n-                throw new IslNotFoundException(source, destination);\n-            }\n-            if (madeChange) {\n-                carrier.islBfdFlagChanged(processed.get(0));\n-            }\n+    private Isl findIsl(Endpoint leftEnd, Endpoint rightEnd) throws IslNotFoundException {\n+        return islRepository.findByEndpoints(\n+                leftEnd.getDatapath(), leftEnd.getPortNumber(), rightEnd.getDatapath(), rightEnd.getPortNumber())\n+                .orElseThrow(() -> new IslNotFoundException(leftEnd, rightEnd));\n+    }\n \n-            return processed;\n-        });\n+    private BfdProperties bfdPropertiesReadEffective(Endpoint endpoint) {\n+        return bfdSessionRepository.findBySwitchIdAndPhysicalPort(endpoint.getDatapath(), endpoint.getPortNumber())\n+                .map(IslMapper.INSTANCE::readBfdProperties)\n+                .orElse(new BfdProperties());\n     }\n \n-    private boolean updateUniIslEnableBfdFlag(\n-            Endpoint leftEnd, Endpoint rightEnd, boolean flagValue, List<Isl> processed) {\n+    private Isl bfdPropertiesWriteGoal(\n+            Endpoint source, Endpoint destination, BfdProperties properties) throws IslNotFoundException {\n+        List<Isl> processed = new ArrayList<>(2);\n+        boolean madeChange;\n+        madeChange = bfdPropertiesWriteGoal(source, destination, properties, processed);\n+        madeChange |= bfdPropertiesWriteGoal(destination, source, properties, processed);\n+\n+        if (processed.size() != 2) {\n+            throw new IslNotFoundException(source, destination);\n+        }\n+        if (madeChange) {\n+            carrier.islBfdPropertiesChanged(source, destination);\n+        }\n+\n+        return processed.get(0);\n+    }\n+\n+    private boolean bfdPropertiesWriteGoal(", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NTY2MDQ4Mg=="}, "originalCommit": {"oid": "2c662bd120dc6cda374384efa70492539bd4e7cd"}, "originalPosition": 116}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzAzNzgyNjY1OnYy", "diffSide": "RIGHT", "path": "src-java/network-topology/network-storm-topology/src/main/java/org/openkilda/wfm/topology/network/controller/isl/IslFsm.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wOVQxNDo0ODoyN1rOHPLF8g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yMlQxNzowNDoyNlrOHWEBiA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NTY3MjQzNA==", "bodyText": "I guess you can rename leftToRight and rightToLeft to simple left and right.", "url": "https://github.com/telstra/open-kilda/pull/3712#discussion_r485672434", "createdAt": "2020-09-09T14:48:27Z", "author": {"login": "rozdy"}, "path": "src-java/network-topology/network-storm-topology/src/main/java/org/openkilda/wfm/topology/network/controller/isl/IslFsm.java", "diffHunk": "@@ -600,6 +637,25 @@ private void initializeFromLinkProps(Endpoint source, Endpoint dest, IslBuilder\n         return result;\n     }\n \n+    private BfdProperties loadBfdProperties() {\n+        BfdProperties leftToRight = loadBfdProperties(reference.getSource(), reference.getDest());", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "2c662bd120dc6cda374384efa70492539bd4e7cd"}, "originalPosition": 193}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5Mjg5NjY0OA==", "bodyText": "it does not exact enough", "url": "https://github.com/telstra/open-kilda/pull/3712#discussion_r492896648", "createdAt": "2020-09-22T17:04:26Z", "author": {"login": "surabujin"}, "path": "src-java/network-topology/network-storm-topology/src/main/java/org/openkilda/wfm/topology/network/controller/isl/IslFsm.java", "diffHunk": "@@ -600,6 +637,25 @@ private void initializeFromLinkProps(Endpoint source, Endpoint dest, IslBuilder\n         return result;\n     }\n \n+    private BfdProperties loadBfdProperties() {\n+        BfdProperties leftToRight = loadBfdProperties(reference.getSource(), reference.getDest());", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NTY3MjQzNA=="}, "originalCommit": {"oid": "2c662bd120dc6cda374384efa70492539bd4e7cd"}, "originalPosition": 193}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzAzNzkxMzc2OnYy", "diffSide": "RIGHT", "path": "src-java/northbound-service/northbound/src/main/java/org/openkilda/northbound/converter/LinkMapper.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wOVQxNTowNTo1NlrOHPL8cw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yMlQxNzowNTo1NVrOHWEFdw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NTY4NjM4Nw==", "bodyText": "Rename responseMap -> mapResponse.", "url": "https://github.com/telstra/open-kilda/pull/3712#discussion_r485686387", "createdAt": "2020-09-09T15:05:56Z", "author": {"login": "rozdy"}, "path": "src-java/northbound-service/northbound/src/main/java/org/openkilda/northbound/converter/LinkMapper.java", "diffHunk": "@@ -17,23 +17,88 @@\n \n import org.openkilda.messaging.info.event.IslInfoData;\n import org.openkilda.messaging.info.event.PathNode;\n+import org.openkilda.messaging.model.NetworkEndpoint;\n+import org.openkilda.messaging.nbtopology.request.BfdPropertiesReadRequest;\n+import org.openkilda.messaging.nbtopology.request.BfdPropertiesWriteRequest;\n+import org.openkilda.messaging.nbtopology.response.BfdPropertiesResponse;\n import org.openkilda.model.SwitchId;\n import org.openkilda.northbound.dto.v1.links.LinkDto;\n import org.openkilda.northbound.dto.v1.links.PathDto;\n+import org.openkilda.northbound.dto.v2.links.BfdPropertiesByEndpoint;\n+import org.openkilda.northbound.dto.v2.links.BfdPropertiesPayload;\n \n import org.mapstruct.Mapper;\n import org.mapstruct.Mapping;\n+import org.mapstruct.MappingTarget;\n+\n+import java.time.Duration;\n+import java.util.Arrays;\n \n @Mapper(componentModel = \"spring\")\n-public interface LinkMapper {\n+public abstract class LinkMapper {\n+    public abstract PathDto map(PathNode data);\n+\n+    @Mapping(target = \"interval\", source = \"intervalMs\")\n+    public abstract org.openkilda.model.BfdProperties map(org.openkilda.northbound.dto.v2.links.BfdProperties source);\n+\n+    @Mapping(target = \"intervalMs\", source = \"interval\")\n+    public abstract org.openkilda.northbound.dto.v2.links.BfdProperties map(org.openkilda.model.BfdProperties source);\n+\n+    @Mapping(target = \"timestamp\", ignore = true)\n+    public abstract BfdPropertiesReadRequest bfdRequestMap(NetworkEndpoint source, NetworkEndpoint destination);\n+\n+    @Mapping(target = \"timestamp\", ignore = true)\n+    @Mapping(target = \"source\", source = \"source\")\n+    @Mapping(target = \"destination\", source = \"destination\")\n+    @Mapping(target = \"properties\", source = \"properties\")\n+    public abstract BfdPropertiesWriteRequest bfdRequestMap(\n+            NetworkEndpoint source, NetworkEndpoint destination,\n+            org.openkilda.northbound.dto.v2.links.BfdProperties  properties);\n+\n+    /**\n+     * Convert {@link BfdPropertiesResponse} into {@link BfdPropertiesPayload}.\n+     */\n+    @Mapping(target = \"intervalMs\", source = \"properties.interval\")\n+    @Mapping(target = \"multiplier\", source = \"properties.multiplier\")\n+    public BfdPropertiesPayload responseMap(BfdPropertiesResponse response) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "2c662bd120dc6cda374384efa70492539bd4e7cd"}, "originalPosition": 48}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5Mjg5NzY1NQ==", "bodyText": "done", "url": "https://github.com/telstra/open-kilda/pull/3712#discussion_r492897655", "createdAt": "2020-09-22T17:05:55Z", "author": {"login": "surabujin"}, "path": "src-java/northbound-service/northbound/src/main/java/org/openkilda/northbound/converter/LinkMapper.java", "diffHunk": "@@ -17,23 +17,88 @@\n \n import org.openkilda.messaging.info.event.IslInfoData;\n import org.openkilda.messaging.info.event.PathNode;\n+import org.openkilda.messaging.model.NetworkEndpoint;\n+import org.openkilda.messaging.nbtopology.request.BfdPropertiesReadRequest;\n+import org.openkilda.messaging.nbtopology.request.BfdPropertiesWriteRequest;\n+import org.openkilda.messaging.nbtopology.response.BfdPropertiesResponse;\n import org.openkilda.model.SwitchId;\n import org.openkilda.northbound.dto.v1.links.LinkDto;\n import org.openkilda.northbound.dto.v1.links.PathDto;\n+import org.openkilda.northbound.dto.v2.links.BfdPropertiesByEndpoint;\n+import org.openkilda.northbound.dto.v2.links.BfdPropertiesPayload;\n \n import org.mapstruct.Mapper;\n import org.mapstruct.Mapping;\n+import org.mapstruct.MappingTarget;\n+\n+import java.time.Duration;\n+import java.util.Arrays;\n \n @Mapper(componentModel = \"spring\")\n-public interface LinkMapper {\n+public abstract class LinkMapper {\n+    public abstract PathDto map(PathNode data);\n+\n+    @Mapping(target = \"interval\", source = \"intervalMs\")\n+    public abstract org.openkilda.model.BfdProperties map(org.openkilda.northbound.dto.v2.links.BfdProperties source);\n+\n+    @Mapping(target = \"intervalMs\", source = \"interval\")\n+    public abstract org.openkilda.northbound.dto.v2.links.BfdProperties map(org.openkilda.model.BfdProperties source);\n+\n+    @Mapping(target = \"timestamp\", ignore = true)\n+    public abstract BfdPropertiesReadRequest bfdRequestMap(NetworkEndpoint source, NetworkEndpoint destination);\n+\n+    @Mapping(target = \"timestamp\", ignore = true)\n+    @Mapping(target = \"source\", source = \"source\")\n+    @Mapping(target = \"destination\", source = \"destination\")\n+    @Mapping(target = \"properties\", source = \"properties\")\n+    public abstract BfdPropertiesWriteRequest bfdRequestMap(\n+            NetworkEndpoint source, NetworkEndpoint destination,\n+            org.openkilda.northbound.dto.v2.links.BfdProperties  properties);\n+\n+    /**\n+     * Convert {@link BfdPropertiesResponse} into {@link BfdPropertiesPayload}.\n+     */\n+    @Mapping(target = \"intervalMs\", source = \"properties.interval\")\n+    @Mapping(target = \"multiplier\", source = \"properties.multiplier\")\n+    public BfdPropertiesPayload responseMap(BfdPropertiesResponse response) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NTY4NjM4Nw=="}, "originalCommit": {"oid": "2c662bd120dc6cda374384efa70492539bd4e7cd"}, "originalPosition": 48}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzAzNzkyNTE0OnYy", "diffSide": "RIGHT", "path": "src-java/northbound-service/northbound/src/main/java/org/openkilda/northbound/service/LinkService.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wOVQxNTowODozMFrOHPMD1Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yMlQxNzowNzoyMVrOHWEIxQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NTY4ODI3Nw==", "bodyText": "Rename methods to write/read/deleteBfdProperties.", "url": "https://github.com/telstra/open-kilda/pull/3712#discussion_r485688277", "createdAt": "2020-09-09T15:08:30Z", "author": {"login": "rozdy"}, "path": "src-java/northbound-service/northbound/src/main/java/org/openkilda/northbound/service/LinkService.java", "diffHunk": "@@ -106,13 +108,15 @@\n      */\n     CompletableFuture<List<LinkDto>> deleteLink(LinkParametersDto linkParameters, boolean force);\n \n-    /**\n-     * Update \"Enable BFD\" flag.\n-     *\n-     * @param link link parameters.\n-     * @return updated link.\n-     */\n-    CompletableFuture<List<LinkDto>> updateLinkEnableBfd(LinkEnableBfdDto link);\n+    CompletableFuture<List<LinkDto>> bfdPropertiesWrite(", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "2c662bd120dc6cda374384efa70492539bd4e7cd"}, "originalPosition": 31}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5Mjg5ODUwMQ==", "bodyText": "done", "url": "https://github.com/telstra/open-kilda/pull/3712#discussion_r492898501", "createdAt": "2020-09-22T17:07:21Z", "author": {"login": "surabujin"}, "path": "src-java/northbound-service/northbound/src/main/java/org/openkilda/northbound/service/LinkService.java", "diffHunk": "@@ -106,13 +108,15 @@\n      */\n     CompletableFuture<List<LinkDto>> deleteLink(LinkParametersDto linkParameters, boolean force);\n \n-    /**\n-     * Update \"Enable BFD\" flag.\n-     *\n-     * @param link link parameters.\n-     * @return updated link.\n-     */\n-    CompletableFuture<List<LinkDto>> updateLinkEnableBfd(LinkEnableBfdDto link);\n+    CompletableFuture<List<LinkDto>> bfdPropertiesWrite(", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NTY4ODI3Nw=="}, "originalCommit": {"oid": "2c662bd120dc6cda374384efa70492539bd4e7cd"}, "originalPosition": 31}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzAzNzk0NTE3OnYy", "diffSide": "RIGHT", "path": "src-java/nbworker-topology/nbworker-storm-topology/src/main/java/org/openkilda/wfm/topology/nbworker/bolts/SwitchOperationsBolt.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wOVQxNToxMjo0M1rOHPMQAw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yMlQxNzoxMzoyOFrOHWEW_w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NTY5MTM5NQ==", "bodyText": "Didn't get it. Why we need to discard this call?", "url": "https://github.com/telstra/open-kilda/pull/3712#discussion_r485691395", "createdAt": "2020-09-09T15:12:43Z", "author": {"login": "rozdy"}, "path": "src-java/nbworker-topology/nbworker-storm-topology/src/main/java/org/openkilda/wfm/topology/nbworker/bolts/SwitchOperationsBolt.java", "diffHunk": "@@ -323,4 +324,9 @@ public void declareOutputFields(OutputFieldsDeclarer declarer) {\n         declarer.declareStream(StreamType.TO_SERVER42.toString(),\n                 new Fields(MessageEncoder.FIELD_ID_PAYLOAD, MessageEncoder.FIELD_ID_CONTEXT));\n     }\n+\n+    @Override\n+    public void islBfdPropertiesChanged(Endpoint source, Endpoint destination) {\n+        log.warn(\"Discard islBfdPropertiesChanged link carrier call\");", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "2c662bd120dc6cda374384efa70492539bd4e7cd"}, "originalPosition": 24}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MjkwMjE0Mw==", "bodyText": "... this is the ugly design of nbworker.\nMethod islBfdPropertiesChanged is part of ILinkOperationsServiceCarrier, this interface are implemented by LinkOperationsBolt and SwitchOperationsBolt. LinkOperationsBolt can and must provide a correct implementation of this method, while SwitchOperationsBolt can't do it. I have added this warning to have visibility of the issue, when something will goest wrong.", "url": "https://github.com/telstra/open-kilda/pull/3712#discussion_r492902143", "createdAt": "2020-09-22T17:13:28Z", "author": {"login": "surabujin"}, "path": "src-java/nbworker-topology/nbworker-storm-topology/src/main/java/org/openkilda/wfm/topology/nbworker/bolts/SwitchOperationsBolt.java", "diffHunk": "@@ -323,4 +324,9 @@ public void declareOutputFields(OutputFieldsDeclarer declarer) {\n         declarer.declareStream(StreamType.TO_SERVER42.toString(),\n                 new Fields(MessageEncoder.FIELD_ID_PAYLOAD, MessageEncoder.FIELD_ID_CONTEXT));\n     }\n+\n+    @Override\n+    public void islBfdPropertiesChanged(Endpoint source, Endpoint destination) {\n+        log.warn(\"Discard islBfdPropertiesChanged link carrier call\");", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NTY5MTM5NQ=="}, "originalCommit": {"oid": "2c662bd120dc6cda374384efa70492539bd4e7cd"}, "originalPosition": 24}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzAzNzk2NjUzOnYy", "diffSide": "RIGHT", "path": "src-java/network-topology/network-storm-topology/src/main/java/org/openkilda/wfm/topology/network/controller/isl/IslFsm.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wOVQxNToxNzoxMFrOHPMdFQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yMlQxNzoxNDo0N1rOHWEZyg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NTY5NDc0MQ==", "bodyText": "Do we still need this method?", "url": "https://github.com/telstra/open-kilda/pull/3712#discussion_r485694741", "createdAt": "2020-09-09T15:17:10Z", "author": {"login": "rozdy"}, "path": "src-java/network-topology/network-storm-topology/src/main/java/org/openkilda/wfm/topology/network/controller/isl/IslFsm.java", "diffHunk": "@@ -486,11 +525,9 @@ private void fireBecomeStateEvent(IslFsmContext context) {\n         fire(route, context);\n     }\n \n-    private boolean shouldSetupBfd() {\n+    private boolean canSetupBfd() {\n         // TODO(surabujin): ensure the switch is BFD capable\n-\n-        return isPerIslBfdToggleEnabled(reference.getSource(), reference.getDest())\n-                || isPerIslBfdToggleEnabled(reference.getDest(), reference.getSource());\n+        return true;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "2c662bd120dc6cda374384efa70492539bd4e7cd"}, "originalPosition": 184}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MjkwMjg1OA==", "bodyText": "I would like to keep it and follow TODO placed there i.e. \"ensure the switch is BFD capable\".", "url": "https://github.com/telstra/open-kilda/pull/3712#discussion_r492902858", "createdAt": "2020-09-22T17:14:47Z", "author": {"login": "surabujin"}, "path": "src-java/network-topology/network-storm-topology/src/main/java/org/openkilda/wfm/topology/network/controller/isl/IslFsm.java", "diffHunk": "@@ -486,11 +525,9 @@ private void fireBecomeStateEvent(IslFsmContext context) {\n         fire(route, context);\n     }\n \n-    private boolean shouldSetupBfd() {\n+    private boolean canSetupBfd() {\n         // TODO(surabujin): ensure the switch is BFD capable\n-\n-        return isPerIslBfdToggleEnabled(reference.getSource(), reference.getDest())\n-                || isPerIslBfdToggleEnabled(reference.getDest(), reference.getSource());\n+        return true;", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NTY5NDc0MQ=="}, "originalCommit": {"oid": "2c662bd120dc6cda374384efa70492539bd4e7cd"}, "originalPosition": 184}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzA0MjQ5MTA3OnYy", "diffSide": "RIGHT", "path": "src-java/kilda-model/src/main/java/org/openkilda/model/Isl.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xMFQxNDo0NjowMVrOHP3r1w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yMlQxNzoxNzoxMFrOHWEfbQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NjQwMzAzMQ==", "bodyText": "Please, double-check that property is worked as expected on the current master.", "url": "https://github.com/telstra/open-kilda/pull/3712#discussion_r486403031", "createdAt": "2020-09-10T14:46:01Z", "author": {"login": "nikitamarchenko"}, "path": "src-java/kilda-model/src/main/java/org/openkilda/model/Isl.java", "diffHunk": "@@ -116,9 +117,17 @@\n     @Property(name = \"under_maintenance\")\n     private boolean underMaintenance;\n \n+    // TODO(surabujin): drop after migration\n     @Property(name = \"enable_bfd\")\n     private boolean enableBfd;\n \n+    @Property(\"bfd_interval\")\n+    @Convert(graphPropertyType = Long.class)\n+    private Duration bfdInterval;\n+\n+    @Property(\"bfd_multiplier\")\n+    private short bfdMultiplier;\n+\n     @Property(name = \"bfd_session_status\")\n     @Convert(graphPropertyType = String.class)\n     private BfdSessionStatus bfdSessionStatus;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "2c662bd120dc6cda374384efa70492539bd4e7cd"}, "originalPosition": 25}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MjkwNDMwMQ==", "bodyText": "Is there any specific scenario that causes this comment to appear here? I will review BFD \"reportiong\" tools one more time.", "url": "https://github.com/telstra/open-kilda/pull/3712#discussion_r492904301", "createdAt": "2020-09-22T17:17:10Z", "author": {"login": "surabujin"}, "path": "src-java/kilda-model/src/main/java/org/openkilda/model/Isl.java", "diffHunk": "@@ -116,9 +117,17 @@\n     @Property(name = \"under_maintenance\")\n     private boolean underMaintenance;\n \n+    // TODO(surabujin): drop after migration\n     @Property(name = \"enable_bfd\")\n     private boolean enableBfd;\n \n+    @Property(\"bfd_interval\")\n+    @Convert(graphPropertyType = Long.class)\n+    private Duration bfdInterval;\n+\n+    @Property(\"bfd_multiplier\")\n+    private short bfdMultiplier;\n+\n     @Property(name = \"bfd_session_status\")\n     @Convert(graphPropertyType = String.class)\n     private BfdSessionStatus bfdSessionStatus;", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NjQwMzAzMQ=="}, "originalCommit": {"oid": "2c662bd120dc6cda374384efa70492539bd4e7cd"}, "originalPosition": 25}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzA0MjU0MTYwOnYy", "diffSide": "RIGHT", "path": "src-java/network-topology/network-storm-topology/src/test/java/org/openkilda/wfm/topology/network/controller/bfd/AbstractBfdActionTest.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xMFQxNDo1Njo0NVrOHP4MSA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yMlQxNzoyMjo1MFrOHWEtpw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NjQxMTMzNg==", "bodyText": "Why did you use literals?", "url": "https://github.com/telstra/open-kilda/pull/3712#discussion_r486411336", "createdAt": "2020-09-10T14:56:45Z", "author": {"login": "nikitamarchenko"}, "path": "src-java/network-topology/network-storm-topology/src/test/java/org/openkilda/wfm/topology/network/controller/bfd/AbstractBfdActionTest.java", "diffHunk": "@@ -45,8 +45,8 @@\n             .logicalPortNumber(alphaLogicalEndpoint.getPortNumber())\n             .udpPortNumber(BfdPortFsm.BFD_UDP_PORT)\n             .discriminator(1001)\n-            .intervalMs(BfdPortFsm.bfdPollInterval)\n-            .multiplier(BfdPortFsm.bfdFailCycleLimit)\n+            .intervalMs(350)", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "2c662bd120dc6cda374384efa70492539bd4e7cd"}, "originalPosition": 6}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MjkwNzk0Mw==", "bodyText": "Because there are no(since this commit) corresponding constants that keep default values for these fields and because this is the test object.", "url": "https://github.com/telstra/open-kilda/pull/3712#discussion_r492907943", "createdAt": "2020-09-22T17:22:50Z", "author": {"login": "surabujin"}, "path": "src-java/network-topology/network-storm-topology/src/test/java/org/openkilda/wfm/topology/network/controller/bfd/AbstractBfdActionTest.java", "diffHunk": "@@ -45,8 +45,8 @@\n             .logicalPortNumber(alphaLogicalEndpoint.getPortNumber())\n             .udpPortNumber(BfdPortFsm.BFD_UDP_PORT)\n             .discriminator(1001)\n-            .intervalMs(BfdPortFsm.bfdPollInterval)\n-            .multiplier(BfdPortFsm.bfdFailCycleLimit)\n+            .intervalMs(350)", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NjQxMTMzNg=="}, "originalCommit": {"oid": "2c662bd120dc6cda374384efa70492539bd4e7cd"}, "originalPosition": 6}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzA0MjcyNTQ3OnYy", "diffSide": "RIGHT", "path": "src-java/northbound-service/northbound/src/main/java/org/openkilda/northbound/controller/v2/LinkControllerV2.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xMFQxNTozNjoyOFrOHP5_kQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yMlQxNzoyNDozNFrOHWEx6A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NjQ0MDg0OQ==", "bodyText": "Not sure about that format.", "url": "https://github.com/telstra/open-kilda/pull/3712#discussion_r486440849", "createdAt": "2020-09-10T15:36:28Z", "author": {"login": "nikitamarchenko"}, "path": "src-java/northbound-service/northbound/src/main/java/org/openkilda/northbound/controller/v2/LinkControllerV2.java", "diffHunk": "@@ -0,0 +1,127 @@\n+/* Copyright 2020 Telstra Open Source\n+ *\n+ *   Licensed under the Apache License, Version 2.0 (the \"License\");\n+ *   you may not use this file except in compliance with the License.\n+ *   You may obtain a copy of the License at\n+ *\n+ *       http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ *   Unless required by applicable law or agreed to in writing, software\n+ *   distributed under the License is distributed on an \"AS IS\" BASIS,\n+ *   WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ *   See the License for the specific language governing permissions and\n+ *   limitations under the License.\n+ */\n+\n+package org.openkilda.northbound.controller.v2;\n+\n+import org.openkilda.messaging.model.NetworkEndpoint;\n+import org.openkilda.model.SwitchId;\n+import org.openkilda.northbound.controller.BaseLinkController;\n+import org.openkilda.northbound.dto.v2.links.BfdProperties;\n+import org.openkilda.northbound.dto.v2.links.BfdPropertiesPayload;\n+import org.openkilda.northbound.service.LinkService;\n+\n+import io.swagger.annotations.ApiOperation;\n+import org.springframework.http.HttpStatus;\n+import org.springframework.web.bind.annotation.DeleteMapping;\n+import org.springframework.web.bind.annotation.GetMapping;\n+import org.springframework.web.bind.annotation.PathVariable;\n+import org.springframework.web.bind.annotation.PutMapping;\n+import org.springframework.web.bind.annotation.RequestBody;\n+import org.springframework.web.bind.annotation.RequestMapping;\n+import org.springframework.web.bind.annotation.ResponseStatus;\n+import org.springframework.web.bind.annotation.RestController;\n+\n+import java.util.Objects;\n+import java.util.Optional;\n+import java.util.concurrent.CompletableFuture;\n+import java.util.stream.Stream;\n+\n+@RestController\n+@RequestMapping(\"/v2/links\")\n+public class LinkControllerV2 extends BaseLinkController {\n+    private static final int BFD_INTERVAL_MIN = 100;\n+    private static final short BFD_MULTIPLIER_MIN = 1;\n+\n+    private final LinkService linkService;\n+\n+    public LinkControllerV2(LinkService linkService) {\n+        this.linkService = linkService;\n+    }\n+\n+    /**\n+     * Write/update/enable BFD properties for specific ISL.\n+     */\n+    @ApiOperation(value = \"Set/update BFD properties\", response = BfdPropertiesPayload.class)\n+    @PutMapping(value = \"/{src-switch}_{src-port}/{dst-switch}_{dst-port}/bfd\")", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "2c662bd120dc6cda374384efa70492539bd4e7cd"}, "originalPosition": 57}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MjkwOTAzMg==", "bodyText": "I am open to propositions. .../src switch/src port/dst switch/dst_port/... is worse as for me.", "url": "https://github.com/telstra/open-kilda/pull/3712#discussion_r492909032", "createdAt": "2020-09-22T17:24:34Z", "author": {"login": "surabujin"}, "path": "src-java/northbound-service/northbound/src/main/java/org/openkilda/northbound/controller/v2/LinkControllerV2.java", "diffHunk": "@@ -0,0 +1,127 @@\n+/* Copyright 2020 Telstra Open Source\n+ *\n+ *   Licensed under the Apache License, Version 2.0 (the \"License\");\n+ *   you may not use this file except in compliance with the License.\n+ *   You may obtain a copy of the License at\n+ *\n+ *       http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ *   Unless required by applicable law or agreed to in writing, software\n+ *   distributed under the License is distributed on an \"AS IS\" BASIS,\n+ *   WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ *   See the License for the specific language governing permissions and\n+ *   limitations under the License.\n+ */\n+\n+package org.openkilda.northbound.controller.v2;\n+\n+import org.openkilda.messaging.model.NetworkEndpoint;\n+import org.openkilda.model.SwitchId;\n+import org.openkilda.northbound.controller.BaseLinkController;\n+import org.openkilda.northbound.dto.v2.links.BfdProperties;\n+import org.openkilda.northbound.dto.v2.links.BfdPropertiesPayload;\n+import org.openkilda.northbound.service.LinkService;\n+\n+import io.swagger.annotations.ApiOperation;\n+import org.springframework.http.HttpStatus;\n+import org.springframework.web.bind.annotation.DeleteMapping;\n+import org.springframework.web.bind.annotation.GetMapping;\n+import org.springframework.web.bind.annotation.PathVariable;\n+import org.springframework.web.bind.annotation.PutMapping;\n+import org.springframework.web.bind.annotation.RequestBody;\n+import org.springframework.web.bind.annotation.RequestMapping;\n+import org.springframework.web.bind.annotation.ResponseStatus;\n+import org.springframework.web.bind.annotation.RestController;\n+\n+import java.util.Objects;\n+import java.util.Optional;\n+import java.util.concurrent.CompletableFuture;\n+import java.util.stream.Stream;\n+\n+@RestController\n+@RequestMapping(\"/v2/links\")\n+public class LinkControllerV2 extends BaseLinkController {\n+    private static final int BFD_INTERVAL_MIN = 100;\n+    private static final short BFD_MULTIPLIER_MIN = 1;\n+\n+    private final LinkService linkService;\n+\n+    public LinkControllerV2(LinkService linkService) {\n+        this.linkService = linkService;\n+    }\n+\n+    /**\n+     * Write/update/enable BFD properties for specific ISL.\n+     */\n+    @ApiOperation(value = \"Set/update BFD properties\", response = BfdPropertiesPayload.class)\n+    @PutMapping(value = \"/{src-switch}_{src-port}/{dst-switch}_{dst-port}/bfd\")", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NjQ0MDg0OQ=="}, "originalCommit": {"oid": "2c662bd120dc6cda374384efa70492539bd4e7cd"}, "originalPosition": 57}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzA0NTQ0MTMwOnYy", "diffSide": "RIGHT", "path": "services/src/neo4j/migrations/1.26-per-isl-bfd-properties/1-per-idl-bfd-properties.xml", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xMVQwODozNDo0MFrOHQTo5Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yMlQxNzoyNDo0NVrOHWEySw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4Njg2MTAyOQ==", "bodyText": "s.port - 1000", "url": "https://github.com/telstra/open-kilda/pull/3712#discussion_r486861029", "createdAt": "2020-09-11T08:34:40Z", "author": {"login": "rtretyak"}, "path": "services/src/neo4j/migrations/1.26-per-isl-bfd-properties/1-per-idl-bfd-properties.xml", "diffHunk": "@@ -0,0 +1,19 @@\n+<?xml version=\"1.0\" encoding=\"UTF-8\"?>\n+<changelog xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\"\n+           xsi:noNamespaceSchemaLocation=\"http://www.liquigraph.org/schema/1.0/liquigraph.xsd\">\n+    <changeset id=\"1.26-bfd-session-update\" author=\"Dmitry Bogun\">\n+        <query><![CDATA[\n+             MATCH (s:bfd_session) WHERE NOT exists(s.physical_port)\n+             SET s.physical_port = s.port - 100,", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "2c662bd120dc6cda374384efa70492539bd4e7cd"}, "originalPosition": 7}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MjkwOTEzMQ==", "bodyText": "fixed", "url": "https://github.com/telstra/open-kilda/pull/3712#discussion_r492909131", "createdAt": "2020-09-22T17:24:45Z", "author": {"login": "surabujin"}, "path": "services/src/neo4j/migrations/1.26-per-isl-bfd-properties/1-per-idl-bfd-properties.xml", "diffHunk": "@@ -0,0 +1,19 @@\n+<?xml version=\"1.0\" encoding=\"UTF-8\"?>\n+<changelog xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\"\n+           xsi:noNamespaceSchemaLocation=\"http://www.liquigraph.org/schema/1.0/liquigraph.xsd\">\n+    <changeset id=\"1.26-bfd-session-update\" author=\"Dmitry Bogun\">\n+        <query><![CDATA[\n+             MATCH (s:bfd_session) WHERE NOT exists(s.physical_port)\n+             SET s.physical_port = s.port - 100,", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4Njg2MTAyOQ=="}, "originalCommit": {"oid": "2c662bd120dc6cda374384efa70492539bd4e7cd"}, "originalPosition": 7}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzA2MTU2MTI0OnYy", "diffSide": "RIGHT", "path": "src-java/northbound-service/northbound/src/main/java/org/openkilda/northbound/service/impl/LinkServiceImpl.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xNlQwOTozNjo1MVrOHSoptA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yMlQxNzoyNDo1NFrOHWEyrw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4OTMwMjQ1Mg==", "bodyText": "as for me, it is a little bit unusual that the ed ending is missing (ed -> disabled). we almost everywhere(except roundTrip) use the ed ending (i.e. failed, activated, discovered)", "url": "https://github.com/telstra/open-kilda/pull/3712#discussion_r489302452", "createdAt": "2020-09-16T09:36:51Z", "author": {"login": "andriidovhan"}, "path": "src-java/northbound-service/northbound/src/main/java/org/openkilda/northbound/service/impl/LinkServiceImpl.java", "diffHunk": "@@ -324,32 +346,87 @@ private BatchResults getLinkPropsResult(List<LinkPropsResponse> responses, List<\n         return messagingChannel.sendAndGetChunked(nbworkerTopic, message)\n                 .thenApply(response -> response.stream()\n                         .map(IslInfoData.class::cast)\n-                        .map(linkMapper::toLinkDto)\n+                        .map(linkMapper::responseMap)\n                         .collect(Collectors.toList()));\n     }\n \n     @Override\n-    public CompletableFuture<List<LinkDto>> updateLinkEnableBfd(LinkEnableBfdDto link) {\n+    public CompletableFuture<List<LinkDto>> bfdPropertiesWrite(\n+            NetworkEndpoint source, NetworkEndpoint dest, boolean isEnabled) {\n+        BfdProperties properties;\n+        if (isEnabled) {\n+            properties = bfdPropertiesDefault;\n+        } else {\n+            properties = BfdProperties.DISABLE;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "2c662bd120dc6cda374384efa70492539bd4e7cd"}, "originalPosition": 109}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MjkwOTIzMQ==", "bodyText": "renamed", "url": "https://github.com/telstra/open-kilda/pull/3712#discussion_r492909231", "createdAt": "2020-09-22T17:24:54Z", "author": {"login": "surabujin"}, "path": "src-java/northbound-service/northbound/src/main/java/org/openkilda/northbound/service/impl/LinkServiceImpl.java", "diffHunk": "@@ -324,32 +346,87 @@ private BatchResults getLinkPropsResult(List<LinkPropsResponse> responses, List<\n         return messagingChannel.sendAndGetChunked(nbworkerTopic, message)\n                 .thenApply(response -> response.stream()\n                         .map(IslInfoData.class::cast)\n-                        .map(linkMapper::toLinkDto)\n+                        .map(linkMapper::responseMap)\n                         .collect(Collectors.toList()));\n     }\n \n     @Override\n-    public CompletableFuture<List<LinkDto>> updateLinkEnableBfd(LinkEnableBfdDto link) {\n+    public CompletableFuture<List<LinkDto>> bfdPropertiesWrite(\n+            NetworkEndpoint source, NetworkEndpoint dest, boolean isEnabled) {\n+        BfdProperties properties;\n+        if (isEnabled) {\n+            properties = bfdPropertiesDefault;\n+        } else {\n+            properties = BfdProperties.DISABLE;", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4OTMwMjQ1Mg=="}, "originalCommit": {"oid": "2c662bd120dc6cda374384efa70492539bd4e7cd"}, "originalPosition": 109}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzEwNzkwNTU2OnYy", "diffSide": "RIGHT", "path": "src-java/kilda-model/src/main/java/org/openkilda/model/BfdProperties.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yOVQwNjo0NzoyOVrOHZdL6A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yOVQwNzoxNDo1MFrOHZeA9A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NjQ1NDYzMg==", "bodyText": "I wouldn't use Duration here, it force to create new db converter(converters in our case not the most reliable thing ever),\nmappers, etc. While the actual usage of it as duration is made in single place only", "url": "https://github.com/telstra/open-kilda/pull/3712#discussion_r496454632", "createdAt": "2020-09-29T06:47:29Z", "author": {"login": "timofei-durakov"}, "path": "src-java/kilda-model/src/main/java/org/openkilda/model/BfdProperties.java", "diffHunk": "@@ -0,0 +1,55 @@\n+/* Copyright 2020 Telstra Open Source\n+ *\n+ *   Licensed under the Apache License, Version 2.0 (the \"License\");\n+ *   you may not use this file except in compliance with the License.\n+ *   You may obtain a copy of the License at\n+ *\n+ *       http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ *   Unless required by applicable law or agreed to in writing, software\n+ *   distributed under the License is distributed on an \"AS IS\" BASIS,\n+ *   WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ *   See the License for the specific language governing permissions and\n+ *   limitations under the License.\n+ */\n+\n+package org.openkilda.model;\n+\n+import com.fasterxml.jackson.annotation.JsonIgnore;\n+import com.fasterxml.jackson.annotation.JsonProperty;\n+import lombok.Builder;\n+import lombok.EqualsAndHashCode;\n+import lombok.Getter;\n+import lombok.ToString;\n+\n+import java.time.Duration;\n+\n+@Getter\n+@ToString\n+@EqualsAndHashCode\n+public class BfdProperties {\n+    @JsonProperty(\"interval\")\n+    protected final Duration interval;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "582fa87d03afea66dc2a944a365a0b58afa78214"}, "originalPosition": 32}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NjQ2ODIxMg==", "bodyText": "This is the easiest and simple way to store time duration in an unambiguous way.\nRegarding issues with converters - first point - we are going to move out neo4j soon enough, the second we do not have a clear vision where the issue and is there any relation to the number of converters. So I don't see the reason to not use proper/handy data types in our model.\nRegarding mappers - all other codebase uses Duration for this field, so if we use a different type here we must use mappers too.", "url": "https://github.com/telstra/open-kilda/pull/3712#discussion_r496468212", "createdAt": "2020-09-29T07:14:50Z", "author": {"login": "surabujin"}, "path": "src-java/kilda-model/src/main/java/org/openkilda/model/BfdProperties.java", "diffHunk": "@@ -0,0 +1,55 @@\n+/* Copyright 2020 Telstra Open Source\n+ *\n+ *   Licensed under the Apache License, Version 2.0 (the \"License\");\n+ *   you may not use this file except in compliance with the License.\n+ *   You may obtain a copy of the License at\n+ *\n+ *       http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ *   Unless required by applicable law or agreed to in writing, software\n+ *   distributed under the License is distributed on an \"AS IS\" BASIS,\n+ *   WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ *   See the License for the specific language governing permissions and\n+ *   limitations under the License.\n+ */\n+\n+package org.openkilda.model;\n+\n+import com.fasterxml.jackson.annotation.JsonIgnore;\n+import com.fasterxml.jackson.annotation.JsonProperty;\n+import lombok.Builder;\n+import lombok.EqualsAndHashCode;\n+import lombok.Getter;\n+import lombok.ToString;\n+\n+import java.time.Duration;\n+\n+@Getter\n+@ToString\n+@EqualsAndHashCode\n+public class BfdProperties {\n+    @JsonProperty(\"interval\")\n+    protected final Duration interval;", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NjQ1NDYzMg=="}, "originalCommit": {"oid": "582fa87d03afea66dc2a944a365a0b58afa78214"}, "originalPosition": 32}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzEyMTY0MDQ5OnYy", "diffSide": "RIGHT", "path": "src-java/kilda-model/src/main/java/org/openkilda/model/Isl.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wMlQwNjoyMzo1MFrOHbiRGw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wMlQwODozNjo0MVrOHblhZw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5ODYzNTAzNQ==", "bodyText": "should we add new fields into toString() method? or just remove toString() to generate it by @Data?", "url": "https://github.com/telstra/open-kilda/pull/3712#discussion_r498635035", "createdAt": "2020-10-02T06:23:50Z", "author": {"login": "niksv"}, "path": "src-java/kilda-model/src/main/java/org/openkilda/model/Isl.java", "diffHunk": "@@ -116,9 +117,17 @@\n     @Property(name = \"under_maintenance\")\n     private boolean underMaintenance;\n \n+    // TODO(surabujin): drop after migration\n     @Property(name = \"enable_bfd\")\n     private boolean enableBfd;\n \n+    @Property(\"bfd_interval\")\n+    @Convert(graphPropertyType = Long.class)\n+    private Duration bfdInterval;\n+\n+    @Property(\"bfd_multiplier\")\n+    private short bfdMultiplier;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "1aad686c977a796ff687e5b158fa55b0eef21167"}, "originalPosition": 21}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5ODY4ODM1OQ==", "bodyText": "Can't say for sure.\nLooks like .toString() include a brief and only most important view of Isl object. Added fields do not part of the most important fields of Isl object, from my point of view. I would like not to include them in the .toString() view now.", "url": "https://github.com/telstra/open-kilda/pull/3712#discussion_r498688359", "createdAt": "2020-10-02T08:36:41Z", "author": {"login": "surabujin"}, "path": "src-java/kilda-model/src/main/java/org/openkilda/model/Isl.java", "diffHunk": "@@ -116,9 +117,17 @@\n     @Property(name = \"under_maintenance\")\n     private boolean underMaintenance;\n \n+    // TODO(surabujin): drop after migration\n     @Property(name = \"enable_bfd\")\n     private boolean enableBfd;\n \n+    @Property(\"bfd_interval\")\n+    @Convert(graphPropertyType = Long.class)\n+    private Duration bfdInterval;\n+\n+    @Property(\"bfd_multiplier\")\n+    private short bfdMultiplier;", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5ODYzNTAzNQ=="}, "originalCommit": {"oid": "1aad686c977a796ff687e5b158fa55b0eef21167"}, "originalPosition": 21}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1821, "cost": 1, "resetAt": "2021-11-13T14:23:39Z"}}}