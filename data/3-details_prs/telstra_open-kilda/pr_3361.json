{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0Mzk3NzIzNzQ3", "number": 3361, "title": "Add inner vlan tag field into APIv2 requests/responses", "bodyText": "", "createdAt": "2020-04-02T17:41:31Z", "url": "https://github.com/telstra/open-kilda/pull/3361", "merged": true, "mergeCommit": {"oid": "bfa1f8c5c21f5403a219df308a9c702e4e93a407"}, "closed": true, "closedAt": "2020-05-18T12:58:41Z", "author": {"login": "surabujin"}, "timelineItems": {"totalCount": 26, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcT6RNWAFqTM4Njk0NjAzMQ==", "endCursor": "Y3Vyc29yOnYyOpPPAAABchPuaLgFqTQxMTk1Njk0Mg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzg2OTQ2MDMx", "url": "https://github.com/telstra/open-kilda/pull/3361#pullrequestreview-386946031", "createdAt": "2020-04-03T05:31:02Z", "commit": {"oid": "162ca92ab0be1f5294bf029a3b4374d21d2b327c"}, "state": "COMMENTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wM1QwNTozMTowMlrOGAFmbw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wM1QwNTozMTo1MVrOGAFnJg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMjc0NDk0Mw==", "bodyText": "empty line", "url": "https://github.com/telstra/open-kilda/pull/3361#discussion_r402744943", "createdAt": "2020-04-03T05:31:02Z", "author": {"login": "niksv"}, "path": "src-java/base-topology/base-messaging/src/main/java/org/openkilda/messaging/payload/flow/FlowEndpointPayload.java", "diffHunk": "@@ -64,35 +72,22 @@\n     public FlowEndpointPayload(@JsonProperty(\"switch-id\") SwitchId switchId,\n                                @JsonProperty(\"port-id\") Integer portId,\n                                @JsonProperty(\"vlan-id\") Integer vlanId,\n+                               @JsonProperty(\"inner-vlan-id\") Integer innerVlanId,\n                                @JsonProperty(\"detect-connected-devices\")\n                                            DetectConnectedDevicesPayload detectConnectedDevices) {\n         super(switchId, portId);\n         setVlanId(vlanId);\n+        setInnerVlanId(innerVlanId);\n+", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "162ca92ab0be1f5294bf029a3b4374d21d2b327c"}, "originalPosition": 47}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMjc0NTEyNg==", "bodyText": "please add inner vlan into toString() and into hashCode()", "url": "https://github.com/telstra/open-kilda/pull/3361#discussion_r402745126", "createdAt": "2020-04-03T05:31:51Z", "author": {"login": "niksv"}, "path": "src-java/base-topology/base-messaging/src/main/java/org/openkilda/messaging/payload/flow/FlowEndpointPayload.java", "diffHunk": "@@ -149,4 +144,15 @@ public String toString() {\n                 .add(\"detect-connected-devices\", detectConnectedDevices)", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "162ca92ab0be1f5294bf029a3b4374d21d2b327c"}, "originalPosition": 81}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "162ca92ab0be1f5294bf029a3b4374d21d2b327c", "author": {"user": {"login": "surabujin", "name": "Dmitriy Bogun"}}, "url": "https://github.com/telstra/open-kilda/commit/162ca92ab0be1f5294bf029a3b4374d21d2b327c", "committedDate": "2020-04-02T17:09:15Z", "message": "Add inner vlan tag field into APIv2 requests/responses"}, "afterCommit": {"oid": "f38835dcb44e1c9982fcf6e014a9e3c141ad3ecf", "author": {"user": {"login": "surabujin", "name": "Dmitriy Bogun"}}, "url": "https://github.com/telstra/open-kilda/commit/f38835dcb44e1c9982fcf6e014a9e3c141ad3ecf", "committedDate": "2020-04-06T16:17:37Z", "message": "Add inner vlan tag field into APIv2 requests/responses"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "f38835dcb44e1c9982fcf6e014a9e3c141ad3ecf", "author": {"user": {"login": "surabujin", "name": "Dmitriy Bogun"}}, "url": "https://github.com/telstra/open-kilda/commit/f38835dcb44e1c9982fcf6e014a9e3c141ad3ecf", "committedDate": "2020-04-06T16:17:37Z", "message": "Add inner vlan tag field into APIv2 requests/responses"}, "afterCommit": {"oid": "0704f40c9c951ae0c93aa7ecc77002fac01fe499", "author": {"user": {"login": "surabujin", "name": "Dmitriy Bogun"}}, "url": "https://github.com/telstra/open-kilda/commit/0704f40c9c951ae0c93aa7ecc77002fac01fe499", "committedDate": "2020-04-07T13:27:36Z", "message": "Add inner vlan tag field into APIv2 requests/responses"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "0704f40c9c951ae0c93aa7ecc77002fac01fe499", "author": {"user": {"login": "surabujin", "name": "Dmitriy Bogun"}}, "url": "https://github.com/telstra/open-kilda/commit/0704f40c9c951ae0c93aa7ecc77002fac01fe499", "committedDate": "2020-04-07T13:27:36Z", "message": "Add inner vlan tag field into APIv2 requests/responses"}, "afterCommit": {"oid": "6266bb43f051e1b9ec1761d3f40bdcc13e25649f", "author": {"user": {"login": "surabujin", "name": "Dmitriy Bogun"}}, "url": "https://github.com/telstra/open-kilda/commit/6266bb43f051e1b9ec1761d3f40bdcc13e25649f", "committedDate": "2020-04-08T08:52:40Z", "message": "Add inner vlan tag field into APIv2 requests/responses"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzg5ODA2NDgx", "url": "https://github.com/telstra/open-kilda/pull/3361#pullrequestreview-389806481", "createdAt": "2020-04-08T09:31:23Z", "commit": {"oid": "6266bb43f051e1b9ec1761d3f40bdcc13e25649f"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzk3ODExMjk1", "url": "https://github.com/telstra/open-kilda/pull/3361#pullrequestreview-397811295", "createdAt": "2020-04-22T03:07:08Z", "commit": {"oid": "6266bb43f051e1b9ec1761d3f40bdcc13e25649f"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yMlQwMzowNzowOFrOGJhP3Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yMlQwMzowNzowOFrOGJhP3Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMjYzNTEwMQ==", "bodyText": "Should we declare \"src_inner_vlan\" and \"dst_inner_vlan\" using a wrapper class instead of the primitive to allow setting null values?", "url": "https://github.com/telstra/open-kilda/pull/3361#discussion_r412635101", "createdAt": "2020-04-22T03:07:08Z", "author": {"login": "sergii-iakovenko"}, "path": "src-java/base-topology/base-messaging/src/main/java/org/openkilda/messaging/model/FlowDto.java", "diffHunk": "@@ -299,7 +309,7 @@ public FlowDto(String flowId,\n                 sourcePort,\n                 destinationPort,\n                 sourceVlan,\n-                destinationVlan,\n+                destinationVlan, 0, 0,", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "6266bb43f051e1b9ec1761d3f40bdcc13e25649f"}, "originalPosition": 36}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "6266bb43f051e1b9ec1761d3f40bdcc13e25649f", "author": {"user": {"login": "surabujin", "name": "Dmitriy Bogun"}}, "url": "https://github.com/telstra/open-kilda/commit/6266bb43f051e1b9ec1761d3f40bdcc13e25649f", "committedDate": "2020-04-08T08:52:40Z", "message": "Add inner vlan tag field into APIv2 requests/responses"}, "afterCommit": {"oid": "b975c811d144e79053bf079dc3bb108a8cbe3c18", "author": {"user": {"login": "surabujin", "name": "Dmitriy Bogun"}}, "url": "https://github.com/telstra/open-kilda/commit/b975c811d144e79053bf079dc3bb108a8cbe3c18", "committedDate": "2020-04-29T07:39:19Z", "message": "Add inner vlan tag field into APIv2 requests/responses"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "b975c811d144e79053bf079dc3bb108a8cbe3c18", "author": {"user": {"login": "surabujin", "name": "Dmitriy Bogun"}}, "url": "https://github.com/telstra/open-kilda/commit/b975c811d144e79053bf079dc3bb108a8cbe3c18", "committedDate": "2020-04-29T07:39:19Z", "message": "Add inner vlan tag field into APIv2 requests/responses"}, "afterCommit": {"oid": "fa19978f89a2aa3bdcf46bc5e7b41fcf875f9de6", "author": {"user": {"login": "surabujin", "name": "Dmitriy Bogun"}}, "url": "https://github.com/telstra/open-kilda/commit/fa19978f89a2aa3bdcf46bc5e7b41fcf875f9de6", "committedDate": "2020-05-02T08:34:54Z", "message": "Add inner vlan tag field into APIv2 requests/responses"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "fa19978f89a2aa3bdcf46bc5e7b41fcf875f9de6", "author": {"user": {"login": "surabujin", "name": "Dmitriy Bogun"}}, "url": "https://github.com/telstra/open-kilda/commit/fa19978f89a2aa3bdcf46bc5e7b41fcf875f9de6", "committedDate": "2020-05-02T08:34:54Z", "message": "Add inner vlan tag field into APIv2 requests/responses"}, "afterCommit": {"oid": "fd13a6124c7a3417132263f177a25041216b5e62", "author": {"user": {"login": "surabujin", "name": "Dmitriy Bogun"}}, "url": "https://github.com/telstra/open-kilda/commit/fd13a6124c7a3417132263f177a25041216b5e62", "committedDate": "2020-05-04T13:27:50Z", "message": "Add inner vlan tag field into APIv2 requests/responses"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "fd13a6124c7a3417132263f177a25041216b5e62", "author": {"user": {"login": "surabujin", "name": "Dmitriy Bogun"}}, "url": "https://github.com/telstra/open-kilda/commit/fd13a6124c7a3417132263f177a25041216b5e62", "committedDate": "2020-05-04T13:27:50Z", "message": "Add inner vlan tag field into APIv2 requests/responses"}, "afterCommit": {"oid": "0dc6684b6450524608e07c2239d56226bab95b37", "author": {"user": {"login": "surabujin", "name": "Dmitriy Bogun"}}, "url": "https://github.com/telstra/open-kilda/commit/0dc6684b6450524608e07c2239d56226bab95b37", "committedDate": "2020-05-04T13:40:44Z", "message": "Add inner vlan tag field into APIv2 requests/responses"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "0dc6684b6450524608e07c2239d56226bab95b37", "author": {"user": {"login": "surabujin", "name": "Dmitriy Bogun"}}, "url": "https://github.com/telstra/open-kilda/commit/0dc6684b6450524608e07c2239d56226bab95b37", "committedDate": "2020-05-04T13:40:44Z", "message": "Add inner vlan tag field into APIv2 requests/responses"}, "afterCommit": {"oid": "1eda51f333c8b2ed6bc261d18d20be8293621906", "author": {"user": {"login": "surabujin", "name": "Dmitriy Bogun"}}, "url": "https://github.com/telstra/open-kilda/commit/1eda51f333c8b2ed6bc261d18d20be8293621906", "committedDate": "2020-05-04T14:28:49Z", "message": "Add inner vlan tag field into APIv2 requests/responses"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "1eda51f333c8b2ed6bc261d18d20be8293621906", "author": {"user": {"login": "surabujin", "name": "Dmitriy Bogun"}}, "url": "https://github.com/telstra/open-kilda/commit/1eda51f333c8b2ed6bc261d18d20be8293621906", "committedDate": "2020-05-04T14:28:49Z", "message": "Add inner vlan tag field into APIv2 requests/responses"}, "afterCommit": {"oid": "139f77ba5b3aa11223ced1a3879d8d024a17f4f0", "author": {"user": {"login": "surabujin", "name": "Dmitriy Bogun"}}, "url": "https://github.com/telstra/open-kilda/commit/139f77ba5b3aa11223ced1a3879d8d024a17f4f0", "committedDate": "2020-05-04T14:57:10Z", "message": "Add inner vlan tag field into APIv2 requests/responses"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "139f77ba5b3aa11223ced1a3879d8d024a17f4f0", "author": {"user": {"login": "surabujin", "name": "Dmitriy Bogun"}}, "url": "https://github.com/telstra/open-kilda/commit/139f77ba5b3aa11223ced1a3879d8d024a17f4f0", "committedDate": "2020-05-04T14:57:10Z", "message": "Add inner vlan tag field into APIv2 requests/responses"}, "afterCommit": {"oid": "4110d6048b1bb972604e5d577d06237d5d321946", "author": {"user": {"login": "surabujin", "name": "Dmitriy Bogun"}}, "url": "https://github.com/telstra/open-kilda/commit/4110d6048b1bb972604e5d577d06237d5d321946", "committedDate": "2020-05-04T18:09:46Z", "message": "Add inner vlan tag field into APIv2 requests/responses"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "4110d6048b1bb972604e5d577d06237d5d321946", "author": {"user": {"login": "surabujin", "name": "Dmitriy Bogun"}}, "url": "https://github.com/telstra/open-kilda/commit/4110d6048b1bb972604e5d577d06237d5d321946", "committedDate": "2020-05-04T18:09:46Z", "message": "Add inner vlan tag field into APIv2 requests/responses"}, "afterCommit": {"oid": "69c032d84eb0383f3f1b74458a0a99c0633b534f", "author": {"user": {"login": "surabujin", "name": "Dmitriy Bogun"}}, "url": "https://github.com/telstra/open-kilda/commit/69c032d84eb0383f3f1b74458a0a99c0633b534f", "committedDate": "2020-05-05T10:08:18Z", "message": "Add inner vlan tag field into APIv2 requests/responses"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "69c032d84eb0383f3f1b74458a0a99c0633b534f", "author": {"user": {"login": "surabujin", "name": "Dmitriy Bogun"}}, "url": "https://github.com/telstra/open-kilda/commit/69c032d84eb0383f3f1b74458a0a99c0633b534f", "committedDate": "2020-05-05T10:08:18Z", "message": "Add inner vlan tag field into APIv2 requests/responses"}, "afterCommit": {"oid": "15d07214296a6d2ebfe3a59a0b4f510d5a9327e1", "author": {"user": {"login": "surabujin", "name": "Dmitriy Bogun"}}, "url": "https://github.com/telstra/open-kilda/commit/15d07214296a6d2ebfe3a59a0b4f510d5a9327e1", "committedDate": "2020-05-05T10:12:47Z", "message": "Add inner vlan tag field into APIv2 requests/responses"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "15d07214296a6d2ebfe3a59a0b4f510d5a9327e1", "author": {"user": {"login": "surabujin", "name": "Dmitriy Bogun"}}, "url": "https://github.com/telstra/open-kilda/commit/15d07214296a6d2ebfe3a59a0b4f510d5a9327e1", "committedDate": "2020-05-05T10:12:47Z", "message": "Add inner vlan tag field into APIv2 requests/responses"}, "afterCommit": {"oid": "dc92f62410b41ca29ae01b83f534fdcb7bc06958", "author": {"user": {"login": "surabujin", "name": "Dmitriy Bogun"}}, "url": "https://github.com/telstra/open-kilda/commit/dc92f62410b41ca29ae01b83f534fdcb7bc06958", "committedDate": "2020-05-06T17:09:12Z", "message": "Add inner vlan tag field into APIv2 requests/responses"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "90240abed1e85c9fd3ff469a11d55d66a822f0e9", "author": {"user": {"login": "surabujin", "name": "Dmitriy Bogun"}}, "url": "https://github.com/telstra/open-kilda/commit/90240abed1e85c9fd3ff469a11d55d66a822f0e9", "committedDate": "2020-05-07T07:16:46Z", "message": "(do-not-push)"}, "afterCommit": {"oid": "f2ea4ef8af5c8b62c5f130edcef5767a250e21e7", "author": {"user": {"login": "andriidovhan", "name": "AndriiDovhan"}}, "url": "https://github.com/telstra/open-kilda/commit/f2ea4ef8af5c8b62c5f130edcef5767a250e21e7", "committedDate": "2020-05-07T10:04:52Z", "message": "(do-not-push) fix swap protected path in multiTableFlow spec"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "f2ea4ef8af5c8b62c5f130edcef5767a250e21e7", "author": {"user": {"login": "andriidovhan", "name": "AndriiDovhan"}}, "url": "https://github.com/telstra/open-kilda/commit/f2ea4ef8af5c8b62c5f130edcef5767a250e21e7", "committedDate": "2020-05-07T10:04:52Z", "message": "(do-not-push) fix swap protected path in multiTableFlow spec"}, "afterCommit": {"oid": "6dfdb8c5ee4f35fb6d860c0e243ffa5772446452", "author": {"user": {"login": "surabujin", "name": "Dmitriy Bogun"}}, "url": "https://github.com/telstra/open-kilda/commit/6dfdb8c5ee4f35fb6d860c0e243ffa5772446452", "committedDate": "2020-05-07T15:49:16Z", "message": "Add inner vlan tag field into APIv2 requests/responses"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "6dfdb8c5ee4f35fb6d860c0e243ffa5772446452", "author": {"user": {"login": "surabujin", "name": "Dmitriy Bogun"}}, "url": "https://github.com/telstra/open-kilda/commit/6dfdb8c5ee4f35fb6d860c0e243ffa5772446452", "committedDate": "2020-05-07T15:49:16Z", "message": "Add inner vlan tag field into APIv2 requests/responses"}, "afterCommit": {"oid": "8a223d5fa8958168af322cce02842d1bd1258c2b", "author": {"user": {"login": "surabujin", "name": "Dmitriy Bogun"}}, "url": "https://github.com/telstra/open-kilda/commit/8a223d5fa8958168af322cce02842d1bd1258c2b", "committedDate": "2020-05-07T16:33:35Z", "message": "Add inner vlan tag field into APIv2 requests/responses"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDA5OTk3Mzg5", "url": "https://github.com/telstra/open-kilda/pull/3361#pullrequestreview-409997389", "createdAt": "2020-05-12T12:39:23Z", "commit": {"oid": "8a223d5fa8958168af322cce02842d1bd1258c2b"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDExMTg4NDA4", "url": "https://github.com/telstra/open-kilda/pull/3361#pullrequestreview-411188408", "createdAt": "2020-05-13T18:25:27Z", "commit": {"oid": "8a223d5fa8958168af322cce02842d1bd1258c2b"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xM1QxODoyNToyN1rOGU-MfA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xM1QxODoyNToyN1rOGU-MfA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNDY0MzcwOA==", "bodyText": "You mix 2 concat practice here, implicit use of StringBuilder and string.format. Chose one.", "url": "https://github.com/telstra/open-kilda/pull/3361#discussion_r424643708", "createdAt": "2020-05-13T18:25:27Z", "author": {"login": "nikitamarchenko"}, "path": "src-java/kilda-model/src/main/java/org/openkilda/model/FlowEndpoint.java", "diffHunk": "@@ -16,48 +16,109 @@\n package org.openkilda.model;\n \n import com.fasterxml.jackson.annotation.JsonCreator;\n+import com.fasterxml.jackson.annotation.JsonIgnore;\n import com.fasterxml.jackson.annotation.JsonProperty;\n import lombok.Builder;\n import lombok.EqualsAndHashCode;\n-import lombok.ToString;\n import lombok.Value;\n \n+import java.util.List;\n+import java.util.Objects;\n+import java.util.stream.Collectors;\n+import java.util.stream.Stream;\n+\n @Value\n-@ToString(callSuper = true)\n @EqualsAndHashCode(callSuper = true)\n public class FlowEndpoint extends NetworkEndpoint {\n     @JsonProperty(\"outer_vlan_id\")\n-    private final int vlanId;\n+    private final int outerVlanId;\n+\n+    @JsonProperty(\"inner_vlan_id\")\n+    private final int innerVlanId;\n \n     @JsonProperty(\"track_lldp_connected_devices\")\n     private final boolean trackLldpConnectedDevices;\n \n     @JsonProperty(\"track_arp_connected_devices\")\n     private final boolean trackArpConnectedDevices;\n \n-    public FlowEndpoint(SwitchId switchId, Integer portNumber) {\n+    public FlowEndpoint(SwitchId switchId, int portNumber) {\n         this(switchId, portNumber, 0);\n     }\n \n-    public FlowEndpoint(SwitchId switchId, Integer portNumber, int vlanId) {\n-        this(switchId, portNumber, vlanId, false, false);\n+    public FlowEndpoint(SwitchId switchId, int portNumber, int outerVlanId) {\n+        this(switchId, portNumber, outerVlanId, 0, false, false);\n+    }\n+\n+    public FlowEndpoint(SwitchId switchId, int portNumber, int outerVlanId, int innerVlanId) {\n+        this(switchId, portNumber, outerVlanId, innerVlanId, false, false);\n     }\n \n     @JsonCreator\n     @Builder(toBuilder = true)\n     public FlowEndpoint(\n             @JsonProperty(\"switch_id\") SwitchId switchId,\n             @JsonProperty(\"port_number\") Integer portNumber,\n-            @JsonProperty(\"outer_vlan_id\") int vlanId,\n+            @JsonProperty(\"outer_vlan_id\") int outerVlanId,\n+            @JsonProperty(\"inner_vlan_id\") int innerVlanId,\n             @JsonProperty(\"track_lldp_connected_devices\") boolean trackLldpConnectedDevices,\n             @JsonProperty(\"track_arp_connected_devices\") boolean trackArpConnectedDevices) {\n         super(switchId, portNumber);\n-        this.vlanId = vlanId;\n+\n         this.trackLldpConnectedDevices = trackLldpConnectedDevices;\n         this.trackArpConnectedDevices = trackArpConnectedDevices;\n+\n+        // normalize VLANs representation\n+        List<Integer> vlanStack = makeVlanStack(innerVlanId, outerVlanId);\n+        if (1 < vlanStack.size()) {\n+            this.outerVlanId = vlanStack.get(1);\n+            this.innerVlanId = vlanStack.get(0);\n+        } else if (!vlanStack.isEmpty()) {\n+            this.outerVlanId = vlanStack.get(0);\n+            this.innerVlanId = 0;\n+        } else {\n+            this.outerVlanId = 0;\n+            this.innerVlanId = 0;\n+        }\n+    }\n+\n+    @JsonIgnore\n+    public List<Integer> getVlanStack() {\n+        return makeVlanStack(innerVlanId, outerVlanId);\n+    }\n+\n+    /**\n+     * Scan provided sequence for valid VLAN IDs and return them as a list.\n+     */\n+    public static List<Integer> makeVlanStack(Integer... sequence) {\n+        return Stream.of(sequence)\n+                .filter(FlowEndpoint::isVlanIdSet)\n+                .collect(Collectors.toList());\n     }\n \n     public static boolean isVlanIdSet(Integer vlanId) {\n         return vlanId != null && 0 < vlanId;\n     }\n+\n+    @Override\n+    public String toString() {\n+        String view = String.format(\"switchId=\\\"%s\\\" port=%d\", switchId, portNumber);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "8a223d5fa8958168af322cce02842d1bd1258c2b"}, "originalPosition": 98}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDExMTg4ODUz", "url": "https://github.com/telstra/open-kilda/pull/3361#pullrequestreview-411188853", "createdAt": "2020-05-13T18:26:01Z", "commit": {"oid": "8a223d5fa8958168af322cce02842d1bd1258c2b"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "09b993e68681c3756aa14f6f4ae42d728927f7ab", "author": {"user": {"login": "surabujin", "name": "Dmitriy Bogun"}}, "url": "https://github.com/telstra/open-kilda/commit/09b993e68681c3756aa14f6f4ae42d728927f7ab", "committedDate": "2020-05-14T08:03:12Z", "message": "Add inner vlan tag field into APIv2 requests/responses"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "8a223d5fa8958168af322cce02842d1bd1258c2b", "author": {"user": {"login": "surabujin", "name": "Dmitriy Bogun"}}, "url": "https://github.com/telstra/open-kilda/commit/8a223d5fa8958168af322cce02842d1bd1258c2b", "committedDate": "2020-05-07T16:33:35Z", "message": "Add inner vlan tag field into APIv2 requests/responses"}, "afterCommit": {"oid": "09b993e68681c3756aa14f6f4ae42d728927f7ab", "author": {"user": {"login": "surabujin", "name": "Dmitriy Bogun"}}, "url": "https://github.com/telstra/open-kilda/commit/09b993e68681c3756aa14f6f4ae42d728927f7ab", "committedDate": "2020-05-14T08:03:12Z", "message": "Add inner vlan tag field into APIv2 requests/responses"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDExOTMzNDky", "url": "https://github.com/telstra/open-kilda/pull/3361#pullrequestreview-411933492", "createdAt": "2020-05-14T15:40:05Z", "commit": {"oid": "09b993e68681c3756aa14f6f4ae42d728927f7ab"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xNFQxNTo0MDowNVrOGViUyw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xNFQxNTo0MDowNVrOGViUyw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNTIzNTY1OQ==", "bodyText": "nit: it's more common to have the target as the last argument. https://mapstruct.org/documentation/stable/reference/html/", "url": "https://github.com/telstra/open-kilda/pull/3361#discussion_r425235659", "createdAt": "2020-05-14T15:40:05Z", "author": {"login": "sergii-iakovenko"}, "path": "src-java/flowhs-topology/flowhs-storm-topology/src/main/java/org/openkilda/wfm/topology/flowhs/mapper/RequestedFlowIncrementalMapper.java", "diffHunk": "@@ -0,0 +1,43 @@\n+/* Copyright 2020 Telstra Open Source\n+ *\n+ *   Licensed under the Apache License, Version 2.0 (the \"License\");\n+ *   you may not use this file except in compliance with the License.\n+ *   You may obtain a copy of the License at\n+ *\n+ *       http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ *   Unless required by applicable law or agreed to in writing, software\n+ *   distributed under the License is distributed on an \"AS IS\" BASIS,\n+ *   WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ *   See the License for the specific language governing permissions and\n+ *   limitations under the License.\n+ */\n+\n+package org.openkilda.wfm.topology.flowhs.mapper;\n+\n+import org.openkilda.model.FlowEndpoint;\n+import org.openkilda.wfm.topology.flowhs.model.RequestedFlow;\n+\n+import org.mapstruct.Mapper;\n+import org.mapstruct.Mapping;\n+import org.mapstruct.MappingTarget;\n+import org.mapstruct.ReportingPolicy;\n+import org.mapstruct.factory.Mappers;\n+\n+@Mapper(unmappedTargetPolicy = ReportingPolicy.IGNORE)\n+public abstract class RequestedFlowIncrementalMapper {\n+    public static final RequestedFlowIncrementalMapper INSTANCE = Mappers.getMapper(\n+            RequestedFlowIncrementalMapper.class);\n+\n+    @Mapping(source = \"switchId\", target = \"srcSwitch\")\n+    @Mapping(source = \"portNumber\", target = \"srcPort\")\n+    @Mapping(source = \"outerVlanId\", target = \"srcVlan\")\n+    @Mapping(source = \"innerVlanId\", target = \"srcInnerVlan\")\n+    public abstract void mapSource(@MappingTarget RequestedFlow target, FlowEndpoint endpoint);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "09b993e68681c3756aa14f6f4ae42d728927f7ab"}, "originalPosition": 36}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDExOTU2OTQy", "url": "https://github.com/telstra/open-kilda/pull/3361#pullrequestreview-411956942", "createdAt": "2020-05-14T16:04:51Z", "commit": {"oid": "09b993e68681c3756aa14f6f4ae42d728927f7ab"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3612, "cost": 1, "resetAt": "2021-11-02T12:20:56Z"}}}