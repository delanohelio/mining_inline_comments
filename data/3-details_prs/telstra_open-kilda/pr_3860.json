{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTIzMjg3NTMw", "number": 3860, "title": "Zero downtime version", "bodyText": "", "createdAt": "2020-11-18T15:58:27Z", "url": "https://github.com/telstra/open-kilda/pull/3860", "merged": true, "mergeCommit": {"oid": "d8ade825510c77a4a1cbdfce557e7a7479fa340f"}, "closed": true, "closedAt": "2020-12-07T09:10:25Z", "author": {"login": "timofei-durakov"}, "timelineItems": {"totalCount": 16, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABddwsRFABqjQwMTE1NjY2Mzg=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdi7NQGAFqTU0NTE1NzIyNQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "ddb9ed74e6cc81a57effa0dc32639a05bb4f3ee3", "author": {"user": {"login": "dpoltavets", "name": "Dmitriy Poltavets"}}, "url": "https://github.com/telstra/open-kilda/commit/ddb9ed74e6cc81a57effa0dc32639a05bb4f3ee3", "committedDate": "2020-11-18T15:57:29Z", "message": "Zero-downtime upgrade PoC: added build_version"}, "afterCommit": {"oid": "15933dbe16eb4e9b01726418fc583ccd76d130c5", "author": {"user": {"login": "dpoltavets", "name": "Dmitriy Poltavets"}}, "url": "https://github.com/telstra/open-kilda/commit/15933dbe16eb4e9b01726418fc583ccd76d130c5", "committedDate": "2020-11-18T16:24:27Z", "message": "Zero-downtime upgrade PoC: added build_version"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "15933dbe16eb4e9b01726418fc583ccd76d130c5", "author": {"user": {"login": "dpoltavets", "name": "Dmitriy Poltavets"}}, "url": "https://github.com/telstra/open-kilda/commit/15933dbe16eb4e9b01726418fc583ccd76d130c5", "committedDate": "2020-11-18T16:24:27Z", "message": "Zero-downtime upgrade PoC: added build_version"}, "afterCommit": {"oid": "5fd1e7172ecb3031ff8ea2da249ae4162a57b822", "author": {"user": {"login": "dpoltavets", "name": "Dmitriy Poltavets"}}, "url": "https://github.com/telstra/open-kilda/commit/5fd1e7172ecb3031ff8ea2da249ae4162a57b822", "committedDate": "2020-11-18T21:12:02Z", "message": "Zero-downtime upgrade PoC: added build_version"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "5fd1e7172ecb3031ff8ea2da249ae4162a57b822", "author": {"user": {"login": "dpoltavets", "name": "Dmitriy Poltavets"}}, "url": "https://github.com/telstra/open-kilda/commit/5fd1e7172ecb3031ff8ea2da249ae4162a57b822", "committedDate": "2020-11-18T21:12:02Z", "message": "Zero-downtime upgrade PoC: added build_version"}, "afterCommit": {"oid": "a15c3c2fe3b0084f521ba0e3b93fa587b670362d", "author": {"user": {"login": "dpoltavets", "name": "Dmitriy Poltavets"}}, "url": "https://github.com/telstra/open-kilda/commit/a15c3c2fe3b0084f521ba0e3b93fa587b670362d", "committedDate": "2020-11-25T07:47:47Z", "message": "Zero-downtime upgrade PoC: added build_version"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "a15c3c2fe3b0084f521ba0e3b93fa587b670362d", "author": {"user": {"login": "dpoltavets", "name": "Dmitriy Poltavets"}}, "url": "https://github.com/telstra/open-kilda/commit/a15c3c2fe3b0084f521ba0e3b93fa587b670362d", "committedDate": "2020-11-25T07:47:47Z", "message": "Zero-downtime upgrade PoC: added build_version"}, "afterCommit": {"oid": "7c355ff9dd99f600058e70857098e7dd49db5505", "author": {"user": {"login": "dpoltavets", "name": "Dmitriy Poltavets"}}, "url": "https://github.com/telstra/open-kilda/commit/7c355ff9dd99f600058e70857098e7dd49db5505", "committedDate": "2020-11-25T08:02:44Z", "message": "Zero-downtime upgrade PoC: added build_version"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "7c355ff9dd99f600058e70857098e7dd49db5505", "author": {"user": {"login": "dpoltavets", "name": "Dmitriy Poltavets"}}, "url": "https://github.com/telstra/open-kilda/commit/7c355ff9dd99f600058e70857098e7dd49db5505", "committedDate": "2020-11-25T08:02:44Z", "message": "Zero-downtime upgrade PoC: added build_version"}, "afterCommit": {"oid": "2fe227ca01b450cf92c155ff4857be30645262db", "author": {"user": {"login": "dpoltavets", "name": "Dmitriy Poltavets"}}, "url": "https://github.com/telstra/open-kilda/commit/2fe227ca01b450cf92c155ff4857be30645262db", "committedDate": "2020-11-25T08:53:29Z", "message": "Zero-downtime upgrade PoC: added build_version"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTM4NDE3MjA4", "url": "https://github.com/telstra/open-kilda/pull/3860#pullrequestreview-538417208", "createdAt": "2020-11-25T11:49:23Z", "commit": {"oid": "2fe227ca01b450cf92c155ff4857be30645262db"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "2fe227ca01b450cf92c155ff4857be30645262db", "author": {"user": {"login": "dpoltavets", "name": "Dmitriy Poltavets"}}, "url": "https://github.com/telstra/open-kilda/commit/2fe227ca01b450cf92c155ff4857be30645262db", "committedDate": "2020-11-25T08:53:29Z", "message": "Zero-downtime upgrade PoC: added build_version"}, "afterCommit": {"oid": "b4806dbfc47c5e1d78e1e522f13b9a139b12ed30", "author": {"user": {"login": "dpoltavets", "name": "Dmitriy Poltavets"}}, "url": "https://github.com/telstra/open-kilda/commit/b4806dbfc47c5e1d78e1e522f13b9a139b12ed30", "committedDate": "2020-11-25T12:16:03Z", "message": "Zero-downtime upgrade PoC: added build_version"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "b4806dbfc47c5e1d78e1e522f13b9a139b12ed30", "author": {"user": {"login": "dpoltavets", "name": "Dmitriy Poltavets"}}, "url": "https://github.com/telstra/open-kilda/commit/b4806dbfc47c5e1d78e1e522f13b9a139b12ed30", "committedDate": "2020-11-25T12:16:03Z", "message": "Zero-downtime upgrade PoC: added build_version"}, "afterCommit": {"oid": "9a7739e7f426097764848b114801d50a93d8385f", "author": {"user": {"login": "dpoltavets", "name": "Dmitriy Poltavets"}}, "url": "https://github.com/telstra/open-kilda/commit/9a7739e7f426097764848b114801d50a93d8385f", "committedDate": "2020-11-26T06:45:54Z", "message": "Zero-downtime upgrade PoC: added build_version"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "9a7739e7f426097764848b114801d50a93d8385f", "author": {"user": {"login": "dpoltavets", "name": "Dmitriy Poltavets"}}, "url": "https://github.com/telstra/open-kilda/commit/9a7739e7f426097764848b114801d50a93d8385f", "committedDate": "2020-11-26T06:45:54Z", "message": "Zero-downtime upgrade PoC: added build_version"}, "afterCommit": {"oid": "17bdb1df124f02b5ef6d95b7c34c3ab80e925f1b", "author": {"user": {"login": "dpoltavets", "name": "Dmitriy Poltavets"}}, "url": "https://github.com/telstra/open-kilda/commit/17bdb1df124f02b5ef6d95b7c34c3ab80e925f1b", "committedDate": "2020-11-26T06:52:29Z", "message": "Zero-downtime upgrade PoC: added build_version"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "17bdb1df124f02b5ef6d95b7c34c3ab80e925f1b", "author": {"user": {"login": "dpoltavets", "name": "Dmitriy Poltavets"}}, "url": "https://github.com/telstra/open-kilda/commit/17bdb1df124f02b5ef6d95b7c34c3ab80e925f1b", "committedDate": "2020-11-26T06:52:29Z", "message": "Zero-downtime upgrade PoC: added build_version"}, "afterCommit": {"oid": "f3466d8906943bc9ad25dcbf647340600951116c", "author": {"user": {"login": "dpoltavets", "name": "Dmitriy Poltavets"}}, "url": "https://github.com/telstra/open-kilda/commit/f3466d8906943bc9ad25dcbf647340600951116c", "committedDate": "2020-11-27T11:10:11Z", "message": "Zero-downtime upgrade PoC: added build_version"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "f3466d8906943bc9ad25dcbf647340600951116c", "author": {"user": {"login": "dpoltavets", "name": "Dmitriy Poltavets"}}, "url": "https://github.com/telstra/open-kilda/commit/f3466d8906943bc9ad25dcbf647340600951116c", "committedDate": "2020-11-27T11:10:11Z", "message": "Zero-downtime upgrade PoC: added build_version"}, "afterCommit": {"oid": "7217ea96d1231913a7a77fe283d8d9d823eb2f7d", "author": {"user": {"login": "dpoltavets", "name": "Dmitriy Poltavets"}}, "url": "https://github.com/telstra/open-kilda/commit/7217ea96d1231913a7a77fe283d8d9d823eb2f7d", "committedDate": "2020-11-28T07:59:05Z", "message": "Zero-downtime upgrade PoC: added build_version"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "7217ea96d1231913a7a77fe283d8d9d823eb2f7d", "author": {"user": {"login": "dpoltavets", "name": "Dmitriy Poltavets"}}, "url": "https://github.com/telstra/open-kilda/commit/7217ea96d1231913a7a77fe283d8d9d823eb2f7d", "committedDate": "2020-11-28T07:59:05Z", "message": "Zero-downtime upgrade PoC: added build_version"}, "afterCommit": {"oid": "d61fd07c6bb30636262ca96c7df0d1366423d10d", "author": {"user": {"login": "dpoltavets", "name": "Dmitriy Poltavets"}}, "url": "https://github.com/telstra/open-kilda/commit/d61fd07c6bb30636262ca96c7df0d1366423d10d", "committedDate": "2020-12-02T07:41:34Z", "message": "Zero-downtime upgrade PoC: added build_version"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTQzNjcxOTkw", "url": "https://github.com/telstra/open-kilda/pull/3860#pullrequestreview-543671990", "createdAt": "2020-12-03T07:33:10Z", "commit": {"oid": "d61fd07c6bb30636262ca96c7df0d1366423d10d"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f3341a630fc323fceacf05a08234479336a08baf", "author": {"user": {"login": "dpoltavets", "name": "Dmitriy Poltavets"}}, "url": "https://github.com/telstra/open-kilda/commit/f3341a630fc323fceacf05a08234479336a08baf", "committedDate": "2020-12-04T07:26:41Z", "message": "Zero-downtime upgrade PoC: added build_version"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "d61fd07c6bb30636262ca96c7df0d1366423d10d", "author": {"user": {"login": "dpoltavets", "name": "Dmitriy Poltavets"}}, "url": "https://github.com/telstra/open-kilda/commit/d61fd07c6bb30636262ca96c7df0d1366423d10d", "committedDate": "2020-12-02T07:41:34Z", "message": "Zero-downtime upgrade PoC: added build_version"}, "afterCommit": {"oid": "f3341a630fc323fceacf05a08234479336a08baf", "author": {"user": {"login": "dpoltavets", "name": "Dmitriy Poltavets"}}, "url": "https://github.com/telstra/open-kilda/commit/f3341a630fc323fceacf05a08234479336a08baf", "committedDate": "2020-12-04T07:26:41Z", "message": "Zero-downtime upgrade PoC: added build_version"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTQ1MTU3MjI1", "url": "https://github.com/telstra/open-kilda/pull/3860#pullrequestreview-545157225", "createdAt": "2020-12-04T17:29:21Z", "commit": {"oid": "f3341a630fc323fceacf05a08234479336a08baf"}, "state": "APPROVED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0wNFQxNzoyOToyMlrOH_aryQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0wNFQxNzoyOToyMlrOH_aryQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNjI1OTUyOQ==", "bodyText": "As for me, it looks like you need some \"generic\" (with java generics) class responsible for publishing to a single node (with shared zk-client if it is possible) and some closure for the set of such publishers. This approach is much more scalable than the current one.", "url": "https://github.com/telstra/open-kilda/pull/3860#discussion_r536259529", "createdAt": "2020-12-04T17:29:22Z", "author": {"login": "surabujin"}, "path": "src-java/blue-green/src/main/java/org/openkilda/bluegreen/ZkWatchDog.java", "diffHunk": "@@ -32,19 +32,28 @@\n public class ZkWatchDog extends ZkClient implements DataCallback {\n \n     private static final String SIGNAL = \"signal\";\n+    private static final String BUILD_VERSION = \"build-version\";\n+\n     @VisibleForTesting\n     protected String signalPath;\n     private Signal signal;\n \n+    @VisibleForTesting\n+    protected String buildVersionPath;\n+    private String buildVersion;\n+\n     @VisibleForTesting\n     Set<LifeCycleObserver> observers = new HashSet<>();\n+    @VisibleForTesting\n+    Set<BuildVersionObserver> buildVersionObservers = new HashSet<>();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f3341a630fc323fceacf05a08234479336a08baf"}, "originalPosition": 17}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3767, "cost": 1, "resetAt": "2021-11-02T12:20:56Z"}}}