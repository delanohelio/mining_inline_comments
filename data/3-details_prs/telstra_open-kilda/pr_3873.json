{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTI2NTA3Njk2", "number": 3873, "title": "Fix flow loops for Q-in-Q", "bodyText": "Related to #3846", "createdAt": "2020-11-24T14:13:51Z", "url": "https://github.com/telstra/open-kilda/pull/3873", "merged": true, "mergeCommit": {"oid": "6b299d142f335beb77bb4385bebbb60ad67b8113"}, "closed": true, "closedAt": "2020-12-03T15:35:44Z", "author": {"login": "rozdy"}, "timelineItems": {"totalCount": 8, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdgmKncAFqTUzOTkyMTU1Mg==", "endCursor": "Y3Vyc29yOnYyOpPPAAABdh1353AH2gAyNTI2NTA3Njk2OmRiYmRjMWNkMzczOTAxZWMyMDdkZDg4N2IxZTFiMzE0MDc2MWY2MWM=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTM5OTIxNTUy", "url": "https://github.com/telstra/open-kilda/pull/3873#pullrequestreview-539921552", "createdAt": "2020-11-27T11:50:48Z", "commit": {"oid": "080c3265319c20e29b3c6e63593ae18af36f90cb"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTM5OTQ0Mzkx", "url": "https://github.com/telstra/open-kilda/pull/3873#pullrequestreview-539944391", "createdAt": "2020-11-27T12:29:21Z", "commit": {"oid": "080c3265319c20e29b3c6e63593ae18af36f90cb"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTQwNjYyOTc0", "url": "https://github.com/telstra/open-kilda/pull/3873#pullrequestreview-540662974", "createdAt": "2020-11-30T07:53:20Z", "commit": {"oid": "080c3265319c20e29b3c6e63593ae18af36f90cb"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0zMFQwNzo1MzoyMFrOH7vMPA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0zMFQwNzo1MzoyMFrOH7vMPA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMjQwMTIxMg==", "bodyText": "This is the method for single VLAN flow, how it can have inner VLAN defined?\nPS Please use FlowEndpoint.isVlanIdSet() method to check definement of vlan id.", "url": "https://github.com/telstra/open-kilda/pull/3873#discussion_r532401212", "createdAt": "2020-11-30T07:53:20Z", "author": {"login": "surabujin"}, "path": "src-java/floodlight-service/floodlight-modules/src/main/java/org/openkilda/floodlight/command/flow/ingress/of/IngressFlowModFactory.java", "diffHunk": "@@ -344,15 +344,17 @@ public OFFlowMod makeSingleVlanFlowLoopMessage() {\n         RoutingMetadata metadata = RoutingMetadata.builder()\n                 .outerVlanId(endpoint.getOuterVlanId())\n                 .build(switchFeatures);\n+        Match.Builder matchBuilder = of.buildMatch()\n+                .setExact(MatchField.IN_PORT, OFPort.of(endpoint.getPortNumber()))\n+                .setMasked(MatchField.METADATA,\n+                OFMetadata.of(metadata.getValue()), OFMetadata.of(metadata.getMask()));\n+        if (endpoint.getInnerVlanId() != 0) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "080c3265319c20e29b3c6e63593ae18af36f90cb"}, "originalPosition": 8}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "080c3265319c20e29b3c6e63593ae18af36f90cb", "author": {"user": {"login": "rozdy", "name": "Ievgen Rozdymakha"}}, "url": "https://github.com/telstra/open-kilda/commit/080c3265319c20e29b3c6e63593ae18af36f90cb", "committedDate": "2020-11-24T13:22:23Z", "message": "Fix flow loops for Q-in-Q"}, "afterCommit": {"oid": "b8347eeddf804114a9678a35b0f4b7c62cf2c53f", "author": {"user": {"login": "rozdy", "name": "Ievgen Rozdymakha"}}, "url": "https://github.com/telstra/open-kilda/commit/b8347eeddf804114a9678a35b0f4b7c62cf2c53f", "committedDate": "2020-11-30T09:04:01Z", "message": "Fix flow loops for Q-in-Q"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTQxMTg3NzUw", "url": "https://github.com/telstra/open-kilda/pull/3873#pullrequestreview-541187750", "createdAt": "2020-11-30T18:38:20Z", "commit": {"oid": "b8347eeddf804114a9678a35b0f4b7c62cf2c53f"}, "state": "APPROVED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0zMFQxODozODoyMVrOH8IeRw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0zMFQxODozODoyMVrOH8IeRw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMjgxNTQzMQ==", "bodyText": "you will get conflict here with patch about single switch loops", "url": "https://github.com/telstra/open-kilda/pull/3873#discussion_r532815431", "createdAt": "2020-11-30T18:38:21Z", "author": {"login": "nikitamarchenko"}, "path": "src-java/flowhs-topology/flowhs-storm-topology/src/main/java/org/openkilda/wfm/topology/flowhs/validation/FlowValidator.java", "diffHunk": "@@ -110,11 +110,7 @@ public void validate(Flow flow, RequestedFlow requestedFlow, Set<String> bulkUpd\n \n     private void validateFlowLoop(Flow flow, RequestedFlow requestedFlow) throws InvalidFlowException {\n         if (requestedFlow.getLoopSwitchId() != null) {\n-            //todo: fix loops for q-in-q and singe switch loops\n-            if (requestedFlow.getSrcInnerVlan() != 0 || requestedFlow.getDestInnerVlan() != 0) {\n-                throw new InvalidFlowException(\"Loop for Q-in-Q flows is not implemented\",\n-                        ErrorType.NOT_IMPLEMENTED);\n-            }\n+            //todo: fix loops singe switch loops", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b8347eeddf804114a9678a35b0f4b7c62cf2c53f"}, "originalPosition": 9}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "cbf16c7ad478a6ed0c3d3a0fe1cdf198e8bc1c3f", "author": {"user": {"login": "rozdy", "name": "Ievgen Rozdymakha"}}, "url": "https://github.com/telstra/open-kilda/commit/cbf16c7ad478a6ed0c3d3a0fe1cdf198e8bc1c3f", "committedDate": "2020-12-01T08:27:47Z", "message": "Fix flow loops for Q-in-Q"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "b8347eeddf804114a9678a35b0f4b7c62cf2c53f", "author": {"user": {"login": "rozdy", "name": "Ievgen Rozdymakha"}}, "url": "https://github.com/telstra/open-kilda/commit/b8347eeddf804114a9678a35b0f4b7c62cf2c53f", "committedDate": "2020-11-30T09:04:01Z", "message": "Fix flow loops for Q-in-Q"}, "afterCommit": {"oid": "cbf16c7ad478a6ed0c3d3a0fe1cdf198e8bc1c3f", "author": {"user": {"login": "rozdy", "name": "Ievgen Rozdymakha"}}, "url": "https://github.com/telstra/open-kilda/commit/cbf16c7ad478a6ed0c3d3a0fe1cdf198e8bc1c3f", "committedDate": "2020-12-01T08:27:47Z", "message": "Fix flow loops for Q-in-Q"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "dbbdc1cd373901ec207dd887b1e1b3140761f61c", "author": {"user": {"login": "andriidovhan", "name": "AndriiDovhan"}}, "url": "https://github.com/telstra/open-kilda/commit/dbbdc1cd373901ec207dd887b1e1b3140761f61c", "committedDate": "2020-12-01T08:42:46Z", "message": "add flowLoop endpoint into func test (#3789)\n\n* add flowLoop endpoint into func test\r\n\r\n* add tests for flowLoop\r\n\r\n* adjust flowLoopSpec to work on the stage env\r\n\r\n* unignore qinq and multiTable in flowLoopSpec"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3774, "cost": 1, "resetAt": "2021-11-02T12:20:56Z"}}}