{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTMwMzMxOTc1", "number": 3894, "title": "add swapEndpoint test for flowLoop", "bodyText": "", "createdAt": "2020-12-01T14:15:17Z", "url": "https://github.com/telstra/open-kilda/pull/3894", "merged": true, "mergeCommit": {"oid": "e9a7e326595937954ada73e73999ad9e9a7330e9"}, "closed": true, "closedAt": "2020-12-11T07:54:48Z", "author": {"login": "andriidovhan"}, "timelineItems": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdh7JQrgBqjQwNTc1OTg0MzQ=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdkwZkmgBqjQwOTQyMjY5NDg=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "1e0b9adddcaa52e6b6d4840908d22485bc109e5e", "author": {"user": {"login": "andriidovhan", "name": "AndriiDovhan"}}, "url": "https://github.com/telstra/open-kilda/commit/1e0b9adddcaa52e6b6d4840908d22485bc109e5e", "committedDate": "2020-12-01T14:10:46Z", "message": "add swapEndpoint test for flowLoop"}, "afterCommit": {"oid": "bde08acc466bce3cd1af93134c29bf70074e0a3c", "author": {"user": {"login": "andriidovhan", "name": "AndriiDovhan"}}, "url": "https://github.com/telstra/open-kilda/commit/bde08acc466bce3cd1af93134c29bf70074e0a3c", "committedDate": "2020-12-01T14:51:03Z", "message": "add swapEndpoint test for flowLoop"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "bde08acc466bce3cd1af93134c29bf70074e0a3c", "author": {"user": {"login": "andriidovhan", "name": "AndriiDovhan"}}, "url": "https://github.com/telstra/open-kilda/commit/bde08acc466bce3cd1af93134c29bf70074e0a3c", "committedDate": "2020-12-01T14:51:03Z", "message": "add swapEndpoint test for flowLoop"}, "afterCommit": {"oid": "0bdcfca7f52ff5983a63bc901a8a50c2c3c7a6ca", "author": {"user": {"login": "andriidovhan", "name": "AndriiDovhan"}}, "url": "https://github.com/telstra/open-kilda/commit/0bdcfca7f52ff5983a63bc901a8a50c2c3c7a6ca", "committedDate": "2020-12-04T15:32:35Z", "message": "add swapEndpoint test for flowLoop"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTQ4OTY3NTU0", "url": "https://github.com/telstra/open-kilda/pull/3894#pullrequestreview-548967554", "createdAt": "2020-12-10T08:48:57Z", "commit": {"oid": "0bdcfca7f52ff5983a63bc901a8a50c2c3c7a6ca"}, "state": "APPROVED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xMFQwODo0ODo1N1rOIC94cw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xMFQwODo1NDo0MlrOIC-HSQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzOTk4MTkzOQ==", "bodyText": "should include reversed pairs", "url": "https://github.com/telstra/open-kilda/pull/3894#discussion_r539981939", "createdAt": "2020-12-10T08:48:57Z", "author": {"login": "rtretyak"}, "path": "src-java/testing/functional-tests/src/test/groovy/org/openkilda/functionaltests/spec/flows/SwapEndpointSpec.groovy", "diffHunk": "@@ -1378,23 +1378,22 @@ switches\"() {\n     }\n \n     @Tidy\n-    def \"Unable to swap endpoints for a flow with flowLoop\"() {\n+    def \"Able to swap endpoints for a flow with flowLoop\"() {\n         setup: \"Create two flows with the same src and different dst switches\"\n         def tgSwitchIds = topology.getActiveTraffGens()*.switchConnected*.dpId\n-        assumeTrue(\"Not enough traffgen switches found\", tgSwitchIds.size() > 2)\n+        assumeTrue(\"Not enough traffgen switches found\", tgSwitchIds.size() > 1)\n         SwitchPair flow2SwitchPair = null\n-        SwitchPair flow1SwitchPair = topologyHelper.switchPairs.collectMany{ [it, it.reversed] }.find { firstPair ->\n+        SwitchPair flow1SwitchPair = topologyHelper.getAllNeighboringSwitchPairs().find { firstPair ->\n             def firstOk = firstPair.src.dpId in tgSwitchIds && firstPair.dst.dpId in tgSwitchIds\n             flow2SwitchPair = topologyHelper.getAllNeighboringSwitchPairs().find { secondPair ->", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "0bdcfca7f52ff5983a63bc901a8a50c2c3c7a6ca"}, "originalPosition": 14}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzOTk4NTczNw==", "bodyText": "still created for the second flow?", "url": "https://github.com/telstra/open-kilda/pull/3894#discussion_r539985737", "createdAt": "2020-12-10T08:54:42Z", "author": {"login": "rtretyak"}, "path": "src-java/testing/functional-tests/src/test/groovy/org/openkilda/functionaltests/spec/flows/SwapEndpointSpec.groovy", "diffHunk": "@@ -1417,40 +1416,52 @@ switches\"() {\n                 new SwapFlowPayload(flow2.id, flowHelper.toFlowEndpointV2(flow2Src),\n                         flowHelper.toFlowEndpointV2(flow2Dst)))\n \n-        then: \"Human readable error is returned\"\n-        def exc = thrown(HttpServerErrorException)\n-        exc.statusCode == HttpStatus.NOT_IMPLEMENTED\n-        def errorDetails = exc.responseBodyAsString.to(MessageError)\n-        errorDetails.errorMessage == \"Could not swap endpoints\"\n-        errorDetails.errorDescription == \"Swap endpoints is not implemented for looped flows\"\n+        then: \"Endpoints are successfully swapped\"\n+        verifyEndpoints(response, flow1Src, flow1Dst, flow2Src, flow2Dst)\n+        verifyEndpoints(flow1.id, flow2.id, flow1Src, flow1Dst, flow2Src, flow2Dst)\n \n         and: \"Flows validation doesn't show any discrepancies\"\n         validateFlows(flow1, flow2)\n \n-        and: \"FlowLoop is still created for the second flow on the dst switch\"\n-        northbound.getFlow(flow2.id).loopSwitchId == flow2SwitchPair.dst.dpId\n+        and: \"FlowLoop is still created for the first flow but on the new dst switch\"", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "0bdcfca7f52ff5983a63bc901a8a50c2c3c7a6ca"}, "originalPosition": 57}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f6ff03ed1f8f4d9a64fe57b15461bf595bd5d795", "author": {"user": {"login": "andriidovhan", "name": "AndriiDovhan"}}, "url": "https://github.com/telstra/open-kilda/commit/f6ff03ed1f8f4d9a64fe57b15461bf595bd5d795", "committedDate": "2020-12-10T09:37:03Z", "message": "add swapEndpoint test for flowLoop"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "0bdcfca7f52ff5983a63bc901a8a50c2c3c7a6ca", "author": {"user": {"login": "andriidovhan", "name": "AndriiDovhan"}}, "url": "https://github.com/telstra/open-kilda/commit/0bdcfca7f52ff5983a63bc901a8a50c2c3c7a6ca", "committedDate": "2020-12-04T15:32:35Z", "message": "add swapEndpoint test for flowLoop"}, "afterCommit": {"oid": "f6ff03ed1f8f4d9a64fe57b15461bf595bd5d795", "author": {"user": {"login": "andriidovhan", "name": "AndriiDovhan"}}, "url": "https://github.com/telstra/open-kilda/commit/f6ff03ed1f8f4d9a64fe57b15461bf595bd5d795", "committedDate": "2020-12-10T09:37:03Z", "message": "add swapEndpoint test for flowLoop"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3783, "cost": 1, "resetAt": "2021-11-02T12:20:56Z"}}}