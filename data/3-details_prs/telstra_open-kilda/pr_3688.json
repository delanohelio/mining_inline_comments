{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDY3NDc1NzU5", "number": 3688, "title": "Fix null pointer exception during producing flow dump", "bodyText": "Close #3552", "createdAt": "2020-08-13T15:54:42Z", "url": "https://github.com/telstra/open-kilda/pull/3688", "merged": true, "mergeCommit": {"oid": "ef5b20823b331005378f70ab1bbfa45f96e6734b"}, "closed": true, "closedAt": "2020-08-19T07:32:50Z", "author": {"login": "surabujin"}, "timelineItems": {"totalCount": 6, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABc-iG0AAH2gAyNDY3NDc1NzU5OjIyY2NjMWQzMjA1MGUxZjRlYTcwZDY1ODk1OTcyNTRmZGZhMjFmOGU=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdAWiSiAFqTQ3MDE5NTU3Mg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "22ccc1d32050e1f4ea70d6589597254fdfa21f8e", "author": {"user": {"login": "surabujin", "name": "Dmitriy Bogun"}}, "url": "https://github.com/telstra/open-kilda/commit/22ccc1d32050e1f4ea70d6589597254fdfa21f8e", "committedDate": "2020-08-13T15:53:36Z", "message": "Fix null pointer exception during producing flow dump"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "398efd4604845d7c2252a39733cdccb5b62bb868", "author": {"user": {"login": "rtretyak", "name": "Roman Tretiak"}}, "url": "https://github.com/telstra/open-kilda/commit/398efd4604845d7c2252a39733cdccb5b62bb868", "committedDate": "2020-08-14T12:15:21Z", "message": "Fix broken reroute test"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDY4MTcxMTQz", "url": "https://github.com/telstra/open-kilda/pull/3688#pullrequestreview-468171143", "createdAt": "2020-08-17T05:25:39Z", "commit": {"oid": "398efd4604845d7c2252a39733cdccb5b62bb868"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDY4MzcyMDIy", "url": "https://github.com/telstra/open-kilda/pull/3688#pullrequestreview-468372022", "createdAt": "2020-08-17T11:11:05Z", "commit": {"oid": "398efd4604845d7c2252a39733cdccb5b62bb868"}, "state": "COMMENTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xN1QxMToxMTowNVrOHBkbWA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xN1QxMToxNzozNFrOHBknMQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MTQwNzQ0OA==", "bodyText": "nit: Is it really related to the issue?", "url": "https://github.com/telstra/open-kilda/pull/3688#discussion_r471407448", "createdAt": "2020-08-17T11:11:05Z", "author": {"login": "sergii-iakovenko"}, "path": "src-java/testing/functional-tests/src/test/groovy/org/openkilda/functionaltests/spec/flows/AutoRerouteV2Spec.groovy", "diffHunk": "@@ -563,7 +563,7 @@ class AutoRerouteV2Spec extends HealthCheckSpecification {\n                 }\n                 sleep(500)\n             }\n-            assert northboundV2.getFlow(firstFlow.flowId).statusInfo =~ /ISL (.*) become INACTIVE because of FAIL TIMEOUT (.*)/\n+            assert northboundV2.getFlow(firstFlow.flowId).statusInfo =~ /ISL (.*) become INACTIVE(.*)/", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "398efd4604845d7c2252a39733cdccb5b62bb868"}, "originalPosition": 5}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MTQxMDQ4MQ==", "bodyText": "2 questions:\n\nHow are the changes in this file related to the title \"NPE during producting flow dump\"?\nWhat benefits do these changes bring? IMHO, 2 iterators instead of an index are neither shorter nor clearer.", "url": "https://github.com/telstra/open-kilda/pull/3688#discussion_r471410481", "createdAt": "2020-08-17T11:17:34Z", "author": {"login": "sergii-iakovenko"}, "path": "src-java/base-topology/base-storm-topology/src/main/java/org/openkilda/wfm/share/mappers/FlowPathMapper.java", "diffHunk": "@@ -65,28 +68,27 @@ public PathInfoData map(FlowPath path) {\n         List<PathNodePayload> resultList = new ArrayList<>();\n \n         Flow flow = flowPath.getFlow();\n-        int srcPort = flow.isForward(flowPath) ? flow.getSrcPort() : flow.getDestPort();\n-        int destPort = flow.isForward(flowPath) ? flow.getDestPort() : flow.getSrcPort();\n-\n-        if (flowPath.getSegments().isEmpty()) {\n-            resultList.add(\n-                    new PathNodePayload(flowPath.getSrcSwitch().getSwitchId(), srcPort, destPort));\n+        FlowEndpoint ingress = FlowSideAdapter.makeIngressAdapter(flow, flowPath).getEndpoint();\n+        FlowEndpoint egress = FlowSideAdapter.makeEgressAdapter(flow, flowPath).getEndpoint();\n+\n+        List<PathSegment> pathSegments = flowPath.getSegments();\n+        Iterator<PathSegment> leftIter = pathSegments.iterator();\n+        Iterator<PathSegment> rightIter = pathSegments.iterator();\n+        if (! rightIter.hasNext()) {\n+            resultList.add(new PathNodePayload(\n+                    flowPath.getSrcSwitch().getSwitchId(), ingress.getPortNumber(), egress.getPortNumber()));\n         } else {\n-            List<PathSegment> pathSegments = flowPath.getSegments();\n-\n-            resultList.add(new PathNodePayload(flowPath.getSrcSwitch().getSwitchId(), srcPort,\n-                    pathSegments.get(0).getSrcPort()));\n-\n-            for (int i = 1; i < pathSegments.size(); i++) {\n-                PathSegment inputNode = pathSegments.get(i - 1);\n-                PathSegment outputNode = pathSegments.get(i);\n-\n-                resultList.add(new PathNodePayload(inputNode.getDestSwitch().getSwitchId(), inputNode.getDestPort(),\n-                        outputNode.getSrcPort()));\n+            PathSegment left;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "398efd4604845d7c2252a39733cdccb5b62bb868"}, "originalPosition": 52}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDY5MTI2NDkw", "url": "https://github.com/telstra/open-kilda/pull/3688#pullrequestreview-469126490", "createdAt": "2020-08-18T08:56:00Z", "commit": {"oid": "398efd4604845d7c2252a39733cdccb5b62bb868"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDcwMTk1NTcy", "url": "https://github.com/telstra/open-kilda/pull/3688#pullrequestreview-470195572", "createdAt": "2020-08-19T07:32:36Z", "commit": {"oid": "398efd4604845d7c2252a39733cdccb5b62bb868"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3554, "cost": 1, "resetAt": "2021-11-02T12:20:56Z"}}}