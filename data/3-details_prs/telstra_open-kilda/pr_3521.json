{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDI3MjA2NTk3", "number": 3521, "title": "Repripritize reroute requests", "bodyText": "Flows with COST_AND_AVAILABLE_BANDWIDTH path computation strategy should be rerouted from low to high bandwidth", "createdAt": "2020-06-03T13:36:12Z", "url": "https://github.com/telstra/open-kilda/pull/3521", "merged": true, "mergeCommit": {"oid": "25e76c39029eacd56b98e6a829883dd2af158f9f"}, "closed": true, "closedAt": "2020-06-19T06:35:32Z", "author": {"login": "rozdy"}, "timelineItems": {"totalCount": 9, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcnpuz7AFqTQyMzU2NzM3OA==", "endCursor": "Y3Vyc29yOnYyOpPPAAABcrdk85AFqTQzMDQ5MDU2Nw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDIzNTY3Mzc4", "url": "https://github.com/telstra/open-kilda/pull/3521#pullrequestreview-423567378", "createdAt": "2020-06-03T13:45:00Z", "commit": {"oid": "12df6fbe479093a1f199e39f8e0ba71ed859431a"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wM1QxMzo0NTowMVrOGech_A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wM1QxMzo0NTowMVrOGech_A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNDU3NzkxNg==", "bodyText": "What if we have the same bandwidths. Shouldn't we then compare by creation time?", "url": "https://github.com/telstra/open-kilda/pull/3521#discussion_r434577916", "createdAt": "2020-06-03T13:45:01Z", "author": {"login": "dpoltavets"}, "path": "src-java/reroute-topology/reroute-storm-topology/src/main/java/org/openkilda/wfm/topology/reroute/service/RerouteQueueService.java", "diffHunk": "@@ -228,15 +230,31 @@ public int compare(FlowThrottlingData throttlingDataA, FlowThrottlingData thrott\n             int priorityB = throttlingDataB.getPriority() == null ? defaultFlowPriority : throttlingDataB.getPriority();\n             Instant timeCreateA = throttlingDataA.getTimeCreate();\n             Instant timeCreateB = throttlingDataB.getTimeCreate();\n+            PathComputationStrategy pathComputationStrategyA = throttlingDataA.getPathComputationStrategy();\n+            PathComputationStrategy pathComputationStrategyB = throttlingDataB.getPathComputationStrategy();\n \n-            if (priorityA == priorityB && (timeCreateA != null || timeCreateB != null)) {\n-                if (timeCreateA == null) {\n-                    return -1;\n+            if (priorityA == priorityB) {\n+                if (pathComputationStrategyA == COST_AND_AVAILABLE_BANDWIDTH\n+                        && pathComputationStrategyB == COST_AND_AVAILABLE_BANDWIDTH) {\n+                    return Long.compare(throttlingDataB.getBandwidth(), throttlingDataA.getBandwidth());", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "12df6fbe479093a1f199e39f8e0ba71ed859431a"}, "originalPosition": 29}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "12df6fbe479093a1f199e39f8e0ba71ed859431a", "author": {"user": {"login": "rozdy", "name": "Ievgen Rozdymakha"}}, "url": "https://github.com/telstra/open-kilda/commit/12df6fbe479093a1f199e39f8e0ba71ed859431a", "committedDate": "2020-06-03T13:33:07Z", "message": "Repripritize reroute requests\n\nFlows with COST_AND_AVAILABLE_BANDWIDTH path computation strategy should be rerouted from low to high bandwidth"}, "afterCommit": {"oid": "36e03f04e6b41cc40fd2b3d7952c4dfb3803b907", "author": {"user": {"login": "rozdy", "name": "Ievgen Rozdymakha"}}, "url": "https://github.com/telstra/open-kilda/commit/36e03f04e6b41cc40fd2b3d7952c4dfb3803b907", "committedDate": "2020-06-03T14:19:37Z", "message": "Repripritize reroute requests\n\nFlows with COST_AND_AVAILABLE_BANDWIDTH path computation strategy should be rerouted from low to high bandwidth"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDIzNjI1Nzgx", "url": "https://github.com/telstra/open-kilda/pull/3521#pullrequestreview-423625781", "createdAt": "2020-06-03T14:42:59Z", "commit": {"oid": "36e03f04e6b41cc40fd2b3d7952c4dfb3803b907"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDI1MTkwNDUx", "url": "https://github.com/telstra/open-kilda/pull/3521#pullrequestreview-425190451", "createdAt": "2020-06-05T10:42:31Z", "commit": {"oid": "36e03f04e6b41cc40fd2b3d7952c4dfb3803b907"}, "state": "APPROVED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wNVQxMDo0MjozMVrOGfpjjw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wNVQxMDo0MjozMVrOGfpjjw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNTgzOTg4Nw==", "bodyText": "As for me it should be separate comparator joined to existing via thenComparing.", "url": "https://github.com/telstra/open-kilda/pull/3521#discussion_r435839887", "createdAt": "2020-06-05T10:42:31Z", "author": {"login": "surabujin"}, "path": "src-java/reroute-topology/reroute-storm-topology/src/main/java/org/openkilda/wfm/topology/reroute/service/RerouteQueueService.java", "diffHunk": "@@ -228,15 +230,35 @@ public int compare(FlowThrottlingData throttlingDataA, FlowThrottlingData thrott\n             int priorityB = throttlingDataB.getPriority() == null ? defaultFlowPriority : throttlingDataB.getPriority();\n             Instant timeCreateA = throttlingDataA.getTimeCreate();\n             Instant timeCreateB = throttlingDataB.getTimeCreate();\n+            PathComputationStrategy pathComputationStrategyA = throttlingDataA.getPathComputationStrategy();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "36e03f04e6b41cc40fd2b3d7952c4dfb3803b907"}, "originalPosition": 20}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "36e03f04e6b41cc40fd2b3d7952c4dfb3803b907", "author": {"user": {"login": "rozdy", "name": "Ievgen Rozdymakha"}}, "url": "https://github.com/telstra/open-kilda/commit/36e03f04e6b41cc40fd2b3d7952c4dfb3803b907", "committedDate": "2020-06-03T14:19:37Z", "message": "Repripritize reroute requests\n\nFlows with COST_AND_AVAILABLE_BANDWIDTH path computation strategy should be rerouted from low to high bandwidth"}, "afterCommit": {"oid": "a2b3902244b65c298a996ddef018992e9ec991b9", "author": {"user": {"login": "rozdy", "name": "Ievgen Rozdymakha"}}, "url": "https://github.com/telstra/open-kilda/commit/a2b3902244b65c298a996ddef018992e9ec991b9", "committedDate": "2020-06-05T14:26:55Z", "message": "Repripritize reroute requests\n\nFlows with COST_AND_AVAILABLE_BANDWIDTH path computation strategy should be rerouted from low to high bandwidth"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "a2b3902244b65c298a996ddef018992e9ec991b9", "author": {"user": {"login": "rozdy", "name": "Ievgen Rozdymakha"}}, "url": "https://github.com/telstra/open-kilda/commit/a2b3902244b65c298a996ddef018992e9ec991b9", "committedDate": "2020-06-05T14:26:55Z", "message": "Repripritize reroute requests\n\nFlows with COST_AND_AVAILABLE_BANDWIDTH path computation strategy should be rerouted from low to high bandwidth"}, "afterCommit": {"oid": "d107aa2273ceb7ca20b200476a9a2e1f50f6df7d", "author": {"user": {"login": "rozdy", "name": "Ievgen Rozdymakha"}}, "url": "https://github.com/telstra/open-kilda/commit/d107aa2273ceb7ca20b200476a9a2e1f50f6df7d", "committedDate": "2020-06-09T11:27:01Z", "message": "Repripritize reroute requests\n\nFlows with COST_AND_AVAILABLE_BANDWIDTH path computation strategy should be rerouted from low to high bandwidth"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "95efb54ad8d4adb9a9b1c1d4a6f27a69cb533473", "author": {"user": {"login": "rozdy", "name": "Ievgen Rozdymakha"}}, "url": "https://github.com/telstra/open-kilda/commit/95efb54ad8d4adb9a9b1c1d4a6f27a69cb533473", "committedDate": "2020-06-09T13:04:44Z", "message": "Repripritize reroute requests\n\nFlows with COST_AND_AVAILABLE_BANDWIDTH path computation strategy should be rerouted from low to high bandwidth"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "d107aa2273ceb7ca20b200476a9a2e1f50f6df7d", "author": {"user": {"login": "rozdy", "name": "Ievgen Rozdymakha"}}, "url": "https://github.com/telstra/open-kilda/commit/d107aa2273ceb7ca20b200476a9a2e1f50f6df7d", "committedDate": "2020-06-09T11:27:01Z", "message": "Repripritize reroute requests\n\nFlows with COST_AND_AVAILABLE_BANDWIDTH path computation strategy should be rerouted from low to high bandwidth"}, "afterCommit": {"oid": "95efb54ad8d4adb9a9b1c1d4a6f27a69cb533473", "author": {"user": {"login": "rozdy", "name": "Ievgen Rozdymakha"}}, "url": "https://github.com/telstra/open-kilda/commit/95efb54ad8d4adb9a9b1c1d4a6f27a69cb533473", "committedDate": "2020-06-09T13:04:44Z", "message": "Repripritize reroute requests\n\nFlows with COST_AND_AVAILABLE_BANDWIDTH path computation strategy should be rerouted from low to high bandwidth"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDMwNDkwNTY3", "url": "https://github.com/telstra/open-kilda/pull/3521#pullrequestreview-430490567", "createdAt": "2020-06-15T09:52:26Z", "commit": {"oid": "95efb54ad8d4adb9a9b1c1d4a6f27a69cb533473"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3578, "cost": 1, "resetAt": "2021-11-02T12:20:56Z"}}}