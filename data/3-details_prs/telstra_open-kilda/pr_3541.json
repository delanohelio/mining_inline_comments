{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDMzNjcxNDQ5", "number": 3541, "title": "Skip reroute requests for flows without affected path segment", "bodyText": "Close #3390", "createdAt": "2020-06-12T13:11:57Z", "url": "https://github.com/telstra/open-kilda/pull/3541", "merged": true, "mergeCommit": {"oid": "4b081d5780334b0d4ecd6a2e24c9dc6948372dfb"}, "closed": true, "closedAt": "2020-07-01T12:26:27Z", "author": {"login": "rozdy"}, "timelineItems": {"totalCount": 10, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcrbRUpgFqTQzMDM3NDAzNw==", "endCursor": "Y3Vyc29yOnYyOpPPAAABcwoGTWABqjM1MDE5MDI2MTY=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDMwMzc0MDM3", "url": "https://github.com/telstra/open-kilda/pull/3541#pullrequestreview-430374037", "createdAt": "2020-06-15T07:11:11Z", "commit": {"oid": "e452895b38212ecda9fcdfb6354eadf99d3e26eb"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDMwNDg5MzMx", "url": "https://github.com/telstra/open-kilda/pull/3541#pullrequestreview-430489331", "createdAt": "2020-06-15T09:50:53Z", "commit": {"oid": "e452895b38212ecda9fcdfb6354eadf99d3e26eb"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDMwNzQ4ODU1", "url": "https://github.com/telstra/open-kilda/pull/3541#pullrequestreview-430748855", "createdAt": "2020-06-15T15:21:14Z", "commit": {"oid": "e452895b38212ecda9fcdfb6354eadf99d3e26eb"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xNVQxNToyMToxNFrOGj3B1A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xNVQxNToyMjoxOVrOGj3Esw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MDI1NDkzMg==", "bodyText": "em... what about the rest of paths passed into paths argument? Now you stop processing paths on first error (not so critical as stop processing all flows on the first error, but still incorrect).", "url": "https://github.com/telstra/open-kilda/pull/3541#discussion_r440254932", "createdAt": "2020-06-15T15:21:14Z", "author": {"login": "surabujin"}, "path": "src-java/reroute-topology/reroute-storm-topology/src/main/java/org/openkilda/wfm/topology/reroute/service/RerouteService.java", "diffHunk": "@@ -137,7 +141,13 @@ private void updateFlowPathsStateForFlow(SwitchId switchId, int port, List<FlowP\n                         || (pathSegment.getDestPort() == port\n                         && switchId.equals(pathSegment.getDestSwitch().getSwitchId()))) {\n                     pathSegment.setFailed(true);\n-                    pathSegmentRepository.updateFailedStatus(fp.getPathId(), pathSegment, true);\n+                    try {\n+                        pathSegmentRepository.updateFailedStatus(fp.getPathId(), pathSegment, true);\n+                    } catch (EntityNotFoundException e) {\n+                        log.warn(\"FlowPath {} not found. Skipping reroute for flow {}.\",\n+                                fp.getPathId(), fp.getFlow().getFlowId(), e);\n+                        return false;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e452895b38212ecda9fcdfb6354eadf99d3e26eb"}, "originalPosition": 68}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MDI1NTY2Nw==", "bodyText": "swapping this and following lines you can get rid of flowPathFound variable.", "url": "https://github.com/telstra/open-kilda/pull/3541#discussion_r440255667", "createdAt": "2020-06-15T15:22:19Z", "author": {"login": "surabujin"}, "path": "src-java/reroute-topology/reroute-storm-topology/src/main/java/org/openkilda/wfm/topology/reroute/service/RerouteService.java", "diffHunk": "@@ -98,21 +99,24 @@ public void rerouteAffectedFlows(MessageSender sender, String correlationId, Rer\n \n         for (FlowWithAffectedPaths entry : groupPathsForRerouting(affectedFlowPaths)) {\n             Flow flow = entry.getFlow();\n-            transactionManager.doInTransaction(() -> {\n-                updateFlowPathsStateForFlow(switchId, port, entry.getAffectedPaths());\n+            Boolean sendRerouteRequest = transactionManager.doInTransaction(() -> {\n+                boolean flowPathFound = updateFlowPathsStateForFlow(switchId, port, entry.getAffectedPaths());", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e452895b38212ecda9fcdfb6354eadf99d3e26eb"}, "originalPosition": 19}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDMzODUzNzA5", "url": "https://github.com/telstra/open-kilda/pull/3541#pullrequestreview-433853709", "createdAt": "2020-06-19T07:15:58Z", "commit": {"oid": "e452895b38212ecda9fcdfb6354eadf99d3e26eb"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "e452895b38212ecda9fcdfb6354eadf99d3e26eb", "author": {"user": {"login": "rozdy", "name": "Ievgen Rozdymakha"}}, "url": "https://github.com/telstra/open-kilda/commit/e452895b38212ecda9fcdfb6354eadf99d3e26eb", "committedDate": "2020-06-12T13:07:20Z", "message": "Skip reroute requests for flows without affected path segment"}, "afterCommit": {"oid": "19d9e68ecc3817077272c57df636a27672cdc06b", "author": {"user": {"login": "rozdy", "name": "Ievgen Rozdymakha"}}, "url": "https://github.com/telstra/open-kilda/commit/19d9e68ecc3817077272c57df636a27672cdc06b", "committedDate": "2020-06-22T13:33:00Z", "message": "Skip reroute requests for flows without affected path segment"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "19d9e68ecc3817077272c57df636a27672cdc06b", "author": {"user": {"login": "rozdy", "name": "Ievgen Rozdymakha"}}, "url": "https://github.com/telstra/open-kilda/commit/19d9e68ecc3817077272c57df636a27672cdc06b", "committedDate": "2020-06-22T13:33:00Z", "message": "Skip reroute requests for flows without affected path segment"}, "afterCommit": {"oid": "4ac96ab980c01d8a98bec87a3619b7770a93d585", "author": {"user": {"login": "rozdy", "name": "Ievgen Rozdymakha"}}, "url": "https://github.com/telstra/open-kilda/commit/4ac96ab980c01d8a98bec87a3619b7770a93d585", "committedDate": "2020-06-22T13:39:09Z", "message": "Skip reroute requests for flows without affected path segment"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDM1ODIyNDEx", "url": "https://github.com/telstra/open-kilda/pull/3541#pullrequestreview-435822411", "createdAt": "2020-06-23T14:10:15Z", "commit": {"oid": "4ac96ab980c01d8a98bec87a3619b7770a93d585"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "4ac96ab980c01d8a98bec87a3619b7770a93d585", "author": {"user": {"login": "rozdy", "name": "Ievgen Rozdymakha"}}, "url": "https://github.com/telstra/open-kilda/commit/4ac96ab980c01d8a98bec87a3619b7770a93d585", "committedDate": "2020-06-22T13:39:09Z", "message": "Skip reroute requests for flows without affected path segment"}, "afterCommit": {"oid": "d01d3c086e31167ccf023aa3147552c63bc29cf8", "author": {"user": {"login": "rozdy", "name": "Ievgen Rozdymakha"}}, "url": "https://github.com/telstra/open-kilda/commit/d01d3c086e31167ccf023aa3147552c63bc29cf8", "committedDate": "2020-07-01T09:58:26Z", "message": "Skip reroute requests for flows without affected path segment"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "68666123b2135907c635425533d7e78e8110ced7", "author": {"user": {"login": "rozdy", "name": "Ievgen Rozdymakha"}}, "url": "https://github.com/telstra/open-kilda/commit/68666123b2135907c635425533d7e78e8110ced7", "committedDate": "2020-07-01T10:56:22Z", "message": "Skip reroute requests for flows without affected path segment"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "d01d3c086e31167ccf023aa3147552c63bc29cf8", "author": {"user": {"login": "rozdy", "name": "Ievgen Rozdymakha"}}, "url": "https://github.com/telstra/open-kilda/commit/d01d3c086e31167ccf023aa3147552c63bc29cf8", "committedDate": "2020-07-01T09:58:26Z", "message": "Skip reroute requests for flows without affected path segment"}, "afterCommit": {"oid": "68666123b2135907c635425533d7e78e8110ced7", "author": {"user": {"login": "rozdy", "name": "Ievgen Rozdymakha"}}, "url": "https://github.com/telstra/open-kilda/commit/68666123b2135907c635425533d7e78e8110ced7", "committedDate": "2020-07-01T10:56:22Z", "message": "Skip reroute requests for flows without affected path segment"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3588, "cost": 1, "resetAt": "2021-11-02T12:20:56Z"}}}