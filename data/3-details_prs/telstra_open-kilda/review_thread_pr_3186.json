{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0MzcyOTk2MzUz", "number": 3186, "reviewThreads": {"totalCount": 13, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xMFQxMDo0NTo1MFrODeaCNg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xMVQwODoxNzowNFrODetsKw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjMzMjEwNDIyOnYy", "diffSide": "RIGHT", "path": "src-java/base-topology/base-storm-topology/src/main/java/org/openkilda/wfm/share/flow/resources/ResourcePool.java", "isResolved": false, "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xMFQxMDo0NTo1MFrOFnheQA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xMVQwODowNzo1OVrOFn_7kw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3Njk4NzIwMA==", "bodyText": "Why do we need to inherit this methods? As for me static utils methods are preferable here.", "url": "https://github.com/telstra/open-kilda/pull/3186#discussion_r376987200", "createdAt": "2020-02-10T10:45:50Z", "author": {"login": "rozdy"}, "path": "src-java/base-topology/base-storm-topology/src/main/java/org/openkilda/wfm/share/flow/resources/ResourcePool.java", "diffHunk": "@@ -0,0 +1,34 @@\n+/* Copyright 2020 Telstra Open Source\n+ *\n+ *   Licensed under the Apache License, Version 2.0 (the \"License\");\n+ *   you may not use this file except in compliance with the License.\n+ *   You may obtain a copy of the License at\n+ *\n+ *       http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ *   Unless required by applicable law or agreed to in writing, software\n+ *   distributed under the License is distributed on an \"AS IS\" BASIS,\n+ *   WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ *   See the License for the specific language governing permissions and\n+ *   limitations under the License.\n+ */\n+\n+package org.openkilda.wfm.share.flow.resources;\n+\n+import java.util.Random;\n+\n+public abstract class ResourcePool {\n+    /**\n+     * Return a random integer value between minValue and maxValue.\n+     */\n+    protected int computeStartValue(int minValue, int maxValue) {\n+        return new Random().ints(1, minValue, maxValue).iterator().nextInt();\n+    }\n+\n+    /**\n+     * Return a random long value between minValue and maxValue.\n+     */\n+    protected long computeStartValue(long minValue, long maxValue) {\n+        return new Random().longs(1, minValue, maxValue).iterator().nextLong();\n+    }", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ec5c518643b98a5e33e131821ca2a8e797aa4e01"}, "originalPosition": 33}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NzAxMjI2Mw==", "bodyText": "Fixed.", "url": "https://github.com/telstra/open-kilda/pull/3186#discussion_r377012263", "createdAt": "2020-02-10T11:41:06Z", "author": {"login": "dpoltavets"}, "path": "src-java/base-topology/base-storm-topology/src/main/java/org/openkilda/wfm/share/flow/resources/ResourcePool.java", "diffHunk": "@@ -0,0 +1,34 @@\n+/* Copyright 2020 Telstra Open Source\n+ *\n+ *   Licensed under the Apache License, Version 2.0 (the \"License\");\n+ *   you may not use this file except in compliance with the License.\n+ *   You may obtain a copy of the License at\n+ *\n+ *       http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ *   Unless required by applicable law or agreed to in writing, software\n+ *   distributed under the License is distributed on an \"AS IS\" BASIS,\n+ *   WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ *   See the License for the specific language governing permissions and\n+ *   limitations under the License.\n+ */\n+\n+package org.openkilda.wfm.share.flow.resources;\n+\n+import java.util.Random;\n+\n+public abstract class ResourcePool {\n+    /**\n+     * Return a random integer value between minValue and maxValue.\n+     */\n+    protected int computeStartValue(int minValue, int maxValue) {\n+        return new Random().ints(1, minValue, maxValue).iterator().nextInt();\n+    }\n+\n+    /**\n+     * Return a random long value between minValue and maxValue.\n+     */\n+    protected long computeStartValue(long minValue, long maxValue) {\n+        return new Random().longs(1, minValue, maxValue).iterator().nextLong();\n+    }", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3Njk4NzIwMA=="}, "originalCommit": {"oid": "ec5c518643b98a5e33e131821ca2a8e797aa4e01"}, "originalPosition": 33}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NzQ4NjIyNw==", "bodyText": "I believe this was a very controversial decision. Why should we expose internal pool logic as a dedicated class with static methods? To allow other classes to reuse them? But what for, if they're pool specific? I don't see any benefits in the solution with static methods vs inherited.\nThere's an option with moving the methods out of the class, create a strategy, and allow pool to choose among implementations.", "url": "https://github.com/telstra/open-kilda/pull/3186#discussion_r377486227", "createdAt": "2020-02-11T08:07:59Z", "author": {"login": "sergii-iakovenko"}, "path": "src-java/base-topology/base-storm-topology/src/main/java/org/openkilda/wfm/share/flow/resources/ResourcePool.java", "diffHunk": "@@ -0,0 +1,34 @@\n+/* Copyright 2020 Telstra Open Source\n+ *\n+ *   Licensed under the Apache License, Version 2.0 (the \"License\");\n+ *   you may not use this file except in compliance with the License.\n+ *   You may obtain a copy of the License at\n+ *\n+ *       http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ *   Unless required by applicable law or agreed to in writing, software\n+ *   distributed under the License is distributed on an \"AS IS\" BASIS,\n+ *   WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ *   See the License for the specific language governing permissions and\n+ *   limitations under the License.\n+ */\n+\n+package org.openkilda.wfm.share.flow.resources;\n+\n+import java.util.Random;\n+\n+public abstract class ResourcePool {\n+    /**\n+     * Return a random integer value between minValue and maxValue.\n+     */\n+    protected int computeStartValue(int minValue, int maxValue) {\n+        return new Random().ints(1, minValue, maxValue).iterator().nextInt();\n+    }\n+\n+    /**\n+     * Return a random long value between minValue and maxValue.\n+     */\n+    protected long computeStartValue(long minValue, long maxValue) {\n+        return new Random().longs(1, minValue, maxValue).iterator().nextLong();\n+    }", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3Njk4NzIwMA=="}, "originalCommit": {"oid": "ec5c518643b98a5e33e131821ca2a8e797aa4e01"}, "originalPosition": 33}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjMzMjEzMTI0OnYy", "diffSide": "RIGHT", "path": "src-java/kilda-persistence-api/src/main/java/org/openkilda/persistence/repositories/FlowCookieRepository.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xMFQxMDo1Mzo1MlrOFnhujg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xMFQxMTo0MToxMVrOFnjASQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3Njk5MTM3NA==", "bodyText": "Please update this section too.", "url": "https://github.com/telstra/open-kilda/pull/3186#discussion_r376991374", "createdAt": "2020-02-10T10:53:52Z", "author": {"login": "rozdy"}, "path": "src-java/kilda-persistence-api/src/main/java/org/openkilda/persistence/repositories/FlowCookieRepository.java", "diffHunk": "@@ -26,8 +26,9 @@\n      * Find an unmasked cookie which is not assigned to any flow.\n      * Use the provided {@code defaultCookie} as the first candidate.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ec5c518643b98a5e33e131821ca2a8e797aa4e01"}, "originalPosition": 2}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NzAxMjI5Nw==", "bodyText": "Fixed.", "url": "https://github.com/telstra/open-kilda/pull/3186#discussion_r377012297", "createdAt": "2020-02-10T11:41:11Z", "author": {"login": "dpoltavets"}, "path": "src-java/kilda-persistence-api/src/main/java/org/openkilda/persistence/repositories/FlowCookieRepository.java", "diffHunk": "@@ -26,8 +26,9 @@\n      * Find an unmasked cookie which is not assigned to any flow.\n      * Use the provided {@code defaultCookie} as the first candidate.", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3Njk5MTM3NA=="}, "originalCommit": {"oid": "ec5c518643b98a5e33e131821ca2a8e797aa4e01"}, "originalPosition": 2}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjMzMjEzNTA1OnYy", "diffSide": "RIGHT", "path": "src-java/kilda-persistence-api/src/main/java/org/openkilda/persistence/repositories/FlowMeterRepository.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xMFQxMDo1NTowMlrOFnhw4Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xMFQxMTo0MjoyN1rOFnjCUg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3Njk5MTk2OQ==", "bodyText": "Update param name here.", "url": "https://github.com/telstra/open-kilda/pull/3186#discussion_r376991969", "createdAt": "2020-02-10T10:55:02Z", "author": {"login": "rozdy"}, "path": "src-java/kilda-persistence-api/src/main/java/org/openkilda/persistence/repositories/FlowMeterRepository.java", "diffHunk": "@@ -40,8 +40,9 @@\n      * Use the provided {@code defaultMeterId} as the first candidate.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ec5c518643b98a5e33e131821ca2a8e797aa4e01"}, "originalPosition": 1}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NzAxMjgxOA==", "bodyText": "Fixed.", "url": "https://github.com/telstra/open-kilda/pull/3186#discussion_r377012818", "createdAt": "2020-02-10T11:42:27Z", "author": {"login": "dpoltavets"}, "path": "src-java/kilda-persistence-api/src/main/java/org/openkilda/persistence/repositories/FlowMeterRepository.java", "diffHunk": "@@ -40,8 +40,9 @@\n      * Use the provided {@code defaultMeterId} as the first candidate.", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3Njk5MTk2OQ=="}, "originalCommit": {"oid": "ec5c518643b98a5e33e131821ca2a8e797aa4e01"}, "originalPosition": 1}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjMzMjEzNjYyOnYy", "diffSide": "RIGHT", "path": "src-java/kilda-persistence-api/src/main/java/org/openkilda/persistence/repositories/TransitVlanRepository.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xMFQxMDo1NTozNFrOFnhx5Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xMFQxMTo0MjozNFrOFnjCgw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3Njk5MjIyOQ==", "bodyText": "Same here.", "url": "https://github.com/telstra/open-kilda/pull/3186#discussion_r376992229", "createdAt": "2020-02-10T10:55:34Z", "author": {"login": "rozdy"}, "path": "src-java/kilda-persistence-api/src/main/java/org/openkilda/persistence/repositories/TransitVlanRepository.java", "diffHunk": "@@ -30,8 +30,9 @@\n      * Find a transit vlan which is not assigned to any flow.\n      * Use the provided defaultVlan as the first candidate.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ec5c518643b98a5e33e131821ca2a8e797aa4e01"}, "originalPosition": 2}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NzAxMjg2Nw==", "bodyText": "Fixed.", "url": "https://github.com/telstra/open-kilda/pull/3186#discussion_r377012867", "createdAt": "2020-02-10T11:42:34Z", "author": {"login": "dpoltavets"}, "path": "src-java/kilda-persistence-api/src/main/java/org/openkilda/persistence/repositories/TransitVlanRepository.java", "diffHunk": "@@ -30,8 +30,9 @@\n      * Find a transit vlan which is not assigned to any flow.\n      * Use the provided defaultVlan as the first candidate.", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3Njk5MjIyOQ=="}, "originalCommit": {"oid": "ec5c518643b98a5e33e131821ca2a8e797aa4e01"}, "originalPosition": 2}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjMzMjEzNzI3OnYy", "diffSide": "RIGHT", "path": "src-java/kilda-persistence-api/src/main/java/org/openkilda/persistence/repositories/VxlanRepository.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xMFQxMDo1NTo0OFrOFnhyUA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xMFQxMTo0MjozOFrOFnjCmg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3Njk5MjMzNg==", "bodyText": "And here.", "url": "https://github.com/telstra/open-kilda/pull/3186#discussion_r376992336", "createdAt": "2020-02-10T10:55:48Z", "author": {"login": "rozdy"}, "path": "src-java/kilda-persistence-api/src/main/java/org/openkilda/persistence/repositories/VxlanRepository.java", "diffHunk": "@@ -28,8 +28,9 @@\n      * Find a vxlan which is not assigned to any flow.\n      * Use the provided defaultVxlan as the first candidate.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ec5c518643b98a5e33e131821ca2a8e797aa4e01"}, "originalPosition": 2}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NzAxMjg5MA==", "bodyText": "Fixed.", "url": "https://github.com/telstra/open-kilda/pull/3186#discussion_r377012890", "createdAt": "2020-02-10T11:42:38Z", "author": {"login": "dpoltavets"}, "path": "src-java/kilda-persistence-api/src/main/java/org/openkilda/persistence/repositories/VxlanRepository.java", "diffHunk": "@@ -28,8 +28,9 @@\n      * Find a vxlan which is not assigned to any flow.\n      * Use the provided defaultVxlan as the first candidate.", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3Njk5MjMzNg=="}, "originalCommit": {"oid": "ec5c518643b98a5e33e131821ca2a8e797aa4e01"}, "originalPosition": 2}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjMzMjE0MzMxOnYy", "diffSide": "RIGHT", "path": "src-java/kilda-persistence-neo4j/src/main/java/org/openkilda/persistence/repositories/impl/Neo4jFlowCookieRepository.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xMFQxMDo1Nzo0OVrOFnh2JA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xMFQxMTo0Mjo0MVrOFnjCsQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3Njk5MzMxNg==", "bodyText": "default_cookie -> min_cookie", "url": "https://github.com/telstra/open-kilda/pull/3186#discussion_r376993316", "createdAt": "2020-02-10T10:57:49Z", "author": {"login": "rozdy"}, "path": "src-java/kilda-persistence-neo4j/src/main/java/org/openkilda/persistence/repositories/impl/Neo4jFlowCookieRepository.java", "diffHunk": "@@ -52,22 +52,23 @@ public Neo4jFlowCookieRepository(Neo4jSessionFactory sessionFactory, Transaction\n     }\n \n     @Override\n-    public Optional<Long> findUnassignedCookie(long defaultCookie) {\n+    public Optional<Long> findUnassignedCookie(long minCookie, long maxCookie) {\n         Map<String, Object> parameters = ImmutableMap.of(\n-                \"default_cookie\", defaultCookie);\n+                \"min_cookie\", minCookie,\n+                \"max_cookie\", maxCookie);\n \n         // The query returns the default_cookie if it's not used in any flow_cookie,", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ec5c518643b98a5e33e131821ca2a8e797aa4e01"}, "originalPosition": 11}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NzAxMjkxMw==", "bodyText": "Fixed.", "url": "https://github.com/telstra/open-kilda/pull/3186#discussion_r377012913", "createdAt": "2020-02-10T11:42:41Z", "author": {"login": "dpoltavets"}, "path": "src-java/kilda-persistence-neo4j/src/main/java/org/openkilda/persistence/repositories/impl/Neo4jFlowCookieRepository.java", "diffHunk": "@@ -52,22 +52,23 @@ public Neo4jFlowCookieRepository(Neo4jSessionFactory sessionFactory, Transaction\n     }\n \n     @Override\n-    public Optional<Long> findUnassignedCookie(long defaultCookie) {\n+    public Optional<Long> findUnassignedCookie(long minCookie, long maxCookie) {\n         Map<String, Object> parameters = ImmutableMap.of(\n-                \"default_cookie\", defaultCookie);\n+                \"min_cookie\", minCookie,\n+                \"max_cookie\", maxCookie);\n \n         // The query returns the default_cookie if it's not used in any flow_cookie,", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3Njk5MzMxNg=="}, "originalCommit": {"oid": "ec5c518643b98a5e33e131821ca2a8e797aa4e01"}, "originalPosition": 11}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjMzMjE0NTY0OnYy", "diffSide": "RIGHT", "path": "src-java/kilda-persistence-neo4j/src/main/java/org/openkilda/persistence/repositories/impl/Neo4jFlowMeterRepository.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xMFQxMDo1ODoyOVrOFnh3fw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xMFQxMTo0Mjo0OFrOFnjC3g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3Njk5MzY2Mw==", "bodyText": "default_meter -> min_meter_id", "url": "https://github.com/telstra/open-kilda/pull/3186#discussion_r376993663", "createdAt": "2020-02-10T10:58:29Z", "author": {"login": "rozdy"}, "path": "src-java/kilda-persistence-neo4j/src/main/java/org/openkilda/persistence/repositories/impl/Neo4jFlowMeterRepository.java", "diffHunk": "@@ -77,24 +77,25 @@ public Neo4jFlowMeterRepository(Neo4jSessionFactory sessionFactory, TransactionM\n     }\n \n     @Override\n-    public Optional<MeterId> findUnassignedMeterId(SwitchId switchId, MeterId defaultMeterId) {\n+    public Optional<MeterId> findUnassignedMeterId(SwitchId switchId, MeterId minMeterId, MeterId maxMeterId) {\n         Map<String, Object> parameters = ImmutableMap.of(\n-                \"default_meter\", defaultMeterId.getValue(),\n+                \"min_meter\", minMeterId.getValue(),\n+                \"max_meter\", maxMeterId.getValue(),\n                 \"switch_id\", switchId.toString()\n         );\n \n         // The query returns the default_meter if it's not used in any flow_meter,", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ec5c518643b98a5e33e131821ca2a8e797aa4e01"}, "originalPosition": 13}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NzAxMjk1OA==", "bodyText": "Fixed.", "url": "https://github.com/telstra/open-kilda/pull/3186#discussion_r377012958", "createdAt": "2020-02-10T11:42:48Z", "author": {"login": "dpoltavets"}, "path": "src-java/kilda-persistence-neo4j/src/main/java/org/openkilda/persistence/repositories/impl/Neo4jFlowMeterRepository.java", "diffHunk": "@@ -77,24 +77,25 @@ public Neo4jFlowMeterRepository(Neo4jSessionFactory sessionFactory, TransactionM\n     }\n \n     @Override\n-    public Optional<MeterId> findUnassignedMeterId(SwitchId switchId, MeterId defaultMeterId) {\n+    public Optional<MeterId> findUnassignedMeterId(SwitchId switchId, MeterId minMeterId, MeterId maxMeterId) {\n         Map<String, Object> parameters = ImmutableMap.of(\n-                \"default_meter\", defaultMeterId.getValue(),\n+                \"min_meter\", minMeterId.getValue(),\n+                \"max_meter\", maxMeterId.getValue(),\n                 \"switch_id\", switchId.toString()\n         );\n \n         // The query returns the default_meter if it's not used in any flow_meter,", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3Njk5MzY2Mw=="}, "originalCommit": {"oid": "ec5c518643b98a5e33e131821ca2a8e797aa4e01"}, "originalPosition": 13}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjMzMjE0NjkzOnYy", "diffSide": "RIGHT", "path": "src-java/kilda-persistence-neo4j/src/main/java/org/openkilda/persistence/repositories/impl/Neo4jTransitVlanRepository.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xMFQxMDo1ODo1MVrOFnh4PQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xMFQxMTo0Mjo1MVrOFnjC8Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3Njk5Mzg1Mw==", "bodyText": "default_vlan -> min_vlan", "url": "https://github.com/telstra/open-kilda/pull/3186#discussion_r376993853", "createdAt": "2020-02-10T10:58:51Z", "author": {"login": "rozdy"}, "path": "src-java/kilda-persistence-neo4j/src/main/java/org/openkilda/persistence/repositories/impl/Neo4jTransitVlanRepository.java", "diffHunk": "@@ -77,22 +77,23 @@ public Neo4jTransitVlanRepository(Neo4jSessionFactory sessionFactory, Transactio\n     }\n \n     @Override\n-    public Optional<Integer> findUnassignedTransitVlan(int defaultVlan) {\n+    public Optional<Integer> findUnassignedTransitVlan(int minVlan, int maxVlan) {\n         Map<String, Object> parameters = ImmutableMap.of(\n-                \"default_vlan\", defaultVlan);\n+                \"min_vlan\", minVlan,\n+                \"max_vlan\", maxVlan);\n \n         // The query returns the default_vlan if it's not used in any transit_vlan,", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ec5c518643b98a5e33e131821ca2a8e797aa4e01"}, "originalPosition": 11}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NzAxMjk3Nw==", "bodyText": "Fixed.", "url": "https://github.com/telstra/open-kilda/pull/3186#discussion_r377012977", "createdAt": "2020-02-10T11:42:51Z", "author": {"login": "dpoltavets"}, "path": "src-java/kilda-persistence-neo4j/src/main/java/org/openkilda/persistence/repositories/impl/Neo4jTransitVlanRepository.java", "diffHunk": "@@ -77,22 +77,23 @@ public Neo4jTransitVlanRepository(Neo4jSessionFactory sessionFactory, Transactio\n     }\n \n     @Override\n-    public Optional<Integer> findUnassignedTransitVlan(int defaultVlan) {\n+    public Optional<Integer> findUnassignedTransitVlan(int minVlan, int maxVlan) {\n         Map<String, Object> parameters = ImmutableMap.of(\n-                \"default_vlan\", defaultVlan);\n+                \"min_vlan\", minVlan,\n+                \"max_vlan\", maxVlan);\n \n         // The query returns the default_vlan if it's not used in any transit_vlan,", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3Njk5Mzg1Mw=="}, "originalCommit": {"oid": "ec5c518643b98a5e33e131821ca2a8e797aa4e01"}, "originalPosition": 11}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjMzMjE0ODA0OnYy", "diffSide": "RIGHT", "path": "src-java/kilda-persistence-neo4j/src/main/java/org/openkilda/persistence/repositories/impl/Neo4jVxlanRepository.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xMFQxMDo1OToxMFrOFnh42A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xMFQxMTo0Mjo1NVrOFnjDEQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3Njk5NDAwOA==", "bodyText": "default_vni -> min_vni", "url": "https://github.com/telstra/open-kilda/pull/3186#discussion_r376994008", "createdAt": "2020-02-10T10:59:10Z", "author": {"login": "rozdy"}, "path": "src-java/kilda-persistence-neo4j/src/main/java/org/openkilda/persistence/repositories/impl/Neo4jVxlanRepository.java", "diffHunk": "@@ -50,22 +50,23 @@ public Neo4jVxlanRepository(Neo4jSessionFactory sessionFactory, TransactionManag\n     }\n \n     @Override\n-    public Optional<Integer> findUnassignedVxlan(int defaultVni) {\n+    public Optional<Integer> findUnassignedVxlan(int minVni, int maxVni) {\n         Map<String, Object> parameters = ImmutableMap.of(\n-                \"default_vni\", defaultVni);\n+                \"min_vni\", minVni,\n+                \"max_vni\", maxVni);\n \n         // The query returns the default_vni if it's not used in any vxlan,", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ec5c518643b98a5e33e131821ca2a8e797aa4e01"}, "originalPosition": 11}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NzAxMzAwOQ==", "bodyText": "Fixed.", "url": "https://github.com/telstra/open-kilda/pull/3186#discussion_r377013009", "createdAt": "2020-02-10T11:42:55Z", "author": {"login": "dpoltavets"}, "path": "src-java/kilda-persistence-neo4j/src/main/java/org/openkilda/persistence/repositories/impl/Neo4jVxlanRepository.java", "diffHunk": "@@ -50,22 +50,23 @@ public Neo4jVxlanRepository(Neo4jSessionFactory sessionFactory, TransactionManag\n     }\n \n     @Override\n-    public Optional<Integer> findUnassignedVxlan(int defaultVni) {\n+    public Optional<Integer> findUnassignedVxlan(int minVni, int maxVni) {\n         Map<String, Object> parameters = ImmutableMap.of(\n-                \"default_vni\", defaultVni);\n+                \"min_vni\", minVni,\n+                \"max_vni\", maxVni);\n \n         // The query returns the default_vni if it's not used in any vxlan,", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3Njk5NDAwOA=="}, "originalCommit": {"oid": "ec5c518643b98a5e33e131821ca2a8e797aa4e01"}, "originalPosition": 11}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjMzMjIwOTU5OnYy", "diffSide": "RIGHT", "path": "src-java/base-topology/base-storm-topology/src/test/java/org/openkilda/wfm/share/flow/resources/MeterPoolTest.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xMFQxMToyMDowM1rOFnieGQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xMFQxMToyMDowM1rOFnieGQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NzAwMzU0NQ==", "bodyText": "you removed deallocate() call.", "url": "https://github.com/telstra/open-kilda/pull/3186#discussion_r377003545", "createdAt": "2020-02-10T11:20:03Z", "author": {"login": "niksv"}, "path": "src-java/base-topology/base-storm-topology/src/test/java/org/openkilda/wfm/share/flow/resources/MeterPoolTest.java", "diffHunk": "@@ -56,26 +58,11 @@ public void setUp() {\n \n     @Test\n     public void meterPoolTest() {\n-        long first = meterPool.allocate(SWITCH_ID, FLOW_1, PATH_ID_1).getValue();\n-        assertEquals(31, first);\n-\n-        long second = meterPool.allocate(SWITCH_ID, FLOW_2, PATH_ID_2).getValue();\n-        assertEquals(32, second);\n-\n-        long third = meterPool.allocate(SWITCH_ID, FLOW_3, PATH_ID_3).getValue();\n-        assertEquals(33, third);\n-\n-        meterPool.deallocate(PATH_ID_3);\n-        meterPool.deallocate(PATH_ID_2);\n-\n-        long fourth = meterPool.allocate(SWITCH_ID, \"flow_4\", new PathId(\"path_4\")).getValue();\n-        assertEquals(32, fourth);\n-\n-        long fifth = meterPool.allocate(SWITCH_ID, \"flow_5\", new PathId(\"path_5\")).getValue();\n-        assertEquals(33, fifth);\n-\n-        long sixth = meterPool.allocate(SWITCH_ID, \"flow_6\", new PathId(\"path_6\")).getValue();\n-        assertEquals(34, sixth);\n+        Set<MeterId> cookies = new HashSet<>();\n+        for (int i = 31; i < 41; i++) {\n+            cookies.add(meterPool.allocate(SWITCH_ID, format(\"flow_%d\", i), new PathId(format(\"path_%d\", i))));\n+        }\n+        assertEquals(10, cookies.size());", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ec5c518643b98a5e33e131821ca2a8e797aa4e01"}, "originalPosition": 37}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjMzMjIxMTA4OnYy", "diffSide": "RIGHT", "path": "src-java/base-topology/base-storm-topology/src/test/java/org/openkilda/wfm/share/flow/resources/transitvlan/TransitVlanPoolTest.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xMFQxMToyMDo0MFrOFnifCw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xMFQxMToyMDo0MFrOFnifCw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NzAwMzc4Nw==", "bodyText": "you removed deallocate too", "url": "https://github.com/telstra/open-kilda/pull/3186#discussion_r377003787", "createdAt": "2020-02-10T11:20:40Z", "author": {"login": "niksv"}, "path": "src-java/base-topology/base-storm-topology/src/test/java/org/openkilda/wfm/share/flow/resources/transitvlan/TransitVlanPoolTest.java", "diffHunk": "@@ -49,34 +48,14 @@ public void setUp() {\n     }\n \n     @Test\n-    public void vlanIdPool() {\n-        Flow flow = Flow.builder().flowId(\"flow_1\").srcSwitch(switch1).destSwitch(switch2).build();\n-        int first = transitVlanPool.allocate(flow, new PathId(\"path_1\"), new PathId(\"opposit_1\"))\n-                .getTransitVlan().getVlan();\n-        assertEquals(100, first);\n-\n-        PathId path2 = new PathId(\"path_2\");\n-\n-        flow.setFlowId(\"flow_2\");\n-        int second = transitVlanPool.allocate(flow, path2, new PathId(\"opposit_2\")).getTransitVlan().getVlan();\n-        assertEquals(101, second);\n-\n-        flow.setFlowId(\"flow_3\");\n-        int third = transitVlanPool.allocate(flow, new PathId(\"path_3\"), new PathId(\"opposit_3\"))\n-                .getTransitVlan().getVlan();\n-        assertEquals(102, third);\n-\n-        transitVlanPool.deallocate(path2);\n-\n-        flow.setFlowId(\"flow_4\");\n-        int fourth = transitVlanPool.allocate(flow, new PathId(\"path_4\"), new PathId(\"opposit_4\"))\n-                .getTransitVlan().getVlan();\n-        assertEquals(101, fourth);\n-\n-        flow.setFlowId(\"flow_5\");\n-        int fifth = transitVlanPool.allocate(flow, new PathId(\"path_5\"), new PathId(\"opposit_5\"))\n-                .getTransitVlan().getVlan();\n-        assertEquals(103, fifth);\n+    public void vlanPoolTest() {\n+        for (int i = 100; i <= 110; i++) {\n+            Flow flow = Flow.builder().flowId(format(\"flow_%d\", i)).srcSwitch(switch1).destSwitch(switch2).build();\n+            assertTrue(transitVlanPool.allocate(\n+                    flow,\n+                    new PathId(format(\"path_%d\", i)),\n+                    new PathId(format(\"opposite_dummy_%d\", i))).getTransitVlan().getVlan() > 0);\n+        }", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ec5c518643b98a5e33e131821ca2a8e797aa4e01"}, "originalPosition": 47}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjMzNTMyMTQ0OnYy", "diffSide": "RIGHT", "path": "src-java/base-topology/base-storm-topology/src/main/java/org/openkilda/wfm/share/flow/resources/ResourceUtils.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xMVQwODoxNTo0NVrOFoAFgw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xMVQwODoxNTo0NVrOFoAFgw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NzQ4ODc3MQ==", "bodyText": "Please, check my comment about the class.", "url": "https://github.com/telstra/open-kilda/pull/3186#discussion_r377488771", "createdAt": "2020-02-11T08:15:45Z", "author": {"login": "sergii-iakovenko"}, "path": "src-java/base-topology/base-storm-topology/src/main/java/org/openkilda/wfm/share/flow/resources/ResourceUtils.java", "diffHunk": "@@ -0,0 +1,38 @@\n+/* Copyright 2020 Telstra Open Source\n+ *\n+ *   Licensed under the Apache License, Version 2.0 (the \"License\");\n+ *   you may not use this file except in compliance with the License.\n+ *   You may obtain a copy of the License at\n+ *\n+ *       http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ *   Unless required by applicable law or agreed to in writing, software\n+ *   distributed under the License is distributed on an \"AS IS\" BASIS,\n+ *   WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ *   See the License for the specific language governing permissions and\n+ *   limitations under the License.\n+ */\n+\n+package org.openkilda.wfm.share.flow.resources;\n+\n+import java.util.Random;\n+\n+public final class ResourceUtils {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "1f1cb93b6f319a553c2902cc594dfb9c9eed2333"}, "originalPosition": 20}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjMzNTMyNDU5OnYy", "diffSide": "RIGHT", "path": "src-java/base-topology/base-storm-topology/src/test/java/org/openkilda/wfm/share/flow/resources/CookiePoolTest.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xMVQwODoxNzowNFrOFoAHVA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xMVQxMDoxNDozNlrOFoDYYA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NzQ4OTIzNg==", "bodyText": "The test became shallow: it doesn't verify the allocated values and doesn't check deallocation. I think additional tests should be added to cover this.", "url": "https://github.com/telstra/open-kilda/pull/3186#discussion_r377489236", "createdAt": "2020-02-11T08:17:04Z", "author": {"login": "sergii-iakovenko"}, "path": "src-java/base-topology/base-storm-topology/src/test/java/org/openkilda/wfm/share/flow/resources/CookiePoolTest.java", "diffHunk": "@@ -35,26 +39,16 @@ public void setUp() {\n \n     @Test\n     public void cookiePool() {\n-        long first = cookiePool.allocate(\"flow_1\");\n-        assertEquals(5, first);\n-\n-        long second = cookiePool.allocate(\"flow_2\");\n-        assertEquals(6, second);\n-\n-        long third = cookiePool.allocate(\"flow_3\");\n-        assertEquals(7, third);\n-\n-        cookiePool.deallocate(second);\n-        long fourth = cookiePool.allocate(\"flow_4\");\n-        assertEquals(6, fourth);\n-\n-        long fifth = cookiePool.allocate(\"flow_5\");\n-        assertEquals(8, fifth);\n+        Set<Long> cookies = new HashSet<>();\n+        for (int i = 5; i <= 25; i++) {\n+            cookies.add(cookiePool.allocate(format(\"flow_%d\", i)));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "1f1cb93b6f319a553c2902cc594dfb9c9eed2333"}, "originalPosition": 39}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NzU0Mjc1Mg==", "bodyText": "Tests have been added.", "url": "https://github.com/telstra/open-kilda/pull/3186#discussion_r377542752", "createdAt": "2020-02-11T10:14:36Z", "author": {"login": "dpoltavets"}, "path": "src-java/base-topology/base-storm-topology/src/test/java/org/openkilda/wfm/share/flow/resources/CookiePoolTest.java", "diffHunk": "@@ -35,26 +39,16 @@ public void setUp() {\n \n     @Test\n     public void cookiePool() {\n-        long first = cookiePool.allocate(\"flow_1\");\n-        assertEquals(5, first);\n-\n-        long second = cookiePool.allocate(\"flow_2\");\n-        assertEquals(6, second);\n-\n-        long third = cookiePool.allocate(\"flow_3\");\n-        assertEquals(7, third);\n-\n-        cookiePool.deallocate(second);\n-        long fourth = cookiePool.allocate(\"flow_4\");\n-        assertEquals(6, fourth);\n-\n-        long fifth = cookiePool.allocate(\"flow_5\");\n-        assertEquals(8, fifth);\n+        Set<Long> cookies = new HashSet<>();\n+        for (int i = 5; i <= 25; i++) {\n+            cookies.add(cookiePool.allocate(format(\"flow_%d\", i)));", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NzQ4OTIzNg=="}, "originalCommit": {"oid": "1f1cb93b6f319a553c2902cc594dfb9c9eed2333"}, "originalPosition": 39}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2127, "cost": 1, "resetAt": "2021-11-13T14:23:39Z"}}}