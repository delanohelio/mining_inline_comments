{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTMxMDA0MjQw", "number": 3899, "title": "refactor vxlan related tests", "bodyText": "", "createdAt": "2020-12-02T13:07:00Z", "url": "https://github.com/telstra/open-kilda/pull/3899", "merged": true, "mergeCommit": {"oid": "6c38a29c293c91025b21f98d793bf26f486ba14a"}, "closed": true, "closedAt": "2020-12-11T10:30:11Z", "author": {"login": "andriidovhan"}, "timelineItems": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdkvSFaAFqTU0ODk2MDAzMA==", "endCursor": "Y3Vyc29yOnYyOpPPAAABdk2iSZABqjQwOTYyMTcyMjU=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTQ4OTYwMDMw", "url": "https://github.com/telstra/open-kilda/pull/3899#pullrequestreview-548960030", "createdAt": "2020-12-10T08:39:05Z", "commit": {"oid": "51a5bbc628a609d28885ec6f2acab005aab11425"}, "state": "APPROVED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xMFQwODozOTowNVrOIC9fjQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xMFQwODo0MjoyM1rOIC9nxw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzOTk3NTU2NQ==", "bodyText": "not sure why it's required here. I don't see any vxlan context in this test", "url": "https://github.com/telstra/open-kilda/pull/3899#discussion_r539975565", "createdAt": "2020-12-10T08:39:05Z", "author": {"login": "rtretyak"}, "path": "src-java/testing/functional-tests/src/test/groovy/org/openkilda/functionaltests/spec/flows/QinQFlowSpec.groovy", "diffHunk": "@@ -842,7 +842,9 @@ class QinQFlowSpec extends HealthCheckSpecification {\n         assumeTrue(\"Unable to find required switches in topology\", (allTraffGenSwitches.size() > 1))\n         def swP = topologyHelper.getAllNeighboringSwitchPairs().find {\n             [it.src, it.dst].every { sw ->\n-                sw.dpId in allTraffGenSwitches*.dpId && northbound.getSwitchProperties(sw.dpId).multiTable\n+                sw.dpId in allTraffGenSwitches*.dpId && northbound.getSwitchProperties(sw.dpId).multiTable &&\n+                        northbound.getSwitchProperties(sw.dpId).supportedTransitEncapsulation\n+                                .contains(FlowEncapsulationType.VXLAN.toString().toLowerCase())", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "51a5bbc628a609d28885ec6f2acab005aab11425"}, "originalPosition": 7}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzOTk3NzY3MQ==", "bodyText": "isVxlanEnabled ?", "url": "https://github.com/telstra/open-kilda/pull/3899#discussion_r539977671", "createdAt": "2020-12-10T08:42:23Z", "author": {"login": "rtretyak"}, "path": "src-java/testing/functional-tests/src/test/groovy/org/openkilda/functionaltests/spec/flows/VxlanFlowV2Spec.groovy", "diffHunk": "@@ -241,14 +242,18 @@ class VxlanFlowV2Spec extends HealthCheckSpecification {\n     @Tidy\n     @Tags(HARDWARE)\n     def \"Able to CRUD a vxlan flow with protected path\"() {\n-        given: \"Two active Noviflow switches with two available path at least\"\n-        def switchPair = topologyHelper.getAllNeighboringSwitchPairs().find {\n-            it.src.noviflow && !it.src.wb5164 && it.dst.noviflow && !it.dst.wb5164 &&\n-                    it.paths.unique(false) { a, b -> a.intersect(b) == [] ? 1 : 0 }.size() >= 2\n+        given: \"Two active VXLAN supported switches with two available path at least\"\n+        def switchPair = topologyHelper.getAllNeighboringSwitchPairs().find { swP ->\n+            [swP.src, swP.dst].every { sw -> isVxlanEnabled(sw.dpId) } && swP.paths.unique(false) {\n+                a, b -> a.intersect(b) == [] ? 1 : 0\n+            }.size() >= 2\n         } ?: assumeTrue(\"No suiting switches found\", false)\n \n         def availablePaths = switchPair.paths.findAll { path ->\n-            pathHelper.getInvolvedSwitches(path).every { it.noviflow && !it.wb5164 }\n+            pathHelper.getInvolvedSwitches(path).every {\n+                northbound.getSwitchProperties(it.dpId).supportedTransitEncapsulation", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "51a5bbc628a609d28885ec6f2acab005aab11425"}, "originalPosition": 37}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "51a5bbc628a609d28885ec6f2acab005aab11425", "author": {"user": {"login": "andriidovhan", "name": "AndriiDovhan"}}, "url": "https://github.com/telstra/open-kilda/commit/51a5bbc628a609d28885ec6f2acab005aab11425", "committedDate": "2020-12-02T12:49:58Z", "message": "refactor vxlan related tests"}, "afterCommit": {"oid": "6254aa4c5dcac8bda602c1b57fd06a90e8d18f03", "author": {"user": {"login": "andriidovhan", "name": "AndriiDovhan"}}, "url": "https://github.com/telstra/open-kilda/commit/6254aa4c5dcac8bda602c1b57fd06a90e8d18f03", "committedDate": "2020-12-10T10:14:46Z", "message": "refactor vxlan related tests"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "8c72b58a35eb8c6e764e6109100b47cfb7fa7f07", "author": {"user": {"login": "andriidovhan", "name": "AndriiDovhan"}}, "url": "https://github.com/telstra/open-kilda/commit/8c72b58a35eb8c6e764e6109100b47cfb7fa7f07", "committedDate": "2020-12-10T17:10:36Z", "message": "refactor vxlan related tests"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "6254aa4c5dcac8bda602c1b57fd06a90e8d18f03", "author": {"user": {"login": "andriidovhan", "name": "AndriiDovhan"}}, "url": "https://github.com/telstra/open-kilda/commit/6254aa4c5dcac8bda602c1b57fd06a90e8d18f03", "committedDate": "2020-12-10T10:14:46Z", "message": "refactor vxlan related tests"}, "afterCommit": {"oid": "8c72b58a35eb8c6e764e6109100b47cfb7fa7f07", "author": {"user": {"login": "andriidovhan", "name": "AndriiDovhan"}}, "url": "https://github.com/telstra/open-kilda/commit/8c72b58a35eb8c6e764e6109100b47cfb7fa7f07", "committedDate": "2020-12-10T17:10:36Z", "message": "refactor vxlan related tests"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3785, "cost": 1, "resetAt": "2021-11-02T12:20:56Z"}}}