{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDM3NzcxNzI4", "number": 3554, "title": "Add replug tests for round-trip case and no portDown case", "bodyText": "", "createdAt": "2020-06-22T08:26:29Z", "url": "https://github.com/telstra/open-kilda/pull/3554", "merged": true, "mergeCommit": {"oid": "517f6ba46ed117703bfea712bcc7e4d37a8e1172"}, "closed": true, "closedAt": "2020-07-20T08:46:10Z", "author": {"login": "rtretyak"}, "timelineItems": {"totalCount": 19, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABctt-DjgFqTQzNDc4MjA1OQ==", "endCursor": "Y3Vyc29yOnYyOpPPAAABc018NwgBqjM1NDQxMzIxMTQ=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDM0NzgyMDU5", "url": "https://github.com/telstra/open-kilda/pull/3554#pullrequestreview-434782059", "createdAt": "2020-06-22T10:06:11Z", "commit": {"oid": "906b763dcd337998bc0c81c82fb5439d22d92a80"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yMlQxMDowNjoxMVrOGm6Mkw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yMlQxMDowNjoxMVrOGm6Mkw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MzQ1MjU2Mw==", "bodyText": "Why do you need NOVIFLOW_COPY_FIELD? Do you need RTL for the non-connected link?\nIf so, let's add this info into the step description/assumeTrue", "url": "https://github.com/telstra/open-kilda/pull/3554#discussion_r443452563", "createdAt": "2020-06-22T10:06:11Z", "author": {"login": "andriidovhan"}, "path": "src-java/testing/functional-tests/src/test/groovy/org/openkilda/functionaltests/spec/links/IslReplugSpec.groovy", "diffHunk": "@@ -21,11 +24,63 @@ import spock.lang.Narrative\n import java.util.concurrent.TimeUnit\n \n @Narrative(\"Verify scenarios around replugging ISLs between different switches/ports.\")\n+@Tags([TOPOLOGY_DEPENDENT])\n class IslReplugSpec extends HealthCheckSpecification {\n \n     @Value('${opentsdb.metric.prefix}')\n     String metricPrefix\n \n+    def \"Roundtrip ISL status changes to MOVED when replugging it into another switch\"() {\n+        given: \"A connected a-switch link, roundtrip-enabled\"\n+        def isl = topology.islsForActiveSwitches.find {\n+            it.aswitch?.inPort && it.aswitch?.outPort &&\n+                    it.srcSwitch.features.contains(SwitchFeature.NOVIFLOW_COPY_FIELD) &&\n+                    it.dstSwitch.features.contains(SwitchFeature.NOVIFLOW_COPY_FIELD)\n+        }\n+        assumeTrue(\"Wasn't able to find enough of required a-switch links with round-trip\", isl.asBoolean())\n+\n+        and: \"A non-connected a-switch link\"\n+        def notConnectedIsl = topology.notConnectedIsls.find {\n+            it.srcSwitch != isl.srcSwitch &&\n+                    it.srcSwitch.features.contains(SwitchFeature.NOVIFLOW_COPY_FIELD)", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "906b763dcd337998bc0c81c82fb5439d22d92a80"}, "originalPosition": 34}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "906b763dcd337998bc0c81c82fb5439d22d92a80", "author": {"user": {"login": "rtretyak", "name": "Roman Tretiak"}}, "url": "https://github.com/telstra/open-kilda/commit/906b763dcd337998bc0c81c82fb5439d22d92a80", "committedDate": "2020-06-22T07:54:14Z", "message": "Add replug tests for round-trip case and no portDown case"}, "afterCommit": {"oid": "eaca9a8dfabe748838fdce04aca7f02975336b02", "author": {"user": {"login": "rtretyak", "name": "Roman Tretiak"}}, "url": "https://github.com/telstra/open-kilda/commit/eaca9a8dfabe748838fdce04aca7f02975336b02", "committedDate": "2020-06-22T10:09:42Z", "message": "Add replug tests for round-trip case and no portDown case"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDM0Nzg0NzE4", "url": "https://github.com/telstra/open-kilda/pull/3554#pullrequestreview-434784718", "createdAt": "2020-06-22T10:09:59Z", "commit": {"oid": "906b763dcd337998bc0c81c82fb5439d22d92a80"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yMlQxMDoxMDo0MVrOGm6V_g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yMlQxMDoxMDo0MVrOGm6V_g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MzQ1NDk3NA==", "bodyText": "How about validating notConnectedIsl.srcSwitch ?", "url": "https://github.com/telstra/open-kilda/pull/3554#discussion_r443454974", "createdAt": "2020-06-22T10:10:41Z", "author": {"login": "andriidovhan"}, "path": "src-java/testing/functional-tests/src/test/groovy/org/openkilda/functionaltests/spec/links/IslReplugSpec.groovy", "diffHunk": "@@ -21,11 +24,63 @@ import spock.lang.Narrative\n import java.util.concurrent.TimeUnit\n \n @Narrative(\"Verify scenarios around replugging ISLs between different switches/ports.\")\n+@Tags([TOPOLOGY_DEPENDENT])\n class IslReplugSpec extends HealthCheckSpecification {\n \n     @Value('${opentsdb.metric.prefix}')\n     String metricPrefix\n \n+    def \"Round-trip ISL status changes to MOVED when replugging it into another switch\"() {\n+        given: \"A connected a-switch link, round-trip-enabled\"\n+        def isl = topology.islsForActiveSwitches.find {\n+            it.aswitch?.inPort && it.aswitch?.outPort &&\n+                    it.srcSwitch.features.contains(SwitchFeature.NOVIFLOW_COPY_FIELD) &&\n+                    it.dstSwitch.features.contains(SwitchFeature.NOVIFLOW_COPY_FIELD)\n+        }\n+        assumeTrue(\"Wasn't able to find enough of required a-switch links with round-trip\", isl.asBoolean())\n+\n+        and: \"A non-connected a-switch link with round-trip support\"\n+        def notConnectedIsl = topology.notConnectedIsls.find {\n+            it.srcSwitch != isl.srcSwitch &&\n+                    it.srcSwitch.features.contains(SwitchFeature.NOVIFLOW_COPY_FIELD)\n+        }\n+        assumeTrue(\"Wasn't able to find enough not connected a-switch links\", notConnectedIsl.asBoolean())\n+\n+        when: \"Replug one end of the connected link to the not connected one\"\n+        def newIsl = islUtils.replug(isl, false, notConnectedIsl, true, false)\n+\n+        then: \"Replugged ISL status changes to MOVED\"\n+        islUtils.waitForIslStatus([isl, isl.reversed], MOVED)\n+\n+        and: \"New ISL becomes DISCOVERED\"\n+        islUtils.waitForIslStatus([newIsl, newIsl.reversed], DISCOVERED)\n+\n+        when: \"Replug the link back where it was\"\n+        islUtils.replug(newIsl, true, isl, false, true)\n+\n+        then: \"Original ISL becomes DISCOVERED again\"\n+        islUtils.waitForIslStatus([isl, isl.reversed], DISCOVERED)\n+\n+        and: \"Replugged ISL status changes to MOVED\"\n+        islUtils.waitForIslStatus([newIsl, newIsl.reversed], MOVED)\n+\n+        when: \"Remove the MOVED ISL\"\n+        assert northbound.deleteLink(islUtils.toLinkParameters(newIsl)).size() == 2\n+\n+        then: \"Moved ISL is removed\"\n+        Wrappers.wait(WAIT_OFFSET) {\n+            assert !islUtils.getIslInfo(newIsl).isPresent()\n+            assert !islUtils.getIslInfo(newIsl.reversed).isPresent()\n+        }\n+\n+        and: \"The src and dst switches of the isl pass switch validation\"\n+        [isl.srcSwitch.dpId, isl.dstSwitch.dpId].each { swId ->", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "eaca9a8dfabe748838fdce04aca7f02975336b02"}, "originalPosition": 66}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "eaca9a8dfabe748838fdce04aca7f02975336b02", "author": {"user": {"login": "rtretyak", "name": "Roman Tretiak"}}, "url": "https://github.com/telstra/open-kilda/commit/eaca9a8dfabe748838fdce04aca7f02975336b02", "committedDate": "2020-06-22T10:09:42Z", "message": "Add replug tests for round-trip case and no portDown case"}, "afterCommit": {"oid": "95cafae7858889b925710fa1555078259e58e01d", "author": {"user": {"login": "rtretyak", "name": "Roman Tretiak"}}, "url": "https://github.com/telstra/open-kilda/commit/95cafae7858889b925710fa1555078259e58e01d", "committedDate": "2020-06-22T10:14:02Z", "message": "Add replug tests for round-trip case and no portDown case"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDM0Nzk1Mzkw", "url": "https://github.com/telstra/open-kilda/pull/3554#pullrequestreview-434795390", "createdAt": "2020-06-22T10:25:52Z", "commit": {"oid": "95cafae7858889b925710fa1555078259e58e01d"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDM1ODAyMTU2", "url": "https://github.com/telstra/open-kilda/pull/3554#pullrequestreview-435802156", "createdAt": "2020-06-23T13:49:54Z", "commit": {"oid": "95cafae7858889b925710fa1555078259e58e01d"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "95cafae7858889b925710fa1555078259e58e01d", "author": {"user": {"login": "rtretyak", "name": "Roman Tretiak"}}, "url": "https://github.com/telstra/open-kilda/commit/95cafae7858889b925710fa1555078259e58e01d", "committedDate": "2020-06-22T10:14:02Z", "message": "Add replug tests for round-trip case and no portDown case"}, "afterCommit": {"oid": "f60a19aeb52bdb89b3c1301c51e560343732a7c8", "author": {"user": {"login": "rtretyak", "name": "Roman Tretiak"}}, "url": "https://github.com/telstra/open-kilda/commit/f60a19aeb52bdb89b3c1301c51e560343732a7c8", "committedDate": "2020-06-25T11:27:25Z", "message": "Update ISL replug tests with round-trip scenarios"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "f60a19aeb52bdb89b3c1301c51e560343732a7c8", "author": {"user": {"login": "rtretyak", "name": "Roman Tretiak"}}, "url": "https://github.com/telstra/open-kilda/commit/f60a19aeb52bdb89b3c1301c51e560343732a7c8", "committedDate": "2020-06-25T11:27:25Z", "message": "Update ISL replug tests with round-trip scenarios"}, "afterCommit": {"oid": "7dac5b1a7f5a369de8ca4b6051807e1467e244d6", "author": {"user": {"login": "rtretyak", "name": "Roman Tretiak"}}, "url": "https://github.com/telstra/open-kilda/commit/7dac5b1a7f5a369de8ca4b6051807e1467e244d6", "committedDate": "2020-06-25T11:31:39Z", "message": "Update ISL replug tests with round-trip scenarios"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "7dac5b1a7f5a369de8ca4b6051807e1467e244d6", "author": {"user": {"login": "rtretyak", "name": "Roman Tretiak"}}, "url": "https://github.com/telstra/open-kilda/commit/7dac5b1a7f5a369de8ca4b6051807e1467e244d6", "committedDate": "2020-06-25T11:31:39Z", "message": "Update ISL replug tests with round-trip scenarios"}, "afterCommit": {"oid": "94aeb55d6a5cf88a8a2d1f17af34021fe3c2abdf", "author": {"user": {"login": "rtretyak", "name": "Roman Tretiak"}}, "url": "https://github.com/telstra/open-kilda/commit/94aeb55d6a5cf88a8a2d1f17af34021fe3c2abdf", "committedDate": "2020-06-25T11:37:51Z", "message": "Update ISL replug tests with round-trip scenarios"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "94aeb55d6a5cf88a8a2d1f17af34021fe3c2abdf", "author": {"user": {"login": "rtretyak", "name": "Roman Tretiak"}}, "url": "https://github.com/telstra/open-kilda/commit/94aeb55d6a5cf88a8a2d1f17af34021fe3c2abdf", "committedDate": "2020-06-25T11:37:51Z", "message": "Update ISL replug tests with round-trip scenarios"}, "afterCommit": {"oid": "348fec9ed168903698a969be5026ce71763ff2ee", "author": {"user": {"login": "rtretyak", "name": "Roman Tretiak"}}, "url": "https://github.com/telstra/open-kilda/commit/348fec9ed168903698a969be5026ce71763ff2ee", "committedDate": "2020-06-26T09:35:02Z", "message": "Update ISL replug tests with round-trip scenarios"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "348fec9ed168903698a969be5026ce71763ff2ee", "author": {"user": {"login": "rtretyak", "name": "Roman Tretiak"}}, "url": "https://github.com/telstra/open-kilda/commit/348fec9ed168903698a969be5026ce71763ff2ee", "committedDate": "2020-06-26T09:35:02Z", "message": "Update ISL replug tests with round-trip scenarios"}, "afterCommit": {"oid": "e6344d75588f7c892861b39e1099c85a07e62c87", "author": {"user": {"login": "rtretyak", "name": "Roman Tretiak"}}, "url": "https://github.com/telstra/open-kilda/commit/e6344d75588f7c892861b39e1099c85a07e62c87", "committedDate": "2020-06-26T11:33:54Z", "message": "Update ISL replug tests with round-trip scenarios"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "93f9f16673f8a9df849794a3e058044c27395014", "author": {"user": {"login": "rtretyak", "name": "Roman Tretiak"}}, "url": "https://github.com/telstra/open-kilda/commit/93f9f16673f8a9df849794a3e058044c27395014", "committedDate": "2020-06-30T15:38:23Z", "message": "Update ISL replug tests with round-trip scenarios"}, "afterCommit": {"oid": "50ad01c3e5c9ae8292ef02f83214d447a4401668", "author": {"user": {"login": "rtretyak", "name": "Roman Tretiak"}}, "url": "https://github.com/telstra/open-kilda/commit/50ad01c3e5c9ae8292ef02f83214d447a4401668", "committedDate": "2020-07-02T10:18:44Z", "message": "Update ISL replug tests with round-trip scenarios"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "50ad01c3e5c9ae8292ef02f83214d447a4401668", "author": {"user": {"login": "rtretyak", "name": "Roman Tretiak"}}, "url": "https://github.com/telstra/open-kilda/commit/50ad01c3e5c9ae8292ef02f83214d447a4401668", "committedDate": "2020-07-02T10:18:44Z", "message": "Update ISL replug tests with round-trip scenarios"}, "afterCommit": {"oid": "0b35820a99b68e6ee4a1a1c33565a4f764f22758", "author": {"user": {"login": "rtretyak", "name": "Roman Tretiak"}}, "url": "https://github.com/telstra/open-kilda/commit/0b35820a99b68e6ee4a1a1c33565a4f764f22758", "committedDate": "2020-07-02T11:26:44Z", "message": "Update ISL replug tests with round-trip scenarios"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "0b35820a99b68e6ee4a1a1c33565a4f764f22758", "author": {"user": {"login": "rtretyak", "name": "Roman Tretiak"}}, "url": "https://github.com/telstra/open-kilda/commit/0b35820a99b68e6ee4a1a1c33565a4f764f22758", "committedDate": "2020-07-02T11:26:44Z", "message": "Update ISL replug tests with round-trip scenarios"}, "afterCommit": {"oid": "d7ccfb7c10cb42041cf795b88e31b4d5ec19f655", "author": {"user": {"login": "rtretyak", "name": "Roman Tretiak"}}, "url": "https://github.com/telstra/open-kilda/commit/d7ccfb7c10cb42041cf795b88e31b4d5ec19f655", "committedDate": "2020-07-02T16:03:56Z", "message": "Update ISL replug tests with round-trip scenarios"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "d7ccfb7c10cb42041cf795b88e31b4d5ec19f655", "author": {"user": {"login": "rtretyak", "name": "Roman Tretiak"}}, "url": "https://github.com/telstra/open-kilda/commit/d7ccfb7c10cb42041cf795b88e31b4d5ec19f655", "committedDate": "2020-07-02T16:03:56Z", "message": "Update ISL replug tests with round-trip scenarios"}, "afterCommit": {"oid": "61970aa9a5f1c614da5eb92e8c9e1f35e1c629a7", "author": {"user": {"login": "rtretyak", "name": "Roman Tretiak"}}, "url": "https://github.com/telstra/open-kilda/commit/61970aa9a5f1c614da5eb92e8c9e1f35e1c629a7", "committedDate": "2020-07-03T07:06:59Z", "message": "Update ISL replug tests with round-trip scenarios"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "61970aa9a5f1c614da5eb92e8c9e1f35e1c629a7", "author": {"user": {"login": "rtretyak", "name": "Roman Tretiak"}}, "url": "https://github.com/telstra/open-kilda/commit/61970aa9a5f1c614da5eb92e8c9e1f35e1c629a7", "committedDate": "2020-07-03T07:06:59Z", "message": "Update ISL replug tests with round-trip scenarios"}, "afterCommit": {"oid": "5404133da5182d65aee0eb28dd1c00514419575c", "author": {"user": {"login": "rtretyak", "name": "Roman Tretiak"}}, "url": "https://github.com/telstra/open-kilda/commit/5404133da5182d65aee0eb28dd1c00514419575c", "committedDate": "2020-07-03T09:55:36Z", "message": "Update ISL replug tests with round-trip scenarios"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "5404133da5182d65aee0eb28dd1c00514419575c", "author": {"user": {"login": "rtretyak", "name": "Roman Tretiak"}}, "url": "https://github.com/telstra/open-kilda/commit/5404133da5182d65aee0eb28dd1c00514419575c", "committedDate": "2020-07-03T09:55:36Z", "message": "Update ISL replug tests with round-trip scenarios"}, "afterCommit": {"oid": "0654fc9ba8967f0e36d5ebab5c2ca402a19623ce", "author": {"user": {"login": "rtretyak", "name": "Roman Tretiak"}}, "url": "https://github.com/telstra/open-kilda/commit/0654fc9ba8967f0e36d5ebab5c2ca402a19623ce", "committedDate": "2020-07-03T11:30:28Z", "message": "Update ISL replug tests with round-trip scenarios"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "01e10c6189fa405720531243bc73ec2c848b2e02", "author": {"user": {"login": "rtretyak", "name": "Roman Tretiak"}}, "url": "https://github.com/telstra/open-kilda/commit/01e10c6189fa405720531243bc73ec2c848b2e02", "committedDate": "2020-07-14T13:20:33Z", "message": "Update ISL replug tests with round-trip scenarios"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "0654fc9ba8967f0e36d5ebab5c2ca402a19623ce", "author": {"user": {"login": "rtretyak", "name": "Roman Tretiak"}}, "url": "https://github.com/telstra/open-kilda/commit/0654fc9ba8967f0e36d5ebab5c2ca402a19623ce", "committedDate": "2020-07-03T11:30:28Z", "message": "Update ISL replug tests with round-trip scenarios"}, "afterCommit": {"oid": "01e10c6189fa405720531243bc73ec2c848b2e02", "author": {"user": {"login": "rtretyak", "name": "Roman Tretiak"}}, "url": "https://github.com/telstra/open-kilda/commit/01e10c6189fa405720531243bc73ec2c848b2e02", "committedDate": "2020-07-14T13:20:33Z", "message": "Update ISL replug tests with round-trip scenarios"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3593, "cost": 1, "resetAt": "2021-11-02T12:20:56Z"}}}