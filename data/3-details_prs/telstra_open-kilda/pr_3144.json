{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0MzY2ODU1NzE3", "number": 3144, "title": "ARP Part 5: Connected devices topology", "bodyText": "Part of #3118", "createdAt": "2020-01-24T14:14:03Z", "url": "https://github.com/telstra/open-kilda/pull/3144", "merged": true, "mergeCommit": {"oid": "f595733582407679fb3734230e4f5f1588da9bde"}, "closed": true, "closedAt": "2020-03-05T04:38:54Z", "author": {"login": "niksv"}, "timelineItems": {"totalCount": 20, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcBkMKAABqjMwMTI1ODg5MzA=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcKWSH_ABqjMwOTYzMjI0OTU=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "6df92036495187fe7cb4d7530f7f17eeb5cf886b", "author": {"user": {"login": "niksv", "name": "Sergey Nikitin"}}, "url": "https://github.com/telstra/open-kilda/commit/6df92036495187fe7cb4d7530f7f17eeb5cf886b", "committedDate": "2020-01-24T14:11:52Z", "message": "ARP Part 5: Connected devices topology\n\nPart of #3118"}, "afterCommit": {"oid": "0fd12a0c9fb1852c99fc993fabc79ddd6e2cde95", "author": {"user": {"login": "niksv", "name": "Sergey Nikitin"}}, "url": "https://github.com/telstra/open-kilda/commit/0fd12a0c9fb1852c99fc993fabc79ddd6e2cde95", "committedDate": "2020-02-06T05:49:05Z", "message": "ARP Part 5: Connected devices topology\n\nPart of #3118"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "0fd12a0c9fb1852c99fc993fabc79ddd6e2cde95", "author": {"user": {"login": "niksv", "name": "Sergey Nikitin"}}, "url": "https://github.com/telstra/open-kilda/commit/0fd12a0c9fb1852c99fc993fabc79ddd6e2cde95", "committedDate": "2020-02-06T05:49:05Z", "message": "ARP Part 5: Connected devices topology\n\nPart of #3118"}, "afterCommit": {"oid": "6192cfa747a1290713908b569064ad415c08c4a0", "author": {"user": {"login": "niksv", "name": "Sergey Nikitin"}}, "url": "https://github.com/telstra/open-kilda/commit/6192cfa747a1290713908b569064ad415c08c4a0", "committedDate": "2020-02-06T12:56:10Z", "message": "ARP Part 5: Connected devices topology\n\nPart of #3118"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "39a4dc9f07f0cdbe69400e75e487bf690c3c2e6c", "author": {"user": {"login": "niksv", "name": "Sergey Nikitin"}}, "url": "https://github.com/telstra/open-kilda/commit/39a4dc9f07f0cdbe69400e75e487bf690c3c2e6c", "committedDate": "2020-02-06T13:25:58Z", "message": "Added Arp devices in responsec"}, "afterCommit": {"oid": "5f89628279f0ebd3ae97d405cda39b7e745eccb0", "author": {"user": {"login": "niksv", "name": "Sergey Nikitin"}}, "url": "https://github.com/telstra/open-kilda/commit/5f89628279f0ebd3ae97d405cda39b7e745eccb0", "committedDate": "2020-02-06T13:30:15Z", "message": "Added Arp devices in responsec"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "5f89628279f0ebd3ae97d405cda39b7e745eccb0", "author": {"user": {"login": "niksv", "name": "Sergey Nikitin"}}, "url": "https://github.com/telstra/open-kilda/commit/5f89628279f0ebd3ae97d405cda39b7e745eccb0", "committedDate": "2020-02-06T13:30:15Z", "message": "Added Arp devices in responsec"}, "afterCommit": {"oid": "38541a0c5e41b61d2c7885b18c0606621afeffd1", "author": {"user": {"login": "niksv", "name": "Sergey Nikitin"}}, "url": "https://github.com/telstra/open-kilda/commit/38541a0c5e41b61d2c7885b18c0606621afeffd1", "committedDate": "2020-02-10T13:22:57Z", "message": "Added Arp devices in responsec"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "38541a0c5e41b61d2c7885b18c0606621afeffd1", "author": {"user": {"login": "niksv", "name": "Sergey Nikitin"}}, "url": "https://github.com/telstra/open-kilda/commit/38541a0c5e41b61d2c7885b18c0606621afeffd1", "committedDate": "2020-02-10T13:22:57Z", "message": "Added Arp devices in responsec"}, "afterCommit": {"oid": "5bdaeff298cb8bab74cf2475941eb056de93fa30", "author": {"user": {"login": "niksv", "name": "Sergey Nikitin"}}, "url": "https://github.com/telstra/open-kilda/commit/5bdaeff298cb8bab74cf2475941eb056de93fa30", "committedDate": "2020-02-12T13:47:45Z", "message": "Added Arp devices in responsec"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "5bdaeff298cb8bab74cf2475941eb056de93fa30", "author": {"user": {"login": "niksv", "name": "Sergey Nikitin"}}, "url": "https://github.com/telstra/open-kilda/commit/5bdaeff298cb8bab74cf2475941eb056de93fa30", "committedDate": "2020-02-12T13:47:45Z", "message": "Added Arp devices in responsec"}, "afterCommit": {"oid": "0081c562b16fa1404e348c2bc6718a0bf02c1256", "author": {"user": {"login": "niksv", "name": "Sergey Nikitin"}}, "url": "https://github.com/telstra/open-kilda/commit/0081c562b16fa1404e348c2bc6718a0bf02c1256", "committedDate": "2020-02-13T06:31:38Z", "message": "Added Arp devices in responses"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "0081c562b16fa1404e348c2bc6718a0bf02c1256", "author": {"user": {"login": "niksv", "name": "Sergey Nikitin"}}, "url": "https://github.com/telstra/open-kilda/commit/0081c562b16fa1404e348c2bc6718a0bf02c1256", "committedDate": "2020-02-13T06:31:38Z", "message": "Added Arp devices in responses"}, "afterCommit": {"oid": "bd070d8a4664c9d2ba5afb1e16c8f48745d51a4b", "author": {"user": {"login": "niksv", "name": "Sergey Nikitin"}}, "url": "https://github.com/telstra/open-kilda/commit/bd070d8a4664c9d2ba5afb1e16c8f48745d51a4b", "committedDate": "2020-02-13T12:03:57Z", "message": "Added Arp devices in responses"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "bd070d8a4664c9d2ba5afb1e16c8f48745d51a4b", "author": {"user": {"login": "niksv", "name": "Sergey Nikitin"}}, "url": "https://github.com/telstra/open-kilda/commit/bd070d8a4664c9d2ba5afb1e16c8f48745d51a4b", "committedDate": "2020-02-13T12:03:57Z", "message": "Added Arp devices in responses"}, "afterCommit": {"oid": "dff2f42523cf9e0ea0606862cae5d79babcee52f", "author": {"user": {"login": "niksv", "name": "Sergey Nikitin"}}, "url": "https://github.com/telstra/open-kilda/commit/dff2f42523cf9e0ea0606862cae5d79babcee52f", "committedDate": "2020-02-13T12:11:07Z", "message": "Added Arp devices in responses"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzU5NzM4NzQy", "url": "https://github.com/telstra/open-kilda/pull/3144#pullrequestreview-359738742", "createdAt": "2020-02-17T13:37:22Z", "commit": {"oid": "dff2f42523cf9e0ea0606862cae5d79babcee52f"}, "state": "APPROVED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xN1QxMzozNzoyMlrOFqkruA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xN1QxMzozNzoyMlrOFqkruA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MDE4NTUyOA==", "bodyText": "Why do you need this sleep?", "url": "https://github.com/telstra/open-kilda/pull/3144#discussion_r380185528", "createdAt": "2020-02-17T13:37:22Z", "author": {"login": "rozdy"}, "path": "src-java/connecteddevices-topology/connecteddevices-storm-topology/src/test/java/org/openkilda/wfm/topology/connecteddevices/service/PacketServiceTest.java", "diffHunk": "@@ -130,6 +135,20 @@ public void testHandleLldpDataDifferentTimeOnUpdate() throws InterruptedExceptio\n         assertNotEquals(devices.iterator().next().getTimeFirstSeen(), devices.iterator().next().getTimeLastSeen());\n     }\n \n+    @Test\n+    public void testHandleArpDataDifferentTimeOnUpdate() throws InterruptedException {\n+        // create\n+        packetService.handleArpData(createArpInfoData());\n+\n+        Thread.sleep(10);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "dff2f42523cf9e0ea0606862cae5d79babcee52f"}, "originalPosition": 85}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "dff2f42523cf9e0ea0606862cae5d79babcee52f", "author": {"user": {"login": "niksv", "name": "Sergey Nikitin"}}, "url": "https://github.com/telstra/open-kilda/commit/dff2f42523cf9e0ea0606862cae5d79babcee52f", "committedDate": "2020-02-13T12:11:07Z", "message": "Added Arp devices in responses"}, "afterCommit": {"oid": "6f5ad81750c34810b5647182b5f19e022af5a8a5", "author": {"user": {"login": "niksv", "name": "Sergey Nikitin"}}, "url": "https://github.com/telstra/open-kilda/commit/6f5ad81750c34810b5647182b5f19e022af5a8a5", "committedDate": "2020-02-18T03:53:59Z", "message": "Added Arp devices in responses"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "6f5ad81750c34810b5647182b5f19e022af5a8a5", "author": {"user": {"login": "niksv", "name": "Sergey Nikitin"}}, "url": "https://github.com/telstra/open-kilda/commit/6f5ad81750c34810b5647182b5f19e022af5a8a5", "committedDate": "2020-02-18T03:53:59Z", "message": "Added Arp devices in responses"}, "afterCommit": {"oid": "9fa137bbcc316531cebcc49b64bbee1790c7d2f2", "author": {"user": {"login": "niksv", "name": "Sergey Nikitin"}}, "url": "https://github.com/telstra/open-kilda/commit/9fa137bbcc316531cebcc49b64bbee1790c7d2f2", "committedDate": "2020-02-18T13:03:55Z", "message": "Added Arp devices in responses"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "9fa137bbcc316531cebcc49b64bbee1790c7d2f2", "author": {"user": {"login": "niksv", "name": "Sergey Nikitin"}}, "url": "https://github.com/telstra/open-kilda/commit/9fa137bbcc316531cebcc49b64bbee1790c7d2f2", "committedDate": "2020-02-18T13:03:55Z", "message": "Added Arp devices in responses"}, "afterCommit": {"oid": "e08d840778507a6d19fa9500d37d292f6e1aeec4", "author": {"user": {"login": "niksv", "name": "Sergey Nikitin"}}, "url": "https://github.com/telstra/open-kilda/commit/e08d840778507a6d19fa9500d37d292f6e1aeec4", "committedDate": "2020-02-19T06:52:14Z", "message": "Added Arp devices in responses"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "e08d840778507a6d19fa9500d37d292f6e1aeec4", "author": {"user": {"login": "niksv", "name": "Sergey Nikitin"}}, "url": "https://github.com/telstra/open-kilda/commit/e08d840778507a6d19fa9500d37d292f6e1aeec4", "committedDate": "2020-02-19T06:52:14Z", "message": "Added Arp devices in responses"}, "afterCommit": {"oid": "5c0f38851ba9d7e586ddf1d0047504d7bd9c801e", "author": {"user": {"login": "niksv", "name": "Sergey Nikitin"}}, "url": "https://github.com/telstra/open-kilda/commit/5c0f38851ba9d7e586ddf1d0047504d7bd9c801e", "committedDate": "2020-02-19T12:18:50Z", "message": "Added Arp devices in responses"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzYyNDYzNTA0", "url": "https://github.com/telstra/open-kilda/pull/3144#pullrequestreview-362463504", "createdAt": "2020-02-21T08:25:46Z", "commit": {"oid": "5c0f38851ba9d7e586ddf1d0047504d7bd9c801e"}, "state": "APPROVED", "comments": {"totalCount": 8, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yMVQwODoyNTo0NlrOFsu9vw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yMVQwODoyODoyN1rOFsvBcA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MjQ1MTEzNQ==", "bodyText": "Can we figure out which packet here, LLDP or ARP? If we can, then it would be better to log more accurate information.", "url": "https://github.com/telstra/open-kilda/pull/3144#discussion_r382451135", "createdAt": "2020-02-21T08:25:46Z", "author": {"login": "dpoltavets"}, "path": "src-java/connecteddevices-topology/connecteddevices-storm-topology/src/main/java/org/openkilda/wfm/topology/connecteddevices/service/PacketService.java", "diffHunk": "@@ -94,28 +103,60 @@ public void handleLldpData(LldpInfoData data) {\n         });\n     }\n \n-    private FlowRelatedData findFlowRelatedData(LldpInfoData data) {\n-        if (data.getCookie() == LLDP_POST_INGRESS_COOKIE) {\n+    /**\n+     * Handle Arp info data.\n+     */\n+    public void handleArpData(ArpInfoData data) {\n+        transactionManager.doInTransaction(() -> {\n+\n+            FlowRelatedData flowRelatedData = findFlowRelatedData(data);\n+            if (flowRelatedData == null) {\n+                return;\n+            }\n+\n+            SwitchConnectedDevice device = getOrBuildArpDevice(data, flowRelatedData.originalVlan);\n+\n+            if (device == null) {\n+                return;\n+            }\n+\n+            device.setTimeLastSeen(Instant.ofEpochMilli(data.getTimestamp()));\n+            device.setFlowId(flowRelatedData.flowId);\n+            device.setSource(flowRelatedData.source);\n+\n+            switchConnectedDeviceRepository.createOrUpdate(device);\n+        });\n+    }\n+\n+    private FlowRelatedData findFlowRelatedData(ConnectedDevicePacketBase data) {\n+        long cookie = data.getCookie();\n+        if (cookie == LLDP_POST_INGRESS_COOKIE\n+                || cookie == ARP_POST_INGRESS_COOKIE) {\n             return findFlowRelatedDataForVlanFlow(data);\n-        } else if (data.getCookie() == LLDP_POST_INGRESS_VXLAN_COOKIE) {\n+        } else if (cookie == LLDP_POST_INGRESS_VXLAN_COOKIE\n+                || cookie == ARP_POST_INGRESS_VXLAN_COOKIE) {\n             return findFlowRelatedDataForVxlanFlow(data);\n-        } else if (data.getCookie() == LLDP_POST_INGRESS_ONE_SWITCH_COOKIE) {\n+        } else if (cookie == LLDP_POST_INGRESS_ONE_SWITCH_COOKIE\n+                || cookie == ARP_POST_INGRESS_ONE_SWITCH_COOKIE) {\n             return findFlowRelatedDataForOneSwitchFlow(data);\n-        } else if (data.getCookie() == LLDP_INPUT_PRE_DROP_COOKIE\n-                || data.getCookie() == LLDP_INGRESS_COOKIE\n-                || data.getCookie() == LLDP_TRANSIT_COOKIE) {\n+        } else if (cookie == LLDP_INPUT_PRE_DROP_COOKIE\n+                || cookie == LLDP_INGRESS_COOKIE\n+                || cookie == LLDP_TRANSIT_COOKIE\n+                || cookie == ARP_INPUT_PRE_DROP_COOKIE\n+                || cookie == ARP_INGRESS_COOKIE\n+                || cookie == ARP_TRANSIT_COOKIE) {\n             int vlan = data.getVlans().isEmpty() ? 0 : data.getVlans().get(0);\n             return new FlowRelatedData(vlan, null, null);\n         }\n-        log.warn(\"Got LLDP packet from unknown rule with cookie {}. Switch {}, port {}, vlans {}\",\n+        log.warn(\"Got LLDP or ARP packet from unknown rule with cookie {}. Switch {}, port {}, vlans {}\",", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "5c0f38851ba9d7e586ddf1d0047504d7bd9c801e"}, "originalPosition": 90}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MjQ1MTcxOQ==", "bodyText": "same", "url": "https://github.com/telstra/open-kilda/pull/3144#discussion_r382451719", "createdAt": "2020-02-21T08:27:23Z", "author": {"login": "dpoltavets"}, "path": "src-java/connecteddevices-topology/connecteddevices-storm-topology/src/main/java/org/openkilda/wfm/topology/connecteddevices/service/PacketService.java", "diffHunk": "@@ -94,28 +103,60 @@ public void handleLldpData(LldpInfoData data) {\n         });\n     }\n \n-    private FlowRelatedData findFlowRelatedData(LldpInfoData data) {\n-        if (data.getCookie() == LLDP_POST_INGRESS_COOKIE) {\n+    /**\n+     * Handle Arp info data.\n+     */\n+    public void handleArpData(ArpInfoData data) {\n+        transactionManager.doInTransaction(() -> {\n+\n+            FlowRelatedData flowRelatedData = findFlowRelatedData(data);\n+            if (flowRelatedData == null) {\n+                return;\n+            }\n+\n+            SwitchConnectedDevice device = getOrBuildArpDevice(data, flowRelatedData.originalVlan);\n+\n+            if (device == null) {\n+                return;\n+            }\n+\n+            device.setTimeLastSeen(Instant.ofEpochMilli(data.getTimestamp()));\n+            device.setFlowId(flowRelatedData.flowId);\n+            device.setSource(flowRelatedData.source);\n+\n+            switchConnectedDeviceRepository.createOrUpdate(device);\n+        });\n+    }\n+\n+    private FlowRelatedData findFlowRelatedData(ConnectedDevicePacketBase data) {\n+        long cookie = data.getCookie();\n+        if (cookie == LLDP_POST_INGRESS_COOKIE\n+                || cookie == ARP_POST_INGRESS_COOKIE) {\n             return findFlowRelatedDataForVlanFlow(data);\n-        } else if (data.getCookie() == LLDP_POST_INGRESS_VXLAN_COOKIE) {\n+        } else if (cookie == LLDP_POST_INGRESS_VXLAN_COOKIE\n+                || cookie == ARP_POST_INGRESS_VXLAN_COOKIE) {\n             return findFlowRelatedDataForVxlanFlow(data);\n-        } else if (data.getCookie() == LLDP_POST_INGRESS_ONE_SWITCH_COOKIE) {\n+        } else if (cookie == LLDP_POST_INGRESS_ONE_SWITCH_COOKIE\n+                || cookie == ARP_POST_INGRESS_ONE_SWITCH_COOKIE) {\n             return findFlowRelatedDataForOneSwitchFlow(data);\n-        } else if (data.getCookie() == LLDP_INPUT_PRE_DROP_COOKIE\n-                || data.getCookie() == LLDP_INGRESS_COOKIE\n-                || data.getCookie() == LLDP_TRANSIT_COOKIE) {\n+        } else if (cookie == LLDP_INPUT_PRE_DROP_COOKIE\n+                || cookie == LLDP_INGRESS_COOKIE\n+                || cookie == LLDP_TRANSIT_COOKIE\n+                || cookie == ARP_INPUT_PRE_DROP_COOKIE\n+                || cookie == ARP_INGRESS_COOKIE\n+                || cookie == ARP_TRANSIT_COOKIE) {\n             int vlan = data.getVlans().isEmpty() ? 0 : data.getVlans().get(0);\n             return new FlowRelatedData(vlan, null, null);\n         }\n-        log.warn(\"Got LLDP packet from unknown rule with cookie {}. Switch {}, port {}, vlans {}\",\n+        log.warn(\"Got LLDP or ARP packet from unknown rule with cookie {}. Switch {}, port {}, vlans {}\",\n                 data.getCookie(), data.getSwitchId(), data.getPortNumber(), data.getVlans());\n         return null;\n     }\n \n     @VisibleForTesting\n-    FlowRelatedData findFlowRelatedDataForVlanFlow(LldpInfoData data) {\n+    FlowRelatedData findFlowRelatedDataForVlanFlow(ConnectedDevicePacketBase data) {\n         if (data.getVlans().isEmpty()) {\n-            log.warn(\"Got LLDP packet without transit VLAN: {}\", data);\n+            log.warn(\"Got LLDP or ARP packet without transit VLAN: {}\", data);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "5c0f38851ba9d7e586ddf1d0047504d7bd9c801e"}, "originalPosition": 100}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MjQ1MTc3MQ==", "bodyText": "same", "url": "https://github.com/telstra/open-kilda/pull/3144#discussion_r382451771", "createdAt": "2020-02-21T08:27:32Z", "author": {"login": "dpoltavets"}, "path": "src-java/connecteddevices-topology/connecteddevices-storm-topology/src/main/java/org/openkilda/wfm/topology/connecteddevices/service/PacketService.java", "diffHunk": "@@ -145,14 +186,14 @@ FlowRelatedData findFlowRelatedDataForVlanFlow(LldpInfoData data) {\n                 return new FlowRelatedData(flow.getDestVlan(), flow.getFlowId(), false);\n             }\n         } else {\n-            log.warn(\"Got LLDP packet from Flow {} on non-src/non-dst switch {}. Transit vlan: {}\",\n+            log.warn(\"Got LLDP or ARP packet from Flow {} on non-src/non-dst switch {}. Transit vlan: {}\",", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "5c0f38851ba9d7e586ddf1d0047504d7bd9c801e"}, "originalPosition": 109}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MjQ1MTg1OA==", "bodyText": "same", "url": "https://github.com/telstra/open-kilda/pull/3144#discussion_r382451858", "createdAt": "2020-02-21T08:27:45Z", "author": {"login": "dpoltavets"}, "path": "src-java/connecteddevices-topology/connecteddevices-storm-topology/src/main/java/org/openkilda/wfm/topology/connecteddevices/service/PacketService.java", "diffHunk": "@@ -165,14 +206,14 @@ FlowRelatedData findFlowRelatedDataForVxlanFlow(LldpInfoData data) {\n         } else if (data.getSwitchId().equals(flow.getDestSwitch().getSwitchId())) {\n             return new FlowRelatedData(inputVlan, flow.getFlowId(), false);\n         } else {\n-            log.warn(\"Got LLDP packet from Flow {} on non-src/non-dst switch {}. Port number {}, input vlan {}\",\n+            log.warn(\"Got LLDP or ARP packet from Flow {} on non-src/non-dst switch {}. Port number {}, input vlan {}\",", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "5c0f38851ba9d7e586ddf1d0047504d7bd9c801e"}, "originalPosition": 126}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MjQ1MTkzMg==", "bodyText": "same", "url": "https://github.com/telstra/open-kilda/pull/3144#discussion_r382451932", "createdAt": "2020-02-21T08:27:58Z", "author": {"login": "dpoltavets"}, "path": "src-java/connecteddevices-topology/connecteddevices-storm-topology/src/main/java/org/openkilda/wfm/topology/connecteddevices/service/PacketService.java", "diffHunk": "@@ -184,7 +225,7 @@ FlowRelatedData findFlowRelatedDataForOneSwitchFlow(LldpInfoData data) {\n         }\n \n         if (!flow.isOneSwitchFlow()) {\n-            log.warn(\"Found NOT one switch flow {} by SwitchId {}, port number {}, vlan {} from LLDP packet\",\n+            log.warn(\"Found NOT one switch flow {} by SwitchId {}, port number {}, vlan {} from LLDP or ARP packet\",", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "5c0f38851ba9d7e586ddf1d0047504d7bd9c801e"}, "originalPosition": 143}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MjQ1MjAxOA==", "bodyText": "same", "url": "https://github.com/telstra/open-kilda/pull/3144#discussion_r382452018", "createdAt": "2020-02-21T08:28:13Z", "author": {"login": "dpoltavets"}, "path": "src-java/connecteddevices-topology/connecteddevices-storm-topology/src/main/java/org/openkilda/wfm/topology/connecteddevices/service/PacketService.java", "diffHunk": "@@ -251,7 +292,7 @@ private FlowRelatedData getOneSwitchOnePortFlowRelatedData(\n                 return new FlowRelatedData(flow.getDestVlan(), flow.getFlowId(), false);\n             }\n         }\n-        log.warn(\"Got LLDP data for one switch one Flow with unknown output vlan {}. Flow {} Data {}\",\n+        log.warn(\"Got LLDP or ARP data for one switch one Flow with unknown output vlan {}. Flow {} Data {}\",", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "5c0f38851ba9d7e586ddf1d0047504d7bd9c801e"}, "originalPosition": 161}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MjQ1MjA1Ng==", "bodyText": "same", "url": "https://github.com/telstra/open-kilda/pull/3144#discussion_r382452056", "createdAt": "2020-02-21T08:28:22Z", "author": {"login": "dpoltavets"}, "path": "src-java/connecteddevices-topology/connecteddevices-storm-topology/src/main/java/org/openkilda/wfm/topology/connecteddevices/service/PacketService.java", "diffHunk": "@@ -282,7 +323,7 @@ private Flow getFlowBySwitchIdPortAndVlan(SwitchId switchId, int portNumber, int\n             if (fullPortFlow.isPresent()) {\n                 return fullPortFlow.get();\n             } else {\n-                log.warn(\"Couldn't find Flow for LLDP packet on endpoint: Switch {}, port {}, vlan {}\",\n+                log.warn(\"Couldn't find Flow for LLDP or ARP packet on endpoint: Switch {}, port {}, vlan {}\",", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "5c0f38851ba9d7e586ddf1d0047504d7bd9c801e"}, "originalPosition": 170}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MjQ1MjA4MA==", "bodyText": "same", "url": "https://github.com/telstra/open-kilda/pull/3144#discussion_r382452080", "createdAt": "2020-02-21T08:28:27Z", "author": {"login": "dpoltavets"}, "path": "src-java/connecteddevices-topology/connecteddevices-storm-topology/src/main/java/org/openkilda/wfm/topology/connecteddevices/service/PacketService.java", "diffHunk": "@@ -301,14 +342,14 @@ private Flow getFlowBySwitchIdInPortAndOutVlan(SwitchId switchId, int inPort, in\n             if (fullPortFlow.isPresent()) {\n                 return fullPortFlow.get();\n             } else {\n-                log.warn(\"Couldn't find Flow for LLDP packet by: Switch {}, InPort {}, OutVlan {}\",\n+                log.warn(\"Couldn't find Flow for LLDP or ARP packet by: Switch {}, InPort {}, OutVlan {}\",", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "5c0f38851ba9d7e586ddf1d0047504d7bd9c801e"}, "originalPosition": 179}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "5f09342e8106183a5b816953da756f77cc0d65ac", "author": {"user": {"login": "niksv", "name": "Sergey Nikitin"}}, "url": "https://github.com/telstra/open-kilda/commit/5f09342e8106183a5b816953da756f77cc0d65ac", "committedDate": "2020-02-21T08:48:17Z", "message": "Improve logs"}, "afterCommit": {"oid": "004fd691c5cdab34528e670b5678b6b138914950", "author": {"user": {"login": "niksv", "name": "Sergey Nikitin"}}, "url": "https://github.com/telstra/open-kilda/commit/004fd691c5cdab34528e670b5678b6b138914950", "committedDate": "2020-02-21T11:27:19Z", "message": "Improve logs"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "004fd691c5cdab34528e670b5678b6b138914950", "author": {"user": {"login": "niksv", "name": "Sergey Nikitin"}}, "url": "https://github.com/telstra/open-kilda/commit/004fd691c5cdab34528e670b5678b6b138914950", "committedDate": "2020-02-21T11:27:19Z", "message": "Improve logs"}, "afterCommit": {"oid": "5d76f2307f036d703e8818a76baa35535f25ac2b", "author": {"user": {"login": "niksv", "name": "Sergey Nikitin"}}, "url": "https://github.com/telstra/open-kilda/commit/5d76f2307f036d703e8818a76baa35535f25ac2b", "committedDate": "2020-03-02T12:58:47Z", "message": "Improve logs"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d183832ba4d03f49f9b2252c422d2123d0b09ad3", "author": {"user": {"login": "niksv", "name": "Sergey Nikitin"}}, "url": "https://github.com/telstra/open-kilda/commit/d183832ba4d03f49f9b2252c422d2123d0b09ad3", "committedDate": "2020-03-04T12:42:48Z", "message": "ARP Part 5: Connected devices topology\n\nPart of #3118"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "57dd6c77e15038a62eb815caf457c14fea95cbc5", "author": {"user": {"login": "niksv", "name": "Sergey Nikitin"}}, "url": "https://github.com/telstra/open-kilda/commit/57dd6c77e15038a62eb815caf457c14fea95cbc5", "committedDate": "2020-03-04T12:42:48Z", "message": "Added Arp devices in responses"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "dc479db42542a3d447b7efae6534805d20c3778b", "author": {"user": {"login": "niksv", "name": "Sergey Nikitin"}}, "url": "https://github.com/telstra/open-kilda/commit/dc479db42542a3d447b7efae6534805d20c3778b", "committedDate": "2020-03-04T12:42:48Z", "message": "Improve logs"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "5d76f2307f036d703e8818a76baa35535f25ac2b", "author": {"user": {"login": "niksv", "name": "Sergey Nikitin"}}, "url": "https://github.com/telstra/open-kilda/commit/5d76f2307f036d703e8818a76baa35535f25ac2b", "committedDate": "2020-03-02T12:58:47Z", "message": "Improve logs"}, "afterCommit": {"oid": "dc479db42542a3d447b7efae6534805d20c3778b", "author": {"user": {"login": "niksv", "name": "Sergey Nikitin"}}, "url": "https://github.com/telstra/open-kilda/commit/dc479db42542a3d447b7efae6534805d20c3778b", "committedDate": "2020-03-04T12:42:48Z", "message": "Improve logs"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3694, "cost": 1, "resetAt": "2021-11-02T12:20:56Z"}}}