{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDY5MzE4Mjk5", "number": 3689, "title": "Filter out one switch flows from affected flows", "bodyText": "One switch flows should not be in a list of affected flows", "createdAt": "2020-08-18T09:10:54Z", "url": "https://github.com/telstra/open-kilda/pull/3689", "merged": true, "mergeCommit": {"oid": "12ab3b19252e1e8dbca853d5e79e8b8b289756b9"}, "closed": true, "closedAt": "2020-08-24T12:37:18Z", "author": {"login": "timofei-durakov"}, "timelineItems": {"totalCount": 12, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdADfEQgFqTQ2OTE0NTkyOQ==", "endCursor": "Y3Vyc29yOnYyOpPPAAABdB_UQLABqjM2ODQ1ODgyNjg=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDY5MTQ1OTI5", "url": "https://github.com/telstra/open-kilda/pull/3689#pullrequestreview-469145929", "createdAt": "2020-08-18T09:20:53Z", "commit": {"oid": "ee7688afb3eb0d048108a395d143ccca5657811c"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDY5MTQ2MjEx", "url": "https://github.com/telstra/open-kilda/pull/3689#pullrequestreview-469146211", "createdAt": "2020-08-18T09:21:15Z", "commit": {"oid": "ee7688afb3eb0d048108a395d143ccca5657811c"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xOFQwOToyMToxNlrOHCLBVg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xOFQwOToyMToxNlrOHCLBVg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MjAzOTc2Ng==", "bodyText": "we should check that ISL is discovered\nif (otherIslFailed) {\n       antiflap.portUp(otherIsl.srcSwitch.dpId, otherIsl.srcPort)\n        Wrappers.wait(discoveryInterval + WAIT_OFFSET) {\n            assert northbound.getLink(otherIsl).actualState == IslChangeType.DISCOVERED\n        }\n}", "url": "https://github.com/telstra/open-kilda/pull/3689#discussion_r472039766", "createdAt": "2020-08-18T09:21:16Z", "author": {"login": "andriidovhan"}, "path": "src-java/testing/functional-tests/src/test/groovy/org/openkilda/functionaltests/spec/flows/AutoRerouteV2Spec.groovy", "diffHunk": "@@ -166,6 +190,7 @@ class AutoRerouteV2Spec extends HealthCheckSpecification {\n         cleanup: \"Remove the flow\"\n         flowHelperV2.deleteFlow(flow.flowId)\n         isSwitchDisconnected && switchHelper.reviveSwitch(sw, blockData, true)\n+        otherIslFailed && antiflap.portUp(otherIsl.srcSwitch.dpId, otherIsl.srcPort)", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ee7688afb3eb0d048108a395d143ccca5657811c"}, "originalPosition": 42}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDY5MTUwOTgx", "url": "https://github.com/telstra/open-kilda/pull/3689#pullrequestreview-469150981", "createdAt": "2020-08-18T09:27:06Z", "commit": {"oid": "ee7688afb3eb0d048108a395d143ccca5657811c"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xOFQwOToyNzowNlrOHCLOzg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xOFQwOToyNzowNlrOHCLOzg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MjA0MzIxNA==", "bodyText": "as for me otherIsl is not clear\ndo you mind renaming it (for example to islToFail) ?", "url": "https://github.com/telstra/open-kilda/pull/3689#discussion_r472043214", "createdAt": "2020-08-18T09:27:06Z", "author": {"login": "andriidovhan"}, "path": "src-java/testing/functional-tests/src/test/groovy/org/openkilda/functionaltests/spec/flows/AutoRerouteV2Spec.groovy", "diffHunk": "@@ -151,6 +152,29 @@ class AutoRerouteV2Spec extends HealthCheckSpecification {\n             assert flowInfo.statusInfo == \"Switch $sw.dpId is inactive\"\n         }\n \n+        when: \"Other isl fails\"\n+        def otherIslFailed = false\n+        def otherIsl = topology.isls.find() {isl-> isl.srcSwitch != sw && isl.dstSwitch != sw}", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ee7688afb3eb0d048108a395d143ccca5657811c"}, "originalPosition": 14}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDY5MTU0OTE0", "url": "https://github.com/telstra/open-kilda/pull/3689#pullrequestreview-469154914", "createdAt": "2020-08-18T09:32:20Z", "commit": {"oid": "ee7688afb3eb0d048108a395d143ccca5657811c"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xOFQwOTozMjoyMFrOHCLa_g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xOFQwOTozMjoyMFrOHCLa_g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MjA0NjMzNA==", "bodyText": "Why do you check the actualState field?\nprobably would be better to check the state field", "url": "https://github.com/telstra/open-kilda/pull/3689#discussion_r472046334", "createdAt": "2020-08-18T09:32:20Z", "author": {"login": "andriidovhan"}, "path": "src-java/testing/functional-tests/src/test/groovy/org/openkilda/functionaltests/spec/flows/AutoRerouteV2Spec.groovy", "diffHunk": "@@ -151,6 +152,29 @@ class AutoRerouteV2Spec extends HealthCheckSpecification {\n             assert flowInfo.statusInfo == \"Switch $sw.dpId is inactive\"\n         }\n \n+        when: \"Other isl fails\"\n+        def otherIslFailed = false\n+        def otherIsl = topology.isls.find() {isl-> isl.srcSwitch != sw && isl.dstSwitch != sw}\n+        antiflap.portDown(otherIsl.srcSwitch.dpId, otherIsl.srcPort)\n+        otherIslFailed = true\n+        Wrappers.wait(WAIT_OFFSET) {\n+            assert northbound.getLink(otherIsl).actualState == IslChangeType.FAILED", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ee7688afb3eb0d048108a395d143ccca5657811c"}, "originalPosition": 18}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "ee7688afb3eb0d048108a395d143ccca5657811c", "author": {"user": {"login": "timofei-durakov", "name": "Timofey Durakov"}}, "url": "https://github.com/telstra/open-kilda/commit/ee7688afb3eb0d048108a395d143ccca5657811c", "committedDate": "2020-08-18T09:06:05Z", "message": "Filter out one switch flows from affected flows\n\nOne switch flows should not be in a list of affected flows"}, "afterCommit": {"oid": "8a86910962e05861ecd26c1a4f9b50a987f4451e", "author": {"user": {"login": "timofei-durakov", "name": "Timofey Durakov"}}, "url": "https://github.com/telstra/open-kilda/commit/8a86910962e05861ecd26c1a4f9b50a987f4451e", "committedDate": "2020-08-18T10:52:30Z", "message": "Filter out one switch flows from affected flows\n\nOne switch flows should not be in a list of affected flows"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "8a86910962e05861ecd26c1a4f9b50a987f4451e", "author": {"user": {"login": "timofei-durakov", "name": "Timofey Durakov"}}, "url": "https://github.com/telstra/open-kilda/commit/8a86910962e05861ecd26c1a4f9b50a987f4451e", "committedDate": "2020-08-18T10:52:30Z", "message": "Filter out one switch flows from affected flows\n\nOne switch flows should not be in a list of affected flows"}, "afterCommit": {"oid": "c7da96fabf9a6dd6c80599a193f9e64dd4d17607", "author": {"user": {"login": "timofei-durakov", "name": "Timofey Durakov"}}, "url": "https://github.com/telstra/open-kilda/commit/c7da96fabf9a6dd6c80599a193f9e64dd4d17607", "committedDate": "2020-08-18T10:57:20Z", "message": "Filter out one switch flows from affected flows\n\nOne switch flows should not be in a list of affected flows"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDY5MjE0NDEy", "url": "https://github.com/telstra/open-kilda/pull/3689#pullrequestreview-469214412", "createdAt": "2020-08-18T10:59:27Z", "commit": {"oid": "c7da96fabf9a6dd6c80599a193f9e64dd4d17607"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDY5NTYxMDg5", "url": "https://github.com/telstra/open-kilda/pull/3689#pullrequestreview-469561089", "createdAt": "2020-08-18T15:18:42Z", "commit": {"oid": "c7da96fabf9a6dd6c80599a193f9e64dd4d17607"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "c7da96fabf9a6dd6c80599a193f9e64dd4d17607", "author": {"user": {"login": "timofei-durakov", "name": "Timofey Durakov"}}, "url": "https://github.com/telstra/open-kilda/commit/c7da96fabf9a6dd6c80599a193f9e64dd4d17607", "committedDate": "2020-08-18T10:57:20Z", "message": "Filter out one switch flows from affected flows\n\nOne switch flows should not be in a list of affected flows"}, "afterCommit": {"oid": "6e641093e1503920d516125555ed4c867927604a", "author": {"user": {"login": "timofei-durakov", "name": "Timofey Durakov"}}, "url": "https://github.com/telstra/open-kilda/commit/6e641093e1503920d516125555ed4c867927604a", "committedDate": "2020-08-19T07:37:06Z", "message": "Filter out one switch flows from affected flows\n\nOne switch flows should not be in a list of affected flows"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDcwMjYzOTIx", "url": "https://github.com/telstra/open-kilda/pull/3689#pullrequestreview-470263921", "createdAt": "2020-08-19T09:03:38Z", "commit": {"oid": "6e641093e1503920d516125555ed4c867927604a"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c8f1898e9191542aea5a22dc00af6e7e679e5643", "author": {"user": {"login": "timofei-durakov", "name": "Timofey Durakov"}}, "url": "https://github.com/telstra/open-kilda/commit/c8f1898e9191542aea5a22dc00af6e7e679e5643", "committedDate": "2020-08-24T09:36:49Z", "message": "Filter out one switch flows from affected flows\n\nOne switch flows should not be in a list of affected flows"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "6e641093e1503920d516125555ed4c867927604a", "author": {"user": {"login": "timofei-durakov", "name": "Timofey Durakov"}}, "url": "https://github.com/telstra/open-kilda/commit/6e641093e1503920d516125555ed4c867927604a", "committedDate": "2020-08-19T07:37:06Z", "message": "Filter out one switch flows from affected flows\n\nOne switch flows should not be in a list of affected flows"}, "afterCommit": {"oid": "c8f1898e9191542aea5a22dc00af6e7e679e5643", "author": {"user": {"login": "timofei-durakov", "name": "Timofey Durakov"}}, "url": "https://github.com/telstra/open-kilda/commit/c8f1898e9191542aea5a22dc00af6e7e679e5643", "committedDate": "2020-08-24T09:36:49Z", "message": "Filter out one switch flows from affected flows\n\nOne switch flows should not be in a list of affected flows"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3555, "cost": 1, "resetAt": "2021-11-02T12:20:56Z"}}}