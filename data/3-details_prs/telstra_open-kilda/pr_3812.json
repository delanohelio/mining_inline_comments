{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTExNTMzNzk4", "number": 3812, "title": "[Server42] fix resources leak closes #3797", "bodyText": "", "createdAt": "2020-10-28T13:08:49Z", "url": "https://github.com/telstra/open-kilda/pull/3812", "merged": true, "mergeCommit": {"oid": "dcaa1be1d364f9eec6d65a3b3d7ce822645e1036"}, "closed": true, "closedAt": "2020-10-28T13:54:04Z", "author": {"login": "nikitamarchenko"}, "timelineItems": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdW9U4PgFqTUxODY0MDg4Mw==", "endCursor": "Y3Vyc29yOnYyOpPPAAABdW9oKngBqjM5MzEyNjQ5NTY=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTE4NjQwODgz", "url": "https://github.com/telstra/open-kilda/pull/3812#pullrequestreview-518640883", "createdAt": "2020-10-28T13:10:35Z", "commit": {"oid": "54301119c20b2e253a6c7152a8e547b2bd4551ba"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTE4NjQyNjA5", "url": "https://github.com/telstra/open-kilda/pull/3812#pullrequestreview-518642609", "createdAt": "2020-10-28T13:12:24Z", "commit": {"oid": "54301119c20b2e253a6c7152a8e547b2bd4551ba"}, "state": "APPROVED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yOFQxMzoxMjoyNVrOHppROQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yOFQxMzoxNzo1MlrOHppgaw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMzQyOTgxNw==", "bodyText": "It will be nice to have a number of sent records here.", "url": "https://github.com/telstra/open-kilda/pull/3812#discussion_r513429817", "createdAt": "2020-10-28T13:12:25Z", "author": {"login": "surabujin"}, "path": "src-java/server42/server42-control-server-stub/src/main/java/org/openkilda/server42/control/serverstub/StatsServer.java", "diffHunk": "@@ -87,8 +87,10 @@ public void run() {\n                     }\n                 }\n \n-                if (!flows.isEmpty()) {\n-                    server.send(flowBucketBuilder.build().toByteArray());\n+                server.send(flowBucketBuilder.build().toByteArray());\n+                if (flows.isEmpty()) {\n+                    log.info(\"send ping\");\n+                } else {\n                     log.info(\"send stats\");", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "54301119c20b2e253a6c7152a8e547b2bd4551ba"}, "originalPosition": 10}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMzQzMzcwNw==", "bodyText": "Can/should it be done on line Socket server = context.createSocket(ZMQ.PULL);? I suspect that \"some\" resource allocation happens inside .createSocket(...) call, not only inside .connect(...) call.", "url": "https://github.com/telstra/open-kilda/pull/3812#discussion_r513433707", "createdAt": "2020-10-28T13:17:52Z", "author": {"login": "surabujin"}, "path": "src-java/server42/server42-stats/src/main/java/org/openkilda/server42/stats/zeromq/StatsCollector.java", "diffHunk": "@@ -73,9 +73,13 @@ public void run() {\n         sessionId = RandomStringUtils.randomAlphanumeric(8);\n         log.info(\"started with session id {}\", sessionId);\n         while (!isInterrupted()) {\n-            try (Socket server = context.createSocket(ZMQ.PULL)) {\n+\n+            Socket serverRef = null;\n+            try {\n+                Socket server = context.createSocket(ZMQ.PULL);\n                 server.setReceiveTimeOut(1000);\n                 server.connect(connectEndpoint);\n+                serverRef = server;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "54301119c20b2e253a6c7152a8e547b2bd4551ba"}, "originalPosition": 11}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f772902e4eb13632bd3ca8fdfa50539e22281725", "author": {"user": {"login": "nikitamarchenko", "name": "Nikita Marchenko"}}, "url": "https://github.com/telstra/open-kilda/commit/f772902e4eb13632bd3ca8fdfa50539e22281725", "committedDate": "2020-10-28T13:31:25Z", "message": "[Server42] fix resources leak closes #3797"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "54301119c20b2e253a6c7152a8e547b2bd4551ba", "author": {"user": {"login": "nikitamarchenko", "name": "Nikita Marchenko"}}, "url": "https://github.com/telstra/open-kilda/commit/54301119c20b2e253a6c7152a8e547b2bd4551ba", "committedDate": "2020-10-28T13:07:13Z", "message": "[Server42] fix resources leak closes #3797"}, "afterCommit": {"oid": "f772902e4eb13632bd3ca8fdfa50539e22281725", "author": {"user": {"login": "nikitamarchenko", "name": "Nikita Marchenko"}}, "url": "https://github.com/telstra/open-kilda/commit/f772902e4eb13632bd3ca8fdfa50539e22281725", "committedDate": "2020-10-28T13:31:25Z", "message": "[Server42] fix resources leak closes #3797"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3751, "cost": 1, "resetAt": "2021-11-02T12:20:56Z"}}}