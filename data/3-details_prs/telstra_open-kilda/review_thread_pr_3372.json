{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDAwNzAwNDI3", "number": 3372, "reviewThreads": {"totalCount": 9, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xMlQwNjo1MzowN1rOD7g4aQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yMFQxMzoyMzowN1rOD-NuSg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjYzNzMxMzA1OnYy", "diffSide": "RIGHT", "path": "src-java/base-topology/base-storm-topology/src/main/java/org/openkilda/wfm/share/history/model/FlowEventData.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xMlQwNjo1MzowN1rOGT4dHQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xMlQxMDo0NDowMlrOGUAx4w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMzUwMTA4NQ==", "bodyText": "Flows, not flow", "url": "https://github.com/telstra/open-kilda/pull/3372#discussion_r423501085", "createdAt": "2020-05-12T06:53:07Z", "author": {"login": "timofei-durakov"}, "path": "src-java/base-topology/base-storm-topology/src/main/java/org/openkilda/wfm/share/history/model/FlowEventData.java", "diffHunk": "@@ -43,7 +43,8 @@\n         CREATE(\"Flow creating\"),\n         UPDATE(\"Flow updating\"),\n         REROUTE(\"Flow rerouting\"),\n-        DELETE(\"Flow deleting\");\n+        DELETE(\"Flow deleting\"),\n+        SWAP_ENDPOINTS(\"Flow swap endpoints\");", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "69ee5fdb6dc6042f049eeb50045580020a78c89a"}, "originalPosition": 6}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMzYzNzQ3NQ==", "bodyText": "Fixed", "url": "https://github.com/telstra/open-kilda/pull/3372#discussion_r423637475", "createdAt": "2020-05-12T10:44:02Z", "author": {"login": "dpoltavets"}, "path": "src-java/base-topology/base-storm-topology/src/main/java/org/openkilda/wfm/share/history/model/FlowEventData.java", "diffHunk": "@@ -43,7 +43,8 @@\n         CREATE(\"Flow creating\"),\n         UPDATE(\"Flow updating\"),\n         REROUTE(\"Flow rerouting\"),\n-        DELETE(\"Flow deleting\");\n+        DELETE(\"Flow deleting\"),\n+        SWAP_ENDPOINTS(\"Flow swap endpoints\");", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMzUwMTA4NQ=="}, "originalCommit": {"oid": "69ee5fdb6dc6042f049eeb50045580020a78c89a"}, "originalPosition": 6}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjYzNzMyNzM3OnYy", "diffSide": "RIGHT", "path": "src-java/flow-topology/flow-messaging/src/main/java/org/openkilda/messaging/command/flow/FlowRequest.java", "isResolved": false, "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xMlQwNjo1Nzo1NVrOGT4mIg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yMFQwOTo1NzowN1rOGYEK7A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMzUwMzM5NA==", "bodyText": "nit: revertable otherwise it will be less readable imho", "url": "https://github.com/telstra/open-kilda/pull/3372#discussion_r423503394", "createdAt": "2020-05-12T06:57:55Z", "author": {"login": "timofei-durakov"}, "path": "src-java/flow-topology/flow-messaging/src/main/java/org/openkilda/messaging/command/flow/FlowRequest.java", "diffHunk": "@@ -73,6 +76,10 @@\n     @Builder.Default\n     DetectConnectedDevicesDto detectConnectedDevices = new DetectConnectedDevicesDto();\n \n+    @Builder.Default\n+    Set<String> bulkUpdateFlowIds = new HashSet<>();\n+    boolean doNotRevert;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "69ee5fdb6dc6042f049eeb50045580020a78c89a"}, "originalPosition": 29}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNTI2NDM4Ng==", "bodyText": "Is \"doNotRevert\" flag applicable to all types of flow requests? If not, it makes sense to have a dedicated request class.", "url": "https://github.com/telstra/open-kilda/pull/3372#discussion_r425264386", "createdAt": "2020-05-14T16:20:02Z", "author": {"login": "sergii-iakovenko"}, "path": "src-java/flow-topology/flow-messaging/src/main/java/org/openkilda/messaging/command/flow/FlowRequest.java", "diffHunk": "@@ -73,6 +76,10 @@\n     @Builder.Default\n     DetectConnectedDevicesDto detectConnectedDevices = new DetectConnectedDevicesDto();\n \n+    @Builder.Default\n+    Set<String> bulkUpdateFlowIds = new HashSet<>();\n+    boolean doNotRevert;", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMzUwMzM5NA=="}, "originalCommit": {"oid": "69ee5fdb6dc6042f049eeb50045580020a78c89a"}, "originalPosition": 29}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNzg4NzM0MA==", "bodyText": "I think that need to do this after removing Flow Topology. Otherwise, there will be more mess in the requests and names.", "url": "https://github.com/telstra/open-kilda/pull/3372#discussion_r427887340", "createdAt": "2020-05-20T09:57:07Z", "author": {"login": "dpoltavets"}, "path": "src-java/flow-topology/flow-messaging/src/main/java/org/openkilda/messaging/command/flow/FlowRequest.java", "diffHunk": "@@ -73,6 +76,10 @@\n     @Builder.Default\n     DetectConnectedDevicesDto detectConnectedDevices = new DetectConnectedDevicesDto();\n \n+    @Builder.Default\n+    Set<String> bulkUpdateFlowIds = new HashSet<>();\n+    boolean doNotRevert;", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMzUwMzM5NA=="}, "originalCommit": {"oid": "69ee5fdb6dc6042f049eeb50045580020a78c89a"}, "originalPosition": 29}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjYzNzQyMjQxOnYy", "diffSide": "RIGHT", "path": "src-java/flowhs-topology/flowhs-storm-topology/src/main/java/org/openkilda/wfm/topology/flowhs/validation/FlowValidator.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xMlQwNzoyNzozMVrOGT5hcw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xMlQxMDo0NDoxMFrOGUAyIQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMzUxODU3OQ==", "bodyText": "need more details on that validation logic, please leave a comment", "url": "https://github.com/telstra/open-kilda/pull/3372#discussion_r423518579", "createdAt": "2020-05-12T07:27:31Z", "author": {"login": "timofei-durakov"}, "path": "src-java/flowhs-topology/flowhs-storm-topology/src/main/java/org/openkilda/wfm/topology/flowhs/validation/FlowValidator.java", "diffHunk": "@@ -288,4 +328,49 @@ private void validateMultiTableProperty(SwitchId switchId, List<String> errorMes\n             }\n         }\n     }\n+\n+    /**\n+     * Check for equals endpoints.\n+     *\n+     * @param firstFlow a first flow.\n+     * @param secondFlow a second flow.\n+     */\n+    @VisibleForTesting\n+    void checkForEqualsEndpoints(RequestedFlow firstFlow, RequestedFlow secondFlow) throws InvalidFlowException {\n+        List<Endpoint> endpoints = new ArrayList<>();\n+        endpoints.add(new Endpoint(firstFlow.getSrcSwitch(),\n+                firstFlow.getSrcPort(), firstFlow.getSrcVlan()));\n+        endpoints.add(new Endpoint(firstFlow.getDestSwitch(),\n+                firstFlow.getDestPort(), firstFlow.getDestVlan()));\n+        endpoints.add(new Endpoint(secondFlow.getSrcSwitch(),\n+                secondFlow.getSrcPort(), secondFlow.getSrcVlan()));\n+        endpoints.add(new Endpoint(secondFlow.getDestSwitch(),\n+                secondFlow.getDestPort(), secondFlow.getDestVlan()));\n+\n+        Set<Endpoint> checkSet = new HashSet<>();\n+        for (Endpoint endpoint : endpoints) {\n+            if (!checkSet.contains(endpoint)) {\n+                checkSet.add(endpoint);\n+            } else {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "69ee5fdb6dc6042f049eeb50045580020a78c89a"}, "originalPosition": 137}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMzYzNzUzNw==", "bodyText": "Fixed", "url": "https://github.com/telstra/open-kilda/pull/3372#discussion_r423637537", "createdAt": "2020-05-12T10:44:10Z", "author": {"login": "dpoltavets"}, "path": "src-java/flowhs-topology/flowhs-storm-topology/src/main/java/org/openkilda/wfm/topology/flowhs/validation/FlowValidator.java", "diffHunk": "@@ -288,4 +328,49 @@ private void validateMultiTableProperty(SwitchId switchId, List<String> errorMes\n             }\n         }\n     }\n+\n+    /**\n+     * Check for equals endpoints.\n+     *\n+     * @param firstFlow a first flow.\n+     * @param secondFlow a second flow.\n+     */\n+    @VisibleForTesting\n+    void checkForEqualsEndpoints(RequestedFlow firstFlow, RequestedFlow secondFlow) throws InvalidFlowException {\n+        List<Endpoint> endpoints = new ArrayList<>();\n+        endpoints.add(new Endpoint(firstFlow.getSrcSwitch(),\n+                firstFlow.getSrcPort(), firstFlow.getSrcVlan()));\n+        endpoints.add(new Endpoint(firstFlow.getDestSwitch(),\n+                firstFlow.getDestPort(), firstFlow.getDestVlan()));\n+        endpoints.add(new Endpoint(secondFlow.getSrcSwitch(),\n+                secondFlow.getSrcPort(), secondFlow.getSrcVlan()));\n+        endpoints.add(new Endpoint(secondFlow.getDestSwitch(),\n+                secondFlow.getDestPort(), secondFlow.getDestVlan()));\n+\n+        Set<Endpoint> checkSet = new HashSet<>();\n+        for (Endpoint endpoint : endpoints) {\n+            if (!checkSet.contains(endpoint)) {\n+                checkSet.add(endpoint);\n+            } else {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMzUxODU3OQ=="}, "originalCommit": {"oid": "69ee5fdb6dc6042f049eeb50045580020a78c89a"}, "originalPosition": 137}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjY0ODIxODc4OnYy", "diffSide": "RIGHT", "path": "src-java/flow-topology/flow-messaging/src/main/java/org/openkilda/messaging/command/flow/SwapFlowEndpointRequest.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xNFQxNjoyMjowMVrOGVkKEA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xNFQxNjoyMjowMVrOGVkKEA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNTI2NTY4MA==", "bodyText": "nit: why not just 2?", "url": "https://github.com/telstra/open-kilda/pull/3372#discussion_r425265680", "createdAt": "2020-05-14T16:22:01Z", "author": {"login": "sergii-iakovenko"}, "path": "src-java/flow-topology/flow-messaging/src/main/java/org/openkilda/messaging/command/flow/SwapFlowEndpointRequest.java", "diffHunk": "@@ -28,16 +28,16 @@\n  */\n @Value\n @EqualsAndHashCode(callSuper = false)\n-public class SwapFlowEndpointRequest extends FlowsBaseRequest {\n-    private static final long serialVersionUID = 1L;\n+public class SwapFlowEndpointRequest extends BaseRequest {\n+    private static final long serialVersionUID = 694340554858269632L;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "aed67242fe369e650990d51da96c49fd0b389890"}, "originalPosition": 22}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjY0ODM5NDI0OnYy", "diffSide": "RIGHT", "path": "src-java/flowhs-topology/flowhs-storm-topology/src/main/java/org/openkilda/wfm/topology/flowhs/fsm/common/actions/FlowProcessingAction.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xNFQxNzowMzozOFrOGVl6PQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yMFQwOTo1NzoyNVrOGYELqg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNTI5NDM5Nw==", "bodyText": "Why did we put this method in generic and shared FlowProcessingAction? It has a very specific use case - wrap the result of findPathIdsByFlowIds into a list for PCE.", "url": "https://github.com/telstra/open-kilda/pull/3372#discussion_r425294397", "createdAt": "2020-05-14T17:03:38Z", "author": {"login": "sergii-iakovenko"}, "path": "src-java/flowhs-topology/flowhs-storm-topology/src/main/java/org/openkilda/wfm/topology/flowhs/fsm/common/actions/FlowProcessingAction.java", "diffHunk": "@@ -104,4 +112,18 @@ protected FlowPath getFlowPath(PathId pathId) {\n                         .filter(flowId -> !flowId.equals(flow.getFlowId()))\n                         .collect(Collectors.toSet());\n     }\n+\n+    protected List<PathId> getFlowsPathIds(Set<String> flowIds) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "aed67242fe369e650990d51da96c49fd0b389890"}, "originalPosition": 43}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNzg4NzUzMA==", "bodyText": "Fixed", "url": "https://github.com/telstra/open-kilda/pull/3372#discussion_r427887530", "createdAt": "2020-05-20T09:57:25Z", "author": {"login": "dpoltavets"}, "path": "src-java/flowhs-topology/flowhs-storm-topology/src/main/java/org/openkilda/wfm/topology/flowhs/fsm/common/actions/FlowProcessingAction.java", "diffHunk": "@@ -104,4 +112,18 @@ protected FlowPath getFlowPath(PathId pathId) {\n                         .filter(flowId -> !flowId.equals(flow.getFlowId()))\n                         .collect(Collectors.toSet());\n     }\n+\n+    protected List<PathId> getFlowsPathIds(Set<String> flowIds) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNTI5NDM5Nw=="}, "originalCommit": {"oid": "aed67242fe369e650990d51da96c49fd0b389890"}, "originalPosition": 43}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjY1MDY5MTQ1OnYy", "diffSide": "RIGHT", "path": "src-java/flowhs-topology/flowhs-storm-topology/src/main/java/org/openkilda/wfm/topology/flowhs/fsm/common/NbTrackableFsm.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xNVQwODo1NjoyN1rOGV8Vgw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yMFQwOTo1NzozNVrOGYEMIA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNTY2MTgyNw==", "bodyText": "hit: you can apply the annotation to the field instead.", "url": "https://github.com/telstra/open-kilda/pull/3372#discussion_r425661827", "createdAt": "2020-05-15T08:56:27Z", "author": {"login": "sergii-iakovenko"}, "path": "src-java/flowhs-topology/flowhs-storm-topology/src/main/java/org/openkilda/wfm/topology/flowhs/fsm/common/NbTrackableFsm.java", "diffHunk": "@@ -18,14 +18,20 @@\n import org.openkilda.messaging.Message;\n import org.openkilda.wfm.CommandContext;\n \n+import lombok.Getter;\n+import lombok.Setter;\n import org.squirrelframework.foundation.fsm.StateMachine;\n \n+@Getter", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "aed67242fe369e650990d51da96c49fd0b389890"}, "originalPosition": 14}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNzg4NzY0OA==", "bodyText": "Fixed", "url": "https://github.com/telstra/open-kilda/pull/3372#discussion_r427887648", "createdAt": "2020-05-20T09:57:35Z", "author": {"login": "dpoltavets"}, "path": "src-java/flowhs-topology/flowhs-storm-topology/src/main/java/org/openkilda/wfm/topology/flowhs/fsm/common/NbTrackableFsm.java", "diffHunk": "@@ -18,14 +18,20 @@\n import org.openkilda.messaging.Message;\n import org.openkilda.wfm.CommandContext;\n \n+import lombok.Getter;\n+import lombok.Setter;\n import org.squirrelframework.foundation.fsm.StateMachine;\n \n+@Getter", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNTY2MTgyNw=="}, "originalCommit": {"oid": "aed67242fe369e650990d51da96c49fd0b389890"}, "originalPosition": 14}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjY1MDc3OTQ1OnYy", "diffSide": "RIGHT", "path": "src-java/flowhs-topology/flowhs-storm-topology/src/main/java/org/openkilda/wfm/topology/flowhs/fsm/common/WithHistorySupportFsm.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xNVQwOToyMTo1N1rOGV9N1g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xNVQwOToyMTo1N1rOGV9N1g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNTY3NjI0Ng==", "bodyText": "So now, a FSM can log an history event with the taskId and flowId which don't belong to the FSM? Let's discuss this.", "url": "https://github.com/telstra/open-kilda/pull/3372#discussion_r425676246", "createdAt": "2020-05-15T09:21:57Z", "author": {"login": "sergii-iakovenko"}, "path": "src-java/flowhs-topology/flowhs-storm-topology/src/main/java/org/openkilda/wfm/topology/flowhs/fsm/common/WithHistorySupportFsm.java", "diffHunk": "@@ -99,24 +122,41 @@ public void saveNewEventToHistory(String action, FlowEventData.Event event) {\n         saveNewEventToHistory(action, event, null, null);\n     }\n \n+    /**\n+     * Add a history record on the new event.\n+     */\n+    public void saveNewEventToHistory(String flowId, String action, FlowEventData.Event event) {\n+        String taskId = KeyProvider.joinKeys(flowId, getCommandContext().getCorrelationId());\n+        saveNewEventToHistory(flowId, action, event, null, null, taskId);\n+    }\n+\n     /**\n      * Add a history record on the new event.\n      */\n     public void saveNewEventToHistory(String action, FlowEventData.Event event,\n                                       FlowEventData.Initiator initiator,\n                                       String details) {\n-        log.debug(\"Flow {} action - {} : {}\", getFlowId(), action, event);\n+        saveNewEventToHistory(getFlowId(), action, event, initiator, details, getCommandContext().getCorrelationId());\n+    }\n+\n+    /**\n+     * Add a history record on the new event.\n+     */\n+    public void saveNewEventToHistory(String flowId, String action, FlowEventData.Event event,", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "aed67242fe369e650990d51da96c49fd0b389890"}, "originalPosition": 77}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjY1MDgwMzg0OnYy", "diffSide": "RIGHT", "path": "src-java/flowhs-topology/flowhs-storm-topology/src/main/java/org/openkilda/wfm/topology/flowhs/fsm/update/actions/AllocatePrimaryResourcesAction.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xNVQwOToyOTowMVrOGV9dkg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yMFQwOTo1ODoxOFrOGYEN1w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNTY4MDI3NA==", "bodyText": "It's a really controversial solution - you allow overprovisioning for the sum of all flows' bandwidth for a single new path, but can't guarantee that this bandwidth will be release by those flows as they can have different paths.", "url": "https://github.com/telstra/open-kilda/pull/3372#discussion_r425680274", "createdAt": "2020-05-15T09:29:01Z", "author": {"login": "sergii-iakovenko"}, "path": "src-java/flowhs-topology/flowhs-storm-topology/src/main/java/org/openkilda/wfm/topology/flowhs/fsm/update/actions/AllocatePrimaryResourcesAction.java", "diffHunk": "@@ -69,7 +82,9 @@ protected void allocate(FlowUpdateFsm stateMachine)\n                 .forward(flow.getForwardPath())\n                 .reverse(flow.getReversePath())\n                 .build();\n-        FlowPathPair newPaths = createFlowPathPair(flow, oldPaths, potentialPath, flowResources);\n+        long overprovisionedBandwidth = getFlowsBandwidthSum(flowIds);\n+        FlowPathPair newPaths = createFlowPathPair(flow, oldPaths, potentialPath, flowResources,", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "aed67242fe369e650990d51da96c49fd0b389890"}, "originalPosition": 54}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNzg4ODA4Nw==", "bodyText": "Fixed.", "url": "https://github.com/telstra/open-kilda/pull/3372#discussion_r427888087", "createdAt": "2020-05-20T09:58:18Z", "author": {"login": "dpoltavets"}, "path": "src-java/flowhs-topology/flowhs-storm-topology/src/main/java/org/openkilda/wfm/topology/flowhs/fsm/update/actions/AllocatePrimaryResourcesAction.java", "diffHunk": "@@ -69,7 +82,9 @@ protected void allocate(FlowUpdateFsm stateMachine)\n                 .forward(flow.getForwardPath())\n                 .reverse(flow.getReversePath())\n                 .build();\n-        FlowPathPair newPaths = createFlowPathPair(flow, oldPaths, potentialPath, flowResources);\n+        long overprovisionedBandwidth = getFlowsBandwidthSum(flowIds);\n+        FlowPathPair newPaths = createFlowPathPair(flow, oldPaths, potentialPath, flowResources,", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNTY4MDI3NA=="}, "originalCommit": {"oid": "aed67242fe369e650990d51da96c49fd0b389890"}, "originalPosition": 54}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjY2NTYzMTQ2OnYy", "diffSide": "RIGHT", "path": "src-java/kilda-persistence-api/src/main/java/org/openkilda/persistence/repositories/FlowPathRepository.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yMFQxMzoyMzowN1rOGYLZhQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yMFQxMzo0NTozN1rOGYMdow==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyODAwNTc2NQ==", "bodyText": "Shouldn't we rename it to \"findByFlowIds\"?", "url": "https://github.com/telstra/open-kilda/pull/3372#discussion_r428005765", "createdAt": "2020-05-20T13:23:07Z", "author": {"login": "sergii-iakovenko"}, "path": "src-java/kilda-persistence-api/src/main/java/org/openkilda/persistence/repositories/FlowPathRepository.java", "diffHunk": "@@ -39,9 +39,9 @@\n \n     Collection<FlowPath> findByFlowGroupId(String flowGroupId);\n \n-    Collection<PathId> findPathIdsByFlowGroupId(String flowGroupId);\n+    Collection<FlowPath> findPathIdsByFlowIds(Set<String> flowIds);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "2bb038818b52c4fbe5e6695afad20ecf0b784827"}, "originalPosition": 5}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyODAyMzIwMw==", "bodyText": "Yes, you are right. Fixed.", "url": "https://github.com/telstra/open-kilda/pull/3372#discussion_r428023203", "createdAt": "2020-05-20T13:45:37Z", "author": {"login": "dpoltavets"}, "path": "src-java/kilda-persistence-api/src/main/java/org/openkilda/persistence/repositories/FlowPathRepository.java", "diffHunk": "@@ -39,9 +39,9 @@\n \n     Collection<FlowPath> findByFlowGroupId(String flowGroupId);\n \n-    Collection<PathId> findPathIdsByFlowGroupId(String flowGroupId);\n+    Collection<FlowPath> findPathIdsByFlowIds(Set<String> flowIds);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyODAwNTc2NQ=="}, "originalCommit": {"oid": "2bb038818b52c4fbe5e6695afad20ecf0b784827"}, "originalPosition": 5}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1920, "cost": 1, "resetAt": "2021-11-13T14:23:39Z"}}}