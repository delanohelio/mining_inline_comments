{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0MzY3NTgwNjIy", "number": 3148, "title": "Periodic pings perf", "bodyText": "This change is\u2002", "createdAt": "2020-01-27T16:19:01Z", "url": "https://github.com/telstra/open-kilda/pull/3148", "merged": true, "mergeCommit": {"oid": "8f3a1c2719886d2390129a454f0afdf4add378aa"}, "closed": true, "closedAt": "2020-01-28T18:16:01Z", "author": {"login": "timofei-durakov"}, "timelineItems": {"totalCount": 17, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABb-hwQ0gBqjI5ODMwNjMzNTQ=", "endCursor": "Y3Vyc29yOnYyOpPPAAABb-ydIDABqjI5ODU5MTczMDQ=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "bc820ee76006fe115f22dab304820bdf5693b1f7", "author": {"user": {"login": "timofei-durakov", "name": "Timofey Durakov"}}, "url": "https://github.com/telstra/open-kilda/commit/bc820ee76006fe115f22dab304820bdf5693b1f7", "committedDate": "2020-01-27T16:17:13Z", "message": "Add periodic pings to flow patch api"}, "afterCommit": {"oid": "fe7f20f0f2740a20e47701524fd1bbae4855f8fa", "author": {"user": {"login": "timofei-durakov", "name": "Timofey Durakov"}}, "url": "https://github.com/telstra/open-kilda/commit/fe7f20f0f2740a20e47701524fd1bbae4855f8fa", "committedDate": "2020-01-27T19:17:34Z", "message": "Add periodic pings to flow patch api"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "fe7f20f0f2740a20e47701524fd1bbae4855f8fa", "author": {"user": {"login": "timofei-durakov", "name": "Timofey Durakov"}}, "url": "https://github.com/telstra/open-kilda/commit/fe7f20f0f2740a20e47701524fd1bbae4855f8fa", "committedDate": "2020-01-27T19:17:34Z", "message": "Add periodic pings to flow patch api"}, "afterCommit": {"oid": "a29e42e56cfbc6bec244d9f7e8ac6d3bdeeb4bca", "author": {"user": {"login": "timofei-durakov", "name": "Timofey Durakov"}}, "url": "https://github.com/telstra/open-kilda/commit/a29e42e56cfbc6bec244d9f7e8ac6d3bdeeb4bca", "committedDate": "2020-01-27T19:55:08Z", "message": "Add periodic pings to flow patch api"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "a29e42e56cfbc6bec244d9f7e8ac6d3bdeeb4bca", "author": {"user": {"login": "timofei-durakov", "name": "Timofey Durakov"}}, "url": "https://github.com/telstra/open-kilda/commit/a29e42e56cfbc6bec244d9f7e8ac6d3bdeeb4bca", "committedDate": "2020-01-27T19:55:08Z", "message": "Add periodic pings to flow patch api"}, "afterCommit": {"oid": "71468d88ecf93480409e5c48115d1484fd81a409", "author": {"user": {"login": "timofei-durakov", "name": "Timofey Durakov"}}, "url": "https://github.com/telstra/open-kilda/commit/71468d88ecf93480409e5c48115d1484fd81a409", "committedDate": "2020-01-28T05:58:12Z", "message": "Add periodic pings to flow patch api"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzQ5MTQ1Mzgy", "url": "https://github.com/telstra/open-kilda/pull/3148#pullrequestreview-349145382", "createdAt": "2020-01-28T06:04:56Z", "commit": {"oid": "71468d88ecf93480409e5c48115d1484fd81a409"}, "state": "COMMENTED", "comments": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yOFQwNjowNDo1NlrOFiaCoQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yOFQwNjoxOTo0OVrOFiaOOQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MTYyMjU2MQ==", "bodyText": "(nit)  Boolean.TRUE.equals(forward.getPeriodicPings())", "url": "https://github.com/telstra/open-kilda/pull/3148#discussion_r371622561", "createdAt": "2020-01-28T06:04:56Z", "author": {"login": "niksv"}, "path": "services/src/messaging/src/main/java/org/openkilda/messaging/model/BidirectionalFlowDto.java", "diffHunk": "@@ -70,7 +70,7 @@ public BidirectionalFlowDto(FlowDto forward, FlowDto reverse) {\n         this(forward.getFlowId(),\n                 forward.getBandwidth(),\n                 forward.isIgnoreBandwidth(),\n-                forward.isPeriodicPings(),\n+                forward.getPeriodicPings() != null ? forward.getPeriodicPings() : false,", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "71468d88ecf93480409e5c48115d1484fd81a409"}, "originalPosition": 5}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MTYyMjY2MA==", "bodyText": "same", "url": "https://github.com/telstra/open-kilda/pull/3148#discussion_r371622660", "createdAt": "2020-01-28T06:05:29Z", "author": {"login": "niksv"}, "path": "services/wfm/src/main/java/org/openkilda/wfm/share/mappers/FlowMapper.java", "diffHunk": "@@ -282,7 +282,7 @@ private Flow buildFlow(FlowDto flow, Supplier<KildaConfiguration> kildaConfigura\n                 .description(flow.getDescription())\n                 .bandwidth(flow.getBandwidth())\n                 .ignoreBandwidth(flow.isIgnoreBandwidth())\n-                .periodicPings(flow.isPeriodicPings())\n+                .periodicPings(flow.getPeriodicPings() != null ? flow.getPeriodicPings() : false)", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "71468d88ecf93480409e5c48115d1484fd81a409"}, "originalPosition": 5}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MTYyNDY0Nw==", "bodyText": "should it be StreamType.PING.toString() instead of stream.toString() ?", "url": "https://github.com/telstra/open-kilda/pull/3148#discussion_r371624647", "createdAt": "2020-01-28T06:15:19Z", "author": {"login": "niksv"}, "path": "services/wfm/src/main/java/org/openkilda/wfm/topology/flow/bolts/CrudBolt.java", "diffHunk": "@@ -795,5 +802,14 @@ public void sendFlowCommands(@NonNull String flowId, @NonNull List<CommandGroup>\n                     System.currentTimeMillis(), correlationId);\n             outputCollector.emit(stream.toString(), tuple, new Values(message, flowId));\n         }\n+\n+        @Override\n+        public void sendPeriodicPingNotification(@NonNull String flowId, boolean enabled) {\n+            CommandMessage message = new CommandMessage(\n+                    new PeriodicPingCommand(flowId, enabled),\n+                    System.currentTimeMillis(), correlationId);\n+\n+            outputCollector.emit(stream.toString(), tuple, new Values(correlationId, message));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "71468d88ecf93480409e5c48115d1484fd81a409"}, "originalPosition": 48}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MTYyNTI3Nw==", "bodyText": "what if there is no such flow?", "url": "https://github.com/telstra/open-kilda/pull/3148#discussion_r371625277", "createdAt": "2020-01-28T06:18:29Z", "author": {"login": "niksv"}, "path": "services/wfm/src/main/java/org/openkilda/wfm/topology/flow/service/FlowService.java", "diffHunk": "@@ -1539,6 +1539,17 @@ private void unwrapBaseFaisafeException(FailsafeException e) throws UnroutableFl\n         return swapFlows(currentFirstFlow, existingFirstFlow, currentSecondFlow, existingSecondFlow, sender);\n     }\n \n+    /**\n+     * Fetch flow and provide update on it's periodic pings.\n+     * @param flowId flow id\n+     * @param sender interface\n+     */\n+    public void notifyOnPeriodicPingChanges(String flowId,\n+                                            FlowCommandSender sender) {\n+        Flow flow = flowRepository.findById(flowId).get();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "71468d88ecf93480409e5c48115d1484fd81a409"}, "originalPosition": 11}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MTYyNTUyOQ==", "bodyText": "(nit) two spaces :)", "url": "https://github.com/telstra/open-kilda/pull/3148#discussion_r371625529", "createdAt": "2020-01-28T06:19:49Z", "author": {"login": "niksv"}, "path": "services/wfm/src/main/java/org/openkilda/wfm/topology/flowhs/fsm/update/actions/OnFinishedAction.java", "diffHunk": "@@ -38,8 +39,12 @@ public OnFinishedAction(FlowOperationsDashboardLogger dashboardLogger) {\n     @Override\n     public void perform(State from, State to, Event event, FlowUpdateContext context, FlowUpdateFsm stateMachine) {\n         if (stateMachine.getNewFlowStatus() == FlowStatus.UP) {\n+            RequestedFlow requestedFlow =  stateMachine.getTargetFlow();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "71468d88ecf93480409e5c48115d1484fd81a409"}, "originalPosition": 12}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzQ5MTUwNzM2", "url": "https://github.com/telstra/open-kilda/pull/3148#pullrequestreview-349150736", "createdAt": "2020-01-28T06:25:54Z", "commit": {"oid": "71468d88ecf93480409e5c48115d1484fd81a409"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "71468d88ecf93480409e5c48115d1484fd81a409", "author": {"user": {"login": "timofei-durakov", "name": "Timofey Durakov"}}, "url": "https://github.com/telstra/open-kilda/commit/71468d88ecf93480409e5c48115d1484fd81a409", "committedDate": "2020-01-28T05:58:12Z", "message": "Add periodic pings to flow patch api"}, "afterCommit": {"oid": "4ddb55b726f2a84372950c94e611d572305e6a7c", "author": {"user": {"login": "timofei-durakov", "name": "Timofey Durakov"}}, "url": "https://github.com/telstra/open-kilda/commit/4ddb55b726f2a84372950c94e611d572305e6a7c", "committedDate": "2020-01-28T06:43:56Z", "message": "Add periodic pings to flow patch api"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzQ5MTY3MDQ3", "url": "https://github.com/telstra/open-kilda/pull/3148#pullrequestreview-349167047", "createdAt": "2020-01-28T07:19:05Z", "commit": {"oid": "4ddb55b726f2a84372950c94e611d572305e6a7c"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzQ5MjAyNzQ4", "url": "https://github.com/telstra/open-kilda/pull/3148#pullrequestreview-349202748", "createdAt": "2020-01-28T08:44:49Z", "commit": {"oid": "4ddb55b726f2a84372950c94e611d572305e6a7c"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzQ5MjU5NDQ3", "url": "https://github.com/telstra/open-kilda/pull/3148#pullrequestreview-349259447", "createdAt": "2020-01-28T10:14:40Z", "commit": {"oid": "4ddb55b726f2a84372950c94e611d572305e6a7c"}, "state": "COMMENTED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzQ5MjgzMDc3", "url": "https://github.com/telstra/open-kilda/pull/3148#pullrequestreview-349283077", "createdAt": "2020-01-28T10:51:37Z", "commit": {"oid": "4ddb55b726f2a84372950c94e611d572305e6a7c"}, "state": "COMMENTED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzQ5Mjg0MzAx", "url": "https://github.com/telstra/open-kilda/pull/3148#pullrequestreview-349284301", "createdAt": "2020-01-28T10:53:39Z", "commit": {"oid": "4ddb55b726f2a84372950c94e611d572305e6a7c"}, "state": "COMMENTED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "4ddb55b726f2a84372950c94e611d572305e6a7c", "author": {"user": {"login": "timofei-durakov", "name": "Timofey Durakov"}}, "url": "https://github.com/telstra/open-kilda/commit/4ddb55b726f2a84372950c94e611d572305e6a7c", "committedDate": "2020-01-28T06:43:56Z", "message": "Add periodic pings to flow patch api"}, "afterCommit": {"oid": "1405caac25e3afd7bc09738a19e5cdd5ce086b08", "author": {"user": {"login": "timofei-durakov", "name": "Timofey Durakov"}}, "url": "https://github.com/telstra/open-kilda/commit/1405caac25e3afd7bc09738a19e5cdd5ce086b08", "committedDate": "2020-01-28T11:00:04Z", "message": "Add periodic pings to flow patch api"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzQ5Mjg4NTUz", "url": "https://github.com/telstra/open-kilda/pull/3148#pullrequestreview-349288553", "createdAt": "2020-01-28T11:00:40Z", "commit": {"oid": "4ddb55b726f2a84372950c94e611d572305e6a7c"}, "state": "COMMENTED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzQ5MzY1ODY2", "url": "https://github.com/telstra/open-kilda/pull/3148#pullrequestreview-349365866", "createdAt": "2020-01-28T13:20:13Z", "commit": {"oid": "1405caac25e3afd7bc09738a19e5cdd5ce086b08"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "4462f173469dc63015bc6e213176b81553720dbb", "author": {"user": {"login": "timofei-durakov", "name": "Timofey Durakov"}}, "url": "https://github.com/telstra/open-kilda/commit/4462f173469dc63015bc6e213176b81553720dbb", "committedDate": "2020-01-28T14:45:00Z", "message": "Add external events for periodic ping"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "96f400270272f8b8aa3f60331cdfbf26e6f81372", "author": {"user": {"login": "timofei-durakov", "name": "Timofey Durakov"}}, "url": "https://github.com/telstra/open-kilda/commit/96f400270272f8b8aa3f60331cdfbf26e6f81372", "committedDate": "2020-01-28T14:45:00Z", "message": "Add periodic pings to flow patch api"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "1405caac25e3afd7bc09738a19e5cdd5ce086b08", "author": {"user": {"login": "timofei-durakov", "name": "Timofey Durakov"}}, "url": "https://github.com/telstra/open-kilda/commit/1405caac25e3afd7bc09738a19e5cdd5ce086b08", "committedDate": "2020-01-28T11:00:04Z", "message": "Add periodic pings to flow patch api"}, "afterCommit": {"oid": "96f400270272f8b8aa3f60331cdfbf26e6f81372", "author": {"user": {"login": "timofei-durakov", "name": "Timofey Durakov"}}, "url": "https://github.com/telstra/open-kilda/commit/96f400270272f8b8aa3f60331cdfbf26e6f81372", "committedDate": "2020-01-28T14:45:00Z", "message": "Add periodic pings to flow patch api"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3697, "cost": 1, "resetAt": "2021-11-02T12:20:56Z"}}}