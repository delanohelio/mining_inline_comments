{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0Mzc0Mjg2ODUy", "number": 3197, "title": "improve test according to #3194", "bodyText": "", "createdAt": "2020-02-12T12:42:06Z", "url": "https://github.com/telstra/open-kilda/pull/3197", "merged": true, "mergeCommit": {"oid": "d3b7d6f76dce551e0458bfa98d0e2de14b0c95a2"}, "closed": true, "closedAt": "2020-03-11T14:21:20Z", "author": {"login": "andriidovhan"}, "timelineItems": {"totalCount": 6, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcDlsUYgBqjMwMzA2NDgxMTc=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcMn3AQgFqTM3MjgwMTIzMA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "af4d66fe75a808aebbbd0fdd3ce4a18edbe4e5fc", "author": {"user": {"login": "andriidovhan", "name": "AndriiDovhan"}}, "url": "https://github.com/telstra/open-kilda/commit/af4d66fe75a808aebbbd0fdd3ce4a18edbe4e5fc", "committedDate": "2020-02-12T12:41:37Z", "message": "improve test according to #3194"}, "afterCommit": {"oid": "ae0c0f2ed241535c06019ff87994bdcbc629c17b", "author": {"user": {"login": "andriidovhan", "name": "AndriiDovhan"}}, "url": "https://github.com/telstra/open-kilda/commit/ae0c0f2ed241535c06019ff87994bdcbc629c17b", "committedDate": "2020-02-12T12:42:38Z", "message": "improve test according to #3194"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "ae0c0f2ed241535c06019ff87994bdcbc629c17b", "author": {"user": {"login": "andriidovhan", "name": "AndriiDovhan"}}, "url": "https://github.com/telstra/open-kilda/commit/ae0c0f2ed241535c06019ff87994bdcbc629c17b", "committedDate": "2020-02-12T12:42:38Z", "message": "improve test according to #3194"}, "afterCommit": {"oid": "11739be2bb6c136ba9d4c7f5820a617dd122ac85", "author": {"user": {"login": "andriidovhan", "name": "AndriiDovhan"}}, "url": "https://github.com/telstra/open-kilda/commit/11739be2bb6c136ba9d4c7f5820a617dd122ac85", "committedDate": "2020-02-19T11:35:08Z", "message": "improve test according to #3194"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ecbd80fe93e93d3d49e61efe9197be22a46d4965", "author": {"user": {"login": "andriidovhan", "name": "AndriiDovhan"}}, "url": "https://github.com/telstra/open-kilda/commit/ecbd80fe93e93d3d49e61efe9197be22a46d4965", "committedDate": "2020-02-21T09:31:59Z", "message": "improve test according to #3194"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "11739be2bb6c136ba9d4c7f5820a617dd122ac85", "author": {"user": {"login": "andriidovhan", "name": "AndriiDovhan"}}, "url": "https://github.com/telstra/open-kilda/commit/11739be2bb6c136ba9d4c7f5820a617dd122ac85", "committedDate": "2020-02-19T11:35:08Z", "message": "improve test according to #3194"}, "afterCommit": {"oid": "ecbd80fe93e93d3d49e61efe9197be22a46d4965", "author": {"user": {"login": "andriidovhan", "name": "AndriiDovhan"}}, "url": "https://github.com/telstra/open-kilda/commit/ecbd80fe93e93d3d49e61efe9197be22a46d4965", "committedDate": "2020-02-21T09:31:59Z", "message": "improve test according to #3194"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzYyNTE1OTY3", "url": "https://github.com/telstra/open-kilda/pull/3197#pullrequestreview-362515967", "createdAt": "2020-02-21T09:58:16Z", "commit": {"oid": "ecbd80fe93e93d3d49e61efe9197be22a46d4965"}, "state": "APPROVED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yMVQwOTo1ODoxNlrOFsxgxQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yMVQwOTo1ODoxNlrOFsxgxQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MjQ5Mjg2OQ==", "bodyText": "I'd appreciate a brief comment about why we expect '5' here. This is not obvious", "url": "https://github.com/telstra/open-kilda/pull/3197#discussion_r382492869", "createdAt": "2020-02-21T09:58:16Z", "author": {"login": "rtretyak"}, "path": "src-java/testing/functional-tests/src/test/groovy/org/openkilda/functionaltests/spec/flows/AutoRerouteV2Spec.groovy", "diffHunk": "@@ -475,11 +478,17 @@ class AutoRerouteV2Spec extends HealthCheckSpecification {\n         }\n \n         and: \"Flow is rerouted due to switchUp event\"\n-        //TODO(andriidovhan) specify flow history verification(it is not implemented yet) Reroute reason: switchUp event\n         Wrappers.wait(WAIT_OFFSET / 2) {\n-            assert northbound.getFlowHistory(firstFlow.flowId).findAll { it.action == \"Flow rerouting\" }.size() == 2\n-\n-            assert northbound.getFlowHistory(secondFlow.flowId).findAll { it.action == \"Flow rerouting\" }.size() == 5\n+            def firstFlowHistory = northbound.getFlowHistory(firstFlow.flowId).findAll { it.action == \"Flow rerouting\" }\n+            assert firstFlowHistory.size() == 2\n+            assert firstFlowHistory.find {\n+                it.details == \"Reason: initiated by Reroute topology: Switch '$switchPair1.src.dpId' online\"\n+            }\n+            def secondFlowHistory = northbound.getFlowHistory(secondFlow.flowId).findAll { it.action == \"Flow rerouting\" }\n+            assert secondFlowHistory.findAll { it.action == \"Flow rerouting\" }.size() == 5", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ecbd80fe93e93d3d49e61efe9197be22a46d4965"}, "originalPosition": 32}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzcyODAxMjMw", "url": "https://github.com/telstra/open-kilda/pull/3197#pullrequestreview-372801230", "createdAt": "2020-03-11T14:19:33Z", "commit": {"oid": "ecbd80fe93e93d3d49e61efe9197be22a46d4965"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3711, "cost": 1, "resetAt": "2021-11-02T12:20:56Z"}}}