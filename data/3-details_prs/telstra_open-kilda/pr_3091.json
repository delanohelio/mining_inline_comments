{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0MzU4NjM0OTM4", "number": 3091, "title": "Now verify cleanup per feature rather than per spec", "bodyText": "", "createdAt": "2020-01-02T11:53:32Z", "url": "https://github.com/telstra/open-kilda/pull/3091", "merged": true, "mergeCommit": {"oid": "64f4ee2b5e83eb40fc5bf6e15fca344f64d20da5"}, "closed": true, "closedAt": "2020-02-19T12:56:53Z", "author": {"login": "rtretyak"}, "timelineItems": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABb54wMOAFqTM0MTcwODM2OQ==", "endCursor": "Y3Vyc29yOnYyOpPPAAABcF0c_dABqjMwNTEyNjI2OTg=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzQxNzA4MzY5", "url": "https://github.com/telstra/open-kilda/pull/3091#pullrequestreview-341708369", "createdAt": "2020-01-13T09:15:56Z", "commit": {"oid": "14ddb7e9480248bba870074d8cbbddae5285354f"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzQxNzA5ODk0", "url": "https://github.com/telstra/open-kilda/pull/3091#pullrequestreview-341709894", "createdAt": "2020-01-13T09:18:57Z", "commit": {"oid": "14ddb7e9480248bba870074d8cbbddae5285354f"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0xM1QwOToxODo1N1rOFcwobA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0xM1QwOToxODo1N1rOFcwobA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NTcwMTIyOA==", "bodyText": "I guess we should check that meter is supported by a switch (.description.contains(\"OF_12\") )", "url": "https://github.com/telstra/open-kilda/pull/3091#discussion_r365701228", "createdAt": "2020-01-13T09:18:57Z", "author": {"login": "andriidovhan"}, "path": "services/src/functional-tests/src/main/groovy/org/openkilda/functionaltests/extension/fixture/CleanupVerifierExtension.groovy", "diffHunk": "@@ -32,23 +33,25 @@ class CleanupVerifierExtension extends ContextAwareGlobalExtension {\n         if (!enabled) {\n             return\n         }\n-        spec.addListener(new AbstractRunListener() {\n-            @Override\n-            void afterSpec(SpecInfo runningSpec) {\n-                log.info(\"Running cleanup verifier for '$runningSpec.name'\")\n-                assert northbound.getAllFlows().empty\n-                northbound.getAllSwitches().each {\n-                    def validation = northbound.validateSwitch(it.switchId)\n-                    validation.verifyRuleSectionsAreEmpty()\n-                    validation.verifyMeterSectionsAreEmpty()\n+        spec.features.each {\n+            it.addInterceptor(new IMethodInterceptor() {\n+                @Override\n+                void intercept(IMethodInvocation invocation) throws Throwable {\n+                    invocation.proceed()\n+                    log.info(\"Running cleanup verifier for '$invocation.feature.name'\")\n+                    assert northbound.getAllFlows().empty\n+                    northbound.getAllSwitches().each {\n+                        def validation = northbound.validateSwitch(it.switchId)\n+                        validation.verifyRuleSectionsAreEmpty()\n+                        validation.verifyMeterSectionsAreEmpty()", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "14ddb7e9480248bba870074d8cbbddae5285354f"}, "originalPosition": 33}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "14ddb7e9480248bba870074d8cbbddae5285354f", "author": {"user": {"login": "rtretyak", "name": "Roman Tretiak"}}, "url": "https://github.com/telstra/open-kilda/commit/14ddb7e9480248bba870074d8cbbddae5285354f", "committedDate": "2020-01-02T11:52:36Z", "message": "Now verify cleanup per feature rather than per spec"}, "afterCommit": {"oid": "075a0800c4868b9a95b17fbb54c2474f7e57217a", "author": {"user": {"login": "rtretyak", "name": "Roman Tretiak"}}, "url": "https://github.com/telstra/open-kilda/commit/075a0800c4868b9a95b17fbb54c2474f7e57217a", "committedDate": "2020-02-14T15:35:24Z", "message": "Now verify cleanup per feature rather than per spec"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "bbff2d775860d6b9d5ba28b378b9ef3ca836c697", "author": {"user": {"login": "rtretyak", "name": "Roman Tretiak"}}, "url": "https://github.com/telstra/open-kilda/commit/bbff2d775860d6b9d5ba28b378b9ef3ca836c697", "committedDate": "2020-02-19T11:02:16Z", "message": "Now verify cleanup per feature rather than per spec"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "075a0800c4868b9a95b17fbb54c2474f7e57217a", "author": {"user": {"login": "rtretyak", "name": "Roman Tretiak"}}, "url": "https://github.com/telstra/open-kilda/commit/075a0800c4868b9a95b17fbb54c2474f7e57217a", "committedDate": "2020-02-14T15:35:24Z", "message": "Now verify cleanup per feature rather than per spec"}, "afterCommit": {"oid": "bbff2d775860d6b9d5ba28b378b9ef3ca836c697", "author": {"user": {"login": "rtretyak", "name": "Roman Tretiak"}}, "url": "https://github.com/telstra/open-kilda/commit/bbff2d775860d6b9d5ba28b378b9ef3ca836c697", "committedDate": "2020-02-19T11:02:16Z", "message": "Now verify cleanup per feature rather than per spec"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3720, "cost": 1, "resetAt": "2021-11-02T12:20:56Z"}}}