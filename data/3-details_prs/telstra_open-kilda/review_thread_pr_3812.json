{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTExNTMzNzk4", "number": 3812, "reviewThreads": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yOFQxMzoxMjoyNVrOEyzdWg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yOFQxMzoxNzo1MlrOEyzm_Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzIxNzA3MzU0OnYy", "diffSide": "RIGHT", "path": "src-java/server42/server42-control-server-stub/src/main/java/org/openkilda/server42/control/serverstub/StatsServer.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yOFQxMzoxMjoyNVrOHppROQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yOFQxMzoxMjoyNVrOHppROQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMzQyOTgxNw==", "bodyText": "It will be nice to have a number of sent records here.", "url": "https://github.com/telstra/open-kilda/pull/3812#discussion_r513429817", "createdAt": "2020-10-28T13:12:25Z", "author": {"login": "surabujin"}, "path": "src-java/server42/server42-control-server-stub/src/main/java/org/openkilda/server42/control/serverstub/StatsServer.java", "diffHunk": "@@ -87,8 +87,10 @@ public void run() {\n                     }\n                 }\n \n-                if (!flows.isEmpty()) {\n-                    server.send(flowBucketBuilder.build().toByteArray());\n+                server.send(flowBucketBuilder.build().toByteArray());\n+                if (flows.isEmpty()) {\n+                    log.info(\"send ping\");\n+                } else {\n                     log.info(\"send stats\");", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "54301119c20b2e253a6c7152a8e547b2bd4551ba"}, "originalPosition": 10}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzIxNzA5ODIxOnYy", "diffSide": "RIGHT", "path": "src-java/server42/server42-stats/src/main/java/org/openkilda/server42/stats/zeromq/StatsCollector.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yOFQxMzoxNzo1MlrOHppgaw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yOFQxMzozMjo1MlrOHpqLOA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMzQzMzcwNw==", "bodyText": "Can/should it be done on line Socket server = context.createSocket(ZMQ.PULL);? I suspect that \"some\" resource allocation happens inside .createSocket(...) call, not only inside .connect(...) call.", "url": "https://github.com/telstra/open-kilda/pull/3812#discussion_r513433707", "createdAt": "2020-10-28T13:17:52Z", "author": {"login": "surabujin"}, "path": "src-java/server42/server42-stats/src/main/java/org/openkilda/server42/stats/zeromq/StatsCollector.java", "diffHunk": "@@ -73,9 +73,13 @@ public void run() {\n         sessionId = RandomStringUtils.randomAlphanumeric(8);\n         log.info(\"started with session id {}\", sessionId);\n         while (!isInterrupted()) {\n-            try (Socket server = context.createSocket(ZMQ.PULL)) {\n+\n+            Socket serverRef = null;\n+            try {\n+                Socket server = context.createSocket(ZMQ.PULL);\n                 server.setReceiveTimeOut(1000);\n                 server.connect(connectEndpoint);\n+                serverRef = server;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "54301119c20b2e253a6c7152a8e547b2bd4551ba"}, "originalPosition": 11}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMzQ0NDY2NA==", "bodyText": "done", "url": "https://github.com/telstra/open-kilda/pull/3812#discussion_r513444664", "createdAt": "2020-10-28T13:32:52Z", "author": {"login": "nikitamarchenko"}, "path": "src-java/server42/server42-stats/src/main/java/org/openkilda/server42/stats/zeromq/StatsCollector.java", "diffHunk": "@@ -73,9 +73,13 @@ public void run() {\n         sessionId = RandomStringUtils.randomAlphanumeric(8);\n         log.info(\"started with session id {}\", sessionId);\n         while (!isInterrupted()) {\n-            try (Socket server = context.createSocket(ZMQ.PULL)) {\n+\n+            Socket serverRef = null;\n+            try {\n+                Socket server = context.createSocket(ZMQ.PULL);\n                 server.setReceiveTimeOut(1000);\n                 server.connect(connectEndpoint);\n+                serverRef = server;", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMzQzMzcwNw=="}, "originalCommit": {"oid": "54301119c20b2e253a6c7152a8e547b2bd4551ba"}, "originalPosition": 11}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2249, "cost": 1, "resetAt": "2021-11-13T14:23:39Z"}}}