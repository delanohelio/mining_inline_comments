{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTI5MDkzNTIz", "number": 3886, "reviewThreads": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0zMFQxMzoyMzozM1rOE-prlw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMi0wMVQwMDoxNjoxNFrOFU_YYQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzM0MTMwMDcxOnYy", "diffSide": "RIGHT", "path": "src-java/reroute-topology/reroute-storm-topology/src/main/java/org/openkilda/wfm/topology/reroute/bolts/RerouteBolt.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0zMFQxMzoyMzozM1rOH764Lw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0zMFQxMzoyMzozM1rOH764Lw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMjU5MjY4Nw==", "bodyText": "I think we need here\n\t   if (message instanceof CommandMessage) {\n                if(active) {\n                    handleCommandMessage((CommandMessage) message);\n                 }\n            } else if (message instanceof InfoMessage) {\n                handleInfoMessage(message);\n            } else {\n                unhandledInput(tuple);\n            }\n\nTo do not log unhandled tuples if topology is not active", "url": "https://github.com/telstra/open-kilda/pull/3886#discussion_r532592687", "createdAt": "2020-11-30T13:23:33Z", "author": {"login": "niksv"}, "path": "src-java/reroute-topology/reroute-storm-topology/src/main/java/org/openkilda/wfm/topology/reroute/bolts/RerouteBolt.java", "diffHunk": "@@ -82,14 +87,18 @@ public void prepare(Map stormConf, TopologyContext context, OutputCollector coll\n      */\n     @Override\n     protected void handleInput(Tuple tuple) throws PipelineException {\n-        Message message = pullValue(tuple, FIELD_ID_PAYLOAD, Message.class);\n-\n-        if (message instanceof CommandMessage) {\n-            handleCommandMessage((CommandMessage) message);\n-        } else if (message instanceof InfoMessage) {\n-            handleInfoMessage(message);\n+        if (ZooKeeperSpout.BOLT_ID.equals(tuple.getSourceComponent())) {\n+            LifecycleEvent event = (LifecycleEvent) tuple.getValueByField(FIELD_ID_LIFECYCLE_EVENT);\n+            handleLifeCycleEvent(event);\n         } else {\n-            unhandledInput(tuple);\n+            Message message = pullValue(tuple, FIELD_ID_PAYLOAD, Message.class);\n+            if (active && message instanceof CommandMessage) {\n+                handleCommandMessage((CommandMessage) message);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f5db2bb92610cd77b2134d1f003c89a8ecf237dd"}, "originalPosition": 38}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzU3NTU0MjczOnYy", "diffSide": "RIGHT", "path": "src-java/reroute-topology/reroute-storm-topology/src/main/java/org/openkilda/wfm/topology/reroute/RerouteTopology.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMi0wMVQwMDoxNjoxNFrOIdN9Jg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMi0wMVQwMDoxNjoxNFrOIdN9Jg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU2NzUwODI2Mg==", "bodyText": "Does it make sense to introduce a dedicated \"build\" method instead of repeating \"getZkTopoName(), getConfig().getBlueGreenMode()\" each time?", "url": "https://github.com/telstra/open-kilda/pull/3886#discussion_r567508262", "createdAt": "2021-02-01T00:16:14Z", "author": {"login": "sergii-iakovenko"}, "path": "src-java/reroute-topology/reroute-storm-topology/src/main/java/org/openkilda/wfm/topology/reroute/RerouteTopology.java", "diffHunk": "@@ -77,22 +81,41 @@ public StormTopology createTopology() {\n \n         operationQueue(topologyBuilder);\n \n-        KafkaBolt<String, Message> kafkaFlowHsBolt = buildKafkaBolt(topologyConfig.getKafkaFlowHsTopic());\n+        KafkaBolt<String, Message> kafkaFlowHsBolt = buildKafkaBolt(topologyConfig.getKafkaFlowHsTopic(),\n+                getZkTopoName(), getConfig().getBlueGreenMode());", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b08e0f0cff60632bfddccc2a3ab7b1d7d5f0819f"}, "originalPosition": 26}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2332, "cost": 1, "resetAt": "2021-11-13T14:23:39Z"}}}