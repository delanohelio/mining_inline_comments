{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDAwODM4MDQ0", "number": 3376, "title": "Remove potential reordering of OF events", "bodyText": "Use \"correct\" kafka-key for each switch-dump event produced by\nOF-speaker on network-dump request. It guarantees correct selection of\nkafka-partition for such messages and as a result, it guarantees correct\nordering of produced events.\nClose #3369", "createdAt": "2020-04-08T13:09:11Z", "url": "https://github.com/telstra/open-kilda/pull/3376", "merged": true, "mergeCommit": {"oid": "46c9d10ab8b19be27ea289d3c539acd9a971554e"}, "closed": true, "closedAt": "2020-04-13T11:01:36Z", "author": {"login": "surabujin"}, "timelineItems": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcVnXxIgH2gAyNDAwODM4MDQ0OmJiZDZlODJkMWJhZDY4NWVmZmQwMTBlZGM4Y2Q3YzY4NjUwNzg5ZGE=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcXMuBQAFqTM5MjA4MTUwNg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "bbd6e82d1bad685effd010edc8cd7c68650789da", "author": {"user": {"login": "surabujin", "name": "Dmitriy Bogun"}}, "url": "https://github.com/telstra/open-kilda/commit/bbd6e82d1bad685effd010edc8cd7c68650789da", "committedDate": "2020-04-08T12:50:45Z", "message": "Remove potential reordering of OF events\n\nUse \"correct\" kafka-key for each switch-dump event produced by\nOF-speaker on network-dump request. It guarantees correct selection of\nkafka-partition for such messages and as a result, it guarantees correct\nordering of produced events."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzkwMTY2NTE1", "url": "https://github.com/telstra/open-kilda/pull/3376#pullrequestreview-390166515", "createdAt": "2020-04-08T17:05:47Z", "commit": {"oid": "bbd6e82d1bad685effd010edc8cd7c68650789da"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wOFQxNzowNTo0N1rOGC4rkw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wOFQxNzowNTo0N1rOGC4rkw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNTY3ODk5NQ==", "bodyText": "nit: Why is \"emit discovery event\" used? This is not related to it.", "url": "https://github.com/telstra/open-kilda/pull/3376#discussion_r405678995", "createdAt": "2020-04-08T17:05:47Z", "author": {"login": "sergii-iakovenko"}, "path": "src-java/floodlight-service/floodlight-modules/src/main/java/org/openkilda/floodlight/switchmanager/SwitchTrackingService.java", "diffHunk": "@@ -167,20 +166,11 @@ public void setup(FloodlightModuleContext context) {\n         }\n     }\n \n-    private void dumpAllSwitchesAction(String correlationId) {\n+    private void dumpAllSwitchesAction() {\n         Collection<IOFSwitch> iofSwitches = switchManager.getAllSwitchMap(true).values();\n-        int switchCounter = 0;\n         for (IOFSwitch sw : iofSwitches) {\n-            try {\n-                NetworkDumpSwitchData swData = new NetworkDumpSwitchData(buildSwitch(sw));\n-                producerService.sendMessageAndTrack(discoveryTopic,\n-                                                correlationId,\n-                                                new ChunkedInfoMessage(swData, System.currentTimeMillis(),\n-                                                        correlationId, switchCounter, iofSwitches.size(), region));\n-            } catch (Exception e) {\n-                logger.error(\"Failed to send network dump for {}\", sw.getId());\n-            }\n-            switchCounter++;\n+            NetworkDumpSwitchData payload = new NetworkDumpSwitchData(buildSwitch(sw));\n+            emitDiscoveryEvent(sw.getId(), payload);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "bbd6e82d1bad685effd010edc8cd7c68650789da"}, "originalPosition": 41}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzkwMTY2ODcz", "url": "https://github.com/telstra/open-kilda/pull/3376#pullrequestreview-390166873", "createdAt": "2020-04-08T17:06:16Z", "commit": {"oid": "bbd6e82d1bad685effd010edc8cd7c68650789da"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzkyMDgxNTA2", "url": "https://github.com/telstra/open-kilda/pull/3376#pullrequestreview-392081506", "createdAt": "2020-04-13T10:55:28Z", "commit": {"oid": "bbd6e82d1bad685effd010edc8cd7c68650789da"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3617, "cost": 1, "resetAt": "2021-11-02T12:20:56Z"}}}