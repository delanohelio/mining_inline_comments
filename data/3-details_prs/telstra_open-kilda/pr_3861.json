{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTIzMjg5MjUx", "number": 3861, "title": "Zero downtime nb worker", "bodyText": "", "createdAt": "2020-11-18T16:00:57Z", "url": "https://github.com/telstra/open-kilda/pull/3861", "merged": true, "mergeCommit": {"oid": "9f3262f49612f008690a68903fb4c3a25e5d7a6c"}, "closed": true, "closedAt": "2021-02-04T15:07:15Z", "author": {"login": "timofei-durakov"}, "timelineItems": {"totalCount": 30, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABddw7JOgBqjQwMTE2NDY5NjI=", "endCursor": "Y3Vyc29yOnYyOpPPAAABd22UrGAFqTU4MzQ4OTgwMA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "fe7093e4cc72d73a117f5eeb19131ca802f9b796", "author": {"user": {"login": "timofei-durakov", "name": "Timofey Durakov"}}, "url": "https://github.com/telstra/open-kilda/commit/fe7093e4cc72d73a117f5eeb19131ca802f9b796", "committedDate": "2020-11-18T15:59:51Z", "message": "Nbworker blue-green"}, "afterCommit": {"oid": "d4549582e2286f8b53c536dbf6f8181e7e0f20ed", "author": {"user": {"login": "timofei-durakov", "name": "Timofey Durakov"}}, "url": "https://github.com/telstra/open-kilda/commit/d4549582e2286f8b53c536dbf6f8181e7e0f20ed", "committedDate": "2020-11-18T16:25:37Z", "message": "Nbworker blue-green"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "d4549582e2286f8b53c536dbf6f8181e7e0f20ed", "author": {"user": {"login": "timofei-durakov", "name": "Timofey Durakov"}}, "url": "https://github.com/telstra/open-kilda/commit/d4549582e2286f8b53c536dbf6f8181e7e0f20ed", "committedDate": "2020-11-18T16:25:37Z", "message": "Nbworker blue-green"}, "afterCommit": {"oid": "41c69e71f651e73c63753ec16ad61c547a3bf6f3", "author": {"user": {"login": "timofei-durakov", "name": "Timofey Durakov"}}, "url": "https://github.com/telstra/open-kilda/commit/41c69e71f651e73c63753ec16ad61c547a3bf6f3", "committedDate": "2020-11-18T21:21:58Z", "message": "Nbworker blue-green"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "41c69e71f651e73c63753ec16ad61c547a3bf6f3", "author": {"user": {"login": "timofei-durakov", "name": "Timofey Durakov"}}, "url": "https://github.com/telstra/open-kilda/commit/41c69e71f651e73c63753ec16ad61c547a3bf6f3", "committedDate": "2020-11-18T21:21:58Z", "message": "Nbworker blue-green"}, "afterCommit": {"oid": "c3f0786f5c01861b8959809be7566f094767eccd", "author": {"user": {"login": "timofei-durakov", "name": "Timofey Durakov"}}, "url": "https://github.com/telstra/open-kilda/commit/c3f0786f5c01861b8959809be7566f094767eccd", "committedDate": "2020-11-25T08:04:26Z", "message": "Nbworker blue-green"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "c3f0786f5c01861b8959809be7566f094767eccd", "author": {"user": {"login": "timofei-durakov", "name": "Timofey Durakov"}}, "url": "https://github.com/telstra/open-kilda/commit/c3f0786f5c01861b8959809be7566f094767eccd", "committedDate": "2020-11-25T08:04:26Z", "message": "Nbworker blue-green"}, "afterCommit": {"oid": "4cafd3cc77f2621ffbffa2ce1d1f13a08d0f16aa", "author": {"user": {"login": "timofei-durakov", "name": "Timofey Durakov"}}, "url": "https://github.com/telstra/open-kilda/commit/4cafd3cc77f2621ffbffa2ce1d1f13a08d0f16aa", "committedDate": "2020-11-25T12:19:04Z", "message": "Nbworker blue-green"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "4cafd3cc77f2621ffbffa2ce1d1f13a08d0f16aa", "author": {"user": {"login": "timofei-durakov", "name": "Timofey Durakov"}}, "url": "https://github.com/telstra/open-kilda/commit/4cafd3cc77f2621ffbffa2ce1d1f13a08d0f16aa", "committedDate": "2020-11-25T12:19:04Z", "message": "Nbworker blue-green"}, "afterCommit": {"oid": "3123e079de3c61540271e2a4507e13d24f4fa610", "author": {"user": {"login": "timofei-durakov", "name": "Timofey Durakov"}}, "url": "https://github.com/telstra/open-kilda/commit/3123e079de3c61540271e2a4507e13d24f4fa610", "committedDate": "2020-11-26T06:48:22Z", "message": "Nbworker blue-green"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "3123e079de3c61540271e2a4507e13d24f4fa610", "author": {"user": {"login": "timofei-durakov", "name": "Timofey Durakov"}}, "url": "https://github.com/telstra/open-kilda/commit/3123e079de3c61540271e2a4507e13d24f4fa610", "committedDate": "2020-11-26T06:48:22Z", "message": "Nbworker blue-green"}, "afterCommit": {"oid": "96e480e966b949487e20ce874a6364b656952453", "author": {"user": {"login": "timofei-durakov", "name": "Timofey Durakov"}}, "url": "https://github.com/telstra/open-kilda/commit/96e480e966b949487e20ce874a6364b656952453", "committedDate": "2020-11-26T06:53:17Z", "message": "Nbworker blue-green"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "96e480e966b949487e20ce874a6364b656952453", "author": {"user": {"login": "timofei-durakov", "name": "Timofey Durakov"}}, "url": "https://github.com/telstra/open-kilda/commit/96e480e966b949487e20ce874a6364b656952453", "committedDate": "2020-11-26T06:53:17Z", "message": "Nbworker blue-green"}, "afterCommit": {"oid": "7dbf621c11d157c65b52ae862cd52b939c7c2984", "author": {"user": {"login": "timofei-durakov", "name": "Timofey Durakov"}}, "url": "https://github.com/telstra/open-kilda/commit/7dbf621c11d157c65b52ae862cd52b939c7c2984", "committedDate": "2020-11-27T12:11:55Z", "message": "Nbworker blue-green"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "7dbf621c11d157c65b52ae862cd52b939c7c2984", "author": {"user": {"login": "timofei-durakov", "name": "Timofey Durakov"}}, "url": "https://github.com/telstra/open-kilda/commit/7dbf621c11d157c65b52ae862cd52b939c7c2984", "committedDate": "2020-11-27T12:11:55Z", "message": "Nbworker blue-green"}, "afterCommit": {"oid": "7efc9a1b46242032ae403f98ce1065291e61a612", "author": {"user": {"login": "timofei-durakov", "name": "Timofey Durakov"}}, "url": "https://github.com/telstra/open-kilda/commit/7efc9a1b46242032ae403f98ce1065291e61a612", "committedDate": "2020-11-29T09:14:20Z", "message": "Nbworker blue-green"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "7efc9a1b46242032ae403f98ce1065291e61a612", "author": {"user": {"login": "timofei-durakov", "name": "Timofey Durakov"}}, "url": "https://github.com/telstra/open-kilda/commit/7efc9a1b46242032ae403f98ce1065291e61a612", "committedDate": "2020-11-29T09:14:20Z", "message": "Nbworker blue-green"}, "afterCommit": {"oid": "96b43f8684ac2b0d2fdb43e2a5537620b74f033a", "author": {"user": {"login": "timofei-durakov", "name": "Timofey Durakov"}}, "url": "https://github.com/telstra/open-kilda/commit/96b43f8684ac2b0d2fdb43e2a5537620b74f033a", "committedDate": "2020-11-29T09:21:34Z", "message": "Nbworker blue-green"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "96b43f8684ac2b0d2fdb43e2a5537620b74f033a", "author": {"user": {"login": "timofei-durakov", "name": "Timofey Durakov"}}, "url": "https://github.com/telstra/open-kilda/commit/96b43f8684ac2b0d2fdb43e2a5537620b74f033a", "committedDate": "2020-11-29T09:21:34Z", "message": "Nbworker blue-green"}, "afterCommit": {"oid": "bac4999570e27ea06d823ccda73268aedc1a4b21", "author": {"user": {"login": "timofei-durakov", "name": "Timofey Durakov"}}, "url": "https://github.com/telstra/open-kilda/commit/bac4999570e27ea06d823ccda73268aedc1a4b21", "committedDate": "2020-12-03T06:30:29Z", "message": "Nbworker blue-green"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "bac4999570e27ea06d823ccda73268aedc1a4b21", "author": {"user": {"login": "timofei-durakov", "name": "Timofey Durakov"}}, "url": "https://github.com/telstra/open-kilda/commit/bac4999570e27ea06d823ccda73268aedc1a4b21", "committedDate": "2020-12-03T06:30:29Z", "message": "Nbworker blue-green"}, "afterCommit": {"oid": "7fe68e88ad0ab634607e97bd18fb9d54806075c0", "author": {"user": {"login": "timofei-durakov", "name": "Timofey Durakov"}}, "url": "https://github.com/telstra/open-kilda/commit/7fe68e88ad0ab634607e97bd18fb9d54806075c0", "committedDate": "2020-12-07T08:06:37Z", "message": "Nbworker blue-green"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "7fe68e88ad0ab634607e97bd18fb9d54806075c0", "author": {"user": {"login": "timofei-durakov", "name": "Timofey Durakov"}}, "url": "https://github.com/telstra/open-kilda/commit/7fe68e88ad0ab634607e97bd18fb9d54806075c0", "committedDate": "2020-12-07T08:06:37Z", "message": "Nbworker blue-green"}, "afterCommit": {"oid": "6d3d1111194a80f1e873515c2e4236690db4111f", "author": {"user": {"login": "timofei-durakov", "name": "Timofey Durakov"}}, "url": "https://github.com/telstra/open-kilda/commit/6d3d1111194a80f1e873515c2e4236690db4111f", "committedDate": "2020-12-07T09:23:51Z", "message": "Nbworker blue-green"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "6d3d1111194a80f1e873515c2e4236690db4111f", "author": {"user": {"login": "timofei-durakov", "name": "Timofey Durakov"}}, "url": "https://github.com/telstra/open-kilda/commit/6d3d1111194a80f1e873515c2e4236690db4111f", "committedDate": "2020-12-07T09:23:51Z", "message": "Nbworker blue-green"}, "afterCommit": {"oid": "043539ae5d93d82e27c367362972390a23b7818f", "author": {"user": {"login": "timofei-durakov", "name": "Timofey Durakov"}}, "url": "https://github.com/telstra/open-kilda/commit/043539ae5d93d82e27c367362972390a23b7818f", "committedDate": "2020-12-09T11:49:24Z", "message": "Nbworker blue-green"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "043539ae5d93d82e27c367362972390a23b7818f", "author": {"user": {"login": "timofei-durakov", "name": "Timofey Durakov"}}, "url": "https://github.com/telstra/open-kilda/commit/043539ae5d93d82e27c367362972390a23b7818f", "committedDate": "2020-12-09T11:49:24Z", "message": "Nbworker blue-green"}, "afterCommit": {"oid": "39fd417e651753b084bfb1915a148c3906cdaad2", "author": {"user": {"login": "timofei-durakov", "name": "Timofey Durakov"}}, "url": "https://github.com/telstra/open-kilda/commit/39fd417e651753b084bfb1915a148c3906cdaad2", "committedDate": "2020-12-11T14:13:59Z", "message": "Nbworker blue-green"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "39fd417e651753b084bfb1915a148c3906cdaad2", "author": {"user": {"login": "timofei-durakov", "name": "Timofey Durakov"}}, "url": "https://github.com/telstra/open-kilda/commit/39fd417e651753b084bfb1915a148c3906cdaad2", "committedDate": "2020-12-11T14:13:59Z", "message": "Nbworker blue-green"}, "afterCommit": {"oid": "77f103eccf54c617707055e0267e53fb62c0b0a1", "author": {"user": {"login": "timofei-durakov", "name": "Timofey Durakov"}}, "url": "https://github.com/telstra/open-kilda/commit/77f103eccf54c617707055e0267e53fb62c0b0a1", "committedDate": "2020-12-23T09:19:30Z", "message": "Nbworker blue-green"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "77f103eccf54c617707055e0267e53fb62c0b0a1", "author": {"user": {"login": "timofei-durakov", "name": "Timofey Durakov"}}, "url": "https://github.com/telstra/open-kilda/commit/77f103eccf54c617707055e0267e53fb62c0b0a1", "committedDate": "2020-12-23T09:19:30Z", "message": "Nbworker blue-green"}, "afterCommit": {"oid": "597eba4e4e20f59a544542b7dbb846327aa2d3fa", "author": {"user": {"login": "timofei-durakov", "name": "Timofey Durakov"}}, "url": "https://github.com/telstra/open-kilda/commit/597eba4e4e20f59a544542b7dbb846327aa2d3fa", "committedDate": "2020-12-28T11:46:30Z", "message": "Nbworker blue-green"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "597eba4e4e20f59a544542b7dbb846327aa2d3fa", "author": {"user": {"login": "timofei-durakov", "name": "Timofey Durakov"}}, "url": "https://github.com/telstra/open-kilda/commit/597eba4e4e20f59a544542b7dbb846327aa2d3fa", "committedDate": "2020-12-28T11:46:30Z", "message": "Nbworker blue-green"}, "afterCommit": {"oid": "1873c5a3be5cac3896a12f87ef18049f0a04b111", "author": {"user": {"login": "timofei-durakov", "name": "Timofey Durakov"}}, "url": "https://github.com/telstra/open-kilda/commit/1873c5a3be5cac3896a12f87ef18049f0a04b111", "committedDate": "2020-12-30T11:20:37Z", "message": "Nbworker blue-green"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "1873c5a3be5cac3896a12f87ef18049f0a04b111", "author": {"user": {"login": "timofei-durakov", "name": "Timofey Durakov"}}, "url": "https://github.com/telstra/open-kilda/commit/1873c5a3be5cac3896a12f87ef18049f0a04b111", "committedDate": "2020-12-30T11:20:37Z", "message": "Nbworker blue-green"}, "afterCommit": {"oid": "1e4c99ccb9e8c4500dfd97801d56744896fcd785", "author": {"user": {"login": "timofei-durakov", "name": "Timofey Durakov"}}, "url": "https://github.com/telstra/open-kilda/commit/1e4c99ccb9e8c4500dfd97801d56744896fcd785", "committedDate": "2021-01-14T10:50:17Z", "message": "Nbworker blue-green"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "1e4c99ccb9e8c4500dfd97801d56744896fcd785", "author": {"user": {"login": "timofei-durakov", "name": "Timofey Durakov"}}, "url": "https://github.com/telstra/open-kilda/commit/1e4c99ccb9e8c4500dfd97801d56744896fcd785", "committedDate": "2021-01-14T10:50:17Z", "message": "Nbworker blue-green"}, "afterCommit": {"oid": "3ef5d2c87df58bea7211b66c5f4ad19838865086", "author": {"user": {"login": "timofei-durakov", "name": "Timofey Durakov"}}, "url": "https://github.com/telstra/open-kilda/commit/3ef5d2c87df58bea7211b66c5f4ad19838865086", "committedDate": "2021-01-14T19:25:38Z", "message": "Nbworker blue-green"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTY5MTcyMDg1", "url": "https://github.com/telstra/open-kilda/pull/3861#pullrequestreview-569172085", "createdAt": "2021-01-15T11:16:56Z", "commit": {"oid": "3ef5d2c87df58bea7211b66c5f4ad19838865086"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "3ef5d2c87df58bea7211b66c5f4ad19838865086", "author": {"user": {"login": "timofei-durakov", "name": "Timofey Durakov"}}, "url": "https://github.com/telstra/open-kilda/commit/3ef5d2c87df58bea7211b66c5f4ad19838865086", "committedDate": "2021-01-14T19:25:38Z", "message": "Nbworker blue-green"}, "afterCommit": {"oid": "229f33dce9b6685834eba21b0c7902d69cb69697", "author": {"user": {"login": "timofei-durakov", "name": "Timofey Durakov"}}, "url": "https://github.com/telstra/open-kilda/commit/229f33dce9b6685834eba21b0c7902d69cb69697", "committedDate": "2021-01-20T13:32:35Z", "message": "Nbworker blue-green"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "229f33dce9b6685834eba21b0c7902d69cb69697", "author": {"user": {"login": "timofei-durakov", "name": "Timofey Durakov"}}, "url": "https://github.com/telstra/open-kilda/commit/229f33dce9b6685834eba21b0c7902d69cb69697", "committedDate": "2021-01-20T13:32:35Z", "message": "Nbworker blue-green"}, "afterCommit": {"oid": "24ff84d73e58631e5c34c7d111e3951b67fea78b", "author": {"user": {"login": "timofei-durakov", "name": "Timofey Durakov"}}, "url": "https://github.com/telstra/open-kilda/commit/24ff84d73e58631e5c34c7d111e3951b67fea78b", "committedDate": "2021-01-25T08:14:36Z", "message": "Nbworker blue-green"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "24ff84d73e58631e5c34c7d111e3951b67fea78b", "author": {"user": {"login": "timofei-durakov", "name": "Timofey Durakov"}}, "url": "https://github.com/telstra/open-kilda/commit/24ff84d73e58631e5c34c7d111e3951b67fea78b", "committedDate": "2021-01-25T08:14:36Z", "message": "Nbworker blue-green"}, "afterCommit": {"oid": "2a62ebcd27632bd1839a03be5569ba29125e931d", "author": {"user": {"login": "timofei-durakov", "name": "Timofey Durakov"}}, "url": "https://github.com/telstra/open-kilda/commit/2a62ebcd27632bd1839a03be5569ba29125e931d", "committedDate": "2021-01-27T08:00:10Z", "message": "Nbworker blue-green"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "2a62ebcd27632bd1839a03be5569ba29125e931d", "author": {"user": {"login": "timofei-durakov", "name": "Timofey Durakov"}}, "url": "https://github.com/telstra/open-kilda/commit/2a62ebcd27632bd1839a03be5569ba29125e931d", "committedDate": "2021-01-27T08:00:10Z", "message": "Nbworker blue-green"}, "afterCommit": {"oid": "64fa00fdbc091a6912569243362108017e05ea66", "author": {"user": {"login": "timofei-durakov", "name": "Timofey Durakov"}}, "url": "https://github.com/telstra/open-kilda/commit/64fa00fdbc091a6912569243362108017e05ea66", "committedDate": "2021-01-29T05:58:55Z", "message": "Nbworker blue-green"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTc5MTcwNTcy", "url": "https://github.com/telstra/open-kilda/pull/3861#pullrequestreview-579170572", "createdAt": "2021-01-29T11:29:24Z", "commit": {"oid": "64fa00fdbc091a6912569243362108017e05ea66"}, "state": "APPROVED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMS0yOVQxMToyOToyNFrOIcgILQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMS0yOVQxMToyOTozMFrOIcgIYQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU2Njc1NzQyMQ==", "bodyText": "should we set deferedShutdownEvent = null here?", "url": "https://github.com/telstra/open-kilda/pull/3861#discussion_r566757421", "createdAt": "2021-01-29T11:29:24Z", "author": {"login": "niksv"}, "path": "src-java/nbworker-topology/nbworker-storm-topology/src/main/java/org/openkilda/wfm/topology/nbworker/bolts/FlowValidationHubBolt.java", "diffHunk": "@@ -62,7 +68,24 @@ public FlowValidationHubBolt(Config config, PersistenceManager persistenceManage\n     @Override\n     public void prepare(Map stormConf, TopologyContext context, OutputCollector collector) {\n         super.prepare(stormConf, context, collector);\n-        service = new FlowValidationHubService(persistenceManager, flowResourcesConfig);\n+        service = new FlowValidationHubService(persistenceManager, flowResourcesConfig,\n+                new FlowValidationHubCarrierImpl(null));\n+    }\n+\n+    @Override\n+    protected void handleLifeCycleEvent(LifecycleEvent event) {\n+        if (event.getSignal().equals(Signal.SHUTDOWN)) {\n+            if (service.deactivate()) {\n+                emit(ZkStreams.ZK.toString(), getCurrentTuple(), new Values(event, getCommandContext()));\n+            } else {\n+                deferedShutdownEvent = event;\n+            }\n+        } else if (event.getSignal().equals(Signal.START)) {\n+            service.activate();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "64fa00fdbc091a6912569243362108017e05ea66"}, "originalPosition": 45}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU2Njc1NzQ3Mw==", "bodyText": "can be replaced with\nactive = false;\nreturn fsms.isEmpty();", "url": "https://github.com/telstra/open-kilda/pull/3861#discussion_r566757473", "createdAt": "2021-01-29T11:29:30Z", "author": {"login": "niksv"}, "path": "src-java/nbworker-topology/nbworker-storm-topology/src/main/java/org/openkilda/wfm/topology/nbworker/services/FlowMeterModifyHubService.java", "diffHunk": "@@ -110,6 +112,26 @@ private void process(FlowMeterModifyFsm fsm) {\n \n         if (exitStates.contains(fsm.getCurrentState())) {\n             fsms.remove(fsm.getKey());\n+            if (fsms.isEmpty() && !active) {\n+                defaultCarrier.sendInactive();\n+            }\n         }\n     }\n+\n+\n+    /**\n+     * Deactivates service.\n+     */\n+    public boolean deactivate() {\n+        active = false;\n+        if (fsms.isEmpty()) {\n+            return true;\n+        }\n+        return false;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "64fa00fdbc091a6912569243362108017e05ea66"}, "originalPosition": 37}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTc5OTQ4MzM3", "url": "https://github.com/telstra/open-kilda/pull/3861#pullrequestreview-579948337", "createdAt": "2021-01-31T23:32:24Z", "commit": {"oid": "64fa00fdbc091a6912569243362108017e05ea66"}, "state": "COMMENTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMS0zMVQyMzozMjoyNFrOIdNnPQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMS0zMVQyMzo0MzoyMFrOIdNsWw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU2NzUwMjY1Mw==", "bodyText": "Does it make sense to introduce a dedicated \"build\" method instead of repeating \"getZkTopoName(), getConfig().getBlueGreenMode()\" each time?", "url": "https://github.com/telstra/open-kilda/pull/3861#discussion_r567502653", "createdAt": "2021-01-31T23:32:24Z", "author": {"login": "sergii-iakovenko"}, "path": "src-java/nbworker-topology/nbworker-storm-topology/src/main/java/org/openkilda/wfm/topology/nbworker/NbWorkerTopology.java", "diffHunk": "@@ -239,45 +260,58 @@ public StormTopology createTopology() {\n                 .shuffleGrouping(SWITCHES_BOLT_NAME, StreamType.DISCO.toString())\n                 .shuffleGrouping(FEATURE_TOGGLES_BOLT_NAME, FeatureTogglesBolt.STREAM_NOTIFICATION_ID);\n \n-        KafkaBolt kafkaNbBolt = buildKafkaBolt(topologyConfig.getKafkaNorthboundTopic());\n+        KafkaBolt kafkaNbBolt = buildKafkaBolt(topologyConfig.getKafkaNorthboundTopic(),\n+                getZkTopoName(), getConfig().getBlueGreenMode());", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "64fa00fdbc091a6912569243362108017e05ea66"}, "originalPosition": 108}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU2NzUwMzk2Mw==", "bodyText": "Could we introduce a default constructor instead of passing null? Currently, it's ambiguous and not clear why null.", "url": "https://github.com/telstra/open-kilda/pull/3861#discussion_r567503963", "createdAt": "2021-01-31T23:43:20Z", "author": {"login": "sergii-iakovenko"}, "path": "src-java/nbworker-topology/nbworker-storm-topology/src/main/java/org/openkilda/wfm/topology/nbworker/bolts/FlowValidationHubBolt.java", "diffHunk": "@@ -62,7 +68,24 @@ public FlowValidationHubBolt(Config config, PersistenceManager persistenceManage\n     @Override\n     public void prepare(Map stormConf, TopologyContext context, OutputCollector collector) {\n         super.prepare(stormConf, context, collector);\n-        service = new FlowValidationHubService(persistenceManager, flowResourcesConfig);\n+        service = new FlowValidationHubService(persistenceManager, flowResourcesConfig,\n+                new FlowValidationHubCarrierImpl(null));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "64fa00fdbc091a6912569243362108017e05ea66"}, "originalPosition": 33}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "64fa00fdbc091a6912569243362108017e05ea66", "author": {"user": {"login": "timofei-durakov", "name": "Timofey Durakov"}}, "url": "https://github.com/telstra/open-kilda/commit/64fa00fdbc091a6912569243362108017e05ea66", "committedDate": "2021-01-29T05:58:55Z", "message": "Nbworker blue-green"}, "afterCommit": {"oid": "6c93a4a0c045c759092f38848beea52bebcbaca6", "author": {"user": {"login": "timofei-durakov", "name": "Timofey Durakov"}}, "url": "https://github.com/telstra/open-kilda/commit/6c93a4a0c045c759092f38848beea52bebcbaca6", "committedDate": "2021-02-03T12:50:55Z", "message": "Nbworker blue-green"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "1e41c75bd14ba239feab66d9e3f3c5a5841414c1", "author": {"user": {"login": "timofei-durakov", "name": "Timofey Durakov"}}, "url": "https://github.com/telstra/open-kilda/commit/1e41c75bd14ba239feab66d9e3f3c5a5841414c1", "committedDate": "2021-02-03T12:57:49Z", "message": "Nbworker blue-green"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "6c93a4a0c045c759092f38848beea52bebcbaca6", "author": {"user": {"login": "timofei-durakov", "name": "Timofey Durakov"}}, "url": "https://github.com/telstra/open-kilda/commit/6c93a4a0c045c759092f38848beea52bebcbaca6", "committedDate": "2021-02-03T12:50:55Z", "message": "Nbworker blue-green"}, "afterCommit": {"oid": "1e41c75bd14ba239feab66d9e3f3c5a5841414c1", "author": {"user": {"login": "timofei-durakov", "name": "Timofey Durakov"}}, "url": "https://github.com/telstra/open-kilda/commit/1e41c75bd14ba239feab66d9e3f3c5a5841414c1", "committedDate": "2021-02-03T12:57:49Z", "message": "Nbworker blue-green"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTgzNDg5ODAw", "url": "https://github.com/telstra/open-kilda/pull/3861#pullrequestreview-583489800", "createdAt": "2021-02-04T15:06:36Z", "commit": {"oid": "1e41c75bd14ba239feab66d9e3f3c5a5841414c1"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3768, "cost": 1, "resetAt": "2021-11-02T12:20:56Z"}}}