{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDE0NzI2NzE4", "number": 3452, "title": "Add test for errors during flow delete", "bodyText": "", "createdAt": "2020-05-07T14:34:13Z", "url": "https://github.com/telstra/open-kilda/pull/3452", "merged": true, "mergeCommit": {"oid": "03c64283640666adc985043162dd9d6c9b6cefbd"}, "closed": true, "closedAt": "2020-05-18T13:07:15Z", "author": {"login": "rtretyak"}, "timelineItems": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcfLGPBAFqTQwODAwNTkzMg==", "endCursor": "Y3Vyc29yOnYyOpPPAAABcggb_wABqjMzMjY0ODI2MjQ=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDA4MDA1OTMy", "url": "https://github.com/telstra/open-kilda/pull/3452#pullrequestreview-408005932", "createdAt": "2020-05-08T05:33:30Z", "commit": {"oid": "9232d685c0ad60de1e89f21d694c9c7c780c3c09"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wOFQwNTozMzozMFrOGSZovg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wOFQwNTozMzozMFrOGSZovg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMTk0NzU4Mg==", "bodyText": "!northboundV2.getFlowStatus(flowId)\nit allows us to not fail if some flow already exist", "url": "https://github.com/telstra/open-kilda/pull/3452#discussion_r421947582", "createdAt": "2020-05-08T05:33:30Z", "author": {"login": "andriidovhan"}, "path": "src-java/testing/functional-tests/src/test/groovy/org/openkilda/functionaltests/spec/resilience/RollbacksSpec.groovy", "diffHunk": "@@ -255,4 +257,32 @@ and at least 1 path must remain safe\"\n                 ]\n         ]\n     }\n+\n+    @Tidy\n+    def \"Flow is successfully deleted from the system even if some rule delete commands fail (no rollback for delete)\"() {\n+        given: \"A flow\"\n+        def swPair = topologyHelper.switchPairs.first()\n+        def flow = flowHelperV2.randomFlow(swPair)\n+        flowHelperV2.addFlow(flow)\n+\n+        when: \"Send delete request for the flow\"\n+        lockKeeper.shapeSwitchesTraffic([swPair.src], new TrafficControlData(1000))\n+        northboundV2.deleteFlow(flow.flowId)\n+\n+        and: \"One of the related switches does not respond\"\n+        def blockData = switchHelper.knockoutSwitch(swPair.src, mgmtFlManager)\n+\n+        then: \"Flow history shows failed delete rule retry attempts but flow deletion is successful at the end\"\n+        wait(WAIT_OFFSET) {\n+            def history = northbound.getFlowHistory(flow.flowId).last().histories\n+            //egress and ingress rule on a broken switch, 3 retries each = total 6\n+            assert history.count { it.details ==~ /Failed to remove the rule.*Retrying \\(attempt \\d+\\)/ } == 6\n+            assert history.last().action == DELETE_SUCCESS\n+        }\n+        northboundV2.getAllFlows().empty", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "9232d685c0ad60de1e89f21d694c9c7c780c3c09"}, "originalPosition": 135}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDA4MDA2MTc2", "url": "https://github.com/telstra/open-kilda/pull/3452#pullrequestreview-408006176", "createdAt": "2020-05-08T05:34:17Z", "commit": {"oid": "9232d685c0ad60de1e89f21d694c9c7c780c3c09"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "9232d685c0ad60de1e89f21d694c9c7c780c3c09", "author": {"user": {"login": "rtretyak", "name": "Roman Tretiak"}}, "url": "https://github.com/telstra/open-kilda/commit/9232d685c0ad60de1e89f21d694c9c7c780c3c09", "committedDate": "2020-05-07T14:29:10Z", "message": "Add test for errors during flow delete"}, "afterCommit": {"oid": "989b055def85eba60de07c0156fa9672d4e05b06", "author": {"user": {"login": "rtretyak", "name": "Roman Tretiak"}}, "url": "https://github.com/telstra/open-kilda/commit/989b055def85eba60de07c0156fa9672d4e05b06", "committedDate": "2020-05-08T09:51:57Z", "message": "Add test for errors during flow delete"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "05a6da8638e341a0ccacd9e8082cf7457a15439c", "author": {"user": {"login": "rtretyak", "name": "Roman Tretiak"}}, "url": "https://github.com/telstra/open-kilda/commit/05a6da8638e341a0ccacd9e8082cf7457a15439c", "committedDate": "2020-05-12T08:58:50Z", "message": "Add test for errors during flow delete"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "989b055def85eba60de07c0156fa9672d4e05b06", "author": {"user": {"login": "rtretyak", "name": "Roman Tretiak"}}, "url": "https://github.com/telstra/open-kilda/commit/989b055def85eba60de07c0156fa9672d4e05b06", "committedDate": "2020-05-08T09:51:57Z", "message": "Add test for errors during flow delete"}, "afterCommit": {"oid": "05a6da8638e341a0ccacd9e8082cf7457a15439c", "author": {"user": {"login": "rtretyak", "name": "Roman Tretiak"}}, "url": "https://github.com/telstra/open-kilda/commit/05a6da8638e341a0ccacd9e8082cf7457a15439c", "committedDate": "2020-05-12T08:58:50Z", "message": "Add test for errors during flow delete"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3642, "cost": 1, "resetAt": "2021-11-02T12:20:56Z"}}}