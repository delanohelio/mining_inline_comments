{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTI5MDkzNTIz", "number": 3886, "title": "Zero downtime reroute", "bodyText": "", "createdAt": "2020-11-29T11:15:29Z", "url": "https://github.com/telstra/open-kilda/pull/3886", "merged": true, "mergeCommit": {"oid": "a27304c6561f3be06afa84d30bd3eeede6c70e5f"}, "closed": true, "closedAt": "2021-02-04T15:14:48Z", "author": {"login": "timofei-durakov"}, "timelineItems": {"totalCount": 20, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdhO7nBgBqjQwNDg5MjgxNTc=", "endCursor": "Y3Vyc29yOnYyOpPPAAABd22b5_AFqTU4MzQ5ODgyNA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "d3bdf4e24cde65ebc598d7323202cca9e300ff05", "author": {"user": {"login": "timofei-durakov", "name": "Timofey Durakov"}}, "url": "https://github.com/telstra/open-kilda/commit/d3bdf4e24cde65ebc598d7323202cca9e300ff05", "committedDate": "2020-11-29T11:13:49Z", "message": "Zero-Downtime Reroute"}, "afterCommit": {"oid": "eb04d412f1ea78bf824f1a3ea264eeeb6bbba0f4", "author": {"user": {"login": "timofei-durakov", "name": "Timofey Durakov"}}, "url": "https://github.com/telstra/open-kilda/commit/eb04d412f1ea78bf824f1a3ea264eeeb6bbba0f4", "committedDate": "2020-11-29T11:20:17Z", "message": "Zero-Downtime Reroute"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "eb04d412f1ea78bf824f1a3ea264eeeb6bbba0f4", "author": {"user": {"login": "timofei-durakov", "name": "Timofey Durakov"}}, "url": "https://github.com/telstra/open-kilda/commit/eb04d412f1ea78bf824f1a3ea264eeeb6bbba0f4", "committedDate": "2020-11-29T11:20:17Z", "message": "Zero-Downtime Reroute"}, "afterCommit": {"oid": "f5db2bb92610cd77b2134d1f003c89a8ecf237dd", "author": {"user": {"login": "timofei-durakov", "name": "Timofey Durakov"}}, "url": "https://github.com/telstra/open-kilda/commit/f5db2bb92610cd77b2134d1f003c89a8ecf237dd", "committedDate": "2020-11-29T12:48:44Z", "message": "Zero-Downtime Reroute"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTQwOTAyNTg2", "url": "https://github.com/telstra/open-kilda/pull/3886#pullrequestreview-540902586", "createdAt": "2020-11-30T13:23:33Z", "commit": {"oid": "f5db2bb92610cd77b2134d1f003c89a8ecf237dd"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0zMFQxMzoyMzozM1rOH764Lw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0zMFQxMzoyMzozM1rOH764Lw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMjU5MjY4Nw==", "bodyText": "I think we need here\n\t   if (message instanceof CommandMessage) {\n                if(active) {\n                    handleCommandMessage((CommandMessage) message);\n                 }\n            } else if (message instanceof InfoMessage) {\n                handleInfoMessage(message);\n            } else {\n                unhandledInput(tuple);\n            }\n\nTo do not log unhandled tuples if topology is not active", "url": "https://github.com/telstra/open-kilda/pull/3886#discussion_r532592687", "createdAt": "2020-11-30T13:23:33Z", "author": {"login": "niksv"}, "path": "src-java/reroute-topology/reroute-storm-topology/src/main/java/org/openkilda/wfm/topology/reroute/bolts/RerouteBolt.java", "diffHunk": "@@ -82,14 +87,18 @@ public void prepare(Map stormConf, TopologyContext context, OutputCollector coll\n      */\n     @Override\n     protected void handleInput(Tuple tuple) throws PipelineException {\n-        Message message = pullValue(tuple, FIELD_ID_PAYLOAD, Message.class);\n-\n-        if (message instanceof CommandMessage) {\n-            handleCommandMessage((CommandMessage) message);\n-        } else if (message instanceof InfoMessage) {\n-            handleInfoMessage(message);\n+        if (ZooKeeperSpout.BOLT_ID.equals(tuple.getSourceComponent())) {\n+            LifecycleEvent event = (LifecycleEvent) tuple.getValueByField(FIELD_ID_LIFECYCLE_EVENT);\n+            handleLifeCycleEvent(event);\n         } else {\n-            unhandledInput(tuple);\n+            Message message = pullValue(tuple, FIELD_ID_PAYLOAD, Message.class);\n+            if (active && message instanceof CommandMessage) {\n+                handleCommandMessage((CommandMessage) message);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f5db2bb92610cd77b2134d1f003c89a8ecf237dd"}, "originalPosition": 38}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "f5db2bb92610cd77b2134d1f003c89a8ecf237dd", "author": {"user": {"login": "timofei-durakov", "name": "Timofey Durakov"}}, "url": "https://github.com/telstra/open-kilda/commit/f5db2bb92610cd77b2134d1f003c89a8ecf237dd", "committedDate": "2020-11-29T12:48:44Z", "message": "Zero-Downtime Reroute"}, "afterCommit": {"oid": "d56387e619ff5685082a1c5d2bb83277bc717583", "author": {"user": {"login": "timofei-durakov", "name": "Timofey Durakov"}}, "url": "https://github.com/telstra/open-kilda/commit/d56387e619ff5685082a1c5d2bb83277bc717583", "committedDate": "2020-12-03T06:26:29Z", "message": "Zero-Downtime Reroute"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "d56387e619ff5685082a1c5d2bb83277bc717583", "author": {"user": {"login": "timofei-durakov", "name": "Timofey Durakov"}}, "url": "https://github.com/telstra/open-kilda/commit/d56387e619ff5685082a1c5d2bb83277bc717583", "committedDate": "2020-12-03T06:26:29Z", "message": "Zero-Downtime Reroute"}, "afterCommit": {"oid": "4c76836ba9283333aa0848132297dc74b293190d", "author": {"user": {"login": "timofei-durakov", "name": "Timofey Durakov"}}, "url": "https://github.com/telstra/open-kilda/commit/4c76836ba9283333aa0848132297dc74b293190d", "committedDate": "2020-12-07T09:40:28Z", "message": "Zero-Downtime Reroute"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "4c76836ba9283333aa0848132297dc74b293190d", "author": {"user": {"login": "timofei-durakov", "name": "Timofey Durakov"}}, "url": "https://github.com/telstra/open-kilda/commit/4c76836ba9283333aa0848132297dc74b293190d", "committedDate": "2020-12-07T09:40:28Z", "message": "Zero-Downtime Reroute"}, "afterCommit": {"oid": "f32c4cfcfe7e195b4f32db2adc004eaea1e078ee", "author": {"user": {"login": "timofei-durakov", "name": "Timofey Durakov"}}, "url": "https://github.com/telstra/open-kilda/commit/f32c4cfcfe7e195b4f32db2adc004eaea1e078ee", "committedDate": "2020-12-09T11:51:51Z", "message": "Zero-Downtime Reroute"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "f32c4cfcfe7e195b4f32db2adc004eaea1e078ee", "author": {"user": {"login": "timofei-durakov", "name": "Timofey Durakov"}}, "url": "https://github.com/telstra/open-kilda/commit/f32c4cfcfe7e195b4f32db2adc004eaea1e078ee", "committedDate": "2020-12-09T11:51:51Z", "message": "Zero-Downtime Reroute"}, "afterCommit": {"oid": "323bae84c112d4323caab995537f2b71f29ef2b2", "author": {"user": {"login": "timofei-durakov", "name": "Timofey Durakov"}}, "url": "https://github.com/telstra/open-kilda/commit/323bae84c112d4323caab995537f2b71f29ef2b2", "committedDate": "2020-12-11T15:07:34Z", "message": "Zero-Downtime Reroute"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "323bae84c112d4323caab995537f2b71f29ef2b2", "author": {"user": {"login": "timofei-durakov", "name": "Timofey Durakov"}}, "url": "https://github.com/telstra/open-kilda/commit/323bae84c112d4323caab995537f2b71f29ef2b2", "committedDate": "2020-12-11T15:07:34Z", "message": "Zero-Downtime Reroute"}, "afterCommit": {"oid": "b3c46383c73930695107d8a1849a274353cf9cac", "author": {"user": {"login": "timofei-durakov", "name": "Timofey Durakov"}}, "url": "https://github.com/telstra/open-kilda/commit/b3c46383c73930695107d8a1849a274353cf9cac", "committedDate": "2020-12-14T06:35:41Z", "message": "Zero-Downtime Reroute"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "b3c46383c73930695107d8a1849a274353cf9cac", "author": {"user": {"login": "timofei-durakov", "name": "Timofey Durakov"}}, "url": "https://github.com/telstra/open-kilda/commit/b3c46383c73930695107d8a1849a274353cf9cac", "committedDate": "2020-12-14T06:35:41Z", "message": "Zero-Downtime Reroute"}, "afterCommit": {"oid": "cd1725e69a03ea9118a89621021b20e040a24d0b", "author": {"user": {"login": "timofei-durakov", "name": "Timofey Durakov"}}, "url": "https://github.com/telstra/open-kilda/commit/cd1725e69a03ea9118a89621021b20e040a24d0b", "committedDate": "2020-12-17T12:40:24Z", "message": "Zero-Downtime Reroute"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "cd1725e69a03ea9118a89621021b20e040a24d0b", "author": {"user": {"login": "timofei-durakov", "name": "Timofey Durakov"}}, "url": "https://github.com/telstra/open-kilda/commit/cd1725e69a03ea9118a89621021b20e040a24d0b", "committedDate": "2020-12-17T12:40:24Z", "message": "Zero-Downtime Reroute"}, "afterCommit": {"oid": "a73316175510c740c9872254d5e89e5eff946501", "author": {"user": {"login": "timofei-durakov", "name": "Timofey Durakov"}}, "url": "https://github.com/telstra/open-kilda/commit/a73316175510c740c9872254d5e89e5eff946501", "committedDate": "2020-12-21T19:44:16Z", "message": "Zero-Downtime Reroute"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "a73316175510c740c9872254d5e89e5eff946501", "author": {"user": {"login": "timofei-durakov", "name": "Timofey Durakov"}}, "url": "https://github.com/telstra/open-kilda/commit/a73316175510c740c9872254d5e89e5eff946501", "committedDate": "2020-12-21T19:44:16Z", "message": "Zero-Downtime Reroute"}, "afterCommit": {"oid": "d64d7bb31705bd75712e848b28cc9aa1895652fd", "author": {"user": {"login": "timofei-durakov", "name": "Timofey Durakov"}}, "url": "https://github.com/telstra/open-kilda/commit/d64d7bb31705bd75712e848b28cc9aa1895652fd", "committedDate": "2020-12-23T07:40:39Z", "message": "Zero-Downtime Reroute"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "d64d7bb31705bd75712e848b28cc9aa1895652fd", "author": {"user": {"login": "timofei-durakov", "name": "Timofey Durakov"}}, "url": "https://github.com/telstra/open-kilda/commit/d64d7bb31705bd75712e848b28cc9aa1895652fd", "committedDate": "2020-12-23T07:40:39Z", "message": "Zero-Downtime Reroute"}, "afterCommit": {"oid": "1768fb6833705d4626cfbbb696e433e4e1391cef", "author": {"user": {"login": "timofei-durakov", "name": "Timofey Durakov"}}, "url": "https://github.com/telstra/open-kilda/commit/1768fb6833705d4626cfbbb696e433e4e1391cef", "committedDate": "2020-12-28T11:03:41Z", "message": "Zero-Downtime Reroute"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "1768fb6833705d4626cfbbb696e433e4e1391cef", "author": {"user": {"login": "timofei-durakov", "name": "Timofey Durakov"}}, "url": "https://github.com/telstra/open-kilda/commit/1768fb6833705d4626cfbbb696e433e4e1391cef", "committedDate": "2020-12-28T11:03:41Z", "message": "Zero-Downtime Reroute"}, "afterCommit": {"oid": "4bc1a96535b7acf08a83d1cd7aeffcb76ba03c81", "author": {"user": {"login": "timofei-durakov", "name": "Timofey Durakov"}}, "url": "https://github.com/telstra/open-kilda/commit/4bc1a96535b7acf08a83d1cd7aeffcb76ba03c81", "committedDate": "2021-01-14T14:23:03Z", "message": "Zero-Downtime Reroute"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "4bc1a96535b7acf08a83d1cd7aeffcb76ba03c81", "author": {"user": {"login": "timofei-durakov", "name": "Timofey Durakov"}}, "url": "https://github.com/telstra/open-kilda/commit/4bc1a96535b7acf08a83d1cd7aeffcb76ba03c81", "committedDate": "2021-01-14T14:23:03Z", "message": "Zero-Downtime Reroute"}, "afterCommit": {"oid": "46d95303fdb37bd76264e1cf0bc289b582895a38", "author": {"user": {"login": "timofei-durakov", "name": "Timofey Durakov"}}, "url": "https://github.com/telstra/open-kilda/commit/46d95303fdb37bd76264e1cf0bc289b582895a38", "committedDate": "2021-01-27T08:17:32Z", "message": "Zero-Downtime Reroute"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "46d95303fdb37bd76264e1cf0bc289b582895a38", "author": {"user": {"login": "timofei-durakov", "name": "Timofey Durakov"}}, "url": "https://github.com/telstra/open-kilda/commit/46d95303fdb37bd76264e1cf0bc289b582895a38", "committedDate": "2021-01-27T08:17:32Z", "message": "Zero-Downtime Reroute"}, "afterCommit": {"oid": "b08e0f0cff60632bfddccc2a3ab7b1d7d5f0819f", "author": {"user": {"login": "timofei-durakov", "name": "Timofey Durakov"}}, "url": "https://github.com/telstra/open-kilda/commit/b08e0f0cff60632bfddccc2a3ab7b1d7d5f0819f", "committedDate": "2021-01-29T06:07:23Z", "message": "Zero-Downtime Reroute"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTc5OTUyOTA4", "url": "https://github.com/telstra/open-kilda/pull/3886#pullrequestreview-579952908", "createdAt": "2021-02-01T00:16:14Z", "commit": {"oid": "b08e0f0cff60632bfddccc2a3ab7b1d7d5f0819f"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMi0wMVQwMDoxNjoxNFrOIdN9Jg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMi0wMVQwMDoxNjoxNFrOIdN9Jg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU2NzUwODI2Mg==", "bodyText": "Does it make sense to introduce a dedicated \"build\" method instead of repeating \"getZkTopoName(), getConfig().getBlueGreenMode()\" each time?", "url": "https://github.com/telstra/open-kilda/pull/3886#discussion_r567508262", "createdAt": "2021-02-01T00:16:14Z", "author": {"login": "sergii-iakovenko"}, "path": "src-java/reroute-topology/reroute-storm-topology/src/main/java/org/openkilda/wfm/topology/reroute/RerouteTopology.java", "diffHunk": "@@ -77,22 +81,41 @@ public StormTopology createTopology() {\n \n         operationQueue(topologyBuilder);\n \n-        KafkaBolt<String, Message> kafkaFlowHsBolt = buildKafkaBolt(topologyConfig.getKafkaFlowHsTopic());\n+        KafkaBolt<String, Message> kafkaFlowHsBolt = buildKafkaBolt(topologyConfig.getKafkaFlowHsTopic(),\n+                getZkTopoName(), getConfig().getBlueGreenMode());", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b08e0f0cff60632bfddccc2a3ab7b1d7d5f0819f"}, "originalPosition": 26}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTgwOTg0NTg0", "url": "https://github.com/telstra/open-kilda/pull/3886#pullrequestreview-580984584", "createdAt": "2021-02-02T04:55:00Z", "commit": {"oid": "b08e0f0cff60632bfddccc2a3ab7b1d7d5f0819f"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "576d0126b701fa3632ce3755d8edf3ecf7b53cc7", "author": {"user": {"login": "timofei-durakov", "name": "Timofey Durakov"}}, "url": "https://github.com/telstra/open-kilda/commit/576d0126b701fa3632ce3755d8edf3ecf7b53cc7", "committedDate": "2021-02-03T13:02:49Z", "message": "Zero-Downtime Reroute"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "b08e0f0cff60632bfddccc2a3ab7b1d7d5f0819f", "author": {"user": {"login": "timofei-durakov", "name": "Timofey Durakov"}}, "url": "https://github.com/telstra/open-kilda/commit/b08e0f0cff60632bfddccc2a3ab7b1d7d5f0819f", "committedDate": "2021-01-29T06:07:23Z", "message": "Zero-Downtime Reroute"}, "afterCommit": {"oid": "576d0126b701fa3632ce3755d8edf3ecf7b53cc7", "author": {"user": {"login": "timofei-durakov", "name": "Timofey Durakov"}}, "url": "https://github.com/telstra/open-kilda/commit/576d0126b701fa3632ce3755d8edf3ecf7b53cc7", "committedDate": "2021-02-03T13:02:49Z", "message": "Zero-Downtime Reroute"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTgzNDk4ODI0", "url": "https://github.com/telstra/open-kilda/pull/3886#pullrequestreview-583498824", "createdAt": "2021-02-04T15:14:30Z", "commit": {"oid": "576d0126b701fa3632ce3755d8edf3ecf7b53cc7"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3779, "cost": 1, "resetAt": "2021-11-02T12:20:56Z"}}}