{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDEwNjk1NzUx", "number": 3432, "title": "Dispatch v1 flow create to flow hs", "bodyText": "changed worker for flow v1 create request\nfixed compile time warnings", "createdAt": "2020-04-29T12:56:18Z", "url": "https://github.com/telstra/open-kilda/pull/3432", "merged": true, "mergeCommit": {"oid": "92b54fd0453cd6eed3125d073f8b1646f660a12c"}, "closed": true, "closedAt": "2020-05-25T12:48:42Z", "author": {"login": "timofei-durakov"}, "timelineItems": {"totalCount": 17, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcccRMYgBqjMyODU3NTYzMjg=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcjG31hgBqjMzNTU4OTEwNTc=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "cba32b510e152d67626f764e061bae8644730a1e", "author": {"user": {"login": "timofei-durakov", "name": "Timofey Durakov"}}, "url": "https://github.com/telstra/open-kilda/commit/cba32b510e152d67626f764e061bae8644730a1e", "committedDate": "2020-04-29T12:54:06Z", "message": "Dispatch v1 flow create to flow hs\n\n- changed worker for flow v1 create request\n- fixed compile time warnings"}, "afterCommit": {"oid": "c3d64474f9a9f4694d249d4fd0278b48ec1e16b9", "author": {"user": {"login": "timofei-durakov", "name": "Timofey Durakov"}}, "url": "https://github.com/telstra/open-kilda/commit/c3d64474f9a9f4694d249d4fd0278b48ec1e16b9", "committedDate": "2020-04-29T17:51:46Z", "message": "Dispatch v1 flow create to flow hs\n\n- changed worker for flow v1 create request\n- fixed compile time warnings"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDA0MDYxMjY4", "url": "https://github.com/telstra/open-kilda/pull/3432#pullrequestreview-404061268", "createdAt": "2020-05-01T08:06:41Z", "commit": {"oid": "c3d64474f9a9f4694d249d4fd0278b48ec1e16b9"}, "state": "COMMENTED", "comments": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wMVQwODowNjo0MlrOGPEfAQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wMVQwODozMjo0NVrOGPE4YA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxODQ1NTI5Nw==", "bodyText": "You don't need eval expression here - instead, you can use source = \"source.switchDpId\".", "url": "https://github.com/telstra/open-kilda/pull/3432#discussion_r418455297", "createdAt": "2020-05-01T08:06:42Z", "author": {"login": "surabujin"}, "path": "src-java/northbound-service/northbound/src/main/java/org/openkilda/northbound/converter/FlowMapper.java", "diffHunk": "@@ -159,6 +160,42 @@ default FlowResponsePayload toFlowResponseOutput(FlowReadResponse r) {\n     @Mapping(target = \"type\", ignore = true)\n     FlowRequest toFlowRequest(FlowRequestV2 request);\n \n+\n+    @Mapping(target = \"flowId\", source = \"id\")\n+    @Mapping(target = \"sourceSwitch\", expression = \"java(request.getSource().getSwitchDpId())\")", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c3d64474f9a9f4694d249d4fd0278b48ec1e16b9"}, "originalPosition": 23}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxODQ2MDM0NA==", "bodyText": "Should it be placed into flowHsTopic?", "url": "https://github.com/telstra/open-kilda/pull/3432#discussion_r418460344", "createdAt": "2020-05-01T08:27:13Z", "author": {"login": "surabujin"}, "path": "src-java/northbound-service/northbound/src/main/java/org/openkilda/northbound/service/impl/FlowServiceImpl.java", "diffHunk": "@@ -170,17 +169,17 @@\n         final String correlationId = RequestCorrelationId.getId();\n         logger.info(\"Create flow: {}\", input);\n \n-        FlowCreateRequest payload;\n+        FlowRequest flowRequest;\n         try {\n-            payload = new FlowCreateRequest(new FlowDto(input), input.getDiverseFlowId());\n+            flowRequest =  flowMapper.toFlowCreateRequest(input);\n         } catch (IllegalArgumentException e) {\n             logger.error(\"Can not parse arguments: {}\", e.getMessage(), e);\n             throw new MessageException(correlationId, System.currentTimeMillis(), ErrorType.DATA_INVALID,\n                     e.getMessage(), \"Can not parse arguments of the create flow request\");\n         }\n \n         CommandMessage request = new CommandMessage(\n-                payload, System.currentTimeMillis(), correlationId, Destination.WFM);\n+                flowRequest, System.currentTimeMillis(), correlationId, Destination.WFM);\n \n         return messagingChannel.sendAndGet(topic, request)", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c3d64474f9a9f4694d249d4fd0278b48ec1e16b9"}, "originalPosition": 27}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxODQ2MDcyNg==", "bodyText": "Are we ready for a complete switch to H&S create? I.e. remove toggle for a fast rollback on v1 create? (Current mapping have such toggle).", "url": "https://github.com/telstra/open-kilda/pull/3432#discussion_r418460726", "createdAt": "2020-05-01T08:28:35Z", "author": {"login": "surabujin"}, "path": "src-java/northbound-service/northbound/src/main/java/org/openkilda/northbound/service/impl/FlowServiceImpl.java", "diffHunk": "@@ -170,17 +169,17 @@\n         final String correlationId = RequestCorrelationId.getId();\n         logger.info(\"Create flow: {}\", input);\n \n-        FlowCreateRequest payload;\n+        FlowRequest flowRequest;\n         try {\n-            payload = new FlowCreateRequest(new FlowDto(input), input.getDiverseFlowId());\n+            flowRequest =  flowMapper.toFlowCreateRequest(input);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c3d64474f9a9f4694d249d4fd0278b48ec1e16b9"}, "originalPosition": 16}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxODQ2MTc5Mg==", "bodyText": "I would like to have a copy constructor for DetectConnectedDevicesDto or mapper method to copy such objects (at least it remove code duplication).", "url": "https://github.com/telstra/open-kilda/pull/3432#discussion_r418461792", "createdAt": "2020-05-01T08:32:45Z", "author": {"login": "surabujin"}, "path": "src-java/northbound-service/northbound/src/main/java/org/openkilda/northbound/converter/FlowMapper.java", "diffHunk": "@@ -159,6 +160,42 @@ default FlowResponsePayload toFlowResponseOutput(FlowReadResponse r) {\n     @Mapping(target = \"type\", ignore = true)\n     FlowRequest toFlowRequest(FlowRequestV2 request);\n \n+\n+    @Mapping(target = \"flowId\", source = \"id\")\n+    @Mapping(target = \"sourceSwitch\", expression = \"java(request.getSource().getSwitchDpId())\")\n+    @Mapping(target = \"destinationSwitch\", expression = \"java(request.getDestination().getSwitchDpId())\")\n+    @Mapping(target = \"sourcePort\", expression = \"java(request.getSource().getPortNumber())\")\n+    @Mapping(target = \"destinationPort\", expression = \"java(request.getDestination().getPortNumber())\")\n+    @Mapping(target = \"sourceVlan\", expression = \"java(request.getSource().getVlanId())\")\n+    @Mapping(target = \"destinationVlan\", expression = \"java(request.getDestination().getVlanId())\")\n+    @Mapping(target = \"bandwidth\", source = \"maximumBandwidth\")\n+    @Mapping(target = \"transitEncapsulationId\", ignore = true)\n+    @Mapping(target = \"type\", ignore = true)\n+    @Mapping(target = \"detectConnectedDevices\", ignore = true)\n+    FlowRequest toFlowRequest(FlowCreatePayload request);\n+\n+    /**\n+     * Map FlowCreatePayload.\n+     *\n+     * @param source {@link FlowCreatePayload} instance.\n+     * @return {@link FlowRequest} instance.\n+     */\n+    default FlowRequest toFlowCreateRequest(FlowCreatePayload source) {\n+        FlowRequest target = toFlowRequest(source).toBuilder().type(Type.CREATE).build();\n+        DetectConnectedDevicesDto detectConnectedDevicesDto = new DetectConnectedDevicesDto();\n+        if (source.getSource().getDetectConnectedDevices() != null) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c3d64474f9a9f4694d249d4fd0278b48ec1e16b9"}, "originalPosition": 44}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "c3d64474f9a9f4694d249d4fd0278b48ec1e16b9", "author": {"user": {"login": "timofei-durakov", "name": "Timofey Durakov"}}, "url": "https://github.com/telstra/open-kilda/commit/c3d64474f9a9f4694d249d4fd0278b48ec1e16b9", "committedDate": "2020-04-29T17:51:46Z", "message": "Dispatch v1 flow create to flow hs\n\n- changed worker for flow v1 create request\n- fixed compile time warnings"}, "afterCommit": {"oid": "f1e7376caab493f3d9893b6912b260d8e2db5ccd", "author": {"user": {"login": "timofei-durakov", "name": "Timofey Durakov"}}, "url": "https://github.com/telstra/open-kilda/commit/f1e7376caab493f3d9893b6912b260d8e2db5ccd", "committedDate": "2020-05-04T13:50:50Z", "message": "Dispatch v1 flow create to flow hs\n\n- changed worker for flow v1 create request\n- fixed compile time warnings"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "f1e7376caab493f3d9893b6912b260d8e2db5ccd", "author": {"user": {"login": "timofei-durakov", "name": "Timofey Durakov"}}, "url": "https://github.com/telstra/open-kilda/commit/f1e7376caab493f3d9893b6912b260d8e2db5ccd", "committedDate": "2020-05-04T13:50:50Z", "message": "Dispatch v1 flow create to flow hs\n\n- changed worker for flow v1 create request\n- fixed compile time warnings"}, "afterCommit": {"oid": "3e2f43c2849978c083d105b00f4fc41075c1d73e", "author": {"user": {"login": "timofei-durakov", "name": "Timofey Durakov"}}, "url": "https://github.com/telstra/open-kilda/commit/3e2f43c2849978c083d105b00f4fc41075c1d73e", "committedDate": "2020-05-05T08:45:20Z", "message": "Dispatch v1 flow create to flow hs\n\n- changed worker for flow v1 create request\n- fixed compile time warnings"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "3e2f43c2849978c083d105b00f4fc41075c1d73e", "author": {"user": {"login": "timofei-durakov", "name": "Timofey Durakov"}}, "url": "https://github.com/telstra/open-kilda/commit/3e2f43c2849978c083d105b00f4fc41075c1d73e", "committedDate": "2020-05-05T08:45:20Z", "message": "Dispatch v1 flow create to flow hs\n\n- changed worker for flow v1 create request\n- fixed compile time warnings"}, "afterCommit": {"oid": "fd593fb254b74f6a1d20a1e7fff05172532024de", "author": {"user": {"login": "timofei-durakov", "name": "Timofey Durakov"}}, "url": "https://github.com/telstra/open-kilda/commit/fd593fb254b74f6a1d20a1e7fff05172532024de", "committedDate": "2020-05-06T07:53:55Z", "message": "Dispatch v1 flow create to flow hs\n\n- changed worker for flow v1 create request\n- fixed compile time warnings"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "fd593fb254b74f6a1d20a1e7fff05172532024de", "author": {"user": {"login": "timofei-durakov", "name": "Timofey Durakov"}}, "url": "https://github.com/telstra/open-kilda/commit/fd593fb254b74f6a1d20a1e7fff05172532024de", "committedDate": "2020-05-06T07:53:55Z", "message": "Dispatch v1 flow create to flow hs\n\n- changed worker for flow v1 create request\n- fixed compile time warnings"}, "afterCommit": {"oid": "ea35f76b7c07896fe7be92d2006e5268ef9409a4", "author": {"user": {"login": "timofei-durakov", "name": "Timofey Durakov"}}, "url": "https://github.com/telstra/open-kilda/commit/ea35f76b7c07896fe7be92d2006e5268ef9409a4", "committedDate": "2020-05-06T08:06:07Z", "message": "Dispatch v1 flow create to flow hs\n\n- changed worker for flow v1 create request\n- fixed compile time warnings"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "ea35f76b7c07896fe7be92d2006e5268ef9409a4", "author": {"user": {"login": "timofei-durakov", "name": "Timofey Durakov"}}, "url": "https://github.com/telstra/open-kilda/commit/ea35f76b7c07896fe7be92d2006e5268ef9409a4", "committedDate": "2020-05-06T08:06:07Z", "message": "Dispatch v1 flow create to flow hs\n\n- changed worker for flow v1 create request\n- fixed compile time warnings"}, "afterCommit": {"oid": "be3f3a51738f25aa8e502b57bf64fe06baa1cd9f", "author": {"user": {"login": "timofei-durakov", "name": "Timofey Durakov"}}, "url": "https://github.com/telstra/open-kilda/commit/be3f3a51738f25aa8e502b57bf64fe06baa1cd9f", "committedDate": "2020-05-06T08:44:05Z", "message": "Dispatch v1 flow create to flow hs\n\n- changed worker for flow v1 create request\n- fixed compile time warnings"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDA2NTE2MTcz", "url": "https://github.com/telstra/open-kilda/pull/3432#pullrequestreview-406516173", "createdAt": "2020-05-06T11:19:08Z", "commit": {"oid": "be3f3a51738f25aa8e502b57bf64fe06baa1cd9f"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "be3f3a51738f25aa8e502b57bf64fe06baa1cd9f", "author": {"user": {"login": "timofei-durakov", "name": "Timofey Durakov"}}, "url": "https://github.com/telstra/open-kilda/commit/be3f3a51738f25aa8e502b57bf64fe06baa1cd9f", "committedDate": "2020-05-06T08:44:05Z", "message": "Dispatch v1 flow create to flow hs\n\n- changed worker for flow v1 create request\n- fixed compile time warnings"}, "afterCommit": {"oid": "67655453be9d76eb59b32cfd70889365e655405d", "author": {"user": {"login": "timofei-durakov", "name": "Timofey Durakov"}}, "url": "https://github.com/telstra/open-kilda/commit/67655453be9d76eb59b32cfd70889365e655405d", "committedDate": "2020-05-07T15:23:51Z", "message": "Dispatch v1 flow create to flow hs\n\n- changed worker for flow v1 create request\n- fixed compile time warnings"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "67655453be9d76eb59b32cfd70889365e655405d", "author": {"user": {"login": "timofei-durakov", "name": "Timofey Durakov"}}, "url": "https://github.com/telstra/open-kilda/commit/67655453be9d76eb59b32cfd70889365e655405d", "committedDate": "2020-05-07T15:23:51Z", "message": "Dispatch v1 flow create to flow hs\n\n- changed worker for flow v1 create request\n- fixed compile time warnings"}, "afterCommit": {"oid": "1c618725c3395afc12fa319df35e831f80268db4", "author": {"user": {"login": "timofei-durakov", "name": "Timofey Durakov"}}, "url": "https://github.com/telstra/open-kilda/commit/1c618725c3395afc12fa319df35e831f80268db4", "committedDate": "2020-05-12T09:10:00Z", "message": "Dispatch v1 flow create to flow hs\n\n- changed worker for flow v1 create request\n- fixed compile time warnings"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDEyNjIxNDY4", "url": "https://github.com/telstra/open-kilda/pull/3432#pullrequestreview-412621468", "createdAt": "2020-05-15T12:54:29Z", "commit": {"oid": "1c618725c3395afc12fa319df35e831f80268db4"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "1c618725c3395afc12fa319df35e831f80268db4", "author": {"user": {"login": "timofei-durakov", "name": "Timofey Durakov"}}, "url": "https://github.com/telstra/open-kilda/commit/1c618725c3395afc12fa319df35e831f80268db4", "committedDate": "2020-05-12T09:10:00Z", "message": "Dispatch v1 flow create to flow hs\n\n- changed worker for flow v1 create request\n- fixed compile time warnings"}, "afterCommit": {"oid": "94a4ceeb6c4dd7d9b4866c5c149df165c9b1d08d", "author": {"user": {"login": "timofei-durakov", "name": "Timofey Durakov"}}, "url": "https://github.com/telstra/open-kilda/commit/94a4ceeb6c4dd7d9b4866c5c149df165c9b1d08d", "committedDate": "2020-05-18T13:20:31Z", "message": "Dispatch v1 flow create to flow hs\n\n- changed worker for flow v1 create request\n- fixed compile time warnings"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "94a4ceeb6c4dd7d9b4866c5c149df165c9b1d08d", "author": {"user": {"login": "timofei-durakov", "name": "Timofey Durakov"}}, "url": "https://github.com/telstra/open-kilda/commit/94a4ceeb6c4dd7d9b4866c5c149df165c9b1d08d", "committedDate": "2020-05-18T13:20:31Z", "message": "Dispatch v1 flow create to flow hs\n\n- changed worker for flow v1 create request\n- fixed compile time warnings"}, "afterCommit": {"oid": "17dfaf9cb94390f8861f76cc2e305fe32113b7bc", "author": {"user": {"login": "timofei-durakov", "name": "Timofey Durakov"}}, "url": "https://github.com/telstra/open-kilda/commit/17dfaf9cb94390f8861f76cc2e305fe32113b7bc", "committedDate": "2020-05-18T15:40:22Z", "message": "Dispatch v1 flow create to flow hs\n\n- changed worker for flow v1 create request\n- fixed compile time warnings"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "17dfaf9cb94390f8861f76cc2e305fe32113b7bc", "author": {"user": {"login": "timofei-durakov", "name": "Timofey Durakov"}}, "url": "https://github.com/telstra/open-kilda/commit/17dfaf9cb94390f8861f76cc2e305fe32113b7bc", "committedDate": "2020-05-18T15:40:22Z", "message": "Dispatch v1 flow create to flow hs\n\n- changed worker for flow v1 create request\n- fixed compile time warnings"}, "afterCommit": {"oid": "fc3f468813b001a1a582bfb7acc4d71992047702", "author": {"user": {"login": "timofei-durakov", "name": "Timofey Durakov"}}, "url": "https://github.com/telstra/open-kilda/commit/fc3f468813b001a1a582bfb7acc4d71992047702", "committedDate": "2020-05-19T08:38:42Z", "message": "Dispatch v1 flow create to flow hs\n\n- changed worker for flow v1 create request\n- fixed compile time warnings"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "fc3f468813b001a1a582bfb7acc4d71992047702", "author": {"user": {"login": "timofei-durakov", "name": "Timofey Durakov"}}, "url": "https://github.com/telstra/open-kilda/commit/fc3f468813b001a1a582bfb7acc4d71992047702", "committedDate": "2020-05-19T08:38:42Z", "message": "Dispatch v1 flow create to flow hs\n\n- changed worker for flow v1 create request\n- fixed compile time warnings"}, "afterCommit": {"oid": "c408785182b712d564615435f4501303089e0753", "author": {"user": {"login": "timofei-durakov", "name": "Timofey Durakov"}}, "url": "https://github.com/telstra/open-kilda/commit/c408785182b712d564615435f4501303089e0753", "committedDate": "2020-05-19T14:12:23Z", "message": "Dispatch v1 flow create to flow hs\n\n- changed worker for flow v1 create request\n- fixed compile time warnings"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "8768b396d05430cc5f9a4f1aaceba62cbc3d2fbb", "author": {"user": {"login": "timofei-durakov", "name": "Timofey Durakov"}}, "url": "https://github.com/telstra/open-kilda/commit/8768b396d05430cc5f9a4f1aaceba62cbc3d2fbb", "committedDate": "2020-05-20T10:53:32Z", "message": "Dispatch v1 flow create to flow hs\n\n- changed worker for flow v1 create request\n- fixed compile time warnings"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "c408785182b712d564615435f4501303089e0753", "author": {"user": {"login": "timofei-durakov", "name": "Timofey Durakov"}}, "url": "https://github.com/telstra/open-kilda/commit/c408785182b712d564615435f4501303089e0753", "committedDate": "2020-05-19T14:12:23Z", "message": "Dispatch v1 flow create to flow hs\n\n- changed worker for flow v1 create request\n- fixed compile time warnings"}, "afterCommit": {"oid": "8768b396d05430cc5f9a4f1aaceba62cbc3d2fbb", "author": {"user": {"login": "timofei-durakov", "name": "Timofey Durakov"}}, "url": "https://github.com/telstra/open-kilda/commit/8768b396d05430cc5f9a4f1aaceba62cbc3d2fbb", "committedDate": "2020-05-20T10:53:32Z", "message": "Dispatch v1 flow create to flow hs\n\n- changed worker for flow v1 create request\n- fixed compile time warnings"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3634, "cost": 1, "resetAt": "2021-11-02T12:20:56Z"}}}