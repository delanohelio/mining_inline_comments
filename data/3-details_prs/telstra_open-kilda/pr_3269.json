{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0Mzg0Nzg2MTMz", "number": 3269, "title": "Fix the appearance of excess rules when flow update V2.", "bodyText": "When updating flow, we save the old flow in the RequestedFlow object using the mapper. And when deleting old rules, we take information from this object. We need these two flags to build commands for removing rules. Also the conditions for removing customer port shared rules have been added.\nCloses: #3266.", "createdAt": "2020-03-06T12:04:01Z", "url": "https://github.com/telstra/open-kilda/pull/3269", "merged": true, "mergeCommit": {"oid": "b0d211a8f3fdc4fee9ea2d942d0b78c9ea2df55b"}, "closed": true, "closedAt": "2020-03-12T15:42:44Z", "author": {"login": "dpoltavets"}, "timelineItems": {"totalCount": 10, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcK_DfAgBqjMxMDUxMjU4Nzk=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcM9SAZgFqTM3MzY0OTQ3Nw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "a08394bfba1800384d390b0eb81cee4065e36bab", "author": {"user": {"login": "dpoltavets", "name": "Dmitriy Poltavets"}}, "url": "https://github.com/telstra/open-kilda/commit/a08394bfba1800384d390b0eb81cee4065e36bab", "committedDate": "2020-03-06T12:02:04Z", "message": "Fix the appearance of excess rules when flow update V2."}, "afterCommit": {"oid": "cecb086af25d936eee235cc20c915b9234b0b5f6", "author": {"user": {"login": "dpoltavets", "name": "Dmitriy Poltavets"}}, "url": "https://github.com/telstra/open-kilda/commit/cecb086af25d936eee235cc20c915b9234b0b5f6", "committedDate": "2020-03-06T12:10:56Z", "message": "Fix the appearance of excess rules when flow update V2.\n\nWhen updating flow, we save the old flow in the RequestedFlow object. And when deleting old rules, we take information from this object. We need these two flags to build rules for removing rules."}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "cecb086af25d936eee235cc20c915b9234b0b5f6", "author": {"user": {"login": "dpoltavets", "name": "Dmitriy Poltavets"}}, "url": "https://github.com/telstra/open-kilda/commit/cecb086af25d936eee235cc20c915b9234b0b5f6", "committedDate": "2020-03-06T12:10:56Z", "message": "Fix the appearance of excess rules when flow update V2.\n\nWhen updating flow, we save the old flow in the RequestedFlow object. And when deleting old rules, we take information from this object. We need these two flags to build rules for removing rules."}, "afterCommit": {"oid": "00f9341ca6bca4e2f30cbcffe3c834cf09f86025", "author": {"user": {"login": "dpoltavets", "name": "Dmitriy Poltavets"}}, "url": "https://github.com/telstra/open-kilda/commit/00f9341ca6bca4e2f30cbcffe3c834cf09f86025", "committedDate": "2020-03-06T12:13:57Z", "message": "Fix the appearance of excess rules when flow update V2.\n\nWhen updating flow, we save the old flow in the RequestedFlow object using the mapper. And when deleting old rules, we take information from this object. We need these two flags to build rules for removing rules."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzcwMjgwNDYw", "url": "https://github.com/telstra/open-kilda/pull/3269#pullrequestreview-370280460", "createdAt": "2020-03-06T12:16:44Z", "commit": {"oid": "00f9341ca6bca4e2f30cbcffe3c834cf09f86025"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzcxNjk2MjY1", "url": "https://github.com/telstra/open-kilda/pull/3269#pullrequestreview-371696265", "createdAt": "2020-03-10T05:56:05Z", "commit": {"oid": "00f9341ca6bca4e2f30cbcffe3c834cf09f86025"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "00f9341ca6bca4e2f30cbcffe3c834cf09f86025", "author": {"user": {"login": "dpoltavets", "name": "Dmitriy Poltavets"}}, "url": "https://github.com/telstra/open-kilda/commit/00f9341ca6bca4e2f30cbcffe3c834cf09f86025", "committedDate": "2020-03-06T12:13:57Z", "message": "Fix the appearance of excess rules when flow update V2.\n\nWhen updating flow, we save the old flow in the RequestedFlow object using the mapper. And when deleting old rules, we take information from this object. We need these two flags to build rules for removing rules."}, "afterCommit": {"oid": "a25d19cea2314618c96eb7fb2211c9f7fef543a0", "author": {"user": {"login": "dpoltavets", "name": "Dmitriy Poltavets"}}, "url": "https://github.com/telstra/open-kilda/commit/a25d19cea2314618c96eb7fb2211c9f7fef543a0", "committedDate": "2020-03-10T13:20:33Z", "message": "Fix the appearance of excess rules when flow update V2.\n\nWhen updating flow, we save the old flow in the RequestedFlow object using the mapper. And when deleting old rules, we take information from this object. We need these two flags to build commands for removing rules. Also the conditions for removing customer port shared rules have been added."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "5dcb4ef3b578185e35da17406c8a571d6763d31d", "author": {"user": {"login": "dpoltavets", "name": "Dmitriy Poltavets"}}, "url": "https://github.com/telstra/open-kilda/commit/5dcb4ef3b578185e35da17406c8a571d6763d31d", "committedDate": "2020-03-10T13:23:50Z", "message": "Fix the appearance of excess rules when flow update V2.\n\nWhen updating flow, we save the old flow in the RequestedFlow object using the mapper. And when deleting old rules, we take information from this object. We need these two flags to build commands for removing rules. Also the conditions for removing customer port shared rules have been added."}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "a25d19cea2314618c96eb7fb2211c9f7fef543a0", "author": {"user": {"login": "dpoltavets", "name": "Dmitriy Poltavets"}}, "url": "https://github.com/telstra/open-kilda/commit/a25d19cea2314618c96eb7fb2211c9f7fef543a0", "committedDate": "2020-03-10T13:20:33Z", "message": "Fix the appearance of excess rules when flow update V2.\n\nWhen updating flow, we save the old flow in the RequestedFlow object using the mapper. And when deleting old rules, we take information from this object. We need these two flags to build commands for removing rules. Also the conditions for removing customer port shared rules have been added."}, "afterCommit": {"oid": "5dcb4ef3b578185e35da17406c8a571d6763d31d", "author": {"user": {"login": "dpoltavets", "name": "Dmitriy Poltavets"}}, "url": "https://github.com/telstra/open-kilda/commit/5dcb4ef3b578185e35da17406c8a571d6763d31d", "committedDate": "2020-03-10T13:23:50Z", "message": "Fix the appearance of excess rules when flow update V2.\n\nWhen updating flow, we save the old flow in the RequestedFlow object using the mapper. And when deleting old rules, we take information from this object. We need these two flags to build commands for removing rules. Also the conditions for removing customer port shared rules have been added."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzcxOTU0OTY3", "url": "https://github.com/telstra/open-kilda/pull/3269#pullrequestreview-371954967", "createdAt": "2020-03-10T13:35:56Z", "commit": {"oid": "5dcb4ef3b578185e35da17406c8a571d6763d31d"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzczMzMwNTY4", "url": "https://github.com/telstra/open-kilda/pull/3269#pullrequestreview-373330568", "createdAt": "2020-03-12T07:38:15Z", "commit": {"oid": "5dcb4ef3b578185e35da17406c8a571d6763d31d"}, "state": "APPROVED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xMlQwNzozODoxNVrOF1T1aA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xMlQwNzozODoxNVrOF1T1aA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MTQ0MzgxNg==", "bodyText": "nit: flowIds.size() == 1 && flowIds.contains(flowId)", "url": "https://github.com/telstra/open-kilda/pull/3269#discussion_r391443816", "createdAt": "2020-03-12T07:38:15Z", "author": {"login": "timofei-durakov"}, "path": "src-java/flowhs-topology/flowhs-storm-topology/src/main/java/org/openkilda/wfm/topology/flowhs/fsm/common/actions/BaseFlowRuleRemovalAction.java", "diffHunk": "@@ -49,6 +50,11 @@ public BaseFlowRuleRemovalAction(PersistenceManager persistenceManager, FlowReso\n         switchPropertiesRepository = persistenceManager.getRepositoryFactory().createSwitchPropertiesRepository();\n     }\n \n+    protected boolean isRemoveCustomerPortSharedCatchRule(String flowId, SwitchId ingressSwitchId, int ingressPort) {\n+        Set<String> flowIds = findFlowsIdsByEndpointWithMultiTable(ingressSwitchId, ingressPort);\n+        return flowIds.size() == 1 && flowIds.iterator().next().equals(flowId);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "5dcb4ef3b578185e35da17406c8a571d6763d31d"}, "originalPosition": 14}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzczNjQ5NDc3", "url": "https://github.com/telstra/open-kilda/pull/3269#pullrequestreview-373649477", "createdAt": "2020-03-12T15:17:03Z", "commit": {"oid": "5dcb4ef3b578185e35da17406c8a571d6763d31d"}, "state": "COMMENTED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3662, "cost": 1, "resetAt": "2021-11-02T12:20:56Z"}}}