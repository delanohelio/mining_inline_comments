{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDg2NTk3OTQ4", "number": 3722, "title": "Add functional tests for bfd v2 api", "bodyText": "", "createdAt": "2020-09-14T13:08:09Z", "url": "https://github.com/telstra/open-kilda/pull/3722", "merged": true, "mergeCommit": {"oid": "f8c3654bea0ba3ec41fe785f2e5eac4286171ce7"}, "closed": true, "closedAt": "2020-10-30T08:08:16Z", "author": {"login": "rtretyak"}, "timelineItems": {"totalCount": 11, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdI0OlCgFqTQ4Nzc5NzgzOA==", "endCursor": "Y3Vyc29yOnYyOpPPAAABdXiMuhAFqTUyMDQ0NTgxNg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDg3Nzk3ODM4", "url": "https://github.com/telstra/open-kilda/pull/3722#pullrequestreview-487797838", "createdAt": "2020-09-14T13:59:22Z", "commit": {"oid": "636f3d40aeb9e5ec645ffa83a801ecb3c9ef4055"}, "state": "APPROVED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xNFQxMzo1OToyMlrOHRVv5w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xNFQxMzo1OTo0NlrOHRVxdg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4Nzk0NDE2Nw==", "bodyText": "@Tidy?", "url": "https://github.com/telstra/open-kilda/pull/3722#discussion_r487944167", "createdAt": "2020-09-14T13:59:22Z", "author": {"login": "andriidovhan"}, "path": "src-java/testing/functional-tests/src/test/groovy/org/openkilda/functionaltests/spec/links/BfdSpec.groovy", "diffHunk": "@@ -245,4 +296,142 @@ class BfdSpec extends HealthCheckSpecification {\n             }\n         }\n     }\n+\n+    def \"Able to create/update BFD session with custom properties\"() {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "636f3d40aeb9e5ec645ffa83a801ecb3c9ef4055"}, "originalPosition": 217}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4Nzk0NDU2Ng==", "bodyText": "@Tidy?", "url": "https://github.com/telstra/open-kilda/pull/3722#discussion_r487944566", "createdAt": "2020-09-14T13:59:46Z", "author": {"login": "andriidovhan"}, "path": "src-java/testing/functional-tests/src/test/groovy/org/openkilda/functionaltests/spec/links/BfdSpec.groovy", "diffHunk": "@@ -245,4 +296,142 @@ class BfdSpec extends HealthCheckSpecification {\n             }\n         }\n     }\n+\n+    def \"Able to create/update BFD session with custom properties\"() {\n+        given: \"An ISL between two Noviflow switches\"\n+        def isl = topology.islsForActiveSwitches.find { it.srcSwitch.noviflow && it.dstSwitch.noviflow }\n+        assumeTrue(\"The test requires at least one BFD ISL\", isl as boolean)\n+\n+        when: \"Create bfd session with custom properties\"\n+        def bfdProps = new BfdProperties(100, (short)1)\n+        northboundV2.setLinkBfd(isl, bfdProps)\n+\n+        then: \"'get ISL' and 'get BFD' api reflect the changes\"\n+        Wrappers.wait(WAIT_OFFSET / 2) {\n+            [isl, isl.reversed].each {\n+                verifyAll(northbound.getLink(it)) {\n+                    enableBfd\n+                    bfdSessionStatus == \"up\"\n+                }\n+                verifyAll(northboundV2.getLinkBfd(it)) {\n+                    properties == bfdProps\n+                    effectiveSource.properties == bfdProps\n+                    effectiveDestination.properties == bfdProps\n+                }\n+            }\n+        }\n+\n+        when: \"Update bfd session with custom properties\"\n+        def updatedBfdProps = new BfdProperties(500, (short)5)\n+        northboundV2.setLinkBfd(isl, updatedBfdProps)\n+\n+        then: \"'get ISL' and 'get BFD' api reflect the changes\"\n+        Wrappers.wait(WAIT_OFFSET / 2) {\n+            [isl, isl.reversed].each {\n+                verifyAll(northbound.getLink(it)) {\n+                    enableBfd\n+                    bfdSessionStatus == \"up\"\n+                }\n+                verifyAll(northboundV2.getLinkBfd(it)) {\n+                    properties == updatedBfdProps\n+                    effectiveSource.properties == updatedBfdProps\n+                    effectiveDestination.properties == updatedBfdProps\n+                }\n+            }\n+        }\n+\n+        cleanup: \"Disable bfd\"\n+        bfdProps && northboundV2.deleteLinkBfd(isl)\n+    }\n+\n+    @Unroll\n+    def \"Unable to create bfd with #data.descr\"() {\n+        given: \"An ISL between two Noviflow switches\"\n+        def isl = topology.islsForActiveSwitches.find { it.srcSwitch.noviflow && it.dstSwitch.noviflow }\n+        assumeTrue(\"The test requires at least one BFD ISL\", isl as boolean)\n+\n+        when: \"Try enabling bfd with forbidden properties\"\n+        northboundV2.setLinkBfd(isl, data.props)\n+\n+        then: \"Error is returned\"\n+        def e = thrown(HttpClientErrorException)\n+        e.statusCode == HttpStatus.BAD_REQUEST\n+\n+        where:\n+        data << [\n+                [\n+                        descr: \"too small interval\",\n+                        props: new BfdProperties(99, (short)1)\n+                ],\n+                [\n+                        descr: \"too small multiplier\",\n+                        props: new BfdProperties(100, (short)0)\n+                ]\n+        ]\n+    }\n+\n+    def \"Able to CRUD BFD sessions using v1 API\"() {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "636f3d40aeb9e5ec645ffa83a801ecb3c9ef4055"}, "originalPosition": 290}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "636f3d40aeb9e5ec645ffa83a801ecb3c9ef4055", "author": {"user": {"login": "rtretyak", "name": "Roman Tretiak"}}, "url": "https://github.com/telstra/open-kilda/commit/636f3d40aeb9e5ec645ffa83a801ecb3c9ef4055", "committedDate": "2020-09-14T13:05:58Z", "message": "Add functional tests for bfd v2 api"}, "afterCommit": {"oid": "262a42f5ad0c9ea9253cf01f159d9a25008b466c", "author": {"user": {"login": "rtretyak", "name": "Roman Tretiak"}}, "url": "https://github.com/telstra/open-kilda/commit/262a42f5ad0c9ea9253cf01f159d9a25008b466c", "committedDate": "2020-09-23T06:39:09Z", "message": "Add functional tests for bfd v2 api"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "262a42f5ad0c9ea9253cf01f159d9a25008b466c", "author": {"user": {"login": "rtretyak", "name": "Roman Tretiak"}}, "url": "https://github.com/telstra/open-kilda/commit/262a42f5ad0c9ea9253cf01f159d9a25008b466c", "committedDate": "2020-09-23T06:39:09Z", "message": "Add functional tests for bfd v2 api"}, "afterCommit": {"oid": "707f638d1ecd889949e0921520e20aecdd7c35d1", "author": {"user": {"login": "rtretyak", "name": "Roman Tretiak"}}, "url": "https://github.com/telstra/open-kilda/commit/707f638d1ecd889949e0921520e20aecdd7c35d1", "committedDate": "2020-09-23T06:43:40Z", "message": "Add functional tests for bfd v2 api"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "707f638d1ecd889949e0921520e20aecdd7c35d1", "author": {"user": {"login": "rtretyak", "name": "Roman Tretiak"}}, "url": "https://github.com/telstra/open-kilda/commit/707f638d1ecd889949e0921520e20aecdd7c35d1", "committedDate": "2020-09-23T06:43:40Z", "message": "Add functional tests for bfd v2 api"}, "afterCommit": {"oid": "3b906351fe14bb366702d4753ecdaedc1ec6bf3d", "author": {"user": {"login": "rtretyak", "name": "Roman Tretiak"}}, "url": "https://github.com/telstra/open-kilda/commit/3b906351fe14bb366702d4753ecdaedc1ec6bf3d", "committedDate": "2020-10-15T10:57:59Z", "message": "Add functional tests for bfd v2 api"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "3b906351fe14bb366702d4753ecdaedc1ec6bf3d", "author": {"user": {"login": "rtretyak", "name": "Roman Tretiak"}}, "url": "https://github.com/telstra/open-kilda/commit/3b906351fe14bb366702d4753ecdaedc1ec6bf3d", "committedDate": "2020-10-15T10:57:59Z", "message": "Add functional tests for bfd v2 api"}, "afterCommit": {"oid": "4482b1f52085194ac9af3ab6cbe60893b6bd50c2", "author": {"user": {"login": "rtretyak", "name": "Roman Tretiak"}}, "url": "https://github.com/telstra/open-kilda/commit/4482b1f52085194ac9af3ab6cbe60893b6bd50c2", "committedDate": "2020-10-19T09:08:56Z", "message": "Add functional tests for v2 bfd api"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "4482b1f52085194ac9af3ab6cbe60893b6bd50c2", "author": {"user": {"login": "rtretyak", "name": "Roman Tretiak"}}, "url": "https://github.com/telstra/open-kilda/commit/4482b1f52085194ac9af3ab6cbe60893b6bd50c2", "committedDate": "2020-10-19T09:08:56Z", "message": "Add functional tests for v2 bfd api"}, "afterCommit": {"oid": "78ffdddce140372cc26191685f8694a2a62fc94b", "author": {"user": {"login": "rtretyak", "name": "Roman Tretiak"}}, "url": "https://github.com/telstra/open-kilda/commit/78ffdddce140372cc26191685f8694a2a62fc94b", "committedDate": "2020-10-19T12:27:15Z", "message": "Add functional tests for v2 bfd api"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "78ffdddce140372cc26191685f8694a2a62fc94b", "author": {"user": {"login": "rtretyak", "name": "Roman Tretiak"}}, "url": "https://github.com/telstra/open-kilda/commit/78ffdddce140372cc26191685f8694a2a62fc94b", "committedDate": "2020-10-19T12:27:15Z", "message": "Add functional tests for v2 bfd api"}, "afterCommit": {"oid": "975d7f0db653d6e9061affade0da74c4bb102e19", "author": {"user": {"login": "rtretyak", "name": "Roman Tretiak"}}, "url": "https://github.com/telstra/open-kilda/commit/975d7f0db653d6e9061affade0da74c4bb102e19", "committedDate": "2020-10-23T11:42:12Z", "message": "Add functional tests for v2 bfd api"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "975d7f0db653d6e9061affade0da74c4bb102e19", "author": {"user": {"login": "rtretyak", "name": "Roman Tretiak"}}, "url": "https://github.com/telstra/open-kilda/commit/975d7f0db653d6e9061affade0da74c4bb102e19", "committedDate": "2020-10-23T11:42:12Z", "message": "Add functional tests for v2 bfd api"}, "afterCommit": {"oid": "9eb2c18d2a64fc49cba44505ce6589389c5f2cad", "author": {"user": {"login": "rtretyak", "name": "Roman Tretiak"}}, "url": "https://github.com/telstra/open-kilda/commit/9eb2c18d2a64fc49cba44505ce6589389c5f2cad", "committedDate": "2020-10-23T13:06:00Z", "message": "Add functional tests for v2 bfd api"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "860f69b8061f4b831981117653065c7f8427bc60", "author": {"user": {"login": "rtretyak", "name": "Roman Tretiak"}}, "url": "https://github.com/telstra/open-kilda/commit/860f69b8061f4b831981117653065c7f8427bc60", "committedDate": "2020-10-27T11:37:25Z", "message": "Add functional tests for bfd v2 api"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "9eb2c18d2a64fc49cba44505ce6589389c5f2cad", "author": {"user": {"login": "rtretyak", "name": "Roman Tretiak"}}, "url": "https://github.com/telstra/open-kilda/commit/9eb2c18d2a64fc49cba44505ce6589389c5f2cad", "committedDate": "2020-10-23T13:06:00Z", "message": "Add functional tests for v2 bfd api"}, "afterCommit": {"oid": "860f69b8061f4b831981117653065c7f8427bc60", "author": {"user": {"login": "rtretyak", "name": "Roman Tretiak"}}, "url": "https://github.com/telstra/open-kilda/commit/860f69b8061f4b831981117653065c7f8427bc60", "committedDate": "2020-10-27T11:37:25Z", "message": "Add functional tests for bfd v2 api"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTIwNDQ1ODE2", "url": "https://github.com/telstra/open-kilda/pull/3722#pullrequestreview-520445816", "createdAt": "2020-10-30T08:08:10Z", "commit": {"oid": "860f69b8061f4b831981117653065c7f8427bc60"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3562, "cost": 1, "resetAt": "2021-11-02T12:20:56Z"}}}