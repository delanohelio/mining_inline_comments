{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTMwMzMxOTc1", "number": 3894, "reviewThreads": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xMFQwODo0ODo1N1rOFDW6Kg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xMFQwODo1NDo0MlrOFDXEPw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzM5MDY1Mzg2OnYy", "diffSide": "RIGHT", "path": "src-java/testing/functional-tests/src/test/groovy/org/openkilda/functionaltests/spec/flows/SwapEndpointSpec.groovy", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xMFQwODo0ODo1N1rOIC94cw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xMFQwOTozNDo0MlrOIC_1CQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzOTk4MTkzOQ==", "bodyText": "should include reversed pairs", "url": "https://github.com/telstra/open-kilda/pull/3894#discussion_r539981939", "createdAt": "2020-12-10T08:48:57Z", "author": {"login": "rtretyak"}, "path": "src-java/testing/functional-tests/src/test/groovy/org/openkilda/functionaltests/spec/flows/SwapEndpointSpec.groovy", "diffHunk": "@@ -1378,23 +1378,22 @@ switches\"() {\n     }\n \n     @Tidy\n-    def \"Unable to swap endpoints for a flow with flowLoop\"() {\n+    def \"Able to swap endpoints for a flow with flowLoop\"() {\n         setup: \"Create two flows with the same src and different dst switches\"\n         def tgSwitchIds = topology.getActiveTraffGens()*.switchConnected*.dpId\n-        assumeTrue(\"Not enough traffgen switches found\", tgSwitchIds.size() > 2)\n+        assumeTrue(\"Not enough traffgen switches found\", tgSwitchIds.size() > 1)\n         SwitchPair flow2SwitchPair = null\n-        SwitchPair flow1SwitchPair = topologyHelper.switchPairs.collectMany{ [it, it.reversed] }.find { firstPair ->\n+        SwitchPair flow1SwitchPair = topologyHelper.getAllNeighboringSwitchPairs().find { firstPair ->\n             def firstOk = firstPair.src.dpId in tgSwitchIds && firstPair.dst.dpId in tgSwitchIds\n             flow2SwitchPair = topologyHelper.getAllNeighboringSwitchPairs().find { secondPair ->", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "0bdcfca7f52ff5983a63bc901a8a50c2c3c7a6ca"}, "originalPosition": 14}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MDAxMzgzMw==", "bodyText": "fixed", "url": "https://github.com/telstra/open-kilda/pull/3894#discussion_r540013833", "createdAt": "2020-12-10T09:34:42Z", "author": {"login": "andriidovhan"}, "path": "src-java/testing/functional-tests/src/test/groovy/org/openkilda/functionaltests/spec/flows/SwapEndpointSpec.groovy", "diffHunk": "@@ -1378,23 +1378,22 @@ switches\"() {\n     }\n \n     @Tidy\n-    def \"Unable to swap endpoints for a flow with flowLoop\"() {\n+    def \"Able to swap endpoints for a flow with flowLoop\"() {\n         setup: \"Create two flows with the same src and different dst switches\"\n         def tgSwitchIds = topology.getActiveTraffGens()*.switchConnected*.dpId\n-        assumeTrue(\"Not enough traffgen switches found\", tgSwitchIds.size() > 2)\n+        assumeTrue(\"Not enough traffgen switches found\", tgSwitchIds.size() > 1)\n         SwitchPair flow2SwitchPair = null\n-        SwitchPair flow1SwitchPair = topologyHelper.switchPairs.collectMany{ [it, it.reversed] }.find { firstPair ->\n+        SwitchPair flow1SwitchPair = topologyHelper.getAllNeighboringSwitchPairs().find { firstPair ->\n             def firstOk = firstPair.src.dpId in tgSwitchIds && firstPair.dst.dpId in tgSwitchIds\n             flow2SwitchPair = topologyHelper.getAllNeighboringSwitchPairs().find { secondPair ->", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzOTk4MTkzOQ=="}, "originalCommit": {"oid": "0bdcfca7f52ff5983a63bc901a8a50c2c3c7a6ca"}, "originalPosition": 14}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzM5MDY3OTY3OnYy", "diffSide": "RIGHT", "path": "src-java/testing/functional-tests/src/test/groovy/org/openkilda/functionaltests/spec/flows/SwapEndpointSpec.groovy", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xMFQwODo1NDo0MlrOIC-HSQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xMFQwOTozNDozNlrOIC_0yw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzOTk4NTczNw==", "bodyText": "still created for the second flow?", "url": "https://github.com/telstra/open-kilda/pull/3894#discussion_r539985737", "createdAt": "2020-12-10T08:54:42Z", "author": {"login": "rtretyak"}, "path": "src-java/testing/functional-tests/src/test/groovy/org/openkilda/functionaltests/spec/flows/SwapEndpointSpec.groovy", "diffHunk": "@@ -1417,40 +1416,52 @@ switches\"() {\n                 new SwapFlowPayload(flow2.id, flowHelper.toFlowEndpointV2(flow2Src),\n                         flowHelper.toFlowEndpointV2(flow2Dst)))\n \n-        then: \"Human readable error is returned\"\n-        def exc = thrown(HttpServerErrorException)\n-        exc.statusCode == HttpStatus.NOT_IMPLEMENTED\n-        def errorDetails = exc.responseBodyAsString.to(MessageError)\n-        errorDetails.errorMessage == \"Could not swap endpoints\"\n-        errorDetails.errorDescription == \"Swap endpoints is not implemented for looped flows\"\n+        then: \"Endpoints are successfully swapped\"\n+        verifyEndpoints(response, flow1Src, flow1Dst, flow2Src, flow2Dst)\n+        verifyEndpoints(flow1.id, flow2.id, flow1Src, flow1Dst, flow2Src, flow2Dst)\n \n         and: \"Flows validation doesn't show any discrepancies\"\n         validateFlows(flow1, flow2)\n \n-        and: \"FlowLoop is still created for the second flow on the dst switch\"\n-        northbound.getFlow(flow2.id).loopSwitchId == flow2SwitchPair.dst.dpId\n+        and: \"FlowLoop is still created for the first flow but on the new dst switch\"", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "0bdcfca7f52ff5983a63bc901a8a50c2c3c7a6ca"}, "originalPosition": 57}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MDAxMzc3MQ==", "bodyText": "oops, you are right(for the second flow).", "url": "https://github.com/telstra/open-kilda/pull/3894#discussion_r540013771", "createdAt": "2020-12-10T09:34:36Z", "author": {"login": "andriidovhan"}, "path": "src-java/testing/functional-tests/src/test/groovy/org/openkilda/functionaltests/spec/flows/SwapEndpointSpec.groovy", "diffHunk": "@@ -1417,40 +1416,52 @@ switches\"() {\n                 new SwapFlowPayload(flow2.id, flowHelper.toFlowEndpointV2(flow2Src),\n                         flowHelper.toFlowEndpointV2(flow2Dst)))\n \n-        then: \"Human readable error is returned\"\n-        def exc = thrown(HttpServerErrorException)\n-        exc.statusCode == HttpStatus.NOT_IMPLEMENTED\n-        def errorDetails = exc.responseBodyAsString.to(MessageError)\n-        errorDetails.errorMessage == \"Could not swap endpoints\"\n-        errorDetails.errorDescription == \"Swap endpoints is not implemented for looped flows\"\n+        then: \"Endpoints are successfully swapped\"\n+        verifyEndpoints(response, flow1Src, flow1Dst, flow2Src, flow2Dst)\n+        verifyEndpoints(flow1.id, flow2.id, flow1Src, flow1Dst, flow2Src, flow2Dst)\n \n         and: \"Flows validation doesn't show any discrepancies\"\n         validateFlows(flow1, flow2)\n \n-        and: \"FlowLoop is still created for the second flow on the dst switch\"\n-        northbound.getFlow(flow2.id).loopSwitchId == flow2SwitchPair.dst.dpId\n+        and: \"FlowLoop is still created for the first flow but on the new dst switch\"", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzOTk4NTczNw=="}, "originalCommit": {"oid": "0bdcfca7f52ff5983a63bc901a8a50c2c3c7a6ca"}, "originalPosition": 57}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2344, "cost": 1, "resetAt": "2021-11-13T14:23:39Z"}}}