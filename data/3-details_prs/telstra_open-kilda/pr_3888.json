{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTI5MTI0ODQx", "number": 3888, "title": "Zero Downtime for Flow HS", "bodyText": "", "createdAt": "2020-11-29T15:17:38Z", "url": "https://github.com/telstra/open-kilda/pull/3888", "merged": true, "mergeCommit": {"oid": "88c0894a0e7974448829151c590b33c57fa4b8a1"}, "closed": true, "closedAt": "2021-02-05T09:39:15Z", "author": {"login": "timofei-durakov"}, "timelineItems": {"totalCount": 25, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdhUTJWgBqjQwNDkyNDQ3MTU=", "endCursor": "Y3Vyc29yOnYyOpPPAAABd3F7tkgFqTU4NDE1MjExNQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "22f2ed85ed7aaf7d9adce276ffb010564660737e", "author": {"user": {"login": "timofei-durakov", "name": "Timofey Durakov"}}, "url": "https://github.com/telstra/open-kilda/commit/22f2ed85ed7aaf7d9adce276ffb010564660737e", "committedDate": "2020-11-29T15:16:32Z", "message": "Zero Downtime for Flow HS"}, "afterCommit": {"oid": "4ac707ac929448b64f2d471c79a2e8818ab5d547", "author": {"user": {"login": "timofei-durakov", "name": "Timofey Durakov"}}, "url": "https://github.com/telstra/open-kilda/commit/4ac707ac929448b64f2d471c79a2e8818ab5d547", "committedDate": "2020-11-29T17:35:27Z", "message": "Zero Downtime for Flow HS"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "4ac707ac929448b64f2d471c79a2e8818ab5d547", "author": {"user": {"login": "timofei-durakov", "name": "Timofey Durakov"}}, "url": "https://github.com/telstra/open-kilda/commit/4ac707ac929448b64f2d471c79a2e8818ab5d547", "committedDate": "2020-11-29T17:35:27Z", "message": "Zero Downtime for Flow HS"}, "afterCommit": {"oid": "dd6ea94d0f6beed9794fcf443434862b52e6e2eb", "author": {"user": {"login": "timofei-durakov", "name": "Timofey Durakov"}}, "url": "https://github.com/telstra/open-kilda/commit/dd6ea94d0f6beed9794fcf443434862b52e6e2eb", "committedDate": "2020-11-29T18:04:42Z", "message": "Zero Downtime for Flow HS"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "dd6ea94d0f6beed9794fcf443434862b52e6e2eb", "author": {"user": {"login": "timofei-durakov", "name": "Timofey Durakov"}}, "url": "https://github.com/telstra/open-kilda/commit/dd6ea94d0f6beed9794fcf443434862b52e6e2eb", "committedDate": "2020-11-29T18:04:42Z", "message": "Zero Downtime for Flow HS"}, "afterCommit": {"oid": "c785897f4c2b4c4ad3e2e1e98adb5462c220192b", "author": {"user": {"login": "timofei-durakov", "name": "Timofey Durakov"}}, "url": "https://github.com/telstra/open-kilda/commit/c785897f4c2b4c4ad3e2e1e98adb5462c220192b", "committedDate": "2020-12-03T06:27:51Z", "message": "Zero Downtime for Flow HS"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "c785897f4c2b4c4ad3e2e1e98adb5462c220192b", "author": {"user": {"login": "timofei-durakov", "name": "Timofey Durakov"}}, "url": "https://github.com/telstra/open-kilda/commit/c785897f4c2b4c4ad3e2e1e98adb5462c220192b", "committedDate": "2020-12-03T06:27:51Z", "message": "Zero Downtime for Flow HS"}, "afterCommit": {"oid": "6c28e63fc22c853b626556f2aa04cca0f293206b", "author": {"user": {"login": "timofei-durakov", "name": "Timofey Durakov"}}, "url": "https://github.com/telstra/open-kilda/commit/6c28e63fc22c853b626556f2aa04cca0f293206b", "committedDate": "2020-12-07T09:16:35Z", "message": "Zero Downtime for Flow HS"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "6c28e63fc22c853b626556f2aa04cca0f293206b", "author": {"user": {"login": "timofei-durakov", "name": "Timofey Durakov"}}, "url": "https://github.com/telstra/open-kilda/commit/6c28e63fc22c853b626556f2aa04cca0f293206b", "committedDate": "2020-12-07T09:16:35Z", "message": "Zero Downtime for Flow HS"}, "afterCommit": {"oid": "58efc92a89bc0110112340b9ff6e11e9aa43a2bd", "author": {"user": {"login": "timofei-durakov", "name": "Timofey Durakov"}}, "url": "https://github.com/telstra/open-kilda/commit/58efc92a89bc0110112340b9ff6e11e9aa43a2bd", "committedDate": "2020-12-07T09:17:37Z", "message": "Zero Downtime for Flow HS"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "58efc92a89bc0110112340b9ff6e11e9aa43a2bd", "author": {"user": {"login": "timofei-durakov", "name": "Timofey Durakov"}}, "url": "https://github.com/telstra/open-kilda/commit/58efc92a89bc0110112340b9ff6e11e9aa43a2bd", "committedDate": "2020-12-07T09:17:37Z", "message": "Zero Downtime for Flow HS"}, "afterCommit": {"oid": "0c532365c227dee18c8154fe92927d0c19bfb76d", "author": {"user": {"login": "timofei-durakov", "name": "Timofey Durakov"}}, "url": "https://github.com/telstra/open-kilda/commit/0c532365c227dee18c8154fe92927d0c19bfb76d", "committedDate": "2020-12-07T09:43:52Z", "message": "Zero Downtime for Flow HS"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTQ2Mjc3NTU0", "url": "https://github.com/telstra/open-kilda/pull/3888#pullrequestreview-546277554", "createdAt": "2020-12-07T15:47:22Z", "commit": {"oid": "0c532365c227dee18c8154fe92927d0c19bfb76d"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0wN1QxNTo0NzoyMlrOIAtL0Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0wN1QxNTo0NzoyMlrOIAtL0Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNzYxMTIxNw==", "bodyText": "incorrect. should be {} instead of %s", "url": "https://github.com/telstra/open-kilda/pull/3888#discussion_r537611217", "createdAt": "2020-12-07T15:47:22Z", "author": {"login": "niksv"}, "path": "src-java/flowhs-topology/flowhs-storm-topology/src/main/java/org/openkilda/wfm/topology/flowhs/bolts/FlowCreateHubBolt.java", "diffHunk": "@@ -87,6 +94,22 @@ protected void init() {\n                 config.getPathAllocationRetryDelay(), config.getSpeakerCommandRetriesLimit());\n     }\n \n+    @Override\n+    protected void handleLifeCycleEvent(LifecycleEvent event) {\n+        if (event.getSignal().equals(Signal.SHUTDOWN)) {\n+            if (service.deactivate()) {\n+                emit(ZkStreams.ZK.toString(), getCurrentTuple(), new Values(event, getCommandContext()));\n+            } else {\n+                deferedShutdownEvent = event;\n+            }\n+        } else if (event.getSignal().equals(Signal.START)) {\n+            service.activate();\n+            emit(ZkStreams.ZK.toString(), getCurrentTuple(), new Values(event, getCommandContext()));\n+        } else {\n+            log.info(\"Received signal info %s\", event.getSignal());", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "0c532365c227dee18c8154fe92927d0c19bfb76d"}, "originalPosition": 51}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "0c532365c227dee18c8154fe92927d0c19bfb76d", "author": {"user": {"login": "timofei-durakov", "name": "Timofey Durakov"}}, "url": "https://github.com/telstra/open-kilda/commit/0c532365c227dee18c8154fe92927d0c19bfb76d", "committedDate": "2020-12-07T09:43:52Z", "message": "Zero Downtime for Flow HS"}, "afterCommit": {"oid": "5f7cb5e2a2e2fa8ef31c53526c06132a2f8bdf74", "author": {"user": {"login": "timofei-durakov", "name": "Timofey Durakov"}}, "url": "https://github.com/telstra/open-kilda/commit/5f7cb5e2a2e2fa8ef31c53526c06132a2f8bdf74", "committedDate": "2020-12-08T07:27:44Z", "message": "Zero Downtime for Flow HS"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "5f7cb5e2a2e2fa8ef31c53526c06132a2f8bdf74", "author": {"user": {"login": "timofei-durakov", "name": "Timofey Durakov"}}, "url": "https://github.com/telstra/open-kilda/commit/5f7cb5e2a2e2fa8ef31c53526c06132a2f8bdf74", "committedDate": "2020-12-08T07:27:44Z", "message": "Zero Downtime for Flow HS"}, "afterCommit": {"oid": "025cf527da525e72e7a2978ec774fee74f862448", "author": {"user": {"login": "timofei-durakov", "name": "Timofey Durakov"}}, "url": "https://github.com/telstra/open-kilda/commit/025cf527da525e72e7a2978ec774fee74f862448", "committedDate": "2020-12-09T11:52:50Z", "message": "Zero Downtime for Flow HS"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "025cf527da525e72e7a2978ec774fee74f862448", "author": {"user": {"login": "timofei-durakov", "name": "Timofey Durakov"}}, "url": "https://github.com/telstra/open-kilda/commit/025cf527da525e72e7a2978ec774fee74f862448", "committedDate": "2020-12-09T11:52:50Z", "message": "Zero Downtime for Flow HS"}, "afterCommit": {"oid": "01768de1a135aa7e988e8df5a1bfc719d9e26987", "author": {"user": {"login": "timofei-durakov", "name": "Timofey Durakov"}}, "url": "https://github.com/telstra/open-kilda/commit/01768de1a135aa7e988e8df5a1bfc719d9e26987", "committedDate": "2020-12-11T15:12:38Z", "message": "Zero Downtime for Flow HS"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "01768de1a135aa7e988e8df5a1bfc719d9e26987", "author": {"user": {"login": "timofei-durakov", "name": "Timofey Durakov"}}, "url": "https://github.com/telstra/open-kilda/commit/01768de1a135aa7e988e8df5a1bfc719d9e26987", "committedDate": "2020-12-11T15:12:38Z", "message": "Zero Downtime for Flow HS"}, "afterCommit": {"oid": "139bf506ae184d2217fbe8384e42f13e23716331", "author": {"user": {"login": "timofei-durakov", "name": "Timofey Durakov"}}, "url": "https://github.com/telstra/open-kilda/commit/139bf506ae184d2217fbe8384e42f13e23716331", "committedDate": "2020-12-17T12:41:40Z", "message": "Zero Downtime for Flow HS"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "139bf506ae184d2217fbe8384e42f13e23716331", "author": {"user": {"login": "timofei-durakov", "name": "Timofey Durakov"}}, "url": "https://github.com/telstra/open-kilda/commit/139bf506ae184d2217fbe8384e42f13e23716331", "committedDate": "2020-12-17T12:41:40Z", "message": "Zero Downtime for Flow HS"}, "afterCommit": {"oid": "8e82a1feeee041cc723102de3af21863c265252d", "author": {"user": {"login": "timofei-durakov", "name": "Timofey Durakov"}}, "url": "https://github.com/telstra/open-kilda/commit/8e82a1feeee041cc723102de3af21863c265252d", "committedDate": "2020-12-21T19:47:13Z", "message": "Zero Downtime for Flow HS"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "8e82a1feeee041cc723102de3af21863c265252d", "author": {"user": {"login": "timofei-durakov", "name": "Timofey Durakov"}}, "url": "https://github.com/telstra/open-kilda/commit/8e82a1feeee041cc723102de3af21863c265252d", "committedDate": "2020-12-21T19:47:13Z", "message": "Zero Downtime for Flow HS"}, "afterCommit": {"oid": "dc1185319bb40bffbeac3dfa06057460585539fe", "author": {"user": {"login": "timofei-durakov", "name": "Timofey Durakov"}}, "url": "https://github.com/telstra/open-kilda/commit/dc1185319bb40bffbeac3dfa06057460585539fe", "committedDate": "2020-12-23T06:39:17Z", "message": "Zero Downtime for Flow HS"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "dc1185319bb40bffbeac3dfa06057460585539fe", "author": {"user": {"login": "timofei-durakov", "name": "Timofey Durakov"}}, "url": "https://github.com/telstra/open-kilda/commit/dc1185319bb40bffbeac3dfa06057460585539fe", "committedDate": "2020-12-23T06:39:17Z", "message": "Zero Downtime for Flow HS"}, "afterCommit": {"oid": "cdb05a45e77a89cb0d3edabb10fa726d3a16c058", "author": {"user": {"login": "timofei-durakov", "name": "Timofey Durakov"}}, "url": "https://github.com/telstra/open-kilda/commit/cdb05a45e77a89cb0d3edabb10fa726d3a16c058", "committedDate": "2020-12-28T10:56:40Z", "message": "Zero Downtime for Flow HS"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "cdb05a45e77a89cb0d3edabb10fa726d3a16c058", "author": {"user": {"login": "timofei-durakov", "name": "Timofey Durakov"}}, "url": "https://github.com/telstra/open-kilda/commit/cdb05a45e77a89cb0d3edabb10fa726d3a16c058", "committedDate": "2020-12-28T10:56:40Z", "message": "Zero Downtime for Flow HS"}, "afterCommit": {"oid": "adbedbf4f67dbaa1b7781d1f950383ce721bb657", "author": {"user": {"login": "timofei-durakov", "name": "Timofey Durakov"}}, "url": "https://github.com/telstra/open-kilda/commit/adbedbf4f67dbaa1b7781d1f950383ce721bb657", "committedDate": "2021-01-14T14:19:19Z", "message": "Zero Downtime for Flow HS"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "adbedbf4f67dbaa1b7781d1f950383ce721bb657", "author": {"user": {"login": "timofei-durakov", "name": "Timofey Durakov"}}, "url": "https://github.com/telstra/open-kilda/commit/adbedbf4f67dbaa1b7781d1f950383ce721bb657", "committedDate": "2021-01-14T14:19:19Z", "message": "Zero Downtime for Flow HS"}, "afterCommit": {"oid": "b66a2babaad03f8247988ac7167bd82bebddb60f", "author": {"user": {"login": "timofei-durakov", "name": "Timofey Durakov"}}, "url": "https://github.com/telstra/open-kilda/commit/b66a2babaad03f8247988ac7167bd82bebddb60f", "committedDate": "2021-01-14T19:19:31Z", "message": "Zero Downtime for Flow HS"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "b66a2babaad03f8247988ac7167bd82bebddb60f", "author": {"user": {"login": "timofei-durakov", "name": "Timofey Durakov"}}, "url": "https://github.com/telstra/open-kilda/commit/b66a2babaad03f8247988ac7167bd82bebddb60f", "committedDate": "2021-01-14T19:19:31Z", "message": "Zero Downtime for Flow HS"}, "afterCommit": {"oid": "cfcd80450d93e3c68ee9392a13040c5d5317f3cf", "author": {"user": {"login": "timofei-durakov", "name": "Timofey Durakov"}}, "url": "https://github.com/telstra/open-kilda/commit/cfcd80450d93e3c68ee9392a13040c5d5317f3cf", "committedDate": "2021-01-25T08:09:22Z", "message": "Zero Downtime for Flow HS"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "cfcd80450d93e3c68ee9392a13040c5d5317f3cf", "author": {"user": {"login": "timofei-durakov", "name": "Timofey Durakov"}}, "url": "https://github.com/telstra/open-kilda/commit/cfcd80450d93e3c68ee9392a13040c5d5317f3cf", "committedDate": "2021-01-25T08:09:22Z", "message": "Zero Downtime for Flow HS"}, "afterCommit": {"oid": "3b4ee858d91ad628702e8cec6afc6252d6da7fe2", "author": {"user": {"login": "timofei-durakov", "name": "Timofey Durakov"}}, "url": "https://github.com/telstra/open-kilda/commit/3b4ee858d91ad628702e8cec6afc6252d6da7fe2", "committedDate": "2021-01-27T08:18:49Z", "message": "Zero Downtime for Flow HS"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "3b4ee858d91ad628702e8cec6afc6252d6da7fe2", "author": {"user": {"login": "timofei-durakov", "name": "Timofey Durakov"}}, "url": "https://github.com/telstra/open-kilda/commit/3b4ee858d91ad628702e8cec6afc6252d6da7fe2", "committedDate": "2021-01-27T08:18:49Z", "message": "Zero Downtime for Flow HS"}, "afterCommit": {"oid": "77fd5014fa6d34e8c16c5ee24e75b21a51ae44c4", "author": {"user": {"login": "timofei-durakov", "name": "Timofey Durakov"}}, "url": "https://github.com/telstra/open-kilda/commit/77fd5014fa6d34e8c16c5ee24e75b21a51ae44c4", "committedDate": "2021-01-29T06:08:07Z", "message": "Zero Downtime for Flow HS"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTc5OTUzMTg0", "url": "https://github.com/telstra/open-kilda/pull/3888#pullrequestreview-579953184", "createdAt": "2021-02-01T00:18:17Z", "commit": {"oid": "77fd5014fa6d34e8c16c5ee24e75b21a51ae44c4"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMi0wMVQwMDoxODoxN1rOIdN-pA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMi0wMVQwMDoxODoxN1rOIdN-pA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU2NzUwODY0NA==", "bodyText": "Why not move this logic up to the abstract topology?", "url": "https://github.com/telstra/open-kilda/pull/3888#discussion_r567508644", "createdAt": "2021-02-01T00:18:17Z", "author": {"login": "sergii-iakovenko"}, "path": "src-java/flowhs-topology/flowhs-storm-topology/src/main/java/org/openkilda/wfm/topology/flowhs/FlowHsTopology.java", "diffHunk": "@@ -105,17 +108,41 @@ public StormTopology createTopology() {\n \n         history(tb, persistenceManager);\n \n+        zkSpout(tb);\n+        zkBolt(tb);\n+\n         return tb.createTopology();\n     }\n \n+    private void zkSpout(TopologyBuilder topologyBuilder) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "77fd5014fa6d34e8c16c5ee24e75b21a51ae44c4"}, "originalPosition": 20}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTgwMjg2MjY4", "url": "https://github.com/telstra/open-kilda/pull/3888#pullrequestreview-580286268", "createdAt": "2021-02-01T12:05:34Z", "commit": {"oid": "77fd5014fa6d34e8c16c5ee24e75b21a51ae44c4"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "77fd5014fa6d34e8c16c5ee24e75b21a51ae44c4", "author": {"user": {"login": "timofei-durakov", "name": "Timofey Durakov"}}, "url": "https://github.com/telstra/open-kilda/commit/77fd5014fa6d34e8c16c5ee24e75b21a51ae44c4", "committedDate": "2021-01-29T06:08:07Z", "message": "Zero Downtime for Flow HS"}, "afterCommit": {"oid": "d8e8bde5018f5743eaa44c0aca596d1b3c7fa61b", "author": {"user": {"login": "timofei-durakov", "name": "Timofey Durakov"}}, "url": "https://github.com/telstra/open-kilda/commit/d8e8bde5018f5743eaa44c0aca596d1b3c7fa61b", "committedDate": "2021-02-03T13:03:31Z", "message": "Zero Downtime for Flow HS"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "41b492754dcac9a42d8f82e51d74f696ca081cca", "author": {"user": {"login": "timofei-durakov", "name": "Timofey Durakov"}}, "url": "https://github.com/telstra/open-kilda/commit/41b492754dcac9a42d8f82e51d74f696ca081cca", "committedDate": "2021-02-04T16:16:26Z", "message": "Zero Downtime for Flow HS"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "d8e8bde5018f5743eaa44c0aca596d1b3c7fa61b", "author": {"user": {"login": "timofei-durakov", "name": "Timofey Durakov"}}, "url": "https://github.com/telstra/open-kilda/commit/d8e8bde5018f5743eaa44c0aca596d1b3c7fa61b", "committedDate": "2021-02-03T13:03:31Z", "message": "Zero Downtime for Flow HS"}, "afterCommit": {"oid": "41b492754dcac9a42d8f82e51d74f696ca081cca", "author": {"user": {"login": "timofei-durakov", "name": "Timofey Durakov"}}, "url": "https://github.com/telstra/open-kilda/commit/41b492754dcac9a42d8f82e51d74f696ca081cca", "committedDate": "2021-02-04T16:16:26Z", "message": "Zero Downtime for Flow HS"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTg0MTUyMTE1", "url": "https://github.com/telstra/open-kilda/pull/3888#pullrequestreview-584152115", "createdAt": "2021-02-05T09:17:49Z", "commit": {"oid": "41b492754dcac9a42d8f82e51d74f696ca081cca"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3780, "cost": 1, "resetAt": "2021-11-02T12:20:56Z"}}}