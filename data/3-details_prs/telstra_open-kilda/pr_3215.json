{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0Mzc2MjM1ODkw", "number": 3215, "title": "Allow flowhs speaker request retry for all error codes", "bodyText": "Flow H&S create operation use separate set of tools to perform speaker\nrequest retries. It allow to retry only for SWITCH_UNAVAILABE error.\nOther CRUD operation do retry on any error code. Rework create operation\nto mimic speaker retry logic of all other CRUD operations.", "createdAt": "2020-02-17T16:53:54Z", "url": "https://github.com/telstra/open-kilda/pull/3215", "merged": true, "mergeCommit": {"oid": "c312b943d28d0009db8bebfbefb684da56cab3a2"}, "closed": true, "closedAt": "2020-05-18T12:57:40Z", "author": {"login": "surabujin"}, "timelineItems": {"totalCount": 6, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcKD8OGgBqjMwOTI2MTYxMTk=", "endCursor": "Y3Vyc29yOnYyOpPPAAABche7JEABqjMzNDAxOTI0NTg=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "816d49fb4c5a70617a9eacebc3b906258ad2883b", "author": {"user": {"login": "surabujin", "name": "Dmitriy Bogun"}}, "url": "https://github.com/telstra/open-kilda/commit/816d49fb4c5a70617a9eacebc3b906258ad2883b", "committedDate": "2020-02-17T16:29:01Z", "message": "Allow flowhs speaker request retry for all error codes\n\nFlow H&S create operation use separate set of tools to perform speaker\nrequest retries. It allow to retry only for SWITCH_UNAVAILABE error.\nOther CRUD operation do retry on any error code. Rework create operation\nto mimic speaker retry logic of all other CRUD operations."}, "afterCommit": {"oid": "4a13555f121aa1493f3ae7a565aa3c0458bf8241", "author": {"user": {"login": "surabujin", "name": "Dmitriy Bogun"}}, "url": "https://github.com/telstra/open-kilda/commit/4a13555f121aa1493f3ae7a565aa3c0458bf8241", "committedDate": "2020-03-03T15:20:32Z", "message": "Allow flowhs speaker request retry for all error codes\n\nFlow H&S create operation use separate set of tools to perform speaker\nrequest retries. It allow to retry only for SWITCH_UNAVAILABE error.\nOther CRUD operation do retry on any error code. Rework create operation\nto mimic speaker retry logic of all other CRUD operations."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzcwNDMxOTEz", "url": "https://github.com/telstra/open-kilda/pull/3215#pullrequestreview-370431913", "createdAt": "2020-03-06T15:59:02Z", "commit": {"oid": "4a13555f121aa1493f3ae7a565aa3c0458bf8241"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzkwMTQ0ODI2", "url": "https://github.com/telstra/open-kilda/pull/3215#pullrequestreview-390144826", "createdAt": "2020-04-08T16:37:50Z", "commit": {"oid": "4a13555f121aa1493f3ae7a565aa3c0458bf8241"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wOFQxNjozNzo1MVrOGC3kbg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wOFQxNjozNzo1MVrOGC3kbg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNTY2MDc4Mg==", "bodyText": "nit: It's the only constructor, why not just assign the field?", "url": "https://github.com/telstra/open-kilda/pull/3215#discussion_r405660782", "createdAt": "2020-04-08T16:37:51Z", "author": {"login": "sergii-iakovenko"}, "path": "src-java/flowhs-topology/flowhs-storm-topology/src/main/java/org/openkilda/wfm/topology/flowhs/fsm/common/SpeakerCommandFsm.java", "diffHunk": "@@ -30,20 +29,28 @@\n import org.squirrelframework.foundation.fsm.StateMachineBuilder;\n import org.squirrelframework.foundation.fsm.StateMachineBuilderFactory;\n \n+import java.util.HashSet;\n+import java.util.Set;\n+\n @Slf4j\n @Getter\n public final class SpeakerCommandFsm\n         extends WithCommandContextFsm<SpeakerCommandFsm, State, Event, SpeakerFlowSegmentResponse> {\n \n     private final FlowSegmentRequest request;\n     private final FlowCreateHubCarrier carrier;\n+    private final Set<ErrorCode> giveUpErrors = new HashSet<>();\n+    private final int allowedRetriesCount;\n     private int remainingRetries;\n \n-    private SpeakerCommandFsm(FlowSegmentRequest request, FlowCreateHubCarrier carrier, Integer retriesLimit) {\n+    private SpeakerCommandFsm(\n+            FlowSegmentRequest request, FlowCreateHubCarrier carrier, Set<ErrorCode> giveUpErrors,\n+            Integer retriesLimit) {\n         super(new CommandContext(request.getMessageContext().getCorrelationId()));\n         this.request = request;\n         this.carrier = carrier;\n-        this.remainingRetries = retriesLimit;\n+        this.giveUpErrors.addAll(giveUpErrors);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "4a13555f121aa1493f3ae7a565aa3c0458bf8241"}, "originalPosition": 39}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzkwMTQ3OTk0", "url": "https://github.com/telstra/open-kilda/pull/3215#pullrequestreview-390147994", "createdAt": "2020-04-08T16:42:03Z", "commit": {"oid": "4a13555f121aa1493f3ae7a565aa3c0458bf8241"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "4a73e09df6ee364860f910e19f3ed6e5d69c618b", "author": {"user": {"login": "surabujin", "name": "Dmitriy Bogun"}}, "url": "https://github.com/telstra/open-kilda/commit/4a73e09df6ee364860f910e19f3ed6e5d69c618b", "committedDate": "2020-05-15T09:47:06Z", "message": "Allow flowhs speaker request retry for all error codes\n\nFlow H&S create operation use separate set of tools to perform speaker\nrequest retries. It allow to retry only for SWITCH_UNAVAILABE error.\nOther CRUD operation do retry on any error code. Rework create operation\nto mimic speaker retry logic of all other CRUD operations."}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "4a13555f121aa1493f3ae7a565aa3c0458bf8241", "author": {"user": {"login": "surabujin", "name": "Dmitriy Bogun"}}, "url": "https://github.com/telstra/open-kilda/commit/4a13555f121aa1493f3ae7a565aa3c0458bf8241", "committedDate": "2020-03-03T15:20:32Z", "message": "Allow flowhs speaker request retry for all error codes\n\nFlow H&S create operation use separate set of tools to perform speaker\nrequest retries. It allow to retry only for SWITCH_UNAVAILABE error.\nOther CRUD operation do retry on any error code. Rework create operation\nto mimic speaker retry logic of all other CRUD operations."}, "afterCommit": {"oid": "4a73e09df6ee364860f910e19f3ed6e5d69c618b", "author": {"user": {"login": "surabujin", "name": "Dmitriy Bogun"}}, "url": "https://github.com/telstra/open-kilda/commit/4a73e09df6ee364860f910e19f3ed6e5d69c618b", "committedDate": "2020-05-15T09:47:06Z", "message": "Allow flowhs speaker request retry for all error codes\n\nFlow H&S create operation use separate set of tools to perform speaker\nrequest retries. It allow to retry only for SWITCH_UNAVAILABE error.\nOther CRUD operation do retry on any error code. Rework create operation\nto mimic speaker retry logic of all other CRUD operations."}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3716, "cost": 1, "resetAt": "2021-11-02T12:20:56Z"}}}