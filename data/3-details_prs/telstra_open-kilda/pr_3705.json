{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDc2Mjc5ODM2", "number": 3705, "title": "Add design for flow loop feature", "bodyText": "", "createdAt": "2020-08-31T12:54:48Z", "url": "https://github.com/telstra/open-kilda/pull/3705", "merged": true, "mergeCommit": {"oid": "465c520675ec282f0a821032061ae24c2b82631b"}, "closed": true, "closedAt": "2020-09-24T18:19:52Z", "author": {"login": "rozdy"}, "timelineItems": {"totalCount": 14, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdE7215ABqjM3MTk3ODYxNDI=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdMBCv5ABqjM4MDMxNzQ4MjM=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "4c1839c8aee5b073562ae0eac991db201f438a2f", "author": {"user": {"login": "rozdy", "name": "Ievgen Rozdymakha"}}, "url": "https://github.com/telstra/open-kilda/commit/4c1839c8aee5b073562ae0eac991db201f438a2f", "committedDate": "2020-08-31T12:51:58Z", "message": "Add design for flow loop feature"}, "afterCommit": {"oid": "94d58890ca7f5ed8032112389f7e3631de4aa0ff", "author": {"user": {"login": "rozdy", "name": "Ievgen Rozdymakha"}}, "url": "https://github.com/telstra/open-kilda/commit/94d58890ca7f5ed8032112389f7e3631de4aa0ff", "committedDate": "2020-09-02T13:16:59Z", "message": "Add design for flow loop feature"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDgxNTgyNTE0", "url": "https://github.com/telstra/open-kilda/pull/3705#pullrequestreview-481582514", "createdAt": "2020-09-03T07:50:30Z", "commit": {"oid": "94d58890ca7f5ed8032112389f7e3631de4aa0ff"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wM1QwNzo1MDozMFrOHMabcQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wM1QwNzo1MDozMFrOHMabcQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4Mjc3Nzk2OQ==", "bodyText": "if one switch flows are supported, you need at least port to this api, also, consider one-switch one-port flows as well, maybe it's worth having vlan_vid too", "url": "https://github.com/telstra/open-kilda/pull/3705#discussion_r482777969", "createdAt": "2020-09-03T07:50:30Z", "author": {"login": "timofei-durakov"}, "path": "docs/design/flow-loop/flow-loop.md", "diffHunk": "@@ -0,0 +1,44 @@\n+# Flow loop feature\n+\n+## Overview\n+\n+Flow loop feature designed for flow path testing. Loop provides additional flow rules on one of the terminating switch so any flow traffic is returned to switch-port where it was received. \n+Such flow has `looped=true` flag and support all flow operations. When loop removed system should restore original flow rules.\n+\n+![Flow-loop](flow-loop.png \"Flow loop\")\n+\n+## API\n+\n+* Get existing flow loops `GET /v2/flows/loop` with optional params `flow_id` and `switch_id`. Response example:\n+\n+~~~\n+[ \n+    {\n+        \"switch_id\": \"00:00:11:22:33:44:55:66\",\n+        \"flow_id\": \"string\"", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "94d58890ca7f5ed8032112389f7e3631de4aa0ff"}, "originalPosition": 18}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDgxNTgzMjM1", "url": "https://github.com/telstra/open-kilda/pull/3705#pullrequestreview-481583235", "createdAt": "2020-09-03T07:51:21Z", "commit": {"oid": "94d58890ca7f5ed8032112389f7e3631de4aa0ff"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wM1QwNzo1MToyMVrOHMadmw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wM1QwNzo1MToyMVrOHMadmw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4Mjc3ODUyMw==", "bodyText": "where you going to store this flag from db perspective, please describe", "url": "https://github.com/telstra/open-kilda/pull/3705#discussion_r482778523", "createdAt": "2020-09-03T07:51:21Z", "author": {"login": "timofei-durakov"}, "path": "docs/design/flow-loop/flow-loop.md", "diffHunk": "@@ -0,0 +1,44 @@\n+# Flow loop feature\n+\n+## Overview\n+\n+Flow loop feature designed for flow path testing. Loop provides additional flow rules on one of the terminating switch so any flow traffic is returned to switch-port where it was received. \n+Such flow has `looped=true` flag and support all flow operations. When loop removed system should restore original flow rules.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "94d58890ca7f5ed8032112389f7e3631de4aa0ff"}, "originalPosition": 6}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDgxNTgzNTU4", "url": "https://github.com/telstra/open-kilda/pull/3705#pullrequestreview-481583558", "createdAt": "2020-09-03T07:51:47Z", "commit": {"oid": "94d58890ca7f5ed8032112389f7e3631de4aa0ff"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDgxNTg1ODM4", "url": "https://github.com/telstra/open-kilda/pull/3705#pullrequestreview-481585838", "createdAt": "2020-09-03T07:54:48Z", "commit": {"oid": "94d58890ca7f5ed8032112389f7e3631de4aa0ff"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wM1QwNzo1NDo0OFrOHMalyw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wM1QwNzo1NDo0OFrOHMalyw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4Mjc4MDYxOQ==", "bodyText": "it may affect our sync/validate for the rules, since the diff could be invisible for validation procedure", "url": "https://github.com/telstra/open-kilda/pull/3705#discussion_r482780619", "createdAt": "2020-09-03T07:54:48Z", "author": {"login": "timofei-durakov"}, "path": "docs/design/flow-loop/flow-loop.md", "diffHunk": "@@ -0,0 +1,44 @@\n+# Flow loop feature\n+\n+## Overview\n+\n+Flow loop feature designed for flow path testing. Loop provides additional flow rules on one of the terminating switch so any flow traffic is returned to switch-port where it was received. \n+Such flow has `looped=true` flag and support all flow operations. When loop removed system should restore original flow rules.\n+\n+![Flow-loop](flow-loop.png \"Flow loop\")\n+\n+## API\n+\n+* Get existing flow loops `GET /v2/flows/loop` with optional params `flow_id` and `switch_id`. Response example:\n+\n+~~~\n+[ \n+    {\n+        \"switch_id\": \"00:00:11:22:33:44:55:66\",\n+        \"flow_id\": \"string\"\n+    },\n+...\n+]\n+~~~\n+\n+* Create flow loop on chosen switch `POST /v2/flows/loop/{flow_id}/{switch_id}`. Flow may have only one loop.\n+\n+* Delete flow loop and restore regular flow rules `DELETE /v2/flows/loop/{flow_id}/{switch_id}`. \n+\n+## Details\n+\n+From persistence perspective flow loop stored as a relation from flow to switch with type `looped on`.\n+\n+Flow loop create and delete operations implemented using H&S approach as a separate hubs in `flow-hs` topology. All H&S flow operations use single point of rule generation based on flow parameters. In current implementation it is `SpeakerFlowSegmentRequestBuilder` class. It should be modified to support flow loop flag and reused in flow loop operations.\n+\n+Additional loop rules has the same cookie as all other flow rules but higher priority. Only these rules are installed or deleted during flow loop operations.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "94d58890ca7f5ed8032112389f7e3631de4aa0ff"}, "originalPosition": 34}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "94d58890ca7f5ed8032112389f7e3631de4aa0ff", "author": {"user": {"login": "rozdy", "name": "Ievgen Rozdymakha"}}, "url": "https://github.com/telstra/open-kilda/commit/94d58890ca7f5ed8032112389f7e3631de4aa0ff", "committedDate": "2020-09-02T13:16:59Z", "message": "Add design for flow loop feature"}, "afterCommit": {"oid": "3034b7a91a01b34e861aa32fc4ae344b06b8a0db", "author": {"user": {"login": "rozdy", "name": "Ievgen Rozdymakha"}}, "url": "https://github.com/telstra/open-kilda/commit/3034b7a91a01b34e861aa32fc4ae344b06b8a0db", "committedDate": "2020-09-03T09:35:41Z", "message": "Add design for flow loop feature"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "3034b7a91a01b34e861aa32fc4ae344b06b8a0db", "author": {"user": {"login": "rozdy", "name": "Ievgen Rozdymakha"}}, "url": "https://github.com/telstra/open-kilda/commit/3034b7a91a01b34e861aa32fc4ae344b06b8a0db", "committedDate": "2020-09-03T09:35:41Z", "message": "Add design for flow loop feature"}, "afterCommit": {"oid": "40aaa05b58319ab597effa5a0540798570f0e336", "author": {"user": {"login": "rozdy", "name": "Ievgen Rozdymakha"}}, "url": "https://github.com/telstra/open-kilda/commit/40aaa05b58319ab597effa5a0540798570f0e336", "committedDate": "2020-09-03T12:45:34Z", "message": "Add design for flow loop feature"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "40aaa05b58319ab597effa5a0540798570f0e336", "author": {"user": {"login": "rozdy", "name": "Ievgen Rozdymakha"}}, "url": "https://github.com/telstra/open-kilda/commit/40aaa05b58319ab597effa5a0540798570f0e336", "committedDate": "2020-09-03T12:45:34Z", "message": "Add design for flow loop feature"}, "afterCommit": {"oid": "e262ebbdae517a1339afe6b0ac6c5121bbf40b7a", "author": {"user": {"login": "rozdy", "name": "Ievgen Rozdymakha"}}, "url": "https://github.com/telstra/open-kilda/commit/e262ebbdae517a1339afe6b0ac6c5121bbf40b7a", "committedDate": "2020-09-04T15:43:13Z", "message": "Add design for flow loop feature"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "e262ebbdae517a1339afe6b0ac6c5121bbf40b7a", "author": {"user": {"login": "rozdy", "name": "Ievgen Rozdymakha"}}, "url": "https://github.com/telstra/open-kilda/commit/e262ebbdae517a1339afe6b0ac6c5121bbf40b7a", "committedDate": "2020-09-04T15:43:13Z", "message": "Add design for flow loop feature"}, "afterCommit": {"oid": "29811c2d04860a9435e0e90e2ddd9e0243a6e042", "author": {"user": {"login": "rozdy", "name": "Ievgen Rozdymakha"}}, "url": "https://github.com/telstra/open-kilda/commit/29811c2d04860a9435e0e90e2ddd9e0243a6e042", "committedDate": "2020-09-04T15:44:38Z", "message": "Add design for flow loop feature"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDg1MDgxMjY2", "url": "https://github.com/telstra/open-kilda/pull/3705#pullrequestreview-485081266", "createdAt": "2020-09-09T14:40:15Z", "commit": {"oid": "29811c2d04860a9435e0e90e2ddd9e0243a6e042"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDg1OTk4ODk2", "url": "https://github.com/telstra/open-kilda/pull/3705#pullrequestreview-485998896", "createdAt": "2020-09-10T14:31:42Z", "commit": {"oid": "29811c2d04860a9435e0e90e2ddd9e0243a6e042"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "29811c2d04860a9435e0e90e2ddd9e0243a6e042", "author": {"user": {"login": "rozdy", "name": "Ievgen Rozdymakha"}}, "url": "https://github.com/telstra/open-kilda/commit/29811c2d04860a9435e0e90e2ddd9e0243a6e042", "committedDate": "2020-09-04T15:44:38Z", "message": "Add design for flow loop feature"}, "afterCommit": {"oid": "96679d721e5e51ca5a6f45428949657c1b6ab516", "author": {"user": {"login": "rozdy", "name": "Ievgen Rozdymakha"}}, "url": "https://github.com/telstra/open-kilda/commit/96679d721e5e51ca5a6f45428949657c1b6ab516", "committedDate": "2020-09-11T11:52:51Z", "message": "Add design for flow loop feature"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "cdf3861cea1e86684047301f1084b790030a0cc1", "author": {"user": {"login": "rozdy", "name": "Ievgen Rozdymakha"}}, "url": "https://github.com/telstra/open-kilda/commit/cdf3861cea1e86684047301f1084b790030a0cc1", "committedDate": "2020-09-24T12:58:42Z", "message": "Add design for flow loop feature"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "96679d721e5e51ca5a6f45428949657c1b6ab516", "author": {"user": {"login": "rozdy", "name": "Ievgen Rozdymakha"}}, "url": "https://github.com/telstra/open-kilda/commit/96679d721e5e51ca5a6f45428949657c1b6ab516", "committedDate": "2020-09-11T11:52:51Z", "message": "Add design for flow loop feature"}, "afterCommit": {"oid": "cdf3861cea1e86684047301f1084b790030a0cc1", "author": {"user": {"login": "rozdy", "name": "Ievgen Rozdymakha"}}, "url": "https://github.com/telstra/open-kilda/commit/cdf3861cea1e86684047301f1084b790030a0cc1", "committedDate": "2020-09-24T12:58:42Z", "message": "Add design for flow loop feature"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3559, "cost": 1, "resetAt": "2021-11-02T12:20:56Z"}}}