{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0Mzk0NzM1OTcz", "number": 3340, "title": "add tests for grpc stats in opentsdb", "bodyText": "", "createdAt": "2020-03-27T12:51:23Z", "url": "https://github.com/telstra/open-kilda/pull/3340", "merged": true, "mergeCommit": {"oid": "b2edb14301127a4a2ea217f1c603df2f812c6ae1"}, "closed": true, "closedAt": "2020-04-07T11:20:45Z", "author": {"login": "andriidovhan"}, "timelineItems": {"totalCount": 6, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcSr0hIABqjMxNzc5MjA0MzI=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcT_5dAgBqjMxOTYxNTAzMDI=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "e1069e39bc510330f15f3d5ac706dc8c9642e1de", "author": {"user": {"login": "andriidovhan", "name": "AndriiDovhan"}}, "url": "https://github.com/telstra/open-kilda/commit/e1069e39bc510330f15f3d5ac706dc8c9642e1de", "committedDate": "2020-03-27T12:49:59Z", "message": "add tests for grpc stats in opentsdb"}, "afterCommit": {"oid": "ea7fb13e5aeae3581df3700188f004b7174e6811", "author": {"user": {"login": "andriidovhan", "name": "AndriiDovhan"}}, "url": "https://github.com/telstra/open-kilda/commit/ea7fb13e5aeae3581df3700188f004b7174e6811", "committedDate": "2020-03-30T10:19:38Z", "message": "add tests for grpc stats in opentsdb"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzgzNzE4NDI2", "url": "https://github.com/telstra/open-kilda/pull/3340#pullrequestreview-383718426", "createdAt": "2020-03-30T10:22:04Z", "commit": {"oid": "ea7fb13e5aeae3581df3700188f004b7174e6811"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzg1NDc5MjA3", "url": "https://github.com/telstra/open-kilda/pull/3340#pullrequestreview-385479207", "createdAt": "2020-04-01T11:02:03Z", "commit": {"oid": "ea7fb13e5aeae3581df3700188f004b7174e6811"}, "state": "COMMENTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wMVQxMTowMjowM1rOF-7jGQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wMVQxMTowMjo1NFrOF-7kwg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMTUzMTY3Mw==", "bodyText": "you can search for it.manufacturer == \"Noviflow Inc.\" if you want noviflow switches. Also, I think it makes sense to pick it.hardware + it.software for uniqueness, since we can have same hw model but with different firmware and most likely would like to test them both", "url": "https://github.com/telstra/open-kilda/pull/3340#discussion_r401531673", "createdAt": "2020-04-01T11:02:03Z", "author": {"login": "rtretyak"}, "path": "src-java/testing/functional-tests/src/test/groovy/org/openkilda/functionaltests/spec/stats/OpenTsdbSpec.groovy", "diffHunk": "@@ -57,7 +57,29 @@ class OpenTsdbSpec extends HealthCheckSpecification {\n                  [[cookieHex: String.format(\"0x%X\", DefaultRule.VERIFICATION_BROADCAST_RULE.cookie)]]].combinations())\n     }\n \n+    @Unroll(\"GRPC stats are being logged for metric:#metric, tags:#tags\")\n+    @Tags([HARDWARE, SMOKE_SWITCHES])\n+    def \"GRPC stats are being logged\"(metric, tags) {\n+        expect: \"At least 1 result in the past 10 minutes\"\n+        otsdb.query(10.minutes.ago, metricPrefix + metric, tags).dps.size() > 0\n+\n+        where:\n+        [metric, tags] << (\n+                [[\"switch.packet-in.total-packets\", \"switch.packet-in.total-packets.dataplane\",\n+                  \"switch.packet-in.no-match.packets\", \"switch.packet-in.apply-action.packets\",\n+                  \"switch.packet-in.apply-action.packets\", \"switch.packet-in.invalid-ttl.packets\",\n+                  \"switch.packet-in.action-set.packets\", \"switch.packet-in.group.packets\",\n+                  \"switch.packet-in.packet-out.packets\", \"switch.packet-out.total-packets.dataplane\",\n+                  \"switch.packet-out.total-packets.host\", \"switch.packet-out.eth0-interface-up\"],\n+                 noviflowSwitches.collect { [switchid: it.switchId.toOtsdFormat()] }].combinations()\n+        )\n+    }\n+\n     def getUniqueSwitches() {\n         topology.activeSwitches.unique { it.ofVersion }\n     }\n+\n+    def getNoviflowSwitches() {\n+        northbound.activeSwitches.findAll { it.description =~ /NW[0-9]+.([0-9].[0-9])/ }.unique { it.hardware }", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ea7fb13e5aeae3581df3700188f004b7174e6811"}, "originalPosition": 27}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMTUzMjA5OA==", "bodyText": "Can be Tidy", "url": "https://github.com/telstra/open-kilda/pull/3340#discussion_r401532098", "createdAt": "2020-04-01T11:02:54Z", "author": {"login": "rtretyak"}, "path": "src-java/testing/functional-tests/src/test/groovy/org/openkilda/functionaltests/spec/stats/OpenTsdbSpec.groovy", "diffHunk": "@@ -57,7 +57,29 @@ class OpenTsdbSpec extends HealthCheckSpecification {\n                  [[cookieHex: String.format(\"0x%X\", DefaultRule.VERIFICATION_BROADCAST_RULE.cookie)]]].combinations())\n     }\n \n+    @Unroll(\"GRPC stats are being logged for metric:#metric, tags:#tags\")\n+    @Tags([HARDWARE, SMOKE_SWITCHES])", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ea7fb13e5aeae3581df3700188f004b7174e6811"}, "originalPosition": 5}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "ea7fb13e5aeae3581df3700188f004b7174e6811", "author": {"user": {"login": "andriidovhan", "name": "AndriiDovhan"}}, "url": "https://github.com/telstra/open-kilda/commit/ea7fb13e5aeae3581df3700188f004b7174e6811", "committedDate": "2020-03-30T10:19:38Z", "message": "add tests for grpc stats in opentsdb"}, "afterCommit": {"oid": "13746311aa9110af0bd5da9d2eeca1509f1a657a", "author": {"user": {"login": "andriidovhan", "name": "AndriiDovhan"}}, "url": "https://github.com/telstra/open-kilda/commit/13746311aa9110af0bd5da9d2eeca1509f1a657a", "committedDate": "2020-04-03T08:36:02Z", "message": "add tests for grpc stats in opentsdb"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f52d0f2b04e89e596c691ce8754070de696f2bdc", "author": {"user": {"login": "andriidovhan", "name": "AndriiDovhan"}}, "url": "https://github.com/telstra/open-kilda/commit/f52d0f2b04e89e596c691ce8754070de696f2bdc", "committedDate": "2020-04-03T12:16:51Z", "message": "add tests for grpc stats in opentsdb"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "13746311aa9110af0bd5da9d2eeca1509f1a657a", "author": {"user": {"login": "andriidovhan", "name": "AndriiDovhan"}}, "url": "https://github.com/telstra/open-kilda/commit/13746311aa9110af0bd5da9d2eeca1509f1a657a", "committedDate": "2020-04-03T08:36:02Z", "message": "add tests for grpc stats in opentsdb"}, "afterCommit": {"oid": "f52d0f2b04e89e596c691ce8754070de696f2bdc", "author": {"user": {"login": "andriidovhan", "name": "AndriiDovhan"}}, "url": "https://github.com/telstra/open-kilda/commit/f52d0f2b04e89e596c691ce8754070de696f2bdc", "committedDate": "2020-04-03T12:16:51Z", "message": "add tests for grpc stats in opentsdb"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3680, "cost": 1, "resetAt": "2021-11-02T12:20:56Z"}}}