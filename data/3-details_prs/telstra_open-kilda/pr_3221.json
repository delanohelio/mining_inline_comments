{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0Mzc3MDc4NTUy", "number": 3221, "title": "improve MultitableFlowsSpec", "bodyText": "Close: #3218", "createdAt": "2020-02-19T10:14:20Z", "url": "https://github.com/telstra/open-kilda/pull/3221", "merged": true, "mergeCommit": {"oid": "4de764ec2d2c4e10fd7531905977089844a1f6da"}, "closed": true, "closedAt": "2020-03-02T16:40:03Z", "author": {"login": "andriidovhan"}, "timelineItems": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcF0ma-ABqjMwNTEyOTY4MjA=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcGe_8AgFqTM2MjU5OTkzMA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "f54d6ce3202db6dec6de7e04fd52ab8837f88bbe", "author": {"user": {"login": "andriidovhan", "name": "AndriiDovhan"}}, "url": "https://github.com/telstra/open-kilda/commit/f54d6ce3202db6dec6de7e04fd52ab8837f88bbe", "committedDate": "2020-02-19T10:12:07Z", "message": "improve MultitableFlowsSpec"}, "afterCommit": {"oid": "cc311e71198b81a8e7f5488f8f998960185763ba", "author": {"user": {"login": "andriidovhan", "name": "AndriiDovhan"}}, "url": "https://github.com/telstra/open-kilda/commit/cc311e71198b81a8e7f5488f8f998960185763ba", "committedDate": "2020-02-19T11:12:20Z", "message": "improve MultitableFlowsSpec"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzYyNTEzMjQ1", "url": "https://github.com/telstra/open-kilda/pull/3221#pullrequestreview-362513245", "createdAt": "2020-02-21T09:53:32Z", "commit": {"oid": "cc311e71198b81a8e7f5488f8f998960185763ba"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yMVQwOTo1MzozM1rOFsxYKQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yMVQwOTo1MzozM1rOFsxYKQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MjQ5MDY2NQ==", "bodyText": "I don't really follow how desired path is connected with this line. So all paths may have a protected path available, but there are no guarantees that the picked desiredPath will have a suitable protected path", "url": "https://github.com/telstra/open-kilda/pull/3221#discussion_r382490665", "createdAt": "2020-02-21T09:53:33Z", "author": {"login": "rtretyak"}, "path": "src-java/testing/functional-tests/src/test/groovy/org/openkilda/functionaltests/spec/multitable/MultitableFlowsSpec.groovy", "diffHunk": "@@ -365,11 +365,12 @@ mode with existing flows and hold flows of different table-mode types\"() {\n         List<PathNode> desiredPath = null\n         List<Switch> involvedSwitches = null\n         def switchPair = topologyHelper.allNotNeighboringSwitchPairs.collectMany { [it, it.reversed] }.find { pair ->\n-            desiredPath = pair.paths.find { path ->\n-                involvedSwitches = pathHelper.getInvolvedSwitches(path)\n-                involvedSwitches.size() == 3 &&\n-                        involvedSwitches.every { it.features.contains(SwitchFeature.MULTI_TABLE) }\n+            def allPaths = pair.paths.findAll { path ->\n+                pathHelper.getInvolvedSwitches(path).every { it.features.contains(SwitchFeature.MULTI_TABLE) }\n             }\n+            desiredPath = allPaths.find { pathHelper.getInvolvedSwitches(it).size() == 3 }\n+            // make sure that alternative path for protected path is available\n+            allPaths.unique(false) { a, b -> a.intersect(b) == [] ? 1 : 0 }.size() >= 2", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "cc311e71198b81a8e7f5488f8f998960185763ba"}, "originalPosition": 13}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "0da871e5b812e7a778f4f62125133a40d96999db", "author": {"user": {"login": "andriidovhan", "name": "AndriiDovhan"}}, "url": "https://github.com/telstra/open-kilda/commit/0da871e5b812e7a778f4f62125133a40d96999db", "committedDate": "2020-02-21T12:33:48Z", "message": "improve MultitableFlowsSpec"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "cc311e71198b81a8e7f5488f8f998960185763ba", "author": {"user": {"login": "andriidovhan", "name": "AndriiDovhan"}}, "url": "https://github.com/telstra/open-kilda/commit/cc311e71198b81a8e7f5488f8f998960185763ba", "committedDate": "2020-02-19T11:12:20Z", "message": "improve MultitableFlowsSpec"}, "afterCommit": {"oid": "0da871e5b812e7a778f4f62125133a40d96999db", "author": {"user": {"login": "andriidovhan", "name": "AndriiDovhan"}}, "url": "https://github.com/telstra/open-kilda/commit/0da871e5b812e7a778f4f62125133a40d96999db", "committedDate": "2020-02-21T12:33:48Z", "message": "improve MultitableFlowsSpec"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzYyNTk5OTMw", "url": "https://github.com/telstra/open-kilda/pull/3221#pullrequestreview-362599930", "createdAt": "2020-02-21T12:36:37Z", "commit": {"oid": "0da871e5b812e7a778f4f62125133a40d96999db"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3719, "cost": 1, "resetAt": "2021-11-02T12:20:56Z"}}}