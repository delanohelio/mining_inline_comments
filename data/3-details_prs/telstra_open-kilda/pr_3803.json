{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTA5MjA5NzIx", "number": 3803, "title": "Introduce fine tuning for storm topologies", "bodyText": "The changes:\n\nIntroduce per topology config file, utilize Storm Flux for it.\nGenerate topology definitions by confd templates.", "createdAt": "2020-10-23T20:48:00Z", "url": "https://github.com/telstra/open-kilda/pull/3803", "merged": true, "mergeCommit": {"oid": "26c0c21cd9670c50bedb4e206b8dc32bf2ebf89f"}, "closed": true, "closedAt": "2020-12-09T21:36:46Z", "author": {"login": "sergii-iakovenko"}, "timelineItems": {"totalCount": 15, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdVeZzjgBqjM5MTU5NjM1NDI=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdkjkhugBqjQwOTE1MjQwNDI=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "00f2a6dbdb1faab953f9fb99567193363c447108", "author": {"user": {"login": "sergii-iakovenko", "name": "Sergii Iakovenko"}}, "url": "https://github.com/telstra/open-kilda/commit/00f2a6dbdb1faab953f9fb99567193363c447108", "committedDate": "2020-10-23T20:41:54Z", "message": "PoC for fine tuning storm topologies: introduce per topology config file, utilize Storm Flux for it."}, "afterCommit": {"oid": "137dbcb053f7bce15210f9c7bef1958eb6d5e474", "author": {"user": {"login": "sergii-iakovenko", "name": "Sergii Iakovenko"}}, "url": "https://github.com/telstra/open-kilda/commit/137dbcb053f7bce15210f9c7bef1958eb6d5e474", "committedDate": "2020-10-23T22:34:48Z", "message": "PoC for fine tuning storm topologies: introduce per topology config file, utilize Storm Flux for it."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTE4NjgzNzY0", "url": "https://github.com/telstra/open-kilda/pull/3803#pullrequestreview-518683764", "createdAt": "2020-10-28T13:53:28Z", "commit": {"oid": "137dbcb053f7bce15210f9c7bef1958eb6d5e474"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "137dbcb053f7bce15210f9c7bef1958eb6d5e474", "author": {"user": {"login": "sergii-iakovenko", "name": "Sergii Iakovenko"}}, "url": "https://github.com/telstra/open-kilda/commit/137dbcb053f7bce15210f9c7bef1958eb6d5e474", "committedDate": "2020-10-23T22:34:48Z", "message": "PoC for fine tuning storm topologies: introduce per topology config file, utilize Storm Flux for it."}, "afterCommit": {"oid": "e0ba7bfd0829e6397eecdf441e57566819a4500a", "author": {"user": {"login": "sergii-iakovenko", "name": "Sergii Iakovenko"}}, "url": "https://github.com/telstra/open-kilda/commit/e0ba7bfd0829e6397eecdf441e57566819a4500a", "committedDate": "2020-11-05T14:51:37Z", "message": "PoC for fine tuning storm topologies: introduce per topology config file, utilize Storm Flux for it."}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "e0ba7bfd0829e6397eecdf441e57566819a4500a", "author": {"user": {"login": "sergii-iakovenko", "name": "Sergii Iakovenko"}}, "url": "https://github.com/telstra/open-kilda/commit/e0ba7bfd0829e6397eecdf441e57566819a4500a", "committedDate": "2020-11-05T14:51:37Z", "message": "PoC for fine tuning storm topologies: introduce per topology config file, utilize Storm Flux for it."}, "afterCommit": {"oid": "31e0378dc4b7344cc6279eaa3b843f63619a5555", "author": {"user": {"login": "sergii-iakovenko", "name": "Sergii Iakovenko"}}, "url": "https://github.com/telstra/open-kilda/commit/31e0378dc4b7344cc6279eaa3b843f63619a5555", "committedDate": "2020-11-05T23:28:53Z", "message": "PoC for fine tuning storm topologies: introduce per topology config file, utilize Storm Flux for it."}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "cc1957332fd758cc497514a682e9771264aa65d0", "author": {"user": {"login": "sergii-iakovenko", "name": "Sergii Iakovenko"}}, "url": "https://github.com/telstra/open-kilda/commit/cc1957332fd758cc497514a682e9771264aa65d0", "committedDate": "2020-11-08T12:11:40Z", "message": "Attempt to stabilize opentsdb unit tests."}, "afterCommit": {"oid": "8ef4f1223329a592a5eda1c540bcfaf958bef056", "author": {"user": {"login": "sergii-iakovenko", "name": "Sergii Iakovenko"}}, "url": "https://github.com/telstra/open-kilda/commit/8ef4f1223329a592a5eda1c540bcfaf958bef056", "committedDate": "2020-11-09T12:58:45Z", "message": "PoC for fine tuning storm topologies: introduce per topology config file, utilize Storm Flux for it."}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "8ef4f1223329a592a5eda1c540bcfaf958bef056", "author": {"user": {"login": "sergii-iakovenko", "name": "Sergii Iakovenko"}}, "url": "https://github.com/telstra/open-kilda/commit/8ef4f1223329a592a5eda1c540bcfaf958bef056", "committedDate": "2020-11-09T12:58:45Z", "message": "PoC for fine tuning storm topologies: introduce per topology config file, utilize Storm Flux for it."}, "afterCommit": {"oid": "8d9f0506736f13343ca812c1463b6c549ac29703", "author": {"user": {"login": "sergii-iakovenko", "name": "Sergii Iakovenko"}}, "url": "https://github.com/telstra/open-kilda/commit/8d9f0506736f13343ca812c1463b6c549ac29703", "committedDate": "2020-11-10T07:55:14Z", "message": "PoC for fine tuning storm topologies: introduce per topology config file, utilize Storm Flux for it."}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "8d9f0506736f13343ca812c1463b6c549ac29703", "author": {"user": {"login": "sergii-iakovenko", "name": "Sergii Iakovenko"}}, "url": "https://github.com/telstra/open-kilda/commit/8d9f0506736f13343ca812c1463b6c549ac29703", "committedDate": "2020-11-10T07:55:14Z", "message": "PoC for fine tuning storm topologies: introduce per topology config file, utilize Storm Flux for it."}, "afterCommit": {"oid": "e0fbba25885f5e2ac88c76c35233053a304d4431", "author": {"user": {"login": "sergii-iakovenko", "name": "Sergii Iakovenko"}}, "url": "https://github.com/telstra/open-kilda/commit/e0fbba25885f5e2ac88c76c35233053a304d4431", "committedDate": "2020-11-10T08:17:42Z", "message": "PoC for fine tuning storm topologies: introduce per topology config file, utilize Storm Flux for it."}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "e0fbba25885f5e2ac88c76c35233053a304d4431", "author": {"user": {"login": "sergii-iakovenko", "name": "Sergii Iakovenko"}}, "url": "https://github.com/telstra/open-kilda/commit/e0fbba25885f5e2ac88c76c35233053a304d4431", "committedDate": "2020-11-10T08:17:42Z", "message": "PoC for fine tuning storm topologies: introduce per topology config file, utilize Storm Flux for it."}, "afterCommit": {"oid": "ec9348750bfdf0a6ed73b799cac435f49b780d9b", "author": {"user": {"login": "sergii-iakovenko", "name": "Sergii Iakovenko"}}, "url": "https://github.com/telstra/open-kilda/commit/ec9348750bfdf0a6ed73b799cac435f49b780d9b", "committedDate": "2020-11-10T08:28:46Z", "message": "PoC for fine tuning storm topologies: introduce per topology config file, utilize Storm Flux for it."}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "ec9348750bfdf0a6ed73b799cac435f49b780d9b", "author": {"user": {"login": "sergii-iakovenko", "name": "Sergii Iakovenko"}}, "url": "https://github.com/telstra/open-kilda/commit/ec9348750bfdf0a6ed73b799cac435f49b780d9b", "committedDate": "2020-11-10T08:28:46Z", "message": "PoC for fine tuning storm topologies: introduce per topology config file, utilize Storm Flux for it."}, "afterCommit": {"oid": "0614c809a75e4530153bf445775799b7c6e39a64", "author": {"user": {"login": "sergii-iakovenko", "name": "Sergii Iakovenko"}}, "url": "https://github.com/telstra/open-kilda/commit/0614c809a75e4530153bf445775799b7c6e39a64", "committedDate": "2020-11-10T19:54:22Z", "message": "Attempt to fix opentsdb-topology unit tests"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "0614c809a75e4530153bf445775799b7c6e39a64", "author": {"user": {"login": "sergii-iakovenko", "name": "Sergii Iakovenko"}}, "url": "https://github.com/telstra/open-kilda/commit/0614c809a75e4530153bf445775799b7c6e39a64", "committedDate": "2020-11-10T19:54:22Z", "message": "Attempt to fix opentsdb-topology unit tests"}, "afterCommit": {"oid": "2672e241e677aa4d9842fa520137fa4c6bc73c99", "author": {"user": {"login": "sergii-iakovenko", "name": "Sergii Iakovenko"}}, "url": "https://github.com/telstra/open-kilda/commit/2672e241e677aa4d9842fa520137fa4c6bc73c99", "committedDate": "2020-11-11T02:37:49Z", "message": "PoC for fine tuning storm topologies: introduce per topology config file, utilize Storm Flux for it."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTQ3NDE5Njcw", "url": "https://github.com/telstra/open-kilda/pull/3803#pullrequestreview-547419670", "createdAt": "2020-12-08T16:42:55Z", "commit": {"oid": "2672e241e677aa4d9842fa520137fa4c6bc73c99"}, "state": "APPROVED", "comments": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0wOFQxNjo0Mjo1NVrOIBoiYQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0wOFQxODoyMDowOVrOIBu9_A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzODU4MzY0OQ==", "bodyText": "As for me kafkaConfig.getHosts() is ... weird enough.", "url": "https://github.com/telstra/open-kilda/pull/3803#discussion_r538583649", "createdAt": "2020-12-08T16:42:55Z", "author": {"login": "surabujin"}, "path": "src-java/base-topology/base-storm-topology/src/main/java/org/openkilda/wfm/topology/AbstractTopology.java", "diffHunk": "@@ -99,12 +111,36 @@ protected AbstractTopology(LaunchEnvironment env, Class<T> topologyConfigClass)\n         kafkaConfig = configurationProvider.getConfiguration(KafkaConfig.class);\n \n         logger.debug(\"Topology built {}: kafka={}, parallelism={}, workers={}\",\n-                topologyName, kafkaConfig.getHosts(), topologyConfig.getParallelism(),\n-                topologyConfig.getWorkers());\n+                topologyName, kafkaConfig.getHosts(), getTopologyParallelism(), getTopologyWorkers());", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "2672e241e677aa4d9842fa520137fa4c6bc73c99"}, "originalPosition": 53}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzODU4ODY0OA==", "bodyText": "looks like we buildin this yamls inside .jar. In this case I don't see any reason to generate them with confd, we should put \"raw\" yaml files into the resources folder. The only reason to keep confd generated configs - the ability to change configuration option without recompile project. If we can't change it without recompilation, we can get rid from confd layer.", "url": "https://github.com/telstra/open-kilda/pull/3803#discussion_r538588648", "createdAt": "2020-12-08T16:47:22Z", "author": {"login": "surabujin"}, "path": "src-java/base-topology/base-storm-topology/src/main/java/org/openkilda/wfm/topology/AbstractTopology.java", "diffHunk": "@@ -99,12 +111,36 @@ protected AbstractTopology(LaunchEnvironment env, Class<T> topologyConfigClass)\n         kafkaConfig = configurationProvider.getConfiguration(KafkaConfig.class);\n \n         logger.debug(\"Topology built {}: kafka={}, parallelism={}, workers={}\",\n-                topologyName, kafkaConfig.getHosts(), topologyConfig.getParallelism(),\n-                topologyConfig.getWorkers());\n+                topologyName, kafkaConfig.getHosts(), getTopologyParallelism(), getTopologyWorkers());\n     }\n \n-    protected String getDefaultTopologyName() {\n-        return getClass().getSimpleName().toLowerCase();\n+    private Optional<TopologyDef> loadTopologyDef(String topologyDefinitionName, Properties properties) {\n+        try {\n+            // Check the definition in resources for existence.\n+            String yamlResource = format(\"/%s.yaml\", topologyDefinitionName);\n+            if (FluxParser.class.getResourceAsStream(yamlResource) == null) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "2672e241e677aa4d9842fa520137fa4c6bc73c99"}, "originalPosition": 62}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzODY4MDA5Nw==", "bodyText": "I would like to not have these *-topology.yaml.exmapl files. There are too many of them. We have issues with supporting ... much lover count of example config for existing components. We will fail to support these examples.", "url": "https://github.com/telstra/open-kilda/pull/3803#discussion_r538680097", "createdAt": "2020-12-08T18:11:30Z", "author": {"login": "surabujin"}, "path": "src-java/connecteddevices-topology/connecteddevices-storm-topology/src/main/resources/connecteddevices-topology.yaml.example", "diffHunk": "@@ -0,0 +1,16 @@\n+# topology configuration", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "2672e241e677aa4d9842fa520137fa4c6bc73c99"}, "originalPosition": 1}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzODY4OTAyMA==", "bodyText": "Is it an intentional change?", "url": "https://github.com/telstra/open-kilda/pull/3803#discussion_r538689020", "createdAt": "2020-12-08T18:20:09Z", "author": {"login": "surabujin"}, "path": "src-java/gradle/wrapper/gradle-wrapper.properties", "diffHunk": "@@ -1,5 +1,5 @@\n distributionBase=GRADLE_USER_HOME\n distributionPath=wrapper/dists\n-distributionUrl=https\\://services.gradle.org/distributions/gradle-6.1.1-bin.zip\n+distributionUrl=https\\://services.gradle.org/distributions/gradle-6.7-bin.zip", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "2672e241e677aa4d9842fa520137fa4c6bc73c99"}, "originalPosition": 4}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTQ4MDQzMzIx", "url": "https://github.com/telstra/open-kilda/pull/3803#pullrequestreview-548043321", "createdAt": "2020-12-09T10:30:11Z", "commit": {"oid": "2672e241e677aa4d9842fa520137fa4c6bc73c99"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTQ4MDk4Nzkz", "url": "https://github.com/telstra/open-kilda/pull/3803#pullrequestreview-548098793", "createdAt": "2020-12-09T11:41:54Z", "commit": {"oid": "2672e241e677aa4d9842fa520137fa4c6bc73c99"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "8bcab2dac61004a852f362245caf96626de65db9", "author": {"user": {"login": "sergii-iakovenko", "name": "Sergii Iakovenko"}}, "url": "https://github.com/telstra/open-kilda/commit/8bcab2dac61004a852f362245caf96626de65db9", "committedDate": "2020-12-09T19:03:52Z", "message": "PoC for fine tuning storm topologies: introduce per topology config file, utilize Storm Flux for it."}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "2672e241e677aa4d9842fa520137fa4c6bc73c99", "author": {"user": {"login": "sergii-iakovenko", "name": "Sergii Iakovenko"}}, "url": "https://github.com/telstra/open-kilda/commit/2672e241e677aa4d9842fa520137fa4c6bc73c99", "committedDate": "2020-11-11T02:37:49Z", "message": "PoC for fine tuning storm topologies: introduce per topology config file, utilize Storm Flux for it."}, "afterCommit": {"oid": "8bcab2dac61004a852f362245caf96626de65db9", "author": {"user": {"login": "sergii-iakovenko", "name": "Sergii Iakovenko"}}, "url": "https://github.com/telstra/open-kilda/commit/8bcab2dac61004a852f362245caf96626de65db9", "committedDate": "2020-12-09T19:03:52Z", "message": "PoC for fine tuning storm topologies: introduce per topology config file, utilize Storm Flux for it."}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3749, "cost": 1, "resetAt": "2021-11-02T12:20:56Z"}}}