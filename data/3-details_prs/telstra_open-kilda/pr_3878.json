{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTI4NTYxMjM0", "number": 3878, "title": "Fix flow loops for single switch flows", "bodyText": "Related to #3846\nMERGE NOTE: please merge after this one #3873", "createdAt": "2020-11-27T11:34:10Z", "url": "https://github.com/telstra/open-kilda/pull/3878", "merged": true, "mergeCommit": {"oid": "271a3b1884ec0927987786fab3de0b2b304c7e05"}, "closed": true, "closedAt": "2020-12-07T09:10:48Z", "author": {"login": "rozdy"}, "timelineItems": {"totalCount": 11, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdgmwpCAFqTUzOTk0NjEzMQ==", "endCursor": "Y3Vyc29yOnYyOpPPAAABdi2s78gBqjQwNzI0MjQzMDE=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTM5OTQ2MTMx", "url": "https://github.com/telstra/open-kilda/pull/3878#pullrequestreview-539946131", "createdAt": "2020-11-27T12:32:20Z", "commit": {"oid": "cc8019dc7a2586992b1094b32a3015f8337a2798"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTQxMTg2MzI5", "url": "https://github.com/telstra/open-kilda/pull/3878#pullrequestreview-541186329", "createdAt": "2020-11-30T18:36:23Z", "commit": {"oid": "cc8019dc7a2586992b1094b32a3015f8337a2798"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "cc8019dc7a2586992b1094b32a3015f8337a2798", "author": {"user": {"login": "rozdy", "name": "Ievgen Rozdymakha"}}, "url": "https://github.com/telstra/open-kilda/commit/cc8019dc7a2586992b1094b32a3015f8337a2798", "committedDate": "2020-11-26T21:33:37Z", "message": "Fix flow loops for single switch flows"}, "afterCommit": {"oid": "f620c2d72cd23825b57ea25ff46962d1a1662fc7", "author": {"user": {"login": "rozdy", "name": "Ievgen Rozdymakha"}}, "url": "https://github.com/telstra/open-kilda/commit/f620c2d72cd23825b57ea25ff46962d1a1662fc7", "committedDate": "2020-12-01T08:29:32Z", "message": "Fix flow loops for single switch flows"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "f620c2d72cd23825b57ea25ff46962d1a1662fc7", "author": {"user": {"login": "rozdy", "name": "Ievgen Rozdymakha"}}, "url": "https://github.com/telstra/open-kilda/commit/f620c2d72cd23825b57ea25ff46962d1a1662fc7", "committedDate": "2020-12-01T08:29:32Z", "message": "Fix flow loops for single switch flows"}, "afterCommit": {"oid": "3d913a1950b348e8895cb115e3474cd14e77db67", "author": {"user": {"login": "rozdy", "name": "Ievgen Rozdymakha"}}, "url": "https://github.com/telstra/open-kilda/commit/3d913a1950b348e8895cb115e3474cd14e77db67", "committedDate": "2020-12-01T08:45:53Z", "message": "Fix flow loops for single switch flows"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "3d913a1950b348e8895cb115e3474cd14e77db67", "author": {"user": {"login": "rozdy", "name": "Ievgen Rozdymakha"}}, "url": "https://github.com/telstra/open-kilda/commit/3d913a1950b348e8895cb115e3474cd14e77db67", "committedDate": "2020-12-01T08:45:53Z", "message": "Fix flow loops for single switch flows"}, "afterCommit": {"oid": "50188b0da85883ef7a622a4b33a0ce9f67226573", "author": {"user": {"login": "rozdy", "name": "Ievgen Rozdymakha"}}, "url": "https://github.com/telstra/open-kilda/commit/50188b0da85883ef7a622a4b33a0ce9f67226573", "committedDate": "2020-12-01T11:45:29Z", "message": "Fix flow loops for single switch flows"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTQ0MTQ1ODEx", "url": "https://github.com/telstra/open-kilda/pull/3878#pullrequestreview-544145811", "createdAt": "2020-12-03T16:31:32Z", "commit": {"oid": "50188b0da85883ef7a622a4b33a0ce9f67226573"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0wM1QxNjozMTozMlrOH-le9Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0wM1QxNjozMjo1OVrOH-ljUw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNTM4Nzg5Mw==", "bodyText": "why null? why not empty list?", "url": "https://github.com/telstra/open-kilda/pull/3878#discussion_r535387893", "createdAt": "2020-12-03T16:31:32Z", "author": {"login": "niksv"}, "path": "src-java/floodlight-service/floodlight-modules/src/main/java/org/openkilda/floodlight/command/flow/ingress/of/IngressFlowLoopInstallMultiTableFlowModFactory.java", "diffHunk": "@@ -15,18 +15,41 @@\n \n package org.openkilda.floodlight.command.flow.ingress.of;\n \n-import org.openkilda.floodlight.command.flow.ingress.IngressFlowSegmentCommand;\n+import org.openkilda.floodlight.command.flow.ingress.IngressFlowSegmentBase;\n import org.openkilda.floodlight.switchmanager.SwitchManager;\n import org.openkilda.floodlight.utils.OfFlowModAddMultiTableMessageBuilderFactory;\n import org.openkilda.model.SwitchFeature;\n \n import net.floodlightcontroller.core.IOFSwitch;\n+import org.projectfloodlight.openflow.protocol.action.OFAction;\n+import org.projectfloodlight.openflow.protocol.instruction.OFInstruction;\n \n+import java.util.List;\n import java.util.Set;\n \n-public class IngressFlowLoopInstallMultiTableFlowModFactory extends IngressFlowSegmentInstallFlowModFactory {\n+public class IngressFlowLoopInstallMultiTableFlowModFactory extends IngressInstallFlowModFactory {\n     public IngressFlowLoopInstallMultiTableFlowModFactory(\n-            IngressFlowSegmentCommand command, IOFSwitch sw, Set<SwitchFeature> features) {\n+            IngressFlowSegmentBase command, IOFSwitch sw, Set<SwitchFeature> features) {\n         super(new OfFlowModAddMultiTableMessageBuilderFactory(SwitchManager.FLOW_LOOP_PRIORITY), command, sw, features);\n     }\n+\n+    @Override\n+    protected List<OFAction> makeServer42IngressFlowTransformActions(List<Integer> vlanStack) {\n+        return null;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "50188b0da85883ef7a622a4b33a0ce9f67226573"}, "originalPosition": 27}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNTM4ODAwMA==", "bodyText": "same", "url": "https://github.com/telstra/open-kilda/pull/3878#discussion_r535388000", "createdAt": "2020-12-03T16:31:40Z", "author": {"login": "niksv"}, "path": "src-java/floodlight-service/floodlight-modules/src/main/java/org/openkilda/floodlight/command/flow/ingress/of/IngressFlowLoopInstallMultiTableFlowModFactory.java", "diffHunk": "@@ -15,18 +15,41 @@\n \n package org.openkilda.floodlight.command.flow.ingress.of;\n \n-import org.openkilda.floodlight.command.flow.ingress.IngressFlowSegmentCommand;\n+import org.openkilda.floodlight.command.flow.ingress.IngressFlowSegmentBase;\n import org.openkilda.floodlight.switchmanager.SwitchManager;\n import org.openkilda.floodlight.utils.OfFlowModAddMultiTableMessageBuilderFactory;\n import org.openkilda.model.SwitchFeature;\n \n import net.floodlightcontroller.core.IOFSwitch;\n+import org.projectfloodlight.openflow.protocol.action.OFAction;\n+import org.projectfloodlight.openflow.protocol.instruction.OFInstruction;\n \n+import java.util.List;\n import java.util.Set;\n \n-public class IngressFlowLoopInstallMultiTableFlowModFactory extends IngressFlowSegmentInstallFlowModFactory {\n+public class IngressFlowLoopInstallMultiTableFlowModFactory extends IngressInstallFlowModFactory {\n     public IngressFlowLoopInstallMultiTableFlowModFactory(\n-            IngressFlowSegmentCommand command, IOFSwitch sw, Set<SwitchFeature> features) {\n+            IngressFlowSegmentBase command, IOFSwitch sw, Set<SwitchFeature> features) {\n         super(new OfFlowModAddMultiTableMessageBuilderFactory(SwitchManager.FLOW_LOOP_PRIORITY), command, sw, features);\n     }\n+\n+    @Override\n+    protected List<OFAction> makeServer42IngressFlowTransformActions(List<Integer> vlanStack) {\n+        return null;\n+    }\n+\n+    @Override\n+    protected List<OFAction> makeTransformActions(List<Integer> vlanStack) {\n+        return null;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "50188b0da85883ef7a622a4b33a0ce9f67226573"}, "originalPosition": 32}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNTM4ODA4Mw==", "bodyText": "why null? why not empty list?", "url": "https://github.com/telstra/open-kilda/pull/3878#discussion_r535388083", "createdAt": "2020-12-03T16:31:46Z", "author": {"login": "niksv"}, "path": "src-java/floodlight-service/floodlight-modules/src/main/java/org/openkilda/floodlight/command/flow/ingress/of/IngressFlowLoopInstallMultiTableFlowModFactory.java", "diffHunk": "@@ -15,18 +15,41 @@\n \n package org.openkilda.floodlight.command.flow.ingress.of;\n \n-import org.openkilda.floodlight.command.flow.ingress.IngressFlowSegmentCommand;\n+import org.openkilda.floodlight.command.flow.ingress.IngressFlowSegmentBase;\n import org.openkilda.floodlight.switchmanager.SwitchManager;\n import org.openkilda.floodlight.utils.OfFlowModAddMultiTableMessageBuilderFactory;\n import org.openkilda.model.SwitchFeature;\n \n import net.floodlightcontroller.core.IOFSwitch;\n+import org.projectfloodlight.openflow.protocol.action.OFAction;\n+import org.projectfloodlight.openflow.protocol.instruction.OFInstruction;\n \n+import java.util.List;\n import java.util.Set;\n \n-public class IngressFlowLoopInstallMultiTableFlowModFactory extends IngressFlowSegmentInstallFlowModFactory {\n+public class IngressFlowLoopInstallMultiTableFlowModFactory extends IngressInstallFlowModFactory {\n     public IngressFlowLoopInstallMultiTableFlowModFactory(\n-            IngressFlowSegmentCommand command, IOFSwitch sw, Set<SwitchFeature> features) {\n+            IngressFlowSegmentBase command, IOFSwitch sw, Set<SwitchFeature> features) {\n         super(new OfFlowModAddMultiTableMessageBuilderFactory(SwitchManager.FLOW_LOOP_PRIORITY), command, sw, features);\n     }\n+\n+    @Override\n+    protected List<OFAction> makeServer42IngressFlowTransformActions(List<Integer> vlanStack) {\n+        return null;\n+    }\n+\n+    @Override\n+    protected List<OFAction> makeTransformActions(List<Integer> vlanStack) {\n+        return null;\n+    }\n+\n+    @Override\n+    protected List<OFInstruction> makeMetadataInstructions() {\n+        return null;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "50188b0da85883ef7a622a4b33a0ce9f67226573"}, "originalPosition": 37}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNTM4OTAxMQ==", "bodyText": "As I see this method used as\napplyActions.add(makeOutputAction());\nWill we add null to the list?", "url": "https://github.com/telstra/open-kilda/pull/3878#discussion_r535389011", "createdAt": "2020-12-03T16:32:59Z", "author": {"login": "niksv"}, "path": "src-java/floodlight-service/floodlight-modules/src/main/java/org/openkilda/floodlight/command/flow/ingress/of/IngressFlowLoopInstallMultiTableFlowModFactory.java", "diffHunk": "@@ -15,18 +15,41 @@\n \n package org.openkilda.floodlight.command.flow.ingress.of;\n \n-import org.openkilda.floodlight.command.flow.ingress.IngressFlowSegmentCommand;\n+import org.openkilda.floodlight.command.flow.ingress.IngressFlowSegmentBase;\n import org.openkilda.floodlight.switchmanager.SwitchManager;\n import org.openkilda.floodlight.utils.OfFlowModAddMultiTableMessageBuilderFactory;\n import org.openkilda.model.SwitchFeature;\n \n import net.floodlightcontroller.core.IOFSwitch;\n+import org.projectfloodlight.openflow.protocol.action.OFAction;\n+import org.projectfloodlight.openflow.protocol.instruction.OFInstruction;\n \n+import java.util.List;\n import java.util.Set;\n \n-public class IngressFlowLoopInstallMultiTableFlowModFactory extends IngressFlowSegmentInstallFlowModFactory {\n+public class IngressFlowLoopInstallMultiTableFlowModFactory extends IngressInstallFlowModFactory {\n     public IngressFlowLoopInstallMultiTableFlowModFactory(\n-            IngressFlowSegmentCommand command, IOFSwitch sw, Set<SwitchFeature> features) {\n+            IngressFlowSegmentBase command, IOFSwitch sw, Set<SwitchFeature> features) {\n         super(new OfFlowModAddMultiTableMessageBuilderFactory(SwitchManager.FLOW_LOOP_PRIORITY), command, sw, features);\n     }\n+\n+    @Override\n+    protected List<OFAction> makeServer42IngressFlowTransformActions(List<Integer> vlanStack) {\n+        return null;\n+    }\n+\n+    @Override\n+    protected List<OFAction> makeTransformActions(List<Integer> vlanStack) {\n+        return null;\n+    }\n+\n+    @Override\n+    protected List<OFInstruction> makeMetadataInstructions() {\n+        return null;\n+    }\n+\n+    @Override\n+    protected OFAction makeOutputAction() {\n+        return null;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "50188b0da85883ef7a622a4b33a0ce9f67226573"}, "originalPosition": 42}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "50188b0da85883ef7a622a4b33a0ce9f67226573", "author": {"user": {"login": "rozdy", "name": "Ievgen Rozdymakha"}}, "url": "https://github.com/telstra/open-kilda/commit/50188b0da85883ef7a622a4b33a0ce9f67226573", "committedDate": "2020-12-01T11:45:29Z", "message": "Fix flow loops for single switch flows"}, "afterCommit": {"oid": "31f1e57efd93a5e1ffc6c3f15cd54393ae9ba0ca", "author": {"user": {"login": "rozdy", "name": "Ievgen Rozdymakha"}}, "url": "https://github.com/telstra/open-kilda/commit/31f1e57efd93a5e1ffc6c3f15cd54393ae9ba0ca", "committedDate": "2020-12-03T17:11:47Z", "message": "Fix flow loops for single switch flows"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTQ0NjkxMjA0", "url": "https://github.com/telstra/open-kilda/pull/3878#pullrequestreview-544691204", "createdAt": "2020-12-04T06:40:28Z", "commit": {"oid": "31f1e57efd93a5e1ffc6c3f15cd54393ae9ba0ca"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTQ0NjkxNzcx", "url": "https://github.com/telstra/open-kilda/pull/3878#pullrequestreview-544691771", "createdAt": "2020-12-04T06:41:56Z", "commit": {"oid": "31f1e57efd93a5e1ffc6c3f15cd54393ae9ba0ca"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0wNFQwNjo0MTo1NlrOH_C_Ig==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0wNFQwNjo0MTo1NlrOH_C_Ig==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNTg3MTI2Ng==", "bodyText": "should these 4 methods throw unsupported exceptions too?", "url": "https://github.com/telstra/open-kilda/pull/3878#discussion_r535871266", "createdAt": "2020-12-04T06:41:56Z", "author": {"login": "niksv"}, "path": "src-java/floodlight-service/floodlight-modules/src/main/java/org/openkilda/floodlight/command/flow/ingress/of/IngressFlowLoopFlowModFactory.java", "diffHunk": "@@ -0,0 +1,59 @@\n+/* Copyright 2019 Telstra Open Source\n+ *\n+ *   Licensed under the Apache License, Version 2.0 (the \"License\");\n+ *   you may not use this file except in compliance with the License.\n+ *   You may obtain a copy of the License at\n+ *\n+ *       http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ *   Unless required by applicable law or agreed to in writing, software\n+ *   distributed under the License is distributed on an \"AS IS\" BASIS,\n+ *   WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ *   See the License for the specific language governing permissions and\n+ *   limitations under the License.\n+ */\n+\n+package org.openkilda.floodlight.command.flow.ingress.of;\n+\n+import org.openkilda.floodlight.command.flow.ingress.IngressFlowLoopCommand;\n+import org.openkilda.floodlight.utils.OfFlowModBuilderFactory;\n+import org.openkilda.model.SwitchFeature;\n+\n+import net.floodlightcontroller.core.IOFSwitch;\n+import org.projectfloodlight.openflow.protocol.action.OFAction;\n+import org.projectfloodlight.openflow.protocol.instruction.OFInstruction;\n+\n+import java.util.Collections;\n+import java.util.List;\n+import java.util.Set;\n+\n+abstract class IngressFlowLoopFlowModFactory extends IngressInstallFlowModFactory {\n+    private final IngressFlowLoopCommand command;\n+\n+    public IngressFlowLoopFlowModFactory(\n+            OfFlowModBuilderFactory flowModBuilderFactory, IngressFlowLoopCommand command, IOFSwitch sw,\n+            Set<SwitchFeature> features) {\n+        super(flowModBuilderFactory, command, sw, features);\n+        this.command = command;\n+    }\n+\n+    @Override\n+    protected List<OFAction> makeTransformActions(List<Integer> vlanStack) {\n+        return Collections.emptyList();\n+    }\n+\n+    @Override\n+    protected List<OFAction> makeServer42IngressFlowTransformActions(List<Integer> vlanStack) {\n+        return Collections.emptyList();\n+    }\n+\n+    @Override\n+    protected OFAction makeOutputAction() {\n+        return null;\n+    }\n+\n+    @Override\n+    protected List<OFInstruction> makeMetadataInstructions() {\n+        return Collections.emptyList();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "31f1e57efd93a5e1ffc6c3f15cd54393ae9ba0ca"}, "originalPosition": 57}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "9e00d4fb18ca6512c2fa7c9f8169ba58b6e19096", "author": {"user": {"login": "rozdy", "name": "Ievgen Rozdymakha"}}, "url": "https://github.com/telstra/open-kilda/commit/9e00d4fb18ca6512c2fa7c9f8169ba58b6e19096", "committedDate": "2020-12-04T12:14:23Z", "message": "Fix flow loops for single switch flows"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "31f1e57efd93a5e1ffc6c3f15cd54393ae9ba0ca", "author": {"user": {"login": "rozdy", "name": "Ievgen Rozdymakha"}}, "url": "https://github.com/telstra/open-kilda/commit/31f1e57efd93a5e1ffc6c3f15cd54393ae9ba0ca", "committedDate": "2020-12-03T17:11:47Z", "message": "Fix flow loops for single switch flows"}, "afterCommit": {"oid": "9e00d4fb18ca6512c2fa7c9f8169ba58b6e19096", "author": {"user": {"login": "rozdy", "name": "Ievgen Rozdymakha"}}, "url": "https://github.com/telstra/open-kilda/commit/9e00d4fb18ca6512c2fa7c9f8169ba58b6e19096", "committedDate": "2020-12-04T12:14:23Z", "message": "Fix flow loops for single switch flows"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3777, "cost": 1, "resetAt": "2021-11-02T12:20:56Z"}}}