{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTE2MzE2NzI0", "number": 3830, "title": "Fight port down and discovery events race condition", "bodyText": "", "createdAt": "2020-11-05T20:21:27Z", "url": "https://github.com/telstra/open-kilda/pull/3830", "merged": true, "mergeCommit": {"oid": "511f17febcd951b12758c9e5d88432a705d50c53"}, "closed": true, "closedAt": "2020-11-16T08:50:41Z", "author": {"login": "surabujin"}, "timelineItems": {"totalCount": 6, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdZxqcZgBqjM5NjU4NjIxNjA=", "endCursor": "Y3Vyc29yOnYyOpPPAAABddA7G4AFqTUzMTEwNzkwOA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "c140f220bd2443fd4ca792ee461686d486cf4518", "author": {"user": {"login": "surabujin", "name": "Dmitriy Bogun"}}, "url": "https://github.com/telstra/open-kilda/commit/c140f220bd2443fd4ca792ee461686d486cf4518", "committedDate": "2020-11-05T20:19:58Z", "message": "Fight port down and discovery events race condition"}, "afterCommit": {"oid": "9efbc176583eb6a245a259b55d4798b1516cdfa0", "author": {"user": {"login": "surabujin", "name": "Dmitriy Bogun"}}, "url": "https://github.com/telstra/open-kilda/commit/9efbc176583eb6a245a259b55d4798b1516cdfa0", "committedDate": "2020-11-06T07:16:49Z", "message": "Fight port down and discovery events race condition"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "9efbc176583eb6a245a259b55d4798b1516cdfa0", "author": {"user": {"login": "surabujin", "name": "Dmitriy Bogun"}}, "url": "https://github.com/telstra/open-kilda/commit/9efbc176583eb6a245a259b55d4798b1516cdfa0", "committedDate": "2020-11-06T07:16:49Z", "message": "Fight port down and discovery events race condition"}, "afterCommit": {"oid": "c6e58f19624eb51fd917eaf42ee0447d6bbc351c", "author": {"user": {"login": "surabujin", "name": "Dmitriy Bogun"}}, "url": "https://github.com/telstra/open-kilda/commit/c6e58f19624eb51fd917eaf42ee0447d6bbc351c", "committedDate": "2020-11-06T16:15:18Z", "message": "Fight port down and discovery events race condition"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f352a1c69c5313984f9680ec99470db93aede905", "author": {"user": {"login": "surabujin", "name": "Dmitriy Bogun"}}, "url": "https://github.com/telstra/open-kilda/commit/f352a1c69c5313984f9680ec99470db93aede905", "committedDate": "2020-11-16T08:27:14Z", "message": "Fight port down and discovery events race condition"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "c6e58f19624eb51fd917eaf42ee0447d6bbc351c", "author": {"user": {"login": "surabujin", "name": "Dmitriy Bogun"}}, "url": "https://github.com/telstra/open-kilda/commit/c6e58f19624eb51fd917eaf42ee0447d6bbc351c", "committedDate": "2020-11-06T16:15:18Z", "message": "Fight port down and discovery events race condition"}, "afterCommit": {"oid": "f352a1c69c5313984f9680ec99470db93aede905", "author": {"user": {"login": "surabujin", "name": "Dmitriy Bogun"}}, "url": "https://github.com/telstra/open-kilda/commit/f352a1c69c5313984f9680ec99470db93aede905", "committedDate": "2020-11-16T08:27:14Z", "message": "Fight port down and discovery events race condition"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTMxMDc0OTUz", "url": "https://github.com/telstra/open-kilda/pull/3830#pullrequestreview-531074953", "createdAt": "2020-11-16T08:28:13Z", "commit": {"oid": "c6e58f19624eb51fd917eaf42ee0447d6bbc351c"}, "state": "APPROVED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xNlQwODoyODozMFrOHzsaXA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xNlQwODoyODozMFrOHzsaXA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMzk2NzA2OA==", "bodyText": "resetting reset :)", "url": "https://github.com/telstra/open-kilda/pull/3830#discussion_r523967068", "createdAt": "2020-11-16T08:28:30Z", "author": {"login": "niksv"}, "path": "src-java/network-topology/network-storm-topology/src/main/java/org/openkilda/wfm/topology/network/controller/isl/DiscoveryPortStatusMonitor.java", "diffHunk": "@@ -22,25 +22,31 @@\n import org.openkilda.wfm.share.model.IslReference;\n import org.openkilda.wfm.topology.network.controller.isl.IslFsm.IslFsmContext;\n import org.openkilda.wfm.topology.network.controller.isl.IslFsm.IslFsmEvent;\n-import org.openkilda.wfm.topology.network.model.LinkStatus;\n+import org.openkilda.wfm.topology.network.model.IslEndpointPortStatus;\n+import org.openkilda.wfm.topology.network.model.RoundTripStatus;\n \n import lombok.extern.slf4j.Slf4j;\n \n import java.util.Optional;\n \n @Slf4j\n-public class DiscoveryPortStatusMonitor extends DiscoveryMonitor<LinkStatus> {\n+public class DiscoveryPortStatusMonitor extends DiscoveryMonitor<IslEndpointPortStatus> {\n+    // To avoid a race condition between port-down and round-trip updates we enforce to wait for at least\n+    // MIN_UPDATE_COUNT updates before resetting reset DOWN state on both endpoints.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f352a1c69c5313984f9680ec99470db93aede905"}, "originalPosition": 16}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTMxMTA3OTA4", "url": "https://github.com/telstra/open-kilda/pull/3830#pullrequestreview-531107908", "createdAt": "2020-11-16T08:45:36Z", "commit": {"oid": "f352a1c69c5313984f9680ec99470db93aede905"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3759, "cost": 1, "resetAt": "2021-11-02T12:20:56Z"}}}