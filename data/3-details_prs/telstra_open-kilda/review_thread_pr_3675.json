{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDYzMzgxNjcw", "number": 3675, "reviewThreads": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0wN1QwNjo1MzoyNlrOEWGbdw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0wN1QwNzo1MzowNFrOEWHfMg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjkxNjA5NDYzOnYy", "diffSide": "RIGHT", "path": "src-java/flowhs-topology/flowhs-storm-topology/src/main/java/org/openkilda/wfm/topology/flowhs/fsm/common/actions/BaseResourceAllocationAction.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0wN1QwNjo1MzoyNlrOG9OmHQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0wN1QwNzozODoxMFrOG9PwUA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2Njg1NTQ1Mw==", "bodyText": "if this check fails will we end up with stalled resources allocated for the flow? since transaction is committed", "url": "https://github.com/telstra/open-kilda/pull/3675#discussion_r466855453", "createdAt": "2020-08-07T06:53:26Z", "author": {"login": "timofei-durakov"}, "path": "src-java/flowhs-topology/flowhs-storm-topology/src/main/java/org/openkilda/wfm/topology/flowhs/fsm/common/actions/BaseResourceAllocationAction.java", "diffHunk": "@@ -196,6 +201,8 @@ private void doAllocateInTransaction(T stateMachine) {\n         } catch (FailsafeException ex) {\n             throw ex.getCause();\n         }\n+\n+        checkAllocatedPaths(stateMachine);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "876d29d8518846dc5c71d7d9d96cfad5021af237"}, "originalPosition": 24}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2Njg3NDQ0OA==", "bodyText": "Yes, you are right. Added a method for removing paths.", "url": "https://github.com/telstra/open-kilda/pull/3675#discussion_r466874448", "createdAt": "2020-08-07T07:38:10Z", "author": {"login": "dpoltavets"}, "path": "src-java/flowhs-topology/flowhs-storm-topology/src/main/java/org/openkilda/wfm/topology/flowhs/fsm/common/actions/BaseResourceAllocationAction.java", "diffHunk": "@@ -196,6 +201,8 @@ private void doAllocateInTransaction(T stateMachine) {\n         } catch (FailsafeException ex) {\n             throw ex.getCause();\n         }\n+\n+        checkAllocatedPaths(stateMachine);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2Njg1NTQ1Mw=="}, "originalCommit": {"oid": "876d29d8518846dc5c71d7d9d96cfad5021af237"}, "originalPosition": 24}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjkxNjI2ODAyOnYy", "diffSide": "RIGHT", "path": "src-java/flowhs-topology/flowhs-storm-topology/src/main/java/org/openkilda/wfm/topology/flowhs/fsm/common/actions/BaseResourceAllocationAction.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0wN1QwNzo1MzowNFrOG9QMew==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0wN1QwODoxMjo0NVrOG9QxeQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2Njg4MTY1OQ==", "bodyText": "what's aabout cookies, meters, vlans?", "url": "https://github.com/telstra/open-kilda/pull/3675#discussion_r466881659", "createdAt": "2020-08-07T07:53:04Z", "author": {"login": "timofei-durakov"}, "path": "src-java/flowhs-topology/flowhs-storm-topology/src/main/java/org/openkilda/wfm/topology/flowhs/fsm/common/actions/BaseResourceAllocationAction.java", "diffHunk": "@@ -196,6 +201,13 @@ private void doAllocateInTransaction(T stateMachine) {\n         } catch (FailsafeException ex) {\n             throw ex.getCause();\n         }\n+\n+        try {\n+            checkAllocatedPaths(stateMachine);\n+        } catch (ResourceAllocationException ex) {\n+            removeAllocatedPaths(stateMachine);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "21d413ce3d8016710439a13cc87bd8094425ed98"}, "originalPosition": 27}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2Njg5MTEyOQ==", "bodyText": "Added deletion of these resources.", "url": "https://github.com/telstra/open-kilda/pull/3675#discussion_r466891129", "createdAt": "2020-08-07T08:12:45Z", "author": {"login": "dpoltavets"}, "path": "src-java/flowhs-topology/flowhs-storm-topology/src/main/java/org/openkilda/wfm/topology/flowhs/fsm/common/actions/BaseResourceAllocationAction.java", "diffHunk": "@@ -196,6 +201,13 @@ private void doAllocateInTransaction(T stateMachine) {\n         } catch (FailsafeException ex) {\n             throw ex.getCause();\n         }\n+\n+        try {\n+            checkAllocatedPaths(stateMachine);\n+        } catch (ResourceAllocationException ex) {\n+            removeAllocatedPaths(stateMachine);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2Njg4MTY1OQ=="}, "originalCommit": {"oid": "21d413ce3d8016710439a13cc87bd8094425ed98"}, "originalPosition": 27}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1794, "cost": 1, "resetAt": "2021-11-13T14:23:39Z"}}}