{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDM2Mzk2MzQ0", "number": 8371, "title": "Display error message for search bar time range inputs", "bodyText": "With this PR we are displaying an error message when the validation of a time range input in the search bar fails. The error message is being displayed as a tooltip above the input.\nIt also adds a validation for the absolute time range selector, to throw an error if the date \"from\" is after the date \"to\".\nFixes #7191\nTypes of changes\n\n\n Bug fix (non-breaking change which fixes an issue)\n New feature (non-breaking change which adds functionality)\n Refactoring (non-breaking change)\n Breaking change (fix or feature that would cause existing functionality to change)\n\nChecklist:\n\n\n\n My code follows the code style of this project.\n My change requires a change to the documentation.\n I have updated the documentation accordingly.\n I have read the CONTRIBUTING document.\n I have added tests to cover my changes.", "createdAt": "2020-06-18T11:02:53Z", "url": "https://github.com/Graylog2/graylog2-server/pull/8371", "merged": true, "mergeCommit": {"oid": "55ef01f68da9b7212f95f04a996205d7ef294fc3"}, "closed": true, "closedAt": "2020-06-29T08:23:13Z", "author": {"login": "linuspahl"}, "timelineItems": {"totalCount": 19, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcscmbeAFqTQzMzE4Mjk1Nw==", "endCursor": "Y3Vyc29yOnYyOpPPAAABcv8sOeAFqTQzODk4NTA5NQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDMzMTgyOTU3", "url": "https://github.com/Graylog2/graylog2-server/pull/8371#pullrequestreview-433182957", "createdAt": "2020-06-18T11:18:04Z", "commit": {"oid": "5cf02ab0693687ea775683e750c5143db0770080"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xOFQxMToxODowNFrOGlq14Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xOFQxMToxODowNFrOGlq14Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MjE1MjQxNw==", "bodyText": "The biggest problem I faced while implementing these changes:\nI had to check here if the \"from\" date is a valid date string, which is also part of the AbsoluteTimeRangeSelector validation . Imagine the following scenario:\nStart date: 2020-06-18 11:04:34.82 (invalid date because last number is missing)\nEnd date: 2020-06-10 11:04:34.823\nIn this case the error message would be \"Start date must be before end date\" instead of \"Format must be: YYYY-MM-DD HH:mm:ss\", without the mentioned date string check in the form validation.\nAt one point I've created a SearchBarFormValidation file, but it was way more complex than the current implementation and I really prefer the component based validation approach. Unfortunately I could not find a way to give the field validation a higher priority than the form validation.", "url": "https://github.com/Graylog2/graylog2-server/pull/8371#discussion_r442152417", "createdAt": "2020-06-18T11:18:04Z", "author": {"login": "linuspahl"}, "path": "graylog2-web-interface/src/views/components/searchbar/SearchBarForm.jsx", "diffHunk": "@@ -21,6 +22,16 @@ type Props = {\n   children: ((props: FormikProps<Values>) => React$Node) | React$Node,\n };\n \n+const validate = (values) => {\n+  const errors = {};\n+  if (values.timerange.type === 'absolute' && DateTime.isValidDateString(values.timerange.from) && values.timerange.from > values.timerange.to) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "5cf02ab0693687ea775683e750c5143db0770080"}, "originalPosition": 14}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDMzODcxNTM5", "url": "https://github.com/Graylog2/graylog2-server/pull/8371#pullrequestreview-433871539", "createdAt": "2020-06-19T07:47:06Z", "commit": {"oid": "5cf02ab0693687ea775683e750c5143db0770080"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xOVQwNzo0NzowNlrOGmLc1g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xOVQwNzo0NzowNlrOGmLc1g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MjY4NjY3OA==", "bodyText": "During testing, I noticed that we have a slight inconsistency. The message says Format must be: YYYY-MM-DD HH:mm:ss, but we do allow specifying milliseconds. So the message should be Format must be: YYYY-MM-DD HH:mm:ss[.SSS]. This would mean not being able to reuse the DateTime.Formats.DATETIME constant, but this is okay, as we should support a couple of formats and use a combined format for the error message.\nA suggestion for a future improvement: I think we should be a bit more relaxed when parsing the date. Right now we expect to specify all units going down to seconds. Imo seconds should be optional, maybe it should even be possible to make hours & minutes optional as well.", "url": "https://github.com/Graylog2/graylog2-server/pull/8371#discussion_r442686678", "createdAt": "2020-06-19T07:47:06Z", "author": {"login": "dennisoelkers"}, "path": "graylog2-web-interface/src/views/components/searchbar/AbsoluteTimeRangeSelector.jsx", "diffHunk": "@@ -36,7 +36,7 @@ const _isValidDateString = (dateString: string) => {\n   }\n   return DateTime.isValidDateString(dateString)\n     ? undefined\n-    : `Invalid date: ${dateString}`;\n+    : `Format must be: ${DateTime.Formats.DATETIME}`;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "5cf02ab0693687ea775683e750c5143db0770080"}, "originalPosition": 5}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDM1NTM2MTY5", "url": "https://github.com/Graylog2/graylog2-server/pull/8371#pullrequestreview-435536169", "createdAt": "2020-06-23T08:01:52Z", "commit": {"oid": "452e88ca22e46e3fc51fddb79c560df48c377e7c"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yM1QwODowMTo1MlrOGnd1qQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yM1QwODowMTo1MlrOGnd1qQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NDAzNjUyMQ==", "bodyText": "This is now YYYY-MM-DD HH:mm:ss.SSS. It should be YYYY-MM-DD HH:mm:ss[.SSS] to indicate that milliseconds are optional. As mentioned in a previous comment, I think we cannot reuse an existing date format string, as we do combine multiple of them (two at the moment, more if we also make e.g. seconds optional).", "url": "https://github.com/Graylog2/graylog2-server/pull/8371#discussion_r444036521", "createdAt": "2020-06-23T08:01:52Z", "author": {"login": "dennisoelkers"}, "path": "graylog2-web-interface/src/views/components/searchbar/AbsoluteTimeRangeSelector.jsx", "diffHunk": "@@ -36,7 +36,7 @@ const _isValidDateString = (dateString: string) => {\n   }\n   return DateTime.isValidDateString(dateString)\n     ? undefined\n-    : `Invalid date: ${dateString}`;\n+    : `Format must be: ${DateTime.Formats.TIMESTAMP}`;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "452e88ca22e46e3fc51fddb79c560df48c377e7c"}, "originalPosition": 5}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "30b8582e61402ec6b95875deb7b04df0c5ee5187", "author": {"user": {"login": "linuspahl", "name": "Linus Pahl"}}, "url": "https://github.com/Graylog2/graylog2-server/commit/30b8582e61402ec6b95875deb7b04df0c5ee5187", "committedDate": "2020-06-25T15:13:10Z", "message": "Add Tooltip for DateInputWithTimePicker which displays errors"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f35f553fbdbc0eae55e8ca9cdb77e24a1f654535", "author": {"user": {"login": "linuspahl", "name": "Linus Pahl"}}, "url": "https://github.com/Graylog2/graylog2-server/commit/f35f553fbdbc0eae55e8ca9cdb77e24a1f654535", "committedDate": "2020-06-25T15:13:10Z", "message": "Add SearchbarForm validation to validate relation between timerange from and to values"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "cf431e84a984e9b120038802a6662076fdb09782", "author": {"user": {"login": "linuspahl", "name": "Linus Pahl"}}, "url": "https://github.com/Graylog2/graylog2-server/commit/cf431e84a984e9b120038802a6662076fdb09782", "committedDate": "2020-06-25T15:13:10Z", "message": "Display required format in absolute timerange selection error message"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "917ddcc631d5853191da36d5468c25ae9b3553b9", "author": {"user": {"login": "linuspahl", "name": "Linus Pahl"}}, "url": "https://github.com/Graylog2/graylog2-server/commit/917ddcc631d5853191da36d5468c25ae9b3553b9", "committedDate": "2020-06-25T15:13:11Z", "message": "Display keyword timerange selector error in tooltip"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "458e2e272c49b1ff040b31bd0dc30a67ec959197", "author": {"user": {"login": "linuspahl", "name": "Linus Pahl"}}, "url": "https://github.com/Graylog2/graylog2-server/commit/458e2e272c49b1ff040b31bd0dc30a67ec959197", "committedDate": "2020-06-25T15:13:11Z", "message": "Remove Tooltip prop allowLineBreak, because it got added to the DOM"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "6e9b56ddde6afd24e185a01149e84747b4395e44", "author": {"user": {"login": "linuspahl", "name": "Linus Pahl"}}, "url": "https://github.com/Graylog2/graylog2-server/commit/6e9b56ddde6afd24e185a01149e84747b4395e44", "committedDate": "2020-06-25T15:13:11Z", "message": "Add test for keyword timerange selector error message"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c4bb54efff37ab270c2509408b8df7a764f96921", "author": {"user": {"login": "linuspahl", "name": "Linus Pahl"}}, "url": "https://github.com/Graylog2/graylog2-server/commit/c4bb54efff37ab270c2509408b8df7a764f96921", "committedDate": "2020-06-25T15:13:11Z", "message": "Add test for SearchBarForm validation"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a5ae7677c22813e26a5e096b21cfb08f5ed70c4f", "author": {"user": {"login": "linuspahl", "name": "Linus Pahl"}}, "url": "https://github.com/Graylog2/graylog2-server/commit/a5ae7677c22813e26a5e096b21cfb08f5ed70c4f", "committedDate": "2020-06-25T15:13:11Z", "message": "Improve SearchBarForm test description"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e3da1466e4fe16020406649d5a661ff897a8c400", "author": {"user": {"login": "linuspahl", "name": "Linus Pahl"}}, "url": "https://github.com/Graylog2/graylog2-server/commit/e3da1466e4fe16020406649d5a661ff897a8c400", "committedDate": "2020-06-25T15:13:11Z", "message": "Fix typo"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "762b08def6c993bd40114be79bedd5f06da912a7", "author": {"user": {"login": "linuspahl", "name": "Linus Pahl"}}, "url": "https://github.com/Graylog2/graylog2-server/commit/762b08def6c993bd40114be79bedd5f06da912a7", "committedDate": "2020-06-25T15:13:11Z", "message": "Change date format for absolute time range selector error message"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "2ebdcf70294402781b69b9470509edfcb1fbac62", "author": {"user": {"login": "linuspahl", "name": "Linus Pahl"}}, "url": "https://github.com/Graylog2/graylog2-server/commit/2ebdcf70294402781b69b9470509edfcb1fbac62", "committedDate": "2020-06-25T15:13:11Z", "message": "Add tests for AbsoluteTimeRangeSelector"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "825cfc8fb9471f190a74ce896a0e2cfd7a917b73", "author": {"user": {"login": "linuspahl", "name": "Linus Pahl"}}, "url": "https://github.com/Graylog2/graylog2-server/commit/825cfc8fb9471f190a74ce896a0e2cfd7a917b73", "committedDate": "2020-06-25T15:13:12Z", "message": "Fix linting"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d51ff4bc9a52244fcd2bd9ebc62100f32f460480", "author": {"user": {"login": "linuspahl", "name": "Linus Pahl"}}, "url": "https://github.com/Graylog2/graylog2-server/commit/d51ff4bc9a52244fcd2bd9ebc62100f32f460480", "committedDate": "2020-06-25T15:13:12Z", "message": "Disable autocomplete for DateInputWithPicker"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ffe1a7199185ce637a03403bacf7d942e7158131", "author": {"user": {"login": "linuspahl", "name": "Linus Pahl"}}, "url": "https://github.com/Graylog2/graylog2-server/commit/ffe1a7199185ce637a03403bacf7d942e7158131", "committedDate": "2020-06-25T15:17:48Z", "message": "Change absolute timerange error message and fix padding-line-between-statements linter errors"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "9e59400f192553a8694051cba93fbd9e7a77b7a8", "author": {"user": {"login": "linuspahl", "name": "Linus Pahl"}}, "url": "https://github.com/Graylog2/graylog2-server/commit/9e59400f192553a8694051cba93fbd9e7a77b7a8", "committedDate": "2020-06-23T14:48:10Z", "message": "Disable autocomplete for DateInputWithPicker"}, "afterCommit": {"oid": "ffe1a7199185ce637a03403bacf7d942e7158131", "author": {"user": {"login": "linuspahl", "name": "Linus Pahl"}}, "url": "https://github.com/Graylog2/graylog2-server/commit/ffe1a7199185ce637a03403bacf7d942e7158131", "committedDate": "2020-06-25T15:17:48Z", "message": "Change absolute timerange error message and fix padding-line-between-statements linter errors"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDM4OTg1MDk1", "url": "https://github.com/Graylog2/graylog2-server/pull/8371#pullrequestreview-438985095", "createdAt": "2020-06-29T08:23:08Z", "commit": {"oid": "ffe1a7199185ce637a03403bacf7d942e7158131"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3082, "cost": 1, "resetAt": "2021-10-28T18:54:27Z"}}}