{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0Mzg0NzMxMzAw", "number": 7645, "title": "Implement sorting options for message table widget", "bodyText": "As described in #7119 the sorting option is not part of the new message list widget.\nThis PR implements the option for the new implementation of the widget.\nFor now the sorting can only be changed inside the message list edit modal. The functionality would also work outside the edit modal, but the changed sort would be saved with e.g. the dashboard. We need to discuss if we appreciate this behaviour or if we want to reset the sort, when the user changes it outside the edit modal.\nI've added a few best practice questions as comments to the PR, but a few general points:\n\nI've used some classes like the Direction or SortConfig, they are currently part of the views/logic/aggregationbuilder directory. Would it make sense to move them to views/logic/widgets?\nWhen using the message list sort icons, we are showing a loading indicator beside the message widget title, but it will be displayed with a delay (not the spinner default spinner delay). I could not really find a way to improve the the timing, but we could e.g. directly show a loading spinner or a different kind of feedback for the clicked sort icon.\nThere is a margin problem with the loading spinner and the widget title, I will fix this in another PR.\n\nFixes #7119\nTypes of changes\n\n Bug fix (non-breaking change which fixes an issue)\n New feature (non-breaking change which adds functionality)\n Refactoring (non-breaking change)\n Breaking change (fix or feature that would cause existing functionality to change)\n\nChecklist:\n\n My code follows the code style of this project.\n My change requires a change to the documentation.\n I have updated the documentation accordingly.\n I have read the CONTRIBUTING document.\n I have added tests to cover my changes.", "createdAt": "2020-03-06T09:57:32Z", "url": "https://github.com/Graylog2/graylog2-server/pull/7645", "merged": true, "mergeCommit": {"oid": "8d3b2762f69276190527d1c5f4954ee28b60cc89"}, "closed": true, "closedAt": "2020-03-11T12:07:43Z", "author": {"login": "linuspahl"}, "timelineItems": {"totalCount": 51, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcK96tyABqjMxMDQ4OTAwMzM=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcMl-L1gFqTM3MjY5OTQxNA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "fd8afc780e53e8378ea348f5622ebab5f44239be", "author": {"user": {"login": "linuspahl", "name": "Linus Pahl"}}, "url": "https://github.com/Graylog2/graylog2-server/commit/fd8afc780e53e8378ea348f5622ebab5f44239be", "committedDate": "2020-03-06T10:52:46Z", "message": "Fix MessageConfigGenerator test"}, "afterCommit": {"oid": "250b4028e8d049d75619949f54b98b812998e518", "author": {"user": {"login": "linuspahl", "name": "Linus Pahl"}}, "url": "https://github.com/Graylog2/graylog2-server/commit/250b4028e8d049d75619949f54b98b812998e518", "committedDate": "2020-03-06T10:53:26Z", "message": "Fix MessageConfigGenerator test"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzcwMjQ0NTMy", "url": "https://github.com/Graylog2/graylog2-server/pull/7645#pullrequestreview-370244532", "createdAt": "2020-03-06T11:05:33Z", "commit": {"oid": "250b4028e8d049d75619949f54b98b812998e518"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wNlQxMTowNTozNFrOFy1GQg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wNlQxMTowNTozNFrOFy1GQg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4ODg0MzA3NA==", "bodyText": "I've tried to add some meaningful tests for the FieldSortSelect, but I could not really find a way to test e.g. the select menu and the selection of an option. It looks like this was also a problem in the SeriesSelect test.", "url": "https://github.com/Graylog2/graylog2-server/pull/7645#discussion_r388843074", "createdAt": "2020-03-06T11:05:34Z", "author": {"login": "linuspahl"}, "path": "graylog2-web-interface/src/views/components/widgets/FieldSortSelect.test.jsx", "diffHunk": "@@ -0,0 +1,40 @@\n+// @flow strict\n+import React from 'react';\n+import { render, cleanup, fireEvent, waitForElement } from 'wrappedTestingLibrary';\n+import { List } from 'immutable';\n+\n+import Direction from 'views/logic/aggregationbuilder/Direction';\n+import FieldType from 'views/logic/fieldtypes/FieldType';\n+import FieldTypeMapping from 'views/logic/fieldtypes/FieldTypeMapping';\n+import SortConfig from 'views/logic/aggregationbuilder/SortConfig';\n+\n+import FieldSortSelect from './FieldSortSelect';\n+\n+\n+describe('FieldSortSelect', () => {\n+  afterEach(cleanup);\n+\n+  const properties = ['enumerable'];\n+  const fieldType1 = new FieldType('string', properties, []);\n+  const fieldTypeMapping1 = new FieldTypeMapping('date', fieldType1);\n+  const fieldType2 = new FieldType('string', properties, []);\n+  const fieldTypeMapping2 = new FieldTypeMapping('http_method', fieldType2);\n+  const fields = List([fieldTypeMapping1, fieldTypeMapping2]);\n+  const sort = [new SortConfig('pivot', 'http_method', Direction.Ascending)];\n+\n+  it('should render minimal', () => {\n+    const { getByText } = render(<FieldSortSelect fields={fields} onChange={() => {}} sort={sort} />);\n+    expect(getByText('http_method')).not.toBeNull();\n+  });\n+\n+  it('should display current sort as selected option', () => {\n+    const { getByText } = render(<FieldSortSelect fields={fields} onChange={() => {}} sort={sort} />);\n+    expect(getByText('http_method')).not.toBeNull();\n+  });\n+\n+  it('should open menu when focused', async () => {\n+    const { getByText, container } = render(<FieldSortSelect fields={fields} onChange={() => {}} sort={sort} />);\n+    fireEvent.focus(container.getElementsByTagName('input')[0]);\n+    await waitForElement(() => getByText(/2 results available./));\n+  });\n+});", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "250b4028e8d049d75619949f54b98b812998e518"}, "originalPosition": 40}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzcwMjQ4NTE1", "url": "https://github.com/Graylog2/graylog2-server/pull/7645#pullrequestreview-370248515", "createdAt": "2020-03-06T11:13:01Z", "commit": {"oid": "2e2331f2728d5772371db5bd43ac918deab01d72"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wNlQxMToxMzowMVrOFy1SMQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wNlQxMToxMzowMVrOFy1SMQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4ODg0NjEyOQ==", "bodyText": "Would you implement useMemo for these two functions or are the not complex enough?", "url": "https://github.com/Graylog2/graylog2-server/pull/7645#discussion_r388846129", "createdAt": "2020-03-06T11:13:01Z", "author": {"login": "linuspahl"}, "path": "graylog2-web-interface/src/views/components/widgets/FieldSortIcon.jsx", "diffHunk": "@@ -0,0 +1,101 @@\n+// @flow strict\n+import React from 'react';\n+import styled, { css, type StyledComponent } from 'styled-components';\n+import PropTypes from 'prop-types';\n+\n+import MessagesWidgetConfig, { defaultSortDirection } from 'views/logic/widgets/MessagesWidgetConfig';\n+import Direction, { type DirectionJson } from 'views/logic/aggregationbuilder/Direction';\n+import SortConfig from 'views/logic/aggregationbuilder/SortConfig';\n+import CustomPropTypes from 'views/components/CustomPropTypes';\n+\n+import { Icon } from 'components/common';\n+\n+type Props = {\n+  config: MessagesWidgetConfig,\n+  fieldName: string,\n+  onConfigChange: (MessagesWidgetConfig) => Promise<void>,\n+  setLoadingState: (loading: boolean) => void,\n+}\n+\n+const SortIcon: StyledComponent<{fieldSortActive: boolean}, {}, HTMLButtonElement> = styled.button(({ fieldSortActive }) => {\n+  const color = fieldSortActive ? '#333' : '#bdbdbd';\n+\n+  return css`\n+    border: 0;\n+    background: transparent;\n+    color: ${color};\n+\n+    padding: 5px;\n+\n+    cursor: pointer;\n+  `;\n+});\n+\n+const _newSort = (config, fieldName, currentSortDirectioName) => {\n+  switch (currentSortDirectioName) {\n+    case Direction.Ascending.direction:\n+      return config.sort.map(sort => sort.toBuilder().direction(Direction.Descending).build());\n+    case Direction.Descending.direction:\n+      return config.sort.map(sort => sort.toBuilder().direction(Direction.Ascending).build());\n+    default:\n+      return [new SortConfig(SortConfig.PIVOT_TYPE, fieldName, defaultSortDirection)];\n+  }\n+};\n+\n+const _changeSort = (config: MessagesWidgetConfig, fieldName: string, sortDirectionName: ?DirectionJson, onConfigChange: (MessagesWidgetConfig) => Promise<void>, setLoadingState: (loading: boolean) => void) => {\n+  setLoadingState(true);\n+  const newSort = _newSort(config, fieldName, sortDirectionName);\n+  const newConfig = config.toBuilder().sort(newSort).build();\n+  onConfigChange(newConfig).then(() => {\n+    setLoadingState(false);\n+  });\n+};\n+\n+const _sortDirectionName = (config: MessagesWidgetConfig, fieldName: string) => {\n+  const currentSort = config.sort && config.sort.length > 0 ? config.sort[0] : null;\n+  if (currentSort && currentSort.field === fieldName) {\n+    return currentSort.direction.direction;\n+  }\n+  return null;\n+};\n+\n+const _newSortDescription = (fielName: string, sortDirectionName: ?DirectionJson) => {\n+  let newDirection;\n+  if (sortDirectionName && sortDirectionName === Direction.Ascending) {\n+    newDirection = Direction.Descending.direction;\n+  } else {\n+    newDirection = Direction.Ascending.direction;\n+  }\n+  return `Sort ${fielName} ${newDirection}`;\n+};\n+\n+const _sortIcon = (fieldSortDirection: ?DirectionJson) => {\n+  if (fieldSortDirection && fieldSortDirection === Direction.Ascending.direction) {\n+    return 'sort-amount-asc';\n+  }\n+  return 'sort-amount-desc';\n+};\n+\n+\n+const FieldSortIcon = ({ fieldName, config, onConfigChange, setLoadingState }: Props) => {\n+  const sortDirectionName = _sortDirectionName(config, fieldName);\n+  const newSortDescription = _newSortDescription(fieldName, sortDirectionName);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "2e2331f2728d5772371db5bd43ac918deab01d72"}, "originalPosition": 82}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzcwMjQ5NTM4", "url": "https://github.com/Graylog2/graylog2-server/pull/7645#pullrequestreview-370249538", "createdAt": "2020-03-06T11:15:01Z", "commit": {"oid": "2e2331f2728d5772371db5bd43ac918deab01d72"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wNlQxMToxNTowMlrOFy1VKA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wNlQxMToxNTowMlrOFy1VKA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4ODg0Njg4OA==", "bodyText": "I've had some inconsistent behaviour when I tried to compare e.g. Direction.Ascending with the direction of a widget config sort and decided to use the direction name instead of the class.", "url": "https://github.com/Graylog2/graylog2-server/pull/7645#discussion_r388846888", "createdAt": "2020-03-06T11:15:02Z", "author": {"login": "linuspahl"}, "path": "graylog2-web-interface/src/views/components/widgets/FieldSortIcon.jsx", "diffHunk": "@@ -0,0 +1,101 @@\n+// @flow strict\n+import React from 'react';\n+import styled, { css, type StyledComponent } from 'styled-components';\n+import PropTypes from 'prop-types';\n+\n+import MessagesWidgetConfig, { defaultSortDirection } from 'views/logic/widgets/MessagesWidgetConfig';\n+import Direction, { type DirectionJson } from 'views/logic/aggregationbuilder/Direction';\n+import SortConfig from 'views/logic/aggregationbuilder/SortConfig';\n+import CustomPropTypes from 'views/components/CustomPropTypes';\n+\n+import { Icon } from 'components/common';\n+\n+type Props = {\n+  config: MessagesWidgetConfig,\n+  fieldName: string,\n+  onConfigChange: (MessagesWidgetConfig) => Promise<void>,\n+  setLoadingState: (loading: boolean) => void,\n+}\n+\n+const SortIcon: StyledComponent<{fieldSortActive: boolean}, {}, HTMLButtonElement> = styled.button(({ fieldSortActive }) => {\n+  const color = fieldSortActive ? '#333' : '#bdbdbd';\n+\n+  return css`\n+    border: 0;\n+    background: transparent;\n+    color: ${color};\n+\n+    padding: 5px;\n+\n+    cursor: pointer;\n+  `;\n+});\n+\n+const _newSort = (config, fieldName, currentSortDirectioName) => {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "2e2331f2728d5772371db5bd43ac918deab01d72"}, "originalPosition": 34}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzcwMjUyNjg2", "url": "https://github.com/Graylog2/graylog2-server/pull/7645#pullrequestreview-370252686", "createdAt": "2020-03-06T11:21:02Z", "commit": {"oid": "9913f2dbb0394998a162229980fb7a4d217b9716"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wNlQxMToyMTowMlrOFy1fEQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wNlQxMToyMTowMlrOFy1fEQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4ODg0OTQyNQ==", "bodyText": "@dennisoelkers we talked about the usage of an extra class to transform the message sort configs when calling the api. I've tried to create a class which is as simple as possible, but it would be great to hear your opinion on how to define the relation with the SortConfig class. It feels a bit wrong to use e.g. the SortConfig Builder for the fromJSON method.", "url": "https://github.com/Graylog2/graylog2-server/pull/7645#discussion_r388849425", "createdAt": "2020-03-06T11:21:02Z", "author": {"login": "linuspahl"}, "path": "graylog2-web-interface/src/views/logic/searchtypes/messages/MessageSortConifg.js", "diffHunk": "@@ -0,0 +1,36 @@\n+// @flow strict\n+import Direction from 'views/logic/aggregationbuilder/Direction';\n+import SortConfig, { Builder } from 'views/logic/aggregationbuilder/SortConfig';\n+\n+export type MessageSortConifgJson = {\n+  field: string,\n+  order: 'ASC' | 'DESC',\n+};\n+\n+export default class MessageSortConifg {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "9913f2dbb0394998a162229980fb7a4d217b9716"}, "originalPosition": 10}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzcwOTkxNjEw", "url": "https://github.com/Graylog2/graylog2-server/pull/7645#pullrequestreview-370991610", "createdAt": "2020-03-09T08:48:10Z", "commit": {"oid": "9913f2dbb0394998a162229980fb7a4d217b9716"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wOVQwODo0ODoxMFrOFzesXA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wOVQwOToyNTowMlrOFzfv2g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4OTUyNDU3Mg==", "bodyText": "This test case is identical to the next one, so I think we should remove it.", "url": "https://github.com/Graylog2/graylog2-server/pull/7645#discussion_r389524572", "createdAt": "2020-03-09T08:48:10Z", "author": {"login": "dennisoelkers"}, "path": "graylog2-web-interface/src/views/components/widgets/FieldSortSelect.test.jsx", "diffHunk": "@@ -0,0 +1,39 @@\n+// @flow strict\n+import React from 'react';\n+import { render, cleanup, fireEvent, waitForElement } from 'wrappedTestingLibrary';\n+import { List } from 'immutable';\n+\n+import Direction from 'views/logic/aggregationbuilder/Direction';\n+import FieldType from 'views/logic/fieldtypes/FieldType';\n+import FieldTypeMapping from 'views/logic/fieldtypes/FieldTypeMapping';\n+import SortConfig from 'views/logic/aggregationbuilder/SortConfig';\n+\n+import FieldSortSelect from './FieldSortSelect';\n+\n+describe('FieldSortSelect', () => {\n+  const properties = ['enumerable'];\n+  const fieldType1 = new FieldType('string', properties, []);\n+  const fieldTypeMapping1 = new FieldTypeMapping('date', fieldType1);\n+  const fieldType2 = new FieldType('string', properties, []);\n+  const fieldTypeMapping2 = new FieldTypeMapping('http_method', fieldType2);\n+  const fields = List([fieldTypeMapping1, fieldTypeMapping2]);\n+  const sort = [new SortConfig('pivot', 'http_method', Direction.Ascending)];\n+\n+  afterEach(cleanup);\n+\n+  it('should render minimal', () => {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "9913f2dbb0394998a162229980fb7a4d217b9716"}, "originalPosition": 24}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4OTUzODEwNg==", "bodyText": "I guess we need to wrap that in an <IfInteractive>...</IfInteractive> block?", "url": "https://github.com/Graylog2/graylog2-server/pull/7645#discussion_r389538106", "createdAt": "2020-03-09T09:17:37Z", "author": {"login": "dennisoelkers"}, "path": "graylog2-web-interface/src/views/components/widgets/MessageTable.jsx", "diffHunk": "@@ -220,6 +229,12 @@ class MessageTable extends React.Component<Props, State> {\n                     <Field type={this._fieldTypeFor(selectedFieldName, fields)}\n                            name={selectedFieldName}\n                            queryId={activeQueryId} />\n+                    {editing && (", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "9913f2dbb0394998a162229980fb7a4d217b9716"}, "originalPosition": 58}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4OTUzODcxMQ==", "bodyText": "There is a typo in the class, file and type names: MessageSortConifg -> MessageSortConfig", "url": "https://github.com/Graylog2/graylog2-server/pull/7645#discussion_r389538711", "createdAt": "2020-03-09T09:18:46Z", "author": {"login": "dennisoelkers"}, "path": "graylog2-web-interface/src/views/logic/searchtypes/messages/MessageSortConifg.js", "diffHunk": "@@ -0,0 +1,36 @@\n+// @flow strict\n+import Direction from 'views/logic/aggregationbuilder/Direction';\n+import SortConfig, { Builder } from 'views/logic/aggregationbuilder/SortConfig';\n+\n+export type MessageSortConifgJson = {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "9913f2dbb0394998a162229980fb7a4d217b9716"}, "originalPosition": 5}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4OTU0MTg1MA==", "bodyText": "I think we should extract a common base class that is used by both MessageSortConfig and SortConfig. Maybe it would make sense to rename SortConfig to AggregateSortConfig and use SortConfig as the name for the base class. Shared code would go in there and the two specialized classes would use it internally to hold their state, but customize construction & (de-)serialization.", "url": "https://github.com/Graylog2/graylog2-server/pull/7645#discussion_r389541850", "createdAt": "2020-03-09T09:25:02Z", "author": {"login": "dennisoelkers"}, "path": "graylog2-web-interface/src/views/logic/searchtypes/messages/MessageSortConifg.js", "diffHunk": "@@ -0,0 +1,36 @@\n+// @flow strict\n+import Direction from 'views/logic/aggregationbuilder/Direction';\n+import SortConfig, { Builder } from 'views/logic/aggregationbuilder/SortConfig';\n+\n+export type MessageSortConifgJson = {\n+  field: string,\n+  order: 'ASC' | 'DESC',\n+};\n+\n+export default class MessageSortConifg {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4ODg0OTQyNQ=="}, "originalCommit": {"oid": "9913f2dbb0394998a162229980fb7a4d217b9716"}, "originalPosition": 10}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "33671b9a937bf8b09b9bd5e94b888cf48db07b42", "author": {"user": {"login": "linuspahl", "name": "Linus Pahl"}}, "url": "https://github.com/Graylog2/graylog2-server/commit/33671b9a937bf8b09b9bd5e94b888cf48db07b42", "committedDate": "2020-03-09T12:24:18Z", "message": "Add sort attribute for MessageListConfig"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e5ebb238a80b4c26100f3dfeea47a36cc2446470", "author": {"user": {"login": "linuspahl", "name": "Linus Pahl"}}, "url": "https://github.com/Graylog2/graylog2-server/commit/e5ebb238a80b4c26100f3dfeea47a36cc2446470", "committedDate": "2020-03-09T12:24:18Z", "message": "Add custom sort select for EditMessageList modal"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a184cfeddf857c14ea2ebef6414c94aa63d2ab76", "author": {"user": {"login": "linuspahl", "name": "Linus Pahl"}}, "url": "https://github.com/Graylog2/graylog2-server/commit/a184cfeddf857c14ea2ebef6414c94aa63d2ab76", "committedDate": "2020-03-09T12:24:18Z", "message": "Refactor FieldSortSelect code style"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f15c210e5155dc2d6bbbee11aaa5bf368bfb0005", "author": {"user": {"login": "linuspahl", "name": "Linus Pahl"}}, "url": "https://github.com/Graylog2/graylog2-server/commit/f15c210e5155dc2d6bbbee11aaa5bf368bfb0005", "committedDate": "2020-03-09T12:24:18Z", "message": "Fix EditMessageList fields flow type definition but using Immutable.List instead of Set"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "605014e5135769a3866bb99627b93272264c79b1", "author": {"user": {"login": "linuspahl", "name": "Linus Pahl"}}, "url": "https://github.com/Graylog2/graylog2-server/commit/605014e5135769a3866bb99627b93272264c79b1", "committedDate": "2020-03-09T12:24:18Z", "message": "Add FieldSortSelect for EditMessageList component\n\n* Add sort icons for fields in message table head\n* Disable maessage table sort icons for default non-edit view\n* Set timestamp asc as default MessageWidgetConfigSort\n* Show loading spinner when changing sort"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "274a6fa270ee525fa3e58c15f2ee832f7205e3ac", "author": {"user": {"login": "linuspahl", "name": "Linus Pahl"}}, "url": "https://github.com/Graylog2/graylog2-server/commit/274a6fa270ee525fa3e58c15f2ee832f7205e3ac", "committedDate": "2020-03-09T12:24:18Z", "message": "Change position of FieldSortSelect in message list edit modal"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e628958795e90ac9b613090aef90a37a607823b8", "author": {"user": {"login": "linuspahl", "name": "Linus Pahl"}}, "url": "https://github.com/Graylog2/graylog2-server/commit/e628958795e90ac9b613090aef90a37a607823b8", "committedDate": "2020-03-09T12:24:18Z", "message": "Change direction of default MessageList sort"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "cae7ab41aebc444198d7a5affd248129655bfdd3", "author": {"user": {"login": "linuspahl", "name": "Linus Pahl"}}, "url": "https://github.com/Graylog2/graylog2-server/commit/cae7ab41aebc444198d7a5affd248129655bfdd3", "committedDate": "2020-03-09T12:24:18Z", "message": "Create directory for all message related search type files"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "14ba059ba62b0137635465665429672fb8314c3c", "author": {"user": {"login": "linuspahl", "name": "Linus Pahl"}}, "url": "https://github.com/Graylog2/graylog2-server/commit/14ba059ba62b0137635465665429672fb8314c3c", "committedDate": "2020-03-09T12:24:18Z", "message": "Create MessageSortConfig to convert SortConfigs for MessageConfigGenerator"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "3126ceb5c970e8dee3919e690cc9eb7b96b75e17", "author": {"user": {"login": "linuspahl", "name": "Linus Pahl"}}, "url": "https://github.com/Graylog2/graylog2-server/commit/3126ceb5c970e8dee3919e690cc9eb7b96b75e17", "committedDate": "2020-03-09T12:24:18Z", "message": "Remove empty line"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "76fd9a6ef223df298dca8ed31892263ad709e674", "author": {"user": {"login": "linuspahl", "name": "Linus Pahl"}}, "url": "https://github.com/Graylog2/graylog2-server/commit/76fd9a6ef223df298dca8ed31892263ad709e674", "committedDate": "2020-03-09T12:24:18Z", "message": "Move FieldSortSelect to views components widget directory"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "3394c6681d9eb37f481aeb9d5fbba65d4dd94a98", "author": {"user": {"login": "linuspahl", "name": "Linus Pahl"}}, "url": "https://github.com/Graylog2/graylog2-server/commit/3394c6681d9eb37f481aeb9d5fbba65d4dd94a98", "committedDate": "2020-03-09T12:24:18Z", "message": "Move SortDirectionSelect from views components aggregationbuilder to widgets directory"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "366b1edb99e5361dca2d7ff9a7b5f5bef75fb3d7", "author": {"user": {"login": "linuspahl", "name": "Linus Pahl"}}, "url": "https://github.com/Graylog2/graylog2-server/commit/366b1edb99e5361dca2d7ff9a7b5f5bef75fb3d7", "committedDate": "2020-03-09T12:24:18Z", "message": "Add basic FieldSortSelect test"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b45c9b4c03884e8cf6db282a719438ac9bf882b5", "author": {"user": {"login": "linuspahl", "name": "Linus Pahl"}}, "url": "https://github.com/Graylog2/graylog2-server/commit/b45c9b4c03884e8cf6db282a719438ac9bf882b5", "committedDate": "2020-03-09T12:24:18Z", "message": "Add title attribute for field sort buttons"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "bd1e2b29a7e8ed9de532af61c252194e90040538", "author": {"user": {"login": "linuspahl", "name": "Linus Pahl"}}, "url": "https://github.com/Graylog2/graylog2-server/commit/bd1e2b29a7e8ed9de532af61c252194e90040538", "committedDate": "2020-03-09T12:24:18Z", "message": "Create separate component for message list sort icon"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "fa39219df66aec22a766bec945fcbb7ff2415966", "author": {"user": {"login": "linuspahl", "name": "Linus Pahl"}}, "url": "https://github.com/Graylog2/graylog2-server/commit/fa39219df66aec22a766bec945fcbb7ff2415966", "committedDate": "2020-03-09T12:24:18Z", "message": "Remove empty row and fix indentation"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a873ae0d7063e105fece9fe1bc0a553c2379efb3", "author": {"user": {"login": "linuspahl", "name": "Linus Pahl"}}, "url": "https://github.com/Graylog2/graylog2-server/commit/a873ae0d7063e105fece9fe1bc0a553c2379efb3", "committedDate": "2020-03-09T12:24:18Z", "message": "Fix sort direction check when changing direction of default sort"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "10de801ffb4187b34027e13973c2b83eef463617", "author": {"user": {"login": "linuspahl", "name": "Linus Pahl"}}, "url": "https://github.com/Graylog2/graylog2-server/commit/10de801ffb4187b34027e13973c2b83eef463617", "committedDate": "2020-03-09T12:24:18Z", "message": "Add test for MessagesSortIcon"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a93fab67ae6a591723065a59da94283c096acfd2", "author": {"user": {"login": "linuspahl", "name": "Linus Pahl"}}, "url": "https://github.com/Graylog2/graylog2-server/commit/a93fab67ae6a591723065a59da94283c096acfd2", "committedDate": "2020-03-09T12:24:18Z", "message": "Rename MessagesSortIcon to FieldSortIcon"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e0def2b6a40b80bf34e25b4fcaa2c8ce39be6a58", "author": {"user": {"login": "linuspahl", "name": "Linus Pahl"}}, "url": "https://github.com/Graylog2/graylog2-server/commit/e0def2b6a40b80bf34e25b4fcaa2c8ce39be6a58", "committedDate": "2020-03-09T12:24:18Z", "message": "Remove not needed sort attribute in MessageListHandler"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "34d52fe46afc2b8c3e82c364a1c389c0efdf1cc1", "author": {"user": {"login": "linuspahl", "name": "Linus Pahl"}}, "url": "https://github.com/Graylog2/graylog2-server/commit/34d52fe46afc2b8c3e82c364a1c389c0efdf1cc1", "committedDate": "2020-03-09T12:24:18Z", "message": "Use direaction name instead of full object for consistent comparison"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c4687cae29c5dc6390aa2f6c470518457faa0221", "author": {"user": {"login": "linuspahl", "name": "Linus Pahl"}}, "url": "https://github.com/Graylog2/graylog2-server/commit/c4687cae29c5dc6390aa2f6c470518457faa0221", "committedDate": "2020-03-09T12:24:18Z", "message": "Fix MessageConfigGenerator test"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "80a5f5411d4e4b3c796f1659c335b64f55343f49", "author": {"user": {"login": "linuspahl", "name": "Linus Pahl"}}, "url": "https://github.com/Graylog2/graylog2-server/commit/80a5f5411d4e4b3c796f1659c335b64f55343f49", "committedDate": "2020-03-09T12:24:18Z", "message": "Improve usage of default message config sort direction"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "24b581b39f32cddf6fab03adea3610b0f9daf671", "author": {"user": {"login": "linuspahl", "name": "Linus Pahl"}}, "url": "https://github.com/Graylog2/graylog2-server/commit/24b581b39f32cddf6fab03adea3610b0f9daf671", "committedDate": "2020-03-09T12:24:18Z", "message": "Remove empty line"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "674f3710ad7018508062ee3a00bf2b239c87eb94", "author": {"user": {"login": "linuspahl", "name": "Linus Pahl"}}, "url": "https://github.com/Graylog2/graylog2-server/commit/674f3710ad7018508062ee3a00bf2b239c87eb94", "committedDate": "2020-03-09T12:24:18Z", "message": "Add PropTypes for FieldSortSelect"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "9dfebe0c7bb5cb9bc484dd54fb3a00b145deb6d2", "author": {"user": {"login": "linuspahl", "name": "Linus Pahl"}}, "url": "https://github.com/Graylog2/graylog2-server/commit/9dfebe0c7bb5cb9bc484dd54fb3a00b145deb6d2", "committedDate": "2020-03-09T12:24:18Z", "message": "Remove empty row"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "9913f2dbb0394998a162229980fb7a4d217b9716", "author": {"user": {"login": "linuspahl", "name": "Linus Pahl"}}, "url": "https://github.com/Graylog2/graylog2-server/commit/9913f2dbb0394998a162229980fb7a4d217b9716", "committedDate": "2020-03-06T11:10:41Z", "message": "Remove empty row"}, "afterCommit": {"oid": "9dfebe0c7bb5cb9bc484dd54fb3a00b145deb6d2", "author": {"user": {"login": "linuspahl", "name": "Linus Pahl"}}, "url": "https://github.com/Graylog2/graylog2-server/commit/9dfebe0c7bb5cb9bc484dd54fb3a00b145deb6d2", "committedDate": "2020-03-09T12:24:18Z", "message": "Remove empty row"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "0188fd7a2b090259a09ef249e571d654d187e2de", "author": {"user": {"login": "linuspahl", "name": "Linus Pahl"}}, "url": "https://github.com/Graylog2/graylog2-server/commit/0188fd7a2b090259a09ef249e571d654d187e2de", "committedDate": "2020-03-09T12:35:42Z", "message": "Remove redundant test"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b9dd3d87d7084f55323eacbc781e61e5b702163d", "author": {"user": {"login": "linuspahl", "name": "Linus Pahl"}}, "url": "https://github.com/Graylog2/graylog2-server/commit/b9dd3d87d7084f55323eacbc781e61e5b702163d", "committedDate": "2020-03-09T12:56:21Z", "message": "Fix typo by renaming MessageSortConifg to MessageSortConfig"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "74a89422cd5fa385262166e6df1f66270c574ed1", "author": {"user": {"login": "linuspahl", "name": "Linus Pahl"}}, "url": "https://github.com/Graylog2/graylog2-server/commit/74a89422cd5fa385262166e6df1f66270c574ed1", "committedDate": "2020-03-09T12:51:54Z", "message": "Fix typo by renaming MessageSortConifg to MessageSortConfig"}, "afterCommit": {"oid": "b9dd3d87d7084f55323eacbc781e61e5b702163d", "author": {"user": {"login": "linuspahl", "name": "Linus Pahl"}}, "url": "https://github.com/Graylog2/graylog2-server/commit/b9dd3d87d7084f55323eacbc781e61e5b702163d", "committedDate": "2020-03-09T12:56:21Z", "message": "Fix typo by renaming MessageSortConifg to MessageSortConfig"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "6df405569fae17f6231fce71cc51f3cd1fd49ffe", "author": {"user": {"login": "linuspahl", "name": "Linus Pahl"}}, "url": "https://github.com/Graylog2/graylog2-server/commit/6df405569fae17f6231fce71cc51f3cd1fd49ffe", "committedDate": "2020-03-09T14:51:20Z", "message": "Add missing prop in MessageList test"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "01fa0d4710635ed7ad2ce1439948f813fd59ef1f", "author": {"user": {"login": "linuspahl", "name": "Linus Pahl"}}, "url": "https://github.com/Graylog2/graylog2-server/commit/01fa0d4710635ed7ad2ce1439948f813fd59ef1f", "committedDate": "2020-03-10T08:19:52Z", "message": "Refactor FieldSortIcon code style"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "90c514bccb38baf5d1d4b6c1d575d7d0795d93ea", "author": {"user": {"login": "linuspahl", "name": "Linus Pahl"}}, "url": "https://github.com/Graylog2/graylog2-server/commit/90c514bccb38baf5d1d4b6c1d575d7d0795d93ea", "committedDate": "2020-03-10T08:26:37Z", "message": "Disable delay for widget header loading spinner"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzcxOTI3MDA3", "url": "https://github.com/Graylog2/graylog2-server/pull/7645#pullrequestreview-371927007", "createdAt": "2020-03-10T13:00:21Z", "commit": {"oid": "01fa0d4710635ed7ad2ce1439948f813fd59ef1f"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 10, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xMFQxMzowMDoyMVrOF0Nr6Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xMFQxNDoxNDo1M1rOF0QsGA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MDI5NDUwNQ==", "bodyText": "Instead of doing this, you could implement equals in the Direction class and use it to compare them. So it would looks like this:\n\n  \n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n              icon: defaultSortDirection.direction === Direction.Descending.direction ? StateDesc.icon : StateAsc.icon,\n          \n          \n            \n              icon: Direction.Descending.equals(defaultSortDirection) ? StateDesc.icon : StateAsc.icon,\n          \n      \n    \n    \n  \n\nThe benefit is that we want to find out if they are equal, but do not care about their internal structure.", "url": "https://github.com/Graylog2/graylog2-server/pull/7645#discussion_r390294505", "createdAt": "2020-03-10T13:00:21Z", "author": {"login": "dennisoelkers"}, "path": "graylog2-web-interface/src/views/components/widgets/FieldSortIcon.jsx", "diffHunk": "@@ -31,61 +38,66 @@ const SortIcon: StyledComponent<{fieldSortActive: boolean}, {}, HTMLButtonElemen\n   `;\n });\n \n-const _newSort = (config, fieldName, currentSortDirectioName) => {\n-  switch (currentSortDirectioName) {\n-    case Direction.Ascending.direction:\n-      return config.sort.map(sort => sort.toBuilder().direction(Direction.Descending).build());\n-    case Direction.Descending.direction:\n-      return config.sort.map(sort => sort.toBuilder().direction(Direction.Ascending).build());\n-    default:\n-      return [new SortConfig(SortConfig.PIVOT_TYPE, fieldName, defaultSortDirection)];\n-  }\n+const _tooltip = (fieldName: string, newDirection: Direction) => {\n+  return `Sort ${fieldName} ${newDirection.direction}`;\n };\n \n-const _changeSort = (config: MessagesWidgetConfig, fieldName: string, sortDirectionName: ?DirectionJson, onConfigChange: (MessagesWidgetConfig) => Promise<void>, setLoadingState: (loading: boolean) => void) => {\n+const _changeSort = (nextDirection: Direction, config: MessagesWidgetConfig, fieldName: string, onConfigChange: (MessagesWidgetConfig) => Promise<void>, setLoadingState: (loading: boolean) => void) => {\n+  const nextSort = [new SortConfig(SortConfig.PIVOT_TYPE, fieldName, nextDirection)];\n+  const newConfig = config.toBuilder().sort(nextSort).build();\n   setLoadingState(true);\n-  const newSort = _newSort(config, fieldName, sortDirectionName);\n-  const newConfig = config.toBuilder().sort(newSort).build();\n   onConfigChange(newConfig).then(() => {\n     setLoadingState(false);\n   });\n };\n \n-const _sortDirectionName = (config: MessagesWidgetConfig, fieldName: string) => {\n-  const currentSort = config.sort && config.sort.length > 0 ? config.sort[0] : null;\n-  if (currentSort && currentSort.field === fieldName) {\n-    return currentSort.direction.direction;\n-  }\n-  return null;\n+const _isFieldSortActive = (config: MessagesWidgetConfig, fieldName: string) => {\n+  return config.sort && config.sort.length > 0 && config.sort[0].field === fieldName;\n };\n \n-const _newSortDescription = (fielName: string, sortDirectionName: ?DirectionJson) => {\n-  let newDirection;\n-  if (sortDirectionName && sortDirectionName === Direction.Ascending) {\n-    newDirection = Direction.Descending.direction;\n-  } else {\n-    newDirection = Direction.Ascending.direction;\n-  }\n-  return `Sort ${fielName} ${newDirection}`;\n+const StateAsc: CurrentState = {\n+  icon: 'sort-amount-asc',\n+  tooltip: (fieldName: string) => _tooltip(fieldName, Direction.Descending),\n+  onSortChange: changeSort => changeSort(Direction.Descending),\n+  sortActive: true,\n };\n \n-const _sortIcon = (fieldSortDirection: ?DirectionJson) => {\n-  if (fieldSortDirection && fieldSortDirection === Direction.Ascending.direction) {\n-    return 'sort-amount-asc';\n+const StateDesc: CurrentState = {\n+  icon: 'sort-amount-desc',\n+  tooltip: (fieldName: string) => _tooltip(fieldName, Direction.Ascending),\n+  onSortChange: changeSort => changeSort(Direction.Ascending),\n+  sortActive: true,\n+};\n+\n+const StateNoSort: CurrentState = {\n+  icon: defaultSortDirection.direction === Direction.Descending.direction ? StateDesc.icon : StateAsc.icon,", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "01fa0d4710635ed7ad2ce1439948f813fd59ef1f"}, "originalPosition": 92}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MDI5NjI3Ng==", "bodyText": "This should be a non-static instance method that just returns the inversion of the current Direction.\nIt could look like this:\n\n  \n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n              static invert(direction: Direction) {\n          \n          \n            \n              invert(): Direction {\n          \n          \n            \n                return Descending.equals(this) ? this.Ascending : this.Descending;\n          \n          \n            \n              }", "url": "https://github.com/Graylog2/graylog2-server/pull/7645#discussion_r390296276", "createdAt": "2020-03-10T13:03:35Z", "author": {"login": "dennisoelkers"}, "path": "graylog2-web-interface/src/views/logic/aggregationbuilder/Direction.js", "diffHunk": "@@ -20,6 +20,10 @@ export default class Direction {\n     return this._direction;\n   }\n \n+  static invert(direction: Direction) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "01fa0d4710635ed7ad2ce1439948f813fd59ef1f"}, "originalPosition": 4}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MDI5NjY3MA==", "bodyText": "There is a typo: fielSortDirection -> fieldSortDirection", "url": "https://github.com/Graylog2/graylog2-server/pull/7645#discussion_r390296670", "createdAt": "2020-03-10T13:04:17Z", "author": {"login": "dennisoelkers"}, "path": "graylog2-web-interface/src/views/components/widgets/FieldSortIcon.jsx", "diffHunk": "@@ -31,61 +38,66 @@ const SortIcon: StyledComponent<{fieldSortActive: boolean}, {}, HTMLButtonElemen\n   `;\n });\n \n-const _newSort = (config, fieldName, currentSortDirectioName) => {\n-  switch (currentSortDirectioName) {\n-    case Direction.Ascending.direction:\n-      return config.sort.map(sort => sort.toBuilder().direction(Direction.Descending).build());\n-    case Direction.Descending.direction:\n-      return config.sort.map(sort => sort.toBuilder().direction(Direction.Ascending).build());\n-    default:\n-      return [new SortConfig(SortConfig.PIVOT_TYPE, fieldName, defaultSortDirection)];\n-  }\n+const _tooltip = (fieldName: string, newDirection: Direction) => {\n+  return `Sort ${fieldName} ${newDirection.direction}`;\n };\n \n-const _changeSort = (config: MessagesWidgetConfig, fieldName: string, sortDirectionName: ?DirectionJson, onConfigChange: (MessagesWidgetConfig) => Promise<void>, setLoadingState: (loading: boolean) => void) => {\n+const _changeSort = (nextDirection: Direction, config: MessagesWidgetConfig, fieldName: string, onConfigChange: (MessagesWidgetConfig) => Promise<void>, setLoadingState: (loading: boolean) => void) => {\n+  const nextSort = [new SortConfig(SortConfig.PIVOT_TYPE, fieldName, nextDirection)];\n+  const newConfig = config.toBuilder().sort(nextSort).build();\n   setLoadingState(true);\n-  const newSort = _newSort(config, fieldName, sortDirectionName);\n-  const newConfig = config.toBuilder().sort(newSort).build();\n   onConfigChange(newConfig).then(() => {\n     setLoadingState(false);\n   });\n };\n \n-const _sortDirectionName = (config: MessagesWidgetConfig, fieldName: string) => {\n-  const currentSort = config.sort && config.sort.length > 0 ? config.sort[0] : null;\n-  if (currentSort && currentSort.field === fieldName) {\n-    return currentSort.direction.direction;\n-  }\n-  return null;\n+const _isFieldSortActive = (config: MessagesWidgetConfig, fieldName: string) => {\n+  return config.sort && config.sort.length > 0 && config.sort[0].field === fieldName;\n };\n \n-const _newSortDescription = (fielName: string, sortDirectionName: ?DirectionJson) => {\n-  let newDirection;\n-  if (sortDirectionName && sortDirectionName === Direction.Ascending) {\n-    newDirection = Direction.Descending.direction;\n-  } else {\n-    newDirection = Direction.Ascending.direction;\n-  }\n-  return `Sort ${fielName} ${newDirection}`;\n+const StateAsc: CurrentState = {\n+  icon: 'sort-amount-asc',\n+  tooltip: (fieldName: string) => _tooltip(fieldName, Direction.Descending),\n+  onSortChange: changeSort => changeSort(Direction.Descending),\n+  sortActive: true,\n };\n \n-const _sortIcon = (fieldSortDirection: ?DirectionJson) => {\n-  if (fieldSortDirection && fieldSortDirection === Direction.Ascending.direction) {\n-    return 'sort-amount-asc';\n+const StateDesc: CurrentState = {\n+  icon: 'sort-amount-desc',\n+  tooltip: (fieldName: string) => _tooltip(fieldName, Direction.Ascending),\n+  onSortChange: changeSort => changeSort(Direction.Ascending),\n+  sortActive: true,\n+};\n+\n+const StateNoSort: CurrentState = {\n+  icon: defaultSortDirection.direction === Direction.Descending.direction ? StateDesc.icon : StateAsc.icon,\n+  tooltip: (fieldName: string) => _tooltip(fieldName, defaultSortDirection),\n+  onSortChange: changeSort => changeSort(defaultSortDirection),\n+  sortActive: false,\n+};\n+\n+const _currentState = (config: MessagesWidgetConfig, fieldName: string) => {\n+  const fielSortDirection = _isFieldSortActive(config, fieldName) ? config.sort[0].direction.direction : null;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "01fa0d4710635ed7ad2ce1439948f813fd59ef1f"}, "originalPosition": 99}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MDMxOTk4MQ==", "bodyText": "An alternative that avoids using Immutable (which is used only for first() here):\n\n  \n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n              const sortDirection = Immutable.Set(sort.map(s => s.direction)).first();\n          \n          \n            \n              const [sortDirection] = sort.map(s => s.direction);\n          \n      \n    \n    \n  \n\nIf sort could be undefined, it would need to be:\n\n  \n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n              const sortDirection = Immutable.Set(sort.map(s => s.direction)).first();\n          \n          \n            \n              const [sortDirection] = (sort || []).map(s => s.direction);\n          \n      \n    \n    \n  \n\nOr we could assign a default in the line above.", "url": "https://github.com/Graylog2/graylog2-server/pull/7645#discussion_r390319981", "createdAt": "2020-03-10T13:41:34Z", "author": {"login": "dennisoelkers"}, "path": "graylog2-web-interface/src/views/components/widgets/EditMessageList.jsx", "diffHunk": "@@ -34,14 +38,26 @@ const _onShowMessageRowChanged = (config, onChange) => {\n   return onChange(newConfig);\n };\n \n+const _onSortChange = (sort: $PropertyType<AggregationWidgetConfig, 'sort'>, config, onChange) => {\n+  const newConfig = config.toBuilder().sort(sort).build();\n+  return onChange(newConfig);\n+};\n+\n+const _onSortDirectionChange = (direction: $PropertyType<AggregationWidgetConfig, 'direction'>, config, onChange) => {\n+  const newConfig = config.toBuilder().sort(config.sort.map(sort => sort.toBuilder().direction(direction).build())).build();\n+  return onChange(newConfig);\n+};\n+\n type Props = {\n   children: React.Node,\n   config: MessagesWidgetConfig,\n-  fields: Immutable.Set<FieldTypeMapping>,\n+  fields: Immutable.List<FieldTypeMapping>,\n   onChange: (MessagesWidgetConfig) => void,\n };\n \n const EditMessageList = ({ children, config, fields, onChange }: Props) => {\n+  const { sort } = config;\n+  const sortDirection = Immutable.Set(sort.map(s => s.direction)).first();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "90c514bccb38baf5d1d4b6c1d575d7d0795d93ea"}, "originalPosition": 35}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MDMyMjQwMw==", "bodyText": "CurrentState is too generic. Maybe DirectionStrategy is better? Same for the other *State namings in this component.", "url": "https://github.com/Graylog2/graylog2-server/pull/7645#discussion_r390322403", "createdAt": "2020-03-10T13:45:01Z", "author": {"login": "dennisoelkers"}, "path": "graylog2-web-interface/src/views/components/widgets/FieldSortIcon.jsx", "diffHunk": "@@ -0,0 +1,112 @@\n+// @flow strict\n+import React from 'react';\n+import styled, { css, type StyledComponent } from 'styled-components';\n+import PropTypes from 'prop-types';\n+\n+import MessagesWidgetConfig, { defaultSortDirection } from 'views/logic/widgets/MessagesWidgetConfig';\n+import Direction from 'views/logic/aggregationbuilder/Direction';\n+import SortConfig from 'views/logic/aggregationbuilder/SortConfig';\n+import CustomPropTypes from 'views/components/CustomPropTypes';\n+\n+import { Icon } from 'components/common';\n+\n+type Props = {\n+  config: MessagesWidgetConfig,\n+  fieldName: string,\n+  onConfigChange: (MessagesWidgetConfig) => Promise<void>,\n+  setLoadingState: (loading: boolean) => void,\n+}\n+\n+type CurrentState = {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "90c514bccb38baf5d1d4b6c1d575d7d0795d93ea"}, "originalPosition": 20}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MDMyNjA2OQ==", "bodyText": "The indentation is off here. I don't know why ESLint does not complain about this, seems like it is  not enforcing it for flow types.", "url": "https://github.com/Graylog2/graylog2-server/pull/7645#discussion_r390326069", "createdAt": "2020-03-10T13:50:21Z", "author": {"login": "dennisoelkers"}, "path": "graylog2-web-interface/src/views/components/widgets/MessageList.jsx", "diffHunk": "@@ -42,35 +42,39 @@ type State = {\n }\n \n type Props = {\n-  fields: FieldTypeMappingsList,\n-  pageSize: number,\n   config: MessagesWidgetConfig,\n+    currentView: {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "90c514bccb38baf5d1d4b6c1d575d7d0795d93ea"}, "originalPosition": 7}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MDMyODIwNA==", "bodyText": "Maybe it makes sense to use a onSortChange function instead, which returns the new set of sort configs? This way the MessageTable widget does not need to know how to change the structure of the message widget config.", "url": "https://github.com/Graylog2/graylog2-server/pull/7645#discussion_r390328204", "createdAt": "2020-03-10T13:53:21Z", "author": {"login": "dennisoelkers"}, "path": "graylog2-web-interface/src/views/components/widgets/MessageList.jsx", "diffHunk": "@@ -42,35 +42,39 @@ type State = {\n }\n \n type Props = {\n-  fields: FieldTypeMappingsList,\n-  pageSize: number,\n   config: MessagesWidgetConfig,\n+    currentView: {\n+      activeQuery: string,\n+      view: {\n+        id: number,\n+      },\n+    },\n   data: { messages: Array<Object>, total: number, id: string },\n-  selectedFields?: Immutable.Set<string>,\n+  editing: boolean,\n+  fields: FieldTypeMappingsList,\n+  onConfigChange: (MessagesWidgetConfig) => Promise<void>,", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "90c514bccb38baf5d1d4b6c1d575d7d0795d93ea"}, "originalPosition": 17}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MDMyODgxNg==", "bodyText": "Having to add that in all the tests could have been prevented by using a default value for the prop.", "url": "https://github.com/Graylog2/graylog2-server/pull/7645#discussion_r390328816", "createdAt": "2020-03-10T13:54:12Z", "author": {"login": "dennisoelkers"}, "path": "graylog2-web-interface/src/views/components/widgets/MessageList.test.jsx", "diffHunk": "@@ -108,6 +108,7 @@ describe('MessageList', () => {\n     const wrapper1 = mount(<MessageList editing\n                                         data={data}\n                                         config={config}\n+                                        onConfigChange={() => {}}", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "90c514bccb38baf5d1d4b6c1d575d7d0795d93ea"}, "originalPosition": 4}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MDM0MzQ5NQ==", "bodyText": "I think there is no benefit reusing SortConfig here. Instead, we could just store the field/direction values in internal fields (we do not even need getters for them) and just define the JSON (de-)serialization format in here.", "url": "https://github.com/Graylog2/graylog2-server/pull/7645#discussion_r390343495", "createdAt": "2020-03-10T14:14:36Z", "author": {"login": "dennisoelkers"}, "path": "graylog2-web-interface/src/views/logic/searchtypes/messages/MessageSortConfig.js", "diffHunk": "@@ -0,0 +1,36 @@\n+// @flow strict\n+import Direction from 'views/logic/aggregationbuilder/Direction';\n+import SortConfig, { Builder } from 'views/logic/aggregationbuilder/SortConfig';\n+\n+export type MessageSortConfigJson = {\n+  field: string,\n+  order: 'ASC' | 'DESC',\n+};\n+\n+export default class MessageSortConfig {\n+  _value: SortConfig\n+\n+  constructor(type: string, field: string, direction: Direction) {\n+    this._value = new SortConfig(type, field, direction);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "90c514bccb38baf5d1d4b6c1d575d7d0795d93ea"}, "originalPosition": 14}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MDM0MzcwNA==", "bodyText": "This actually returns a SortConfig instead of a MessageSortConfig.", "url": "https://github.com/Graylog2/graylog2-server/pull/7645#discussion_r390343704", "createdAt": "2020-03-10T14:14:53Z", "author": {"login": "dennisoelkers"}, "path": "graylog2-web-interface/src/views/logic/searchtypes/messages/MessageSortConfig.js", "diffHunk": "@@ -0,0 +1,36 @@\n+// @flow strict\n+import Direction from 'views/logic/aggregationbuilder/Direction';\n+import SortConfig, { Builder } from 'views/logic/aggregationbuilder/SortConfig';\n+\n+export type MessageSortConfigJson = {\n+  field: string,\n+  order: 'ASC' | 'DESC',\n+};\n+\n+export default class MessageSortConfig {\n+  _value: SortConfig\n+\n+  constructor(type: string, field: string, direction: Direction) {\n+    this._value = new SortConfig(type, field, direction);\n+  }\n+\n+  toJSON(): MessageSortConfigJson {\n+    const { field, direction } = this._value;\n+\n+    return {\n+      field,\n+      order: direction === Direction.Ascending ? 'ASC' : 'DESC',\n+    };\n+  }\n+\n+  static fromJSON(value: MessageSortConfigJson) {\n+    const { field, order } = value;\n+\n+    // eslint-disable-next-line no-use-before-define\n+    return new Builder()", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "90c514bccb38baf5d1d4b6c1d575d7d0795d93ea"}, "originalPosition": 30}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "20611b85d11e1bae8ce11ff329cb6a975ff0c997", "author": {"user": {"login": "linuspahl", "name": "Linus Pahl"}}, "url": "https://github.com/Graylog2/graylog2-server/commit/20611b85d11e1bae8ce11ff329cb6a975ff0c997", "committedDate": "2020-03-11T09:55:48Z", "message": "Remove not needed Direction invert method"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "103aa5176269cd42214d0c43b51c980b6aeabbdf", "author": {"user": {"login": "linuspahl", "name": "Linus Pahl"}}, "url": "https://github.com/Graylog2/graylog2-server/commit/103aa5176269cd42214d0c43b51c980b6aeabbdf", "committedDate": "2020-03-11T10:03:01Z", "message": "Implement equals method for Direction class"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "bab4c48bb660d6f0d7c96f33ca8a1a76b1100571", "author": {"user": {"login": "linuspahl", "name": "Linus Pahl"}}, "url": "https://github.com/Graylog2/graylog2-server/commit/bab4c48bb660d6f0d7c96f33ca8a1a76b1100571", "committedDate": "2020-03-11T10:05:01Z", "message": "Fix typo"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c1800417edda753322d8ee090f53a9aa93a21f0e", "author": {"user": {"login": "linuspahl", "name": "Linus Pahl"}}, "url": "https://github.com/Graylog2/graylog2-server/commit/c1800417edda753322d8ee090f53a9aa93a21f0e", "committedDate": "2020-03-11T10:07:30Z", "message": "Improve extraction of current sort direction in EditMessageList"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "fe9bda1ae3f7fd2a1999cf58b3e3b724142d0a33", "author": {"user": {"login": "linuspahl", "name": "Linus Pahl"}}, "url": "https://github.com/Graylog2/graylog2-server/commit/fe9bda1ae3f7fd2a1999cf58b3e3b724142d0a33", "committedDate": "2020-03-11T10:10:34Z", "message": "Use DirectionStrategy instead of CurrentState for FieldSortIcon strategy"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "60447e416a8ddafae291720cb42e2c01baddccd5", "author": {"user": {"login": "linuspahl", "name": "Linus Pahl"}}, "url": "https://github.com/Graylog2/graylog2-server/commit/60447e416a8ddafae291720cb42e2c01baddccd5", "committedDate": "2020-03-11T10:11:32Z", "message": "Fix indentation"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "192bd74ff0e6f984b2b6509f373168abe6ce58ff", "author": {"user": {"login": "linuspahl", "name": "Linus Pahl"}}, "url": "https://github.com/Graylog2/graylog2-server/commit/192bd74ff0e6f984b2b6509f373168abe6ce58ff", "committedDate": "2020-03-11T10:14:38Z", "message": "Use default prop for MessageList onConfigChange"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "eb97cfe5bb0b12b2b00a2a5e5c13c7524dce6127", "author": {"user": {"login": "linuspahl", "name": "Linus Pahl"}}, "url": "https://github.com/Graylog2/graylog2-server/commit/eb97cfe5bb0b12b2b00a2a5e5c13c7524dce6127", "committedDate": "2020-03-11T10:28:10Z", "message": "Only use MessageWidgetConfig for de-/serialization"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c3748b9d8c0ca8b372f7dca6ecf50d1195141ba5", "author": {"user": {"login": "linuspahl", "name": "Linus Pahl"}}, "url": "https://github.com/Graylog2/graylog2-server/commit/c3748b9d8c0ca8b372f7dca6ecf50d1195141ba5", "committedDate": "2020-03-11T11:00:35Z", "message": "Extract sort config change from FieldSortIcon and move logic to MessageList"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "0080d3462284efdf277b957307e325857ed669aa", "author": {"user": {"login": "linuspahl", "name": "Linus Pahl"}}, "url": "https://github.com/Graylog2/graylog2-server/commit/0080d3462284efdf277b957307e325857ed669aa", "committedDate": "2020-03-11T11:03:02Z", "message": "Add and remove row"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzcyNjk5NDE0", "url": "https://github.com/Graylog2/graylog2-server/pull/7645#pullrequestreview-372699414", "createdAt": "2020-03-11T12:07:35Z", "commit": {"oid": "0080d3462284efdf277b957307e325857ed669aa"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2567, "cost": 1, "resetAt": "2021-10-28T18:54:27Z"}}}