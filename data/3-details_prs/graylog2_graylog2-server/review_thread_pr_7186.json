{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0MzYzMTQxMzI3", "number": 7186, "reviewThreads": {"totalCount": 15, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0xNVQxMzo1MDo0M1rODYLgDw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yM1QxMToxNToxOVrODaIlLQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjI2NjgwODQ3OnYy", "diffSide": "RIGHT", "path": "graylog2-server/src/main/java/org/graylog/plugins/views/search/views/Titles.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0xNVQxMzo1MDo0M1rOFd42jQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0xN1QwODo1NDoxMlrOFeyVaQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2Njg4NDQ5Mw==", "bodyText": "Instead of making this public, could we introduce Titles#withWidgetTitle(String widgetId, String title) which returns a modified instance of Titles with the widget title being added?", "url": "https://github.com/Graylog2/graylog2-server/pull/7186#discussion_r366884493", "createdAt": "2020-01-15T13:50:43Z", "author": {"login": "dennisoelkers"}, "path": "graylog2-server/src/main/java/org/graylog/plugins/views/search/views/Titles.java", "diffHunk": "@@ -26,7 +26,7 @@\n \n @AutoValue\n public abstract class Titles {\n-    private static final String KEY_WIDGETS = \"widget\";\n+    public static final String KEY_WIDGETS = \"widget\";", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "18f48ae43fae9afcab203932f690890c49cc7186"}, "originalPosition": 5}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NzgyNjI4MQ==", "bodyText": "Sounds good to me! \ud83d\udc4d Done!", "url": "https://github.com/Graylog2/graylog2-server/pull/7186#discussion_r367826281", "createdAt": "2020-01-17T08:54:12Z", "author": {"login": "kmerz"}, "path": "graylog2-server/src/main/java/org/graylog/plugins/views/search/views/Titles.java", "diffHunk": "@@ -26,7 +26,7 @@\n \n @AutoValue\n public abstract class Titles {\n-    private static final String KEY_WIDGETS = \"widget\";\n+    public static final String KEY_WIDGETS = \"widget\";", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2Njg4NDQ5Mw=="}, "originalCommit": {"oid": "18f48ae43fae9afcab203932f690890c49cc7186"}, "originalPosition": 5}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjI2OTc0NzM0OnYy", "diffSide": "RIGHT", "path": "graylog2-server/src/main/java/org/graylog2/contentpacks/facades/dashboardV1/RandomUUIDProvider.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0xNlQxMDo0MDo0MFrOFeVGCA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0xNlQxMDo0MDo0MFrOFeVGCA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NzM0NzIwOA==", "bodyText": "This is the third copy of this class. :) Also, since this is never mocked, why not just use UUID.randomUUID().toString() to keep things simple?", "url": "https://github.com/Graylog2/graylog2-server/pull/7186#discussion_r367347208", "createdAt": "2020-01-16T10:40:40Z", "author": {"login": "alex-konn"}, "path": "graylog2-server/src/main/java/org/graylog2/contentpacks/facades/dashboardV1/RandomUUIDProvider.java", "diffHunk": "@@ -0,0 +1,43 @@\n+/**", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "18f48ae43fae9afcab203932f690890c49cc7186"}, "originalPosition": 1}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjI2OTc1MDY0OnYy", "diffSide": "RIGHT", "path": "graylog2-server/src/main/java/org/graylog2/contentpacks/facades/dashboardV1/PositionConverter.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0xNlQxMDo0MTo1MFrOFeVIEA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yM1QwOToxMjozNVrOFg3G4A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NzM0NzcyOA==", "bodyText": "?", "url": "https://github.com/Graylog2/graylog2-server/pull/7186#discussion_r367347728", "createdAt": "2020-01-16T10:41:50Z", "author": {"login": "alex-konn"}, "path": "graylog2-server/src/main/java/org/graylog2/contentpacks/facades/dashboardV1/PositionConverter.java", "diffHunk": "@@ -0,0 +1,32 @@\n+/**\n+ * This file is part of Graylog.\n+ *\n+ * Graylog is free software: you can redistribute it and/or modify\n+ * it under the terms of the GNU General Public License as published by\n+ * the Free Software Foundation, either version 3 of the License, or\n+ * (at your option) any later version.\n+ *\n+ * Graylog is distributed in the hope that it will be useful,\n+ * but WITHOUT ANY WARRANTY; without even the implied warranty of\n+ * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n+ * GNU General Public License for more details.\n+ *\n+ * You should have received a copy of the GNU General Public License\n+ * along with Graylog.  If not, see <http://www.gnu.org/licenses/>.\n+ */\n+package org.graylog2.contentpacks.facades.dashboardV1;\n+\n+import com.google.common.collect.ImmutableMap;\n+import org.graylog.plugins.views.search.views.Position;\n+import org.graylog.plugins.views.search.views.WidgetPositionDTO;\n+import org.graylog2.contentpacks.model.entities.DashboardWidgetEntity;\n+import org.graylog2.contentpacks.model.entities.references.ValueReference;\n+\n+import java.util.Collection;\n+import java.util.HashMap;\n+import java.util.Map;\n+import java.util.Optional;\n+\n+public class PositionConverter {\n+", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "18f48ae43fae9afcab203932f690890c49cc7186"}, "originalPosition": 31}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MDAwMTYzMg==", "bodyText": "\ud83d\udc4d", "url": "https://github.com/Graylog2/graylog2-server/pull/7186#discussion_r370001632", "createdAt": "2020-01-23T09:12:35Z", "author": {"login": "kmerz"}, "path": "graylog2-server/src/main/java/org/graylog2/contentpacks/facades/dashboardV1/PositionConverter.java", "diffHunk": "@@ -0,0 +1,32 @@\n+/**\n+ * This file is part of Graylog.\n+ *\n+ * Graylog is free software: you can redistribute it and/or modify\n+ * it under the terms of the GNU General Public License as published by\n+ * the Free Software Foundation, either version 3 of the License, or\n+ * (at your option) any later version.\n+ *\n+ * Graylog is distributed in the hope that it will be useful,\n+ * but WITHOUT ANY WARRANTY; without even the implied warranty of\n+ * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n+ * GNU General Public License for more details.\n+ *\n+ * You should have received a copy of the GNU General Public License\n+ * along with Graylog.  If not, see <http://www.gnu.org/licenses/>.\n+ */\n+package org.graylog2.contentpacks.facades.dashboardV1;\n+\n+import com.google.common.collect.ImmutableMap;\n+import org.graylog.plugins.views.search.views.Position;\n+import org.graylog.plugins.views.search.views.WidgetPositionDTO;\n+import org.graylog2.contentpacks.model.entities.DashboardWidgetEntity;\n+import org.graylog2.contentpacks.model.entities.references.ValueReference;\n+\n+import java.util.Collection;\n+import java.util.HashMap;\n+import java.util.Map;\n+import java.util.Optional;\n+\n+public class PositionConverter {\n+", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NzM0NzcyOA=="}, "originalCommit": {"oid": "18f48ae43fae9afcab203932f690890c49cc7186"}, "originalPosition": 31}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjI2OTc1MTM2OnYy", "diffSide": "RIGHT", "path": "graylog2-server/src/main/java/org/graylog2/contentpacks/facades/dashboardV1/TimeIntervalMapper.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0xNlQxMDo0MjowN1rOFeVIhg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yM1QwOToxNTo0NVrOFg3MWA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NzM0Nzg0Ng==", "bodyText": "Unused", "url": "https://github.com/Graylog2/graylog2-server/pull/7186#discussion_r367347846", "createdAt": "2020-01-16T10:42:07Z", "author": {"login": "alex-konn"}, "path": "graylog2-server/src/main/java/org/graylog2/contentpacks/facades/dashboardV1/TimeIntervalMapper.java", "diffHunk": "@@ -0,0 +1,39 @@\n+/**\n+ * This file is part of Graylog.\n+ *\n+ * Graylog is free software: you can redistribute it and/or modify\n+ * it under the terms of the GNU General Public License as published by\n+ * the Free Software Foundation, either version 3 of the License, or\n+ * (at your option) any later version.\n+ *\n+ * Graylog is distributed in the hope that it will be useful,\n+ * but WITHOUT ANY WARRANTY; without even the implied warranty of\n+ * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n+ * GNU General Public License for more details.\n+ *\n+ * You should have received a copy of the GNU General Public License\n+ * along with Graylog.  If not, see <http://www.gnu.org/licenses/>.\n+ */\n+package org.graylog2.contentpacks.facades.dashboardV1;\n+\n+\n+import com.google.common.collect.ImmutableMap;\n+import org.graylog.plugins.views.search.searchtypes.pivot.buckets.TimeUnitInterval;\n+\n+import java.util.Map;\n+\n+public class TimeIntervalMapper {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "18f48ae43fae9afcab203932f690890c49cc7186"}, "originalPosition": 25}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MDAwMzAzMg==", "bodyText": "Strange... but okay! \ud83e\udd37\u200d\u2642\ufe0f", "url": "https://github.com/Graylog2/graylog2-server/pull/7186#discussion_r370003032", "createdAt": "2020-01-23T09:15:45Z", "author": {"login": "kmerz"}, "path": "graylog2-server/src/main/java/org/graylog2/contentpacks/facades/dashboardV1/TimeIntervalMapper.java", "diffHunk": "@@ -0,0 +1,39 @@\n+/**\n+ * This file is part of Graylog.\n+ *\n+ * Graylog is free software: you can redistribute it and/or modify\n+ * it under the terms of the GNU General Public License as published by\n+ * the Free Software Foundation, either version 3 of the License, or\n+ * (at your option) any later version.\n+ *\n+ * Graylog is distributed in the hope that it will be useful,\n+ * but WITHOUT ANY WARRANTY; without even the implied warranty of\n+ * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n+ * GNU General Public License for more details.\n+ *\n+ * You should have received a copy of the GNU General Public License\n+ * along with Graylog.  If not, see <http://www.gnu.org/licenses/>.\n+ */\n+package org.graylog2.contentpacks.facades.dashboardV1;\n+\n+\n+import com.google.common.collect.ImmutableMap;\n+import org.graylog.plugins.views.search.searchtypes.pivot.buckets.TimeUnitInterval;\n+\n+import java.util.Map;\n+\n+public class TimeIntervalMapper {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NzM0Nzg0Ng=="}, "originalCommit": {"oid": "18f48ae43fae9afcab203932f690890c49cc7186"}, "originalPosition": 25}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjI2OTgwNzgzOnYy", "diffSide": "RIGHT", "path": "graylog2-server/src/main/java/org/graylog2/contentpacks/facades/dashboardV1/DashboardV1Facade.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0xNlQxMTowMTo1NFrOFeVrSA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yM1QwOToxNzo1OFrOFg3QXA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NzM1Njc0NA==", "bodyText": "ViewFacade#getNativeViews should be protected instead of public. It's only ever called in ViewFacade itself.", "url": "https://github.com/Graylog2/graylog2-server/pull/7186#discussion_r367356744", "createdAt": "2020-01-16T11:01:54Z", "author": {"login": "alex-konn"}, "path": "graylog2-server/src/main/java/org/graylog2/contentpacks/facades/dashboardV1/DashboardV1Facade.java", "diffHunk": "@@ -0,0 +1,120 @@\n+/**\n+ * This file is part of Graylog.\n+ *\n+ * Graylog is free software: you can redistribute it and/or modify\n+ * it under the terms of the GNU General Public License as published by\n+ * the Free Software Foundation, either version 3 of the License, or\n+ * (at your option) any later version.\n+ *\n+ * Graylog is distributed in the hope that it will be useful,\n+ * but WITHOUT ANY WARRANTY; without even the implied warranty of\n+ * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n+ * GNU General Public License for more details.\n+ *\n+ * You should have received a copy of the GNU General Public License\n+ * along with Graylog.  If not, see <http://www.gnu.org/licenses/>.\n+ */\n+package org.graylog2.contentpacks.facades.dashboardV1;\n+\n+import com.fasterxml.jackson.databind.JsonNode;\n+import com.fasterxml.jackson.databind.ObjectMapper;\n+import com.google.common.collect.ImmutableSet;\n+import com.google.common.graph.Graph;\n+import org.graylog.plugins.views.search.db.SearchDbService;\n+import org.graylog.plugins.views.search.views.ViewDTO;\n+import org.graylog.plugins.views.search.views.ViewService;\n+import org.graylog2.contentpacks.facades.ViewFacade;\n+import org.graylog2.contentpacks.model.ModelType;\n+import org.graylog2.contentpacks.model.ModelTypes;\n+import org.graylog2.contentpacks.model.entities.DashboardEntity;\n+import org.graylog2.contentpacks.model.entities.Entity;\n+import org.graylog2.contentpacks.model.entities.EntityDescriptor;\n+import org.graylog2.contentpacks.model.entities.EntityV1;\n+import org.graylog2.contentpacks.model.entities.NativeEntity;\n+import org.graylog2.contentpacks.model.entities.ViewEntity;\n+import org.graylog2.contentpacks.model.entities.references.ValueReference;\n+import org.graylog2.plugin.indexer.searches.timeranges.InvalidRangeParametersException;\n+\n+import javax.inject.Inject;\n+import java.util.Map;\n+import java.util.stream.Stream;\n+\n+public class DashboardV1Facade extends ViewFacade {\n+    public static final ModelType TYPE_V1 = ModelTypes.DASHBOARD_V1;\n+    private ObjectMapper objectMapper;\n+    private RandomUUIDProvider randomUUIDProvider;\n+\n+    @Inject\n+    public DashboardV1Facade(ObjectMapper objectMapper,\n+                             SearchDbService searchDbService,\n+                             RandomUUIDProvider randomUUIDProvider,\n+                             ViewService viewService) {\n+        super(objectMapper, searchDbService, viewService);\n+        this.objectMapper = objectMapper;\n+        this.randomUUIDProvider = randomUUIDProvider;\n+    }\n+\n+    @Override\n+    public ViewDTO.Type getDTOType() {\n+        return ViewDTO.Type.DASHBOARD;\n+    }\n+\n+    @Override\n+    public ModelType getModelType() {\n+        return ModelTypes.DASHBOARD_V1;\n+    }\n+\n+    @Override\n+    public Stream<ViewDTO> getNativeViews() {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "18f48ae43fae9afcab203932f690890c49cc7186"}, "originalPosition": 68}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MDAwNDA2MA==", "bodyText": "\ud83d\udc4d", "url": "https://github.com/Graylog2/graylog2-server/pull/7186#discussion_r370004060", "createdAt": "2020-01-23T09:17:58Z", "author": {"login": "kmerz"}, "path": "graylog2-server/src/main/java/org/graylog2/contentpacks/facades/dashboardV1/DashboardV1Facade.java", "diffHunk": "@@ -0,0 +1,120 @@\n+/**\n+ * This file is part of Graylog.\n+ *\n+ * Graylog is free software: you can redistribute it and/or modify\n+ * it under the terms of the GNU General Public License as published by\n+ * the Free Software Foundation, either version 3 of the License, or\n+ * (at your option) any later version.\n+ *\n+ * Graylog is distributed in the hope that it will be useful,\n+ * but WITHOUT ANY WARRANTY; without even the implied warranty of\n+ * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n+ * GNU General Public License for more details.\n+ *\n+ * You should have received a copy of the GNU General Public License\n+ * along with Graylog.  If not, see <http://www.gnu.org/licenses/>.\n+ */\n+package org.graylog2.contentpacks.facades.dashboardV1;\n+\n+import com.fasterxml.jackson.databind.JsonNode;\n+import com.fasterxml.jackson.databind.ObjectMapper;\n+import com.google.common.collect.ImmutableSet;\n+import com.google.common.graph.Graph;\n+import org.graylog.plugins.views.search.db.SearchDbService;\n+import org.graylog.plugins.views.search.views.ViewDTO;\n+import org.graylog.plugins.views.search.views.ViewService;\n+import org.graylog2.contentpacks.facades.ViewFacade;\n+import org.graylog2.contentpacks.model.ModelType;\n+import org.graylog2.contentpacks.model.ModelTypes;\n+import org.graylog2.contentpacks.model.entities.DashboardEntity;\n+import org.graylog2.contentpacks.model.entities.Entity;\n+import org.graylog2.contentpacks.model.entities.EntityDescriptor;\n+import org.graylog2.contentpacks.model.entities.EntityV1;\n+import org.graylog2.contentpacks.model.entities.NativeEntity;\n+import org.graylog2.contentpacks.model.entities.ViewEntity;\n+import org.graylog2.contentpacks.model.entities.references.ValueReference;\n+import org.graylog2.plugin.indexer.searches.timeranges.InvalidRangeParametersException;\n+\n+import javax.inject.Inject;\n+import java.util.Map;\n+import java.util.stream.Stream;\n+\n+public class DashboardV1Facade extends ViewFacade {\n+    public static final ModelType TYPE_V1 = ModelTypes.DASHBOARD_V1;\n+    private ObjectMapper objectMapper;\n+    private RandomUUIDProvider randomUUIDProvider;\n+\n+    @Inject\n+    public DashboardV1Facade(ObjectMapper objectMapper,\n+                             SearchDbService searchDbService,\n+                             RandomUUIDProvider randomUUIDProvider,\n+                             ViewService viewService) {\n+        super(objectMapper, searchDbService, viewService);\n+        this.objectMapper = objectMapper;\n+        this.randomUUIDProvider = randomUUIDProvider;\n+    }\n+\n+    @Override\n+    public ViewDTO.Type getDTOType() {\n+        return ViewDTO.Type.DASHBOARD;\n+    }\n+\n+    @Override\n+    public ModelType getModelType() {\n+        return ModelTypes.DASHBOARD_V1;\n+    }\n+\n+    @Override\n+    public Stream<ViewDTO> getNativeViews() {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NzM1Njc0NA=="}, "originalCommit": {"oid": "18f48ae43fae9afcab203932f690890c49cc7186"}, "originalPosition": 68}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjI4NDk5NjQ0OnYy", "diffSide": "RIGHT", "path": "graylog2-server/src/main/java/org/graylog2/contentpacks/facades/dashboardV1/DashboardWidgetConverter.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yMlQxNzoyNjozNVrOFgklfw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yMlQxNzoyNjozNVrOFgklfw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2OTY5ODE3NQ==", "bodyText": "I think we should use type.toUpperCase() as old dashboard widgets can have their type in lower case. Was different for two different content packs with different dashboards I created on graylog.torch.sh.", "url": "https://github.com/Graylog2/graylog2-server/pull/7186#discussion_r369698175", "createdAt": "2020-01-22T17:26:35Z", "author": {"login": "alex-konn"}, "path": "graylog2-server/src/main/java/org/graylog2/contentpacks/facades/dashboardV1/DashboardWidgetConverter.java", "diffHunk": "@@ -0,0 +1,465 @@\n+/**\n+ * This file is part of Graylog.\n+ *\n+ * Graylog is free software: you can redistribute it and/or modify\n+ * it under the terms of the GNU General Public License as published by\n+ * the Free Software Foundation, either version 3 of the License, or\n+ * (at your option) any later version.\n+ *\n+ * Graylog is distributed in the hope that it will be useful,\n+ * but WITHOUT ANY WARRANTY; without even the implied warranty of\n+ * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n+ * GNU General Public License for more details.\n+ *\n+ * You should have received a copy of the GNU General Public License\n+ * along with Graylog.  If not, see <http://www.gnu.org/licenses/>.\n+ */\n+package org.graylog2.contentpacks.facades.dashboardV1;\n+\n+import com.google.common.base.Splitter;\n+import com.google.common.base.Strings;\n+import com.google.common.collect.ImmutableList;\n+import com.google.common.collect.ImmutableSet;\n+import org.graylog.plugins.views.search.elasticsearch.ElasticsearchQueryString;\n+import org.graylog.plugins.views.search.views.WidgetConfigDTO;\n+import org.graylog.plugins.views.search.views.widgets.aggregation.AggregationConfigDTO;\n+import org.graylog.plugins.views.search.views.widgets.aggregation.AreaVisualizationConfigDTO;\n+import org.graylog.plugins.views.search.views.widgets.aggregation.AutoIntervalDTO;\n+import org.graylog.plugins.views.search.views.widgets.aggregation.BarVisualizationConfigDTO;\n+import org.graylog.plugins.views.search.views.widgets.aggregation.Interpolation;\n+import org.graylog.plugins.views.search.views.widgets.aggregation.LineVisualizationConfigDTO;\n+import org.graylog.plugins.views.search.views.widgets.aggregation.NumberVisualizationConfigDTO;\n+import org.graylog.plugins.views.search.views.widgets.aggregation.PivotDTO;\n+import org.graylog.plugins.views.search.views.widgets.aggregation.SeriesConfigDTO;\n+import org.graylog.plugins.views.search.views.widgets.aggregation.SeriesDTO;\n+import org.graylog.plugins.views.search.views.widgets.aggregation.TimeHistogramConfigDTO;\n+import org.graylog.plugins.views.search.views.widgets.aggregation.ValueConfigDTO;\n+import org.graylog.plugins.views.search.views.widgets.aggregation.VisualizationConfigDTO;\n+import org.graylog.plugins.views.search.views.widgets.aggregation.sort.PivotSortConfig;\n+import org.graylog.plugins.views.search.views.widgets.aggregation.sort.SortConfigDTO;\n+import org.graylog2.contentpacks.model.entities.DashboardWidgetEntity;\n+import org.graylog2.contentpacks.model.entities.WidgetConfig;\n+import org.graylog2.contentpacks.model.entities.WidgetEntity;\n+import org.graylog2.contentpacks.model.entities.references.ValueReference;\n+import org.graylog2.plugin.indexer.searches.timeranges.InvalidRangeParametersException;\n+\n+import java.util.ArrayList;\n+import java.util.Collections;\n+import java.util.List;\n+import java.util.Map;\n+import java.util.Objects;\n+import java.util.Optional;\n+import java.util.stream.Collectors;\n+\n+public class DashboardWidgetConverter {\n+    private Map<String, ValueReference> parameters;\n+    private RandomUUIDProvider randomUUIDProvider;\n+    private DashboardWidgetEntity dashboardWidgetEntity;\n+    private WidgetConfig config;\n+\n+    public DashboardWidgetConverter(DashboardWidgetEntity dashboardWidgetEntity,\n+                                    Map<String, ValueReference> parameters,\n+                                    RandomUUIDProvider randomUUIDProvider) {\n+        this.dashboardWidgetEntity = dashboardWidgetEntity;\n+        this.parameters = parameters;\n+        this.randomUUIDProvider = randomUUIDProvider;\n+        this.config = new WidgetConfig(dashboardWidgetEntity.configuration(), parameters);\n+    }\n+\n+    public static List<WidgetEntity> convert(DashboardWidgetEntity dashboardWidgetEntity,\n+                                             Map<String, ValueReference> parameters,\n+                                             RandomUUIDProvider randomUUIDProvider) {\n+        final DashboardWidgetConverter converter = new DashboardWidgetConverter(\n+                dashboardWidgetEntity, parameters, randomUUIDProvider);\n+        return converter.convert();\n+    }\n+\n+    public List<WidgetEntity> convert() {\n+        final String type = dashboardWidgetEntity.type().asString(parameters);\n+\n+        try {\n+            switch (type) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f1a9b6a266f0ac3725a0995abd0da12e814bedf5"}, "originalPosition": 81}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjI4NzE0Mjc5OnYy", "diffSide": "RIGHT", "path": "graylog2-server/src/test/java/org/graylog2/contentpacks/facades/DashboardV1FacadeTest.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yM1QxMDoyMDo0OFrOFg5KzQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yM1QxMjozMToyMFrOFg8hvA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MDAzNTQwNQ==", "bodyText": "Use com.google.common.collect.ImmutableMap", "url": "https://github.com/Graylog2/graylog2-server/pull/7186#discussion_r370035405", "createdAt": "2020-01-23T10:20:48Z", "author": {"login": "alex-konn"}, "path": "graylog2-server/src/test/java/org/graylog2/contentpacks/facades/DashboardV1FacadeTest.java", "diffHunk": "@@ -0,0 +1,187 @@\n+/**\n+ * This file is part of Graylog.\n+ *\n+ * Graylog is free software: you can redistribute it and/or modify\n+ * it under the terms of the GNU General Public License as published by\n+ * the Free Software Foundation, either version 3 of the License, or\n+ * (at your option) any later version.\n+ *\n+ * Graylog is distributed in the hope that it will be useful,\n+ * but WITHOUT ANY WARRANTY; without even the implied warranty of\n+ * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n+ * GNU General Public License for more details.\n+ *\n+ * You should have received a copy of the GNU General Public License\n+ * along with Graylog.  If not, see <http://www.gnu.org/licenses/>.\n+ */\n+package org.graylog2.contentpacks.facades;\n+\n+import com.fasterxml.jackson.databind.ObjectMapper;\n+import com.fasterxml.jackson.databind.jsontype.NamedType;\n+import com.google.common.io.Resources;\n+import com.lordofthejars.nosqlunit.annotation.UsingDataSet;\n+import com.lordofthejars.nosqlunit.core.LoadStrategyEnum;\n+import com.lordofthejars.nosqlunit.mongodb.InMemoryMongoDb;\n+import org.graylog.plugins.views.search.Query;\n+import org.graylog.plugins.views.search.Search;\n+import org.graylog.plugins.views.search.SearchRequirements;\n+import org.graylog.plugins.views.search.db.SearchDbService;\n+import org.graylog.plugins.views.search.filter.OrFilter;\n+import org.graylog.plugins.views.search.filter.QueryStringFilter;\n+import org.graylog.plugins.views.search.filter.StreamFilter;\n+import org.graylog.plugins.views.search.searchtypes.pivot.PivotSort;\n+import org.graylog.plugins.views.search.views.ViewDTO;\n+import org.graylog.plugins.views.search.views.ViewRequirements;\n+import org.graylog.plugins.views.search.views.ViewService;\n+import org.graylog.plugins.views.search.views.ViewStateDTO;\n+import org.graylog.plugins.views.search.views.WidgetDTO;\n+import org.graylog.plugins.views.search.views.widgets.aggregation.AggregationConfigDTO;\n+import org.graylog.plugins.views.search.views.widgets.aggregation.AutoIntervalDTO;\n+import org.graylog.plugins.views.search.views.widgets.aggregation.BarVisualizationConfigDTO;\n+import org.graylog.plugins.views.search.views.widgets.aggregation.LineVisualizationConfigDTO;\n+import org.graylog.plugins.views.search.views.widgets.aggregation.NumberVisualizationConfigDTO;\n+import org.graylog.plugins.views.search.views.widgets.aggregation.TimeHistogramConfigDTO;\n+import org.graylog.plugins.views.search.views.widgets.aggregation.ValueConfigDTO;\n+import org.graylog.plugins.views.search.views.widgets.aggregation.sort.PivotSortConfig;\n+import org.graylog.plugins.views.search.views.widgets.messagelist.MessageListConfigDTO;\n+import org.graylog2.bindings.providers.MongoJackObjectMapperProvider;\n+import org.graylog2.contentpacks.facades.dashboardV1.DashboardV1Facade;\n+import org.graylog2.contentpacks.model.ContentPack;\n+import org.graylog2.contentpacks.model.ContentPackV1;\n+import org.graylog2.contentpacks.model.ModelTypes;\n+import org.graylog2.contentpacks.model.entities.Entity;\n+import org.graylog2.contentpacks.model.entities.EntityDescriptor;\n+import org.graylog2.contentpacks.model.entities.NativeEntity;\n+import org.graylog2.contentpacks.model.entities.PivotEntity;\n+import org.graylog2.database.MongoConnection;\n+import org.graylog2.database.MongoConnectionRule;\n+import org.graylog2.database.NotFoundException;\n+import org.graylog2.plugin.cluster.ClusterConfigService;\n+import org.graylog2.shared.bindings.providers.ObjectMapperProvider;\n+import org.graylog2.streams.StreamImpl;\n+import org.junit.Before;\n+import org.junit.ClassRule;\n+import org.junit.Rule;\n+import org.junit.Test;\n+import org.testcontainers.shaded.com.google.common.collect.ImmutableMap;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "97d35ff327b4a10b60bd71864d4d80dac801671a"}, "originalPosition": 66}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MDA5MDQyOA==", "bodyText": "\ud83d\udc4d", "url": "https://github.com/Graylog2/graylog2-server/pull/7186#discussion_r370090428", "createdAt": "2020-01-23T12:31:20Z", "author": {"login": "kmerz"}, "path": "graylog2-server/src/test/java/org/graylog2/contentpacks/facades/DashboardV1FacadeTest.java", "diffHunk": "@@ -0,0 +1,187 @@\n+/**\n+ * This file is part of Graylog.\n+ *\n+ * Graylog is free software: you can redistribute it and/or modify\n+ * it under the terms of the GNU General Public License as published by\n+ * the Free Software Foundation, either version 3 of the License, or\n+ * (at your option) any later version.\n+ *\n+ * Graylog is distributed in the hope that it will be useful,\n+ * but WITHOUT ANY WARRANTY; without even the implied warranty of\n+ * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n+ * GNU General Public License for more details.\n+ *\n+ * You should have received a copy of the GNU General Public License\n+ * along with Graylog.  If not, see <http://www.gnu.org/licenses/>.\n+ */\n+package org.graylog2.contentpacks.facades;\n+\n+import com.fasterxml.jackson.databind.ObjectMapper;\n+import com.fasterxml.jackson.databind.jsontype.NamedType;\n+import com.google.common.io.Resources;\n+import com.lordofthejars.nosqlunit.annotation.UsingDataSet;\n+import com.lordofthejars.nosqlunit.core.LoadStrategyEnum;\n+import com.lordofthejars.nosqlunit.mongodb.InMemoryMongoDb;\n+import org.graylog.plugins.views.search.Query;\n+import org.graylog.plugins.views.search.Search;\n+import org.graylog.plugins.views.search.SearchRequirements;\n+import org.graylog.plugins.views.search.db.SearchDbService;\n+import org.graylog.plugins.views.search.filter.OrFilter;\n+import org.graylog.plugins.views.search.filter.QueryStringFilter;\n+import org.graylog.plugins.views.search.filter.StreamFilter;\n+import org.graylog.plugins.views.search.searchtypes.pivot.PivotSort;\n+import org.graylog.plugins.views.search.views.ViewDTO;\n+import org.graylog.plugins.views.search.views.ViewRequirements;\n+import org.graylog.plugins.views.search.views.ViewService;\n+import org.graylog.plugins.views.search.views.ViewStateDTO;\n+import org.graylog.plugins.views.search.views.WidgetDTO;\n+import org.graylog.plugins.views.search.views.widgets.aggregation.AggregationConfigDTO;\n+import org.graylog.plugins.views.search.views.widgets.aggregation.AutoIntervalDTO;\n+import org.graylog.plugins.views.search.views.widgets.aggregation.BarVisualizationConfigDTO;\n+import org.graylog.plugins.views.search.views.widgets.aggregation.LineVisualizationConfigDTO;\n+import org.graylog.plugins.views.search.views.widgets.aggregation.NumberVisualizationConfigDTO;\n+import org.graylog.plugins.views.search.views.widgets.aggregation.TimeHistogramConfigDTO;\n+import org.graylog.plugins.views.search.views.widgets.aggregation.ValueConfigDTO;\n+import org.graylog.plugins.views.search.views.widgets.aggregation.sort.PivotSortConfig;\n+import org.graylog.plugins.views.search.views.widgets.messagelist.MessageListConfigDTO;\n+import org.graylog2.bindings.providers.MongoJackObjectMapperProvider;\n+import org.graylog2.contentpacks.facades.dashboardV1.DashboardV1Facade;\n+import org.graylog2.contentpacks.model.ContentPack;\n+import org.graylog2.contentpacks.model.ContentPackV1;\n+import org.graylog2.contentpacks.model.ModelTypes;\n+import org.graylog2.contentpacks.model.entities.Entity;\n+import org.graylog2.contentpacks.model.entities.EntityDescriptor;\n+import org.graylog2.contentpacks.model.entities.NativeEntity;\n+import org.graylog2.contentpacks.model.entities.PivotEntity;\n+import org.graylog2.database.MongoConnection;\n+import org.graylog2.database.MongoConnectionRule;\n+import org.graylog2.database.NotFoundException;\n+import org.graylog2.plugin.cluster.ClusterConfigService;\n+import org.graylog2.shared.bindings.providers.ObjectMapperProvider;\n+import org.graylog2.streams.StreamImpl;\n+import org.junit.Before;\n+import org.junit.ClassRule;\n+import org.junit.Rule;\n+import org.junit.Test;\n+import org.testcontainers.shaded.com.google.common.collect.ImmutableMap;", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MDAzNTQwNQ=="}, "originalCommit": {"oid": "97d35ff327b4a10b60bd71864d4d80dac801671a"}, "originalPosition": 66}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjI4NzE1MzQ1OnYy", "diffSide": "RIGHT", "path": "graylog2-server/src/main/java/org/graylog2/contentpacks/facades/ViewFacade.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yM1QxMDoyNDoyNFrOFg5RLw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yM1QxMjozMzo1MVrOFg8lvg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MDAzNzAzOQ==", "bodyText": "The throws clause is not needed here. If this is removed, you can also remove it from createNativeEntity and DashboardV1Facade#decode", "url": "https://github.com/Graylog2/graylog2-server/pull/7186#discussion_r370037039", "createdAt": "2020-01-23T10:24:24Z", "author": {"login": "alex-konn"}, "path": "graylog2-server/src/main/java/org/graylog2/contentpacks/facades/ViewFacade.java", "diffHunk": "@@ -105,17 +106,17 @@ private Entity exportNativeEntity(ViewDTO view, EntityDescriptorIds entityDescri\n     public NativeEntity<ViewDTO> createNativeEntity(Entity entity,\n                                                     Map<String, ValueReference> parameters,\n                                                     Map<EntityDescriptor, Object> nativeEntities,\n-                                                    String username) {\n+                                                    String username) throws InvalidRangeParametersException {\n         if (entity instanceof EntityV1) {\n             return decode((EntityV1) entity, parameters, nativeEntities);\n         } else {\n             throw new IllegalArgumentException(\"Unsupported entity version: \" + entity.getClass());\n         }\n     }\n \n-    private NativeEntity<ViewDTO> decode(EntityV1 entityV1,\n+    protected NativeEntity<ViewDTO> decode(EntityV1 entityV1,\n                                          Map<String, ValueReference> parameters,\n-                                         Map<EntityDescriptor, Object> nativeEntities) {\n+                                         Map<EntityDescriptor, Object> nativeEntities) throws InvalidRangeParametersException {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "97d35ff327b4a10b60bd71864d4d80dac801671a"}, "originalPosition": 25}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MDA5MTQ1NA==", "bodyText": "\ud83d\udc4d", "url": "https://github.com/Graylog2/graylog2-server/pull/7186#discussion_r370091454", "createdAt": "2020-01-23T12:33:51Z", "author": {"login": "kmerz"}, "path": "graylog2-server/src/main/java/org/graylog2/contentpacks/facades/ViewFacade.java", "diffHunk": "@@ -105,17 +106,17 @@ private Entity exportNativeEntity(ViewDTO view, EntityDescriptorIds entityDescri\n     public NativeEntity<ViewDTO> createNativeEntity(Entity entity,\n                                                     Map<String, ValueReference> parameters,\n                                                     Map<EntityDescriptor, Object> nativeEntities,\n-                                                    String username) {\n+                                                    String username) throws InvalidRangeParametersException {\n         if (entity instanceof EntityV1) {\n             return decode((EntityV1) entity, parameters, nativeEntities);\n         } else {\n             throw new IllegalArgumentException(\"Unsupported entity version: \" + entity.getClass());\n         }\n     }\n \n-    private NativeEntity<ViewDTO> decode(EntityV1 entityV1,\n+    protected NativeEntity<ViewDTO> decode(EntityV1 entityV1,\n                                          Map<String, ValueReference> parameters,\n-                                         Map<EntityDescriptor, Object> nativeEntities) {\n+                                         Map<EntityDescriptor, Object> nativeEntities) throws InvalidRangeParametersException {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MDAzNzAzOQ=="}, "originalCommit": {"oid": "97d35ff327b4a10b60bd71864d4d80dac801671a"}, "originalPosition": 25}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjI4NzE2NzE4OnYy", "diffSide": "RIGHT", "path": "graylog2-server/src/main/java/org/graylog2/contentpacks/facades/dashboardV1/DashboardV1Facade.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yM1QxMDoyODozOFrOFg5ZnQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yM1QxMjozNjo0NVrOFg8qxw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MDAzOTE5Nw==", "bodyText": "The same instanceof check is done in resolveForInstallation and could be extracted into a method called ensureV1(Entity entity) which throws the exception.", "url": "https://github.com/Graylog2/graylog2-server/pull/7186#discussion_r370039197", "createdAt": "2020-01-23T10:28:38Z", "author": {"login": "alex-konn"}, "path": "graylog2-server/src/main/java/org/graylog2/contentpacks/facades/dashboardV1/DashboardV1Facade.java", "diffHunk": "@@ -0,0 +1,117 @@\n+/**\n+ * This file is part of Graylog.\n+ *\n+ * Graylog is free software: you can redistribute it and/or modify\n+ * it under the terms of the GNU General Public License as published by\n+ * the Free Software Foundation, either version 3 of the License, or\n+ * (at your option) any later version.\n+ *\n+ * Graylog is distributed in the hope that it will be useful,\n+ * but WITHOUT ANY WARRANTY; without even the implied warranty of\n+ * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n+ * GNU General Public License for more details.\n+ *\n+ * You should have received a copy of the GNU General Public License\n+ * along with Graylog.  If not, see <http://www.gnu.org/licenses/>.\n+ */\n+package org.graylog2.contentpacks.facades.dashboardV1;\n+\n+import com.fasterxml.jackson.databind.JsonNode;\n+import com.fasterxml.jackson.databind.ObjectMapper;\n+import com.google.common.collect.ImmutableSet;\n+import com.google.common.graph.Graph;\n+import org.graylog.plugins.views.search.db.SearchDbService;\n+import org.graylog.plugins.views.search.views.ViewDTO;\n+import org.graylog.plugins.views.search.views.ViewService;\n+import org.graylog2.contentpacks.facades.ViewFacade;\n+import org.graylog2.contentpacks.model.ModelType;\n+import org.graylog2.contentpacks.model.ModelTypes;\n+import org.graylog2.contentpacks.model.entities.DashboardEntity;\n+import org.graylog2.contentpacks.model.entities.Entity;\n+import org.graylog2.contentpacks.model.entities.EntityDescriptor;\n+import org.graylog2.contentpacks.model.entities.EntityV1;\n+import org.graylog2.contentpacks.model.entities.NativeEntity;\n+import org.graylog2.contentpacks.model.entities.ViewEntity;\n+import org.graylog2.contentpacks.model.entities.references.ValueReference;\n+import org.graylog2.plugin.indexer.searches.timeranges.InvalidRangeParametersException;\n+\n+import javax.inject.Inject;\n+import java.util.Map;\n+import java.util.stream.Stream;\n+\n+public class DashboardV1Facade extends ViewFacade {\n+    public static final ModelType TYPE_V1 = ModelTypes.DASHBOARD_V1;\n+    private ObjectMapper objectMapper;\n+\n+    @Inject\n+    public DashboardV1Facade(ObjectMapper objectMapper,\n+                             SearchDbService searchDbService,\n+                             ViewService viewService) {\n+        super(objectMapper, searchDbService, viewService);\n+        this.objectMapper = objectMapper;\n+    }\n+\n+    @Override\n+    public ViewDTO.Type getDTOType() {\n+        return ViewDTO.Type.DASHBOARD;\n+    }\n+\n+    @Override\n+    public ModelType getModelType() {\n+        return ModelTypes.DASHBOARD_V1;\n+    }\n+\n+    @Override\n+    protected Stream<ViewDTO> getNativeViews() {\n+        /* There are no old dashboards in the system */\n+        return ImmutableSet.<ViewDTO>of().stream();\n+    }\n+\n+    @Override\n+    public NativeEntity<ViewDTO> createNativeEntity(Entity entity, Map<String, ValueReference> parameters, Map<EntityDescriptor, Object> nativeEntities, String username) {\n+        if (entity instanceof EntityV1) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "97d35ff327b4a10b60bd71864d4d80dac801671a"}, "originalPosition": 72}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MDA5Mjc0Mw==", "bodyText": "\ud83d\udc4d", "url": "https://github.com/Graylog2/graylog2-server/pull/7186#discussion_r370092743", "createdAt": "2020-01-23T12:36:45Z", "author": {"login": "kmerz"}, "path": "graylog2-server/src/main/java/org/graylog2/contentpacks/facades/dashboardV1/DashboardV1Facade.java", "diffHunk": "@@ -0,0 +1,117 @@\n+/**\n+ * This file is part of Graylog.\n+ *\n+ * Graylog is free software: you can redistribute it and/or modify\n+ * it under the terms of the GNU General Public License as published by\n+ * the Free Software Foundation, either version 3 of the License, or\n+ * (at your option) any later version.\n+ *\n+ * Graylog is distributed in the hope that it will be useful,\n+ * but WITHOUT ANY WARRANTY; without even the implied warranty of\n+ * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n+ * GNU General Public License for more details.\n+ *\n+ * You should have received a copy of the GNU General Public License\n+ * along with Graylog.  If not, see <http://www.gnu.org/licenses/>.\n+ */\n+package org.graylog2.contentpacks.facades.dashboardV1;\n+\n+import com.fasterxml.jackson.databind.JsonNode;\n+import com.fasterxml.jackson.databind.ObjectMapper;\n+import com.google.common.collect.ImmutableSet;\n+import com.google.common.graph.Graph;\n+import org.graylog.plugins.views.search.db.SearchDbService;\n+import org.graylog.plugins.views.search.views.ViewDTO;\n+import org.graylog.plugins.views.search.views.ViewService;\n+import org.graylog2.contentpacks.facades.ViewFacade;\n+import org.graylog2.contentpacks.model.ModelType;\n+import org.graylog2.contentpacks.model.ModelTypes;\n+import org.graylog2.contentpacks.model.entities.DashboardEntity;\n+import org.graylog2.contentpacks.model.entities.Entity;\n+import org.graylog2.contentpacks.model.entities.EntityDescriptor;\n+import org.graylog2.contentpacks.model.entities.EntityV1;\n+import org.graylog2.contentpacks.model.entities.NativeEntity;\n+import org.graylog2.contentpacks.model.entities.ViewEntity;\n+import org.graylog2.contentpacks.model.entities.references.ValueReference;\n+import org.graylog2.plugin.indexer.searches.timeranges.InvalidRangeParametersException;\n+\n+import javax.inject.Inject;\n+import java.util.Map;\n+import java.util.stream.Stream;\n+\n+public class DashboardV1Facade extends ViewFacade {\n+    public static final ModelType TYPE_V1 = ModelTypes.DASHBOARD_V1;\n+    private ObjectMapper objectMapper;\n+\n+    @Inject\n+    public DashboardV1Facade(ObjectMapper objectMapper,\n+                             SearchDbService searchDbService,\n+                             ViewService viewService) {\n+        super(objectMapper, searchDbService, viewService);\n+        this.objectMapper = objectMapper;\n+    }\n+\n+    @Override\n+    public ViewDTO.Type getDTOType() {\n+        return ViewDTO.Type.DASHBOARD;\n+    }\n+\n+    @Override\n+    public ModelType getModelType() {\n+        return ModelTypes.DASHBOARD_V1;\n+    }\n+\n+    @Override\n+    protected Stream<ViewDTO> getNativeViews() {\n+        /* There are no old dashboards in the system */\n+        return ImmutableSet.<ViewDTO>of().stream();\n+    }\n+\n+    @Override\n+    public NativeEntity<ViewDTO> createNativeEntity(Entity entity, Map<String, ValueReference> parameters, Map<EntityDescriptor, Object> nativeEntities, String username) {\n+        if (entity instanceof EntityV1) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MDAzOTE5Nw=="}, "originalCommit": {"oid": "97d35ff327b4a10b60bd71864d4d80dac801671a"}, "originalPosition": 72}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjI4NzE4MjUzOnYy", "diffSide": "RIGHT", "path": "graylog2-server/src/main/java/org/graylog2/contentpacks/facades/dashboardV1/DashboardWidgetConverter.java", "isResolved": true, "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yM1QxMDozMzozMVrOFg5ilA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yM1QxMzozODo0M1rOFg-YQA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MDA0MTQ5Mg==", "bodyText": "Instead of instantiating the class in a static method I would recommend passing it to EntityConverter as a constructor parameter. This allows mocking it for unit tests, if necessary and is just generally good practice.", "url": "https://github.com/Graylog2/graylog2-server/pull/7186#discussion_r370041492", "createdAt": "2020-01-23T10:33:31Z", "author": {"login": "alex-konn"}, "path": "graylog2-server/src/main/java/org/graylog2/contentpacks/facades/dashboardV1/DashboardWidgetConverter.java", "diffHunk": "@@ -0,0 +1,462 @@\n+/**\n+ * This file is part of Graylog.\n+ *\n+ * Graylog is free software: you can redistribute it and/or modify\n+ * it under the terms of the GNU General Public License as published by\n+ * the Free Software Foundation, either version 3 of the License, or\n+ * (at your option) any later version.\n+ *\n+ * Graylog is distributed in the hope that it will be useful,\n+ * but WITHOUT ANY WARRANTY; without even the implied warranty of\n+ * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n+ * GNU General Public License for more details.\n+ *\n+ * You should have received a copy of the GNU General Public License\n+ * along with Graylog.  If not, see <http://www.gnu.org/licenses/>.\n+ */\n+package org.graylog2.contentpacks.facades.dashboardV1;\n+\n+import com.google.common.base.Splitter;\n+import com.google.common.base.Strings;\n+import com.google.common.collect.ImmutableList;\n+import com.google.common.collect.ImmutableSet;\n+import org.graylog.plugins.views.search.elasticsearch.ElasticsearchQueryString;\n+import org.graylog.plugins.views.search.views.WidgetConfigDTO;\n+import org.graylog.plugins.views.search.views.widgets.aggregation.AggregationConfigDTO;\n+import org.graylog.plugins.views.search.views.widgets.aggregation.AreaVisualizationConfigDTO;\n+import org.graylog.plugins.views.search.views.widgets.aggregation.AutoIntervalDTO;\n+import org.graylog.plugins.views.search.views.widgets.aggregation.BarVisualizationConfigDTO;\n+import org.graylog.plugins.views.search.views.widgets.aggregation.Interpolation;\n+import org.graylog.plugins.views.search.views.widgets.aggregation.LineVisualizationConfigDTO;\n+import org.graylog.plugins.views.search.views.widgets.aggregation.NumberVisualizationConfigDTO;\n+import org.graylog.plugins.views.search.views.widgets.aggregation.PivotDTO;\n+import org.graylog.plugins.views.search.views.widgets.aggregation.SeriesConfigDTO;\n+import org.graylog.plugins.views.search.views.widgets.aggregation.SeriesDTO;\n+import org.graylog.plugins.views.search.views.widgets.aggregation.TimeHistogramConfigDTO;\n+import org.graylog.plugins.views.search.views.widgets.aggregation.ValueConfigDTO;\n+import org.graylog.plugins.views.search.views.widgets.aggregation.VisualizationConfigDTO;\n+import org.graylog.plugins.views.search.views.widgets.aggregation.sort.PivotSortConfig;\n+import org.graylog.plugins.views.search.views.widgets.aggregation.sort.SortConfigDTO;\n+import org.graylog2.contentpacks.model.entities.DashboardWidgetEntity;\n+import org.graylog2.contentpacks.model.entities.WidgetConfig;\n+import org.graylog2.contentpacks.model.entities.WidgetEntity;\n+import org.graylog2.contentpacks.model.entities.references.ValueReference;\n+import org.graylog2.plugin.indexer.searches.timeranges.InvalidRangeParametersException;\n+\n+import java.util.ArrayList;\n+import java.util.Collections;\n+import java.util.List;\n+import java.util.Locale;\n+import java.util.Map;\n+import java.util.Objects;\n+import java.util.Optional;\n+import java.util.UUID;\n+import java.util.stream.Collectors;\n+\n+public class DashboardWidgetConverter {\n+    private Map<String, ValueReference> parameters;\n+    private DashboardWidgetEntity dashboardWidgetEntity;\n+    private WidgetConfig config;\n+\n+    public DashboardWidgetConverter(DashboardWidgetEntity dashboardWidgetEntity,\n+                                    Map<String, ValueReference> parameters) {\n+        this.dashboardWidgetEntity = dashboardWidgetEntity;\n+        this.parameters = parameters;\n+        this.config = new WidgetConfig(dashboardWidgetEntity.configuration(), parameters);\n+    }\n+\n+    public static List<WidgetEntity> convert(DashboardWidgetEntity dashboardWidgetEntity,", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "97d35ff327b4a10b60bd71864d4d80dac801671a"}, "originalPosition": 68}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MDA0MzM1MQ==", "bodyText": "The current constructor parameters are really the thing to convert so should (would have to, if you follow the suggestion above) become arguments of convert().", "url": "https://github.com/Graylog2/graylog2-server/pull/7186#discussion_r370043351", "createdAt": "2020-01-23T10:37:30Z", "author": {"login": "alex-konn"}, "path": "graylog2-server/src/main/java/org/graylog2/contentpacks/facades/dashboardV1/DashboardWidgetConverter.java", "diffHunk": "@@ -0,0 +1,462 @@\n+/**\n+ * This file is part of Graylog.\n+ *\n+ * Graylog is free software: you can redistribute it and/or modify\n+ * it under the terms of the GNU General Public License as published by\n+ * the Free Software Foundation, either version 3 of the License, or\n+ * (at your option) any later version.\n+ *\n+ * Graylog is distributed in the hope that it will be useful,\n+ * but WITHOUT ANY WARRANTY; without even the implied warranty of\n+ * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n+ * GNU General Public License for more details.\n+ *\n+ * You should have received a copy of the GNU General Public License\n+ * along with Graylog.  If not, see <http://www.gnu.org/licenses/>.\n+ */\n+package org.graylog2.contentpacks.facades.dashboardV1;\n+\n+import com.google.common.base.Splitter;\n+import com.google.common.base.Strings;\n+import com.google.common.collect.ImmutableList;\n+import com.google.common.collect.ImmutableSet;\n+import org.graylog.plugins.views.search.elasticsearch.ElasticsearchQueryString;\n+import org.graylog.plugins.views.search.views.WidgetConfigDTO;\n+import org.graylog.plugins.views.search.views.widgets.aggregation.AggregationConfigDTO;\n+import org.graylog.plugins.views.search.views.widgets.aggregation.AreaVisualizationConfigDTO;\n+import org.graylog.plugins.views.search.views.widgets.aggregation.AutoIntervalDTO;\n+import org.graylog.plugins.views.search.views.widgets.aggregation.BarVisualizationConfigDTO;\n+import org.graylog.plugins.views.search.views.widgets.aggregation.Interpolation;\n+import org.graylog.plugins.views.search.views.widgets.aggregation.LineVisualizationConfigDTO;\n+import org.graylog.plugins.views.search.views.widgets.aggregation.NumberVisualizationConfigDTO;\n+import org.graylog.plugins.views.search.views.widgets.aggregation.PivotDTO;\n+import org.graylog.plugins.views.search.views.widgets.aggregation.SeriesConfigDTO;\n+import org.graylog.plugins.views.search.views.widgets.aggregation.SeriesDTO;\n+import org.graylog.plugins.views.search.views.widgets.aggregation.TimeHistogramConfigDTO;\n+import org.graylog.plugins.views.search.views.widgets.aggregation.ValueConfigDTO;\n+import org.graylog.plugins.views.search.views.widgets.aggregation.VisualizationConfigDTO;\n+import org.graylog.plugins.views.search.views.widgets.aggregation.sort.PivotSortConfig;\n+import org.graylog.plugins.views.search.views.widgets.aggregation.sort.SortConfigDTO;\n+import org.graylog2.contentpacks.model.entities.DashboardWidgetEntity;\n+import org.graylog2.contentpacks.model.entities.WidgetConfig;\n+import org.graylog2.contentpacks.model.entities.WidgetEntity;\n+import org.graylog2.contentpacks.model.entities.references.ValueReference;\n+import org.graylog2.plugin.indexer.searches.timeranges.InvalidRangeParametersException;\n+\n+import java.util.ArrayList;\n+import java.util.Collections;\n+import java.util.List;\n+import java.util.Locale;\n+import java.util.Map;\n+import java.util.Objects;\n+import java.util.Optional;\n+import java.util.UUID;\n+import java.util.stream.Collectors;\n+\n+public class DashboardWidgetConverter {\n+    private Map<String, ValueReference> parameters;\n+    private DashboardWidgetEntity dashboardWidgetEntity;\n+    private WidgetConfig config;\n+\n+    public DashboardWidgetConverter(DashboardWidgetEntity dashboardWidgetEntity,\n+                                    Map<String, ValueReference> parameters) {\n+        this.dashboardWidgetEntity = dashboardWidgetEntity;\n+        this.parameters = parameters;\n+        this.config = new WidgetConfig(dashboardWidgetEntity.configuration(), parameters);\n+    }\n+\n+    public static List<WidgetEntity> convert(DashboardWidgetEntity dashboardWidgetEntity,", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MDA0MTQ5Mg=="}, "originalCommit": {"oid": "97d35ff327b4a10b60bd71864d4d80dac801671a"}, "originalPosition": 68}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MDEyMDc2OA==", "bodyText": "\ud83d\udc4d", "url": "https://github.com/Graylog2/graylog2-server/pull/7186#discussion_r370120768", "createdAt": "2020-01-23T13:38:43Z", "author": {"login": "kmerz"}, "path": "graylog2-server/src/main/java/org/graylog2/contentpacks/facades/dashboardV1/DashboardWidgetConverter.java", "diffHunk": "@@ -0,0 +1,462 @@\n+/**\n+ * This file is part of Graylog.\n+ *\n+ * Graylog is free software: you can redistribute it and/or modify\n+ * it under the terms of the GNU General Public License as published by\n+ * the Free Software Foundation, either version 3 of the License, or\n+ * (at your option) any later version.\n+ *\n+ * Graylog is distributed in the hope that it will be useful,\n+ * but WITHOUT ANY WARRANTY; without even the implied warranty of\n+ * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n+ * GNU General Public License for more details.\n+ *\n+ * You should have received a copy of the GNU General Public License\n+ * along with Graylog.  If not, see <http://www.gnu.org/licenses/>.\n+ */\n+package org.graylog2.contentpacks.facades.dashboardV1;\n+\n+import com.google.common.base.Splitter;\n+import com.google.common.base.Strings;\n+import com.google.common.collect.ImmutableList;\n+import com.google.common.collect.ImmutableSet;\n+import org.graylog.plugins.views.search.elasticsearch.ElasticsearchQueryString;\n+import org.graylog.plugins.views.search.views.WidgetConfigDTO;\n+import org.graylog.plugins.views.search.views.widgets.aggregation.AggregationConfigDTO;\n+import org.graylog.plugins.views.search.views.widgets.aggregation.AreaVisualizationConfigDTO;\n+import org.graylog.plugins.views.search.views.widgets.aggregation.AutoIntervalDTO;\n+import org.graylog.plugins.views.search.views.widgets.aggregation.BarVisualizationConfigDTO;\n+import org.graylog.plugins.views.search.views.widgets.aggregation.Interpolation;\n+import org.graylog.plugins.views.search.views.widgets.aggregation.LineVisualizationConfigDTO;\n+import org.graylog.plugins.views.search.views.widgets.aggregation.NumberVisualizationConfigDTO;\n+import org.graylog.plugins.views.search.views.widgets.aggregation.PivotDTO;\n+import org.graylog.plugins.views.search.views.widgets.aggregation.SeriesConfigDTO;\n+import org.graylog.plugins.views.search.views.widgets.aggregation.SeriesDTO;\n+import org.graylog.plugins.views.search.views.widgets.aggregation.TimeHistogramConfigDTO;\n+import org.graylog.plugins.views.search.views.widgets.aggregation.ValueConfigDTO;\n+import org.graylog.plugins.views.search.views.widgets.aggregation.VisualizationConfigDTO;\n+import org.graylog.plugins.views.search.views.widgets.aggregation.sort.PivotSortConfig;\n+import org.graylog.plugins.views.search.views.widgets.aggregation.sort.SortConfigDTO;\n+import org.graylog2.contentpacks.model.entities.DashboardWidgetEntity;\n+import org.graylog2.contentpacks.model.entities.WidgetConfig;\n+import org.graylog2.contentpacks.model.entities.WidgetEntity;\n+import org.graylog2.contentpacks.model.entities.references.ValueReference;\n+import org.graylog2.plugin.indexer.searches.timeranges.InvalidRangeParametersException;\n+\n+import java.util.ArrayList;\n+import java.util.Collections;\n+import java.util.List;\n+import java.util.Locale;\n+import java.util.Map;\n+import java.util.Objects;\n+import java.util.Optional;\n+import java.util.UUID;\n+import java.util.stream.Collectors;\n+\n+public class DashboardWidgetConverter {\n+    private Map<String, ValueReference> parameters;\n+    private DashboardWidgetEntity dashboardWidgetEntity;\n+    private WidgetConfig config;\n+\n+    public DashboardWidgetConverter(DashboardWidgetEntity dashboardWidgetEntity,\n+                                    Map<String, ValueReference> parameters) {\n+        this.dashboardWidgetEntity = dashboardWidgetEntity;\n+        this.parameters = parameters;\n+        this.config = new WidgetConfig(dashboardWidgetEntity.configuration(), parameters);\n+    }\n+\n+    public static List<WidgetEntity> convert(DashboardWidgetEntity dashboardWidgetEntity,", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MDA0MTQ5Mg=="}, "originalCommit": {"oid": "97d35ff327b4a10b60bd71864d4d80dac801671a"}, "originalPosition": 68}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjI4NzI1MjQ2OnYy", "diffSide": "RIGHT", "path": "graylog2-server/src/main/java/org/graylog2/contentpacks/facades/dashboardV1/EntityConverter.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yM1QxMDo1Njo0NVrOFg6NJA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yM1QxMzo0NjozNlrOFg-oZQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MDA1MjM4OA==", "bodyText": "I would suggest to extract more private methods to make this pretty long method easier to understand.", "url": "https://github.com/Graylog2/graylog2-server/pull/7186#discussion_r370052388", "createdAt": "2020-01-23T10:56:45Z", "author": {"login": "alex-konn"}, "path": "graylog2-server/src/main/java/org/graylog2/contentpacks/facades/dashboardV1/EntityConverter.java", "diffHunk": "@@ -0,0 +1,125 @@\n+/**\n+ * This file is part of Graylog.\n+ *\n+ * Graylog is free software: you can redistribute it and/or modify\n+ * it under the terms of the GNU General Public License as published by\n+ * the Free Software Foundation, either version 3 of the License, or\n+ * (at your option) any later version.\n+ *\n+ * Graylog is distributed in the hope that it will be useful,\n+ * but WITHOUT ANY WARRANTY; without even the implied warranty of\n+ * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n+ * GNU General Public License for more details.\n+ *\n+ * You should have received a copy of the GNU General Public License\n+ * along with Graylog.  If not, see <http://www.gnu.org/licenses/>.\n+ */\n+package org.graylog2.contentpacks.facades.dashboardV1;\n+\n+import com.google.common.collect.ImmutableMap;\n+import com.google.common.collect.ImmutableSet;\n+import org.graylog.plugins.views.search.elasticsearch.ElasticsearchQueryString;\n+import org.graylog.plugins.views.search.views.Titles;\n+import org.graylog.plugins.views.search.views.WidgetPositionDTO;\n+import org.graylog2.contentpacks.model.entities.DashboardEntity;\n+import org.graylog2.contentpacks.model.entities.DashboardWidgetEntity;\n+import org.graylog2.contentpacks.model.entities.QueryEntity;\n+import org.graylog2.contentpacks.model.entities.SearchEntity;\n+import org.graylog2.contentpacks.model.entities.SearchTypeEntity;\n+import org.graylog2.contentpacks.model.entities.ViewEntity;\n+import org.graylog2.contentpacks.model.entities.ViewStateEntity;\n+import org.graylog2.contentpacks.model.entities.WidgetEntity;\n+import org.graylog2.contentpacks.model.entities.references.ValueReference;\n+import org.graylog2.plugin.indexer.searches.timeranges.InvalidRangeParametersException;\n+import org.graylog2.plugin.indexer.searches.timeranges.RelativeRange;\n+import org.joda.time.DateTime;\n+import org.joda.time.DateTimeZone;\n+\n+import java.util.Collection;\n+import java.util.Collections;\n+import java.util.HashMap;\n+import java.util.HashSet;\n+import java.util.List;\n+import java.util.Map;\n+import java.util.Set;\n+import java.util.UUID;\n+import java.util.stream.Collectors;\n+\n+public class EntityConverter {\n+\n+    private DashboardEntity dashboardEntity;\n+    private Map<String, ValueReference> parameters;\n+\n+    public EntityConverter(DashboardEntity dashboardEntity,\n+                           Map<String, ValueReference> parameters) {\n+       this.dashboardEntity = dashboardEntity;\n+       this.parameters = parameters;\n+    }\n+\n+    public ViewEntity convert() {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "97d35ff327b4a10b60bd71864d4d80dac801671a"}, "originalPosition": 59}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MDEyNDkwMQ==", "bodyText": "\ud83d\udc4d \ud83d\udc4e \ud83d\udc4d", "url": "https://github.com/Graylog2/graylog2-server/pull/7186#discussion_r370124901", "createdAt": "2020-01-23T13:46:36Z", "author": {"login": "kmerz"}, "path": "graylog2-server/src/main/java/org/graylog2/contentpacks/facades/dashboardV1/EntityConverter.java", "diffHunk": "@@ -0,0 +1,125 @@\n+/**\n+ * This file is part of Graylog.\n+ *\n+ * Graylog is free software: you can redistribute it and/or modify\n+ * it under the terms of the GNU General Public License as published by\n+ * the Free Software Foundation, either version 3 of the License, or\n+ * (at your option) any later version.\n+ *\n+ * Graylog is distributed in the hope that it will be useful,\n+ * but WITHOUT ANY WARRANTY; without even the implied warranty of\n+ * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n+ * GNU General Public License for more details.\n+ *\n+ * You should have received a copy of the GNU General Public License\n+ * along with Graylog.  If not, see <http://www.gnu.org/licenses/>.\n+ */\n+package org.graylog2.contentpacks.facades.dashboardV1;\n+\n+import com.google.common.collect.ImmutableMap;\n+import com.google.common.collect.ImmutableSet;\n+import org.graylog.plugins.views.search.elasticsearch.ElasticsearchQueryString;\n+import org.graylog.plugins.views.search.views.Titles;\n+import org.graylog.plugins.views.search.views.WidgetPositionDTO;\n+import org.graylog2.contentpacks.model.entities.DashboardEntity;\n+import org.graylog2.contentpacks.model.entities.DashboardWidgetEntity;\n+import org.graylog2.contentpacks.model.entities.QueryEntity;\n+import org.graylog2.contentpacks.model.entities.SearchEntity;\n+import org.graylog2.contentpacks.model.entities.SearchTypeEntity;\n+import org.graylog2.contentpacks.model.entities.ViewEntity;\n+import org.graylog2.contentpacks.model.entities.ViewStateEntity;\n+import org.graylog2.contentpacks.model.entities.WidgetEntity;\n+import org.graylog2.contentpacks.model.entities.references.ValueReference;\n+import org.graylog2.plugin.indexer.searches.timeranges.InvalidRangeParametersException;\n+import org.graylog2.plugin.indexer.searches.timeranges.RelativeRange;\n+import org.joda.time.DateTime;\n+import org.joda.time.DateTimeZone;\n+\n+import java.util.Collection;\n+import java.util.Collections;\n+import java.util.HashMap;\n+import java.util.HashSet;\n+import java.util.List;\n+import java.util.Map;\n+import java.util.Set;\n+import java.util.UUID;\n+import java.util.stream.Collectors;\n+\n+public class EntityConverter {\n+\n+    private DashboardEntity dashboardEntity;\n+    private Map<String, ValueReference> parameters;\n+\n+    public EntityConverter(DashboardEntity dashboardEntity,\n+                           Map<String, ValueReference> parameters) {\n+       this.dashboardEntity = dashboardEntity;\n+       this.parameters = parameters;\n+    }\n+\n+    public ViewEntity convert() {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MDA1MjM4OA=="}, "originalCommit": {"oid": "97d35ff327b4a10b60bd71864d4d80dac801671a"}, "originalPosition": 59}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjI4NzI3Mzg2OnYy", "diffSide": "RIGHT", "path": "graylog2-server/src/main/java/org/graylog2/contentpacks/model/entities/KeywordRangeEntity.java", "isResolved": true, "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yM1QxMTowNDo1MVrOFg6aWg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yM1QxNToyMToyNVrOFhCHAw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MDA1NTc3MA==", "bodyText": "How about catching InvalidRangeParametersException and throwing some Runtimeexception instead? This would remove the need to declare (or handle) in a bunch of places in DashboardWidgetConverter.\nIMO InvalidRangeParametersException should be an unchecked exception anyway as nothing can be done about it by the system at runtime, but that's a different story and out of scope for this PR of course.", "url": "https://github.com/Graylog2/graylog2-server/pull/7186#discussion_r370055770", "createdAt": "2020-01-23T11:04:51Z", "author": {"login": "alex-konn"}, "path": "graylog2-server/src/main/java/org/graylog2/contentpacks/model/entities/KeywordRangeEntity.java", "diffHunk": "@@ -44,6 +49,12 @@ public static KeywordRangeEntity of(KeywordRange keywordRange) {\n         return new AutoValue_KeywordRangeEntity.Builder();\n     }\n \n+    @Override\n+    public final TimeRange convert(Map<String, ValueReference> parameters) throws InvalidRangeParametersException {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "97d35ff327b4a10b60bd71864d4d80dac801671a"}, "originalPosition": 18}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MDA1NjE3NQ==", "bodyText": "Same applies to the other *RangeEntity classes of course.", "url": "https://github.com/Graylog2/graylog2-server/pull/7186#discussion_r370056175", "createdAt": "2020-01-23T11:05:56Z", "author": {"login": "alex-konn"}, "path": "graylog2-server/src/main/java/org/graylog2/contentpacks/model/entities/KeywordRangeEntity.java", "diffHunk": "@@ -44,6 +49,12 @@ public static KeywordRangeEntity of(KeywordRange keywordRange) {\n         return new AutoValue_KeywordRangeEntity.Builder();\n     }\n \n+    @Override\n+    public final TimeRange convert(Map<String, ValueReference> parameters) throws InvalidRangeParametersException {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MDA1NTc3MA=="}, "originalCommit": {"oid": "97d35ff327b4a10b60bd71864d4d80dac801671a"}, "originalPosition": 18}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MDE4MTg5MQ==", "bodyText": "\ud83d\udc4d", "url": "https://github.com/Graylog2/graylog2-server/pull/7186#discussion_r370181891", "createdAt": "2020-01-23T15:21:25Z", "author": {"login": "kmerz"}, "path": "graylog2-server/src/main/java/org/graylog2/contentpacks/model/entities/KeywordRangeEntity.java", "diffHunk": "@@ -44,6 +49,12 @@ public static KeywordRangeEntity of(KeywordRange keywordRange) {\n         return new AutoValue_KeywordRangeEntity.Builder();\n     }\n \n+    @Override\n+    public final TimeRange convert(Map<String, ValueReference> parameters) throws InvalidRangeParametersException {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MDA1NTc3MA=="}, "originalCommit": {"oid": "97d35ff327b4a10b60bd71864d4d80dac801671a"}, "originalPosition": 18}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjI4NzI4NDk3OnYy", "diffSide": "RIGHT", "path": "graylog2-server/src/main/java/org/graylog2/contentpacks/facades/dashboardV1/DashboardWidgetConverter.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yM1QxMTowOToyMVrOFg6hHQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yM1QxMTowOToyMVrOFg6hHQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MDA1NzUwMQ==", "bodyText": "I have read through the remainder of this class, but feel unable to really review it in depth in a reasonable time frame, as it's a huge bunch of special case logic for the various widget types. Gotta trust you here. :)", "url": "https://github.com/Graylog2/graylog2-server/pull/7186#discussion_r370057501", "createdAt": "2020-01-23T11:09:21Z", "author": {"login": "alex-konn"}, "path": "graylog2-server/src/main/java/org/graylog2/contentpacks/facades/dashboardV1/DashboardWidgetConverter.java", "diffHunk": "@@ -0,0 +1,462 @@\n+/**\n+ * This file is part of Graylog.\n+ *\n+ * Graylog is free software: you can redistribute it and/or modify\n+ * it under the terms of the GNU General Public License as published by\n+ * the Free Software Foundation, either version 3 of the License, or\n+ * (at your option) any later version.\n+ *\n+ * Graylog is distributed in the hope that it will be useful,\n+ * but WITHOUT ANY WARRANTY; without even the implied warranty of\n+ * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n+ * GNU General Public License for more details.\n+ *\n+ * You should have received a copy of the GNU General Public License\n+ * along with Graylog.  If not, see <http://www.gnu.org/licenses/>.\n+ */\n+package org.graylog2.contentpacks.facades.dashboardV1;\n+\n+import com.google.common.base.Splitter;\n+import com.google.common.base.Strings;\n+import com.google.common.collect.ImmutableList;\n+import com.google.common.collect.ImmutableSet;\n+import org.graylog.plugins.views.search.elasticsearch.ElasticsearchQueryString;\n+import org.graylog.plugins.views.search.views.WidgetConfigDTO;\n+import org.graylog.plugins.views.search.views.widgets.aggregation.AggregationConfigDTO;\n+import org.graylog.plugins.views.search.views.widgets.aggregation.AreaVisualizationConfigDTO;\n+import org.graylog.plugins.views.search.views.widgets.aggregation.AutoIntervalDTO;\n+import org.graylog.plugins.views.search.views.widgets.aggregation.BarVisualizationConfigDTO;\n+import org.graylog.plugins.views.search.views.widgets.aggregation.Interpolation;\n+import org.graylog.plugins.views.search.views.widgets.aggregation.LineVisualizationConfigDTO;\n+import org.graylog.plugins.views.search.views.widgets.aggregation.NumberVisualizationConfigDTO;\n+import org.graylog.plugins.views.search.views.widgets.aggregation.PivotDTO;\n+import org.graylog.plugins.views.search.views.widgets.aggregation.SeriesConfigDTO;\n+import org.graylog.plugins.views.search.views.widgets.aggregation.SeriesDTO;\n+import org.graylog.plugins.views.search.views.widgets.aggregation.TimeHistogramConfigDTO;\n+import org.graylog.plugins.views.search.views.widgets.aggregation.ValueConfigDTO;\n+import org.graylog.plugins.views.search.views.widgets.aggregation.VisualizationConfigDTO;\n+import org.graylog.plugins.views.search.views.widgets.aggregation.sort.PivotSortConfig;\n+import org.graylog.plugins.views.search.views.widgets.aggregation.sort.SortConfigDTO;\n+import org.graylog2.contentpacks.model.entities.DashboardWidgetEntity;\n+import org.graylog2.contentpacks.model.entities.WidgetConfig;\n+import org.graylog2.contentpacks.model.entities.WidgetEntity;\n+import org.graylog2.contentpacks.model.entities.references.ValueReference;\n+import org.graylog2.plugin.indexer.searches.timeranges.InvalidRangeParametersException;\n+\n+import java.util.ArrayList;\n+import java.util.Collections;\n+import java.util.List;\n+import java.util.Locale;\n+import java.util.Map;\n+import java.util.Objects;\n+import java.util.Optional;\n+import java.util.UUID;\n+import java.util.stream.Collectors;\n+\n+public class DashboardWidgetConverter {\n+    private Map<String, ValueReference> parameters;\n+    private DashboardWidgetEntity dashboardWidgetEntity;\n+    private WidgetConfig config;\n+\n+    public DashboardWidgetConverter(DashboardWidgetEntity dashboardWidgetEntity,\n+                                    Map<String, ValueReference> parameters) {\n+        this.dashboardWidgetEntity = dashboardWidgetEntity;\n+        this.parameters = parameters;\n+        this.config = new WidgetConfig(dashboardWidgetEntity.configuration(), parameters);\n+    }\n+\n+    public static List<WidgetEntity> convert(DashboardWidgetEntity dashboardWidgetEntity,\n+                                             Map<String, ValueReference> parameters) {\n+        final DashboardWidgetConverter converter = new DashboardWidgetConverter(dashboardWidgetEntity, parameters);\n+        return converter.convert();\n+    }\n+\n+    public List<WidgetEntity> convert() {\n+        final String type = dashboardWidgetEntity.type().asString(parameters);\n+\n+        try {\n+            switch (type.toUpperCase(Locale.ENGLISH)) {\n+                case \"SEARCH_RESULT_CHART\":\n+                    return createHistogramWidget();\n+                case \"FIELD_CHART\":\n+                    return createFieldChartWidget();\n+                case \"STACKED_CHART\":\n+                    return createStackedChartWidget();\n+                case \"STATS_COUNT\":\n+                    return createStatsCountWidget();\n+                case \"QUICKVALUES\":\n+                    return createQuickValueWidgets();\n+                case \"STREAM_SEARCH_RESULT_COUNT\":\n+                case \"SEARCH_RESULT_COUNT\":\n+                    return createSearchResultCount();\n+                case \"QUICKVALUES_HISTOGRAM\":\n+                    return createQuickValueHistogramWidgets();\n+                case \"ORG.GRAYLOG.PLUGINS.MAP.WIDGET.STRATEGY.MAPWIDGETSTRATEGY\":\n+                    return createMapWidget();\n+                default: {\n+                    throw new IllegalArgumentException(\n+                            \"The provided entity does not have a valid Widget type: \" + type);\n+                }\n+            }\n+        } catch (\n+                InvalidRangeParametersException e) {\n+            throw new IllegalArgumentException(\n+                    \"The provided entity does not have a valid timerange type: \" + e.getMessage());\n+        }\n+    }\n+", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "97d35ff327b4a10b60bd71864d4d80dac801671a"}, "originalPosition": 107}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjI4NzI5MjI1OnYy", "diffSide": "RIGHT", "path": "graylog2-server/src/main/java/org/graylog2/contentpacks/model/entities/WidgetEntity.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yM1QxMToxMjowMlrOFg6leA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yM1QxMToxMjowMlrOFg6leA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MDA1ODYxNg==", "bodyText": "The same applies as for DashboardWidgetConverter: I have read through the remainder of this class, but feel unable to really review it in depth in a reasonable time frame, as it's a huge bunch of special case logic for the various widget types. Gotta trust you here. :)", "url": "https://github.com/Graylog2/graylog2-server/pull/7186#discussion_r370058616", "createdAt": "2020-01-23T11:12:02Z", "author": {"login": "alex-konn"}, "path": "graylog2-server/src/main/java/org/graylog2/contentpacks/model/entities/WidgetEntity.java", "diffHunk": "@@ -142,4 +166,103 @@ public WidgetDTO toNativeEntity(Map<String, ValueReference> parameters, Map<Enti\n         }\n         return widgetBuilder.build();\n     }\n+", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "97d35ff327b4a10b60bd71864d4d80dac801671a"}, "originalPosition": 58}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjI4NzMwMTU3OnYy", "diffSide": "RIGHT", "path": "graylog2-server/src/test/java/org/graylog2/contentpacks/facades/DashboardV1FacadeTest.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yM1QxMToxNToxOVrOFg6q3Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yM1QxMToxNToxOVrOFg6q3Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MDA1OTk5Nw==", "bodyText": "I would split this up into three tests so that it becomes easier to see what's wrong when a test fails. Nice job extracting the assertions though! \ud83d\udc4d", "url": "https://github.com/Graylog2/graylog2-server/pull/7186#discussion_r370059997", "createdAt": "2020-01-23T11:15:19Z", "author": {"login": "alex-konn"}, "path": "graylog2-server/src/test/java/org/graylog2/contentpacks/facades/DashboardV1FacadeTest.java", "diffHunk": "@@ -0,0 +1,187 @@\n+/**\n+ * This file is part of Graylog.\n+ *\n+ * Graylog is free software: you can redistribute it and/or modify\n+ * it under the terms of the GNU General Public License as published by\n+ * the Free Software Foundation, either version 3 of the License, or\n+ * (at your option) any later version.\n+ *\n+ * Graylog is distributed in the hope that it will be useful,\n+ * but WITHOUT ANY WARRANTY; without even the implied warranty of\n+ * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n+ * GNU General Public License for more details.\n+ *\n+ * You should have received a copy of the GNU General Public License\n+ * along with Graylog.  If not, see <http://www.gnu.org/licenses/>.\n+ */\n+package org.graylog2.contentpacks.facades;\n+\n+import com.fasterxml.jackson.databind.ObjectMapper;\n+import com.fasterxml.jackson.databind.jsontype.NamedType;\n+import com.google.common.io.Resources;\n+import com.lordofthejars.nosqlunit.annotation.UsingDataSet;\n+import com.lordofthejars.nosqlunit.core.LoadStrategyEnum;\n+import com.lordofthejars.nosqlunit.mongodb.InMemoryMongoDb;\n+import org.graylog.plugins.views.search.Query;\n+import org.graylog.plugins.views.search.Search;\n+import org.graylog.plugins.views.search.SearchRequirements;\n+import org.graylog.plugins.views.search.db.SearchDbService;\n+import org.graylog.plugins.views.search.filter.OrFilter;\n+import org.graylog.plugins.views.search.filter.QueryStringFilter;\n+import org.graylog.plugins.views.search.filter.StreamFilter;\n+import org.graylog.plugins.views.search.searchtypes.pivot.PivotSort;\n+import org.graylog.plugins.views.search.views.ViewDTO;\n+import org.graylog.plugins.views.search.views.ViewRequirements;\n+import org.graylog.plugins.views.search.views.ViewService;\n+import org.graylog.plugins.views.search.views.ViewStateDTO;\n+import org.graylog.plugins.views.search.views.WidgetDTO;\n+import org.graylog.plugins.views.search.views.widgets.aggregation.AggregationConfigDTO;\n+import org.graylog.plugins.views.search.views.widgets.aggregation.AutoIntervalDTO;\n+import org.graylog.plugins.views.search.views.widgets.aggregation.BarVisualizationConfigDTO;\n+import org.graylog.plugins.views.search.views.widgets.aggregation.LineVisualizationConfigDTO;\n+import org.graylog.plugins.views.search.views.widgets.aggregation.NumberVisualizationConfigDTO;\n+import org.graylog.plugins.views.search.views.widgets.aggregation.TimeHistogramConfigDTO;\n+import org.graylog.plugins.views.search.views.widgets.aggregation.ValueConfigDTO;\n+import org.graylog.plugins.views.search.views.widgets.aggregation.sort.PivotSortConfig;\n+import org.graylog.plugins.views.search.views.widgets.messagelist.MessageListConfigDTO;\n+import org.graylog2.bindings.providers.MongoJackObjectMapperProvider;\n+import org.graylog2.contentpacks.facades.dashboardV1.DashboardV1Facade;\n+import org.graylog2.contentpacks.model.ContentPack;\n+import org.graylog2.contentpacks.model.ContentPackV1;\n+import org.graylog2.contentpacks.model.ModelTypes;\n+import org.graylog2.contentpacks.model.entities.Entity;\n+import org.graylog2.contentpacks.model.entities.EntityDescriptor;\n+import org.graylog2.contentpacks.model.entities.NativeEntity;\n+import org.graylog2.contentpacks.model.entities.PivotEntity;\n+import org.graylog2.database.MongoConnection;\n+import org.graylog2.database.MongoConnectionRule;\n+import org.graylog2.database.NotFoundException;\n+import org.graylog2.plugin.cluster.ClusterConfigService;\n+import org.graylog2.shared.bindings.providers.ObjectMapperProvider;\n+import org.graylog2.streams.StreamImpl;\n+import org.junit.Before;\n+import org.junit.ClassRule;\n+import org.junit.Rule;\n+import org.junit.Test;\n+import org.testcontainers.shaded.com.google.common.collect.ImmutableMap;\n+\n+import java.net.URL;\n+import java.util.Collections;\n+import java.util.Date;\n+import java.util.HashMap;\n+import java.util.Map;\n+import java.util.Optional;\n+import java.util.Set;\n+import java.util.stream.Collectors;\n+\n+import static com.lordofthejars.nosqlunit.mongodb.InMemoryMongoDb.InMemoryMongoRuleBuilder.newInMemoryMongoDbRule;\n+import static org.assertj.core.api.Assertions.assertThat;\n+\n+public class DashboardV1FacadeTest {\n+\n+    @ClassRule\n+    public static final InMemoryMongoDb IN_MEMORY_MONGO_DB = newInMemoryMongoDbRule().build();\n+    @Rule\n+    public final MongoConnectionRule mongoRule = MongoConnectionRule.build(\"test\");\n+\n+    private final ObjectMapper objectMapper = new ObjectMapperProvider().get();\n+\n+    public static class TestSearchDBService extends SearchDbService {\n+        protected TestSearchDBService(MongoConnection mongoConnection,\n+                                      MongoJackObjectMapperProvider mapper) {\n+            super(mongoConnection, mapper, dto -> new SearchRequirements(Collections.emptySet(), dto));\n+        }\n+    }\n+\n+    public static class TestViewService extends ViewService {\n+        protected TestViewService(MongoConnection mongoConnection,\n+                                  MongoJackObjectMapperProvider mapper,\n+                                  ClusterConfigService clusterConfigService) {\n+            super(mongoConnection, mapper, clusterConfigService,\n+                    dto -> new ViewRequirements(Collections.emptySet(), dto));\n+        }\n+    }\n+\n+    private DashboardV1Facade facade;\n+    private ViewFacadeTest.TestViewService viewService;\n+    private ViewFacadeTest.TestSearchDBService searchDbService;\n+    private final String viewId = \"5def958063303ae5f68eccae\"; /* stored in database */\n+    private final String newViewId = \"5def958063303ae5f68edead\";\n+    private final String newStreamId = \"5def958063303ae5f68ebeaf\";\n+    private final String streamId = \"5cdab2293d27467fbe9e8a72\"; /* stored in database */\n+\n+\n+    @Before\n+    public void setUp() {\n+        objectMapper.registerSubtypes(new NamedType(AggregationConfigDTO.class, AggregationConfigDTO.NAME));\n+        objectMapper.registerSubtypes(new NamedType(MessageListConfigDTO.class, MessageListConfigDTO.NAME));\n+        objectMapper.registerSubtypes(new NamedType(LineVisualizationConfigDTO.class, LineVisualizationConfigDTO.NAME));\n+        objectMapper.registerSubtypes(new NamedType(BarVisualizationConfigDTO.class, BarVisualizationConfigDTO.NAME));\n+        objectMapper.registerSubtypes(new NamedType(NumberVisualizationConfigDTO.class, NumberVisualizationConfigDTO.NAME));\n+        objectMapper.registerSubtypes(new NamedType(TimeHistogramConfigDTO.class, TimeHistogramConfigDTO.NAME));\n+        objectMapper.registerSubtypes(new NamedType(ValueConfigDTO.class, ValueConfigDTO.NAME));\n+        objectMapper.registerSubtypes(new NamedType(PivotSortConfig.class, PivotSortConfig.Type));\n+        objectMapper.registerSubtypes(new NamedType(PivotEntity.class, PivotEntity.NAME));\n+        objectMapper.registerSubtypes(new NamedType(PivotSort.class, PivotSort.Type));\n+        objectMapper.registerSubtypes(new NamedType(OrFilter.class, OrFilter.NAME));\n+        objectMapper.registerSubtypes(new NamedType(StreamFilter.class, StreamFilter.NAME));\n+        objectMapper.registerSubtypes(new NamedType(QueryStringFilter.class, QueryStringFilter.NAME));\n+        objectMapper.registerSubtypes(new NamedType(AutoIntervalDTO.class, AutoIntervalDTO.type));\n+        searchDbService = new ViewFacadeTest.TestSearchDBService(mongoRule.getMongoConnection(),\n+                new MongoJackObjectMapperProvider(objectMapper));\n+        viewService = new ViewFacadeTest.TestViewService(mongoRule.getMongoConnection(),\n+                new MongoJackObjectMapperProvider(objectMapper), null);\n+        facade = new DashboardV1Facade(objectMapper, searchDbService, viewService);\n+    }\n+\n+    @Test\n+    @UsingDataSet(loadStrategy = LoadStrategyEnum.CLEAN_INSERT)\n+    public void shouldConvertAndInstallAOldDashboardAsNewView() throws Exception {\n+        final URL resourceUrl = Resources.getResource(DashboardV1Facade.class, \"content-pack-dashboard-v1.json\");\n+        final ContentPack contentPack = objectMapper.readValue(resourceUrl, ContentPack.class);\n+        assertThat(contentPack).isInstanceOf(ContentPackV1.class);\n+        final ContentPackV1 contentPackV1 = (ContentPackV1) contentPack;\n+        final Entity entity = contentPackV1.entities().iterator().next();\n+\n+        final StreamImpl stream = new StreamImpl(Collections.emptyMap());\n+        final Map<EntityDescriptor, Object> nativeEntities = new HashMap<>(1);\n+        nativeEntities.put(EntityDescriptor.create(\"58b3d55a-51ad-4b3e-865c-85776016a151\", ModelTypes.STREAM_V1), stream);\n+\n+        final NativeEntity<ViewDTO> nativeEntity = facade.createNativeEntity(entity,\n+                ImmutableMap.of(), nativeEntities, \"kmerz\");\n+        assertThat(nativeEntity).isNotNull();\n+\n+        final ViewDTO viewDTO = nativeEntity.entity();\n+        viewDOTShouldHaveGeneralInformation(viewDTO);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "97d35ff327b4a10b60bd71864d4d80dac801671a"}, "originalPosition": 155}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3900, "cost": 1, "resetAt": "2021-11-12T20:28:25Z"}}}