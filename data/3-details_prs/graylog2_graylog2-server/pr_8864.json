{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDczMTE4MjEw", "number": 8864, "title": "Improve `GraylogThemeProvider` rendering by streamlining state handling.", "bodyText": "Description\n\nMotivation and Context\n\n\nThis PR is refactoring the GraylogThemeProvider component's state handling to reduce the number of renderings required until it stabilizes (initially and after a theme change was triggered) and improve its readability.\nFor this, it removes the cascade of dependant useEffect + setStates and replaces them with a) straight variable assignments or b) useMemo. This allows us to reduce rendering counts from 10 initially/4 upon a theme change to 3 initially/1 upon a theme change. For better readibility, the handling of the user theme preference (getting and setting it) is extracted into the useCurrentThemeMode hook.\nSome additional cleanup was performed, also the debounce was removed as it seemed to be unneeded, because the toggle is disabled while the new theme is loading. If it turns out to be still required, it should be changed to use { leading: true, trailing: false } options, so it is preventing subsequent clicks but does not waste time by waiting for the trailing edge.\nHow Has This Been Tested?\n\n\n\nScreenshots (if appropriate):\nTypes of changes\n\n\n Bug fix (non-breaking change which fixes an issue)\n New feature (non-breaking change which adds functionality)\n Refactoring (non-breaking change)\n Breaking change (fix or feature that would cause existing functionality to change)\n\nChecklist:\n\n\n\n My code follows the code style of this project.\n My change requires a change to the documentation.\n I have updated the documentation accordingly.\n I have read the CONTRIBUTING document.\n I have added tests to cover my changes.", "createdAt": "2020-08-25T10:55:20Z", "url": "https://github.com/Graylog2/graylog2-server/pull/8864", "merged": true, "mergeCommit": {"oid": "a5e74438be6da8afcc4a787377e2d5d484ef5ad7"}, "closed": true, "closedAt": "2020-08-25T15:31:16Z", "author": {"login": "dennisoelkers"}, "timelineItems": {"totalCount": 11, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdCVFwvgH2gAyNDczMTE4MjEwOmU5MGIyZGM3MDQ3MzdlOWMwNWViODQ3N2I3OWEyNzVkYzY2ODQ1Y2Y=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdCXiLfAH2gAyNDczMTE4MjEwOmFmY2IyN2EzM2RjMGZhNmNiMTIyMzc0ZTZiMGEwNDA0NDViMGMyZTc=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "e90b2dc704737e9c05eb8477b79a275dc66845cf", "author": {"user": {"login": "dennisoelkers", "name": "Dennis Oelkers"}}, "url": "https://github.com/Graylog2/graylog2-server/commit/e90b2dc704737e9c05eb8477b79a275dc66845cf", "committedDate": "2020-08-25T10:59:23Z", "message": "Replacing `useEffect` with plain variable assignment."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "745fcf0c5e5965de6c534436842b2a9d7e3333a7", "author": {"user": {"login": "dennisoelkers", "name": "Dennis Oelkers"}}, "url": "https://github.com/Graylog2/graylog2-server/commit/745fcf0c5e5965de6c534436842b2a9d7e3333a7", "committedDate": "2020-08-25T10:59:23Z", "message": "Replacing unneeded `useState`/`useEffect` in `ThemeModeToggle`."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "455b9f82f72b7386ff7e6dfa63b2bd31ded04c7d", "author": {"user": {"login": "dennisoelkers", "name": "Dennis Oelkers"}}, "url": "https://github.com/Graylog2/graylog2-server/commit/455b9f82f72b7386ff7e6dfa63b2bd31ded04c7d", "committedDate": "2020-08-25T10:59:23Z", "message": "Replace `useEffect` + `setTheme` with `useMemo`."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "cb30e4bff9ded3cbd33f998c885e5f61f1e10c50", "author": {"user": {"login": "dennisoelkers", "name": "Dennis Oelkers"}}, "url": "https://github.com/Graylog2/graylog2-server/commit/cb30e4bff9ded3cbd33f998c885e5f61f1e10c50", "committedDate": "2020-08-25T10:59:24Z", "message": "Extracting `useCurrentThemeMode` hook, consolidating theme creation."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a004537da01179ddc353fcda35b2a1d19c9cd2e1", "author": {"user": {"login": "dennisoelkers", "name": "Dennis Oelkers"}}, "url": "https://github.com/Graylog2/graylog2-server/commit/a004537da01179ddc353fcda35b2a1d19c9cd2e1", "committedDate": "2020-08-25T10:59:24Z", "message": "Cleaning up debounce."}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "b257b5e6c04fb1ff32a39b4ee16ad9e8fc4bf459", "author": {"user": {"login": "dennisoelkers", "name": "Dennis Oelkers"}}, "url": "https://github.com/Graylog2/graylog2-server/commit/b257b5e6c04fb1ff32a39b4ee16ad9e8fc4bf459", "committedDate": "2020-08-25T10:59:12Z", "message": "Cleaning up debounce."}, "afterCommit": {"oid": "a004537da01179ddc353fcda35b2a1d19c9cd2e1", "author": {"user": {"login": "dennisoelkers", "name": "Dennis Oelkers"}}, "url": "https://github.com/Graylog2/graylog2-server/commit/a004537da01179ddc353fcda35b2a1d19c9cd2e1", "committedDate": "2020-08-25T10:59:24Z", "message": "Cleaning up debounce."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "8af9a9c578fc98bc7501cec46942a608ab51345b", "author": {"user": {"login": "dennisoelkers", "name": "Dennis Oelkers"}}, "url": "https://github.com/Graylog2/graylog2-server/commit/8af9a9c578fc98bc7501cec46942a608ab51345b", "committedDate": "2020-08-25T13:11:30Z", "message": "Using `defer` to execute theme change mode async."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDc0NDc1MDUz", "url": "https://github.com/Graylog2/graylog2-server/pull/8864#pullrequestreview-474475053", "createdAt": "2020-08-25T13:22:48Z", "commit": {"oid": "8af9a9c578fc98bc7501cec46942a608ab51345b"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDc0NDc2ODMw", "url": "https://github.com/Graylog2/graylog2-server/pull/8864#pullrequestreview-474476830", "createdAt": "2020-08-25T13:24:46Z", "commit": {"oid": "8af9a9c578fc98bc7501cec46942a608ab51345b"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yNVQxMzoyNDo0NlrOHGX6ZA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yNVQxMzoyNDo0NlrOHGX6ZA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NjQ0NTI4NA==", "bodyText": "To enable tree-shaking in lodash, you have to import functions using syntax like import foo from 'lodash/foo'.\nimport { foo } from 'lodash' will not tree-shake.\n\n  \n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            import { defer } from 'lodash';\n          \n          \n            \n            import defer from 'lodash/defer';", "url": "https://github.com/Graylog2/graylog2-server/pull/8864#discussion_r476445284", "createdAt": "2020-08-25T13:24:46Z", "author": {"login": "kyleknighted"}, "path": "graylog2-web-interface/src/components/navigation/ThemeModeToggle.jsx", "diffHunk": "@@ -2,7 +2,7 @@\n import * as React from 'react';\n import { useEffect, useState } from 'react';\n import styled, { css, withTheme, type StyledComponent } from 'styled-components';\n-import debounce from 'lodash/debounce';\n+import { defer } from 'lodash';", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "8af9a9c578fc98bc7501cec46942a608ab51345b"}, "originalPosition": 5}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDc0NDc5OTc1", "url": "https://github.com/Graylog2/graylog2-server/pull/8864#pullrequestreview-474479975", "createdAt": "2020-08-25T13:28:08Z", "commit": {"oid": "8af9a9c578fc98bc7501cec46942a608ab51345b"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "afcb27a33dc0fa6cb122374e6b0a040445b0c2e7", "author": {"user": {"login": "dennisoelkers", "name": "Dennis Oelkers"}}, "url": "https://github.com/Graylog2/graylog2-server/commit/afcb27a33dc0fa6cb122374e6b0a040445b0c2e7", "committedDate": "2020-08-25T13:50:14Z", "message": "Import specific function only."}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2867, "cost": 1, "resetAt": "2021-10-28T18:54:27Z"}}}