{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTM0Mzc4Mzg1", "number": 9721, "title": "Improving `connect` type inference regarding component `propTypes` and `defaultProps`.", "bodyText": "Description\nThis PR improves the type inference when using connect for a component which also uses defaultProps.  Previously we had a problem in the following case:\nComponent has a prop exampleProp. This prop is defined as required in the component Prop type, but has a default value. Since it has a default value, the PropTypes are defining the prop as optional. When we use this component the exampleProp is required. With this PR the exampleProp is typed as optional.\nTypes of changes\n\n\n Bug fix (non-breaking change which fixes an issue)\n New feature (non-breaking change which adds functionality)\n Refactoring (non-breaking change)\n Breaking change (fix or feature that would cause existing functionality to change)", "createdAt": "2020-12-08T11:15:39Z", "url": "https://github.com/Graylog2/graylog2-server/pull/9721", "merged": true, "mergeCommit": {"oid": "0810484de09060da64da41d5ac918eb599ee3ac5"}, "closed": true, "closedAt": "2020-12-10T12:18:35Z", "author": {"login": "linuspahl"}, "timelineItems": {"totalCount": 20, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdkGnh7gH2gAyNTM0Mzc4Mzg1OjA2N2E2M2QzMjlkMTQ1NDhhNzcwZDI3OWY3YzFjODIxZTUxMWM2MGM=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdkyWoggFqTU0OTEzOTM0Nw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "067a63d329d14548a770d279f7c1c821e511c60c", "author": {"user": {"login": "linuspahl", "name": "Linus Pahl"}}, "url": "https://github.com/Graylog2/graylog2-server/commit/067a63d329d14548a770d279f7c1c821e511c60c", "committedDate": "2020-12-08T09:21:07Z", "message": "Considering defaultProps and propTypes in connect type inference."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "47b600fc88efa1c6f7d1bfeacfbe86c1bc06778c", "author": {"user": {"login": "linuspahl", "name": "Linus Pahl"}}, "url": "https://github.com/Graylog2/graylog2-server/commit/47b600fc88efa1c6f7d1bfeacfbe86c1bc06778c", "committedDate": "2020-12-08T09:21:07Z", "message": "Remove `Widget` propTypes which are not compatible with prop type definition."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "9c57607f9578e625324773236725f7c81bfac4f5", "author": {"user": {"login": "linuspahl", "name": "Linus Pahl"}}, "url": "https://github.com/Graylog2/graylog2-server/commit/9c57607f9578e625324773236725f7c81bfac4f5", "committedDate": "2020-12-08T09:21:07Z", "message": "Remove `URLWhiteListFormModal` propTypes which are not compatible with prop type definition."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c89a37990f2df49b84b852b9a8179aeeafcc3568", "author": {"user": {"login": "linuspahl", "name": "Linus Pahl"}}, "url": "https://github.com/Graylog2/graylog2-server/commit/c89a37990f2df49b84b852b9a8179aeeafcc3568", "committedDate": "2020-12-08T09:21:07Z", "message": "Remove `StreamsRuleForm` propTypes which are not compatible with prop type definition."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "5941eedad8ba07e8fbce1d039403eef705342db3", "author": {"user": {"login": "linuspahl", "name": "Linus Pahl"}}, "url": "https://github.com/Graylog2/graylog2-server/commit/5941eedad8ba07e8fbce1d039403eef705342db3", "committedDate": "2020-12-08T09:21:07Z", "message": "Remove not needed type definition in `connect`."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d209c21215059022e046792bc14f9707305251e7", "author": {"user": {"login": "linuspahl", "name": "Linus Pahl"}}, "url": "https://github.com/Graylog2/graylog2-server/commit/d209c21215059022e046792bc14f9707305251e7", "committedDate": "2020-12-08T09:21:07Z", "message": "Add tests for `connect` typing."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "13951a8d7e783ca2f14309a53bfb95feaf572196", "author": {"user": {"login": "linuspahl", "name": "Linus Pahl"}}, "url": "https://github.com/Graylog2/graylog2-server/commit/13951a8d7e783ca2f14309a53bfb95feaf572196", "committedDate": "2020-12-08T09:21:07Z", "message": "Fix `StreamRuleForm` type definitions."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "dbf8900677fe10cb8b6001a8b91a6aaba113111d", "author": {"user": {"login": "linuspahl", "name": "Linus Pahl"}}, "url": "https://github.com/Graylog2/graylog2-server/commit/dbf8900677fe10cb8b6001a8b91a6aaba113111d", "committedDate": "2020-12-08T09:21:07Z", "message": "Define type for `DashboardSearchBar` config prop."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c93bb29e2cd80f3e345cfa0e8385c58379638f54", "author": {"user": {"login": "linuspahl", "name": "Linus Pahl"}}, "url": "https://github.com/Graylog2/graylog2-server/commit/c93bb29e2cd80f3e345cfa0e8385c58379638f54", "committedDate": "2020-12-08T09:21:07Z", "message": "Remove not needed code in `SavedSearchControls`."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "26fc1d51d1b105598a792714df451961f72958f4", "author": {"user": {"login": "linuspahl", "name": "Linus Pahl"}}, "url": "https://github.com/Graylog2/graylog2-server/commit/26fc1d51d1b105598a792714df451961f72958f4", "committedDate": "2020-12-08T09:21:07Z", "message": "Update `SavedSearchList` prop types."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e2d004e87458f3035466c999c4d622193b133786", "author": {"user": {"login": "linuspahl", "name": "Linus Pahl"}}, "url": "https://github.com/Graylog2/graylog2-server/commit/e2d004e87458f3035466c999c4d622193b133786", "committedDate": "2020-12-08T10:26:43Z", "message": "Removing empty line"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "32d98aa580a836ab2ec737aa8a056fcdb96037c5", "author": {"user": {"login": "linuspahl", "name": "Linus Pahl"}}, "url": "https://github.com/Graylog2/graylog2-server/commit/32d98aa580a836ab2ec737aa8a056fcdb96037c5", "committedDate": "2020-12-08T10:34:32Z", "message": "Implementing `instanceOf` for widget propType in `Widget`."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "11aa69f9eb3c6aa7119a480743d2ce42320cd495", "author": {"user": {"login": "linuspahl", "name": "Linus Pahl"}}, "url": "https://github.com/Graylog2/graylog2-server/commit/11aa69f9eb3c6aa7119a480743d2ce42320cd495", "committedDate": "2020-12-08T10:37:56Z", "message": "Removing not needed example component in `connect` test."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "2888bb6242fbe253233e603daa34ca769769b333", "author": {"user": {"login": "linuspahl", "name": "Linus Pahl"}}, "url": "https://github.com/Graylog2/graylog2-server/commit/2888bb6242fbe253233e603daa34ca769769b333", "committedDate": "2020-12-08T11:02:38Z", "message": "Adding test for defaultProps typing for `connect`."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "38c6d37c398aee8ca24c5279167df9829e19b325", "author": {"user": {"login": "linuspahl", "name": "Linus Pahl"}}, "url": "https://github.com/Graylog2/graylog2-server/commit/38c6d37c398aee8ca24c5279167df9829e19b325", "committedDate": "2020-12-08T11:14:02Z", "message": "Removing `instanceOf` in PropTypes of `Widget` because it is not working as expected and resulted in failing tests."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "2dafbba436ccf4f4e959a794fa78c29c9b8d7178", "author": {"user": {"login": "linuspahl", "name": "Linus Pahl"}}, "url": "https://github.com/Graylog2/graylog2-server/commit/2dafbba436ccf4f4e959a794fa78c29c9b8d7178", "committedDate": "2020-12-08T11:15:12Z", "message": "Fixing `connect` tests."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTQ4MTMzMTM3", "url": "https://github.com/Graylog2/graylog2-server/pull/9721#pullrequestreview-548133137", "createdAt": "2020-12-09T12:28:29Z", "commit": {"oid": "2dafbba436ccf4f4e959a794fa78c29c9b8d7178"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 6, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0wOVQxMjoyODoyOVrOICSKOQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0wOVQxMjozNjo0NFrOICSfBw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzOTI2NTU5Mw==", "bodyText": "We can do this instead:\n    urlType: PropTypes.oneOf(['regex', 'literal', ''] as const),", "url": "https://github.com/Graylog2/graylog2-server/pull/9721#discussion_r539265593", "createdAt": "2020-12-09T12:28:29Z", "author": {"login": "dennisoelkers"}, "path": "graylog2-web-interface/src/components/common/URLWhiteListFormModal.tsx", "diffHunk": "@@ -55,15 +55,14 @@ class URLWhiteListFormModal extends React.Component<Props, State> {\n     newUrlEntry: PropTypes.string,\n     onUpdate: PropTypes.func,\n     configuration: PropTypes.object,\n-    currentUser: PropTypes.object.isRequired,\n-    urlType: PropTypes.string,", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "2dafbba436ccf4f4e959a794fa78c29c9b8d7178"}, "originalPosition": 14}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzOTI2NTcxOA==", "bodyText": "We can do this instead:\n    currentUser: PropTypes.exact({\n      permissions: PropTypes.arrayOf(PropTypes.string),\n    }).isRequired,", "url": "https://github.com/Graylog2/graylog2-server/pull/9721#discussion_r539265718", "createdAt": "2020-12-09T12:28:42Z", "author": {"login": "dennisoelkers"}, "path": "graylog2-web-interface/src/components/common/URLWhiteListFormModal.tsx", "diffHunk": "@@ -55,15 +55,14 @@ class URLWhiteListFormModal extends React.Component<Props, State> {\n     newUrlEntry: PropTypes.string,\n     onUpdate: PropTypes.func,\n     configuration: PropTypes.object,\n-    currentUser: PropTypes.object.isRequired,", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "2dafbba436ccf4f4e959a794fa78c29c9b8d7178"}, "originalPosition": 13}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzOTI2NTk0Mg==", "bodyText": "If we use the suggestion above, we can remove this.", "url": "https://github.com/Graylog2/graylog2-server/pull/9721#discussion_r539265942", "createdAt": "2020-12-09T12:29:03Z", "author": {"login": "dennisoelkers"}, "path": "graylog2-web-interface/src/components/common/URLWhiteListFormModal.tsx", "diffHunk": "@@ -55,15 +55,14 @@ class URLWhiteListFormModal extends React.Component<Props, State> {\n     newUrlEntry: PropTypes.string,\n     onUpdate: PropTypes.func,\n     configuration: PropTypes.object,\n-    currentUser: PropTypes.object.isRequired,\n-    urlType: PropTypes.string,\n   };\n \n   static defaultProps = {\n     newUrlEntry: '',\n     onUpdate: () => { return undefined; },\n     configuration: {},\n-    urlType: '',\n+    // eslint-disable-next-line react/default-props-match-prop-types", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "2dafbba436ccf4f4e959a794fa78c29c9b8d7178"}, "originalPosition": 22}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzOTI3MDM2OA==", "bodyText": "I think we might be able to use CustomPropTypes.CurrentView` here.", "url": "https://github.com/Graylog2/graylog2-server/pull/9721#discussion_r539270368", "createdAt": "2020-12-09T12:35:53Z", "author": {"login": "dennisoelkers"}, "path": "graylog2-web-interface/src/views/components/widgets/Widget.tsx", "diffHunk": "@@ -129,14 +129,6 @@ const _editComponentForType = (type) => {\n class Widget extends React.Component<Props, State> {\n   static propTypes = {\n     id: PropTypes.string.isRequired,\n-    view: PropTypes.object.isRequired,", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "2dafbba436ccf4f4e959a794fa78c29c9b8d7178"}, "originalPosition": 4}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzOTI3MDY3Ng==", "bodyText": "Can we use PropTypes.instanceOf(WidgetModel) here?", "url": "https://github.com/Graylog2/graylog2-server/pull/9721#discussion_r539270676", "createdAt": "2020-12-09T12:36:24Z", "author": {"login": "dennisoelkers"}, "path": "graylog2-web-interface/src/views/components/widgets/Widget.tsx", "diffHunk": "@@ -129,14 +129,6 @@ const _editComponentForType = (type) => {\n class Widget extends React.Component<Props, State> {\n   static propTypes = {\n     id: PropTypes.string.isRequired,\n-    view: PropTypes.object.isRequired,\n-    widget: PropTypes.shape({", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "2dafbba436ccf4f4e959a794fa78c29c9b8d7178"}, "originalPosition": 5}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzOTI3MDkxOQ==", "bodyText": "Can we use PropTypes.instanceOf(WidgetPosition) here?", "url": "https://github.com/Graylog2/graylog2-server/pull/9721#discussion_r539270919", "createdAt": "2020-12-09T12:36:44Z", "author": {"login": "dennisoelkers"}, "path": "graylog2-web-interface/src/views/components/widgets/Widget.tsx", "diffHunk": "@@ -146,7 +138,6 @@ class Widget extends React.Component<Props, State> {\n     onSizeChange: PropTypes.func.isRequired,\n     onPositionsChange: PropTypes.func.isRequired,\n     title: PropTypes.string.isRequired,\n-    position: PropTypes.object.isRequired,", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "2dafbba436ccf4f4e959a794fa78c29c9b8d7178"}, "originalPosition": 19}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "4edcf73525201958397f8f232427b38567f81b82", "author": {"user": {"login": "linuspahl", "name": "Linus Pahl"}}, "url": "https://github.com/Graylog2/graylog2-server/commit/4edcf73525201958397f8f232427b38567f81b82", "committedDate": "2020-12-09T15:26:12Z", "message": "Improving `URLWhiteListFormModal` prop-types."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "5123f547162103f278fd1e5568933f5025f3ec52", "author": {"user": {"login": "linuspahl", "name": "Linus Pahl"}}, "url": "https://github.com/Graylog2/graylog2-server/commit/5123f547162103f278fd1e5568933f5025f3ec52", "committedDate": "2020-12-09T16:01:23Z", "message": "Improving `Widget` prop-types and updating `Widget.test`."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTQ5MTM5MzQ3", "url": "https://github.com/Graylog2/graylog2-server/pull/9721#pullrequestreview-549139347", "createdAt": "2020-12-10T12:18:29Z", "commit": {"oid": "5123f547162103f278fd1e5568933f5025f3ec52"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3306, "cost": 1, "resetAt": "2021-10-28T18:54:27Z"}}}