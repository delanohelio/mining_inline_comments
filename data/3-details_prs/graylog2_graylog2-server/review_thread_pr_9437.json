{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTE5MDcxMzYw", "number": 9437, "reviewThreads": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xMVQxMDoxMTo0N1rOE3o85w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xMVQxMjoxMDozN1rOE3rX7g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzI2Nzc4MDg3OnYy", "diffSide": "RIGHT", "path": "graylog2-server/src/main/java/org/graylog2/rest/resources/users/UsersResource.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xMVQxMDoxMTo0N1rOHxGs7Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xMVQxMDoxNDoxMVrOHxGyGw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMTI1MjA3Nw==", "bodyText": "We have @Context UserContext userContext for this now.", "url": "https://github.com/Graylog2/graylog2-server/pull/9437#discussion_r521252077", "createdAt": "2020-11-11T10:11:47Z", "author": {"login": "mpfz0r"}, "path": "graylog2-server/src/main/java/org/graylog2/rest/resources/users/UsersResource.java", "diffHunk": "@@ -556,11 +557,17 @@ public void changePassword(\n     @ApiOperation(\"Update the account status for a user\")\n     @AuditEvent(type = AuditEventTypes.USER_UPDATE)\n     public Response updateAccountStatus(\n-            @ApiParam(name = \"userId\", value = \"The id of the user whose status to change.\", required = true) @PathParam(\"userId\") String userId,\n+            @ApiParam(name = \"userId\", value = \"The id of the user whose status to change.\", required = true)\n+            @PathParam(\"userId\") @NotBlank String userId,\n             @ApiParam(name = \"newStatus\", value = \"The account status to be set\", required = true,\n-                    defaultValue = \"enabled\", allowableValues = \"enabled,disabled,deleted\")\n+                      defaultValue = \"enabled\", allowableValues = \"enabled,disabled,deleted\")\n             @PathParam(\"newStatus\") @NotBlank String newStatusString) throws ValidationException {\n \n+        final User currentUser = requireNonNull(getCurrentUser(), \"currentUser cannot be null\");", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "09f80bddf2a25eeb93e959902b53e7c8ef6c9732"}, "originalPosition": 20}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMTI1MzQwMw==", "bodyText": "Hah, you are right! \ud83d\ude04 I will change it. Thank you!", "url": "https://github.com/Graylog2/graylog2-server/pull/9437#discussion_r521253403", "createdAt": "2020-11-11T10:14:11Z", "author": {"login": "bernd"}, "path": "graylog2-server/src/main/java/org/graylog2/rest/resources/users/UsersResource.java", "diffHunk": "@@ -556,11 +557,17 @@ public void changePassword(\n     @ApiOperation(\"Update the account status for a user\")\n     @AuditEvent(type = AuditEventTypes.USER_UPDATE)\n     public Response updateAccountStatus(\n-            @ApiParam(name = \"userId\", value = \"The id of the user whose status to change.\", required = true) @PathParam(\"userId\") String userId,\n+            @ApiParam(name = \"userId\", value = \"The id of the user whose status to change.\", required = true)\n+            @PathParam(\"userId\") @NotBlank String userId,\n             @ApiParam(name = \"newStatus\", value = \"The account status to be set\", required = true,\n-                    defaultValue = \"enabled\", allowableValues = \"enabled,disabled,deleted\")\n+                      defaultValue = \"enabled\", allowableValues = \"enabled,disabled,deleted\")\n             @PathParam(\"newStatus\") @NotBlank String newStatusString) throws ValidationException {\n \n+        final User currentUser = requireNonNull(getCurrentUser(), \"currentUser cannot be null\");", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMTI1MjA3Nw=="}, "originalCommit": {"oid": "09f80bddf2a25eeb93e959902b53e7c8ef6c9732"}, "originalPosition": 20}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzI2ODE3Nzc0OnYy", "diffSide": "RIGHT", "path": "graylog2-web-interface/src/components/users/UsersOverview/UserOverviewItem/ActionsCell.jsx", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xMVQxMjoxMDozN1rOHxKgaA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xMVQxMjoxMDozN1rOHxKgaA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMTMxNDQwOA==", "bodyText": "When disabling a user and closing the confirm dialog, UsersDomain.setStatus(id, 'enabled'); is being called and the API responds with Error: Not Modified", "url": "https://github.com/Graylog2/graylog2-server/pull/9437#discussion_r521314408", "createdAt": "2020-11-11T12:10:37Z", "author": {"login": "linuspahl"}, "path": "graylog2-web-interface/src/components/users/UsersOverview/UserOverviewItem/ActionsCell.jsx", "diffHunk": "@@ -50,9 +52,17 @@ const ReadOnlyActions = ({ user }: { user: UserOverview }) => {\n };\n \n const EditActions = ({ user, user: { username, id, fullName, accountStatus, external, readOnly } }: { user: UserOverview }) => {\n+  const currentUser = useContext(CurrentUserContext) || {};\n+\n   const _toggleStatus = () => {\n-    const newStatus = accountStatus === 'enabled' ? 'disabled' : 'enabled';\n-    UsersDomain.setStatus(id, newStatus);\n+    // eslint-disable-next-line no-alert\n+    if (accountStatus === 'enabled' && window.confirm(`Do you really want to disable user ${fullName}? All current sessions will be terminated.`)) {\n+      UsersDomain.setStatus(id, 'disabled');\n+\n+      return;\n+    }\n+\n+    UsersDomain.setStatus(id, 'enabled');", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "42db1c9085452ddc77753212a63b2522dbfb72d4"}, "originalPosition": 26}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4412, "cost": 1, "resetAt": "2021-11-12T20:28:25Z"}}}