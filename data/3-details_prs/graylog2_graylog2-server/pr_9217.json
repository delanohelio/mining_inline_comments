{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTA2ODAwNjIx", "number": 9217, "title": "Use user ID instead of username for user management API calls", "bodyText": "Description\nPreviously most user management related API calls were based on the username, with this PR we are using the user id instead. This way we can use the user id for all user management related URLs like /system/users/[user-id]/edit.\nHere is an overview of all endpoint changes\n\nuser update /users/${username}  => /users/${userId}\nuser password change /users/${username}/password  => /users/${userId}/password\nuser token create and delete /users/${username}/tokens/${tokenName}  => /users/${userId}/tokens/${tokenName}\nuser tokens list /users/${username}/tokens/${tokenName} => /users/${userId}/tokens/${tokenName}\n\nOnly the user delete endpoint did not changed\nFixes: #9238\nFixes: #9192", "createdAt": "2020-10-20T13:28:01Z", "url": "https://github.com/Graylog2/graylog2-server/pull/9217", "merged": true, "mergeCommit": {"oid": "bfab844eeea6d3fad14464c17caeef5c30c92764"}, "closed": true, "closedAt": "2020-10-28T16:54:21Z", "author": {"login": "mpfz0r"}, "timelineItems": {"totalCount": 25, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdWUfx9gBqjM5MjA3NDA4MTM=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdXAhh5gFqTUxODg4MzA4MQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "032c4524b0c201368d46065040bcfcdbb158b155", "author": {"user": {"login": "mpfz0r", "name": "Marco Pfatschbacher"}}, "url": "https://github.com/Graylog2/graylog2-server/commit/032c4524b0c201368d46065040bcfcdbb158b155", "committedDate": "2020-10-26T10:43:34Z", "message": "Change shares/user endpoint to userId as well"}, "afterCommit": {"oid": "0edcfb1e2fa7a82a2d8f2169ba7348aaabd0d029", "author": {"user": {"login": "mpfz0r", "name": "Marco Pfatschbacher"}}, "url": "https://github.com/Graylog2/graylog2-server/commit/0edcfb1e2fa7a82a2d8f2169ba7348aaabd0d029", "committedDate": "2020-10-26T13:36:11Z", "message": "Change shares/user endpoint to userId as well"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "0edcfb1e2fa7a82a2d8f2169ba7348aaabd0d029", "author": {"user": {"login": "mpfz0r", "name": "Marco Pfatschbacher"}}, "url": "https://github.com/Graylog2/graylog2-server/commit/0edcfb1e2fa7a82a2d8f2169ba7348aaabd0d029", "committedDate": "2020-10-26T13:36:11Z", "message": "Change shares/user endpoint to userId as well"}, "afterCommit": {"oid": "db678a8af8d785805dacd985608d929757d6e796", "author": {"user": {"login": "mpfz0r", "name": "Marco Pfatschbacher"}}, "url": "https://github.com/Graylog2/graylog2-server/commit/db678a8af8d785805dacd985608d929757d6e796", "committedDate": "2020-10-27T14:31:29Z", "message": "Change more user endpoints to userId"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "5685d18b1c2699249903981ed0e508f8d43f63a0", "author": {"user": {"login": "linuspahl", "name": "Linus Pahl"}}, "url": "https://github.com/Graylog2/graylog2-server/commit/5685d18b1c2699249903981ed0e508f8d43f63a0", "committedDate": "2020-10-27T18:13:59Z", "message": "Use user id instead of username for api calls on user management pages"}, "afterCommit": {"oid": "5e7a6bc92261d79de1f357cd85d664448283a77d", "author": {"user": {"login": "linuspahl", "name": "Linus Pahl"}}, "url": "https://github.com/Graylog2/graylog2-server/commit/5e7a6bc92261d79de1f357cd85d664448283a77d", "committedDate": "2020-10-27T18:18:23Z", "message": "Use user id instead of username for api calls on user management pages"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTE4NDQyODE1", "url": "https://github.com/Graylog2/graylog2-server/pull/9217#pullrequestreview-518442815", "createdAt": "2020-10-28T08:59:02Z", "commit": {"oid": "ce2392be8ac6ae2f0fd4da225bd13ce3ebf66a15"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yOFQwODo1OTowM1rOHpf5XQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yOFQwOToyNDo1N1rOHpg4fQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMzI3NjI1Mw==", "bodyText": "The endpoint is /users not /system/users.", "url": "https://github.com/Graylog2/graylog2-server/pull/9217#discussion_r513276253", "createdAt": "2020-10-28T08:59:03Z", "author": {"login": "bernd"}, "path": "UPGRADING.rst", "diffHunk": "@@ -11,6 +11,11 @@ Prior to v3.3.3, the certificates of LDAP servers which are connected to using a\n \n A `CVE <https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2020-15813>`_ is tracked for this issue.\n \n+Change of API endpoint for user retrieval and modification\n+==========================================================\n+\n+In 4.0 we changed most of the user API endpoint `/system/users` to expect user IDs instead of names.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ce2392be8ac6ae2f0fd4da225bd13ce3ebf66a15"}, "originalPosition": 7}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMzI4NjM5OQ==", "bodyText": "How about putting the handling code into a separate method so we don't duplicate the same code in get and getbyId? \ud83d\ude04", "url": "https://github.com/Graylog2/graylog2-server/pull/9217#discussion_r513286399", "createdAt": "2020-10-28T09:15:28Z", "author": {"login": "bernd"}, "path": "graylog2-server/src/main/java/org/graylog2/rest/resources/users/UsersResource.java", "diffHunk": "@@ -173,6 +174,32 @@ public UserSummary get(@ApiParam(name = \"username\", value = \"The username to ret\n         return toUserResponse(user, isSelf || canEditUserPermissions, AllUserSessions.create(sessionService));\n     }\n \n+    @GET\n+    @Path(\"id/{userId}\")\n+    @ApiOperation(value = \"Get user details by userId\", notes = \"The user's permissions are only included if a user asks for his \" +\n+            \"own account or for users with the necessary permissions to edit permissions.\")\n+    @ApiResponses({\n+            @ApiResponse(code = 404, message = \"The user could not be found.\")\n+    })\n+    public UserSummary getbyId(@ApiParam(name = \"userId\", value = \"The userId to return information for.\", required = true)\n+                           @PathParam(\"userId\") String userId,\n+                           @Context UserContext userContext) {\n+\n+        final User user = loadUserById(userId);\n+        final String username = user.getName();\n+        // If a user has permissions to edit another user's profile, it should be able to see it.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "96c5a5184ad294dc4dd4f09e535a20f5965c507a"}, "originalPosition": 25}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMzI5MjQxMw==", "bodyText": "Why don't we delete users by ID and still use the username for that?", "url": "https://github.com/Graylog2/graylog2-server/pull/9217#discussion_r513292413", "createdAt": "2020-10-28T09:24:57Z", "author": {"login": "bernd"}, "path": "graylog2-web-interface/src/actions/users/UsersActions.js", "diffHunk": "@@ -40,13 +40,14 @@ export type PaginatedUsers = PaginatedList<UserOverview> & {\n \n export type ActionsType = {\n   create: (user: UserCreate) => Promise<void>,\n-  load: (username: string) => Promise<User>,\n-  update: (username: string, request: any) => Promise<void>,\n-  delete: (username: string) => Promise<void>,\n-  changePassword: (username: string, request: ChangePasswordRequest) => Promise<void>,\n-  createToken: (username: string, tokenName: string) => Promise<Token>,\n-  loadTokens: (username: string) => Promise<Token[]>,\n-  deleteToken: (username: string, tokenId: string, tokenName: string) => Promise<void>,\n+  load: (userId: string) => Promise<User>,\n+  loadByUsername: (username: string) => Promise<User>,\n+  update: (userId: string, request: any) => Promise<void>,\n+  delete: (username: string, fullName: string) => Promise<void>,", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "96c5a5184ad294dc4dd4f09e535a20f5965c507a"}, "originalPosition": 14}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTE4NDc1NDM3", "url": "https://github.com/Graylog2/graylog2-server/pull/9217#pullrequestreview-518475437", "createdAt": "2020-10-28T09:38:28Z", "commit": {"oid": "96c5a5184ad294dc4dd4f09e535a20f5965c507a"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yOFQwOTozODoyOFrOHpha7w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yOFQwOTozODoyOFrOHpha7w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMzMwMTIzMQ==", "bodyText": "for permission we need to use the username", "url": "https://github.com/Graylog2/graylog2-server/pull/9217#discussion_r513301231", "createdAt": "2020-10-28T09:38:28Z", "author": {"login": "kmerz"}, "path": "graylog2-web-interface/src/pages/UserTokensEditPage.jsx", "diffHunk": "@@ -31,16 +31,16 @@ const PageTitle = ({ fullName }: {fullName: ?string}) => (\n   </>\n );\n \n-const _loadTokens = (username, currentUser, setTokens) => {\n-  if (isPermitted(currentUser?.permissions, [`users:tokenlist:${username}`])) {\n-    UsersDomain.loadTokens(username).then(setTokens);\n+const _loadTokens = (userId, currentUser, setTokens) => {\n+  if (isPermitted(currentUser?.permissions, [`users:tokenlist:${userId}`])) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "96c5a5184ad294dc4dd4f09e535a20f5965c507a"}, "originalPosition": 17}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTE4NzQxMTI1", "url": "https://github.com/Graylog2/graylog2-server/pull/9217#pullrequestreview-518741125", "createdAt": "2020-10-28T14:43:45Z", "commit": {"oid": "e8b8ee8996f532b734481dbe582f8838c6d531ec"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "59322883a0c4391668b53e53d112088e651223ad", "author": {"user": {"login": "mpfz0r", "name": "Marco Pfatschbacher"}}, "url": "https://github.com/Graylog2/graylog2-server/commit/59322883a0c4391668b53e53d112088e651223ad", "committedDate": "2020-10-28T15:17:45Z", "message": "Add Resource to load user by userId"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "bb8969aa4a6adcab966732b2c24255c9efc2c0e3", "author": {"user": {"login": "mpfz0r", "name": "Marco Pfatschbacher"}}, "url": "https://github.com/Graylog2/graylog2-server/commit/bb8969aa4a6adcab966732b2c24255c9efc2c0e3", "committedDate": "2020-10-28T15:17:46Z", "message": "Change shares/user endpoint to userId as well"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f625b62b20e6efc105d6564d5264c1fc34414595", "author": {"user": {"login": "mpfz0r", "name": "Marco Pfatschbacher"}}, "url": "https://github.com/Graylog2/graylog2-server/commit/f625b62b20e6efc105d6564d5264c1fc34414595", "committedDate": "2020-10-28T15:17:46Z", "message": "Change more user endpoints to userId"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "6510efb81645d893611ca126dab3a6044a4208df", "author": {"user": {"login": "mpfz0r", "name": "Marco Pfatschbacher"}}, "url": "https://github.com/Graylog2/graylog2-server/commit/6510efb81645d893611ca126dab3a6044a4208df", "committedDate": "2020-10-28T15:17:46Z", "message": "Add API change note to UPGRADING"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "1c06fa2ce05c5f6b1b287070b3a781ed73d8b923", "author": {"user": {"login": "mpfz0r", "name": "Marco Pfatschbacher"}}, "url": "https://github.com/Graylog2/graylog2-server/commit/1c06fa2ce05c5f6b1b287070b3a781ed73d8b923", "committedDate": "2020-10-28T15:17:46Z", "message": "Adopt to AllUserSessions change"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "5ef9e41a1b50240a3862446860691f44700962ad", "author": {"user": {"login": "linuspahl", "name": "Linus Pahl"}}, "url": "https://github.com/Graylog2/graylog2-server/commit/5ef9e41a1b50240a3862446860691f44700962ad", "committedDate": "2020-10-28T15:17:46Z", "message": "Use user id instead of username for api calls on user management pages"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "24b40babf36798aaa77a273d93308f84eff21f51", "author": {"user": {"login": "linuspahl", "name": "Linus Pahl"}}, "url": "https://github.com/Graylog2/graylog2-server/commit/24b40babf36798aaa77a273d93308f84eff21f51", "committedDate": "2020-10-28T15:17:46Z", "message": "Fix user edit and details link in user menu"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "1880404a49215cf9d7a656415267cd459b15a062", "author": {"user": {"login": "linuspahl", "name": "Linus Pahl"}}, "url": "https://github.com/Graylog2/graylog2-server/commit/1880404a49215cf9d7a656415267cd459b15a062", "committedDate": "2020-10-28T15:17:46Z", "message": "Fix user link in shared entities overview"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e69061fdb129c8fbe9bfe504d80d16da94164fc5", "author": {"user": {"login": "linuspahl", "name": "Linus Pahl"}}, "url": "https://github.com/Graylog2/graylog2-server/commit/e69061fdb129c8fbe9bfe504d80d16da94164fc5", "committedDate": "2020-10-28T15:17:46Z", "message": "Remove not needed component UserManagementLinks"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a94373d351bb782ade943debc8d9cfee5d2a73cd", "author": {"user": {"login": "linuspahl", "name": "Linus Pahl"}}, "url": "https://github.com/Graylog2/graylog2-server/commit/a94373d351bb782ade943debc8d9cfee5d2a73cd", "committedDate": "2020-10-28T15:17:46Z", "message": "Fix linter warnings and tests"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "fc82d7200e6134e0d825bb3d9cb4286a0f4b9172", "author": {"user": {"login": "linuspahl", "name": "Linus Pahl"}}, "url": "https://github.com/Graylog2/graylog2-server/commit/fc82d7200e6134e0d825bb3d9cb4286a0f4b9172", "committedDate": "2020-10-28T15:17:46Z", "message": "Remove not needed encodeURIComponent and fix system admin edit tokens link"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a34aab5b50ec98c3d27fc6bd08b49a98f6cc00c0", "author": {"user": {"login": "linuspahl", "name": "Linus Pahl"}}, "url": "https://github.com/Graylog2/graylog2-server/commit/a34aab5b50ec98c3d27fc6bd08b49a98f6cc00c0", "committedDate": "2020-10-28T15:17:47Z", "message": "Fix permissions check for user tokens edit page"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "0753649121c16fd99095147bd0d0f52c63f5d1f1", "author": {"user": {"login": "mpfz0r", "name": "Marco Pfatschbacher"}}, "url": "https://github.com/Graylog2/graylog2-server/commit/0753649121c16fd99095147bd0d0f52c63f5d1f1", "committedDate": "2020-10-28T15:17:47Z", "message": "Mention correct /users endpoint in UPGRADING.rst"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b40e62520994fcaa5bb24176ccf1d0569e2624d1", "author": {"user": {"login": "mpfz0r", "name": "Marco Pfatschbacher"}}, "url": "https://github.com/Graylog2/graylog2-server/commit/b40e62520994fcaa5bb24176ccf1d0569e2624d1", "committedDate": "2020-10-28T15:17:47Z", "message": "Reduce code duplication"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "1122471d1287112fc8de2c05f26079662077dc65", "author": {"user": {"login": "mpfz0r", "name": "Marco Pfatschbacher"}}, "url": "https://github.com/Graylog2/graylog2-server/commit/1122471d1287112fc8de2c05f26079662077dc65", "committedDate": "2020-10-28T15:17:47Z", "message": "Implement deleteUserById  (DELETE /users/id/{userId})"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "dc8df3a16da4b5c00e52eea334edf76f0ee80d0a", "author": {"user": {"login": "mpfz0r", "name": "Marco Pfatschbacher"}}, "url": "https://github.com/Graylog2/graylog2-server/commit/dc8df3a16da4b5c00e52eea334edf76f0ee80d0a", "committedDate": "2020-10-28T15:17:47Z", "message": "Actually call deleteById from UsersResource :-D"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "4e6ba83d31a6f53572bae18f23f7588238aede03", "author": {"user": {"login": "linuspahl", "name": "Linus Pahl"}}, "url": "https://github.com/Graylog2/graylog2-server/commit/4e6ba83d31a6f53572bae18f23f7588238aede03", "committedDate": "2020-10-28T15:24:25Z", "message": "Use /users/id/[user-id] instead of /users/[username] endpoint to delete a user"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "e8b8ee8996f532b734481dbe582f8838c6d531ec", "author": {"user": {"login": "mpfz0r", "name": "Marco Pfatschbacher"}}, "url": "https://github.com/Graylog2/graylog2-server/commit/e8b8ee8996f532b734481dbe582f8838c6d531ec", "committedDate": "2020-10-28T13:35:06Z", "message": "Actually call deleteById from UsersResource :-D"}, "afterCommit": {"oid": "4e6ba83d31a6f53572bae18f23f7588238aede03", "author": {"user": {"login": "linuspahl", "name": "Linus Pahl"}}, "url": "https://github.com/Graylog2/graylog2-server/commit/4e6ba83d31a6f53572bae18f23f7588238aede03", "committedDate": "2020-10-28T15:24:25Z", "message": "Use /users/id/[user-id] instead of /users/[username] endpoint to delete a user"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTE4ODgzMDgx", "url": "https://github.com/Graylog2/graylog2-server/pull/9217#pullrequestreview-518883081", "createdAt": "2020-10-28T16:54:07Z", "commit": {"oid": "4e6ba83d31a6f53572bae18f23f7588238aede03"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3434, "cost": 1, "resetAt": "2021-10-28T18:54:27Z"}}}