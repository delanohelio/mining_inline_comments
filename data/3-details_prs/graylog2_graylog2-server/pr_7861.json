{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDAxODUxMzA3", "number": 7861, "title": "Provide global context for current user preferences.", "bodyText": "Description\n\nMotivation and Context\n\n\nThis PR is providing a context containing user preferences (right now\nuntyped key/value pairs) that can be consumed by react components. A\ndefault provider taking preferences from the currently logged in user\nwas created and employed in the LoggedInPage component so it is\navailable everywhere after a user's login.\nIn addition, the PreferencesStore is turned into using proper Reflux\nactions and the CurrentUserStore listens to the action to save\npreferences in order to reload its state after it has completed. This\nmakes changing preferences of a user effective in the CurrentUserStore\nimmediately.\nHow Has This Been Tested?\n\n\n\nScreenshots (if appropriate):\nTypes of changes\n\n\n Bug fix (non-breaking change which fixes an issue)\n New feature (non-breaking change which adds functionality)\n Refactoring (non-breaking change)\n Breaking change (fix or feature that would cause existing functionality to change)\n\nChecklist:\n\n\n\n My code follows the code style of this project.\n My change requires a change to the documentation.\n I have updated the documentation accordingly.\n I have read the CONTRIBUTING document.\n I have added tests to cover my changes.", "createdAt": "2020-04-10T10:19:25Z", "url": "https://github.com/Graylog2/graylog2-server/pull/7861", "merged": true, "mergeCommit": {"oid": "d81588c34dabc055b5d35e6649104a0e4dd437e9"}, "closed": true, "closedAt": "2020-04-15T15:02:42Z", "author": {"login": "dennisoelkers"}, "timelineItems": {"totalCount": 12, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcWO_VgAH2gAyNDAxODUxMzA3Ojg1YjZjY2I4YjY3NWY0Y2FjMmQxMmFlOTQyNDRlZTFhMzg5NDU2NTk=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcX5c-vgFqTM5Mzg2MzMyNA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "85b6ccb8b675f4cac2d12ae94244ee1a38945659", "author": {"user": {"login": "dennisoelkers", "name": "Dennis Oelkers"}}, "url": "https://github.com/Graylog2/graylog2-server/commit/85b6ccb8b675f4cac2d12ae94244ee1a38945659", "committedDate": "2020-04-10T11:00:16Z", "message": "Creating user preferences context and default provider."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "5ce3ac49fc954ad5d540800c8a1cd82c2eb18732", "author": {"user": {"login": "dennisoelkers", "name": "Dennis Oelkers"}}, "url": "https://github.com/Graylog2/graylog2-server/commit/5ce3ac49fc954ad5d540800c8a1cd82c2eb18732", "committedDate": "2020-04-10T11:00:17Z", "message": "Use default user preferences provider to wrap when logged in."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "99672e70908d6109e0e5cbc8608a4c84b6e1ba3b", "author": {"user": {"login": "dennisoelkers", "name": "Dennis Oelkers"}}, "url": "https://github.com/Graylog2/graylog2-server/commit/99672e70908d6109e0e5cbc8608a4c84b6e1ba3b", "committedDate": "2020-04-10T11:00:17Z", "message": "Make PreferencesStore use actions."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "4b46384e211f81bf1533594137b6d4bcbdd9fc51", "author": {"user": {"login": "dennisoelkers", "name": "Dennis Oelkers"}}, "url": "https://github.com/Graylog2/graylog2-server/commit/4b46384e211f81bf1533594137b6d4bcbdd9fc51", "committedDate": "2020-04-10T11:00:17Z", "message": "Also export mocks with names usable in `jest.mock()` calls."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "615cb866ad583138b9fefca1fd675ac10594f87b", "author": {"user": {"login": "dennisoelkers", "name": "Dennis Oelkers"}}, "url": "https://github.com/Graylog2/graylog2-server/commit/615cb866ad583138b9fefca1fd675ac10594f87b", "committedDate": "2020-04-10T11:00:17Z", "message": "Fix linter hints in `CombinedProviderMock`."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "40658eb569de1b658692d1ef61065fd1cd880e90", "author": {"user": {"login": "dennisoelkers", "name": "Dennis Oelkers"}}, "url": "https://github.com/Graylog2/graylog2-server/commit/40658eb569de1b658692d1ef61065fd1cd880e90", "committedDate": "2020-04-10T11:00:17Z", "message": "Make `CurrentUserStore` reload when preferences are saved."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a1502b86dd10b986a4d6dffcb09d27d40ce8cff2", "author": {"user": {"login": "dennisoelkers", "name": "Dennis Oelkers"}}, "url": "https://github.com/Graylog2/graylog2-server/commit/a1502b86dd10b986a4d6dffcb09d27d40ce8cff2", "committedDate": "2020-04-10T11:02:59Z", "message": "Fixing linter hints."}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "78d9079e83fada7ea3c3c449451195028aa7db19", "author": {"user": {"login": "dennisoelkers", "name": "Dennis Oelkers"}}, "url": "https://github.com/Graylog2/graylog2-server/commit/78d9079e83fada7ea3c3c449451195028aa7db19", "committedDate": "2020-04-10T10:14:26Z", "message": "Make `CurrentUserStore` reload when preferences are saved."}, "afterCommit": {"oid": "a1502b86dd10b986a4d6dffcb09d27d40ce8cff2", "author": {"user": {"login": "dennisoelkers", "name": "Dennis Oelkers"}}, "url": "https://github.com/Graylog2/graylog2-server/commit/a1502b86dd10b986a4d6dffcb09d27d40ce8cff2", "committedDate": "2020-04-10T11:02:59Z", "message": "Fixing linter hints."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzkyODkwMTQ5", "url": "https://github.com/Graylog2/graylog2-server/pull/7861#pullrequestreview-392890149", "createdAt": "2020-04-14T12:46:02Z", "commit": {"oid": "a1502b86dd10b986a4d6dffcb09d27d40ce8cff2"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xNFQxMjo0NjowMlrOGFM4IQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xNFQxMjo0NjowMlrOGFM4IQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwODEwNzA0MQ==", "bodyText": "What is the reason to use CombinedProvider.get( here? Compared with import CurrentUserStore from 'stores/users/CurrentUserStore'; the only difference is that using the CombinedProvider, preferences is not undefined initially.", "url": "https://github.com/Graylog2/graylog2-server/pull/7861#discussion_r408107041", "createdAt": "2020-04-14T12:46:02Z", "author": {"login": "linuspahl"}, "path": "graylog2-web-interface/src/contexts/CurrentUserPreferencesProvider.jsx", "diffHunk": "@@ -0,0 +1,27 @@\n+// @flow strict\n+import * as React from 'react';\n+import PropTypes from 'prop-types';\n+import { get } from 'lodash';\n+\n+import { useStore } from 'stores/connect';\n+import CombinedProvider from 'injection/CombinedProvider';\n+import UserPreferencesContext from './UserPreferencesContext';\n+\n+const { CurrentUserStore } = CombinedProvider.get('CurrentUser');", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a1502b86dd10b986a4d6dffcb09d27d40ce8cff2"}, "originalPosition": 10}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzkyOTA5ODU2", "url": "https://github.com/Graylog2/graylog2-server/pull/7861#pullrequestreview-392909856", "createdAt": "2020-04-14T13:10:22Z", "commit": {"oid": "a1502b86dd10b986a4d6dffcb09d27d40ce8cff2"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xNFQxMzoxMDoyMlrOGFN2nw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xNFQxMzoxMDoyMlrOGFN2nw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwODEyMzAzOQ==", "bodyText": "One thought regarding the placement, which does not require a change right now: At some point it will be very useful to wrap the <GraylogThemeProvider> with the <CurrentUserPreferencesProvider> to show a specific theme based on the user settings. But we can still adjust this when we have the need.", "url": "https://github.com/Graylog2/graylog2-server/pull/7861#discussion_r408123039", "createdAt": "2020-04-14T13:10:22Z", "author": {"login": "linuspahl"}, "path": "graylog2-web-interface/src/pages/LoggedInPage.jsx", "diffHunk": "@@ -1,10 +1,11 @@\n import React from 'react';\n import AppRouter from 'routing/AppRouter';\n+import CurrentUserPreferencesProvider from '../contexts/CurrentUserPreferencesProvider';\n \n-class LoggedInPage extends React.Component {\n-  render() {\n-    return <AppRouter />;\n-  }\n-}\n+const LoggedInPage = () => (\n+  <CurrentUserPreferencesProvider>\n+    <AppRouter />\n+  </CurrentUserPreferencesProvider>\n+);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a1502b86dd10b986a4d6dffcb09d27d40ce8cff2"}, "originalPosition": 14}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzkyOTI5NzA5", "url": "https://github.com/Graylog2/graylog2-server/pull/7861#pullrequestreview-392929709", "createdAt": "2020-04-14T13:32:50Z", "commit": {"oid": "a1502b86dd10b986a4d6dffcb09d27d40ce8cff2"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xNFQxMzozMjo1MFrOGFOzzQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xNFQxMzozMjo1MFrOGFOzzQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwODEzODcwMQ==", "bodyText": "I guess it is a possible improvement for a follow up PR to replace the usage of StoreProviderMock and StoreMock in all our tests?", "url": "https://github.com/Graylog2/graylog2-server/pull/7861#discussion_r408138701", "createdAt": "2020-04-14T13:32:50Z", "author": {"login": "linuspahl"}, "path": "graylog2-web-interface/test/helpers/mocking/index.js", "diffHunk": "@@ -1,4 +1,7 @@\n export { default as CombinedProviderMock } from './CombinedProviderMock';\n+export { default as MockCombinedProvider } from './CombinedProviderMock';\n export { default as StoreMock } from './StoreMock';\n+export { default as MockStore } from './StoreMock';\n export { default as StoreProviderMock } from './StoreProviderMock';\n+export { default as MockStoreProvider } from './StoreProviderMock';\n export { default as asMock } from './AsMock';", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a1502b86dd10b986a4d6dffcb09d27d40ce8cff2"}, "originalPosition": 7}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzkzODYzMzI0", "url": "https://github.com/Graylog2/graylog2-server/pull/7861#pullrequestreview-393863324", "createdAt": "2020-04-15T15:02:35Z", "commit": {"oid": "a1502b86dd10b986a4d6dffcb09d27d40ce8cff2"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2520, "cost": 1, "resetAt": "2021-10-28T18:54:27Z"}}}