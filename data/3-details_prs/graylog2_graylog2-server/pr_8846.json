{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDcxNjA3MzI1", "number": 8846, "title": "Add user preferences section for UserDetails and UserEdit page", "bodyText": "This PR adds the user preferences section for UserDetails and UserEdit page.\nFor read only users most settings come from the local storage, this is only relevant for the UserDetailsPage because they can't view the UserEditPage.\nThe preference updateUnfocused has no effect right now which means we can discuss if we want to hide / remove this option in the UI.\nThe theme mode is a preference but I came to the conclusion it should only be configured by using the theme mode toggle.\nI saw that we are not using the loadUserPreferences method of the PreferencesStore we could remove this together with the api logic in a follow-up PR.\nFixes: #8826\n/jenkins-pr-deps Graylog2/graylog-plugin-enterprise#1742", "createdAt": "2020-08-21T12:35:28Z", "url": "https://github.com/Graylog2/graylog2-server/pull/8846", "merged": true, "mergeCommit": {"oid": "0f67da4a7f1531c60257753ccbbbefe8a9d94a31"}, "closed": true, "closedAt": "2020-08-25T11:58:30Z", "author": {"login": "linuspahl"}, "timelineItems": {"totalCount": 11, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdBD1x6gH2gAyNDcxNjA3MzI1OmFhMDQzZmYwMTc5YWNjYzBiNDNhYTM2OGFiMzRjZmQ4Njc1OTMzMzA=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdCV7ywAFqTQ3NDQwNzk0NQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "aa043ff0179accc0b43aa368ab34cfd867593330", "author": {"user": {"login": "linuspahl", "name": "Linus Pahl"}}, "url": "https://github.com/Graylog2/graylog2-server/commit/aa043ff0179accc0b43aa368ab34cfd867593330", "committedDate": "2020-08-21T12:19:37Z", "message": "Rename UserDetails TeamSection to TeamsSection"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "32e8c2054d7dc61b4caa7615331eba8a894506a0", "author": {"user": {"login": "linuspahl", "name": "Linus Pahl"}}, "url": "https://github.com/Graylog2/graylog2-server/commit/32e8c2054d7dc61b4caa7615331eba8a894506a0", "committedDate": "2020-08-21T12:19:37Z", "message": "Add PreferencesSection for UserEdit and UserDetails page"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "591e380d5572fb1c342e39396952af34847769ac", "author": {"user": {"login": "linuspahl", "name": "Linus Pahl"}}, "url": "https://github.com/Graylog2/graylog2-server/commit/591e380d5572fb1c342e39396952af34847769ac", "committedDate": "2020-08-21T12:19:37Z", "message": "Refactor PreferencesStore usage"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "4aee4f91027a3c8846f01a1a3e93666d3f8a1616", "author": {"user": {"login": "linuspahl", "name": "Linus Pahl"}}, "url": "https://github.com/Graylog2/graylog2-server/commit/4aee4f91027a3c8846f01a1a3e93666d3f8a1616", "committedDate": "2020-08-21T12:26:33Z", "message": "Smaller fixes"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDcyNDUzMTg3", "url": "https://github.com/Graylog2/graylog2-server/pull/8846#pullrequestreview-472453187", "createdAt": "2020-08-21T12:39:18Z", "commit": {"oid": "4aee4f91027a3c8846f01a1a3e93666d3f8a1616"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yMVQxMjozOToxOFrOHErlHQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yMVQxMjozOToxOFrOHErlHQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NDY3MDM2NQ==", "bodyText": "This is a perfect example for code I would like to centralise, but don't really know a good place for. It is clearly presentation logic which means it should not be part of the PreferenceStore nor the directory logic/users", "url": "https://github.com/Graylog2/graylog2-server/pull/8846#discussion_r474670365", "createdAt": "2020-08-21T12:39:18Z", "author": {"login": "linuspahl"}, "path": "graylog2-web-interface/src/components/users/UserDetails/PreferencesSection.jsx", "diffHunk": "@@ -0,0 +1,52 @@\n+// @flow strict\n+import * as React from 'react';\n+\n+import { PREFERENCES_THEME_MODE } from 'theme/constants';\n+import Store from 'logic/local-storage/Store';\n+import User from 'logic/users/User';\n+import ReadOnlyFormGroup from 'components/common/ReadOnlyFormGroup';\n+import SectionComponent from 'components/common/Section/SectionComponent';\n+\n+type Props = {\n+  user: User,\n+};\n+\n+export const getPreferenceValueLabel = (preferenceType: string, preferenceValue: mixed): string => {\n+  if (preferenceType === 'boolean') {\n+    return preferenceValue ? 'yes' : 'no';\n+  }\n+\n+  return String(preferenceValue);\n+};", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "4aee4f91027a3c8846f01a1a3e93666d3f8a1616"}, "originalPosition": 20}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDczMTg3MzEy", "url": "https://github.com/Graylog2/graylog2-server/pull/8846#pullrequestreview-473187312", "createdAt": "2020-08-24T07:37:25Z", "commit": {"oid": "4aee4f91027a3c8846f01a1a3e93666d3f8a1616"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yNFQwNzozNzoyNVrOHFX_dg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yNFQwNzo1ODo1MFrOHFYsmg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NTM5ODAwNg==", "bodyText": "I would move it to ReadOnlyFormGroup. It is quite certain the only place which ever needs it. In addition I would set a prop which is configuring it: <ReadOnlyFormGroup label=\"Search autocompletion\" value={enableSmartSearch}  valueConverter=\"boolean\" /> something like this.", "url": "https://github.com/Graylog2/graylog2-server/pull/8846#discussion_r475398006", "createdAt": "2020-08-24T07:37:25Z", "author": {"login": "kmerz"}, "path": "graylog2-web-interface/src/components/users/UserDetails/PreferencesSection.jsx", "diffHunk": "@@ -0,0 +1,52 @@\n+// @flow strict\n+import * as React from 'react';\n+\n+import { PREFERENCES_THEME_MODE } from 'theme/constants';\n+import Store from 'logic/local-storage/Store';\n+import User from 'logic/users/User';\n+import ReadOnlyFormGroup from 'components/common/ReadOnlyFormGroup';\n+import SectionComponent from 'components/common/Section/SectionComponent';\n+\n+type Props = {\n+  user: User,\n+};\n+\n+export const getPreferenceValueLabel = (preferenceType: string, preferenceValue: mixed): string => {\n+  if (preferenceType === 'boolean') {\n+    return preferenceValue ? 'yes' : 'no';\n+  }\n+\n+  return String(preferenceValue);\n+};", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NDY3MDM2NQ=="}, "originalCommit": {"oid": "4aee4f91027a3c8846f01a1a3e93666d3f8a1616"}, "originalPosition": 20}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NTQwOTU2Mg==", "bodyText": "Since we now exactly know what in the PreferenceMap is, we should do the real type here. So if someone is adding a new entry and accessing it he get's informed that it is not in the type.", "url": "https://github.com/Graylog2/graylog2-server/pull/8846#discussion_r475409562", "createdAt": "2020-08-24T07:58:50Z", "author": {"login": "kmerz"}, "path": "graylog2-web-interface/src/stores/users/PreferencesStore.js", "diffHunk": "@@ -13,49 +13,38 @@ export type Preference = {\n   value: any,\n };\n \n-type PreferencesMap = {\n+export type PreferencesMap = {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "4aee4f91027a3c8846f01a1a3e93666d3f8a1616"}, "originalPosition": 5}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "09dbdf04267a0d780812633f096818e3c980ca59", "author": {"user": {"login": "linuspahl", "name": "Linus Pahl"}}, "url": "https://github.com/Graylog2/graylog2-server/commit/09dbdf04267a0d780812633f096818e3c980ca59", "committedDate": "2020-08-24T15:03:43Z", "message": "Add icon for boolean values of ReadOnlyFormField"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "179def0299c0b304c86dea3fd40203518ca1e752", "author": {"user": {"login": "linuspahl", "name": "Linus Pahl"}}, "url": "https://github.com/Graylog2/graylog2-server/commit/179def0299c0b304c86dea3fd40203518ca1e752", "committedDate": "2020-08-24T15:05:32Z", "message": "Define real type definition for PreferencesMap"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "610c403124e2e7bdf5f805fe5b34f060d1fa14f3", "author": {"user": {"login": "linuspahl", "name": "Linus Pahl"}}, "url": "https://github.com/Graylog2/graylog2-server/commit/610c403124e2e7bdf5f805fe5b34f060d1fa14f3", "committedDate": "2020-08-24T15:36:41Z", "message": "Update UserOverview and preferences type definitions"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "022ef2bb92729e7345bc687cdbc17b85037ea7f2", "author": {"user": {"login": "linuspahl", "name": "Linus Pahl"}}, "url": "https://github.com/Graylog2/graylog2-server/commit/022ef2bb92729e7345bc687cdbc17b85037ea7f2", "committedDate": "2020-08-24T15:48:28Z", "message": "Remove empty line"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDc0NDA3OTQ1", "url": "https://github.com/Graylog2/graylog2-server/pull/8846#pullrequestreview-474407945", "createdAt": "2020-08-25T11:58:24Z", "commit": {"oid": "022ef2bb92729e7345bc687cdbc17b85037ea7f2"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2849, "cost": 1, "resetAt": "2021-10-28T18:54:27Z"}}}