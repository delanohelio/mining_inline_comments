{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDcwODY5ODUw", "number": 8836, "reviewThreads": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yMVQwODo0OTozNlrOEa3v3Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yMVQxMTozNzoxMVrOEa7whg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjk2NjExODA1OnYy", "diffSide": "RIGHT", "path": "graylog2-web-interface/src/components/permissions/EntityShareModal.jsx", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yMVQwODo0OTozNlrOHEjiHQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yMVQwODo0OTozNlrOHEjiHQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NDUzODUyNQ==", "bodyText": "I tried to add a more complex test but this is not possible with due to the mocking and usage of the EntityShareStore. We will be able to handle the mocking better when we use the return value of our actions inside the EntityShareModal instead of the state from the EntityShareState", "url": "https://github.com/Graylog2/graylog2-server/pull/8836#discussion_r474538525", "createdAt": "2020-08-21T08:49:36Z", "author": {"login": "linuspahl"}, "path": "graylog2-web-interface/src/components/permissions/EntityShareModal.jsx", "diffHunk": "@@ -25,18 +25,40 @@ const EntityShareModal = ({ description, entityId, entityType, entityTitle, onCl\n   const { state: entityShareState } = useStore(EntityShareStore);\n   const [disableSubmit, setDisableSubmit] = useState(false);\n   const entityGRN = createGRN(entityType, entityId);\n+  const granteesSelectRef = useRef();\n \n   useEffect(() => {\n     EntityShareActions.prepare(entityGRN);\n   }, [entityGRN]);\n \n   const _handleSave = () => {\n     setDisableSubmit(true);\n+    const granteesSelect = granteesSelectRef?.current;\n+    const garnteesSelectValue = granteesSelect?.state?.value;\n+    const granteesSelectOptions = granteesSelect?.props?.options;\n     const payload: EntitySharePayload = {\n       selected_grantee_capabilities: entityShareState.selectedGranteeCapabilities,\n     };\n \n-    return EntityShareActions.update(entityGRN, payload).then(onClose);\n+    if (garnteesSelectValue) {\n+      const selectedOption = granteesSelectOptions?.find((option) => option.value === garnteesSelectValue);\n+\n+      if (!selectedOption) {\n+        throw Error(`Can't find ${garnteesSelectValue} in grantees select options on save`);\n+      }\n+\n+      // eslint-disable-next-line no-alert\n+      if (!window.confirm(`\"${selectedOption.label}\" got selected but was never added as a collaborator. Do you want to continue anyway?`)) {\n+        setDisableSubmit(false);\n+\n+        return;\n+      }\n+    }\n+\n+    EntityShareActions.update(entityGRN, payload).then(() => {\n+      setDisableSubmit(true);\n+      onClose();\n+    });", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "151b256a2aedfe26c852a35edcdf9a6679c2ccbc"}, "originalPosition": 46}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjk2Njc3NTEwOnYy", "diffSide": "RIGHT", "path": "graylog2-web-interface/src/components/permissions/EntityShareModal.jsx", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yMVQxMTozNzoxMVrOHEp36A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yMVQxMTozNzoxMVrOHEp36A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NDY0MjQwOA==", "bodyText": "What about we do throw an error if we are running in development and ignore it if we are in production?", "url": "https://github.com/Graylog2/graylog2-server/pull/8836#discussion_r474642408", "createdAt": "2020-08-21T11:37:11Z", "author": {"login": "kmerz"}, "path": "graylog2-web-interface/src/components/permissions/EntityShareModal.jsx", "diffHunk": "@@ -25,18 +25,40 @@ const EntityShareModal = ({ description, entityId, entityType, entityTitle, onCl\n   const { state: entityShareState } = useStore(EntityShareStore);\n   const [disableSubmit, setDisableSubmit] = useState(false);\n   const entityGRN = createGRN(entityType, entityId);\n+  const granteesSelectRef = useRef();\n \n   useEffect(() => {\n     EntityShareActions.prepare(entityGRN);\n   }, [entityGRN]);\n \n   const _handleSave = () => {\n     setDisableSubmit(true);\n+    const granteesSelect = granteesSelectRef?.current;\n+    const garnteesSelectValue = granteesSelect?.state?.value;\n+    const granteesSelectOptions = granteesSelect?.props?.options;\n     const payload: EntitySharePayload = {\n       selected_grantee_capabilities: entityShareState.selectedGranteeCapabilities,\n     };\n \n-    return EntityShareActions.update(entityGRN, payload).then(onClose);\n+    if (garnteesSelectValue) {\n+      const selectedOption = granteesSelectOptions?.find((option) => option.value === garnteesSelectValue);\n+\n+      if (!selectedOption) {\n+        throw Error(`Can't find ${garnteesSelectValue} in grantees select options on save`);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "151b256a2aedfe26c852a35edcdf9a6679c2ccbc"}, "originalPosition": 32}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4032, "cost": 1, "resetAt": "2021-11-12T20:28:25Z"}}}