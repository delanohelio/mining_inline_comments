{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDc0OTE2ODkw", "number": 8882, "title": "Wrap app with GlobalStylesProvider to amend global css in-flight", "bodyText": "Description\n\nMoved Global Theme Styles to a Context Provider so a single instance can be manipulated\nMotivation and Context\n\n\nGlobal styles were duplicating on error pages\nTypes of changes\n\n\n Bug fix (non-breaking change which fixes an issue)\n New feature (non-breaking change which adds functionality)\n Refactoring (non-breaking change)\n Breaking change (fix or feature that would cause existing functionality to change)\n\nChecklist:\n\n\n\n My code follows the code style of this project.\n My change requires a change to the documentation.\n I have updated the documentation accordingly.\n I have read the CONTRIBUTING document.\n I have added tests to cover my changes.", "createdAt": "2020-08-27T19:55:51Z", "url": "https://github.com/Graylog2/graylog2-server/pull/8882", "merged": true, "mergeCommit": {"oid": "aabfd44c42ad0e62d436758b094bd383d311492c"}, "closed": true, "closedAt": "2020-09-02T07:13:24Z", "author": {"login": "kyleknighted"}, "timelineItems": {"totalCount": 8, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdDE2KHgH2gAyNDc0OTE2ODkwOmZiYjNjMzEwNTUzYWRkYTIxYjlkM2YxYzU5OTVjZWNkNDZjZjRmMGY=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdEo-NWgFqTQ3OTg1MjIwMQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "fbb3c310553adda21b9d3f1c5995cecd46cf4f0f", "author": {"user": {"login": "kyleknighted", "name": "Kyle Knight"}}, "url": "https://github.com/Graylog2/graylog2-server/commit/fbb3c310553adda21b9d3f1c5995cecd46cf4f0f", "committedDate": "2020-08-27T18:37:47Z", "message": "Move Scratchpad provider to same directory as others"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f967c27bafab1f25557da8c254485c1f6fe4036b", "author": {"user": {"login": "kyleknighted", "name": "Kyle Knight"}}, "url": "https://github.com/Graylog2/graylog2-server/commit/f967c27bafab1f25557da8c254485c1f6fe4036b", "committedDate": "2020-08-27T18:47:51Z", "message": "GlobalStylesProvider to avoid double rendered styles"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f7f4370711ef7e2f04da787c4388fc7817b828f8", "author": {"user": {"login": "kyleknighted", "name": "Kyle Knight"}}, "url": "https://github.com/Graylog2/graylog2-server/commit/f7f4370711ef7e2f04da787c4388fc7817b828f8", "committedDate": "2020-08-27T19:54:11Z", "message": "tests, lint, & flow"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDc3NjA3OTU2", "url": "https://github.com/Graylog2/graylog2-server/pull/8882#pullrequestreview-477607956", "createdAt": "2020-08-28T10:07:47Z", "commit": {"oid": "f7f4370711ef7e2f04da787c4388fc7817b828f8"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yOFQxMDowNzo0N1rOHI39iA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yOFQxMDoxNToxNFrOHI4h0A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3OTA2NzUyOA==", "bodyText": "We need to reset the additional styles here as well.", "url": "https://github.com/Graylog2/graylog2-server/pull/8882#discussion_r479067528", "createdAt": "2020-08-28T10:07:47Z", "author": {"login": "linuspahl"}, "path": "graylog2-web-interface/src/pages/LoadingPage.jsx", "diffHunk": "@@ -1,15 +1,20 @@\n import PropTypes from 'prop-types';\n-import React from 'react';\n+import React, { useContext, useEffect } from 'react';\n \n import { DocumentTitle, Spinner, Icon } from 'components/common';\n import LoginBox from 'components/login/LoginBox';\n import authStyles from 'theme/styles/authStyles';\n-import GlobalThemeStyles from 'theme/GlobalThemeStyles';\n+import { GlobalStylesContext } from 'contexts/GlobalStylesProvider';\n \n const LoadingPage = ({ text }) => {\n+  const { addGlobalStyles } = useContext(GlobalStylesContext);\n+\n+  useEffect(() => {\n+    addGlobalStyles(authStyles);\n+  }, []);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f7f4370711ef7e2f04da787c4388fc7817b828f8"}, "originalPosition": 16}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3OTA3MTk1Nw==", "bodyText": "This should be (?CSSRules) => void", "url": "https://github.com/Graylog2/graylog2-server/pull/8882#discussion_r479071957", "createdAt": "2020-08-28T10:11:33Z", "author": {"login": "linuspahl"}, "path": "graylog2-web-interface/src/contexts/GlobalStylesProvider.jsx", "diffHunk": "@@ -1,6 +1,31 @@\n-import { createGlobalStyle, css } from 'styled-components';\n-\n-const GlobalThemeStyles = createGlobalStyle(({ additionalStyles, theme }) => css`\n+// @flow strict\n+import * as React from 'react';\n+import { createContext, useState } from 'react';\n+import PropTypes from 'prop-types';\n+import { createGlobalStyle, css, type CSSRules } from 'styled-components';\n+\n+type Props = {\n+  children: React.Node,\n+};\n+\n+type StyleTypes = {\n+  addGlobalStyles: (?CSSRules) => ?string,", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f7f4370711ef7e2f04da787c4388fc7817b828f8"}, "originalPosition": 15}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3OTA3NjgxNg==", "bodyText": "Let's unify this type with the type used in line 12 and define the type like this: const [additionalStyles, addGlobalStyles] = useState<?string>();", "url": "https://github.com/Graylog2/graylog2-server/pull/8882#discussion_r479076816", "createdAt": "2020-08-28T10:15:14Z", "author": {"login": "linuspahl"}, "path": "graylog2-web-interface/src/contexts/GlobalStylesProvider.jsx", "diffHunk": "@@ -1,6 +1,31 @@\n-import { createGlobalStyle, css } from 'styled-components';\n-\n-const GlobalThemeStyles = createGlobalStyle(({ additionalStyles, theme }) => css`\n+// @flow strict\n+import * as React from 'react';\n+import { createContext, useState } from 'react';\n+import PropTypes from 'prop-types';\n+import { createGlobalStyle, css, type CSSRules } from 'styled-components';\n+\n+type Props = {\n+  children: React.Node,\n+};\n+\n+type StyleTypes = {\n+  addGlobalStyles: (?CSSRules) => ?string,\n+};\n+\n+export const GlobalStylesContext = createContext<StyleTypes>({ addGlobalStyles: () => {} });\n+\n+const GlobalStylesProvider = ({ children }: Props) => {\n+  const [additionalStyles: string, addGlobalStyles] = useState();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f7f4370711ef7e2f04da787c4388fc7817b828f8"}, "originalPosition": 21}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "38278aec8ed834aa5c6acf3171518636dd3fd984", "author": {"user": {"login": "kyleknighted", "name": "Kyle Knight"}}, "url": "https://github.com/Graylog2/graylog2-server/commit/38278aec8ed834aa5c6acf3171518636dd3fd984", "committedDate": "2020-08-28T14:33:02Z", "message": "Reset background on logged in pages"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "aad84ef19d28789443bcea71160695a717efccc4", "author": {"user": {"login": "kyleknighted", "name": "Kyle Knight"}}, "url": "https://github.com/Graylog2/graylog2-server/commit/aad84ef19d28789443bcea71160695a717efccc4", "committedDate": "2020-08-28T14:35:46Z", "message": "flow"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "14e568e97c866971608a9a28ad77b18fa0bb3cd7", "author": {"user": {"login": "kyleknighted", "name": "Kyle Knight"}}, "url": "https://github.com/Graylog2/graylog2-server/commit/14e568e97c866971608a9a28ad77b18fa0bb3cd7", "committedDate": "2020-08-28T14:44:03Z", "message": "flow"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDc5ODUyMjAx", "url": "https://github.com/Graylog2/graylog2-server/pull/8882#pullrequestreview-479852201", "createdAt": "2020-09-01T15:17:05Z", "commit": {"oid": "14e568e97c866971608a9a28ad77b18fa0bb3cd7"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2874, "cost": 1, "resetAt": "2021-10-28T18:54:27Z"}}}