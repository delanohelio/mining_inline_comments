{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTE5MTg4Nzg5", "number": 9444, "title": "Add startpage to the Settings Section of a user", "bodyText": "Motivation\nMake startpage configureable in settings section of a user\nDescription\nAdd two selects one for the type dashboard / stream and one for the list of available options.\nFor normal users we as entity share resource for a list of dashboards or streams and for admin users\nwe ask dashboards resource and stream resource.\nIf a user lost a view permission for the selected startpage we show a warning message.\n\n\n\nRefs #9443", "createdAt": "2020-11-11T13:11:41Z", "url": "https://github.com/Graylog2/graylog2-server/pull/9444", "merged": true, "mergeCommit": {"oid": "2b4e241ef3dc4439bd5767dbcf85e7307e52a2f4"}, "closed": true, "closedAt": "2020-12-07T17:12:07Z", "author": {"login": "kmerz"}, "timelineItems": {"totalCount": 23, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdcDpAOgFqTUyOTg5NDQ1Mg==", "endCursor": "Y3Vyc29yOnYyOpPPAAABdj4wRwAFqTU0NjM1ODEzOA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTI5ODk0NDUy", "url": "https://github.com/Graylog2/graylog2-server/pull/9444#pullrequestreview-529894452", "createdAt": "2020-11-13T09:13:15Z", "commit": {"oid": "2b077d27ea1ac4c5a66b567e5daea0bf0d27d88e"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xM1QwOToxMzoxNlrOHymatA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xM1QwOToxMzoxNlrOHymatA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMjgyMDI3Ng==", "bodyText": "console.log", "url": "https://github.com/Graylog2/graylog2-server/pull/9444#discussion_r522820276", "createdAt": "2020-11-13T09:13:16Z", "author": {"login": "linuspahl"}, "path": "graylog2-web-interface/src/components/users/UserEdit/UserEdit.jsx", "diffHunk": "@@ -28,6 +28,7 @@ type Props = {\n };\n \n const _updateUser = (data, currentUser, userId) => {\n+  console.log(data);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "2b077d27ea1ac4c5a66b567e5daea0bf0d27d88e"}, "originalPosition": 4}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "2b077d27ea1ac4c5a66b567e5daea0bf0d27d88e", "author": {"user": {"login": "kmerz", "name": "Konrad Merz"}}, "url": "https://github.com/Graylog2/graylog2-server/commit/2b077d27ea1ac4c5a66b567e5daea0bf0d27d88e", "committedDate": "2020-11-11T13:08:59Z", "message": "Add startpage to the Settings Section of a user\n\n## Motivation\nPrior to this change, there was no way to reset the start page of a\nuser. A user could only change the startpage to a different stream.\n\n## Description\nThis change will add a new field to the settings section of a user where\nhe can edit its startpage."}, "afterCommit": {"oid": "e17e987376e582365cd7634b25970fdcf1be892e", "author": {"user": {"login": "kmerz", "name": "Konrad Merz"}}, "url": "https://github.com/Graylog2/graylog2-server/commit/e17e987376e582365cd7634b25970fdcf1be892e", "committedDate": "2020-11-25T13:11:32Z", "message": "Display name of start page on User Details"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTM5MTc4MDc2", "url": "https://github.com/Graylog2/graylog2-server/pull/9444#pullrequestreview-539178076", "createdAt": "2020-11-26T10:18:49Z", "commit": {"oid": "06555bb0a61f2c22b3427f949cac3399325c5be3"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0yNlQxMDoyNTozN1rOH6VGbw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0yNlQxMDo0MjoyMlrOH6VvQw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMDkyNTE2Nw==", "bodyText": "Right now these selects only have the placeholder 'Select...'.  We could display something like Select type and Select entity.", "url": "https://github.com/Graylog2/graylog2-server/pull/9444#discussion_r530925167", "createdAt": "2020-11-26T10:25:37Z", "author": {"login": "linuspahl"}, "path": "graylog2-web-interface/src/components/users/StartpageFormGroup.tsx", "diffHunk": "@@ -0,0 +1,143 @@\n+/*\n+ * Copyright (C) 2020 Graylog, Inc.\n+ *\n+ * This program is free software: you can redistribute it and/or modify\n+ * it under the terms of the Server Side Public License, version 1,\n+ * as published by MongoDB, Inc.\n+ *\n+ * This program is distributed in the hope that it will be useful,\n+ * but WITHOUT ANY WARRANTY; without even the implied warranty of\n+ * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n+ * Server Side Public License for more details.\n+ *\n+ * You should have received a copy of the Server Side Public License\n+ * along with this program. If not, see\n+ * <http://www.mongodb.com/licensing/server-side-public-license>.\n+ */\n+import * as React from 'react';\n+import * as Immutable from 'immutable';\n+import { useState, useEffect } from 'react';\n+import { Field } from 'formik';\n+import styled from 'styled-components';\n+\n+import { getValuesFromGRN } from 'logic/permissions/GRN';\n+import { Button, Alert } from 'components/graylog';\n+import { Input } from 'components/bootstrap';\n+import SharedEntity from 'logic/permissions/SharedEntity';\n+import EntityShareDomain from 'domainActions/permissions/EntityShareDomain';\n+import Spinner from 'components/common/Spinner';\n+import Select from 'components/common/Select';\n+import { DashboardsActions } from 'views/stores/DashboardsStore';\n+import { StreamsActions } from 'stores/streams/StreamsStore';\n+\n+const Container = styled.div`\n+  display: flex;\n+  align-items: center;\n+`;\n+\n+const TypeSelect = styled(Select)`\n+  width: 200px;\n+  margin-right: 3px;\n+`;\n+\n+const ValueSelect = styled(Select)`\n+  width: 400px;\n+`;\n+\n+const ResetBtn = styled(Button)`\n+  margin-left: 5px;\n+`;\n+\n+type Props = {\n+  userId: string;\n+  permissions: Immutable.List<string>;\n+}\n+\n+type Option = {\n+  value: string;\n+  label: string;\n+}\n+\n+// We cannot ask for all since the backend did not implement something like this. So for now its 10000.\n+const UNLIMITED_ENTITY_SHARE_REQ = { page: 1, perPage: 10000, query: '' };\n+\n+const grnId = (grn) => getValuesFromGRN(grn).id;\n+const _grnOptionFormatter = ({ id, title }: SharedEntity): Option => ({ value: grnId(id), label: title });\n+const typeOptions = [\n+  { value: 'dashboard', label: 'Dashboard' },\n+  { value: 'stream', label: 'Stream' },\n+];\n+\n+const ADMIN_PERMISSION = '*';\n+\n+const StartpageFormGroup = ({ userId, permissions }: Props) => {\n+  const [dashboards, setDashboards] = useState<Option[] | undefined>();\n+  const [streams, setStreams] = useState<Option[] | undefined>();\n+\n+  useEffect(() => {\n+    if (permissions.includes(ADMIN_PERMISSION)) {\n+      DashboardsActions.search('', 1, 0).then(({ list }) => setDashboards(list.map(({ id, title }) => ({ value: id, label: title }))));\n+\n+      StreamsActions.searchPaginated(1, 0, '').then(({ streams: streamsList }) => setStreams(streamsList.map(({ id, title }) => ({ value: id, label: title }))));\n+    } else {\n+      EntityShareDomain.loadUserSharesPaginated(userId, {\n+        ...UNLIMITED_ENTITY_SHARE_REQ,\n+        additionalQueries: { entity_type: 'dashboard' },\n+      }).then(({ list }) => setDashboards(list.map(_grnOptionFormatter).toArray()))\n+        .then(() => EntityShareDomain.loadUserSharesPaginated(userId, {\n+          ...UNLIMITED_ENTITY_SHARE_REQ,\n+          additionalQueries: { entity_type: 'stream' },\n+        }).then(({ list }) => setStreams(list.map(_grnOptionFormatter).toArray())));\n+    }\n+  }, [permissions, userId]);\n+\n+  if (!streams || !dashboards) {\n+    return <Spinner />;\n+  }\n+\n+  return (\n+    <Field name=\"startpage\">\n+      {({ field: { name, value, onChange } }) => {\n+        const type = value?.type ?? 'dashboard';\n+        const options = type === 'dashboard' ? dashboards : streams;\n+\n+        const error = value?.id && options.findIndex(({ value: v }) => v === value.id) < 0\n+          ? <Alert bsStyle=\"warning\">User is missing permission for the configured page</Alert>\n+          : null;\n+\n+        const resetBtn = value?.type\n+          ? (\n+            <ResetBtn onClick={() => onChange({ target: { name, value: {} } })}>\n+              Reset\n+            </ResetBtn>\n+          )\n+          : null;\n+\n+        return (\n+          <>\n+            <Input id=\"startpage\"\n+                   label=\"Start page\"\n+                   help=\"Select the page the user sees right after log in\"\n+                   labelClassName=\"col-sm-3\"\n+                   wrapperClassName=\"col-sm-9\">\n+              <>\n+                <Container>\n+                  <TypeSelect options={typeOptions}\n+                              onChange={(newType) => onChange({ target: { name, value: { type: newType, id: undefined } } })}\n+                              value={value?.type} />\n+                  <ValueSelect options={options}\n+                               onChange={(newId) => onChange({ target: { name, value: { type: type, id: newId } } })}\n+                               value={value?.id} />", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "06555bb0a61f2c22b3427f949cac3399325c5be3"}, "originalPosition": 130}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMDkzMTM4MQ==", "bodyText": "We could describe here that only entities which are accessible by a user can be defined as a start page. If you think about it, it is legit, but this way we can avoid confusion, especially when an admin edits the settings of an user.", "url": "https://github.com/Graylog2/graylog2-server/pull/9444#discussion_r530931381", "createdAt": "2020-11-26T10:35:30Z", "author": {"login": "linuspahl"}, "path": "graylog2-web-interface/src/components/users/StartpageFormGroup.tsx", "diffHunk": "@@ -0,0 +1,143 @@\n+/*\n+ * Copyright (C) 2020 Graylog, Inc.\n+ *\n+ * This program is free software: you can redistribute it and/or modify\n+ * it under the terms of the Server Side Public License, version 1,\n+ * as published by MongoDB, Inc.\n+ *\n+ * This program is distributed in the hope that it will be useful,\n+ * but WITHOUT ANY WARRANTY; without even the implied warranty of\n+ * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n+ * Server Side Public License for more details.\n+ *\n+ * You should have received a copy of the Server Side Public License\n+ * along with this program. If not, see\n+ * <http://www.mongodb.com/licensing/server-side-public-license>.\n+ */\n+import * as React from 'react';\n+import * as Immutable from 'immutable';\n+import { useState, useEffect } from 'react';\n+import { Field } from 'formik';\n+import styled from 'styled-components';\n+\n+import { getValuesFromGRN } from 'logic/permissions/GRN';\n+import { Button, Alert } from 'components/graylog';\n+import { Input } from 'components/bootstrap';\n+import SharedEntity from 'logic/permissions/SharedEntity';\n+import EntityShareDomain from 'domainActions/permissions/EntityShareDomain';\n+import Spinner from 'components/common/Spinner';\n+import Select from 'components/common/Select';\n+import { DashboardsActions } from 'views/stores/DashboardsStore';\n+import { StreamsActions } from 'stores/streams/StreamsStore';\n+\n+const Container = styled.div`\n+  display: flex;\n+  align-items: center;\n+`;\n+\n+const TypeSelect = styled(Select)`\n+  width: 200px;\n+  margin-right: 3px;\n+`;\n+\n+const ValueSelect = styled(Select)`\n+  width: 400px;\n+`;\n+\n+const ResetBtn = styled(Button)`\n+  margin-left: 5px;\n+`;\n+\n+type Props = {\n+  userId: string;\n+  permissions: Immutable.List<string>;\n+}\n+\n+type Option = {\n+  value: string;\n+  label: string;\n+}\n+\n+// We cannot ask for all since the backend did not implement something like this. So for now its 10000.\n+const UNLIMITED_ENTITY_SHARE_REQ = { page: 1, perPage: 10000, query: '' };\n+\n+const grnId = (grn) => getValuesFromGRN(grn).id;\n+const _grnOptionFormatter = ({ id, title }: SharedEntity): Option => ({ value: grnId(id), label: title });\n+const typeOptions = [\n+  { value: 'dashboard', label: 'Dashboard' },\n+  { value: 'stream', label: 'Stream' },\n+];\n+\n+const ADMIN_PERMISSION = '*';\n+\n+const StartpageFormGroup = ({ userId, permissions }: Props) => {\n+  const [dashboards, setDashboards] = useState<Option[] | undefined>();\n+  const [streams, setStreams] = useState<Option[] | undefined>();\n+\n+  useEffect(() => {\n+    if (permissions.includes(ADMIN_PERMISSION)) {\n+      DashboardsActions.search('', 1, 0).then(({ list }) => setDashboards(list.map(({ id, title }) => ({ value: id, label: title }))));\n+\n+      StreamsActions.searchPaginated(1, 0, '').then(({ streams: streamsList }) => setStreams(streamsList.map(({ id, title }) => ({ value: id, label: title }))));\n+    } else {\n+      EntityShareDomain.loadUserSharesPaginated(userId, {\n+        ...UNLIMITED_ENTITY_SHARE_REQ,\n+        additionalQueries: { entity_type: 'dashboard' },\n+      }).then(({ list }) => setDashboards(list.map(_grnOptionFormatter).toArray()))\n+        .then(() => EntityShareDomain.loadUserSharesPaginated(userId, {\n+          ...UNLIMITED_ENTITY_SHARE_REQ,\n+          additionalQueries: { entity_type: 'stream' },\n+        }).then(({ list }) => setStreams(list.map(_grnOptionFormatter).toArray())));\n+    }\n+  }, [permissions, userId]);\n+\n+  if (!streams || !dashboards) {\n+    return <Spinner />;\n+  }\n+\n+  return (\n+    <Field name=\"startpage\">\n+      {({ field: { name, value, onChange } }) => {\n+        const type = value?.type ?? 'dashboard';\n+        const options = type === 'dashboard' ? dashboards : streams;\n+\n+        const error = value?.id && options.findIndex(({ value: v }) => v === value.id) < 0\n+          ? <Alert bsStyle=\"warning\">User is missing permission for the configured page</Alert>\n+          : null;\n+\n+        const resetBtn = value?.type\n+          ? (\n+            <ResetBtn onClick={() => onChange({ target: { name, value: {} } })}>\n+              Reset\n+            </ResetBtn>\n+          )\n+          : null;\n+\n+        return (\n+          <>\n+            <Input id=\"startpage\"\n+                   label=\"Start page\"\n+                   help=\"Select the page the user sees right after log in\"", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "06555bb0a61f2c22b3427f949cac3399325c5be3"}, "originalPosition": 120}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMDkzNDA5NA==", "bodyText": "Currently it is possible to define only the type without an entity as the start page and submit the settings. We could add a validate prop for the field, to avoid this case.", "url": "https://github.com/Graylog2/graylog2-server/pull/9444#discussion_r530934094", "createdAt": "2020-11-26T10:39:59Z", "author": {"login": "linuspahl"}, "path": "graylog2-web-interface/src/components/users/StartpageFormGroup.tsx", "diffHunk": "@@ -0,0 +1,143 @@\n+/*\n+ * Copyright (C) 2020 Graylog, Inc.\n+ *\n+ * This program is free software: you can redistribute it and/or modify\n+ * it under the terms of the Server Side Public License, version 1,\n+ * as published by MongoDB, Inc.\n+ *\n+ * This program is distributed in the hope that it will be useful,\n+ * but WITHOUT ANY WARRANTY; without even the implied warranty of\n+ * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n+ * Server Side Public License for more details.\n+ *\n+ * You should have received a copy of the Server Side Public License\n+ * along with this program. If not, see\n+ * <http://www.mongodb.com/licensing/server-side-public-license>.\n+ */\n+import * as React from 'react';\n+import * as Immutable from 'immutable';\n+import { useState, useEffect } from 'react';\n+import { Field } from 'formik';\n+import styled from 'styled-components';\n+\n+import { getValuesFromGRN } from 'logic/permissions/GRN';\n+import { Button, Alert } from 'components/graylog';\n+import { Input } from 'components/bootstrap';\n+import SharedEntity from 'logic/permissions/SharedEntity';\n+import EntityShareDomain from 'domainActions/permissions/EntityShareDomain';\n+import Spinner from 'components/common/Spinner';\n+import Select from 'components/common/Select';\n+import { DashboardsActions } from 'views/stores/DashboardsStore';\n+import { StreamsActions } from 'stores/streams/StreamsStore';\n+\n+const Container = styled.div`\n+  display: flex;\n+  align-items: center;\n+`;\n+\n+const TypeSelect = styled(Select)`\n+  width: 200px;\n+  margin-right: 3px;\n+`;\n+\n+const ValueSelect = styled(Select)`\n+  width: 400px;\n+`;\n+\n+const ResetBtn = styled(Button)`\n+  margin-left: 5px;\n+`;\n+\n+type Props = {\n+  userId: string;\n+  permissions: Immutable.List<string>;\n+}\n+\n+type Option = {\n+  value: string;\n+  label: string;\n+}\n+\n+// We cannot ask for all since the backend did not implement something like this. So for now its 10000.\n+const UNLIMITED_ENTITY_SHARE_REQ = { page: 1, perPage: 10000, query: '' };\n+\n+const grnId = (grn) => getValuesFromGRN(grn).id;\n+const _grnOptionFormatter = ({ id, title }: SharedEntity): Option => ({ value: grnId(id), label: title });\n+const typeOptions = [\n+  { value: 'dashboard', label: 'Dashboard' },\n+  { value: 'stream', label: 'Stream' },\n+];\n+\n+const ADMIN_PERMISSION = '*';\n+\n+const StartpageFormGroup = ({ userId, permissions }: Props) => {\n+  const [dashboards, setDashboards] = useState<Option[] | undefined>();\n+  const [streams, setStreams] = useState<Option[] | undefined>();\n+\n+  useEffect(() => {\n+    if (permissions.includes(ADMIN_PERMISSION)) {\n+      DashboardsActions.search('', 1, 0).then(({ list }) => setDashboards(list.map(({ id, title }) => ({ value: id, label: title }))));\n+\n+      StreamsActions.searchPaginated(1, 0, '').then(({ streams: streamsList }) => setStreams(streamsList.map(({ id, title }) => ({ value: id, label: title }))));\n+    } else {\n+      EntityShareDomain.loadUserSharesPaginated(userId, {\n+        ...UNLIMITED_ENTITY_SHARE_REQ,\n+        additionalQueries: { entity_type: 'dashboard' },\n+      }).then(({ list }) => setDashboards(list.map(_grnOptionFormatter).toArray()))\n+        .then(() => EntityShareDomain.loadUserSharesPaginated(userId, {\n+          ...UNLIMITED_ENTITY_SHARE_REQ,\n+          additionalQueries: { entity_type: 'stream' },\n+        }).then(({ list }) => setStreams(list.map(_grnOptionFormatter).toArray())));\n+    }\n+  }, [permissions, userId]);\n+\n+  if (!streams || !dashboards) {\n+    return <Spinner />;\n+  }\n+\n+  return (\n+    <Field name=\"startpage\">", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "06555bb0a61f2c22b3427f949cac3399325c5be3"}, "originalPosition": 99}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMDkzNTYxOQ==", "bodyText": "Whats the reason to not load dashboards and streams at the same time?", "url": "https://github.com/Graylog2/graylog2-server/pull/9444#discussion_r530935619", "createdAt": "2020-11-26T10:42:22Z", "author": {"login": "linuspahl"}, "path": "graylog2-web-interface/src/components/users/StartpageFormGroup.tsx", "diffHunk": "@@ -0,0 +1,143 @@\n+/*\n+ * Copyright (C) 2020 Graylog, Inc.\n+ *\n+ * This program is free software: you can redistribute it and/or modify\n+ * it under the terms of the Server Side Public License, version 1,\n+ * as published by MongoDB, Inc.\n+ *\n+ * This program is distributed in the hope that it will be useful,\n+ * but WITHOUT ANY WARRANTY; without even the implied warranty of\n+ * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n+ * Server Side Public License for more details.\n+ *\n+ * You should have received a copy of the Server Side Public License\n+ * along with this program. If not, see\n+ * <http://www.mongodb.com/licensing/server-side-public-license>.\n+ */\n+import * as React from 'react';\n+import * as Immutable from 'immutable';\n+import { useState, useEffect } from 'react';\n+import { Field } from 'formik';\n+import styled from 'styled-components';\n+\n+import { getValuesFromGRN } from 'logic/permissions/GRN';\n+import { Button, Alert } from 'components/graylog';\n+import { Input } from 'components/bootstrap';\n+import SharedEntity from 'logic/permissions/SharedEntity';\n+import EntityShareDomain from 'domainActions/permissions/EntityShareDomain';\n+import Spinner from 'components/common/Spinner';\n+import Select from 'components/common/Select';\n+import { DashboardsActions } from 'views/stores/DashboardsStore';\n+import { StreamsActions } from 'stores/streams/StreamsStore';\n+\n+const Container = styled.div`\n+  display: flex;\n+  align-items: center;\n+`;\n+\n+const TypeSelect = styled(Select)`\n+  width: 200px;\n+  margin-right: 3px;\n+`;\n+\n+const ValueSelect = styled(Select)`\n+  width: 400px;\n+`;\n+\n+const ResetBtn = styled(Button)`\n+  margin-left: 5px;\n+`;\n+\n+type Props = {\n+  userId: string;\n+  permissions: Immutable.List<string>;\n+}\n+\n+type Option = {\n+  value: string;\n+  label: string;\n+}\n+\n+// We cannot ask for all since the backend did not implement something like this. So for now its 10000.\n+const UNLIMITED_ENTITY_SHARE_REQ = { page: 1, perPage: 10000, query: '' };\n+\n+const grnId = (grn) => getValuesFromGRN(grn).id;\n+const _grnOptionFormatter = ({ id, title }: SharedEntity): Option => ({ value: grnId(id), label: title });\n+const typeOptions = [\n+  { value: 'dashboard', label: 'Dashboard' },\n+  { value: 'stream', label: 'Stream' },\n+];\n+\n+const ADMIN_PERMISSION = '*';\n+\n+const StartpageFormGroup = ({ userId, permissions }: Props) => {\n+  const [dashboards, setDashboards] = useState<Option[] | undefined>();\n+  const [streams, setStreams] = useState<Option[] | undefined>();\n+\n+  useEffect(() => {\n+    if (permissions.includes(ADMIN_PERMISSION)) {\n+      DashboardsActions.search('', 1, 0).then(({ list }) => setDashboards(list.map(({ id, title }) => ({ value: id, label: title }))));\n+\n+      StreamsActions.searchPaginated(1, 0, '').then(({ streams: streamsList }) => setStreams(streamsList.map(({ id, title }) => ({ value: id, label: title }))));\n+    } else {\n+      EntityShareDomain.loadUserSharesPaginated(userId, {\n+        ...UNLIMITED_ENTITY_SHARE_REQ,\n+        additionalQueries: { entity_type: 'dashboard' },\n+      }).then(({ list }) => setDashboards(list.map(_grnOptionFormatter).toArray()))\n+        .then(() => EntityShareDomain.loadUserSharesPaginated(userId, {\n+          ...UNLIMITED_ENTITY_SHARE_REQ,\n+          additionalQueries: { entity_type: 'stream' },\n+        }).then(({ list }) => setStreams(list.map(_grnOptionFormatter).toArray())));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "06555bb0a61f2c22b3427f949cac3399325c5be3"}, "originalPosition": 90}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "06555bb0a61f2c22b3427f949cac3399325c5be3", "author": {"user": {"login": "kmerz", "name": "Konrad Merz"}}, "url": "https://github.com/Graylog2/graylog2-server/commit/06555bb0a61f2c22b3427f949cac3399325c5be3", "committedDate": "2020-11-26T08:25:07Z", "message": "Remove unused variables"}, "afterCommit": {"oid": "2dfb9dc30c45fa39daa9918ad9a03cc60f00060e", "author": {"user": {"login": "kmerz", "name": "Konrad Merz"}}, "url": "https://github.com/Graylog2/graylog2-server/commit/2dfb9dc30c45fa39daa9918ad9a03cc60f00060e", "committedDate": "2020-12-03T13:54:51Z", "message": "Make better help texts and place holder"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "3eb3be249b714ee616fffd2dd54789fd7ca40e1e", "author": {"user": {"login": "kmerz", "name": "Konrad Merz"}}, "url": "https://github.com/Graylog2/graylog2-server/commit/3eb3be249b714ee616fffd2dd54789fd7ca40e1e", "committedDate": "2020-12-04T09:06:59Z", "message": "Add startpage to the Settings Section of a user\n\n## Motivation\nPrior to this change, there was no way to reset the start page of a\nuser. A user could only change the startpage to a different stream.\n\n## Description\nThis change will add a new field to the settings section of a user where\nhe can edit its startpage."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f66f191488811c28965fd5b2777805d3cc9d7533", "author": {"user": {"login": "kmerz", "name": "Konrad Merz"}}, "url": "https://github.com/Graylog2/graylog2-server/commit/f66f191488811c28965fd5b2777805d3cc9d7533", "committedDate": "2020-12-04T09:07:00Z", "message": "Rename to tsx"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f2c1f36367ad3d69f250d47c6b46efaf02652c1c", "author": {"user": {"login": "kmerz", "name": "Konrad Merz"}}, "url": "https://github.com/Graylog2/graylog2-server/commit/f2c1f36367ad3d69f250d47c6b46efaf02652c1c", "committedDate": "2020-12-04T09:07:01Z", "message": "Make StreamsStore actionable"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "4674deadb3818f851334b21c7f46348e0699c51d", "author": {"user": {"login": "kmerz", "name": "Konrad Merz"}}, "url": "https://github.com/Graylog2/graylog2-server/commit/4674deadb3818f851334b21c7f46348e0699c51d", "committedDate": "2020-12-04T09:07:01Z", "message": "Let dashboard store return PaginatedViews"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a0ecfecc1a0cde3b321f8a9ddc0278a4a921d0c6", "author": {"user": {"login": "kmerz", "name": "Konrad Merz"}}, "url": "https://github.com/Graylog2/graylog2-server/commit/a0ecfecc1a0cde3b321f8a9ddc0278a4a921d0c6", "committedDate": "2020-12-04T09:07:02Z", "message": "Make Startpage comfortable selectable"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b25a6e2499370351b979963ee9ab4c7da20b8357", "author": {"user": {"login": "kmerz", "name": "Konrad Merz"}}, "url": "https://github.com/Graylog2/graylog2-server/commit/b25a6e2499370351b979963ee9ab4c7da20b8357", "committedDate": "2020-12-04T09:07:02Z", "message": "Fix typescript migration"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b79caa973f0674871ee643c017d3052e6683d76d", "author": {"user": {"login": "kmerz", "name": "Konrad Merz"}}, "url": "https://github.com/Graylog2/graylog2-server/commit/b79caa973f0674871ee643c017d3052e6683d76d", "committedDate": "2020-12-04T09:07:02Z", "message": "Display name of start page on User Details"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b968b0c009446aff92550598f18687cc765deca7", "author": {"user": {"login": "kmerz", "name": "Konrad Merz"}}, "url": "https://github.com/Graylog2/graylog2-server/commit/b968b0c009446aff92550598f18687cc765deca7", "committedDate": "2020-12-04T09:07:02Z", "message": "Fix DecoratorsConfig.tsx"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "4c38000e5dacc294a2cf226f4cc520a776aee9c0", "author": {"user": {"login": "kmerz", "name": "Konrad Merz"}}, "url": "https://github.com/Graylog2/graylog2-server/commit/4c38000e5dacc294a2cf226f4cc520a776aee9c0", "committedDate": "2020-12-04T09:07:03Z", "message": "Add waring if a user lost permission for a configured start page"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "2f4a8bdf3033e46d430a57c6533ca3de2b3c28ea", "author": {"user": {"login": "kmerz", "name": "Konrad Merz"}}, "url": "https://github.com/Graylog2/graylog2-server/commit/2f4a8bdf3033e46d430a57c6533ca3de2b3c28ea", "committedDate": "2020-12-04T09:07:03Z", "message": "Fix linter hints"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "bca7c32d63b55d9bf1caade2407440ee8b27cdf4", "author": {"user": {"login": "kmerz", "name": "Konrad Merz"}}, "url": "https://github.com/Graylog2/graylog2-server/commit/bca7c32d63b55d9bf1caade2407440ee8b27cdf4", "committedDate": "2020-12-04T09:07:04Z", "message": "Fix another linter warning"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d2419a7872df55dee415db5394864111db8b9b39", "author": {"user": {"login": "kmerz", "name": "Konrad Merz"}}, "url": "https://github.com/Graylog2/graylog2-server/commit/d2419a7872df55dee415db5394864111db8b9b39", "committedDate": "2020-12-04T09:07:05Z", "message": "Fix SectionSettings.test.tsc"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "1e3dab03930070aa7d4fc7b0f35f8d3ef69afe6b", "author": {"user": {"login": "kmerz", "name": "Konrad Merz"}}, "url": "https://github.com/Graylog2/graylog2-server/commit/1e3dab03930070aa7d4fc7b0f35f8d3ef69afe6b", "committedDate": "2020-12-04T09:07:06Z", "message": "Remove unused variables"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "cf4f7bfe0ec09ec5d871e2a568f90831fc1ec68c", "author": {"user": {"login": "kmerz", "name": "Konrad Merz"}}, "url": "https://github.com/Graylog2/graylog2-server/commit/cf4f7bfe0ec09ec5d871e2a568f90831fc1ec68c", "committedDate": "2020-12-04T09:07:06Z", "message": "Make better help texts and place holder"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "99893aa9d8bae5f5d4f4716d3ac4bc437874bc47", "author": {"user": {"login": "kmerz", "name": "Konrad Merz"}}, "url": "https://github.com/Graylog2/graylog2-server/commit/99893aa9d8bae5f5d4f4716d3ac4bc437874bc47", "committedDate": "2020-12-04T09:07:07Z", "message": "Only timeout related settings are permitted to the user"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "139e0b665ed535f8737be62ed646b71b88d560aa", "author": {"user": {"login": "kmerz", "name": "Konrad Merz"}}, "url": "https://github.com/Graylog2/graylog2-server/commit/139e0b665ed535f8737be62ed646b71b88d560aa", "committedDate": "2020-12-03T15:42:13Z", "message": "Only timeout related settings are permitted to the user"}, "afterCommit": {"oid": "99893aa9d8bae5f5d4f4716d3ac4bc437874bc47", "author": {"user": {"login": "kmerz", "name": "Konrad Merz"}}, "url": "https://github.com/Graylog2/graylog2-server/commit/99893aa9d8bae5f5d4f4716d3ac4bc437874bc47", "committedDate": "2020-12-04T09:07:07Z", "message": "Only timeout related settings are permitted to the user"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTQ1MDU4MjMx", "url": "https://github.com/Graylog2/graylog2-server/pull/9444#pullrequestreview-545058231", "createdAt": "2020-12-04T15:28:23Z", "commit": {"oid": "99893aa9d8bae5f5d4f4716d3ac4bc437874bc47"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0wNFQxNToyODoyM1rOH_V3QQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0wNFQxNToyODoyM1rOH_V3QQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNjE4MDU0NQ==", "bodyText": "When there is no type selected it says Select undefined.\nLet use Select ${value?.type} ?? 'entity' here.", "url": "https://github.com/Graylog2/graylog2-server/pull/9444#discussion_r536180545", "createdAt": "2020-12-04T15:28:23Z", "author": {"login": "linuspahl"}, "path": "graylog2-web-interface/src/components/users/StartpageFormGroup.tsx", "diffHunk": "@@ -0,0 +1,145 @@\n+/*\n+ * Copyright (C) 2020 Graylog, Inc.\n+ *\n+ * This program is free software: you can redistribute it and/or modify\n+ * it under the terms of the Server Side Public License, version 1,\n+ * as published by MongoDB, Inc.\n+ *\n+ * This program is distributed in the hope that it will be useful,\n+ * but WITHOUT ANY WARRANTY; without even the implied warranty of\n+ * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n+ * Server Side Public License for more details.\n+ *\n+ * You should have received a copy of the Server Side Public License\n+ * along with this program. If not, see\n+ * <http://www.mongodb.com/licensing/server-side-public-license>.\n+ */\n+import * as React from 'react';\n+import * as Immutable from 'immutable';\n+import { useState, useEffect } from 'react';\n+import { Field } from 'formik';\n+import styled from 'styled-components';\n+\n+import { getValuesFromGRN } from 'logic/permissions/GRN';\n+import { Button, Alert } from 'components/graylog';\n+import { Input } from 'components/bootstrap';\n+import SharedEntity from 'logic/permissions/SharedEntity';\n+import EntityShareDomain from 'domainActions/permissions/EntityShareDomain';\n+import Spinner from 'components/common/Spinner';\n+import Select from 'components/common/Select';\n+import { DashboardsActions } from 'views/stores/DashboardsStore';\n+import { StreamsActions } from 'stores/streams/StreamsStore';\n+\n+const Container = styled.div`\n+  display: flex;\n+  align-items: center;\n+`;\n+\n+const TypeSelect = styled(Select)`\n+  width: 200px;\n+  margin-right: 3px;\n+`;\n+\n+const ValueSelect = styled(Select)`\n+  width: 400px;\n+`;\n+\n+const ResetBtn = styled(Button)`\n+  margin-left: 5px;\n+`;\n+\n+type Props = {\n+  userId: string;\n+  permissions: Immutable.List<string>;\n+}\n+\n+type Option = {\n+  value: string;\n+  label: string;\n+}\n+\n+// We cannot ask for all since the backend did not implement something like this. So for now its 10000.\n+const UNLIMITED_ENTITY_SHARE_REQ = { page: 1, perPage: 10000, query: '' };\n+\n+const grnId = (grn) => getValuesFromGRN(grn).id;\n+const _grnOptionFormatter = ({ id, title }: SharedEntity): Option => ({ value: grnId(id), label: title });\n+const typeOptions = [\n+  { value: 'dashboard', label: 'Dashboard' },\n+  { value: 'stream', label: 'Stream' },\n+];\n+\n+const ADMIN_PERMISSION = '*';\n+\n+const StartpageFormGroup = ({ userId, permissions }: Props) => {\n+  const [dashboards, setDashboards] = useState<Option[] | undefined>();\n+  const [streams, setStreams] = useState<Option[] | undefined>();\n+\n+  useEffect(() => {\n+    if (permissions.includes(ADMIN_PERMISSION)) {\n+      DashboardsActions.search('', 1, 0).then(({ list }) => setDashboards(list.map(({ id, title }) => ({ value: id, label: title }))));\n+\n+      StreamsActions.searchPaginated(1, 0, '').then(({ streams: streamsList }) => setStreams(streamsList.map(({ id, title }) => ({ value: id, label: title }))));\n+    } else {\n+      EntityShareDomain.loadUserSharesPaginated(userId, {\n+        ...UNLIMITED_ENTITY_SHARE_REQ,\n+        additionalQueries: { entity_type: 'dashboard' },\n+      }).then(({ list }) => setDashboards(list.map(_grnOptionFormatter).toArray()))\n+        .then(() => EntityShareDomain.loadUserSharesPaginated(userId, {\n+          ...UNLIMITED_ENTITY_SHARE_REQ,\n+          additionalQueries: { entity_type: 'stream' },\n+        }).then(({ list }) => setStreams(list.map(_grnOptionFormatter).toArray())));\n+    }\n+  }, [permissions, userId]);\n+\n+  if (!streams || !dashboards) {\n+    return <Spinner />;\n+  }\n+\n+  return (\n+    <Field name=\"startpage\">\n+      {({ field: { name, value, onChange } }) => {\n+        const type = value?.type ?? 'dashboard';\n+        const options = type === 'dashboard' ? dashboards : streams;\n+\n+        const error = value?.id && options.findIndex(({ value: v }) => v === value.id) < 0\n+          ? <Alert bsStyle=\"warning\">User is missing permission for the configured page</Alert>\n+          : null;\n+\n+        const resetBtn = value?.type\n+          ? (\n+            <ResetBtn onClick={() => onChange({ target: { name, value: {} } })}>\n+              Reset\n+            </ResetBtn>\n+          )\n+          : null;\n+\n+        return (\n+          <>\n+            <Input id=\"startpage\"\n+                   label=\"Start page\"\n+                   help=\"Select the page the user sees right after log in. Only entities are selectable which the user has permissions for.\"\n+                   labelClassName=\"col-sm-3\"\n+                   wrapperClassName=\"col-sm-9\">\n+              <>\n+                <Container>\n+                  <TypeSelect options={typeOptions}\n+                              placeholder=\"Select type\"\n+                              onChange={(newType) => onChange({ target: { name, value: { type: newType, id: undefined } } })}\n+                              value={value?.type} />\n+                  <ValueSelect options={options}\n+                               placeholder={`Select ${value?.type}`}", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "99893aa9d8bae5f5d4f4716d3ac4bc437874bc47"}, "originalPosition": 130}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e4f520c08d9d08c938436cb19064f2404eba69c4", "author": {"user": {"login": "kmerz", "name": "Konrad Merz"}}, "url": "https://github.com/Graylog2/graylog2-server/commit/e4f520c08d9d08c938436cb19064f2404eba69c4", "committedDate": "2020-12-07T15:21:17Z", "message": "Fix permission for test"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTQ2MzU4MTM4", "url": "https://github.com/Graylog2/graylog2-server/pull/9444#pullrequestreview-546358138", "createdAt": "2020-12-07T17:12:00Z", "commit": {"oid": "e4f520c08d9d08c938436cb19064f2404eba69c4"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3422, "cost": 1, "resetAt": "2021-10-28T18:54:27Z"}}}