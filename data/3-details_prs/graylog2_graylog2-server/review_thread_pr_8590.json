{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDU0NTI3NDQ2", "number": 8590, "reviewThreads": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yMVQxOTozMzo0MFrOEQxFgg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yN1QxMDo1NzowNVrOESVmgg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjg2MDE2ODk4OnYy", "diffSide": "RIGHT", "path": "graylog2-web-interface/src/components/users/UserDetails/UserDetails.jsx", "isResolved": false, "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yMVQxOTozMzo0MFrOG1GzpQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yN1QxMDoxNjo0MFrOG3cYiw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1ODMzOTIzNw==", "bodyText": "Could the user be added to a Context Provider so that we do not have to pass it to every component?", "url": "https://github.com/Graylog2/graylog2-server/pull/8590#discussion_r458339237", "createdAt": "2020-07-21T19:33:40Z", "author": {"login": "kyleknighted"}, "path": "graylog2-web-interface/src/components/users/UserDetails/UserDetails.jsx", "diffHunk": "@@ -28,8 +29,8 @@ const UserDetails = ({ user }: Props) => {\n           <SettingsSection user={user} />\n         </div>\n         <div>\n-          <SectionComponent title=\"Teams\">Children</SectionComponent>\n           <RolesSection user={user} />\n+          <TeamsSection user={user} />", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "6f85d7cd5533566eb0ff10972a8487417e104e05"}, "originalPosition": 14}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1OTMxMzI4NQ==", "bodyText": "I will discuss this with @linuspahl on monday", "url": "https://github.com/Graylog2/graylog2-server/pull/8590#discussion_r459313285", "createdAt": "2020-07-23T09:08:22Z", "author": {"login": "kmerz"}, "path": "graylog2-web-interface/src/components/users/UserDetails/UserDetails.jsx", "diffHunk": "@@ -28,8 +29,8 @@ const UserDetails = ({ user }: Props) => {\n           <SettingsSection user={user} />\n         </div>\n         <div>\n-          <SectionComponent title=\"Teams\">Children</SectionComponent>\n           <RolesSection user={user} />\n+          <TeamsSection user={user} />", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1ODMzOTIzNw=="}, "originalCommit": {"oid": "6f85d7cd5533566eb0ff10972a8487417e104e05"}, "originalPosition": 14}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MDc4OTg5OQ==", "bodyText": "The advantages are not huge, but I agree we could something like a UserDetailsContext.", "url": "https://github.com/Graylog2/graylog2-server/pull/8590#discussion_r460789899", "createdAt": "2020-07-27T10:16:40Z", "author": {"login": "linuspahl"}, "path": "graylog2-web-interface/src/components/users/UserDetails/UserDetails.jsx", "diffHunk": "@@ -28,8 +29,8 @@ const UserDetails = ({ user }: Props) => {\n           <SettingsSection user={user} />\n         </div>\n         <div>\n-          <SectionComponent title=\"Teams\">Children</SectionComponent>\n           <RolesSection user={user} />\n+          <TeamsSection user={user} />", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1ODMzOTIzNw=="}, "originalCommit": {"oid": "6f85d7cd5533566eb0ff10972a8487417e104e05"}, "originalPosition": 14}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjg2MDE3OTcyOnYy", "diffSide": "RIGHT", "path": "graylog2-web-interface/src/components/users/UserEdit/TeamsSection.jsx", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yMVQxOTozNzowOFrOG1G6Rw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yM1QwOTowOToyMFrOG2CShA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1ODM0MDkzNQ==", "bodyText": "This looks to be the same as src/components/users/UserDetails/TeamSection.jsx:18\nCan we add a link to /system/enterprise so that users can sign up for Enterprise?", "url": "https://github.com/Graylog2/graylog2-server/pull/8590#discussion_r458340935", "createdAt": "2020-07-21T19:37:08Z", "author": {"login": "kyleknighted"}, "path": "graylog2-web-interface/src/components/users/UserEdit/TeamsSection.jsx", "diffHunk": "@@ -0,0 +1,41 @@\n+// @flow strict\n+import * as React from 'react';\n+import styled from 'styled-components';\n+import { PluginStore } from 'graylog-web-plugin/plugin';\n+\n+import User from 'logic/users/User';\n+\n+import SectionComponent from '../SectionComponent';\n+\n+type Props = {\n+  user: User,\n+};\n+\n+const Header = styled.h4`\n+  margin-bottom: 5px;\n+`;\n+\n+const NoEnterpriseComponent = () => (", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "6f85d7cd5533566eb0ff10972a8487417e104e05"}, "originalPosition": 18}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1OTMxMzc5Ng==", "bodyText": "No because there is not /system/enterprise since there is no Enterprise Plugin installed", "url": "https://github.com/Graylog2/graylog2-server/pull/8590#discussion_r459313796", "createdAt": "2020-07-23T09:09:20Z", "author": {"login": "kmerz"}, "path": "graylog2-web-interface/src/components/users/UserEdit/TeamsSection.jsx", "diffHunk": "@@ -0,0 +1,41 @@\n+// @flow strict\n+import * as React from 'react';\n+import styled from 'styled-components';\n+import { PluginStore } from 'graylog-web-plugin/plugin';\n+\n+import User from 'logic/users/User';\n+\n+import SectionComponent from '../SectionComponent';\n+\n+type Props = {\n+  user: User,\n+};\n+\n+const Header = styled.h4`\n+  margin-bottom: 5px;\n+`;\n+\n+const NoEnterpriseComponent = () => (", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1ODM0MDkzNQ=="}, "originalCommit": {"oid": "6f85d7cd5533566eb0ff10972a8487417e104e05"}, "originalPosition": 18}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjg3NjUyMzYzOnYy", "diffSide": "RIGHT", "path": "graylog2-web-interface/src/components/users/UserEdit/RolesSelector.jsx", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yN1QxMDoyMjowOFrOG3cjOQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yN1QxMDoyMjowOFrOG3cjOQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MDc5MjYzMw==", "bodyText": "I should have mentioned it in the roles select PR, but let's return the function here onChange={(role) => onChange({ target: { value: role, name } }). Just in case the related component needs to work with the return value of onChange in the future.", "url": "https://github.com/Graylog2/graylog2-server/pull/8590#discussion_r460792633", "createdAt": "2020-07-27T10:22:08Z", "author": {"login": "linuspahl"}, "path": "graylog2-web-interface/src/components/users/UserEdit/RolesSelector.jsx", "diffHunk": "@@ -0,0 +1,123 @@\n+// @flow strict\n+import * as React from 'react';\n+import { useEffect, useState } from 'react';\n+import { Formik, Form, Field } from 'formik';\n+import styled, { css } from 'styled-components';\n+import type { StyledComponent } from 'styled-components';\n+\n+import { AuthzRolesActions, type PaginatedListType } from 'stores/roles/AuthzRolesStore';\n+import { type ThemeInterface } from 'theme';\n+import { Button } from 'components/graylog';\n+import { Select } from 'components/common';\n+import User from 'logic/users/User';\n+\n+type Props = {\n+  onSubmit: ({ roles: string[] }) => Promise<void>,\n+  user: User,\n+};\n+\n+const SubmitButton = styled(Button)`\n+  margin-left: 15px;\n+`;\n+\n+const FormElements = styled.div`\n+  display: flex;\n+`;\n+\n+const Errors: StyledComponent<{}, ThemeInterface, HTMLDivElement> = styled.div(({ theme }) => css`\n+  width: 100%;\n+  margin-top: 3px;\n+  color: ${theme.colors.variant.danger};\n+\n+  > * {\n+    margin-right: 5px;\n+\n+    :last-child {\n+      margin-right: 0;\n+    }\n+  }\n+`);\n+\n+const RoleSelectOption = styled.div`\n+  display: flex;\n+  align-items: center;\n+`;\n+\n+const StyledSelect = styled(Select)`\n+  flex: 1;\n+`;\n+\n+const _renderRoleOption = ({ label }: { label: string }) => (\n+  <RoleSelectOption>{label}</RoleSelectOption>\n+);\n+\n+const _isRequired = (field) => (value) => (!value ? `The ${field} is required` : undefined);\n+\n+const RolesSelector = ({ user, onSubmit }: Props) => {\n+  const [roles, setRoles] = useState([]);\n+\n+  const onUpdate = ({ role }: { role: string }, { resetForm }) => {\n+    const userRoles = user.roles;\n+    const newRoles = userRoles.push(role).toJS();\n+\n+    onSubmit({ roles: newRoles }).then(() => {\n+      resetForm();\n+    });\n+  };\n+\n+  useEffect(() => {\n+    const getUnlimited = [1, 0, ''];\n+\n+    AuthzRolesActions.loadPaginated(...getUnlimited)\n+      .then((response: PaginatedListType) => {\n+        const { list } = response;\n+\n+        const resultRoles = list\n+          .filter((r) => !user.roles.includes(r.name))\n+          .toArray()\n+          .map((r) => ({ label: r.name, value: r.name }));\n+        setRoles(resultRoles);\n+      });\n+  }, [user]);\n+\n+  return (\n+    <div>\n+      <Formik onSubmit={onUpdate}\n+              initialValues={{ role: undefined }}>\n+        {({ isSubmitting, isValid, errors }) => (\n+          <Form>\n+            <FormElements>\n+              <Field name=\"role\" validate={_isRequired('role')}>\n+                {({ field: { name, value, onChange } }) => (\n+                  <StyledSelect inputProps={{ 'arial-label': 'Search for roles ' }}\n+                                onChange={(role) => {\n+                                  onChange({ target: { value: role, name } });", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "6eb7c8a1cf7b39811247e958496a9eb26fbe5078"}, "originalPosition": 94}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjg3NjYzNzQ2OnYy", "diffSide": "RIGHT", "path": "graylog2-web-interface/src/components/users/UserDetails/TeamSection.jsx", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yN1QxMDo1NzowNVrOG3dmOw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yN1QxMDo1NzowNVrOG3dmOw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MDgwOTc4Nw==", "bodyText": "*you need to install", "url": "https://github.com/Graylog2/graylog2-server/pull/8590#discussion_r460809787", "createdAt": "2020-07-27T10:57:05Z", "author": {"login": "linuspahl"}, "path": "graylog2-web-interface/src/components/users/UserDetails/TeamSection.jsx", "diffHunk": "@@ -0,0 +1,41 @@\n+// @flow strict\n+import * as React from 'react';\n+import styled from 'styled-components';\n+import { PluginStore } from 'graylog-web-plugin/plugin';\n+\n+import User from 'logic/users/User';\n+\n+import SectionComponent from '../SectionComponent';\n+\n+type Props = {\n+  user: User,\n+};\n+\n+const Header = styled.h4`\n+  margin-bottom: 5px;\n+`;\n+\n+const NoEnterpriseComponent = () => (\n+  <SectionComponent title=\"Teams\">\n+    <Header>No enterprise plugin found</Header>\n+    <p>To use the <b>Teams</b> functionality you install the Graylog <b>Enterprise</b> plugin.</p>", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "6eb7c8a1cf7b39811247e958496a9eb26fbe5078"}, "originalPosition": 21}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4172, "cost": 1, "resetAt": "2021-11-12T20:28:25Z"}}}