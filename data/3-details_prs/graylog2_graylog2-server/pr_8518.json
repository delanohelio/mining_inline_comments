{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDQ2ODU5NjMw", "number": 8518, "title": "Implement dependency permission check", "bodyText": "Also rename the missing_dependencies field in the sharing response to missing_permissions_on_dependencies.\nThe previous name was wrong and didn't represent the content of the field.", "createdAt": "2020-07-09T13:26:14Z", "url": "https://github.com/Graylog2/graylog2-server/pull/8518", "merged": true, "mergeCommit": {"oid": "fac46d43a1e2294bcf79ffafd4f39bfc2cdc878c"}, "closed": true, "closedAt": "2020-07-15T09:04:30Z", "author": {"login": "bernd"}, "timelineItems": {"totalCount": 11, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABczOw5dAH2gAyNDQ2ODU5NjMwOjUxNjE5ZWJjY2M0MjMwMDM4MjYzZDZmNWQ4ZTg4N2U1OTJlMDVlNzA=", "endCursor": "Y3Vyc29yOnYyOpPPAAABc1G3f1gFqTQ0ODc2NTIwOQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "51619ebccc4230038263d6f5d8e887e592e05e70", "author": {"user": {"login": "bernd", "name": "Bernd Ahlers"}}, "url": "https://github.com/Graylog2/graylog2-server/commit/51619ebccc4230038263d6f5d8e887e592e05e70", "committedDate": "2020-07-09T13:08:18Z", "message": "Implement dependency permission check"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "095fb53b18e281a2fa896854cac8d4c4fa6533e2", "author": {"user": {"login": "bernd", "name": "Bernd Ahlers"}}, "url": "https://github.com/Graylog2/graylog2-server/commit/095fb53b18e281a2fa896854cac8d4c4fa6533e2", "committedDate": "2020-07-09T13:12:57Z", "message": "Rename \"missing_dependencies\" to \"missing_permissions_on_dependencies\"\n\nThe previous name was wrong."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "5ac8c7f1989201a3f33ef2201154cb5bb7508a99", "author": {"user": {"login": "bernd", "name": "Bernd Ahlers"}}, "url": "https://github.com/Graylog2/graylog2-server/commit/5ac8c7f1989201a3f33ef2201154cb5bb7508a99", "committedDate": "2020-07-10T07:50:36Z", "message": "Move GRN classes into org.graylog.grn package\n\nAlso add GRNType to GRN and remove permissionPrefix from GRN. (it's\nalready in GRNType)"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e16985676e28e4e2a9eff40e6803b19b6744dec8", "author": {"user": {"login": "bernd", "name": "Bernd Ahlers"}}, "url": "https://github.com/Graylog2/graylog2-server/commit/e16985676e28e4e2a9eff40e6803b19b6744dec8", "committedDate": "2020-07-10T07:51:55Z", "message": "Add GRN descriptor service\n\nThis can be used to get a descriptor with metadata for a given GRN.\n(e.g. the entity title)"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "940e49c095045291e39444d70ef950102354b4da", "author": {"user": {"login": "bernd", "name": "Bernd Ahlers"}}, "url": "https://github.com/Graylog2/graylog2-server/commit/940e49c095045291e39444d70ef950102354b4da", "committedDate": "2020-07-10T08:32:53Z", "message": "Lookup owners for entity dependencies"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "4b9b312d8b5abe7b2b832a616fc676c32f4c9ef3", "author": {"user": {"login": "bernd", "name": "Bernd Ahlers"}}, "url": "https://github.com/Graylog2/graylog2-server/commit/4b9b312d8b5abe7b2b832a616fc676c32f4c9ef3", "committedDate": "2020-07-10T12:54:03Z", "message": "Merge branch 'feature/permissions' into share-dependency-permission-check"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e29ebd21f0bb9f3fa9f2c331a582fc03c939cfd3", "author": {"user": {"login": "mpfz0r", "name": "Marco Pfatschbacher"}}, "url": "https://github.com/Graylog2/graylog2-server/commit/e29ebd21f0bb9f3fa9f2c331a582fc03c939cfd3", "committedDate": "2020-07-14T07:37:20Z", "message": "Add GRN type for event definitions"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "4f342ca6f5af07f817ab171cf496d445bda2008e", "author": {"user": {"login": "mpfz0r", "name": "Marco Pfatschbacher"}}, "url": "https://github.com/Graylog2/graylog2-server/commit/4f342ca6f5af07f817ab171cf496d445bda2008e", "committedDate": "2020-07-14T07:50:39Z", "message": "Also register EVENT_DEFINITION in GRNModule"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDQ3OTAwMzU0", "url": "https://github.com/Graylog2/graylog2-server/pull/8518#pullrequestreview-447900354", "createdAt": "2020-07-14T08:32:42Z", "commit": {"oid": "4f342ca6f5af07f817ab171cf496d445bda2008e"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xNFQwODozMjo0MlrOGxJyAw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xNFQwODozMjo0MlrOGxJyAw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NDE5MzY2Nw==", "bodyText": "This will potentially build a \"user\" with the principal of a team..\nWe need to solve this sooner or later..", "url": "https://github.com/Graylog2/graylog2-server/pull/8518#discussion_r454193667", "createdAt": "2020-07-14T08:32:42Z", "author": {"login": "mpfz0r"}, "path": "graylog2-server/src/main/java/org/graylog/security/UserAuthorizer.java", "diffHunk": "@@ -0,0 +1,56 @@\n+/**\n+ * This file is part of Graylog.\n+ *\n+ * Graylog is free software: you can redistribute it and/or modify\n+ * it under the terms of the GNU General Public License as published by\n+ * the Free Software Foundation, either version 3 of the License, or\n+ * (at your option) any later version.\n+ *\n+ * Graylog is distributed in the hope that it will be useful,\n+ * but WITHOUT ANY WARRANTY; without even the implied warranty of\n+ * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n+ * GNU General Public License for more details.\n+ *\n+ * You should have received a copy of the GNU General Public License\n+ * along with Graylog.  If not, see <http://www.gnu.org/licenses/>.\n+ */\n+package org.graylog.security;\n+\n+import com.google.inject.assistedinject.Assisted;\n+import org.apache.shiro.mgt.DefaultSecurityManager;\n+import org.apache.shiro.subject.SimplePrincipalCollection;\n+import org.apache.shiro.subject.Subject;\n+import org.graylog.grn.GRN;\n+\n+import javax.inject.Inject;\n+\n+import static com.google.common.base.Preconditions.checkArgument;\n+import static org.apache.commons.lang3.StringUtils.isNotBlank;\n+\n+public class UserAuthorizer {\n+    public interface Factory {\n+        UserAuthorizer create(GRN grantee);\n+    }\n+\n+    private final Subject subject;\n+\n+    @Inject\n+    public UserAuthorizer(DefaultSecurityManager securityManager, @Assisted GRN grantee) {\n+        this.subject = new Subject.Builder(securityManager)\n+                .principals(new SimplePrincipalCollection(grantee.entity(), \"UserAuthorizer\"))", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "4f342ca6f5af07f817ab171cf496d445bda2008e"}, "originalPosition": 40}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "cc3272f8f242ffd790350a0d613ccca0be80afd6", "author": {"user": {"login": "bernd", "name": "Bernd Ahlers"}}, "url": "https://github.com/Graylog2/graylog2-server/commit/cc3272f8f242ffd790350a0d613ccca0be80afd6", "committedDate": "2020-07-15T08:03:55Z", "message": "Refactor authorizer and permission resolver to handle generic principals\n\nPreviously it handled only users, not it's possible to authorize teams\nand the global team as well."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDQ4NzY1MjA5", "url": "https://github.com/Graylog2/graylog2-server/pull/8518#pullrequestreview-448765209", "createdAt": "2020-07-15T09:04:07Z", "commit": {"oid": "cc3272f8f242ffd790350a0d613ccca0be80afd6"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2982, "cost": 1, "resetAt": "2021-10-28T18:54:27Z"}}}