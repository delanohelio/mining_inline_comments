{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDk4NTk1MTg5", "number": 9097, "title": "Moving Date Picker to Popover", "bodyText": "Description\n\nMigrating existing Date & Time Picker from SearchBar to Popover and building out Date & Time display into Search Bar\nMotivation and Context\n\n\nFirst step in adding functionality to the DTP is to give it more room.\nNeed to move it from the SearchBar to its own Popover\nScreenshots (if appropriate):\nTypes of changes\n\n\n Bug fix (non-breaking change which fixes an issue)\n New feature (non-breaking change which adds functionality)\n Refactoring (non-breaking change)\n Breaking change (fix or feature that would cause existing functionality to change)\n\nChecklist:\n\n\n\n My code follows the code style of this project.\n My change requires a change to the documentation.\n I have updated the documentation accordingly.\n I have read the CONTRIBUTING document.\n I have added tests to cover my changes.", "createdAt": "2020-10-06T14:35:56Z", "url": "https://github.com/Graylog2/graylog2-server/pull/9097", "merged": true, "mergeCommit": {"oid": "377a01d4370877b12be977334810c3e8f3606442"}, "closed": true, "closedAt": "2020-10-23T08:30:21Z", "author": {"login": "kyleknighted"}, "timelineItems": {"totalCount": 15, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdQmSctAFqTUwNTA3NjYxNQ==", "endCursor": "Y3Vyc29yOnYyOpPPAAABdVF3T1gBqjM5MTA0MzA2MTA=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTA1MDc2NjE1", "url": "https://github.com/Graylog2/graylog2-server/pull/9097#pullrequestreview-505076615", "createdAt": "2020-10-08T18:56:33Z", "commit": {"oid": "88496adc607b21685a37b7d67f054078aa94b640"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wOFQxODo1NjozNFrOHesQhw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wOFQxODo1NjozNFrOHesQhw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMTk0NDQ1NQ==", "bodyText": "Happy to discuss if there better options for this!", "url": "https://github.com/Graylog2/graylog2-server/pull/9097#discussion_r501944455", "createdAt": "2020-10-08T18:56:34Z", "author": {"login": "kyleknighted"}, "path": "graylog2-web-interface/src/views/components/searchbar/TimeRangeDisplay.jsx", "diffHunk": "@@ -0,0 +1,101 @@\n+// @flow strict\n+import * as React from 'react';\n+import { useEffect, useRef, useState } from 'react';\n+import styled, { css, type StyledComponent } from 'styled-components';\n+import moment from 'moment';\n+\n+import { type ThemeInterface } from 'theme';\n+import { type TimeRange } from 'views/logic/queries/Query';\n+import StoreProvider from 'injection/StoreProvider';\n+\n+type Props = {|\n+  timerange: ?TimeRange,\n+|};\n+\n+const EMPTY_RANGE = '----/--/-- --:--:--.---';\n+const EMPTY_OUTPUT = { from: EMPTY_RANGE, until: EMPTY_RANGE };\n+\n+const ToolsStore = StoreProvider.getStore('Tools');\n+\n+const TimeRangeWrapper: StyledComponent<{}, ThemeInterface, HTMLParagraphElement> = styled.p(({ theme }) => css`\n+  width: 100%;\n+  padding: 3px 9px;\n+  margin: 0 12px;\n+  display: flex;\n+  justify-content: space-around;\n+  background-color: ${theme.colors.variant.lightest.primary};\n+  align-items: center;\n+  border-radius: 4px;\n+  \n+  > span {\n+    flex: 1;\n+  }\n+  \n+  code {\n+    color: ${theme.colors.variant.dark.primary};\n+    background: transparent;\n+    font-size: ${theme.fonts.size.body};\n+  }\n+`);\n+\n+const dateOutput = (timerange: TimeRange) => {\n+  let from = EMPTY_RANGE;\n+\n+  switch (timerange.type) {\n+    case 'relative':\n+      from = !timerange.range ? 'All Time' : moment()\n+        .subtract(timerange.range * 1000)\n+        .fromNow();\n+\n+      return {\n+        from,\n+        until: 'Now',\n+      };\n+\n+    case 'absolute':\n+    case 'keyword':\n+      return { from: timerange.from, until: timerange.to };\n+    default:\n+      return { from, until: from };\n+  }\n+};\n+\n+const TimeRangeDisplay = ({ timerange }: Props) => {\n+  const [{ from, until }, setTimeOutput] = useState(EMPTY_OUTPUT);\n+  const dateTested = useRef(false);\n+\n+  useEffect(() => {\n+    if (timerange?.type === 'keyword' && !timerange.from) {\n+      if (!dateTested.current) {\n+        ToolsStore.testNaturalDate(timerange.keyword)\n+          .then((response) => {\n+            dateTested.current = true;\n+\n+            setTimeOutput({\n+              from: response.from,\n+              until: response.to,\n+            });\n+          }, () => {\n+            setTimeOutput(EMPTY_OUTPUT);\n+          });\n+      }\n+    } else if (timerange?.type) {\n+      setTimeOutput(dateOutput(timerange));\n+    }\n+  }, [dateTested, timerange]);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "88496adc607b21685a37b7d67f054078aa94b640"}, "originalPosition": 85}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTA2Mzg1ODk5", "url": "https://github.com/Graylog2/graylog2-server/pull/9097#pullrequestreview-506385899", "createdAt": "2020-10-12T08:08:27Z", "commit": {"oid": "88496adc607b21685a37b7d67f054078aa94b640"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xMlQwODowODoyN1rOHfzhMg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xMlQwODowODoyN1rOHfzhMg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMzExMTk4Ng==", "bodyText": "If I am not mistaken default should throw an error. If someone is adding a new timerange type he would be thankful if the code is leading him to the places where he needs to insert the new type. And the current default should never occur otherwise.", "url": "https://github.com/Graylog2/graylog2-server/pull/9097#discussion_r503111986", "createdAt": "2020-10-12T08:08:27Z", "author": {"login": "kmerz"}, "path": "graylog2-web-interface/src/views/components/searchbar/TimeRangeDisplay.jsx", "diffHunk": "@@ -0,0 +1,101 @@\n+// @flow strict\n+import * as React from 'react';\n+import { useEffect, useRef, useState } from 'react';\n+import styled, { css, type StyledComponent } from 'styled-components';\n+import moment from 'moment';\n+\n+import { type ThemeInterface } from 'theme';\n+import { type TimeRange } from 'views/logic/queries/Query';\n+import StoreProvider from 'injection/StoreProvider';\n+\n+type Props = {|\n+  timerange: ?TimeRange,\n+|};\n+\n+const EMPTY_RANGE = '----/--/-- --:--:--.---';\n+const EMPTY_OUTPUT = { from: EMPTY_RANGE, until: EMPTY_RANGE };\n+\n+const ToolsStore = StoreProvider.getStore('Tools');\n+\n+const TimeRangeWrapper: StyledComponent<{}, ThemeInterface, HTMLParagraphElement> = styled.p(({ theme }) => css`\n+  width: 100%;\n+  padding: 3px 9px;\n+  margin: 0 12px;\n+  display: flex;\n+  justify-content: space-around;\n+  background-color: ${theme.colors.variant.lightest.primary};\n+  align-items: center;\n+  border-radius: 4px;\n+  \n+  > span {\n+    flex: 1;\n+  }\n+  \n+  code {\n+    color: ${theme.colors.variant.dark.primary};\n+    background: transparent;\n+    font-size: ${theme.fonts.size.body};\n+  }\n+`);\n+\n+const dateOutput = (timerange: TimeRange) => {\n+  let from = EMPTY_RANGE;\n+\n+  switch (timerange.type) {\n+    case 'relative':\n+      from = !timerange.range ? 'All Time' : moment()\n+        .subtract(timerange.range * 1000)\n+        .fromNow();\n+\n+      return {\n+        from,\n+        until: 'Now',\n+      };\n+\n+    case 'absolute':\n+    case 'keyword':\n+      return { from: timerange.from, until: timerange.to };\n+    default:", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "88496adc607b21685a37b7d67f054078aa94b640"}, "originalPosition": 58}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "5e102223309435cff4465a427379316103f84bd0", "author": {"user": {"login": "kyleknighted", "name": "Kyle Knight"}}, "url": "https://github.com/Graylog2/graylog2-server/commit/5e102223309435cff4465a427379316103f84bd0", "committedDate": "2020-10-22T17:57:03Z", "message": "Migrating original range options to Popover"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "640096b000e85b5cfb72ada27e72075284baa8f7", "author": {"user": {"login": "kyleknighted", "name": "Kyle Knight"}}, "url": "https://github.com/Graylog2/graylog2-server/commit/640096b000e85b5cfb72ada27e72075284baa8f7", "committedDate": "2020-10-22T17:57:03Z", "message": "Converting existing DateTimePicker to Popover"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d6fa8e3e25cf6603593ba638b5957f0795f9d435", "author": {"user": {"login": "kyleknighted", "name": "Kyle Knight"}}, "url": "https://github.com/Graylog2/graylog2-server/commit/d6fa8e3e25cf6603593ba638b5957f0795f9d435", "committedDate": "2020-10-22T17:57:03Z", "message": "Styling TimeRangeDisplay"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "2cebfa5a66514bbdfe5074bbd984c6285775c932", "author": {"user": {"login": "kyleknighted", "name": "Kyle Knight"}}, "url": "https://github.com/Graylog2/graylog2-server/commit/2cebfa5a66514bbdfe5074bbd984c6285775c932", "committedDate": "2020-10-22T17:57:03Z", "message": "Flow Tests"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ac35859933fd37d27b6040895d057f677c7d65ff", "author": {"user": {"login": "kyleknighted", "name": "Kyle Knight"}}, "url": "https://github.com/Graylog2/graylog2-server/commit/ac35859933fd37d27b6040895d057f677c7d65ff", "committedDate": "2020-10-22T17:57:03Z", "message": "Some Cleanup"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "25112b1e7dbef5ad6dc0da649911ec1682ace5cf", "author": {"user": {"login": "kyleknighted", "name": "Kyle Knight"}}, "url": "https://github.com/Graylog2/graylog2-server/commit/25112b1e7dbef5ad6dc0da649911ec1682ace5cf", "committedDate": "2020-10-22T17:57:04Z", "message": "temp -> tempTimeRange"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "9e009404c1bec47b91264f839d5928af7c7e347c", "author": {"user": {"login": "kyleknighted", "name": "Kyle Knight"}}, "url": "https://github.com/Graylog2/graylog2-server/commit/9e009404c1bec47b91264f839d5928af7c7e347c", "committedDate": "2020-10-22T17:57:04Z", "message": "Linting"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "86688606af936dd08f485400ab5f8bc6b7adc551", "author": {"user": {"login": "kyleknighted", "name": "Kyle Knight"}}, "url": "https://github.com/Graylog2/graylog2-server/commit/86688606af936dd08f485400ab5f8bc6b7adc551", "committedDate": "2020-10-22T17:57:04Z", "message": "Keyword output"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c037d11c9c01417be177e6c0fba47f38b4d255f6", "author": {"user": {"login": "kyleknighted", "name": "Kyle Knight"}}, "url": "https://github.com/Graylog2/graylog2-server/commit/c037d11c9c01417be177e6c0fba47f38b4d255f6", "committedDate": "2020-10-22T17:57:04Z", "message": "All time ranges loading properly"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "63ccc2381306ed2d42961ceacae743bc17e867ce", "author": {"user": {"login": "kyleknighted", "name": "Kyle Knight"}}, "url": "https://github.com/Graylog2/graylog2-server/commit/63ccc2381306ed2d42961ceacae743bc17e867ce", "committedDate": "2020-10-22T17:57:04Z", "message": "react hook linting"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "082af7acca570773fb673f66300a25caa8fe44ef", "author": {"user": {"login": "kyleknighted", "name": "Kyle Knight"}}, "url": "https://github.com/Graylog2/graylog2-server/commit/082af7acca570773fb673f66300a25caa8fe44ef", "committedDate": "2020-10-22T17:57:04Z", "message": "lint weak objects"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "92d1e3ac551832c94925c2fa6ae07648794c47b2", "author": {"user": {"login": "kyleknighted", "name": "Kyle Knight"}}, "url": "https://github.com/Graylog2/graylog2-server/commit/92d1e3ac551832c94925c2fa6ae07648794c47b2", "committedDate": "2020-10-22T17:57:04Z", "message": "Error on TimeRangeDisplay default type"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "e496b30cabf4b00a8e7863f015e636f0fac6db17", "author": {"user": {"login": "kyleknighted", "name": "Kyle Knight"}}, "url": "https://github.com/Graylog2/graylog2-server/commit/e496b30cabf4b00a8e7863f015e636f0fac6db17", "committedDate": "2020-10-14T19:20:27Z", "message": "Error on TimeRangeDisplay default type"}, "afterCommit": {"oid": "92d1e3ac551832c94925c2fa6ae07648794c47b2", "author": {"user": {"login": "kyleknighted", "name": "Kyle Knight"}}, "url": "https://github.com/Graylog2/graylog2-server/commit/92d1e3ac551832c94925c2fa6ae07648794c47b2", "committedDate": "2020-10-22T17:57:04Z", "message": "Error on TimeRangeDisplay default type"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3495, "cost": 1, "resetAt": "2021-10-28T18:54:27Z"}}}