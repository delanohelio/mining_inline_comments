{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDU0NTI3NDQ2", "number": 8590, "title": "Teams edit", "bodyText": "Description\nAdd Teams Section to the UserDetails and UserEdit page.\n#8573 needs to be merged first.\nTypes of changes\n\n Bug fix (non-breaking change which fixes an issue)\n New feature (non-breaking change which adds functionality)\n Refactoring (non-breaking change)\n Breaking change (fix or feature that would cause existing functionality to change)", "createdAt": "2020-07-21T14:03:33Z", "url": "https://github.com/Graylog2/graylog2-server/pull/8590", "merged": true, "mergeCommit": {"oid": "bf54b27528bd02b7db40667e4ffce5bc3ea6da3d"}, "closed": true, "closedAt": "2020-07-28T08:05:18Z", "author": {"login": "kmerz"}, "timelineItems": {"totalCount": 10, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABc3Lq_nAFqTQ1Mjc2Nzk0MQ==", "endCursor": "Y3Vyc29yOnYyOpPPAAABc5R0B_gFqTQ1NjM5NTgwMw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDUyNzY3OTQx", "url": "https://github.com/Graylog2/graylog2-server/pull/8590#pullrequestreview-452767941", "createdAt": "2020-07-21T19:33:40Z", "commit": {"oid": "6f85d7cd5533566eb0ff10972a8487417e104e05"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yMVQxOTozMzo0MFrOG1GzpQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yMVQxOTozNzowOFrOG1G6Rw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1ODMzOTIzNw==", "bodyText": "Could the user be added to a Context Provider so that we do not have to pass it to every component?", "url": "https://github.com/Graylog2/graylog2-server/pull/8590#discussion_r458339237", "createdAt": "2020-07-21T19:33:40Z", "author": {"login": "kyleknighted"}, "path": "graylog2-web-interface/src/components/users/UserDetails/UserDetails.jsx", "diffHunk": "@@ -28,8 +29,8 @@ const UserDetails = ({ user }: Props) => {\n           <SettingsSection user={user} />\n         </div>\n         <div>\n-          <SectionComponent title=\"Teams\">Children</SectionComponent>\n           <RolesSection user={user} />\n+          <TeamsSection user={user} />", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "6f85d7cd5533566eb0ff10972a8487417e104e05"}, "originalPosition": 14}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1ODM0MDkzNQ==", "bodyText": "This looks to be the same as src/components/users/UserDetails/TeamSection.jsx:18\nCan we add a link to /system/enterprise so that users can sign up for Enterprise?", "url": "https://github.com/Graylog2/graylog2-server/pull/8590#discussion_r458340935", "createdAt": "2020-07-21T19:37:08Z", "author": {"login": "kyleknighted"}, "path": "graylog2-web-interface/src/components/users/UserEdit/TeamsSection.jsx", "diffHunk": "@@ -0,0 +1,41 @@\n+// @flow strict\n+import * as React from 'react';\n+import styled from 'styled-components';\n+import { PluginStore } from 'graylog-web-plugin/plugin';\n+\n+import User from 'logic/users/User';\n+\n+import SectionComponent from '../SectionComponent';\n+\n+type Props = {\n+  user: User,\n+};\n+\n+const Header = styled.h4`\n+  margin-bottom: 5px;\n+`;\n+\n+const NoEnterpriseComponent = () => (", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "6f85d7cd5533566eb0ff10972a8487417e104e05"}, "originalPosition": 18}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "6f85d7cd5533566eb0ff10972a8487417e104e05", "author": {"user": {"login": "kmerz", "name": "Konrad Merz"}}, "url": "https://github.com/Graylog2/graylog2-server/commit/6f85d7cd5533566eb0ff10972a8487417e104e05", "committedDate": "2020-07-21T14:01:07Z", "message": "List all teams of the user in User Details"}, "afterCommit": {"oid": "c60a91dc430dc1f0ae9401a12e36a946a3aa39a4", "author": {"user": {"login": "kmerz", "name": "Konrad Merz"}}, "url": "https://github.com/Graylog2/graylog2-server/commit/c60a91dc430dc1f0ae9401a12e36a946a3aa39a4", "committedDate": "2020-07-24T08:55:29Z", "message": "List all teams of the user in User Details"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "c60a91dc430dc1f0ae9401a12e36a946a3aa39a4", "author": {"user": {"login": "kmerz", "name": "Konrad Merz"}}, "url": "https://github.com/Graylog2/graylog2-server/commit/c60a91dc430dc1f0ae9401a12e36a946a3aa39a4", "committedDate": "2020-07-24T08:55:29Z", "message": "List all teams of the user in User Details"}, "afterCommit": {"oid": "6eb7c8a1cf7b39811247e958496a9eb26fbe5078", "author": {"user": {"login": "kmerz", "name": "Konrad Merz"}}, "url": "https://github.com/Graylog2/graylog2-server/commit/6eb7c8a1cf7b39811247e958496a9eb26fbe5078", "committedDate": "2020-07-27T10:09:29Z", "message": "List all teams of the user in User Details"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDU1NjU3OTU4", "url": "https://github.com/Graylog2/graylog2-server/pull/8590#pullrequestreview-455657958", "createdAt": "2020-07-27T10:22:07Z", "commit": {"oid": "6eb7c8a1cf7b39811247e958496a9eb26fbe5078"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yN1QxMDoyMjowOFrOG3cjOQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yN1QxMDo1NzowNVrOG3dmOw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MDc5MjYzMw==", "bodyText": "I should have mentioned it in the roles select PR, but let's return the function here onChange={(role) => onChange({ target: { value: role, name } }). Just in case the related component needs to work with the return value of onChange in the future.", "url": "https://github.com/Graylog2/graylog2-server/pull/8590#discussion_r460792633", "createdAt": "2020-07-27T10:22:08Z", "author": {"login": "linuspahl"}, "path": "graylog2-web-interface/src/components/users/UserEdit/RolesSelector.jsx", "diffHunk": "@@ -0,0 +1,123 @@\n+// @flow strict\n+import * as React from 'react';\n+import { useEffect, useState } from 'react';\n+import { Formik, Form, Field } from 'formik';\n+import styled, { css } from 'styled-components';\n+import type { StyledComponent } from 'styled-components';\n+\n+import { AuthzRolesActions, type PaginatedListType } from 'stores/roles/AuthzRolesStore';\n+import { type ThemeInterface } from 'theme';\n+import { Button } from 'components/graylog';\n+import { Select } from 'components/common';\n+import User from 'logic/users/User';\n+\n+type Props = {\n+  onSubmit: ({ roles: string[] }) => Promise<void>,\n+  user: User,\n+};\n+\n+const SubmitButton = styled(Button)`\n+  margin-left: 15px;\n+`;\n+\n+const FormElements = styled.div`\n+  display: flex;\n+`;\n+\n+const Errors: StyledComponent<{}, ThemeInterface, HTMLDivElement> = styled.div(({ theme }) => css`\n+  width: 100%;\n+  margin-top: 3px;\n+  color: ${theme.colors.variant.danger};\n+\n+  > * {\n+    margin-right: 5px;\n+\n+    :last-child {\n+      margin-right: 0;\n+    }\n+  }\n+`);\n+\n+const RoleSelectOption = styled.div`\n+  display: flex;\n+  align-items: center;\n+`;\n+\n+const StyledSelect = styled(Select)`\n+  flex: 1;\n+`;\n+\n+const _renderRoleOption = ({ label }: { label: string }) => (\n+  <RoleSelectOption>{label}</RoleSelectOption>\n+);\n+\n+const _isRequired = (field) => (value) => (!value ? `The ${field} is required` : undefined);\n+\n+const RolesSelector = ({ user, onSubmit }: Props) => {\n+  const [roles, setRoles] = useState([]);\n+\n+  const onUpdate = ({ role }: { role: string }, { resetForm }) => {\n+    const userRoles = user.roles;\n+    const newRoles = userRoles.push(role).toJS();\n+\n+    onSubmit({ roles: newRoles }).then(() => {\n+      resetForm();\n+    });\n+  };\n+\n+  useEffect(() => {\n+    const getUnlimited = [1, 0, ''];\n+\n+    AuthzRolesActions.loadPaginated(...getUnlimited)\n+      .then((response: PaginatedListType) => {\n+        const { list } = response;\n+\n+        const resultRoles = list\n+          .filter((r) => !user.roles.includes(r.name))\n+          .toArray()\n+          .map((r) => ({ label: r.name, value: r.name }));\n+        setRoles(resultRoles);\n+      });\n+  }, [user]);\n+\n+  return (\n+    <div>\n+      <Formik onSubmit={onUpdate}\n+              initialValues={{ role: undefined }}>\n+        {({ isSubmitting, isValid, errors }) => (\n+          <Form>\n+            <FormElements>\n+              <Field name=\"role\" validate={_isRequired('role')}>\n+                {({ field: { name, value, onChange } }) => (\n+                  <StyledSelect inputProps={{ 'arial-label': 'Search for roles ' }}\n+                                onChange={(role) => {\n+                                  onChange({ target: { value: role, name } });", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "6eb7c8a1cf7b39811247e958496a9eb26fbe5078"}, "originalPosition": 94}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MDgwOTc4Nw==", "bodyText": "*you need to install", "url": "https://github.com/Graylog2/graylog2-server/pull/8590#discussion_r460809787", "createdAt": "2020-07-27T10:57:05Z", "author": {"login": "linuspahl"}, "path": "graylog2-web-interface/src/components/users/UserDetails/TeamSection.jsx", "diffHunk": "@@ -0,0 +1,41 @@\n+// @flow strict\n+import * as React from 'react';\n+import styled from 'styled-components';\n+import { PluginStore } from 'graylog-web-plugin/plugin';\n+\n+import User from 'logic/users/User';\n+\n+import SectionComponent from '../SectionComponent';\n+\n+type Props = {\n+  user: User,\n+};\n+\n+const Header = styled.h4`\n+  margin-bottom: 5px;\n+`;\n+\n+const NoEnterpriseComponent = () => (\n+  <SectionComponent title=\"Teams\">\n+    <Header>No enterprise plugin found</Header>\n+    <p>To use the <b>Teams</b> functionality you install the Graylog <b>Enterprise</b> plugin.</p>", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "6eb7c8a1cf7b39811247e958496a9eb26fbe5078"}, "originalPosition": 21}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "6eb7c8a1cf7b39811247e958496a9eb26fbe5078", "author": {"user": {"login": "kmerz", "name": "Konrad Merz"}}, "url": "https://github.com/Graylog2/graylog2-server/commit/6eb7c8a1cf7b39811247e958496a9eb26fbe5078", "committedDate": "2020-07-27T10:09:29Z", "message": "List all teams of the user in User Details"}, "afterCommit": {"oid": "396bfae3852765fbab84999ab6b6e0d7f437144e", "author": {"user": {"login": "kmerz", "name": "Konrad Merz"}}, "url": "https://github.com/Graylog2/graylog2-server/commit/396bfae3852765fbab84999ab6b6e0d7f437144e", "committedDate": "2020-07-27T12:56:05Z", "message": "Fix annotations from @linuspahl"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a5562650e0b314eed3b5cc289f978ef9dbe2b91e", "author": {"user": {"login": "kmerz", "name": "Konrad Merz"}}, "url": "https://github.com/Graylog2/graylog2-server/commit/a5562650e0b314eed3b5cc289f978ef9dbe2b91e", "committedDate": "2020-07-27T13:43:39Z", "message": "Add TeamsSection"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "3f7058c5d93ef5d9be75a1d3c64db2cf057d6188", "author": {"user": {"login": "kmerz", "name": "Konrad Merz"}}, "url": "https://github.com/Graylog2/graylog2-server/commit/3f7058c5d93ef5d9be75a1d3c64db2cf057d6188", "committedDate": "2020-07-27T13:43:39Z", "message": "List all teams of the user in User Details"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "607b8b3691070189251d0f42b297dce38d6980d4", "author": {"user": {"login": "kmerz", "name": "Konrad Merz"}}, "url": "https://github.com/Graylog2/graylog2-server/commit/607b8b3691070189251d0f42b297dce38d6980d4", "committedDate": "2020-07-27T13:43:39Z", "message": "Fix annotations from @linuspahl"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "396bfae3852765fbab84999ab6b6e0d7f437144e", "author": {"user": {"login": "kmerz", "name": "Konrad Merz"}}, "url": "https://github.com/Graylog2/graylog2-server/commit/396bfae3852765fbab84999ab6b6e0d7f437144e", "committedDate": "2020-07-27T12:56:05Z", "message": "Fix annotations from @linuspahl"}, "afterCommit": {"oid": "607b8b3691070189251d0f42b297dce38d6980d4", "author": {"user": {"login": "kmerz", "name": "Konrad Merz"}}, "url": "https://github.com/Graylog2/graylog2-server/commit/607b8b3691070189251d0f42b297dce38d6980d4", "committedDate": "2020-07-27T13:43:39Z", "message": "Fix annotations from @linuspahl"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDU2Mzk1ODAz", "url": "https://github.com/Graylog2/graylog2-server/pull/8590#pullrequestreview-456395803", "createdAt": "2020-07-28T08:04:59Z", "commit": {"oid": "607b8b3691070189251d0f42b297dce38d6980d4"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3042, "cost": 1, "resetAt": "2021-10-28T18:54:27Z"}}}