{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTMxNjg0ODY0", "number": 9693, "title": "Simplify pulsar processing", "bodyText": "Get rid of a few intermediate classes and use RawMessageEvent directly. This saves us a few conversion steps.\n\n\nUnify messageQueueId and journalOffset", "createdAt": "2020-12-03T10:47:27Z", "url": "https://github.com/Graylog2/graylog2-server/pull/9693", "merged": true, "mergeCommit": {"oid": "7ea94c615a4bd8f41087ef293984f86930f2ee1e"}, "closed": true, "closedAt": "2020-12-07T16:02:37Z", "author": {"login": "mpfz0r"}, "timelineItems": {"totalCount": 16, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdikNCagBqjQwNjc4NjExOTQ=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdj3voDgFqTU0NjI5MTQ3MQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "cb31b43b4be7622ecb1b1352b9b578d473529313", "author": {"user": {"login": "mpfz0r", "name": "Marco Pfatschbacher"}}, "url": "https://github.com/Graylog2/graylog2-server/commit/cb31b43b4be7622ecb1b1352b9b578d473529313", "committedDate": "2020-12-03T12:14:48Z", "message": "Compare array content. Found by errorprone plugin"}, "afterCommit": {"oid": "636688c6a100ebc2c3bae67ff7afb4027c132fb3", "author": {"user": {"login": "mpfz0r", "name": "Marco Pfatschbacher"}}, "url": "https://github.com/Graylog2/graylog2-server/commit/636688c6a100ebc2c3bae67ff7afb4027c132fb3", "committedDate": "2020-12-03T14:40:48Z", "message": "Compare array content. Found by errorprone plugin"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c59db5ea3a4978ff03d57172fa22bb6626b6a460", "author": {"user": {"login": "mpfz0r", "name": "Marco Pfatschbacher"}}, "url": "https://github.com/Graylog2/graylog2-server/commit/c59db5ea3a4978ff03d57172fa22bb6626b6a460", "committedDate": "2020-12-03T15:18:51Z", "message": "Simplify input processing\n\nGet rid of a few intermediate classes and use RawMessageEvent\ndirectly.\nThis saves us a few conversion steps."}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "636688c6a100ebc2c3bae67ff7afb4027c132fb3", "author": {"user": {"login": "mpfz0r", "name": "Marco Pfatschbacher"}}, "url": "https://github.com/Graylog2/graylog2-server/commit/636688c6a100ebc2c3bae67ff7afb4027c132fb3", "committedDate": "2020-12-03T14:40:48Z", "message": "Compare array content. Found by errorprone plugin"}, "afterCommit": {"oid": "c59db5ea3a4978ff03d57172fa22bb6626b6a460", "author": {"user": {"login": "mpfz0r", "name": "Marco Pfatschbacher"}}, "url": "https://github.com/Graylog2/graylog2-server/commit/c59db5ea3a4978ff03d57172fa22bb6626b6a460", "committedDate": "2020-12-03T15:18:51Z", "message": "Simplify input processing\n\nGet rid of a few intermediate classes and use RawMessageEvent\ndirectly.\nThis saves us a few conversion steps."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ba289fc81fab36b7485601bf5bfb3ac0ea98acae", "author": {"user": {"login": "mpfz0r", "name": "Marco Pfatschbacher"}}, "url": "https://github.com/Graylog2/graylog2-server/commit/ba289fc81fab36b7485601bf5bfb3ac0ea98acae", "committedDate": "2020-12-03T15:20:25Z", "message": "Unify messageQueueId and journalOffset"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "dcc0704828389d28d1203539300861bc146aaed7", "author": {"user": {"login": "mpfz0r", "name": "Marco Pfatschbacher"}}, "url": "https://github.com/Graylog2/graylog2-server/commit/dcc0704828389d28d1203539300861bc146aaed7", "committedDate": "2020-12-03T16:35:29Z", "message": "Merge remote-tracking branch 'origin/pulsar' into simplify-pulsar-processing"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "5a2bed586f1548b8fe327c5de282a0b91c7eb0c2", "author": {"user": {"login": "mpfz0r", "name": "Marco Pfatschbacher"}}, "url": "https://github.com/Graylog2/graylog2-server/commit/5a2bed586f1548b8fe327c5de282a0b91c7eb0c2", "committedDate": "2020-12-03T16:37:01Z", "message": "Use MessageQueueAcknowledger instead of Journal"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f2019ee8378554555c133424a6cdc1bb53c65efb", "author": {"user": {"login": "thll", "name": "Othello Maurer"}}, "url": "https://github.com/Graylog2/graylog2-server/commit/f2019ee8378554555c133424a6cdc1bb53c65efb", "committedDate": "2020-12-04T10:23:31Z", "message": "Merge pull request #9700 from Graylog2/use-messagequeue-acknowledger\n\nUse MessageQueueAcknowledger instead of Journal"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTQ0ODUzNTgx", "url": "https://github.com/Graylog2/graylog2-server/pull/9693#pullrequestreview-544853581", "createdAt": "2020-12-04T10:53:28Z", "commit": {"oid": "f2019ee8378554555c133424a6cdc1bb53c65efb"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0wNFQxMDo1MzoyOVrOH_Llqg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0wNFQxMzo1Nzo0MFrOH_SAzw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNjAxMjIwMg==", "bodyText": "Yes please!", "url": "https://github.com/Graylog2/graylog2-server/pull/9693#discussion_r536012202", "createdAt": "2020-12-04T10:53:29Z", "author": {"login": "thll"}, "path": "graylog2-server/src/main/java/org/graylog2/shared/messageq/kafka/KafkaMessageQueueReader.java", "diffHunk": "@@ -16,22 +16,15 @@\n  */\n package org.graylog2.shared.messageq.kafka;\n \n-import com.google.common.base.Function;\n-import com.google.common.collect.Lists;\n import com.google.common.util.concurrent.AbstractService;\n-import org.graylog2.shared.journal.Journal;\n import org.graylog2.shared.journal.KafkaJournal;\n-import org.graylog2.shared.messageq.MessageQueue;\n import org.graylog2.shared.messageq.MessageQueueException;\n import org.graylog2.shared.messageq.MessageQueueReader;\n \n-import javax.annotation.Nullable;\n import javax.inject.Inject;\n-import java.util.ArrayList;\n import java.util.List;\n \n-import static com.google.common.collect.Lists.transform;\n-\n+// TODO this doesn't do anything but to please the interface. remove?", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f2019ee8378554555c133424a6cdc1bb53c65efb"}, "originalPosition": 20}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNjEwMTU0Mw==", "bodyText": "Afaics the commitId can now not be null anymore, so we should also remove the @Nullable annotation from #commitId().", "url": "https://github.com/Graylog2/graylog2-server/pull/9693#discussion_r536101543", "createdAt": "2020-12-04T13:32:23Z", "author": {"login": "thll"}, "path": "graylog2-server/src/main/java/org/graylog2/shared/messageq/pulsar/PulsarMessageQueueEntry.java", "diffHunk": "@@ -43,15 +43,6 @@\n         this.timestamp = message.getEventTime();\n     }\n \n-    PulsarMessageQueueEntry(byte[] id, @Nullable byte[] key, byte[] value, long timestamp) {\n-        this.commitId = null;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f2019ee8378554555c133424a6cdc1bb53c65efb"}, "originalPosition": 5}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNjExNzQ1NQ==", "bodyText": "Do you think we still need the exception handling? If so, we should adjust the error message and re-add the filtering of null messages in #onEvent. I have the feeling we can just remove the exception handling though because we are not doing much which would be prone to throwing exceptions, except maybe a NPE in line 126 which we then probably should guard against.", "url": "https://github.com/Graylog2/graylog2-server/pull/9693#discussion_r536117455", "createdAt": "2020-12-04T13:57:40Z", "author": {"login": "thll"}, "path": "graylog2-server/src/main/java/org/graylog2/shared/buffers/JournallingMessageHandler.java", "diffHunk": "@@ -161,12 +132,7 @@ public DateTime getLatestReceiveTime() {\n                     latestReceiveTime = latestReceiveTime.isBefore(messageTimestamp) ? messageTimestamp : latestReceiveTime;\n                 }\n \n-                // clear for gc and to avoid promotion to tenured space\n-                input.setMessageIdBytes(null);\n-                input.setEncodedRawMessage(null);\n-                input.setMessageTimestamp(null);\n-                // convert to journal entry\n-                return journal.createEntry(messageIdBytes, encodedRawMessage);\n+                return input;\n             } catch (Exception e) {\n                 log.error(\"Unable to convert RawMessageEvent to Journal.Entry - skipping event\", e);\n                 return null;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f2019ee8378554555c133424a6cdc1bb53c65efb"}, "originalPosition": 88}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b21e9f69a00a282e70fef4d4c4e032d436881ed6", "author": {"user": {"login": "mpfz0r", "name": "Marco Pfatschbacher"}}, "url": "https://github.com/Graylog2/graylog2-server/commit/b21e9f69a00a282e70fef4d4c4e032d436881ed6", "committedDate": "2020-12-07T09:11:32Z", "message": "Remove MessageQueueReader interface\n\n - It doesn't fit our current abstraction"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "711fa9f313e5cab18e420a5b7a9a03a5741b3423", "author": {"user": {"login": "mpfz0r", "name": "Marco Pfatschbacher"}}, "url": "https://github.com/Graylog2/graylog2-server/commit/711fa9f313e5cab18e420a5b7a9a03a5741b3423", "committedDate": "2020-12-07T09:16:23Z", "message": "Remove Nullable from commitId"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "8440a10bcb44621499959229d24714fd8fcef4de", "author": {"user": {"login": "mpfz0r", "name": "Marco Pfatschbacher"}}, "url": "https://github.com/Graylog2/graylog2-server/commit/8440a10bcb44621499959229d24714fd8fcef4de", "committedDate": "2020-12-07T09:36:22Z", "message": "Remove exception handling from Filter.\n\nIt doesn't do any conversion anymore, but simply\nrecord statistics."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d57a49360bcc01c26f82269f9bfcac73f887e0a2", "author": {"user": {"login": "mpfz0r", "name": "Marco Pfatschbacher"}}, "url": "https://github.com/Graylog2/graylog2-server/commit/d57a49360bcc01c26f82269f9bfcac73f887e0a2", "committedDate": "2020-12-07T09:46:15Z", "message": "Remove unneded dependency"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "4d8558b44c2c0e2fa4317e66dfa86386d58c8be4", "author": {"user": {"login": "mpfz0r", "name": "Marco Pfatschbacher"}}, "url": "https://github.com/Graylog2/graylog2-server/commit/4d8558b44c2c0e2fa4317e66dfa86386d58c8be4", "committedDate": "2020-12-07T09:46:29Z", "message": "Keep updating the processingStatusRecorder\n\nThis got deleted by accident :-/"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b3f7bb25a450736bbf5ba1eaa470d9420602f7d6", "author": {"user": {"login": "mpfz0r", "name": "Marco Pfatschbacher"}}, "url": "https://github.com/Graylog2/graylog2-server/commit/b3f7bb25a450736bbf5ba1eaa470d9420602f7d6", "committedDate": "2020-12-07T09:52:00Z", "message": "Remove more unused code"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e641637cdda7a026afc54c7773c808a3c8a4e7cc", "author": {"user": {"login": "mpfz0r", "name": "Marco Pfatschbacher"}}, "url": "https://github.com/Graylog2/graylog2-server/commit/e641637cdda7a026afc54c7773c808a3c8a4e7cc", "committedDate": "2020-12-07T10:54:56Z", "message": "Don't journal messages where encodedRawMessage is null\n\nThis restores the previous behaviour of the JournallingMessageHandler.\n\nUse Streams instead of arcane guava Lists transform."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTQ2MjkxNDcx", "url": "https://github.com/Graylog2/graylog2-server/pull/9693#pullrequestreview-546291471", "createdAt": "2020-12-07T16:01:24Z", "commit": {"oid": "e641637cdda7a026afc54c7773c808a3c8a4e7cc"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3286, "cost": 1, "resetAt": "2021-10-28T18:54:27Z"}}}