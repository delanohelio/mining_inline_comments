{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDU3NzAzNzg2", "number": 8632, "reviewThreads": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0wM1QwNzo1OToyMFrOEUgW7A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0wM1QwNzo1OToyMFrOEUgW7A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjg5OTM3MTMyOnYy", "diffSide": "RIGHT", "path": "graylog2-server/src/main/java/org/graylog2/indexer/EventsIndexMapping6.java", "isResolved": true, "comments": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0wM1QwNzo1OToyMFrOG6vxCQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0wNFQxNTowMDozNFrOG7kf3g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NDI1MzE5Mw==", "bodyText": "What is the actual todo item here?", "url": "https://github.com/Graylog2/graylog2-server/pull/8632#discussion_r464253193", "createdAt": "2020-08-03T07:59:20Z", "author": {"login": "dennisoelkers"}, "path": "graylog2-server/src/main/java/org/graylog2/indexer/EventsIndexMapping6.java", "diffHunk": "@@ -16,194 +16,13 @@\n  */\n package org.graylog2.indexer;\n \n-import com.google.common.collect.ImmutableList;\n import com.google.common.collect.ImmutableMap;\n-import org.graylog2.indexer.indexset.IndexSetConfig;\n-import org.graylog2.plugin.Tools;\n \n-import java.util.Map;\n-\n-public class EventsIndexMapping6 implements IndexMappingTemplate {\n+public class EventsIndexMapping6 extends EventsIndexMapping {\n     @Override\n-    public Map<String, Object> toTemplate(IndexSetConfig indexSetConfig, String indexPattern, int order) {\n-        final String indexPatternsField = \"index_patterns\";\n-        final Object indexPatternsValue = indexPattern;\n-        final String indexRefreshInterval = \"1s\"; // TODO: Index refresh interval must be configurable\n-\n+    protected ImmutableMap<String, Object> buildMappings() {\n         return map()\n-                .put(indexPatternsField, indexPatternsValue)\n-                .put(\"order\", order)\n-                .put(\"settings\", map()\n-                        .put(\"index.refresh_interval\", indexRefreshInterval)\n-                        .build())\n-                .put(\"mappings\", map()\n-                        .put(IndexMapping.TYPE_MESSAGE, map() // TODO: Type name is \"message\" because the index field type poller is using that\n-                                .put(\"_source\", map()\n-                                        .put(\"enabled\", true)\n-                                        .build())\n-                                .put(\"dynamic\", false)\n-                                .put(\"dynamic_templates\", list()\n-                                        .add(map()\n-                                                .put(\"fields\", map()\n-                                                        .put(\"path_match\", \"fields.*\")\n-                                                        .put(\"mapping\", map()\n-                                                                .put(\"type\", \"keyword\")\n-                                                                .put(\"doc_values\", true)\n-                                                                .put(\"index\", true)\n-                                                                .build())\n-                                                        .build())\n-                                                .build())\n-                                        /* TODO: Enable the typed fields once we decided if that's the way to go\n-                                        .add(map()\n-                                                .put(\"fields-typed-long\", map()\n-                                                        .put(\"path_match\", \"fields_typed.long.*\")\n-                                                        .put(\"mapping\", map()\n-                                                                .put(\"type\", \"long\")\n-                                                                .put(\"doc_values\", true)\n-                                                                .put(\"index\", true)\n-                                                                .build())\n-                                                        .build())\n-                                                .build())\n-                                        .add(map()\n-                                                .put(\"fields-typed-double\", map()\n-                                                        .put(\"path_match\", \"fields_typed.double.*\")\n-                                                        .put(\"mapping\", map()\n-                                                                .put(\"type\", \"double\")\n-                                                                .put(\"doc_values\", true)\n-                                                                .put(\"index\", true)\n-                                                                .build())\n-                                                        .build())\n-                                                .build())\n-                                        .add(map()\n-                                                .put(\"fields-typed-boolean\", map()\n-                                                        .put(\"path_match\", \"fields_typed.boolean.*\")\n-                                                        .put(\"mapping\", map()\n-                                                                .put(\"type\", \"boolean\")\n-                                                                .put(\"doc_values\", true)\n-                                                                .put(\"index\", true)\n-                                                                .build())\n-                                                        .build())\n-                                                .build())\n-                                        .add(map()\n-                                                .put(\"fields-typed-ip\", map()\n-                                                        .put(\"path_match\", \"fields_typed.ip.*\")\n-                                                        .put(\"mapping\", map()\n-                                                                .put(\"type\", \"ip\")\n-                                                                .put(\"doc_values\", true)\n-                                                                .put(\"index\", true)\n-                                                                .build())\n-                                                        .build())\n-                                                .build())\n-                                         */\n-                                        .build())\n-                                .put(\"properties\", map()\n-                                        .put(\"id\", map()\n-                                                .put(\"type\", \"keyword\")\n-                                                .build())\n-                                        .put(\"event_definition_type\", map()\n-                                                .put(\"type\", \"keyword\")\n-                                                .build())\n-                                        .put(\"event_definition_id\", map()\n-                                                .put(\"type\", \"keyword\")\n-                                                .build())\n-                                        .put(\"origin_context\", map()\n-                                                .put(\"type\", \"keyword\")\n-                                                .build())\n-                                        .put(\"timestamp\", map()\n-                                                .put(\"type\", \"date\")\n-                                                // Use the same format we use for the \"message\" mapping to make sure we\n-                                                // can use the search.\n-                                                .put(\"format\", Tools.ES_DATE_FORMAT)\n-                                                .build())\n-                                        .put(\"timestamp_processing\", map()\n-                                                .put(\"type\", \"date\")\n-                                                // Use the same format we use for the \"message\" mapping to make sure we\n-                                                // can use the search.\n-                                                .put(\"format\", Tools.ES_DATE_FORMAT)\n-                                                .build())\n-                                        .put(\"timerange_start\", map()\n-                                                .put(\"type\", \"date\")\n-                                                // Use the same format we use for the \"message\" mapping to make sure we\n-                                                // can use the search.\n-                                                .put(\"format\", Tools.ES_DATE_FORMAT)\n-                                                .build())\n-                                        .put(\"timerange_end\", map()\n-                                                .put(\"type\", \"date\")\n-                                                // Use the same format we use for the \"message\" mapping to make sure we\n-                                                // can use the search.\n-                                                .put(\"format\", Tools.ES_DATE_FORMAT)\n-                                                .build())\n-                                        .put(\"streams\", map()\n-                                                .put(\"type\", \"keyword\")\n-                                                .build())\n-                                        .put(\"source_streams\", map()\n-                                                .put(\"type\", \"keyword\")\n-                                                .build())\n-                                        .put(\"message\", map()\n-                                                .put(\"type\", \"text\")\n-                                                .put(\"analyzer\", \"standard\")\n-                                                .put(\"norms\", false)\n-                                                .put(\"fields\", map()\n-                                                        .put(\"keyword\", map()\n-                                                                .put(\"type\", \"keyword\")\n-                                                                .build())\n-                                                        .build())\n-                                                .build())\n-                                        .put(\"source\", map()\n-                                                .put(\"type\", \"keyword\")\n-                                                .build())\n-                                        .put(\"key\", map()\n-                                                .put(\"type\", \"keyword\")\n-                                                .build())\n-                                        .put(\"key_tuple\", map()\n-                                                .put(\"type\", \"keyword\")\n-                                                .build())\n-                                        .put(\"priority\", map()\n-                                                .put(\"type\", \"long\")\n-                                                .build())\n-                                        .put(\"alert\", map()\n-                                                .put(\"type\", \"boolean\")\n-                                                .build())\n-                                        .put(\"fields\", map()\n-                                                .put(\"type\", \"object\")\n-                                                .put(\"dynamic\", true)\n-                                                .build())\n-                                        /* TODO: Enable the typed fields once we decided if that's the way to go\n-                                        .put(\"fields_typed\", map()\n-                                                .put(\"type\", \"object\")\n-                                                .put(\"properties\", map()\n-                                                        .put(\"long\", map()\n-                                                                .put(\"type\", \"object\")\n-                                                                .put(\"dynamic\", true)\n-                                                                .build())\n-                                                        .put(\"double\", map()\n-                                                                .put(\"type\", \"object\")\n-                                                                .put(\"dynamic\", true)\n-                                                                .build())\n-                                                        .put(\"boolean\", map()\n-                                                                .put(\"type\", \"object\")\n-                                                                .put(\"dynamic\", true)\n-                                                                .build())\n-                                                        .put(\"ip\", map()\n-                                                                .put(\"type\", \"object\")\n-                                                                .put(\"dynamic\", true)\n-                                                                .build())\n-                                                        .build())\n-                                                .build())\n-                                         */\n-                                        .put(\"triggered_jobs\", map()\n-                                                .put(\"type\", \"keyword\")\n-                                                .build())\n-                                        .build())\n-                                .build())\n-                        .build())\n+                .put(IndexMapping.TYPE_MESSAGE, super.buildMappings()) // TODO: Type name is \"message\" because the index field type poller is using that", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "29d96de148ea84d7da4e7c006f3ac4b183ab6886"}, "originalPosition": 187}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NDI4MjI0Mw==", "bodyText": "What is the actual todo item here?\n\nI don't know. That comment was there before, so I left it in.", "url": "https://github.com/Graylog2/graylog2-server/pull/8632#discussion_r464282243", "createdAt": "2020-08-03T08:57:06Z", "author": {"login": "alex-konn"}, "path": "graylog2-server/src/main/java/org/graylog2/indexer/EventsIndexMapping6.java", "diffHunk": "@@ -16,194 +16,13 @@\n  */\n package org.graylog2.indexer;\n \n-import com.google.common.collect.ImmutableList;\n import com.google.common.collect.ImmutableMap;\n-import org.graylog2.indexer.indexset.IndexSetConfig;\n-import org.graylog2.plugin.Tools;\n \n-import java.util.Map;\n-\n-public class EventsIndexMapping6 implements IndexMappingTemplate {\n+public class EventsIndexMapping6 extends EventsIndexMapping {\n     @Override\n-    public Map<String, Object> toTemplate(IndexSetConfig indexSetConfig, String indexPattern, int order) {\n-        final String indexPatternsField = \"index_patterns\";\n-        final Object indexPatternsValue = indexPattern;\n-        final String indexRefreshInterval = \"1s\"; // TODO: Index refresh interval must be configurable\n-\n+    protected ImmutableMap<String, Object> buildMappings() {\n         return map()\n-                .put(indexPatternsField, indexPatternsValue)\n-                .put(\"order\", order)\n-                .put(\"settings\", map()\n-                        .put(\"index.refresh_interval\", indexRefreshInterval)\n-                        .build())\n-                .put(\"mappings\", map()\n-                        .put(IndexMapping.TYPE_MESSAGE, map() // TODO: Type name is \"message\" because the index field type poller is using that\n-                                .put(\"_source\", map()\n-                                        .put(\"enabled\", true)\n-                                        .build())\n-                                .put(\"dynamic\", false)\n-                                .put(\"dynamic_templates\", list()\n-                                        .add(map()\n-                                                .put(\"fields\", map()\n-                                                        .put(\"path_match\", \"fields.*\")\n-                                                        .put(\"mapping\", map()\n-                                                                .put(\"type\", \"keyword\")\n-                                                                .put(\"doc_values\", true)\n-                                                                .put(\"index\", true)\n-                                                                .build())\n-                                                        .build())\n-                                                .build())\n-                                        /* TODO: Enable the typed fields once we decided if that's the way to go\n-                                        .add(map()\n-                                                .put(\"fields-typed-long\", map()\n-                                                        .put(\"path_match\", \"fields_typed.long.*\")\n-                                                        .put(\"mapping\", map()\n-                                                                .put(\"type\", \"long\")\n-                                                                .put(\"doc_values\", true)\n-                                                                .put(\"index\", true)\n-                                                                .build())\n-                                                        .build())\n-                                                .build())\n-                                        .add(map()\n-                                                .put(\"fields-typed-double\", map()\n-                                                        .put(\"path_match\", \"fields_typed.double.*\")\n-                                                        .put(\"mapping\", map()\n-                                                                .put(\"type\", \"double\")\n-                                                                .put(\"doc_values\", true)\n-                                                                .put(\"index\", true)\n-                                                                .build())\n-                                                        .build())\n-                                                .build())\n-                                        .add(map()\n-                                                .put(\"fields-typed-boolean\", map()\n-                                                        .put(\"path_match\", \"fields_typed.boolean.*\")\n-                                                        .put(\"mapping\", map()\n-                                                                .put(\"type\", \"boolean\")\n-                                                                .put(\"doc_values\", true)\n-                                                                .put(\"index\", true)\n-                                                                .build())\n-                                                        .build())\n-                                                .build())\n-                                        .add(map()\n-                                                .put(\"fields-typed-ip\", map()\n-                                                        .put(\"path_match\", \"fields_typed.ip.*\")\n-                                                        .put(\"mapping\", map()\n-                                                                .put(\"type\", \"ip\")\n-                                                                .put(\"doc_values\", true)\n-                                                                .put(\"index\", true)\n-                                                                .build())\n-                                                        .build())\n-                                                .build())\n-                                         */\n-                                        .build())\n-                                .put(\"properties\", map()\n-                                        .put(\"id\", map()\n-                                                .put(\"type\", \"keyword\")\n-                                                .build())\n-                                        .put(\"event_definition_type\", map()\n-                                                .put(\"type\", \"keyword\")\n-                                                .build())\n-                                        .put(\"event_definition_id\", map()\n-                                                .put(\"type\", \"keyword\")\n-                                                .build())\n-                                        .put(\"origin_context\", map()\n-                                                .put(\"type\", \"keyword\")\n-                                                .build())\n-                                        .put(\"timestamp\", map()\n-                                                .put(\"type\", \"date\")\n-                                                // Use the same format we use for the \"message\" mapping to make sure we\n-                                                // can use the search.\n-                                                .put(\"format\", Tools.ES_DATE_FORMAT)\n-                                                .build())\n-                                        .put(\"timestamp_processing\", map()\n-                                                .put(\"type\", \"date\")\n-                                                // Use the same format we use for the \"message\" mapping to make sure we\n-                                                // can use the search.\n-                                                .put(\"format\", Tools.ES_DATE_FORMAT)\n-                                                .build())\n-                                        .put(\"timerange_start\", map()\n-                                                .put(\"type\", \"date\")\n-                                                // Use the same format we use for the \"message\" mapping to make sure we\n-                                                // can use the search.\n-                                                .put(\"format\", Tools.ES_DATE_FORMAT)\n-                                                .build())\n-                                        .put(\"timerange_end\", map()\n-                                                .put(\"type\", \"date\")\n-                                                // Use the same format we use for the \"message\" mapping to make sure we\n-                                                // can use the search.\n-                                                .put(\"format\", Tools.ES_DATE_FORMAT)\n-                                                .build())\n-                                        .put(\"streams\", map()\n-                                                .put(\"type\", \"keyword\")\n-                                                .build())\n-                                        .put(\"source_streams\", map()\n-                                                .put(\"type\", \"keyword\")\n-                                                .build())\n-                                        .put(\"message\", map()\n-                                                .put(\"type\", \"text\")\n-                                                .put(\"analyzer\", \"standard\")\n-                                                .put(\"norms\", false)\n-                                                .put(\"fields\", map()\n-                                                        .put(\"keyword\", map()\n-                                                                .put(\"type\", \"keyword\")\n-                                                                .build())\n-                                                        .build())\n-                                                .build())\n-                                        .put(\"source\", map()\n-                                                .put(\"type\", \"keyword\")\n-                                                .build())\n-                                        .put(\"key\", map()\n-                                                .put(\"type\", \"keyword\")\n-                                                .build())\n-                                        .put(\"key_tuple\", map()\n-                                                .put(\"type\", \"keyword\")\n-                                                .build())\n-                                        .put(\"priority\", map()\n-                                                .put(\"type\", \"long\")\n-                                                .build())\n-                                        .put(\"alert\", map()\n-                                                .put(\"type\", \"boolean\")\n-                                                .build())\n-                                        .put(\"fields\", map()\n-                                                .put(\"type\", \"object\")\n-                                                .put(\"dynamic\", true)\n-                                                .build())\n-                                        /* TODO: Enable the typed fields once we decided if that's the way to go\n-                                        .put(\"fields_typed\", map()\n-                                                .put(\"type\", \"object\")\n-                                                .put(\"properties\", map()\n-                                                        .put(\"long\", map()\n-                                                                .put(\"type\", \"object\")\n-                                                                .put(\"dynamic\", true)\n-                                                                .build())\n-                                                        .put(\"double\", map()\n-                                                                .put(\"type\", \"object\")\n-                                                                .put(\"dynamic\", true)\n-                                                                .build())\n-                                                        .put(\"boolean\", map()\n-                                                                .put(\"type\", \"object\")\n-                                                                .put(\"dynamic\", true)\n-                                                                .build())\n-                                                        .put(\"ip\", map()\n-                                                                .put(\"type\", \"object\")\n-                                                                .put(\"dynamic\", true)\n-                                                                .build())\n-                                                        .build())\n-                                                .build())\n-                                         */\n-                                        .put(\"triggered_jobs\", map()\n-                                                .put(\"type\", \"keyword\")\n-                                                .build())\n-                                        .build())\n-                                .build())\n-                        .build())\n+                .put(IndexMapping.TYPE_MESSAGE, super.buildMappings()) // TODO: Type name is \"message\" because the index field type poller is using that", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NDI1MzE5Mw=="}, "originalCommit": {"oid": "29d96de148ea84d7da4e7c006f3ac4b183ab6886"}, "originalPosition": 187}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NTAxMjQ3MA==", "bodyText": "I guess we should remove it then.", "url": "https://github.com/Graylog2/graylog2-server/pull/8632#discussion_r465012470", "createdAt": "2020-08-04T12:27:20Z", "author": {"login": "dennisoelkers"}, "path": "graylog2-server/src/main/java/org/graylog2/indexer/EventsIndexMapping6.java", "diffHunk": "@@ -16,194 +16,13 @@\n  */\n package org.graylog2.indexer;\n \n-import com.google.common.collect.ImmutableList;\n import com.google.common.collect.ImmutableMap;\n-import org.graylog2.indexer.indexset.IndexSetConfig;\n-import org.graylog2.plugin.Tools;\n \n-import java.util.Map;\n-\n-public class EventsIndexMapping6 implements IndexMappingTemplate {\n+public class EventsIndexMapping6 extends EventsIndexMapping {\n     @Override\n-    public Map<String, Object> toTemplate(IndexSetConfig indexSetConfig, String indexPattern, int order) {\n-        final String indexPatternsField = \"index_patterns\";\n-        final Object indexPatternsValue = indexPattern;\n-        final String indexRefreshInterval = \"1s\"; // TODO: Index refresh interval must be configurable\n-\n+    protected ImmutableMap<String, Object> buildMappings() {\n         return map()\n-                .put(indexPatternsField, indexPatternsValue)\n-                .put(\"order\", order)\n-                .put(\"settings\", map()\n-                        .put(\"index.refresh_interval\", indexRefreshInterval)\n-                        .build())\n-                .put(\"mappings\", map()\n-                        .put(IndexMapping.TYPE_MESSAGE, map() // TODO: Type name is \"message\" because the index field type poller is using that\n-                                .put(\"_source\", map()\n-                                        .put(\"enabled\", true)\n-                                        .build())\n-                                .put(\"dynamic\", false)\n-                                .put(\"dynamic_templates\", list()\n-                                        .add(map()\n-                                                .put(\"fields\", map()\n-                                                        .put(\"path_match\", \"fields.*\")\n-                                                        .put(\"mapping\", map()\n-                                                                .put(\"type\", \"keyword\")\n-                                                                .put(\"doc_values\", true)\n-                                                                .put(\"index\", true)\n-                                                                .build())\n-                                                        .build())\n-                                                .build())\n-                                        /* TODO: Enable the typed fields once we decided if that's the way to go\n-                                        .add(map()\n-                                                .put(\"fields-typed-long\", map()\n-                                                        .put(\"path_match\", \"fields_typed.long.*\")\n-                                                        .put(\"mapping\", map()\n-                                                                .put(\"type\", \"long\")\n-                                                                .put(\"doc_values\", true)\n-                                                                .put(\"index\", true)\n-                                                                .build())\n-                                                        .build())\n-                                                .build())\n-                                        .add(map()\n-                                                .put(\"fields-typed-double\", map()\n-                                                        .put(\"path_match\", \"fields_typed.double.*\")\n-                                                        .put(\"mapping\", map()\n-                                                                .put(\"type\", \"double\")\n-                                                                .put(\"doc_values\", true)\n-                                                                .put(\"index\", true)\n-                                                                .build())\n-                                                        .build())\n-                                                .build())\n-                                        .add(map()\n-                                                .put(\"fields-typed-boolean\", map()\n-                                                        .put(\"path_match\", \"fields_typed.boolean.*\")\n-                                                        .put(\"mapping\", map()\n-                                                                .put(\"type\", \"boolean\")\n-                                                                .put(\"doc_values\", true)\n-                                                                .put(\"index\", true)\n-                                                                .build())\n-                                                        .build())\n-                                                .build())\n-                                        .add(map()\n-                                                .put(\"fields-typed-ip\", map()\n-                                                        .put(\"path_match\", \"fields_typed.ip.*\")\n-                                                        .put(\"mapping\", map()\n-                                                                .put(\"type\", \"ip\")\n-                                                                .put(\"doc_values\", true)\n-                                                                .put(\"index\", true)\n-                                                                .build())\n-                                                        .build())\n-                                                .build())\n-                                         */\n-                                        .build())\n-                                .put(\"properties\", map()\n-                                        .put(\"id\", map()\n-                                                .put(\"type\", \"keyword\")\n-                                                .build())\n-                                        .put(\"event_definition_type\", map()\n-                                                .put(\"type\", \"keyword\")\n-                                                .build())\n-                                        .put(\"event_definition_id\", map()\n-                                                .put(\"type\", \"keyword\")\n-                                                .build())\n-                                        .put(\"origin_context\", map()\n-                                                .put(\"type\", \"keyword\")\n-                                                .build())\n-                                        .put(\"timestamp\", map()\n-                                                .put(\"type\", \"date\")\n-                                                // Use the same format we use for the \"message\" mapping to make sure we\n-                                                // can use the search.\n-                                                .put(\"format\", Tools.ES_DATE_FORMAT)\n-                                                .build())\n-                                        .put(\"timestamp_processing\", map()\n-                                                .put(\"type\", \"date\")\n-                                                // Use the same format we use for the \"message\" mapping to make sure we\n-                                                // can use the search.\n-                                                .put(\"format\", Tools.ES_DATE_FORMAT)\n-                                                .build())\n-                                        .put(\"timerange_start\", map()\n-                                                .put(\"type\", \"date\")\n-                                                // Use the same format we use for the \"message\" mapping to make sure we\n-                                                // can use the search.\n-                                                .put(\"format\", Tools.ES_DATE_FORMAT)\n-                                                .build())\n-                                        .put(\"timerange_end\", map()\n-                                                .put(\"type\", \"date\")\n-                                                // Use the same format we use for the \"message\" mapping to make sure we\n-                                                // can use the search.\n-                                                .put(\"format\", Tools.ES_DATE_FORMAT)\n-                                                .build())\n-                                        .put(\"streams\", map()\n-                                                .put(\"type\", \"keyword\")\n-                                                .build())\n-                                        .put(\"source_streams\", map()\n-                                                .put(\"type\", \"keyword\")\n-                                                .build())\n-                                        .put(\"message\", map()\n-                                                .put(\"type\", \"text\")\n-                                                .put(\"analyzer\", \"standard\")\n-                                                .put(\"norms\", false)\n-                                                .put(\"fields\", map()\n-                                                        .put(\"keyword\", map()\n-                                                                .put(\"type\", \"keyword\")\n-                                                                .build())\n-                                                        .build())\n-                                                .build())\n-                                        .put(\"source\", map()\n-                                                .put(\"type\", \"keyword\")\n-                                                .build())\n-                                        .put(\"key\", map()\n-                                                .put(\"type\", \"keyword\")\n-                                                .build())\n-                                        .put(\"key_tuple\", map()\n-                                                .put(\"type\", \"keyword\")\n-                                                .build())\n-                                        .put(\"priority\", map()\n-                                                .put(\"type\", \"long\")\n-                                                .build())\n-                                        .put(\"alert\", map()\n-                                                .put(\"type\", \"boolean\")\n-                                                .build())\n-                                        .put(\"fields\", map()\n-                                                .put(\"type\", \"object\")\n-                                                .put(\"dynamic\", true)\n-                                                .build())\n-                                        /* TODO: Enable the typed fields once we decided if that's the way to go\n-                                        .put(\"fields_typed\", map()\n-                                                .put(\"type\", \"object\")\n-                                                .put(\"properties\", map()\n-                                                        .put(\"long\", map()\n-                                                                .put(\"type\", \"object\")\n-                                                                .put(\"dynamic\", true)\n-                                                                .build())\n-                                                        .put(\"double\", map()\n-                                                                .put(\"type\", \"object\")\n-                                                                .put(\"dynamic\", true)\n-                                                                .build())\n-                                                        .put(\"boolean\", map()\n-                                                                .put(\"type\", \"object\")\n-                                                                .put(\"dynamic\", true)\n-                                                                .build())\n-                                                        .put(\"ip\", map()\n-                                                                .put(\"type\", \"object\")\n-                                                                .put(\"dynamic\", true)\n-                                                                .build())\n-                                                        .build())\n-                                                .build())\n-                                         */\n-                                        .put(\"triggered_jobs\", map()\n-                                                .put(\"type\", \"keyword\")\n-                                                .build())\n-                                        .build())\n-                                .build())\n-                        .build())\n+                .put(IndexMapping.TYPE_MESSAGE, super.buildMappings()) // TODO: Type name is \"message\" because the index field type poller is using that", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NDI1MzE5Mw=="}, "originalCommit": {"oid": "29d96de148ea84d7da4e7c006f3ac4b183ab6886"}, "originalPosition": 187}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NTExNzE1MA==", "bodyText": "Fair enough. Will do.", "url": "https://github.com/Graylog2/graylog2-server/pull/8632#discussion_r465117150", "createdAt": "2020-08-04T15:00:34Z", "author": {"login": "alex-konn"}, "path": "graylog2-server/src/main/java/org/graylog2/indexer/EventsIndexMapping6.java", "diffHunk": "@@ -16,194 +16,13 @@\n  */\n package org.graylog2.indexer;\n \n-import com.google.common.collect.ImmutableList;\n import com.google.common.collect.ImmutableMap;\n-import org.graylog2.indexer.indexset.IndexSetConfig;\n-import org.graylog2.plugin.Tools;\n \n-import java.util.Map;\n-\n-public class EventsIndexMapping6 implements IndexMappingTemplate {\n+public class EventsIndexMapping6 extends EventsIndexMapping {\n     @Override\n-    public Map<String, Object> toTemplate(IndexSetConfig indexSetConfig, String indexPattern, int order) {\n-        final String indexPatternsField = \"index_patterns\";\n-        final Object indexPatternsValue = indexPattern;\n-        final String indexRefreshInterval = \"1s\"; // TODO: Index refresh interval must be configurable\n-\n+    protected ImmutableMap<String, Object> buildMappings() {\n         return map()\n-                .put(indexPatternsField, indexPatternsValue)\n-                .put(\"order\", order)\n-                .put(\"settings\", map()\n-                        .put(\"index.refresh_interval\", indexRefreshInterval)\n-                        .build())\n-                .put(\"mappings\", map()\n-                        .put(IndexMapping.TYPE_MESSAGE, map() // TODO: Type name is \"message\" because the index field type poller is using that\n-                                .put(\"_source\", map()\n-                                        .put(\"enabled\", true)\n-                                        .build())\n-                                .put(\"dynamic\", false)\n-                                .put(\"dynamic_templates\", list()\n-                                        .add(map()\n-                                                .put(\"fields\", map()\n-                                                        .put(\"path_match\", \"fields.*\")\n-                                                        .put(\"mapping\", map()\n-                                                                .put(\"type\", \"keyword\")\n-                                                                .put(\"doc_values\", true)\n-                                                                .put(\"index\", true)\n-                                                                .build())\n-                                                        .build())\n-                                                .build())\n-                                        /* TODO: Enable the typed fields once we decided if that's the way to go\n-                                        .add(map()\n-                                                .put(\"fields-typed-long\", map()\n-                                                        .put(\"path_match\", \"fields_typed.long.*\")\n-                                                        .put(\"mapping\", map()\n-                                                                .put(\"type\", \"long\")\n-                                                                .put(\"doc_values\", true)\n-                                                                .put(\"index\", true)\n-                                                                .build())\n-                                                        .build())\n-                                                .build())\n-                                        .add(map()\n-                                                .put(\"fields-typed-double\", map()\n-                                                        .put(\"path_match\", \"fields_typed.double.*\")\n-                                                        .put(\"mapping\", map()\n-                                                                .put(\"type\", \"double\")\n-                                                                .put(\"doc_values\", true)\n-                                                                .put(\"index\", true)\n-                                                                .build())\n-                                                        .build())\n-                                                .build())\n-                                        .add(map()\n-                                                .put(\"fields-typed-boolean\", map()\n-                                                        .put(\"path_match\", \"fields_typed.boolean.*\")\n-                                                        .put(\"mapping\", map()\n-                                                                .put(\"type\", \"boolean\")\n-                                                                .put(\"doc_values\", true)\n-                                                                .put(\"index\", true)\n-                                                                .build())\n-                                                        .build())\n-                                                .build())\n-                                        .add(map()\n-                                                .put(\"fields-typed-ip\", map()\n-                                                        .put(\"path_match\", \"fields_typed.ip.*\")\n-                                                        .put(\"mapping\", map()\n-                                                                .put(\"type\", \"ip\")\n-                                                                .put(\"doc_values\", true)\n-                                                                .put(\"index\", true)\n-                                                                .build())\n-                                                        .build())\n-                                                .build())\n-                                         */\n-                                        .build())\n-                                .put(\"properties\", map()\n-                                        .put(\"id\", map()\n-                                                .put(\"type\", \"keyword\")\n-                                                .build())\n-                                        .put(\"event_definition_type\", map()\n-                                                .put(\"type\", \"keyword\")\n-                                                .build())\n-                                        .put(\"event_definition_id\", map()\n-                                                .put(\"type\", \"keyword\")\n-                                                .build())\n-                                        .put(\"origin_context\", map()\n-                                                .put(\"type\", \"keyword\")\n-                                                .build())\n-                                        .put(\"timestamp\", map()\n-                                                .put(\"type\", \"date\")\n-                                                // Use the same format we use for the \"message\" mapping to make sure we\n-                                                // can use the search.\n-                                                .put(\"format\", Tools.ES_DATE_FORMAT)\n-                                                .build())\n-                                        .put(\"timestamp_processing\", map()\n-                                                .put(\"type\", \"date\")\n-                                                // Use the same format we use for the \"message\" mapping to make sure we\n-                                                // can use the search.\n-                                                .put(\"format\", Tools.ES_DATE_FORMAT)\n-                                                .build())\n-                                        .put(\"timerange_start\", map()\n-                                                .put(\"type\", \"date\")\n-                                                // Use the same format we use for the \"message\" mapping to make sure we\n-                                                // can use the search.\n-                                                .put(\"format\", Tools.ES_DATE_FORMAT)\n-                                                .build())\n-                                        .put(\"timerange_end\", map()\n-                                                .put(\"type\", \"date\")\n-                                                // Use the same format we use for the \"message\" mapping to make sure we\n-                                                // can use the search.\n-                                                .put(\"format\", Tools.ES_DATE_FORMAT)\n-                                                .build())\n-                                        .put(\"streams\", map()\n-                                                .put(\"type\", \"keyword\")\n-                                                .build())\n-                                        .put(\"source_streams\", map()\n-                                                .put(\"type\", \"keyword\")\n-                                                .build())\n-                                        .put(\"message\", map()\n-                                                .put(\"type\", \"text\")\n-                                                .put(\"analyzer\", \"standard\")\n-                                                .put(\"norms\", false)\n-                                                .put(\"fields\", map()\n-                                                        .put(\"keyword\", map()\n-                                                                .put(\"type\", \"keyword\")\n-                                                                .build())\n-                                                        .build())\n-                                                .build())\n-                                        .put(\"source\", map()\n-                                                .put(\"type\", \"keyword\")\n-                                                .build())\n-                                        .put(\"key\", map()\n-                                                .put(\"type\", \"keyword\")\n-                                                .build())\n-                                        .put(\"key_tuple\", map()\n-                                                .put(\"type\", \"keyword\")\n-                                                .build())\n-                                        .put(\"priority\", map()\n-                                                .put(\"type\", \"long\")\n-                                                .build())\n-                                        .put(\"alert\", map()\n-                                                .put(\"type\", \"boolean\")\n-                                                .build())\n-                                        .put(\"fields\", map()\n-                                                .put(\"type\", \"object\")\n-                                                .put(\"dynamic\", true)\n-                                                .build())\n-                                        /* TODO: Enable the typed fields once we decided if that's the way to go\n-                                        .put(\"fields_typed\", map()\n-                                                .put(\"type\", \"object\")\n-                                                .put(\"properties\", map()\n-                                                        .put(\"long\", map()\n-                                                                .put(\"type\", \"object\")\n-                                                                .put(\"dynamic\", true)\n-                                                                .build())\n-                                                        .put(\"double\", map()\n-                                                                .put(\"type\", \"object\")\n-                                                                .put(\"dynamic\", true)\n-                                                                .build())\n-                                                        .put(\"boolean\", map()\n-                                                                .put(\"type\", \"object\")\n-                                                                .put(\"dynamic\", true)\n-                                                                .build())\n-                                                        .put(\"ip\", map()\n-                                                                .put(\"type\", \"object\")\n-                                                                .put(\"dynamic\", true)\n-                                                                .build())\n-                                                        .build())\n-                                                .build())\n-                                         */\n-                                        .put(\"triggered_jobs\", map()\n-                                                .put(\"type\", \"keyword\")\n-                                                .build())\n-                                        .build())\n-                                .build())\n-                        .build())\n+                .put(IndexMapping.TYPE_MESSAGE, super.buildMappings()) // TODO: Type name is \"message\" because the index field type poller is using that", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NDI1MzE5Mw=="}, "originalCommit": {"oid": "29d96de148ea84d7da4e7c006f3ac4b183ab6886"}, "originalPosition": 187}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4069, "cost": 1, "resetAt": "2021-11-12T20:28:25Z"}}}