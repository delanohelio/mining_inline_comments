{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDUxMTY4NDI1", "number": 8573, "reviewThreads": {"totalCount": 8, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yMFQxNTowMzoyNFrOEQPFsQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yN1QwOTo0Nzo1MFrOESUL2w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjg1NDU5ODg5OnYy", "diffSide": "RIGHT", "path": "graylog2-web-interface/src/components/users/PaginatedItem.jsx", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yMFQxNTowMzoyNFrOG0RzVA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yMFQxNTowMzoyNFrOG0RzVA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NzQ3MDgwNA==", "bodyText": "Does this really need to be a component? Could we just do StyledIconButton?", "url": "https://github.com/Graylog2/graylog2-server/pull/8573#discussion_r457470804", "createdAt": "2020-07-20T15:03:24Z", "author": {"login": "kyleknighted"}, "path": "graylog2-web-interface/src/components/users/PaginatedItem.jsx", "diffHunk": "@@ -3,13 +3,33 @@ import * as React from 'react';\n import styled, { css, type StyledComponent } from 'styled-components';\n \n import { type ThemeInterface } from 'theme';\n+import { IconButton } from 'components/common';\n \n import type { DescriptiveItem } from './PaginatedItemOverview';\n \n-type Props = { item: DescriptiveItem };\n+type Props = {\n+  item: DescriptiveItem,\n+  onDeleteItem?: (DescriptiveItem) => void,\n+};\n+\n+type DeleteProps = {\n+  item: DescriptiveItem,\n+  onDeleteItem?: (DescriptiveItem) => void,\n+};\n+\n+// eslint-disable-next-line react/prop-types\n+const DeleteButton = ({ onDeleteItem, item }: DeleteProps) => {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "7e5da2882cdb177892581c2b34716354b74d74e4"}, "originalPosition": 20}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjg1NDY4Nzc3OnYy", "diffSide": "RIGHT", "path": "graylog2-web-interface/src/components/users/UserEdit/RolesSelector.jsx", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yMFQxNToxNjozN1rOG0Sk0Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yMVQwNzowODoxNFrOG0q7UQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NzQ4MzQ3Mw==", "bodyText": "This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters. Learn more about bidirectional Unicode characters\n\n\n  \n\n\n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            const Errors: StyledComponent<{}, ThemeInterface, HTMLDivElement> = styled.div(({ theme }) => `\n          \n          \n            \n            const Errors: StyledComponent<{}, ThemeInterface, HTMLDivElement> = styled.div(({ theme }) => css`", "url": "https://github.com/Graylog2/graylog2-server/pull/8573#discussion_r457483473", "createdAt": "2020-07-20T15:16:37Z", "author": {"login": "kyleknighted"}, "path": "graylog2-web-interface/src/components/users/UserEdit/RolesSelector.jsx", "diffHunk": "@@ -0,0 +1,120 @@\n+// @flow strict\n+import * as React from 'react';\n+import { useEffect, useState } from 'react';\n+import { Formik, Form, Field } from 'formik';\n+import styled, { type StyledComponent } from 'styled-components';\n+\n+import { AuthzRolesActions, type PaginatedListType } from 'stores/roles/AuthzRolesStore';\n+import { type ThemeInterface } from 'theme';\n+import { Button } from 'components/graylog';\n+import { Select } from 'components/common';\n+import User from 'logic/users/User';\n+\n+type Props = {\n+  onSubmit: ({ roles: string[] }) => Promise<void>,\n+  user: User,\n+};\n+\n+const SubmitButton = styled(Button)`\n+  margin-left: 15px;\n+`;\n+\n+const FormElements = styled.div`\n+  display: flex;\n+`;\n+\n+const Errors: StyledComponent<{}, ThemeInterface, HTMLDivElement> = styled.div(({ theme }) => `", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "7e5da2882cdb177892581c2b34716354b74d74e4"}, "originalPosition": 26}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1Nzg4MjQ0OQ==", "bodyText": "\ud83d\udc4d", "url": "https://github.com/Graylog2/graylog2-server/pull/8573#discussion_r457882449", "createdAt": "2020-07-21T07:08:14Z", "author": {"login": "kmerz"}, "path": "graylog2-web-interface/src/components/users/UserEdit/RolesSelector.jsx", "diffHunk": "@@ -0,0 +1,120 @@\n+// @flow strict\n+import * as React from 'react';\n+import { useEffect, useState } from 'react';\n+import { Formik, Form, Field } from 'formik';\n+import styled, { type StyledComponent } from 'styled-components';\n+\n+import { AuthzRolesActions, type PaginatedListType } from 'stores/roles/AuthzRolesStore';\n+import { type ThemeInterface } from 'theme';\n+import { Button } from 'components/graylog';\n+import { Select } from 'components/common';\n+import User from 'logic/users/User';\n+\n+type Props = {\n+  onSubmit: ({ roles: string[] }) => Promise<void>,\n+  user: User,\n+};\n+\n+const SubmitButton = styled(Button)`\n+  margin-left: 15px;\n+`;\n+\n+const FormElements = styled.div`\n+  display: flex;\n+`;\n+\n+const Errors: StyledComponent<{}, ThemeInterface, HTMLDivElement> = styled.div(({ theme }) => `", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NzQ4MzQ3Mw=="}, "originalCommit": {"oid": "7e5da2882cdb177892581c2b34716354b74d74e4"}, "originalPosition": 26}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjg1NDY5MDMzOnYy", "diffSide": "RIGHT", "path": "graylog2-web-interface/src/components/users/UserEdit/RolesSelector.jsx", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yMFQxNToxNzowMVrOG0SmKg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yMVQwNzowODoyMlrOG0q7gg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NzQ4MzgxOA==", "bodyText": "This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters. Learn more about bidirectional Unicode characters\n\n\n  \n\n\n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            import styled, { type StyledComponent } from 'styled-components';\n          \n          \n            \n            import styled, { css } from 'styled-components';\n          \n          \n            \n            import type { StyledComponent } from 'styled-components';", "url": "https://github.com/Graylog2/graylog2-server/pull/8573#discussion_r457483818", "createdAt": "2020-07-20T15:17:01Z", "author": {"login": "kyleknighted"}, "path": "graylog2-web-interface/src/components/users/UserEdit/RolesSelector.jsx", "diffHunk": "@@ -0,0 +1,120 @@\n+// @flow strict\n+import * as React from 'react';\n+import { useEffect, useState } from 'react';\n+import { Formik, Form, Field } from 'formik';\n+import styled, { type StyledComponent } from 'styled-components';", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "7e5da2882cdb177892581c2b34716354b74d74e4"}, "originalPosition": 5}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1Nzg4MjQ5OA==", "bodyText": "\ud83d\udc4d", "url": "https://github.com/Graylog2/graylog2-server/pull/8573#discussion_r457882498", "createdAt": "2020-07-21T07:08:22Z", "author": {"login": "kmerz"}, "path": "graylog2-web-interface/src/components/users/UserEdit/RolesSelector.jsx", "diffHunk": "@@ -0,0 +1,120 @@\n+// @flow strict\n+import * as React from 'react';\n+import { useEffect, useState } from 'react';\n+import { Formik, Form, Field } from 'formik';\n+import styled, { type StyledComponent } from 'styled-components';", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NzQ4MzgxOA=="}, "originalCommit": {"oid": "7e5da2882cdb177892581c2b34716354b74d74e4"}, "originalPosition": 5}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjg1NTAzOTgyOnYy", "diffSide": "RIGHT", "path": "graylog2-web-interface/src/components/users/UserEdit/RolesSelector.jsx", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yMFQxNjoyNDo0MVrOG0V2Qg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yMFQxNjoyNDo0MVrOG0V2Qg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NzUzNzA5MA==", "bodyText": "This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters. Learn more about bidirectional Unicode characters\n\n\n  \n\n\n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                                        title=\"Add Collaborator\"\n          \n          \n            \n                                        title=\"Add Role\"", "url": "https://github.com/Graylog2/graylog2-server/pull/8573#discussion_r457537090", "createdAt": "2020-07-20T16:24:41Z", "author": {"login": "kyleknighted"}, "path": "graylog2-web-interface/src/components/users/UserEdit/RolesSelector.jsx", "diffHunk": "@@ -0,0 +1,120 @@\n+// @flow strict\n+import * as React from 'react';\n+import { useEffect, useState } from 'react';\n+import { Formik, Form, Field } from 'formik';\n+import styled, { type StyledComponent } from 'styled-components';\n+\n+import { AuthzRolesActions, type PaginatedListType } from 'stores/roles/AuthzRolesStore';\n+import { type ThemeInterface } from 'theme';\n+import { Button } from 'components/graylog';\n+import { Select } from 'components/common';\n+import User from 'logic/users/User';\n+\n+type Props = {\n+  onSubmit: ({ roles: string[] }) => Promise<void>,\n+  user: User,\n+};\n+\n+const SubmitButton = styled(Button)`\n+  margin-left: 15px;\n+`;\n+\n+const FormElements = styled.div`\n+  display: flex;\n+`;\n+\n+const Errors: StyledComponent<{}, ThemeInterface, HTMLDivElement> = styled.div(({ theme }) => `\n+  width: 100%;\n+  margin-top: 3px;\n+  color: ${theme.colors.variant.danger};\n+\n+  > * {\n+    margin-right: 5px;\n+\n+    :last-child {\n+      margin-right: 0;\n+    }\n+  }\n+`);\n+\n+const RoleSelectOption = styled.div`\n+  display: flex;\n+  align-items: center;\n+`;\n+\n+const StyledSelect = styled(Select)`\n+  flex: 1;\n+`;\n+\n+const _renderRoleOption = ({ label }: { label: string }) => (\n+  <RoleSelectOption>{label}</RoleSelectOption>\n+);\n+\n+const _isRequired = (field) => (value) => (!value ? `The ${field} is required` : undefined);\n+\n+const RolesSelector = ({ user, onSubmit }: Props) => {\n+  const [roles, setRoles] = useState([]);\n+\n+  const onUpdate = ({ role }: { role: string }, { resetForm }) => {\n+    const userRoles = user.roles;\n+    const newRoles = userRoles.push(role).toJS();\n+\n+    onSubmit({ roles: newRoles }).then(() => {\n+      resetForm();\n+    });\n+  };\n+\n+  useEffect(() => {\n+    AuthzRolesActions.loadPaginated(1, 0, '')\n+      .then((response: PaginatedListType) => {\n+        const { list } = response;\n+\n+        const resultRoles = list\n+          .filter((r) => !user.roles.includes(r.name))\n+          .toArray()\n+          .map((r) => ({ label: r.name, value: r.name }));\n+        setRoles(resultRoles);\n+      });\n+  }, [user]);\n+\n+  return (\n+    <div>\n+      <Formik onSubmit={onUpdate}\n+              initialValues={{ role: undefined }}>\n+        {({ isSubmitting, isValid, errors }) => (\n+          <Form>\n+            <FormElements>\n+              <Field name=\"role\" validate={_isRequired('role')}>\n+                {({ field: { name, value, onChange } }) => (\n+                  <StyledSelect inputProps={{ 'arial-label': 'Search for roles ' }}\n+                                onChange={(role) => {\n+                                  onChange({ target: { value: role, name } });\n+                                }}\n+                                optionRenderer={_renderRoleOption}\n+                                options={roles}\n+                                placeholder=\"Search for roles\"\n+                                value={value} />\n+                )}\n+              </Field>\n+              <SubmitButton bsStyle=\"success\"\n+                            disabled={isSubmitting || !isValid}\n+                            title=\"Add Collaborator\"", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "7e5da2882cdb177892581c2b34716354b74d74e4"}, "originalPosition": 101}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjg1NTA0NTQ3OnYy", "diffSide": "RIGHT", "path": "graylog2-web-interface/src/components/users/UserEdit/RolesSelector.jsx", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yMFQxNjoyNjowNlrOG0V54w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yMFQxNjoyNjowNlrOG0V54w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NzUzODAxOQ==", "bodyText": "I'm confused why we need two different Search inputs here.", "url": "https://github.com/Graylog2/graylog2-server/pull/8573#discussion_r457538019", "createdAt": "2020-07-20T16:26:06Z", "author": {"login": "kyleknighted"}, "path": "graylog2-web-interface/src/components/users/UserEdit/RolesSelector.jsx", "diffHunk": "@@ -0,0 +1,120 @@\n+// @flow strict\n+import * as React from 'react';\n+import { useEffect, useState } from 'react';\n+import { Formik, Form, Field } from 'formik';\n+import styled, { type StyledComponent } from 'styled-components';\n+\n+import { AuthzRolesActions, type PaginatedListType } from 'stores/roles/AuthzRolesStore';\n+import { type ThemeInterface } from 'theme';\n+import { Button } from 'components/graylog';\n+import { Select } from 'components/common';\n+import User from 'logic/users/User';\n+\n+type Props = {\n+  onSubmit: ({ roles: string[] }) => Promise<void>,\n+  user: User,\n+};\n+\n+const SubmitButton = styled(Button)`\n+  margin-left: 15px;\n+`;\n+\n+const FormElements = styled.div`\n+  display: flex;\n+`;\n+\n+const Errors: StyledComponent<{}, ThemeInterface, HTMLDivElement> = styled.div(({ theme }) => `\n+  width: 100%;\n+  margin-top: 3px;\n+  color: ${theme.colors.variant.danger};\n+\n+  > * {\n+    margin-right: 5px;\n+\n+    :last-child {\n+      margin-right: 0;\n+    }\n+  }\n+`);\n+\n+const RoleSelectOption = styled.div`\n+  display: flex;\n+  align-items: center;\n+`;\n+\n+const StyledSelect = styled(Select)`\n+  flex: 1;\n+`;\n+\n+const _renderRoleOption = ({ label }: { label: string }) => (\n+  <RoleSelectOption>{label}</RoleSelectOption>\n+);\n+\n+const _isRequired = (field) => (value) => (!value ? `The ${field} is required` : undefined);\n+\n+const RolesSelector = ({ user, onSubmit }: Props) => {\n+  const [roles, setRoles] = useState([]);\n+\n+  const onUpdate = ({ role }: { role: string }, { resetForm }) => {\n+    const userRoles = user.roles;\n+    const newRoles = userRoles.push(role).toJS();\n+\n+    onSubmit({ roles: newRoles }).then(() => {\n+      resetForm();\n+    });\n+  };\n+\n+  useEffect(() => {\n+    AuthzRolesActions.loadPaginated(1, 0, '')\n+      .then((response: PaginatedListType) => {\n+        const { list } = response;\n+\n+        const resultRoles = list\n+          .filter((r) => !user.roles.includes(r.name))\n+          .toArray()\n+          .map((r) => ({ label: r.name, value: r.name }));\n+        setRoles(resultRoles);\n+      });\n+  }, [user]);\n+\n+  return (\n+    <div>\n+      <Formik onSubmit={onUpdate}\n+              initialValues={{ role: undefined }}>\n+        {({ isSubmitting, isValid, errors }) => (\n+          <Form>\n+            <FormElements>\n+              <Field name=\"role\" validate={_isRequired('role')}>\n+                {({ field: { name, value, onChange } }) => (\n+                  <StyledSelect inputProps={{ 'arial-label': 'Search for roles ' }}", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "7e5da2882cdb177892581c2b34716354b74d74e4"}, "originalPosition": 89}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjg2MDEwNjg3OnYy", "diffSide": "RIGHT", "path": "graylog2-web-interface/src/components/users/PaginatedItem.jsx", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yMVQxOToxNDoyMFrOG1GMBg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yMVQxOToxNDoyMFrOG1GMBg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1ODMyOTA5NA==", "bodyText": "Don't need the inner function if there's no props or theme being used\n\n  \n    \n  \n    \n\n  \n  This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters. Learn more about bidirectional Unicode characters\n\n\n  \n\n\n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            const StyledDeleteButton = styled(IconButton)(() => css`\n          \n          \n            \n              flex: 0;\n          \n          \n            \n            `);\n          \n          \n            \n            const StyledDeleteButton = styled(IconButton)`\n          \n          \n            \n              flex: 0;\n          \n          \n            \n            `;", "url": "https://github.com/Graylog2/graylog2-server/pull/8573#discussion_r458329094", "createdAt": "2020-07-21T19:14:20Z", "author": {"login": "kyleknighted"}, "path": "graylog2-web-interface/src/components/users/PaginatedItem.jsx", "diffHunk": "@@ -20,13 +24,33 @@ const Container: StyledComponent<{}, ThemeInterface, HTMLSpanElement> = styled.s\n \n const Header = styled.h4`\n   padding-bottom: 5px;\n+  flex: 1;\n `;\n \n-const PaginatedItem = ({ item: { name, description } }: Props) => (\n-  <Container>\n-    <Header>{name}</Header>\n-    <span>{description}</span>\n-  </Container>\n-);\n+const Description = styled.span`\n+  flex: 2;\n+`;\n+\n+const StyledDeleteButton = styled(IconButton)(() => css`\n+  flex: 0;\n+`);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d5b040df5ac86c455631192cfd80003b7f82a1e3"}, "originalPosition": 39}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjg2MDEyMDAzOnYy", "diffSide": "RIGHT", "path": "graylog2-web-interface/src/components/users/PaginatedItem.jsx", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yMVQxOToxODoxM1rOG1GURQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yMVQxOToxODoxM1rOG1GURQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1ODMzMTIwNQ==", "bodyText": "Are propTypes not needed or is that handled by type Props above?", "url": "https://github.com/Graylog2/graylog2-server/pull/8573#discussion_r458331205", "createdAt": "2020-07-21T19:18:13Z", "author": {"login": "kyleknighted"}, "path": "graylog2-web-interface/src/components/users/PaginatedItem.jsx", "diffHunk": "@@ -20,13 +24,33 @@ const Container: StyledComponent<{}, ThemeInterface, HTMLSpanElement> = styled.s\n \n const Header = styled.h4`\n   padding-bottom: 5px;\n+  flex: 1;\n `;\n \n-const PaginatedItem = ({ item: { name, description } }: Props) => (\n-  <Container>\n-    <Header>{name}</Header>\n-    <span>{description}</span>\n-  </Container>\n-);\n+const Description = styled.span`\n+  flex: 2;\n+`;\n+\n+const StyledDeleteButton = styled(IconButton)(() => css`\n+  flex: 0;\n+`);\n+\n+const PaginatedItem = ({ item: { name, description }, onDeleteItem, item }: Props) => {\n+  const deleteButton = typeof onDeleteItem === 'function'\n+    ? <StyledDeleteButton onClick={() => onDeleteItem(item)} name=\"times\" />\n+    : null;\n+\n+  return (\n+    <Container>\n+      <Header>{name}</Header>\n+      <Description>{description}</Description>\n+      { deleteButton }\n+    </Container>\n+  );\n+};\n+\n+PaginatedItem.defaultProps = {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d5b040df5ac86c455631192cfd80003b7f82a1e3"}, "originalPosition": 55}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjg3NjQwNTM5OnYy", "diffSide": "RIGHT", "path": "graylog2-web-interface/src/components/users/UserEdit/RolesSection.jsx", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yN1QwOTo0Nzo1MFrOG3ba_Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yN1QwOTo0Nzo1MFrOG3ba_Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MDc3NDE0MQ==", "bodyText": "What do you think about the wording \"Assign Roles\" instead of \"Add Roles\"?", "url": "https://github.com/Graylog2/graylog2-server/pull/8573#discussion_r460774141", "createdAt": "2020-07-27T09:47:50Z", "author": {"login": "linuspahl"}, "path": "graylog2-web-interface/src/components/users/UserEdit/RolesSection.jsx", "diffHunk": "@@ -0,0 +1,78 @@\n+// @flow strict\n+import * as React from 'react';\n+import { useState } from 'react';\n+import * as Immutable from 'immutable';\n+import styled from 'styled-components';\n+\n+import UserNotification from 'util/UserNotification';\n+import User from 'logic/users/User';\n+import { AuthzRolesActions } from 'stores/roles/AuthzRolesStore';\n+import { UsersActions } from 'stores/users/UsersStore';\n+\n+import RolesSelector from './RolesSelector';\n+\n+import PaginatedItemOverview, { defaultPageInfo, type PaginationInfo, type PaginatedListType } from '../PaginatedItemOverview';\n+import SectionComponent from '../SectionComponent';\n+import type { DescriptiveItem } from '../PaginatedItemOverview';\n+\n+type Props = {\n+  user: User,\n+  onSubmit: ({ roles: string[] }) => Promise<void>,\n+};\n+\n+const Container = styled.div`\n+  margin-top 15px;\n+  margin-bottom 15px;\n+`;\n+\n+const RolesSection = ({ user, onSubmit }: Props) => {\n+  const { username } = user;\n+  const [loading, setLoading] = useState(false);\n+  const [roles, setRoles] = useState();\n+\n+  const _onLoad = ({ page, perPage, query }: PaginationInfo = defaultPageInfo): Promise<PaginatedListType> => {\n+    setLoading(true);\n+\n+    return AuthzRolesActions.loadForUser(username, page, perPage, query)\n+      .then((response) => {\n+        setLoading(false);\n+\n+        return {\n+          pagination: response.pagination,\n+          list: response.list.map((item) => (item: DescriptiveItem)),\n+        };\n+      }, (error) => {\n+        if (error.additional.status === 404) {\n+          UserNotification.error(`Loading roles for user ${username} failed with status: ${error}`,\n+            'Could not load roles for user');\n+        }\n+\n+        return error;\n+      });\n+  };\n+\n+  const onUpdate = (data) => onSubmit(data).then(() => {\n+    _onLoad().then((response) => setRoles(response));\n+    UsersActions.load(username);\n+  });\n+\n+  const onDeleteRole = (role: DescriptiveItem) => {\n+    const newUserRoles = Immutable.Set(user.roles.toJS()).remove(role.name).toJS();\n+    onUpdate({ roles: newUserRoles });\n+  };\n+\n+  return (\n+    <SectionComponent title=\"Roles\" showLoading={loading}>\n+      <h4>Add Roles</h4>", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c1b15a8f2c6313b988df78a8892fd130c87cea8a"}, "originalPosition": 66}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4169, "cost": 1, "resetAt": "2021-11-12T20:28:25Z"}}}