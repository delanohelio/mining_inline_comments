{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0MzY3ODg5MTQ0", "number": 7306, "title": "Change color chart from Map to List of Value Class ", "bodyText": "Description, Motivation and Context\nPrior to this change, the data structure to store\nWidgetFormattingSettings did use the \"user input\" for storing a map.\nBut mongodb does not allow to store keys with dot in the map.\nThis change will change the data structure from a map to a list\nof objects. That way mongodb does not need to store the keys.\nAlso add migration to fix existing color charts in mongodbs.\nFixes #7235\nHow Has This Been Tested?\n\nAdd dashboard with color chart containing a non IP keyname with dots and see that it\ndoes not get saved.\nRemove dots from name\nRun migration\nCheck that chart color still exists and add the dots back to the name which should now successfully be saved.\n\nTypes of changes\n\n Bug fix (non-breaking change which fixes an issue)\n New feature (non-breaking change which adds functionality)\n Refactoring (non-breaking change)\n Breaking change (fix or feature that would cause existing functionality to change)\n\nChecklist:\n\n My code follows the code style of this project.\n My change requires a change to the documentation.\n I have updated the documentation accordingly.\n I have read the CONTRIBUTING document.\n I have added tests to cover my changes.", "createdAt": "2020-01-28T08:41:04Z", "url": "https://github.com/Graylog2/graylog2-server/pull/7306", "merged": true, "mergeCommit": {"oid": "3a3bc29884de4d35dd4d90c408213be55176648a"}, "closed": true, "closedAt": "2020-01-28T11:02:33Z", "author": {"login": "kmerz"}, "timelineItems": {"totalCount": 8, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABb-tkVfgFqTM0OTIxMzI4MQ==", "endCursor": "Y3Vyc29yOnYyOpPPAAABb-uvj8gFqTM0OTI2Njc4NA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzQ5MjEzMjgx", "url": "https://github.com/Graylog2/graylog2-server/pull/7306#pullrequestreview-349213281", "createdAt": "2020-01-28T09:02:49Z", "commit": {"oid": "ba58a5fffa0488c9fd734e1b5fbbeceff343b8d6"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yOFQwOTowMjo0OVrOFidVXw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yOFQwOTowMzoxN1rOFidWFA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MTY3NjUxMQ==", "bodyText": "IMO the previous naming (chartColors) was slightly better.", "url": "https://github.com/Graylog2/graylog2-server/pull/7306#discussion_r371676511", "createdAt": "2020-01-28T09:02:49Z", "author": {"login": "dennisoelkers"}, "path": "graylog2-server/src/main/java/org/graylog/plugins/views/search/views/widgets/aggregation/WidgetFormattingSettings.java", "diffHunk": "@@ -22,27 +22,27 @@\n import com.google.auto.value.AutoValue;\n \n import java.util.Collections;\n-import java.util.Map;\n+import java.util.List;\n \n @AutoValue\n @JsonDeserialize(builder = WidgetFormattingSettings.Builder.class)\n public abstract class WidgetFormattingSettings {\n     private static final String FIELD_CHART_COLORS = \"chart_colors\";\n \n     @JsonProperty(FIELD_CHART_COLORS)\n-    public abstract Map<String, ChartColor> chartColors();\n+    public abstract List<ChartColorSetting> chartColorSettings();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ba58a5fffa0488c9fd734e1b5fbbeceff343b8d6"}, "originalPosition": 14}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MTY3NjY5Mg==", "bodyText": "Maybe ChartColorMapping captures the purpose of this class better?", "url": "https://github.com/Graylog2/graylog2-server/pull/7306#discussion_r371676692", "createdAt": "2020-01-28T09:03:17Z", "author": {"login": "dennisoelkers"}, "path": "graylog2-server/src/main/java/org/graylog/plugins/views/search/views/widgets/aggregation/ChartColorSetting.java", "diffHunk": "@@ -0,0 +1,35 @@\n+package org.graylog.plugins.views.search.views.widgets.aggregation;\n+\n+import com.fasterxml.jackson.annotation.JsonCreator;\n+import com.fasterxml.jackson.annotation.JsonProperty;\n+import com.fasterxml.jackson.databind.annotation.JsonDeserialize;\n+import com.google.auto.value.AutoValue;\n+\n+@AutoValue\n+@JsonDeserialize(builder = ChartColorSetting.Builder.class)\n+public abstract class ChartColorSetting {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ba58a5fffa0488c9fd734e1b5fbbeceff343b8d6"}, "originalPosition": 10}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e89841b86f1ecce5b54011f6c5caf3d502bf3147", "author": {"user": {"login": "kmerz", "name": "Konrad Merz"}}, "url": "https://github.com/Graylog2/graylog2-server/commit/e89841b86f1ecce5b54011f6c5caf3d502bf3147", "committedDate": "2020-01-28T10:22:05Z", "message": "Change data structure in WidgetFormattingSetting\n\nPrior to this change, the data structure to store\nWidgetFormattingSettings did use the \"user input\" for storing a map.\nBut mongodb does not allow to store keys with dot in the map.\n\nThis change will change the data structure from a map to a list\nof objects. That way mongodb does not need to store the keys."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "6543da1b6cf704001461e7cf5dafdd9034044916", "author": {"user": {"login": "kmerz", "name": "Konrad Merz"}}, "url": "https://github.com/Graylog2/graylog2-server/commit/6543da1b6cf704001461e7cf5dafdd9034044916", "committedDate": "2020-01-28T10:22:05Z", "message": "Migrate existing data structures for color charts\n\nPrior to this change, we changed the data structure of color charts\nfrom a generic Map to auto value classes. This change prevents\nexisting installations to run.\n\nThis change will migrate the existing datastructures in the mongodb\nto the new auto value classes."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f1846ae2412022fe66f71683760eff2143a426e4", "author": {"user": {"login": "kmerz", "name": "Konrad Merz"}}, "url": "https://github.com/Graylog2/graylog2-server/commit/f1846ae2412022fe66f71683760eff2143a426e4", "committedDate": "2020-01-28T10:22:05Z", "message": "Add missing licenses"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "bf1209e9a256fe3be8c63fd5d34eac6ca171b98a", "author": {"user": {"login": "kmerz", "name": "Konrad Merz"}}, "url": "https://github.com/Graylog2/graylog2-server/commit/bf1209e9a256fe3be8c63fd5d34eac6ca171b98a", "committedDate": "2020-01-28T10:22:05Z", "message": "Fix annotations from @dennisoelkers"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "297a7aa00e5498d25f92c0bb4a38878eb9aca785", "author": {"user": {"login": "kmerz", "name": "Konrad Merz"}}, "url": "https://github.com/Graylog2/graylog2-server/commit/297a7aa00e5498d25f92c0bb4a38878eb9aca785", "committedDate": "2020-01-28T10:22:05Z", "message": "Add more tests"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "bcc047c2f53b2b66479a4223cc5ef07b0cffc821", "author": {"user": {"login": "kmerz", "name": "Konrad Merz"}}, "url": "https://github.com/Graylog2/graylog2-server/commit/bcc047c2f53b2b66479a4223cc5ef07b0cffc821", "committedDate": "2020-01-28T10:03:39Z", "message": "Add more tests"}, "afterCommit": {"oid": "297a7aa00e5498d25f92c0bb4a38878eb9aca785", "author": {"user": {"login": "kmerz", "name": "Konrad Merz"}}, "url": "https://github.com/Graylog2/graylog2-server/commit/297a7aa00e5498d25f92c0bb4a38878eb9aca785", "committedDate": "2020-01-28T10:22:05Z", "message": "Add more tests"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzQ5MjY2Nzg0", "url": "https://github.com/Graylog2/graylog2-server/pull/7306#pullrequestreview-349266784", "createdAt": "2020-01-28T10:25:49Z", "commit": {"oid": "297a7aa00e5498d25f92c0bb4a38878eb9aca785"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2735, "cost": 1, "resetAt": "2021-10-28T18:54:27Z"}}}