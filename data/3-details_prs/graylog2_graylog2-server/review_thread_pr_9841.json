{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTQzOTcyODA4", "number": 9841, "reviewThreads": {"totalCount": 7, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMS0wOFQwOTowODo0OVrOFMcXtQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMS0xNFQxNjoxNTozOFrOFOvmTw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzQ4NTkyMDUzOnYy", "diffSide": "RIGHT", "path": "graylog2-web-interface/src/views/logic/views/GetPositionForNewWidget.ts", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMS0wOFQwOTowODo0OVrOIQKuEQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMS0wOFQwOTowODo0OVrOIQKuEQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1MzgyMzc2MQ==", "bodyText": "The naming is off here: This is more of a widgetPositionBuilder or similar.", "url": "https://github.com/Graylog2/graylog2-server/pull/9841#discussion_r553823761", "createdAt": "2021-01-08T09:08:49Z", "author": {"login": "dennisoelkers"}, "path": "graylog2-web-interface/src/views/logic/views/GetPositionForNewWidget.ts", "diffHunk": "@@ -0,0 +1,31 @@\n+/*\n+ * Copyright (C) 2020 Graylog, Inc.\n+ *\n+ * This program is free software: you can redistribute it and/or modify\n+ * it under the terms of the Server Side Public License, version 1,\n+ * as published by MongoDB, Inc.\n+ *\n+ * This program is distributed in the hope that it will be useful,\n+ * but WITHOUT ANY WARRANTY; without even the implied warranty of\n+ * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n+ * Server Side Public License for more details.\n+ *\n+ * You should have received a copy of the Server Side Public License\n+ * along with this program. If not, see\n+ * <http://www.mongodb.com/licensing/server-side-public-license>.\n+ */\n+import { widgetDefinition } from 'views/logic/Widgets';\n+import WidgetPosition from 'views/logic/widgets/WidgetPosition';\n+import Widget from 'views/logic/widgets/Widget';\n+import View from 'views/logic/views/View';\n+\n+const GetPositionForNewWidget = (widget: Widget, queryId: string, view: View) => {\n+  const widgetDef = widgetDefinition(widget.type);\n+\n+  const widgetBuilder = view.state.get(queryId).widgetPositions[widget.id]?.toBuilder()", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "57d29d7de57b5bdef4e84a7f92bb4c143c160b87"}, "originalPosition": 25}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzQ4NTkyMzI0OnYy", "diffSide": "RIGHT", "path": "graylog2-web-interface/src/views/logic/views/GetPositionForNewWidget.ts", "isResolved": false, "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMS0wOFQwOTowOTo0MFrOIQKvmw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMS0xMVQxNTowMjoyNFrOIRZHlw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1MzgyNDE1NQ==", "bodyText": "Why is the position of the widget overriden to 1,1, even if a position for the widget existed before?", "url": "https://github.com/Graylog2/graylog2-server/pull/9841#discussion_r553824155", "createdAt": "2021-01-08T09:09:40Z", "author": {"login": "dennisoelkers"}, "path": "graylog2-web-interface/src/views/logic/views/GetPositionForNewWidget.ts", "diffHunk": "@@ -0,0 +1,31 @@\n+/*\n+ * Copyright (C) 2020 Graylog, Inc.\n+ *\n+ * This program is free software: you can redistribute it and/or modify\n+ * it under the terms of the Server Side Public License, version 1,\n+ * as published by MongoDB, Inc.\n+ *\n+ * This program is distributed in the hope that it will be useful,\n+ * but WITHOUT ANY WARRANTY; without even the implied warranty of\n+ * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n+ * Server Side Public License for more details.\n+ *\n+ * You should have received a copy of the Server Side Public License\n+ * along with this program. If not, see\n+ * <http://www.mongodb.com/licensing/server-side-public-license>.\n+ */\n+import { widgetDefinition } from 'views/logic/Widgets';\n+import WidgetPosition from 'views/logic/widgets/WidgetPosition';\n+import Widget from 'views/logic/widgets/Widget';\n+import View from 'views/logic/views/View';\n+\n+const GetPositionForNewWidget = (widget: Widget, queryId: string, view: View) => {\n+  const widgetDef = widgetDefinition(widget.type);\n+\n+  const widgetBuilder = view.state.get(queryId).widgetPositions[widget.id]?.toBuilder()\n+    || WidgetPosition.builder().width(widgetDef.defaultWidth).height(widgetDef.defaultHeight);\n+\n+  return widgetBuilder.col(1).row(1).build();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "57d29d7de57b5bdef4e84a7f92bb4c143c160b87"}, "originalPosition": 28}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1NDg4Njg0MA==", "bodyText": "Because it is the position for a new widget, and right now we place the new widgets on top.", "url": "https://github.com/Graylog2/graylog2-server/pull/9841#discussion_r554886840", "createdAt": "2021-01-11T08:33:55Z", "author": {"login": "kmerz"}, "path": "graylog2-web-interface/src/views/logic/views/GetPositionForNewWidget.ts", "diffHunk": "@@ -0,0 +1,31 @@\n+/*\n+ * Copyright (C) 2020 Graylog, Inc.\n+ *\n+ * This program is free software: you can redistribute it and/or modify\n+ * it under the terms of the Server Side Public License, version 1,\n+ * as published by MongoDB, Inc.\n+ *\n+ * This program is distributed in the hope that it will be useful,\n+ * but WITHOUT ANY WARRANTY; without even the implied warranty of\n+ * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n+ * Server Side Public License for more details.\n+ *\n+ * You should have received a copy of the Server Side Public License\n+ * along with this program. If not, see\n+ * <http://www.mongodb.com/licensing/server-side-public-license>.\n+ */\n+import { widgetDefinition } from 'views/logic/Widgets';\n+import WidgetPosition from 'views/logic/widgets/WidgetPosition';\n+import Widget from 'views/logic/widgets/Widget';\n+import View from 'views/logic/views/View';\n+\n+const GetPositionForNewWidget = (widget: Widget, queryId: string, view: View) => {\n+  const widgetDef = widgetDefinition(widget.type);\n+\n+  const widgetBuilder = view.state.get(queryId).widgetPositions[widget.id]?.toBuilder()\n+    || WidgetPosition.builder().width(widgetDef.defaultWidth).height(widgetDef.defaultHeight);\n+\n+  return widgetBuilder.col(1).row(1).build();", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1MzgyNDE1NQ=="}, "originalCommit": {"oid": "57d29d7de57b5bdef4e84a7f92bb4c143c160b87"}, "originalPosition": 28}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1NTEwODI0Nw==", "bodyText": "widgetBuilder is either:\n\na previously existing widget position (retrieved through view.state.get(queryId).widgetPositions[widget.id]?.toBuilder())\na newly created widget position with default dimensions (created through WidgetPosition.builder().width(widgetDef.defaultWidth).height(widgetDef.defaultHeight))\n\nIn the first case the widget position should not be overridden IMO.", "url": "https://github.com/Graylog2/graylog2-server/pull/9841#discussion_r555108247", "createdAt": "2021-01-11T15:02:24Z", "author": {"login": "dennisoelkers"}, "path": "graylog2-web-interface/src/views/logic/views/GetPositionForNewWidget.ts", "diffHunk": "@@ -0,0 +1,31 @@\n+/*\n+ * Copyright (C) 2020 Graylog, Inc.\n+ *\n+ * This program is free software: you can redistribute it and/or modify\n+ * it under the terms of the Server Side Public License, version 1,\n+ * as published by MongoDB, Inc.\n+ *\n+ * This program is distributed in the hope that it will be useful,\n+ * but WITHOUT ANY WARRANTY; without even the implied warranty of\n+ * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n+ * Server Side Public License for more details.\n+ *\n+ * You should have received a copy of the Server Side Public License\n+ * along with this program. If not, see\n+ * <http://www.mongodb.com/licensing/server-side-public-license>.\n+ */\n+import { widgetDefinition } from 'views/logic/Widgets';\n+import WidgetPosition from 'views/logic/widgets/WidgetPosition';\n+import Widget from 'views/logic/widgets/Widget';\n+import View from 'views/logic/views/View';\n+\n+const GetPositionForNewWidget = (widget: Widget, queryId: string, view: View) => {\n+  const widgetDef = widgetDefinition(widget.type);\n+\n+  const widgetBuilder = view.state.get(queryId).widgetPositions[widget.id]?.toBuilder()\n+    || WidgetPosition.builder().width(widgetDef.defaultWidth).height(widgetDef.defaultHeight);\n+\n+  return widgetBuilder.col(1).row(1).build();", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1MzgyNDE1NQ=="}, "originalCommit": {"oid": "57d29d7de57b5bdef4e84a7f92bb4c143c160b87"}, "originalPosition": 28}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzQ4NTkyNTgyOnYy", "diffSide": "RIGHT", "path": "graylog2-web-interface/src/views/logic/views/GetPositionForNewWidget.ts", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMS0wOFQwOToxMDoyNFrOIQKxJg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMS0xMVQwODo0ODozM1rOIRMCKQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1MzgyNDU1MA==", "bodyText": "This logic is contained in AddNewWidgetsToPositions as well. Can we consolidate it?", "url": "https://github.com/Graylog2/graylog2-server/pull/9841#discussion_r553824550", "createdAt": "2021-01-08T09:10:24Z", "author": {"login": "dennisoelkers"}, "path": "graylog2-web-interface/src/views/logic/views/GetPositionForNewWidget.ts", "diffHunk": "@@ -0,0 +1,31 @@\n+/*\n+ * Copyright (C) 2020 Graylog, Inc.\n+ *\n+ * This program is free software: you can redistribute it and/or modify\n+ * it under the terms of the Server Side Public License, version 1,\n+ * as published by MongoDB, Inc.\n+ *\n+ * This program is distributed in the hope that it will be useful,\n+ * but WITHOUT ANY WARRANTY; without even the implied warranty of\n+ * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n+ * Server Side Public License for more details.\n+ *\n+ * You should have received a copy of the Server Side Public License\n+ * along with this program. If not, see\n+ * <http://www.mongodb.com/licensing/server-side-public-license>.\n+ */\n+import { widgetDefinition } from 'views/logic/Widgets';\n+import WidgetPosition from 'views/logic/widgets/WidgetPosition';\n+import Widget from 'views/logic/widgets/Widget';\n+import View from 'views/logic/views/View';\n+\n+const GetPositionForNewWidget = (widget: Widget, queryId: string, view: View) => {\n+  const widgetDef = widgetDefinition(widget.type);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "57d29d7de57b5bdef4e84a7f92bb4c143c160b87"}, "originalPosition": 23}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1NDg5Mzg2NQ==", "bodyText": "I do not really see how it would it improve the code. \ud83d\ude15", "url": "https://github.com/Graylog2/graylog2-server/pull/9841#discussion_r554893865", "createdAt": "2021-01-11T08:48:33Z", "author": {"login": "kmerz"}, "path": "graylog2-web-interface/src/views/logic/views/GetPositionForNewWidget.ts", "diffHunk": "@@ -0,0 +1,31 @@\n+/*\n+ * Copyright (C) 2020 Graylog, Inc.\n+ *\n+ * This program is free software: you can redistribute it and/or modify\n+ * it under the terms of the Server Side Public License, version 1,\n+ * as published by MongoDB, Inc.\n+ *\n+ * This program is distributed in the hope that it will be useful,\n+ * but WITHOUT ANY WARRANTY; without even the implied warranty of\n+ * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n+ * Server Side Public License for more details.\n+ *\n+ * You should have received a copy of the Server Side Public License\n+ * along with this program. If not, see\n+ * <http://www.mongodb.com/licensing/server-side-public-license>.\n+ */\n+import { widgetDefinition } from 'views/logic/Widgets';\n+import WidgetPosition from 'views/logic/widgets/WidgetPosition';\n+import Widget from 'views/logic/widgets/Widget';\n+import View from 'views/logic/views/View';\n+\n+const GetPositionForNewWidget = (widget: Widget, queryId: string, view: View) => {\n+  const widgetDef = widgetDefinition(widget.type);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1MzgyNDU1MA=="}, "originalCommit": {"oid": "57d29d7de57b5bdef4e84a7f92bb4c143c160b87"}, "originalPosition": 23}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzQ4NTkzNTk2OnYy", "diffSide": "RIGHT", "path": "graylog2-web-interface/src/views/logic/views/__snapshots__/CopyWidgetToDashboard.test.js.snap", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMS0wOFQwOToxMzo0MVrOIQK3MQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMS0wOFQwOToxMzo0MVrOIQK3MQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1MzgyNjA5Nw==", "bodyText": "Isn't this an indication that the code has an issue? IMO it should not generate a NaN value for the row.", "url": "https://github.com/Graylog2/graylog2-server/pull/9841#discussion_r553826097", "createdAt": "2021-01-08T09:13:41Z", "author": {"login": "dennisoelkers"}, "path": "graylog2-web-interface/src/views/logic/views/__snapshots__/CopyWidgetToDashboard.test.js.snap", "diffHunk": "@@ -17,27 +17,33 @@ Object {\n         \"546b13fe-eae7-4fb8-abb9-e0e3a907c3e6\": Object {\n           \"col\": 1,\n           \"height\": 3,\n-          \"row\": 5,\n+          \"row\": NaN,", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "57d29d7de57b5bdef4e84a7f92bb4c143c160b87"}, "originalPosition": 5}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzQ4NTkzODMzOnYy", "diffSide": "RIGHT", "path": "graylog2-web-interface/src/views/logic/views/__snapshots__/MoveWidgetToTab.test.ts.snap", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMS0wOFQwOToxNDoyNFrOIQK4kQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMS0wOFQwOToxNDoyNFrOIQK4kQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1MzgyNjQ0OQ==", "bodyText": "Is this correct? height & width are undefined.", "url": "https://github.com/Graylog2/graylog2-server/pull/9841#discussion_r553826449", "createdAt": "2021-01-08T09:14:24Z", "author": {"login": "dennisoelkers"}, "path": "graylog2-web-interface/src/views/logic/views/__snapshots__/MoveWidgetToTab.test.ts.snap", "diffHunk": "@@ -194,7 +194,85 @@ Object {\n }\n `;\n \n-exports[`MoveWidgetToTab should work when titles are empty 1`] = `\n+exports['MoveWidgetToTab should provide a default position in case the widgets position cannot be found 1'] = `\n+Object {\n+  \"created_at\": \"2020-05-27T12:32:49.786Z\",\n+  \"description\": \"move widget to tab\",\n+  \"id\": \"5ece5e1b74ff709b0b0dc69b\",\n+  \"owner\": \"admin\",\n+  \"properties\": Immutable.List [],\n+  \"search_id\": \"new-search-id\",\n+  \"state\": Immutable.Map {\n+    \"fa247d8f-7afa-45b7-b57e-3cdef4ee53be\": Object {\n+      \"formatting\": Object {\n+        \"highlighting\": Array [],\n+      },\n+      \"positions\": Immutable.Map {},\n+      \"selected_fields\": undefined,\n+      \"titles\": Immutable.Map {\n+        \"widget\": Immutable.Map {},\n+      },\n+      \"widget_mapping\": Immutable.Map {},\n+      \"widgets\": Immutable.List [],\n+    },\n+    \"5faea09b-4187-4eda-9d59-7a86d4774c73\": Object {\n+      \"formatting\": Object {\n+        \"highlighting\": Array [],\n+      },\n+      \"positions\": Immutable.Map {\n+        \"dead-beef\": Object {\n+          \"col\": 1,\n+          \"height\": undefined,", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "57d29d7de57b5bdef4e84a7f92bb4c143c160b87"}, "originalPosition": 50}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzQ5NDYyMjMwOnYy", "diffSide": "RIGHT", "path": "graylog2-web-interface/src/views/logic/views/AddNewWidgetsToPositions.test.ts", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMS0xMVQxNTowNjo1NFrOIRZUGg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMS0xMVQxNTowNjo1NFrOIRZUGg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1NTExMTQ1MA==", "bodyText": "The import and the name of the test need to be renamed too.", "url": "https://github.com/Graylog2/graylog2-server/pull/9841#discussion_r555111450", "createdAt": "2021-01-11T15:06:54Z", "author": {"login": "dennisoelkers"}, "path": "graylog2-web-interface/src/views/logic/views/AddNewWidgetsToPositions.test.ts", "diffHunk": "@@ -20,7 +20,7 @@ import { PluginStore } from 'graylog-web-plugin/plugin';\n import Widget from 'views/logic/widgets/Widget';\n import WidgetPosition from 'views/logic/widgets/WidgetPosition';\n \n-import AddNewWidgetsToPositions from './AddNewWidgetsToPositions';\n+import AddNewWidgetsToPositions from './GenerateNextPosition';", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "51f0424bfbe1f069dc7ab38200d13b0b31b10b43"}, "originalPosition": 5}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzUxMDA0MjM5OnYy", "diffSide": "RIGHT", "path": "graylog2-web-interface/src/views/stores/CurrentViewStateStore.ts", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMS0xNFQxNjoxNTozOFrOITsCxQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMS0xNFQxNjoxNTozOFrOITsCxQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1NzUxNTQ2MQ==", "bodyText": "The import name should be changed.", "url": "https://github.com/Graylog2/graylog2-server/pull/9841#discussion_r557515461", "createdAt": "2021-01-14T16:15:38Z", "author": {"login": "dennisoelkers"}, "path": "graylog2-web-interface/src/views/stores/CurrentViewStateStore.ts", "diffHunk": "@@ -22,7 +22,7 @@ import type { RefluxActions, Store } from 'stores/StoreTypes';\n import FormattingSettings from 'views/logic/views/formatting/FormattingSettings';\n import Widget from 'views/logic/widgets/Widget';\n import { singletonActions, singletonStore } from 'views/logic/singleton';\n-import AddNewWidgetsToPositions from 'views/logic/views/AddNewWidgetsToPositions';\n+import AddNewWidgetsToPositions from 'views/logic/views/GenerateNextPosition';", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e51cd2bb6073225394c3c24a4d14acf14c065726"}, "originalPosition": 5}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4318, "cost": 1, "resetAt": "2021-11-12T20:28:25Z"}}}