{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTEyOTM5NDc4", "number": 9316, "reviewThreads": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wM1QxMzoyMDowNlrOE0zYjg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wM1QxMzoyMDowNlrOE0zYjg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzIzODAzMjc4OnYy", "diffSide": "RIGHT", "path": "graylog2-web-interface/src/stores/metrics/MetricsStore.js", "isResolved": false, "comments": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wM1QxMzoyMDowNlrOHsuaZA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wNFQxMjo0Mzo0NVrOHtWevA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNjY1OTgxMg==", "bodyText": "We are returning error from the promise handler there. Do we want to make use of that in the error handling part of the ShowMetricsPage and show the error there?", "url": "https://github.com/Graylog2/graylog2-server/pull/9316#discussion_r516659812", "createdAt": "2020-11-03T13:20:06Z", "author": {"login": "dennisoelkers"}, "path": "graylog2-web-interface/src/stores/metrics/MetricsStore.js", "diffHunk": "@@ -169,6 +170,11 @@ const MetricsStore = Reflux.createStore({\n \n       return fetch('GET', url).then((response) => {\n         return { nodeId: nodeId, names: response.metrics };\n+      }, (error) => {\n+        UserNotification.error(`Fetching metrics for node [${nodeId}] failed with: ${error}.`,\n+          'Could not fetch node metrics');\n+        // When fetching metrics fails, keep previous available metrics around, letting user see them\n+        return { nodeId: nodeId, names: this.metricsNames[nodeId], error: error };", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e9d758210b581f7fce3df74780082dff893b5aee"}, "originalPosition": 16}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNjY3MDg5Nw==", "bodyText": "I guess we could replace the toastr error notification with something less annoying, will take a quick look \ud83d\udc4d", "url": "https://github.com/Graylog2/graylog2-server/pull/9316#discussion_r516670897", "createdAt": "2020-11-03T13:38:01Z", "author": {"login": "edmundoa"}, "path": "graylog2-web-interface/src/stores/metrics/MetricsStore.js", "diffHunk": "@@ -169,6 +170,11 @@ const MetricsStore = Reflux.createStore({\n \n       return fetch('GET', url).then((response) => {\n         return { nodeId: nodeId, names: response.metrics };\n+      }, (error) => {\n+        UserNotification.error(`Fetching metrics for node [${nodeId}] failed with: ${error}.`,\n+          'Could not fetch node metrics');\n+        // When fetching metrics fails, keep previous available metrics around, letting user see them\n+        return { nodeId: nodeId, names: this.metricsNames[nodeId], error: error };", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNjY1OTgxMg=="}, "originalCommit": {"oid": "e9d758210b581f7fce3df74780082dff893b5aee"}, "originalPosition": 16}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNzI4ODg2NA==", "bodyText": "@dennisoelkers I reworked the UI a bit to display a text error next to the filter, instead of possibly multiple toaster notifications. I'll re-request for your review, let me know what you think :)", "url": "https://github.com/Graylog2/graylog2-server/pull/9316#discussion_r517288864", "createdAt": "2020-11-04T11:50:25Z", "author": {"login": "edmundoa"}, "path": "graylog2-web-interface/src/stores/metrics/MetricsStore.js", "diffHunk": "@@ -169,6 +170,11 @@ const MetricsStore = Reflux.createStore({\n \n       return fetch('GET', url).then((response) => {\n         return { nodeId: nodeId, names: response.metrics };\n+      }, (error) => {\n+        UserNotification.error(`Fetching metrics for node [${nodeId}] failed with: ${error}.`,\n+          'Could not fetch node metrics');\n+        // When fetching metrics fails, keep previous available metrics around, letting user see them\n+        return { nodeId: nodeId, names: this.metricsNames[nodeId], error: error };", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNjY1OTgxMg=="}, "originalCommit": {"oid": "e9d758210b581f7fce3df74780082dff893b5aee"}, "originalPosition": 16}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNzMwNzYzOQ==", "bodyText": "When I am going to the node metrics page with your patch applied, I end up here (ShowMetricsPage.jsx:66), which does not show the error message of the error that occurred. Maybe we should centralize error handling in one of the two components (ShowMetricsPage vs. MetricsComponent) instead of doing it in both?", "url": "https://github.com/Graylog2/graylog2-server/pull/9316#discussion_r517307639", "createdAt": "2020-11-04T12:27:00Z", "author": {"login": "dennisoelkers"}, "path": "graylog2-web-interface/src/stores/metrics/MetricsStore.js", "diffHunk": "@@ -169,6 +170,11 @@ const MetricsStore = Reflux.createStore({\n \n       return fetch('GET', url).then((response) => {\n         return { nodeId: nodeId, names: response.metrics };\n+      }, (error) => {\n+        UserNotification.error(`Fetching metrics for node [${nodeId}] failed with: ${error}.`,\n+          'Could not fetch node metrics');\n+        // When fetching metrics fails, keep previous available metrics around, letting user see them\n+        return { nodeId: nodeId, names: this.metricsNames[nodeId], error: error };", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNjY1OTgxMg=="}, "originalCommit": {"oid": "e9d758210b581f7fce3df74780082dff893b5aee"}, "originalPosition": 16}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNzMxNjI4NA==", "bodyText": "I think you refer to the change in the page header for ShowMetricsPage (the link takes me somewhere else, somehow). I was thinking about putting the error message in the page header, but decided against it since it may take quite a bit of space and the error message will be displayed below anyway.\nRight now all of the error handling is done in MetricsComponent, since it's the component rendering the page content and seemed cleaner that way (less imports and need to move stuff around). The only exception is the page header in ShowMetricsPage, and only because we indicate the number of metrics the node is reporting.", "url": "https://github.com/Graylog2/graylog2-server/pull/9316#discussion_r517316284", "createdAt": "2020-11-04T12:43:45Z", "author": {"login": "edmundoa"}, "path": "graylog2-web-interface/src/stores/metrics/MetricsStore.js", "diffHunk": "@@ -169,6 +170,11 @@ const MetricsStore = Reflux.createStore({\n \n       return fetch('GET', url).then((response) => {\n         return { nodeId: nodeId, names: response.metrics };\n+      }, (error) => {\n+        UserNotification.error(`Fetching metrics for node [${nodeId}] failed with: ${error}.`,\n+          'Could not fetch node metrics');\n+        // When fetching metrics fails, keep previous available metrics around, letting user see them\n+        return { nodeId: nodeId, names: this.metricsNames[nodeId], error: error };", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNjY1OTgxMg=="}, "originalCommit": {"oid": "e9d758210b581f7fce3df74780082dff893b5aee"}, "originalPosition": 16}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4459, "cost": 1, "resetAt": "2021-11-12T20:28:25Z"}}}