{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTA2ODAwNjIx", "number": 9217, "reviewThreads": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yOFQwODo1OTowM1rOEytfNw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yOFQwOTozODoyOFrOEyudWg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzIxNjA5NTI3OnYy", "diffSide": "RIGHT", "path": "UPGRADING.rst", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yOFQwODo1OTowM1rOHpf5XQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yOFQwODo1OTowM1rOHpf5XQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMzI3NjI1Mw==", "bodyText": "The endpoint is /users not /system/users.", "url": "https://github.com/Graylog2/graylog2-server/pull/9217#discussion_r513276253", "createdAt": "2020-10-28T08:59:03Z", "author": {"login": "bernd"}, "path": "UPGRADING.rst", "diffHunk": "@@ -11,6 +11,11 @@ Prior to v3.3.3, the certificates of LDAP servers which are connected to using a\n \n A `CVE <https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2020-15813>`_ is tracked for this issue.\n \n+Change of API endpoint for user retrieval and modification\n+==========================================================\n+\n+In 4.0 we changed most of the user API endpoint `/system/users` to expect user IDs instead of names.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ce2392be8ac6ae2f0fd4da225bd13ce3ebf66a15"}, "originalPosition": 7}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzIxNjE1OTUwOnYy", "diffSide": "RIGHT", "path": "graylog2-server/src/main/java/org/graylog2/rest/resources/users/UsersResource.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yOFQwOToxNToyOFrOHpgg_w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yOFQwOToxNToyOFrOHpgg_w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMzI4NjM5OQ==", "bodyText": "How about putting the handling code into a separate method so we don't duplicate the same code in get and getbyId? \ud83d\ude04", "url": "https://github.com/Graylog2/graylog2-server/pull/9217#discussion_r513286399", "createdAt": "2020-10-28T09:15:28Z", "author": {"login": "bernd"}, "path": "graylog2-server/src/main/java/org/graylog2/rest/resources/users/UsersResource.java", "diffHunk": "@@ -173,6 +174,32 @@ public UserSummary get(@ApiParam(name = \"username\", value = \"The username to ret\n         return toUserResponse(user, isSelf || canEditUserPermissions, AllUserSessions.create(sessionService));\n     }\n \n+    @GET\n+    @Path(\"id/{userId}\")\n+    @ApiOperation(value = \"Get user details by userId\", notes = \"The user's permissions are only included if a user asks for his \" +\n+            \"own account or for users with the necessary permissions to edit permissions.\")\n+    @ApiResponses({\n+            @ApiResponse(code = 404, message = \"The user could not be found.\")\n+    })\n+    public UserSummary getbyId(@ApiParam(name = \"userId\", value = \"The userId to return information for.\", required = true)\n+                           @PathParam(\"userId\") String userId,\n+                           @Context UserContext userContext) {\n+\n+        final User user = loadUserById(userId);\n+        final String username = user.getName();\n+        // If a user has permissions to edit another user's profile, it should be able to see it.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "96c5a5184ad294dc4dd4f09e535a20f5965c507a"}, "originalPosition": 25}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzIxNjE5ODM4OnYy", "diffSide": "RIGHT", "path": "graylog2-web-interface/src/actions/users/UsersActions.js", "isResolved": true, "comments": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yOFQwOToyNDo1N1rOHpg4fQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yOFQxMzozMDoyM1rOHpqEEQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMzI5MjQxMw==", "bodyText": "Why don't we delete users by ID and still use the username for that?", "url": "https://github.com/Graylog2/graylog2-server/pull/9217#discussion_r513292413", "createdAt": "2020-10-28T09:24:57Z", "author": {"login": "bernd"}, "path": "graylog2-web-interface/src/actions/users/UsersActions.js", "diffHunk": "@@ -40,13 +40,14 @@ export type PaginatedUsers = PaginatedList<UserOverview> & {\n \n export type ActionsType = {\n   create: (user: UserCreate) => Promise<void>,\n-  load: (username: string) => Promise<User>,\n-  update: (username: string, request: any) => Promise<void>,\n-  delete: (username: string) => Promise<void>,\n-  changePassword: (username: string, request: ChangePasswordRequest) => Promise<void>,\n-  createToken: (username: string, tokenName: string) => Promise<Token>,\n-  loadTokens: (username: string) => Promise<Token[]>,\n-  deleteToken: (username: string, tokenId: string, tokenName: string) => Promise<void>,\n+  load: (userId: string) => Promise<User>,\n+  loadByUsername: (username: string) => Promise<User>,\n+  update: (userId: string, request: any) => Promise<void>,\n+  delete: (username: string, fullName: string) => Promise<void>,", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "96c5a5184ad294dc4dd4f09e535a20f5965c507a"}, "originalPosition": 14}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMzQxNDM0Ng==", "bodyText": "I didn't want to touch the delete code, because that also needs changes to the UserService.delete() which has these weird functionality that allows to remove multiple users with the same name..", "url": "https://github.com/Graylog2/graylog2-server/pull/9217#discussion_r513414346", "createdAt": "2020-10-28T12:48:58Z", "author": {"login": "mpfz0r"}, "path": "graylog2-web-interface/src/actions/users/UsersActions.js", "diffHunk": "@@ -40,13 +40,14 @@ export type PaginatedUsers = PaginatedList<UserOverview> & {\n \n export type ActionsType = {\n   create: (user: UserCreate) => Promise<void>,\n-  load: (username: string) => Promise<User>,\n-  update: (username: string, request: any) => Promise<void>,\n-  delete: (username: string) => Promise<void>,\n-  changePassword: (username: string, request: ChangePasswordRequest) => Promise<void>,\n-  createToken: (username: string, tokenName: string) => Promise<Token>,\n-  loadTokens: (username: string) => Promise<Token[]>,\n-  deleteToken: (username: string, tokenId: string, tokenName: string) => Promise<void>,\n+  load: (userId: string) => Promise<User>,\n+  loadByUsername: (username: string) => Promise<User>,\n+  update: (userId: string, request: any) => Promise<void>,\n+  delete: (username: string, fullName: string) => Promise<void>,", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMzI5MjQxMw=="}, "originalCommit": {"oid": "96c5a5184ad294dc4dd4f09e535a20f5965c507a"}, "originalPosition": 14}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMzQyMTM0Nw==", "bodyText": "@mpfz0r How about creating a UserService#deleteById method and a DELETE /users/id/<id> endpoint so we can leave the other code untouched?", "url": "https://github.com/Graylog2/graylog2-server/pull/9217#discussion_r513421347", "createdAt": "2020-10-28T12:59:28Z", "author": {"login": "bernd"}, "path": "graylog2-web-interface/src/actions/users/UsersActions.js", "diffHunk": "@@ -40,13 +40,14 @@ export type PaginatedUsers = PaginatedList<UserOverview> & {\n \n export type ActionsType = {\n   create: (user: UserCreate) => Promise<void>,\n-  load: (username: string) => Promise<User>,\n-  update: (username: string, request: any) => Promise<void>,\n-  delete: (username: string) => Promise<void>,\n-  changePassword: (username: string, request: ChangePasswordRequest) => Promise<void>,\n-  createToken: (username: string, tokenName: string) => Promise<Token>,\n-  loadTokens: (username: string) => Promise<Token[]>,\n-  deleteToken: (username: string, tokenId: string, tokenName: string) => Promise<void>,\n+  load: (userId: string) => Promise<User>,\n+  loadByUsername: (username: string) => Promise<User>,\n+  update: (userId: string, request: any) => Promise<void>,\n+  delete: (username: string, fullName: string) => Promise<void>,", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMzI5MjQxMw=="}, "originalCommit": {"oid": "96c5a5184ad294dc4dd4f09e535a20f5965c507a"}, "originalPosition": 14}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMzQyNDQ2OA==", "bodyText": "@bernd that I can do, of course", "url": "https://github.com/Graylog2/graylog2-server/pull/9217#discussion_r513424468", "createdAt": "2020-10-28T13:04:18Z", "author": {"login": "mpfz0r"}, "path": "graylog2-web-interface/src/actions/users/UsersActions.js", "diffHunk": "@@ -40,13 +40,14 @@ export type PaginatedUsers = PaginatedList<UserOverview> & {\n \n export type ActionsType = {\n   create: (user: UserCreate) => Promise<void>,\n-  load: (username: string) => Promise<User>,\n-  update: (username: string, request: any) => Promise<void>,\n-  delete: (username: string) => Promise<void>,\n-  changePassword: (username: string, request: ChangePasswordRequest) => Promise<void>,\n-  createToken: (username: string, tokenName: string) => Promise<Token>,\n-  loadTokens: (username: string) => Promise<Token[]>,\n-  deleteToken: (username: string, tokenId: string, tokenName: string) => Promise<void>,\n+  load: (userId: string) => Promise<User>,\n+  loadByUsername: (username: string) => Promise<User>,\n+  update: (userId: string, request: any) => Promise<void>,\n+  delete: (username: string, fullName: string) => Promise<void>,", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMzI5MjQxMw=="}, "originalCommit": {"oid": "96c5a5184ad294dc4dd4f09e535a20f5965c507a"}, "originalPosition": 14}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMzQ0MjgzMw==", "bodyText": "ok, done. @linuspahl there is also user deletebyId endpoint now", "url": "https://github.com/Graylog2/graylog2-server/pull/9217#discussion_r513442833", "createdAt": "2020-10-28T13:30:23Z", "author": {"login": "mpfz0r"}, "path": "graylog2-web-interface/src/actions/users/UsersActions.js", "diffHunk": "@@ -40,13 +40,14 @@ export type PaginatedUsers = PaginatedList<UserOverview> & {\n \n export type ActionsType = {\n   create: (user: UserCreate) => Promise<void>,\n-  load: (username: string) => Promise<User>,\n-  update: (username: string, request: any) => Promise<void>,\n-  delete: (username: string) => Promise<void>,\n-  changePassword: (username: string, request: ChangePasswordRequest) => Promise<void>,\n-  createToken: (username: string, tokenName: string) => Promise<Token>,\n-  loadTokens: (username: string) => Promise<Token[]>,\n-  deleteToken: (username: string, tokenId: string, tokenName: string) => Promise<void>,\n+  load: (userId: string) => Promise<User>,\n+  loadByUsername: (username: string) => Promise<User>,\n+  update: (userId: string, request: any) => Promise<void>,\n+  delete: (username: string, fullName: string) => Promise<void>,", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMzI5MjQxMw=="}, "originalCommit": {"oid": "96c5a5184ad294dc4dd4f09e535a20f5965c507a"}, "originalPosition": 14}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzIxNjI1NDM0OnYy", "diffSide": "RIGHT", "path": "graylog2-web-interface/src/pages/UserTokensEditPage.jsx", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yOFQwOTozODoyOFrOHpha7w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yOFQwOTo1Mjo1MlrOHpiB-Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMzMwMTIzMQ==", "bodyText": "for permission we need to use the username", "url": "https://github.com/Graylog2/graylog2-server/pull/9217#discussion_r513301231", "createdAt": "2020-10-28T09:38:28Z", "author": {"login": "kmerz"}, "path": "graylog2-web-interface/src/pages/UserTokensEditPage.jsx", "diffHunk": "@@ -31,16 +31,16 @@ const PageTitle = ({ fullName }: {fullName: ?string}) => (\n   </>\n );\n \n-const _loadTokens = (username, currentUser, setTokens) => {\n-  if (isPermitted(currentUser?.permissions, [`users:tokenlist:${username}`])) {\n-    UsersDomain.loadTokens(username).then(setTokens);\n+const _loadTokens = (userId, currentUser, setTokens) => {\n+  if (isPermitted(currentUser?.permissions, [`users:tokenlist:${userId}`])) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "96c5a5184ad294dc4dd4f09e535a20f5965c507a"}, "originalPosition": 17}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMzMxMTIyNQ==", "bodyText": "Good catch", "url": "https://github.com/Graylog2/graylog2-server/pull/9217#discussion_r513311225", "createdAt": "2020-10-28T09:52:52Z", "author": {"login": "linuspahl"}, "path": "graylog2-web-interface/src/pages/UserTokensEditPage.jsx", "diffHunk": "@@ -31,16 +31,16 @@ const PageTitle = ({ fullName }: {fullName: ?string}) => (\n   </>\n );\n \n-const _loadTokens = (username, currentUser, setTokens) => {\n-  if (isPermitted(currentUser?.permissions, [`users:tokenlist:${username}`])) {\n-    UsersDomain.loadTokens(username).then(setTokens);\n+const _loadTokens = (userId, currentUser, setTokens) => {\n+  if (isPermitted(currentUser?.permissions, [`users:tokenlist:${userId}`])) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMzMwMTIzMQ=="}, "originalCommit": {"oid": "96c5a5184ad294dc4dd4f09e535a20f5965c507a"}, "originalPosition": 17}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4430, "cost": 1, "resetAt": "2021-11-12T20:28:25Z"}}}