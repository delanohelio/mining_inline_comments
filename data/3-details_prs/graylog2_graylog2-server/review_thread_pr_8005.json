{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDEwODcxMTE5", "number": 8005, "reviewThreads": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wNFQxMzoxMzowMlrOD4-zEA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wNVQwODoyNToyOFrOD5TUiQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjYxMDc1NzI4OnYy", "diffSide": "RIGHT", "path": "graylog2-web-interface/src/components/sidecars/configurations/CopyCollectorModal.jsx", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wNFQxMzoxMzowMlrOGP_pow==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wNFQxMzoxMzowMlrOGP_pow==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxOTQyNDY3NQ==", "bodyText": "The validation parameter will not always have those fields, and it may even be an empty object. Trying to destructure it will result in an error.\nUnhandled rejection TypeError: Invalid attempt to destructure non-iterable instance\nat _nonIterableRest (http://localhost:8080/7c9d6ab7-32.js:1273:37)\nat _slicedToArray (http://localhost:8080/7c9d6ab7-32.js:1271:99)\nat http://localhost:8080/7c9d6ab7-32.js:1392:37", "url": "https://github.com/Graylog2/graylog2-server/pull/8005#discussion_r419424675", "createdAt": "2020-05-04T13:13:02Z", "author": {"login": "edmundoa"}, "path": "graylog2-web-interface/src/components/sidecars/configurations/CopyCollectorModal.jsx", "diffHunk": "@@ -44,52 +43,40 @@ class CopyCollectorModal extends React.Component {\n   };\n \n   _save = () => {\n-    const collector = this.state;\n+    const { errorMessage, id, name } = this.state;\n+    const { copyCollector } = this.props;\n \n-    if (!collector.error) {\n-      this.props.copyCollector(this.state.id, this.state.name, this._saved);\n+    if (!errorMessage) {\n+      copyCollector(id, name, this._saved);\n     }\n   };\n \n   _changeName = (event) => {\n-    const nextName = event.target.value;\n-    this.setState({ name: nextName });\n+    const { collector, validateCollector } = this.props;\n+    const name = event.target.value;\n+    this.setState({ name, errorMessage: undefined });\n \n-    const nextCollector = lodash.cloneDeep(this.props.collector);\n-    nextCollector.name = nextName;\n+    const nextCollector = lodash.cloneDeep(collector);\n+    nextCollector.name = name;\n     nextCollector.id = '';\n \n-    this.props.validateCollector(nextCollector).then((validation) => {\n-      let errorMessage = '';\n-      if (validation.errors.name) {\n-        errorMessage = validation.errors.name[0];\n-      }\n-      this.setState({ error: validation.failed, error_message: errorMessage });\n+    validateCollector(nextCollector).then((validation) => {\n+      const [errorMessage] = validation.errors.name;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "65bbbaa364ce87284092a8511066b53a3d73fb10"}, "originalPosition": 93}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjYxMDc1ODIwOnYy", "diffSide": "RIGHT", "path": "graylog2-web-interface/src/components/sidecars/configurations/CopyConfigurationModal.jsx", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wNFQxMzoxMzoxOFrOGP_qSw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wNFQxMzoxMzoxOFrOGP_qSw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxOTQyNDg0Mw==", "bodyText": "Same as above.", "url": "https://github.com/Graylog2/graylog2-server/pull/8005#discussion_r419424843", "createdAt": "2020-05-04T13:13:18Z", "author": {"login": "edmundoa"}, "path": "graylog2-web-interface/src/components/sidecars/configurations/CopyConfigurationModal.jsx", "diffHunk": "@@ -43,47 +42,37 @@ class CopyConfigurationModal extends React.Component {\n   };\n \n   _save = () => {\n-    const configuration = this.state;\n+    const { copyConfiguration } = this.props;\n+    const { errorMessage, id, name } = this.state;\n \n-    if (!configuration.error) {\n-      this.props.copyConfiguration(this.state.id, this.state.name, this._saved);\n+    if (errorMessage) {\n+      copyConfiguration(id, name, this._saved);\n     }\n   };\n \n   _changeName = (event) => {\n-    const nextName = event.target.value;\n-    this.setState({ name: nextName });\n-    this.props.validateConfiguration({ name: nextName }).then((validation) => {\n-      let errorMessage = '';\n-      if (validation.errors.name) {\n-        errorMessage = validation.errors.name[0];\n-      }\n-      this.setState({ error: validation.failed, error_message: errorMessage });\n+    const { validateConfiguration } = this.props;\n+    const name = event.target.value;\n+    this.setState({ name, errorMessage: undefined });\n+\n+    validateConfiguration({ name }).then((validation) => {\n+      const [errorMessage] = validation.errors.name;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "65bbbaa364ce87284092a8511066b53a3d73fb10"}, "originalPosition": 86}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjYxMDc2NjAzOnYy", "diffSide": "RIGHT", "path": "graylog2-web-interface/src/components/sidecars/configurations/CopyConfigurationModal.jsx", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wNFQxMzoxNTowM1rOGP_u5g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wNFQxMzoxNTowM1rOGP_u5g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxOTQyNjAyMg==", "bodyText": "This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters. Learn more about bidirectional Unicode characters\n\n\n  \n\n\n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                if (errorMessage) {\n          \n          \n            \n                if (!errorMessage) {\n          \n      \n    \n    \n  \n\nOtherwise will do the opposite of what we want.", "url": "https://github.com/Graylog2/graylog2-server/pull/8005#discussion_r419426022", "createdAt": "2020-05-04T13:15:03Z", "author": {"login": "edmundoa"}, "path": "graylog2-web-interface/src/components/sidecars/configurations/CopyConfigurationModal.jsx", "diffHunk": "@@ -43,47 +42,37 @@ class CopyConfigurationModal extends React.Component {\n   };\n \n   _save = () => {\n-    const configuration = this.state;\n+    const { copyConfiguration } = this.props;\n+    const { errorMessage, id, name } = this.state;\n \n-    if (!configuration.error) {\n-      this.props.copyConfiguration(this.state.id, this.state.name, this._saved);\n+    if (errorMessage) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "65bbbaa364ce87284092a8511066b53a3d73fb10"}, "originalPosition": 67}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjYxNDExOTc3OnYy", "diffSide": "RIGHT", "path": "graylog2-web-interface/src/components/sidecars/configurations/CopyConfigurationModal.jsx", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wNVQwODoyNToyOVrOGQfPtA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wNVQwODoyNToyOVrOGQfPtA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxOTk0MjMyNA==", "bodyText": "I saw this in my browser console, I think this prop needs a default value here or make the prop not required:\nWarning: Failed prop type: The prop `error` is marked as required in `CloneMenuItem`, but its value is `undefined`.\n    in CloneMenuItem (created by CopyConfigurationModal)\n    in CopyConfigurationModal (created by ConfigurationRow)\n    in ul (created by DropdownMenu)\n    in RootCloseWrapper (created by DropdownMenu)\n    in DropdownMenu (created by Dropdown)", "url": "https://github.com/Graylog2/graylog2-server/pull/8005#discussion_r419942324", "createdAt": "2020-05-05T08:25:29Z", "author": {"login": "edmundoa"}, "path": "graylog2-web-interface/src/components/sidecars/configurations/CopyConfigurationModal.jsx", "diffHunk": "@@ -43,47 +42,37 @@ class CopyConfigurationModal extends React.Component {\n   };\n \n   _save = () => {\n-    const configuration = this.state;\n+    const { copyConfiguration } = this.props;\n+    const { errorMessage, id, name } = this.state;\n \n-    if (!configuration.error) {\n-      this.props.copyConfiguration(this.state.id, this.state.name, this._saved);\n+    if (!errorMessage) {\n+      copyConfiguration(id, name, this._saved);\n     }\n   };\n \n   _changeName = (event) => {\n-    const nextName = event.target.value;\n-    this.setState({ name: nextName });\n-    this.props.validateConfiguration({ name: nextName }).then((validation) => {\n-      let errorMessage = '';\n+    const { validateConfiguration } = this.props;\n+    const name = event.target.value;\n+    this.setState({ name, errorMessage: undefined });\n+\n+    validateConfiguration({ name }).then((validation) => {\n       if (validation.errors.name) {\n-        errorMessage = validation.errors.name[0];\n+        this.setState({ errorMessage: validation.errors.name[0] });\n       }\n-      this.setState({ error: validation.failed, error_message: errorMessage });\n     });\n   };\n \n   render() {\n+    const { errorMessage, name } = this.state;\n+\n     return (\n-      <span>\n-        <MenuItem className={style.menuItem} onSelect={this.openModal}>Clone</MenuItem>\n-        <BootstrapModalForm ref=\"modal\"\n-                            title=\"Clone\"\n-                            onSubmitForm={this._save}\n-                            submitButtonDisabled={this.state.error}\n-                            submitButtonText=\"Done\">\n-          <fieldset>\n-            <Input type=\"text\"\n-                   id={this._getId('configuration-name')}\n-                   label=\"Name\"\n-                   defaultValue={this.state.name}\n-                   onChange={this._changeName}\n-                   bsStyle={this.state.error ? 'error' : null}\n-                   help={this.state.error ? this.state.error_message : 'Type a name for the new configuration'}\n-                   autoFocus\n-                   required />\n-          </fieldset>\n-        </BootstrapModalForm>\n-      </span>\n+      <CloneMenuItem onSelect={this.openModal}\n+                     onSave={this._save}\n+                     id={this._getId('configuration-name')}\n+                     onChange={this._changeName}\n+                     error={errorMessage}", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "32b746ae92b031f7e114a8504cd2ecf44bd54e9b"}, "originalPosition": 118}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3759, "cost": 1, "resetAt": "2021-11-12T20:28:25Z"}}}