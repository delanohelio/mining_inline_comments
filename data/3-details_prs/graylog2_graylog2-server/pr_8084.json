{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDE2MTMzODIz", "number": 8084, "title": "Support editing title, description and summary of a saved search", "bodyText": "This PR implements the \"Edit metadata\" action for the saved searches search bar menu, which opens a modal to edit the title, description and summary.\nIt also:\n\nrenames the \"Edit\" dashboard search bar action to \"Edit metadata\"\nI think \"Edit\" is too generic. From a user's perspective: What is going to happen, will a click on the button display the search / widgets in an edit mode?\nadjusts the sidebar view description.\nFor an ad hoc search, an info will be displayed to save the search as a saved search / dashboard, to add a description / summary. On a dashboard / saved search the view description will include a view type specific placeholder, if a summary or description is not defined.\n\nRegarding the tests for SavedSearchControls, I've tried to test if the edit modal opens, when clicking on \"Edit Metadata\", but I could not easily test this case with enzyme. Out of Interest I would like to have another look with someone else.\nTypes of changes\n\n\n Bug fix (non-breaking change which fixes an issue)\n New feature (non-breaking change which adds functionality)\n Refactoring (non-breaking change)\n Breaking change (fix or feature that would cause existing functionality to change)\n\nChecklist:\n\n\n\n My code follows the code style of this project.\n My change requires a change to the documentation.\n I have updated the documentation accordingly.\n I have read the CONTRIBUTING document.\n I have added tests to cover my changes.", "createdAt": "2020-05-11T14:16:38Z", "url": "https://github.com/Graylog2/graylog2-server/pull/8084", "merged": true, "mergeCommit": {"oid": "d3977152c1320e421959b446784ee44da8e1d6d0"}, "closed": true, "closedAt": "2020-06-12T09:14:33Z", "author": {"login": "linuspahl"}, "timelineItems": {"totalCount": 11, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABclFjB4ABqjMzNzM4MjQ3MTc=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcqfPGTgFqTQyOTU4Njk2Mg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "9b7ab91e4ca92198722bd8845c11add0c9f18594", "author": {"user": {"login": "linuspahl", "name": "Linus Pahl"}}, "url": "https://github.com/Graylog2/graylog2-server/commit/9b7ab91e4ca92198722bd8845c11add0c9f18594", "committedDate": "2020-05-11T13:47:41Z", "message": "Support editing title, description and summary of a saved search\n\n* Add \"Edit metadata\" action for saved search controls\n* Rename \"Edit\" action to \"Edit metadata\" for dashboards\n* Implement view type specific description for ViewPropertiesModal\n* Adjust sidebar ViewDescription"}, "afterCommit": {"oid": "be7225a50c37ef44d824d8dd5641f56834fde2d9", "author": {"user": {"login": "linuspahl", "name": "Linus Pahl"}}, "url": "https://github.com/Graylog2/graylog2-server/commit/be7225a50c37ef44d824d8dd5641f56834fde2d9", "committedDate": "2020-05-26T14:28:54Z", "message": "Support editing title, description and summary of a saved search\n\n* Add \"Edit metadata\" action for saved search controls\n* Rename \"Edit\" action to \"Edit metadata\" for dashboards\n* Implement view type specific description for ViewPropertiesModal\n* Adjust sidebar ViewDescription"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "be7225a50c37ef44d824d8dd5641f56834fde2d9", "author": {"user": {"login": "linuspahl", "name": "Linus Pahl"}}, "url": "https://github.com/Graylog2/graylog2-server/commit/be7225a50c37ef44d824d8dd5641f56834fde2d9", "committedDate": "2020-05-26T14:28:54Z", "message": "Support editing title, description and summary of a saved search\n\n* Add \"Edit metadata\" action for saved search controls\n* Rename \"Edit\" action to \"Edit metadata\" for dashboards\n* Implement view type specific description for ViewPropertiesModal\n* Adjust sidebar ViewDescription"}, "afterCommit": {"oid": "41541b815e9b4ecdf4794e676f562d05be049fb9", "author": {"user": {"login": "linuspahl", "name": "Linus Pahl"}}, "url": "https://github.com/Graylog2/graylog2-server/commit/41541b815e9b4ecdf4794e676f562d05be049fb9", "committedDate": "2020-05-26T15:33:41Z", "message": "Support editing title, description and summary of a saved search\n\n* Add \"Edit metadata\" action for saved search controls\n* Rename \"Edit\" action to \"Edit metadata\" for dashboards\n* Implement view type specific description for ViewPropertiesModal\n* Adjust sidebar ViewDescription"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDE4NDI4NDc3", "url": "https://github.com/Graylog2/graylog2-server/pull/8084#pullrequestreview-418428477", "createdAt": "2020-05-26T15:39:47Z", "commit": {"oid": "41541b815e9b4ecdf4794e676f562d05be049fb9"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yNlQxNTozOTo0OFrOGakV-g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yNlQxNTozOTo0OFrOGakV-g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMDUxMTYxMA==", "bodyText": "I does not have to be in this PR, but wouldn't it be wiser to make a functional component of this component, instead of adding a UNSAFE_", "url": "https://github.com/Graylog2/graylog2-server/pull/8084#discussion_r430511610", "createdAt": "2020-05-26T15:39:48Z", "author": {"login": "kmerz"}, "path": "graylog2-web-interface/src/views/components/views/ViewPropertiesModal.jsx", "diffHunk": "@@ -23,7 +24,8 @@ export default class ViewPropertiesModal extends React.Component {\n     };\n   }\n \n-  componentWillReceiveProps(nextProps) {\n+  // eslint-disable-next-line camelcase", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "41541b815e9b4ecdf4794e676f562d05be049fb9"}, "originalPosition": 13}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDE4NDMwOTg1", "url": "https://github.com/Graylog2/graylog2-server/pull/8084#pullrequestreview-418430985", "createdAt": "2020-05-26T15:42:23Z", "commit": {"oid": "41541b815e9b4ecdf4794e676f562d05be049fb9"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yNlQxNTo0MjoyM1rOGakfrQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yNlQxNTo0MjoyM1rOGakfrQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMDUxNDA5Mw==", "bodyText": "When we turn this into a functional component, we should do something better then comparing the whole view.\n\nit is not very efficient\nwe do not really care about the whole view if I am not wrong", "url": "https://github.com/Graylog2/graylog2-server/pull/8084#discussion_r430514093", "createdAt": "2020-05-26T15:42:23Z", "author": {"login": "kmerz"}, "path": "graylog2-web-interface/src/views/components/views/ViewPropertiesModal.jsx", "diffHunk": "@@ -23,7 +24,8 @@ export default class ViewPropertiesModal extends React.Component {\n     };\n   }\n \n-  componentWillReceiveProps(nextProps) {\n+  // eslint-disable-next-line camelcase\n+  UNSAFE_componentWillReceiveProps(nextProps) {\n     const { title } = this.props;\n     const { view } = this.state;\n     if (title !== nextProps.title || !isEqual(view, nextProps.view)) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "41541b815e9b4ecdf4794e676f562d05be049fb9"}, "originalPosition": 17}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDE4NDM0MjE1", "url": "https://github.com/Graylog2/graylog2-server/pull/8084#pullrequestreview-418434215", "createdAt": "2020-05-26T15:45:58Z", "commit": {"oid": "41541b815e9b4ecdf4794e676f562d05be049fb9"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yNlQxNTo0NTo1OFrOGakpiw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yNlQxNTo0NTo1OFrOGakpiw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMDUxNjYxOQ==", "bodyText": "The order of Sections does not make much sense to me:\n\nI would rather have the description and summary together and the result in the beginning or the end.", "url": "https://github.com/Graylog2/graylog2-server/pull/8084#discussion_r430516619", "createdAt": "2020-05-26T15:45:58Z", "author": {"login": "kmerz"}, "path": "graylog2-web-interface/src/views/components/sidebar/ViewDescription.jsx", "diffHunk": "@@ -1,46 +1,55 @@\n // @flow strict\n-import React from 'react';\n+import * as React from 'react';\n+import { useContext } from 'react';\n import styled from 'styled-components';\n import PropTypes from 'prop-types';\n \n import type { ViewMetaData } from 'views/stores/ViewMetadataStore';\n+import QueryResult from 'views/logic/QueryResult';\n \n-import IfDashboard from 'views/components/dashboard/IfDashboard';\n+import ViewTypeLabel from 'views/components/ViewTypeLabel';\n+import ViewTypeContext from 'views/components/contexts/ViewTypeContext';\n import { SearchResultOverview } from 'views/components/sidebar';\n \n const Section = styled.div`\n   margin-bottom: 8px;\n `;\n \n-const defaultNewDashboardSummary = 'No dashboard summary.';\n-\n type Props = {\n-  results: Object,\n+  results: QueryResult,\n   viewMetadata: ViewMetaData,\n };\n \n const ViewDescription = ({ results, viewMetadata }: Props) => {\n-  const formatDashboardDescription = (view: ViewMetaData) => {\n-    const { description } = view;\n-    if (description) {\n-      return <span>{description}</span>;\n-    }\n-    return <i>No dashboard description.</i>;\n-  };\n+  const isAdHocSearch = !viewMetadata.id;\n+  const viewType = useContext(ViewTypeContext);\n+  const viewTypeLabel = viewType ? <ViewTypeLabel type={viewType} /> : '';\n+  const resultsSection = (\n+    <Section>\n+      <SearchResultOverview results={results} />\n+    </Section>\n+  );\n \n-  return (\n-    <>\n-      <IfDashboard>\n+  if (isAdHocSearch) {\n+    return (\n+      <>\n+        {resultsSection}\n         <Section>\n-          {viewMetadata.summary || defaultNewDashboardSummary}\n+          <i>Save the search or export it to a dashboard to add a custom description.</i>\n         </Section>\n-      </IfDashboard>\n+      </>\n+    );\n+  }\n+\n+  return (\n+    <>\n+      <Section>\n+        {viewMetadata.summary || <i>No {viewTypeLabel} summary.</i>}\n+      </Section>\n+      {resultsSection}\n       <Section>\n-        <SearchResultOverview results={results} />\n+        {viewMetadata.description || <i>No {viewTypeLabel} description.</i>}\n       </Section>", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "41541b815e9b4ecdf4794e676f562d05be049fb9"}, "originalPosition": 70}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDE4NDM0NTQ5", "url": "https://github.com/Graylog2/graylog2-server/pull/8084#pullrequestreview-418434549", "createdAt": "2020-05-26T15:46:21Z", "commit": {"oid": "41541b815e9b4ecdf4794e676f562d05be049fb9"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "41541b815e9b4ecdf4794e676f562d05be049fb9", "author": {"user": {"login": "linuspahl", "name": "Linus Pahl"}}, "url": "https://github.com/Graylog2/graylog2-server/commit/41541b815e9b4ecdf4794e676f562d05be049fb9", "committedDate": "2020-05-26T15:33:41Z", "message": "Support editing title, description and summary of a saved search\n\n* Add \"Edit metadata\" action for saved search controls\n* Rename \"Edit\" action to \"Edit metadata\" for dashboards\n* Implement view type specific description for ViewPropertiesModal\n* Adjust sidebar ViewDescription"}, "afterCommit": {"oid": "7d9d4bd102aa5f43aa8e64acfcc56399e2122ba2", "author": {"user": {"login": "linuspahl", "name": "Linus Pahl"}}, "url": "https://github.com/Graylog2/graylog2-server/commit/7d9d4bd102aa5f43aa8e64acfcc56399e2122ba2", "committedDate": "2020-06-02T15:11:37Z", "message": "Support editing title, description and summary of a saved search\n\n* Add \"Edit metadata\" action for saved search controls\n* Rename \"Edit\" action to \"Edit metadata\" for dashboards\n* Implement view type specific description for ViewPropertiesModal\n* Adjust sidebar ViewDescription"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "fe3c2517718ddc94fb9852cc0ab36f756a675db3", "author": {"user": {"login": "linuspahl", "name": "Linus Pahl"}}, "url": "https://github.com/Graylog2/graylog2-server/commit/fe3c2517718ddc94fb9852cc0ab36f756a675db3", "committedDate": "2020-06-11T08:45:14Z", "message": "Support editing title, description and summary of a saved search\n\n* Add \"Edit metadata\" action for saved search controls\n* Rename \"Edit\" action to \"Edit metadata\" for dashboards\n* Implement view type specific description for ViewPropertiesModal\n* Adjust sidebar ViewDescription"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f23645bae78aaf99dcf968561fb964f73710e7ae", "author": {"user": {"login": "linuspahl", "name": "Linus Pahl"}}, "url": "https://github.com/Graylog2/graylog2-server/commit/f23645bae78aaf99dcf968561fb964f73710e7ae", "committedDate": "2020-06-11T08:45:14Z", "message": "Movesearch execution info in sidebar above search summary and description"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "7ea379a7e4cab94fd80b3313437cfe20e2439594", "author": {"user": {"login": "linuspahl", "name": "Linus Pahl"}}, "url": "https://github.com/Graylog2/graylog2-server/commit/7ea379a7e4cab94fd80b3313437cfe20e2439594", "committedDate": "2020-06-02T15:15:31Z", "message": "Movesearch execution info in sidebar above search summary and description"}, "afterCommit": {"oid": "f23645bae78aaf99dcf968561fb964f73710e7ae", "author": {"user": {"login": "linuspahl", "name": "Linus Pahl"}}, "url": "https://github.com/Graylog2/graylog2-server/commit/f23645bae78aaf99dcf968561fb964f73710e7ae", "committedDate": "2020-06-11T08:45:14Z", "message": "Movesearch execution info in sidebar above search summary and description"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDI5NTg2OTYy", "url": "https://github.com/Graylog2/graylog2-server/pull/8084#pullrequestreview-429586962", "createdAt": "2020-06-12T09:14:27Z", "commit": {"oid": "f23645bae78aaf99dcf968561fb964f73710e7ae"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3219, "cost": 1, "resetAt": "2021-10-28T18:54:27Z"}}}