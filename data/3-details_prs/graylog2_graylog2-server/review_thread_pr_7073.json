{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0MzU4Njg3NzMw", "number": 7073, "reviewThreads": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yMFQxMzo0Njo1MlrODZNvlw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yMFQxMzo0Njo1MlrODZNvlw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjI3NzY2MTY3OnYy", "diffSide": "RIGHT", "path": "graylog2-web-interface/src/components/users/EditRole.jsx", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yMFQxMzo0Njo1MlrOFfe1Iw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yMFQxNTowNjozNVrOFfhOeA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2ODU1NTI5OQ==", "bodyText": "Since we use getDerivedStateFromProps to initialize an \"empty\" role, and getDerivedStateFromProps is called before the first render and before any subsequent update is rendered, I think the constructor can be simplified and doesn't need to handle the default case.\nSo I think we can simplify this logic doing the following:\n\nIn the constructor, we set the role to the initialRole, since we are also using that to get the initialName\nIn getDerivedStateFromProps we check if prevState.role is set, and if it is not set we initialize it to the \"empty\" role", "url": "https://github.com/Graylog2/graylog2-server/pull/7073#discussion_r368555299", "createdAt": "2020-01-20T13:46:52Z", "author": {"login": "edmundoa"}, "path": "graylog2-web-interface/src/components/users/EditRole.jsx", "diffHunk": "@@ -1,85 +1,77 @@\n import PropTypes from 'prop-types';\n import React from 'react';\n-import createReactClass from 'create-react-class';\n import Immutable from 'immutable';\n \n import { Button, Alert, Col, ControlLabel, FormGroup, HelpBlock, Row } from 'components/graylog';\n import { Input } from 'components/bootstrap';\n import PermissionSelector from 'components/users/PermissionSelector';\n-import PermissionsMixin from 'util/PermissionsMixin';\n \n-const EditRole = createReactClass({\n-  displayName: 'EditRole',\n-\n-  propTypes: {\n-    initialRole: PropTypes.object.isRequired,\n-    onSave: PropTypes.func.isRequired,\n-    cancelEdit: PropTypes.func.isRequired,\n-    streams: PropTypes.object.isRequired,\n-    dashboards: PropTypes.object.isRequired,\n-  },\n-\n-  mixins: [PermissionsMixin],\n-\n-  getInitialState() {\n+class EditRole extends React.Component {\n+  constructor(props) {\n+    super(props);\n     const { initialRole } = this.props;\n-\n     let role = initialRole;\n-    if (role === null) {\n-      // for the create dialog\n+    if (!role) {\n       role = {\n         name: null,\n         description: null,\n         permissions: [],\n       };\n     }\n-    return {\n+    this.state = {\n       role,\n       initialName: this._safeRoleName(initialRole),\n     };\n-  },\n+  }\n \n-  componentWillReceiveProps(newProps) {\n-    this.setState({ role: newProps.initialRole, initialName: this._safeRoleName(newProps.initialRole) });\n-  },\n+  static getDerivedStateFromProps(nextProps, prevState) {\n+    const {\n+      role = {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "dc8e58d5afcaa94157ea6935205e05756517077d"}, "originalPosition": 53}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2ODU5NDU1Mg==", "bodyText": "Ok for that, added the update", "url": "https://github.com/Graylog2/graylog2-server/pull/7073#discussion_r368594552", "createdAt": "2020-01-20T15:06:35Z", "author": {"login": "ousmaneo"}, "path": "graylog2-web-interface/src/components/users/EditRole.jsx", "diffHunk": "@@ -1,85 +1,77 @@\n import PropTypes from 'prop-types';\n import React from 'react';\n-import createReactClass from 'create-react-class';\n import Immutable from 'immutable';\n \n import { Button, Alert, Col, ControlLabel, FormGroup, HelpBlock, Row } from 'components/graylog';\n import { Input } from 'components/bootstrap';\n import PermissionSelector from 'components/users/PermissionSelector';\n-import PermissionsMixin from 'util/PermissionsMixin';\n \n-const EditRole = createReactClass({\n-  displayName: 'EditRole',\n-\n-  propTypes: {\n-    initialRole: PropTypes.object.isRequired,\n-    onSave: PropTypes.func.isRequired,\n-    cancelEdit: PropTypes.func.isRequired,\n-    streams: PropTypes.object.isRequired,\n-    dashboards: PropTypes.object.isRequired,\n-  },\n-\n-  mixins: [PermissionsMixin],\n-\n-  getInitialState() {\n+class EditRole extends React.Component {\n+  constructor(props) {\n+    super(props);\n     const { initialRole } = this.props;\n-\n     let role = initialRole;\n-    if (role === null) {\n-      // for the create dialog\n+    if (!role) {\n       role = {\n         name: null,\n         description: null,\n         permissions: [],\n       };\n     }\n-    return {\n+    this.state = {\n       role,\n       initialName: this._safeRoleName(initialRole),\n     };\n-  },\n+  }\n \n-  componentWillReceiveProps(newProps) {\n-    this.setState({ role: newProps.initialRole, initialName: this._safeRoleName(newProps.initialRole) });\n-  },\n+  static getDerivedStateFromProps(nextProps, prevState) {\n+    const {\n+      role = {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2ODU1NTI5OQ=="}, "originalCommit": {"oid": "dc8e58d5afcaa94157ea6935205e05756517077d"}, "originalPosition": 53}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3976, "cost": 1, "resetAt": "2021-11-12T20:28:25Z"}}}