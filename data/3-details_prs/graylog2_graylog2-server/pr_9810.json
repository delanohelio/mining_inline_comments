{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTQwNjkxMzk3", "number": 9810, "title": "DateTimePicker - Adding limitDuration config to Widget", "bodyText": "Widget DateTime Picker needed limitDuration from the search config", "createdAt": "2020-12-15T20:35:02Z", "url": "https://github.com/Graylog2/graylog2-server/pull/9810", "merged": true, "mergeCommit": {"oid": "5c95e659da18125d25207538e32084d172965d14"}, "closed": true, "closedAt": "2021-01-14T16:23:57Z", "author": {"login": "kyleknighted"}, "timelineItems": {"totalCount": 11, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdmf232gH2gAyNTQwNjkxMzk3OjhkYzQxNzlmODY0MjI4ZTZlN2QxMzU3ODMwMzNhYjEwOTVmZDY5NWI=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdwG13cAFqTU2ODQwMTI0MA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "8dc4179f864228e6e7d135783033ab1095fd695b", "author": {"user": {"login": "kyleknighted", "name": "Kyle Knight"}}, "url": "https://github.com/Graylog2/graylog2-server/commit/8dc4179f864228e6e7d135783033ab1095fd695b", "committedDate": "2020-12-15T19:53:21Z", "message": "Adding limitDuration config to Widget"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "02720a9533ed8f931e73595c963320fb5df42fbc", "author": {"user": {"login": "kyleknighted", "name": "Kyle Knight"}}, "url": "https://github.com/Graylog2/graylog2-server/commit/02720a9533ed8f931e73595c963320fb5df42fbc", "committedDate": "2020-12-15T20:33:37Z", "message": "test & snap"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTUzNDczMzcz", "url": "https://github.com/Graylog2/graylog2-server/pull/9810#pullrequestreview-553473373", "createdAt": "2020-12-16T08:55:31Z", "commit": {"oid": "02720a9533ed8f931e73595c963320fb5df42fbc"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xNlQwODo1NTozMVrOIG6e6Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xNlQwOTowMToyM1rOIG6ucQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NDEyMDU1Mw==", "bodyText": "I would suggest using connect only for class-based components and use useStore for function components. The benefit is the simpler API and it does not create a wrapper component.\nFor this, you can just do:\nconst config = useStore(SearchConfigStore, ({ configurations: { searchesClusterConfig } }) => searchesClusterConfig);", "url": "https://github.com/Graylog2/graylog2-server/pull/9810#discussion_r544120553", "createdAt": "2020-12-16T08:55:31Z", "author": {"login": "dennisoelkers"}, "path": "graylog2-web-interface/src/views/components/widgets/EditWidgetFrame.tsx", "diffHunk": "@@ -124,4 +130,8 @@ EditWidgetFrame.propTypes = {\n   children: PropTypes.node.isRequired,\n };\n \n-export default EditWidgetFrame;\n+export default connect(EditWidgetFrame, {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "02720a9533ed8f931e73595c963320fb5df42fbc"}, "originalPosition": 57}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NDEyMjI5Mg==", "bodyText": "Is the time range limit really part of the form state? IMO it is a static setting that is not changed in the form, so it should not be part of its state. If we want to pass it through to other subcomponents, we could use a context instead.", "url": "https://github.com/Graylog2/graylog2-server/pull/9810#discussion_r544122292", "createdAt": "2020-12-16T08:57:59Z", "author": {"login": "dennisoelkers"}, "path": "graylog2-web-interface/src/views/components/widgets/EditWidgetFrame.tsx", "diffHunk": "@@ -93,7 +99,7 @@ const EditWidgetFrame = ({ children }: Props) => {\n            animation={false}\n            dialogComponentClass={EditWidgetDialog}\n            enforceFocus={false}>\n-      <SearchBarForm initialValues={{ limitDuration: 0, timerange, streams, queryString }}\n+      <SearchBarForm initialValues={{ limitDuration, timerange, streams, queryString }}", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "02720a9533ed8f931e73595c963320fb5df42fbc"}, "originalPosition": 48}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NDEyNDUyOQ==", "bodyText": "Do we need checks here if\n\nconfig or\nquery_time_range_limit are undefined?\n\nThe first would result in an exception, the second forces us to rely on moment.duration returning an empty duration if the argument is undefined. IMO we should make this more explicit like this:\n\n  \n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n              const limitDuration = moment.duration(config.query_time_range_limit).asSeconds();\n          \n          \n            \n              const limitDuration = config?.query_time_range_limit !== undefined ? moment.duration(config.query_time_range_limit).asSeconds() : 0;", "url": "https://github.com/Graylog2/graylog2-server/pull/9810#discussion_r544124529", "createdAt": "2020-12-16T09:01:23Z", "author": {"login": "dennisoelkers"}, "path": "graylog2-web-interface/src/views/components/widgets/EditWidgetFrame.tsx", "diffHunk": "@@ -83,6 +88,7 @@ const EditWidgetFrame = ({ children }: Props) => {\n     return <Spinner text=\"Loading widget ...\" />;\n   }\n \n+  const limitDuration = moment.duration(config.query_time_range_limit).asSeconds();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "02720a9533ed8f931e73595c963320fb5df42fbc"}, "originalPosition": 39}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "732943b50fdc968e3a57b973ed81f3ab9b8acc6b", "author": {"user": {"login": "kyleknighted", "name": "Kyle Knight"}}, "url": "https://github.com/Graylog2/graylog2-server/commit/732943b50fdc968e3a57b973ed81f3ab9b8acc6b", "committedDate": "2020-12-16T14:16:14Z", "message": "update connect HOC to useStore hook"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "23526e1da4367ad95f203108d9bc095a34e4c37d", "author": {"user": {"login": "kyleknighted", "name": "Kyle Knight"}}, "url": "https://github.com/Graylog2/graylog2-server/commit/23526e1da4367ad95f203108d9bc095a34e4c37d", "committedDate": "2020-12-16T14:32:34Z", "message": "Optional chaining in moment duration"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTU0NDc4NjI1", "url": "https://github.com/Graylog2/graylog2-server/pull/9810#pullrequestreview-554478625", "createdAt": "2020-12-17T10:40:14Z", "commit": {"oid": "23526e1da4367ad95f203108d9bc095a34e4c37d"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xN1QxMDo0MDoxNVrOIHvVlg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xN1QxMDo0MDoxNVrOIHvVlg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NDk4NjUxOA==", "bodyText": "IMO we can remove the explicit SearchesConfig type. It should be inferred from SearchConfigStore's type.", "url": "https://github.com/Graylog2/graylog2-server/pull/9810#discussion_r544986518", "createdAt": "2020-12-17T10:40:15Z", "author": {"login": "dennisoelkers"}, "path": "graylog2-web-interface/src/views/components/widgets/EditWidgetFrame.tsx", "diffHunk": "@@ -71,6 +75,8 @@ const onSubmit = (values, widget: Widget) => {\n };\n \n const EditWidgetFrame = ({ children }: Props) => {\n+  const config: SearchesConfig = useStore(SearchConfigStore, ({ searchesClusterConfig }) => searchesClusterConfig);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "23526e1da4367ad95f203108d9bc095a34e4c37d"}, "originalPosition": 23}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "44df1e0c4884c7578180e00a6d320e4a317a7c1c", "author": {"user": {"login": "kyleknighted", "name": "Kyle Knight"}}, "url": "https://github.com/Graylog2/graylog2-server/commit/44df1e0c4884c7578180e00a6d320e4a317a7c1c", "committedDate": "2021-01-11T17:44:46Z", "message": "Merge branch 'feature/DateTimeRange' into dtp_widget_limitDuration"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "96448f26c5fa738fe1c1207391157d6da75ffaa3", "author": {"user": {"login": "kyleknighted", "name": "Kyle Knight"}}, "url": "https://github.com/Graylog2/graylog2-server/commit/96448f26c5fa738fe1c1207391157d6da75ffaa3", "committedDate": "2021-01-11T17:52:46Z", "message": "remove the explicit SearchesConfig type"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "db6d247dd64a2e69d80f84a2aac9020460be4e65", "author": {"user": {"login": "kyleknighted", "name": "Kyle Knight"}}, "url": "https://github.com/Graylog2/graylog2-server/commit/db6d247dd64a2e69d80f84a2aac9020460be4e65", "committedDate": "2021-01-13T15:46:41Z", "message": "Merge branch 'feature/DateTimeRange' into dtp_widget_limitDuration"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "eba07428372ca627f15498ba326689ae0c381521", "author": {"user": {"login": "kyleknighted", "name": "Kyle Knight"}}, "url": "https://github.com/Graylog2/graylog2-server/commit/eba07428372ca627f15498ba326689ae0c381521", "committedDate": "2021-01-13T17:06:24Z", "message": "Updated tests and snapshots"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTY4NDAxMjQw", "url": "https://github.com/Graylog2/graylog2-server/pull/9810#pullrequestreview-568401240", "createdAt": "2021-01-14T16:23:52Z", "commit": {"oid": "eba07428372ca627f15498ba326689ae0c381521"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3247, "cost": 1, "resetAt": "2021-10-28T18:54:27Z"}}}