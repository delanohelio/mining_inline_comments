{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDQzNTQ2NDIz", "number": 8472, "reviewThreads": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wM1QxMDozODoyNlrOELNT_Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wM1QxMDo0MzoxM1rOELNYyQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjgwMTg3OTAxOnYy", "diffSide": "LEFT", "path": "graylog2-server/src/main/java/org/graylog/security/shares/EntitySharesService.java", "isResolved": false, "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wM1QxMDozODoyNlrOGssKaw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wM1QxMToxMDowOVrOGss8wA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0OTUxNDA5MQ==", "bodyText": "did we reach a decision regarding this?\nIn my book we were still filtering the current user..\nThis also needs to be handled by the frontend now. (If they don't send back your own grant, it will get deleted)", "url": "https://github.com/Graylog2/graylog2-server/pull/8472#discussion_r449514091", "createdAt": "2020-07-03T10:38:26Z", "author": {"login": "mpfz0r"}, "path": "graylog2-server/src/main/java/org/graylog/security/shares/EntitySharesService.java", "diffHunk": "@@ -98,32 +98,32 @@ public EntitySharePrepareResponse prepareShare(GRN ownedEntity,\n      * The grants in the request are created or, if they already exist, updated.\n      *\n      * @param ownedEntity the target entity for the updated grants\n-     * @param request     the request containing grantees and their roles\n+     * @param request     the request containing grantees and their capabilities\n      * @param sharingUser the user executing the request\n      */\n     public EntitySharePrepareResponse updateEntityShares(GRN ownedEntity, EntityShareRequest request, User sharingUser) {\n         final String userName = sharingUser.getName();\n-        final List<GrantDTO> existingGrants = grantService.getForTarget(ownedEntity, grnRegistry.newGRN(\"user\", sharingUser.getName()));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "56db48aa94652bb8e17beae0cc4df13dd9519373"}, "originalPosition": 50}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0OTUyMjMxOQ==", "bodyText": "Good point. I actually saw this as a bug. \ud83d\ude04 My understanding was, that we need to allow that a user can remove its own ownership for an entity. That means the sharing user needs to be in the active shares and shown in the list of users in the share dialog. If we exclude the current user from the active shares, we need a different way for allowing a user to remove its own ownership.", "url": "https://github.com/Graylog2/graylog2-server/pull/8472#discussion_r449522319", "createdAt": "2020-07-03T10:57:52Z", "author": {"login": "bernd"}, "path": "graylog2-server/src/main/java/org/graylog/security/shares/EntitySharesService.java", "diffHunk": "@@ -98,32 +98,32 @@ public EntitySharePrepareResponse prepareShare(GRN ownedEntity,\n      * The grants in the request are created or, if they already exist, updated.\n      *\n      * @param ownedEntity the target entity for the updated grants\n-     * @param request     the request containing grantees and their roles\n+     * @param request     the request containing grantees and their capabilities\n      * @param sharingUser the user executing the request\n      */\n     public EntitySharePrepareResponse updateEntityShares(GRN ownedEntity, EntityShareRequest request, User sharingUser) {\n         final String userName = sharingUser.getName();\n-        final List<GrantDTO> existingGrants = grantService.getForTarget(ownedEntity, grnRegistry.newGRN(\"user\", sharingUser.getName()));", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0OTUxNDA5MQ=="}, "originalCommit": {"oid": "56db48aa94652bb8e17beae0cc4df13dd9519373"}, "originalPosition": 50}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0OTUyNjk3Ng==", "bodyText": "From a UX perspective, I'd say this will clutter the UI, because it's a rare condition.\nBut we can keep the API generic. The frontend could still hide it..", "url": "https://github.com/Graylog2/graylog2-server/pull/8472#discussion_r449526976", "createdAt": "2020-07-03T11:10:09Z", "author": {"login": "mpfz0r"}, "path": "graylog2-server/src/main/java/org/graylog/security/shares/EntitySharesService.java", "diffHunk": "@@ -98,32 +98,32 @@ public EntitySharePrepareResponse prepareShare(GRN ownedEntity,\n      * The grants in the request are created or, if they already exist, updated.\n      *\n      * @param ownedEntity the target entity for the updated grants\n-     * @param request     the request containing grantees and their roles\n+     * @param request     the request containing grantees and their capabilities\n      * @param sharingUser the user executing the request\n      */\n     public EntitySharePrepareResponse updateEntityShares(GRN ownedEntity, EntityShareRequest request, User sharingUser) {\n         final String userName = sharingUser.getName();\n-        final List<GrantDTO> existingGrants = grantService.getForTarget(ownedEntity, grnRegistry.newGRN(\"user\", sharingUser.getName()));", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0OTUxNDA5MQ=="}, "originalCommit": {"oid": "56db48aa94652bb8e17beae0cc4df13dd9519373"}, "originalPosition": 50}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjgwMTg5MTI5OnYy", "diffSide": "RIGHT", "path": "graylog2-server/src/main/java/org/graylog2/utilities/GRNRegistry.java", "isResolved": false, "comments": {"totalCount": 6, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wM1QxMDo0MzoxM1rOGssSHQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wM1QxMToyNDoxMFrOGstSMQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0OTUxNjA2MQ==", "bodyText": "does this need a permissions prefix? capabilities will never be entities that are managed with permissions.\nSame goes for roles.\nI'm not even sure we should be using GRNs for that, actually..", "url": "https://github.com/Graylog2/graylog2-server/pull/8472#discussion_r449516061", "createdAt": "2020-07-03T10:43:13Z", "author": {"login": "mpfz0r"}, "path": "graylog2-server/src/main/java/org/graylog2/utilities/GRNRegistry.java", "diffHunk": "@@ -39,6 +39,7 @@\n     // TODO find a way to unify these\n     private static final ImmutableSet<GRNType> BUILTIN_TYPES = ImmutableSet.<GRNType>builder()\n             .add(GRNType.create(\"collection\", \"collections:\"))\n+            .add(GRNType.create(\"capability\", \"capabilities:\"))", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "56db48aa94652bb8e17beae0cc4df13dd9519373"}, "originalPosition": 4}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0OTUyMjMzNw==", "bodyText": "Not sure, but I thought it also didn't hurt at the moment. I also don't see a reason not to use GRNs for that. What's your thinking behind that?", "url": "https://github.com/Graylog2/graylog2-server/pull/8472#discussion_r449522337", "createdAt": "2020-07-03T10:57:55Z", "author": {"login": "bernd"}, "path": "graylog2-server/src/main/java/org/graylog2/utilities/GRNRegistry.java", "diffHunk": "@@ -39,6 +39,7 @@\n     // TODO find a way to unify these\n     private static final ImmutableSet<GRNType> BUILTIN_TYPES = ImmutableSet.<GRNType>builder()\n             .add(GRNType.create(\"collection\", \"collections:\"))\n+            .add(GRNType.create(\"capability\", \"capabilities:\"))", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0OTUxNjA2MQ=="}, "originalCommit": {"oid": "56db48aa94652bb8e17beae0cc4df13dd9519373"}, "originalPosition": 4}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0OTUyMzc1Mw==", "bodyText": "To clarify: My thinking was, that we might need to allow modification of capabilities (e.g. adding new permissions from plugins).\nNow that I spelled it out... Extending capabilities will probably an internal thing without user interaction, so we also don't need permissions for that. \ud83d\ude04", "url": "https://github.com/Graylog2/graylog2-server/pull/8472#discussion_r449523753", "createdAt": "2020-07-03T11:01:23Z", "author": {"login": "bernd"}, "path": "graylog2-server/src/main/java/org/graylog2/utilities/GRNRegistry.java", "diffHunk": "@@ -39,6 +39,7 @@\n     // TODO find a way to unify these\n     private static final ImmutableSet<GRNType> BUILTIN_TYPES = ImmutableSet.<GRNType>builder()\n             .add(GRNType.create(\"collection\", \"collections:\"))\n+            .add(GRNType.create(\"capability\", \"capabilities:\"))", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0OTUxNjA2MQ=="}, "originalCommit": {"oid": "56db48aa94652bb8e17beae0cc4df13dd9519373"}, "originalPosition": 4}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0OTUyODcyMw==", "bodyText": "Not sure, but I thought it also didn't hurt at the moment. I also don't see a reason not to use GRNs for that. What's your thinking behind that?\n\nJust for simplicity. Currently we could be having three easily readable constants in the Grants table: View, Manage, Own", "url": "https://github.com/Graylog2/graylog2-server/pull/8472#discussion_r449528723", "createdAt": "2020-07-03T11:14:47Z", "author": {"login": "mpfz0r"}, "path": "graylog2-server/src/main/java/org/graylog2/utilities/GRNRegistry.java", "diffHunk": "@@ -39,6 +39,7 @@\n     // TODO find a way to unify these\n     private static final ImmutableSet<GRNType> BUILTIN_TYPES = ImmutableSet.<GRNType>builder()\n             .add(GRNType.create(\"collection\", \"collections:\"))\n+            .add(GRNType.create(\"capability\", \"capabilities:\"))", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0OTUxNjA2MQ=="}, "originalCommit": {"oid": "56db48aa94652bb8e17beae0cc4df13dd9519373"}, "originalPosition": 4}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0OTUyOTYyMQ==", "bodyText": "To clarify: My thinking was, that we might need to allow modification of capabilities (e.g. adding new permissions from plugins).\nNow that I spelled it out... Extending capabilities will probably an internal thing without user interaction, so we also don't need permissions for that. smile\n\nhaving capabilities to modify capabilities \ud83d\ude48  reaching tourning completeness :-D", "url": "https://github.com/Graylog2/graylog2-server/pull/8472#discussion_r449529621", "createdAt": "2020-07-03T11:16:57Z", "author": {"login": "mpfz0r"}, "path": "graylog2-server/src/main/java/org/graylog2/utilities/GRNRegistry.java", "diffHunk": "@@ -39,6 +39,7 @@\n     // TODO find a way to unify these\n     private static final ImmutableSet<GRNType> BUILTIN_TYPES = ImmutableSet.<GRNType>builder()\n             .add(GRNType.create(\"collection\", \"collections:\"))\n+            .add(GRNType.create(\"capability\", \"capabilities:\"))", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0OTUxNjA2MQ=="}, "originalCommit": {"oid": "56db48aa94652bb8e17beae0cc4df13dd9519373"}, "originalPosition": 4}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0OTUzMjQ2NQ==", "bodyText": "Just for simplicity. Currently we could be having three easily readable constants in the Grants table: View, Manage, Own\n\nOkay, sounds good. So I would update the code to only use simple keywords view, manage and own for the capabilities. If we ever need to use GRNs, it should be a simple migration. \ud83d\udc4d", "url": "https://github.com/Graylog2/graylog2-server/pull/8472#discussion_r449532465", "createdAt": "2020-07-03T11:24:10Z", "author": {"login": "bernd"}, "path": "graylog2-server/src/main/java/org/graylog2/utilities/GRNRegistry.java", "diffHunk": "@@ -39,6 +39,7 @@\n     // TODO find a way to unify these\n     private static final ImmutableSet<GRNType> BUILTIN_TYPES = ImmutableSet.<GRNType>builder()\n             .add(GRNType.create(\"collection\", \"collections:\"))\n+            .add(GRNType.create(\"capability\", \"capabilities:\"))", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0OTUxNjA2MQ=="}, "originalCommit": {"oid": "56db48aa94652bb8e17beae0cc4df13dd9519373"}, "originalPosition": 4}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4101, "cost": 1, "resetAt": "2021-11-12T20:28:25Z"}}}