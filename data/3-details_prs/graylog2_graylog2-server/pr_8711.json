{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDYzOTM0NjQy", "number": 8711, "title": "Implement new roles overview", "bodyText": "Including route, page, and nav item\n\nWe need to merge #8705 + the related enterprise PR first.\n/jenkins-pr-deps Graylog2/graylog-plugin-enterprise#1569", "createdAt": "2020-08-06T10:21:41Z", "url": "https://github.com/Graylog2/graylog2-server/pull/8711", "merged": true, "mergeCommit": {"oid": "0f2cfeba9721ded4d819e9e0321b0bb18c737f78"}, "closed": true, "closedAt": "2020-08-13T08:04:18Z", "author": {"login": "linuspahl"}, "timelineItems": {"totalCount": 16, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABc8OKXiAFqTQ2MjQzNDAwMg==", "endCursor": "Y3Vyc29yOnYyOpPPAAABc-bZDHgFqTQ2NjUzMjI0MQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDYyNDM0MDAy", "url": "https://github.com/Graylog2/graylog2-server/pull/8711#pullrequestreview-462434002", "createdAt": "2020-08-06T11:31:32Z", "commit": {"oid": "d18610e6cfd01791bab7245530d04fa3648a889b"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0wNlQxMTozMTozMlrOG8vnKQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0wNlQxMTozMTozMlrOG8vnKQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NjM0NzgxNw==", "bodyText": "The type for the response string[] is based on deleteUser. When the api route exists, we may need to adjust this.", "url": "https://github.com/Graylog2/graylog2-server/pull/8711#discussion_r466347817", "createdAt": "2020-08-06T11:31:32Z", "author": {"login": "linuspahl"}, "path": "graylog2-web-interface/src/actions/roles/AuthzRolesActions.js", "diffHunk": "@@ -6,6 +6,7 @@ import { singletonActions } from 'views/logic/singleton';\n import type { RefluxActions } from 'stores/StoreTypes';\n \n type AuthzRolesActionsType = RefluxActions<{\n+  deleteRole: (roleId: string) => Promise<string[]>,", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d18610e6cfd01791bab7245530d04fa3648a889b"}, "originalPosition": 4}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "c3e970ce852caecb6c19f65fb559d88397a309e4", "author": {"user": {"login": "linuspahl", "name": "Linus Pahl"}}, "url": "https://github.com/Graylog2/graylog2-server/commit/c3e970ce852caecb6c19f65fb559d88397a309e4", "committedDate": "2020-08-06T12:28:30Z", "message": "Rename ROLES routes key"}, "afterCommit": {"oid": "2b31c76dfbdd2dd28680ab22a3cffbc6bd6e1f6a", "author": {"user": {"login": "linuspahl", "name": "Linus Pahl"}}, "url": "https://github.com/Graylog2/graylog2-server/commit/2b31c76dfbdd2dd28680ab22a3cffbc6bd6e1f6a", "committedDate": "2020-08-07T08:34:53Z", "message": "Rename ROLES routes key"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDYzMjc3OTE1", "url": "https://github.com/Graylog2/graylog2-server/pull/8711#pullrequestreview-463277915", "createdAt": "2020-08-07T12:39:15Z", "commit": {"oid": "2b31c76dfbdd2dd28680ab22a3cffbc6bd6e1f6a"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0wN1QxMjozOToxNVrOG9YRBg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0wN1QxMjozOToxNVrOG9YRBg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NzAxMzg5NA==", "bodyText": "I will update this in a follow-up PR", "url": "https://github.com/Graylog2/graylog2-server/pull/8711#discussion_r467013894", "createdAt": "2020-08-07T12:39:15Z", "author": {"login": "linuspahl"}, "path": "graylog2-web-interface/src/components/roles/RolesOverview/ActionsCell.jsx", "diffHunk": "@@ -0,0 +1,71 @@\n+// @flow strict\n+import * as React from 'react';\n+import styled from 'styled-components';\n+import { LinkContainer } from 'react-router-bootstrap';\n+\n+import UserNotification from 'util/UserNotification';\n+import { AuthzRolesActions } from 'stores/roles/AuthzRolesStore';\n+import Routes from 'routing/Routes';\n+import Role from 'logic/roles/Role';\n+import { Button } from 'components/graylog';\n+import { IfPermitted } from 'components/common';\n+\n+type Props = {\n+  readOnly: $PropertyType<Role, 'readOnly'>,\n+  roleId: $PropertyType<Role, 'id'>,\n+  roleName: $PropertyType<Role, 'name'>,\n+};\n+\n+const ActtionsWrapper = styled.div`\n+  display: flex;\n+  justify-content: flex-end;\n+`;\n+\n+const ActionsCell = ({ roleId, roleName, readOnly }: Props) => {\n+  const _deleteRole = () => {\n+    // eslint-disable-next-line no-alert\n+    if (window.confirm(`Do you really want to delete role ${roleName}?`)) {\n+      AuthzRolesActions.deleteRole(roleId).then(() => {\n+        UserNotification.success(`Role \"${roleName}\" was deleted successfully`);\n+      }, () => {\n+        UserNotification.error(`There was an error deleting the role \"${roleName}\"`);\n+      });\n+\n+      // AuthzRolesActions.getMembers(roleName).then((membership) => {\n+      //   if (membership.users.length !== 0) {\n+      //     UserNotification.error(`Cannot delete role ${roleName}. It is still assigned to ${membership.users.length} users.`);\n+      //   } else {\n+      //     AuthzRolesActions.deleteRole(roleId).then(() => {\n+      //       UserNotification.success(`Role \"${roleName}\" was deleted successfully`);\n+      //     }, () => {\n+      //       UserNotification.error(`There was an error deleting the role \"${roleName}\"`);\n+      //     });\n+      //   }\n+      // });", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "2b31c76dfbdd2dd28680ab22a3cffbc6bd6e1f6a"}, "originalPosition": 44}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDY0MDEzOTEy", "url": "https://github.com/Graylog2/graylog2-server/pull/8711#pullrequestreview-464013912", "createdAt": "2020-08-10T07:42:55Z", "commit": {"oid": "2b31c76dfbdd2dd28680ab22a3cffbc6bd6e1f6a"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xMFQwNzo0Mjo1NlrOG-ERmg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xMFQwNzo0Mjo1NlrOG-ERmg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NzczNDkzOA==", "bodyText": ".edit() should take the id of the role and not the role name", "url": "https://github.com/Graylog2/graylog2-server/pull/8711#discussion_r467734938", "createdAt": "2020-08-10T07:42:56Z", "author": {"login": "kmerz"}, "path": "graylog2-web-interface/src/components/roles/RolesOverview/ActionsCell.jsx", "diffHunk": "@@ -0,0 +1,71 @@\n+// @flow strict\n+import * as React from 'react';\n+import styled from 'styled-components';\n+import { LinkContainer } from 'react-router-bootstrap';\n+\n+import UserNotification from 'util/UserNotification';\n+import { AuthzRolesActions } from 'stores/roles/AuthzRolesStore';\n+import Routes from 'routing/Routes';\n+import Role from 'logic/roles/Role';\n+import { Button } from 'components/graylog';\n+import { IfPermitted } from 'components/common';\n+\n+type Props = {\n+  readOnly: $PropertyType<Role, 'readOnly'>,\n+  roleId: $PropertyType<Role, 'id'>,\n+  roleName: $PropertyType<Role, 'name'>,\n+};\n+\n+const ActtionsWrapper = styled.div`\n+  display: flex;\n+  justify-content: flex-end;\n+`;\n+\n+const ActionsCell = ({ roleId, roleName, readOnly }: Props) => {\n+  const _deleteRole = () => {\n+    // eslint-disable-next-line no-alert\n+    if (window.confirm(`Do you really want to delete role ${roleName}?`)) {\n+      AuthzRolesActions.deleteRole(roleId).then(() => {\n+        UserNotification.success(`Role \"${roleName}\" was deleted successfully`);\n+      }, () => {\n+        UserNotification.error(`There was an error deleting the role \"${roleName}\"`);\n+      });\n+\n+      // AuthzRolesActions.getMembers(roleName).then((membership) => {\n+      //   if (membership.users.length !== 0) {\n+      //     UserNotification.error(`Cannot delete role ${roleName}. It is still assigned to ${membership.users.length} users.`);\n+      //   } else {\n+      //     AuthzRolesActions.deleteRole(roleId).then(() => {\n+      //       UserNotification.success(`Role \"${roleName}\" was deleted successfully`);\n+      //     }, () => {\n+      //       UserNotification.error(`There was an error deleting the role \"${roleName}\"`);\n+      //     });\n+      //   }\n+      // });\n+    }\n+  };\n+\n+  return (\n+    <td>\n+      <ActtionsWrapper>\n+        <IfPermitted permissions={[`roles:edit:${roleName}`]}>\n+          <LinkContainer to={Routes.SYSTEM.AUTHZROLES.edit(encodeURIComponent(roleName))}>", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "2b31c76dfbdd2dd28680ab22a3cffbc6bd6e1f6a"}, "originalPosition": 52}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "bbf0136faaa4c09c0a4f21367c84c9dd4540e0db", "author": {"user": {"login": "linuspahl", "name": "Linus Pahl"}}, "url": "https://github.com/Graylog2/graylog2-server/commit/bbf0136faaa4c09c0a4f21367c84c9dd4540e0db", "committedDate": "2020-08-10T07:51:37Z", "message": "Fix permissions check for role delete and edit button"}, "afterCommit": {"oid": "de4a535d23eab34f0026ce40af2e4534da6f94c0", "author": {"user": {"login": "linuspahl", "name": "Linus Pahl"}}, "url": "https://github.com/Graylog2/graylog2-server/commit/de4a535d23eab34f0026ce40af2e4534da6f94c0", "committedDate": "2020-08-10T07:52:20Z", "message": "Fix permissions check for role delete and edit button"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "de4a535d23eab34f0026ce40af2e4534da6f94c0", "author": {"user": {"login": "linuspahl", "name": "Linus Pahl"}}, "url": "https://github.com/Graylog2/graylog2-server/commit/de4a535d23eab34f0026ce40af2e4534da6f94c0", "committedDate": "2020-08-10T07:52:20Z", "message": "Fix permissions check for role delete and edit button"}, "afterCommit": {"oid": "a7b5cad803bb134e0dcce75a38171dd568ba9094", "author": {"user": {"login": "linuspahl", "name": "Linus Pahl"}}, "url": "https://github.com/Graylog2/graylog2-server/commit/a7b5cad803bb134e0dcce75a38171dd568ba9094", "committedDate": "2020-08-12T07:14:58Z", "message": "Unify RolesOverview pagination handling"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a7dc777e28ad60aa11c977072b662390584e3916", "author": {"user": {"login": "linuspahl", "name": "Linus Pahl"}}, "url": "https://github.com/Graylog2/graylog2-server/commit/a7dc777e28ad60aa11c977072b662390584e3916", "committedDate": "2020-08-12T14:48:05Z", "message": "Add RolesOverview\n\n* Including route, page, and nav item"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f69568c2be08fa76383c70afab1a5e81ad58d4d6", "author": {"user": {"login": "linuspahl", "name": "Linus Pahl"}}, "url": "https://github.com/Graylog2/graylog2-server/commit/f69568c2be08fa76383c70afab1a5e81ad58d4d6", "committedDate": "2020-08-12T14:48:05Z", "message": "Extract RolesQueryHelper"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "aa51d2da67de2245113ee43e38a9ce6fac9e5081", "author": {"user": {"login": "linuspahl", "name": "Linus Pahl"}}, "url": "https://github.com/Graylog2/graylog2-server/commit/aa51d2da67de2245113ee43e38a9ce6fac9e5081", "committedDate": "2020-08-12T14:48:05Z", "message": "Add route for role edit"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "0aeccdbb6ea2bb995011b355aea0b61f969d5573", "author": {"user": {"login": "linuspahl", "name": "Linus Pahl"}}, "url": "https://github.com/Graylog2/graylog2-server/commit/0aeccdbb6ea2bb995011b355aea0b61f969d5573", "committedDate": "2020-08-12T14:48:05Z", "message": "Fix SystemMenu test"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "98221c0cf1e6ddf263d7dc00f41f597d65261ae8", "author": {"user": {"login": "linuspahl", "name": "Linus Pahl"}}, "url": "https://github.com/Graylog2/graylog2-server/commit/98221c0cf1e6ddf263d7dc00f41f597d65261ae8", "committedDate": "2020-08-12T14:48:05Z", "message": "Rename ROLES routes key"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "675f0518fdb130841b31825068c710f7edee7eb8", "author": {"user": {"login": "linuspahl", "name": "Linus Pahl"}}, "url": "https://github.com/Graylog2/graylog2-server/commit/675f0518fdb130841b31825068c710f7edee7eb8", "committedDate": "2020-08-12T14:48:05Z", "message": "Fix permissions check for role delete and edit button"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "af5471621cfe4bf21c8ac8461d6094c9637f85e3", "author": {"user": {"login": "linuspahl", "name": "Linus Pahl"}}, "url": "https://github.com/Graylog2/graylog2-server/commit/af5471621cfe4bf21c8ac8461d6094c9637f85e3", "committedDate": "2020-08-12T14:48:05Z", "message": "Unify RolesOverview pagination handling"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "97e861b27ea66bf86ef06df2c8f50b9c56734263", "author": {"user": {"login": "linuspahl", "name": "Linus Pahl"}}, "url": "https://github.com/Graylog2/graylog2-server/commit/97e861b27ea66bf86ef06df2c8f50b9c56734263", "committedDate": "2020-08-12T14:54:54Z", "message": "Fix role edit and delete permission check and edit role link"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "a7b5cad803bb134e0dcce75a38171dd568ba9094", "author": {"user": {"login": "linuspahl", "name": "Linus Pahl"}}, "url": "https://github.com/Graylog2/graylog2-server/commit/a7b5cad803bb134e0dcce75a38171dd568ba9094", "committedDate": "2020-08-12T07:14:58Z", "message": "Unify RolesOverview pagination handling"}, "afterCommit": {"oid": "97e861b27ea66bf86ef06df2c8f50b9c56734263", "author": {"user": {"login": "linuspahl", "name": "Linus Pahl"}}, "url": "https://github.com/Graylog2/graylog2-server/commit/97e861b27ea66bf86ef06df2c8f50b9c56734263", "committedDate": "2020-08-12T14:54:54Z", "message": "Fix role edit and delete permission check and edit role link"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDY2NTMyMjQx", "url": "https://github.com/Graylog2/graylog2-server/pull/8711#pullrequestreview-466532241", "createdAt": "2020-08-13T08:04:11Z", "commit": {"oid": "97e861b27ea66bf86ef06df2c8f50b9c56734263"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2932, "cost": 1, "resetAt": "2021-10-28T18:54:27Z"}}}