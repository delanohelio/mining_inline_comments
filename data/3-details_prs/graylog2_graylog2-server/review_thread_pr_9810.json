{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTQwNjkxMzk3", "number": 9810, "reviewThreads": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xNlQwODo1NTozMVrOFGE_Iw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xN1QxMDo0MDoxNVrOFGpAQg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzQxOTE3NDc1OnYy", "diffSide": "RIGHT", "path": "graylog2-web-interface/src/views/components/widgets/EditWidgetFrame.tsx", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xNlQwODo1NTozMVrOIG6e6Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xNlQxNDoxNjo1NFrOIHHbKQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NDEyMDU1Mw==", "bodyText": "I would suggest using connect only for class-based components and use useStore for function components. The benefit is the simpler API and it does not create a wrapper component.\nFor this, you can just do:\nconst config = useStore(SearchConfigStore, ({ configurations: { searchesClusterConfig } }) => searchesClusterConfig);", "url": "https://github.com/Graylog2/graylog2-server/pull/9810#discussion_r544120553", "createdAt": "2020-12-16T08:55:31Z", "author": {"login": "dennisoelkers"}, "path": "graylog2-web-interface/src/views/components/widgets/EditWidgetFrame.tsx", "diffHunk": "@@ -124,4 +130,8 @@ EditWidgetFrame.propTypes = {\n   children: PropTypes.node.isRequired,\n };\n \n-export default EditWidgetFrame;\n+export default connect(EditWidgetFrame, {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "02720a9533ed8f931e73595c963320fb5df42fbc"}, "originalPosition": 57}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NDMzMjU4NQ==", "bodyText": "Great suggestion! Had to modify slightly, but thanks for the reminder on this hook!", "url": "https://github.com/Graylog2/graylog2-server/pull/9810#discussion_r544332585", "createdAt": "2020-12-16T14:16:54Z", "author": {"login": "kyleknighted"}, "path": "graylog2-web-interface/src/views/components/widgets/EditWidgetFrame.tsx", "diffHunk": "@@ -124,4 +130,8 @@ EditWidgetFrame.propTypes = {\n   children: PropTypes.node.isRequired,\n };\n \n-export default EditWidgetFrame;\n+export default connect(EditWidgetFrame, {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NDEyMDU1Mw=="}, "originalCommit": {"oid": "02720a9533ed8f931e73595c963320fb5df42fbc"}, "originalPosition": 57}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzQxOTE4NjM2OnYy", "diffSide": "RIGHT", "path": "graylog2-web-interface/src/views/components/widgets/EditWidgetFrame.tsx", "isResolved": false, "comments": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xNlQwODo1Nzo1OVrOIG6ltA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMS0xMlQxODozMzo0N1rOISO3-A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NDEyMjI5Mg==", "bodyText": "Is the time range limit really part of the form state? IMO it is a static setting that is not changed in the form, so it should not be part of its state. If we want to pass it through to other subcomponents, we could use a context instead.", "url": "https://github.com/Graylog2/graylog2-server/pull/9810#discussion_r544122292", "createdAt": "2020-12-16T08:57:59Z", "author": {"login": "dennisoelkers"}, "path": "graylog2-web-interface/src/views/components/widgets/EditWidgetFrame.tsx", "diffHunk": "@@ -93,7 +99,7 @@ const EditWidgetFrame = ({ children }: Props) => {\n            animation={false}\n            dialogComponentClass={EditWidgetDialog}\n            enforceFocus={false}>\n-      <SearchBarForm initialValues={{ limitDuration: 0, timerange, streams, queryString }}\n+      <SearchBarForm initialValues={{ limitDuration, timerange, streams, queryString }}", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "02720a9533ed8f931e73595c963320fb5df42fbc"}, "originalPosition": 48}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NDMzMzkyNA==", "bodyText": "It's not really part of the entire state, and I agree having a wrapping context may be better, but this is already written in such a way across Search and Dashboard, so it would require updating in a few places. Maybe this is something we can include as a follow-up later or do you feel it is important enough to rework all of them?", "url": "https://github.com/Graylog2/graylog2-server/pull/9810#discussion_r544333924", "createdAt": "2020-12-16T14:18:37Z", "author": {"login": "kyleknighted"}, "path": "graylog2-web-interface/src/views/components/widgets/EditWidgetFrame.tsx", "diffHunk": "@@ -93,7 +99,7 @@ const EditWidgetFrame = ({ children }: Props) => {\n            animation={false}\n            dialogComponentClass={EditWidgetDialog}\n            enforceFocus={false}>\n-      <SearchBarForm initialValues={{ limitDuration: 0, timerange, streams, queryString }}\n+      <SearchBarForm initialValues={{ limitDuration, timerange, streams, queryString }}", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NDEyMjI5Mg=="}, "originalCommit": {"oid": "02720a9533ed8f931e73595c963320fb5df42fbc"}, "originalPosition": 48}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NDk4NTI0OQ==", "bodyText": "If you keep track of it and rework it before the picker is merged into master, then this is fine.", "url": "https://github.com/Graylog2/graylog2-server/pull/9810#discussion_r544985249", "createdAt": "2020-12-17T10:38:20Z", "author": {"login": "dennisoelkers"}, "path": "graylog2-web-interface/src/views/components/widgets/EditWidgetFrame.tsx", "diffHunk": "@@ -93,7 +99,7 @@ const EditWidgetFrame = ({ children }: Props) => {\n            animation={false}\n            dialogComponentClass={EditWidgetDialog}\n            enforceFocus={false}>\n-      <SearchBarForm initialValues={{ limitDuration: 0, timerange, streams, queryString }}\n+      <SearchBarForm initialValues={{ limitDuration, timerange, streams, queryString }}", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NDEyMjI5Mg=="}, "originalCommit": {"oid": "02720a9533ed8f931e73595c963320fb5df42fbc"}, "originalPosition": 48}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1NTk4ODk4NA==", "bodyText": "This conversation was followed-up in #9893", "url": "https://github.com/Graylog2/graylog2-server/pull/9810#discussion_r555988984", "createdAt": "2021-01-12T18:33:47Z", "author": {"login": "kyleknighted"}, "path": "graylog2-web-interface/src/views/components/widgets/EditWidgetFrame.tsx", "diffHunk": "@@ -93,7 +99,7 @@ const EditWidgetFrame = ({ children }: Props) => {\n            animation={false}\n            dialogComponentClass={EditWidgetDialog}\n            enforceFocus={false}>\n-      <SearchBarForm initialValues={{ limitDuration: 0, timerange, streams, queryString }}\n+      <SearchBarForm initialValues={{ limitDuration, timerange, streams, queryString }}", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NDEyMjI5Mg=="}, "originalCommit": {"oid": "02720a9533ed8f931e73595c963320fb5df42fbc"}, "originalPosition": 48}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzQxOTIwMTA3OnYy", "diffSide": "RIGHT", "path": "graylog2-web-interface/src/views/components/widgets/EditWidgetFrame.tsx", "isResolved": false, "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xNlQwOTowMToyM1rOIG6ucQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xN1QxMDozOToxN1rOIHvTBg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NDEyNDUyOQ==", "bodyText": "Do we need checks here if\n\nconfig or\nquery_time_range_limit are undefined?\n\nThe first would result in an exception, the second forces us to rely on moment.duration returning an empty duration if the argument is undefined. IMO we should make this more explicit like this:\n\n  \n    \n  \n    \n\n  \n  This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters. Learn more about bidirectional Unicode characters\n\n\n  \n\n\n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n              const limitDuration = moment.duration(config.query_time_range_limit).asSeconds();\n          \n          \n            \n              const limitDuration = config?.query_time_range_limit !== undefined ? moment.duration(config.query_time_range_limit).asSeconds() : 0;", "url": "https://github.com/Graylog2/graylog2-server/pull/9810#discussion_r544124529", "createdAt": "2020-12-16T09:01:23Z", "author": {"login": "dennisoelkers"}, "path": "graylog2-web-interface/src/views/components/widgets/EditWidgetFrame.tsx", "diffHunk": "@@ -83,6 +88,7 @@ const EditWidgetFrame = ({ children }: Props) => {\n     return <Spinner text=\"Loading widget ...\" />;\n   }\n \n+  const limitDuration = moment.duration(config.query_time_range_limit).asSeconds();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "02720a9533ed8f931e73595c963320fb5df42fbc"}, "originalPosition": 39}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NDM1MzUyMg==", "bodyText": "moment.duration(undefined | null) will return 0.\nIf config does not return Search Config, then we are already having issues everywhere else with searching because we will not have the necessary data.\nIf query_time_range_limit also does not return something, then we should define this as a default in the SearchConfigStore to always return 0 if it does not exist.\nI do agree that there should be some checking though so added the optional chaining to the object\nconst limitDuration = moment.duration(config?.query_time_range_limit).asSeconds();\nMaybe something like const limitDuration = moment.duration(config?.query_time_range_limit ?? 0).asSeconds(); would be good?", "url": "https://github.com/Graylog2/graylog2-server/pull/9810#discussion_r544353522", "createdAt": "2020-12-16T14:43:31Z", "author": {"login": "kyleknighted"}, "path": "graylog2-web-interface/src/views/components/widgets/EditWidgetFrame.tsx", "diffHunk": "@@ -83,6 +88,7 @@ const EditWidgetFrame = ({ children }: Props) => {\n     return <Spinner text=\"Loading widget ...\" />;\n   }\n \n+  const limitDuration = moment.duration(config.query_time_range_limit).asSeconds();", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NDEyNDUyOQ=="}, "originalCommit": {"oid": "02720a9533ed8f931e73595c963320fb5df42fbc"}, "originalPosition": 39}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NDk4NTg2Mg==", "bodyText": "The last option would be okay for me too.", "url": "https://github.com/Graylog2/graylog2-server/pull/9810#discussion_r544985862", "createdAt": "2020-12-17T10:39:17Z", "author": {"login": "dennisoelkers"}, "path": "graylog2-web-interface/src/views/components/widgets/EditWidgetFrame.tsx", "diffHunk": "@@ -83,6 +88,7 @@ const EditWidgetFrame = ({ children }: Props) => {\n     return <Spinner text=\"Loading widget ...\" />;\n   }\n \n+  const limitDuration = moment.duration(config.query_time_range_limit).asSeconds();", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NDEyNDUyOQ=="}, "originalCommit": {"oid": "02720a9533ed8f931e73595c963320fb5df42fbc"}, "originalPosition": 39}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzQyNTA3NTg2OnYy", "diffSide": "RIGHT", "path": "graylog2-web-interface/src/views/components/widgets/EditWidgetFrame.tsx", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xN1QxMDo0MDoxNVrOIHvVlg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMS0xMVQxNzo1MzowOVrOIRgvvw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NDk4NjUxOA==", "bodyText": "IMO we can remove the explicit SearchesConfig type. It should be inferred from SearchConfigStore's type.", "url": "https://github.com/Graylog2/graylog2-server/pull/9810#discussion_r544986518", "createdAt": "2020-12-17T10:40:15Z", "author": {"login": "dennisoelkers"}, "path": "graylog2-web-interface/src/views/components/widgets/EditWidgetFrame.tsx", "diffHunk": "@@ -71,6 +75,8 @@ const onSubmit = (values, widget: Widget) => {\n };\n \n const EditWidgetFrame = ({ children }: Props) => {\n+  const config: SearchesConfig = useStore(SearchConfigStore, ({ searchesClusterConfig }) => searchesClusterConfig);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "23526e1da4367ad95f203108d9bc095a34e4c37d"}, "originalPosition": 23}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1NTIzMzIxNQ==", "bodyText": "@dennisoelkers Updated!", "url": "https://github.com/Graylog2/graylog2-server/pull/9810#discussion_r555233215", "createdAt": "2021-01-11T17:53:09Z", "author": {"login": "kyleknighted"}, "path": "graylog2-web-interface/src/views/components/widgets/EditWidgetFrame.tsx", "diffHunk": "@@ -71,6 +75,8 @@ const onSubmit = (values, widget: Widget) => {\n };\n \n const EditWidgetFrame = ({ children }: Props) => {\n+  const config: SearchesConfig = useStore(SearchConfigStore, ({ searchesClusterConfig }) => searchesClusterConfig);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NDk4NjUxOA=="}, "originalCommit": {"oid": "23526e1da4367ad95f203108d9bc095a34e4c37d"}, "originalPosition": 23}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4307, "cost": 1, "resetAt": "2021-11-12T20:28:25Z"}}}