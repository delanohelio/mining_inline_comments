{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDcxNzAyMzEy", "number": 8848, "reviewThreads": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yNFQwNzo1MDo1MFrOEbckSg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yNFQxMzowMDozM1rOEbjh2A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjk3MjE1MDUwOnYy", "diffSide": "RIGHT", "path": "graylog2-web-interface/src/views/components/searchbar/QueryInput.jsx", "isResolved": false, "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yNFQwNzo1MDo1MFrOHFYbnA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yNlQwNzo0NzowNlrOHG_8nQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NTQwNTIxMg==", "bodyText": "Initially I wrapped QueryInput with withTheme,  but it results in a flow error I can't fix easily:\nCannot call withPluginEntities because property completers is missing in object type [1] in the first argument.\n[prop-missing]\n\n     src/views/components/searchbar/QueryInput.jsx\n     105\u2502   placeholder: '',\n     106\u2502 };\n     107\u2502\n     108\u2502 export default withPluginEntities(withTheme(QueryInput), { completers: 'views.completers' });\n     109\u2502\n\n     flow-typed/npm/styled-components_v4.x.x.js\n [1] 175\u2502   declare export function withTheme<Theme, Config: {...}, Instance>(Component: React$AbstractComponent<Config, Instance>): React$AbstractComponent<$Diff<Config, ThemeProps<Theme | void>>, Instance>\n\nI prefer the above structure and we do it similar in comparable cases where we use withPluginEntities  (e.g. in combination with withRouter), but I see no other disadvantage regarding the current structure.", "url": "https://github.com/Graylog2/graylog2-server/pull/8848#discussion_r475405212", "createdAt": "2020-08-24T07:50:50Z", "author": {"login": "linuspahl"}, "path": "graylog2-web-interface/src/views/components/searchbar/QueryInput.jsx", "diffHunk": "@@ -104,4 +104,4 @@ QueryInput.defaultProps = {\n   placeholder: '',\n };\n \n-export default withPluginEntities(QueryInput, { completers: 'views.completers' });\n+export default withTheme(withPluginEntities(QueryInput, { completers: 'views.completers' }));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ac178653f875f56ea326e847808824303252411d"}, "originalPosition": 60}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NTQyMzc3MA==", "bodyText": "It is fine this way, imo. It should work both ways around though, so I took a quick look into the issue. There are two things:\na) we are still using styled-components for v4. They do not work with functional components (like QueryInput is), so the type inference for the component does not work. I was able to force it by passing explicit types for the generics like this:\nwithPluginEntities(withTheme<ThemeInterface, Props, typeof undefined>(QueryInput), { completers: 'views.completers' })\n\nb) updating the typedefs to v5 fixed this issue and made it work with withPluginEntities(withTheme(QueryInput) out of the box. Can you do the typedef update either in this or a separate PR?\nHope this helps.", "url": "https://github.com/Graylog2/graylog2-server/pull/8848#discussion_r475423770", "createdAt": "2020-08-24T08:26:20Z", "author": {"login": "dennisoelkers"}, "path": "graylog2-web-interface/src/views/components/searchbar/QueryInput.jsx", "diffHunk": "@@ -104,4 +104,4 @@ QueryInput.defaultProps = {\n   placeholder: '',\n };\n \n-export default withPluginEntities(QueryInput, { completers: 'views.completers' });\n+export default withTheme(withPluginEntities(QueryInput, { completers: 'views.completers' }));", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NTQwNTIxMg=="}, "originalCommit": {"oid": "ac178653f875f56ea326e847808824303252411d"}, "originalPosition": 60}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NzEwMTIxMw==", "bodyText": "Thanks again for the feedback, I've tested solution b) locally by using #8866 and I am still receiving the flow type error with the styled-components v5 interface definition:\nError \u2508\u2508\u2508\u2508\u2508\u2508\u2508\u2508\u2508\u2508\u2508\u2508\u2508\u2508\u2508\u2508\u2508\u2508\u2508\u2508\u2508\u2508\u2508\u2508\u2508\u2508\u2508\u2508\u2508\u2508\u2508\u2508\u2508\u2508\u2508\u2508\u2508\u2508\u2508\u2508\u2508\u2508\u2508\u2508\u2508\u2508\u2508\u2508\u2508\u2508\u2508\u2508\u2508\u2508\u2508\u2508\u2508\u2508\u2508\u2508\u2508 src/views/components/searchbar/QueryInput.jsx:108:16\n\nCannot call withPluginEntities because property completers is missing in object type [1] in the first argument.\n[prop-missing]\n\n     src/views/components/searchbar/QueryInput.jsx\n     105\u2502   placeholder: '',\n     106\u2502 };\n     107\u2502\n     108\u2502 export default withPluginEntities(withTheme(QueryInput), { completers: 'views.completers' });\n     109\u2502\n\n     flow-typed/npm/styled-components_v5.x.x.js\n [1] 223\u2502   declare export function withTheme<Theme, Config: { ... }, Instance>(\n\n\nDo you have an idea, why this behaves differently?\nI also Implemented solution a) and realised we need to define explicit types when using withPluginEntities. Under these circumstances I prefer the following solution:\nconst mapping = { completers: 'views.completers' };\n\nexport default withPluginEntities<$Rest<Props, {| theme: ThemeInterface |}>, typeof mapping>(withTheme(QueryInput), mapping);", "url": "https://github.com/Graylog2/graylog2-server/pull/8848#discussion_r477101213", "createdAt": "2020-08-26T07:47:06Z", "author": {"login": "linuspahl"}, "path": "graylog2-web-interface/src/views/components/searchbar/QueryInput.jsx", "diffHunk": "@@ -104,4 +104,4 @@ QueryInput.defaultProps = {\n   placeholder: '',\n };\n \n-export default withPluginEntities(QueryInput, { completers: 'views.completers' });\n+export default withTheme(withPluginEntities(QueryInput, { completers: 'views.completers' }));", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NTQwNTIxMg=="}, "originalCommit": {"oid": "ac178653f875f56ea326e847808824303252411d"}, "originalPosition": 60}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjk3MzI4ODE2OnYy", "diffSide": "RIGHT", "path": "graylog2-web-interface/src/views/components/searchbar/QueryInput.jsx", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yNFQxMjo1OTo0OVrOHFjPRA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yNFQxMjo1OTo0OVrOHFjPRA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NTU4MjI3Ng==", "bodyText": "This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters. Learn more about bidirectional Unicode characters\n\n\n  \n\n\n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            import type { ThemeInterface } from 'theme';\n          \n          \n            \n            import { themePropTypes, type ThemeInterface } from 'theme';", "url": "https://github.com/Graylog2/graylog2-server/pull/8848#discussion_r475582276", "createdAt": "2020-08-24T12:59:49Z", "author": {"login": "kyleknighted"}, "path": "graylog2-web-interface/src/views/components/searchbar/QueryInput.jsx", "diffHunk": "@@ -1,8 +1,10 @@\n // @flow strict\n import * as React from 'react';\n import { useCallback, useMemo } from 'react';\n+import { withTheme } from 'styled-components';\n import PropTypes from 'prop-types';\n \n+import type { ThemeInterface } from 'theme';", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ac178653f875f56ea326e847808824303252411d"}, "originalPosition": 7}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjk3MzI5MTEyOnYy", "diffSide": "RIGHT", "path": "graylog2-web-interface/src/views/components/searchbar/QueryInput.jsx", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yNFQxMzowMDozM1rOHFjRAQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yNFQxMzowMDozM1rOHFjRAQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NTU4MjcyMQ==", "bodyText": "Could we add theme: themePropTypes.isRequired to the propTypes object as well?", "url": "https://github.com/Graylog2/graylog2-server/pull/8848#discussion_r475582721", "createdAt": "2020-08-24T13:00:33Z", "author": {"login": "kyleknighted"}, "path": "graylog2-web-interface/src/views/components/searchbar/QueryInput.jsx", "diffHunk": "@@ -12,19 +14,20 @@ import SearchBarAutoCompletions from './SearchBarAutocompletions';\n import type { Completer } from './SearchBarAutocompletions';\n \n type Props = {|\n-  disabled: boolean,\n-  value: string,\n-  completers: Array<Completer>,\n   completerFactory: (Array<Completer>) => AutoCompleter,\n+  completers: Array<Completer>,\n+  disabled: boolean,\n   onBlur?: (string) => void,\n   onChange: (string) => Promise<string>,\n   onExecute: (string) => void,\n   placeholder: string,\n+  theme: ThemeInterface,", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ac178653f875f56ea326e847808824303252411d"}, "originalPosition": 25}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4038, "cost": 1, "resetAt": "2021-11-12T20:28:25Z"}}}