{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDkwNDM4MjYz", "number": 9007, "title": "Add authentication services infrastructure", "bodyText": "This PR adds the authentication services infrastructure including an authentication service for MongoDB and LDAP authentication.\nIncludes the changes from #8949 so we can close that one.\n/jenkins-pr-deps Graylog2/graylog-plugin-enterprise#1569\nCloses #8949", "createdAt": "2020-09-21T17:03:37Z", "url": "https://github.com/Graylog2/graylog2-server/pull/9007", "merged": true, "mergeCommit": {"oid": "a4ef1be6ce84d02a9ce8fff7b4843000d0316526"}, "closed": true, "closedAt": "2020-09-24T08:17:31Z", "author": {"login": "bernd"}, "timelineItems": {"totalCount": 48, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdFfpbjAH2gAyNDkwNDM4MjYzOmVmNjQ5ZDhhYTAzYjQ0M2Y0ZDllMjA5ZjRiNTlhZWU2OWNkODQ4ZmQ=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdLwVNsgH2gAyNDkwNDM4MjYzOjc3MmM3Y2M4NGJjYTUwNzcwOTBmZDU1MTMyMTc3NTY4MDU2MDlmMTA=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "ef649d8aa03b443f4d9e209f4b59aee69cd848fd", "author": {"user": {"login": "bernd", "name": "Bernd Ahlers"}}, "url": "https://github.com/Graylog2/graylog2-server/commit/ef649d8aa03b443f4d9e209f4b59aee69cd848fd", "committedDate": "2020-09-04T06:59:10Z", "message": "Start identity provider authenticating realm"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "df7a45b43d93f532935c8412b8385161e931475b", "author": {"user": {"login": "bernd", "name": "Bernd Ahlers"}}, "url": "https://github.com/Graylog2/graylog2-server/commit/df7a45b43d93f532935c8412b8385161e931475b", "committedDate": "2020-09-04T08:33:28Z", "message": "Start a MongoDB identity provider"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "fa78501171ed12ab58b0a5a36756617a81e57abe", "author": {"user": {"login": "bernd", "name": "Bernd Ahlers"}}, "url": "https://github.com/Graylog2/graylog2-server/commit/fa78501171ed12ab58b0a5a36756617a81e57abe", "committedDate": "2020-09-04T08:36:31Z", "message": "Remove unused fields"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "2617e3cf2db334ac6bedca0e6af9a97f7028c0b1", "author": {"user": {"login": "bernd", "name": "Bernd Ahlers"}}, "url": "https://github.com/Graylog2/graylog2-server/commit/2617e3cf2db334ac6bedca0e6af9a97f7028c0b1", "committedDate": "2020-09-04T09:00:27Z", "message": "Add global identity provider config"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "1d41fbe8161195e6ec0d9704f750982330d2afef", "author": {"user": {"login": "bernd", "name": "Bernd Ahlers"}}, "url": "https://github.com/Graylog2/graylog2-server/commit/1d41fbe8161195e6ec0d9704f750982330d2afef", "committedDate": "2020-09-04T10:53:01Z", "message": "Start user profile and profile provisioner"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "5f58b1d870a8435c68eb3f097a6e491ace61b316", "author": {"user": {"login": "bernd", "name": "Bernd Ahlers"}}, "url": "https://github.com/Graylog2/graylog2-server/commit/5f58b1d870a8435c68eb3f097a6e491ace61b316", "committedDate": "2020-09-04T11:30:44Z", "message": "Better realm name"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d57993c55581619719639839bf6ade434e5187a8", "author": {"user": {"login": "bernd", "name": "Bernd Ahlers"}}, "url": "https://github.com/Graylog2/graylog2-server/commit/d57993c55581619719639839bf6ade434e5187a8", "committedDate": "2020-09-04T12:35:36Z", "message": "Add comment"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a658bd06b4ce46489a745cbe3537757777b9a465", "author": {"user": {"login": "bernd", "name": "Bernd Ahlers"}}, "url": "https://github.com/Graylog2/graylog2-server/commit/a658bd06b4ce46489a745cbe3537757777b9a465", "committedDate": "2020-09-10T14:40:29Z", "message": "Merge branch 'feature/permissions' into feature/idp"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "4605a8b211f73bbd58663d357aa91baa9813ad3d", "author": {"user": {"login": "bernd", "name": "Bernd Ahlers"}}, "url": "https://github.com/Graylog2/graylog2-server/commit/4605a8b211f73bbd58663d357aa91baa9813ad3d", "committedDate": "2020-09-10T15:54:02Z", "message": "Rename identity provider to authentication service"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a36e42b383f301d60b03749ed4f3647768c31549", "author": {"user": {"login": "bernd", "name": "Bernd Ahlers"}}, "url": "https://github.com/Graylog2/graylog2-server/commit/a36e42b383f301d60b03749ed4f3647768c31549", "committedDate": "2020-09-15T15:37:26Z", "message": "Rename some fields"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "7f0a97e219d6f997075755ebc94a7714d583029a", "author": {"user": {"login": "bernd", "name": "Bernd Ahlers"}}, "url": "https://github.com/Graylog2/graylog2-server/commit/7f0a97e219d6f997075755ebc94a7714d583029a", "committedDate": "2020-09-15T16:10:28Z", "message": "Add AuthServiceBackend#backendType()"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "3ce54ed35635d8006b658331645d1142e32a059b", "author": {"user": {"login": "bernd", "name": "Bernd Ahlers"}}, "url": "https://github.com/Graylog2/graylog2-server/commit/3ce54ed35635d8006b658331645d1142e32a059b", "committedDate": "2020-09-15T16:33:57Z", "message": "Rename UserProfileProvisioner to ProvisionerService and add actions"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b8175906f451ffb8990e721cccc912d552f366a3", "author": {"user": {"login": "bernd", "name": "Bernd Ahlers"}}, "url": "https://github.com/Graylog2/graylog2-server/commit/b8175906f451ffb8990e721cccc912d552f366a3", "committedDate": "2020-09-15T16:40:02Z", "message": "Add ProvisionException"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f834da8e334d350ad6afc50a640b161d9bce5201", "author": {"user": {"login": "bernd", "name": "Bernd Ahlers"}}, "url": "https://github.com/Graylog2/graylog2-server/commit/f834da8e334d350ad6afc50a640b161d9bce5201", "committedDate": "2020-09-16T17:02:27Z", "message": "Add constant for default session timeout"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "68a264147ee577ea764743bd713b30b786b9502b", "author": {"user": {"login": "bernd", "name": "Bernd Ahlers"}}, "url": "https://github.com/Graylog2/graylog2-server/commit/68a264147ee577ea764743bd713b30b786b9502b", "committedDate": "2020-09-16T17:03:51Z", "message": "Add auth_service_id and auth_service_uid to User and UserService"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c28e4e63b6d442d683c2642dff4cffead0b52df8", "author": {"user": {"login": "bernd", "name": "Bernd Ahlers"}}, "url": "https://github.com/Graylog2/graylog2-server/commit/c28e4e63b6d442d683c2642dff4cffead0b52df8", "committedDate": "2020-09-16T17:05:33Z", "message": "Provision a new user for external auth services"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f8621aa04a97eca9c7e55f463db87bcbd505da6b", "author": {"user": {"login": "bernd", "name": "Bernd Ahlers"}}, "url": "https://github.com/Graylog2/graylog2-server/commit/f8621aa04a97eca9c7e55f463db87bcbd505da6b", "committedDate": "2020-09-16T17:06:26Z", "message": "Merge remote-tracking branch 'origin/feature/permissions' into feature/idp"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "30978e45cdc7d57b81222721cb076ff9861cb0c4", "author": {"user": {"login": "bernd", "name": "Bernd Ahlers"}}, "url": "https://github.com/Graylog2/graylog2-server/commit/30978e45cdc7d57b81222721cb076ff9861cb0c4", "committedDate": "2020-09-17T08:41:42Z", "message": "Use a map binder and factories for provisioner actions"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "7d1990a310fb519fc245948fa8ffb417d55f8f3c", "author": {"user": {"login": "bernd", "name": "Bernd Ahlers"}}, "url": "https://github.com/Graylog2/graylog2-server/commit/7d1990a310fb519fc245948fa8ffb417d55f8f3c", "committedDate": "2020-09-17T09:48:21Z", "message": "Adjust ProvisionerService#newDetails()"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "6f7b55eba41dbd43d9180fc9d156c6599e7a937d", "author": {"user": {"login": "bernd", "name": "Bernd Ahlers"}}, "url": "https://github.com/Graylog2/graylog2-server/commit/6f7b55eba41dbd43d9180fc9d156c6599e7a937d", "committedDate": "2020-09-17T09:56:46Z", "message": "Set placeholder password for new users"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "8d87fe14a87340d841a18825d040752ee981ad19", "author": {"user": {"login": "bernd", "name": "Bernd Ahlers"}}, "url": "https://github.com/Graylog2/graylog2-server/commit/8d87fe14a87340d841a18825d040752ee981ad19", "committedDate": "2020-09-18T12:10:03Z", "message": "Introduce EncryptedValue and related classes\n\nThis class contains an encrypted value and its salt. I can be used when\nsensitive data must be stored in the database.\n\nIt comes with a custom JSON serializer and deserializer. They serialize\nand deserialize the value in different ways depending on the context.\nWhen storing/reading the value in/from MongoDB, the literal content\n(encrypted value and salt) are read/written.\nIn all other contexts, the serialized JSON only contains an indicator if\nthe value is set or not. When parsing the JSON, only a \"set_value\" field\nis allowed to set a new value.\n\nThe deserializer automatically creates an encrypted value and salt from\nthe given new plain text value."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f90ac2212342701fc457e7619402dd4e46511b9f", "author": {"user": {"login": "bernd", "name": "Bernd Ahlers"}}, "url": "https://github.com/Graylog2/graylog2-server/commit/f90ac2212342701fc457e7619402dd4e46511b9f", "committedDate": "2020-09-18T14:49:45Z", "message": "Add UserService#loadAllForAuthServiceBackend"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "38bbeb3f92c60def3de7cb0567f0cd287a172878", "author": {"user": {"login": "bernd", "name": "Bernd Ahlers"}}, "url": "https://github.com/Graylog2/graylog2-server/commit/38bbeb3f92c60def3de7cb0567f0cd287a172878", "committedDate": "2020-09-18T14:50:15Z", "message": "Extend GlobalAuthServiceConfig for updates"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "31eafdb54fe6011e65a932367401b627ba6e0cd9", "author": {"user": {"login": "bernd", "name": "Bernd Ahlers"}}, "url": "https://github.com/Graylog2/graylog2-server/commit/31eafdb54fe6011e65a932367401b627ba6e0cd9", "committedDate": "2020-09-18T15:32:05Z", "message": "Add ValidationFailureException and corresponding mapper"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "309cf310a1b08cfa458b0d92c5c1fa6cb5ac534d", "author": {"user": {"login": "bernd", "name": "Bernd Ahlers"}}, "url": "https://github.com/Graylog2/graylog2-server/commit/309cf310a1b08cfa458b0d92c5c1fa6cb5ac534d", "committedDate": "2020-09-18T16:34:17Z", "message": "Implement auth backends and configurations"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "8edb6e6be43d1715f4979e504287971576018432", "author": {"user": {"login": "bernd", "name": "Bernd Ahlers"}}, "url": "https://github.com/Graylog2/graylog2-server/commit/8edb6e6be43d1715f4979e504287971576018432", "committedDate": "2020-09-18T17:59:36Z", "message": "Extract TrustManagerProvider into its own file so it can be reused"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "9ffed8343c68b359ffcacdd5fe04de0eadc331d2", "author": {"user": {"login": "bernd", "name": "Bernd Ahlers"}}, "url": "https://github.com/Graylog2/graylog2-server/commit/9ffed8343c68b359ffcacdd5fe04de0eadc331d2", "committedDate": "2020-09-19T00:40:03Z", "message": "Fix setting auth service attributes on User"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "bd410aae1e3ce6f5794a4e040b52e172ee8ccd22", "author": {"user": {"login": "bernd", "name": "Bernd Ahlers"}}, "url": "https://github.com/Graylog2/graylog2-server/commit/bd410aae1e3ce6f5794a4e040b52e172ee8ccd22", "committedDate": "2020-09-19T00:40:30Z", "message": "Add missing attribute to builder"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a58c37f47b6b1e60de35b44e0bd2fff977cfc3f3", "author": {"user": {"login": "bernd", "name": "Bernd Ahlers"}}, "url": "https://github.com/Graylog2/graylog2-server/commit/a58c37f47b6b1e60de35b44e0bd2fff977cfc3f3", "committedDate": "2020-09-19T00:43:51Z", "message": "Fix user provisioning\n\nWe need to set an encrypted password value when creating a user."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "aaefbc99e2b5fe454fadf339cd832249506d6b0e", "author": {"user": {"login": "bernd", "name": "Bernd Ahlers"}}, "url": "https://github.com/Graylog2/graylog2-server/commit/aaefbc99e2b5fe454fadf339cd832249506d6b0e", "committedDate": "2020-09-19T00:44:21Z", "message": "Include backend type in realm string in returned SimpleAccount"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "fe2d5c46ed71ce7f60e72caf169107e7e471b564", "author": {"user": {"login": "bernd", "name": "Bernd Ahlers"}}, "url": "https://github.com/Graylog2/graylog2-server/commit/fe2d5c46ed71ce7f60e72caf169107e7e471b564", "committedDate": "2020-09-19T00:45:05Z", "message": "Add missing user attributes to UserOverviewDTO"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "84f6e243b811fdaebcb6fbedccf0852e19db7ced", "author": {"user": {"login": "bernd", "name": "Bernd Ahlers"}}, "url": "https://github.com/Graylog2/graylog2-server/commit/84f6e243b811fdaebcb6fbedccf0852e19db7ced", "committedDate": "2020-09-19T01:00:26Z", "message": "Fall back to default backend if active backend doesn't work"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "6143b50c536a50163506b9add92cad27ca809746", "author": {"user": {"login": "bernd", "name": "Bernd Ahlers"}}, "url": "https://github.com/Graylog2/graylog2-server/commit/6143b50c536a50163506b9add92cad27ca809746", "committedDate": "2020-09-19T01:01:13Z", "message": "Remove unused variable"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "3bcb34c2a7ba8126196d79f041d2852a2cbc4d54", "author": {"user": {"login": "bernd", "name": "Bernd Ahlers"}}, "url": "https://github.com/Graylog2/graylog2-server/commit/3bcb34c2a7ba8126196d79f041d2852a2cbc4d54", "committedDate": "2020-09-21T10:34:34Z", "message": "Return null instead of a 404 if there is no active backend"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "6b616206ff31a87d0b6d4419926cb617f1e52f24", "author": {"user": {"login": "bernd", "name": "Bernd Ahlers"}}, "url": "https://github.com/Graylog2/graylog2-server/commit/6b616206ff31a87d0b6d4419926cb617f1e52f24", "committedDate": "2020-09-21T11:09:55Z", "message": "Add LdapEntry#getNonBlank and add some more tests"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "793602aa8425987f2c1e667ffba9d4bbd6fd9245", "author": {"user": {"login": "bernd", "name": "Bernd Ahlers"}}, "url": "https://github.com/Graylog2/graylog2-server/commit/793602aa8425987f2c1e667ffba9d4bbd6fd9245", "committedDate": "2020-09-21T12:33:55Z", "message": "Encrypt user password before passing it on to authentication services\n\nThis ensures that we don't expose it by accident (e.g. logging it)\nAll consumers need to decrypt it before they can use it."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "1430eaf16b060de93ba90f278e75a66d6455dd99", "author": {"user": {"login": "bernd", "name": "Bernd Ahlers"}}, "url": "https://github.com/Graylog2/graylog2-server/commit/1430eaf16b060de93ba90f278e75a66d6455dd99", "committedDate": "2020-09-21T12:36:41Z", "message": "Reduce log level for some log statements"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "54abf997dbfc289c6a88a66fab822abedcdb37d2", "author": {"user": {"login": "bernd", "name": "Bernd Ahlers"}}, "url": "https://github.com/Graylog2/graylog2-server/commit/54abf997dbfc289c6a88a66fab822abedcdb37d2", "committedDate": "2020-09-21T15:54:54Z", "message": "Add auth service backend test code"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c3f9991e01b1b0df1878470b2b48a2f2d3e6da94", "author": {"user": {"login": "bernd", "name": "Bernd Ahlers"}}, "url": "https://github.com/Graylog2/graylog2-server/commit/c3f9991e01b1b0df1878470b2b48a2f2d3e6da94", "committedDate": "2020-09-21T16:06:23Z", "message": "Add LDAP authentication service"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b81f8f74136c2dbaf2e38b072870c4ba0cbd6338", "author": {"user": {"login": "bernd", "name": "Bernd Ahlers"}}, "url": "https://github.com/Graylog2/graylog2-server/commit/b81f8f74136c2dbaf2e38b072870c4ba0cbd6338", "committedDate": "2020-09-21T16:54:08Z", "message": "Don't run authentication services for the \"root_username\" user"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "2c45a280a31522511fa020e7f814e0b9de8742c0", "author": {"user": {"login": "bernd", "name": "Bernd Ahlers"}}, "url": "https://github.com/Graylog2/graylog2-server/commit/2c45a280a31522511fa020e7f814e0b9de8742c0", "committedDate": "2020-09-21T16:56:19Z", "message": "Use an explicit authenticating realm order instead of the dynamic one\n\nAlso disable binding of the legacy LDAP and MongoDB realm.s"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e59f11aa3544246c35a3fd64666d8c855e3881e0", "author": {"user": {"login": "bernd", "name": "Bernd Ahlers"}}, "url": "https://github.com/Graylog2/graylog2-server/commit/e59f11aa3544246c35a3fd64666d8c855e3881e0", "committedDate": "2020-09-21T16:59:09Z", "message": "Merge branch 'feature/permissions' into feature/idp"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "de9dd869f0b6d01fbde7968b7767876aeac9e82f", "author": {"user": {"login": "bernd", "name": "Bernd Ahlers"}}, "url": "https://github.com/Graylog2/graylog2-server/commit/de9dd869f0b6d01fbde7968b7767876aeac9e82f", "committedDate": "2020-09-21T17:31:36Z", "message": "Fail login if provisioning fails"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "cf55b222103f0054a41a2d8f3da74f7e2bf6cbf2", "author": {"user": {"login": "bernd", "name": "Bernd Ahlers"}}, "url": "https://github.com/Graylog2/graylog2-server/commit/cf55b222103f0054a41a2d8f3da74f7e2bf6cbf2", "committedDate": "2020-09-21T17:37:32Z", "message": "Add TestPasswordSecretModule for guice injections in testing"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "579545f40602081c83358b5a9ec850cf8a309b6a", "author": {"user": {"login": "bernd", "name": "Bernd Ahlers"}}, "url": "https://github.com/Graylog2/graylog2-server/commit/579545f40602081c83358b5a9ec850cf8a309b6a", "committedDate": "2020-09-21T17:45:46Z", "message": "Add missing audit annotations to resources"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDkzMjc0ODcz", "url": "https://github.com/Graylog2/graylog2-server/pull/9007#pullrequestreview-493274873", "createdAt": "2020-09-22T09:23:03Z", "commit": {"oid": "579545f40602081c83358b5a9ec850cf8a309b6a"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yMlQwOToyMzowNFrOHVxfeA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yMlQwOToyMzowNFrOHVxfeA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MjU5MzAxNg==", "bodyText": "My thoughts to this:\n\nLDAP server logs to graylog\nLDAP server is \"broken\"\nYou want to look at the problem but you can't log in to graylog since LDAP is \"broken\"\nA fallback user with reader rights (so other than admin) would be helpful", "url": "https://github.com/Graylog2/graylog2-server/pull/9007#discussion_r492593016", "createdAt": "2020-09-22T09:23:04Z", "author": {"login": "kmerz"}, "path": "graylog2-server/src/main/java/org/graylog/security/authservice/AuthServiceAuthenticator.java", "diffHunk": "@@ -0,0 +1,84 @@\n+/**\n+ * This file is part of Graylog.\n+ *\n+ * Graylog is free software: you can redistribute it and/or modify\n+ * it under the terms of the GNU General Public License as published by\n+ * the Free Software Foundation, either version 3 of the License, or\n+ * (at your option) any later version.\n+ *\n+ * Graylog is distributed in the hope that it will be useful,\n+ * but WITHOUT ANY WARRANTY; without even the implied warranty of\n+ * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n+ * GNU General Public License for more details.\n+ *\n+ * You should have received a copy of the GNU General Public License\n+ * along with Graylog.  If not, see <http://www.gnu.org/licenses/>.\n+ */\n+package org.graylog.security.authservice;\n+\n+import org.slf4j.Logger;\n+import org.slf4j.LoggerFactory;\n+\n+import javax.inject.Inject;\n+import java.util.Optional;\n+\n+public class AuthServiceAuthenticator {\n+    private static final Logger LOG = LoggerFactory.getLogger(AuthServiceAuthenticator.class);\n+\n+    private final GlobalAuthServiceConfig authServiceConfig;\n+    private final ProvisionerService provisionerService;\n+\n+    @Inject\n+    public AuthServiceAuthenticator(GlobalAuthServiceConfig authServiceConfig,\n+                                    ProvisionerService provisionerService) {\n+        this.authServiceConfig = authServiceConfig;\n+        this.provisionerService = provisionerService;\n+    }\n+\n+    /**\n+     * Tries to authenticate the username with the given password and returns the authenticated username if successful.\n+     *\n+     * @param authCredentials the authentication credentials\n+     * @return the authenticated username\n+     */\n+    public AuthServiceResult authenticate(AuthServiceCredentials authCredentials) {\n+        final Optional<AuthServiceBackend> activeBackend = authServiceConfig.getActiveBackend();\n+\n+        if (activeBackend.isPresent()) {\n+            final AuthServiceResult result = authenticate(authCredentials, activeBackend.get());\n+            if (result.isSuccess()) {\n+                return result;\n+            }\n+            // TODO: Do we want the fallback to the default backend here? Maybe it should be configurable?", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "579545f40602081c83358b5a9ec850cf8a309b6a"}, "originalPosition": 52}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDk0NDE4NTUz", "url": "https://github.com/Graylog2/graylog2-server/pull/9007#pullrequestreview-494418553", "createdAt": "2020-09-23T08:25:16Z", "commit": {"oid": "579545f40602081c83358b5a9ec850cf8a309b6a"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "772c7cc84bca5077090fd5513217756805609f10", "author": {"user": {"login": "bernd", "name": "Bernd Ahlers"}}, "url": "https://github.com/Graylog2/graylog2-server/commit/772c7cc84bca5077090fd5513217756805609f10", "committedDate": "2020-09-23T17:49:01Z", "message": "Add /system/authentication/services/active-backend/users endpoint"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3549, "cost": 1, "resetAt": "2021-10-28T18:54:27Z"}}}