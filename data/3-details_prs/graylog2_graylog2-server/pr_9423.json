{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTE4NDkyNTc5", "number": 9423, "title": "Hide indices on cloud", "bodyText": "Hides all pages and mentioning of indices for cloud consumer as they will not be needing those.\nDescription\n\nHides the indices page, the entry in the systems menu, indices index failures on system overview.\nMotivation and Context\n\n\nBecause this feature will not be available for cloud users.\nHow Has This Been Tested?\n\n\n\nUsing a local cloud environment.\nTypes of changes\n\n\n Bug fix (non-breaking change which fixes an issue)\n New feature (non-breaking change which adds functionality)\n Refactoring (non-breaking change)\n Breaking change (fix or feature that would cause existing functionality to change)\n\nChecklist:\n\n\n\n My code follows the code style of this project.\n My change requires a change to the documentation.\n I have updated the documentation accordingly.\n I have read the CONTRIBUTING document.\n I have added tests to cover my changes.", "createdAt": "2020-11-10T13:34:41Z", "url": "https://github.com/Graylog2/graylog2-server/pull/9423", "merged": true, "mergeCommit": {"oid": "67f840e365eae5d0a9350efa01f656f2d4ea6d8a"}, "closed": true, "closedAt": "2020-11-16T13:08:13Z", "author": {"login": "Gaya"}, "timelineItems": {"totalCount": 16, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdbJMJMAH2gAyNTE4NDkyNTc5OmZhM2QyOWE0MjEyNDg5M2VhNjBkZTFjMzljNTg2OTkyOTU2YjdmZTM=", "endCursor": "Y3Vyc29yOnYyOpPPAAABddErU5gFqTUzMTMwMjQwNw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "fa3d29a42124893ea60de1c39c586992956b7fe3", "author": {"user": {"login": "Gaya", "name": "Gaya Kessler"}}, "url": "https://github.com/Graylog2/graylog2-server/commit/fa3d29a42124893ea60de1c39c586992956b7fe3", "committedDate": "2020-11-10T13:15:36Z", "message": "hide indices page component in cloud"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "bd490b664ca9be90516a0c19307c054a9756f91c", "author": {"user": {"login": "Gaya", "name": "Gaya Kessler"}}, "url": "https://github.com/Graylog2/graylog2-server/commit/bd490b664ca9be90516a0c19307c054a9756f91c", "committedDate": "2020-11-10T13:21:07Z", "message": "abstract conditional away to component"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "19be6992b2b2279b1e6d6af482047e048df8d756", "author": {"user": {"login": "Gaya", "name": "Gaya Kessler"}}, "url": "https://github.com/Graylog2/graylog2-server/commit/19be6992b2b2279b1e6d6af482047e048df8d756", "committedDate": "2020-11-10T13:22:14Z", "message": "hide indices menu item on cloud"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "343bc150cea170f4fb0948768598529207800275", "author": {"user": {"login": "Gaya", "name": "Gaya Kessler"}}, "url": "https://github.com/Graylog2/graylog2-server/commit/343bc150cea170f4fb0948768598529207800275", "committedDate": "2020-11-10T13:27:47Z", "message": "hide indices failures"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "61ee8277bc0b920099cf7699ca2a1da3a9ae3d93", "author": {"user": {"login": "Gaya", "name": "Gaya Kessler"}}, "url": "https://github.com/Graylog2/graylog2-server/commit/61ee8277bc0b920099cf7699ca2a1da3a9ae3d93", "committedDate": "2020-11-10T15:21:30Z", "message": "rename jsx"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c85d3eebb89f464dd0cfc9c3ee3a6e22d4cf2f68", "author": {"user": {"login": "Gaya", "name": "Gaya Kessler"}}, "url": "https://github.com/Graylog2/graylog2-server/commit/c85d3eebb89f464dd0cfc9c3ee3a6e22d4cf2f68", "committedDate": "2020-11-10T15:31:42Z", "message": "update mocks for settings"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "dfa9e00587fcba252d6c1910acb20f264b13c543", "author": {"user": {"login": "Gaya", "name": "Gaya Kessler"}}, "url": "https://github.com/Graylog2/graylog2-server/commit/dfa9e00587fcba252d6c1910acb20f264b13c543", "committedDate": "2020-11-11T08:23:56Z", "message": "hide index pages"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTI4MDg0MjM5", "url": "https://github.com/Graylog2/graylog2-server/pull/9423#pullrequestreview-528084239", "createdAt": "2020-11-11T11:21:29Z", "commit": {"oid": "dfa9e00587fcba252d6c1910acb20f264b13c543"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xMVQxMToyMToyOVrOHxJASQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xMVQxMToyMToyOVrOHxJASQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMTI4OTgwMQ==", "bodyText": "I suggest moving these checks into AppRouter, so that react-router will not have the route configuration for routes that should be hidden. This helps us by not having to modify each page that should be hidden, and the behaviour is more consistent with other routes that do not exist.\nSomething like this should do the trick:\n--- a/graylog2-web-interface/src/routing/AppRouter.jsx\n+++ b/graylog2-web-interface/src/routing/AppRouter.jsx\n@@ -87,6 +87,7 @@ import {\n } from 'pages';\n \n import RouterErrorBoundary from 'components/errors/RouterErrorBoundary';\n+import withHideOnCloud from '../util/conditional/withHideOnCloud';\n \n const AppRouter = () => {\n   const pluginRoutes = PluginStore.exports('routes');\n@@ -162,7 +163,7 @@ const AppRouter = () => {\n                      component={EditContentPackPage} />\n               <Route path={Routes.SYSTEM.CONTENTPACKS.show(':contentPackId')} component={ShowContentPackPage} />\n               <Route path={Routes.SYSTEM.GROKPATTERNS} component={GrokPatternsPage} />\n-              <Route path={Routes.SYSTEM.INDICES.LIST} component={IndicesPage} />\n+              {withHideOnCloud(<Route path={Routes.SYSTEM.INDICES.LIST} component={IndicesPage} />)}\n               <Route path={Routes.SYSTEM.INDEX_SETS.CREATE} component={IndexSetCreationPage} />\n               <Route path={Routes.SYSTEM.INDEX_SETS.SHOW(':indexSetId')} component={IndexSetPage} />\n               <Route path={Routes.SYSTEM.INDEX_SETS.CONFIGURATION(':indexSetId')}", "url": "https://github.com/Graylog2/graylog2-server/pull/9423#discussion_r521289801", "createdAt": "2020-11-11T11:21:29Z", "author": {"login": "edmundoa"}, "path": "graylog2-web-interface/src/pages/IndicesPage.jsx", "diffHunk": "@@ -48,4 +49,4 @@ class IndicesPage extends React.Component {\n   }\n }\n \n-export default IndicesPage;\n+export default withHideOnCloud(IndicesPage);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "dfa9e00587fcba252d6c1910acb20f264b13c543"}, "originalPosition": 13}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTI4MDg1MjE1", "url": "https://github.com/Graylog2/graylog2-server/pull/9423#pullrequestreview-528085215", "createdAt": "2020-11-11T11:22:47Z", "commit": {"oid": "dfa9e00587fcba252d6c1910acb20f264b13c543"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a0852800fa9271ac52cda83304ce880d912087a4", "author": {"user": {"login": "Gaya", "name": "Gaya Kessler"}}, "url": "https://github.com/Graylog2/graylog2-server/commit/a0852800fa9271ac52cda83304ce880d912087a4", "committedDate": "2020-11-11T15:44:42Z", "message": "do not register indices routes"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "64858cb992e3ac2bc5c7e668949c75ed9f14f683", "author": {"user": {"login": "Gaya", "name": "Gaya Kessler"}}, "url": "https://github.com/Graylog2/graylog2-server/commit/64858cb992e3ac2bc5c7e668949c75ed9f14f683", "committedDate": "2020-11-11T15:47:48Z", "message": "disable indexes pages"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "6fba17b1bc503bf447f06bfa2744ec78e31aa515", "author": {"user": {"login": "Gaya", "name": "Gaya Kessler"}}, "url": "https://github.com/Graylog2/graylog2-server/commit/6fba17b1bc503bf447f06bfa2744ec78e31aa515", "committedDate": "2020-11-11T15:48:03Z", "message": "remove withHideOnCloud HOCs"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "0caba56051efcd828cb1124a621f13e4ca1169ec", "author": {"user": {"login": "Gaya", "name": "Gaya Kessler"}}, "url": "https://github.com/Graylog2/graylog2-server/commit/0caba56051efcd828cb1124a621f13e4ca1169ec", "committedDate": "2020-11-11T15:49:21Z", "message": "whoops, typo"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTMxMTYzMzc1", "url": "https://github.com/Graylog2/graylog2-server/pull/9423#pullrequestreview-531163375", "createdAt": "2020-11-16T09:51:19Z", "commit": {"oid": "0caba56051efcd828cb1124a621f13e4ca1169ec"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xNlQwOTo1MToyMFrOHzxSbg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xNlQwOTo1MToyMFrOHzxSbg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNDA0Njk1OA==", "bodyText": "These three lines have an eslint error:\nESLint: Missing parentheses around multilines JSX(react/jsx-wrap-multilines)", "url": "https://github.com/Graylog2/graylog2-server/pull/9423#discussion_r524046958", "createdAt": "2020-11-16T09:51:20Z", "author": {"login": "edmundoa"}, "path": "graylog2-web-interface/src/routing/AppRouter.jsx", "diffHunk": "@@ -162,12 +165,15 @@ const AppRouter = () => {\n                      component={EditContentPackPage} />\n               <Route path={Routes.SYSTEM.CONTENTPACKS.show(':contentPackId')} component={ShowContentPackPage} />\n               <Route path={Routes.SYSTEM.GROKPATTERNS} component={GrokPatternsPage} />\n-              <Route path={Routes.SYSTEM.INDICES.LIST} component={IndicesPage} />\n-              <Route path={Routes.SYSTEM.INDEX_SETS.CREATE} component={IndexSetCreationPage} />\n-              <Route path={Routes.SYSTEM.INDEX_SETS.SHOW(':indexSetId')} component={IndexSetPage} />\n-              <Route path={Routes.SYSTEM.INDEX_SETS.CONFIGURATION(':indexSetId')}\n-                     component={IndexSetConfigurationPage} />\n-              <Route path={Routes.SYSTEM.INDICES.FAILURES} component={IndexerFailuresPage} />\n+\n+              {!isCloud && <Route path={Routes.SYSTEM.INDEX_SETS.CREATE}\n+                                  component={IndexSetCreationPage} />}\n+              {!isCloud && <Route path={Routes.SYSTEM.INDEX_SETS.SHOW(':indexSetId')}\n+                                  component={IndexSetPage} />}\n+              {!isCloud && <Route path={Routes.SYSTEM.INDEX_SETS.CONFIGURATION(':indexSetId')}", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "0caba56051efcd828cb1124a621f13e4ca1169ec"}, "originalPosition": 32}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "48b444762ecaee79206efbb9afa3ca1cb5b84a42", "author": {"user": {"login": "Gaya", "name": "Gaya Kessler"}}, "url": "https://github.com/Graylog2/graylog2-server/commit/48b444762ecaee79206efbb9afa3ca1cb5b84a42", "committedDate": "2020-11-16T10:51:57Z", "message": "fix eslint and group routes to hide on cloud"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTMxMzAyNDA3", "url": "https://github.com/Graylog2/graylog2-server/pull/9423#pullrequestreview-531302407", "createdAt": "2020-11-16T13:07:59Z", "commit": {"oid": "48b444762ecaee79206efbb9afa3ca1cb5b84a42"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3410, "cost": 1, "resetAt": "2021-10-28T18:54:27Z"}}}