{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0Mzk4MjM2NTU0", "number": 7829, "title": "Improve triggering search executions from search bar.", "bodyText": "Description\n\nMotivation and Context\n\n\nThis PR is incorporating user feedback into the product to improve the behaviour of the search controls (time range, streams, query string) for the search & dashboard pages as well was when editing a widget on a dashboard.\nThe changes it introduces are:\n\nChanging the time range type (relative, absolute, keyword) does not\nimmediately trigger a search refresh\nChanging one of the values for the absolute time range (from, to)\ndoes not trigger a search refresh, unless the user presses enter\nChanging the keyword value does not trigger a search refresh (upon\nchange or blur) unless the user presses enter\nIf validation for one of the fields fails (namely invalid timestamp\nfor absolute from/to or invalid keyword), the search button is disabled\nBlurring the query string input does not trigger a search refresh\n(pressing enter inside still does)\nChanging the set of streams does not trigger a search refresh\nWhen the user has changed a value and not submitted a search (the\ntime range/query string), a yellow bubble will show up at the search\nbutton, indicating that there are uncommitted changes\n\nThere are couple of specialties in this PR:\n\nTo simplify form handling, the formik library is introduced, helping a lot to make creation of a proper form with consistent validation, dirty flag & submission way easier.\nThis PR is updating ace-builds to v1.4.9 through a version resolution in package.json. The update is needed because of an issue (ajaxorg/ace-builds#171) in v1.4.8.\nThe change to package.json which modifies the moduleNameMapper section is needed, because of the import of ace-builds/webpack-resolver, which utilizes the file-loader to import themes/modes, but uses a file-loader setting that was previously not mached in jest's module name mapper which translates these statements into simple imports.\n\nFixes #7572.\nFixes #7596.\nFixes #7724.\nHow Has This Been Tested?\n\n\n\nScreenshots (if appropriate):\nTypes of changes\n\n\n Bug fix (non-breaking change which fixes an issue)\n New feature (non-breaking change which adds functionality)\n Refactoring (non-breaking change)\n Breaking change (fix or feature that would cause existing functionality to change)\n\nChecklist:\n\n\n\n My code follows the code style of this project.\n My change requires a change to the documentation.\n I have updated the documentation accordingly.\n I have read the CONTRIBUTING document.\n I have added tests to cover my changes.", "createdAt": "2020-04-03T15:22:30Z", "url": "https://github.com/Graylog2/graylog2-server/pull/7829", "merged": true, "mergeCommit": {"oid": "a82c8f4ef1317f4f6a8a85109bd88b475640af96"}, "closed": true, "closedAt": "2020-04-17T12:20:11Z", "author": {"login": "dennisoelkers"}, "timelineItems": {"totalCount": 80, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcVR-3wgBqjMyMDk1MDM1Nzg=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcYgU4VAFqTM5NTQwNDE3NQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "ea2f7112635d037152863d77b5a9309e0dcde384", "author": {"user": {"login": "dennisoelkers", "name": "Dennis Oelkers"}}, "url": "https://github.com/Graylog2/graylog2-server/commit/ea2f7112635d037152863d77b5a9309e0dcde384", "committedDate": "2020-04-06T19:57:58Z", "message": "Updating `ace-builds` to 1.4.9."}, "afterCommit": {"oid": "792e2f3288d123de4d712790747ebb69ed2901fc", "author": {"user": {"login": "dennisoelkers", "name": "Dennis Oelkers"}}, "url": "https://github.com/Graylog2/graylog2-server/commit/792e2f3288d123de4d712790747ebb69ed2901fc", "committedDate": "2020-04-07T11:55:21Z", "message": "Updating `ace-builds` to 1.4.9."}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "6b1d264570300f03a4976fd44a48082dc9dd2a79", "author": {"user": {"login": "dennisoelkers", "name": "Dennis Oelkers"}}, "url": "https://github.com/Graylog2/graylog2-server/commit/6b1d264570300f03a4976fd44a48082dc9dd2a79", "committedDate": "2020-04-07T14:47:26Z", "message": "Fixing tests for `AbsoluteTimeRangeSelector`."}, "afterCommit": {"oid": "bb2d44af0720a95cf0ea284bc7303a56949b684a", "author": {"user": {"login": "dennisoelkers", "name": "Dennis Oelkers"}}, "url": "https://github.com/Graylog2/graylog2-server/commit/bb2d44af0720a95cf0ea284bc7303a56949b684a", "committedDate": "2020-04-07T14:49:36Z", "message": "Fixing tests for `AbsoluteTimeRangeSelector`."}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "5060a1101ff361de220a9901a652c8da4b593bd0", "author": {"user": {"login": "dennisoelkers", "name": "Dennis Oelkers"}}, "url": "https://github.com/Graylog2/graylog2-server/commit/5060a1101ff361de220a9901a652c8da4b593bd0", "committedDate": "2020-04-08T16:29:06Z", "message": "Fixing the expectation."}, "afterCommit": {"oid": "560a0ba83bee054b0af52107fc23a2280235a4f8", "author": {"user": {"login": "dennisoelkers", "name": "Dennis Oelkers"}}, "url": "https://github.com/Graylog2/graylog2-server/commit/560a0ba83bee054b0af52107fc23a2280235a4f8", "committedDate": "2020-04-14T12:14:03Z", "message": "Changing relative time range does not execute search."}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "560a0ba83bee054b0af52107fc23a2280235a4f8", "author": {"user": {"login": "dennisoelkers", "name": "Dennis Oelkers"}}, "url": "https://github.com/Graylog2/graylog2-server/commit/560a0ba83bee054b0af52107fc23a2280235a4f8", "committedDate": "2020-04-14T12:14:03Z", "message": "Changing relative time range does not execute search."}, "afterCommit": {"oid": "841e891f78cc3b4c5aa5c749efe13c4631018949", "author": {"user": {"login": "dennisoelkers", "name": "Dennis Oelkers"}}, "url": "https://github.com/Graylog2/graylog2-server/commit/841e891f78cc3b4c5aa5c749efe13c4631018949", "committedDate": "2020-04-15T14:14:59Z", "message": "Changing relative time range does not execute search."}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "40a0b591e6a32135746dcc83bec2e0a8c7fc9872", "author": {"user": {"login": "dennisoelkers", "name": "Dennis Oelkers"}}, "url": "https://github.com/Graylog2/graylog2-server/commit/40a0b591e6a32135746dcc83bec2e0a8c7fc9872", "committedDate": "2020-04-15T14:59:52Z", "message": "Returning promise in onChange handlers to prevent exception."}, "afterCommit": {"oid": "cea25d4b47af90646704ff825d59e420e966c69d", "author": {"user": {"login": "dennisoelkers", "name": "Dennis Oelkers"}}, "url": "https://github.com/Graylog2/graylog2-server/commit/cea25d4b47af90646704ff825d59e420e966c69d", "committedDate": "2020-04-15T15:07:12Z", "message": "Returning promise in onChange handlers to prevent exception."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "07016a0ec018fda96775cbb3782ca6ca2e122595", "author": {"user": {"login": "dennisoelkers", "name": "Dennis Oelkers"}}, "url": "https://github.com/Graylog2/graylog2-server/commit/07016a0ec018fda96775cbb3782ca6ca2e122595", "committedDate": "2020-04-16T08:02:38Z", "message": "Cache timerange state in `SearchBar` component."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ae58ba2a4e5016055c9a7d85f684fe8d06401a93", "author": {"user": {"login": "dennisoelkers", "name": "Dennis Oelkers"}}, "url": "https://github.com/Graylog2/graylog2-server/commit/ae58ba2a4e5016055c9a7d85f684fe8d06401a93", "committedDate": "2020-04-16T08:02:38Z", "message": "Reusing `filtersToStreamSet`."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "2b0ecb2669e9f694a121ae266d82ddfc84b62f97", "author": {"user": {"login": "dennisoelkers", "name": "Dennis Oelkers"}}, "url": "https://github.com/Graylog2/graylog2-server/commit/2b0ecb2669e9f694a121ae266d82ddfc84b62f97", "committedDate": "2020-04-16T08:02:39Z", "message": "Adding `onSubmit` to time range inputs."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e6c7f246651b23a743b4ad32e259f690a461cd8c", "author": {"user": {"login": "dennisoelkers", "name": "Dennis Oelkers"}}, "url": "https://github.com/Graylog2/graylog2-server/commit/e6c7f246651b23a743b4ad32e259f690a461cd8c", "committedDate": "2020-04-16T08:02:39Z", "message": "Performing search only when pressing enter in absolute time range input."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "7e26dfa3ca23cb19de87c1a6ebe739af564cad14", "author": {"user": {"login": "dennisoelkers", "name": "Dennis Oelkers"}}, "url": "https://github.com/Graylog2/graylog2-server/commit/7e26dfa3ca23cb19de87c1a6ebe739af564cad14", "committedDate": "2020-04-16T08:02:39Z", "message": "Extracting reducer function."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "4b2a2bc1968a41dcd03421d35e1c749ca483c1f1", "author": {"user": {"login": "dennisoelkers", "name": "Dennis Oelkers"}}, "url": "https://github.com/Graylog2/graylog2-server/commit/4b2a2bc1968a41dcd03421d35e1c749ca483c1f1", "committedDate": "2020-04-16T08:02:39Z", "message": "Making keyword input only submit when pressing enter."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "be765aad4788953e2e9badb7958cc3b5ca3d11b9", "author": {"user": {"login": "dennisoelkers", "name": "Dennis Oelkers"}}, "url": "https://github.com/Graylog2/graylog2-server/commit/be765aad4788953e2e9badb7958cc3b5ca3d11b9", "committedDate": "2020-04-16T08:02:39Z", "message": "Replacing custom form logic with formik."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "342b839ed3a1842d8715b18e65c6257214c2c188", "author": {"user": {"login": "dennisoelkers", "name": "Dennis Oelkers"}}, "url": "https://github.com/Graylog2/graylog2-server/commit/342b839ed3a1842d8715b18e65c6257214c2c188", "committedDate": "2020-04-16T08:02:39Z", "message": "Wrapping controls in one formik instance."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c11a09eca961ff03bad9c8de6387068981c04ab1", "author": {"user": {"login": "dennisoelkers", "name": "Dennis Oelkers"}}, "url": "https://github.com/Graylog2/graylog2-server/commit/c11a09eca961ff03bad9c8de6387068981c04ab1", "committedDate": "2020-04-16T08:02:39Z", "message": "Fixing relative type and active handling."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "7febb42a5c77e1d6ebeb20d9843e8622d6cd611f", "author": {"user": {"login": "dennisoelkers", "name": "Dennis Oelkers"}}, "url": "https://github.com/Graylog2/graylog2-server/commit/7febb42a5c77e1d6ebeb20d9843e8622d6cd611f", "committedDate": "2020-04-16T08:02:39Z", "message": "Correcting return type for `onSubmit`."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a69ab84363ee8e19a81da3ad7cf464a240be592e", "author": {"user": {"login": "dennisoelkers", "name": "Dennis Oelkers"}}, "url": "https://github.com/Graylog2/graylog2-server/commit/a69ab84363ee8e19a81da3ad7cf464a240be592e", "committedDate": "2020-04-16T08:02:39Z", "message": "Widening parameter type for builder method."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "fee658f945262f593df18ca42b5264ad9b08be8e", "author": {"user": {"login": "dennisoelkers", "name": "Dennis Oelkers"}}, "url": "https://github.com/Graylog2/graylog2-server/commit/fee658f945262f593df18ca42b5264ad9b08be8e", "committedDate": "2020-04-16T08:02:40Z", "message": "Minor fixes."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "8810769074521ffa7ee0305e30c1d3b7c2339263", "author": {"user": {"login": "dennisoelkers", "name": "Dennis Oelkers"}}, "url": "https://github.com/Graylog2/graylog2-server/commit/8810769074521ffa7ee0305e30c1d3b7c2339263", "committedDate": "2020-04-16T08:02:40Z", "message": "Moving render prop to children."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f62b1e54ea3aaa9e23fd8ddd10b32d0423124b6a", "author": {"user": {"login": "dennisoelkers", "name": "Dennis Oelkers"}}, "url": "https://github.com/Graylog2/graylog2-server/commit/f62b1e54ea3aaa9e23fd8ddd10b32d0423124b6a", "committedDate": "2020-04-16T08:02:40Z", "message": "Wiring `WidgetQueryControls` again."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e1b3967c99e9e1df1eb0ccdddf54775af778dd75", "author": {"user": {"login": "dennisoelkers", "name": "Dennis Oelkers"}}, "url": "https://github.com/Graylog2/graylog2-server/commit/e1b3967c99e9e1df1eb0ccdddf54775af778dd75", "committedDate": "2020-04-16T08:02:40Z", "message": "Removing unused id."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a5b65c86cff418eacb06a01bc3df3fbd1cb4b78c", "author": {"user": {"login": "dennisoelkers", "name": "Dennis Oelkers"}}, "url": "https://github.com/Graylog2/graylog2-server/commit/a5b65c86cff418eacb06a01bc3df3fbd1cb4b78c", "committedDate": "2020-04-16T08:02:40Z", "message": "Consolidating form boilerplate in `SearchBarForm`."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "5a213637c648e16af8aaa0e04ca643552db4baa7", "author": {"user": {"login": "dennisoelkers", "name": "Dennis Oelkers"}}, "url": "https://github.com/Graylog2/graylog2-server/commit/5a213637c648e16af8aaa0e04ca643552db4baa7", "committedDate": "2020-04-16T08:02:40Z", "message": "Allow updating initial values."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d09e06ef207050e4f6308418082f880deee6dcea", "author": {"user": {"login": "dennisoelkers", "name": "Dennis Oelkers"}}, "url": "https://github.com/Graylog2/graylog2-server/commit/d09e06ef207050e4f6308418082f880deee6dcea", "committedDate": "2020-04-16T08:02:40Z", "message": "Adding `dirty` indicator to search button`."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d64b53edcd18b9df58d1759fc16f7ff1929fa90b", "author": {"user": {"login": "dennisoelkers", "name": "Dennis Oelkers"}}, "url": "https://github.com/Graylog2/graylog2-server/commit/d64b53edcd18b9df58d1759fc16f7ff1929fa90b", "committedDate": "2020-04-16T08:02:40Z", "message": "Adding workaround for field validation."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "1a4fdc98682ec476568b17bd47def8e70d1b8e2e", "author": {"user": {"login": "dennisoelkers", "name": "Dennis Oelkers"}}, "url": "https://github.com/Graylog2/graylog2-server/commit/1a4fdc98682ec476568b17bd47def8e70d1b8e2e", "committedDate": "2020-04-16T08:02:40Z", "message": "Fixing linter hints."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "0ebac76dc444a3e60a6afc0cc2e7ff045b7a3b54", "author": {"user": {"login": "dennisoelkers", "name": "Dennis Oelkers"}}, "url": "https://github.com/Graylog2/graylog2-server/commit/0ebac76dc444a3e60a6afc0cc2e7ff045b7a3b54", "committedDate": "2020-04-16T08:02:40Z", "message": "Fixing flow hints."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e74f8915ef0496d72c96c67fe8d1e2a7e32df23d", "author": {"user": {"login": "dennisoelkers", "name": "Dennis Oelkers"}}, "url": "https://github.com/Graylog2/graylog2-server/commit/e74f8915ef0496d72c96c67fe8d1e2a7e32df23d", "committedDate": "2020-04-16T08:03:06Z", "message": "Updating snapshots."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "4fa574347a2007511a92061e959f87fc8aced574", "author": {"user": {"login": "dennisoelkers", "name": "Dennis Oelkers"}}, "url": "https://github.com/Graylog2/graylog2-server/commit/4fa574347a2007511a92061e959f87fc8aced574", "committedDate": "2020-04-16T08:03:09Z", "message": "Removing now unneeded eslint directive."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "67003d08ec445e2f0153f80ddb48e2f10da63b07", "author": {"user": {"login": "dennisoelkers", "name": "Dennis Oelkers"}}, "url": "https://github.com/Graylog2/graylog2-server/commit/67003d08ec445e2f0153f80ddb48e2f10da63b07", "committedDate": "2020-04-16T08:03:09Z", "message": "Updating tests for `KeywordTimeRangeSelector`."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "2741367d06c9340d6fc76fa0ce5d8c68a5e98d96", "author": {"user": {"login": "dennisoelkers", "name": "Dennis Oelkers"}}, "url": "https://github.com/Graylog2/graylog2-server/commit/2741367d06c9340d6fc76fa0ce5d8c68a5e98d96", "committedDate": "2020-04-16T08:03:09Z", "message": "Updating `ace-builds` to 1.4.9."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "fc77d323cc37830fc029a2d7b851e431a18ff1ca", "author": {"user": {"login": "dennisoelkers", "name": "Dennis Oelkers"}}, "url": "https://github.com/Graylog2/graylog2-server/commit/fc77d323cc37830fc029a2d7b851e431a18ff1ca", "committedDate": "2020-04-16T08:03:09Z", "message": "Updating `WidgetQueryControls` tests."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "07c0f6e27ab2d4d0f8dab58f0e065bb1efa97ea0", "author": {"user": {"login": "dennisoelkers", "name": "Dennis Oelkers"}}, "url": "https://github.com/Graylog2/graylog2-server/commit/07c0f6e27ab2d4d0f8dab58f0e065bb1efa97ea0", "committedDate": "2020-04-16T08:03:09Z", "message": "Allowing to pass optional `onSubmit` prop."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "3b7d734ec031d221066d3e890d63d6d34f113f98", "author": {"user": {"login": "dennisoelkers", "name": "Dennis Oelkers"}}, "url": "https://github.com/Graylog2/graylog2-server/commit/3b7d734ec031d221066d3e890d63d6d34f113f98", "committedDate": "2020-04-16T08:03:09Z", "message": "Fixing `SearchBar` test."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "2576214898671ff33a0fe8548c9d5b5de280a5f7", "author": {"user": {"login": "dennisoelkers", "name": "Dennis Oelkers"}}, "url": "https://github.com/Graylog2/graylog2-server/commit/2576214898671ff33a0fe8548c9d5b5de280a5f7", "committedDate": "2020-04-16T08:03:09Z", "message": "Using consistent format for timestamps in `DateInputWithPicker`."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a86a109d1bd900253e117502d400cc1e7c85463c", "author": {"user": {"login": "dennisoelkers", "name": "Dennis Oelkers"}}, "url": "https://github.com/Graylog2/graylog2-server/commit/a86a109d1bd900253e117502d400cc1e7c85463c", "committedDate": "2020-04-16T08:03:09Z", "message": "Adding ids to elements in `DateInputWithPicker`."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "8e11046a007edc62c78e8a37c59bb251bc2571f5", "author": {"user": {"login": "dennisoelkers", "name": "Dennis Oelkers"}}, "url": "https://github.com/Graylog2/graylog2-server/commit/8e11046a007edc62c78e8a37c59bb251bc2571f5", "committedDate": "2020-04-16T08:03:10Z", "message": "Typing and reordering validation function in `KeywordTimeRangeSelector`."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c8ab7ec87293507f348c8f0db13cbcffac9e3d5f", "author": {"user": {"login": "dennisoelkers", "name": "Dennis Oelkers"}}, "url": "https://github.com/Graylog2/graylog2-server/commit/c8ab7ec87293507f348c8f0db13cbcffac9e3d5f", "committedDate": "2020-04-16T08:03:10Z", "message": "Making tests for `KeywordTimeRangeSelector` handle asynchronicity."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "9b131dfe9424323d3cce3abca314904b5cfd6023", "author": {"user": {"login": "dennisoelkers", "name": "Dennis Oelkers"}}, "url": "https://github.com/Graylog2/graylog2-server/commit/9b131dfe9424323d3cce3abca314904b5cfd6023", "committedDate": "2020-04-16T08:03:10Z", "message": "Extracting onChange function in `RelativeTimeRangeSelector`."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "5355f50d0deabe020929f72d2607c47cf1f4565b", "author": {"user": {"login": "dennisoelkers", "name": "Dennis Oelkers"}}, "url": "https://github.com/Graylog2/graylog2-server/commit/5355f50d0deabe020929f72d2607c47cf1f4565b", "committedDate": "2020-04-16T08:03:10Z", "message": "Turning `range` parameter into number when submitting."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b8e0dc5e39cd05495a06296a8dcdcab17a0e0f8e", "author": {"user": {"login": "dennisoelkers", "name": "Dennis Oelkers"}}, "url": "https://github.com/Graylog2/graylog2-server/commit/b8e0dc5e39cd05495a06296a8dcdcab17a0e0f8e", "committedDate": "2020-04-16T08:03:10Z", "message": "Adding id to dropdown button element in `TimeRangeTypeSelector`."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ffb8cf185403b17c83aa077827fac0d2f9998e60", "author": {"user": {"login": "dennisoelkers", "name": "Dennis Oelkers"}}, "url": "https://github.com/Graylog2/graylog2-server/commit/ffb8cf185403b17c83aa077827fac0d2f9998e60", "committedDate": "2020-04-16T08:03:10Z", "message": "Fixing tests for `AbsoluteTimeRangeSelector`."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "55f410b85113f4f3244ac9803937b4d78d3805fe", "author": {"user": {"login": "dennisoelkers", "name": "Dennis Oelkers"}}, "url": "https://github.com/Graylog2/graylog2-server/commit/55f410b85113f4f3244ac9803937b4d78d3805fe", "committedDate": "2020-04-16T08:03:11Z", "message": "Validating upon mount."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f1aaaffda7e1d221138ee8c513364bf9d4b3993c", "author": {"user": {"login": "dennisoelkers", "name": "Dennis Oelkers"}}, "url": "https://github.com/Graylog2/graylog2-server/commit/f1aaaffda7e1d221138ee8c513364bf9d4b3993c", "committedDate": "2020-04-16T08:03:11Z", "message": "Parse integer in `RelativeTimeRangeSelector` already."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "91497a922ed2792ce3c18406a48a2d92d91628d6", "author": {"user": {"login": "dennisoelkers", "name": "Dennis Oelkers"}}, "url": "https://github.com/Graylog2/graylog2-server/commit/91497a922ed2792ce3c18406a48a2d92d91628d6", "committedDate": "2020-04-16T08:03:11Z", "message": "Adding missing comma."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c816cb696e1a5995deae1c078e32b4a1195f0a02", "author": {"user": {"login": "dennisoelkers", "name": "Dennis Oelkers"}}, "url": "https://github.com/Graylog2/graylog2-server/commit/c816cb696e1a5995deae1c078e32b4a1195f0a02", "committedDate": "2020-04-16T08:03:11Z", "message": "Fixing flow hints."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "178c03e4e36f1decaf82d7cae1c70a17aabdac7d", "author": {"user": {"login": "dennisoelkers", "name": "Dennis Oelkers"}}, "url": "https://github.com/Graylog2/graylog2-server/commit/178c03e4e36f1decaf82d7cae1c70a17aabdac7d", "committedDate": "2020-04-16T08:03:11Z", "message": "Check if defined to satisfy flow."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "6078f1d59870d58daf8aac2786fbd40ff809d47b", "author": {"user": {"login": "dennisoelkers", "name": "Dennis Oelkers"}}, "url": "https://github.com/Graylog2/graylog2-server/commit/6078f1d59870d58daf8aac2786fbd40ff809d47b", "committedDate": "2020-04-16T08:03:11Z", "message": "Updating formik typedef."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "08101f029aea97d53ec5efa1a9c302e3eb40a55f", "author": {"user": {"login": "dennisoelkers", "name": "Dennis Oelkers"}}, "url": "https://github.com/Graylog2/graylog2-server/commit/08101f029aea97d53ec5efa1a9c302e3eb40a55f", "committedDate": "2020-04-16T08:03:11Z", "message": "Unifying date string handling for absolute time range input."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a505ab224e2002870f53c5735f78d63e45b22be7", "author": {"user": {"login": "dennisoelkers", "name": "Dennis Oelkers"}}, "url": "https://github.com/Graylog2/graylog2-server/commit/a505ab224e2002870f53c5735f78d63e45b22be7", "committedDate": "2020-04-16T08:03:11Z", "message": "Making react-ace testable."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "afb021d6bb4339509e3a88d29f7b29db2759e84f", "author": {"user": {"login": "dennisoelkers", "name": "Dennis Oelkers"}}, "url": "https://github.com/Graylog2/graylog2-server/commit/afb021d6bb4339509e3a88d29f7b29db2759e84f", "committedDate": "2020-04-16T08:03:11Z", "message": "Add action to set new timerange & query for global override together."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "dee08251c47aa6b23d3a7671f99b52dfcfd125cb", "author": {"user": {"login": "dennisoelkers", "name": "Dennis Oelkers"}}, "url": "https://github.com/Graylog2/graylog2-server/commit/dee08251c47aa6b23d3a7671f99b52dfcfd125cb", "committedDate": "2020-04-16T08:03:12Z", "message": "Set timerange & query together from `DashboardSearchBar`."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "860059cded1303f73c0c47ed28e445781d161c54", "author": {"user": {"login": "dennisoelkers", "name": "Dennis Oelkers"}}, "url": "https://github.com/Graylog2/graylog2-server/commit/860059cded1303f73c0c47ed28e445781d161c54", "committedDate": "2020-04-16T08:03:12Z", "message": "Add dirty flags to search buttons."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "92a0bdaa2dde5b1ef03afb0d09f7642f77251fab", "author": {"user": {"login": "dennisoelkers", "name": "Dennis Oelkers"}}, "url": "https://github.com/Graylog2/graylog2-server/commit/92a0bdaa2dde5b1ef03afb0d09f7642f77251fab", "committedDate": "2020-04-16T08:03:12Z", "message": "Removing now unneeded ace setting."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "968d9688ca2d82d3e0905be841e0991a87f6de39", "author": {"user": {"login": "dennisoelkers", "name": "Dennis Oelkers"}}, "url": "https://github.com/Graylog2/graylog2-server/commit/968d9688ca2d82d3e0905be841e0991a87f6de39", "committedDate": "2020-04-16T08:03:12Z", "message": "Inlining field handling, extracting timerange migration function."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "7f96fb9edde563f6625f4559e1e23f52a73ae6a5", "author": {"user": {"login": "dennisoelkers", "name": "Dennis Oelkers"}}, "url": "https://github.com/Graylog2/graylog2-server/commit/7f96fb9edde563f6625f4559e1e23f52a73ae6a5", "committedDate": "2020-04-16T08:03:12Z", "message": "Adding tests for `DashboardSearchForm`."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "dd9d4e4f43cafbd2affcd125449eb3c7d48140f3", "author": {"user": {"login": "dennisoelkers", "name": "Dennis Oelkers"}}, "url": "https://github.com/Graylog2/graylog2-server/commit/dd9d4e4f43cafbd2affcd125449eb3c7d48140f3", "committedDate": "2020-04-16T08:03:12Z", "message": "Fixing linter hints."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "95ed22d2da59aa485625f7c1fccc589431f30936", "author": {"user": {"login": "dennisoelkers", "name": "Dennis Oelkers"}}, "url": "https://github.com/Graylog2/graylog2-server/commit/95ed22d2da59aa485625f7c1fccc589431f30936", "committedDate": "2020-04-16T08:03:12Z", "message": "Removing unused store actions."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "bf5639f4cb3909ddde26fe08937e6a8ec7b8f513", "author": {"user": {"login": "dennisoelkers", "name": "Dennis Oelkers"}}, "url": "https://github.com/Graylog2/graylog2-server/commit/bf5639f4cb3909ddde26fe08937e6a8ec7b8f513", "committedDate": "2020-04-16T08:03:12Z", "message": "Adding tests for `DateInputWithPicker`."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "29b467308c6bb9fcda19cfa87844d6803e83bc26", "author": {"user": {"login": "dennisoelkers", "name": "Dennis Oelkers"}}, "url": "https://github.com/Graylog2/graylog2-server/commit/29b467308c6bb9fcda19cfa87844d6803e83bc26", "committedDate": "2020-04-16T08:03:13Z", "message": "Fixing linter hints."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "1c47b834df199c0402d3845acc2e50b3e5585a60", "author": {"user": {"login": "dennisoelkers", "name": "Dennis Oelkers"}}, "url": "https://github.com/Graylog2/graylog2-server/commit/1c47b834df199c0402d3845acc2e50b3e5585a60", "committedDate": "2020-04-16T08:03:13Z", "message": "Change test title."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e04aa96bb3ed9dc0bbfcc86a31ba3768bf43caa6", "author": {"user": {"login": "dennisoelkers", "name": "Dennis Oelkers"}}, "url": "https://github.com/Graylog2/graylog2-server/commit/e04aa96bb3ed9dc0bbfcc86a31ba3768bf43caa6", "committedDate": "2020-04-16T08:03:13Z", "message": "Consider timezone in tests."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "94f7d213076ea5c89dba623eac33e971bbaf036b", "author": {"user": {"login": "dennisoelkers", "name": "Dennis Oelkers"}}, "url": "https://github.com/Graylog2/graylog2-server/commit/94f7d213076ea5c89dba623eac33e971bbaf036b", "committedDate": "2020-04-16T08:03:13Z", "message": "Fixing the expectation."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c47448a5f641b823dd023186082ed652b6cc4809", "author": {"user": {"login": "dennisoelkers", "name": "Dennis Oelkers"}}, "url": "https://github.com/Graylog2/graylog2-server/commit/c47448a5f641b823dd023186082ed652b6cc4809", "committedDate": "2020-04-16T08:03:13Z", "message": "Changing relative time range does not execute search."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "98892582d3d72cabdcbbbf2652f08b4c097d4ace", "author": {"user": {"login": "dennisoelkers", "name": "Dennis Oelkers"}}, "url": "https://github.com/Graylog2/graylog2-server/commit/98892582d3d72cabdcbbbf2652f08b4c097d4ace", "committedDate": "2020-04-16T08:03:13Z", "message": "Returning promise in onChange handlers to prevent exception."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "1dc43f51b0ce679f6d7e33f0f66ed2b6a51170e0", "author": {"user": {"login": "dennisoelkers", "name": "Dennis Oelkers"}}, "url": "https://github.com/Graylog2/graylog2-server/commit/1dc43f51b0ce679f6d7e33f0f66ed2b6a51170e0", "committedDate": "2020-04-16T08:39:55Z", "message": "Updating snapshots after rebase."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "423cf9f52d54c790237edf67430f89b85360f332", "author": {"user": {"login": "dennisoelkers", "name": "Dennis Oelkers"}}, "url": "https://github.com/Graylog2/graylog2-server/commit/423cf9f52d54c790237edf67430f89b85360f332", "committedDate": "2020-04-16T09:07:17Z", "message": "Fixing sync with query parameters."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "9545526c61e75471bebf803242d336cc0d006fef", "author": {"user": {"login": "dennisoelkers", "name": "Dennis Oelkers"}}, "url": "https://github.com/Graylog2/graylog2-server/commit/9545526c61e75471bebf803242d336cc0d006fef", "committedDate": "2020-04-16T09:26:51Z", "message": "Replacing deprecated glyph names."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "1ff2800a1843b1249e9b2ea555edcecaf29ad0bb", "author": {"user": {"login": "dennisoelkers", "name": "Dennis Oelkers"}}, "url": "https://github.com/Graylog2/graylog2-server/commit/1ff2800a1843b1249e9b2ea555edcecaf29ad0bb", "committedDate": "2020-04-16T09:43:00Z", "message": "Updating test for `useSyncWithQueryParameters`."}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "cea25d4b47af90646704ff825d59e420e966c69d", "author": {"user": {"login": "dennisoelkers", "name": "Dennis Oelkers"}}, "url": "https://github.com/Graylog2/graylog2-server/commit/cea25d4b47af90646704ff825d59e420e966c69d", "committedDate": "2020-04-15T15:07:12Z", "message": "Returning promise in onChange handlers to prevent exception."}, "afterCommit": {"oid": "1ff2800a1843b1249e9b2ea555edcecaf29ad0bb", "author": {"user": {"login": "dennisoelkers", "name": "Dennis Oelkers"}}, "url": "https://github.com/Graylog2/graylog2-server/commit/1ff2800a1843b1249e9b2ea555edcecaf29ad0bb", "committedDate": "2020-04-16T09:43:00Z", "message": "Updating test for `useSyncWithQueryParameters`."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzk0NTQyMDU3", "url": "https://github.com/Graylog2/graylog2-server/pull/7829#pullrequestreview-394542057", "createdAt": "2020-04-16T11:29:57Z", "commit": {"oid": "1ff2800a1843b1249e9b2ea555edcecaf29ad0bb"}, "state": "COMMENTED", "comments": {"totalCount": 9, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xNlQxMToyOTo1N1rOGGg7Iw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xNlQxMjoyOTo0NVrOGGi6LQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwOTQ4NDA2Nw==", "bodyText": "values can be typed as well.", "url": "https://github.com/Graylog2/graylog2-server/pull/7829#discussion_r409484067", "createdAt": "2020-04-16T11:29:57Z", "author": {"login": "linuspahl"}, "path": "graylog2-web-interface/src/views/components/WidgetQueryControls.jsx", "diffHunk": "@@ -105,56 +68,77 @@ const ResetOverrideHint = () => (\n   </CenteredBox>\n );\n \n+const onSubmit = (values, widget: Widget) => {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "1ff2800a1843b1249e9b2ea555edcecaf29ad0bb"}, "originalPosition": 80}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwOTQ4NjM3Nw==", "bodyText": "The propTypes can be removed.", "url": "https://github.com/Graylog2/graylog2-server/pull/7829#discussion_r409486377", "createdAt": "2020-04-16T11:34:34Z", "author": {"login": "linuspahl"}, "path": "graylog2-web-interface/src/views/components/searchbar/TimeRangeOverrideTypeSelector.jsx", "diffHunk": "@@ -1,42 +1,48 @@\n-import React from 'react';\n+// @flow strict\n+import * as React from 'react';\n+import { useCallback } from 'react';\n+import { useField } from 'formik';\n \n import { ButtonToolbar, DropdownButton, MenuItem } from 'components/graylog';\n import { Icon } from 'components/common';\n-import PropTypes from 'views/components/CustomPropTypes';\n+import { migrateTimeRangeToNewType } from '../TimerangeForForm';\n \n-const TimeRangeOverrideTypeSelector = ({ onSelect, value }) => (\n-  <ButtonToolbar className=\"extended-search-timerange-chooser pull-left\">\n-    <DropdownButton bsStyle=\"info\"\n-                    title={<Icon name=\"clock-o\" />}\n-                    onSelect={onSelect}\n-                    id=\"dropdown-timerange-selector\">\n-      <MenuItem eventKey=\"disabled\"\n-                active={value === undefined}>\n-        No Override\n-      </MenuItem>\n-      <MenuItem eventKey=\"relative\"\n-                active={value === 'relative'}>\n-        Relative\n-      </MenuItem>\n-      <MenuItem eventKey=\"absolute\"\n-                active={value === 'absolute'}>\n-        Absolute\n-      </MenuItem>\n-      <MenuItem eventKey=\"keyword\"\n-                active={value === 'keyword'}>\n-        Keyword\n-      </MenuItem>\n-    </DropdownButton>\n-  </ButtonToolbar>\n-);\n-\n-TimeRangeOverrideTypeSelector.propTypes = {\n-  onSelect: PropTypes.func.isRequired,\n-  value: PropTypes.TimeRangeType,\n+const TimeRangeOverrideTypeSelector = () => {\n+  const [{ value, onChange, name }] = useField('timerange');\n+  const { type } = value || {};\n+  const onSelect = useCallback((newType) => onChange({\n+    target: {\n+      value: migrateTimeRangeToNewType(value, newType),\n+      name,\n+    },\n+  }), [onChange, value]);\n+  return (\n+    <ButtonToolbar className=\"extended-search-timerange-chooser pull-left\">\n+      <DropdownButton bsStyle=\"info\"\n+                      title={<Icon name=\"clock\" />}\n+                      onSelect={onSelect}\n+                      id=\"dropdown-timerange-selector\">\n+        <MenuItem eventKey=\"disabled\"\n+                  active={type === undefined}>\n+          No Override\n+        </MenuItem>\n+        <MenuItem eventKey=\"relative\"\n+                  active={type === 'relative'}>\n+          Relative\n+        </MenuItem>\n+        <MenuItem eventKey=\"absolute\"\n+                  active={type === 'absolute'}>\n+          Absolute\n+        </MenuItem>\n+        <MenuItem eventKey=\"keyword\"\n+                  active={type === 'keyword'}>\n+          Keyword\n+        </MenuItem>\n+      </DropdownButton>\n+    </ButtonToolbar>\n+  );\n };\n \n-TimeRangeOverrideTypeSelector.defaultProps = {\n-  value: undefined,\n-};\n+TimeRangeOverrideTypeSelector.propTypes = {};", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "1ff2800a1843b1249e9b2ea555edcecaf29ad0bb"}, "originalPosition": 80}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwOTQ4ODE5Mg==", "bodyText": "We could extract the default options relative, absolute and keyword in a component which can be used for TimeRangeOverrideTypeSelector and TimeRangeTypeSelector", "url": "https://github.com/Graylog2/graylog2-server/pull/7829#discussion_r409488192", "createdAt": "2020-04-16T11:38:14Z", "author": {"login": "linuspahl"}, "path": "graylog2-web-interface/src/views/components/searchbar/TimeRangeOverrideTypeSelector.jsx", "diffHunk": "@@ -1,42 +1,48 @@\n-import React from 'react';\n+// @flow strict\n+import * as React from 'react';\n+import { useCallback } from 'react';\n+import { useField } from 'formik';\n \n import { ButtonToolbar, DropdownButton, MenuItem } from 'components/graylog';\n import { Icon } from 'components/common';\n-import PropTypes from 'views/components/CustomPropTypes';\n+import { migrateTimeRangeToNewType } from '../TimerangeForForm';\n \n-const TimeRangeOverrideTypeSelector = ({ onSelect, value }) => (\n-  <ButtonToolbar className=\"extended-search-timerange-chooser pull-left\">\n-    <DropdownButton bsStyle=\"info\"\n-                    title={<Icon name=\"clock-o\" />}\n-                    onSelect={onSelect}\n-                    id=\"dropdown-timerange-selector\">\n-      <MenuItem eventKey=\"disabled\"\n-                active={value === undefined}>\n-        No Override\n-      </MenuItem>\n-      <MenuItem eventKey=\"relative\"\n-                active={value === 'relative'}>\n-        Relative\n-      </MenuItem>\n-      <MenuItem eventKey=\"absolute\"\n-                active={value === 'absolute'}>\n-        Absolute\n-      </MenuItem>\n-      <MenuItem eventKey=\"keyword\"\n-                active={value === 'keyword'}>\n-        Keyword\n-      </MenuItem>\n-    </DropdownButton>\n-  </ButtonToolbar>\n-);\n-\n-TimeRangeOverrideTypeSelector.propTypes = {\n-  onSelect: PropTypes.func.isRequired,\n-  value: PropTypes.TimeRangeType,\n+const TimeRangeOverrideTypeSelector = () => {\n+  const [{ value, onChange, name }] = useField('timerange');\n+  const { type } = value || {};\n+  const onSelect = useCallback((newType) => onChange({\n+    target: {\n+      value: migrateTimeRangeToNewType(value, newType),\n+      name,\n+    },\n+  }), [onChange, value]);\n+  return (\n+    <ButtonToolbar className=\"extended-search-timerange-chooser pull-left\">\n+      <DropdownButton bsStyle=\"info\"\n+                      title={<Icon name=\"clock\" />}\n+                      onSelect={onSelect}\n+                      id=\"dropdown-timerange-selector\">\n+        <MenuItem eventKey=\"disabled\"\n+                  active={type === undefined}>\n+          No Override\n+        </MenuItem>\n+        <MenuItem eventKey=\"relative\"\n+                  active={type === 'relative'}>\n+          Relative\n+        </MenuItem>\n+        <MenuItem eventKey=\"absolute\"\n+                  active={type === 'absolute'}>\n+          Absolute\n+        </MenuItem>\n+        <MenuItem eventKey=\"keyword\"\n+                  active={type === 'keyword'}>\n+          Keyword\n+        </MenuItem>", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "1ff2800a1843b1249e9b2ea555edcecaf29ad0bb"}, "originalPosition": 71}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwOTQ5MTYzOQ==", "bodyText": "This check is not really necessary, because timerangeStrategies[undefined] is falsy as well. Or do you just prefer being explicit?", "url": "https://github.com/Graylog2/graylog2-server/pull/7829#discussion_r409491639", "createdAt": "2020-04-16T11:44:51Z", "author": {"login": "linuspahl"}, "path": "graylog2-web-interface/src/views/components/searchbar/TimeRangeInput.jsx", "diffHunk": "@@ -1,31 +1,50 @@\n-import React from 'react';\n+// @flow strict\n+import * as React from 'react';\n import PropTypes from 'prop-types';\n+import { useField } from 'formik';\n \n-import RelativeTimeRangeSelector from 'views/components/searchbar/RelativeTimeRangeSelector';\n+import type { SearchesConfig } from 'components/search/SearchConfig';\n import AbsoluteTimeRangeSelector from 'views/components/searchbar/AbsoluteTimeRangeSelector';\n import KeywordTimeRangeSelector from 'views/components/searchbar/KeywordTimeRangeSelector';\n+import RelativeTimeRangeSelector from 'views/components/searchbar/RelativeTimeRangeSelector';\n+import DisabledTimeRangeSelector from './DisabledTimeRangeSelector';\n \n-export default function TimeRangeInput({ disabled, rangeType, rangeParams, config, onChange }) {\n-  switch (rangeType) {\n-    case 'relative':\n-      return <RelativeTimeRangeSelector disabled={disabled} value={rangeParams} config={config} onChange={onChange} />;\n-    case 'absolute':\n-      return <AbsoluteTimeRangeSelector disabled={disabled} value={rangeParams} onChange={onChange} />;\n-    case 'keyword':\n-      return <KeywordTimeRangeSelector disabled={disabled} value={rangeParams} onChange={onChange} />;\n-    default:\n-      throw new Error(`Unsupported range type ${rangeType}`);\n+type Props = {\n+  disabled: boolean,\n+  config: SearchesConfig,\n+};\n+\n+const timerangeStrategies = {\n+  absolute: {\n+    component: AbsoluteTimeRangeSelector,\n+  },\n+  relative: {\n+    component: RelativeTimeRangeSelector,\n+  },\n+  keyword: {\n+    component: KeywordTimeRangeSelector,\n+  },\n+};\n+\n+const timerangeStrategy = (type) => {\n+  if (type === undefined) {\n+    return { component: DisabledTimeRangeSelector };\n   }", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "1ff2800a1843b1249e9b2ea555edcecaf29ad0bb"}, "originalPosition": 44}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwOTUwMjU2Ng==", "bodyText": "We can type the param type here as well.", "url": "https://github.com/Graylog2/graylog2-server/pull/7829#discussion_r409502566", "createdAt": "2020-04-16T12:05:17Z", "author": {"login": "linuspahl"}, "path": "graylog2-web-interface/src/views/components/searchbar/TimeRangeInput.jsx", "diffHunk": "@@ -1,31 +1,50 @@\n-import React from 'react';\n+// @flow strict\n+import * as React from 'react';\n import PropTypes from 'prop-types';\n+import { useField } from 'formik';\n \n-import RelativeTimeRangeSelector from 'views/components/searchbar/RelativeTimeRangeSelector';\n+import type { SearchesConfig } from 'components/search/SearchConfig';\n import AbsoluteTimeRangeSelector from 'views/components/searchbar/AbsoluteTimeRangeSelector';\n import KeywordTimeRangeSelector from 'views/components/searchbar/KeywordTimeRangeSelector';\n+import RelativeTimeRangeSelector from 'views/components/searchbar/RelativeTimeRangeSelector';\n+import DisabledTimeRangeSelector from './DisabledTimeRangeSelector';\n \n-export default function TimeRangeInput({ disabled, rangeType, rangeParams, config, onChange }) {\n-  switch (rangeType) {\n-    case 'relative':\n-      return <RelativeTimeRangeSelector disabled={disabled} value={rangeParams} config={config} onChange={onChange} />;\n-    case 'absolute':\n-      return <AbsoluteTimeRangeSelector disabled={disabled} value={rangeParams} onChange={onChange} />;\n-    case 'keyword':\n-      return <KeywordTimeRangeSelector disabled={disabled} value={rangeParams} onChange={onChange} />;\n-    default:\n-      throw new Error(`Unsupported range type ${rangeType}`);\n+type Props = {\n+  disabled: boolean,\n+  config: SearchesConfig,\n+};\n+\n+const timerangeStrategies = {\n+  absolute: {\n+    component: AbsoluteTimeRangeSelector,\n+  },\n+  relative: {\n+    component: RelativeTimeRangeSelector,\n+  },\n+  keyword: {\n+    component: KeywordTimeRangeSelector,\n+  },\n+};\n+\n+const timerangeStrategy = (type) => {\n+  if (type === undefined) {\n+    return { component: DisabledTimeRangeSelector };\n   }", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwOTQ5MTYzOQ=="}, "originalCommit": {"oid": "1ff2800a1843b1249e9b2ea555edcecaf29ad0bb"}, "originalPosition": 44}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwOTUwNDc2OQ==", "bodyText": "We are checking if the provided type exists in comparable cases, let's check it here as well.", "url": "https://github.com/Graylog2/graylog2-server/pull/7829#discussion_r409504769", "createdAt": "2020-04-16T12:09:29Z", "author": {"login": "linuspahl"}, "path": "graylog2-web-interface/src/views/components/TimerangeForForm.js", "diffHunk": "@@ -0,0 +1,66 @@\n+// @flow strict\n+import moment from 'moment';\n+\n+import DateTime from 'logic/datetimes/DateTime';\n+import type { TimeRange } from 'views/logic/queries/Query';\n+\n+const formatDatetime = (datetime) => datetime.toString(DateTime.Formats.TIMESTAMP);\n+\n+export const onSubmittingTimerange = (timerange: TimeRange): TimeRange => {\n+  switch (timerange.type) {\n+    case 'absolute':\n+      return {\n+        type: timerange.type,\n+        from: DateTime.parseFromString(timerange.from).toISOString(),\n+        to: DateTime.parseFromString(timerange.to).toISOString(),\n+      };\n+    case 'relative':\n+      return {\n+        type: timerange.type,\n+        range: timerange.range,\n+      };\n+    case 'keyword':\n+      return timerange;\n+    default: throw new Error(`Invalid time range type: ${timerange.type}`);\n+  }\n+};\n+\n+export const onInitializingTimerange = (timerange: TimeRange): TimeRange => {\n+  switch (timerange.type) {\n+    case 'absolute':\n+      return {\n+        type: timerange.type,\n+        from: formatDatetime(DateTime.parseFromString(timerange.from)),\n+        to: formatDatetime(DateTime.parseFromString(timerange.to)),\n+      };\n+    case 'relative':\n+      return {\n+        type: timerange.type,\n+        range: timerange.range,\n+      };\n+    case 'keyword':\n+      return timerange;\n+    default: throw new Error(`Invalid time range type: ${timerange.type}`);\n+  }\n+};\n+\n+const migrationStrategies = {\n+  absolute: (oldTimerange: ?TimeRange) => ({\n+    type: 'absolute',\n+    from: formatDatetime(new DateTime(moment().subtract((oldTimerange && oldTimerange.type === 'relative') ? oldTimerange.range : 300, 'seconds'))),\n+    to: formatDatetime(new DateTime(moment())),\n+  }),\n+  relative: () => ({ type: 'relative', range: 300 }),\n+  keyword: () => ({ type: 'keyword', keyword: 'Last five minutes' }),\n+  disabled: () => undefined,\n+};\n+\n+export const migrateTimeRangeToNewType = (oldTimerange: ?TimeRange, type: string): ?TimeRange => {\n+  const oldType = oldTimerange ? oldTimerange.type : 'disabled';\n+\n+  if (type === oldType) {\n+    return oldTimerange;\n+  }\n+\n+  return migrationStrategies[type](oldTimerange);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "1ff2800a1843b1249e9b2ea555edcecaf29ad0bb"}, "originalPosition": 65}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwOTUwNzY2Ng==", "bodyText": "Something for a follow up PR: We should add this color to our theme.", "url": "https://github.com/Graylog2/graylog2-server/pull/7829#discussion_r409507666", "createdAt": "2020-04-16T12:14:44Z", "author": {"login": "linuspahl"}, "path": "graylog2-web-interface/src/views/components/searchbar/SearchButton.jsx", "diffHunk": "@@ -1,24 +1,60 @@\n+// @flow strict\n import React from 'react';\n import PropTypes from 'prop-types';\n+import styled from 'styled-components';\n+import type { StyledComponent } from 'styled-components';\n \n import { Button } from 'components/graylog';\n import { Spinner, Icon } from 'components/common';\n+import type { ThemeInterface } from 'theme/index';\n \n-const SearchButton = ({ running, disabled, glyph }) => (\n-  <Button type=\"submit\" bsStyle={running ? 'warning' : 'success'} disabled={disabled} className=\"pull-left search-button-execute\">\n-    {running ? <Spinner fixedWidth pulse text=\"\" /> : <Icon name={glyph} /> }\n-  </Button>\n-);\n+const DirtyButton: StyledComponent<{}, ThemeInterface, any> = styled(Button)`\n+  position: relative;\n+\n+  ::after {\n+    position: absolute;\n+    content: '';\n+    height: 16px;\n+    width: 16px;\n+    top: -5px;\n+    right: -6px;\n+    border-radius: 50%;\n+    background-color: #ffc107;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "1ff2800a1843b1249e9b2ea555edcecaf29ad0bb"}, "originalPosition": 27}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwOTUxMTcwMA==", "bodyText": "Not related to this PR, but we are never defining the running prop. Are we not using the button loading state, because of to the global loading indicator?", "url": "https://github.com/Graylog2/graylog2-server/pull/7829#discussion_r409511700", "createdAt": "2020-04-16T12:21:31Z", "author": {"login": "linuspahl"}, "path": "graylog2-web-interface/src/views/components/searchbar/SearchButton.jsx", "diffHunk": "@@ -1,24 +1,60 @@\n+// @flow strict\n import React from 'react';\n import PropTypes from 'prop-types';\n+import styled from 'styled-components';\n+import type { StyledComponent } from 'styled-components';\n \n import { Button } from 'components/graylog';\n import { Spinner, Icon } from 'components/common';\n+import type { ThemeInterface } from 'theme/index';\n \n-const SearchButton = ({ running, disabled, glyph }) => (\n-  <Button type=\"submit\" bsStyle={running ? 'warning' : 'success'} disabled={disabled} className=\"pull-left search-button-execute\">\n-    {running ? <Spinner fixedWidth pulse text=\"\" /> : <Icon name={glyph} /> }\n-  </Button>\n-);\n+const DirtyButton: StyledComponent<{}, ThemeInterface, any> = styled(Button)`\n+  position: relative;\n+\n+  ::after {\n+    position: absolute;\n+    content: '';\n+    height: 16px;\n+    width: 16px;\n+    top: -5px;\n+    right: -6px;\n+    border-radius: 50%;\n+    background-color: #ffc107;\n+  }\n+`;\n+\n+type Props = {\n+  running: boolean,\n+  disabled: boolean,\n+  glyph: string,\n+  dirty: boolean,\n+};\n+\n+const SearchButton = ({ running, disabled, glyph, dirty }: Props) => {\n+  const ButtonComponent = dirty ? DirtyButton : Button;\n+  const title = dirty ? 'Perform search (changes were made after last search execution)' : 'Perform search';\n+  return (\n+    <ButtonComponent type=\"submit\"\n+                     bsStyle={running ? 'warning' : 'success'}\n+                     disabled={disabled}\n+                     title={title}\n+                     className=\"pull-left search-button-execute\">\n+      {running ? <Spinner fixedWidth pulse text=\"\" /> : <Icon name={glyph} />}", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "1ff2800a1843b1249e9b2ea555edcecaf29ad0bb"}, "originalPosition": 47}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwOTUxNjU4OQ==", "bodyText": "There is no immediate benefit, but any can be replaces with HTMLButtonElement", "url": "https://github.com/Graylog2/graylog2-server/pull/7829#discussion_r409516589", "createdAt": "2020-04-16T12:29:45Z", "author": {"login": "linuspahl"}, "path": "graylog2-web-interface/src/views/components/searchbar/SearchButton.jsx", "diffHunk": "@@ -1,24 +1,60 @@\n+// @flow strict\n import React from 'react';\n import PropTypes from 'prop-types';\n+import styled from 'styled-components';\n+import type { StyledComponent } from 'styled-components';\n \n import { Button } from 'components/graylog';\n import { Spinner, Icon } from 'components/common';\n+import type { ThemeInterface } from 'theme/index';\n \n-const SearchButton = ({ running, disabled, glyph }) => (\n-  <Button type=\"submit\" bsStyle={running ? 'warning' : 'success'} disabled={disabled} className=\"pull-left search-button-execute\">\n-    {running ? <Spinner fixedWidth pulse text=\"\" /> : <Icon name={glyph} /> }\n-  </Button>\n-);\n+const DirtyButton: StyledComponent<{}, ThemeInterface, any> = styled(Button)`", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "1ff2800a1843b1249e9b2ea555edcecaf29ad0bb"}, "originalPosition": 16}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ceecead2158c750530a8fe46468a5572fb35f4d5", "author": {"user": {"login": "dennisoelkers", "name": "Dennis Oelkers"}}, "url": "https://github.com/Graylog2/graylog2-server/commit/ceecead2158c750530a8fe46468a5572fb35f4d5", "committedDate": "2020-04-16T14:42:17Z", "message": "Removing obsolete `running` prop."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "74de1f26b5502a41217b014c39500f9c31e2cc2e", "author": {"user": {"login": "dennisoelkers", "name": "Dennis Oelkers"}}, "url": "https://github.com/Graylog2/graylog2-server/commit/74de1f26b5502a41217b014c39500f9c31e2cc2e", "committedDate": "2020-04-16T14:45:00Z", "message": "Throwing exception for invalid time range type."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "1ebf08d7c7bdf92344d9192eb72f224d6c731787", "author": {"user": {"login": "dennisoelkers", "name": "Dennis Oelkers"}}, "url": "https://github.com/Graylog2/graylog2-server/commit/1ebf08d7c7bdf92344d9192eb72f224d6c731787", "committedDate": "2020-04-16T14:48:37Z", "message": "Extracting shared time range type selector menu items."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "78f1016ef71d526f270e2b1d8c024edfa398a96b", "author": {"user": {"login": "dennisoelkers", "name": "Dennis Oelkers"}}, "url": "https://github.com/Graylog2/graylog2-server/commit/78f1016ef71d526f270e2b1d8c024edfa398a96b", "committedDate": "2020-04-16T14:49:52Z", "message": "Removing unused imports."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "9fdf87812150bdd17d65b75c7686a5ce61f5c464", "author": {"user": {"login": "dennisoelkers", "name": "Dennis Oelkers"}}, "url": "https://github.com/Graylog2/graylog2-server/commit/9fdf87812150bdd17d65b75c7686a5ce61f5c464", "committedDate": "2020-04-16T14:51:26Z", "message": "Cleaning up styled components type annotations."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b7017b9f02b6ce8f5e23298da4855d4e44bdf4bd", "author": {"user": {"login": "dennisoelkers", "name": "Dennis Oelkers"}}, "url": "https://github.com/Graylog2/graylog2-server/commit/b7017b9f02b6ce8f5e23298da4855d4e44bdf4bd", "committedDate": "2020-04-16T14:56:07Z", "message": "Typing parameter properly."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e5d665dd34b768437dc4211dd272234a50643fce", "author": {"user": {"login": "dennisoelkers", "name": "Dennis Oelkers"}}, "url": "https://github.com/Graylog2/graylog2-server/commit/e5d665dd34b768437dc4211dd272234a50643fce", "committedDate": "2020-04-17T07:55:59Z", "message": "Replacing React component for shared type selector items with function.\n\nIn a previous commit, commonly used time range type selector items were\nextracted into a component named `TimeRangeTypeMenuItems`. Unfortunately,\nwrapping children of the `DropdownButton` in an intermediate component\nbreaks adding event handlers to them through the parent component.\nTherefore, this commit is turning the component into a function that is\nreturning the shared menu items."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "5b2094af17e303d3d12cbc15c3af1d03bb7b76a6", "author": {"user": {"login": "dennisoelkers", "name": "Dennis Oelkers"}}, "url": "https://github.com/Graylog2/graylog2-server/commit/5b2094af17e303d3d12cbc15c3af1d03bb7b76a6", "committedDate": "2020-04-17T10:32:05Z", "message": "Typing map result explicitly."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzk1Mzg5MDE3", "url": "https://github.com/Graylog2/graylog2-server/pull/7829#pullrequestreview-395389017", "createdAt": "2020-04-17T11:54:26Z", "commit": {"oid": "5b2094af17e303d3d12cbc15c3af1d03bb7b76a6"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzk1NDA0MTc1", "url": "https://github.com/Graylog2/graylog2-server/pull/7829#pullrequestreview-395404175", "createdAt": "2020-04-17T12:20:02Z", "commit": {"oid": "5b2094af17e303d3d12cbc15c3af1d03bb7b76a6"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2497, "cost": 1, "resetAt": "2021-10-28T18:54:27Z"}}}