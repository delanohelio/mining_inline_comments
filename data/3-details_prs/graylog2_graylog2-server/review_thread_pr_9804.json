{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTQwMjU1NDQ0", "number": 9804, "reviewThreads": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xNlQwODo0NDo0NlrOFGEsTg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xNlQwODo0NjowMFrOFGEuSw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzQxOTEyNjU0OnYy", "diffSide": "RIGHT", "path": "graylog2-server/src/main/java/org/graylog/scheduler/JobSchedulerService.java", "isResolved": true, "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xNlQwODo0NDo0NlrOIG6C0A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xNlQwODo1ODoxMVrOIG6mQg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NDExMzM2MA==", "bodyText": "Hmm,  why do we need this?\nThe thread is already interrupted. Or am I missing something?", "url": "https://github.com/Graylog2/graylog2-server/pull/9804#discussion_r544113360", "createdAt": "2020-12-16T08:44:46Z", "author": {"login": "mpfz0r"}, "path": "graylog2-server/src/main/java/org/graylog/scheduler/JobSchedulerService.java", "diffHunk": "@@ -69,14 +70,21 @@ public JobSchedulerService(JobExecutionEngine.Factory engineFactory,\n     @Override\n     protected void startUp() throws Exception {\n         schedulerEventBus.register(this);\n+        this.executionThread = Thread.currentThread();\n     }\n \n     @Override\n     protected void run() throws Exception {\n         // Safety measure to make sure everything is started before we start job scheduling.\n         LOG.debug(\"Waiting for server to enter RUNNING status before starting the scheduler loop\");\n-        serverStatus.awaitRunning(() -> LOG.debug(\"Server entered RUNNING state, starting scheduler loop\"));\n-\n+        try {\n+            serverStatus.awaitRunning();\n+        } catch (InterruptedException e) {\n+            Thread.currentThread().interrupt();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "272ff9d9cc0baa35fe6eef4cde740334369216ac"}, "originalPosition": 24}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NDEyMTc4NA==", "bodyText": "Nevermind, found the answer myself. Weird semantics :/", "url": "https://github.com/Graylog2/graylog2-server/pull/9804#discussion_r544121784", "createdAt": "2020-12-16T08:57:17Z", "author": {"login": "mpfz0r"}, "path": "graylog2-server/src/main/java/org/graylog/scheduler/JobSchedulerService.java", "diffHunk": "@@ -69,14 +70,21 @@ public JobSchedulerService(JobExecutionEngine.Factory engineFactory,\n     @Override\n     protected void startUp() throws Exception {\n         schedulerEventBus.register(this);\n+        this.executionThread = Thread.currentThread();\n     }\n \n     @Override\n     protected void run() throws Exception {\n         // Safety measure to make sure everything is started before we start job scheduling.\n         LOG.debug(\"Waiting for server to enter RUNNING status before starting the scheduler loop\");\n-        serverStatus.awaitRunning(() -> LOG.debug(\"Server entered RUNNING state, starting scheduler loop\"));\n-\n+        try {\n+            serverStatus.awaitRunning();\n+        } catch (InterruptedException e) {\n+            Thread.currentThread().interrupt();", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NDExMzM2MA=="}, "originalCommit": {"oid": "272ff9d9cc0baa35fe6eef4cde740334369216ac"}, "originalPosition": 24}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NDEyMjQzNA==", "bodyText": "Are you referring to setting the interrupt flag with Thread.currentThread().interrupt();? In this particular case we don't strictly need it but afaik it's good practice to set the flag when the thread was interrupted to let the caller know about it.", "url": "https://github.com/Graylog2/graylog2-server/pull/9804#discussion_r544122434", "createdAt": "2020-12-16T08:58:11Z", "author": {"login": "thll"}, "path": "graylog2-server/src/main/java/org/graylog/scheduler/JobSchedulerService.java", "diffHunk": "@@ -69,14 +70,21 @@ public JobSchedulerService(JobExecutionEngine.Factory engineFactory,\n     @Override\n     protected void startUp() throws Exception {\n         schedulerEventBus.register(this);\n+        this.executionThread = Thread.currentThread();\n     }\n \n     @Override\n     protected void run() throws Exception {\n         // Safety measure to make sure everything is started before we start job scheduling.\n         LOG.debug(\"Waiting for server to enter RUNNING status before starting the scheduler loop\");\n-        serverStatus.awaitRunning(() -> LOG.debug(\"Server entered RUNNING state, starting scheduler loop\"));\n-\n+        try {\n+            serverStatus.awaitRunning();\n+        } catch (InterruptedException e) {\n+            Thread.currentThread().interrupt();", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NDExMzM2MA=="}, "originalCommit": {"oid": "272ff9d9cc0baa35fe6eef4cde740334369216ac"}, "originalPosition": 24}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzQxOTEzMTYzOnYy", "diffSide": "RIGHT", "path": "graylog2-server/src/main/java/org/graylog2/plugin/ServerStatus.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xNlQwODo0NjowMFrOIG6F0Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xNlQwOTowNjo1N1rOIG68hA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NDExNDEyOQ==", "bodyText": "We could still mark this one @Deprecated\n\n  \n    \n  \n    \n\n  \n  This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters. Learn more about bidirectional Unicode characters\n\n\n  \n\n\n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                public void awaitRunning(final Runnable runnable) {\n          \n          \n            \n                @Deprecated\n          \n          \n            \n                public void awaitRunning(final Runnable runnable) {", "url": "https://github.com/Graylog2/graylog2-server/pull/9804#discussion_r544114129", "createdAt": "2020-12-16T08:46:00Z", "author": {"login": "mpfz0r"}, "path": "graylog2-server/src/main/java/org/graylog2/plugin/ServerStatus.java", "diffHunk": "@@ -149,6 +149,11 @@ public void overrideLoadBalancerThrottled() {\n         publishLifecycle(Lifecycle.OVERRIDE_LB_THROTTLED);\n     }\n \n+    /**\n+     * Blocks until the server enters the RUNNING state and then executes the given Runnable.\n+     * <p>\n+     * <b>This method is not interruptible while waiting for the server to enter the RUNNING state.</b>\n+     */\n     public void awaitRunning(final Runnable runnable) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "272ff9d9cc0baa35fe6eef4cde740334369216ac"}, "originalPosition": 9}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NDEyODEzMg==", "bodyText": "yep, why not", "url": "https://github.com/Graylog2/graylog2-server/pull/9804#discussion_r544128132", "createdAt": "2020-12-16T09:06:57Z", "author": {"login": "thll"}, "path": "graylog2-server/src/main/java/org/graylog2/plugin/ServerStatus.java", "diffHunk": "@@ -149,6 +149,11 @@ public void overrideLoadBalancerThrottled() {\n         publishLifecycle(Lifecycle.OVERRIDE_LB_THROTTLED);\n     }\n \n+    /**\n+     * Blocks until the server enters the RUNNING state and then executes the given Runnable.\n+     * <p>\n+     * <b>This method is not interruptible while waiting for the server to enter the RUNNING state.</b>\n+     */\n     public void awaitRunning(final Runnable runnable) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NDExNDEyOQ=="}, "originalCommit": {"oid": "272ff9d9cc0baa35fe6eef4cde740334369216ac"}, "originalPosition": 9}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4305, "cost": 1, "resetAt": "2021-11-12T20:28:25Z"}}}