{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0MzkwNDg2MDk5", "number": 7709, "title": "Bulk CSV export for views-based searches", "bodyText": "This PR contains the essentials for the new search export as described in #7354.\nThe following requirements will be implemented in follow-up PRs:\n\naudit log\napi docs\ntests for search after requests with multiple Elasticsearch versions\n\nNext steps:\n\nUse the massage table widget name as a title for the CSV export file\nOnly show stream related fields in CSV export modal", "createdAt": "2020-03-18T14:56:59Z", "url": "https://github.com/Graylog2/graylog2-server/pull/7709", "merged": true, "mergeCommit": {"oid": "82d4acab019b35145cabfe291a8043a19d893d8b"}, "closed": true, "closedAt": "2020-04-24T07:41:02Z", "author": {"login": "alex-konn"}, "timelineItems": {"totalCount": 136, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcadwwggH2gAyMzkwNDg2MDk5OjRlNmU3MzFlYTYzOTY1NTEwNTIzODRiZjA1ZWRkOTg5YTlmYzMwNWU=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcashrHgFqTM5OTcxMDgzMg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "4e6e731ea6396551052384bf05edd989a9fc305e", "author": {"user": {"login": "alex-konn", "name": "Alex Konn"}}, "url": "https://github.com/Graylog2/graylog2-server/commit/4e6e731ea6396551052384bf05edd989a9fc305e", "committedDate": "2020-04-23T14:28:37Z", "message": "Pick correct query for search type\n\n... if a search type is specified for the export.\nThe assumption that a search may only have a single Query\nof course doesn't hold for exports from dashboards, where\na search can have multiple.\nPick the single query containing the requested search type instead."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "bcf13214876654184e607443a06724a843a90c0e", "author": {"user": {"login": "alex-konn", "name": "Alex Konn"}}, "url": "https://github.com/Graylog2/graylog2-server/commit/bcf13214876654184e607443a06724a843a90c0e", "committedDate": "2020-04-23T14:28:38Z", "message": "Fix integration test\n\n...to expect the corrected timestamp format"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "10418613328f2fcfaa24d19bc2646da6b0e84a22", "author": {"user": {"login": "linuspahl", "name": "Linus Pahl"}}, "url": "https://github.com/Graylog2/graylog2-server/commit/10418613328f2fcfaa24d19bc2646da6b0e84a22", "committedDate": "2020-04-23T14:28:38Z", "message": "Fix linter warnings and errors"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "65b1c6462f91b9ea70208e5ae253c656dd9d8fca", "author": {"user": {"login": "alex-konn", "name": "Alex Konn"}}, "url": "https://github.com/Graylog2/graylog2-server/commit/65b1c6462f91b9ea70208e5ae253c656dd9d8fca", "committedDate": "2020-04-23T14:28:40Z", "message": "Make ElasticsearchExportBackend keep all fields\n\n...instead of reducing them down to only the requested ones.\nThis is important for decorators. A user might want a field in\nthe result that is added by a decorator based on other fields,\nwhich the user doesn't want to see in the result."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "70b038ade16ff6f66504fe4bfecefcb0cbf9ba99", "author": {"user": {"login": "alex-konn", "name": "Alex Konn"}}, "url": "https://github.com/Graylog2/graylog2-server/commit/70b038ade16ff6f66504fe4bfecefcb0cbf9ba99", "committedDate": "2020-04-23T14:28:40Z", "message": "Remove `MessagesRequest#additionalQueryString`\n\n...and concatenate query strings beforehand, if necessary"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "be9e8fd109bb324c09729fb7a57ebcb49fcd8af4", "author": {"user": {"login": "linuspahl", "name": "Linus Pahl"}}, "url": "https://github.com/Graylog2/graylog2-server/commit/be9e8fd109bb324c09729fb7a57ebcb49fcd8af4", "committedDate": "2020-04-23T14:28:41Z", "message": "Change export limit description"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e6f327070d3c09230f50cefe61983f4ffa1984b0", "author": {"user": {"login": "linuspahl", "name": "Linus Pahl"}}, "url": "https://github.com/Graylog2/graylog2-server/commit/e6f327070d3c09230f50cefe61983f4ffa1984b0", "committedDate": "2020-04-23T14:28:42Z", "message": "Change export setting input labels"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "00c9fc40e3ec51f5641a7c9a5e4159f795dfc000", "author": {"user": {"login": "linuspahl", "name": "Linus Pahl"}}, "url": "https://github.com/Graylog2/graylog2-server/commit/00c9fc40e3ec51f5641a7c9a5e4159f795dfc000", "committedDate": "2020-04-23T14:28:43Z", "message": "Optionally allow creation of custom options when using the Select component"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "6b39dee47aac70706cb6872e909e789fb1c45f1a", "author": {"user": {"login": "linuspahl", "name": "Linus Pahl"}}, "url": "https://github.com/Graylog2/graylog2-server/commit/6b39dee47aac70706cb6872e909e789fb1c45f1a", "committedDate": "2020-04-23T14:28:43Z", "message": "Allow creation of custom fields on CSV export"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "1c0535ae9a783b91a339586a683a8778e1f781e6", "author": {"user": {"login": "linuspahl", "name": "Linus Pahl"}}, "url": "https://github.com/Graylog2/graylog2-server/commit/1c0535ae9a783b91a339586a683a8778e1f781e6", "committedDate": "2020-04-23T14:28:44Z", "message": "Update snapshots and fix CSVExportModal text"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "6e97e0e5e684dec0f5c2a321249cfca65cf43f35", "author": {"user": {"login": "linuspahl", "name": "Linus Pahl"}}, "url": "https://github.com/Graylog2/graylog2-server/commit/6e97e0e5e684dec0f5c2a321249cfca65cf43f35", "committedDate": "2020-04-23T14:28:45Z", "message": "Remove not needed import"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e00ad76f869c616f68f62bae7e46c1170cd00a55", "author": {"user": {"login": "linuspahl", "name": "Linus Pahl"}}, "url": "https://github.com/Graylog2/graylog2-server/commit/e00ad76f869c616f68f62bae7e46c1170cd00a55", "committedDate": "2020-04-23T14:28:45Z", "message": "Remove weak Object type definition"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "667f991672bad15896d1dbef415b3f0b079ee222", "author": {"user": {"login": "linuspahl", "name": "Linus Pahl"}}, "url": "https://github.com/Graylog2/graylog2-server/commit/667f991672bad15896d1dbef415b3f0b079ee222", "committedDate": "2020-04-23T14:28:46Z", "message": "Change text style"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a0cce5853171aa5d44cc1801e40e89337d3b0335", "author": {"user": {"login": "linuspahl", "name": "Linus Pahl"}}, "url": "https://github.com/Graylog2/graylog2-server/commit/a0cce5853171aa5d44cc1801e40e89337d3b0335", "committedDate": "2020-04-23T14:28:46Z", "message": "Always include message field as an initial field in export form"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "8b9bc18207f70ec7706391119c90e58641d05e1a", "author": {"user": {"login": "linuspahl", "name": "Linus Pahl"}}, "url": "https://github.com/Graylog2/graylog2-server/commit/8b9bc18207f70ec7706391119c90e58641d05e1a", "committedDate": "2020-04-23T14:28:47Z", "message": "Adjust sort input description"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "088bae0e2ce3fae2caf5fe0f4d327a7ca5b99024", "author": {"user": {"login": "linuspahl", "name": "Linus Pahl"}}, "url": "https://github.com/Graylog2/graylog2-server/commit/088bae0e2ce3fae2caf5fe0f4d327a7ca5b99024", "committedDate": "2020-04-23T14:28:47Z", "message": "Adjust decorated fields description"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "37a324d7d1c66f90dd13746cfd76afbbdadd9438", "author": {"user": {"login": "linuspahl", "name": "Linus Pahl"}}, "url": "https://github.com/Graylog2/graylog2-server/commit/37a324d7d1c66f90dd13746cfd76afbbdadd9438", "committedDate": "2020-04-23T14:28:48Z", "message": "Fixing typo"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e5ee19fd8f1fc9b7e4ec92c6f6468b3d415601c4", "author": {"user": {"login": "linuspahl", "name": "Linus Pahl"}}, "url": "https://github.com/Graylog2/graylog2-server/commit/e5ee19fd8f1fc9b7e4ec92c6f6468b3d415601c4", "committedDate": "2020-04-23T14:28:49Z", "message": "Fix indentation"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "747df1f601deffb104a5f979ddda83d302fbaa55", "author": {"user": {"login": "linuspahl", "name": "Linus Pahl"}}, "url": "https://github.com/Graylog2/graylog2-server/commit/747df1f601deffb104a5f979ddda83d302fbaa55", "committedDate": "2020-04-23T14:28:49Z", "message": "Disable start download button while export file is being generated"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "717e8ed4b97197f363c8dfba8421b79dab5882de", "author": {"user": {"login": "linuspahl", "name": "Linus Pahl"}}, "url": "https://github.com/Graylog2/graylog2-server/commit/717e8ed4b97197f363c8dfba8421b79dab5882de", "committedDate": "2020-04-23T14:28:50Z", "message": "Revert not needed propTypes placement change"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "1afa2bfc7e5b389658063f42be5e0108ebb4b9ae", "author": {"user": {"login": "linuspahl", "name": "Linus Pahl"}}, "url": "https://github.com/Graylog2/graylog2-server/commit/1afa2bfc7e5b389658063f42be5e0108ebb4b9ae", "committedDate": "2020-04-23T14:28:50Z", "message": "Fix FetchProvider behaviour on unauthorized requests"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "4c8341a7b05cf1e8182311c2871fe7b8ca739ab4", "author": {"user": {"login": "linuspahl", "name": "Linus Pahl"}}, "url": "https://github.com/Graylog2/graylog2-server/commit/4c8341a7b05cf1e8182311c2871fe7b8ca739ab4", "committedDate": "2020-04-23T14:28:51Z", "message": "Close CSVExportModal after finished download"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ab88778046ab8918b3adcb0dba31598ec49a1953", "author": {"user": {"login": "linuspahl", "name": "Linus Pahl"}}, "url": "https://github.com/Graylog2/graylog2-server/commit/ab88778046ab8918b3adcb0dba31598ec49a1953", "committedDate": "2020-04-23T14:28:52Z", "message": "Import * as React when importing react instead of only default"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "53ba1b1c7552a5fc017e6abc9e89cd17fcf920b3", "author": {"user": {"login": "linuspahl", "name": "Linus Pahl"}}, "url": "https://github.com/Graylog2/graylog2-server/commit/53ba1b1c7552a5fc017e6abc9e89cd17fcf920b3", "committedDate": "2020-04-23T14:28:52Z", "message": "Integrate view type specific export start in export strategy"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "fba98af30d3c73261404d457c867e6e1eddfaae1", "author": {"user": {"login": "linuspahl", "name": "Linus Pahl"}}, "url": "https://github.com/Graylog2/graylog2-server/commit/fba98af30d3c73261404d457c867e6e1eddfaae1", "committedDate": "2020-04-23T14:28:53Z", "message": "Refactor Select component structure"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e39abb78a18c8af5d63a4413c55f1b3aa908d998", "author": {"user": {"login": "linuspahl", "name": "Linus Pahl"}}, "url": "https://github.com/Graylog2/graylog2-server/commit/e39abb78a18c8af5d63a4413c55f1b3aa908d998", "committedDate": "2020-04-23T14:28:53Z", "message": "Refactor export filename creation"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "4461ecfb906d7e08cf74678d574c4c2bd0e74cb2", "author": {"user": {"login": "alex-konn", "name": "Alex Konn"}}, "url": "https://github.com/Graylog2/graylog2-server/commit/4461ecfb906d7e08cf74678d574c4c2bd0e74cb2", "committedDate": "2020-04-23T14:28:54Z", "message": "Extract building MessagesRequest to own class\n\nIntroduced CommandFactory to improve the code for building a MessagesRequest from a Search and MessageList (if available)."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "5b3d916366ce7d54b1b0724f54cd006de28aaa01", "author": {"user": {"login": "alex-konn", "name": "Alex Konn"}}, "url": "https://github.com/Graylog2/graylog2-server/commit/5b3d916366ce7d54b1b0724f54cd006de28aaa01", "committedDate": "2020-04-23T14:28:55Z", "message": "Only support ElasticsearchQueryString in export\n\nWe don't have anything else anyway, and this avoids type casting"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "46fbc57d1d15e58b57e5727f413b2aa54cd29892", "author": {"user": {"login": "alex-konn", "name": "Alex Konn"}}, "url": "https://github.com/Graylog2/graylog2-server/commit/46fbc57d1d15e58b57e5727f413b2aa54cd29892", "committedDate": "2020-04-23T14:28:55Z", "message": "Introduce ExportMessagesCommand\n\nHaving a separate class makes it simpler to distinguish what the api accepts from what we need for processing an export.\nMost prominently we want to convert all time ranges to absolute before processing so that we can submit the absolute time range to the audit log exactly as it's executed"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ca387a3f469416f257e718414e2b257506317e8b", "author": {"user": {"login": "alex-konn", "name": "Alex Konn"}}, "url": "https://github.com/Graylog2/graylog2-server/commit/ca387a3f469416f257e718414e2b257506317e8b", "committedDate": "2020-04-23T14:28:56Z", "message": "Add decorators to ExportMessagesCommand\n\nFinding the decorators to apply belongs in CommandFactory. This will also make it simpler to add in support from decorators that are not directly attached to message lists.\nE.g., decorators configured for streams, if we want to use them, or decorators a user might want to specify on API requests."}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "64051a8e1fba15a6308ef3013bc2ebcff505c2df", "author": {"user": {"login": "alex-konn", "name": "Alex Konn"}}, "url": "https://github.com/Graylog2/graylog2-server/commit/64051a8e1fba15a6308ef3013bc2ebcff505c2df", "committedDate": "2020-04-23T12:24:08Z", "message": "Add decorators to ExportMessagesCommand\n\nFinding the decorators to apply belongs in CommandFactory. This will also make it simpler to add in support from decorators that are not directly attached to message lists.\nE.g., decorators configured for streams, if we want to use them, or decorators a user might want to specify on API requests."}, "afterCommit": {"oid": "ca387a3f469416f257e718414e2b257506317e8b", "author": {"user": {"login": "alex-konn", "name": "Alex Konn"}}, "url": "https://github.com/Graylog2/graylog2-server/commit/ca387a3f469416f257e718414e2b257506317e8b", "committedDate": "2020-04-23T14:28:56Z", "message": "Add decorators to ExportMessagesCommand\n\nFinding the decorators to apply belongs in CommandFactory. This will also make it simpler to add in support from decorators that are not directly attached to message lists.\nE.g., decorators configured for streams, if we want to use them, or decorators a user might want to specify on API requests."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "875b602a59663945faae9c6d0ef9db913d0f9234", "author": {"user": {"login": "linuspahl", "name": "Linus Pahl"}}, "url": "https://github.com/Graylog2/graylog2-server/commit/875b602a59663945faae9c6d0ef9db913d0f9234", "committedDate": "2020-04-23T15:24:27Z", "message": "Disable sort direction select if no sort is selected"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e788f442ffabcc0f6f3938736ccb8df3af761582", "author": {"user": {"login": "linuspahl", "name": "Linus Pahl"}}, "url": "https://github.com/Graylog2/graylog2-server/commit/e788f442ffabcc0f6f3938736ccb8df3af761582", "committedDate": "2020-04-23T15:27:38Z", "message": "Only allow export messages limits greater than one"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzk5MjY2MzQ3", "url": "https://github.com/Graylog2/graylog2-server/pull/7709#pullrequestreview-399266347", "createdAt": "2020-04-23T16:21:48Z", "commit": {"oid": "e788f442ffabcc0f6f3938736ccb8df3af761582"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzk5NzEwODMy", "url": "https://github.com/Graylog2/graylog2-server/pull/7709#pullrequestreview-399710832", "createdAt": "2020-04-24T07:40:43Z", "commit": {"oid": "e788f442ffabcc0f6f3938736ccb8df3af761582"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "80287def71c6b9ba0f7b4c3d9dfa3c34c2b5b519", "author": {"user": {"login": "linuspahl", "name": "Linus Pahl"}}, "url": "https://github.com/Graylog2/graylog2-server/commit/80287def71c6b9ba0f7b4c3d9dfa3c34c2b5b519", "committedDate": "2020-03-20T08:47:06Z", "message": "Create MessagesExportUtil for API calls on CSV export"}, "afterCommit": {"oid": "1fdf83c68f703ef5a56522fc8530fbe154bc280f", "author": {"user": {"login": "linuspahl", "name": "Linus Pahl"}}, "url": "https://github.com/Graylog2/graylog2-server/commit/1fdf83c68f703ef5a56522fc8530fbe154bc280f", "committedDate": "2020-03-20T10:44:53Z", "message": "Create MessagesExportUtil for API calls on CSV export"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "15be1b3113ed0c7bdaf68aebbaad7271077e5dea", "author": {"user": {"login": "alex-konn", "name": "Alex Konn"}}, "url": "https://github.com/Graylog2/graylog2-server/commit/15be1b3113ed0c7bdaf68aebbaad7271077e5dea", "committedDate": "2020-03-27T15:30:01Z", "message": "Allow mocking async execution in MessagesResource\n\nto avoid flaky tests"}, "afterCommit": {"oid": "a0140ac5445b0aa4a1e555f3dbc6e03a4dfbebb0", "author": {"user": {"login": "linuspahl", "name": "Linus Pahl"}}, "url": "https://github.com/Graylog2/graylog2-server/commit/a0140ac5445b0aa4a1e555f3dbc6e03a4dfbebb0", "committedDate": "2020-04-06T12:34:09Z", "message": "Remove font-awesome from package.json"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "23de7da488e9ecb5e1bc8209fd064fb1e47e6d3a", "author": {"user": {"login": "linuspahl", "name": "Linus Pahl"}}, "url": "https://github.com/Graylog2/graylog2-server/commit/23de7da488e9ecb5e1bc8209fd064fb1e47e6d3a", "committedDate": "2020-04-14T08:10:36Z", "message": "Use search specific endpoint to export all messages of a search"}, "afterCommit": {"oid": "1caaef202f5c2c356381f529a7444c1b7fce708c", "author": {"user": {"login": "linuspahl", "name": "Linus Pahl"}}, "url": "https://github.com/Graylog2/graylog2-server/commit/1caaef202f5c2c356381f529a7444c1b7fce708c", "committedDate": "2020-04-14T08:21:16Z", "message": "Use search specific endpoint to export all messages of a search"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzkzODc4Nzkw", "url": "https://github.com/Graylog2/graylog2-server/pull/7709#pullrequestreview-393878790", "createdAt": "2020-04-15T15:18:51Z", "commit": {"oid": "41ca176aee268d0432b6fd8e03c88a66ccf98c33"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 6, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xNVQxNToxODo1MVrOGF-0oQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xNVQxNTo0NzowNFrOGGAHtQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwODkyNTM0NQ==", "bodyText": "This could be replaced by using the LinkedHashSetUtil#linkedHashSetOf() method. I think I saw a few more places where you could use the newly introduced util class.", "url": "https://github.com/Graylog2/graylog2-server/pull/7709#discussion_r408925345", "createdAt": "2020-04-15T15:18:51Z", "author": {"login": "bernd"}, "path": "graylog2-server/src/main/java/org/graylog/plugins/views/search/export/MessagesRequest.java", "diffHunk": "@@ -0,0 +1,120 @@\n+/**\n+ * This file is part of Graylog.\n+ *\n+ * Graylog is free software: you can redistribute it and/or modify\n+ * it under the terms of the GNU General Public License as published by\n+ * the Free Software Foundation, either version 3 of the License, or\n+ * (at your option) any later version.\n+ *\n+ * Graylog is distributed in the hope that it will be useful,\n+ * but WITHOUT ANY WARRANTY; without even the implied warranty of\n+ * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n+ * GNU General Public License for more details.\n+ *\n+ * You should have received a copy of the GNU General Public License\n+ * along with Graylog.  If not, see <http://www.gnu.org/licenses/>.\n+ */\n+package org.graylog.plugins.views.search.export;\n+\n+import com.fasterxml.jackson.annotation.JsonCreator;\n+import com.fasterxml.jackson.annotation.JsonProperty;\n+import com.fasterxml.jackson.databind.annotation.JsonDeserialize;\n+import com.google.auto.value.AutoValue;\n+import org.graylog.plugins.views.search.engine.BackendQuery;\n+import org.graylog.plugins.views.search.searchtypes.Sort;\n+import org.graylog2.plugin.indexer.searches.timeranges.TimeRange;\n+\n+import javax.validation.ValidationException;\n+import java.util.ArrayList;\n+import java.util.Arrays;\n+import java.util.LinkedHashSet;\n+import java.util.List;\n+import java.util.Optional;\n+import java.util.Set;\n+import java.util.stream.Collectors;\n+\n+@AutoValue\n+@JsonDeserialize(builder = MessagesRequest.Builder.class)\n+public abstract class MessagesRequest {\n+    public abstract Optional<TimeRange> timeRange();\n+\n+    public abstract Optional<BackendQuery> queryString();\n+\n+    public abstract Optional<BackendQuery> additionalQueryString();\n+\n+    public abstract Optional<Set<String>> streams();\n+\n+    public abstract Optional<LinkedHashSet<String>> fieldsInOrder();\n+\n+    public abstract Optional<LinkedHashSet<Sort>> sort();\n+\n+    public abstract Optional<Integer> chunkSize();\n+\n+    public static MessagesRequest empty() {\n+        return builder().build();\n+    }\n+\n+    public static Builder builder() {\n+        return Builder.create();\n+    }\n+\n+    public abstract Builder toBuilder();\n+\n+    public void ensureCompleteness() {\n+        List<String> missingFields = new ArrayList<>();\n+        if (!timeRange().isPresent())\n+            missingFields.add(\"timeRange\");\n+        if (!queryString().isPresent())\n+            missingFields.add(\"queryString\");\n+        if (!streams().isPresent() || streams().get().isEmpty())\n+            missingFields.add(\"streams\");\n+        if (!fieldsInOrder().isPresent() || fieldsInOrder().get().isEmpty())\n+            missingFields.add(\"fieldsInOrder\");\n+        if (!sort().isPresent())\n+            missingFields.add(\"sort\");\n+\n+        if (!missingFields.isEmpty()) {\n+            String message = \"Missing fields: \" + missingFields;\n+            throw new ValidationException(message);\n+        }\n+    }\n+\n+    @AutoValue.Builder\n+    public abstract static class Builder {\n+        @JsonProperty(\"timerange\")\n+        public abstract Builder timeRange(TimeRange timeRange);\n+\n+        @JsonProperty\n+        public abstract Builder streams(Set<String> streams);\n+\n+        @JsonProperty(\"query_string\")\n+        public abstract Builder queryString(BackendQuery queryString);\n+\n+        public abstract Builder additionalQueryString(BackendQuery queryString);\n+\n+        @JsonProperty(\"fields_in_order\")\n+        public abstract Builder fieldsInOrder(LinkedHashSet<String> fieldsInOrder);\n+\n+        public Builder fieldsInOrder(String... fieldsInOrder) {\n+            LinkedHashSet<String> fields = Arrays.stream(fieldsInOrder).collect(Collectors.toCollection(LinkedHashSet::new));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "41ca176aee268d0432b6fd8e03c88a66ccf98c33"}, "originalPosition": 99}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwODkyNjA5Ng==", "bodyText": "How about using Message.FIELD_GL2_MESSAGE_ID here instead of hardcoding the field name here?", "url": "https://github.com/Graylog2/graylog2-server/pull/7709#discussion_r408926096", "createdAt": "2020-04-15T15:19:41Z", "author": {"login": "bernd"}, "path": "graylog2-server/src/main/java/org/graylog/plugins/views/search/export/es/ElasticsearchExportBackend.java", "diffHunk": "@@ -0,0 +1,211 @@\n+/**\n+ * This file is part of Graylog.\n+ *\n+ * Graylog is free software: you can redistribute it and/or modify\n+ * it under the terms of the GNU General Public License as published by\n+ * the Free Software Foundation, either version 3 of the License, or\n+ * (at your option) any later version.\n+ *\n+ * Graylog is distributed in the hope that it will be useful,\n+ * but WITHOUT ANY WARRANTY; without even the implied warranty of\n+ * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n+ * GNU General Public License for more details.\n+ *\n+ * You should have received a copy of the GNU General Public License\n+ * along with Graylog.  If not, see <http://www.gnu.org/licenses/>.\n+ */\n+package org.graylog.plugins.views.search.export.es;\n+\n+import io.searchbox.client.JestClient;\n+import io.searchbox.core.Search;\n+import io.searchbox.core.SearchResult;\n+import org.elasticsearch.index.query.BoolQueryBuilder;\n+import org.elasticsearch.index.query.QueryBuilder;\n+import org.elasticsearch.search.builder.SearchSourceBuilder;\n+import org.elasticsearch.search.sort.SortBuilders;\n+import org.elasticsearch.search.sort.SortOrder;\n+import org.graylog.plugins.views.search.elasticsearch.ElasticsearchQueryString;\n+import org.graylog.plugins.views.search.elasticsearch.IndexLookup;\n+import org.graylog.plugins.views.search.export.ExportBackend;\n+import org.graylog.plugins.views.search.export.MessagesRequest;\n+import org.graylog.plugins.views.search.export.SimpleMessage;\n+import org.graylog.plugins.views.search.export.SimpleMessageChunk;\n+import org.graylog.plugins.views.search.searchtypes.Sort;\n+import org.graylog2.indexer.IndexHelper;\n+import org.graylog2.indexer.IndexMapping;\n+import org.graylog2.indexer.cluster.jest.JestUtils;\n+import org.graylog2.plugin.Message;\n+import org.slf4j.Logger;\n+import org.slf4j.LoggerFactory;\n+\n+import javax.inject.Inject;\n+import java.util.LinkedHashMap;\n+import java.util.LinkedHashSet;\n+import java.util.List;\n+import java.util.Map;\n+import java.util.Set;\n+import java.util.UUID;\n+import java.util.function.Consumer;\n+\n+import static java.util.Objects.requireNonNull;\n+import static java.util.stream.Collectors.toCollection;\n+import static org.elasticsearch.index.query.QueryBuilders.boolQuery;\n+import static org.elasticsearch.index.query.QueryBuilders.matchAllQuery;\n+import static org.elasticsearch.index.query.QueryBuilders.queryStringQuery;\n+import static org.elasticsearch.index.query.QueryBuilders.termsQuery;\n+\n+public class ElasticsearchExportBackend implements ExportBackend {\n+    private static final Logger LOG = LoggerFactory.getLogger(ElasticsearchExportBackend.class);\n+\n+    private static final int DEFAULT_CHUNK_SIZE = 1000;\n+    private static final String TIEBREAKER_FIELD = \"gl2_message_id\";", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "41ca176aee268d0432b6fd8e03c88a66ccf98c33"}, "originalPosition": 61}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwODkyNjc2MQ==", "bodyText": "Is this a typo or intentional? runAsyncc with a double c", "url": "https://github.com/Graylog2/graylog2-server/pull/7709#discussion_r408926761", "createdAt": "2020-04-15T15:20:31Z", "author": {"login": "bernd"}, "path": "graylog2-server/src/main/java/org/graylog/plugins/views/search/export/ChunkedRunner.java", "diffHunk": "@@ -0,0 +1,72 @@\n+/**\n+ * This file is part of Graylog.\n+ *\n+ * Graylog is free software: you can redistribute it and/or modify\n+ * it under the terms of the GNU General Public License as published by\n+ * the Free Software Foundation, either version 3 of the License, or\n+ * (at your option) any later version.\n+ *\n+ * Graylog is distributed in the hope that it will be useful,\n+ * but WITHOUT ANY WARRANTY; without even the implied warranty of\n+ * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n+ * GNU General Public License for more details.\n+ *\n+ * You should have received a copy of the GNU General Public License\n+ * along with Graylog.  If not, see <http://www.gnu.org/licenses/>.\n+ */\n+package org.graylog.plugins.views.search.export;\n+\n+import com.google.common.util.concurrent.ThreadFactoryBuilder;\n+import org.glassfish.jersey.server.ChunkedOutput;\n+import org.slf4j.Logger;\n+import org.slf4j.LoggerFactory;\n+\n+import java.io.IOException;\n+import java.util.concurrent.ExecutorService;\n+import java.util.concurrent.Executors;\n+import java.util.function.Consumer;\n+\n+public class ChunkedRunner {\n+\n+    private static final Logger LOG = LoggerFactory.getLogger(ChunkedRunner.class);\n+\n+    private final ChunkedOutput<SimpleMessageChunk> output = new ChunkedOutput<>(SimpleMessageChunk.class);\n+\n+    public static ChunkedOutput<SimpleMessageChunk> runAsyncc(Consumer<Consumer<SimpleMessageChunk>> call) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "41ca176aee268d0432b6fd8e03c88a66ccf98c33"}, "originalPosition": 35}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwODkzMzc0NA==", "bodyText": "How about trimming the queryString() here to handle typos like \" *\" and similar?", "url": "https://github.com/Graylog2/graylog2-server/pull/7709#discussion_r408933744", "createdAt": "2020-04-15T15:29:31Z", "author": {"login": "bernd"}, "path": "graylog2-server/src/main/java/org/graylog/plugins/views/search/elasticsearch/ElasticsearchQueryString.java", "diffHunk": "@@ -30,12 +31,21 @@\n \n     public static final String NAME = \"elasticsearch\";\n \n+    public static ElasticsearchQueryString empty() {\n+        return ElasticsearchQueryString.builder().queryString(\"\").build();\n+    }\n+\n     @Override\n     public abstract String type();\n \n     @JsonProperty\n     public abstract String queryString();\n \n+    @JsonIgnore\n+    public boolean isEmpty() {\n+        return queryString().isEmpty() || queryString().equals(\"*\");", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "41ca176aee268d0432b6fd8e03c88a66ccf98c33"}, "originalPosition": 24}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwODk0MTgzNw==", "bodyText": "This class seems to be unused.", "url": "https://github.com/Graylog2/graylog2-server/pull/7709#discussion_r408941837", "createdAt": "2020-04-15T15:40:20Z", "author": {"login": "bernd"}, "path": "graylog2-server/src/main/java/org/graylog/plugins/views/search/export/MessagesResult.java", "diffHunk": "@@ -0,0 +1,43 @@\n+/**\n+ * This file is part of Graylog.\n+ *\n+ * Graylog is free software: you can redistribute it and/or modify\n+ * it under the terms of the GNU General Public License as published by\n+ * the Free Software Foundation, either version 3 of the License, or\n+ * (at your option) any later version.\n+ *\n+ * Graylog is distributed in the hope that it will be useful,\n+ * but WITHOUT ANY WARRANTY; without even the implied warranty of\n+ * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n+ * GNU General Public License for more details.\n+ *\n+ * You should have received a copy of the GNU General Public License\n+ * along with Graylog.  If not, see <http://www.gnu.org/licenses/>.\n+ */\n+package org.graylog.plugins.views.search.export;\n+\n+import com.google.auto.value.AutoValue;\n+\n+@AutoValue\n+public abstract class MessagesResult {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "41ca176aee268d0432b6fd8e03c88a66ccf98c33"}, "originalPosition": 22}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwODk0NjYxMw==", "bodyText": "The leading wildcard handling probably needs to be enabled.", "url": "https://github.com/Graylog2/graylog2-server/pull/7709#discussion_r408946613", "createdAt": "2020-04-15T15:47:04Z", "author": {"login": "bernd"}, "path": "graylog2-server/src/main/java/org/graylog/plugins/views/search/export/es/ElasticsearchExportBackend.java", "diffHunk": "@@ -0,0 +1,211 @@\n+/**\n+ * This file is part of Graylog.\n+ *\n+ * Graylog is free software: you can redistribute it and/or modify\n+ * it under the terms of the GNU General Public License as published by\n+ * the Free Software Foundation, either version 3 of the License, or\n+ * (at your option) any later version.\n+ *\n+ * Graylog is distributed in the hope that it will be useful,\n+ * but WITHOUT ANY WARRANTY; without even the implied warranty of\n+ * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n+ * GNU General Public License for more details.\n+ *\n+ * You should have received a copy of the GNU General Public License\n+ * along with Graylog.  If not, see <http://www.gnu.org/licenses/>.\n+ */\n+package org.graylog.plugins.views.search.export.es;\n+\n+import io.searchbox.client.JestClient;\n+import io.searchbox.core.Search;\n+import io.searchbox.core.SearchResult;\n+import org.elasticsearch.index.query.BoolQueryBuilder;\n+import org.elasticsearch.index.query.QueryBuilder;\n+import org.elasticsearch.search.builder.SearchSourceBuilder;\n+import org.elasticsearch.search.sort.SortBuilders;\n+import org.elasticsearch.search.sort.SortOrder;\n+import org.graylog.plugins.views.search.elasticsearch.ElasticsearchQueryString;\n+import org.graylog.plugins.views.search.elasticsearch.IndexLookup;\n+import org.graylog.plugins.views.search.export.ExportBackend;\n+import org.graylog.plugins.views.search.export.MessagesRequest;\n+import org.graylog.plugins.views.search.export.SimpleMessage;\n+import org.graylog.plugins.views.search.export.SimpleMessageChunk;\n+import org.graylog.plugins.views.search.searchtypes.Sort;\n+import org.graylog2.indexer.IndexHelper;\n+import org.graylog2.indexer.IndexMapping;\n+import org.graylog2.indexer.cluster.jest.JestUtils;\n+import org.graylog2.plugin.Message;\n+import org.slf4j.Logger;\n+import org.slf4j.LoggerFactory;\n+\n+import javax.inject.Inject;\n+import java.util.LinkedHashMap;\n+import java.util.LinkedHashSet;\n+import java.util.List;\n+import java.util.Map;\n+import java.util.Set;\n+import java.util.UUID;\n+import java.util.function.Consumer;\n+\n+import static java.util.Objects.requireNonNull;\n+import static java.util.stream.Collectors.toCollection;\n+import static org.elasticsearch.index.query.QueryBuilders.boolQuery;\n+import static org.elasticsearch.index.query.QueryBuilders.matchAllQuery;\n+import static org.elasticsearch.index.query.QueryBuilders.queryStringQuery;\n+import static org.elasticsearch.index.query.QueryBuilders.termsQuery;\n+\n+public class ElasticsearchExportBackend implements ExportBackend {\n+    private static final Logger LOG = LoggerFactory.getLogger(ElasticsearchExportBackend.class);\n+\n+    private static final int DEFAULT_CHUNK_SIZE = 1000;\n+    private static final String TIEBREAKER_FIELD = \"gl2_message_id\";\n+\n+    private final JestClient jestClient;\n+    private final IndexLookup indexLookup;\n+\n+    @Inject\n+    public ElasticsearchExportBackend(JestClient jestClient, IndexLookup indexLookup) {\n+        this.jestClient = jestClient;\n+        this.indexLookup = indexLookup;\n+    }\n+\n+    @Override\n+    public void run(MessagesRequest request, Consumer<SimpleMessageChunk> chunkCollector) {\n+        request.ensureCompleteness();\n+\n+        fetchResults(request, chunkCollector);\n+    }\n+\n+    private void fetchResults(MessagesRequest request, Consumer<SimpleMessageChunk> chunkCollector) {\n+        Object[] searchAfterValues = null;\n+        boolean isFirstChunk = true;\n+\n+        while (true) {\n+            List<SearchResult.Hit<Map, Void>> hits = search(request, searchAfterValues);\n+\n+            if (hits.isEmpty()) {\n+                return;\n+            }\n+\n+            boolean success = publishChunk(chunkCollector, hits, request.fieldsInOrder().get(), isFirstChunk);\n+            if (!success) {\n+                return;\n+            }\n+\n+            searchAfterValues = lastHitSortFrom(hits);\n+            isFirstChunk = false;\n+        }\n+    }\n+\n+    private List<SearchResult.Hit<Map, Void>> search(MessagesRequest request, Object[] searchAfterValues) {\n+        Search search = buildSearchRequest(request, searchAfterValues);\n+\n+        SearchResult result = JestUtils.execute(jestClient, search, () -> \"Failed to execute Search After request\");\n+\n+        return result.getHits(Map.class, false);\n+    }\n+\n+    private Search buildSearchRequest(MessagesRequest request, Object[] searchAfterValues) {\n+        SearchSourceBuilder ssb = searchSourceBuilderFrom(request, searchAfterValues);\n+\n+        Set<String> indices = indicesFor(request);\n+\n+        return new Search.Builder(ssb.toString())\n+                .addType(IndexMapping.TYPE_MESSAGE)\n+                .allowNoIndices(false)\n+                .ignoreUnavailable(false)\n+                .addIndex(indices)\n+                .build();\n+    }\n+\n+    @SuppressWarnings(\"OptionalGetWithoutIsPresent\")\n+    private SearchSourceBuilder searchSourceBuilderFrom(MessagesRequest request, Object[] searchAfterValues) {\n+        QueryBuilder query = queryFrom(request);\n+\n+        SearchSourceBuilder ssb = new SearchSourceBuilder()\n+                .query(query)\n+                .size(request.chunkSize().orElse(DEFAULT_CHUNK_SIZE));\n+\n+        addSort(ssb, request.sort().get());\n+\n+        if (searchAfterValues != null) {\n+            ssb.searchAfter(searchAfterValues);\n+        }\n+        return ssb;\n+    }\n+\n+    @SuppressWarnings(\"OptionalGetWithoutIsPresent\")\n+    private QueryBuilder queryFrom(MessagesRequest request) {\n+        ElasticsearchQueryString backendQuery = (ElasticsearchQueryString) request.queryString().get();\n+\n+        QueryBuilder query = backendQuery.isEmpty() ?\n+                matchAllQuery() :\n+                queryStringQuery(backendQuery.queryString());//.allowLeadingWildcard(allowLeadingWildcardSearches);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "41ca176aee268d0432b6fd8e03c88a66ccf98c33"}, "originalPosition": 143}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzk1Mjg0NTEw", "url": "https://github.com/Graylog2/graylog2-server/pull/7709#pullrequestreview-395284510", "createdAt": "2020-04-17T09:04:11Z", "commit": {"oid": "a67797654ea3a2304295ababad6bbcb16a94b0e7"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "69e9bbd9be41818cf7e032e86903ab4538c6e9e5", "author": {"user": {"login": "linuspahl", "name": "Linus Pahl"}}, "url": "https://github.com/Graylog2/graylog2-server/commit/69e9bbd9be41818cf7e032e86903ab4538c6e9e5", "committedDate": "2020-04-17T13:44:22Z", "message": "Provide search execution state on CSV export"}, "afterCommit": {"oid": "a60e56daa0e10581628707f08723654b62cb0f1d", "author": {"user": {"login": "linuspahl", "name": "Linus Pahl"}}, "url": "https://github.com/Graylog2/graylog2-server/commit/a60e56daa0e10581628707f08723654b62cb0f1d", "committedDate": "2020-04-19T11:21:21Z", "message": "Provide search execution state on CSV export"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "c186407da122a2f6b69bd2ba4039f76ad28e7f4b", "author": {"user": {"login": "alex-konn", "name": "Alex Konn"}}, "url": "https://github.com/Graylog2/graylog2-server/commit/c186407da122a2f6b69bd2ba4039f76ad28e7f4b", "committedDate": "2020-04-20T11:56:32Z", "message": "Fix integration test\n\n...to expect the corrected timestamp format"}, "afterCommit": {"oid": "250386b297ae0df80ba407ee6d76dc9bb5d0d9cd", "author": {"user": {"login": "alex-konn", "name": "Alex Konn"}}, "url": "https://github.com/Graylog2/graylog2-server/commit/250386b297ae0df80ba407ee6d76dc9bb5d0d9cd", "committedDate": "2020-04-20T13:58:05Z", "message": "Fix integration test\n\n...to expect the corrected timestamp format"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzk4OTA3ODIw", "url": "https://github.com/Graylog2/graylog2-server/pull/7709#pullrequestreview-398907820", "createdAt": "2020-04-23T09:11:12Z", "commit": {"oid": "0ae146dca6ac09747e2fe8148d11e5447ac9693a"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yM1QwOToxMToxMlrOGKfFqw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yM1QwOToyMDoyNlrOGKfepQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMzY0ODI5OQ==", "bodyText": "Extracting the props makes it harder to see how the effective props look like. Instead we could leave the structure as before (with inline props next to the component) and do something like: const Component = allowOptionCreation ? CreatableSelect : ReactSelect; and render <Component ... later.", "url": "https://github.com/Graylog2/graylog2-server/pull/7709#discussion_r413648299", "createdAt": "2020-04-23T09:11:12Z", "author": {"login": "dennisoelkers"}, "path": "graylog2-web-interface/src/views/components/Select.jsx", "diffHunk": "@@ -115,24 +121,34 @@ const Select = ({ components, styles, ignoreCase = true, ignoreAccents = false,\n     valueContainer,\n   };\n   const filterOption = createFilter({ ignoreCase, ignoreAccents });\n+  const selectProps = {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "0ae146dca6ac09747e2fe8148d11e5447ac9693a"}, "originalPosition": 66}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMzY1MzgzMQ==", "bodyText": "Should we move this and the corresponding call for a search to the strategies as well?", "url": "https://github.com/Graylog2/graylog2-server/pull/7709#discussion_r413653831", "createdAt": "2020-04-23T09:19:11Z", "author": {"login": "dennisoelkers"}, "path": "graylog2-web-interface/src/views/components/searchbar/csvexport/startDownload.js", "diffHunk": "@@ -0,0 +1,64 @@\n+// @flow strict\n+import { Set } from 'immutable';\n+\n+import { exportSearchMessages, exportSearchTypeMessages, type ExportPayload } from 'util/MessagesExportUtils';\n+import StringUtils from 'util/StringUtils';\n+\n+import MessageSortConfig from 'views/logic/searchtypes/messages/MessageSortConfig';\n+import Query from 'views/logic/queries/Query';\n+import SortConfig from 'views/logic/aggregationbuilder/SortConfig';\n+import View from 'views/logic/views/View';\n+import Widget from 'views/logic/widgets/Widget';\n+import ViewTypeLabel from 'views/components/ViewTypeLabel';\n+import SearchExecutionState from 'views/logic/search/SearchExecutionState';\n+\n+const _exportOnDashboard = (defaultExportPayload: ExportPayload, searchType: any, searchId: string, filename: string) => {\n+  if (!searchType) {\n+    throw new Error('CSV exports on a dashboard require a selected widget!');\n+  }\n+  return exportSearchTypeMessages(defaultExportPayload, searchId, searchType.id, filename);\n+};\n+\n+const _exportOnSearchPage = (defaultExportPayload: ExportPayload, searchQueries: Set<Query>, searchType: ?any, searchId: string, filename: string) => {\n+  if (searchQueries.size !== 1) {\n+    throw new Error('Searches must only have a single query!');\n+  }\n+  if (searchType) {\n+    return exportSearchTypeMessages(defaultExportPayload, searchId, searchType.id, filename);\n+  }\n+  return exportSearchMessages(defaultExportPayload, searchId, filename);\n+};\n+\n+const startDownload = (view: View, executionState: SearchExecutionState, selectedWidget: ?Widget, selectedFields: { field: string }[], selectedSort: SortConfig[], limit: ?number) => {\n+  const defaultExportPayload = {\n+    execution_state: executionState,\n+    fields_in_order: selectedFields.map((field) => field.field),\n+    sort: selectedSort.map((sortConfig) => new MessageSortConfig(sortConfig.field, sortConfig.direction)),\n+    limit,\n+  };\n+  let filename = 'search-result';\n+  let searchType;\n+\n+  if (selectedWidget) {\n+    const widgetTitle = view.getWidgetTitleByWidget(selectedWidget);\n+    filename = `${widgetTitle}-${filename}`;\n+    searchType = view.getSearchTypeByWidgetId(selectedWidget.id);\n+  } else {\n+    const viewTitle = view.title || `Untitled ${ViewTypeLabel({ type: view.type, capitalize: true })}`;\n+    filename = `${viewTitle}-${filename}`;\n+  }\n+\n+  const filenameWithoutSpaces = StringUtils.replaceSpaces(filename, '-');\n+\n+  if (view.type === View.Type.Dashboard) {\n+    return _exportOnDashboard(defaultExportPayload, searchType, view.search.id, filenameWithoutSpaces);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "129f0cad1811bf36655af50b23adbe3f3027585a"}, "originalPosition": 54}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMzY1NDY5Mw==", "bodyText": "We should import this as\n\n  \n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            import React from 'react';\n          \n          \n            \n            import * as React from 'react';\n          \n      \n    \n    \n  \n\nSo we do not get only the default export.", "url": "https://github.com/Graylog2/graylog2-server/pull/7709#discussion_r413654693", "createdAt": "2020-04-23T09:20:26Z", "author": {"login": "dennisoelkers"}, "path": "graylog2-web-interface/src/views/components/searchbar/csvexport/CSVExportSettings.jsx", "diffHunk": "@@ -0,0 +1,107 @@\n+// @flow strict\n+import React from 'react';", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "129f0cad1811bf36655af50b23adbe3f3027585a"}, "originalPosition": 2}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "129f0cad1811bf36655af50b23adbe3f3027585a", "author": {"user": {"login": "linuspahl", "name": "Linus Pahl"}}, "url": "https://github.com/Graylog2/graylog2-server/commit/129f0cad1811bf36655af50b23adbe3f3027585a", "committedDate": "2020-04-23T09:05:50Z", "message": "Revert not needed propTypes placement change"}, "afterCommit": {"oid": "13982ea56728c939bc76d8599b5ad73902996228", "author": {"user": {"login": "linuspahl", "name": "Linus Pahl"}}, "url": "https://github.com/Graylog2/graylog2-server/commit/13982ea56728c939bc76d8599b5ad73902996228", "committedDate": "2020-04-23T09:40:40Z", "message": "Fix FetchProvider behaviour on unauthorized requests"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "13982ea56728c939bc76d8599b5ad73902996228", "author": {"user": {"login": "linuspahl", "name": "Linus Pahl"}}, "url": "https://github.com/Graylog2/graylog2-server/commit/13982ea56728c939bc76d8599b5ad73902996228", "committedDate": "2020-04-23T09:40:40Z", "message": "Fix FetchProvider behaviour on unauthorized requests"}, "afterCommit": {"oid": "cdd7ab291eef32b071908b6b95abe9d8d42f4b68", "author": {"user": {"login": "linuspahl", "name": "Linus Pahl"}}, "url": "https://github.com/Graylog2/graylog2-server/commit/cdd7ab291eef32b071908b6b95abe9d8d42f4b68", "committedDate": "2020-04-23T10:20:32Z", "message": "Fix FetchProvider behaviour on unauthorized requests"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b611c3d003bf67807288cc9766f53f261924c7a3", "author": {"user": {"login": "linuspahl", "name": "Linus Pahl"}}, "url": "https://github.com/Graylog2/graylog2-server/commit/b611c3d003bf67807288cc9766f53f261924c7a3", "committedDate": "2020-04-23T14:27:28Z", "message": "Extend CSV export modal"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "cf9d2567eadf890a18a949013ced8c0204edea58", "author": {"user": {"login": "linuspahl", "name": "Linus Pahl"}}, "url": "https://github.com/Graylog2/graylog2-server/commit/cf9d2567eadf890a18a949013ced8c0204edea58", "committedDate": "2020-04-23T14:27:29Z", "message": "Disable widget csv export for every widget which is not a message list"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "737b664744f019f0b8d9db72b068f8132d02a4c3", "author": {"user": {"login": "linuspahl", "name": "Linus Pahl"}}, "url": "https://github.com/Graylog2/graylog2-server/commit/737b664744f019f0b8d9db72b068f8132d02a4c3", "committedDate": "2020-04-23T14:27:29Z", "message": "Cleanup code"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "5f008a6df7e3ebf5e8150b108c2f324cfb39c061", "author": {"user": {"login": "linuspahl", "name": "Linus Pahl"}}, "url": "https://github.com/Graylog2/graylog2-server/commit/5f008a6df7e3ebf5e8150b108c2f324cfb39c061", "committedDate": "2020-04-23T14:27:29Z", "message": "Add csv export button for dashboard actions menu and use view instead of view store in CSVExportModal"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "4f5a9436fabcbeadc7f934a228497b7f594b4afb", "author": {"user": {"login": "linuspahl", "name": "Linus Pahl"}}, "url": "https://github.com/Graylog2/graylog2-server/commit/4f5a9436fabcbeadc7f934a228497b7f594b4afb", "committedDate": "2020-04-23T14:27:30Z", "message": "Further code refactoring"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b24c4bd9ffb1977c22db3d345575ade66574282d", "author": {"user": {"login": "linuspahl", "name": "Linus Pahl"}}, "url": "https://github.com/Graylog2/graylog2-server/commit/b24c4bd9ffb1977c22db3d345575ade66574282d", "committedDate": "2020-04-23T14:27:30Z", "message": "Creat separate component for sortable field select"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "36f34ec74ed29b040d52882d25157832175623fe", "author": {"user": {"login": "linuspahl", "name": "Linus Pahl"}}, "url": "https://github.com/Graylog2/graylog2-server/commit/36f34ec74ed29b040d52882d25157832175623fe", "committedDate": "2020-04-23T14:27:30Z", "message": "Simplify widget and title extraction"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "3699b11628bffc207ba873ff117c921efe688cd9", "author": {"user": {"login": "alex-konn", "name": "Alex Konn"}}, "url": "https://github.com/Graylog2/graylog2-server/commit/3699b11628bffc207ba873ff117c921efe688cd9", "committedDate": "2020-04-23T14:27:31Z", "message": "Add separate API endpoints for new views export\n- Added MessagesResource\n- Added generic endpoint for search-type-independent results\n- Added search-type-specific endpoint. Tbd, if this is actually\n  needed for the first iteration. Will be thrown out, if not\n- Stubbed resulting CSV for now"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "3aca805e67dece9510516ac0a7c31750f2aa2865", "author": {"user": {"login": "linuspahl", "name": "Linus Pahl"}}, "url": "https://github.com/Graylog2/graylog2-server/commit/3aca805e67dece9510516ac0a7c31750f2aa2865", "committedDate": "2020-04-23T14:27:31Z", "message": "Split up modal steps and create separate components"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b0ec57c9e00ffec8330c190ba6e9b52fda4a7617", "author": {"user": {"login": "alex-konn", "name": "Alex Konn"}}, "url": "https://github.com/Graylog2/graylog2-server/commit/b0ec57c9e00ffec8330c190ba6e9b52fda4a7617", "committedDate": "2020-04-23T14:27:32Z", "message": "Enable audit events for MessagesResource"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c7213600162c2172cf2e073c0812552e75717b85", "author": {"user": {"login": "alex-konn", "name": "Alex Konn"}}, "url": "https://github.com/Graylog2/graylog2-server/commit/c7213600162c2172cf2e073c0812552e75717b85", "committedDate": "2020-04-23T14:27:32Z", "message": "Removed wrong import"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b578541d7ffbc4a77181a4beb76f3e65195ee92e", "author": {"user": {"login": "linuspahl", "name": "Linus Pahl"}}, "url": "https://github.com/Graylog2/graylog2-server/commit/b578541d7ffbc4a77181a4beb76f3e65195ee92e", "committedDate": "2020-04-23T14:27:33Z", "message": "Improve description"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "882889d56291a28cf7773149f007d64cedb82196", "author": {"user": {"login": "linuspahl", "name": "Linus Pahl"}}, "url": "https://github.com/Graylog2/graylog2-server/commit/882889d56291a28cf7773149f007d64cedb82196", "committedDate": "2020-04-23T14:27:33Z", "message": "Refactor code style"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "983f2a7ff7fe6cab2d7797cd3f69e8e0dd2e6b63", "author": {"user": {"login": "linuspahl", "name": "Linus Pahl"}}, "url": "https://github.com/Graylog2/graylog2-server/commit/983f2a7ff7fe6cab2d7797cd3f69e8e0dd2e6b63", "committedDate": "2020-04-23T14:27:34Z", "message": "Add info about sort seelction"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b5463332eba82091d426281a5a545e0b169dcb55", "author": {"user": {"login": "linuspahl", "name": "Linus Pahl"}}, "url": "https://github.com/Graylog2/graylog2-server/commit/b5463332eba82091d426281a5a545e0b169dcb55", "committedDate": "2020-04-23T14:27:34Z", "message": "Unify naming"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b8510319f6819e436cd7c275687c7e0afae350ef", "author": {"user": {"login": "linuspahl", "name": "Linus Pahl"}}, "url": "https://github.com/Graylog2/graylog2-server/commit/b8510319f6819e436cd7c275687c7e0afae350ef", "committedDate": "2020-04-23T14:27:35Z", "message": "Create MessagesExportUtil for API calls on CSV export"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "665a89c7b4bd5f7eec81b8b8f36eab53a4038a10", "author": {"user": {"login": "linuspahl", "name": "Linus Pahl"}}, "url": "https://github.com/Graylog2/graylog2-server/commit/665a89c7b4bd5f7eec81b8b8f36eab53a4038a10", "committedDate": "2020-04-23T14:27:36Z", "message": "Use correct payload when exporting csv"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "732c787ba4c40b9608df6a5c230da239dc832b27", "author": {"user": {"login": "linuspahl", "name": "Linus Pahl"}}, "url": "https://github.com/Graylog2/graylog2-server/commit/732c787ba4c40b9608df6a5c230da239dc832b27", "committedDate": "2020-04-23T14:27:36Z", "message": "Implement correct url creation for message export"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "619090319625a1cdcda520ab2c923b38073a6ee6", "author": {"user": {"login": "linuspahl", "name": "Linus Pahl"}}, "url": "https://github.com/Graylog2/graylog2-server/commit/619090319625a1cdcda520ab2c923b38073a6ee6", "committedDate": "2020-04-23T14:27:37Z", "message": "Implement downloadjs and extend FetchProvider for file downloads"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "2d3636fbe51aeb0f5f5f81c08b89fab9ba262cb6", "author": {"user": {"login": "linuspahl", "name": "Linus Pahl"}}, "url": "https://github.com/Graylog2/graylog2-server/commit/2d3636fbe51aeb0f5f5f81c08b89fab9ba262cb6", "committedDate": "2020-04-23T14:27:37Z", "message": "Show info when no message list is existst on a dashboard"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e2819e7d3c44ef24b9a4e3beffd1621c7631a5a9", "author": {"user": {"login": "linuspahl", "name": "Linus Pahl"}}, "url": "https://github.com/Graylog2/graylog2-server/commit/e2819e7d3c44ef24b9a4e3beffd1621c7631a5a9", "committedDate": "2020-04-23T14:27:38Z", "message": "Improve CSVExportModal code quality by implementing export strategies"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c7fda34b601b1335a26b15cd773bea4071a2bffe", "author": {"user": {"login": "linuspahl", "name": "Linus Pahl"}}, "url": "https://github.com/Graylog2/graylog2-server/commit/c7fda34b601b1335a26b15cd773bea4071a2bffe", "committedDate": "2020-04-23T14:27:39Z", "message": "Rename fixedWidgetId prop to directExportWidgetId"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "3e386c9fe87ece4565ad3138dec263efe638209a", "author": {"user": {"login": "linuspahl", "name": "Linus Pahl"}}, "url": "https://github.com/Graylog2/graylog2-server/commit/3e386c9fe87ece4565ad3138dec263efe638209a", "committedDate": "2020-04-23T14:27:39Z", "message": "Add tests"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "7eccc24c0dfa70e018a554bf23761d750b942ae3", "author": {"user": {"login": "linuspahl", "name": "Linus Pahl"}}, "url": "https://github.com/Graylog2/graylog2-server/commit/7eccc24c0dfa70e018a554bf23761d750b942ae3", "committedDate": "2020-04-23T14:27:40Z", "message": "Sort imports"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "fa41c602cd336ae051afb6a1d1945ede7c049eac", "author": {"user": {"login": "linuspahl", "name": "Linus Pahl"}}, "url": "https://github.com/Graylog2/graylog2-server/commit/fa41c602cd336ae051afb6a1d1945ede7c049eac", "committedDate": "2020-04-23T14:27:41Z", "message": "Add tests for csv export download execution\n- Add mock for fetchFile in FetchProvider\n- Fix search type flow type definition by using string instead of String\n- Use lodash flatten instead of Array.prototype.flat() due to missing jest / jsdom support"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "9d4e578127c9d0b3b4ee21b40e8d2d5de0b7df45", "author": {"user": {"login": "linuspahl", "name": "Linus Pahl"}}, "url": "https://github.com/Graylog2/graylog2-server/commit/9d4e578127c9d0b3b4ee21b40e8d2d5de0b7df45", "committedDate": "2020-04-23T14:27:41Z", "message": "Disable download when no fields got selected"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b704945ddd57a6f7a11f6799b333ed9069f8fb80", "author": {"user": {"login": "linuspahl", "name": "Linus Pahl"}}, "url": "https://github.com/Graylog2/graylog2-server/commit/b704945ddd57a6f7a11f6799b333ed9069f8fb80", "committedDate": "2020-04-23T14:27:42Z", "message": "Clean up CSVExportModal component by splitting the related logic"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "fb98508bf478e2e754bcccf30f0dc703d6eecdb8", "author": {"user": {"login": "linuspahl", "name": "Linus Pahl"}}, "url": "https://github.com/Graylog2/graylog2-server/commit/fb98508bf478e2e754bcccf30f0dc703d6eecdb8", "committedDate": "2020-04-23T14:27:43Z", "message": "Add flow-types stub for downloadjs"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "98c618ae5bfbe59c16779baffaa06f37966b0272", "author": {"user": {"login": "linuspahl", "name": "Linus Pahl"}}, "url": "https://github.com/Graylog2/graylog2-server/commit/98c618ae5bfbe59c16779baffaa06f37966b0272", "committedDate": "2020-04-23T14:27:43Z", "message": "Fix flow errors"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e800f382d1017f133894245b2e93b794224daf1a", "author": {"user": {"login": "linuspahl", "name": "Linus Pahl"}}, "url": "https://github.com/Graylog2/graylog2-server/commit/e800f382d1017f133894245b2e93b794224daf1a", "committedDate": "2020-04-23T14:27:44Z", "message": "Add flow annotation for downloadjs stub"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "468a35c6f5e156afca5096b8d9bc8f4d5ea4e631", "author": {"user": {"login": "linuspahl", "name": "Linus Pahl"}}, "url": "https://github.com/Graylog2/graylog2-server/commit/468a35c6f5e156afca5096b8d9bc8f4d5ea4e631", "committedDate": "2020-04-23T14:27:45Z", "message": "Fix linter warnings"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "7e5e9e77bc6f75154c78f4e8194608510b5286b8", "author": {"user": {"login": "linuspahl", "name": "Linus Pahl"}}, "url": "https://github.com/Graylog2/graylog2-server/commit/7e5e9e77bc6f75154c78f4e8194608510b5286b8", "committedDate": "2020-04-23T14:27:45Z", "message": "Fix typo"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "6a61552f15e47084c0818a84a759acd525ff513e", "author": {"user": {"login": "alex-konn", "name": "Alex Konn"}}, "url": "https://github.com/Graylog2/graylog2-server/commit/6a61552f15e47084c0818a84a759acd525ff513e", "committedDate": "2020-04-23T14:27:46Z", "message": "WIP: add dedicated ElasticsearchExportBackend\n\n- Added separate class for making the \"search after\" request\n  It doesn't actually use \"search after\" yet. Will be added next.\n  It might turn out to be better to integrate this with the big\n  ElasticsearchBackend of the views context, but I don't want to do\n  that from the start, because that would make getting started much\n  more difficult and I'm not sure that that's even a good idea.\n- Added default values for MessagesRequest\n- Added validation for completeness of MessagesRequest"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "17e31208d1d7fe012c9184212ef7d51178acc6f1", "author": {"user": {"login": "alex-konn", "name": "Alex Konn"}}, "url": "https://github.com/Graylog2/graylog2-server/commit/17e31208d1d7fe012c9184212ef7d51178acc6f1", "committedDate": "2020-04-23T14:27:47Z", "message": "Continued implementing ElasticsearchExportBackend"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "9e24e07d1a6f7140f5a4bf969598559b6bf49a70", "author": {"user": {"login": "alex-konn", "name": "Alex Konn"}}, "url": "https://github.com/Graylog2/graylog2-server/commit/9e24e07d1a6f7140f5a4bf969598559b6bf49a70", "committedDate": "2020-04-23T14:27:47Z", "message": "Use LinkedHashSet in MessagesRequest\n\n... to guarantee ordering of fields and sort"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "7d908b5038357b215e312f6a7f096bd520e74050", "author": {"user": {"login": "alex-konn", "name": "Alex Konn"}}, "url": "https://github.com/Graylog2/graylog2-server/commit/7d908b5038357b215e312f6a7f096bd520e74050", "committedDate": "2020-04-23T14:27:48Z", "message": "JsonIgnore convenience getter on ElasticsearchQueryString"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f9165733d551bbbd3912f41fee60a7164e972f76", "author": {"user": {"login": "alex-konn", "name": "Alex Konn"}}, "url": "https://github.com/Graylog2/graylog2-server/commit/f9165733d551bbbd3912f41fee60a7164e972f76", "committedDate": "2020-04-23T14:27:49Z", "message": "Run \"search after\" queries asynchronously\n\n- Use Executor in MessagesResource\n- Forward chunks to ChunkedOutput via callbacks"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "7ab8f98d1e8961c87a2c66c442e83991de77a370", "author": {"user": {"login": "alex-konn", "name": "Alex Konn"}}, "url": "https://github.com/Graylog2/graylog2-server/commit/7ab8f98d1e8961c87a2c66c442e83991de77a370", "committedDate": "2020-04-23T14:27:49Z", "message": "Add named ThreadFactoryBuilder\n\n...to properly name the resulting thread."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d0f35a6a76f391bd151d189b87de8ecd78c3abac", "author": {"user": {"login": "alex-konn", "name": "Alex Konn"}}, "url": "https://github.com/Graylog2/graylog2-server/commit/d0f35a6a76f391bd151d189b87de8ecd78c3abac", "committedDate": "2020-04-23T14:27:50Z", "message": "Allow mocking async execution in MessagesResource\n\nto avoid flaky tests"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "1cd771b558cdf41801d70fc706e03fb2de6386cf", "author": {"user": {"login": "linuspahl", "name": "Linus Pahl"}}, "url": "https://github.com/Graylog2/graylog2-server/commit/1cd771b558cdf41801d70fc706e03fb2de6386cf", "committedDate": "2020-04-23T14:27:50Z", "message": "Fix merge conflict in package.json"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "0b4cc4c47aafe8803d4c9341a2d227f57bc2e40c", "author": {"user": {"login": "linuspahl", "name": "Linus Pahl"}}, "url": "https://github.com/Graylog2/graylog2-server/commit/0b4cc4c47aafe8803d4c9341a2d227f57bc2e40c", "committedDate": "2020-04-23T14:27:51Z", "message": "Remove font-awesome from package.json"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e252abea0a411f06fd0bfa1565454e57885f7a64", "author": {"user": {"login": "alex-konn", "name": "Alex Konn"}}, "url": "https://github.com/Graylog2/graylog2-server/commit/e252abea0a411f06fd0bfa1565454e57885f7a64", "committedDate": "2020-04-23T14:27:51Z", "message": "Some cleanup in ElasticsearchExportBackend"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "26adad9568d800dc43f1571dd7fb57ba82bbb063", "author": {"user": {"login": "alex-konn", "name": "Alex Konn"}}, "url": "https://github.com/Graylog2/graylog2-server/commit/26adad9568d800dc43f1571dd7fb57ba82bbb063", "committedDate": "2020-04-23T14:27:52Z", "message": "Build MessagesRequest for export from Search"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "3893ac8c63f9554e6bb562a6ca08ce4145df2fbd", "author": {"user": {"login": "alex-konn", "name": "Alex Konn"}}, "url": "https://github.com/Graylog2/graylog2-server/commit/3893ac8c63f9554e6bb562a6ca08ce4145df2fbd", "committedDate": "2020-04-23T14:27:52Z", "message": "Use additional query string in ElasticsearchExportBackend"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "1e1b56826e42070e911f6637b7cb5544725b251f", "author": {"user": {"login": "alex-konn", "name": "Alex Konn"}}, "url": "https://github.com/Graylog2/graylog2-server/commit/1e1b56826e42070e911f6637b7cb5544725b251f", "committedDate": "2020-04-23T14:27:53Z", "message": "Require streams and fieldsInOrder to be specified"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "acc53523cda7168b65b9748235adff54bbc35e63", "author": {"user": {"login": "alex-konn", "name": "Alex Konn"}}, "url": "https://github.com/Graylog2/graylog2-server/commit/acc53523cda7168b65b9748235adff54bbc35e63", "committedDate": "2020-04-23T14:27:53Z", "message": "Copy permission checks from SearchResource to MessagesResource\n\nWhile copying that code is certainly not ideal, I decided to hold off\non implementing a better solution until we have a better way to check\npermissions in general. Better to stick to one awkward way of doing things\nthan inventing another slightly-better-but-not-really-good variant that's only\nused in one place."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f73782f5904daa2cd09a57ee19d3b3dc095ece9c", "author": {"user": {"login": "alex-konn", "name": "Alex Konn"}}, "url": "https://github.com/Graylog2/graylog2-server/commit/f73782f5904daa2cd09a57ee19d3b3dc095ece9c", "committedDate": "2020-04-23T14:27:54Z", "message": "Add default streams also for plain messages request"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "4e123b67a883eb0ab524924eac4f7a836dc01c87", "author": {"user": {"login": "linuspahl", "name": "Linus Pahl"}}, "url": "https://github.com/Graylog2/graylog2-server/commit/4e123b67a883eb0ab524924eac4f7a836dc01c87", "committedDate": "2020-04-23T14:27:55Z", "message": "Remove not needed CSVExportModal component, which is a leftover from the lest rebase"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "dfc6ca6f9e2d929e365ac99b105023ce8e01c707", "author": {"user": {"login": "alex-konn", "name": "Alex Konn"}}, "url": "https://github.com/Graylog2/graylog2-server/commit/dfc6ca6f9e2d929e365ac99b105023ce8e01c707", "committedDate": "2020-04-23T14:27:56Z", "message": "Added endpoint with only search id"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "5d5b40a0130c0680d2546dbb1a6f19725cf1f9a7", "author": {"user": {"login": "alex-konn", "name": "Alex Konn"}}, "url": "https://github.com/Graylog2/graylog2-server/commit/5d5b40a0130c0680d2546dbb1a6f19725cf1f9a7", "committedDate": "2020-04-23T14:27:56Z", "message": "Added missing license header"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "9692f6a07af20ce4bddff2f45ce7f4eb1e1c6fb6", "author": {"user": {"login": "alex-konn", "name": "Alex Konn"}}, "url": "https://github.com/Graylog2/graylog2-server/commit/9692f6a07af20ce4bddff2f45ce7f4eb1e1c6fb6", "committedDate": "2020-04-23T14:27:57Z", "message": "Fix failing test"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "fc87724f0e619601602787507f814f9ffc95e3a0", "author": {"user": {"login": "alex-konn", "name": "Alex Konn"}}, "url": "https://github.com/Graylog2/graylog2-server/commit/fc87724f0e619601602787507f814f9ffc95e3a0", "committedDate": "2020-04-23T14:27:58Z", "message": "Introduce SimpleMessage class instead of using plain strings"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "aefb1d375fcdaee2b92b83a5594fdfe1c812b0a5", "author": {"user": {"login": "alex-konn", "name": "Alex Konn"}}, "url": "https://github.com/Graylog2/graylog2-server/commit/aefb1d375fcdaee2b92b83a5594fdfe1c812b0a5", "committedDate": "2020-04-23T14:27:59Z", "message": "Introduce collection class SimpleMessages"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "84460f0525208f065ed523cb4b21fe498c4d20ad", "author": {"user": {"login": "alex-konn", "name": "Alex Konn"}}, "url": "https://github.com/Graylog2/graylog2-server/commit/84460f0525208f065ed523cb4b21fe498c4d20ad", "committedDate": "2020-04-23T14:28:00Z", "message": "Write response chunks as csv\n\n- Added a SimpleMessageChunkCsvWriter, which is a JAX-RS MessageBodyWriter,\n  similar to ScrollChunkWriter for the old export\n- Renamed SimpleMessages to SimpleMessageChunk"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "13a49f8171733a8992bd2e23ea235ee60d0f1d8f", "author": {"user": {"login": "alex-konn", "name": "Alex Konn"}}, "url": "https://github.com/Graylog2/graylog2-server/commit/13a49f8171733a8992bd2e23ea235ee60d0f1d8f", "committedDate": "2020-04-23T14:28:00Z", "message": "Add charset to string construction in test\n\n...to satisfy forbiddenapis check"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "010fe48e3cb9a021f95f653a8c186200828a008e", "author": {"user": {"login": "alex-konn", "name": "Alex Konn"}}, "url": "https://github.com/Graylog2/graylog2-server/commit/010fe48e3cb9a021f95f653a8c186200828a008e", "committedDate": "2020-04-23T14:28:01Z", "message": "Minor cleanup\n\n- Deleted unnecessary file\n- Filled in error message for Jest call in ElasticsearchExportBackend"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "01a10f5f194d3e82c6f6d4c8e56ad677d68b6c84", "author": {"user": {"login": "alex-konn", "name": "Alex Konn"}}, "url": "https://github.com/Graylog2/graylog2-server/commit/01a10f5f194d3e82c6f6d4c8e56ad677d68b6c84", "committedDate": "2020-04-23T14:28:02Z", "message": "Extracted async run and creation of ChunkedOutput\n\n...to new class ChunkedRunner. This simplifies MessagesResource,\nadds a central place for error handling, and removes the necessity\nto close the output via an onDone callback passed down to\nElasticsearchExportBackend"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "fca27f56922dac90992a7b0e9c3b4bd2020b075d", "author": {"user": {"login": "alex-konn", "name": "Alex Konn"}}, "url": "https://github.com/Graylog2/graylog2-server/commit/fca27f56922dac90992a7b0e9c3b4bd2020b075d", "committedDate": "2020-04-23T14:28:04Z", "message": "Allow overriding default chunk size from request"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "3fd58fec1c76159be333ceefcb9c0c8951f017ea", "author": {"user": {"login": "alex-konn", "name": "Alex Konn"}}, "url": "https://github.com/Graylog2/graylog2-server/commit/3fd58fec1c76159be333ceefcb9c0c8951f017ea", "committedDate": "2020-04-23T14:28:06Z", "message": "Added integration test"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "01b6a3d354959107cbe342eccbbf802847179316", "author": {"user": {"login": "linuspahl", "name": "Linus Pahl"}}, "url": "https://github.com/Graylog2/graylog2-server/commit/01b6a3d354959107cbe342eccbbf802847179316", "committedDate": "2020-04-23T14:28:07Z", "message": "Remove yarn-error.log"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ea7763a071cf74f493ad0b0ce4e97d373656fc7e", "author": {"user": {"login": "linuspahl", "name": "Linus Pahl"}}, "url": "https://github.com/Graylog2/graylog2-server/commit/ea7763a071cf74f493ad0b0ce4e97d373656fc7e", "committedDate": "2020-04-23T14:28:09Z", "message": "Fix yarn.lock conflict"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c9970c7eca223c9012abb9c3c4574438141e8407", "author": {"user": {"login": "linuspahl", "name": "Linus Pahl"}}, "url": "https://github.com/Graylog2/graylog2-server/commit/c9970c7eca223c9012abb9c3c4574438141e8407", "committedDate": "2020-04-23T14:28:10Z", "message": "Use search specific endpoint to export all messages of a search"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "2867004e759ac58106eee839d986457c448f9ba2", "author": {"user": {"login": "alex-konn", "name": "Alex Konn"}}, "url": "https://github.com/Graylog2/graylog2-server/commit/2867004e759ac58106eee839d986457c448f9ba2", "committedDate": "2020-04-23T14:28:12Z", "message": "Add basic decorators support for export\n\n- Added interface ChunkDecorator, which is used by MessagesExporter to apply decorators\n- Added implementation LegacyChunkDecorator to encapsulate the current decorators logic."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "13431a64526717c33704b5fceced49ec8434f809", "author": {"user": {"login": "alex-konn", "name": "Alex Konn"}}, "url": "https://github.com/Graylog2/graylog2-server/commit/13431a64526717c33704b5fceced49ec8434f809", "committedDate": "2020-04-23T14:28:13Z", "message": "Add basic decorators support for export\n\n- Added interface ChunkDecorator, which is used by MessagesExporter to apply decorators\n- Added implementation LegacyChunkDecorator to encapsulate the current decorators logic.\n- Extracted LegacyDecoratorProcessor from ESMessageList for reuse"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "4b7c2f3b0eb715c311f38699077ce7da9c55f4bd", "author": {"user": {"login": "alex-konn", "name": "Alex Konn"}}, "url": "https://github.com/Graylog2/graylog2-server/commit/4b7c2f3b0eb715c311f38699077ce7da9c55f4bd", "committedDate": "2020-04-23T14:28:15Z", "message": "Add index and _id to SimpleMessage for legacy decorator support\n\nThe old decorators implementation relies on an _id field and the the index name to map decorated messages to the undecorated original"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "6726f5e18fd4312e1e010a8437dd1e5111dac430", "author": {"user": {"login": "alex-konn", "name": "Alex Konn"}}, "url": "https://github.com/Graylog2/graylog2-server/commit/6726f5e18fd4312e1e010a8437dd1e5111dac430", "committedDate": "2020-04-23T14:28:16Z", "message": "Set additional fields on SearchResponse\n\nMake a best effort to set the non-message fields on SearchResponse. This is not necessary for our own decorators, but users might use their own, which rely on these fields."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ed090ef825ee43cb773378ffea88ec1c0121b889", "author": {"user": {"login": "linuspahl", "name": "Linus Pahl"}}, "url": "https://github.com/Graylog2/graylog2-server/commit/ed090ef825ee43cb773378ffea88ec1c0121b889", "committedDate": "2020-04-23T14:28:17Z", "message": "Show loading spinner after starting CSV export"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "9c6e25e0331599e8609ace4215f6b881e49ee6f0", "author": {"user": {"login": "linuspahl", "name": "Linus Pahl"}}, "url": "https://github.com/Graylog2/graylog2-server/commit/9c6e25e0331599e8609ace4215f6b881e49ee6f0", "committedDate": "2020-04-23T14:28:18Z", "message": "Improve loading indicator code style"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a33cb671d93ec7a8724d645f5fb36666964b6a6b", "author": {"user": {"login": "linuspahl", "name": "Linus Pahl"}}, "url": "https://github.com/Graylog2/graylog2-server/commit/a33cb671d93ec7a8724d645f5fb36666964b6a6b", "committedDate": "2020-04-23T14:28:19Z", "message": "Show loading spinner after starting CSV export"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "8e5ad1dca5266d1e2129b560c44a21ea2b8ad26e", "author": {"user": {"login": "linuspahl", "name": "Linus Pahl"}}, "url": "https://github.com/Graylog2/graylog2-server/commit/8e5ad1dca5266d1e2129b560c44a21ea2b8ad26e", "committedDate": "2020-04-23T14:28:20Z", "message": "Add method for view to get search type by widget id"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "eb5fd4b7e60ffc471934c448c7b89046ef2690f1", "author": {"user": {"login": "linuspahl", "name": "Linus Pahl"}}, "url": "https://github.com/Graylog2/graylog2-server/commit/eb5fd4b7e60ffc471934c448c7b89046ef2690f1", "committedDate": "2020-04-23T14:28:21Z", "message": "Change sort input description"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a54273c04bedfe136b7c935fd5e72efeb83c99de", "author": {"user": {"login": "alex-konn", "name": "Alex Konn"}}, "url": "https://github.com/Graylog2/graylog2-server/commit/a54273c04bedfe136b7c935fd5e72efeb83c99de", "committedDate": "2020-04-23T14:28:22Z", "message": "Remove _id field for asserts in ElasticsearchExportBackendIT"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f419ce84fc329dcced26bb3f80761903991fad27", "author": {"user": {"login": "alex-konn", "name": "Alex Konn"}}, "url": "https://github.com/Graylog2/graylog2-server/commit/f419ce84fc329dcced26bb3f80761903991fad27", "committedDate": "2020-04-23T14:28:23Z", "message": "Simplified setting defaults on MessagesRequest\n\nRemoved custom validation for now and will add it back where it makes sense."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a9733df59ae55bccb810be53a83fd67ec5e1000e", "author": {"user": {"login": "alex-konn", "name": "Alex Konn"}}, "url": "https://github.com/Graylog2/graylog2-server/commit/a9733df59ae55bccb810be53a83fd67ec5e1000e", "committedDate": "2020-04-23T14:28:24Z", "message": "Add @NotEmpty validation where it makes sense for\n\n- MessagesRequest#fieldsInOrder (default will be applied if null)\n- MessagesRequest#sort (default will be applied if null)\n- ResultFormat#fieldsInOrder (default will be applied if null)"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "8b3ae53264612df97b1bcf7e41605209fce6bab6", "author": {"user": {"login": "alex-konn", "name": "Alex Konn"}}, "url": "https://github.com/Graylog2/graylog2-server/commit/8b3ae53264612df97b1bcf7e41605209fce6bab6", "committedDate": "2020-04-23T14:28:25Z", "message": "Respect allow_leading_wildcard_searches config\n\n- Injected config value in ElasticsearchExportBackend\n- Extracted shard error parsing from ElasticsearchBackend\n  to JestUtils for reuse\n- Added JestWrapper instead of using JestUtils in\n  ElasticsearchExportBackend to avoid static method calls\n  in tests, which complicate mocking"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a4687886beb583ceedaa17f63c22c716697c1279", "author": {"user": {"login": "alex-konn", "name": "Alex Konn"}}, "url": "https://github.com/Graylog2/graylog2-server/commit/a4687886beb583ceedaa17f63c22c716697c1279", "committedDate": "2020-04-23T14:28:26Z", "message": "Small cleanup"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ba51c78b42c92d5c39ca6c409b3ec74d69d3a94a", "author": {"user": {"login": "alex-konn", "name": "Alex Konn"}}, "url": "https://github.com/Graylog2/graylog2-server/commit/ba51c78b42c92d5c39ca6c409b3ec74d69d3a94a", "committedDate": "2020-04-23T14:28:26Z", "message": "Add parameter support\n\n- Added wrapper class QueryStringDecorator for use in MessagesExporter\n- Parameters are resolved using a stubbed `SearchJob`. The map of QueryResults for use only in QueryReferenceParameters is left empty, because we decided to get rid of QueryReferenceParameters completely. Thank goodness. That would have been an even bigger mess.\n- The ResultFormat API parameter can now also contain an execution state, equivalent to what's used for search execution. That's where parameter values come in. (It's also used to parse global overrides from dashboards - something we had overlooked so far)."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "253e0ac3524bade3312ec12a04653ee971eee8ec", "author": {"user": {"login": "alex-konn", "name": "Alex Konn"}}, "url": "https://github.com/Graylog2/graylog2-server/commit/253e0ac3524bade3312ec12a04653ee971eee8ec", "committedDate": "2020-04-23T14:28:27Z", "message": "Add missing license header"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "3eb940ffcbad405b62fe725fbfe599bba98d29af", "author": {"user": {"login": "alex-konn", "name": "Alex Konn"}}, "url": "https://github.com/Graylog2/graylog2-server/commit/3eb940ffcbad405b62fe725fbfe599bba98d29af", "committedDate": "2020-04-23T14:28:28Z", "message": "Fix failing tests\n\n...by correctly mocking QueryStringDecorator in MessagesExporterTest"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e41d2b30394f8850a1f99b3cbc1a24bc9836b112", "author": {"user": {"login": "alex-konn", "name": "Alex Konn"}}, "url": "https://github.com/Graylog2/graylog2-server/commit/e41d2b30394f8850a1f99b3cbc1a24bc9836b112", "committedDate": "2020-04-23T14:28:29Z", "message": "Add limit parameter"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "488309cc2cc8ae36e2bee8eb9d10d81aefb3c957", "author": {"user": {"login": "alex-konn", "name": "Alex Konn"}}, "url": "https://github.com/Graylog2/graylog2-server/commit/488309cc2cc8ae36e2bee8eb9d10d81aefb3c957", "committedDate": "2020-04-23T14:28:29Z", "message": "Fix sloppy method name in ChunkedRunner"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "270a8efd396f92885aaad2c925680a1ca500713b", "author": {"user": {"login": "alex-konn", "name": "Alex Konn"}}, "url": "https://github.com/Graylog2/graylog2-server/commit/270a8efd396f92885aaad2c925680a1ca500713b", "committedDate": "2020-04-23T14:28:30Z", "message": "Trim string in ElasticsearchQueryString.isEmpty"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "905eb7146493b83284774700190bea14e85552e5", "author": {"user": {"login": "alex-konn", "name": "Alex Konn"}}, "url": "https://github.com/Graylog2/graylog2-server/commit/905eb7146493b83284774700190bea14e85552e5", "committedDate": "2020-04-23T14:28:31Z", "message": "Use `LinkedHashSetUtil::linkedHashSetOf` in more places"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "042d5452dd942a5197fe0e85b15539611b5273cd", "author": {"user": {"login": "alex-konn", "name": "Alex Konn"}}, "url": "https://github.com/Graylog2/graylog2-server/commit/042d5452dd942a5197fe0e85b15539611b5273cd", "committedDate": "2020-04-23T14:28:32Z", "message": "Reuse constant Message.FIELD_GL2_MESSAGE_ID"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d646fae948ac3a5106c658df904acfe022151c1f", "author": {"user": {"login": "linuspahl", "name": "Linus Pahl"}}, "url": "https://github.com/Graylog2/graylog2-server/commit/d646fae948ac3a5106c658df904acfe022151c1f", "committedDate": "2020-04-23T14:28:32Z", "message": "Add limit input for CSV export modal"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "277919dce9f6e1ea76d4328eb1e5e7eb31408a58", "author": {"user": {"login": "linuspahl", "name": "Linus Pahl"}}, "url": "https://github.com/Graylog2/graylog2-server/commit/277919dce9f6e1ea76d4328eb1e5e7eb31408a58", "committedDate": "2020-04-23T14:28:33Z", "message": "Provide search execution state on CSV export"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "8b59911a6ab4a67b3c5a0b1891f010ba59d015a9", "author": {"user": {"login": "linuspahl", "name": "Linus Pahl"}}, "url": "https://github.com/Graylog2/graylog2-server/commit/8b59911a6ab4a67b3c5a0b1891f010ba59d015a9", "committedDate": "2020-04-23T14:28:33Z", "message": "Adjust limit description"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "384bd8c508fd301925a72639de445b1f35db189a", "author": {"user": {"login": "linuspahl", "name": "Linus Pahl"}}, "url": "https://github.com/Graylog2/graylog2-server/commit/384bd8c508fd301925a72639de445b1f35db189a", "committedDate": "2020-04-23T14:28:34Z", "message": "Refactor CSVExport modal test structure"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "4aeab61e304aa62e34dc66c75aca34d49adbdfea", "author": {"user": {"login": "linuspahl", "name": "Linus Pahl"}}, "url": "https://github.com/Graylog2/graylog2-server/commit/4aeab61e304aa62e34dc66c75aca34d49adbdfea", "committedDate": "2020-04-23T14:28:35Z", "message": "Test if search execution state is being provided on export"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "05183cd317a0f2f8aa55fd7bedc00aca2c818386", "author": {"user": {"login": "linuspahl", "name": "Linus Pahl"}}, "url": "https://github.com/Graylog2/graylog2-server/commit/05183cd317a0f2f8aa55fd7bedc00aca2c818386", "committedDate": "2020-04-23T14:28:36Z", "message": "Use selected widget or view title as filename"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2592, "cost": 1, "resetAt": "2021-10-28T18:54:27Z"}}}