{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDAzODIwMTg3", "number": 7885, "title": "Enable/disable auto-completion in query input based on user preference.", "bodyText": "Description\n\nMotivation and Context\n\n\nNote: This needs #7829 to be merged before.\nThis PR is adding back functionality which enables/disables the field\nname autocompletion in the query input on the search/dashboards pages if\nthe user has a user preference for enableSmartSearch set which is\nfalse.\nFixes #7809.\nHow Has This Been Tested?\n\n\n\nScreenshots (if appropriate):\nTypes of changes\n\n\n Bug fix (non-breaking change which fixes an issue)\n New feature (non-breaking change which adds functionality)\n Refactoring (non-breaking change)\n Breaking change (fix or feature that would cause existing functionality to change)\n\nChecklist:\n\n\n\n My code follows the code style of this project.\n My change requires a change to the documentation.\n I have updated the documentation accordingly.\n I have read the CONTRIBUTING document.\n I have added tests to cover my changes.", "createdAt": "2020-04-15T15:09:36Z", "url": "https://github.com/Graylog2/graylog2-server/pull/7885", "merged": true, "mergeCommit": {"oid": "d4049df01e94b211e7360b6c4db352eda8a84ae5"}, "closed": true, "closedAt": "2020-04-20T08:02:41Z", "author": {"login": "dennisoelkers"}, "timelineItems": {"totalCount": 18, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcX8CQ3gFqTM5NDAxMDQ0MA==", "endCursor": "Y3Vyc29yOnYyOpPPAAABcZacPZAFqTM5NjIyNDQzOQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzk0MDEwNDQw", "url": "https://github.com/Graylog2/graylog2-server/pull/7885#pullrequestreview-394010440", "createdAt": "2020-04-15T18:03:06Z", "commit": {"oid": "f33c5d83d4ff8388433ccc4910b7c51d43a15e1e"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xNVQxODowMzowNlrOGGFYZA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xNVQxODowMzowNlrOGGFYZA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwOTAzMjgwNA==", "bodyText": "Should probably keep these to the defaultProps instead of potentially resetting what the default is here.", "url": "https://github.com/Graylog2/graylog2-server/pull/7885#discussion_r409032804", "createdAt": "2020-04-15T18:03:06Z", "author": {"login": "kyleknighted"}, "path": "graylog2-web-interface/src/views/components/SearchBar.jsx", "diffHunk": "@@ -21,90 +23,100 @@ import HorizontalSpacer from 'views/components/horizontalspacer/HorizontalSpacer\n import { QueriesActions } from 'views/stores/QueriesStore';\n import { CurrentQueryStore } from 'views/stores/CurrentQueryStore';\n import { StreamsStore } from 'views/stores/StreamsStore';\n-import { QueryFiltersActions, QueryFiltersStore } from 'views/stores/QueryFiltersStore';\n+import { QueryFiltersStore } from 'views/stores/QueryFiltersStore';\n+import Query, { createElasticsearchQueryString, filtersForQuery, filtersToStreamSet } from 'views/logic/queries/Query';\n+import type { FilterType, QueryId, TimeRange } from 'views/logic/queries/Query';\n+import SearchBarForm from './searchbar/SearchBarForm';\n \n type Props = {\n   availableStreams: Array<*>,\n   config: any,\n-  currentQuery: {\n-    id: string,\n-    timerange: any,\n-    query: {\n-      query_string: string,\n-    },\n-  },\n+  currentQuery: Query,\n   disableSearch: boolean,\n-  onExecute: () => void,\n-  queryFilters: Immutable.Map<any, any>,\n+  onSubmit: ({ timerange: TimeRange, streams: Array<string>, queryString: string }, Query) => Promise<any>,\n+  queryFilters: Immutable.Map<QueryId, FilterType>,\n+};\n+\n+const defaultOnSubmit = ({ timerange, streams, queryString }, currentQuery: Query) => {\n+  const newQuery = currentQuery.toBuilder()\n+    .timerange(timerange)\n+    .filter(filtersForQuery(streams))\n+    .query(createElasticsearchQueryString(queryString))\n+    .build();\n+\n+  return QueriesActions.update(newQuery.id, newQuery);\n };\n \n-const SearchBar = ({ availableStreams, config, currentQuery, disableSearch = false, onExecute: performSearch, queryFilters }: Props) => {\n+const SearchBar = ({ availableStreams, config, currentQuery, disableSearch = false, queryFilters, onSubmit = defaultOnSubmit }: Props) => {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f33c5d83d4ff8388433ccc4910b7c51d43a15e1e"}, "originalPosition": 49}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzk0MDQxMDQz", "url": "https://github.com/Graylog2/graylog2-server/pull/7885#pullrequestreview-394041043", "createdAt": "2020-04-15T18:45:25Z", "commit": {"oid": "f33c5d83d4ff8388433ccc4910b7c51d43a15e1e"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xNVQxODo0NToyNVrOGGG49w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xNVQxODo0NToyNVrOGGG49w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwOTA1NzUyNw==", "bodyText": "Since you're not using the Theme here, you can just pass void instead of ThemeInterface\n\n  \n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            const DirtyButton: StyledComponent<{}, ThemeInterface, any> = styled(Button)`\n          \n          \n            \n            const DirtyButton: StyledComponent<{}, void, any> = styled(Button)`", "url": "https://github.com/Graylog2/graylog2-server/pull/7885#discussion_r409057527", "createdAt": "2020-04-15T18:45:25Z", "author": {"login": "kyleknighted"}, "path": "graylog2-web-interface/src/views/components/searchbar/SearchButton.jsx", "diffHunk": "@@ -1,24 +1,60 @@\n+// @flow strict\n import React from 'react';\n import PropTypes from 'prop-types';\n+import styled from 'styled-components';\n+import type { StyledComponent } from 'styled-components';\n \n import { Button } from 'components/graylog';\n import { Spinner, Icon } from 'components/common';\n+import type { ThemeInterface } from 'theme/index';\n \n-const SearchButton = ({ running, disabled, glyph }) => (\n-  <Button type=\"submit\" bsStyle={running ? 'warning' : 'success'} disabled={disabled} className=\"pull-left search-button-execute\">\n-    {running ? <Spinner fixedWidth pulse text=\"\" /> : <Icon name={glyph} /> }\n-  </Button>\n-);\n+const DirtyButton: StyledComponent<{}, ThemeInterface, any> = styled(Button)`", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f33c5d83d4ff8388433ccc4910b7c51d43a15e1e"}, "originalPosition": 16}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzk0MDQyOTEw", "url": "https://github.com/Graylog2/graylog2-server/pull/7885#pullrequestreview-394042910", "createdAt": "2020-04-15T18:48:06Z", "commit": {"oid": "f33c5d83d4ff8388433ccc4910b7c51d43a15e1e"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xNVQxODo0ODowNlrOGGG--g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xNVQxODo0ODowNlrOGGG--g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwOTA1OTA2Ng==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            import styled from 'styled-components';\n          \n          \n            \n            import type { StyledComponent } from 'styled-components';\n          \n          \n            \n            import styled, { type StyledComponent } from 'styled-components';", "url": "https://github.com/Graylog2/graylog2-server/pull/7885#discussion_r409059066", "createdAt": "2020-04-15T18:48:06Z", "author": {"login": "kyleknighted"}, "path": "graylog2-web-interface/src/views/components/searchbar/SearchButton.jsx", "diffHunk": "@@ -1,24 +1,60 @@\n+// @flow strict\n import React from 'react';\n import PropTypes from 'prop-types';\n+import styled from 'styled-components';\n+import type { StyledComponent } from 'styled-components';", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f33c5d83d4ff8388433ccc4910b7c51d43a15e1e"}, "originalPosition": 5}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzk0MDQzNTI2", "url": "https://github.com/Graylog2/graylog2-server/pull/7885#pullrequestreview-394043526", "createdAt": "2020-04-15T18:48:58Z", "commit": {"oid": "f33c5d83d4ff8388433ccc4910b7c51d43a15e1e"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xNVQxODo0ODo1OFrOGGHA7A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xNVQxODo0ODo1OFrOGGHA7A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwOTA1OTU2NA==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            import type { ThemeInterface } from 'theme/index';", "url": "https://github.com/Graylog2/graylog2-server/pull/7885#discussion_r409059564", "createdAt": "2020-04-15T18:48:58Z", "author": {"login": "kyleknighted"}, "path": "graylog2-web-interface/src/views/components/searchbar/SearchButton.jsx", "diffHunk": "@@ -1,24 +1,60 @@\n+// @flow strict\n import React from 'react';\n import PropTypes from 'prop-types';\n+import styled from 'styled-components';\n+import type { StyledComponent } from 'styled-components';\n \n import { Button } from 'components/graylog';\n import { Spinner, Icon } from 'components/common';\n+import type { ThemeInterface } from 'theme/index';", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f33c5d83d4ff8388433ccc4910b7c51d43a15e1e"}, "originalPosition": 9}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "f33c5d83d4ff8388433ccc4910b7c51d43a15e1e", "author": {"user": {"login": "dennisoelkers", "name": "Dennis Oelkers"}}, "url": "https://github.com/Graylog2/graylog2-server/commit/f33c5d83d4ff8388433ccc4910b7c51d43a15e1e", "committedDate": "2020-04-15T15:07:30Z", "message": "Enable/disable auto completion based on user preference."}, "afterCommit": {"oid": "facbc5934098c6d6877f0b9c87f129be77f5ae3d", "author": {"user": {"login": "dennisoelkers", "name": "Dennis Oelkers"}}, "url": "https://github.com/Graylog2/graylog2-server/commit/facbc5934098c6d6877f0b9c87f129be77f5ae3d", "committedDate": "2020-04-16T11:20:23Z", "message": "Updating `QueryInput` tests."}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "333a7e75f6f6cf7b99b351145edb8f336319d4d2", "author": {"user": {"login": "dennisoelkers", "name": "Dennis Oelkers"}}, "url": "https://github.com/Graylog2/graylog2-server/commit/333a7e75f6f6cf7b99b351145edb8f336319d4d2", "committedDate": "2020-04-16T12:56:29Z", "message": "Using shared `defaultProps` object."}, "afterCommit": {"oid": "87fb148f089815e7b368fd26f1378a0323163d1d", "author": {"user": {"login": "dennisoelkers", "name": "Dennis Oelkers"}}, "url": "https://github.com/Graylog2/graylog2-server/commit/87fb148f089815e7b368fd26f1378a0323163d1d", "committedDate": "2020-04-16T14:51:50Z", "message": "Using shared `defaultProps` object."}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "87fb148f089815e7b368fd26f1378a0323163d1d", "author": {"user": {"login": "dennisoelkers", "name": "Dennis Oelkers"}}, "url": "https://github.com/Graylog2/graylog2-server/commit/87fb148f089815e7b368fd26f1378a0323163d1d", "committedDate": "2020-04-16T14:51:50Z", "message": "Using shared `defaultProps` object."}, "afterCommit": {"oid": "c08292fa37c60c803bf82c58cfe0915362aa1938", "author": {"user": {"login": "dennisoelkers", "name": "Dennis Oelkers"}}, "url": "https://github.com/Graylog2/graylog2-server/commit/c08292fa37c60c803bf82c58cfe0915362aa1938", "committedDate": "2020-04-16T15:03:29Z", "message": "Using shared `defaultProps` object."}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "c08292fa37c60c803bf82c58cfe0915362aa1938", "author": {"user": {"login": "dennisoelkers", "name": "Dennis Oelkers"}}, "url": "https://github.com/Graylog2/graylog2-server/commit/c08292fa37c60c803bf82c58cfe0915362aa1938", "committedDate": "2020-04-16T15:03:29Z", "message": "Using shared `defaultProps` object."}, "afterCommit": {"oid": "4fd08bb0614b20dc7add4396643b189dda69f70e", "author": {"user": {"login": "dennisoelkers", "name": "Dennis Oelkers"}}, "url": "https://github.com/Graylog2/graylog2-server/commit/4fd08bb0614b20dc7add4396643b189dda69f70e", "committedDate": "2020-04-17T08:03:58Z", "message": "Using shared `defaultProps` object."}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "4fd08bb0614b20dc7add4396643b189dda69f70e", "author": {"user": {"login": "dennisoelkers", "name": "Dennis Oelkers"}}, "url": "https://github.com/Graylog2/graylog2-server/commit/4fd08bb0614b20dc7add4396643b189dda69f70e", "committedDate": "2020-04-17T08:03:58Z", "message": "Using shared `defaultProps` object."}, "afterCommit": {"oid": "586f56189bb735bd2ea1ff9db5eb62270ec7a2cf", "author": {"user": {"login": "dennisoelkers", "name": "Dennis Oelkers"}}, "url": "https://github.com/Graylog2/graylog2-server/commit/586f56189bb735bd2ea1ff9db5eb62270ec7a2cf", "committedDate": "2020-04-17T10:37:47Z", "message": "Using shared `defaultProps` object."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "bdf355a772f485fb8e6bbfd8213189b96f7df4c7", "author": {"user": {"login": "dennisoelkers", "name": "Dennis Oelkers"}}, "url": "https://github.com/Graylog2/graylog2-server/commit/bdf355a772f485fb8e6bbfd8213189b96f7df4c7", "committedDate": "2020-04-17T12:36:38Z", "message": "Updating snapshots."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ef47a4feca86cbf05db8dcb920c30d4eed5fd26a", "author": {"user": {"login": "dennisoelkers", "name": "Dennis Oelkers"}}, "url": "https://github.com/Graylog2/graylog2-server/commit/ef47a4feca86cbf05db8dcb920c30d4eed5fd26a", "committedDate": "2020-04-17T12:36:39Z", "message": "Replacing homebrewn placeholder with ace feature."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c41641a22ca61d87a3293299a78794cdfa4be2f0", "author": {"user": {"login": "dennisoelkers", "name": "Dennis Oelkers"}}, "url": "https://github.com/Graylog2/graylog2-server/commit/c41641a22ca61d87a3293299a78794cdfa4be2f0", "committedDate": "2020-04-17T12:36:39Z", "message": "Refactoring `QueryInput` to functional component."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d50bbe6358a5fdfd3c91cf9d98dc018e35028f55", "author": {"user": {"login": "dennisoelkers", "name": "Dennis Oelkers"}}, "url": "https://github.com/Graylog2/graylog2-server/commit/d50bbe6358a5fdfd3c91cf9d98dc018e35028f55", "committedDate": "2020-04-17T12:36:39Z", "message": "Enable/disable auto completion based on user preference."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a41206a5d9752be4564fd13eedf740f5a6fc873d", "author": {"user": {"login": "dennisoelkers", "name": "Dennis Oelkers"}}, "url": "https://github.com/Graylog2/graylog2-server/commit/a41206a5d9752be4564fd13eedf740f5a6fc873d", "committedDate": "2020-04-17T12:36:39Z", "message": "Updating `QueryInput` tests."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "66dc4372ff490d5d47ebac7867a7bd52c3254a22", "author": {"user": {"login": "dennisoelkers", "name": "Dennis Oelkers"}}, "url": "https://github.com/Graylog2/graylog2-server/commit/66dc4372ff490d5d47ebac7867a7bd52c3254a22", "committedDate": "2020-04-17T12:36:39Z", "message": "Fixing linter hint."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "7c3b3ba0940a551a55eca0ccaf2a197b10e1be52", "author": {"user": {"login": "dennisoelkers", "name": "Dennis Oelkers"}}, "url": "https://github.com/Graylog2/graylog2-server/commit/7c3b3ba0940a551a55eca0ccaf2a197b10e1be52", "committedDate": "2020-04-17T12:36:40Z", "message": "Using shared `defaultProps` object."}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "586f56189bb735bd2ea1ff9db5eb62270ec7a2cf", "author": {"user": {"login": "dennisoelkers", "name": "Dennis Oelkers"}}, "url": "https://github.com/Graylog2/graylog2-server/commit/586f56189bb735bd2ea1ff9db5eb62270ec7a2cf", "committedDate": "2020-04-17T10:37:47Z", "message": "Using shared `defaultProps` object."}, "afterCommit": {"oid": "7c3b3ba0940a551a55eca0ccaf2a197b10e1be52", "author": {"user": {"login": "dennisoelkers", "name": "Dennis Oelkers"}}, "url": "https://github.com/Graylog2/graylog2-server/commit/7c3b3ba0940a551a55eca0ccaf2a197b10e1be52", "committedDate": "2020-04-17T12:36:40Z", "message": "Using shared `defaultProps` object."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzk2MjI0NDM5", "url": "https://github.com/Graylog2/graylog2-server/pull/7885#pullrequestreview-396224439", "createdAt": "2020-04-20T08:02:34Z", "commit": {"oid": "7c3b3ba0940a551a55eca0ccaf2a197b10e1be52"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2376, "cost": 1, "resetAt": "2021-10-28T18:54:27Z"}}}