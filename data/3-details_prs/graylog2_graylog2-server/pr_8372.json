{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDM2NDIwMzAz", "number": 8372, "title": "Provision ES storage implementation based on configured ES version.", "bodyText": "Description\n\nMotivation and Context\n\n\nThis change introduces a quick and dirty mechanism to configure the ES storage implementation used. The user is now able to define a elasticsearch_version configuration directive where just the major version (for now) is specified. Every storage implementation can register its adapters to a version. At runtime, the configured version is used to resolve interface bindings to their corresponding implementations.\nThis implementation is a bit ugly at the moment. It requires quite some boiler plate, but works for now, especially considering that the number of interfaces is not too big, reducing the boilerplate.\nOne way to improve this in the future is to load storage driver modules differently instead of reusing our generic plugin mechanism. This would allow us to define a different interface for storage driver modules, exposing the version they support and the module they need for binding explicitly. With this information, we could bind only the driver module which we want (and only once), instead of resolving at runtime.\nHow Has This Been Tested?\n\n\n\nScreenshots (if appropriate):\nTypes of changes\n\n\n Bug fix (non-breaking change which fixes an issue)\n New feature (non-breaking change which adds functionality)\n Refactoring (non-breaking change)\n Breaking change (fix or feature that would cause existing functionality to change)\n\nChecklist:\n\n\n\n My code follows the code style of this project.\n My change requires a change to the documentation.\n I have updated the documentation accordingly.\n I have read the CONTRIBUTING document.\n I have added tests to cover my changes.", "createdAt": "2020-06-18T11:51:00Z", "url": "https://github.com/Graylog2/graylog2-server/pull/8372", "merged": true, "mergeCommit": {"oid": "a977a563171a84dcf272fa82c30edadf8056e678"}, "closed": true, "closedAt": "2020-06-24T10:20:51Z", "author": {"login": "dennisoelkers"}, "timelineItems": {"totalCount": 10, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABctr3kIgBqjM0NjY5OTM3NzQ=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcuXX_QgFqTQzNjUxNTgyMw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "f0e0e5acf5d2997a0e1bd00b9a73300d0d0ba129", "author": {"user": {"login": "dennisoelkers", "name": "Dennis Oelkers"}}, "url": "https://github.com/Graylog2/graylog2-server/commit/f0e0e5acf5d2997a0e1bd00b9a73300d0d0ba129", "committedDate": "2020-06-18T11:44:25Z", "message": "Renaming class, injecting providers in Map instead of instances."}, "afterCommit": {"oid": "cfdad76c66161d170aeb9c5514858fc72799007b", "author": {"user": {"login": "dennisoelkers", "name": "Dennis Oelkers"}}, "url": "https://github.com/Graylog2/graylog2-server/commit/cfdad76c66161d170aeb9c5514858fc72799007b", "committedDate": "2020-06-22T07:39:07Z", "message": "Renaming module, binding backends with version."}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "33a45f35aed6cdf51350ee477a1ca9e0037ede8c", "author": {"user": {"login": "dennisoelkers", "name": "Dennis Oelkers"}}, "url": "https://github.com/Graylog2/graylog2-server/commit/33a45f35aed6cdf51350ee477a1ca9e0037ede8c", "committedDate": "2020-06-22T12:37:19Z", "message": "Pre-Binding export backend in a version-aware manner."}, "afterCommit": {"oid": "e182aba25002fc6a429007c4d558e6d50316f96e", "author": {"user": {"login": "dennisoelkers", "name": "Dennis Oelkers"}}, "url": "https://github.com/Graylog2/graylog2-server/commit/e182aba25002fc6a429007c4d558e6d50316f96e", "committedDate": "2020-06-22T12:37:51Z", "message": "Pre-Binding export backend in a version-aware manner."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "526c51be017a44c4651ab21d617c4eb8f6314d13", "author": {"user": {"login": "dennisoelkers", "name": "Dennis Oelkers"}}, "url": "https://github.com/Graylog2/graylog2-server/commit/526c51be017a44c4651ab21d617c4eb8f6314d13", "committedDate": "2020-06-23T10:04:49Z", "message": "Using version specific providers to inject implementations based on config setting."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "3d56136b727e5eb190d398af297ec3eae84d64bb", "author": {"user": {"login": "dennisoelkers", "name": "Dennis Oelkers"}}, "url": "https://github.com/Graylog2/graylog2-server/commit/3d56136b727e5eb190d398af297ec3eae84d64bb", "committedDate": "2020-06-23T10:04:51Z", "message": "Renaming class, injecting providers in Map instead of instances."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "70029f8677ead20278d5e684ded69a8558057f47", "author": {"user": {"login": "dennisoelkers", "name": "Dennis Oelkers"}}, "url": "https://github.com/Graylog2/graylog2-server/commit/70029f8677ead20278d5e684ded69a8558057f47", "committedDate": "2020-06-23T10:05:12Z", "message": "Renaming module, binding backends with version."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "8da61ec17511ad47cf2e57da027dce06c32dce0d", "author": {"user": {"login": "dennisoelkers", "name": "Dennis Oelkers"}}, "url": "https://github.com/Graylog2/graylog2-server/commit/8da61ec17511ad47cf2e57da027dce06c32dce0d", "committedDate": "2020-06-23T10:05:13Z", "message": "Pre-Binding export backend in a version-aware manner."}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "e182aba25002fc6a429007c4d558e6d50316f96e", "author": {"user": {"login": "dennisoelkers", "name": "Dennis Oelkers"}}, "url": "https://github.com/Graylog2/graylog2-server/commit/e182aba25002fc6a429007c4d558e6d50316f96e", "committedDate": "2020-06-22T12:37:51Z", "message": "Pre-Binding export backend in a version-aware manner."}, "afterCommit": {"oid": "8da61ec17511ad47cf2e57da027dce06c32dce0d", "author": {"user": {"login": "dennisoelkers", "name": "Dennis Oelkers"}}, "url": "https://github.com/Graylog2/graylog2-server/commit/8da61ec17511ad47cf2e57da027dce06c32dce0d", "committedDate": "2020-06-23T10:05:13Z", "message": "Pre-Binding export backend in a version-aware manner."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDM1NjcwNDQy", "url": "https://github.com/Graylog2/graylog2-server/pull/8372#pullrequestreview-435670442", "createdAt": "2020-06-23T10:59:25Z", "commit": {"oid": "8da61ec17511ad47cf2e57da027dce06c32dce0d"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yM1QxMDo1OToyNVrOGnkGZw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yM1QxMTowNzo0M1rOGnkVcQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NDEzOTExMQ==", "bodyText": "I would suggest renaming this to SUPPORTED_ES_VERSION. This would especially simplify understanding other classes where this constant is referenced.", "url": "https://github.com/Graylog2/graylog2-server/pull/8372#discussion_r444139111", "createdAt": "2020-06-23T10:59:25Z", "author": {"login": "alex-konn"}, "path": "graylog-storage-elasticsearch6/src/main/java/org/graylog/storage/elasticsearch6/Elasticsearch6Plugin.java", "diffHunk": "@@ -4,10 +4,13 @@\n import org.graylog2.plugin.Plugin;\n import org.graylog2.plugin.PluginMetaData;\n import org.graylog2.plugin.PluginModule;\n+import org.graylog2.plugin.Version;\n \n import java.util.Collection;\n \n public class Elasticsearch6Plugin implements Plugin {\n+    public static final Version SUPPORTED_VERSION = Version.from(6, 0, 0);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "8da61ec17511ad47cf2e57da027dce06c32dce0d"}, "originalPosition": 9}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NDE0Mjk2MQ==", "bodyText": "Wouldn't it be enough to use bindForVersion(SUPPORTED_VERSION, ExportBackend.class); directly here instead of adding two additional private methods?", "url": "https://github.com/Graylog2/graylog2-server/pull/8372#discussion_r444142961", "createdAt": "2020-06-23T11:07:43Z", "author": {"login": "alex-konn"}, "path": "graylog-storage-elasticsearch6/src/main/java/org/graylog/storage/elasticsearch6/ViewsESBackendModule.java", "diffHunk": "@@ -97,8 +97,20 @@ protected void configure() {\n         registerPivotBucketHandler(Time.NAME, ESTimeHandler.class);\n         registerPivotBucketHandler(DateRangeBucket.NAME, ESDateRangeHandler.class);\n \n-        bind(ExportBackend.class).to(ElasticsearchExportBackend.class);\n-        bind(RequestStrategy.class).to(org.graylog.storage.elasticsearch6.views.export.Scroll.class);\n+        bindExportBackend().to(ElasticsearchExportBackend.class);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "8da61ec17511ad47cf2e57da027dce06c32dce0d"}, "originalPosition": 33}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b3b0e3eeca126c8345b59a528013ee19cbd8e5d2", "author": {"user": {"login": "dennisoelkers", "name": "Dennis Oelkers"}}, "url": "https://github.com/Graylog2/graylog2-server/commit/b3b0e3eeca126c8345b59a528013ee19cbd8e5d2", "committedDate": "2020-06-23T14:54:58Z", "message": "Renaming constant."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDM2NTE1ODIz", "url": "https://github.com/Graylog2/graylog2-server/pull/8372#pullrequestreview-436515823", "createdAt": "2020-06-24T10:20:37Z", "commit": {"oid": "b3b0e3eeca126c8345b59a528013ee19cbd8e5d2"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3086, "cost": 1, "resetAt": "2021-10-28T18:54:27Z"}}}