{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTAzOTU0MzY0", "number": 9165, "title": "Expose `isCloud` to frontend", "bodyText": "Description\n\nExposes an isCloud flag via config.js.\nWhen running in production mode, the flag is mirroring the is_cloud server configuration parameter which is by default false and has to be enabled explicitly.\nWhen running in development mode (env DEVELOPMENT=true), the flag is false by default but will be automatically set to true when the cloud plugin is present.\nMotivation and Context\n\n\nWhen running in a cloud context, certain UI elements need to be different than for an on-premise deployment. With this flag exposed, the UI has an easy way to know about the context.\nHow Has This Been Tested?\n\n\n\nTo see if this works in development mode I altered the DEV badge we show in the header. If the cloud context is detected, it now looks like this:\n\nChecked that this works also in the production build by temporarily adding console.log debugging statements and building with maven.\nScreenshots (if appropriate):\nTypes of changes\n\n\n Bug fix (non-breaking change which fixes an issue)\n New feature (non-breaking change which adds functionality)\n Refactoring (non-breaking change)\n Breaking change (fix or feature that would cause existing functionality to change)\n\nChecklist:\n\n\n\n My code follows the code style of this project.\n My change requires a change to the documentation.\n I have updated the documentation accordingly.\n I have read the CONTRIBUTING document.\n I have added tests to cover my changes.", "createdAt": "2020-10-15T09:20:03Z", "url": "https://github.com/Graylog2/graylog2-server/pull/9165", "merged": true, "mergeCommit": {"oid": "608f1f7194e62793775be71be5e85f21c8ba537f"}, "closed": true, "closedAt": "2020-10-19T12:07:02Z", "author": {"login": "thll"}, "timelineItems": {"totalCount": 11, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdScrgWAH2gAyNTAzOTU0MzY0OjVlMTYwOTE4YjJkNTJlMjkxYzg5YTEwMTRhZGYzODU0NjZiOTRiYmM=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdUDAtwgFqTUxMTY4OTA4Nw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "5e160918b2d52e291c89a1014adf385466b94bbc", "author": {"user": {"login": "thll", "name": "Othello Maurer"}}, "url": "https://github.com/Graylog2/graylog2-server/commit/5e160918b2d52e291c89a1014adf385466b94bbc", "committedDate": "2020-10-14T12:52:44Z", "message": "Expose `isCloud` to frontend\n\nStill needs cleaning up and will probably fail if the cloud plugin is\nnot loaded."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "4fb91b370d507181fbf2328bb39af16455543162", "author": {"user": {"login": "thll", "name": "Othello Maurer"}}, "url": "https://github.com/Graylog2/graylog2-server/commit/4fb91b370d507181fbf2328bb39af16455543162", "committedDate": "2020-10-15T09:08:24Z", "message": "Don't use environment variable to transport value for isCloud"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d00a48ceed4bcd37a063cc95064ac3551e3c1656", "author": {"user": {"login": "thll", "name": "Othello Maurer"}}, "url": "https://github.com/Graylog2/graylog2-server/commit/d00a48ceed4bcd37a063cc95064ac3551e3c1656", "committedDate": "2020-10-15T12:43:17Z", "message": "new approach: don't use template but webpack define plugin instead"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ce684bdaf99bc0bff88b2073182cd546731cbf2c", "author": {"user": {"login": "thll", "name": "Othello Maurer"}}, "url": "https://github.com/Graylog2/graylog2-server/commit/ce684bdaf99bc0bff88b2073182cd546731cbf2c", "committedDate": "2020-10-15T12:53:26Z", "message": "Fix ESLint warnings"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "addd0fa6191b55be710439149509f38b09026e7c", "author": {"user": {"login": "thll", "name": "Othello Maurer"}}, "url": "https://github.com/Graylog2/graylog2-server/commit/addd0fa6191b55be710439149509f38b09026e7c", "committedDate": "2020-10-15T13:08:51Z", "message": "Add \"CLOUD\" to dev badge also for narrow screens"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "03f5eda80af62415798b5d59b156c4e4558fdfc3", "author": {"user": {"login": "thll", "name": "Othello Maurer"}}, "url": "https://github.com/Graylog2/graylog2-server/commit/03f5eda80af62415798b5d59b156c4e4558fdfc3", "committedDate": "2020-10-16T09:57:09Z", "message": "Add missing parentheses"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTExNDQ5MTMw", "url": "https://github.com/Graylog2/graylog2-server/pull/9165#pullrequestreview-511449130", "createdAt": "2020-10-19T06:40:30Z", "commit": {"oid": "03f5eda80af62415798b5d59b156c4e4558fdfc3"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xOVQwNjo0MDozMFrOHj_uKA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xOVQwNjo1MDoyM1rOHj_-kg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNzUwNjIxNg==", "bodyText": "I'd remove the prefix space here\nThere is already a space before DEV so I think we can leave it out of the 'CLOUD ' string, or remove the space before DEV\n\n  \n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                      && <Badge bsStyle=\"danger\" className=\"small-scrn-badge dev-badge\">{AppConfig.isCloud() ? 'CLOUD ' : ''} DEV</Badge>\n          \n          \n            \n                      && <Badge bsStyle=\"danger\" className=\"small-scrn-badge dev-badge\">{AppConfig.isCloud() ? 'CLOUD' : ''} DEV</Badge>", "url": "https://github.com/Graylog2/graylog2-server/pull/9165#discussion_r507506216", "createdAt": "2020-10-19T06:40:30Z", "author": {"login": "Gaya"}, "path": "graylog2-web-interface/src/components/navigation/Navigation.jsx", "diffHunk": "@@ -90,7 +90,7 @@ const Navigation = ({ permissions, fullName, location, loginName }) => {\n \n         {\n         AppConfig.gl2DevMode()\n-          && <Badge bsStyle=\"danger\" className=\"small-scrn-badge dev-badge\">DEV</Badge>\n+          && <Badge bsStyle=\"danger\" className=\"small-scrn-badge dev-badge\">{AppConfig.isCloud() ? 'CLOUD ' : ''} DEV</Badge>", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "03f5eda80af62415798b5d59b156c4e4558fdfc3"}, "originalPosition": 5}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNzUwNjMxOA==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                            <Badge bsStyle=\"danger\" className=\"dev-badge\">{AppConfig.isCloud() ? 'CLOUD ' : ''} DEV</Badge>\n          \n          \n            \n                            <Badge bsStyle=\"danger\" className=\"dev-badge\">{AppConfig.isCloud() ? 'CLOUD ' : ''}DEV</Badge>", "url": "https://github.com/Graylog2/graylog2-server/pull/9165#discussion_r507506318", "createdAt": "2020-10-19T06:40:48Z", "author": {"login": "Gaya"}, "path": "graylog2-web-interface/src/components/navigation/Navigation.jsx", "diffHunk": "@@ -124,7 +124,7 @@ const Navigation = ({ permissions, fullName, location, loginName }) => {\n           AppConfig.gl2DevMode()\n             && (\n               <InactiveNavItem className=\"dev-badge-wrap\">\n-                <Badge bsStyle=\"danger\" className=\"dev-badge\">DEV</Badge>\n+                <Badge bsStyle=\"danger\" className=\"dev-badge\">{AppConfig.isCloud() ? 'CLOUD ' : ''} DEV</Badge>", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "03f5eda80af62415798b5d59b156c4e4558fdfc3"}, "originalPosition": 14}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNzUwODQyNw==", "bodyText": "You can remove the parenthesis after typeof\n\n  \n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                if (typeof (IS_CLOUD) !== 'undefined') {\n          \n          \n            \n                if (typeof IS_CLOUD !== 'undefined') {", "url": "https://github.com/Graylog2/graylog2-server/pull/9165#discussion_r507508427", "createdAt": "2020-10-19T06:45:48Z", "author": {"login": "Gaya"}, "path": "graylog2-web-interface/src/util/AppConfig.js", "diffHunk": "@@ -30,6 +30,15 @@ const AppConfig = {\n     return this.appConfig().rootTimeZone;\n   },\n \n+  isCloud() {\n+    if (typeof (IS_CLOUD) !== 'undefined') {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "03f5eda80af62415798b5d59b156c4e4558fdfc3"}, "originalPosition": 5}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNzUwOTk5Mw==", "bodyText": "Array.some() will return true if there is any element which matches the condition. So no need to filter and then count the amount of elements.\n\n  \n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            if (pluginConfigs.filter((config) => config.includes('graylog-plugin-cloud/server-plugin')).length > 0) {\n          \n          \n            \n            if (pluginConfigs.some((config) => config.includes('graylog-plugin-cloud/server-plugin'))) {", "url": "https://github.com/Graylog2/graylog2-server/pull/9165#discussion_r507509993", "createdAt": "2020-10-19T06:49:20Z", "author": {"login": "Gaya"}, "path": "graylog2-web-interface/webpack.combined.config.js", "diffHunk": "@@ -16,7 +16,11 @@ const globOptions = {\n   nodir: true,\n };\n \n-const pluginConfigs = process.env.disable_plugins === 'true' ? [] : glob.sync(pluginConfigPattern, globOptions).map(config => `${globCwd}/${config}`);\n+const pluginConfigs = process.env.disable_plugins === 'true' ? [] : glob.sync(pluginConfigPattern, globOptions).map((config) => `${globCwd}/${config}`);\n+\n+if (pluginConfigs.filter((config) => config.includes('graylog-plugin-cloud/server-plugin')).length > 0) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "03f5eda80af62415798b5d59b156c4e4558fdfc3"}, "originalPosition": 7}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNzUxMDQxOA==", "bodyText": "Much better indeed!", "url": "https://github.com/Graylog2/graylog2-server/pull/9165#discussion_r507510418", "createdAt": "2020-10-19T06:50:23Z", "author": {"login": "Gaya"}, "path": "graylog2-web-interface/webpack.combined.config.js", "diffHunk": "@@ -29,10 +33,9 @@ function getPluginName(pluginConfig) {\n     // If a package.json file exists (should normally be the case) use the package name for pluginName\n     const pkg = JSON.parse(fs.readFileSync(packageConfig, 'utf8'));\n     return pkg.name.replace(/\\s+/g, '');\n-  } else {\n-    // Otherwise just use the directory name of the webpack config file\n-    return path.basename(path.dirname(pluginConfig));\n   }\n+  // Otherwise just use the directory name of the webpack config file", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "03f5eda80af62415798b5d59b156c4e4558fdfc3"}, "originalPosition": 21}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "8607388d79abc54c5859e31bf5c9b134d035b1b4", "author": {"user": {"login": "thll", "name": "Othello Maurer"}}, "url": "https://github.com/Graylog2/graylog2-server/commit/8607388d79abc54c5859e31bf5c9b134d035b1b4", "committedDate": "2020-10-19T11:05:42Z", "message": "Remove extra space from badge\n\nCo-authored-by: Gaya Kessler <gaya@theclevernode.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a07e3b37c8234a0f4dc5fc50a90f892e863a5963", "author": {"user": {"login": "thll", "name": "Othello Maurer"}}, "url": "https://github.com/Graylog2/graylog2-server/commit/a07e3b37c8234a0f4dc5fc50a90f892e863a5963", "committedDate": "2020-10-19T11:20:36Z", "message": "Simplify expression\n\nCo-authored-by: Gaya Kessler <gaya@theclevernode.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "9c55b7886f3c7de2ca355ed8956848de20f3bdc6", "author": {"user": {"login": "thll", "name": "Othello Maurer"}}, "url": "https://github.com/Graylog2/graylog2-server/commit/9c55b7886f3c7de2ca355ed8956848de20f3bdc6", "committedDate": "2020-10-19T11:23:54Z", "message": "Remove parentheses\n\nCo-authored-by: Gaya Kessler <gaya@theclevernode.com>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTExNjg5MDg3", "url": "https://github.com/Graylog2/graylog2-server/pull/9165#pullrequestreview-511689087", "createdAt": "2020-10-19T12:06:13Z", "commit": {"oid": "9c55b7886f3c7de2ca355ed8956848de20f3bdc6"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3504, "cost": 1, "resetAt": "2021-10-28T18:54:27Z"}}}