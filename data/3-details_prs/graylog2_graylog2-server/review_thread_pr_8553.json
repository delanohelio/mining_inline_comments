{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDQ5NTEyNDAz", "number": 8553, "reviewThreads": {"totalCount": 8, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xNlQxMDoxMjowOFrOEPEH8w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xNlQxMDozNToyNVrOEPEnbg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjg0MjMxNjY3OnYy", "diffSide": "RIGHT", "path": "graylog2-web-interface/src/components/users/PaginatedItem.jsx", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xNlQxMDoxMjowOFrOGykXJA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xNlQxMDoxMjowOFrOGykXJA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NTY3NzczMg==", "bodyText": "Let's add a space here.", "url": "https://github.com/Graylog2/graylog2-server/pull/8553#discussion_r455677732", "createdAt": "2020-07-16T10:12:08Z", "author": {"login": "linuspahl"}, "path": "graylog2-web-interface/src/components/users/PaginatedItem.jsx", "diffHunk": "@@ -0,0 +1,33 @@\n+// @flow strict\n+import * as React from 'react';\n+import styled, { css, type StyledComponent } from 'styled-components';\n+\n+import { type ThemeInterface } from 'theme';\n+\n+import type { DescriptiveItem } from './PaginatedItemOverview';\n+\n+type Props = { item: DescriptiveItem };\n+\n+const Container: StyledComponent<{ isAdmin: boolean }, ThemeInterface, HTMLSpanElement> = styled.span(({ isAdmin, theme }) => css`\n+  display:block;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "874e11fd2c09524d3c30a03d3c95b3fd78abbae4"}, "originalPosition": 12}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjg0MjMyMzkzOnYy", "diffSide": "RIGHT", "path": "graylog2-web-interface/src/components/users/PaginatedItem.jsx", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xNlQxMDoxNDoxN1rOGykbfg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xNlQxMDoxNDoxN1rOGykbfg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NTY3ODg0Ng==", "bodyText": "Whats ist the purpose of hl here? I saw a warning in the console, that hl is not a supported html tag.", "url": "https://github.com/Graylog2/graylog2-server/pull/8553#discussion_r455678846", "createdAt": "2020-07-16T10:14:17Z", "author": {"login": "linuspahl"}, "path": "graylog2-web-interface/src/components/users/PaginatedItem.jsx", "diffHunk": "@@ -0,0 +1,33 @@\n+// @flow strict\n+import * as React from 'react';\n+import styled, { css, type StyledComponent } from 'styled-components';\n+\n+import { type ThemeInterface } from 'theme';\n+\n+import type { DescriptiveItem } from './PaginatedItemOverview';\n+\n+type Props = { item: DescriptiveItem };\n+\n+const Container: StyledComponent<{ isAdmin: boolean }, ThemeInterface, HTMLSpanElement> = styled.span(({ isAdmin, theme }) => css`\n+  display:block;\n+  padding: 10px;\n+  background-color: ${theme.colors.table.background};\n+\n+  :nth-of-type(even) {\n+    background-color: ${theme.colors.table.backgroundAlt};\n+  };\n+`);\n+\n+const Header = styled.h4`\n+  padding-bottom: 5px;\n+`;\n+\n+const PaginatedItem = ({ item: { name, description } }: Props) => (\n+  <Container>\n+    <Header>{name}</Header>\n+    <span>{description}</span>\n+    <hl />", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "874e11fd2c09524d3c30a03d3c95b3fd78abbae4"}, "originalPosition": 29}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjg0MjM0NjE1OnYy", "diffSide": "RIGHT", "path": "graylog2-web-interface/src/components/users/PaginatedItemOverview.jsx", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xNlQxMDoyMDo0NlrOGykpdA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xNlQxMDoyMDo0NlrOGykpdA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NTY4MjQyMA==", "bodyText": "We could create a constant for the initial page size and use it here + for the PaginatedList -> pagesSizes", "url": "https://github.com/Graylog2/graylog2-server/pull/8553#discussion_r455682420", "createdAt": "2020-07-16T10:20:46Z", "author": {"login": "linuspahl"}, "path": "graylog2-web-interface/src/components/users/PaginatedItemOverview.jsx", "diffHunk": "@@ -0,0 +1,92 @@\n+// @flow strict\n+import * as React from 'react';\n+import { useEffect, useState } from 'react';\n+import styled from 'styled-components';\n+import * as Immutable from 'immutable';\n+\n+import { PaginatedList, SearchForm } from 'components/common';\n+\n+import PaginatedItem from './PaginatedItem';\n+\n+const Container = styled.div`\n+  margin-top: 10px;\n+`;\n+\n+export type PaginationInfo = {\n+  total: number,\n+  count: number,\n+  page: number,\n+  perPage: number,\n+  query: string,\n+};\n+\n+export interface DescriptiveItem {\n+  get id(): string,\n+  get name(): string,\n+  get description(): string,\n+}\n+\n+type ListOfDescriptiveItems = Immutable.List<DescriptiveItem>;\n+\n+export type PaginatedListType = {\n+  pagination: PaginationInfo,\n+  list: ListOfDescriptiveItems,\n+};\n+\n+type Props = {\n+  onLoad: (PaginationInfo) => Promise<PaginatedListType>,\n+};\n+\n+const PaginatedItemOverview = ({ onLoad }: Props) => {\n+  const [items, setItems] = useState();\n+  const [paginationInfo, setPaginationInfo] = useState({\n+    count: 0,\n+    total: 0,\n+    page: 1,\n+    perPage: 5,", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "874e11fd2c09524d3c30a03d3c95b3fd78abbae4"}, "originalPosition": 46}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjg0MjM1MjY4OnYy", "diffSide": "RIGHT", "path": "graylog2-web-interface/src/components/users/PaginatedItemOverview.jsx", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xNlQxMDoyMjo0NFrOGyktdw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xNlQxMDoyMjo0NFrOGyktdw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NTY4MzQ0Nw==", "bodyText": "There are some warnings in the console for these methods:\n.then() only accepts functions but was passed: [object Undefined]", "url": "https://github.com/Graylog2/graylog2-server/pull/8553#discussion_r455683447", "createdAt": "2020-07-16T10:22:44Z", "author": {"login": "linuspahl"}, "path": "graylog2-web-interface/src/components/users/PaginatedItemOverview.jsx", "diffHunk": "@@ -0,0 +1,92 @@\n+// @flow strict\n+import * as React from 'react';\n+import { useEffect, useState } from 'react';\n+import styled from 'styled-components';\n+import * as Immutable from 'immutable';\n+\n+import { PaginatedList, SearchForm } from 'components/common';\n+\n+import PaginatedItem from './PaginatedItem';\n+\n+const Container = styled.div`\n+  margin-top: 10px;\n+`;\n+\n+export type PaginationInfo = {\n+  total: number,\n+  count: number,\n+  page: number,\n+  perPage: number,\n+  query: string,\n+};\n+\n+export interface DescriptiveItem {\n+  get id(): string,\n+  get name(): string,\n+  get description(): string,\n+}\n+\n+type ListOfDescriptiveItems = Immutable.List<DescriptiveItem>;\n+\n+export type PaginatedListType = {\n+  pagination: PaginationInfo,\n+  list: ListOfDescriptiveItems,\n+};\n+\n+type Props = {\n+  onLoad: (PaginationInfo) => Promise<PaginatedListType>,\n+};\n+\n+const PaginatedItemOverview = ({ onLoad }: Props) => {\n+  const [items, setItems] = useState();\n+  const [paginationInfo, setPaginationInfo] = useState({\n+    count: 0,\n+    total: 0,\n+    page: 1,\n+    perPage: 5,\n+    query: '',\n+  });\n+\n+  const _setResponse = ({ list, pagination }: PaginatedListType) => {\n+    setPaginationInfo(pagination);\n+    setItems(list);\n+  };\n+\n+  useEffect(() => {\n+    onLoad(paginationInfo).then(_setResponse);\n+  }, []);\n+\n+  const _onPageChange = (query) => (page, perPage) => {\n+    const pageInfo = {\n+      ...paginationInfo,\n+      query,\n+      page,\n+      perPage,\n+    };\n+    onLoad(pageInfo).then(_setResponse);\n+  };\n+\n+  const _onSearch = (query) => {\n+    const pageInfo = {\n+      ...paginationInfo,\n+      page: 1,\n+      query,\n+    };\n+    onLoad(pageInfo).then(_setResponse);\n+  };\n+", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "874e11fd2c09524d3c30a03d3c95b3fd78abbae4"}, "originalPosition": 77}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjg0MjM1NzMzOnYy", "diffSide": "RIGHT", "path": "graylog2-web-interface/src/components/users/PaginatedItemOverview.jsx", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xNlQxMDoyNDowNlrOGykwMA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xNlQxMDoyNDowNlrOGykwMA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NTY4NDE0NA==", "bodyText": "We could display a message here, if there are no results for the current search.", "url": "https://github.com/Graylog2/graylog2-server/pull/8553#discussion_r455684144", "createdAt": "2020-07-16T10:24:06Z", "author": {"login": "linuspahl"}, "path": "graylog2-web-interface/src/components/users/PaginatedItemOverview.jsx", "diffHunk": "@@ -0,0 +1,92 @@\n+// @flow strict\n+import * as React from 'react';\n+import { useEffect, useState } from 'react';\n+import styled from 'styled-components';\n+import * as Immutable from 'immutable';\n+\n+import { PaginatedList, SearchForm } from 'components/common';\n+\n+import PaginatedItem from './PaginatedItem';\n+\n+const Container = styled.div`\n+  margin-top: 10px;\n+`;\n+\n+export type PaginationInfo = {\n+  total: number,\n+  count: number,\n+  page: number,\n+  perPage: number,\n+  query: string,\n+};\n+\n+export interface DescriptiveItem {\n+  get id(): string,\n+  get name(): string,\n+  get description(): string,\n+}\n+\n+type ListOfDescriptiveItems = Immutable.List<DescriptiveItem>;\n+\n+export type PaginatedListType = {\n+  pagination: PaginationInfo,\n+  list: ListOfDescriptiveItems,\n+};\n+\n+type Props = {\n+  onLoad: (PaginationInfo) => Promise<PaginatedListType>,\n+};\n+\n+const PaginatedItemOverview = ({ onLoad }: Props) => {\n+  const [items, setItems] = useState();\n+  const [paginationInfo, setPaginationInfo] = useState({\n+    count: 0,\n+    total: 0,\n+    page: 1,\n+    perPage: 5,\n+    query: '',\n+  });\n+\n+  const _setResponse = ({ list, pagination }: PaginatedListType) => {\n+    setPaginationInfo(pagination);\n+    setItems(list);\n+  };\n+\n+  useEffect(() => {\n+    onLoad(paginationInfo).then(_setResponse);\n+  }, []);\n+\n+  const _onPageChange = (query) => (page, perPage) => {\n+    const pageInfo = {\n+      ...paginationInfo,\n+      query,\n+      page,\n+      perPage,\n+    };\n+    onLoad(pageInfo).then(_setResponse);\n+  };\n+\n+  const _onSearch = (query) => {\n+    const pageInfo = {\n+      ...paginationInfo,\n+      page: 1,\n+      query,\n+    };\n+    onLoad(pageInfo).then(_setResponse);\n+  };\n+\n+  return (\n+    <PaginatedList onChange={_onPageChange(paginationInfo.query)}\n+                   pageSize={paginationInfo.perPage}\n+                   totalItems={paginationInfo.total}\n+                   pageSizes={[5, 10, 30]}\n+                   activePage={paginationInfo.page}>\n+      <SearchForm onSearch={_onSearch} />\n+      <Container>\n+        {items && items.toArray().map((item) => <PaginatedItem key={item.id} item={item} />) }", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "874e11fd2c09524d3c30a03d3c95b3fd78abbae4"}, "originalPosition": 86}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjg0MjM2NTU2OnYy", "diffSide": "RIGHT", "path": "graylog2-web-interface/src/components/users/UserDetails/RolesSection.jsx", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xNlQxMDoyNjozNFrOGyk1VQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xNlQxMDoyOTo0N1rOGyk8OA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NTY4NTQ2MQ==", "bodyText": "() => setLoading(false) \ud83d\ude09", "url": "https://github.com/Graylog2/graylog2-server/pull/8553#discussion_r455685461", "createdAt": "2020-07-16T10:26:34Z", "author": {"login": "linuspahl"}, "path": "graylog2-web-interface/src/components/users/UserDetails/RolesSection.jsx", "diffHunk": "@@ -0,0 +1,33 @@\n+// @flow strict\n+import * as React from 'react';\n+import { useState } from 'react';\n+\n+import User from 'logic/users/User';\n+import { AuthzRolesActions } from 'stores/roles/AuthzRolesStore';\n+\n+import PaginatedItemOverview, { type PaginationInfo, type PaginatedListType } from '../PaginatedItemOverview';\n+import SectionComponent from '../SectionComponent';\n+\n+type Props = {\n+  user: User,\n+};\n+\n+const RolesSection = ({ user: { username } }: Props) => {\n+  const [loading, setLoading] = useState(false);\n+\n+  const _onLoad = ({ page, perPage, query }: PaginationInfo): Promise<PaginatedListType> => {\n+    setLoading(true);\n+\n+    // $FlowFixMe Role implements Descriptive Item!!!\n+    return AuthzRolesActions.loadForUser(username, page, perPage, query)\n+      .then(setLoading(false));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "874e11fd2c09524d3c30a03d3c95b3fd78abbae4"}, "originalPosition": 23}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NTY4NzIyNA==", "bodyText": "(or something similar)", "url": "https://github.com/Graylog2/graylog2-server/pull/8553#discussion_r455687224", "createdAt": "2020-07-16T10:29:47Z", "author": {"login": "linuspahl"}, "path": "graylog2-web-interface/src/components/users/UserDetails/RolesSection.jsx", "diffHunk": "@@ -0,0 +1,33 @@\n+// @flow strict\n+import * as React from 'react';\n+import { useState } from 'react';\n+\n+import User from 'logic/users/User';\n+import { AuthzRolesActions } from 'stores/roles/AuthzRolesStore';\n+\n+import PaginatedItemOverview, { type PaginationInfo, type PaginatedListType } from '../PaginatedItemOverview';\n+import SectionComponent from '../SectionComponent';\n+\n+type Props = {\n+  user: User,\n+};\n+\n+const RolesSection = ({ user: { username } }: Props) => {\n+  const [loading, setLoading] = useState(false);\n+\n+  const _onLoad = ({ page, perPage, query }: PaginationInfo): Promise<PaginatedListType> => {\n+    setLoading(true);\n+\n+    // $FlowFixMe Role implements Descriptive Item!!!\n+    return AuthzRolesActions.loadForUser(username, page, perPage, query)\n+      .then(setLoading(false));", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NTY4NTQ2MQ=="}, "originalCommit": {"oid": "874e11fd2c09524d3c30a03d3c95b3fd78abbae4"}, "originalPosition": 23}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjg0MjM4MjQ5OnYy", "diffSide": "RIGHT", "path": "graylog2-web-interface/src/components/users/SectionComponent.jsx", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xNlQxMDozMToyN1rOGyk_1A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xNlQxMDozMToyN1rOGyk_1A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NTY4ODE0OA==", "bodyText": "I like it! but we should display the spinner, like in the UsersOverview currently Loading... is being displayed under the headline.", "url": "https://github.com/Graylog2/graylog2-server/pull/8553#discussion_r455688148", "createdAt": "2020-07-16T10:31:27Z", "author": {"login": "linuspahl"}, "path": "graylog2-web-interface/src/components/users/SectionComponent.jsx", "diffHunk": "@@ -2,24 +2,30 @@\n import * as React from 'react';\n import styled from 'styled-components';\n \n+import Spinner from 'components/common/Spinner';\n import { Row, Col } from 'components/graylog';\n \n type Props = {\n   children: React.Node,\n   title: string,\n+  showLoading?: boolean,\n };\n \n const Headline = styled.h2`\n   margin-bottom: 15px;\n `;\n \n-const SectionComponent = ({ children, title }: Props) => (\n+const SectionComponent = ({ children, title, showLoading = false }: Props) => (\n   <Row className=\"content\">\n     <Col xs={12}>\n-      <Headline>{title}</Headline>\n+      <Headline>{title}</Headline>{showLoading && <Spinner />}", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "874e11fd2c09524d3c30a03d3c95b3fd78abbae4"}, "originalPosition": 22}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjg0MjM5NzI2OnYy", "diffSide": "RIGHT", "path": "graylog2-web-interface/src/stores/roles/AuthzRolesStore.js", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xNlQxMDozNToyNVrOGylIfQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xNlQxMTozNjoxNVrOGynAVw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NTY5MDM2NQ==", "bodyText": "I prefer to trigger the user notification inside the component, so the store does not contain any presentation logic.  We should refactor this for our previous changes as well.", "url": "https://github.com/Graylog2/graylog2-server/pull/8553#discussion_r455690365", "createdAt": "2020-07-16T10:35:25Z", "author": {"login": "linuspahl"}, "path": "graylog2-web-interface/src/stores/roles/AuthzRolesStore.js", "diffHunk": "@@ -0,0 +1,69 @@\n+// @flow strict\n+import Reflux from 'reflux';\n+import * as Immutable from 'immutable';\n+\n+import type { Store } from 'stores/StoreTypes';\n+import fetch from 'logic/rest/FetchProvider';\n+import ApiRoutes from 'routing/ApiRoutes';\n+import { qualifyUrl } from 'util/URLUtils';\n+import UserNotification from 'util/UserNotification';\n+import { singletonStore } from 'views/logic/singleton';\n+import PaginationURL from 'util/PaginationURL';\n+import Role from 'logic/roles/Role';\n+import type { RoleJSON } from 'logic/roles/Role';\n+import AuthzRolesActions from 'actions/roles/AuthzRolesActions';\n+\n+import type { PaginatedResponseType, PaginationType } from '../PaginationTypes';\n+\n+type PaginatedResponse = PaginatedResponseType & {\n+  roles: Array<RoleJSON>,\n+};\n+\n+export type PaginatedListType = {\n+  list: Immutable.List<Role>,\n+  pagination: PaginationType,\n+};\n+\n+type AuthzRolesStoreState = {};\n+\n+type AuthzRolesStoreType = Store<AuthzRolesStoreState>;\n+\n+// eslint-disable-next-line camelcase\n+const _responseToPaginatedList = ({ count, total, page, per_page, query, roles }: PaginatedResponse) => {\n+  return {\n+    list: Immutable.List(roles.map((r) => Role.fromJSON(r))),\n+    pagination: {\n+      count,\n+      total,\n+      page,\n+      perPage: per_page,\n+      query,\n+    },\n+  };\n+};\n+\n+const AuthzRolesStore: AuthzRolesStoreType = singletonStore(\n+  'AuthzRoles',\n+  () => Reflux.createStore({\n+    listenables: [AuthzRolesActions],\n+\n+    loadForUser(username: string, page: number, perPage: number, query: string): Promise<PaginatedListType> {\n+      const url = PaginationURL(ApiRoutes.AuthzRolesController.loadForUser(username).url, page, perPage, query);\n+\n+      const promise = fetch('GET', qualifyUrl(url))\n+        .then(_responseToPaginatedList,\n+          (error) => {\n+            if (error.additional.status !== 404) {\n+              UserNotification.error(`Loading roles for user ${username} failed with status: ${error}`,\n+                'Could not load roles for user');\n+            }\n+          });", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "874e11fd2c09524d3c30a03d3c95b3fd78abbae4"}, "originalPosition": 60}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NTcyMTA0Nw==", "bodyText": "Nice there was a bug in the code as well! \ud83d\udc4d", "url": "https://github.com/Graylog2/graylog2-server/pull/8553#discussion_r455721047", "createdAt": "2020-07-16T11:36:15Z", "author": {"login": "kmerz"}, "path": "graylog2-web-interface/src/stores/roles/AuthzRolesStore.js", "diffHunk": "@@ -0,0 +1,69 @@\n+// @flow strict\n+import Reflux from 'reflux';\n+import * as Immutable from 'immutable';\n+\n+import type { Store } from 'stores/StoreTypes';\n+import fetch from 'logic/rest/FetchProvider';\n+import ApiRoutes from 'routing/ApiRoutes';\n+import { qualifyUrl } from 'util/URLUtils';\n+import UserNotification from 'util/UserNotification';\n+import { singletonStore } from 'views/logic/singleton';\n+import PaginationURL from 'util/PaginationURL';\n+import Role from 'logic/roles/Role';\n+import type { RoleJSON } from 'logic/roles/Role';\n+import AuthzRolesActions from 'actions/roles/AuthzRolesActions';\n+\n+import type { PaginatedResponseType, PaginationType } from '../PaginationTypes';\n+\n+type PaginatedResponse = PaginatedResponseType & {\n+  roles: Array<RoleJSON>,\n+};\n+\n+export type PaginatedListType = {\n+  list: Immutable.List<Role>,\n+  pagination: PaginationType,\n+};\n+\n+type AuthzRolesStoreState = {};\n+\n+type AuthzRolesStoreType = Store<AuthzRolesStoreState>;\n+\n+// eslint-disable-next-line camelcase\n+const _responseToPaginatedList = ({ count, total, page, per_page, query, roles }: PaginatedResponse) => {\n+  return {\n+    list: Immutable.List(roles.map((r) => Role.fromJSON(r))),\n+    pagination: {\n+      count,\n+      total,\n+      page,\n+      perPage: per_page,\n+      query,\n+    },\n+  };\n+};\n+\n+const AuthzRolesStore: AuthzRolesStoreType = singletonStore(\n+  'AuthzRoles',\n+  () => Reflux.createStore({\n+    listenables: [AuthzRolesActions],\n+\n+    loadForUser(username: string, page: number, perPage: number, query: string): Promise<PaginatedListType> {\n+      const url = PaginationURL(ApiRoutes.AuthzRolesController.loadForUser(username).url, page, perPage, query);\n+\n+      const promise = fetch('GET', qualifyUrl(url))\n+        .then(_responseToPaginatedList,\n+          (error) => {\n+            if (error.additional.status !== 404) {\n+              UserNotification.error(`Loading roles for user ${username} failed with status: ${error}`,\n+                'Could not load roles for user');\n+            }\n+          });", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NTY5MDM2NQ=="}, "originalCommit": {"oid": "874e11fd2c09524d3c30a03d3c95b3fd78abbae4"}, "originalPosition": 60}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4157, "cost": 1, "resetAt": "2021-11-12T20:28:25Z"}}}