{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDAzODIwMTg3", "number": 7885, "reviewThreads": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xNVQxODowMzowNlrODyLxXw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xNVQxODo0ODo1OFrODyMx_Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjUzOTQ4MjU1OnYy", "diffSide": "RIGHT", "path": "graylog2-web-interface/src/views/components/SearchBar.jsx", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xNVQxODowMzowNlrOGGFYZA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xNlQxMjo1NjoyMFrOGGj7DA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwOTAzMjgwNA==", "bodyText": "Should probably keep these to the defaultProps instead of potentially resetting what the default is here.", "url": "https://github.com/Graylog2/graylog2-server/pull/7885#discussion_r409032804", "createdAt": "2020-04-15T18:03:06Z", "author": {"login": "kyleknighted"}, "path": "graylog2-web-interface/src/views/components/SearchBar.jsx", "diffHunk": "@@ -21,90 +23,100 @@ import HorizontalSpacer from 'views/components/horizontalspacer/HorizontalSpacer\n import { QueriesActions } from 'views/stores/QueriesStore';\n import { CurrentQueryStore } from 'views/stores/CurrentQueryStore';\n import { StreamsStore } from 'views/stores/StreamsStore';\n-import { QueryFiltersActions, QueryFiltersStore } from 'views/stores/QueryFiltersStore';\n+import { QueryFiltersStore } from 'views/stores/QueryFiltersStore';\n+import Query, { createElasticsearchQueryString, filtersForQuery, filtersToStreamSet } from 'views/logic/queries/Query';\n+import type { FilterType, QueryId, TimeRange } from 'views/logic/queries/Query';\n+import SearchBarForm from './searchbar/SearchBarForm';\n \n type Props = {\n   availableStreams: Array<*>,\n   config: any,\n-  currentQuery: {\n-    id: string,\n-    timerange: any,\n-    query: {\n-      query_string: string,\n-    },\n-  },\n+  currentQuery: Query,\n   disableSearch: boolean,\n-  onExecute: () => void,\n-  queryFilters: Immutable.Map<any, any>,\n+  onSubmit: ({ timerange: TimeRange, streams: Array<string>, queryString: string }, Query) => Promise<any>,\n+  queryFilters: Immutable.Map<QueryId, FilterType>,\n+};\n+\n+const defaultOnSubmit = ({ timerange, streams, queryString }, currentQuery: Query) => {\n+  const newQuery = currentQuery.toBuilder()\n+    .timerange(timerange)\n+    .filter(filtersForQuery(streams))\n+    .query(createElasticsearchQueryString(queryString))\n+    .build();\n+\n+  return QueriesActions.update(newQuery.id, newQuery);\n };\n \n-const SearchBar = ({ availableStreams, config, currentQuery, disableSearch = false, onExecute: performSearch, queryFilters }: Props) => {\n+const SearchBar = ({ availableStreams, config, currentQuery, disableSearch = false, queryFilters, onSubmit = defaultOnSubmit }: Props) => {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f33c5d83d4ff8388433ccc4910b7c51d43a15e1e"}, "originalPosition": 49}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwOTUzMzE5Ng==", "bodyText": "The benefit of using default values is that flow is doing proper type checks, while the PropTypes type specs only do check very basic things (in this case if onSubmit is a function or not). Otoh, having runtime checks potentially helps us debugging issues caused by untested integration code.\nThe remaining risk is that someone could change one, but not the other, so they deviate. To address this, I created a defaultProps object which we are referencing in both places. I am not sure if it improves things or makes it more verbose.", "url": "https://github.com/Graylog2/graylog2-server/pull/7885#discussion_r409533196", "createdAt": "2020-04-16T12:56:20Z", "author": {"login": "dennisoelkers"}, "path": "graylog2-web-interface/src/views/components/SearchBar.jsx", "diffHunk": "@@ -21,90 +23,100 @@ import HorizontalSpacer from 'views/components/horizontalspacer/HorizontalSpacer\n import { QueriesActions } from 'views/stores/QueriesStore';\n import { CurrentQueryStore } from 'views/stores/CurrentQueryStore';\n import { StreamsStore } from 'views/stores/StreamsStore';\n-import { QueryFiltersActions, QueryFiltersStore } from 'views/stores/QueryFiltersStore';\n+import { QueryFiltersStore } from 'views/stores/QueryFiltersStore';\n+import Query, { createElasticsearchQueryString, filtersForQuery, filtersToStreamSet } from 'views/logic/queries/Query';\n+import type { FilterType, QueryId, TimeRange } from 'views/logic/queries/Query';\n+import SearchBarForm from './searchbar/SearchBarForm';\n \n type Props = {\n   availableStreams: Array<*>,\n   config: any,\n-  currentQuery: {\n-    id: string,\n-    timerange: any,\n-    query: {\n-      query_string: string,\n-    },\n-  },\n+  currentQuery: Query,\n   disableSearch: boolean,\n-  onExecute: () => void,\n-  queryFilters: Immutable.Map<any, any>,\n+  onSubmit: ({ timerange: TimeRange, streams: Array<string>, queryString: string }, Query) => Promise<any>,\n+  queryFilters: Immutable.Map<QueryId, FilterType>,\n+};\n+\n+const defaultOnSubmit = ({ timerange, streams, queryString }, currentQuery: Query) => {\n+  const newQuery = currentQuery.toBuilder()\n+    .timerange(timerange)\n+    .filter(filtersForQuery(streams))\n+    .query(createElasticsearchQueryString(queryString))\n+    .build();\n+\n+  return QueriesActions.update(newQuery.id, newQuery);\n };\n \n-const SearchBar = ({ availableStreams, config, currentQuery, disableSearch = false, onExecute: performSearch, queryFilters }: Props) => {\n+const SearchBar = ({ availableStreams, config, currentQuery, disableSearch = false, queryFilters, onSubmit = defaultOnSubmit }: Props) => {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwOTAzMjgwNA=="}, "originalCommit": {"oid": "f33c5d83d4ff8388433ccc4910b7c51d43a15e1e"}, "originalPosition": 49}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjUzOTYzNTM1OnYy", "diffSide": "RIGHT", "path": "graylog2-web-interface/src/views/components/searchbar/SearchButton.jsx", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xNVQxODo0NToyNVrOGGG49w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xNVQxODo0NToyNVrOGGG49w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwOTA1NzUyNw==", "bodyText": "Since you're not using the Theme here, you can just pass void instead of ThemeInterface\n\n  \n    \n  \n    \n\n  \n  This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters. Learn more about bidirectional Unicode characters\n\n\n  \n\n\n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            const DirtyButton: StyledComponent<{}, ThemeInterface, any> = styled(Button)`\n          \n          \n            \n            const DirtyButton: StyledComponent<{}, void, any> = styled(Button)`", "url": "https://github.com/Graylog2/graylog2-server/pull/7885#discussion_r409057527", "createdAt": "2020-04-15T18:45:25Z", "author": {"login": "kyleknighted"}, "path": "graylog2-web-interface/src/views/components/searchbar/SearchButton.jsx", "diffHunk": "@@ -1,24 +1,60 @@\n+// @flow strict\n import React from 'react';\n import PropTypes from 'prop-types';\n+import styled from 'styled-components';\n+import type { StyledComponent } from 'styled-components';\n \n import { Button } from 'components/graylog';\n import { Spinner, Icon } from 'components/common';\n+import type { ThemeInterface } from 'theme/index';\n \n-const SearchButton = ({ running, disabled, glyph }) => (\n-  <Button type=\"submit\" bsStyle={running ? 'warning' : 'success'} disabled={disabled} className=\"pull-left search-button-execute\">\n-    {running ? <Spinner fixedWidth pulse text=\"\" /> : <Icon name={glyph} /> }\n-  </Button>\n-);\n+const DirtyButton: StyledComponent<{}, ThemeInterface, any> = styled(Button)`", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f33c5d83d4ff8388433ccc4910b7c51d43a15e1e"}, "originalPosition": 16}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjUzOTY0NDkwOnYy", "diffSide": "RIGHT", "path": "graylog2-web-interface/src/views/components/searchbar/SearchButton.jsx", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xNVQxODo0ODowNlrOGGG--g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xNVQxODo0ODowNlrOGGG--g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwOTA1OTA2Ng==", "bodyText": "This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters. Learn more about bidirectional Unicode characters\n\n\n  \n\n\n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            import styled from 'styled-components';\n          \n          \n            \n            import type { StyledComponent } from 'styled-components';\n          \n          \n            \n            import styled, { type StyledComponent } from 'styled-components';", "url": "https://github.com/Graylog2/graylog2-server/pull/7885#discussion_r409059066", "createdAt": "2020-04-15T18:48:06Z", "author": {"login": "kyleknighted"}, "path": "graylog2-web-interface/src/views/components/searchbar/SearchButton.jsx", "diffHunk": "@@ -1,24 +1,60 @@\n+// @flow strict\n import React from 'react';\n import PropTypes from 'prop-types';\n+import styled from 'styled-components';\n+import type { StyledComponent } from 'styled-components';", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f33c5d83d4ff8388433ccc4910b7c51d43a15e1e"}, "originalPosition": 5}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjUzOTY0Nzk3OnYy", "diffSide": "RIGHT", "path": "graylog2-web-interface/src/views/components/searchbar/SearchButton.jsx", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xNVQxODo0ODo1OFrOGGHA7A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xNVQxODo0ODo1OFrOGGHA7A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwOTA1OTU2NA==", "bodyText": "This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters. Learn more about bidirectional Unicode characters\n\n\n  \n\n\n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            import type { ThemeInterface } from 'theme/index';", "url": "https://github.com/Graylog2/graylog2-server/pull/7885#discussion_r409059564", "createdAt": "2020-04-15T18:48:58Z", "author": {"login": "kyleknighted"}, "path": "graylog2-web-interface/src/views/components/searchbar/SearchButton.jsx", "diffHunk": "@@ -1,24 +1,60 @@\n+// @flow strict\n import React from 'react';\n import PropTypes from 'prop-types';\n+import styled from 'styled-components';\n+import type { StyledComponent } from 'styled-components';\n \n import { Button } from 'components/graylog';\n import { Spinner, Icon } from 'components/common';\n+import type { ThemeInterface } from 'theme/index';", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f33c5d83d4ff8388433ccc4910b7c51d43a15e1e"}, "originalPosition": 9}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3700, "cost": 1, "resetAt": "2021-11-12T20:28:25Z"}}}