{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDEwODcxMTE5", "number": 8005, "title": "Sidecar Clone Configuration option", "bodyText": "Description\n\n\nUpdate theme colors in Clone MenuItem\nUpdate code for less duplication\n\nMotivation and Context\n\n\nTheme All The Things! and clean up along the way\nScreenshots (if appropriate):\n\nTypes of changes\n\n\n Bug fix (non-breaking change which fixes an issue)\n New feature (non-breaking change which adds functionality)\n Refactoring (non-breaking change)\n Breaking change (fix or feature that would cause existing functionality to change)\n\nChecklist:\n\n\n\n My code follows the code style of this project.\n My change requires a change to the documentation.\n I have updated the documentation accordingly.\n I have read the CONTRIBUTING document.\n I have added tests to cover my changes.", "createdAt": "2020-04-29T18:12:22Z", "url": "https://github.com/Graylog2/graylog2-server/pull/8005", "merged": true, "mergeCommit": {"oid": "d676adb5534237920652c03d7e471e2623087cba"}, "closed": true, "closedAt": "2020-05-07T08:21:27Z", "author": {"login": "kyleknighted"}, "timelineItems": {"totalCount": 9, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcd_TyTgFqTQwNDk3MzAwMQ==", "endCursor": "Y3Vyc29yOnYyOpPPAAABce45i-gFqTQwNzI1MDMwMA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDA0OTczMDAx", "url": "https://github.com/Graylog2/graylog2-server/pull/8005#pullrequestreview-404973001", "createdAt": "2020-05-04T13:13:02Z", "commit": {"oid": "65bbbaa364ce87284092a8511066b53a3d73fb10"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wNFQxMzoxMzowMlrOGP_pow==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wNFQxMzoxNTowM1rOGP_u5g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxOTQyNDY3NQ==", "bodyText": "The validation parameter will not always have those fields, and it may even be an empty object. Trying to destructure it will result in an error.\nUnhandled rejection TypeError: Invalid attempt to destructure non-iterable instance\nat _nonIterableRest (http://localhost:8080/7c9d6ab7-32.js:1273:37)\nat _slicedToArray (http://localhost:8080/7c9d6ab7-32.js:1271:99)\nat http://localhost:8080/7c9d6ab7-32.js:1392:37", "url": "https://github.com/Graylog2/graylog2-server/pull/8005#discussion_r419424675", "createdAt": "2020-05-04T13:13:02Z", "author": {"login": "edmundoa"}, "path": "graylog2-web-interface/src/components/sidecars/configurations/CopyCollectorModal.jsx", "diffHunk": "@@ -44,52 +43,40 @@ class CopyCollectorModal extends React.Component {\n   };\n \n   _save = () => {\n-    const collector = this.state;\n+    const { errorMessage, id, name } = this.state;\n+    const { copyCollector } = this.props;\n \n-    if (!collector.error) {\n-      this.props.copyCollector(this.state.id, this.state.name, this._saved);\n+    if (!errorMessage) {\n+      copyCollector(id, name, this._saved);\n     }\n   };\n \n   _changeName = (event) => {\n-    const nextName = event.target.value;\n-    this.setState({ name: nextName });\n+    const { collector, validateCollector } = this.props;\n+    const name = event.target.value;\n+    this.setState({ name, errorMessage: undefined });\n \n-    const nextCollector = lodash.cloneDeep(this.props.collector);\n-    nextCollector.name = nextName;\n+    const nextCollector = lodash.cloneDeep(collector);\n+    nextCollector.name = name;\n     nextCollector.id = '';\n \n-    this.props.validateCollector(nextCollector).then((validation) => {\n-      let errorMessage = '';\n-      if (validation.errors.name) {\n-        errorMessage = validation.errors.name[0];\n-      }\n-      this.setState({ error: validation.failed, error_message: errorMessage });\n+    validateCollector(nextCollector).then((validation) => {\n+      const [errorMessage] = validation.errors.name;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "65bbbaa364ce87284092a8511066b53a3d73fb10"}, "originalPosition": 93}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxOTQyNDg0Mw==", "bodyText": "Same as above.", "url": "https://github.com/Graylog2/graylog2-server/pull/8005#discussion_r419424843", "createdAt": "2020-05-04T13:13:18Z", "author": {"login": "edmundoa"}, "path": "graylog2-web-interface/src/components/sidecars/configurations/CopyConfigurationModal.jsx", "diffHunk": "@@ -43,47 +42,37 @@ class CopyConfigurationModal extends React.Component {\n   };\n \n   _save = () => {\n-    const configuration = this.state;\n+    const { copyConfiguration } = this.props;\n+    const { errorMessage, id, name } = this.state;\n \n-    if (!configuration.error) {\n-      this.props.copyConfiguration(this.state.id, this.state.name, this._saved);\n+    if (errorMessage) {\n+      copyConfiguration(id, name, this._saved);\n     }\n   };\n \n   _changeName = (event) => {\n-    const nextName = event.target.value;\n-    this.setState({ name: nextName });\n-    this.props.validateConfiguration({ name: nextName }).then((validation) => {\n-      let errorMessage = '';\n-      if (validation.errors.name) {\n-        errorMessage = validation.errors.name[0];\n-      }\n-      this.setState({ error: validation.failed, error_message: errorMessage });\n+    const { validateConfiguration } = this.props;\n+    const name = event.target.value;\n+    this.setState({ name, errorMessage: undefined });\n+\n+    validateConfiguration({ name }).then((validation) => {\n+      const [errorMessage] = validation.errors.name;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "65bbbaa364ce87284092a8511066b53a3d73fb10"}, "originalPosition": 86}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxOTQyNjAyMg==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                if (errorMessage) {\n          \n          \n            \n                if (!errorMessage) {\n          \n      \n    \n    \n  \n\nOtherwise will do the opposite of what we want.", "url": "https://github.com/Graylog2/graylog2-server/pull/8005#discussion_r419426022", "createdAt": "2020-05-04T13:15:03Z", "author": {"login": "edmundoa"}, "path": "graylog2-web-interface/src/components/sidecars/configurations/CopyConfigurationModal.jsx", "diffHunk": "@@ -43,47 +42,37 @@ class CopyConfigurationModal extends React.Component {\n   };\n \n   _save = () => {\n-    const configuration = this.state;\n+    const { copyConfiguration } = this.props;\n+    const { errorMessage, id, name } = this.state;\n \n-    if (!configuration.error) {\n-      this.props.copyConfiguration(this.state.id, this.state.name, this._saved);\n+    if (errorMessage) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "65bbbaa364ce87284092a8511066b53a3d73fb10"}, "originalPosition": 67}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "1bba58c2ed78d89dac461401558066261ae90f42", "author": {"user": {"login": "kyleknighted", "name": "Kyle Knight"}}, "url": "https://github.com/Graylog2/graylog2-server/commit/1bba58c2ed78d89dac461401558066261ae90f42", "committedDate": "2020-05-04T13:50:13Z", "message": "pr feedback"}, "afterCommit": {"oid": "32b746ae92b031f7e114a8504cd2ecf44bd54e9b", "author": {"user": {"login": "kyleknighted", "name": "Kyle Knight"}}, "url": "https://github.com/Graylog2/graylog2-server/commit/32b746ae92b031f7e114a8504cd2ecf44bd54e9b", "committedDate": "2020-05-04T13:50:35Z", "message": "pr feedback"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDA1NTg0MDA2", "url": "https://github.com/Graylog2/graylog2-server/pull/8005#pullrequestreview-405584006", "createdAt": "2020-05-05T08:25:28Z", "commit": {"oid": "32b746ae92b031f7e114a8504cd2ecf44bd54e9b"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wNVQwODoyNToyOVrOGQfPtA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wNVQwODoyNToyOVrOGQfPtA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxOTk0MjMyNA==", "bodyText": "I saw this in my browser console, I think this prop needs a default value here or make the prop not required:\nWarning: Failed prop type: The prop `error` is marked as required in `CloneMenuItem`, but its value is `undefined`.\n    in CloneMenuItem (created by CopyConfigurationModal)\n    in CopyConfigurationModal (created by ConfigurationRow)\n    in ul (created by DropdownMenu)\n    in RootCloseWrapper (created by DropdownMenu)\n    in DropdownMenu (created by Dropdown)", "url": "https://github.com/Graylog2/graylog2-server/pull/8005#discussion_r419942324", "createdAt": "2020-05-05T08:25:29Z", "author": {"login": "edmundoa"}, "path": "graylog2-web-interface/src/components/sidecars/configurations/CopyConfigurationModal.jsx", "diffHunk": "@@ -43,47 +42,37 @@ class CopyConfigurationModal extends React.Component {\n   };\n \n   _save = () => {\n-    const configuration = this.state;\n+    const { copyConfiguration } = this.props;\n+    const { errorMessage, id, name } = this.state;\n \n-    if (!configuration.error) {\n-      this.props.copyConfiguration(this.state.id, this.state.name, this._saved);\n+    if (!errorMessage) {\n+      copyConfiguration(id, name, this._saved);\n     }\n   };\n \n   _changeName = (event) => {\n-    const nextName = event.target.value;\n-    this.setState({ name: nextName });\n-    this.props.validateConfiguration({ name: nextName }).then((validation) => {\n-      let errorMessage = '';\n+    const { validateConfiguration } = this.props;\n+    const name = event.target.value;\n+    this.setState({ name, errorMessage: undefined });\n+\n+    validateConfiguration({ name }).then((validation) => {\n       if (validation.errors.name) {\n-        errorMessage = validation.errors.name[0];\n+        this.setState({ errorMessage: validation.errors.name[0] });\n       }\n-      this.setState({ error: validation.failed, error_message: errorMessage });\n     });\n   };\n \n   render() {\n+    const { errorMessage, name } = this.state;\n+\n     return (\n-      <span>\n-        <MenuItem className={style.menuItem} onSelect={this.openModal}>Clone</MenuItem>\n-        <BootstrapModalForm ref=\"modal\"\n-                            title=\"Clone\"\n-                            onSubmitForm={this._save}\n-                            submitButtonDisabled={this.state.error}\n-                            submitButtonText=\"Done\">\n-          <fieldset>\n-            <Input type=\"text\"\n-                   id={this._getId('configuration-name')}\n-                   label=\"Name\"\n-                   defaultValue={this.state.name}\n-                   onChange={this._changeName}\n-                   bsStyle={this.state.error ? 'error' : null}\n-                   help={this.state.error ? this.state.error_message : 'Type a name for the new configuration'}\n-                   autoFocus\n-                   required />\n-          </fieldset>\n-        </BootstrapModalForm>\n-      </span>\n+      <CloneMenuItem onSelect={this.openModal}\n+                     onSave={this._save}\n+                     id={this._getId('configuration-name')}\n+                     onChange={this._changeName}\n+                     error={errorMessage}", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "32b746ae92b031f7e114a8504cd2ecf44bd54e9b"}, "originalPosition": 118}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a918c554ae13802116921d76cd206d937a2b679b", "author": {"user": {"login": "kyleknighted", "name": "Kyle Knight"}}, "url": "https://github.com/Graylog2/graylog2-server/commit/a918c554ae13802116921d76cd206d937a2b679b", "committedDate": "2020-05-06T18:14:57Z", "message": "CloneMenuItem"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a6abcc895c4693da1eea1d9e9d9735529efc854b", "author": {"user": {"login": "kyleknighted", "name": "Kyle Knight"}}, "url": "https://github.com/Graylog2/graylog2-server/commit/a6abcc895c4693da1eea1d9e9d9735529efc854b", "committedDate": "2020-05-06T18:14:57Z", "message": "cleanup implementation"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "fedad119a7843e5935cc727916d814d9fc005d84", "author": {"user": {"login": "kyleknighted", "name": "Kyle Knight"}}, "url": "https://github.com/Graylog2/graylog2-server/commit/fedad119a7843e5935cc727916d814d9fc005d84", "committedDate": "2020-05-06T18:14:57Z", "message": "pr feedback"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "78601f74d28e18b3834cf60555e244cba5e64e6d", "author": {"user": {"login": "kyleknighted", "name": "Kyle Knight"}}, "url": "https://github.com/Graylog2/graylog2-server/commit/78601f74d28e18b3834cf60555e244cba5e64e6d", "committedDate": "2020-05-06T18:14:58Z", "message": "error prop not required"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "b40199ca254d6eb032b822a4c814ae69eba9ac0d", "author": {"user": {"login": "kyleknighted", "name": "Kyle Knight"}}, "url": "https://github.com/Graylog2/graylog2-server/commit/b40199ca254d6eb032b822a4c814ae69eba9ac0d", "committedDate": "2020-05-06T12:11:19Z", "message": "error prop not required"}, "afterCommit": {"oid": "78601f74d28e18b3834cf60555e244cba5e64e6d", "author": {"user": {"login": "kyleknighted", "name": "Kyle Knight"}}, "url": "https://github.com/Graylog2/graylog2-server/commit/78601f74d28e18b3834cf60555e244cba5e64e6d", "committedDate": "2020-05-06T18:14:58Z", "message": "error prop not required"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDA3MjUwMzAw", "url": "https://github.com/Graylog2/graylog2-server/pull/8005#pullrequestreview-407250300", "createdAt": "2020-05-07T08:21:21Z", "commit": {"oid": "78601f74d28e18b3834cf60555e244cba5e64e6d"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2458, "cost": 1, "resetAt": "2021-10-28T18:54:27Z"}}}