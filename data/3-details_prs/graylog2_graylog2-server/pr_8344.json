{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDM0NTMxODI5", "number": 8344, "title": "Refactor field list component", "bodyText": "This PR refactors the field list component by:\n\nremoving usage of createReactClass by using a functional component\nsplitting up the component in multiple components\nusing styled component instead of css file\nadding flow types\nremoving usage of not needed ViewMetadata store\n\nMotivation and Context\nI always wanted to refactor this component and it helps avoiding linter warnings in open PRs.\nTypes of changes\n\n\n Bug fix (non-breaking change which fixes an issue)\n New feature (non-breaking change which adds functionality)\n Refactoring (non-breaking change)\n Breaking change (fix or feature that would cause existing functionality to change)", "createdAt": "2020-06-15T13:13:20Z", "url": "https://github.com/Graylog2/graylog2-server/pull/8344", "merged": true, "mergeCommit": {"oid": "145552d571fb2775325cee33d2ab832802b15919"}, "closed": true, "closedAt": "2020-06-18T13:56:44Z", "author": {"login": "linuspahl"}, "timelineItems": {"totalCount": 14, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcrgQPyAH2gAyNDM0NTMxODI5Ojc0MGJmOTAzNjk5MzkzNDkzMDYxMjY3ZGYzYjVjNDUyZmI0Y2YxOTc=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcse3lggFqTQzMzMwOTM1Nw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "740bf903699393493061267df3b5c452fb4cf197", "author": {"user": {"login": "linuspahl", "name": "Linus Pahl"}}, "url": "https://github.com/Graylog2/graylog2-server/commit/740bf903699393493061267df3b5c452fb4cf197", "committedDate": "2020-06-15T12:59:32Z", "message": "Add flow-typed stub for react-window"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "27df46a6374d8af0703a31043b2748c1e282e838", "author": {"user": {"login": "linuspahl", "name": "Linus Pahl"}}, "url": "https://github.com/Graylog2/graylog2-server/commit/27df46a6374d8af0703a31043b2748c1e282e838", "committedDate": "2020-06-15T13:00:21Z", "message": "Refactor field list component\n- remove usage of createReactClass by using a functional component\n- splitting up the component in multiple components\n- use styled component instead of css file\n- Adding flow types\n- Remove usage of not needed ViewMetadata store"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "69553ffd195642cf6a83a19654dc98beac4deb48", "author": {"user": {"login": "linuspahl", "name": "Linus Pahl"}}, "url": "https://github.com/Graylog2/graylog2-server/commit/69553ffd195642cf6a83a19654dc98beac4deb48", "committedDate": "2020-06-15T13:11:08Z", "message": "Use styled components instead of inline style"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c9d9872227da064f68c0bc33feabb34fd3446091", "author": {"user": {"login": "linuspahl", "name": "Linus Pahl"}}, "url": "https://github.com/Graylog2/graylog2-server/commit/c9d9872227da064f68c0bc33feabb34fd3446091", "committedDate": "2020-06-15T14:06:43Z", "message": "Disable eslint warning for dependency cycle in sidebar index file"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDMyMTkxMjIx", "url": "https://github.com/Graylog2/graylog2-server/pull/8344#pullrequestreview-432191221", "createdAt": "2020-06-17T08:49:58Z", "commit": {"oid": "c9d9872227da064f68c0bc33feabb34fd3446091"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xN1QwODo0OTo1OFrOGk8F7w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xN1QwODo1MzowMVrOGk8OMg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTM4NjQ3OQ==", "bodyText": "Using a reducer here overcomplicates things, as the field category and the filter are not related. They could be handled by using two separate, independent states.", "url": "https://github.com/Graylog2/graylog2-server/pull/8344#discussion_r441386479", "createdAt": "2020-06-17T08:49:58Z", "author": {"login": "dennisoelkers"}, "path": "graylog2-web-interface/src/views/components/sidebar/fields/FieldsOverview.jsx", "diffHunk": "@@ -0,0 +1,125 @@\n+// @flow strict\n+import * as React from 'react';\n+import { useReducer } from 'react';\n+import PropTypes from 'prop-types';\n+import { List as ImmutableList } from 'immutable';\n+import styled, { type StyledComponent } from 'styled-components';\n+\n+import type { ViewMetaData as ViewMetadata } from 'views/stores/ViewMetadataStore';\n+import FieldTypeMapping from 'views/logic/fieldtypes/FieldTypeMapping';\n+import { type ThemeInterface } from 'theme';\n+\n+import { Button } from 'components/graylog';\n+import List from './List';\n+import ChangeMode from './ChangeMode';\n+\n+type Props = {\n+  viewMetadata: ViewMetadata,\n+  listHeight: number,\n+  fields: ImmutableList<FieldTypeMapping>,\n+  allFields: ImmutableList<FieldTypeMapping>,\n+};\n+\n+const Container: StyledComponent<{}, ThemeInterface, HTMLDivElement> = styled.div`\n+  white-space: break-spaces;\n+`;\n+\n+const FilterForm = styled.form`\n+  display: flex;\n+`;\n+\n+const FilterInputWrapper = styled.div`\n+  flex-grow: 1;\n+  margin-right: 5px;\n+`;\n+\n+const FilterInput = styled.input`\n+  width: 100%;\n+`;\n+\n+const FieldListModes = styled.div`\n+  margin-top: 5px;\n+  margin-bottom: 0;\n+`;\n+\n+const reducer = (state, action: {type: string, payload?: { mode?: string, filter?: string }}): { filter: ?string, currentMode: string } => {\n+  const { payload = {} } = action;\n+  const { mode, filter } = payload;\n+  switch (action.type) {\n+    case 'search':\n+      return { ...state, filter: filter };\n+    case 'searchReset':\n+      return { ...state, filter: undefined };\n+    case 'changeMode':\n+      return mode ? { ...state, currentMode: mode } : state;\n+    default:\n+      return state;\n+  }\n+};\n+\n+const FieldsOverview = ({ allFields, fields, viewMetadata, listHeight }: Props) => {\n+  const [{ filter, currentMode }, dispatch] = useReducer(reducer, { filter: undefined, currentMode: 'current' });", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c9d9872227da064f68c0bc33feabb34fd3446091"}, "originalPosition": 61}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTM4ODU5NA==", "bodyText": "ChangeMode is not an ideal name, it is not really giving away what it is doing. Maybe something like FieldGroup?\nI think we can also align props naming with React standards. Instead of changeMode using onSelect or onClick would give away what it's doing, instead of currentMode, we can use a boolean selected prop, allowing the user of the component to determine if it should be shown as selected or not.", "url": "https://github.com/Graylog2/graylog2-server/pull/8344#discussion_r441388594", "createdAt": "2020-06-17T08:53:01Z", "author": {"login": "dennisoelkers"}, "path": "graylog2-web-interface/src/views/components/sidebar/fields/ChangeMode.jsx", "diffHunk": "@@ -0,0 +1,26 @@\n+// @flow strict\n+import * as React from 'react';\n+\n+type Props = {\n+  changeMode: (newMode: string) => void,\n+  currentMode: string,\n+  mode: string,\n+  text: string,\n+  title: string,\n+};\n+\n+const ChangeMode = ({ changeMode, currentMode, mode, text, title }: Props) => {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c9d9872227da064f68c0bc33feabb34fd3446091"}, "originalPosition": 12}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDMyMTk1Nzg3", "url": "https://github.com/Graylog2/graylog2-server/pull/8344#pullrequestreview-432195787", "createdAt": "2020-06-17T08:55:29Z", "commit": {"oid": "c9d9872227da064f68c0bc33feabb34fd3446091"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xN1QwODo1NToyOVrOGk8U-w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xN1QwODo1NToyOVrOGk8U-w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTM5MDMzMQ==", "bodyText": "It might make sense to move a file instead of deleting it (especially in this case, where we are still keeping lots from the component, just under a new name), so we retain its history.", "url": "https://github.com/Graylog2/graylog2-server/pull/8344#discussion_r441390331", "createdAt": "2020-06-17T08:55:29Z", "author": {"login": "dennisoelkers"}, "path": "graylog2-web-interface/src/views/components/sidebar/FieldList.jsx", "diffHunk": "@@ -1,184 +0,0 @@\n-import React from 'react';", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c9d9872227da064f68c0bc33feabb34fd3446091"}, "originalPosition": 1}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "422bf914689c04894c0e5c6de67114f74c4ba709", "author": {"user": {"login": "linuspahl", "name": "Linus Pahl"}}, "url": "https://github.com/Graylog2/graylog2-server/commit/422bf914689c04894c0e5c6de67114f74c4ba709", "committedDate": "2020-06-17T13:46:09Z", "message": "Rename FieldsOverview to FieldList"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "0cc6523bfdfbc0de32e989c652db878102f0fa9d", "author": {"user": {"login": "linuspahl", "name": "Linus Pahl"}}, "url": "https://github.com/Graylog2/graylog2-server/commit/0cc6523bfdfbc0de32e989c652db878102f0fa9d", "committedDate": "2020-06-17T14:28:10Z", "message": "Change naming from mode to field group"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "44995e39f0d132463b0a5f26e3f46119e6f86963", "author": {"user": {"login": "linuspahl", "name": "Linus Pahl"}}, "url": "https://github.com/Graylog2/graylog2-server/commit/44995e39f0d132463b0a5f26e3f46119e6f86963", "committedDate": "2020-06-17T14:38:23Z", "message": "Replace useReducer with useState in FieldList"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "7495d72a98c33d3639d921e0577d8d65397bc149", "author": {"user": {"login": "linuspahl", "name": "Linus Pahl"}}, "url": "https://github.com/Graylog2/graylog2-server/commit/7495d72a98c33d3639d921e0577d8d65397bc149", "committedDate": "2020-06-17T14:45:10Z", "message": "Tell git that the field list moved (1/2)"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "6010081322af2f2472dc2e53eb88b374533f558c", "author": {"user": {"login": "linuspahl", "name": "Linus Pahl"}}, "url": "https://github.com/Graylog2/graylog2-server/commit/6010081322af2f2472dc2e53eb88b374533f558c", "committedDate": "2020-06-17T14:46:57Z", "message": "Tell git that the field list moved (2/2)"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ad7177bcd68185e7f0bf9661d2ff607fedb71116", "author": {"user": {"login": "linuspahl", "name": "Linus Pahl"}}, "url": "https://github.com/Graylog2/graylog2-server/commit/ad7177bcd68185e7f0bf9661d2ff607fedb71116", "committedDate": "2020-06-17T15:05:28Z", "message": "Rename FieldList to FieldsOverview"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "20763e81ed080be360ccfd5ea94ca7809988fad0", "author": {"user": {"login": "linuspahl", "name": "Linus Pahl"}}, "url": "https://github.com/Graylog2/graylog2-server/commit/20763e81ed080be360ccfd5ea94ca7809988fad0", "committedDate": "2020-06-17T14:57:10Z", "message": "Rename FieldList to FieldsOverview"}, "afterCommit": {"oid": "ad7177bcd68185e7f0bf9661d2ff607fedb71116", "author": {"user": {"login": "linuspahl", "name": "Linus Pahl"}}, "url": "https://github.com/Graylog2/graylog2-server/commit/ad7177bcd68185e7f0bf9661d2ff607fedb71116", "committedDate": "2020-06-17T15:05:28Z", "message": "Rename FieldList to FieldsOverview"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDMzMzA5MzU3", "url": "https://github.com/Graylog2/graylog2-server/pull/8344#pullrequestreview-433309357", "createdAt": "2020-06-18T13:56:37Z", "commit": {"oid": "ad7177bcd68185e7f0bf9661d2ff607fedb71116"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3063, "cost": 1, "resetAt": "2021-10-28T18:54:27Z"}}}