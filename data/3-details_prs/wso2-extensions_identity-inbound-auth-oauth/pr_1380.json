{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDE4ODUwNzI5", "number": 1380, "title": "Fix JWT token validation at introspection", "bodyText": "$subject", "createdAt": "2020-05-15T22:08:13Z", "url": "https://github.com/wso2-extensions/identity-inbound-auth-oauth/pull/1380", "merged": true, "mergeCommit": {"oid": "7d71db7ccd9a215eee8419c5db16b71451dcc182"}, "closed": true, "closedAt": "2020-05-20T05:48:46Z", "author": {"login": "tharindu-bandara"}, "timelineItems": {"totalCount": 9, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABchpf9eAH2gAyNDE4ODUwNzI5OmZkM2E1MmFiY2YzYTBhZTZmNTBlMDIzOGNjNzIxNDYyODY5NjEzNzQ=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcieLUEgFqTQxMzUwNTM5Ng==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "fd3a52abcf3a0ae6f50e0238cc72146286961374", "author": {"user": {"login": "tharindu-bandara", "name": "Tharindu Bandara"}}, "url": "https://github.com/wso2-extensions/identity-inbound-auth-oauth/commit/fd3a52abcf3a0ae6f50e0238cc72146286961374", "committedDate": "2020-05-15T22:06:36Z", "message": "Fix JWT token validation at introspection"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "201acce27c9b11a2c09edacdaaea5e9367bae1fa", "author": {"user": {"login": "tharindu-bandara", "name": "Tharindu Bandara"}}, "url": "https://github.com/wso2-extensions/identity-inbound-auth-oauth/commit/201acce27c9b11a2c09edacdaaea5e9367bae1fa", "committedDate": "2020-05-15T22:57:59Z", "message": "Fix formatting"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDEzMDU1OTEx", "url": "https://github.com/wso2-extensions/identity-inbound-auth-oauth/pull/1380#pullrequestreview-413055911", "createdAt": "2020-05-16T07:29:49Z", "commit": {"oid": "201acce27c9b11a2c09edacdaaea5e9367bae1fa"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xNlQwNzoyOTo0OVrOGWY0MQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xNlQwNzoyOTo0OVrOGWY0MQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNjEyODQzMw==", "bodyText": "Lets add a debug log with the exception", "url": "https://github.com/wso2-extensions/identity-inbound-auth-oauth/pull/1380#discussion_r426128433", "createdAt": "2020-05-16T07:29:49Z", "author": {"login": "janakamarasena"}, "path": "components/org.wso2.carbon.identity.oauth/src/main/java/org/wso2/carbon/identity/oauth2/util/OAuth2Util.java", "diffHunk": "@@ -2822,6 +2823,25 @@ public static Certificate getX509CertOfOAuthApp(String clientId,\n         }\n     }\n \n+    /**\n+     * Return true if the token identifier is a parsable JWT.\n+     *\n+     * @param tokenIdentifier String JWT token identifier.\n+     * @return true for a JWT token.\n+     */\n+    public static boolean isParsableJWT(String tokenIdentifier) {\n+\n+        if (StringUtils.isEmpty(tokenIdentifier)) {\n+            return false;\n+        }\n+        try {\n+            JWTParser.parse(tokenIdentifier);\n+            return true;\n+        } catch (ParseException e) {\n+            return false;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "201acce27c9b11a2c09edacdaaea5e9367bae1fa"}, "originalPosition": 27}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDEzMjU5NTMw", "url": "https://github.com/wso2-extensions/identity-inbound-auth-oauth/pull/1380#pullrequestreview-413259530", "createdAt": "2020-05-18T04:06:50Z", "commit": {"oid": "8b470323deb3712aede396c84307e8c6c5d305e9"}, "state": "DISMISSED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDEzMjYwMTQ5", "url": "https://github.com/wso2-extensions/identity-inbound-auth-oauth/pull/1380#pullrequestreview-413260149", "createdAt": "2020-05-18T04:09:43Z", "commit": {"oid": "8b470323deb3712aede396c84307e8c6c5d305e9"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xOFQwNDowOTo0M1rOGWm85Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xOFQwNDowOTo0M1rOGWm85Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNjM2MDAzNw==", "bodyText": "OAuth2JWTTokenValidator is extending DefaultOAuth2TokenValidator. this can cause a problem, right?", "url": "https://github.com/wso2-extensions/identity-inbound-auth-oauth/pull/1380#discussion_r426360037", "createdAt": "2020-05-18T04:09:43Z", "author": {"login": "madurangasiriwardena"}, "path": "components/org.wso2.carbon.identity.oauth/src/main/java/org/wso2/carbon/identity/oauth2/validators/TokenValidationHandler.java", "diffHunk": "@@ -230,11 +233,16 @@ public OAuth2IntrospectionResponseDTO buildIntrospectionResponse(OAuth2TokenVali\n         // To hold the applicable validators list from all the available validators. This list will be prioritized if we\n         // have a token_type_hint.\n         List<OAuth2TokenValidator> applicableValidators = new ArrayList<>();\n+        boolean isJWTTokenValidation = isJWTTokenValidation(oAuth2Token.getIdentifier());\n \n         // If we have a token type hint, we have to prioritize our list.\n         if (oAuth2Token.getTokenType() != null) {\n             if (tokenValidators.get(oAuth2Token.getTokenType()) != null) {\n-                applicableValidators.add(tokenValidators.get(oAuth2Token.getTokenType()));\n+                // Ignore bearer token validators if the token is JWT.\n+                if (!(isJWTTokenValidation && tokenValidators.get(oAuth2Token.getTokenType()) instanceof", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "8b470323deb3712aede396c84307e8c6c5d305e9"}, "originalPosition": 28}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "1b45f0d9e7b8cd9c2aeedb370194448c09747715", "author": {"user": {"login": "tharindu-bandara", "name": "Tharindu Bandara"}}, "url": "https://github.com/wso2-extensions/identity-inbound-auth-oauth/commit/1b45f0d9e7b8cd9c2aeedb370194448c09747715", "committedDate": "2020-05-18T11:03:17Z", "message": "Fix review comments"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "8b470323deb3712aede396c84307e8c6c5d305e9", "author": {"user": {"login": "tharindu-bandara", "name": "Tharindu Bandara"}}, "url": "https://github.com/wso2-extensions/identity-inbound-auth-oauth/commit/8b470323deb3712aede396c84307e8c6c5d305e9", "committedDate": "2020-05-16T18:27:01Z", "message": "Add debug log"}, "afterCommit": {"oid": "1b45f0d9e7b8cd9c2aeedb370194448c09747715", "author": {"user": {"login": "tharindu-bandara", "name": "Tharindu Bandara"}}, "url": "https://github.com/wso2-extensions/identity-inbound-auth-oauth/commit/1b45f0d9e7b8cd9c2aeedb370194448c09747715", "committedDate": "2020-05-18T11:03:17Z", "message": "Fix review comments"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "fe9d02263accb17cf4d32959ff8d7316ef553c26", "author": {"user": {"login": "tharindu-bandara", "name": "Tharindu Bandara"}}, "url": "https://github.com/wso2-extensions/identity-inbound-auth-oauth/commit/fe9d02263accb17cf4d32959ff8d7316ef553c26", "committedDate": "2020-05-18T11:06:09Z", "message": "Fix formatting"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDEzNTA1Mzk2", "url": "https://github.com/wso2-extensions/identity-inbound-auth-oauth/pull/1380#pullrequestreview-413505396", "createdAt": "2020-05-18T11:29:01Z", "commit": {"oid": "fe9d02263accb17cf4d32959ff8d7316ef553c26"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3283, "cost": 1, "resetAt": "2021-11-02T10:47:05Z"}}}