{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDI2Mzg4OTE2", "number": 1389, "reviewThreads": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xNlQxMzowMDoyMVrOEF7Rrw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xNlQxMjoxNDozNFrOFGKW5A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjc0NjQ5NTE5OnYy", "diffSide": "RIGHT", "path": "components/org.wso2.carbon.identity.oauth/src/main/java/org/wso2/carbon/identity/oauth/OAuthAdminServiceImpl.java", "isResolved": true, "comments": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xNlQxMzowMDoyMVrOGkaH8Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xOVQxMDoyNDoxNVrOGmP7XQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MDgyOTkzNw==", "bodyText": "What about the applications cached?", "url": "https://github.com/wso2-extensions/identity-inbound-auth-oauth/pull/1389#discussion_r440829937", "createdAt": "2020-06-16T13:00:21Z", "author": {"login": "mefarazath"}, "path": "components/org.wso2.carbon.identity.oauth/src/main/java/org/wso2/carbon/identity/oauth/OAuthAdminServiceImpl.java", "diffHunk": "@@ -865,6 +865,22 @@ public void removeOAuthApplicationData(String consumerKey) throws IdentityOAuthA\n \n     }\n \n+    /**\n+     * Remove all OAuth consumer applications of a tenant.\n+     *\n+     * @param tenantId Id of the tenant\n+     * @throws IdentityOAuthAdminException\n+     */\n+    public void removeAllOAuthApplicationData(int tenantId) throws IdentityOAuthAdminException {\n+\n+        if (LOG.isDebugEnabled()) {\n+            LOG.debug(\"Deleting all OAuth Application data of the tenant: \" + tenantId);\n+        }\n+\n+        OAuthAppDAO dao = new OAuthAppDAO();\n+        dao.removeConsumerApplicationsByTenantId(tenantId);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "5326ccdfd73f4b4af501d20fd764d692a55f02f4"}, "originalPosition": 17}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MDgzMDcyMg==", "bodyText": "Also, we need to check what happens to the OAuth app -> Service Provider associations with this delete.", "url": "https://github.com/wso2-extensions/identity-inbound-auth-oauth/pull/1389#discussion_r440830722", "createdAt": "2020-06-16T13:01:35Z", "author": {"login": "mefarazath"}, "path": "components/org.wso2.carbon.identity.oauth/src/main/java/org/wso2/carbon/identity/oauth/OAuthAdminServiceImpl.java", "diffHunk": "@@ -865,6 +865,22 @@ public void removeOAuthApplicationData(String consumerKey) throws IdentityOAuthA\n \n     }\n \n+    /**\n+     * Remove all OAuth consumer applications of a tenant.\n+     *\n+     * @param tenantId Id of the tenant\n+     * @throws IdentityOAuthAdminException\n+     */\n+    public void removeAllOAuthApplicationData(int tenantId) throws IdentityOAuthAdminException {\n+\n+        if (LOG.isDebugEnabled()) {\n+            LOG.debug(\"Deleting all OAuth Application data of the tenant: \" + tenantId);\n+        }\n+\n+        OAuthAppDAO dao = new OAuthAppDAO();\n+        dao.removeConsumerApplicationsByTenantId(tenantId);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MDgyOTkzNw=="}, "originalCommit": {"oid": "5326ccdfd73f4b4af501d20fd764d692a55f02f4"}, "originalPosition": 17}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0Mjc0NTYyMw==", "bodyText": "Do we need to separately delete OAuth apps?  OAuth apps should be auto-deleted when we delete the Service Providers. So, This step is not required.\n@mefarazath WDYT?", "url": "https://github.com/wso2-extensions/identity-inbound-auth-oauth/pull/1389#discussion_r442745623", "createdAt": "2020-06-19T09:54:29Z", "author": {"login": "IsuraD"}, "path": "components/org.wso2.carbon.identity.oauth/src/main/java/org/wso2/carbon/identity/oauth/OAuthAdminServiceImpl.java", "diffHunk": "@@ -865,6 +865,22 @@ public void removeOAuthApplicationData(String consumerKey) throws IdentityOAuthA\n \n     }\n \n+    /**\n+     * Remove all OAuth consumer applications of a tenant.\n+     *\n+     * @param tenantId Id of the tenant\n+     * @throws IdentityOAuthAdminException\n+     */\n+    public void removeAllOAuthApplicationData(int tenantId) throws IdentityOAuthAdminException {\n+\n+        if (LOG.isDebugEnabled()) {\n+            LOG.debug(\"Deleting all OAuth Application data of the tenant: \" + tenantId);\n+        }\n+\n+        OAuthAppDAO dao = new OAuthAppDAO();\n+        dao.removeConsumerApplicationsByTenantId(tenantId);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MDgyOTkzNw=="}, "originalCommit": {"oid": "5326ccdfd73f4b4af501d20fd764d692a55f02f4"}, "originalPosition": 17}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0Mjc2MDAyOQ==", "bodyText": "I think, there we only delete from SP tables. Thus let's keep this.  As Farasath mentioned, we have to delete the associations too.", "url": "https://github.com/wso2-extensions/identity-inbound-auth-oauth/pull/1389#discussion_r442760029", "createdAt": "2020-06-19T10:24:15Z", "author": {"login": "IsuraD"}, "path": "components/org.wso2.carbon.identity.oauth/src/main/java/org/wso2/carbon/identity/oauth/OAuthAdminServiceImpl.java", "diffHunk": "@@ -865,6 +865,22 @@ public void removeOAuthApplicationData(String consumerKey) throws IdentityOAuthA\n \n     }\n \n+    /**\n+     * Remove all OAuth consumer applications of a tenant.\n+     *\n+     * @param tenantId Id of the tenant\n+     * @throws IdentityOAuthAdminException\n+     */\n+    public void removeAllOAuthApplicationData(int tenantId) throws IdentityOAuthAdminException {\n+\n+        if (LOG.isDebugEnabled()) {\n+            LOG.debug(\"Deleting all OAuth Application data of the tenant: \" + tenantId);\n+        }\n+\n+        OAuthAppDAO dao = new OAuthAppDAO();\n+        dao.removeConsumerApplicationsByTenantId(tenantId);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MDgyOTkzNw=="}, "originalCommit": {"oid": "5326ccdfd73f4b4af501d20fd764d692a55f02f4"}, "originalPosition": 17}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjc1NDIyMTI4OnYy", "diffSide": "RIGHT", "path": "components/org.wso2.carbon.identity.oauth/src/main/java/org/wso2/carbon/identity/oauth/dao/OAuthAppDAO.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xOFQwOTowMDoxNlrOGlmPMw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xOFQwOTowMDoxNlrOGlmPMw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MjA3Njk3OQ==", "bodyText": "these 2 try blocks can be combined.", "url": "https://github.com/wso2-extensions/identity-inbound-auth-oauth/pull/1389#discussion_r442076979", "createdAt": "2020-06-18T09:00:16Z", "author": {"login": "madurangasiriwardena"}, "path": "components/org.wso2.carbon.identity.oauth/src/main/java/org/wso2/carbon/identity/oauth/dao/OAuthAppDAO.java", "diffHunk": "@@ -695,6 +695,32 @@ public void removeConsumerApplication(String consumerKey) throws IdentityOAuthAd\n         }\n     }\n \n+    /**\n+     * Delete all consumer applications of a given tenant.\n+     *\n+     * @param tenantId Id of the tenant\n+     * @throws IdentityOAuthAdminException\n+     */\n+    public void removeConsumerApplicationsByTenantId(int tenantId) throws IdentityOAuthAdminException {\n+\n+        try (Connection connection = IdentityDatabaseUtil.getDBConnection(false)) {\n+            try (PreparedStatement prepStmt = connection", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "5326ccdfd73f4b4af501d20fd764d692a55f02f4"}, "originalPosition": 13}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjc1ODM3NTE3OnYy", "diffSide": "RIGHT", "path": "components/org.wso2.carbon.identity.oauth/src/main/java/org/wso2/carbon/identity/oauth/listener/IdentityOAuthTenantMgtListener.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xOVQwOTo1MjoyNVrOGmO_Rg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xOVQwOTo1MjoyNVrOGmO_Rg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0Mjc0NDY0Ng==", "bodyText": "Can't we reuse the TenantCreationEventListener?", "url": "https://github.com/wso2-extensions/identity-inbound-auth-oauth/pull/1389#discussion_r442744646", "createdAt": "2020-06-19T09:52:25Z", "author": {"login": "IsuraD"}, "path": "components/org.wso2.carbon.identity.oauth/src/main/java/org/wso2/carbon/identity/oauth/listener/IdentityOAuthTenantMgtListener.java", "diffHunk": "@@ -0,0 +1,88 @@\n+/*\n+ * Copyright (c) 2020, WSO2 Inc. (http://www.wso2.org) All Rights Reserved.\n+ *\n+ * WSO2 Inc. licenses this file to you under the Apache License,\n+ * Version 2.0 (the \"License\"); you may not use this file except\n+ * in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ * http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing,\n+ * software distributed under the License is distributed on an\n+ * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n+ * KIND, either express or implied. See the License for the\n+ * specific language governing permissions and limitations\n+ * under the License.\n+ */\n+\n+package org.wso2.carbon.identity.oauth.listener;\n+\n+import org.wso2.carbon.identity.oauth.IdentityOAuthAdminException;\n+import org.wso2.carbon.identity.oauth2.internal.OAuth2ServiceComponentHolder;\n+import org.wso2.carbon.stratos.common.beans.TenantInfoBean;\n+import org.wso2.carbon.stratos.common.exception.StratosException;\n+import org.wso2.carbon.stratos.common.listeners.TenantMgtListener;\n+\n+/**\n+ * Identity OAuth Tenant Management Listener.\n+ */\n+public class IdentityOAuthTenantMgtListener implements TenantMgtListener {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "5326ccdfd73f4b4af501d20fd764d692a55f02f4"}, "originalPosition": 30}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzQyMDA1NDc2OnYy", "diffSide": "RIGHT", "path": "components/org.wso2.carbon.identity.oauth/src/main/java/org/wso2/carbon/identity/oauth/OAuthAdminServiceImpl.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xNlQxMjoxNDozNFrOIHCawg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMS0wNlQyMDowMDowNFrOIPUb2Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NDI1MDU2Mg==", "bodyText": "Change this as follows:\nAnd check this throughout the PR\n@param tenantId of the tenant", "url": "https://github.com/wso2-extensions/identity-inbound-auth-oauth/pull/1389#discussion_r544250562", "createdAt": "2020-12-16T12:14:34Z", "author": {"login": "Kanapriya"}, "path": "components/org.wso2.carbon.identity.oauth/src/main/java/org/wso2/carbon/identity/oauth/OAuthAdminServiceImpl.java", "diffHunk": "@@ -865,6 +865,22 @@ public void removeOAuthApplicationData(String consumerKey) throws IdentityOAuthA\n \n     }\n \n+    /**\n+     * Remove all OAuth consumer applications of a tenant.\n+     *\n+     * @param tenantId Id of the tenant", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "06e35f24144a964762575993bcb87d4789e43b02"}, "originalPosition": 7}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1MjkzNDM2MQ==", "bodyText": "I have placed it there as, tenantId is the parameter name and Id of the tenant is the description. Hope that's fine.", "url": "https://github.com/wso2-extensions/identity-inbound-auth-oauth/pull/1389#discussion_r552934361", "createdAt": "2021-01-06T20:00:04Z", "author": {"login": "sumedhe"}, "path": "components/org.wso2.carbon.identity.oauth/src/main/java/org/wso2/carbon/identity/oauth/OAuthAdminServiceImpl.java", "diffHunk": "@@ -865,6 +865,22 @@ public void removeOAuthApplicationData(String consumerKey) throws IdentityOAuthA\n \n     }\n \n+    /**\n+     * Remove all OAuth consumer applications of a tenant.\n+     *\n+     * @param tenantId Id of the tenant", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NDI1MDU2Mg=="}, "originalCommit": {"oid": "06e35f24144a964762575993bcb87d4789e43b02"}, "originalPosition": 7}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3709, "cost": 1, "resetAt": "2021-11-13T14:23:39Z"}}}