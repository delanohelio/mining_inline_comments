{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDEzODg5OTA1", "number": 1376, "title": "Ensure claims are retrieved from the correct tenant domain", "bodyText": "Proposed changes in this pull request\n\nFixes wso2/product-is#8217.\nA token response can be subjected to pre-processing, thus it could lose tenant domain context information. For example, when BuildSubjectIdentifierFromSPConfig property is enabled, the token response passed to the method for an /userinfo request does not contain tenant domain in the authorized username, thus leading the user to be considered as belonging in the super tenant.\nTherefore user's claim is retrieved, once the tenant domain is correctly identified from the accessTokenDO data.", "createdAt": "2020-05-06T05:45:42Z", "url": "https://github.com/wso2-extensions/identity-inbound-auth-oauth/pull/1376", "merged": true, "mergeCommit": {"oid": "7071fd7b83219b1bff8450d1eb2305f8d1e30b95"}, "closed": true, "closedAt": "2020-05-06T09:47:08Z", "author": {"login": "tharindu-bandara"}, "timelineItems": {"totalCount": 6, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABceiCxygH2gAyNDEzODg5OTA1OjM4YzJkMzVkNGE5M2ZkZjYwM2RjOTJjZTQ5NjQyNDczYTg5ODhjODM=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcelEF3AFqTQwNjQzNDA1MQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "38c2d35d4a93fdf603dc92ce49642473a8988c83", "author": {"user": {"login": "tharindu-bandara", "name": "Tharindu Bandara"}}, "url": "https://github.com/wso2-extensions/identity-inbound-auth-oauth/commit/38c2d35d4a93fdf603dc92ce49642473a8988c83", "committedDate": "2020-05-06T05:43:37Z", "message": "Ensure claims are retrieved from the correct tenant domain\n\n- Fixes https://github.com/wso2/product-is/issues/8217.\n- Token response can be subjected to pre-processing, thus it could loose tenant domain context information."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "9c6083a59cfc0045d33846450e4b5b68c83e63fc", "author": {"user": {"login": "tharindu-bandara", "name": "Tharindu Bandara"}}, "url": "https://github.com/wso2-extensions/identity-inbound-auth-oauth/commit/9c6083a59cfc0045d33846450e4b5b68c83e63fc", "committedDate": "2020-05-06T05:43:37Z", "message": "Fix review comments and tests"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDA2NDA4ODUy", "url": "https://github.com/wso2-extensions/identity-inbound-auth-oauth/pull/1376#pullrequestreview-406408852", "createdAt": "2020-05-06T08:40:18Z", "commit": {"oid": "9c6083a59cfc0045d33846450e4b5b68c83e63fc"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDA2NDMyNjcy", "url": "https://github.com/wso2-extensions/identity-inbound-auth-oauth/pull/1376#pullrequestreview-406432672", "createdAt": "2020-05-06T09:12:45Z", "commit": {"oid": "9c6083a59cfc0045d33846450e4b5b68c83e63fc"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wNlQwOToxMjo0NVrOGRKYuw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wNlQwOToxMjo0NVrOGRKYuw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMDY0OTE0Nw==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                private AccessTokenDO getAccessTokenDO(String clientId, AuthenticatedUser authenticatedUser) {\n          \n          \n            \n                    AccessTokenDO accessTokenDO = new AccessTokenDO();\n          \n          \n            \n                private AccessTokenDO getAccessTokenDO(String clientId, AuthenticatedUser authenticatedUser) {\n          \n          \n            \n                \n          \n          \n            \n                    AccessTokenDO accessTokenDO = new AccessTokenDO();", "url": "https://github.com/wso2-extensions/identity-inbound-auth-oauth/pull/1376#discussion_r420649147", "createdAt": "2020-05-06T09:12:45Z", "author": {"login": "tharindu-bandara"}, "path": "components/org.wso2.carbon.identity.oauth.endpoint/src/test/java/org/wso2/carbon/identity/oauth/endpoint/util/ClaimUtilTest.java", "diffHunk": "@@ -330,6 +331,13 @@ private AccessTokenDO getAccessTokenDO(String clientId, String userStoreDomain,\n         return accessTokenDO;\n     }\n \n+    private AccessTokenDO getAccessTokenDO(String clientId, AuthenticatedUser authenticatedUser) {\n+        AccessTokenDO accessTokenDO = new AccessTokenDO();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "9c6083a59cfc0045d33846450e4b5b68c83e63fc"}, "originalPosition": 15}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "8cbbddf3db6ec02e59f036e852da47ca2dac78c6", "author": {"user": {"login": "tharindu-bandara", "name": "Tharindu Bandara"}}, "url": "https://github.com/wso2-extensions/identity-inbound-auth-oauth/commit/8cbbddf3db6ec02e59f036e852da47ca2dac78c6", "committedDate": "2020-05-06T09:12:54Z", "message": "Fix new line"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDA2NDM0MDUx", "url": "https://github.com/wso2-extensions/identity-inbound-auth-oauth/pull/1376#pullrequestreview-406434051", "createdAt": "2020-05-06T09:14:46Z", "commit": {"oid": "8cbbddf3db6ec02e59f036e852da47ca2dac78c6"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3277, "cost": 1, "resetAt": "2021-11-02T10:47:05Z"}}}