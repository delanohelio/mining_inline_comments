{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDI2Mzg4OTE2", "number": 1389, "title": "Implement OAuth data deletion on Tenant Deletion", "bodyText": "Proposed changes in this pull request\nDeletion of OAuth consumer apps and OIDC properties, in the tenant deletion process.\nFixes #1388", "createdAt": "2020-06-02T06:56:39Z", "url": "https://github.com/wso2-extensions/identity-inbound-auth-oauth/pull/1389", "merged": true, "mergeCommit": {"oid": "392e7ad1ea63415385dc76c17400522618e2f114"}, "closed": true, "closedAt": "2020-07-13T05:19:12Z", "author": {"login": "sumedhe"}, "timelineItems": {"totalCount": 10, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcnPTBggBqjMzOTYxNDU5MjU=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdmt5N_gFqTU1MzYyODMwNA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "d3249172aa5fd710b32aaebb7f930ce261a986ca", "author": {"user": {"login": "sumedhe", "name": "Sumedhe Dissanayake"}}, "url": "https://github.com/wso2-extensions/identity-inbound-auth-oauth/commit/d3249172aa5fd710b32aaebb7f930ce261a986ca", "committedDate": "2020-06-02T06:46:16Z", "message": "Implement OAuth data deletion on Tenant Deletion"}, "afterCommit": {"oid": "b800019929045af135094527274c2beb8896768e", "author": {"user": {"login": "sumedhe", "name": "Sumedhe Dissanayake"}}, "url": "https://github.com/wso2-extensions/identity-inbound-auth-oauth/commit/b800019929045af135094527274c2beb8896768e", "committedDate": "2020-06-02T06:58:14Z", "message": "Implement OAuth data deletion on Tenant Deletion"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "b800019929045af135094527274c2beb8896768e", "author": {"user": {"login": "sumedhe", "name": "Sumedhe Dissanayake"}}, "url": "https://github.com/wso2-extensions/identity-inbound-auth-oauth/commit/b800019929045af135094527274c2beb8896768e", "committedDate": "2020-06-02T06:58:14Z", "message": "Implement OAuth data deletion on Tenant Deletion"}, "afterCommit": {"oid": "5326ccdfd73f4b4af501d20fd764d692a55f02f4", "author": {"user": {"login": "sumedhe", "name": "Sumedhe Dissanayake"}}, "url": "https://github.com/wso2-extensions/identity-inbound-auth-oauth/commit/5326ccdfd73f4b4af501d20fd764d692a55f02f4", "committedDate": "2020-06-02T07:00:49Z", "message": "Implement OAuth data deletion on Tenant Deletion"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDMxNDc2MjIz", "url": "https://github.com/wso2-extensions/identity-inbound-auth-oauth/pull/1389#pullrequestreview-431476223", "createdAt": "2020-06-16T13:00:21Z", "commit": {"oid": "5326ccdfd73f4b4af501d20fd764d692a55f02f4"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xNlQxMzowMDoyMVrOGkaH8Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xNlQxMzowMDoyMVrOGkaH8Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MDgyOTkzNw==", "bodyText": "What about the applications cached?", "url": "https://github.com/wso2-extensions/identity-inbound-auth-oauth/pull/1389#discussion_r440829937", "createdAt": "2020-06-16T13:00:21Z", "author": {"login": "mefarazath"}, "path": "components/org.wso2.carbon.identity.oauth/src/main/java/org/wso2/carbon/identity/oauth/OAuthAdminServiceImpl.java", "diffHunk": "@@ -865,6 +865,22 @@ public void removeOAuthApplicationData(String consumerKey) throws IdentityOAuthA\n \n     }\n \n+    /**\n+     * Remove all OAuth consumer applications of a tenant.\n+     *\n+     * @param tenantId Id of the tenant\n+     * @throws IdentityOAuthAdminException\n+     */\n+    public void removeAllOAuthApplicationData(int tenantId) throws IdentityOAuthAdminException {\n+\n+        if (LOG.isDebugEnabled()) {\n+            LOG.debug(\"Deleting all OAuth Application data of the tenant: \" + tenantId);\n+        }\n+\n+        OAuthAppDAO dao = new OAuthAppDAO();\n+        dao.removeConsumerApplicationsByTenantId(tenantId);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "5326ccdfd73f4b4af501d20fd764d692a55f02f4"}, "originalPosition": 17}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDMzMDgxNTg0", "url": "https://github.com/wso2-extensions/identity-inbound-auth-oauth/pull/1389#pullrequestreview-433081584", "createdAt": "2020-06-18T09:00:16Z", "commit": {"oid": "5326ccdfd73f4b4af501d20fd764d692a55f02f4"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xOFQwOTowMDoxNlrOGlmPMw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xOFQwOTowMDoxNlrOGlmPMw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MjA3Njk3OQ==", "bodyText": "these 2 try blocks can be combined.", "url": "https://github.com/wso2-extensions/identity-inbound-auth-oauth/pull/1389#discussion_r442076979", "createdAt": "2020-06-18T09:00:16Z", "author": {"login": "madurangasiriwardena"}, "path": "components/org.wso2.carbon.identity.oauth/src/main/java/org/wso2/carbon/identity/oauth/dao/OAuthAppDAO.java", "diffHunk": "@@ -695,6 +695,32 @@ public void removeConsumerApplication(String consumerKey) throws IdentityOAuthAd\n         }\n     }\n \n+    /**\n+     * Delete all consumer applications of a given tenant.\n+     *\n+     * @param tenantId Id of the tenant\n+     * @throws IdentityOAuthAdminException\n+     */\n+    public void removeConsumerApplicationsByTenantId(int tenantId) throws IdentityOAuthAdminException {\n+\n+        try (Connection connection = IdentityDatabaseUtil.getDBConnection(false)) {\n+            try (PreparedStatement prepStmt = connection", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "5326ccdfd73f4b4af501d20fd764d692a55f02f4"}, "originalPosition": 13}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDMzOTQ3OTcz", "url": "https://github.com/wso2-extensions/identity-inbound-auth-oauth/pull/1389#pullrequestreview-433947973", "createdAt": "2020-06-19T09:52:25Z", "commit": {"oid": "5326ccdfd73f4b4af501d20fd764d692a55f02f4"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xOVQwOTo1MjoyNVrOGmO_Rg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xOVQwOTo1MjoyNVrOGmO_Rg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0Mjc0NDY0Ng==", "bodyText": "Can't we reuse the TenantCreationEventListener?", "url": "https://github.com/wso2-extensions/identity-inbound-auth-oauth/pull/1389#discussion_r442744646", "createdAt": "2020-06-19T09:52:25Z", "author": {"login": "IsuraD"}, "path": "components/org.wso2.carbon.identity.oauth/src/main/java/org/wso2/carbon/identity/oauth/listener/IdentityOAuthTenantMgtListener.java", "diffHunk": "@@ -0,0 +1,88 @@\n+/*\n+ * Copyright (c) 2020, WSO2 Inc. (http://www.wso2.org) All Rights Reserved.\n+ *\n+ * WSO2 Inc. licenses this file to you under the Apache License,\n+ * Version 2.0 (the \"License\"); you may not use this file except\n+ * in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ * http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing,\n+ * software distributed under the License is distributed on an\n+ * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n+ * KIND, either express or implied. See the License for the\n+ * specific language governing permissions and limitations\n+ * under the License.\n+ */\n+\n+package org.wso2.carbon.identity.oauth.listener;\n+\n+import org.wso2.carbon.identity.oauth.IdentityOAuthAdminException;\n+import org.wso2.carbon.identity.oauth2.internal.OAuth2ServiceComponentHolder;\n+import org.wso2.carbon.stratos.common.beans.TenantInfoBean;\n+import org.wso2.carbon.stratos.common.exception.StratosException;\n+import org.wso2.carbon.stratos.common.listeners.TenantMgtListener;\n+\n+/**\n+ * Identity OAuth Tenant Management Listener.\n+ */\n+public class IdentityOAuthTenantMgtListener implements TenantMgtListener {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "5326ccdfd73f4b4af501d20fd764d692a55f02f4"}, "originalPosition": 30}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "5326ccdfd73f4b4af501d20fd764d692a55f02f4", "author": {"user": {"login": "sumedhe", "name": "Sumedhe Dissanayake"}}, "url": "https://github.com/wso2-extensions/identity-inbound-auth-oauth/commit/5326ccdfd73f4b4af501d20fd764d692a55f02f4", "committedDate": "2020-06-02T07:00:49Z", "message": "Implement OAuth data deletion on Tenant Deletion"}, "afterCommit": {"oid": "accbe641d1dc4e0d37dee36749b878fdbee28ced", "author": {"user": {"login": "sumedhe", "name": "Sumedhe Dissanayake"}}, "url": "https://github.com/wso2-extensions/identity-inbound-auth-oauth/commit/accbe641d1dc4e0d37dee36749b878fdbee28ced", "committedDate": "2020-06-21T19:58:07Z", "message": "Implement OAuth data deletion on Tenant Deletion"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "06e35f24144a964762575993bcb87d4789e43b02", "author": {"user": {"login": "sumedhe", "name": "Sumedhe Dissanayake"}}, "url": "https://github.com/wso2-extensions/identity-inbound-auth-oauth/commit/06e35f24144a964762575993bcb87d4789e43b02", "committedDate": "2020-06-24T08:23:09Z", "message": "Implement OAuth data deletion on Tenant Deletion"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "accbe641d1dc4e0d37dee36749b878fdbee28ced", "author": {"user": {"login": "sumedhe", "name": "Sumedhe Dissanayake"}}, "url": "https://github.com/wso2-extensions/identity-inbound-auth-oauth/commit/accbe641d1dc4e0d37dee36749b878fdbee28ced", "committedDate": "2020-06-21T19:58:07Z", "message": "Implement OAuth data deletion on Tenant Deletion"}, "afterCommit": {"oid": "06e35f24144a964762575993bcb87d4789e43b02", "author": {"user": {"login": "sumedhe", "name": "Sumedhe Dissanayake"}}, "url": "https://github.com/wso2-extensions/identity-inbound-auth-oauth/commit/06e35f24144a964762575993bcb87d4789e43b02", "committedDate": "2020-06-24T08:23:09Z", "message": "Implement OAuth data deletion on Tenant Deletion"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDQ2OTg2ODc5", "url": "https://github.com/wso2-extensions/identity-inbound-auth-oauth/pull/1389#pullrequestreview-446986879", "createdAt": "2020-07-13T05:19:05Z", "commit": {"oid": "06e35f24144a964762575993bcb87d4789e43b02"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTUzNjI4MzA0", "url": "https://github.com/wso2-extensions/identity-inbound-auth-oauth/pull/1389#pullrequestreview-553628304", "createdAt": "2020-12-16T12:14:34Z", "commit": {"oid": "06e35f24144a964762575993bcb87d4789e43b02"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xNlQxMjoxNDozNFrOIHCawg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xNlQxMjoxNDozNFrOIHCawg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NDI1MDU2Mg==", "bodyText": "Change this as follows:\nAnd check this throughout the PR\n@param tenantId of the tenant", "url": "https://github.com/wso2-extensions/identity-inbound-auth-oauth/pull/1389#discussion_r544250562", "createdAt": "2020-12-16T12:14:34Z", "author": {"login": "Kanapriya"}, "path": "components/org.wso2.carbon.identity.oauth/src/main/java/org/wso2/carbon/identity/oauth/OAuthAdminServiceImpl.java", "diffHunk": "@@ -865,6 +865,22 @@ public void removeOAuthApplicationData(String consumerKey) throws IdentityOAuthA\n \n     }\n \n+    /**\n+     * Remove all OAuth consumer applications of a tenant.\n+     *\n+     * @param tenantId Id of the tenant", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "06e35f24144a964762575993bcb87d4789e43b02"}, "originalPosition": 7}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3290, "cost": 1, "resetAt": "2021-11-02T10:47:05Z"}}}