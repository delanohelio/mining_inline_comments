{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0Mzc4MTQ1NjY2", "number": 1329, "title": "Add location header to the response of REST API call to add oauth scopes", "bodyText": "Proposed changes in this pull request\nFix for issue wso2/product-is#7598", "createdAt": "2020-02-21T07:29:44Z", "url": "https://github.com/wso2-extensions/identity-inbound-auth-oauth/pull/1329", "merged": true, "mergeCommit": {"oid": "ebc3cd3212a744aba79c1714e3e3f25e04e6119e"}, "closed": true, "closedAt": "2020-02-21T10:39:06Z", "author": {"login": "DinikaSen"}, "timelineItems": {"totalCount": 8, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcGah9RgH2gAyMzc4MTQ1NjY2OjgwNDVhNjE4YjM0YTQ1OTBiZGFkYjIyZmMyMzNiMDY2M2JkMTI2ZTA=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcGbzHnAFqTM2MjQ3NzIxMg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "8045a618b34a4590bdadb22fc233b0663bd126e0", "author": {"user": {"login": "DinikaSen", "name": "Dinika Senarath"}}, "url": "https://github.com/wso2-extensions/identity-inbound-auth-oauth/commit/8045a618b34a4590bdadb22fc233b0663bd126e0", "committedDate": "2020-02-21T07:24:15Z", "message": "Add location header to the response of REST API call to add oauth scopes"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzYyNDU4NjM5", "url": "https://github.com/wso2-extensions/identity-inbound-auth-oauth/pull/1329#pullrequestreview-362458639", "createdAt": "2020-02-21T08:15:20Z", "commit": {"oid": "8045a618b34a4590bdadb22fc233b0663bd126e0"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yMVQwODoxNToyMFrOFsuuhA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yMVQwODoxNToyMFrOFsuuhA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MjQ0NzIzNg==", "bodyText": "will it be possible to rename this variable as location?", "url": "https://github.com/wso2-extensions/identity-inbound-auth-oauth/pull/1329#discussion_r382447236", "createdAt": "2020-02-21T08:15:20Z", "author": {"login": "Buddhimah"}, "path": "components/org.wso2.carbon.identity.oauth.scope.endpoint/src/main/java/org/wso2/carbon/identity/oauth/scope/endpoint/impl/ScopesApiServiceImpl.java", "diffHunk": "@@ -233,4 +246,48 @@ public Response deleteScope(String name) {\n         }\n         return Response.status(Response.Status.OK).build();\n     }\n+\n+    /**\n+     * Build the complete URI to the location of the resource.\n+     * Ex: https://localhost:9443/t/<tenant-domain>/identity/oauth2/v1.0/scopes/name/<scope_name>\n+     *\n+     * @param name of the scope.\n+     * @return Fully qualified and complete URI.\n+     */\n+    private static URI buildURIForHeader(String name) {\n+\n+        String tenantQualifiedRelativePath =\n+                String.format(TENANT_CONTEXT_PATH_COMPONENT, getTenantDomainFromContext()) + SERVER_API_PATH_COMPONENT;\n+        String url = IdentityUtil.getEndpointURIPath(tenantQualifiedRelativePath + name, false, true);\n+\n+        URI loc = URI.create(url);\n+        if (!loc.isAbsolute()) {\n+            Message currentMessage = PhaseInterceptorChain.getCurrentMessage();\n+            if (currentMessage != null) {\n+                UriInfo ui = new UriInfoImpl(currentMessage.getExchange().getInMessage(), null);\n+                try {\n+                    return new URI(ui.getBaseUri().getScheme(), ui.getBaseUri().getAuthority(), url, null, null);\n+                } catch (URISyntaxException e) {\n+                    LOG.error(\"Server encountered an error while building the location URL with scheme: \" +\n+                            ui.getBaseUri().getScheme() + \", authority: \" + ui.getBaseUri().getAuthority() +\n+                            \", url: \" + url, e);\n+                }\n+            }\n+        }\n+        return loc;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "8045a618b34a4590bdadb22fc233b0663bd126e0"}, "originalPosition": 71}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzYyNDYwMDEz", "url": "https://github.com/wso2-extensions/identity-inbound-auth-oauth/pull/1329#pullrequestreview-362460013", "createdAt": "2020-02-21T08:18:14Z", "commit": {"oid": "8045a618b34a4590bdadb22fc233b0663bd126e0"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yMVQwODoxODoxNFrOFsuyzQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yMVQwODoxODoxNFrOFsuyzQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MjQ0ODMzMw==", "bodyText": "if (StringUtils.isNotBlank(IdentityUtil.threadLocalProperties.get().get(TENANT_NAME_FROM_CONTEXT))) {\n        return (String) IdentityUtil.threadLocalProperties.get().get(TENANT_NAME_FROM_CONTEXT);\n    }\n    return MultitenantConstants.SUPER_TENANT_DOMAIN_NAME;", "url": "https://github.com/wso2-extensions/identity-inbound-auth-oauth/pull/1329#discussion_r382448333", "createdAt": "2020-02-21T08:18:14Z", "author": {"login": "Buddhimah"}, "path": "components/org.wso2.carbon.identity.oauth.scope.endpoint/src/main/java/org/wso2/carbon/identity/oauth/scope/endpoint/impl/ScopesApiServiceImpl.java", "diffHunk": "@@ -233,4 +246,48 @@ public Response deleteScope(String name) {\n         }\n         return Response.status(Response.Status.OK).build();\n     }\n+\n+    /**\n+     * Build the complete URI to the location of the resource.\n+     * Ex: https://localhost:9443/t/<tenant-domain>/identity/oauth2/v1.0/scopes/name/<scope_name>\n+     *\n+     * @param name of the scope.\n+     * @return Fully qualified and complete URI.\n+     */\n+    private static URI buildURIForHeader(String name) {\n+\n+        String tenantQualifiedRelativePath =\n+                String.format(TENANT_CONTEXT_PATH_COMPONENT, getTenantDomainFromContext()) + SERVER_API_PATH_COMPONENT;\n+        String url = IdentityUtil.getEndpointURIPath(tenantQualifiedRelativePath + name, false, true);\n+\n+        URI loc = URI.create(url);\n+        if (!loc.isAbsolute()) {\n+            Message currentMessage = PhaseInterceptorChain.getCurrentMessage();\n+            if (currentMessage != null) {\n+                UriInfo ui = new UriInfoImpl(currentMessage.getExchange().getInMessage(), null);\n+                try {\n+                    return new URI(ui.getBaseUri().getScheme(), ui.getBaseUri().getAuthority(), url, null, null);\n+                } catch (URISyntaxException e) {\n+                    LOG.error(\"Server encountered an error while building the location URL with scheme: \" +\n+                            ui.getBaseUri().getScheme() + \", authority: \" + ui.getBaseUri().getAuthority() +\n+                            \", url: \" + url, e);\n+                }\n+            }\n+        }\n+        return loc;\n+    }\n+\n+    /**\n+     * Retrieves loaded tenant domain from carbon context.\n+     *\n+     * @return tenant domain of the request being served.\n+     */\n+    private static String getTenantDomainFromContext() {\n+\n+        String tenantDomain = MultitenantConstants.SUPER_TENANT_DOMAIN_NAME;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "8045a618b34a4590bdadb22fc233b0663bd126e0"}, "originalPosition": 81}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzYyNDYyMTU0", "url": "https://github.com/wso2-extensions/identity-inbound-auth-oauth/pull/1329#pullrequestreview-362462154", "createdAt": "2020-02-21T08:22:56Z", "commit": {"oid": "8045a618b34a4590bdadb22fc233b0663bd126e0"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yMVQwODoyMjo1N1rOFsu5fg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yMVQwODoyMjo1N1rOFsu5fg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MjQ1MDA0Ng==", "bodyText": "Can we change the parameter name to something like scopeName", "url": "https://github.com/wso2-extensions/identity-inbound-auth-oauth/pull/1329#discussion_r382450046", "createdAt": "2020-02-21T08:22:57Z", "author": {"login": "Buddhimah"}, "path": "components/org.wso2.carbon.identity.oauth.scope.endpoint/src/main/java/org/wso2/carbon/identity/oauth/scope/endpoint/impl/ScopesApiServiceImpl.java", "diffHunk": "@@ -233,4 +246,48 @@ public Response deleteScope(String name) {\n         }\n         return Response.status(Response.Status.OK).build();\n     }\n+\n+    /**\n+     * Build the complete URI to the location of the resource.\n+     * Ex: https://localhost:9443/t/<tenant-domain>/identity/oauth2/v1.0/scopes/name/<scope_name>\n+     *\n+     * @param name of the scope.\n+     * @return Fully qualified and complete URI.\n+     */\n+    private static URI buildURIForHeader(String name) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "8045a618b34a4590bdadb22fc233b0663bd126e0"}, "originalPosition": 51}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "5c477731e784f3fbcb9de136d6e0e569db981e58", "author": {"user": {"login": "DinikaSen", "name": "Dinika Senarath"}}, "url": "https://github.com/wso2-extensions/identity-inbound-auth-oauth/commit/5c477731e784f3fbcb9de136d6e0e569db981e58", "committedDate": "2020-02-21T08:24:54Z", "message": "Rename variable loc to location"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "112d70b3c2f70edcd8215a6471ede743d9159039", "author": {"user": {"login": "DinikaSen", "name": "Dinika Senarath"}}, "url": "https://github.com/wso2-extensions/identity-inbound-auth-oauth/commit/112d70b3c2f70edcd8215a6471ede743d9159039", "committedDate": "2020-02-21T08:31:34Z", "message": "Rename variable scope to scopeName"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzYyNDcxODQ0", "url": "https://github.com/wso2-extensions/identity-inbound-auth-oauth/pull/1329#pullrequestreview-362471844", "createdAt": "2020-02-21T08:42:50Z", "commit": {"oid": "112d70b3c2f70edcd8215a6471ede743d9159039"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzYyNDc3MjEy", "url": "https://github.com/wso2-extensions/identity-inbound-auth-oauth/pull/1329#pullrequestreview-362477212", "createdAt": "2020-02-21T08:52:54Z", "commit": {"oid": "112d70b3c2f70edcd8215a6471ede743d9159039"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3214, "cost": 1, "resetAt": "2021-11-02T10:47:05Z"}}}