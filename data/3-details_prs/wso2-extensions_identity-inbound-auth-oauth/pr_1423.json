{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDY2MDE2NTU4", "number": 1423, "title": "Adding extension to support Custom Key IDs", "bodyText": "Purpose\n\nThis PR will introduce an extension point to add custom Key IDs for JWT tokens.\n\nApproach\n\nKeyIDProvider interface is added and DefaultKeyIDProvider class was written extending that interface. This default implementation contains the original Key ID calculation logic. At the OAuth2ServiceComponent registration, we set this default implementation as the KeyID Provider implementation, if there is no other custom KeyIDProvider instances are registered. If a Custom KeyIDProvider is registered, it will be used when calculating the Key ID\n\nRefer mail thread : [OB] Custom Key ID for the ID Token Builder\nSecurity checks\n\nFollowed secure coding standards in http://wso2.com/technical-reports/wso2-secure-engineering-guidelines? yes\nRan FindSecurityBugs plugin and verified report? yes\nConfirmed that this PR doesn't commit any keys, passwords, tokens, usernames, or other secrets? yes", "createdAt": "2020-08-11T10:29:48Z", "url": "https://github.com/wso2-extensions/identity-inbound-auth-oauth/pull/1423", "merged": true, "mergeCommit": {"oid": "ba8099c34e642ac8cfb69c7f907c758915d717df"}, "closed": true, "closedAt": "2020-08-25T04:51:02Z", "author": {"login": "dimuthnc"}, "timelineItems": {"totalCount": 19, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABc9z5TugH2gAyNDY2MDE2NTU4OjkxYTBiYmVlZGJjZjFkZTc0MzcwNDkyMWRhZTBjMjZiNjg4Nzg5YzQ=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdCIHfDAFqTQ3MzgwOTEyMw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "91a0bbeedbcf1de743704921dae0c26b688789c4", "author": {"user": {"login": "dimuthwso2", "name": null}}, "url": "https://github.com/wso2-extensions/identity-inbound-auth-oauth/commit/91a0bbeedbcf1de743704921dae0c26b688789c4", "committedDate": "2020-08-11T10:03:13Z", "message": "Add KeyIDProvider interface and DefaultKeyIDProviderImpl implementation"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "05440dfaef80c68103af65d990e85d3403a4ba95", "author": {"user": {"login": "dimuthwso2", "name": null}}, "url": "https://github.com/wso2-extensions/identity-inbound-auth-oauth/commit/05440dfaef80c68103af65d990e85d3403a4ba95", "committedDate": "2020-08-11T10:03:58Z", "message": "Add methods to register custom KeyIDProvider implementations to Data holder during OSGi activation"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "23994040fb2ed234e38e334883a58f644c04fed1", "author": {"user": {"login": "dimuthwso2", "name": null}}, "url": "https://github.com/wso2-extensions/identity-inbound-auth-oauth/commit/23994040fb2ed234e38e334883a58f644c04fed1", "committedDate": "2020-08-11T10:04:21Z", "message": "Change the KeyID Calculation logic to the new KeyIDProvider based method"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "1e254c2dcaded52acba4c278e1b3a1a6ebd82ad4", "author": {"user": {"login": "dimuthwso2", "name": null}}, "url": "https://github.com/wso2-extensions/identity-inbound-auth-oauth/commit/1e254c2dcaded52acba4c278e1b3a1a6ebd82ad4", "committedDate": "2020-08-11T10:04:35Z", "message": "Fixed the failing test cases"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ce082e8765ba27ca9a5b64d51e70168f20c088f0", "author": {"user": {"login": "dimuthwso2", "name": null}}, "url": "https://github.com/wso2-extensions/identity-inbound-auth-oauth/commit/ce082e8765ba27ca9a5b64d51e70168f20c088f0", "committedDate": "2020-08-12T11:36:59Z", "message": "Fixed the log printing logic"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "3598c67dfb769cbe96a676ad7ce245408761203c", "author": {"user": {"login": "dimuthwso2", "name": null}}, "url": "https://github.com/wso2-extensions/identity-inbound-auth-oauth/commit/3598c67dfb769cbe96a676ad7ce245408761203c", "committedDate": "2020-08-19T07:22:41Z", "message": "Fixed styling issues pointed in review"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "2e1b30f41c3249879aec764d612de272f743335f", "author": {"user": {"login": "dimuthwso2", "name": null}}, "url": "https://github.com/wso2-extensions/identity-inbound-auth-oauth/commit/2e1b30f41c3249879aec764d612de272f743335f", "committedDate": "2020-08-19T07:23:14Z", "message": "Merge branch 'master' of https://github.com/wso2-extensions/identity-inbound-auth-oauth"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "95115b883375a71a2d90436ff5ad9381af537f75", "author": {"user": {"login": "dimuthwso2", "name": null}}, "url": "https://github.com/wso2-extensions/identity-inbound-auth-oauth/commit/95115b883375a71a2d90436ff5ad9381af537f75", "committedDate": "2020-08-19T09:12:44Z", "message": "Add debug logs for KeyIDProvider implementation"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f3759c7482fc2bf21a7b614f5a63dbd05c68c3dd", "author": {"user": {"login": "dimuthwso2", "name": null}}, "url": "https://github.com/wso2-extensions/identity-inbound-auth-oauth/commit/f3759c7482fc2bf21a7b614f5a63dbd05c68c3dd", "committedDate": "2020-08-19T09:44:22Z", "message": "Fixed styling issues"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "04edb66ca6253384d82585f9139772267c194117", "author": {"user": {"login": "dimuthwso2", "name": null}}, "url": "https://github.com/wso2-extensions/identity-inbound-auth-oauth/commit/04edb66ca6253384d82585f9139772267c194117", "committedDate": "2020-08-19T09:48:35Z", "message": "Fixed styling issues"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "3c35ec3dbc722e031615e03ad1402d022cda97b1", "author": {"user": {"login": "dimuthwso2", "name": null}}, "url": "https://github.com/wso2-extensions/identity-inbound-auth-oauth/commit/3c35ec3dbc722e031615e03ad1402d022cda97b1", "committedDate": "2020-08-19T10:05:38Z", "message": "Fixed styling issues"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDcwMzI0MzI3", "url": "https://github.com/wso2-extensions/identity-inbound-auth-oauth/pull/1423#pullrequestreview-470324327", "createdAt": "2020-08-19T10:24:52Z", "commit": {"oid": "3c35ec3dbc722e031615e03ad1402d022cda97b1"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c6a3abcb8c224352eccee7212ed814954c88b740", "author": {"user": {"login": "dimuthwso2", "name": null}}, "url": "https://github.com/wso2-extensions/identity-inbound-auth-oauth/commit/c6a3abcb8c224352eccee7212ed814954c88b740", "committedDate": "2020-08-19T12:22:52Z", "message": "Debug log in OAuth2Util reformatted"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDcxMTAyMTEz", "url": "https://github.com/wso2-extensions/identity-inbound-auth-oauth/pull/1423#pullrequestreview-471102113", "createdAt": "2020-08-20T03:29:42Z", "commit": {"oid": "c6a3abcb8c224352eccee7212ed814954c88b740"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yMFQwMzoyOTo0MlrOHDoMZw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yMFQwMzoyOTo0MlrOHDoMZw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MzU2NjMxMQ==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                 * Method to obtain KeyID value for the JWT header.\n          \n          \n            \n                 * Method to obtain 'kid' value for the signing key to be included the JWT header.", "url": "https://github.com/wso2-extensions/identity-inbound-auth-oauth/pull/1423#discussion_r473566311", "createdAt": "2020-08-20T03:29:42Z", "author": {"login": "mefarazath"}, "path": "components/org.wso2.carbon.identity.oauth/src/main/java/org/wso2/carbon/identity/oauth2/util/OAuth2Util.java", "diffHunk": "@@ -2456,6 +2453,19 @@ public static String getKID(String certThumbprint, JWSAlgorithm signatureAlgorit\n         return certThumbprint + \"_\" + signatureAlgorithm.toString();\n     }\n \n+    /**\n+     * Method to obtain KeyID value for the JWT header.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c6a3abcb8c224352eccee7212ed814954c88b740"}, "originalPosition": 37}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDcxMTAyNjU2", "url": "https://github.com/wso2-extensions/identity-inbound-auth-oauth/pull/1423#pullrequestreview-471102656", "createdAt": "2020-08-20T03:31:38Z", "commit": {"oid": "c6a3abcb8c224352eccee7212ed814954c88b740"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yMFQwMzozMTozOVrOHDoOeA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yMFQwMzozMTozOVrOHDoOeA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MzU2Njg0MA==", "bodyText": "Is passing the Keystore reference useful here in the exception message?", "url": "https://github.com/wso2-extensions/identity-inbound-auth-oauth/pull/1423#discussion_r473566840", "createdAt": "2020-08-20T03:31:39Z", "author": {"login": "mefarazath"}, "path": "components/org.wso2.carbon.identity.oauth/src/main/java/org/wso2/carbon/identity/oauth2/util/OAuth2Util.java", "diffHunk": "@@ -2540,10 +2571,28 @@ private static Certificate getCertificate(String tenantDomain, int tenantId) thr\n                 // derive key store name\n                 String ksName = tenantDomain.trim().replace(\".\", \"-\");\n                 String jksName = ksName + \".jks\";\n-                keyStore = tenantKSM.getKeyStore(jksName);\n-                publicCert = keyStore.getCertificate(tenantDomain);\n+                if (log.isDebugEnabled()) {\n+                    log.debug(String.format(\"Loading default tenant certificate for tenant : %s from the KeyStore\" +\n+                            \" %s\", tenantDomain, ksName));\n+                }\n+                try {\n+                    keyStore = tenantKSM.getKeyStore(jksName);\n+                    publicCert = keyStore.getCertificate(tenantDomain);\n+                } catch (KeyStoreException e) {\n+                    throw new IdentityOAuth2Exception(\"Error occurred while loading public certificate for tenant: \" +\n+                            tenantDomain, e);\n+                } catch (Exception e) {\n+                    throw new IdentityOAuth2Exception(\"Error occurred while loading Keystore: \" + keyStore + \" for \" +", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c6a3abcb8c224352eccee7212ed814954c88b740"}, "originalPosition": 150}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "30cbeb360acf87c9c903bd9c82d8c0652b17cb57", "author": {"user": {"login": "dimuthnc", "name": "Dimuth Menikgama"}}, "url": "https://github.com/wso2-extensions/identity-inbound-auth-oauth/commit/30cbeb360acf87c9c903bd9c82d8c0652b17cb57", "committedDate": "2020-08-20T04:05:05Z", "message": "Update components/org.wso2.carbon.identity.oauth/src/main/java/org/wso2/carbon/identity/oauth2/util/OAuth2Util.java\n\nCo-authored-by: Farasath Ahamed <mefarazath@gmail.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "edc2012997898be551b94ffd5637f94b26f7720c", "author": {"user": {"login": "dimuthwso2", "name": null}}, "url": "https://github.com/wso2-extensions/identity-inbound-auth-oauth/commit/edc2012997898be551b94ffd5637f94b26f7720c", "committedDate": "2020-08-20T04:11:05Z", "message": "Refactored Exception message in getCertificate method"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c0d257bf4bca184534a887234bf80dfb20f71891", "author": {"user": {"login": "dimuthwso2", "name": null}}, "url": "https://github.com/wso2-extensions/identity-inbound-auth-oauth/commit/c0d257bf4bca184534a887234bf80dfb20f71891", "committedDate": "2020-08-20T04:11:32Z", "message": "Merge branch 'master' of https://github.com/dimuthnc/identity-inbound-auth-oauth"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDczODA5MTIz", "url": "https://github.com/wso2-extensions/identity-inbound-auth-oauth/pull/1423#pullrequestreview-473809123", "createdAt": "2020-08-24T19:52:30Z", "commit": {"oid": "c0d257bf4bca184534a887234bf80dfb20f71891"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3135, "cost": 1, "resetAt": "2021-11-02T10:47:05Z"}}}