{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDA4NTk4NDEz", "number": 1366, "title": "Add unit tests for getIDTokenIssuer", "bodyText": "Proposed changes in this pull request\n$subject\nAdding test cases for #1365", "createdAt": "2020-04-24T14:52:40Z", "url": "https://github.com/wso2-extensions/identity-inbound-auth-oauth/pull/1366", "merged": true, "mergeCommit": {"oid": "21c41ee1f298d6213dde42b206c9370ddb9d7da2"}, "closed": true, "closedAt": "2020-06-19T06:50:43Z", "author": {"login": "chamathns"}, "timelineItems": {"totalCount": 7, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcayuBVABqjMyNjk3Nzg3MTQ=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcstWc2AFqTQzMzg0MDQyMA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "f1d031e7526c750d475527483baa96314ff45197", "author": {"user": {"login": "chamathns", "name": "Chamath Samarawickrama"}}, "url": "https://github.com/wso2-extensions/identity-inbound-auth-oauth/commit/f1d031e7526c750d475527483baa96314ff45197", "committedDate": "2020-04-24T14:49:49Z", "message": "add unit tests"}, "afterCommit": {"oid": "3d92fe43e73c551e4b4040145f1a48940ed7ee4b", "author": {"user": {"login": "chamathns", "name": "Chamath Samarawickrama"}}, "url": "https://github.com/wso2-extensions/identity-inbound-auth-oauth/commit/3d92fe43e73c551e4b4040145f1a48940ed7ee4b", "committedDate": "2020-04-24T14:53:22Z", "message": "add unit tests"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "dd0031ae4c980be43b1f345b945ee88b16bd542f", "author": {"user": {"login": "chamathns", "name": "Chamath Samarawickrama"}}, "url": "https://github.com/wso2-extensions/identity-inbound-auth-oauth/commit/dd0031ae4c980be43b1f345b945ee88b16bd542f", "committedDate": "2020-04-24T15:25:37Z", "message": "add unit tests"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "3d92fe43e73c551e4b4040145f1a48940ed7ee4b", "author": {"user": {"login": "chamathns", "name": "Chamath Samarawickrama"}}, "url": "https://github.com/wso2-extensions/identity-inbound-auth-oauth/commit/3d92fe43e73c551e4b4040145f1a48940ed7ee4b", "committedDate": "2020-04-24T14:53:22Z", "message": "add unit tests"}, "afterCommit": {"oid": "dd0031ae4c980be43b1f345b945ee88b16bd542f", "author": {"user": {"login": "chamathns", "name": "Chamath Samarawickrama"}}, "url": "https://github.com/wso2-extensions/identity-inbound-auth-oauth/commit/dd0031ae4c980be43b1f345b945ee88b16bd542f", "committedDate": "2020-04-24T15:25:37Z", "message": "add unit tests"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDMzNzk5NTgw", "url": "https://github.com/wso2-extensions/identity-inbound-auth-oauth/pull/1366#pullrequestreview-433799580", "createdAt": "2020-06-19T04:48:24Z", "commit": {"oid": "dd0031ae4c980be43b1f345b945ee88b16bd542f"}, "state": "COMMENTED", "comments": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xOVQwNDo0ODoyNVrOGmH6QA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xOVQwNDo0OTo1OFrOGmH7vA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MjYyODY3Mg==", "bodyText": "Handle the exception. We can use  expectedExceptions", "url": "https://github.com/wso2-extensions/identity-inbound-auth-oauth/pull/1366#discussion_r442628672", "createdAt": "2020-06-19T04:48:25Z", "author": {"login": "piraveena"}, "path": "components/org.wso2.carbon.identity.oauth/src/test/java/org/wso2/carbon/identity/oauth2/util/OAuth2UtilTest.java", "diffHunk": "@@ -953,14 +972,59 @@ public void testGetIDTokenIssuer(String oidcIDTokenIssuer, String oauth2TokenEPU\n         assertEquals(OAuth2Util.getIDTokenIssuer(), issuer);\n     }\n \n+    @DataProvider(name = \"IDTokenIssuerData2\")\n+    public Object[][] idTokenIssuerData2() {\n+\n+        return new Object[][]{\n+                // tenant-qualified URL support\n+                // OIDC Config url\n+                // tenant domain\n+                // expected\n+                {false, \"https://localhost:9443/testIssuer\", \"wso2.com\", \"https://localhost:9443/testIssuer\"},\n+                {false, \"https://localhost:9443/testIssuer\", \"\", \"https://localhost:9443/testIssuer\"},\n+                {true, \"https://localhost:9443/testIssuer\", \"\", \"https://localhost:9443/oauth2/token\"},\n+                {true, \"https://localhost:9443/testIssuer\", \"wso2.com\", \"https://localhost:9443/t/wso2\" +\n+                        \".com/oauth2/token\"}\n+\n+        };\n+    }\n+\n+    @Test(dataProvider = \"IDTokenIssuerData2\")\n+    public void testGetIDTokenIssuer2(boolean enableTenantURLSupport, String oidcConfigUrl, String tenantDomain,\n+                                      String expected) {\n+\n+        when(IdentityTenantUtil.isTenantQualifiedUrlsEnabled()).thenReturn(enableTenantURLSupport);\n+        when(IdentityTenantUtil.getTenantDomainFromContext()).thenReturn(tenantDomain);\n+        when(PrivilegedCarbonContext.getThreadLocalCarbonContext().getTenantDomain()).thenReturn(\"carbon.super\");\n+\n+        FederatedAuthenticatorConfig[] federatedAuthenticatorConfigs = new FederatedAuthenticatorConfig[0];\n+        when(mockIdentityProvider.getFederatedAuthenticatorConfigs()).thenReturn(federatedAuthenticatorConfigs);\n+\n+        mockStatic(IdentityApplicationManagementUtil.class);\n+        mockStatic(FederatedAuthenticatorConfig.class);\n+        Property property = mock(Property.class);\n+        Property[] properties = new Property[0];\n+        when(IdentityApplicationManagementUtil.getFederatedAuthenticator(federatedAuthenticatorConfigs,\n+                \"openidconnect\")).thenReturn(mockFederatedAuthenticatorConfig);\n+        when(mockFederatedAuthenticatorConfig.getProperties()).thenReturn(properties);\n+        when(IdentityApplicationManagementUtil.getProperty(properties, \"IdPEntityId\")).thenReturn(property);\n+        when(property.getValue()).thenReturn(oidcConfigUrl);\n+        try {\n+            assertEquals(getIdTokenIssuer(tenantDomain), expected);\n+        } catch (IdentityOAuth2Exception e) {\n+            //mock request, hence ignored.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "dd0031ae4c980be43b1f345b945ee88b16bd542f"}, "originalPosition": 105}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MjYyODc1MQ==", "bodyText": "provide a meaning ful name for this dataprovider", "url": "https://github.com/wso2-extensions/identity-inbound-auth-oauth/pull/1366#discussion_r442628751", "createdAt": "2020-06-19T04:48:44Z", "author": {"login": "piraveena"}, "path": "components/org.wso2.carbon.identity.oauth/src/test/java/org/wso2/carbon/identity/oauth2/util/OAuth2UtilTest.java", "diffHunk": "@@ -953,14 +972,59 @@ public void testGetIDTokenIssuer(String oidcIDTokenIssuer, String oauth2TokenEPU\n         assertEquals(OAuth2Util.getIDTokenIssuer(), issuer);\n     }\n \n+    @DataProvider(name = \"IDTokenIssuerData2\")", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "dd0031ae4c980be43b1f345b945ee88b16bd542f"}, "originalPosition": 65}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MjYyOTAxMA==", "bodyText": "add the access modifier", "url": "https://github.com/wso2-extensions/identity-inbound-auth-oauth/pull/1366#discussion_r442629010", "createdAt": "2020-06-19T04:49:42Z", "author": {"login": "piraveena"}, "path": "components/org.wso2.carbon.identity.oauth/src/test/java/org/wso2/carbon/identity/oauth2/util/OAuth2UtilTest.java", "diffHunk": "@@ -162,6 +169,15 @@\n     @Mock\n     private AxisConfiguration mockAxisConfiguration;\n \n+    @Mock\n+    FederatedAuthenticatorConfig mockFederatedAuthenticatorConfig = new FederatedAuthenticatorConfig();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "dd0031ae4c980be43b1f345b945ee88b16bd542f"}, "originalPosition": 40}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MjYyOTA1Mg==", "bodyText": "remove the new line", "url": "https://github.com/wso2-extensions/identity-inbound-auth-oauth/pull/1366#discussion_r442629052", "createdAt": "2020-06-19T04:49:58Z", "author": {"login": "piraveena"}, "path": "components/org.wso2.carbon.identity.oauth/src/test/java/org/wso2/carbon/identity/oauth2/util/OAuth2UtilTest.java", "diffHunk": "@@ -953,14 +972,59 @@ public void testGetIDTokenIssuer(String oidcIDTokenIssuer, String oauth2TokenEPU\n         assertEquals(OAuth2Util.getIDTokenIssuer(), issuer);\n     }\n \n+    @DataProvider(name = \"IDTokenIssuerData2\")\n+    public Object[][] idTokenIssuerData2() {\n+\n+        return new Object[][]{\n+                // tenant-qualified URL support\n+                // OIDC Config url\n+                // tenant domain\n+                // expected\n+                {false, \"https://localhost:9443/testIssuer\", \"wso2.com\", \"https://localhost:9443/testIssuer\"},\n+                {false, \"https://localhost:9443/testIssuer\", \"\", \"https://localhost:9443/testIssuer\"},\n+                {true, \"https://localhost:9443/testIssuer\", \"\", \"https://localhost:9443/oauth2/token\"},\n+                {true, \"https://localhost:9443/testIssuer\", \"wso2.com\", \"https://localhost:9443/t/wso2\" +\n+                        \".com/oauth2/token\"}\n+", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "dd0031ae4c980be43b1f345b945ee88b16bd542f"}, "originalPosition": 78}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a0d4bcaf5797a7d5dc2d7e1646a138a8f2b745cd", "author": {"user": {"login": "chamathns", "name": "Chamath Samarawickrama"}}, "url": "https://github.com/wso2-extensions/identity-inbound-auth-oauth/commit/a0d4bcaf5797a7d5dc2d7e1646a138a8f2b745cd", "committedDate": "2020-06-19T05:40:58Z", "message": "refactor code"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "d976d51caed5cf0dcd2a9cd7cd6c9a47eefa0f9b", "author": {"user": {"login": "chamathns", "name": "Chamath Samarawickrama"}}, "url": "https://github.com/wso2-extensions/identity-inbound-auth-oauth/commit/d976d51caed5cf0dcd2a9cd7cd6c9a47eefa0f9b", "committedDate": "2020-06-19T05:28:00Z", "message": "refactor code"}, "afterCommit": {"oid": "a0d4bcaf5797a7d5dc2d7e1646a138a8f2b745cd", "author": {"user": {"login": "chamathns", "name": "Chamath Samarawickrama"}}, "url": "https://github.com/wso2-extensions/identity-inbound-auth-oauth/commit/a0d4bcaf5797a7d5dc2d7e1646a138a8f2b745cd", "committedDate": "2020-06-19T05:40:58Z", "message": "refactor code"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDMzODQwNDIw", "url": "https://github.com/wso2-extensions/identity-inbound-auth-oauth/pull/1366#pullrequestreview-433840420", "createdAt": "2020-06-19T06:49:00Z", "commit": {"oid": "a0d4bcaf5797a7d5dc2d7e1646a138a8f2b745cd"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3264, "cost": 1, "resetAt": "2021-11-02T10:47:05Z"}}}