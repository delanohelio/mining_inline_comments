{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDY2MDE2NTU4", "number": 1423, "reviewThreads": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yMFQwMzoyOTo0MlrOEaSgBQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yMFQwMzozMTozOVrOEaShmA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjk2MDAxNTQxOnYy", "diffSide": "RIGHT", "path": "components/org.wso2.carbon.identity.oauth/src/main/java/org/wso2/carbon/identity/oauth2/util/OAuth2Util.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yMFQwMzoyOTo0MlrOHDoMZw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yMFQwMzoyOTo0MlrOHDoMZw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MzU2NjMxMQ==", "bodyText": "This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters. Learn more about bidirectional Unicode characters\n\n\n  \n\n\n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                 * Method to obtain KeyID value for the JWT header.\n          \n          \n            \n                 * Method to obtain 'kid' value for the signing key to be included the JWT header.", "url": "https://github.com/wso2-extensions/identity-inbound-auth-oauth/pull/1423#discussion_r473566311", "createdAt": "2020-08-20T03:29:42Z", "author": {"login": "mefarazath"}, "path": "components/org.wso2.carbon.identity.oauth/src/main/java/org/wso2/carbon/identity/oauth2/util/OAuth2Util.java", "diffHunk": "@@ -2456,6 +2453,19 @@ public static String getKID(String certThumbprint, JWSAlgorithm signatureAlgorit\n         return certThumbprint + \"_\" + signatureAlgorithm.toString();\n     }\n \n+    /**\n+     * Method to obtain KeyID value for the JWT header.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c6a3abcb8c224352eccee7212ed814954c88b740"}, "originalPosition": 37}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjk2MDAxOTQ0OnYy", "diffSide": "RIGHT", "path": "components/org.wso2.carbon.identity.oauth/src/main/java/org/wso2/carbon/identity/oauth2/util/OAuth2Util.java", "isResolved": false, "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yMFQwMzozMTozOVrOHDoOeA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yMFQwNDoxNTowNVrOHDo6ig==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MzU2Njg0MA==", "bodyText": "Is passing the Keystore reference useful here in the exception message?", "url": "https://github.com/wso2-extensions/identity-inbound-auth-oauth/pull/1423#discussion_r473566840", "createdAt": "2020-08-20T03:31:39Z", "author": {"login": "mefarazath"}, "path": "components/org.wso2.carbon.identity.oauth/src/main/java/org/wso2/carbon/identity/oauth2/util/OAuth2Util.java", "diffHunk": "@@ -2540,10 +2571,28 @@ private static Certificate getCertificate(String tenantDomain, int tenantId) thr\n                 // derive key store name\n                 String ksName = tenantDomain.trim().replace(\".\", \"-\");\n                 String jksName = ksName + \".jks\";\n-                keyStore = tenantKSM.getKeyStore(jksName);\n-                publicCert = keyStore.getCertificate(tenantDomain);\n+                if (log.isDebugEnabled()) {\n+                    log.debug(String.format(\"Loading default tenant certificate for tenant : %s from the KeyStore\" +\n+                            \" %s\", tenantDomain, ksName));\n+                }\n+                try {\n+                    keyStore = tenantKSM.getKeyStore(jksName);\n+                    publicCert = keyStore.getCertificate(tenantDomain);\n+                } catch (KeyStoreException e) {\n+                    throw new IdentityOAuth2Exception(\"Error occurred while loading public certificate for tenant: \" +\n+                            tenantDomain, e);\n+                } catch (Exception e) {\n+                    throw new IdentityOAuth2Exception(\"Error occurred while loading Keystore: \" + keyStore + \" for \" +", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c6a3abcb8c224352eccee7212ed814954c88b740"}, "originalPosition": 150}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MzU3NjI3Mg==", "bodyText": "Since the method is about getting the certificate from the tenant domain, the Keystore reference calculated using that value does not seems useful. Therefore I will remove it.", "url": "https://github.com/wso2-extensions/identity-inbound-auth-oauth/pull/1423#discussion_r473576272", "createdAt": "2020-08-20T04:08:29Z", "author": {"login": "dimuthnc"}, "path": "components/org.wso2.carbon.identity.oauth/src/main/java/org/wso2/carbon/identity/oauth2/util/OAuth2Util.java", "diffHunk": "@@ -2540,10 +2571,28 @@ private static Certificate getCertificate(String tenantDomain, int tenantId) thr\n                 // derive key store name\n                 String ksName = tenantDomain.trim().replace(\".\", \"-\");\n                 String jksName = ksName + \".jks\";\n-                keyStore = tenantKSM.getKeyStore(jksName);\n-                publicCert = keyStore.getCertificate(tenantDomain);\n+                if (log.isDebugEnabled()) {\n+                    log.debug(String.format(\"Loading default tenant certificate for tenant : %s from the KeyStore\" +\n+                            \" %s\", tenantDomain, ksName));\n+                }\n+                try {\n+                    keyStore = tenantKSM.getKeyStore(jksName);\n+                    publicCert = keyStore.getCertificate(tenantDomain);\n+                } catch (KeyStoreException e) {\n+                    throw new IdentityOAuth2Exception(\"Error occurred while loading public certificate for tenant: \" +\n+                            tenantDomain, e);\n+                } catch (Exception e) {\n+                    throw new IdentityOAuth2Exception(\"Error occurred while loading Keystore: \" + keyStore + \" for \" +", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MzU2Njg0MA=="}, "originalCommit": {"oid": "c6a3abcb8c224352eccee7212ed814954c88b740"}, "originalPosition": 150}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MzU3ODEyMg==", "bodyText": "fixed", "url": "https://github.com/wso2-extensions/identity-inbound-auth-oauth/pull/1423#discussion_r473578122", "createdAt": "2020-08-20T04:15:05Z", "author": {"login": "dimuthnc"}, "path": "components/org.wso2.carbon.identity.oauth/src/main/java/org/wso2/carbon/identity/oauth2/util/OAuth2Util.java", "diffHunk": "@@ -2540,10 +2571,28 @@ private static Certificate getCertificate(String tenantDomain, int tenantId) thr\n                 // derive key store name\n                 String ksName = tenantDomain.trim().replace(\".\", \"-\");\n                 String jksName = ksName + \".jks\";\n-                keyStore = tenantKSM.getKeyStore(jksName);\n-                publicCert = keyStore.getCertificate(tenantDomain);\n+                if (log.isDebugEnabled()) {\n+                    log.debug(String.format(\"Loading default tenant certificate for tenant : %s from the KeyStore\" +\n+                            \" %s\", tenantDomain, ksName));\n+                }\n+                try {\n+                    keyStore = tenantKSM.getKeyStore(jksName);\n+                    publicCert = keyStore.getCertificate(tenantDomain);\n+                } catch (KeyStoreException e) {\n+                    throw new IdentityOAuth2Exception(\"Error occurred while loading public certificate for tenant: \" +\n+                            tenantDomain, e);\n+                } catch (Exception e) {\n+                    throw new IdentityOAuth2Exception(\"Error occurred while loading Keystore: \" + keyStore + \" for \" +", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MzU2Njg0MA=="}, "originalCommit": {"oid": "c6a3abcb8c224352eccee7212ed814954c88b740"}, "originalPosition": 150}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3585, "cost": 1, "resetAt": "2021-11-13T14:23:39Z"}}}