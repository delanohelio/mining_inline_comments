{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0Mzc4MTQ1NjY2", "number": 1329, "reviewThreads": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yMVQwODoxNToyMFrODhy9Tw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yMVQwODoyMjo1N1rODhzESA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjM2NzY0NDk1OnYy", "diffSide": "RIGHT", "path": "components/org.wso2.carbon.identity.oauth.scope.endpoint/src/main/java/org/wso2/carbon/identity/oauth/scope/endpoint/impl/ScopesApiServiceImpl.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yMVQwODoxNToyMFrOFsuuhA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yMVQwODoyNTo0NFrOFsu9rw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MjQ0NzIzNg==", "bodyText": "will it be possible to rename this variable as location?", "url": "https://github.com/wso2-extensions/identity-inbound-auth-oauth/pull/1329#discussion_r382447236", "createdAt": "2020-02-21T08:15:20Z", "author": {"login": "Buddhimah"}, "path": "components/org.wso2.carbon.identity.oauth.scope.endpoint/src/main/java/org/wso2/carbon/identity/oauth/scope/endpoint/impl/ScopesApiServiceImpl.java", "diffHunk": "@@ -233,4 +246,48 @@ public Response deleteScope(String name) {\n         }\n         return Response.status(Response.Status.OK).build();\n     }\n+\n+    /**\n+     * Build the complete URI to the location of the resource.\n+     * Ex: https://localhost:9443/t/<tenant-domain>/identity/oauth2/v1.0/scopes/name/<scope_name>\n+     *\n+     * @param name of the scope.\n+     * @return Fully qualified and complete URI.\n+     */\n+    private static URI buildURIForHeader(String name) {\n+\n+        String tenantQualifiedRelativePath =\n+                String.format(TENANT_CONTEXT_PATH_COMPONENT, getTenantDomainFromContext()) + SERVER_API_PATH_COMPONENT;\n+        String url = IdentityUtil.getEndpointURIPath(tenantQualifiedRelativePath + name, false, true);\n+\n+        URI loc = URI.create(url);\n+        if (!loc.isAbsolute()) {\n+            Message currentMessage = PhaseInterceptorChain.getCurrentMessage();\n+            if (currentMessage != null) {\n+                UriInfo ui = new UriInfoImpl(currentMessage.getExchange().getInMessage(), null);\n+                try {\n+                    return new URI(ui.getBaseUri().getScheme(), ui.getBaseUri().getAuthority(), url, null, null);\n+                } catch (URISyntaxException e) {\n+                    LOG.error(\"Server encountered an error while building the location URL with scheme: \" +\n+                            ui.getBaseUri().getScheme() + \", authority: \" + ui.getBaseUri().getAuthority() +\n+                            \", url: \" + url, e);\n+                }\n+            }\n+        }\n+        return loc;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "8045a618b34a4590bdadb22fc233b0663bd126e0"}, "originalPosition": 71}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MjQ1MTExOQ==", "bodyText": "Renamed", "url": "https://github.com/wso2-extensions/identity-inbound-auth-oauth/pull/1329#discussion_r382451119", "createdAt": "2020-02-21T08:25:44Z", "author": {"login": "DinikaSen"}, "path": "components/org.wso2.carbon.identity.oauth.scope.endpoint/src/main/java/org/wso2/carbon/identity/oauth/scope/endpoint/impl/ScopesApiServiceImpl.java", "diffHunk": "@@ -233,4 +246,48 @@ public Response deleteScope(String name) {\n         }\n         return Response.status(Response.Status.OK).build();\n     }\n+\n+    /**\n+     * Build the complete URI to the location of the resource.\n+     * Ex: https://localhost:9443/t/<tenant-domain>/identity/oauth2/v1.0/scopes/name/<scope_name>\n+     *\n+     * @param name of the scope.\n+     * @return Fully qualified and complete URI.\n+     */\n+    private static URI buildURIForHeader(String name) {\n+\n+        String tenantQualifiedRelativePath =\n+                String.format(TENANT_CONTEXT_PATH_COMPONENT, getTenantDomainFromContext()) + SERVER_API_PATH_COMPONENT;\n+        String url = IdentityUtil.getEndpointURIPath(tenantQualifiedRelativePath + name, false, true);\n+\n+        URI loc = URI.create(url);\n+        if (!loc.isAbsolute()) {\n+            Message currentMessage = PhaseInterceptorChain.getCurrentMessage();\n+            if (currentMessage != null) {\n+                UriInfo ui = new UriInfoImpl(currentMessage.getExchange().getInMessage(), null);\n+                try {\n+                    return new URI(ui.getBaseUri().getScheme(), ui.getBaseUri().getAuthority(), url, null, null);\n+                } catch (URISyntaxException e) {\n+                    LOG.error(\"Server encountered an error while building the location URL with scheme: \" +\n+                            ui.getBaseUri().getScheme() + \", authority: \" + ui.getBaseUri().getAuthority() +\n+                            \", url: \" + url, e);\n+                }\n+            }\n+        }\n+        return loc;", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MjQ0NzIzNg=="}, "originalCommit": {"oid": "8045a618b34a4590bdadb22fc233b0663bd126e0"}, "originalPosition": 71}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjM2NzY1MjAzOnYy", "diffSide": "RIGHT", "path": "components/org.wso2.carbon.identity.oauth.scope.endpoint/src/main/java/org/wso2/carbon/identity/oauth/scope/endpoint/impl/ScopesApiServiceImpl.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yMVQwODoxODoxNFrOFsuyzQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yMVQwODoyMToyMVrOFsu3WA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MjQ0ODMzMw==", "bodyText": "if (StringUtils.isNotBlank(IdentityUtil.threadLocalProperties.get().get(TENANT_NAME_FROM_CONTEXT))) {\n        return (String) IdentityUtil.threadLocalProperties.get().get(TENANT_NAME_FROM_CONTEXT);\n    }\n    return MultitenantConstants.SUPER_TENANT_DOMAIN_NAME;", "url": "https://github.com/wso2-extensions/identity-inbound-auth-oauth/pull/1329#discussion_r382448333", "createdAt": "2020-02-21T08:18:14Z", "author": {"login": "Buddhimah"}, "path": "components/org.wso2.carbon.identity.oauth.scope.endpoint/src/main/java/org/wso2/carbon/identity/oauth/scope/endpoint/impl/ScopesApiServiceImpl.java", "diffHunk": "@@ -233,4 +246,48 @@ public Response deleteScope(String name) {\n         }\n         return Response.status(Response.Status.OK).build();\n     }\n+\n+    /**\n+     * Build the complete URI to the location of the resource.\n+     * Ex: https://localhost:9443/t/<tenant-domain>/identity/oauth2/v1.0/scopes/name/<scope_name>\n+     *\n+     * @param name of the scope.\n+     * @return Fully qualified and complete URI.\n+     */\n+    private static URI buildURIForHeader(String name) {\n+\n+        String tenantQualifiedRelativePath =\n+                String.format(TENANT_CONTEXT_PATH_COMPONENT, getTenantDomainFromContext()) + SERVER_API_PATH_COMPONENT;\n+        String url = IdentityUtil.getEndpointURIPath(tenantQualifiedRelativePath + name, false, true);\n+\n+        URI loc = URI.create(url);\n+        if (!loc.isAbsolute()) {\n+            Message currentMessage = PhaseInterceptorChain.getCurrentMessage();\n+            if (currentMessage != null) {\n+                UriInfo ui = new UriInfoImpl(currentMessage.getExchange().getInMessage(), null);\n+                try {\n+                    return new URI(ui.getBaseUri().getScheme(), ui.getBaseUri().getAuthority(), url, null, null);\n+                } catch (URISyntaxException e) {\n+                    LOG.error(\"Server encountered an error while building the location URL with scheme: \" +\n+                            ui.getBaseUri().getScheme() + \", authority: \" + ui.getBaseUri().getAuthority() +\n+                            \", url: \" + url, e);\n+                }\n+            }\n+        }\n+        return loc;\n+    }\n+\n+    /**\n+     * Retrieves loaded tenant domain from carbon context.\n+     *\n+     * @return tenant domain of the request being served.\n+     */\n+    private static String getTenantDomainFromContext() {\n+\n+        String tenantDomain = MultitenantConstants.SUPER_TENANT_DOMAIN_NAME;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "8045a618b34a4590bdadb22fc233b0663bd126e0"}, "originalPosition": 81}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MjQ0OTQ5Ng==", "bodyText": "I think this is okay since it avoids multiple returns in the method.", "url": "https://github.com/wso2-extensions/identity-inbound-auth-oauth/pull/1329#discussion_r382449496", "createdAt": "2020-02-21T08:21:21Z", "author": {"login": "madurangasiriwardena"}, "path": "components/org.wso2.carbon.identity.oauth.scope.endpoint/src/main/java/org/wso2/carbon/identity/oauth/scope/endpoint/impl/ScopesApiServiceImpl.java", "diffHunk": "@@ -233,4 +246,48 @@ public Response deleteScope(String name) {\n         }\n         return Response.status(Response.Status.OK).build();\n     }\n+\n+    /**\n+     * Build the complete URI to the location of the resource.\n+     * Ex: https://localhost:9443/t/<tenant-domain>/identity/oauth2/v1.0/scopes/name/<scope_name>\n+     *\n+     * @param name of the scope.\n+     * @return Fully qualified and complete URI.\n+     */\n+    private static URI buildURIForHeader(String name) {\n+\n+        String tenantQualifiedRelativePath =\n+                String.format(TENANT_CONTEXT_PATH_COMPONENT, getTenantDomainFromContext()) + SERVER_API_PATH_COMPONENT;\n+        String url = IdentityUtil.getEndpointURIPath(tenantQualifiedRelativePath + name, false, true);\n+\n+        URI loc = URI.create(url);\n+        if (!loc.isAbsolute()) {\n+            Message currentMessage = PhaseInterceptorChain.getCurrentMessage();\n+            if (currentMessage != null) {\n+                UriInfo ui = new UriInfoImpl(currentMessage.getExchange().getInMessage(), null);\n+                try {\n+                    return new URI(ui.getBaseUri().getScheme(), ui.getBaseUri().getAuthority(), url, null, null);\n+                } catch (URISyntaxException e) {\n+                    LOG.error(\"Server encountered an error while building the location URL with scheme: \" +\n+                            ui.getBaseUri().getScheme() + \", authority: \" + ui.getBaseUri().getAuthority() +\n+                            \", url: \" + url, e);\n+                }\n+            }\n+        }\n+        return loc;\n+    }\n+\n+    /**\n+     * Retrieves loaded tenant domain from carbon context.\n+     *\n+     * @return tenant domain of the request being served.\n+     */\n+    private static String getTenantDomainFromContext() {\n+\n+        String tenantDomain = MultitenantConstants.SUPER_TENANT_DOMAIN_NAME;", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MjQ0ODMzMw=="}, "originalCommit": {"oid": "8045a618b34a4590bdadb22fc233b0663bd126e0"}, "originalPosition": 81}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjM2NzY2MjgwOnYy", "diffSide": "RIGHT", "path": "components/org.wso2.carbon.identity.oauth.scope.endpoint/src/main/java/org/wso2/carbon/identity/oauth/scope/endpoint/impl/ScopesApiServiceImpl.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yMVQwODoyMjo1N1rOFsu5fg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yMVQwODozMzowOFrOFsvINQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MjQ1MDA0Ng==", "bodyText": "Can we change the parameter name to something like scopeName", "url": "https://github.com/wso2-extensions/identity-inbound-auth-oauth/pull/1329#discussion_r382450046", "createdAt": "2020-02-21T08:22:57Z", "author": {"login": "Buddhimah"}, "path": "components/org.wso2.carbon.identity.oauth.scope.endpoint/src/main/java/org/wso2/carbon/identity/oauth/scope/endpoint/impl/ScopesApiServiceImpl.java", "diffHunk": "@@ -233,4 +246,48 @@ public Response deleteScope(String name) {\n         }\n         return Response.status(Response.Status.OK).build();\n     }\n+\n+    /**\n+     * Build the complete URI to the location of the resource.\n+     * Ex: https://localhost:9443/t/<tenant-domain>/identity/oauth2/v1.0/scopes/name/<scope_name>\n+     *\n+     * @param name of the scope.\n+     * @return Fully qualified and complete URI.\n+     */\n+    private static URI buildURIForHeader(String name) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "8045a618b34a4590bdadb22fc233b0663bd126e0"}, "originalPosition": 51}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MjQ1MzgxMw==", "bodyText": "Changed 'name' to 'scopeName'", "url": "https://github.com/wso2-extensions/identity-inbound-auth-oauth/pull/1329#discussion_r382453813", "createdAt": "2020-02-21T08:33:08Z", "author": {"login": "DinikaSen"}, "path": "components/org.wso2.carbon.identity.oauth.scope.endpoint/src/main/java/org/wso2/carbon/identity/oauth/scope/endpoint/impl/ScopesApiServiceImpl.java", "diffHunk": "@@ -233,4 +246,48 @@ public Response deleteScope(String name) {\n         }\n         return Response.status(Response.Status.OK).build();\n     }\n+\n+    /**\n+     * Build the complete URI to the location of the resource.\n+     * Ex: https://localhost:9443/t/<tenant-domain>/identity/oauth2/v1.0/scopes/name/<scope_name>\n+     *\n+     * @param name of the scope.\n+     * @return Fully qualified and complete URI.\n+     */\n+    private static URI buildURIForHeader(String name) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MjQ1MDA0Ng=="}, "originalCommit": {"oid": "8045a618b34a4590bdadb22fc233b0663bd126e0"}, "originalPosition": 51}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3645, "cost": 1, "resetAt": "2021-11-13T14:23:39Z"}}}