{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTI2NTc1ODk5", "number": 331, "title": "[#321] kpis initialized early with landscape", "bodyText": "", "createdAt": "2020-11-24T15:42:39Z", "url": "https://github.com/dedica-team/nivio/pull/331", "merged": true, "mergeCommit": {"oid": "86fb684752e6ae4fb5251f8bf2320aca4b60c4b3"}, "closed": true, "closedAt": "2020-11-27T06:55:35Z", "author": {"login": "bonndan"}, "timelineItems": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdfrrXFAH2gAyNTI2NTc1ODk5OmQ2MTEyMDY1MzM5ZGE5OWYyMmQ5YjA0MzI3NjBmYmY4YjljNzFhYTY=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdgh5vkgH2gAyNTI2NTc1ODk5OmExOWM0OTYwM2E2NzAzMTM5YjBhZjc3MGM0NjExMTViNjY3ZWVhNGY=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "d6112065339da99f22d9b0432760fbf8b9c71aa6", "author": {"user": null}, "url": "https://github.com/dedica-team/nivio/commit/d6112065339da99f22d9b0432760fbf8b9c71aa6", "committedDate": "2020-11-24T15:42:10Z", "message": "[#321] kpis initialized early with landscape"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTM4NTEzODg0", "url": "https://github.com/dedica-team/nivio/pull/331#pullrequestreview-538513884", "createdAt": "2020-11-25T13:53:02Z", "commit": {"oid": "d6112065339da99f22d9b0432760fbf8b9c71aa6"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0yNVQxMzo1MzowM1rOH50YjQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0yNVQxMzo1MzowM1rOH50YjQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMDM4OTEzMw==", "bodyText": "This looks a bit strange at the first sight. I checked more deeply and realized that applyKPIs() is a default method in the Asseable interface that recursively calls itself.\nI would have suggested to make applyKPIs() in Landscape use the KPIs already known to the Landscape. I did not see any usage of landscape.applyKPIs(Map<String, KPI> kpis) where we would provide the KPIs from the outside.", "url": "https://github.com/dedica-team/nivio/pull/331#discussion_r530389133", "createdAt": "2020-11-25T13:53:03Z", "author": {"login": "mfbieber"}, "path": "src/main/java/de/bonndan/nivio/assessment/AssessmentController.java", "diffHunk": "@@ -31,9 +28,7 @@ public AssessmentController(LandscapeRepository landscapeRepository, KPIFactory\n             return ResponseEntity.notFound().build();\n         }\n \n-        Assessment assessment = new Assessment(\n-                landscape.applyKPIs(factory.getConfiguredKPIs(landscape))\n-        );\n+        Assessment assessment = new Assessment(landscape.applyKPIs(landscape.getKpis()));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d6112065339da99f22d9b0432760fbf8b9c71aa6"}, "originalPosition": 27}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTM5NDY0MTU2", "url": "https://github.com/dedica-team/nivio/pull/331#pullrequestreview-539464156", "createdAt": "2020-11-26T16:55:03Z", "commit": {"oid": "d6112065339da99f22d9b0432760fbf8b9c71aa6"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0yNlQxNjo1NTowM1rOH6iqvQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0yNlQxNjo1NTowM1rOH6iqvQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMTE0NzQ1Mw==", "bodyText": "Objects.requireNonNull() does not check if the map is empty, only if an object == null.", "url": "https://github.com/dedica-team/nivio/pull/331#discussion_r531147453", "createdAt": "2020-11-26T16:55:03Z", "author": {"login": "mfbieber"}, "path": "src/main/java/de/bonndan/nivio/assessment/kpi/KPIFactory.java", "diffHunk": "@@ -32,16 +29,18 @@ public KPIFactory(ApplicationEventPublisher eventPublisher) {\n     /**\n      * Returns the default KPIs plus custom ones and configuration.\n      *\n-     * @param landscape the landscape\n+     * @param kpiConfigMap the landscape kpi configurations\n      * @return effective KPIs\n+     * @throws ProcessingException if a KPI is misconfigured\n      */\n-    public Map<String, KPI> getConfiguredKPIs(Landscape landscape) {\n+    public Map<String, KPI> getConfiguredKPIs(@NonNull Map<String, KPIConfig> kpiConfigMap) {\n \n-        Map<String, KPIConfig> config = landscape.getConfig().getKPIs();\n-        Map<String, KPI> kpis = new HashMap<>(defaultKPIs.size() + config.size());\n+        Objects.requireNonNull(kpiConfigMap, \"kpi config is null or empty\");", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d6112065339da99f22d9b0432760fbf8b9c71aa6"}, "originalPosition": 46}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a19c49603a6703139b0af770c461115b667eea4f", "author": {"user": null}, "url": "https://github.com/dedica-team/nivio/commit/a19c49603a6703139b0af770c461115b667eea4f", "committedDate": "2020-11-27T06:52:45Z", "message": "[#321] renamed method, added comments"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1913, "cost": 1, "resetAt": "2021-11-01T13:51:04Z"}}}