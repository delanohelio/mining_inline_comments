{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTMzODM3NTE0", "number": 336, "title": "External data from links, interal refactoring", "bodyText": "External data can be loaded using links. Currently it reads GitHub projects and Spring Boot health checks. A LOT can be done here, but I think this is better handled in separate issues.\nThis escalated quickly. I've refactored and cleaned up some stuff in the Indexer, now there are Resolvers which work on the incoming data, and Processors which modify the landscape.", "createdAt": "2020-12-07T17:40:31Z", "url": "https://github.com/dedica-team/nivio/pull/336", "merged": true, "mergeCommit": {"oid": "75e764ced9090f5058824d55b1cbf41c80fb11fe"}, "closed": true, "closedAt": "2020-12-21T12:54:50Z", "author": {"login": "bonndan"}, "timelineItems": {"totalCount": 40, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABc1zZRlAH2gAyNTMzODM3NTE0OjNiYmM3ZTkzYTJiM2YzMjM5ZTgzMmRkZDgwZDFkNDYyZjA5Zjk5MmY=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdoFrQrgH2gAyNTMzODM3NTE0OjkyMmVmOTVmMDk4NzI3N2JhNWNkM2NlYTJmOTc4OWU0NWVlYzQ1ODA=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "3bbc7e93a2b3f3239e832ddd80d1d462f09f992f", "author": {"user": {"login": "bonndan", "name": "Daniel Pozzi"}}, "url": "https://github.com/dedica-team/nivio/commit/3bbc7e93a2b3f3239e832ddd80d1d462f09f992f", "committedDate": "2020-07-17T12:56:50Z", "message": "[#97] draft how link resolving could work"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "6d0153d3ac423a64efb1ffb00fb2de8b9b24d878", "author": {"user": {"login": "bonndan", "name": "Daniel Pozzi"}}, "url": "https://github.com/dedica-team/nivio/commit/6d0153d3ac423a64efb1ffb00fb2de8b9b24d878", "committedDate": "2020-12-06T17:32:34Z", "message": "[#97] draft how link resolving could work"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "4d25340619ae78f2900bb4ef183a963f2a13584f", "author": {"user": null}, "url": "https://github.com/dedica-team/nivio/commit/4d25340619ae78f2900bb4ef183a963f2a13584f", "committedDate": "2020-12-06T21:21:57Z", "message": "[#97] link handler work in progress"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "4796d53f68b055afd071bf73c287a0457ce8e7cc", "author": {"user": null}, "url": "https://github.com/dedica-team/nivio/commit/4796d53f68b055afd071bf73c287a0457ce8e7cc", "committedDate": "2020-12-06T21:23:43Z", "message": "Merge remote-tracking branch 'origin/97_link_resolver' into 97_link_resolver\n\n# Conflicts:\n#\tsrc/main/java/de/bonndan/nivio/input/Indexer.java\n#\tsrc/main/java/de/bonndan/nivio/input/LinksResolver.java\n#\tsrc/test/java/de/bonndan/nivio/input/IndexerIntegrationTest.java\n#\tsrc/test/java/de/bonndan/nivio/output/jgraphx/JGraphXRendererTest.java"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "171b79832a40ab1c9603ae313a66bf2f8cd13cc5", "author": {"user": null}, "url": "https://github.com/dedica-team/nivio/commit/171b79832a40ab1c9603ae313a66bf2f8cd13cc5", "committedDate": "2020-12-07T17:28:23Z", "message": "[#97] github repo link handler"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "3b024961832ed3876b093a4297a9ff63e08cb53e", "author": {"user": null}, "url": "https://github.com/dedica-team/nivio/commit/3b024961832ed3876b093a4297a9ff63e08cb53e", "committedDate": "2020-12-07T17:33:58Z", "message": "[#97] inout landscape has repo link"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "fd2bf50a610015b92157bcb2aed79de7ebe40cbc", "author": {"user": null}, "url": "https://github.com/dedica-team/nivio/commit/fd2bf50a610015b92157bcb2aed79de7ebe40cbc", "committedDate": "2020-12-07T19:52:33Z", "message": "[#97] sonar wip"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "1347bf4406191901c17aac953093c8fb3cf4c8f8", "author": {"user": null}, "url": "https://github.com/dedica-team/nivio/commit/1347bf4406191901c17aac953093c8fb3cf4c8f8", "committedDate": "2020-12-07T19:55:24Z", "message": "[#97] sonar wip"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "8c84be709db4856b645a539a69b47b3cbf131910", "author": {"user": null}, "url": "https://github.com/dedica-team/nivio/commit/8c84be709db4856b645a539a69b47b3cbf131910", "committedDate": "2020-12-07T20:01:39Z", "message": "[#97] sonar wip"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTQ2NDkyNTIz", "url": "https://github.com/dedica-team/nivio/pull/336#pullrequestreview-546492523", "createdAt": "2020-12-07T20:03:35Z", "commit": {"oid": "8c84be709db4856b645a539a69b47b3cbf131910"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0wN1QyMDowMzozNVrOIA4Xpw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0wN1QyMDowMzozNVrOIA4Xpw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNzc5NDQ3MQ==", "bodyText": "@sl0815 still no time to work on this? The GitHub connection is already working. Loading Sonarqube stuff is just a matter of knowing their API.", "url": "https://github.com/dedica-team/nivio/pull/336#discussion_r537794471", "createdAt": "2020-12-07T20:03:35Z", "author": {"login": "bonndan"}, "path": "src/main/java/de/bonndan/nivio/input/linked/SonarLinkHandler.java", "diffHunk": "@@ -0,0 +1,41 @@\n+package de.bonndan.nivio.input.linked;\n+\n+import de.bonndan.nivio.model.Labeled;\n+import de.bonndan.nivio.model.Link;\n+import org.slf4j.Logger;\n+import org.slf4j.LoggerFactory;\n+import org.sonar.wsclient.SonarClient;\n+\n+import java.util.Optional;\n+import java.util.concurrent.CompletableFuture;\n+\n+public class SonarLinkHandler implements ExternalLinkHandler {\n+\n+    private final Logger LOGGER = LoggerFactory.getLogger(SonarLinkHandler.class);\n+\n+    private final Optional<SonarClient> sonarClient;\n+    private final String sonarApiEndpoint;\n+\n+    public SonarLinkHandler(Optional<SonarClient> sonarClient,String sonarApiEndpoint) {\n+        this.sonarClient = sonarClient;\n+\n+        this.sonarApiEndpoint = sonarApiEndpoint;\n+    }\n+\n+    /**\n+     * https://medium.com/@shanchathusanda/https-medium-com-shanchathusanda-integrating-sonarqube-apis-with-a-java-application-de8fdc8b951f\n+     * @param link\n+     * @param component\n+     * @return\n+     */\n+    @Override\n+    public CompletableFuture<String> resolveAndApplyData(Link link, Labeled component) {\n+        if (sonarClient.isEmpty()) {\n+            return CompletableFuture.completedFuture(\"SonarClient is not configured\");\n+        }\n+\n+        SonarClient sonarClient = this.sonarClient.get();\n+        // TODO", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "8c84be709db4856b645a539a69b47b3cbf131910"}, "originalPosition": 38}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "187b77bd61650b28e820c5e46b9dd8ffce0bb0df", "author": {"user": null}, "url": "https://github.com/dedica-team/nivio/commit/187b77bd61650b28e820c5e46b9dd8ffce0bb0df", "committedDate": "2020-12-14T11:07:18Z", "message": "[#97] external links resolved earlier, now contribute to input DTOs"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b38b2e95b3656bc493bc0f49c71288c435649c06", "author": {"user": null}, "url": "https://github.com/dedica-team/nivio/commit/b38b2e95b3656bc493bc0f49c71288c435649c06", "committedDate": "2020-12-14T11:30:08Z", "message": "[#97] extended test"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "dd6a506b0963d8980e32cad7a9a01b950432b785", "author": {"user": null}, "url": "https://github.com/dedica-team/nivio/commit/dd6a506b0963d8980e32cad7a9a01b950432b785", "committedDate": "2020-12-14T11:32:22Z", "message": "[#97] extended test"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "6628f98a4389656daf508cff8c3efbdb5cc4b8e8", "author": {"user": null}, "url": "https://github.com/dedica-team/nivio/commit/6628f98a4389656daf508cff8c3efbdb5cc4b8e8", "committedDate": "2020-12-15T07:03:50Z", "message": "[#97] extended GitHubRepoHandler"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "6f9e2948998fbe3d6424a3d41c5dd65cd61d835c", "author": {"user": null}, "url": "https://github.com/dedica-team/nivio/commit/6f9e2948998fbe3d6424a3d41c5dd65cd61d835c", "committedDate": "2020-12-15T07:08:37Z", "message": "[#97] group description fix"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "9607011cdc7bacc6374ef12ee3c50f6ea760fc54", "author": {"user": null}, "url": "https://github.com/dedica-team/nivio/commit/9607011cdc7bacc6374ef12ee3c50f6ea760fc54", "committedDate": "2020-12-15T07:09:00Z", "message": "[#97] LinksResolver fix"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "675766e93c8ce3048b1a37909f5fd462ae9ca9e5", "author": {"user": null}, "url": "https://github.com/dedica-team/nivio/commit/675766e93c8ce3048b1a37909f5fd462ae9ca9e5", "committedDate": "2020-12-15T07:09:31Z", "message": "[#97] added prometheus url"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c5212f4ec9e553e91497a3692b25a5f148f50f8b", "author": {"user": null}, "url": "https://github.com/dedica-team/nivio/commit/c5212f4ec9e553e91497a3692b25a5f148f50f8b", "committedDate": "2020-12-15T09:18:38Z", "message": "[#97] refactored resolving of templates (no more coupling with templates map between resolvers)"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c3a7d0abefbf39c2b87147277a82ed27f995bff5", "author": {"user": null}, "url": "https://github.com/dedica-team/nivio/commit/c3a7d0abefbf39c2b87147277a82ed27f995bff5", "committedDate": "2020-12-15T09:38:05Z", "message": "[#97] refactored indexer: distinction between Processor and Resolver"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTU1OTM0NTUx", "url": "https://github.com/dedica-team/nivio/pull/336#pullrequestreview-555934551", "createdAt": "2020-12-19T11:09:26Z", "commit": {"oid": "c3a7d0abefbf39c2b87147277a82ed27f995bff5"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xOVQxMTowOToyNlrOII6-gA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xOVQxMTowOToyNlrOII6-gA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NjIyNTc5Mg==", "bodyText": "This sould be \"provides\" - it still does, does it?", "url": "https://github.com/dedica-team/nivio/pull/336#discussion_r546225792", "createdAt": "2020-12-19T11:09:26Z", "author": {"login": "mfbieber"}, "path": "docs/source/input.rst", "diffHunk": "@@ -46,4 +46,24 @@ from environment variables. To exclude internal stacks (like those responsible f\n Nivio proprietary format\n ------------------------\n \n-Nivio provided an own format, which allows to set all model properties manually (see Model and Syntax section)\n\\ No newline at end of file\n+Nivio provided an own format, which allows to set all model properties manually (see Model and Syntax section).", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c3a7d0abefbf39c2b87147277a82ed27f995bff5"}, "originalPosition": 6}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTU1OTM0NzAw", "url": "https://github.com/dedica-team/nivio/pull/336#pullrequestreview-555934700", "createdAt": "2020-12-19T11:12:37Z", "commit": {"oid": "c3a7d0abefbf39c2b87147277a82ed27f995bff5"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xOVQxMToxMjozN1rOII6_Vg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xOVQxMToxMjozN1rOII6_Vg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NjIyNjAwNg==", "bodyText": "It must be \"cannot\"", "url": "https://github.com/dedica-team/nivio/pull/336#discussion_r546226006", "createdAt": "2020-12-19T11:12:37Z", "author": {"login": "mfbieber"}, "path": "docs/source/input.rst", "diffHunk": "@@ -46,4 +46,24 @@ from environment variables. To exclude internal stacks (like those responsible f\n Nivio proprietary format\n ------------------------\n \n-Nivio provided an own format, which allows to set all model properties manually (see Model and Syntax section)\n\\ No newline at end of file\n+Nivio provided an own format, which allows to set all model properties manually (see Model and Syntax section).\n+\n+\n+External data\n+-------------\n+\n+Nivio can load external data that can not be used directly to build landscapes, but is still valuable. For example, the\n+number of GitHub issues might be interesting to see on a landscape item that is an open source component. To attach such\n+data to landscape components, use links having special known identifiers like \"github\" or \"sonar\".\n+", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c3a7d0abefbf39c2b87147277a82ed27f995bff5"}, "originalPosition": 15}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTU1OTM1ODQx", "url": "https://github.com/dedica-team/nivio/pull/336#pullrequestreview-555935841", "createdAt": "2020-12-19T11:34:35Z", "commit": {"oid": "c3a7d0abefbf39c2b87147277a82ed27f995bff5"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xOVQxMTozNDozNVrOII7HQQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xOVQxMTozNDozNVrOII7HQQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NjIyODAzMw==", "bodyText": "Is this just a Map merge? If yes, why not use item.getLinks().putAll(increment.getLinks());", "url": "https://github.com/dedica-team/nivio/pull/336#discussion_r546228033", "createdAt": "2020-12-19T11:34:35Z", "author": {"login": "mfbieber"}, "path": "src/main/java/de/bonndan/nivio/input/ComponentDescriptionValues.java", "diffHunk": "@@ -0,0 +1,60 @@\n+package de.bonndan.nivio.input;\n+\n+import de.bonndan.nivio.input.dto.ComponentDescription;\n+import de.bonndan.nivio.input.dto.ItemDescription;\n+import de.bonndan.nivio.model.Labeled;\n+import org.springframework.util.StringUtils;\n+\n+import static de.bonndan.nivio.util.SafeAssign.assignSafe;\n+import static de.bonndan.nivio.util.SafeAssign.assignSafeIfAbsent;\n+\n+public class ComponentDescriptionValues {\n+\n+    /**\n+     * Overwrites labels and links.\n+     *\n+     * @param existing  current description present in the landscape\n+     * @param increment new values\n+     */\n+    public static void assignNotNull(ComponentDescription existing, ComponentDescription increment) {\n+\n+        if (increment.getName() != null)\n+            existing.setName(increment.getName());\n+\n+        if (increment.getDescription() != null)\n+            existing.setDescription(increment.getDescription());\n+\n+        if (increment.getOwner() != null)\n+            existing.setOwner(increment.getOwner());\n+\n+        if (increment.getLabels() != null) {\n+            increment.getLabels().forEach((s, s2) -> {\n+                if (increment.getLabel(s) != null) {\n+                    existing.setLabel(s, s2);\n+                }\n+            });\n+        }\n+\n+        existing.getLinks().putAll(increment.getLinks());\n+\n+    }\n+    /**\n+     * Writes the values of the increment (second object) to the first where first is null/absent.\n+     *\n+     * @param item     target\n+     * @param increment source\n+     */\n+    public static void assignSafeNotNull(ComponentDescription item, ComponentDescription increment) {\n+\n+        assignSafeIfAbsent(increment.getName(), item.getName(), item::setName);\n+        assignSafeIfAbsent(increment.getDescription(), item.getDescription(), item::setDescription);\n+        assignSafeIfAbsent(increment.getOwner(), item.getOwner(), item::setOwner);\n+\n+        Labeled.merge(increment, item);\n+\n+        increment.getLinks().entrySet().stream()\n+                .filter(entry -> !item.getLinks().containsKey(entry.getKey()))\n+                .forEach(entry -> item.getLinks().put(entry.getKey(), entry.getValue()));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c3a7d0abefbf39c2b87147277a82ed27f995bff5"}, "originalPosition": 57}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTU1OTM3OTU2", "url": "https://github.com/dedica-team/nivio/pull/336#pullrequestreview-555937956", "createdAt": "2020-12-19T12:16:57Z", "commit": {"oid": "c3a7d0abefbf39c2b87147277a82ed27f995bff5"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xOVQxMjoxNjo1N1rOII7Wkg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xOVQxMjoxNjo1N1rOII7Wkg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NjIzMTk1NA==", "bodyText": "Shouldn't the method be named resolve()?", "url": "https://github.com/dedica-team/nivio/pull/336#discussion_r546231954", "createdAt": "2020-12-19T12:16:57Z", "author": {"login": "mfbieber"}, "path": "src/main/java/de/bonndan/nivio/input/Indexer.java", "diffHunk": "@@ -87,42 +88,45 @@ private void runResolvers(LandscapeDescription input, Landscape landscape) {\n         KPIFactory kpiFactory = new KPIFactory();\n         landscape.setKpis(kpiFactory.getConfiguredKPIs(input.getConfig().getKPIs()));\n \n-        Map<ItemDescription, List<String>> templatesAndTargets = new HashMap<>();\n         // read all input sources\n-        new SourceReferencesResolver(formatFactory, logger).resolve(input, templatesAndTargets);\n+        new SourceReferencesResolver(formatFactory, logger).resolve(input);\n \n-        // apply template values to the items\n-        new TemplateResolver().processTemplates(input, templatesAndTargets);\n+        // apply template values to items\n+        new TemplateResolver(logger).resolve(input);\n \n-        // read special labels on items and assign the values to fields\n-        new LabelToFieldProcessor(logger).process(input, landscape);\n+        // resolve links on components to gather more data.\n+        new LinksResolver(logger, linkHandlerFactory).process(input);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c3a7d0abefbf39c2b87147277a82ed27f995bff5"}, "originalPosition": 55}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTU1OTM4MjAz", "url": "https://github.com/dedica-team/nivio/pull/336#pullrequestreview-555938203", "createdAt": "2020-12-19T12:21:45Z", "commit": {"oid": "c3a7d0abefbf39c2b87147277a82ed27f995bff5"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xOVQxMjoyMTo0NVrOII7YBg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xOVQxMjoyMTo0NVrOII7YBg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NjIzMjMyNg==", "bodyText": "Since this is all about resolvers and processors. What is the difference between both of them? They both operate on the provided LandscapeDescription input. Is the result a modified input which is later applied to the Landscape?", "url": "https://github.com/dedica-team/nivio/pull/336#discussion_r546232326", "createdAt": "2020-12-19T12:21:45Z", "author": {"login": "mfbieber"}, "path": "src/main/java/de/bonndan/nivio/input/Indexer.java", "diffHunk": "@@ -87,42 +88,45 @@ private void runResolvers(LandscapeDescription input, Landscape landscape) {\n         KPIFactory kpiFactory = new KPIFactory();\n         landscape.setKpis(kpiFactory.getConfiguredKPIs(input.getConfig().getKPIs()));\n \n-        Map<ItemDescription, List<String>> templatesAndTargets = new HashMap<>();\n         // read all input sources\n-        new SourceReferencesResolver(formatFactory, logger).resolve(input, templatesAndTargets);\n+        new SourceReferencesResolver(formatFactory, logger).resolve(input);\n \n-        // apply template values to the items\n-        new TemplateResolver().processTemplates(input, templatesAndTargets);\n+        // apply template values to items\n+        new TemplateResolver(logger).resolve(input);\n \n-        // read special labels on items and assign the values to fields\n-        new LabelToFieldProcessor(logger).process(input, landscape);\n+        // resolve links on components to gather more data.\n+        new LinksResolver(logger, linkHandlerFactory).process(input);\n \n         // mask any label containing secrets\n-        new SecureLabelsProcessor().process(input);\n+        new SecureLabelsResolver(logger).resolve(input);\n \n         // create relation targets on the fly if the landscape is configured \"greedy\"\n-        new InstantItemResolver(logger).processTargets(input);\n+        new InstantItemResolver(logger).resolve(input);\n+\n+        // read special labels on items and assign the values to fields\n+        new LabelToFieldResolver(logger).resolve(input);\n \n         // find items for relation endpoints (which can be queries, identifiers...)\n-        new RelationEndpointResolver(logger).processRelations(input);\n+        // KEEP here (must run late after other resolvers)\n+        new RelationEndpointResolver(logger).resolve(input);\n \n         // add any missing groups\n-        new GroupResolver(logger).process(input, landscape);\n+        new GroupProcessor(logger).process(input, landscape);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c3a7d0abefbf39c2b87147277a82ed27f995bff5"}, "originalPosition": 75}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "55ebdb6dd175e9e0de82e9d0600081ddf2df2b0a", "author": {"user": null}, "url": "https://github.com/dedica-team/nivio/commit/55ebdb6dd175e9e0de82e9d0600081ddf2df2b0a", "committedDate": "2020-12-19T12:24:23Z", "message": "[#97] LinksResolver extends Resolver"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTU1OTM4MzU0", "url": "https://github.com/dedica-team/nivio/pull/336#pullrequestreview-555938354", "createdAt": "2020-12-19T12:24:56Z", "commit": {"oid": "c3a7d0abefbf39c2b87147277a82ed27f995bff5"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xOVQxMjoyNDo1NlrOII7ZFA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xOVQxMjoyNDo1NlrOII7ZFA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NjIzMjU5Ng==", "bodyText": "The contains check is not necessary. Can't this also be simpler like this: item.getInterfaces().addAll(template.getInterfaces());?", "url": "https://github.com/dedica-team/nivio/pull/336#discussion_r546232596", "createdAt": "2020-12-19T12:24:56Z", "author": {"login": "mfbieber"}, "path": "src/main/java/de/bonndan/nivio/input/ItemDescriptionValues.java", "diffHunk": "@@ -13,32 +16,46 @@\n      */\n     public static void assignNotNull(ItemDescription existing, ItemDescription increment) {\n \n-        if (increment.getName() != null)\n-            existing.setName(increment.getName());\n+        ComponentDescriptionValues.assignNotNull(existing, increment);\n+\n         if (increment.getType() != null)\n             existing.setType(increment.getType());\n-        if (increment.getDescription() != null)\n-            existing.setDescription(increment.getDescription());\n         if (increment.getContact() != null)\n             existing.setContact(increment.getContact());\n \n-        if (increment.getOwner() != null)\n-            existing.setOwner(increment.getOwner());\n         if (increment.getGroup() != null)\n             existing.setGroup(increment.getGroup());\n \n-        if (increment.getLabels() != null) {\n-            increment.getLabels().forEach((s, s2) -> {\n-                if (increment.getLabel(s) != null) {\n-                    existing.setLabel(s, s2);\n-                }\n-            });\n-        }\n-\n-        existing.getLinks().putAll(increment.getLinks());\n-\n         assignSafe(increment.getRelations(), (rel) -> rel.forEach(existing::addRelation));\n \n         assignSafe(increment.getInterfaces(), (set) -> set.forEach(intf -> existing.getInterfaces().add(intf)));\n     }\n+\n+    /**\n+     * Writes the values of the template (second object) to the first where first is null.\n+     *\n+     * @param item     target\n+     * @param template source\n+     */\n+    public static void assignSafeNotNull(ItemDescription item, ItemDescription template) {\n+\n+        ComponentDescriptionValues.assignSafeNotNull(item, template);\n+\n+        assignSafeIfAbsent(template.getType(), item.getType(), item::setType);\n+        assignSafeIfAbsent(template.getContact(), item.getContact(), item::setContact);\n+        assignSafeIfAbsent(template.getGroup(), item.getGroup(), item::setGroup);\n+\n+        if (template.getProvidedBy() != null) {\n+            template.getProvidedBy().stream()\n+                    .filter(s -> !StringUtils.isEmpty(s) && !item.getProvidedBy().contains(s))\n+                    .forEach(s -> item.getProvidedBy().add(s));\n+        }\n+\n+        template.getRelations().forEach(item::addRelation);\n+\n+        template.getInterfaces().forEach(interfaceItem -> {\n+            if (!item.getInterfaces().contains(interfaceItem))\n+                item.getInterfaces().add(interfaceItem);\n+        });", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c3a7d0abefbf39c2b87147277a82ed27f995bff5"}, "originalPosition": 74}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "8eef21e7dc674167e3fec9991401bd0b4c14fd11", "author": {"user": null}, "url": "https://github.com/dedica-team/nivio/commit/8eef21e7dc674167e3fec9991401bd0b4c14fd11", "committedDate": "2020-12-19T12:25:05Z", "message": "[#97] fix wording"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTU1OTM4NDkw", "url": "https://github.com/dedica-team/nivio/pull/336#pullrequestreview-555938490", "createdAt": "2020-12-19T12:27:44Z", "commit": {"oid": "c3a7d0abefbf39c2b87147277a82ed27f995bff5"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xOVQxMjoyNzo0NFrOII7aPQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xOVQxMjoyNzo0NFrOII7aPQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NjIzMjg5Mw==", "bodyText": "Why does this not extend Resolver?", "url": "https://github.com/dedica-team/nivio/pull/336#discussion_r546232893", "createdAt": "2020-12-19T12:27:44Z", "author": {"login": "mfbieber"}, "path": "src/main/java/de/bonndan/nivio/input/LinksResolver.java", "diffHunk": "@@ -0,0 +1,81 @@\n+package de.bonndan.nivio.input;\n+\n+import de.bonndan.nivio.ProcessingException;\n+import de.bonndan.nivio.input.dto.ComponentDescription;\n+import de.bonndan.nivio.input.dto.LandscapeDescription;\n+import de.bonndan.nivio.input.external.LinkHandlerFactory;\n+import de.bonndan.nivio.util.SafeAssign;\n+import org.slf4j.Logger;\n+import org.slf4j.LoggerFactory;\n+\n+import java.util.ArrayList;\n+import java.util.List;\n+import java.util.concurrent.CompletableFuture;\n+import java.util.concurrent.ExecutionException;\n+import java.util.concurrent.TimeUnit;\n+import java.util.concurrent.TimeoutException;\n+\n+\n+/**\n+ * Resolves all links of all landscape components.\n+ */\n+public class LinksResolver {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c3a7d0abefbf39c2b87147277a82ed27f995bff5"}, "originalPosition": 22}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d91b670e9fb2cbe672adcf3587e02490852426a7", "author": {"user": null}, "url": "https://github.com/dedica-team/nivio/commit/d91b670e9fb2cbe672adcf3587e02490852426a7", "committedDate": "2020-12-19T12:27:59Z", "message": "[#97] code cleanup"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTU1OTM4NzA4", "url": "https://github.com/dedica-team/nivio/pull/336#pullrequestreview-555938708", "createdAt": "2020-12-19T12:31:37Z", "commit": {"oid": "c3a7d0abefbf39c2b87147277a82ed27f995bff5"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xOVQxMjozMTozN1rOII7bpw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xOVQxMjozMTozN1rOII7bpw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NjIzMzI1NQ==", "bodyText": "Do you use  an abstract class instead of an interface only because of the ProcessLog field?", "url": "https://github.com/dedica-team/nivio/pull/336#discussion_r546233255", "createdAt": "2020-12-19T12:31:37Z", "author": {"login": "mfbieber"}, "path": "src/main/java/de/bonndan/nivio/input/Processor.java", "diffHunk": "@@ -0,0 +1,20 @@\n+package de.bonndan.nivio.input;\n+\n+import de.bonndan.nivio.input.dto.LandscapeDescription;\n+import de.bonndan.nivio.model.Landscape;\n+\n+/**\n+ * Modifies the target landscape using input.\n+ *\n+ *\n+ */\n+abstract class Processor {\n+\n+    protected final ProcessLog processLog;\n+\n+    protected Processor(ProcessLog processLog) {\n+        this.processLog = processLog;\n+    }", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c3a7d0abefbf39c2b87147277a82ed27f995bff5"}, "originalPosition": 17}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTU1OTM4Nzg3", "url": "https://github.com/dedica-team/nivio/pull/336#pullrequestreview-555938787", "createdAt": "2020-12-19T12:33:20Z", "commit": {"oid": "c3a7d0abefbf39c2b87147277a82ed27f995bff5"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xOVQxMjozMzoyMFrOII7cLw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xOVQxMjozMzoyMFrOII7cLw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NjIzMzM5MQ==", "bodyText": "Why is the name set to null?", "url": "https://github.com/dedica-team/nivio/pull/336#discussion_r546233391", "createdAt": "2020-12-19T12:33:20Z", "author": {"login": "mfbieber"}, "path": "src/main/java/de/bonndan/nivio/input/TemplateResolver.java", "diffHunk": "@@ -1,30 +1,44 @@\n package de.bonndan.nivio.input;\n \n+import de.bonndan.nivio.ProcessingException;\n import de.bonndan.nivio.input.dto.ItemDescription;\n import de.bonndan.nivio.input.dto.LandscapeDescription;\n-import de.bonndan.nivio.model.*;\n-import org.springframework.util.StringUtils;\n+import de.bonndan.nivio.util.URLHelper;\n \n-import java.util.*;\n-\n-import static de.bonndan.nivio.util.SafeAssign.assignSafeIfAbsent;\n+import java.net.URL;\n+import java.util.HashMap;\n+import java.util.List;\n+import java.util.Map;\n \n /**\n  * Responsible to apply templates to landscape items.\n  * <p>\n  * Resolves the items the templates are assigned to as well as dynamic endpoints of relation in templates.\n  */\n-public class TemplateResolver {\n+public class TemplateResolver extends Resolver {\n+\n+    protected TemplateResolver(ProcessLog processLog) {\n+        super(processLog);\n+    }\n \n     /**\n      * Applies the template values and relations to all items the template is assigned to.\n      *\n-     * @param landscape           the landscape containing all(!) items. Querying happens on these items.\n-     * @param templatesAndTargets The assignment can be a list of static item identifiers or dynamic queries to match\n-     *                            certain items.\n+     * @param landscape the landscape containing all(!) items. Querying happens on these items.\n      */\n-    public void processTemplates(LandscapeDescription landscape, Map<ItemDescription, List<String>> templatesAndTargets) {\n-        templatesAndTargets.forEach((landscapeItem, identifiers) -> applyTemplateValues(landscapeItem, identifiers, landscape));\n+    @Override\n+    public void resolve(LandscapeDescription landscape) {\n+\n+        Map<ItemDescription, List<String>> templatesAndTargets = new HashMap<>();\n+        landscape.getSourceReferences().forEach(ref -> {\n+            ref.getAssignTemplates().forEach((key, identifiers) -> {\n+                ItemDescription template = landscape.getTemplates().get(key);\n+                template.setName(null);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c3a7d0abefbf39c2b87147277a82ed27f995bff5"}, "originalPosition": 47}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTU1OTM5MjQ2", "url": "https://github.com/dedica-team/nivio/pull/336#pullrequestreview-555939246", "createdAt": "2020-12-19T12:42:13Z", "commit": {"oid": "c3a7d0abefbf39c2b87147277a82ed27f995bff5"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xOVQxMjo0MjoxNFrOII7fWg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xOVQxMjo0MjoxNFrOII7fWg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NjIzNDIwMg==", "bodyText": "Is there any ComponentDescription that will not have a name, description and owner when the object is constructed? We are working towards more inmutability in objects, I would not invite to use the setters through the interface and rather deprecate as much setters as possible ;)", "url": "https://github.com/dedica-team/nivio/pull/336#discussion_r546234202", "createdAt": "2020-12-19T12:42:14Z", "author": {"login": "mfbieber"}, "path": "src/main/java/de/bonndan/nivio/input/dto/ComponentDescription.java", "diffHunk": "@@ -0,0 +1,26 @@\n+package de.bonndan.nivio.input.dto;\n+\n+import de.bonndan.nivio.model.Labeled;\n+import de.bonndan.nivio.model.Linked;\n+\n+/**\n+ * Base interface for input DTOs.\n+ *\n+ *\n+ */\n+public interface ComponentDescription extends Labeled, Linked {\n+\n+    String getIdentifier();\n+\n+    String getName();\n+\n+    void setName(String name);\n+\n+    String getDescription();\n+\n+    void setDescription(String description);\n+\n+    String getOwner();\n+\n+    void setOwner(String owner);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c3a7d0abefbf39c2b87147277a82ed27f995bff5"}, "originalPosition": 25}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTU1OTM5NDk2", "url": "https://github.com/dedica-team/nivio/pull/336#pullrequestreview-555939496", "createdAt": "2020-12-19T12:46:49Z", "commit": {"oid": "c3a7d0abefbf39c2b87147277a82ed27f995bff5"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xOVQxMjo0Njo0OVrOII7hLA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xOVQxMjo0Njo0OVrOII7hLA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NjIzNDY2OA==", "bodyText": "This is cool \ud83d\ude3b\nShouldn't the description though be something like \"Loads the open issues, open pull requests, the readme and the repositories description\"?", "url": "https://github.com/dedica-team/nivio/pull/336#discussion_r546234668", "createdAt": "2020-12-19T12:46:49Z", "author": {"login": "mfbieber"}, "path": "src/main/java/de/bonndan/nivio/input/external/github/GitHubRepoHandler.java", "diffHunk": "@@ -0,0 +1,75 @@\n+package de.bonndan.nivio.input.external.github;\n+\n+import de.bonndan.nivio.input.dto.ComponentDescription;\n+import de.bonndan.nivio.input.dto.ItemDescription;\n+import de.bonndan.nivio.input.external.ExternalLinkHandler;\n+import de.bonndan.nivio.model.Link;\n+import org.kohsuke.github.GHIssueState;\n+import org.kohsuke.github.GHRepository;\n+import org.kohsuke.github.GitHub;\n+import org.kohsuke.github.MarkdownMode;\n+import org.slf4j.Logger;\n+import org.slf4j.LoggerFactory;\n+import org.springframework.lang.NonNull;\n+import org.springframework.util.StringUtils;\n+\n+import java.util.concurrent.CompletableFuture;\n+\n+/**\n+ * https://github-api.kohsuke.org/index.html\n+ */\n+public class GitHubRepoHandler implements ExternalLinkHandler {\n+\n+    private static final Logger LOGGER = LoggerFactory.getLogger(GitHubRepoHandler.class);\n+\n+    public static final String OPEN_ISSUES = \"github.issues.open\";\n+    public static final String OPEN_PRS = \"github.pullrequests.open\";\n+    public static final String README = \"github.readme\";\n+    public static final String DESCRIPTION = \"github.description\";\n+\n+    private final GitHub gitHub;\n+\n+    public GitHubRepoHandler(GitHub gitHub) {\n+        this.gitHub = gitHub;\n+    }\n+\n+    /**\n+     * Loads the open issues from the repo.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c3a7d0abefbf39c2b87147277a82ed27f995bff5"}, "originalPosition": 37}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTU1OTM5Nzg1", "url": "https://github.com/dedica-team/nivio/pull/336#pullrequestreview-555939785", "createdAt": "2020-12-19T12:51:53Z", "commit": {"oid": "c3a7d0abefbf39c2b87147277a82ed27f995bff5"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xOVQxMjo1MTo1M1rOII7i4A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xOVQxMjo1MTo1M1rOII7i4A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NjIzNTEwNA==", "bodyText": "There is no test for this, is there? Also I didn't find one for the JsonCompositeHealth. Why not addind directly a test for this new functionality? The test should be rather simple now.\nI started adding jacoco with #329 and from what I saw, we can really improve on test code coverage!", "url": "https://github.com/dedica-team/nivio/pull/336#discussion_r546235104", "createdAt": "2020-12-19T12:51:53Z", "author": {"login": "mfbieber"}, "path": "src/main/java/de/bonndan/nivio/input/external/springboot/CompositeHealthDeserializer.java", "diffHunk": "@@ -0,0 +1,27 @@\n+package de.bonndan.nivio.input.external.springboot;\n+\n+import com.fasterxml.jackson.core.JsonParser;\n+import com.fasterxml.jackson.core.TreeNode;\n+import com.fasterxml.jackson.databind.DeserializationContext;\n+import com.fasterxml.jackson.databind.JsonDeserializer;\n+import com.fasterxml.jackson.databind.node.TextNode;\n+import org.springframework.boot.jackson.JsonComponent;\n+\n+import java.io.IOException;\n+import java.util.Map;\n+\n+@JsonComponent\n+public class CompositeHealthDeserializer extends JsonDeserializer<JsonCompositeHealth> {\n+\n+    @Override\n+    public JsonCompositeHealth deserialize(JsonParser jsonParser, DeserializationContext deserializationContext) throws IOException {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c3a7d0abefbf39c2b87147277a82ed27f995bff5"}, "originalPosition": 17}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b71e25cd09eb0e8ce2af9c3631292c334147992e", "author": {"user": null}, "url": "https://github.com/dedica-team/nivio/commit/b71e25cd09eb0e8ce2af9c3631292c334147992e", "committedDate": "2020-12-19T12:57:41Z", "message": "[#97] wording fix"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f83a93190bca6977f045772f935d9f0c5ad2e78d", "author": {"user": null}, "url": "https://github.com/dedica-team/nivio/commit/f83a93190bca6977f045772f935d9f0c5ad2e78d", "committedDate": "2020-12-19T12:59:06Z", "message": "[#97] added comment"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "402c5504ee649c32bf27f209db5ff526911144da", "author": {"user": null}, "url": "https://github.com/dedica-team/nivio/commit/402c5504ee649c32bf27f209db5ff526911144da", "committedDate": "2020-12-19T13:17:56Z", "message": "[#97] name,description can be null in ComponentDescription"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "1088c1cdb4af1fa6387bf8f67881868a8ecd8563", "author": {"user": null}, "url": "https://github.com/dedica-team/nivio/commit/1088c1cdb4af1fa6387bf8f67881868a8ecd8563", "committedDate": "2020-12-19T16:15:11Z", "message": "[#97] added docs"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "96838f780853ab88f6bd5dd95f1ffaf181266168", "author": {"user": null}, "url": "https://github.com/dedica-team/nivio/commit/96838f780853ab88f6bd5dd95f1ffaf181266168", "committedDate": "2020-12-20T18:00:33Z", "message": "cleanup"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "922ef95f0987277ba5cd3cea2f9789e45eec4580", "author": {"user": null}, "url": "https://github.com/dedica-team/nivio/commit/922ef95f0987277ba5cd3cea2f9789e45eec4580", "committedDate": "2020-12-20T18:30:59Z", "message": "cleanup"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1919, "cost": 1, "resetAt": "2021-11-01T13:51:04Z"}}}