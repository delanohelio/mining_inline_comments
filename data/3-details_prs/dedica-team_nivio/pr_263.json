{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDgzMTQ3NDEx", "number": 263, "title": "260 duplicate items", "bodyText": "closes #260\nThe problem is that Item.hashCode is dependent on the \"group\" field value, which had been changed after items were added to a Set. Usually Sets only contain unique items, but the item group was changed after having been added to the collection, so the equality to duplicates was not given anymore.\nIn addition, Group.getItems now returns an immutable copy and an addItem method has been added which enforces correct item group field values.\nThis is a step towards #212 , but does not eliminate all mutability.", "createdAt": "2020-09-09T21:27:55Z", "url": "https://github.com/dedica-team/nivio/pull/263", "merged": true, "mergeCommit": {"oid": "543bdd7e8320d926b49c5a4742cfca4e4fd70454"}, "closed": true, "closedAt": "2020-09-10T18:06:14Z", "author": {"login": "bonndan"}, "timelineItems": {"totalCount": 9, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdHS6VngH2gAyNDgzMTQ3NDExOjQ0M2Q2NGE0OTUyNDliYjE0NzdlZjQ4OTQ2OGEyYWU1MjRjODU5Y2M=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdHhD9lAH2gAyNDgzMTQ3NDExOjgwZTFiNmRhYjk4YTBhNzQ2YzRjMThhYjhkOTA0MzBlNjQxMDc0Y2I=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "443d64a495249bb1477ef489468a2ae524c859cc", "author": {"user": null}, "url": "https://github.com/dedica-team/nivio/commit/443d64a495249bb1477ef489468a2ae524c859cc", "committedDate": "2020-09-09T21:16:43Z", "message": "[#260] refactoring towards immutability"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "9b5918ffff8522f16e2643765ff17b14c822f376", "author": {"user": null}, "url": "https://github.com/dedica-team/nivio/commit/9b5918ffff8522f16e2643765ff17b14c822f376", "committedDate": "2020-09-09T21:21:48Z", "message": "[#260] changed log level"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "618b6af9f7521b8424dfecda53663c240510e7e6", "author": {"user": null}, "url": "https://github.com/dedica-team/nivio/commit/618b6af9f7521b8424dfecda53663c240510e7e6", "committedDate": "2020-09-09T21:24:08Z", "message": "[#260] added tests"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDg1ODQyNzY1", "url": "https://github.com/dedica-team/nivio/pull/263#pullrequestreview-485842765", "createdAt": "2020-09-10T11:40:24Z", "commit": {"oid": "618b6af9f7521b8424dfecda53663c240510e7e6"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDg1ODQ3Mjg0", "url": "https://github.com/dedica-team/nivio/pull/263#pullrequestreview-485847284", "createdAt": "2020-09-10T11:47:13Z", "commit": {"oid": "618b6af9f7521b8424dfecda53663c240510e7e6"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDg1ODc2OTk0", "url": "https://github.com/dedica-team/nivio/pull/263#pullrequestreview-485876994", "createdAt": "2020-09-10T12:29:23Z", "commit": {"oid": "618b6af9f7521b8424dfecda53663c240510e7e6"}, "state": "APPROVED", "comments": {"totalCount": 7, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xMFQxMjoyOToyM1rOHPxKsw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xMFQxMjo0MTozOFrOHPxn_A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NjI5NjI0Mw==", "bodyText": "You could also wrap it with Collections.unmodifiableSet() as modification would not make sense anymore.", "url": "https://github.com/dedica-team/nivio/pull/263#discussion_r486296243", "createdAt": "2020-09-10T12:29:23Z", "author": {"login": "Matthimatiker"}, "path": "src/main/java/de/bonndan/nivio/model/Group.java", "diffHunk": "@@ -93,8 +92,13 @@ public void setColor(String color) {\n         return links;\n     }\n \n+    /**\n+     * Returns an immutable copy of the items.\n+     *\n+     * @return immutable copy\n+     */\n     public Set<Item> getItems() {\n-        return items;\n+        return Set.copyOf(items);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "618b6af9f7521b8424dfecda53663c240510e7e6"}, "originalPosition": 43}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NjI5NjM5MA==", "bodyText": "\ud83d\udc4d", "url": "https://github.com/dedica-team/nivio/pull/263#discussion_r486296390", "createdAt": "2020-09-10T12:29:38Z", "author": {"login": "Matthimatiker"}, "path": "src/main/java/de/bonndan/nivio/model/Group.java", "diffHunk": "@@ -142,4 +146,22 @@ public String toString() {\n                 \"identifier='\" + identifier + '\\'' +\n                 '}';\n     }\n+\n+    /**\n+     * Adds an item to this group.\n+     *\n+     * @param item the item to add.\n+     * @throws IllegalArgumentException if the item group field mismatches\n+     */\n+    public void addItem(Item item) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "618b6af9f7521b8424dfecda53663c240510e7e6"}, "originalPosition": 58}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NjI5Njg2MQ==", "bodyText": "\ud83d\udc4d", "url": "https://github.com/dedica-team/nivio/pull/263#discussion_r486296861", "createdAt": "2020-09-10T12:30:21Z", "author": {"login": "Matthimatiker"}, "path": "src/main/java/de/bonndan/nivio/model/Item.java", "diffHunk": "@@ -18,7 +18,7 @@\n \n     @NotNull\n     @Pattern(regexp = LandscapeItem.IDENTIFIER_VALIDATION)\n-    private String identifier;\n+    private final String identifier;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "618b6af9f7521b8424dfecda53663c240510e7e6"}, "originalPosition": 5}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NjI5NzMyNw==", "bodyText": "\ud83d\udc4d", "url": "https://github.com/dedica-team/nivio/pull/263#discussion_r486297327", "createdAt": "2020-09-10T12:31:09Z", "author": {"login": "Matthimatiker"}, "path": "src/main/java/de/bonndan/nivio/model/Item.java", "diffHunk": "@@ -227,7 +236,7 @@ public boolean equals(Object o) {\n \n     @Override\n     public int hashCode() {\n-        return Objects.hash(toString());\n+        return Objects.hash(identifier);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "618b6af9f7521b8424dfecda53663c240510e7e6"}, "originalPosition": 55}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NjI5ODI1Nw==", "bodyText": "Shouldn't equals also check for the identifier now?", "url": "https://github.com/dedica-team/nivio/pull/263#discussion_r486298257", "createdAt": "2020-09-10T12:32:44Z", "author": {"login": "Matthimatiker"}, "path": "src/main/java/de/bonndan/nivio/model/Item.java", "diffHunk": "@@ -227,7 +236,7 @@ public boolean equals(Object o) {\n \n     @Override\n     public int hashCode() {\n-        return Objects.hash(toString());\n+        return Objects.hash(identifier);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NjI5NzMyNw=="}, "originalCommit": {"oid": "618b6af9f7521b8424dfecda53663c240510e7e6"}, "originalPosition": 55}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NjMwMDUzMw==", "bodyText": "Adding a constructor for this case might increase readability of item construction, as the reader does not have to reason about null.", "url": "https://github.com/dedica-team/nivio/pull/263#discussion_r486300533", "createdAt": "2020-09-10T12:36:32Z", "author": {"login": "Matthimatiker"}, "path": "src/test/java/de/bonndan/nivio/assessment/kpi/LifecycleKPITest.java", "diffHunk": "@@ -24,8 +24,7 @@ public void setup() {\n \n     @Test\n     public void green() {\n-        Item item = new Item();\n-        item.setIdentifier(\"foo\");\n+        Item item = new Item(null, \"foo\");", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "618b6af9f7521b8424dfecda53663c240510e7e6"}, "originalPosition": 6}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NjMwMzc0MA==", "bodyText": "I am a bit surprised that this throws an exception.\nI would have expected that the returned Set (but not the original one) is modified.", "url": "https://github.com/dedica-team/nivio/pull/263#discussion_r486303740", "createdAt": "2020-09-10T12:41:38Z", "author": {"login": "Matthimatiker"}, "path": "src/test/java/de/bonndan/nivio/model/GroupTest.java", "diffHunk": "@@ -0,0 +1,42 @@\n+package de.bonndan.nivio.model;\n+\n+import org.junit.jupiter.api.Test;\n+\n+import static org.junit.jupiter.api.Assertions.*;\n+\n+class GroupTest {\n+\n+    @Test\n+    void doesNotAllowEmptyIdentifier() {\n+        assertThrows(Exception.class, () -> new Group(\"\"));\n+    }\n+\n+    @Test\n+    void getItemsIsImmutable() {\n+        Group g = new Group(\"foo\");\n+        assertThrows(Exception.class, () -> g.getItems().add(new Item(\"a\", \"b\")));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "618b6af9f7521b8424dfecda53663c240510e7e6"}, "originalPosition": 17}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "6961ed1c245f3c25a61f902db980ece03ace8676", "author": {"user": null}, "url": "https://github.com/dedica-team/nivio/commit/6961ed1c245f3c25a61f902db980ece03ace8676", "committedDate": "2020-09-10T13:45:54Z", "message": "configurable polling frequency"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "1e7cead2a0b147febe13184dac2f4fcd793afdea", "author": {"user": null}, "url": "https://github.com/dedica-team/nivio/commit/1e7cead2a0b147febe13184dac2f4fcd793afdea", "committedDate": "2020-09-10T13:45:54Z", "message": "[#266] label cleanup, writing prefixed labels to item labels"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "80e1b6dab98a0a746c4c18ab8d90430e641074cb", "author": {"user": null}, "url": "https://github.com/dedica-team/nivio/commit/80e1b6dab98a0a746c4c18ab8d90430e641074cb", "committedDate": "2020-09-10T13:45:54Z", "message": "[#266] cleanup"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1882, "cost": 1, "resetAt": "2021-11-01T13:51:04Z"}}}