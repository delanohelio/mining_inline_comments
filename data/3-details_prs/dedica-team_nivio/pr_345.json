{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTQ2MjA1ODk5", "number": 345, "title": "Trigger event instead of direct use of Indexer an API #309", "bodyText": "changes referencing issue #309", "createdAt": "2020-12-28T19:14:29Z", "url": "https://github.com/dedica-team/nivio/pull/345", "merged": true, "mergeCommit": {"oid": "735435cd202413b04c8286cdcabcd07fb362ce0b"}, "closed": true, "closedAt": "2021-01-30T07:48:09Z", "author": {"login": "Ruchika8"}, "timelineItems": {"totalCount": 7, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdqqSifgH2gAyNTQ2MjA1ODk5OmU5MzhjNDNkNWRhNmNmNGZmYWJmYzBiN2MzYjBjNjMyYTBlYzNkYTI=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdsvi57AFqTU1OTQ1MDgwMA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "e938c43d5da6cf4ffabfc0b7c3b0c632a0ec3da2", "author": {"user": {"login": "Ruchika8", "name": "Ruchika Salwan"}}, "url": "https://github.com/dedica-team/nivio/commit/e938c43d5da6cf4ffabfc0b7c3b0c632a0ec3da2", "committedDate": "2020-12-28T18:18:19Z", "message": "Merge pull request #1 from dedica-team/develop\n\nupdate forked repo"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "10d61e3284ba79358fbf80dc4c73a0a0cd3ed399", "author": {"user": {"login": "Ruchika8", "name": "Ruchika Salwan"}}, "url": "https://github.com/dedica-team/nivio/commit/10d61e3284ba79358fbf80dc4c73a0a0cd3ed399", "committedDate": "2020-12-28T18:53:30Z", "message": "initial commit"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ea8fa9b464ab862208572c8da5521c03d5f238a2", "author": {"user": {"login": "Ruchika8", "name": "Ruchika Salwan"}}, "url": "https://github.com/dedica-team/nivio/commit/ea8fa9b464ab862208572c8da5521c03d5f238a2", "committedDate": "2020-12-28T19:04:06Z", "message": "updated controller"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTYwNzI2MjA3", "url": "https://github.com/dedica-team/nivio/pull/345#pullrequestreview-560726207", "createdAt": "2021-01-03T21:22:15Z", "commit": {"oid": "ea8fa9b464ab862208572c8da5521c03d5f238a2"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMS0wM1QyMToyMjoxNVrOINhx7Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMS0wM1QyMToyMjoxNVrOINhx7Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1MTA1NTg1Mw==", "bodyText": "This looks fine, we can remove line 131 tough! \ud83d\ude04", "url": "https://github.com/dedica-team/nivio/pull/345#discussion_r551055853", "createdAt": "2021-01-03T21:22:15Z", "author": {"login": "mfbieber"}, "path": "src/main/java/de/bonndan/nivio/api/ApiController.java", "diffHunk": "@@ -124,7 +128,11 @@ public Index index() {\n     @RequestMapping(path = \"/landscape\", method = RequestMethod.POST)\n     public ProcessLog create(@RequestBody String body) {\n         LandscapeDescription env = LandscapeDescriptionFactory.fromString(body, \"request body\");\n-        return indexer.index(env);\n+        //return indexer.index(env);\n+        IndexEvent event = new IndexEvent(this, env, \"create landscape\");\n+        publisher.publishEvent(event);\n+        return event.getProcessLog();\n+", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ea8fa9b464ab862208572c8da5521c03d5f238a2"}, "originalPosition": 47}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTYwNzI2MjI4", "url": "https://github.com/dedica-team/nivio/pull/345#pullrequestreview-560726228", "createdAt": "2021-01-03T21:22:56Z", "commit": {"oid": "ea8fa9b464ab862208572c8da5521c03d5f238a2"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMS0wM1QyMToyMjo1NlrOINhyEQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMS0wM1QyMToyMjo1NlrOINhyEQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1MTA1NTg4OQ==", "bodyText": "Also the indexer is not needed anymore. We can remove line 46 and line 33!", "url": "https://github.com/dedica-team/nivio/pull/345#discussion_r551055889", "createdAt": "2021-01-03T21:22:56Z", "author": {"login": "mfbieber"}, "path": "src/main/java/de/bonndan/nivio/api/ApiController.java", "diffHunk": "@@ -30,18 +32,20 @@\n     private final InputFormatHandlerFactory formatFactory;\n     private final Indexer indexer;\n     private final LinkFactory linkFactory;\n+    private final ApplicationEventPublisher publisher;\n \n     public ApiController(LandscapeRepository landscapeRepository,\n                          LandscapeDescriptionFactory landscapeDescriptionFactory,\n                          InputFormatHandlerFactory formatFactory,\n                          Indexer indexer,\n-                         LinkFactory linkFactory\n-    ) {\n+                         LinkFactory linkFactory,\n+                         ApplicationEventPublisher publisher) {\n         this.landscapeRepository = landscapeRepository;\n         this.landscapeDescriptionFactory = landscapeDescriptionFactory;\n         this.formatFactory = formatFactory;\n         this.indexer = indexer;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ea8fa9b464ab862208572c8da5521c03d5f238a2"}, "originalPosition": 32}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTYwNzI2NDgw", "url": "https://github.com/dedica-team/nivio/pull/345#pullrequestreview-560726480", "createdAt": "2021-01-03T21:27:10Z", "commit": {"oid": "ea8fa9b464ab862208572c8da5521c03d5f238a2"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTU5NDUwODAw", "url": "https://github.com/dedica-team/nivio/pull/345#pullrequestreview-559450800", "createdAt": "2020-12-29T09:36:38Z", "commit": {"oid": "ea8fa9b464ab862208572c8da5521c03d5f238a2"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0yOVQwOTozNjozOFrOIMLIBQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0yOVQwOTozNjozOFrOIMLIBQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0OTYzNjEwMQ==", "bodyText": "Your solution is correct and fulfills the current API contract. \ud83d\udc4d\nHowever, @mfbieber is working on #212 to introduce reduce immutability everywhere. I suggest to change the API and return a simple json/hateoas response containing the link to the log (and the landscape) in every controller method. What also has changed in the meantime is that we do more async stuff (fetching external links) and can't (should not) wait for indexing completion anymore.\nWhat do you think @Ruchika8 @mfbieber ?", "url": "https://github.com/dedica-team/nivio/pull/345#discussion_r549636101", "createdAt": "2020-12-29T09:36:38Z", "author": {"login": "bonndan"}, "path": "src/main/java/de/bonndan/nivio/IndexEvent.java", "diffHunk": "@@ -15,6 +16,7 @@\n \n     private final String message;\n     private final LandscapeDescription landscapeDescription;\n+    private ProcessLog processLog;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ea8fa9b464ab862208572c8da5521c03d5f238a2"}, "originalPosition": 12}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1926, "cost": 1, "resetAt": "2021-11-01T13:51:04Z"}}}