{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDQ5ODEzOTE0", "number": 499, "title": "Disallow problematic identifiers", "bodyText": "These newly disallowed identifiers were never actually supported in\npractice and are problematic on multiple levels:\n\nAn identifier like _ or __ are bad names that don't help users understand an API.\nIdentifiers like _ are problematic for languages like Rust that use this character for pattern matching.\n\nIssue #, if available:\nDescription of changes:\nBy submitting this pull request, I confirm that my contribution is made under the terms of the Apache 2.0 license.", "createdAt": "2020-07-16T00:24:49Z", "url": "https://github.com/awslabs/smithy/pull/499", "merged": true, "mergeCommit": {"oid": "a779b4769aeee78f4b8e2d3ac954401256fe72be"}, "closed": true, "closedAt": "2020-07-16T16:25:28Z", "author": {"login": "mtdowling"}, "timelineItems": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABc1hIRLAFqTQ0OTk3MDYyNg==", "endCursor": "Y3Vyc29yOnYyOpPPAAABc1hgdBgFqTQ0OTk5NzY4MQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDQ5OTcwNjI2", "url": "https://github.com/awslabs/smithy/pull/499#pullrequestreview-449970626", "createdAt": "2020-07-16T15:36:44Z", "commit": {"oid": "b0f98d57bced5e318ced8324bc808ee72936ee49"}, "state": "COMMENTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xNlQxNTozNjo0NFrOGywvLw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xNlQxNTozOTo0M1rOGyw3SA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NTg4MDQ5NQ==", "bodyText": "Went looking to see if this needs to be updated in the idl.rst file of the spec, but it looks like it isn't present there. Should probably add this section of the ABNF over there as well, since its heading seems to indicate completeness.", "url": "https://github.com/awslabs/smithy/pull/499#discussion_r455880495", "createdAt": "2020-07-16T15:36:44Z", "author": {"login": "kstich"}, "path": "docs/source/1.0/spec/core/model.rst", "diffHunk": "@@ -445,7 +445,9 @@ Shape IDs are formally defined by the following ABNF:\n     root_shape_id          :`absolute_root_shape_id` / `identifier`\n     absolute_root_shape_id :`namespace` \"#\" `identifier`\n     namespace              :`identifier` *(\".\" `identifier`)\n-    identifier             :(ALPHA / \"_\") *(ALPHA / DIGIT / \"_\")\n+    identifier             :identifier_start *identifier_chars", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b0f98d57bced5e318ced8324bc808ee72936ee49"}, "originalPosition": 5}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NTg4MjU2OA==", "bodyText": "s/e..g/e.g.", "url": "https://github.com/awslabs/smithy/pull/499#discussion_r455882568", "createdAt": "2020-07-16T15:39:43Z", "author": {"login": "kstich"}, "path": "smithy-model/src/main/java/software/amazon/smithy/model/shapes/ShapeId.java", "diffHunk": "@@ -117,21 +117,40 @@ public static boolean isValidNamespace(CharSequence namespace) {\n      * @return Returns true if this is a valid identifier.\n      */\n     public static boolean isValidIdentifier(CharSequence identifier) {\n-        if (identifier == null || identifier.length() == 0) {\n-            return false;\n+        return parseIdentifier(identifier, 0) == identifier.length();\n+    }\n+\n+    private static int parseIdentifier(CharSequence identifier, int offset) {\n+        if (identifier == null || identifier.length() <= offset) {\n+            return -1;\n         }\n \n-        if (!ParserUtils.isIdentifierStart(identifier.charAt(0))) {\n-            return false;\n+        // Parse the required identifier_start production.\n+        char startingChar = identifier.charAt(offset);\n+        if (startingChar == '_') {\n+            while (identifier.charAt(offset) == '_') {\n+                offset++;\n+            }\n+            if (!ParserUtils.isValidIdentifierCharacter(identifier.charAt(offset))) {\n+                return -1;\n+            }\n+            offset++;\n+        } else if (!ParserUtils.isAlphabetic(startingChar)) {\n+            return -1;\n         }\n \n-        for (int i = 1; i < identifier.length(); i++) {\n-            if (!ParserUtils.isValidIdentifierCharacter(identifier.charAt(i))) {\n-                return false;\n+        // Parse the optional identifier_chars production.\n+        while (offset < identifier.length()) {\n+            if (!ParserUtils.isValidIdentifierCharacter(identifier.charAt(offset))) {\n+                // Return the position of the character that stops the identifier.\n+                // This is either an invalid case (e..g, isValidIdentifier), or", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b0f98d57bced5e318ced8324bc808ee72936ee49"}, "originalPosition": 84}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "3ca1ce2190b928e76939345e89b5880bca40b970", "author": {"user": {"login": "mtdowling", "name": "Michael Dowling"}}, "url": "https://github.com/awslabs/smithy/commit/3ca1ce2190b928e76939345e89b5880bca40b970", "committedDate": "2020-07-16T16:01:37Z", "message": "Disallow problematic identifiers\n\nThese newly disallowed identifiers were never actually supported in\npractice and are problematic on multiple levels:\n\n1. An identifier like `_` or `__` are bad names that don't help users\n   understand an API.\n2. Identifiers like `_` are problematic for languages like Rust that use\n   this character for pattern matching."}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "b0f98d57bced5e318ced8324bc808ee72936ee49", "author": {"user": {"login": "mtdowling", "name": "Michael Dowling"}}, "url": "https://github.com/awslabs/smithy/commit/b0f98d57bced5e318ced8324bc808ee72936ee49", "committedDate": "2020-07-16T00:23:10Z", "message": "Disallow problematic identifiers\n\nThese newly disallowed identifiers were never actually supported in\npractice and are problematic on multiple levels:\n\n1. An identifier like `_` or `__` are bad names that don't help users\n   understand an API.\n2. Identifiers like `_` are problematic for languages like Rust that use\n   this character for pattern matching."}, "afterCommit": {"oid": "3ca1ce2190b928e76939345e89b5880bca40b970", "author": {"user": {"login": "mtdowling", "name": "Michael Dowling"}}, "url": "https://github.com/awslabs/smithy/commit/3ca1ce2190b928e76939345e89b5880bca40b970", "committedDate": "2020-07-16T16:01:37Z", "message": "Disallow problematic identifiers\n\nThese newly disallowed identifiers were never actually supported in\npractice and are problematic on multiple levels:\n\n1. An identifier like `_` or `__` are bad names that don't help users\n   understand an API.\n2. Identifiers like `_` are problematic for languages like Rust that use\n   this character for pattern matching."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDQ5OTk3Njgx", "url": "https://github.com/awslabs/smithy/pull/499#pullrequestreview-449997681", "createdAt": "2020-07-16T16:06:23Z", "commit": {"oid": "3ca1ce2190b928e76939345e89b5880bca40b970"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2213, "cost": 1, "resetAt": "2021-11-01T11:59:11Z"}}}