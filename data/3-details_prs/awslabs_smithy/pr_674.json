{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTQxNDg0NzEy", "number": 674, "title": "Fix openapi greedy param names for API Gateway REST APIs", "bodyText": "For OpenAPI, \"greedy\" labels need a corresponding name parameter, which was added in #641.\nHowever, some vendors/tooling, including REST APIs for API Gateway, require that the name parameter exclude the \"+\" suffix in the generated name parameter.\nThis CR adds an option to configure OpenApiConfig to remove that suffix, which is then used as the default for REST APIs in smithy-aws-apigateway-openapi.\nBy submitting this pull request, I confirm that my contribution is made under the terms of the Apache 2.0 license.", "createdAt": "2020-12-16T22:47:55Z", "url": "https://github.com/awslabs/smithy/pull/674", "merged": true, "mergeCommit": {"oid": "38dcc8be2d9c03ec5f27fd0beb3b21000fadbc67"}, "closed": true, "closedAt": "2020-12-21T18:42:08Z", "author": {"login": "srchase"}, "timelineItems": {"totalCount": 6, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdm2HFRAH2gAyNTQxNDg0NzEyOmNiOGIzMDQzYzk1NDQ2OTU0NjM5ZWZlZTVmYTJlN2UwNjAzYjNlYTM=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdoabvJAFqTU1NjU4NzU2Ng==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "cb8b3043c95446954639efee5fa2e7e0603b3ea3", "author": {"user": {"login": "srchase", "name": "Chase Coalwell"}}, "url": "https://github.com/awslabs/smithy/commit/cb8b3043c95446954639efee5fa2e7e0603b3ea3", "committedDate": "2020-12-16T21:48:58Z", "message": "Add config to suffix greedy param"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "958c9a8e12994e69b6a8f2e4022605b88787a42e", "author": {"user": {"login": "srchase", "name": "Chase Coalwell"}}, "url": "https://github.com/awslabs/smithy/commit/958c9a8e12994e69b6a8f2e4022605b88787a42e", "committedDate": "2020-12-16T22:37:47Z", "message": "Default REST apis to remove greedy suffix"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTU0MTU1ODkx", "url": "https://github.com/awslabs/smithy/pull/674#pullrequestreview-554155891", "createdAt": "2020-12-16T23:03:03Z", "commit": {"oid": "958c9a8e12994e69b6a8f2e4022605b88787a42e"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xNlQyMzowMzowNFrOIHdB1w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xNlQyMzoxMDo0M1rOIHdPVA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NDY4NjU1MQ==", "bodyText": "This would probably work better as a real if statement now that the ternary is so complex.", "url": "https://github.com/awslabs/smithy/pull/674#discussion_r544686551", "createdAt": "2020-12-16T23:03:04Z", "author": {"login": "kstich"}, "path": "smithy-openapi/src/main/java/software/amazon/smithy/openapi/fromsmithy/protocols/AbstractRestProtocol.java", "diffHunk": "@@ -138,7 +138,11 @@ abstract Schema createDocumentSchema(\n \n             // Greedy labels in OpenAPI need to include the label in the generated parameter.\n             // For example, given \"/{foo+}\", the parameter name must be \"foo+\".\n-            String name = label.isGreedyLabel() ? label.getContent() + \"+\" : label.getContent();\n+            // Some vendors/tooling, require the \"+\" suffix be excluded in the generated parameter.\n+            // If required, the setRemoveGreedyParameterSuffix config option should be set to `true`.\n+            // When this option is enabled, given \"/{foo+}\", the parameter name will be \"foo\".\n+            String name = (label.isGreedyLabel() && !context.getConfig().getRemoveGreedyParameterSuffix())", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "958c9a8e12994e69b6a8f2e4022605b88787a42e"}, "originalPosition": 8}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NDY4Njg1Mw==", "bodyText": "This should have a guide update, since it's a new option.", "url": "https://github.com/awslabs/smithy/pull/674#discussion_r544686853", "createdAt": "2020-12-16T23:03:47Z", "author": {"login": "kstich"}, "path": "smithy-openapi/src/main/java/software/amazon/smithy/openapi/OpenApiConfig.java", "diffHunk": "@@ -218,6 +219,14 @@ public void setForbidGreedyLabels(boolean forbidGreedyLabels) {\n         this.forbidGreedyLabels = forbidGreedyLabels;\n     }\n \n+    public boolean getRemoveGreedyParameterSuffix() {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "958c9a8e12994e69b6a8f2e4022605b88787a42e"}, "originalPosition": 12}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NDY4OTUxOA==", "bodyText": "This should probably link to their API docs showing that greedy labels are not suffixed for REST: https://docs.aws.amazon.com/apigateway/latest/developerguide/setup-http-integrations.html\nConsider a \"this is counter to the default, like for HTTP APIs, ...\" that links to those docs too: https://docs.aws.amazon.com/apigateway/latest/developerguide/http-api-develop-integrations-http.html", "url": "https://github.com/awslabs/smithy/pull/674#discussion_r544689518", "createdAt": "2020-12-16T23:09:37Z", "author": {"login": "kstich"}, "path": "smithy-aws-apigateway-openapi/src/main/java/software/amazon/smithy/aws/apigateway/openapi/AddDefaultRestConfigSettings.java", "diffHunk": "@@ -0,0 +1,36 @@\n+/*\n+ * Copyright 2020 Amazon.com, Inc. or its affiliates. All Rights Reserved.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\").\n+ * You may not use this file except in compliance with the License.\n+ * A copy of the License is located at\n+ *\n+ *  http://aws.amazon.com/apache2.0\n+ *\n+ * or in the \"license\" file accompanying this file. This file is distributed\n+ * on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either\n+ * express or implied. See the License for the specific language governing\n+ * permissions and limitations under the License.\n+ */\n+\n+package software.amazon.smithy.aws.apigateway.openapi;\n+\n+import java.util.List;\n+import software.amazon.smithy.model.Model;\n+import software.amazon.smithy.openapi.OpenApiConfig;\n+import software.amazon.smithy.utils.ListUtils;\n+\n+/**\n+ * REST APIs require that name parameters for greedy labels are not suffixed with \"+\".", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "958c9a8e12994e69b6a8f2e4022605b88787a42e"}, "originalPosition": 24}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NDY5MDAwNA==", "bodyText": "This should have javadoc.", "url": "https://github.com/awslabs/smithy/pull/674#discussion_r544690004", "createdAt": "2020-12-16T23:10:43Z", "author": {"login": "kstich"}, "path": "smithy-openapi/src/main/java/software/amazon/smithy/openapi/OpenApiConfig.java", "diffHunk": "@@ -218,6 +219,14 @@ public void setForbidGreedyLabels(boolean forbidGreedyLabels) {\n         this.forbidGreedyLabels = forbidGreedyLabels;\n     }\n \n+    public boolean getRemoveGreedyParameterSuffix() {\n+        return removeGreedyParameterSuffix;\n+    }\n+\n+    public void setRemoveGreedyParameterSuffix(boolean removeGreedyParameterSuffix) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "958c9a8e12994e69b6a8f2e4022605b88787a42e"}, "originalPosition": 16}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ee69c1c4ae18c050239476beb5ad5c6abded8051", "author": {"user": {"login": "srchase", "name": "Chase Coalwell"}}, "url": "https://github.com/awslabs/smithy/commit/ee69c1c4ae18c050239476beb5ad5c6abded8051", "committedDate": "2020-12-17T00:16:36Z", "message": "Simplify suffix logic, add docs"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTU0NTMzMTEx", "url": "https://github.com/awslabs/smithy/pull/674#pullrequestreview-554533111", "createdAt": "2020-12-17T11:53:27Z", "commit": {"oid": "ee69c1c4ae18c050239476beb5ad5c6abded8051"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTU2NTg3NTY2", "url": "https://github.com/awslabs/smithy/pull/674#pullrequestreview-556587566", "createdAt": "2020-12-21T18:42:02Z", "commit": {"oid": "ee69c1c4ae18c050239476beb5ad5c6abded8051"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2132, "cost": 1, "resetAt": "2021-11-01T11:59:11Z"}}}