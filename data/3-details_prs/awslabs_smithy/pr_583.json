{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDk0OTQ3MDEz", "number": 583, "title": "Add additional default CORS headers with config", "bodyText": "Adds additional CORS headers when converting to an OpenAPI model for Amazon API Gateway.\nBy default, amz-sdk-invocation-id and amz-sdk-request headers will be added to the CORS preflight request.\nOn the openapi configuration, the additionalAllowedCorsHeaders option can be used to set other additional headers in place of these default headers, or to omit these default headers entirely by setting an empty array.\nSample config:\n{\n    \"version\": \"1.0\",\n    \"plugins\": {\n        \"openapi\": {\n            \"service\": \"smithy.example#Weather\",\n            \"additionalAllowedCorsHeaders\": [\"foo-header\", \"bar-header\"]\n        }\n    }\n}\n\nBy submitting this pull request, I confirm that my contribution is made under the terms of the Apache 2.0 license.", "createdAt": "2020-09-29T16:09:19Z", "url": "https://github.com/awslabs/smithy/pull/583", "merged": true, "mergeCommit": {"oid": "027fb84adad10557754f11b30a2b0d6755559cd1"}, "closed": true, "closedAt": "2020-09-29T22:44:15Z", "author": {"login": "srchase"}, "timelineItems": {"totalCount": 6, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdNuMPLgFqTQ5ODg1NjE0OA==", "endCursor": "Y3Vyc29yOnYyOpPPAAABdNwIYfgFqTQ5ODk3NjMxMQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDk4ODU2MTQ4", "url": "https://github.com/awslabs/smithy/pull/583#pullrequestreview-498856148", "createdAt": "2020-09-29T20:26:47Z", "commit": {"oid": "f3e51a704689f9f3082e47d796b6a2c9ad456f38"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yOVQyMDoyNjo0N1rOHZ_5Jw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yOVQyMDoyNjo0N1rOHZ_5Jw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NzAyMzI3MQ==", "bodyText": "I'd call this preflight requests and not integrations. We'll use this same configuration for HTTP APIs, and they don't require a preflight integration the same was as the REST APIs do.", "url": "https://github.com/awslabs/smithy/pull/583#discussion_r497023271", "createdAt": "2020-09-29T20:26:47Z", "author": {"login": "mtdowling"}, "path": "docs/source/1.0/guides/converting-to-openapi.rst", "diffHunk": "@@ -691,6 +691,24 @@ disableCloudFormationSubstitution (``boolean``)\n     .. seealso:: :ref:`openapi-cfn-substitutions`\n \n \n+additionalAllowedCorsHeaders (``[string]``)\n+    Sets additional allowed CORS headers on the preflight integration. If this", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f3e51a704689f9f3082e47d796b6a2c9ad456f38"}, "originalPosition": 5}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "f3e51a704689f9f3082e47d796b6a2c9ad456f38", "author": {"user": {"login": "srchase", "name": "Chase Coalwell"}}, "url": "https://github.com/awslabs/smithy/commit/f3e51a704689f9f3082e47d796b6a2c9ad456f38", "committedDate": "2020-09-29T16:03:28Z", "message": "Add additional default CORS headers with config"}, "afterCommit": {"oid": "6a014d07f96044e84a190fdffae3cfb6acbe05d6", "author": {"user": {"login": "srchase", "name": "Chase Coalwell"}}, "url": "https://github.com/awslabs/smithy/commit/6a014d07f96044e84a190fdffae3cfb6acbe05d6", "committedDate": "2020-09-29T20:54:27Z", "message": "Add additional default CORS headers with config"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDk4OTcwNDA5", "url": "https://github.com/awslabs/smithy/pull/583#pullrequestreview-498970409", "createdAt": "2020-09-29T22:36:39Z", "commit": {"oid": "6a014d07f96044e84a190fdffae3cfb6acbe05d6"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yOVQyMjozNjozOVrOHaEliQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yOVQyMjozNjozOVrOHaEliQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NzEwMDE2OQ==", "bodyText": "nit: headerNames.addAll(additionalAllowedHeaders)", "url": "https://github.com/awslabs/smithy/pull/583#discussion_r497100169", "createdAt": "2020-09-29T22:36:39Z", "author": {"login": "mtdowling"}, "path": "smithy-aws-apigateway-openapi/src/main/java/software/amazon/smithy/aws/apigateway/openapi/AddCorsPreflightIntegration.java", "diffHunk": "@@ -112,6 +112,14 @@ private static PathItem addPreflightIntegration(\n         // add headers during the Smithy to OpenAPI conversion process will need to update this\n         // list of headers accordingly.\n         Set<String> headerNames = new TreeSet<>(corsTrait.getAdditionalAllowedHeaders());\n+\n+        // Sets additional allowed headers from the API Gateway config.\n+        List<String> additionalAllowedHeaders = context.getConfig().getExtensions(ApiGatewayConfig.class)\n+                .getAdditionalAllowedCorsHeaders();\n+        for (String header : additionalAllowedHeaders) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "6a014d07f96044e84a190fdffae3cfb6acbe05d6"}, "originalPosition": 8}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d1d54c179cfc4b16d2b087bcbc5193b5850fe9f7", "author": {"user": {"login": "srchase", "name": "Chase Coalwell"}}, "url": "https://github.com/awslabs/smithy/commit/d1d54c179cfc4b16d2b087bcbc5193b5850fe9f7", "committedDate": "2020-09-29T22:42:04Z", "message": "Add additional default CORS headers with config"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "6a014d07f96044e84a190fdffae3cfb6acbe05d6", "author": {"user": {"login": "srchase", "name": "Chase Coalwell"}}, "url": "https://github.com/awslabs/smithy/commit/6a014d07f96044e84a190fdffae3cfb6acbe05d6", "committedDate": "2020-09-29T20:54:27Z", "message": "Add additional default CORS headers with config"}, "afterCommit": {"oid": "d1d54c179cfc4b16d2b087bcbc5193b5850fe9f7", "author": {"user": {"login": "srchase", "name": "Chase Coalwell"}}, "url": "https://github.com/awslabs/smithy/commit/d1d54c179cfc4b16d2b087bcbc5193b5850fe9f7", "committedDate": "2020-09-29T22:42:04Z", "message": "Add additional default CORS headers with config"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDk4OTc2MzEx", "url": "https://github.com/awslabs/smithy/pull/583#pullrequestreview-498976311", "createdAt": "2020-09-29T22:42:51Z", "commit": {"oid": "d1d54c179cfc4b16d2b087bcbc5193b5850fe9f7"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2143, "cost": 1, "resetAt": "2021-11-01T11:59:11Z"}}}