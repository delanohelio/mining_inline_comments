{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDM3MzIwODkz", "number": 470, "reviewThreads": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xOVQyMzozNTozNVrOEHQjUA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xOVQyMzozNzozNFrOEHQkYQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjc2MDQ2NjcyOnYy", "diffSide": "RIGHT", "path": "smithy-model/src/test/java/software/amazon/smithy/model/loader/ModelAssemblerTest.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xOVQyMzozNTozNVrOGmjUmA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yMFQwMDoxNDo0MFrOGmjn2g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MzA3Nzc4NA==", "bodyText": "A simpler test case could just directly create a SuppressTrait rather than needing to use a TraitFactory. Seems like the TraitFactory bit isn't under test here.", "url": "https://github.com/awslabs/smithy/pull/470#discussion_r443077784", "createdAt": "2020-06-19T23:35:35Z", "author": {"login": "mtdowling"}, "path": "smithy-model/src/test/java/software/amazon/smithy/model/loader/ModelAssemblerTest.java", "diffHunk": "@@ -88,6 +92,26 @@ public void addsExplicitShapes() {\n         assertThat(result.unwrap().getShape(ShapeId.from(\"ns.foo#Bar\")), is(Optional.of(shape)));\n     }\n \n+    @Test\n+    public void addsExplicitTraits() {\n+        StringShape shape = StringShape.builder().id(\"ns.foo#Bar\").build();\n+\n+        Node node = Node.fromStrings(\"validator\");\n+        TraitFactory provider = TraitFactory.createServiceFactory();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "6dfbc28f7fe9239eb6f6faf8c42242f3e94e4e02"}, "originalPosition": 26}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MzA4MjcxNA==", "bodyText": "Fixed.", "url": "https://github.com/awslabs/smithy/pull/470#discussion_r443082714", "createdAt": "2020-06-20T00:14:40Z", "author": {"login": "srchase"}, "path": "smithy-model/src/test/java/software/amazon/smithy/model/loader/ModelAssemblerTest.java", "diffHunk": "@@ -88,6 +92,26 @@ public void addsExplicitShapes() {\n         assertThat(result.unwrap().getShape(ShapeId.from(\"ns.foo#Bar\")), is(Optional.of(shape)));\n     }\n \n+    @Test\n+    public void addsExplicitTraits() {\n+        StringShape shape = StringShape.builder().id(\"ns.foo#Bar\").build();\n+\n+        Node node = Node.fromStrings(\"validator\");\n+        TraitFactory provider = TraitFactory.createServiceFactory();", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MzA3Nzc4NA=="}, "originalCommit": {"oid": "6dfbc28f7fe9239eb6f6faf8c42242f3e94e4e02"}, "originalPosition": 26}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjc2MDQ2ODI0OnYy", "diffSide": "RIGHT", "path": "smithy-model/src/test/java/software/amazon/smithy/model/loader/ModelAssemblerTest.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xOVQyMzozNjoyMlrOGmjVTw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xOVQyMzozNjoyMlrOGmjVTw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MzA3Nzk2Nw==", "bodyText": "Then here you could test both for the concrete trait class, no? (i.e., shape.getTrait(SuppressTrait.class))", "url": "https://github.com/awslabs/smithy/pull/470#discussion_r443077967", "createdAt": "2020-06-19T23:36:22Z", "author": {"login": "mtdowling"}, "path": "smithy-model/src/test/java/software/amazon/smithy/model/loader/ModelAssemblerTest.java", "diffHunk": "@@ -88,6 +92,26 @@ public void addsExplicitShapes() {\n         assertThat(result.unwrap().getShape(ShapeId.from(\"ns.foo#Bar\")), is(Optional.of(shape)));\n     }\n \n+    @Test\n+    public void addsExplicitTraits() {\n+        StringShape shape = StringShape.builder().id(\"ns.foo#Bar\").build();\n+\n+        Node node = Node.fromStrings(\"validator\");\n+        TraitFactory provider = TraitFactory.createServiceFactory();\n+        Optional<Trait> trait = provider.createTrait(\n+                ShapeId.from(\"smithy.api#suppress\"), shape.toShapeId(), node);\n+\n+        SuppressTrait suppress = (SuppressTrait) trait.get();\n+        ValidatedResult<Model> result = new ModelAssembler()\n+                .addShape(shape)\n+                .addTrait(shape.toShapeId(), suppress)\n+                .assemble();\n+\n+        assertThat(result.getValidationEvents(), empty());\n+        Shape resultShape = result.unwrap().getShape(ShapeId.from(\"ns.foo#Bar\")).get();\n+        assertTrue(resultShape.findTrait(\"smithy.api#suppress\").isPresent());", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "6dfbc28f7fe9239eb6f6faf8c42242f3e94e4e02"}, "originalPosition": 38}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjc2MDQ2OTQ1OnYy", "diffSide": "RIGHT", "path": "smithy-model/src/main/java/software/amazon/smithy/model/loader/ModelAssembler.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xOVQyMzozNzozNFrOGmjV-g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yMFQwMDoxNDo0OFrOGmjn5g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MzA3ODEzOA==", "bodyText": "Nit, personal taste -- I know this comes right after some forEach calls, but I prefer a normal for loop when possible.", "url": "https://github.com/awslabs/smithy/pull/470#discussion_r443078138", "createdAt": "2020-06-19T23:37:34Z", "author": {"login": "mtdowling"}, "path": "smithy-model/src/main/java/software/amazon/smithy/model/loader/ModelAssembler.java", "diffHunk": "@@ -499,6 +517,9 @@ private LoaderVisitor createLoaderVisitor() {\n \n         shapes.forEach(visitor::onShape);\n         metadata.forEach(visitor::onMetadata);\n+        pendingTraits.forEach(pendingTrait -> {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "6dfbc28f7fe9239eb6f6faf8c42242f3e94e4e02"}, "originalPosition": 57}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MzA4MjcyNg==", "bodyText": "Fixed.", "url": "https://github.com/awslabs/smithy/pull/470#discussion_r443082726", "createdAt": "2020-06-20T00:14:48Z", "author": {"login": "srchase"}, "path": "smithy-model/src/main/java/software/amazon/smithy/model/loader/ModelAssembler.java", "diffHunk": "@@ -499,6 +517,9 @@ private LoaderVisitor createLoaderVisitor() {\n \n         shapes.forEach(visitor::onShape);\n         metadata.forEach(visitor::onMetadata);\n+        pendingTraits.forEach(pendingTrait -> {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MzA3ODEzOA=="}, "originalCommit": {"oid": "6dfbc28f7fe9239eb6f6faf8c42242f3e94e4e02"}, "originalPosition": 57}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3683, "cost": 1, "resetAt": "2021-11-12T11:18:39Z"}}}