{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDg0NDc4OTkx", "number": 561, "title": "Emit events when traits are changed", "bodyText": "Smithy-diff previously did not emit validation events when a trait was\nadded, removed, or changed unless the trait was marked with one of a few\nspecial tags. This commit updates smithy-diff to emit a NOTE when a\ntrait is added or changed and a WARNING when a trait is removed. This\nhelps ensure that all trait changes are caught by smithy-diff, while\nstill allowing more granular control through the tags.\nIssue #, if available:\nDescription of changes:\nBy submitting this pull request, I confirm that my contribution is made under the terms of the Apache 2.0 license.", "createdAt": "2020-09-11T00:31:52Z", "url": "https://github.com/awslabs/smithy/pull/561", "merged": true, "mergeCommit": {"oid": "6383030ef46e4183fc51f8d981f813571ec4e982"}, "closed": true, "closedAt": "2020-09-11T19:47:31Z", "author": {"login": "mtdowling"}, "timelineItems": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdHqQ93gH2gAyNDg0NDc4OTkxOjE5YmI2ZDkxZGE0ZDZiOWNiMzM2MDM4OGFlMTViMjVlZjg1MTk3OGM=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdH6oBlgH2gAyNDg0NDc4OTkxOmZhY2Q5NTc4NDJmZmJmOTZlZmI0ZDNlNjhlYjRiZDRhN2FmODVhNWI=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "19bb6d91da4d6b9cb3360388ae15b25ef851978c", "author": {"user": {"login": "mtdowling", "name": "Michael Dowling"}}, "url": "https://github.com/awslabs/smithy/commit/19bb6d91da4d6b9cb3360388ae15b25ef851978c", "committedDate": "2020-09-11T00:29:15Z", "message": "Emit events when traits are changed\n\nSmithy-diff previously did not emit validation events when a trait was\nadded, removed, or changed unless the trait was marked with one of a few\nspecial tags. This commit updates smithy-diff to emit a NOTE when a\ntrait is added or changed and a WARNING when a trait is removed. This\nhelps ensure that all trait changes are caught by smithy-diff, while\nstill allowing more granular control through the tags."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDg2OTA2NjI5", "url": "https://github.com/awslabs/smithy/pull/561#pullrequestreview-486906629", "createdAt": "2020-09-11T15:26:36Z", "commit": {"oid": "19bb6d91da4d6b9cb3360388ae15b25ef851978c"}, "state": "COMMENTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xMVQxNToyNjozNlrOHQjfOQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xMVQxNToyNjo1NFrOHQjgGQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NzEyMDY5Nw==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                                        \"The `%s` trait was added to the `%s` %s shape: %s\",\n          \n          \n            \n                                        \"The `%s` trait was added to the `%s` %s shape with the value: %s\",", "url": "https://github.com/awslabs/smithy/pull/561#discussion_r487120697", "createdAt": "2020-09-11T15:26:36Z", "author": {"login": "kstich"}, "path": "smithy-diff/src/main/java/software/amazon/smithy/diff/evaluators/ModifiedTrait.java", "diffHunk": "@@ -101,6 +101,29 @@\n                             changedShape.getNewShape().getType(),\n                             Node.prettyPrintJson(oldTrait.toNode()),\n                             Node.prettyPrintJson(newTrait.toNode()))));\n+                } else if (oldTrait == null) {\n+                    events.add(note(changedShape.getNewShape(), newTrait, String.format(\n+                            \"The `%s` trait was added to the `%s` %s shape: %s\",", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "19bb6d91da4d6b9cb3360388ae15b25ef851978c"}, "originalPosition": 6}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NzEyMDkyMQ==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                    assertThat(messages, hasItem(\"The `smithy.example#c` trait was added to the `smithy.example#Foo` string shape: \\\"foo\\\"\"));\n          \n          \n            \n                    assertThat(messages, hasItem(\"The `smithy.example#c` trait was added to the `smithy.example#Foo` string shape with the value: \\\"foo\\\"\"));", "url": "https://github.com/awslabs/smithy/pull/561#discussion_r487120921", "createdAt": "2020-09-11T15:26:54Z", "author": {"login": "kstich"}, "path": "smithy-diff/src/test/java/software/amazon/smithy/diff/evaluators/ModifiedTraitTest.java", "diffHunk": "@@ -98,4 +103,28 @@ private static Shape createDefinition(String tag) {\n                 .addTrait(TraitDefinition.builder().build())\n                 .build();\n     }\n+\n+    @Test\n+    public void modifiedShapeNoTag() {\n+        Model modelA = Model.assembler()\n+                .addImport(getClass().getResource(\"trait-test-a.smithy\"))\n+                .assemble()\n+                .unwrap();\n+        Model modelB = Model.assembler()\n+                .addImport(getClass().getResource(\"trait-test-b.smithy\"))\n+                .assemble()\n+                .unwrap();\n+        List<ValidationEvent> events = TestHelper.findEvents(ModelDiff.compare(modelA, modelB), \"ModifiedTrait\");\n+        List<String> messages = events.stream()\n+                .map(ValidationEvent::getMessage)\n+                .collect(Collectors.toList());\n+\n+        assertThat(events, hasSize(3));\n+        assertThat(events.stream().filter(e -> e.getSeverity() == Severity.WARNING).count(), equalTo(1L));\n+        assertThat(events.stream().filter(e -> e.getSeverity() == Severity.NOTE).count(), equalTo(2L));\n+\n+        assertThat(messages, hasItem(\"The `smithy.example#c` trait was added to the `smithy.example#Foo` string shape: \\\"foo\\\"\"));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "19bb6d91da4d6b9cb3360388ae15b25ef851978c"}, "originalPosition": 47}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "5e82477ebcbca25140687d8a2ff82b932443776c", "author": {"user": {"login": "mtdowling", "name": "Michael Dowling"}}, "url": "https://github.com/awslabs/smithy/commit/5e82477ebcbca25140687d8a2ff82b932443776c", "committedDate": "2020-09-11T19:32:50Z", "message": "Update smithy-diff/src/main/java/software/amazon/smithy/diff/evaluators/ModifiedTrait.java\n\nCo-authored-by: Kevin Stich <stickevi@amazon.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "facd957842ffbf96efb4d3e68eb4bd4a7af85a5b", "author": {"user": {"login": "mtdowling", "name": "Michael Dowling"}}, "url": "https://github.com/awslabs/smithy/commit/facd957842ffbf96efb4d3e68eb4bd4a7af85a5b", "committedDate": "2020-09-11T19:32:55Z", "message": "Update smithy-diff/src/test/java/software/amazon/smithy/diff/evaluators/ModifiedTraitTest.java\n\nCo-authored-by: Kevin Stich <stickevi@amazon.com>"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2134, "cost": 1, "resetAt": "2021-11-01T11:59:11Z"}}}