{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTM0NzYzNTgz", "number": 662, "title": "Fix truncated environment variable expansions", "bodyText": "Any environment variable expansions in smithy-build.json that did not start at the beginning of the field resulted in dropping the character that preceded the ${NAME} placeholder.\nConsider the following smithy-build.json example, with the environment variable of FOO was set to BAZ:\n{\n    \"version\": \"1.0\",\n    \"projections\": {\n        \"a\": {\n            \"transforms\": [\n                {\n                    \"name\": \"includeShapesByTag\",\n                    \"args\": {\n                        \"tags\": [\"BAR${FOO}\"]\n                    }\n                }\n            ]\n        }\n    }\n}\n\nCurrently, this results in the shapes with the tag BABAZ being included, instead of BARBAZ as expected.\nThis CR corrects the expansion behavior to assure preceding characters are included appropriately.\nBy submitting this pull request, I confirm that my contribution is made under the terms of the Apache 2.0 license.", "createdAt": "2020-12-08T22:18:49Z", "url": "https://github.com/awslabs/smithy/pull/662", "merged": true, "mergeCommit": {"oid": "5fcd31d6c2cbda685e76ced07a6613d5134c9ce4"}, "closed": true, "closedAt": "2020-12-08T23:09:35Z", "author": {"login": "srchase"}, "timelineItems": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdkRty9gH2gAyNTM0NzYzNTgzOjEwNDVkNDkyNTY0ODY0ZDIyY2RiNjY4ZDk4ZTcwYzliODE3MjIyMTM=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdkSVzggFqTU0NzcwNDQ2Ng==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "1045d492564864d22cdb668d98e70c9b81722213", "author": {"user": {"login": "srchase", "name": "Chase Coalwell"}}, "url": "https://github.com/awslabs/smithy/commit/1045d492564864d22cdb668d98e70c9b81722213", "committedDate": "2020-12-08T22:16:55Z", "message": "Fix truncated env var expansions"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTQ3NzA0NDY2", "url": "https://github.com/awslabs/smithy/pull/662#pullrequestreview-547704466", "createdAt": "2020-12-08T23:00:34Z", "commit": {"oid": "1045d492564864d22cdb668d98e70c9b81722213"}, "state": "APPROVED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0wOFQyMzowMDozNFrOIB6MQA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0wOFQyMzowMDozNFrOIB6MQA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzODg3Mjg5Ng==", "bodyText": "This works, but it would probably be easier to understand if this used https://github.com/awslabs/smithy/blob/master/smithy-utils/src/main/java/software/amazon/smithy/utils/SimpleParser.java. I think we can merge this for now to fix the bug, and then go back and improve this when we have time.", "url": "https://github.com/awslabs/smithy/pull/662#discussion_r538872896", "createdAt": "2020-12-08T23:00:34Z", "author": {"login": "mtdowling"}, "path": "smithy-build/src/main/java/software/amazon/smithy/build/model/ConfigLoader.java", "diffHunk": "@@ -115,6 +115,11 @@ public Node stringNode(StringNode node) {\n             while (matcher.find()) {\n                 String variable = matcher.group(1);\n                 String replacement = expand(node.getSourceLocation(), variable);\n+                // INLINE over-matches to allow for escaping. If the over-matched first group does not start with\n+                // '${', we need to prepend the first character from that group on the replacement.\n+                if (!matcher.group(0).startsWith(\"${\")) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "1045d492564864d22cdb668d98e70c9b81722213"}, "originalPosition": 6}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2179, "cost": 1, "resetAt": "2021-11-01T11:59:11Z"}}}