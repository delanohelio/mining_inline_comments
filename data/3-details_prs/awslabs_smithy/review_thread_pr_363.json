{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDAwNTI2MzQx", "number": 363, "reviewThreads": {"totalCount": 7, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wOFQxNzowNzowNFrODwFcjg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wOFQxOTozNzoxOFrODwIuvA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjUxNzQ3NDcwOnYy", "diffSide": "RIGHT", "path": "smithy-aws-apigateway-traits/src/main/resources/META-INF/smithy/aws.apigateway.json", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wOFQxNzowNzowNFrOGC4ufA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wOFQxNzowNzowNFrOGC4ufA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNTY3OTc0MA==", "bodyText": "Should we call this \"Developer Guide\" so that it matches the nomenclature of the referenced docs?", "url": "https://github.com/awslabs/smithy/pull/363#discussion_r405679740", "createdAt": "2020-04-08T17:07:04Z", "author": {"login": "mtdowling"}, "path": "smithy-aws-apigateway-traits/src/main/resources/META-INF/smithy/aws.apigateway.json", "diffHunk": "@@ -8,7 +8,9 @@\n                     \"selector\": \"service\"\n                 },\n                 \"smithy.api#documentation\": \"Specifies the source of the caller identifier that will be used to throttle API methods that require a key.\",\n-                \"smithy.api#externalDocumentation\": \"https://docs.aws.amazon.com/apigateway/latest/developerguide/api-gateway-swagger-extensions-api-key-source.html\",\n+                \"smithy.api#externalDocumentation\": {\n+                    \"User Guide\": \"https://docs.aws.amazon.com/apigateway/latest/developerguide/api-gateway-swagger-extensions-api-key-source.html\"", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "0d78257b61d91b6fba8cbed140e5f61b812cfc64"}, "originalPosition": 6}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjUxNzQ3NzMxOnYy", "diffSide": "RIGHT", "path": "docs/source/guides/converting-to-openapi.rst", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wOFQxNzowNzo0NVrOGC4wFA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wOFQxNzowNzo0NVrOGC4wFA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNTY4MDE0OA==", "bodyText": "I'm going to be renaming these anyways..., but I'd probably just call this openapi.externalDocs.", "url": "https://github.com/awslabs/smithy/pull/363#discussion_r405680148", "createdAt": "2020-04-08T17:07:45Z", "author": {"login": "mtdowling"}, "path": "docs/source/guides/converting-to-openapi.rst", "diffHunk": "@@ -196,6 +196,27 @@ openapi.use.xml (boolean)\n     Enables converting Smithy XML traits to OpenAPI XML properties. (this\n     feature is not yet implemented).\n \n+openapi.use.convertedExternalDocs ([string])", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "0d78257b61d91b6fba8cbed140e5f61b812cfc64"}, "originalPosition": 4}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjUxNzQ4Mjk1OnYy", "diffSide": "RIGHT", "path": "docs/source/guides/converting-to-openapi.rst", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wOFQxNzowOToxMlrOGC4zkw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wOFQxNzowOToxMlrOGC4zkw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNTY4MTA0Mw==", "bodyText": "Can we add \"Developer Guide\" to this list?\nWhy Api and not API? Since these are arbitrary and meant to be displayed directly, I think we should probably use API.\nIs this list case-insensitive? I think it probably should be. Thoughts?\nShould probably not say \"set of names\", but \"priority ordered list of names\"", "url": "https://github.com/awslabs/smithy/pull/363#discussion_r405681043", "createdAt": "2020-04-08T17:09:12Z", "author": {"login": "mtdowling"}, "path": "docs/source/guides/converting-to-openapi.rst", "diffHunk": "@@ -196,6 +196,27 @@ openapi.use.xml (boolean)\n     Enables converting Smithy XML traits to OpenAPI XML properties. (this\n     feature is not yet implemented).\n \n+openapi.use.convertedExternalDocs ([string])\n+    Limits the source of converted \"externalDocs\" fields to the specified set\n+    of names in an :ref:`externaldocumentation-trait`. By default, this is a\n+    set of the following values: \"Homepage\", \"Api Reference\", \"User Guide\",", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "0d78257b61d91b6fba8cbed140e5f61b812cfc64"}, "originalPosition": 7}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjUxNzQ5NTE0OnYy", "diffSide": "RIGHT", "path": "smithy-model/src/main/java/software/amazon/smithy/model/traits/ExternalDocumentationTrait.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wOFQxNzoxMjozNFrOGC47OA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wOFQxNzoxMjozNFrOGC47OA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNTY4MzAwMA==", "bodyText": "Can this be simplified to: ObjectNode.fromStringMap(urls)", "url": "https://github.com/awslabs/smithy/pull/363#discussion_r405683000", "createdAt": "2020-04-08T17:12:34Z", "author": {"login": "mtdowling"}, "path": "smithy-model/src/main/java/software/amazon/smithy/model/traits/ExternalDocumentationTrait.java", "diffHunk": "@@ -17,37 +17,119 @@\n \n import java.net.MalformedURLException;\n import java.net.URL;\n+import java.util.Collections;\n+import java.util.LinkedHashMap;\n+import java.util.Map;\n+import java.util.Objects;\n import software.amazon.smithy.model.SourceException;\n import software.amazon.smithy.model.SourceLocation;\n+import software.amazon.smithy.model.node.Node;\n+import software.amazon.smithy.model.node.ObjectNode;\n+import software.amazon.smithy.model.node.StringNode;\n import software.amazon.smithy.model.shapes.ShapeId;\n+import software.amazon.smithy.utils.Pair;\n+import software.amazon.smithy.utils.ToSmithyBuilder;\n \n /**\n- * Provides a link to external documentation of a service or operation.\n+ * Provides named links to external documentation.\n  */\n-public final class ExternalDocumentationTrait extends StringTrait {\n+public final class ExternalDocumentationTrait extends AbstractTrait\n+        implements ToSmithyBuilder<ExternalDocumentationTrait> {\n+\n     public static final ShapeId ID = ShapeId.from(\"smithy.api#externalDocumentation\");\n \n-    public ExternalDocumentationTrait(String value, SourceLocation sourceLocation) {\n-        super(ID, value, sourceLocation);\n-        validateUrl(value, sourceLocation);\n-    }\n+    private final Map<String, String> urls;\n \n-    public ExternalDocumentationTrait(String value) {\n-        this(value, SourceLocation.NONE);\n-    }\n+    public ExternalDocumentationTrait(Builder builder) {\n+        super(ID, builder.sourceLocation);\n+        this.urls = Collections.unmodifiableMap(builder.urls);\n \n-    public static final class Provider extends StringTrait.Provider<ExternalDocumentationTrait> {\n-        public Provider() {\n-            super(ID, ExternalDocumentationTrait::new);\n+        if (urls.isEmpty()) {\n+            throw new SourceException(\"externalDocumentation must have at least one entry\", getSourceLocation());\n         }\n+        urls.forEach((name, url) -> validateUrl(name, url, getSourceLocation()));\n     }\n \n-    private static String validateUrl(String url, SourceLocation location) {\n+    private static String validateUrl(String name, String url, SourceLocation location) {\n         try {\n             new URL(url);\n             return url;\n         } catch (MalformedURLException e) {\n-            throw new SourceException(\"externalDocumentation must be a valid URL. Found \" + url, location);\n+            throw new SourceException(String.format(\"Each externalDocumentation value must be a valid URL. \"\n+                    + \"Found \\\"%s\\\" for name \\\"%s\\\"\", url, name), location);\n+        }\n+    }\n+\n+    /**\n+     * Gets the external documentation names and links.\n+     *\n+     * @return returns the external documentation mapping.\n+     */\n+    public Map<String, String> getUrls() {\n+        return urls;\n+    }\n+\n+    @Override\n+    protected Node createNode() {\n+        return urls.entrySet().stream()", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "0d78257b61d91b6fba8cbed140e5f61b812cfc64"}, "originalPosition": 72}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjUxNzUwNDIxOnYy", "diffSide": "RIGHT", "path": "smithy-model/src/main/resources/software/amazon/smithy/model/loader/prelude-traits.smithy", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wOFQxNzoxNDo1MVrOGC5A3A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wOFQxNzoxNDo1MVrOGC5A3A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNTY4NDQ0NA==", "bodyText": "I suggest applyinh the @length trait to force it to have > 1 entry", "url": "https://github.com/awslabs/smithy/pull/363#discussion_r405684444", "createdAt": "2020-04-08T17:14:51Z", "author": {"login": "mtdowling"}, "path": "smithy-model/src/main/resources/software/amazon/smithy/model/loader/prelude-traits.smithy", "diffHunk": "@@ -57,7 +57,10 @@ string documentation\n \n /// Provides a link to additional documentation.\n @trait\n-string externalDocumentation\n+map externalDocumentation {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "0d78257b61d91b6fba8cbed140e5f61b812cfc64"}, "originalPosition": 5}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjUxNzUwNjU2OnYy", "diffSide": "RIGHT", "path": "smithy-model/src/main/java/software/amazon/smithy/model/traits/ExternalDocumentationTrait.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wOFQxNzoxNToyM1rOGC5CRw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wOFQxNzoxNToyM1rOGC5CRw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNTY4NDgwNw==", "bodyText": "This validation could be removed and just handled by the model validation process if you add the @length trait to the map in the prelude model.", "url": "https://github.com/awslabs/smithy/pull/363#discussion_r405684807", "createdAt": "2020-04-08T17:15:23Z", "author": {"login": "mtdowling"}, "path": "smithy-model/src/main/java/software/amazon/smithy/model/traits/ExternalDocumentationTrait.java", "diffHunk": "@@ -17,37 +17,119 @@\n \n import java.net.MalformedURLException;\n import java.net.URL;\n+import java.util.Collections;\n+import java.util.LinkedHashMap;\n+import java.util.Map;\n+import java.util.Objects;\n import software.amazon.smithy.model.SourceException;\n import software.amazon.smithy.model.SourceLocation;\n+import software.amazon.smithy.model.node.Node;\n+import software.amazon.smithy.model.node.ObjectNode;\n+import software.amazon.smithy.model.node.StringNode;\n import software.amazon.smithy.model.shapes.ShapeId;\n+import software.amazon.smithy.utils.Pair;\n+import software.amazon.smithy.utils.ToSmithyBuilder;\n \n /**\n- * Provides a link to external documentation of a service or operation.\n+ * Provides named links to external documentation.\n  */\n-public final class ExternalDocumentationTrait extends StringTrait {\n+public final class ExternalDocumentationTrait extends AbstractTrait\n+        implements ToSmithyBuilder<ExternalDocumentationTrait> {\n+\n     public static final ShapeId ID = ShapeId.from(\"smithy.api#externalDocumentation\");\n \n-    public ExternalDocumentationTrait(String value, SourceLocation sourceLocation) {\n-        super(ID, value, sourceLocation);\n-        validateUrl(value, sourceLocation);\n-    }\n+    private final Map<String, String> urls;\n \n-    public ExternalDocumentationTrait(String value) {\n-        this(value, SourceLocation.NONE);\n-    }\n+    public ExternalDocumentationTrait(Builder builder) {\n+        super(ID, builder.sourceLocation);\n+        this.urls = Collections.unmodifiableMap(builder.urls);\n \n-    public static final class Provider extends StringTrait.Provider<ExternalDocumentationTrait> {\n-        public Provider() {\n-            super(ID, ExternalDocumentationTrait::new);\n+        if (urls.isEmpty()) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "0d78257b61d91b6fba8cbed140e5f61b812cfc64"}, "originalPosition": 43}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjUxODAxMjc2OnYy", "diffSide": "RIGHT", "path": "docs/source/guides/converting-to-openapi.rst", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wOFQxOTozNzoxOFrOGC-BIg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wOFQxOTozOTowMVrOGC-E5A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNTc2NjQzNA==", "bodyText": "Need to add \"Developer Guide\" here.", "url": "https://github.com/awslabs/smithy/pull/363#discussion_r405766434", "createdAt": "2020-04-08T19:37:18Z", "author": {"login": "mtdowling"}, "path": "docs/source/guides/converting-to-openapi.rst", "diffHunk": "@@ -196,6 +196,28 @@ openapi.use.xml (boolean)\n     Enables converting Smithy XML traits to OpenAPI XML properties. (this\n     feature is not yet implemented).\n \n+openapi.externalDocs ([string])\n+    Limits the source of converted \"externalDocs\" fields to the specified\n+    priority ordered list of names in an :ref:`externaldocumentation-trait`.\n+    This list is case insensitive. By default, this is a list of the following\n+    values: \"Homepage\", \"API Reference\", \"User Guide\", \"Reference\", and", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e0cbe966ae5724fc0cfee1eb7667603509976a44"}, "originalPosition": 8}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNTc2NzM5Ng==", "bodyText": "\ud83e\udd26\u200d\u2642\ufe0f", "url": "https://github.com/awslabs/smithy/pull/363#discussion_r405767396", "createdAt": "2020-04-08T19:39:01Z", "author": {"login": "kstich"}, "path": "docs/source/guides/converting-to-openapi.rst", "diffHunk": "@@ -196,6 +196,28 @@ openapi.use.xml (boolean)\n     Enables converting Smithy XML traits to OpenAPI XML properties. (this\n     feature is not yet implemented).\n \n+openapi.externalDocs ([string])\n+    Limits the source of converted \"externalDocs\" fields to the specified\n+    priority ordered list of names in an :ref:`externaldocumentation-trait`.\n+    This list is case insensitive. By default, this is a list of the following\n+    values: \"Homepage\", \"API Reference\", \"User Guide\", \"Reference\", and", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNTc2NjQzNA=="}, "originalCommit": {"oid": "e0cbe966ae5724fc0cfee1eb7667603509976a44"}, "originalPosition": 8}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3749, "cost": 1, "resetAt": "2021-11-12T11:18:39Z"}}}