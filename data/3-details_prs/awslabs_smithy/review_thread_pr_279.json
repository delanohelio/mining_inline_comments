{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0Mzc3MzMwOTAy", "number": 279, "reviewThreads": {"totalCount": 14, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xOVQxODo0ODowN1rODhLgzw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yMFQxNzoyNzowNlrODhnQ4Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjM2MTE4MjIzOnYy", "diffSide": "RIGHT", "path": "smithy-linters/src/main/java/software/amazon/smithy/linters/DeprecatedTraitsValidator.java", "isResolved": true, "comments": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xOVQxODo0ODowN1rOFrzRfA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yMFQwMDo0Njo0M1rOFr85Kw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MTQ3MzE0OA==", "bodyText": "hasTrait?", "url": "https://github.com/awslabs/smithy/pull/279#discussion_r381473148", "createdAt": "2020-02-19T18:48:07Z", "author": {"login": "mtdowling"}, "path": "smithy-linters/src/main/java/software/amazon/smithy/linters/DeprecatedTraitsValidator.java", "diffHunk": "@@ -0,0 +1,50 @@\n+/*\n+ * Copyright 2019 Amazon.com, Inc. or its affiliates. All Rights Reserved.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\").\n+ * You may not use this file except in compliance with the License.\n+ * A copy of the License is located at\n+ *\n+ *  http://aws.amazon.com/apache2.0\n+ *\n+ * or in the \"license\" file accompanying this file. This file is distributed\n+ * on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either\n+ * express or implied. See the License for the specific language governing\n+ * permissions and limitations under the License.\n+ */\n+\n+package software.amazon.smithy.linters;\n+\n+import static java.lang.String.format;\n+\n+import java.util.List;\n+import java.util.stream.Collectors;\n+import software.amazon.smithy.model.Model;\n+import software.amazon.smithy.model.traits.DeprecatedTrait;\n+import software.amazon.smithy.model.traits.TraitDefinition;\n+import software.amazon.smithy.model.validation.AbstractValidator;\n+import software.amazon.smithy.model.validation.ValidationEvent;\n+import software.amazon.smithy.model.validation.ValidatorService;\n+\n+/**\n+ * Emits a validation event if a model contains a trait that has been marked as deprecated.\n+ */\n+public final class DeprecatedTraitsValidator extends AbstractValidator {\n+\n+    public static final class Provider extends ValidatorService.Provider {\n+        public Provider() {\n+            super(DeprecatedTraitsValidator.class, DeprecatedTraitsValidator::new);\n+        }\n+    }\n+\n+    @Override\n+    public List<ValidationEvent> validate(Model model) {\n+\n+        return model.shapes()\n+                .filter(shape -> shape.hasTrait(TraitDefinition.class))\n+                .filter(trait -> trait.getTrait(DeprecatedTrait.class).isPresent())", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "9a23747c31d4ac817cc8f0bb1aad9e68500e4490"}, "originalPosition": 45}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MTYwMjUwNw==", "bodyText": "Not sure what the question is on this one.", "url": "https://github.com/awslabs/smithy/pull/279#discussion_r381602507", "createdAt": "2020-02-19T23:15:22Z", "author": {"login": "srchase"}, "path": "smithy-linters/src/main/java/software/amazon/smithy/linters/DeprecatedTraitsValidator.java", "diffHunk": "@@ -0,0 +1,50 @@\n+/*\n+ * Copyright 2019 Amazon.com, Inc. or its affiliates. All Rights Reserved.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\").\n+ * You may not use this file except in compliance with the License.\n+ * A copy of the License is located at\n+ *\n+ *  http://aws.amazon.com/apache2.0\n+ *\n+ * or in the \"license\" file accompanying this file. This file is distributed\n+ * on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either\n+ * express or implied. See the License for the specific language governing\n+ * permissions and limitations under the License.\n+ */\n+\n+package software.amazon.smithy.linters;\n+\n+import static java.lang.String.format;\n+\n+import java.util.List;\n+import java.util.stream.Collectors;\n+import software.amazon.smithy.model.Model;\n+import software.amazon.smithy.model.traits.DeprecatedTrait;\n+import software.amazon.smithy.model.traits.TraitDefinition;\n+import software.amazon.smithy.model.validation.AbstractValidator;\n+import software.amazon.smithy.model.validation.ValidationEvent;\n+import software.amazon.smithy.model.validation.ValidatorService;\n+\n+/**\n+ * Emits a validation event if a model contains a trait that has been marked as deprecated.\n+ */\n+public final class DeprecatedTraitsValidator extends AbstractValidator {\n+\n+    public static final class Provider extends ValidatorService.Provider {\n+        public Provider() {\n+            super(DeprecatedTraitsValidator.class, DeprecatedTraitsValidator::new);\n+        }\n+    }\n+\n+    @Override\n+    public List<ValidationEvent> validate(Model model) {\n+\n+        return model.shapes()\n+                .filter(shape -> shape.hasTrait(TraitDefinition.class))\n+                .filter(trait -> trait.getTrait(DeprecatedTrait.class).isPresent())", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MTQ3MzE0OA=="}, "originalCommit": {"oid": "9a23747c31d4ac817cc8f0bb1aad9e68500e4490"}, "originalPosition": 45}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MTYwNjA2MQ==", "bodyText": "I suggest you use hasTrait, not isPresent.", "url": "https://github.com/awslabs/smithy/pull/279#discussion_r381606061", "createdAt": "2020-02-19T23:25:37Z", "author": {"login": "mtdowling"}, "path": "smithy-linters/src/main/java/software/amazon/smithy/linters/DeprecatedTraitsValidator.java", "diffHunk": "@@ -0,0 +1,50 @@\n+/*\n+ * Copyright 2019 Amazon.com, Inc. or its affiliates. All Rights Reserved.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\").\n+ * You may not use this file except in compliance with the License.\n+ * A copy of the License is located at\n+ *\n+ *  http://aws.amazon.com/apache2.0\n+ *\n+ * or in the \"license\" file accompanying this file. This file is distributed\n+ * on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either\n+ * express or implied. See the License for the specific language governing\n+ * permissions and limitations under the License.\n+ */\n+\n+package software.amazon.smithy.linters;\n+\n+import static java.lang.String.format;\n+\n+import java.util.List;\n+import java.util.stream.Collectors;\n+import software.amazon.smithy.model.Model;\n+import software.amazon.smithy.model.traits.DeprecatedTrait;\n+import software.amazon.smithy.model.traits.TraitDefinition;\n+import software.amazon.smithy.model.validation.AbstractValidator;\n+import software.amazon.smithy.model.validation.ValidationEvent;\n+import software.amazon.smithy.model.validation.ValidatorService;\n+\n+/**\n+ * Emits a validation event if a model contains a trait that has been marked as deprecated.\n+ */\n+public final class DeprecatedTraitsValidator extends AbstractValidator {\n+\n+    public static final class Provider extends ValidatorService.Provider {\n+        public Provider() {\n+            super(DeprecatedTraitsValidator.class, DeprecatedTraitsValidator::new);\n+        }\n+    }\n+\n+    @Override\n+    public List<ValidationEvent> validate(Model model) {\n+\n+        return model.shapes()\n+                .filter(shape -> shape.hasTrait(TraitDefinition.class))\n+                .filter(trait -> trait.getTrait(DeprecatedTrait.class).isPresent())", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MTQ3MzE0OA=="}, "originalCommit": {"oid": "9a23747c31d4ac817cc8f0bb1aad9e68500e4490"}, "originalPosition": 45}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MTYzMDc2Mw==", "bodyText": "Fixed.", "url": "https://github.com/awslabs/smithy/pull/279#discussion_r381630763", "createdAt": "2020-02-20T00:46:43Z", "author": {"login": "srchase"}, "path": "smithy-linters/src/main/java/software/amazon/smithy/linters/DeprecatedTraitsValidator.java", "diffHunk": "@@ -0,0 +1,50 @@\n+/*\n+ * Copyright 2019 Amazon.com, Inc. or its affiliates. All Rights Reserved.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\").\n+ * You may not use this file except in compliance with the License.\n+ * A copy of the License is located at\n+ *\n+ *  http://aws.amazon.com/apache2.0\n+ *\n+ * or in the \"license\" file accompanying this file. This file is distributed\n+ * on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either\n+ * express or implied. See the License for the specific language governing\n+ * permissions and limitations under the License.\n+ */\n+\n+package software.amazon.smithy.linters;\n+\n+import static java.lang.String.format;\n+\n+import java.util.List;\n+import java.util.stream.Collectors;\n+import software.amazon.smithy.model.Model;\n+import software.amazon.smithy.model.traits.DeprecatedTrait;\n+import software.amazon.smithy.model.traits.TraitDefinition;\n+import software.amazon.smithy.model.validation.AbstractValidator;\n+import software.amazon.smithy.model.validation.ValidationEvent;\n+import software.amazon.smithy.model.validation.ValidatorService;\n+\n+/**\n+ * Emits a validation event if a model contains a trait that has been marked as deprecated.\n+ */\n+public final class DeprecatedTraitsValidator extends AbstractValidator {\n+\n+    public static final class Provider extends ValidatorService.Provider {\n+        public Provider() {\n+            super(DeprecatedTraitsValidator.class, DeprecatedTraitsValidator::new);\n+        }\n+    }\n+\n+    @Override\n+    public List<ValidationEvent> validate(Model model) {\n+\n+        return model.shapes()\n+                .filter(shape -> shape.hasTrait(TraitDefinition.class))\n+                .filter(trait -> trait.getTrait(DeprecatedTrait.class).isPresent())", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MTQ3MzE0OA=="}, "originalCommit": {"oid": "9a23747c31d4ac817cc8f0bb1aad9e68500e4490"}, "originalPosition": 45}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjM2MTE4Nzg5OnYy", "diffSide": "RIGHT", "path": "smithy-linters/src/main/java/software/amazon/smithy/linters/DeprecatedTraitsValidator.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xOVQxODo0OTo1NFrOFrzVMw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xOVQyMzoxMjoyNlrOFr7HBw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MTQ3NDA5OQ==", "bodyText": "For consistency, we usually wrap shape IDs in backticks.\nI'd how the entire shape ID, not just the name.", "url": "https://github.com/awslabs/smithy/pull/279#discussion_r381474099", "createdAt": "2020-02-19T18:49:54Z", "author": {"login": "mtdowling"}, "path": "smithy-linters/src/main/java/software/amazon/smithy/linters/DeprecatedTraitsValidator.java", "diffHunk": "@@ -0,0 +1,50 @@\n+/*\n+ * Copyright 2019 Amazon.com, Inc. or its affiliates. All Rights Reserved.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\").\n+ * You may not use this file except in compliance with the License.\n+ * A copy of the License is located at\n+ *\n+ *  http://aws.amazon.com/apache2.0\n+ *\n+ * or in the \"license\" file accompanying this file. This file is distributed\n+ * on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either\n+ * express or implied. See the License for the specific language governing\n+ * permissions and limitations under the License.\n+ */\n+\n+package software.amazon.smithy.linters;\n+\n+import static java.lang.String.format;\n+\n+import java.util.List;\n+import java.util.stream.Collectors;\n+import software.amazon.smithy.model.Model;\n+import software.amazon.smithy.model.traits.DeprecatedTrait;\n+import software.amazon.smithy.model.traits.TraitDefinition;\n+import software.amazon.smithy.model.validation.AbstractValidator;\n+import software.amazon.smithy.model.validation.ValidationEvent;\n+import software.amazon.smithy.model.validation.ValidatorService;\n+\n+/**\n+ * Emits a validation event if a model contains a trait that has been marked as deprecated.\n+ */\n+public final class DeprecatedTraitsValidator extends AbstractValidator {\n+\n+    public static final class Provider extends ValidatorService.Provider {\n+        public Provider() {\n+            super(DeprecatedTraitsValidator.class, DeprecatedTraitsValidator::new);\n+        }\n+    }\n+\n+    @Override\n+    public List<ValidationEvent> validate(Model model) {\n+\n+        return model.shapes()\n+                .filter(shape -> shape.hasTrait(TraitDefinition.class))\n+                .filter(trait -> trait.getTrait(DeprecatedTrait.class).isPresent())\n+                .map(deprecatedTrait -> warning(deprecatedTrait, format(\"The %s trait is deprecated.\",", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "9a23747c31d4ac817cc8f0bb1aad9e68500e4490"}, "originalPosition": 46}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MTYwMTU0Mw==", "bodyText": "Fixed in ea47f36\n\n\nThe entire warning is prefixed with the shape ID.", "url": "https://github.com/awslabs/smithy/pull/279#discussion_r381601543", "createdAt": "2020-02-19T23:12:26Z", "author": {"login": "srchase"}, "path": "smithy-linters/src/main/java/software/amazon/smithy/linters/DeprecatedTraitsValidator.java", "diffHunk": "@@ -0,0 +1,50 @@\n+/*\n+ * Copyright 2019 Amazon.com, Inc. or its affiliates. All Rights Reserved.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\").\n+ * You may not use this file except in compliance with the License.\n+ * A copy of the License is located at\n+ *\n+ *  http://aws.amazon.com/apache2.0\n+ *\n+ * or in the \"license\" file accompanying this file. This file is distributed\n+ * on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either\n+ * express or implied. See the License for the specific language governing\n+ * permissions and limitations under the License.\n+ */\n+\n+package software.amazon.smithy.linters;\n+\n+import static java.lang.String.format;\n+\n+import java.util.List;\n+import java.util.stream.Collectors;\n+import software.amazon.smithy.model.Model;\n+import software.amazon.smithy.model.traits.DeprecatedTrait;\n+import software.amazon.smithy.model.traits.TraitDefinition;\n+import software.amazon.smithy.model.validation.AbstractValidator;\n+import software.amazon.smithy.model.validation.ValidationEvent;\n+import software.amazon.smithy.model.validation.ValidatorService;\n+\n+/**\n+ * Emits a validation event if a model contains a trait that has been marked as deprecated.\n+ */\n+public final class DeprecatedTraitsValidator extends AbstractValidator {\n+\n+    public static final class Provider extends ValidatorService.Provider {\n+        public Provider() {\n+            super(DeprecatedTraitsValidator.class, DeprecatedTraitsValidator::new);\n+        }\n+    }\n+\n+    @Override\n+    public List<ValidationEvent> validate(Model model) {\n+\n+        return model.shapes()\n+                .filter(shape -> shape.hasTrait(TraitDefinition.class))\n+                .filter(trait -> trait.getTrait(DeprecatedTrait.class).isPresent())\n+                .map(deprecatedTrait -> warning(deprecatedTrait, format(\"The %s trait is deprecated.\",", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MTQ3NDA5OQ=="}, "originalCommit": {"oid": "9a23747c31d4ac817cc8f0bb1aad9e68500e4490"}, "originalPosition": 46}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjM2MTE4OTI0OnYy", "diffSide": "RIGHT", "path": "smithy-linters/src/test/resources/software/amazon/smithy/linters/errorfiles/deprecated-traits-validator.json", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xOVQxODo1MDoyM1rOFrzWKA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xOVQyMzoxMzowNFrOFr7H3A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MTQ3NDM0NA==", "bodyText": "This isn't needed. The DeprecatedTraits validator should always run.\nYou're also missing a META-INF/services entry for your validator.", "url": "https://github.com/awslabs/smithy/pull/279#discussion_r381474344", "createdAt": "2020-02-19T18:50:23Z", "author": {"login": "mtdowling"}, "path": "smithy-linters/src/test/resources/software/amazon/smithy/linters/errorfiles/deprecated-traits-validator.json", "diffHunk": "@@ -0,0 +1,29 @@\n+{\n+  \"smithy\": \"0.5.0\",\n+  \"shapes\": {\n+    \"ns.foo#MyString\": {\n+      \"type\": \"string\",\n+      \"traits\": {\n+        \"ns.foo#myTraitName\": { }\n+      }\n+    },\n+    \"ns.foo#myTraitName\": {\n+      \"type\": \"structure\",\n+      \"members\": { },\n+      \"traits\": {\n+        \"smithy.api#deprecated\": { },\n+        \"smithy.api#trait\": {\n+          \"selector\": \"*\"\n+        }\n+      }\n+    }\n+  },\n+  \"metadata\": {\n+    \"validators\": [\n+      {\n+        \"id\": \"Deprecated Traits\",\n+        \"name\": \"DeprecatedTraits\"", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "9a23747c31d4ac817cc8f0bb1aad9e68500e4490"}, "originalPosition": 25}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MTYwMTc1Ng==", "bodyText": "Fixed in ea47f36\nDropped the ID, but the name is used in the test runner.", "url": "https://github.com/awslabs/smithy/pull/279#discussion_r381601756", "createdAt": "2020-02-19T23:13:04Z", "author": {"login": "srchase"}, "path": "smithy-linters/src/test/resources/software/amazon/smithy/linters/errorfiles/deprecated-traits-validator.json", "diffHunk": "@@ -0,0 +1,29 @@\n+{\n+  \"smithy\": \"0.5.0\",\n+  \"shapes\": {\n+    \"ns.foo#MyString\": {\n+      \"type\": \"string\",\n+      \"traits\": {\n+        \"ns.foo#myTraitName\": { }\n+      }\n+    },\n+    \"ns.foo#myTraitName\": {\n+      \"type\": \"structure\",\n+      \"members\": { },\n+      \"traits\": {\n+        \"smithy.api#deprecated\": { },\n+        \"smithy.api#trait\": {\n+          \"selector\": \"*\"\n+        }\n+      }\n+    }\n+  },\n+  \"metadata\": {\n+    \"validators\": [\n+      {\n+        \"id\": \"Deprecated Traits\",\n+        \"name\": \"DeprecatedTraits\"", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MTQ3NDM0NA=="}, "originalCommit": {"oid": "9a23747c31d4ac817cc8f0bb1aad9e68500e4490"}, "originalPosition": 25}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjM2MTE5MjUwOnYy", "diffSide": "RIGHT", "path": "smithy-linters/src/test/resources/software/amazon/smithy/linters/errorfiles/deprecated-traits-validator.errors", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xOVQxODo1MToyN1rOFrzYXg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xOVQyMzoxMjozNVrOFr7HPw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MTQ3NDkxMA==", "bodyText": "This should be applied to the shape that used the deprecated trait, not the deprecated trait itself. When I see this warning, I need to know what shape the trait was applied to and what trait was applied.", "url": "https://github.com/awslabs/smithy/pull/279#discussion_r381474910", "createdAt": "2020-02-19T18:51:27Z", "author": {"login": "mtdowling"}, "path": "smithy-linters/src/test/resources/software/amazon/smithy/linters/errorfiles/deprecated-traits-validator.errors", "diffHunk": "@@ -0,0 +1 @@\n+[WARNING] ns.foo#myTraitName: The myTraitName trait is deprecated. | Deprecated Traits", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "9a23747c31d4ac817cc8f0bb1aad9e68500e4490"}, "originalPosition": 1}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MTYwMTU5OQ==", "bodyText": "Fixed in ea47f36", "url": "https://github.com/awslabs/smithy/pull/279#discussion_r381601599", "createdAt": "2020-02-19T23:12:35Z", "author": {"login": "srchase"}, "path": "smithy-linters/src/test/resources/software/amazon/smithy/linters/errorfiles/deprecated-traits-validator.errors", "diffHunk": "@@ -0,0 +1 @@\n+[WARNING] ns.foo#myTraitName: The myTraitName trait is deprecated. | Deprecated Traits", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MTQ3NDkxMA=="}, "originalCommit": {"oid": "9a23747c31d4ac817cc8f0bb1aad9e68500e4490"}, "originalPosition": 1}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjM2MTE5NzczOnYy", "diffSide": "RIGHT", "path": "smithy-linters/src/main/java/software/amazon/smithy/linters/DeprecatedTraitsValidator.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xOVQxODo1Mjo1NlrOFrzb9Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xOVQyMzoxMzozM1rOFr7Ilw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MTQ3NTgyOQ==", "bodyText": "This isn't actually detecting when a trait that's marked as deprecated is applied to a shape.\nYou probably need to first get a set of all the shape IDs that are both traits and deprected. Then you would need to emit validation events for every shape that uses any of the deprecated shape IDs.", "url": "https://github.com/awslabs/smithy/pull/279#discussion_r381475829", "createdAt": "2020-02-19T18:52:56Z", "author": {"login": "mtdowling"}, "path": "smithy-linters/src/main/java/software/amazon/smithy/linters/DeprecatedTraitsValidator.java", "diffHunk": "@@ -0,0 +1,50 @@\n+/*\n+ * Copyright 2019 Amazon.com, Inc. or its affiliates. All Rights Reserved.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\").\n+ * You may not use this file except in compliance with the License.\n+ * A copy of the License is located at\n+ *\n+ *  http://aws.amazon.com/apache2.0\n+ *\n+ * or in the \"license\" file accompanying this file. This file is distributed\n+ * on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either\n+ * express or implied. See the License for the specific language governing\n+ * permissions and limitations under the License.\n+ */\n+\n+package software.amazon.smithy.linters;\n+\n+import static java.lang.String.format;\n+\n+import java.util.List;\n+import java.util.stream.Collectors;\n+import software.amazon.smithy.model.Model;\n+import software.amazon.smithy.model.traits.DeprecatedTrait;\n+import software.amazon.smithy.model.traits.TraitDefinition;\n+import software.amazon.smithy.model.validation.AbstractValidator;\n+import software.amazon.smithy.model.validation.ValidationEvent;\n+import software.amazon.smithy.model.validation.ValidatorService;\n+\n+/**\n+ * Emits a validation event if a model contains a trait that has been marked as deprecated.\n+ */\n+public final class DeprecatedTraitsValidator extends AbstractValidator {\n+\n+    public static final class Provider extends ValidatorService.Provider {\n+        public Provider() {\n+            super(DeprecatedTraitsValidator.class, DeprecatedTraitsValidator::new);\n+        }\n+    }\n+\n+    @Override\n+    public List<ValidationEvent> validate(Model model) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "9a23747c31d4ac817cc8f0bb1aad9e68500e4490"}, "originalPosition": 41}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MTYwMTk0Mw==", "bodyText": "Fixed in ea47f36", "url": "https://github.com/awslabs/smithy/pull/279#discussion_r381601943", "createdAt": "2020-02-19T23:13:33Z", "author": {"login": "srchase"}, "path": "smithy-linters/src/main/java/software/amazon/smithy/linters/DeprecatedTraitsValidator.java", "diffHunk": "@@ -0,0 +1,50 @@\n+/*\n+ * Copyright 2019 Amazon.com, Inc. or its affiliates. All Rights Reserved.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\").\n+ * You may not use this file except in compliance with the License.\n+ * A copy of the License is located at\n+ *\n+ *  http://aws.amazon.com/apache2.0\n+ *\n+ * or in the \"license\" file accompanying this file. This file is distributed\n+ * on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either\n+ * express or implied. See the License for the specific language governing\n+ * permissions and limitations under the License.\n+ */\n+\n+package software.amazon.smithy.linters;\n+\n+import static java.lang.String.format;\n+\n+import java.util.List;\n+import java.util.stream.Collectors;\n+import software.amazon.smithy.model.Model;\n+import software.amazon.smithy.model.traits.DeprecatedTrait;\n+import software.amazon.smithy.model.traits.TraitDefinition;\n+import software.amazon.smithy.model.validation.AbstractValidator;\n+import software.amazon.smithy.model.validation.ValidationEvent;\n+import software.amazon.smithy.model.validation.ValidatorService;\n+\n+/**\n+ * Emits a validation event if a model contains a trait that has been marked as deprecated.\n+ */\n+public final class DeprecatedTraitsValidator extends AbstractValidator {\n+\n+    public static final class Provider extends ValidatorService.Provider {\n+        public Provider() {\n+            super(DeprecatedTraitsValidator.class, DeprecatedTraitsValidator::new);\n+        }\n+    }\n+\n+    @Override\n+    public List<ValidationEvent> validate(Model model) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MTQ3NTgyOQ=="}, "originalCommit": {"oid": "9a23747c31d4ac817cc8f0bb1aad9e68500e4490"}, "originalPosition": 41}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjM2MjAxNzE2OnYy", "diffSide": "RIGHT", "path": "smithy-linters/src/main/java/software/amazon/smithy/linters/DeprecatedTraitsValidator.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xOVQyMzoyNjo0N1rOFr7aZA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yMFQwMDo0NzowMlrOFr85gw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MTYwNjUwMA==", "bodyText": "Why filter this here? I think the use of a deprecated trait on any shape is useful.", "url": "https://github.com/awslabs/smithy/pull/279#discussion_r381606500", "createdAt": "2020-02-19T23:26:47Z", "author": {"login": "mtdowling"}, "path": "smithy-linters/src/main/java/software/amazon/smithy/linters/DeprecatedTraitsValidator.java", "diffHunk": "@@ -0,0 +1,66 @@\n+/*\n+ * Copyright 2019 Amazon.com, Inc. or its affiliates. All Rights Reserved.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\").\n+ * You may not use this file except in compliance with the License.\n+ * A copy of the License is located at\n+ *\n+ *  http://aws.amazon.com/apache2.0\n+ *\n+ * or in the \"license\" file accompanying this file. This file is distributed\n+ * on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either\n+ * express or implied. See the License for the specific language governing\n+ * permissions and limitations under the License.\n+ */\n+\n+package software.amazon.smithy.linters;\n+\n+import static java.lang.String.format;\n+\n+import java.util.ArrayList;\n+import java.util.List;\n+import java.util.Set;\n+import java.util.stream.Collectors;\n+import software.amazon.smithy.model.Model;\n+import software.amazon.smithy.model.shapes.Shape;\n+import software.amazon.smithy.model.shapes.ShapeId;\n+import software.amazon.smithy.model.traits.DeprecatedTrait;\n+import software.amazon.smithy.model.traits.TraitDefinition;\n+import software.amazon.smithy.model.validation.AbstractValidator;\n+import software.amazon.smithy.model.validation.ValidationEvent;\n+import software.amazon.smithy.model.validation.ValidatorService;\n+\n+/**\n+ * Emits a validation event if a model contains shapes that are bound to deprecated traits.\n+ */\n+public final class DeprecatedTraitsValidator extends AbstractValidator {\n+\n+    public static final class Provider extends ValidatorService.Provider {\n+        public Provider() {\n+            super(DeprecatedTraitsValidator.class, DeprecatedTraitsValidator::new);\n+        }\n+    }\n+\n+    @Override\n+    public List<ValidationEvent> validate(Model model) {\n+        Set<ShapeId> deprecatedTraits = model.shapes()\n+                .filter(shape -> shape.hasTrait(TraitDefinition.class))\n+                .filter(trait -> trait.getTrait(DeprecatedTrait.class).isPresent())\n+                .map(Shape::getId)\n+                .collect(Collectors.toSet());\n+\n+        return model.shapes()\n+                .filter(shape -> !shape.hasTrait(TraitDefinition.class))", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ea47f366e419ad8f3f9a8821923e8ac47a866ea4"}, "originalPosition": 53}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MTYzMDg1MQ==", "bodyText": "Removed this filtering.  Now validating all shapes.", "url": "https://github.com/awslabs/smithy/pull/279#discussion_r381630851", "createdAt": "2020-02-20T00:47:02Z", "author": {"login": "srchase"}, "path": "smithy-linters/src/main/java/software/amazon/smithy/linters/DeprecatedTraitsValidator.java", "diffHunk": "@@ -0,0 +1,66 @@\n+/*\n+ * Copyright 2019 Amazon.com, Inc. or its affiliates. All Rights Reserved.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\").\n+ * You may not use this file except in compliance with the License.\n+ * A copy of the License is located at\n+ *\n+ *  http://aws.amazon.com/apache2.0\n+ *\n+ * or in the \"license\" file accompanying this file. This file is distributed\n+ * on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either\n+ * express or implied. See the License for the specific language governing\n+ * permissions and limitations under the License.\n+ */\n+\n+package software.amazon.smithy.linters;\n+\n+import static java.lang.String.format;\n+\n+import java.util.ArrayList;\n+import java.util.List;\n+import java.util.Set;\n+import java.util.stream.Collectors;\n+import software.amazon.smithy.model.Model;\n+import software.amazon.smithy.model.shapes.Shape;\n+import software.amazon.smithy.model.shapes.ShapeId;\n+import software.amazon.smithy.model.traits.DeprecatedTrait;\n+import software.amazon.smithy.model.traits.TraitDefinition;\n+import software.amazon.smithy.model.validation.AbstractValidator;\n+import software.amazon.smithy.model.validation.ValidationEvent;\n+import software.amazon.smithy.model.validation.ValidatorService;\n+\n+/**\n+ * Emits a validation event if a model contains shapes that are bound to deprecated traits.\n+ */\n+public final class DeprecatedTraitsValidator extends AbstractValidator {\n+\n+    public static final class Provider extends ValidatorService.Provider {\n+        public Provider() {\n+            super(DeprecatedTraitsValidator.class, DeprecatedTraitsValidator::new);\n+        }\n+    }\n+\n+    @Override\n+    public List<ValidationEvent> validate(Model model) {\n+        Set<ShapeId> deprecatedTraits = model.shapes()\n+                .filter(shape -> shape.hasTrait(TraitDefinition.class))\n+                .filter(trait -> trait.getTrait(DeprecatedTrait.class).isPresent())\n+                .map(Shape::getId)\n+                .collect(Collectors.toSet());\n+\n+        return model.shapes()\n+                .filter(shape -> !shape.hasTrait(TraitDefinition.class))", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MTYwNjUwMA=="}, "originalCommit": {"oid": "ea47f366e419ad8f3f9a8821923e8ac47a866ea4"}, "originalPosition": 53}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjM2MjAxODczOnYy", "diffSide": "RIGHT", "path": "smithy-linters/src/main/java/software/amazon/smithy/linters/DeprecatedTraitsValidator.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xOVQyMzoyNzozMFrOFr7bUg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yMFQwMDo0NzoyNlrOFr85-g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MTYwNjczOA==", "bodyText": "I'd just use a for loop here. It'll make this code easier to read, and you're already mutating a list in the stream.", "url": "https://github.com/awslabs/smithy/pull/279#discussion_r381606738", "createdAt": "2020-02-19T23:27:30Z", "author": {"login": "mtdowling"}, "path": "smithy-linters/src/main/java/software/amazon/smithy/linters/DeprecatedTraitsValidator.java", "diffHunk": "@@ -0,0 +1,66 @@\n+/*\n+ * Copyright 2019 Amazon.com, Inc. or its affiliates. All Rights Reserved.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\").\n+ * You may not use this file except in compliance with the License.\n+ * A copy of the License is located at\n+ *\n+ *  http://aws.amazon.com/apache2.0\n+ *\n+ * or in the \"license\" file accompanying this file. This file is distributed\n+ * on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either\n+ * express or implied. See the License for the specific language governing\n+ * permissions and limitations under the License.\n+ */\n+\n+package software.amazon.smithy.linters;\n+\n+import static java.lang.String.format;\n+\n+import java.util.ArrayList;\n+import java.util.List;\n+import java.util.Set;\n+import java.util.stream.Collectors;\n+import software.amazon.smithy.model.Model;\n+import software.amazon.smithy.model.shapes.Shape;\n+import software.amazon.smithy.model.shapes.ShapeId;\n+import software.amazon.smithy.model.traits.DeprecatedTrait;\n+import software.amazon.smithy.model.traits.TraitDefinition;\n+import software.amazon.smithy.model.validation.AbstractValidator;\n+import software.amazon.smithy.model.validation.ValidationEvent;\n+import software.amazon.smithy.model.validation.ValidatorService;\n+\n+/**\n+ * Emits a validation event if a model contains shapes that are bound to deprecated traits.\n+ */\n+public final class DeprecatedTraitsValidator extends AbstractValidator {\n+\n+    public static final class Provider extends ValidatorService.Provider {\n+        public Provider() {\n+            super(DeprecatedTraitsValidator.class, DeprecatedTraitsValidator::new);\n+        }\n+    }\n+\n+    @Override\n+    public List<ValidationEvent> validate(Model model) {\n+        Set<ShapeId> deprecatedTraits = model.shapes()\n+                .filter(shape -> shape.hasTrait(TraitDefinition.class))\n+                .filter(trait -> trait.getTrait(DeprecatedTrait.class).isPresent())\n+                .map(Shape::getId)\n+                .collect(Collectors.toSet());\n+\n+        return model.shapes()\n+                .filter(shape -> !shape.hasTrait(TraitDefinition.class))\n+                .flatMap(nonTraitShape -> validateShape(nonTraitShape, deprecatedTraits).stream())\n+                .collect(Collectors.toList());\n+    }\n+\n+    private List<ValidationEvent> validateShape(Shape shape, Set<ShapeId> deprecatedTraits) {\n+        List<ValidationEvent> events = new ArrayList<>();\n+        shape.getAllTraits().keySet().stream().filter(trait -> deprecatedTraits.contains(trait.toShapeId()))", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ea47f366e419ad8f3f9a8821923e8ac47a866ea4"}, "originalPosition": 60}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MTYzMDk3MA==", "bodyText": "Fixed.", "url": "https://github.com/awslabs/smithy/pull/279#discussion_r381630970", "createdAt": "2020-02-20T00:47:26Z", "author": {"login": "srchase"}, "path": "smithy-linters/src/main/java/software/amazon/smithy/linters/DeprecatedTraitsValidator.java", "diffHunk": "@@ -0,0 +1,66 @@\n+/*\n+ * Copyright 2019 Amazon.com, Inc. or its affiliates. All Rights Reserved.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\").\n+ * You may not use this file except in compliance with the License.\n+ * A copy of the License is located at\n+ *\n+ *  http://aws.amazon.com/apache2.0\n+ *\n+ * or in the \"license\" file accompanying this file. This file is distributed\n+ * on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either\n+ * express or implied. See the License for the specific language governing\n+ * permissions and limitations under the License.\n+ */\n+\n+package software.amazon.smithy.linters;\n+\n+import static java.lang.String.format;\n+\n+import java.util.ArrayList;\n+import java.util.List;\n+import java.util.Set;\n+import java.util.stream.Collectors;\n+import software.amazon.smithy.model.Model;\n+import software.amazon.smithy.model.shapes.Shape;\n+import software.amazon.smithy.model.shapes.ShapeId;\n+import software.amazon.smithy.model.traits.DeprecatedTrait;\n+import software.amazon.smithy.model.traits.TraitDefinition;\n+import software.amazon.smithy.model.validation.AbstractValidator;\n+import software.amazon.smithy.model.validation.ValidationEvent;\n+import software.amazon.smithy.model.validation.ValidatorService;\n+\n+/**\n+ * Emits a validation event if a model contains shapes that are bound to deprecated traits.\n+ */\n+public final class DeprecatedTraitsValidator extends AbstractValidator {\n+\n+    public static final class Provider extends ValidatorService.Provider {\n+        public Provider() {\n+            super(DeprecatedTraitsValidator.class, DeprecatedTraitsValidator::new);\n+        }\n+    }\n+\n+    @Override\n+    public List<ValidationEvent> validate(Model model) {\n+        Set<ShapeId> deprecatedTraits = model.shapes()\n+                .filter(shape -> shape.hasTrait(TraitDefinition.class))\n+                .filter(trait -> trait.getTrait(DeprecatedTrait.class).isPresent())\n+                .map(Shape::getId)\n+                .collect(Collectors.toSet());\n+\n+        return model.shapes()\n+                .filter(shape -> !shape.hasTrait(TraitDefinition.class))\n+                .flatMap(nonTraitShape -> validateShape(nonTraitShape, deprecatedTraits).stream())\n+                .collect(Collectors.toList());\n+    }\n+\n+    private List<ValidationEvent> validateShape(Shape shape, Set<ShapeId> deprecatedTraits) {\n+        List<ValidationEvent> events = new ArrayList<>();\n+        shape.getAllTraits().keySet().stream().filter(trait -> deprecatedTraits.contains(trait.toShapeId()))", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MTYwNjczOA=="}, "originalCommit": {"oid": "ea47f366e419ad8f3f9a8821923e8ac47a866ea4"}, "originalPosition": 60}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjM2MjAyMzc3OnYy", "diffSide": "RIGHT", "path": "smithy-linters/src/main/java/software/amazon/smithy/linters/DeprecatedTraitsValidator.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xOVQyMzoyOTo1MFrOFr7eaA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yMFQwMDo0Nzo1OFrOFr86mg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MTYwNzUyOA==", "bodyText": "Don't use .getName(). Show the entire shape ID. Also, you don't need to include the shape ID of the affected shape in the message since that's already part of the validation event. Maybe just say: \"This shape applies a trait that is deprecated: X\". You should probably also include the deprecation message of the @deprecated trait if one is defined.", "url": "https://github.com/awslabs/smithy/pull/279#discussion_r381607528", "createdAt": "2020-02-19T23:29:50Z", "author": {"login": "mtdowling"}, "path": "smithy-linters/src/main/java/software/amazon/smithy/linters/DeprecatedTraitsValidator.java", "diffHunk": "@@ -0,0 +1,66 @@\n+/*\n+ * Copyright 2019 Amazon.com, Inc. or its affiliates. All Rights Reserved.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\").\n+ * You may not use this file except in compliance with the License.\n+ * A copy of the License is located at\n+ *\n+ *  http://aws.amazon.com/apache2.0\n+ *\n+ * or in the \"license\" file accompanying this file. This file is distributed\n+ * on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either\n+ * express or implied. See the License for the specific language governing\n+ * permissions and limitations under the License.\n+ */\n+\n+package software.amazon.smithy.linters;\n+\n+import static java.lang.String.format;\n+\n+import java.util.ArrayList;\n+import java.util.List;\n+import java.util.Set;\n+import java.util.stream.Collectors;\n+import software.amazon.smithy.model.Model;\n+import software.amazon.smithy.model.shapes.Shape;\n+import software.amazon.smithy.model.shapes.ShapeId;\n+import software.amazon.smithy.model.traits.DeprecatedTrait;\n+import software.amazon.smithy.model.traits.TraitDefinition;\n+import software.amazon.smithy.model.validation.AbstractValidator;\n+import software.amazon.smithy.model.validation.ValidationEvent;\n+import software.amazon.smithy.model.validation.ValidatorService;\n+\n+/**\n+ * Emits a validation event if a model contains shapes that are bound to deprecated traits.\n+ */\n+public final class DeprecatedTraitsValidator extends AbstractValidator {\n+\n+    public static final class Provider extends ValidatorService.Provider {\n+        public Provider() {\n+            super(DeprecatedTraitsValidator.class, DeprecatedTraitsValidator::new);\n+        }\n+    }\n+\n+    @Override\n+    public List<ValidationEvent> validate(Model model) {\n+        Set<ShapeId> deprecatedTraits = model.shapes()\n+                .filter(shape -> shape.hasTrait(TraitDefinition.class))\n+                .filter(trait -> trait.getTrait(DeprecatedTrait.class).isPresent())\n+                .map(Shape::getId)\n+                .collect(Collectors.toSet());\n+\n+        return model.shapes()\n+                .filter(shape -> !shape.hasTrait(TraitDefinition.class))\n+                .flatMap(nonTraitShape -> validateShape(nonTraitShape, deprecatedTraits).stream())\n+                .collect(Collectors.toList());\n+    }\n+\n+    private List<ValidationEvent> validateShape(Shape shape, Set<ShapeId> deprecatedTraits) {\n+        List<ValidationEvent> events = new ArrayList<>();\n+        shape.getAllTraits().keySet().stream().filter(trait -> deprecatedTraits.contains(trait.toShapeId()))\n+                .map(boundDeprecatedTrait -> warning(shape, format(\"Shape `%s` uses deprecated trait: %s\",\n+                        shape.getId().getName(), boundDeprecatedTrait.getName())))", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ea47f366e419ad8f3f9a8821923e8ac47a866ea4"}, "originalPosition": 62}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MTYzMTEzMA==", "bodyText": "Added message if present on @deprecated trait.", "url": "https://github.com/awslabs/smithy/pull/279#discussion_r381631130", "createdAt": "2020-02-20T00:47:58Z", "author": {"login": "srchase"}, "path": "smithy-linters/src/main/java/software/amazon/smithy/linters/DeprecatedTraitsValidator.java", "diffHunk": "@@ -0,0 +1,66 @@\n+/*\n+ * Copyright 2019 Amazon.com, Inc. or its affiliates. All Rights Reserved.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\").\n+ * You may not use this file except in compliance with the License.\n+ * A copy of the License is located at\n+ *\n+ *  http://aws.amazon.com/apache2.0\n+ *\n+ * or in the \"license\" file accompanying this file. This file is distributed\n+ * on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either\n+ * express or implied. See the License for the specific language governing\n+ * permissions and limitations under the License.\n+ */\n+\n+package software.amazon.smithy.linters;\n+\n+import static java.lang.String.format;\n+\n+import java.util.ArrayList;\n+import java.util.List;\n+import java.util.Set;\n+import java.util.stream.Collectors;\n+import software.amazon.smithy.model.Model;\n+import software.amazon.smithy.model.shapes.Shape;\n+import software.amazon.smithy.model.shapes.ShapeId;\n+import software.amazon.smithy.model.traits.DeprecatedTrait;\n+import software.amazon.smithy.model.traits.TraitDefinition;\n+import software.amazon.smithy.model.validation.AbstractValidator;\n+import software.amazon.smithy.model.validation.ValidationEvent;\n+import software.amazon.smithy.model.validation.ValidatorService;\n+\n+/**\n+ * Emits a validation event if a model contains shapes that are bound to deprecated traits.\n+ */\n+public final class DeprecatedTraitsValidator extends AbstractValidator {\n+\n+    public static final class Provider extends ValidatorService.Provider {\n+        public Provider() {\n+            super(DeprecatedTraitsValidator.class, DeprecatedTraitsValidator::new);\n+        }\n+    }\n+\n+    @Override\n+    public List<ValidationEvent> validate(Model model) {\n+        Set<ShapeId> deprecatedTraits = model.shapes()\n+                .filter(shape -> shape.hasTrait(TraitDefinition.class))\n+                .filter(trait -> trait.getTrait(DeprecatedTrait.class).isPresent())\n+                .map(Shape::getId)\n+                .collect(Collectors.toSet());\n+\n+        return model.shapes()\n+                .filter(shape -> !shape.hasTrait(TraitDefinition.class))\n+                .flatMap(nonTraitShape -> validateShape(nonTraitShape, deprecatedTraits).stream())\n+                .collect(Collectors.toList());\n+    }\n+\n+    private List<ValidationEvent> validateShape(Shape shape, Set<ShapeId> deprecatedTraits) {\n+        List<ValidationEvent> events = new ArrayList<>();\n+        shape.getAllTraits().keySet().stream().filter(trait -> deprecatedTraits.contains(trait.toShapeId()))\n+                .map(boundDeprecatedTrait -> warning(shape, format(\"Shape `%s` uses deprecated trait: %s\",\n+                        shape.getId().getName(), boundDeprecatedTrait.getName())))", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MTYwNzUyOA=="}, "originalCommit": {"oid": "ea47f366e419ad8f3f9a8821923e8ac47a866ea4"}, "originalPosition": 62}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjM2MjE5ODYxOnYy", "diffSide": "RIGHT", "path": "smithy-linters/src/main/java/software/amazon/smithy/linters/DeprecatedTraitsValidator.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yMFQwMTowMDo1M1rOFr9I3g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yMFQxNjoxMTo1NlrOFsZqJw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MTYzNDc4Mg==", "bodyText": "No need to use .get() here. Use expectTrait(DeprecatedTrait.class).\nDeprecatedTrait deprecatedTrait = model.expectShape(trait.toShapeId()).expectTrait(DeprecatedTrait.class)", "url": "https://github.com/awslabs/smithy/pull/279#discussion_r381634782", "createdAt": "2020-02-20T01:00:53Z", "author": {"login": "mtdowling"}, "path": "smithy-linters/src/main/java/software/amazon/smithy/linters/DeprecatedTraitsValidator.java", "diffHunk": "@@ -0,0 +1,72 @@\n+/*\n+ * Copyright 2019 Amazon.com, Inc. or its affiliates. All Rights Reserved.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\").\n+ * You may not use this file except in compliance with the License.\n+ * A copy of the License is located at\n+ *\n+ *  http://aws.amazon.com/apache2.0\n+ *\n+ * or in the \"license\" file accompanying this file. This file is distributed\n+ * on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either\n+ * express or implied. See the License for the specific language governing\n+ * permissions and limitations under the License.\n+ */\n+\n+package software.amazon.smithy.linters;\n+\n+import static java.lang.String.format;\n+\n+import java.util.ArrayList;\n+import java.util.List;\n+import java.util.Set;\n+import java.util.stream.Collectors;\n+import software.amazon.smithy.model.Model;\n+import software.amazon.smithy.model.shapes.Shape;\n+import software.amazon.smithy.model.shapes.ShapeId;\n+import software.amazon.smithy.model.traits.DeprecatedTrait;\n+import software.amazon.smithy.model.traits.TraitDefinition;\n+import software.amazon.smithy.model.validation.AbstractValidator;\n+import software.amazon.smithy.model.validation.ValidationEvent;\n+import software.amazon.smithy.model.validation.ValidatorService;\n+\n+/**\n+ * Emits a validation event if a model contains shapes that are bound to deprecated traits.\n+ */\n+public final class DeprecatedTraitsValidator extends AbstractValidator {\n+\n+    public static final class Provider extends ValidatorService.Provider {\n+        public Provider() {\n+            super(DeprecatedTraitsValidator.class, DeprecatedTraitsValidator::new);\n+        }\n+    }\n+\n+    @Override\n+    public List<ValidationEvent> validate(Model model) {\n+        Set<ShapeId> deprecatedTraits = model.shapes()\n+                .filter(shape -> shape.hasTrait(TraitDefinition.class))\n+                .filter(trait -> trait.hasTrait(DeprecatedTrait.class))\n+                .map(Shape::getId)\n+                .collect(Collectors.toSet());\n+\n+        return model.shapes()\n+                .flatMap(shape -> validateShape(model, shape, deprecatedTraits).stream())\n+                .collect(Collectors.toList());\n+    }\n+\n+    private List<ValidationEvent> validateShape(Model model, Shape shape, Set<ShapeId> deprecatedTraits) {\n+        List<ValidationEvent> events = new ArrayList<>();\n+        shape.getAllTraits().forEach((shapeId, trait) -> {\n+            if (deprecatedTraits.contains(trait.toShapeId())) {\n+                DeprecatedTrait deprecatedTrait = model.expectShape(trait.toShapeId()).getTrait(DeprecatedTrait.class)", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "204cea2f0f50bf783e1ff4a4c2ac05a3640089e7"}, "originalPosition": 61}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MjEwMjA1NQ==", "bodyText": "Fixed.", "url": "https://github.com/awslabs/smithy/pull/279#discussion_r382102055", "createdAt": "2020-02-20T16:11:56Z", "author": {"login": "srchase"}, "path": "smithy-linters/src/main/java/software/amazon/smithy/linters/DeprecatedTraitsValidator.java", "diffHunk": "@@ -0,0 +1,72 @@\n+/*\n+ * Copyright 2019 Amazon.com, Inc. or its affiliates. All Rights Reserved.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\").\n+ * You may not use this file except in compliance with the License.\n+ * A copy of the License is located at\n+ *\n+ *  http://aws.amazon.com/apache2.0\n+ *\n+ * or in the \"license\" file accompanying this file. This file is distributed\n+ * on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either\n+ * express or implied. See the License for the specific language governing\n+ * permissions and limitations under the License.\n+ */\n+\n+package software.amazon.smithy.linters;\n+\n+import static java.lang.String.format;\n+\n+import java.util.ArrayList;\n+import java.util.List;\n+import java.util.Set;\n+import java.util.stream.Collectors;\n+import software.amazon.smithy.model.Model;\n+import software.amazon.smithy.model.shapes.Shape;\n+import software.amazon.smithy.model.shapes.ShapeId;\n+import software.amazon.smithy.model.traits.DeprecatedTrait;\n+import software.amazon.smithy.model.traits.TraitDefinition;\n+import software.amazon.smithy.model.validation.AbstractValidator;\n+import software.amazon.smithy.model.validation.ValidationEvent;\n+import software.amazon.smithy.model.validation.ValidatorService;\n+\n+/**\n+ * Emits a validation event if a model contains shapes that are bound to deprecated traits.\n+ */\n+public final class DeprecatedTraitsValidator extends AbstractValidator {\n+\n+    public static final class Provider extends ValidatorService.Provider {\n+        public Provider() {\n+            super(DeprecatedTraitsValidator.class, DeprecatedTraitsValidator::new);\n+        }\n+    }\n+\n+    @Override\n+    public List<ValidationEvent> validate(Model model) {\n+        Set<ShapeId> deprecatedTraits = model.shapes()\n+                .filter(shape -> shape.hasTrait(TraitDefinition.class))\n+                .filter(trait -> trait.hasTrait(DeprecatedTrait.class))\n+                .map(Shape::getId)\n+                .collect(Collectors.toSet());\n+\n+        return model.shapes()\n+                .flatMap(shape -> validateShape(model, shape, deprecatedTraits).stream())\n+                .collect(Collectors.toList());\n+    }\n+\n+    private List<ValidationEvent> validateShape(Model model, Shape shape, Set<ShapeId> deprecatedTraits) {\n+        List<ValidationEvent> events = new ArrayList<>();\n+        shape.getAllTraits().forEach((shapeId, trait) -> {\n+            if (deprecatedTraits.contains(trait.toShapeId())) {\n+                DeprecatedTrait deprecatedTrait = model.expectShape(trait.toShapeId()).getTrait(DeprecatedTrait.class)", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MTYzNDc4Mg=="}, "originalCommit": {"oid": "204cea2f0f50bf783e1ff4a4c2ac05a3640089e7"}, "originalPosition": 61}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjM2MjIwMTAyOnYy", "diffSide": "RIGHT", "path": "smithy-linters/src/main/java/software/amazon/smithy/linters/DeprecatedTraitsValidator.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yMFQwMTowMjoxN1rOFr9KQw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yMFQxNjoxMTozN1rOFsZpTA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MTYzNTEzOQ==", "bodyText": "Nit: with code like this, you can bail early and remove some nesting:\nif (!deprecatedTraits.contains(trait.toShapeId()) {\n    continue;\n}", "url": "https://github.com/awslabs/smithy/pull/279#discussion_r381635139", "createdAt": "2020-02-20T01:02:17Z", "author": {"login": "mtdowling"}, "path": "smithy-linters/src/main/java/software/amazon/smithy/linters/DeprecatedTraitsValidator.java", "diffHunk": "@@ -0,0 +1,72 @@\n+/*\n+ * Copyright 2019 Amazon.com, Inc. or its affiliates. All Rights Reserved.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\").\n+ * You may not use this file except in compliance with the License.\n+ * A copy of the License is located at\n+ *\n+ *  http://aws.amazon.com/apache2.0\n+ *\n+ * or in the \"license\" file accompanying this file. This file is distributed\n+ * on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either\n+ * express or implied. See the License for the specific language governing\n+ * permissions and limitations under the License.\n+ */\n+\n+package software.amazon.smithy.linters;\n+\n+import static java.lang.String.format;\n+\n+import java.util.ArrayList;\n+import java.util.List;\n+import java.util.Set;\n+import java.util.stream.Collectors;\n+import software.amazon.smithy.model.Model;\n+import software.amazon.smithy.model.shapes.Shape;\n+import software.amazon.smithy.model.shapes.ShapeId;\n+import software.amazon.smithy.model.traits.DeprecatedTrait;\n+import software.amazon.smithy.model.traits.TraitDefinition;\n+import software.amazon.smithy.model.validation.AbstractValidator;\n+import software.amazon.smithy.model.validation.ValidationEvent;\n+import software.amazon.smithy.model.validation.ValidatorService;\n+\n+/**\n+ * Emits a validation event if a model contains shapes that are bound to deprecated traits.\n+ */\n+public final class DeprecatedTraitsValidator extends AbstractValidator {\n+\n+    public static final class Provider extends ValidatorService.Provider {\n+        public Provider() {\n+            super(DeprecatedTraitsValidator.class, DeprecatedTraitsValidator::new);\n+        }\n+    }\n+\n+    @Override\n+    public List<ValidationEvent> validate(Model model) {\n+        Set<ShapeId> deprecatedTraits = model.shapes()\n+                .filter(shape -> shape.hasTrait(TraitDefinition.class))\n+                .filter(trait -> trait.hasTrait(DeprecatedTrait.class))\n+                .map(Shape::getId)\n+                .collect(Collectors.toSet());\n+\n+        return model.shapes()\n+                .flatMap(shape -> validateShape(model, shape, deprecatedTraits).stream())\n+                .collect(Collectors.toList());\n+    }\n+\n+    private List<ValidationEvent> validateShape(Model model, Shape shape, Set<ShapeId> deprecatedTraits) {\n+        List<ValidationEvent> events = new ArrayList<>();\n+        shape.getAllTraits().forEach((shapeId, trait) -> {\n+            if (deprecatedTraits.contains(trait.toShapeId())) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "204cea2f0f50bf783e1ff4a4c2ac05a3640089e7"}, "originalPosition": 60}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MjEwMTgzNg==", "bodyText": "Fixed with return", "url": "https://github.com/awslabs/smithy/pull/279#discussion_r382101836", "createdAt": "2020-02-20T16:11:37Z", "author": {"login": "srchase"}, "path": "smithy-linters/src/main/java/software/amazon/smithy/linters/DeprecatedTraitsValidator.java", "diffHunk": "@@ -0,0 +1,72 @@\n+/*\n+ * Copyright 2019 Amazon.com, Inc. or its affiliates. All Rights Reserved.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\").\n+ * You may not use this file except in compliance with the License.\n+ * A copy of the License is located at\n+ *\n+ *  http://aws.amazon.com/apache2.0\n+ *\n+ * or in the \"license\" file accompanying this file. This file is distributed\n+ * on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either\n+ * express or implied. See the License for the specific language governing\n+ * permissions and limitations under the License.\n+ */\n+\n+package software.amazon.smithy.linters;\n+\n+import static java.lang.String.format;\n+\n+import java.util.ArrayList;\n+import java.util.List;\n+import java.util.Set;\n+import java.util.stream.Collectors;\n+import software.amazon.smithy.model.Model;\n+import software.amazon.smithy.model.shapes.Shape;\n+import software.amazon.smithy.model.shapes.ShapeId;\n+import software.amazon.smithy.model.traits.DeprecatedTrait;\n+import software.amazon.smithy.model.traits.TraitDefinition;\n+import software.amazon.smithy.model.validation.AbstractValidator;\n+import software.amazon.smithy.model.validation.ValidationEvent;\n+import software.amazon.smithy.model.validation.ValidatorService;\n+\n+/**\n+ * Emits a validation event if a model contains shapes that are bound to deprecated traits.\n+ */\n+public final class DeprecatedTraitsValidator extends AbstractValidator {\n+\n+    public static final class Provider extends ValidatorService.Provider {\n+        public Provider() {\n+            super(DeprecatedTraitsValidator.class, DeprecatedTraitsValidator::new);\n+        }\n+    }\n+\n+    @Override\n+    public List<ValidationEvent> validate(Model model) {\n+        Set<ShapeId> deprecatedTraits = model.shapes()\n+                .filter(shape -> shape.hasTrait(TraitDefinition.class))\n+                .filter(trait -> trait.hasTrait(DeprecatedTrait.class))\n+                .map(Shape::getId)\n+                .collect(Collectors.toSet());\n+\n+        return model.shapes()\n+                .flatMap(shape -> validateShape(model, shape, deprecatedTraits).stream())\n+                .collect(Collectors.toList());\n+    }\n+\n+    private List<ValidationEvent> validateShape(Model model, Shape shape, Set<ShapeId> deprecatedTraits) {\n+        List<ValidationEvent> events = new ArrayList<>();\n+        shape.getAllTraits().forEach((shapeId, trait) -> {\n+            if (deprecatedTraits.contains(trait.toShapeId())) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MTYzNTEzOQ=="}, "originalCommit": {"oid": "204cea2f0f50bf783e1ff4a4c2ac05a3640089e7"}, "originalPosition": 60}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjM2MjIwNDMzOnYy", "diffSide": "RIGHT", "path": "smithy-linters/src/main/java/software/amazon/smithy/linters/DeprecatedTraitsValidator.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yMFQwMTowNDoyMlrOFr9MUg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yMFQwMTowNDoyMlrOFr9MUg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MTYzNTY2Ng==", "bodyText": "This should be relative to the trait that was applied to the shape. You can do this by passing then trait in as the second argument.\nevents.add(warning(shape, trait, format(...", "url": "https://github.com/awslabs/smithy/pull/279#discussion_r381635666", "createdAt": "2020-02-20T01:04:22Z", "author": {"login": "mtdowling"}, "path": "smithy-linters/src/main/java/software/amazon/smithy/linters/DeprecatedTraitsValidator.java", "diffHunk": "@@ -0,0 +1,72 @@\n+/*\n+ * Copyright 2019 Amazon.com, Inc. or its affiliates. All Rights Reserved.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\").\n+ * You may not use this file except in compliance with the License.\n+ * A copy of the License is located at\n+ *\n+ *  http://aws.amazon.com/apache2.0\n+ *\n+ * or in the \"license\" file accompanying this file. This file is distributed\n+ * on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either\n+ * express or implied. See the License for the specific language governing\n+ * permissions and limitations under the License.\n+ */\n+\n+package software.amazon.smithy.linters;\n+\n+import static java.lang.String.format;\n+\n+import java.util.ArrayList;\n+import java.util.List;\n+import java.util.Set;\n+import java.util.stream.Collectors;\n+import software.amazon.smithy.model.Model;\n+import software.amazon.smithy.model.shapes.Shape;\n+import software.amazon.smithy.model.shapes.ShapeId;\n+import software.amazon.smithy.model.traits.DeprecatedTrait;\n+import software.amazon.smithy.model.traits.TraitDefinition;\n+import software.amazon.smithy.model.validation.AbstractValidator;\n+import software.amazon.smithy.model.validation.ValidationEvent;\n+import software.amazon.smithy.model.validation.ValidatorService;\n+\n+/**\n+ * Emits a validation event if a model contains shapes that are bound to deprecated traits.\n+ */\n+public final class DeprecatedTraitsValidator extends AbstractValidator {\n+\n+    public static final class Provider extends ValidatorService.Provider {\n+        public Provider() {\n+            super(DeprecatedTraitsValidator.class, DeprecatedTraitsValidator::new);\n+        }\n+    }\n+\n+    @Override\n+    public List<ValidationEvent> validate(Model model) {\n+        Set<ShapeId> deprecatedTraits = model.shapes()\n+                .filter(shape -> shape.hasTrait(TraitDefinition.class))\n+                .filter(trait -> trait.hasTrait(DeprecatedTrait.class))\n+                .map(Shape::getId)\n+                .collect(Collectors.toSet());\n+\n+        return model.shapes()\n+                .flatMap(shape -> validateShape(model, shape, deprecatedTraits).stream())\n+                .collect(Collectors.toList());\n+    }\n+\n+    private List<ValidationEvent> validateShape(Model model, Shape shape, Set<ShapeId> deprecatedTraits) {\n+        List<ValidationEvent> events = new ArrayList<>();\n+        shape.getAllTraits().forEach((shapeId, trait) -> {\n+            if (deprecatedTraits.contains(trait.toShapeId())) {\n+                DeprecatedTrait deprecatedTrait = model.expectShape(trait.toShapeId()).getTrait(DeprecatedTrait.class)\n+                        .get();\n+                String traitMessage = trait.toShapeId().toString();\n+                if (deprecatedTrait.getMessage().isPresent()) {\n+                    traitMessage = traitMessage.concat(\", \" + deprecatedTrait.getMessage().get());\n+                }\n+                events.add(warning(shape, format(\"This shape applies a trait that is deprecated: %s\", traitMessage)));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "204cea2f0f50bf783e1ff4a4c2ac05a3640089e7"}, "originalPosition": 67}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjM2NTcwMTUzOnYy", "diffSide": "RIGHT", "path": "smithy-linters/src/test/resources/software/amazon/smithy/linters/errorfiles/deprecated-traits-validator.json", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yMFQxNzoxODo1M1rOFscIyw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yMFQxODoyOToyM1rOFseZDQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MjE0MjY2Nw==", "bodyText": "Why do you need this?", "url": "https://github.com/awslabs/smithy/pull/279#discussion_r382142667", "createdAt": "2020-02-20T17:18:53Z", "author": {"login": "mtdowling"}, "path": "smithy-linters/src/test/resources/software/amazon/smithy/linters/errorfiles/deprecated-traits-validator.json", "diffHunk": "@@ -0,0 +1,51 @@\n+{\n+  \"smithy\": \"0.5.0\",\n+  \"shapes\": {\n+    \"ns.foo#MyString\": {\n+      \"type\": \"string\",\n+      \"traits\": {\n+        \"ns.foo#fooTrait\": { },\n+        \"ns.foo#barTrait\": { },\n+        \"ns.foo#bazTrait\": { }\n+      }\n+    },\n+    \"ns.foo#fooTrait\": {\n+      \"type\": \"structure\",\n+      \"members\": { },\n+      \"traits\": {\n+        \"smithy.api#deprecated\": { },\n+        \"smithy.api#trait\": {\n+          \"selector\": \"*\"\n+        }\n+      }\n+    },\n+    \"ns.foo#barTrait\": {\n+      \"type\": \"structure\",\n+      \"members\": { },\n+      \"traits\": {\n+        \"smithy.api#deprecated\": {\n+          \"message\": \"This trait is no longer used.\"\n+        },\n+        \"smithy.api#trait\": {\n+          \"selector\": \"*\"\n+        }\n+      }\n+    },\n+    \"ns.foo#bazTrait\": {\n+      \"type\": \"structure\",\n+      \"members\": { },\n+      \"traits\": {\n+        \"smithy.api#trait\": {\n+          \"selector\": \"*\"\n+        }\n+      }\n+    }\n+  },\n+  \"metadata\": {\n+    \"validators\": [", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f0cd7347f7856626787d65683da88585ffc37c0c"}, "originalPosition": 45}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MjE3OTU5Nw==", "bodyText": "Fixed.  Moved to model validation from linters.", "url": "https://github.com/awslabs/smithy/pull/279#discussion_r382179597", "createdAt": "2020-02-20T18:29:23Z", "author": {"login": "srchase"}, "path": "smithy-linters/src/test/resources/software/amazon/smithy/linters/errorfiles/deprecated-traits-validator.json", "diffHunk": "@@ -0,0 +1,51 @@\n+{\n+  \"smithy\": \"0.5.0\",\n+  \"shapes\": {\n+    \"ns.foo#MyString\": {\n+      \"type\": \"string\",\n+      \"traits\": {\n+        \"ns.foo#fooTrait\": { },\n+        \"ns.foo#barTrait\": { },\n+        \"ns.foo#bazTrait\": { }\n+      }\n+    },\n+    \"ns.foo#fooTrait\": {\n+      \"type\": \"structure\",\n+      \"members\": { },\n+      \"traits\": {\n+        \"smithy.api#deprecated\": { },\n+        \"smithy.api#trait\": {\n+          \"selector\": \"*\"\n+        }\n+      }\n+    },\n+    \"ns.foo#barTrait\": {\n+      \"type\": \"structure\",\n+      \"members\": { },\n+      \"traits\": {\n+        \"smithy.api#deprecated\": {\n+          \"message\": \"This trait is no longer used.\"\n+        },\n+        \"smithy.api#trait\": {\n+          \"selector\": \"*\"\n+        }\n+      }\n+    },\n+    \"ns.foo#bazTrait\": {\n+      \"type\": \"structure\",\n+      \"members\": { },\n+      \"traits\": {\n+        \"smithy.api#trait\": {\n+          \"selector\": \"*\"\n+        }\n+      }\n+    }\n+  },\n+  \"metadata\": {\n+    \"validators\": [", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MjE0MjY2Nw=="}, "originalCommit": {"oid": "f0cd7347f7856626787d65683da88585ffc37c0c"}, "originalPosition": 45}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjM2NTcyNzQ2OnYy", "diffSide": "RIGHT", "path": "smithy-linters/src/main/java/software/amazon/smithy/linters/DeprecatedTraitsValidator.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yMFQxNzoyNjozNVrOFscZiA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yMFQxODozMDoyMFrOFsea8A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MjE0Njk1Mg==", "bodyText": "nit: Using concat is odd", "url": "https://github.com/awslabs/smithy/pull/279#discussion_r382146952", "createdAt": "2020-02-20T17:26:35Z", "author": {"login": "mtdowling"}, "path": "smithy-linters/src/main/java/software/amazon/smithy/linters/DeprecatedTraitsValidator.java", "diffHunk": "@@ -0,0 +1,73 @@\n+/*\n+ * Copyright 2019 Amazon.com, Inc. or its affiliates. All Rights Reserved.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\").\n+ * You may not use this file except in compliance with the License.\n+ * A copy of the License is located at\n+ *\n+ *  http://aws.amazon.com/apache2.0\n+ *\n+ * or in the \"license\" file accompanying this file. This file is distributed\n+ * on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either\n+ * express or implied. See the License for the specific language governing\n+ * permissions and limitations under the License.\n+ */\n+\n+package software.amazon.smithy.linters;\n+\n+import static java.lang.String.format;\n+\n+import java.util.ArrayList;\n+import java.util.List;\n+import java.util.Set;\n+import java.util.stream.Collectors;\n+import software.amazon.smithy.model.Model;\n+import software.amazon.smithy.model.shapes.Shape;\n+import software.amazon.smithy.model.shapes.ShapeId;\n+import software.amazon.smithy.model.traits.DeprecatedTrait;\n+import software.amazon.smithy.model.traits.TraitDefinition;\n+import software.amazon.smithy.model.validation.AbstractValidator;\n+import software.amazon.smithy.model.validation.ValidationEvent;\n+import software.amazon.smithy.model.validation.ValidatorService;\n+\n+/**\n+ * Emits a validation event if a model contains shapes that are bound to deprecated traits.\n+ */\n+public final class DeprecatedTraitsValidator extends AbstractValidator {\n+\n+    public static final class Provider extends ValidatorService.Provider {\n+        public Provider() {\n+            super(DeprecatedTraitsValidator.class, DeprecatedTraitsValidator::new);\n+        }\n+    }\n+\n+    @Override\n+    public List<ValidationEvent> validate(Model model) {\n+        Set<ShapeId> deprecatedTraits = model.shapes()\n+                .filter(shape -> shape.hasTrait(TraitDefinition.class))\n+                .filter(trait -> trait.hasTrait(DeprecatedTrait.class))\n+                .map(Shape::getId)\n+                .collect(Collectors.toSet());\n+\n+        return model.shapes()\n+                .flatMap(shape -> validateShape(model, shape, deprecatedTraits).stream())\n+                .collect(Collectors.toList());\n+    }\n+\n+    private List<ValidationEvent> validateShape(Model model, Shape shape, Set<ShapeId> deprecatedTraits) {\n+        List<ValidationEvent> events = new ArrayList<>();\n+        shape.getAllTraits().forEach((shapeId, trait) -> {\n+            if (!deprecatedTraits.contains(trait.toShapeId())) {\n+                return;\n+            }\n+            DeprecatedTrait deprecatedTrait = model.expectShape(trait.toShapeId()).expectTrait(DeprecatedTrait.class);\n+            String traitMessage = trait.toShapeId().toString();\n+            if (deprecatedTrait.getMessage().isPresent()) {\n+                traitMessage = traitMessage.concat(\", \" + deprecatedTrait.getMessage().get());", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f0cd7347f7856626787d65683da88585ffc37c0c"}, "originalPosition": 66}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MjE4MDA4MA==", "bodyText": "Fixed.", "url": "https://github.com/awslabs/smithy/pull/279#discussion_r382180080", "createdAt": "2020-02-20T18:30:20Z", "author": {"login": "srchase"}, "path": "smithy-linters/src/main/java/software/amazon/smithy/linters/DeprecatedTraitsValidator.java", "diffHunk": "@@ -0,0 +1,73 @@\n+/*\n+ * Copyright 2019 Amazon.com, Inc. or its affiliates. All Rights Reserved.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\").\n+ * You may not use this file except in compliance with the License.\n+ * A copy of the License is located at\n+ *\n+ *  http://aws.amazon.com/apache2.0\n+ *\n+ * or in the \"license\" file accompanying this file. This file is distributed\n+ * on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either\n+ * express or implied. See the License for the specific language governing\n+ * permissions and limitations under the License.\n+ */\n+\n+package software.amazon.smithy.linters;\n+\n+import static java.lang.String.format;\n+\n+import java.util.ArrayList;\n+import java.util.List;\n+import java.util.Set;\n+import java.util.stream.Collectors;\n+import software.amazon.smithy.model.Model;\n+import software.amazon.smithy.model.shapes.Shape;\n+import software.amazon.smithy.model.shapes.ShapeId;\n+import software.amazon.smithy.model.traits.DeprecatedTrait;\n+import software.amazon.smithy.model.traits.TraitDefinition;\n+import software.amazon.smithy.model.validation.AbstractValidator;\n+import software.amazon.smithy.model.validation.ValidationEvent;\n+import software.amazon.smithy.model.validation.ValidatorService;\n+\n+/**\n+ * Emits a validation event if a model contains shapes that are bound to deprecated traits.\n+ */\n+public final class DeprecatedTraitsValidator extends AbstractValidator {\n+\n+    public static final class Provider extends ValidatorService.Provider {\n+        public Provider() {\n+            super(DeprecatedTraitsValidator.class, DeprecatedTraitsValidator::new);\n+        }\n+    }\n+\n+    @Override\n+    public List<ValidationEvent> validate(Model model) {\n+        Set<ShapeId> deprecatedTraits = model.shapes()\n+                .filter(shape -> shape.hasTrait(TraitDefinition.class))\n+                .filter(trait -> trait.hasTrait(DeprecatedTrait.class))\n+                .map(Shape::getId)\n+                .collect(Collectors.toSet());\n+\n+        return model.shapes()\n+                .flatMap(shape -> validateShape(model, shape, deprecatedTraits).stream())\n+                .collect(Collectors.toList());\n+    }\n+\n+    private List<ValidationEvent> validateShape(Model model, Shape shape, Set<ShapeId> deprecatedTraits) {\n+        List<ValidationEvent> events = new ArrayList<>();\n+        shape.getAllTraits().forEach((shapeId, trait) -> {\n+            if (!deprecatedTraits.contains(trait.toShapeId())) {\n+                return;\n+            }\n+            DeprecatedTrait deprecatedTrait = model.expectShape(trait.toShapeId()).expectTrait(DeprecatedTrait.class);\n+            String traitMessage = trait.toShapeId().toString();\n+            if (deprecatedTrait.getMessage().isPresent()) {\n+                traitMessage = traitMessage.concat(\", \" + deprecatedTrait.getMessage().get());", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MjE0Njk1Mg=="}, "originalCommit": {"oid": "f0cd7347f7856626787d65683da88585ffc37c0c"}, "originalPosition": 66}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjM2NTcyODk3OnYy", "diffSide": "RIGHT", "path": "smithy-linters/src/main/java/software/amazon/smithy/linters/DeprecatedTraitsValidator.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yMFQxNzoyNzowNlrOFscalQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yMFQxODoyOTo1OFrOFseaRA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MjE0NzIyMQ==", "bodyText": "Just remembered that we have https://github.com/awslabs/smithy/blob/master/smithy-model/src/main/java/software/amazon/smithy/model/Model.java#L178, which should probably be used to reduce the duplicated effort of finding these trait shapes in the model.", "url": "https://github.com/awslabs/smithy/pull/279#discussion_r382147221", "createdAt": "2020-02-20T17:27:06Z", "author": {"login": "mtdowling"}, "path": "smithy-linters/src/main/java/software/amazon/smithy/linters/DeprecatedTraitsValidator.java", "diffHunk": "@@ -0,0 +1,73 @@\n+/*\n+ * Copyright 2019 Amazon.com, Inc. or its affiliates. All Rights Reserved.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\").\n+ * You may not use this file except in compliance with the License.\n+ * A copy of the License is located at\n+ *\n+ *  http://aws.amazon.com/apache2.0\n+ *\n+ * or in the \"license\" file accompanying this file. This file is distributed\n+ * on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either\n+ * express or implied. See the License for the specific language governing\n+ * permissions and limitations under the License.\n+ */\n+\n+package software.amazon.smithy.linters;\n+\n+import static java.lang.String.format;\n+\n+import java.util.ArrayList;\n+import java.util.List;\n+import java.util.Set;\n+import java.util.stream.Collectors;\n+import software.amazon.smithy.model.Model;\n+import software.amazon.smithy.model.shapes.Shape;\n+import software.amazon.smithy.model.shapes.ShapeId;\n+import software.amazon.smithy.model.traits.DeprecatedTrait;\n+import software.amazon.smithy.model.traits.TraitDefinition;\n+import software.amazon.smithy.model.validation.AbstractValidator;\n+import software.amazon.smithy.model.validation.ValidationEvent;\n+import software.amazon.smithy.model.validation.ValidatorService;\n+\n+/**\n+ * Emits a validation event if a model contains shapes that are bound to deprecated traits.\n+ */\n+public final class DeprecatedTraitsValidator extends AbstractValidator {\n+\n+    public static final class Provider extends ValidatorService.Provider {\n+        public Provider() {\n+            super(DeprecatedTraitsValidator.class, DeprecatedTraitsValidator::new);\n+        }\n+    }\n+\n+    @Override\n+    public List<ValidationEvent> validate(Model model) {\n+        Set<ShapeId> deprecatedTraits = model.shapes()", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f0cd7347f7856626787d65683da88585ffc37c0c"}, "originalPosition": 46}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MjE3OTkwOA==", "bodyText": "Thanks. Swapped to getTraitShapes.", "url": "https://github.com/awslabs/smithy/pull/279#discussion_r382179908", "createdAt": "2020-02-20T18:29:58Z", "author": {"login": "srchase"}, "path": "smithy-linters/src/main/java/software/amazon/smithy/linters/DeprecatedTraitsValidator.java", "diffHunk": "@@ -0,0 +1,73 @@\n+/*\n+ * Copyright 2019 Amazon.com, Inc. or its affiliates. All Rights Reserved.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\").\n+ * You may not use this file except in compliance with the License.\n+ * A copy of the License is located at\n+ *\n+ *  http://aws.amazon.com/apache2.0\n+ *\n+ * or in the \"license\" file accompanying this file. This file is distributed\n+ * on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either\n+ * express or implied. See the License for the specific language governing\n+ * permissions and limitations under the License.\n+ */\n+\n+package software.amazon.smithy.linters;\n+\n+import static java.lang.String.format;\n+\n+import java.util.ArrayList;\n+import java.util.List;\n+import java.util.Set;\n+import java.util.stream.Collectors;\n+import software.amazon.smithy.model.Model;\n+import software.amazon.smithy.model.shapes.Shape;\n+import software.amazon.smithy.model.shapes.ShapeId;\n+import software.amazon.smithy.model.traits.DeprecatedTrait;\n+import software.amazon.smithy.model.traits.TraitDefinition;\n+import software.amazon.smithy.model.validation.AbstractValidator;\n+import software.amazon.smithy.model.validation.ValidationEvent;\n+import software.amazon.smithy.model.validation.ValidatorService;\n+\n+/**\n+ * Emits a validation event if a model contains shapes that are bound to deprecated traits.\n+ */\n+public final class DeprecatedTraitsValidator extends AbstractValidator {\n+\n+    public static final class Provider extends ValidatorService.Provider {\n+        public Provider() {\n+            super(DeprecatedTraitsValidator.class, DeprecatedTraitsValidator::new);\n+        }\n+    }\n+\n+    @Override\n+    public List<ValidationEvent> validate(Model model) {\n+        Set<ShapeId> deprecatedTraits = model.shapes()", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MjE0NzIyMQ=="}, "originalCommit": {"oid": "f0cd7347f7856626787d65683da88585ffc37c0c"}, "originalPosition": 46}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3842, "cost": 1, "resetAt": "2021-11-12T11:18:39Z"}}}