{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0Mzc3MzMwOTAy", "number": 279, "title": "Emit warnings for deprecated traits", "bodyText": "Adds DeprecatedTraitsValidator that emits warnings when a model contains shapes that apply deprecated traits.\nBy submitting this pull request, I confirm that my contribution is made under the terms of the Apache 2.0 license.", "createdAt": "2020-02-19T18:46:37Z", "url": "https://github.com/awslabs/smithy/pull/279", "merged": true, "mergeCommit": {"oid": "979fb3b6fb6b941400629bdb7cfdcd315c08371c"}, "closed": true, "closedAt": "2020-02-20T22:02:54Z", "author": {"login": "srchase"}, "timelineItems": {"totalCount": 12, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcF7EovAH2gAyMzc3MzMwOTAyOjlhMjM3NDdjMzFkNGFjODE3Y2M4ZjBiYjFhYWQ5ZTY4NTAwZTQ0OTA=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcGR6mKgFqTM2MjI0MjY5Mw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "9a23747c31d4ac817cc8f0bb1aad9e68500e4490", "author": {"user": {"login": "srchase", "name": "Chase Coalwell"}}, "url": "https://github.com/awslabs/smithy/commit/9a23747c31d4ac817cc8f0bb1aad9e68500e4490", "committedDate": "2020-02-19T18:45:10Z", "message": "Emit warnings for deprecated traits"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzYxMzQ1NzE5", "url": "https://github.com/awslabs/smithy/pull/279#pullrequestreview-361345719", "createdAt": "2020-02-19T18:48:07Z", "commit": {"oid": "9a23747c31d4ac817cc8f0bb1aad9e68500e4490"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xOVQxODo0ODowN1rOFrzRfA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xOVQxODo1Mjo1NlrOFrzb9Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MTQ3MzE0OA==", "bodyText": "hasTrait?", "url": "https://github.com/awslabs/smithy/pull/279#discussion_r381473148", "createdAt": "2020-02-19T18:48:07Z", "author": {"login": "mtdowling"}, "path": "smithy-linters/src/main/java/software/amazon/smithy/linters/DeprecatedTraitsValidator.java", "diffHunk": "@@ -0,0 +1,50 @@\n+/*\n+ * Copyright 2019 Amazon.com, Inc. or its affiliates. All Rights Reserved.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\").\n+ * You may not use this file except in compliance with the License.\n+ * A copy of the License is located at\n+ *\n+ *  http://aws.amazon.com/apache2.0\n+ *\n+ * or in the \"license\" file accompanying this file. This file is distributed\n+ * on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either\n+ * express or implied. See the License for the specific language governing\n+ * permissions and limitations under the License.\n+ */\n+\n+package software.amazon.smithy.linters;\n+\n+import static java.lang.String.format;\n+\n+import java.util.List;\n+import java.util.stream.Collectors;\n+import software.amazon.smithy.model.Model;\n+import software.amazon.smithy.model.traits.DeprecatedTrait;\n+import software.amazon.smithy.model.traits.TraitDefinition;\n+import software.amazon.smithy.model.validation.AbstractValidator;\n+import software.amazon.smithy.model.validation.ValidationEvent;\n+import software.amazon.smithy.model.validation.ValidatorService;\n+\n+/**\n+ * Emits a validation event if a model contains a trait that has been marked as deprecated.\n+ */\n+public final class DeprecatedTraitsValidator extends AbstractValidator {\n+\n+    public static final class Provider extends ValidatorService.Provider {\n+        public Provider() {\n+            super(DeprecatedTraitsValidator.class, DeprecatedTraitsValidator::new);\n+        }\n+    }\n+\n+    @Override\n+    public List<ValidationEvent> validate(Model model) {\n+\n+        return model.shapes()\n+                .filter(shape -> shape.hasTrait(TraitDefinition.class))\n+                .filter(trait -> trait.getTrait(DeprecatedTrait.class).isPresent())", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "9a23747c31d4ac817cc8f0bb1aad9e68500e4490"}, "originalPosition": 45}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MTQ3NDA5OQ==", "bodyText": "For consistency, we usually wrap shape IDs in backticks.\nI'd how the entire shape ID, not just the name.", "url": "https://github.com/awslabs/smithy/pull/279#discussion_r381474099", "createdAt": "2020-02-19T18:49:54Z", "author": {"login": "mtdowling"}, "path": "smithy-linters/src/main/java/software/amazon/smithy/linters/DeprecatedTraitsValidator.java", "diffHunk": "@@ -0,0 +1,50 @@\n+/*\n+ * Copyright 2019 Amazon.com, Inc. or its affiliates. All Rights Reserved.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\").\n+ * You may not use this file except in compliance with the License.\n+ * A copy of the License is located at\n+ *\n+ *  http://aws.amazon.com/apache2.0\n+ *\n+ * or in the \"license\" file accompanying this file. This file is distributed\n+ * on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either\n+ * express or implied. See the License for the specific language governing\n+ * permissions and limitations under the License.\n+ */\n+\n+package software.amazon.smithy.linters;\n+\n+import static java.lang.String.format;\n+\n+import java.util.List;\n+import java.util.stream.Collectors;\n+import software.amazon.smithy.model.Model;\n+import software.amazon.smithy.model.traits.DeprecatedTrait;\n+import software.amazon.smithy.model.traits.TraitDefinition;\n+import software.amazon.smithy.model.validation.AbstractValidator;\n+import software.amazon.smithy.model.validation.ValidationEvent;\n+import software.amazon.smithy.model.validation.ValidatorService;\n+\n+/**\n+ * Emits a validation event if a model contains a trait that has been marked as deprecated.\n+ */\n+public final class DeprecatedTraitsValidator extends AbstractValidator {\n+\n+    public static final class Provider extends ValidatorService.Provider {\n+        public Provider() {\n+            super(DeprecatedTraitsValidator.class, DeprecatedTraitsValidator::new);\n+        }\n+    }\n+\n+    @Override\n+    public List<ValidationEvent> validate(Model model) {\n+\n+        return model.shapes()\n+                .filter(shape -> shape.hasTrait(TraitDefinition.class))\n+                .filter(trait -> trait.getTrait(DeprecatedTrait.class).isPresent())\n+                .map(deprecatedTrait -> warning(deprecatedTrait, format(\"The %s trait is deprecated.\",", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "9a23747c31d4ac817cc8f0bb1aad9e68500e4490"}, "originalPosition": 46}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MTQ3NDM0NA==", "bodyText": "This isn't needed. The DeprecatedTraits validator should always run.\nYou're also missing a META-INF/services entry for your validator.", "url": "https://github.com/awslabs/smithy/pull/279#discussion_r381474344", "createdAt": "2020-02-19T18:50:23Z", "author": {"login": "mtdowling"}, "path": "smithy-linters/src/test/resources/software/amazon/smithy/linters/errorfiles/deprecated-traits-validator.json", "diffHunk": "@@ -0,0 +1,29 @@\n+{\n+  \"smithy\": \"0.5.0\",\n+  \"shapes\": {\n+    \"ns.foo#MyString\": {\n+      \"type\": \"string\",\n+      \"traits\": {\n+        \"ns.foo#myTraitName\": { }\n+      }\n+    },\n+    \"ns.foo#myTraitName\": {\n+      \"type\": \"structure\",\n+      \"members\": { },\n+      \"traits\": {\n+        \"smithy.api#deprecated\": { },\n+        \"smithy.api#trait\": {\n+          \"selector\": \"*\"\n+        }\n+      }\n+    }\n+  },\n+  \"metadata\": {\n+    \"validators\": [\n+      {\n+        \"id\": \"Deprecated Traits\",\n+        \"name\": \"DeprecatedTraits\"", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "9a23747c31d4ac817cc8f0bb1aad9e68500e4490"}, "originalPosition": 25}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MTQ3NDkxMA==", "bodyText": "This should be applied to the shape that used the deprecated trait, not the deprecated trait itself. When I see this warning, I need to know what shape the trait was applied to and what trait was applied.", "url": "https://github.com/awslabs/smithy/pull/279#discussion_r381474910", "createdAt": "2020-02-19T18:51:27Z", "author": {"login": "mtdowling"}, "path": "smithy-linters/src/test/resources/software/amazon/smithy/linters/errorfiles/deprecated-traits-validator.errors", "diffHunk": "@@ -0,0 +1 @@\n+[WARNING] ns.foo#myTraitName: The myTraitName trait is deprecated. | Deprecated Traits", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "9a23747c31d4ac817cc8f0bb1aad9e68500e4490"}, "originalPosition": 1}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MTQ3NTgyOQ==", "bodyText": "This isn't actually detecting when a trait that's marked as deprecated is applied to a shape.\nYou probably need to first get a set of all the shape IDs that are both traits and deprected. Then you would need to emit validation events for every shape that uses any of the deprecated shape IDs.", "url": "https://github.com/awslabs/smithy/pull/279#discussion_r381475829", "createdAt": "2020-02-19T18:52:56Z", "author": {"login": "mtdowling"}, "path": "smithy-linters/src/main/java/software/amazon/smithy/linters/DeprecatedTraitsValidator.java", "diffHunk": "@@ -0,0 +1,50 @@\n+/*\n+ * Copyright 2019 Amazon.com, Inc. or its affiliates. All Rights Reserved.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\").\n+ * You may not use this file except in compliance with the License.\n+ * A copy of the License is located at\n+ *\n+ *  http://aws.amazon.com/apache2.0\n+ *\n+ * or in the \"license\" file accompanying this file. This file is distributed\n+ * on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either\n+ * express or implied. See the License for the specific language governing\n+ * permissions and limitations under the License.\n+ */\n+\n+package software.amazon.smithy.linters;\n+\n+import static java.lang.String.format;\n+\n+import java.util.List;\n+import java.util.stream.Collectors;\n+import software.amazon.smithy.model.Model;\n+import software.amazon.smithy.model.traits.DeprecatedTrait;\n+import software.amazon.smithy.model.traits.TraitDefinition;\n+import software.amazon.smithy.model.validation.AbstractValidator;\n+import software.amazon.smithy.model.validation.ValidationEvent;\n+import software.amazon.smithy.model.validation.ValidatorService;\n+\n+/**\n+ * Emits a validation event if a model contains a trait that has been marked as deprecated.\n+ */\n+public final class DeprecatedTraitsValidator extends AbstractValidator {\n+\n+    public static final class Provider extends ValidatorService.Provider {\n+        public Provider() {\n+            super(DeprecatedTraitsValidator.class, DeprecatedTraitsValidator::new);\n+        }\n+    }\n+\n+    @Override\n+    public List<ValidationEvent> validate(Model model) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "9a23747c31d4ac817cc8f0bb1aad9e68500e4490"}, "originalPosition": 41}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "8abdbc1717b2d6becd5b938d980480d16de8fd92", "author": {"user": {"login": "srchase", "name": "Chase Coalwell"}}, "url": "https://github.com/awslabs/smithy/commit/8abdbc1717b2d6becd5b938d980480d16de8fd92", "committedDate": "2020-02-19T23:10:28Z", "message": "Emit on shapes with deprecated traits"}, "afterCommit": {"oid": "934de90a7cabc37ea91f371ec24d399d8b6c8276", "author": {"user": {"login": "srchase", "name": "Chase Coalwell"}}, "url": "https://github.com/awslabs/smithy/commit/934de90a7cabc37ea91f371ec24d399d8b6c8276", "committedDate": "2020-02-19T23:15:59Z", "message": "Emit on shapes with deprecated traits"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ea47f366e419ad8f3f9a8821923e8ac47a866ea4", "author": {"user": {"login": "srchase", "name": "Chase Coalwell"}}, "url": "https://github.com/awslabs/smithy/commit/ea47f366e419ad8f3f9a8821923e8ac47a866ea4", "committedDate": "2020-02-19T23:17:07Z", "message": "Emit on shapes with deprecated traits"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "934de90a7cabc37ea91f371ec24d399d8b6c8276", "author": {"user": {"login": "srchase", "name": "Chase Coalwell"}}, "url": "https://github.com/awslabs/smithy/commit/934de90a7cabc37ea91f371ec24d399d8b6c8276", "committedDate": "2020-02-19T23:15:59Z", "message": "Emit on shapes with deprecated traits"}, "afterCommit": {"oid": "ea47f366e419ad8f3f9a8821923e8ac47a866ea4", "author": {"user": {"login": "srchase", "name": "Chase Coalwell"}}, "url": "https://github.com/awslabs/smithy/commit/ea47f366e419ad8f3f9a8821923e8ac47a866ea4", "committedDate": "2020-02-19T23:17:07Z", "message": "Emit on shapes with deprecated traits"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzYxNTEzNTg4", "url": "https://github.com/awslabs/smithy/pull/279#pullrequestreview-361513588", "createdAt": "2020-02-19T23:26:47Z", "commit": {"oid": "ea47f366e419ad8f3f9a8821923e8ac47a866ea4"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xOVQyMzoyNjo0N1rOFr7aZA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xOVQyMzoyOTo1MFrOFr7eaA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MTYwNjUwMA==", "bodyText": "Why filter this here? I think the use of a deprecated trait on any shape is useful.", "url": "https://github.com/awslabs/smithy/pull/279#discussion_r381606500", "createdAt": "2020-02-19T23:26:47Z", "author": {"login": "mtdowling"}, "path": "smithy-linters/src/main/java/software/amazon/smithy/linters/DeprecatedTraitsValidator.java", "diffHunk": "@@ -0,0 +1,66 @@\n+/*\n+ * Copyright 2019 Amazon.com, Inc. or its affiliates. All Rights Reserved.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\").\n+ * You may not use this file except in compliance with the License.\n+ * A copy of the License is located at\n+ *\n+ *  http://aws.amazon.com/apache2.0\n+ *\n+ * or in the \"license\" file accompanying this file. This file is distributed\n+ * on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either\n+ * express or implied. See the License for the specific language governing\n+ * permissions and limitations under the License.\n+ */\n+\n+package software.amazon.smithy.linters;\n+\n+import static java.lang.String.format;\n+\n+import java.util.ArrayList;\n+import java.util.List;\n+import java.util.Set;\n+import java.util.stream.Collectors;\n+import software.amazon.smithy.model.Model;\n+import software.amazon.smithy.model.shapes.Shape;\n+import software.amazon.smithy.model.shapes.ShapeId;\n+import software.amazon.smithy.model.traits.DeprecatedTrait;\n+import software.amazon.smithy.model.traits.TraitDefinition;\n+import software.amazon.smithy.model.validation.AbstractValidator;\n+import software.amazon.smithy.model.validation.ValidationEvent;\n+import software.amazon.smithy.model.validation.ValidatorService;\n+\n+/**\n+ * Emits a validation event if a model contains shapes that are bound to deprecated traits.\n+ */\n+public final class DeprecatedTraitsValidator extends AbstractValidator {\n+\n+    public static final class Provider extends ValidatorService.Provider {\n+        public Provider() {\n+            super(DeprecatedTraitsValidator.class, DeprecatedTraitsValidator::new);\n+        }\n+    }\n+\n+    @Override\n+    public List<ValidationEvent> validate(Model model) {\n+        Set<ShapeId> deprecatedTraits = model.shapes()\n+                .filter(shape -> shape.hasTrait(TraitDefinition.class))\n+                .filter(trait -> trait.getTrait(DeprecatedTrait.class).isPresent())\n+                .map(Shape::getId)\n+                .collect(Collectors.toSet());\n+\n+        return model.shapes()\n+                .filter(shape -> !shape.hasTrait(TraitDefinition.class))", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ea47f366e419ad8f3f9a8821923e8ac47a866ea4"}, "originalPosition": 53}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MTYwNjczOA==", "bodyText": "I'd just use a for loop here. It'll make this code easier to read, and you're already mutating a list in the stream.", "url": "https://github.com/awslabs/smithy/pull/279#discussion_r381606738", "createdAt": "2020-02-19T23:27:30Z", "author": {"login": "mtdowling"}, "path": "smithy-linters/src/main/java/software/amazon/smithy/linters/DeprecatedTraitsValidator.java", "diffHunk": "@@ -0,0 +1,66 @@\n+/*\n+ * Copyright 2019 Amazon.com, Inc. or its affiliates. All Rights Reserved.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\").\n+ * You may not use this file except in compliance with the License.\n+ * A copy of the License is located at\n+ *\n+ *  http://aws.amazon.com/apache2.0\n+ *\n+ * or in the \"license\" file accompanying this file. This file is distributed\n+ * on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either\n+ * express or implied. See the License for the specific language governing\n+ * permissions and limitations under the License.\n+ */\n+\n+package software.amazon.smithy.linters;\n+\n+import static java.lang.String.format;\n+\n+import java.util.ArrayList;\n+import java.util.List;\n+import java.util.Set;\n+import java.util.stream.Collectors;\n+import software.amazon.smithy.model.Model;\n+import software.amazon.smithy.model.shapes.Shape;\n+import software.amazon.smithy.model.shapes.ShapeId;\n+import software.amazon.smithy.model.traits.DeprecatedTrait;\n+import software.amazon.smithy.model.traits.TraitDefinition;\n+import software.amazon.smithy.model.validation.AbstractValidator;\n+import software.amazon.smithy.model.validation.ValidationEvent;\n+import software.amazon.smithy.model.validation.ValidatorService;\n+\n+/**\n+ * Emits a validation event if a model contains shapes that are bound to deprecated traits.\n+ */\n+public final class DeprecatedTraitsValidator extends AbstractValidator {\n+\n+    public static final class Provider extends ValidatorService.Provider {\n+        public Provider() {\n+            super(DeprecatedTraitsValidator.class, DeprecatedTraitsValidator::new);\n+        }\n+    }\n+\n+    @Override\n+    public List<ValidationEvent> validate(Model model) {\n+        Set<ShapeId> deprecatedTraits = model.shapes()\n+                .filter(shape -> shape.hasTrait(TraitDefinition.class))\n+                .filter(trait -> trait.getTrait(DeprecatedTrait.class).isPresent())\n+                .map(Shape::getId)\n+                .collect(Collectors.toSet());\n+\n+        return model.shapes()\n+                .filter(shape -> !shape.hasTrait(TraitDefinition.class))\n+                .flatMap(nonTraitShape -> validateShape(nonTraitShape, deprecatedTraits).stream())\n+                .collect(Collectors.toList());\n+    }\n+\n+    private List<ValidationEvent> validateShape(Shape shape, Set<ShapeId> deprecatedTraits) {\n+        List<ValidationEvent> events = new ArrayList<>();\n+        shape.getAllTraits().keySet().stream().filter(trait -> deprecatedTraits.contains(trait.toShapeId()))", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ea47f366e419ad8f3f9a8821923e8ac47a866ea4"}, "originalPosition": 60}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MTYwNzUyOA==", "bodyText": "Don't use .getName(). Show the entire shape ID. Also, you don't need to include the shape ID of the affected shape in the message since that's already part of the validation event. Maybe just say: \"This shape applies a trait that is deprecated: X\". You should probably also include the deprecation message of the @deprecated trait if one is defined.", "url": "https://github.com/awslabs/smithy/pull/279#discussion_r381607528", "createdAt": "2020-02-19T23:29:50Z", "author": {"login": "mtdowling"}, "path": "smithy-linters/src/main/java/software/amazon/smithy/linters/DeprecatedTraitsValidator.java", "diffHunk": "@@ -0,0 +1,66 @@\n+/*\n+ * Copyright 2019 Amazon.com, Inc. or its affiliates. All Rights Reserved.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\").\n+ * You may not use this file except in compliance with the License.\n+ * A copy of the License is located at\n+ *\n+ *  http://aws.amazon.com/apache2.0\n+ *\n+ * or in the \"license\" file accompanying this file. This file is distributed\n+ * on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either\n+ * express or implied. See the License for the specific language governing\n+ * permissions and limitations under the License.\n+ */\n+\n+package software.amazon.smithy.linters;\n+\n+import static java.lang.String.format;\n+\n+import java.util.ArrayList;\n+import java.util.List;\n+import java.util.Set;\n+import java.util.stream.Collectors;\n+import software.amazon.smithy.model.Model;\n+import software.amazon.smithy.model.shapes.Shape;\n+import software.amazon.smithy.model.shapes.ShapeId;\n+import software.amazon.smithy.model.traits.DeprecatedTrait;\n+import software.amazon.smithy.model.traits.TraitDefinition;\n+import software.amazon.smithy.model.validation.AbstractValidator;\n+import software.amazon.smithy.model.validation.ValidationEvent;\n+import software.amazon.smithy.model.validation.ValidatorService;\n+\n+/**\n+ * Emits a validation event if a model contains shapes that are bound to deprecated traits.\n+ */\n+public final class DeprecatedTraitsValidator extends AbstractValidator {\n+\n+    public static final class Provider extends ValidatorService.Provider {\n+        public Provider() {\n+            super(DeprecatedTraitsValidator.class, DeprecatedTraitsValidator::new);\n+        }\n+    }\n+\n+    @Override\n+    public List<ValidationEvent> validate(Model model) {\n+        Set<ShapeId> deprecatedTraits = model.shapes()\n+                .filter(shape -> shape.hasTrait(TraitDefinition.class))\n+                .filter(trait -> trait.getTrait(DeprecatedTrait.class).isPresent())\n+                .map(Shape::getId)\n+                .collect(Collectors.toSet());\n+\n+        return model.shapes()\n+                .filter(shape -> !shape.hasTrait(TraitDefinition.class))\n+                .flatMap(nonTraitShape -> validateShape(nonTraitShape, deprecatedTraits).stream())\n+                .collect(Collectors.toList());\n+    }\n+\n+    private List<ValidationEvent> validateShape(Shape shape, Set<ShapeId> deprecatedTraits) {\n+        List<ValidationEvent> events = new ArrayList<>();\n+        shape.getAllTraits().keySet().stream().filter(trait -> deprecatedTraits.contains(trait.toShapeId()))\n+                .map(boundDeprecatedTrait -> warning(shape, format(\"Shape `%s` uses deprecated trait: %s\",\n+                        shape.getId().getName(), boundDeprecatedTrait.getName())))", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ea47f366e419ad8f3f9a8821923e8ac47a866ea4"}, "originalPosition": 62}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "204cea2f0f50bf783e1ff4a4c2ac05a3640089e7", "author": {"user": {"login": "srchase", "name": "Chase Coalwell"}}, "url": "https://github.com/awslabs/smithy/commit/204cea2f0f50bf783e1ff4a4c2ac05a3640089e7", "committedDate": "2020-02-20T00:45:45Z", "message": "Include message if present"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzYxNTUyMzA4", "url": "https://github.com/awslabs/smithy/pull/279#pullrequestreview-361552308", "createdAt": "2020-02-20T01:00:53Z", "commit": {"oid": "204cea2f0f50bf783e1ff4a4c2ac05a3640089e7"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yMFQwMTowMDo1M1rOFr9I3g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yMFQwMTowNDoyMlrOFr9MUg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MTYzNDc4Mg==", "bodyText": "No need to use .get() here. Use expectTrait(DeprecatedTrait.class).\nDeprecatedTrait deprecatedTrait = model.expectShape(trait.toShapeId()).expectTrait(DeprecatedTrait.class)", "url": "https://github.com/awslabs/smithy/pull/279#discussion_r381634782", "createdAt": "2020-02-20T01:00:53Z", "author": {"login": "mtdowling"}, "path": "smithy-linters/src/main/java/software/amazon/smithy/linters/DeprecatedTraitsValidator.java", "diffHunk": "@@ -0,0 +1,72 @@\n+/*\n+ * Copyright 2019 Amazon.com, Inc. or its affiliates. All Rights Reserved.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\").\n+ * You may not use this file except in compliance with the License.\n+ * A copy of the License is located at\n+ *\n+ *  http://aws.amazon.com/apache2.0\n+ *\n+ * or in the \"license\" file accompanying this file. This file is distributed\n+ * on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either\n+ * express or implied. See the License for the specific language governing\n+ * permissions and limitations under the License.\n+ */\n+\n+package software.amazon.smithy.linters;\n+\n+import static java.lang.String.format;\n+\n+import java.util.ArrayList;\n+import java.util.List;\n+import java.util.Set;\n+import java.util.stream.Collectors;\n+import software.amazon.smithy.model.Model;\n+import software.amazon.smithy.model.shapes.Shape;\n+import software.amazon.smithy.model.shapes.ShapeId;\n+import software.amazon.smithy.model.traits.DeprecatedTrait;\n+import software.amazon.smithy.model.traits.TraitDefinition;\n+import software.amazon.smithy.model.validation.AbstractValidator;\n+import software.amazon.smithy.model.validation.ValidationEvent;\n+import software.amazon.smithy.model.validation.ValidatorService;\n+\n+/**\n+ * Emits a validation event if a model contains shapes that are bound to deprecated traits.\n+ */\n+public final class DeprecatedTraitsValidator extends AbstractValidator {\n+\n+    public static final class Provider extends ValidatorService.Provider {\n+        public Provider() {\n+            super(DeprecatedTraitsValidator.class, DeprecatedTraitsValidator::new);\n+        }\n+    }\n+\n+    @Override\n+    public List<ValidationEvent> validate(Model model) {\n+        Set<ShapeId> deprecatedTraits = model.shapes()\n+                .filter(shape -> shape.hasTrait(TraitDefinition.class))\n+                .filter(trait -> trait.hasTrait(DeprecatedTrait.class))\n+                .map(Shape::getId)\n+                .collect(Collectors.toSet());\n+\n+        return model.shapes()\n+                .flatMap(shape -> validateShape(model, shape, deprecatedTraits).stream())\n+                .collect(Collectors.toList());\n+    }\n+\n+    private List<ValidationEvent> validateShape(Model model, Shape shape, Set<ShapeId> deprecatedTraits) {\n+        List<ValidationEvent> events = new ArrayList<>();\n+        shape.getAllTraits().forEach((shapeId, trait) -> {\n+            if (deprecatedTraits.contains(trait.toShapeId())) {\n+                DeprecatedTrait deprecatedTrait = model.expectShape(trait.toShapeId()).getTrait(DeprecatedTrait.class)", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "204cea2f0f50bf783e1ff4a4c2ac05a3640089e7"}, "originalPosition": 61}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MTYzNTEzOQ==", "bodyText": "Nit: with code like this, you can bail early and remove some nesting:\nif (!deprecatedTraits.contains(trait.toShapeId()) {\n    continue;\n}", "url": "https://github.com/awslabs/smithy/pull/279#discussion_r381635139", "createdAt": "2020-02-20T01:02:17Z", "author": {"login": "mtdowling"}, "path": "smithy-linters/src/main/java/software/amazon/smithy/linters/DeprecatedTraitsValidator.java", "diffHunk": "@@ -0,0 +1,72 @@\n+/*\n+ * Copyright 2019 Amazon.com, Inc. or its affiliates. All Rights Reserved.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\").\n+ * You may not use this file except in compliance with the License.\n+ * A copy of the License is located at\n+ *\n+ *  http://aws.amazon.com/apache2.0\n+ *\n+ * or in the \"license\" file accompanying this file. This file is distributed\n+ * on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either\n+ * express or implied. See the License for the specific language governing\n+ * permissions and limitations under the License.\n+ */\n+\n+package software.amazon.smithy.linters;\n+\n+import static java.lang.String.format;\n+\n+import java.util.ArrayList;\n+import java.util.List;\n+import java.util.Set;\n+import java.util.stream.Collectors;\n+import software.amazon.smithy.model.Model;\n+import software.amazon.smithy.model.shapes.Shape;\n+import software.amazon.smithy.model.shapes.ShapeId;\n+import software.amazon.smithy.model.traits.DeprecatedTrait;\n+import software.amazon.smithy.model.traits.TraitDefinition;\n+import software.amazon.smithy.model.validation.AbstractValidator;\n+import software.amazon.smithy.model.validation.ValidationEvent;\n+import software.amazon.smithy.model.validation.ValidatorService;\n+\n+/**\n+ * Emits a validation event if a model contains shapes that are bound to deprecated traits.\n+ */\n+public final class DeprecatedTraitsValidator extends AbstractValidator {\n+\n+    public static final class Provider extends ValidatorService.Provider {\n+        public Provider() {\n+            super(DeprecatedTraitsValidator.class, DeprecatedTraitsValidator::new);\n+        }\n+    }\n+\n+    @Override\n+    public List<ValidationEvent> validate(Model model) {\n+        Set<ShapeId> deprecatedTraits = model.shapes()\n+                .filter(shape -> shape.hasTrait(TraitDefinition.class))\n+                .filter(trait -> trait.hasTrait(DeprecatedTrait.class))\n+                .map(Shape::getId)\n+                .collect(Collectors.toSet());\n+\n+        return model.shapes()\n+                .flatMap(shape -> validateShape(model, shape, deprecatedTraits).stream())\n+                .collect(Collectors.toList());\n+    }\n+\n+    private List<ValidationEvent> validateShape(Model model, Shape shape, Set<ShapeId> deprecatedTraits) {\n+        List<ValidationEvent> events = new ArrayList<>();\n+        shape.getAllTraits().forEach((shapeId, trait) -> {\n+            if (deprecatedTraits.contains(trait.toShapeId())) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "204cea2f0f50bf783e1ff4a4c2ac05a3640089e7"}, "originalPosition": 60}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MTYzNTY2Ng==", "bodyText": "This should be relative to the trait that was applied to the shape. You can do this by passing then trait in as the second argument.\nevents.add(warning(shape, trait, format(...", "url": "https://github.com/awslabs/smithy/pull/279#discussion_r381635666", "createdAt": "2020-02-20T01:04:22Z", "author": {"login": "mtdowling"}, "path": "smithy-linters/src/main/java/software/amazon/smithy/linters/DeprecatedTraitsValidator.java", "diffHunk": "@@ -0,0 +1,72 @@\n+/*\n+ * Copyright 2019 Amazon.com, Inc. or its affiliates. All Rights Reserved.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\").\n+ * You may not use this file except in compliance with the License.\n+ * A copy of the License is located at\n+ *\n+ *  http://aws.amazon.com/apache2.0\n+ *\n+ * or in the \"license\" file accompanying this file. This file is distributed\n+ * on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either\n+ * express or implied. See the License for the specific language governing\n+ * permissions and limitations under the License.\n+ */\n+\n+package software.amazon.smithy.linters;\n+\n+import static java.lang.String.format;\n+\n+import java.util.ArrayList;\n+import java.util.List;\n+import java.util.Set;\n+import java.util.stream.Collectors;\n+import software.amazon.smithy.model.Model;\n+import software.amazon.smithy.model.shapes.Shape;\n+import software.amazon.smithy.model.shapes.ShapeId;\n+import software.amazon.smithy.model.traits.DeprecatedTrait;\n+import software.amazon.smithy.model.traits.TraitDefinition;\n+import software.amazon.smithy.model.validation.AbstractValidator;\n+import software.amazon.smithy.model.validation.ValidationEvent;\n+import software.amazon.smithy.model.validation.ValidatorService;\n+\n+/**\n+ * Emits a validation event if a model contains shapes that are bound to deprecated traits.\n+ */\n+public final class DeprecatedTraitsValidator extends AbstractValidator {\n+\n+    public static final class Provider extends ValidatorService.Provider {\n+        public Provider() {\n+            super(DeprecatedTraitsValidator.class, DeprecatedTraitsValidator::new);\n+        }\n+    }\n+\n+    @Override\n+    public List<ValidationEvent> validate(Model model) {\n+        Set<ShapeId> deprecatedTraits = model.shapes()\n+                .filter(shape -> shape.hasTrait(TraitDefinition.class))\n+                .filter(trait -> trait.hasTrait(DeprecatedTrait.class))\n+                .map(Shape::getId)\n+                .collect(Collectors.toSet());\n+\n+        return model.shapes()\n+                .flatMap(shape -> validateShape(model, shape, deprecatedTraits).stream())\n+                .collect(Collectors.toList());\n+    }\n+\n+    private List<ValidationEvent> validateShape(Model model, Shape shape, Set<ShapeId> deprecatedTraits) {\n+        List<ValidationEvent> events = new ArrayList<>();\n+        shape.getAllTraits().forEach((shapeId, trait) -> {\n+            if (deprecatedTraits.contains(trait.toShapeId())) {\n+                DeprecatedTrait deprecatedTrait = model.expectShape(trait.toShapeId()).getTrait(DeprecatedTrait.class)\n+                        .get();\n+                String traitMessage = trait.toShapeId().toString();\n+                if (deprecatedTrait.getMessage().isPresent()) {\n+                    traitMessage = traitMessage.concat(\", \" + deprecatedTrait.getMessage().get());\n+                }\n+                events.add(warning(shape, format(\"This shape applies a trait that is deprecated: %s\", traitMessage)));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "204cea2f0f50bf783e1ff4a4c2ac05a3640089e7"}, "originalPosition": 67}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f0cd7347f7856626787d65683da88585ffc37c0c", "author": {"user": {"login": "srchase", "name": "Chase Coalwell"}}, "url": "https://github.com/awslabs/smithy/commit/f0cd7347f7856626787d65683da88585ffc37c0c", "committedDate": "2020-02-20T16:11:11Z", "message": "Refactor, return early"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzYyMDg2NzIw", "url": "https://github.com/awslabs/smithy/pull/279#pullrequestreview-362086720", "createdAt": "2020-02-20T17:18:53Z", "commit": {"oid": "f0cd7347f7856626787d65683da88585ffc37c0c"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yMFQxNzoxODo1M1rOFscIyw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yMFQxNzoyNzowNlrOFscalQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MjE0MjY2Nw==", "bodyText": "Why do you need this?", "url": "https://github.com/awslabs/smithy/pull/279#discussion_r382142667", "createdAt": "2020-02-20T17:18:53Z", "author": {"login": "mtdowling"}, "path": "smithy-linters/src/test/resources/software/amazon/smithy/linters/errorfiles/deprecated-traits-validator.json", "diffHunk": "@@ -0,0 +1,51 @@\n+{\n+  \"smithy\": \"0.5.0\",\n+  \"shapes\": {\n+    \"ns.foo#MyString\": {\n+      \"type\": \"string\",\n+      \"traits\": {\n+        \"ns.foo#fooTrait\": { },\n+        \"ns.foo#barTrait\": { },\n+        \"ns.foo#bazTrait\": { }\n+      }\n+    },\n+    \"ns.foo#fooTrait\": {\n+      \"type\": \"structure\",\n+      \"members\": { },\n+      \"traits\": {\n+        \"smithy.api#deprecated\": { },\n+        \"smithy.api#trait\": {\n+          \"selector\": \"*\"\n+        }\n+      }\n+    },\n+    \"ns.foo#barTrait\": {\n+      \"type\": \"structure\",\n+      \"members\": { },\n+      \"traits\": {\n+        \"smithy.api#deprecated\": {\n+          \"message\": \"This trait is no longer used.\"\n+        },\n+        \"smithy.api#trait\": {\n+          \"selector\": \"*\"\n+        }\n+      }\n+    },\n+    \"ns.foo#bazTrait\": {\n+      \"type\": \"structure\",\n+      \"members\": { },\n+      \"traits\": {\n+        \"smithy.api#trait\": {\n+          \"selector\": \"*\"\n+        }\n+      }\n+    }\n+  },\n+  \"metadata\": {\n+    \"validators\": [", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f0cd7347f7856626787d65683da88585ffc37c0c"}, "originalPosition": 45}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MjE0Njk1Mg==", "bodyText": "nit: Using concat is odd", "url": "https://github.com/awslabs/smithy/pull/279#discussion_r382146952", "createdAt": "2020-02-20T17:26:35Z", "author": {"login": "mtdowling"}, "path": "smithy-linters/src/main/java/software/amazon/smithy/linters/DeprecatedTraitsValidator.java", "diffHunk": "@@ -0,0 +1,73 @@\n+/*\n+ * Copyright 2019 Amazon.com, Inc. or its affiliates. All Rights Reserved.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\").\n+ * You may not use this file except in compliance with the License.\n+ * A copy of the License is located at\n+ *\n+ *  http://aws.amazon.com/apache2.0\n+ *\n+ * or in the \"license\" file accompanying this file. This file is distributed\n+ * on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either\n+ * express or implied. See the License for the specific language governing\n+ * permissions and limitations under the License.\n+ */\n+\n+package software.amazon.smithy.linters;\n+\n+import static java.lang.String.format;\n+\n+import java.util.ArrayList;\n+import java.util.List;\n+import java.util.Set;\n+import java.util.stream.Collectors;\n+import software.amazon.smithy.model.Model;\n+import software.amazon.smithy.model.shapes.Shape;\n+import software.amazon.smithy.model.shapes.ShapeId;\n+import software.amazon.smithy.model.traits.DeprecatedTrait;\n+import software.amazon.smithy.model.traits.TraitDefinition;\n+import software.amazon.smithy.model.validation.AbstractValidator;\n+import software.amazon.smithy.model.validation.ValidationEvent;\n+import software.amazon.smithy.model.validation.ValidatorService;\n+\n+/**\n+ * Emits a validation event if a model contains shapes that are bound to deprecated traits.\n+ */\n+public final class DeprecatedTraitsValidator extends AbstractValidator {\n+\n+    public static final class Provider extends ValidatorService.Provider {\n+        public Provider() {\n+            super(DeprecatedTraitsValidator.class, DeprecatedTraitsValidator::new);\n+        }\n+    }\n+\n+    @Override\n+    public List<ValidationEvent> validate(Model model) {\n+        Set<ShapeId> deprecatedTraits = model.shapes()\n+                .filter(shape -> shape.hasTrait(TraitDefinition.class))\n+                .filter(trait -> trait.hasTrait(DeprecatedTrait.class))\n+                .map(Shape::getId)\n+                .collect(Collectors.toSet());\n+\n+        return model.shapes()\n+                .flatMap(shape -> validateShape(model, shape, deprecatedTraits).stream())\n+                .collect(Collectors.toList());\n+    }\n+\n+    private List<ValidationEvent> validateShape(Model model, Shape shape, Set<ShapeId> deprecatedTraits) {\n+        List<ValidationEvent> events = new ArrayList<>();\n+        shape.getAllTraits().forEach((shapeId, trait) -> {\n+            if (!deprecatedTraits.contains(trait.toShapeId())) {\n+                return;\n+            }\n+            DeprecatedTrait deprecatedTrait = model.expectShape(trait.toShapeId()).expectTrait(DeprecatedTrait.class);\n+            String traitMessage = trait.toShapeId().toString();\n+            if (deprecatedTrait.getMessage().isPresent()) {\n+                traitMessage = traitMessage.concat(\", \" + deprecatedTrait.getMessage().get());", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f0cd7347f7856626787d65683da88585ffc37c0c"}, "originalPosition": 66}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MjE0NzIyMQ==", "bodyText": "Just remembered that we have https://github.com/awslabs/smithy/blob/master/smithy-model/src/main/java/software/amazon/smithy/model/Model.java#L178, which should probably be used to reduce the duplicated effort of finding these trait shapes in the model.", "url": "https://github.com/awslabs/smithy/pull/279#discussion_r382147221", "createdAt": "2020-02-20T17:27:06Z", "author": {"login": "mtdowling"}, "path": "smithy-linters/src/main/java/software/amazon/smithy/linters/DeprecatedTraitsValidator.java", "diffHunk": "@@ -0,0 +1,73 @@\n+/*\n+ * Copyright 2019 Amazon.com, Inc. or its affiliates. All Rights Reserved.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\").\n+ * You may not use this file except in compliance with the License.\n+ * A copy of the License is located at\n+ *\n+ *  http://aws.amazon.com/apache2.0\n+ *\n+ * or in the \"license\" file accompanying this file. This file is distributed\n+ * on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either\n+ * express or implied. See the License for the specific language governing\n+ * permissions and limitations under the License.\n+ */\n+\n+package software.amazon.smithy.linters;\n+\n+import static java.lang.String.format;\n+\n+import java.util.ArrayList;\n+import java.util.List;\n+import java.util.Set;\n+import java.util.stream.Collectors;\n+import software.amazon.smithy.model.Model;\n+import software.amazon.smithy.model.shapes.Shape;\n+import software.amazon.smithy.model.shapes.ShapeId;\n+import software.amazon.smithy.model.traits.DeprecatedTrait;\n+import software.amazon.smithy.model.traits.TraitDefinition;\n+import software.amazon.smithy.model.validation.AbstractValidator;\n+import software.amazon.smithy.model.validation.ValidationEvent;\n+import software.amazon.smithy.model.validation.ValidatorService;\n+\n+/**\n+ * Emits a validation event if a model contains shapes that are bound to deprecated traits.\n+ */\n+public final class DeprecatedTraitsValidator extends AbstractValidator {\n+\n+    public static final class Provider extends ValidatorService.Provider {\n+        public Provider() {\n+            super(DeprecatedTraitsValidator.class, DeprecatedTraitsValidator::new);\n+        }\n+    }\n+\n+    @Override\n+    public List<ValidationEvent> validate(Model model) {\n+        Set<ShapeId> deprecatedTraits = model.shapes()", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f0cd7347f7856626787d65683da88585ffc37c0c"}, "originalPosition": 46}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "23110bcb368b98e5fee0d2fecff9110133a611b2", "author": {"user": {"login": "srchase", "name": "Chase Coalwell"}}, "url": "https://github.com/awslabs/smithy/commit/23110bcb368b98e5fee0d2fecff9110133a611b2", "committedDate": "2020-02-20T18:28:54Z", "message": "Move to model validation"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzYyMjQyNjkz", "url": "https://github.com/awslabs/smithy/pull/279#pullrequestreview-362242693", "createdAt": "2020-02-20T21:22:01Z", "commit": {"oid": "23110bcb368b98e5fee0d2fecff9110133a611b2"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2313, "cost": 1, "resetAt": "2021-11-01T11:59:11Z"}}}