{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTE3MDA2MTIy", "number": 626, "title": "Don't conflict URI if an endpoint prefix is present", "bodyText": "Two URIs can't conflict if one has an endpoint prefix, or if both have an endpoint prefix that can't resolve to the same prefix.\nBy submitting this pull request, I confirm that my contribution is made under the terms of the Apache 2.0 license.", "createdAt": "2020-11-06T22:18:34Z", "url": "https://github.com/awslabs/smithy/pull/626", "merged": true, "mergeCommit": {"oid": "076547fea82e04491c490b1e0675a6340900ae6f"}, "closed": true, "closedAt": "2020-11-12T23:58:03Z", "author": {"login": "JordonPhillips"}, "timelineItems": {"totalCount": 10, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdZ-iqZgH2gAyNTE3MDA2MTIyOjRlMzYyZTY3M2RhOTE3YWMwZGMwNzE4NTAxODZlZTdjZTVhOTc5Mjg=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdb4txQAFqTUyOTQ3ODI1OQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "4e362e673da917ac0dc071850186ee7ce5a97928", "author": {"user": {"login": "JordonPhillips", "name": "Jordon Phillips"}}, "url": "https://github.com/awslabs/smithy/commit/4e362e673da917ac0dc071850186ee7ce5a97928", "committedDate": "2020-11-06T22:17:19Z", "message": "Don't conflict URI if an endpoint prefix is present"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTI1NjM3NTQ1", "url": "https://github.com/awslabs/smithy/pull/626#pullrequestreview-525637545", "createdAt": "2020-11-07T08:25:27Z", "commit": {"oid": "4e362e673da917ac0dc071850186ee7ce5a97928"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wN1QwODoyNToyN1rOHvGivQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wN1QwODoyNToyN1rOHvGivQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxOTE1MjMxNw==", "bodyText": "?", "url": "https://github.com/awslabs/smithy/pull/626#discussion_r519152317", "createdAt": "2020-11-07T08:25:27Z", "author": {"login": "mtdowling"}, "path": "smithy-model/src/test/resources/software/amazon/smithy/model/errorfiles/validators/http-uri-conflict-validator.json", "diffHunk": "@@ -315,6 +333,120 @@\n                     }\n                 }\n             }\n+        },\n+        \"ns.foo#EndpointPrefixDeconflicts1\": {\n+            \"type\": \"operation\",\n+            \"traits\": {\n+                \"smithy.api#http\": {\n+                    \"uri\": \"/endpoint-prefix\",\n+                    \"method\": \"PUT\"\n+                },\n+                \"smithy.api#endpoint\": {\n+                    \"hostPrefix\": \"prefix.\"\n+                },\n+                \"smithy.api#idempotent\": {}\n+            }\n+        },\n+        \"ns.foo#EndpointPrefixDeconflicts2\": {\n+            \"type\": \"operation\",\n+            \"traits\": {\n+                \"smithy.api#http\": {\n+                    \"uri\": \"/endpoint-prefix\",\n+                    \"method\": \"PUT\"\n+                },\n+                \"smithy.api#idempotent\": {}\n+            }\n+        },\n+        \"ns.foo#PatternDeconflicts1\": {\n+            \"type\": \"operation\",\n+            \"traits\": {\n+                \"smithy.api#http\": {\n+                    \"uri\": \"/endpoint-prefix-pattern-deconflicts\",\n+                    \"method\": \"PUT\"\n+                },\n+                \"smithy.api#endpoint\": {\n+                    \"hostPrefix\": \"label.\"\n+                },\n+                \"smithy.api#idempotent\": {}\n+            }\n+        },\n+        \"ns.foo#PatternDeconflicts2\": {\n+            \"type\": \"operation\",\n+            \"traits\": {\n+                \"smithy.api#http\": {\n+                    \"uri\": \"/endpoint-prefix-pattern-deconflicts\",\n+                    \"method\": \"PUT\"\n+                },\n+                \"smithy.api#endpoint\": {\n+                    \"hostPrefix\": \"{HostLabel}.\"\n+                },\n+                \"smithy.api#idempotent\": {}\n+            },\n+            \"input\": {\n+                \"target\": \"ns.foo#HostLabelInputWithPattern\"\n+            }\n+        },\n+        \"ns.foo#HostLabelInputWithPattern\": {\n+            \"type\": \"structure\",\n+            \"members\": {\n+                \"HostLabel\": {\n+                    \"target\": \"smithy.api#String\",\n+                    \"traits\": {\n+                        \"smithy.api#hostLabel\": {},\n+                        \"smithy.api#pattern\": \"foo\",\n+                        \"smithy.api#required\": {}\n+                    }\n+                }\n+            }\n+        },\n+", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "4e362e673da917ac0dc071850186ee7ce5a97928"}, "originalPosition": 95}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "13da6d9d2c11d3f2c8f11dd595e8edba9d97eb36", "author": {"user": {"login": "JordonPhillips", "name": "Jordon Phillips"}}, "url": "https://github.com/awslabs/smithy/commit/13da6d9d2c11d3f2c8f11dd595e8edba9d97eb36", "committedDate": "2020-11-09T23:58:14Z", "message": "Remove extraneous whitespace"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "14ab195f7dba1f31ba38ae890d4d377ffa4842f8", "author": {"user": {"login": "JordonPhillips", "name": "Jordon Phillips"}}, "url": "https://github.com/awslabs/smithy/commit/14ab195f7dba1f31ba38ae890d4d377ffa4842f8", "committedDate": "2020-11-10T00:19:57Z", "message": "Update http spec"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTI3Njg2NzU2", "url": "https://github.com/awslabs/smithy/pull/626#pullrequestreview-527686756", "createdAt": "2020-11-10T23:21:16Z", "commit": {"oid": "14ab195f7dba1f31ba38ae890d4d377ffa4842f8"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xMFQyMzoyMToxNlrOHwzdtg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xMFQyMzoyMToxNlrOHwzdtg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMDkzNjg4Ng==", "bodyText": "Can we just return a map and state that the map maintains order?", "url": "https://github.com/awslabs/smithy/pull/626#discussion_r520936886", "createdAt": "2020-11-10T23:21:16Z", "author": {"login": "mtdowling"}, "path": "smithy-model/src/main/java/software/amazon/smithy/model/pattern/SmithyPattern.java", "diffHunk": "@@ -111,6 +113,43 @@ public boolean equals(Object other) {\n         return other instanceof SmithyPattern && pattern.equals(((SmithyPattern) other).pattern);\n     }\n \n+    /**\n+     * Gets a list of explicitly conflicting label segments between this\n+     * pattern and another.\n+     *\n+     * @param otherPattern SmithyPattern to check against.\n+     * @return A list of Segment Pairs where each pair represents a conflict\n+     *     and where the left side of the Pair is a segment from this pattern.\n+     */\n+    public List<Pair<Segment, Segment>> getConflictingLabelSegments(SmithyPattern otherPattern) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "14ab195f7dba1f31ba38ae890d4d377ffa4842f8"}, "originalPosition": 28}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTI3Njk1OTE1", "url": "https://github.com/awslabs/smithy/pull/626#pullrequestreview-527695915", "createdAt": "2020-11-10T23:41:56Z", "commit": {"oid": "14ab195f7dba1f31ba38ae890d4d377ffa4842f8"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xMFQyMzo0MTo1NlrOHwz7iQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xMFQyMzo0MTo1NlrOHwz7iQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMDk0NDUyMQ==", "bodyText": "Personal nit: I'd replace this with good old-fashioned looking Java. Maybe it's because the indentation implies that the Optional composition doesn't wrap the streaming composition.", "url": "https://github.com/awslabs/smithy/pull/626#discussion_r520944521", "createdAt": "2020-11-10T23:41:56Z", "author": {"login": "mtdowling"}, "path": "smithy-model/src/main/java/software/amazon/smithy/model/validation/validators/HttpUriConflictValidator.java", "diffHunk": "@@ -159,6 +197,16 @@ private boolean isAllowableConflict(Model model, OperationShape operation, Opera\n                 .collect(Collectors.toMap(Pair::getLeft, Pair::getRight));\n     }\n \n+    private Map<String, Pattern> getHostLabelPatterns(Model model, OperationShape operation) {\n+        return OperationIndex.of(model).getInput(operation)", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "14ab195f7dba1f31ba38ae890d4d377ffa4842f8"}, "originalPosition": 125}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "84ad2c1979a5505cd04483fe46a78aedf457f050", "author": {"user": {"login": "JordonPhillips", "name": "Jordon Phillips"}}, "url": "https://github.com/awslabs/smithy/commit/84ad2c1979a5505cd04483fe46a78aedf457f050", "committedDate": "2020-11-10T23:43:32Z", "message": "Return conflicting labels as map"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "da87684234bc537f37a9284633d983bbd20eba76", "author": {"user": {"login": "JordonPhillips", "name": "Jordon Phillips"}}, "url": "https://github.com/awslabs/smithy/commit/da87684234bc537f37a9284633d983bbd20eba76", "committedDate": "2020-11-10T23:47:55Z", "message": "Pull optional handling apart from input handling"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "cb8454e2aa7b4fc1b46c37c17c5c8ae08e7cf3a8", "author": {"user": {"login": "JordonPhillips", "name": "Jordon Phillips"}}, "url": "https://github.com/awslabs/smithy/commit/cb8454e2aa7b4fc1b46c37c17c5c8ae08e7cf3a8", "committedDate": "2020-11-12T20:09:05Z", "message": "Rename map-based conflict detection"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTI5NDc4MjU5", "url": "https://github.com/awslabs/smithy/pull/626#pullrequestreview-529478259", "createdAt": "2020-11-12T20:37:52Z", "commit": {"oid": "cb8454e2aa7b4fc1b46c37c17c5c8ae08e7cf3a8"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2163, "cost": 1, "resetAt": "2021-11-01T11:59:11Z"}}}