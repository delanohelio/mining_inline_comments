{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDg4NTkyMzk3", "number": 4331, "reviewThreads": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xOFQwNzo0MTozMlrOEk2pvA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xOFQwNzo0MzoxN1rOEk2ryQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzA3MDc5NjEyOnYy", "diffSide": "LEFT", "path": "engine/schema/src/main/resources/META-INF/db/schema-41310to41400.sql", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xOFQwNzo0MTozMlrOHUBsew==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xOFQwNzo0ODoyM1rOHUB5sg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MDc2MTMzOQ==", "bodyText": "why is this moved to another upgrade script? it makes it harder to compare and would imply it will not be needed/used in propriatory 4.13 releases anymore", "url": "https://github.com/apache/cloudstack/pull/4331#discussion_r490761339", "createdAt": "2020-09-18T07:41:32Z", "author": {"login": "DaanHoogland"}, "path": "engine/schema/src/main/resources/META-INF/db/schema-41310to41400.sql", "diffHunk": "@@ -53,33 +53,6 @@ ALTER TABLE `cloud`.`vm_instance` ADD COLUMN `backup_offering_id` bigint unsigne\n ALTER TABLE `cloud`.`vm_instance` ADD COLUMN `backup_external_id` varchar(255) DEFAULT NULL COMMENT 'ID of external backup job or container if any';\n ALTER TABLE `cloud`.`vm_instance` ADD COLUMN `backup_volumes` text DEFAULT NULL COMMENT 'details of backedup volumes';\n \n-ALTER TABLE `cloud`.`image_store` ADD COLUMN `readonly` boolean DEFAULT false COMMENT 'defines status of image store';", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "5d8d69c70146440b2d9dc3585cfe38ee818c1c2d"}, "originalPosition": 4}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MDc2NDcyMg==", "bodyText": "@DaanHoogland  This is related to PR#4053 which merged recently to master where the schema changes were made in old schema file.\nhttps://github.com/apache/cloudstack/pull/4053/files#r490066335", "url": "https://github.com/apache/cloudstack/pull/4331#discussion_r490764722", "createdAt": "2020-09-18T07:48:23Z", "author": {"login": "harikrishna-patnala"}, "path": "engine/schema/src/main/resources/META-INF/db/schema-41310to41400.sql", "diffHunk": "@@ -53,33 +53,6 @@ ALTER TABLE `cloud`.`vm_instance` ADD COLUMN `backup_offering_id` bigint unsigne\n ALTER TABLE `cloud`.`vm_instance` ADD COLUMN `backup_external_id` varchar(255) DEFAULT NULL COMMENT 'ID of external backup job or container if any';\n ALTER TABLE `cloud`.`vm_instance` ADD COLUMN `backup_volumes` text DEFAULT NULL COMMENT 'details of backedup volumes';\n \n-ALTER TABLE `cloud`.`image_store` ADD COLUMN `readonly` boolean DEFAULT false COMMENT 'defines status of image store';", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MDc2MTMzOQ=="}, "originalCommit": {"oid": "5d8d69c70146440b2d9dc3585cfe38ee818c1c2d"}, "originalPosition": 4}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzA3MDgwMTM3OnYy", "diffSide": "RIGHT", "path": "services/secondary-storage/server/src/main/java/org/apache/cloudstack/storage/resource/NfsSecondaryStorageResource.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xOFQwNzo0MzoxOFrOHUBv0A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xOFQwODoxMTo1MVrOHUCrFQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MDc2MjE5Mg==", "bodyText": "please put this condition in a boolean method with a good descriptive name.", "url": "https://github.com/apache/cloudstack/pull/4331#discussion_r490762192", "createdAt": "2020-09-18T07:43:18Z", "author": {"login": "DaanHoogland"}, "path": "services/secondary-storage/server/src/main/java/org/apache/cloudstack/storage/resource/NfsSecondaryStorageResource.java", "diffHunk": "@@ -1049,8 +1049,11 @@ protected Answer execute(CopyCommand cmd) {\n         DataTO destData = cmd.getDestTO();\n         DataStoreTO srcDataStore = srcData.getDataStore();\n         DataStoreTO destDataStore = destData.getDataStore();\n-\n-        if (DataStoreRole.Image == srcDataStore.getRole()  && DataStoreRole.Image == destDataStore.getRole()) {\n+        if (DataStoreRole.Image == srcDataStore.getRole() && DataStoreRole.Image == destDataStore.getRole() &&\n+            srcDataStore instanceof NfsTO && destDataStore instanceof NfsTO &&\n+            ((srcData.getObjectType() == DataObjectType.TEMPLATE && destData.getObjectType() == DataObjectType.TEMPLATE) ||\n+                    (srcData.getObjectType() == DataObjectType.SNAPSHOT && destData.getObjectType() == DataObjectType.SNAPSHOT) ||\n+                    (srcData.getObjectType() == DataObjectType.VOLUME && destData.getObjectType() == DataObjectType.VOLUME))) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "5d8d69c70146440b2d9dc3585cfe38ee818c1c2d"}, "originalPosition": 10}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MDc3NzM2NQ==", "bodyText": "@DaanHoogland extracted the conditional", "url": "https://github.com/apache/cloudstack/pull/4331#discussion_r490777365", "createdAt": "2020-09-18T08:11:51Z", "author": {"login": "Pearl1594"}, "path": "services/secondary-storage/server/src/main/java/org/apache/cloudstack/storage/resource/NfsSecondaryStorageResource.java", "diffHunk": "@@ -1049,8 +1049,11 @@ protected Answer execute(CopyCommand cmd) {\n         DataTO destData = cmd.getDestTO();\n         DataStoreTO srcDataStore = srcData.getDataStore();\n         DataStoreTO destDataStore = destData.getDataStore();\n-\n-        if (DataStoreRole.Image == srcDataStore.getRole()  && DataStoreRole.Image == destDataStore.getRole()) {\n+        if (DataStoreRole.Image == srcDataStore.getRole() && DataStoreRole.Image == destDataStore.getRole() &&\n+            srcDataStore instanceof NfsTO && destDataStore instanceof NfsTO &&\n+            ((srcData.getObjectType() == DataObjectType.TEMPLATE && destData.getObjectType() == DataObjectType.TEMPLATE) ||\n+                    (srcData.getObjectType() == DataObjectType.SNAPSHOT && destData.getObjectType() == DataObjectType.SNAPSHOT) ||\n+                    (srcData.getObjectType() == DataObjectType.VOLUME && destData.getObjectType() == DataObjectType.VOLUME))) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MDc2MjE5Mg=="}, "originalCommit": {"oid": "5d8d69c70146440b2d9dc3585cfe38ee818c1c2d"}, "originalPosition": 10}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4189, "cost": 1, "resetAt": "2021-11-12T11:18:39Z"}}}