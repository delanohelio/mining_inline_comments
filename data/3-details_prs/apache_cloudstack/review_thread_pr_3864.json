{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0MzcwNzc0MTkw", "number": 3864, "reviewThreads": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0wNFQxMjo0MTozMFrODc9pnQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0wNFQxMjo0MTozMFrODc9pnQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjMxNjk2Nzk3OnYy", "diffSide": "RIGHT", "path": "server/src/main/java/com/cloud/network/router/VirtualNetworkApplianceManagerImpl.java", "isResolved": true, "comments": {"totalCount": 9, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0wNFQxMjo0MTozMFrOFlSqtw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xMlQwOTozMDozNlrOFonRwQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NDY0NzQ3OQ==", "bodyText": "Could it cause regressions for anything others: LB, INTERNAL_LB_VM, NETSCALER_VM cc @weizhouapache @DaanHoogland", "url": "https://github.com/apache/cloudstack/pull/3864#discussion_r374647479", "createdAt": "2020-02-04T12:41:30Z", "author": {"login": "rhtyd"}, "path": "server/src/main/java/com/cloud/network/router/VirtualNetworkApplianceManagerImpl.java", "diffHunk": "@@ -885,6 +885,10 @@ public void doInTransactionWithoutResult(final TransactionStatus status) {\n     @DB\n     protected void updateSite2SiteVpnConnectionState(final List<DomainRouterVO> routers) {\n         for (final DomainRouterVO router : routers) {\n+            if (router.getRole() != Role.VIRTUAL_ROUTER) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "164f9847d63435eb30e7c543958c419cb64328d9"}, "originalPosition": 4}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NDY4Mzg1Ng==", "bodyText": "@rhtyd as far as I know, site2site vpn can only be applied on vpc vrs, so this should be ok.", "url": "https://github.com/apache/cloudstack/pull/3864#discussion_r374683856", "createdAt": "2020-02-04T13:57:28Z", "author": {"login": "weizhouapache"}, "path": "server/src/main/java/com/cloud/network/router/VirtualNetworkApplianceManagerImpl.java", "diffHunk": "@@ -885,6 +885,10 @@ public void doInTransactionWithoutResult(final TransactionStatus status) {\n     @DB\n     protected void updateSite2SiteVpnConnectionState(final List<DomainRouterVO> routers) {\n         for (final DomainRouterVO router : routers) {\n+            if (router.getRole() != Role.VIRTUAL_ROUTER) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NDY0NzQ3OQ=="}, "originalCommit": {"oid": "164f9847d63435eb30e7c543958c419cb64328d9"}, "originalPosition": 4}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NTA3ODcyNA==", "bodyText": "@weizhouapache @ravening cc @DaanHoogland - the only type I'm not sure about is Netscalars. @PaulAngus can you comment if netscalar supports site-to-site VPN?", "url": "https://github.com/apache/cloudstack/pull/3864#discussion_r375078724", "createdAt": "2020-02-05T06:30:00Z", "author": {"login": "rhtyd"}, "path": "server/src/main/java/com/cloud/network/router/VirtualNetworkApplianceManagerImpl.java", "diffHunk": "@@ -885,6 +885,10 @@ public void doInTransactionWithoutResult(final TransactionStatus status) {\n     @DB\n     protected void updateSite2SiteVpnConnectionState(final List<DomainRouterVO> routers) {\n         for (final DomainRouterVO router : routers) {\n+            if (router.getRole() != Role.VIRTUAL_ROUTER) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NDY0NzQ3OQ=="}, "originalCommit": {"oid": "164f9847d63435eb30e7c543958c419cb64328d9"}, "originalPosition": 4}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NTE5Nzc5Ng==", "bodyText": "Do we have netscaler users present and active?", "url": "https://github.com/apache/cloudstack/pull/3864#discussion_r375197796", "createdAt": "2020-02-05T11:19:02Z", "author": {"login": "DaanHoogland"}, "path": "server/src/main/java/com/cloud/network/router/VirtualNetworkApplianceManagerImpl.java", "diffHunk": "@@ -885,6 +885,10 @@ public void doInTransactionWithoutResult(final TransactionStatus status) {\n     @DB\n     protected void updateSite2SiteVpnConnectionState(final List<DomainRouterVO> routers) {\n         for (final DomainRouterVO router : routers) {\n+            if (router.getRole() != Role.VIRTUAL_ROUTER) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NDY0NzQ3OQ=="}, "originalCommit": {"oid": "164f9847d63435eb30e7c543958c419cb64328d9"}, "originalPosition": 4}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NTY1MDUyMw==", "bodyText": "We may that's why I've pinged @PaulAngus - advice?", "url": "https://github.com/apache/cloudstack/pull/3864#discussion_r375650523", "createdAt": "2020-02-06T05:47:02Z", "author": {"login": "rhtyd"}, "path": "server/src/main/java/com/cloud/network/router/VirtualNetworkApplianceManagerImpl.java", "diffHunk": "@@ -885,6 +885,10 @@ public void doInTransactionWithoutResult(final TransactionStatus status) {\n     @DB\n     protected void updateSite2SiteVpnConnectionState(final List<DomainRouterVO> routers) {\n         for (final DomainRouterVO router : routers) {\n+            if (router.getRole() != Role.VIRTUAL_ROUTER) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NDY0NzQ3OQ=="}, "originalCommit": {"oid": "164f9847d63435eb30e7c543958c419cb64328d9"}, "originalPosition": 4}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NjIyMjUwMQ==", "bodyText": "Ping @andrijapanicsb @PaulAngus", "url": "https://github.com/apache/cloudstack/pull/3864#discussion_r376222501", "createdAt": "2020-02-07T05:41:35Z", "author": {"login": "rhtyd"}, "path": "server/src/main/java/com/cloud/network/router/VirtualNetworkApplianceManagerImpl.java", "diffHunk": "@@ -885,6 +885,10 @@ public void doInTransactionWithoutResult(final TransactionStatus status) {\n     @DB\n     protected void updateSite2SiteVpnConnectionState(final List<DomainRouterVO> routers) {\n         for (final DomainRouterVO router : routers) {\n+            if (router.getRole() != Role.VIRTUAL_ROUTER) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NDY0NzQ3OQ=="}, "originalCommit": {"oid": "164f9847d63435eb30e7c543958c419cb64328d9"}, "originalPosition": 4}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NjM2OTc3Mw==", "bodyText": "not sure I can advise here... I say we go forward, as NetScaller should definitively NOT be marked as \"VIRTUAL_ROUTER\"", "url": "https://github.com/apache/cloudstack/pull/3864#discussion_r376369773", "createdAt": "2020-02-07T12:39:09Z", "author": {"login": "andrijapanicsb"}, "path": "server/src/main/java/com/cloud/network/router/VirtualNetworkApplianceManagerImpl.java", "diffHunk": "@@ -885,6 +885,10 @@ public void doInTransactionWithoutResult(final TransactionStatus status) {\n     @DB\n     protected void updateSite2SiteVpnConnectionState(final List<DomainRouterVO> routers) {\n         for (final DomainRouterVO router : routers) {\n+            if (router.getRole() != Role.VIRTUAL_ROUTER) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NDY0NzQ3OQ=="}, "originalCommit": {"oid": "164f9847d63435eb30e7c543958c419cb64328d9"}, "originalPosition": 4}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NjY5NTAyNA==", "bodyText": "@ravening can you change the conditional to: router.getRole() == INTERNAL_LB_VM", "url": "https://github.com/apache/cloudstack/pull/3864#discussion_r376695024", "createdAt": "2020-02-08T07:51:04Z", "author": {"login": "rhtyd"}, "path": "server/src/main/java/com/cloud/network/router/VirtualNetworkApplianceManagerImpl.java", "diffHunk": "@@ -885,6 +885,10 @@ public void doInTransactionWithoutResult(final TransactionStatus status) {\n     @DB\n     protected void updateSite2SiteVpnConnectionState(final List<DomainRouterVO> routers) {\n         for (final DomainRouterVO router : routers) {\n+            if (router.getRole() != Role.VIRTUAL_ROUTER) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NDY0NzQ3OQ=="}, "originalCommit": {"oid": "164f9847d63435eb30e7c543958c419cb64328d9"}, "originalPosition": 4}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3ODEzMDg4MQ==", "bodyText": "I have made necessary changes", "url": "https://github.com/apache/cloudstack/pull/3864#discussion_r378130881", "createdAt": "2020-02-12T09:30:36Z", "author": {"login": "ravening"}, "path": "server/src/main/java/com/cloud/network/router/VirtualNetworkApplianceManagerImpl.java", "diffHunk": "@@ -885,6 +885,10 @@ public void doInTransactionWithoutResult(final TransactionStatus status) {\n     @DB\n     protected void updateSite2SiteVpnConnectionState(final List<DomainRouterVO> routers) {\n         for (final DomainRouterVO router : routers) {\n+            if (router.getRole() != Role.VIRTUAL_ROUTER) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NDY0NzQ3OQ=="}, "originalCommit": {"oid": "164f9847d63435eb30e7c543958c419cb64328d9"}, "originalPosition": 4}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4024, "cost": 1, "resetAt": "2021-11-12T11:18:39Z"}}}