{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0MzY5NjU1MTg2", "number": 3857, "title": "vr: add missing rule for port forwarding rule in vpc", "bodyText": "Description\n\nWhen create a port forwarding rule to a vm in vpc, we cannot access the port forwarding rule from inside the vm.\nSteps to reproduce\n(1) create a port forwarding rule in VPC, public ip X.X.X.X to vm Y.Y.Y.Y port 22\n(2) ssh to vm, or login vm console\n(3) in vm, ssh X.X.X.X does not work.\nFixes: #3763\nTypes of changes\n\n\n Breaking change (fix or feature that would cause existing functionality to change)\n New feature (non-breaking change which adds functionality)\n Bug fix (non-breaking change which fixes an issue)\n Enhancement (improves an existing feature and functionality)\n Cleanup (Code refactoring and cleanup, that may add test cases)\n\nScreenshots (if appropriate):\nHow Has This Been Tested?\n\n\n\nwith this change, the public Ip is reachable from inside vm in step (3) above.", "createdAt": "2020-01-31T16:10:40Z", "url": "https://github.com/apache/cloudstack/pull/3857", "merged": true, "mergeCommit": {"oid": "d88c614a35107015f211c598282c03f0408f32d2"}, "closed": true, "closedAt": "2020-02-06T19:25:57Z", "author": {"login": "ustcweizhou"}, "timelineItems": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABb_xWQcgH2gAyMzY5NjU1MTg2Ojg2NzZhNjYwMGNlNTY4ODE1MjM1OGQ5YzIzNjE1MTZiYmQxMGViZWM=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcBsV5mgFqTM1NDUzMjQ5Mg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "8676a6600ce5688152358d9c2361516bbd10ebec", "author": {"user": {"login": "ustcweizhou", "name": "Wei Zhou"}}, "url": "https://github.com/apache/cloudstack/commit/8676a6600ce5688152358d9c2361516bbd10ebec", "committedDate": "2020-01-31T16:01:49Z", "message": "vr: add missing rule for port forwarding rule in vpc"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzUyMTA3OTk4", "url": "https://github.com/apache/cloudstack/pull/3857#pullrequestreview-352107998", "createdAt": "2020-02-03T09:15:31Z", "commit": {"oid": "8676a6600ce5688152358d9c2361516bbd10ebec"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzU0MjEzMzk1", "url": "https://github.com/apache/cloudstack/pull/3857#pullrequestreview-354213395", "createdAt": "2020-02-06T05:51:02Z", "commit": {"oid": "8676a6600ce5688152358d9c2361516bbd10ebec"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0wNlQwNTo1MTowM1rOFmP8EA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0wNlQwNTo1MTowM1rOFmP8EA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NTY1MTM0NA==", "bodyText": "@ustcweizhou can you fix the indent issue here, run pycodestyle --max-line-length=179 on this file to confirm. See Travis' 1st job failure for hints: ../debian/opt/cloud/bin/configure.py:940:15: E127 continuation line over-indented for visual indent", "url": "https://github.com/apache/cloudstack/pull/3857#discussion_r375651344", "createdAt": "2020-02-06T05:51:03Z", "author": {"login": "rhtyd"}, "path": "systemvm/debian/opt/cloud/bin/configure.py", "diffHunk": "@@ -930,8 +936,20 @@ def forward_vpc(self, rule):\n         if not rule[\"internal_ports\"] == \"any\":\n             fw_output_rule += \":\" + self.portsToString(rule[\"internal_ports\"], \"-\")\n \n+        fw_postrout_rule2 = \"-j SNAT --to-source %s -A POSTROUTING -s %s -d %s/32 -o %s -p %s -m %s --dport %s\" % \\\n+              (", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "8676a6600ce5688152358d9c2361516bbd10ebec"}, "originalPosition": 18}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b9ae8c4a1efba03d0ff2961b7d612639222305d2", "author": {"user": {"login": "ustcweizhou", "name": "Wei Zhou"}}, "url": "https://github.com/apache/cloudstack/commit/b9ae8c4a1efba03d0ff2961b7d612639222305d2", "committedDate": "2020-02-06T08:23:36Z", "message": "vr: fix check error with 'pycodestyle --max-line-length=179 systemvm/debian/opt/cloud/bin/configure.py'"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzU0NTMyNDky", "url": "https://github.com/apache/cloudstack/pull/3857#pullrequestreview-354532492", "createdAt": "2020-02-06T15:19:45Z", "commit": {"oid": "b9ae8c4a1efba03d0ff2961b7d612639222305d2"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4585, "cost": 1, "resetAt": "2021-10-28T17:48:14Z"}}}