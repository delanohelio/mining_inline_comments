{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDM4MTQ4NzQ3", "number": 4165, "title": "Allow renaming cluster, host, and storage", "bodyText": "Description\n\nThis PR adds implementation for changing host and storage name, additionally, it fixes a Bug on cluster updateCluster API command. This PRs also enhances the UI by allowing editing field name on Host and Storage pool. Due to the fact that there is no support to editing cluster via UI, it was not edited.\nTODO:  I will address Host,  Cluster, and Storage Pool name edition on CloudStack Primate once the API implementation gets merged.\nDetails:\nPrior to this PR the following API commands did not offer support for updating name:\n\nupdateHost (enhancement)\nupdateStoragePool  (enhancement)\n\nAdditionally, updateCluster claims to support changing a cluster name (via clustername parameter); however, such operation did not work.  (bug)\n\n\n\n\n\nTypes of changes\n\n\n Breaking change (fix or feature that would cause existing functionality to change)\n New feature (non-breaking change which adds functionality)\n Bug fix (non-breaking change which fixes an issue)\n Enhancement (improves an existing feature and functionality)\n Cleanup (Code refactoring and cleanup, that may add test cases)\n\nHow Has This Been Tested?\n\n\n\n\nVia API,  change host, cluster, and storage pool names.\nVia UI, change host and storage pool names.", "createdAt": "2020-06-22T20:02:04Z", "url": "https://github.com/apache/cloudstack/pull/4165", "merged": true, "mergeCommit": {"oid": "22374860794f3348ed0b1e9a941b5e0b4b91de29"}, "closed": true, "closedAt": "2020-08-05T08:38:30Z", "author": {"login": "GabrielBrascher"}, "timelineItems": {"totalCount": 13, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABctp-uvAH2gAyNDM4MTQ4NzQ3OmY1ZDgwYmJmMzI4ZmY0ZDI2N2ZkOTAyYzE5M2U0MTZmMjliNDljNTI=", "endCursor": "Y3Vyc29yOnYyOpPPAAABc73FEqAFqTQ2MTQ1NjU0MA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "f5d80bbf328ff4d267fd902c193e416f29b49c52", "author": {"user": {"login": "GabrielBrascher", "name": "Gabriel Beims Br\u00e4scher"}}, "url": "https://github.com/apache/cloudstack/commit/f5d80bbf328ff4d267fd902c193e416f29b49c52", "committedDate": "2020-06-22T05:27:18Z", "message": "Update cluster name"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "813ea48c1faf99800936420be3fc2d6ba9f2bc39", "author": {"user": {"login": "GabrielBrascher", "name": "Gabriel Beims Br\u00e4scher"}}, "url": "https://github.com/apache/cloudstack/commit/813ea48c1faf99800936420be3fc2d6ba9f2bc39", "committedDate": "2020-06-22T06:39:41Z", "message": "Update name of Host"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDM1MjM0NTAw", "url": "https://github.com/apache/cloudstack/pull/4165#pullrequestreview-435234500", "createdAt": "2020-06-22T20:05:09Z", "commit": {"oid": "38e69e5afa11ba9a4d383e97609073b5ab1876d7"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yMlQyMDowNTowOVrOGnPHPA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yMlQyMDowNTowOVrOGnPHPA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0Mzc5NTI2MA==", "bodyText": "@nvazquez can you please take a look at it?\nI changed API parameter handling from separate parameters on the method call to an object of UpdateClusterCmd class. Therefore, I needed to change this tiny piece of RollingMaintenanceManagerImpl.", "url": "https://github.com/apache/cloudstack/pull/4165#discussion_r443795260", "createdAt": "2020-06-22T20:05:09Z", "author": {"login": "GabrielBrascher"}, "path": "server/src/main/java/com/cloud/resource/RollingMaintenanceManagerImpl.java", "diffHunk": "@@ -114,12 +115,15 @@ public boolean configure(String name, Map<String, Object> params) throws Configu\n         return true;\n     }\n \n-    private void updateCluster(long clusterId, String state) {\n+    private void updateCluster(long clusterId, String allocationState) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "38e69e5afa11ba9a4d383e97609073b5ab1876d7"}, "originalPosition": 13}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "bef567f835c950aa62f4d60cf9060130d043e840", "author": {"user": {"login": "GabrielBrascher", "name": "Gabriel Beims Br\u00e4scher"}}, "url": "https://github.com/apache/cloudstack/commit/bef567f835c950aa62f4d60cf9060130d043e840", "committedDate": "2020-06-22T20:07:01Z", "message": "Fix UpdateClusterCmd for Rolling maintenance, MockResourceManager\n\nUpdate Host name handling to update instead of persist\n\nAllow update\n Storage name"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "38e69e5afa11ba9a4d383e97609073b5ab1876d7", "author": {"user": {"login": "GabrielBrascher", "name": "Gabriel Beims Br\u00e4scher"}}, "url": "https://github.com/apache/cloudstack/commit/38e69e5afa11ba9a4d383e97609073b5ab1876d7", "committedDate": "2020-06-22T18:49:16Z", "message": "Fix UpdateClusterCmd for Rolling maintenance, MockResourceManager\n\nUpdate Host name handling to update instead of persist\n\nAllow update\n Storage name"}, "afterCommit": {"oid": "bef567f835c950aa62f4d60cf9060130d043e840", "author": {"user": {"login": "GabrielBrascher", "name": "Gabriel Beims Br\u00e4scher"}}, "url": "https://github.com/apache/cloudstack/commit/bef567f835c950aa62f4d60cf9060130d043e840", "committedDate": "2020-06-22T20:07:01Z", "message": "Fix UpdateClusterCmd for Rolling maintenance, MockResourceManager\n\nUpdate Host name handling to update instead of persist\n\nAllow update\n Storage name"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "91961eb8f72471c9c8a8d151a9be812bd91ffe0f", "author": {"user": {"login": "GabrielBrascher", "name": "Gabriel Beims Br\u00e4scher"}}, "url": "https://github.com/apache/cloudstack/commit/91961eb8f72471c9c8a8d151a9be812bd91ffe0f", "committedDate": "2020-06-22T20:18:37Z", "message": "add log message for updating cluster and storage pool name"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDM2NTYxMjQ4", "url": "https://github.com/apache/cloudstack/pull/4165#pullrequestreview-436561248", "createdAt": "2020-06-24T11:33:19Z", "commit": {"oid": "91961eb8f72471c9c8a8d151a9be812bd91ffe0f"}, "state": "COMMENTED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "cea53fbb8e0ef94bb0b3b6f20ab0bac260b4bf91", "author": {"user": {"login": "GabrielBrascher", "name": "Gabriel Beims Br\u00e4scher"}}, "url": "https://github.com/apache/cloudstack/commit/cea53fbb8e0ef94bb0b3b6f20ab0bac260b4bf91", "committedDate": "2020-06-24T20:49:56Z", "message": "Prevent renaming VMware cluster as it could cause problems."}, "afterCommit": {"oid": "74e99009307ab7751ea175795a45fb97ed66a709", "author": {"user": {"login": "GabrielBrascher", "name": "Gabriel Beims Br\u00e4scher"}}, "url": "https://github.com/apache/cloudstack/commit/74e99009307ab7751ea175795a45fb97ed66a709", "committedDate": "2020-06-24T20:52:31Z", "message": "Prevent renaming VMware cluster as it could cause problems."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "9176e290e296ced915e831dc403f5971948aa701", "author": {"user": {"login": "GabrielBrascher", "name": "Gabriel Beims Br\u00e4scher"}}, "url": "https://github.com/apache/cloudstack/commit/9176e290e296ced915e831dc403f5971948aa701", "committedDate": "2020-06-24T20:54:37Z", "message": "Prevent renaming VMware cluster as it could cause problems."}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "74e99009307ab7751ea175795a45fb97ed66a709", "author": {"user": {"login": "GabrielBrascher", "name": "Gabriel Beims Br\u00e4scher"}}, "url": "https://github.com/apache/cloudstack/commit/74e99009307ab7751ea175795a45fb97ed66a709", "committedDate": "2020-06-24T20:52:31Z", "message": "Prevent renaming VMware cluster as it could cause problems."}, "afterCommit": {"oid": "9176e290e296ced915e831dc403f5971948aa701", "author": {"user": {"login": "GabrielBrascher", "name": "Gabriel Beims Br\u00e4scher"}}, "url": "https://github.com/apache/cloudstack/commit/9176e290e296ced915e831dc403f5971948aa701", "committedDate": "2020-06-24T20:54:37Z", "message": "Prevent renaming VMware cluster as it could cause problems."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDQzNTEyOTM5", "url": "https://github.com/apache/cloudstack/pull/4165#pullrequestreview-443512939", "createdAt": "2020-07-07T02:03:23Z", "commit": {"oid": "9176e290e296ced915e831dc403f5971948aa701"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDUwMTU3ODY3", "url": "https://github.com/apache/cloudstack/pull/4165#pullrequestreview-450157867", "createdAt": "2020-07-16T19:36:24Z", "commit": {"oid": "9176e290e296ced915e831dc403f5971948aa701"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xNlQxOTozNjoyNFrOGy5waw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xNlQxOTozNjoyNFrOGy5waw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NjAyODI2Nw==", "bodyText": "@rhtyd considering your concerns with issues caused by renaming VMware clusters I added this line.", "url": "https://github.com/apache/cloudstack/pull/4165#discussion_r456028267", "createdAt": "2020-07-16T19:36:24Z", "author": {"login": "GabrielBrascher"}, "path": "server/src/main/java/com/cloud/resource/ResourceManagerImpl.java", "diffHunk": "@@ -1026,12 +1027,26 @@ public void doInTransactionWithoutResult(final TransactionStatus status) {\n \n     @Override\n     @DB\n-    public Cluster updateCluster(final Cluster clusterToUpdate, final String clusterType, final String hypervisor, final String allocationState, final String managedstate) {\n+    public Cluster updateCluster(UpdateClusterCmd cmd) {\n+        ClusterVO cluster = (ClusterVO) getCluster(cmd.getId());\n+        String clusterType = cmd.getClusterType();\n+        String hypervisor = cmd.getHypervisor();\n+        String allocationState = cmd.getAllocationState();\n+        String managedstate = cmd.getManagedstate();\n+        String name = cmd.getClusterName();\n \n-        final ClusterVO cluster = (ClusterVO)clusterToUpdate;\n         // Verify cluster information and update the cluster if needed\n         boolean doUpdate = false;\n \n+        if (org.apache.commons.lang.StringUtils.isNotBlank(name)) {\n+            if(cluster.getHypervisorType() == HypervisorType.VMware) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "9176e290e296ced915e831dc403f5971948aa701"}, "originalPosition": 26}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDYxNDU2NTQw", "url": "https://github.com/apache/cloudstack/pull/4165#pullrequestreview-461456540", "createdAt": "2020-08-05T08:37:56Z", "commit": {"oid": "9176e290e296ced915e831dc403f5971948aa701"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3873, "cost": 1, "resetAt": "2021-10-28T17:48:14Z"}}}